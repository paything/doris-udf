(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=e(r);fetch(r.href,s)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function KI(n){const t=Object.create(null);for(const e of n.split(","))t[e]=1;return e=>e in t}const Ti={},up=[],Va=()=>{},hst=()=>!1,FA=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&(n.charCodeAt(2)>122||n.charCodeAt(2)<97),qI=n=>n.startsWith("onUpdate:"),Hr=Object.assign,ZI=(n,t)=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)},dst=Object.prototype.hasOwnProperty,yi=(n,t)=>dst.call(n,t),ve=Array.isArray,cp=n=>U0(n)==="[object Map]",Ef=n=>U0(n)==="[object Set]",HH=n=>U0(n)==="[object Date]",Ie=n=>typeof n=="function",Bn=n=>typeof n=="string",Ya=n=>typeof n=="symbol",ji=n=>n!==null&&typeof n=="object",t9=n=>(ji(n)||Ie(n))&&Ie(n.then)&&Ie(n.catch),e9=Object.prototype.toString,U0=n=>e9.call(n),ust=n=>U0(n).slice(8,-1),i9=n=>U0(n)==="[object Object]",JI=n=>Bn(n)&&n!=="NaN"&&n[0]!=="-"&&""+parseInt(n,10)===n,rv=KI(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),HA=n=>{const t=Object.create(null);return e=>t[e]||(t[e]=n(e))},cst=/-(\w)/g,Ad=HA(n=>n.replace(cst,(t,e)=>e?e.toUpperCase():"")),gst=/\B([A-Z])/g,Vc=HA(n=>n.replace(gst,"-$1").toLowerCase()),n9=HA(n=>n.charAt(0).toUpperCase()+n.slice(1)),ek=HA(n=>n?`on${n9(n)}`:""),ad=(n,t)=>!Object.is(n,t),uC=(n,...t)=>{for(let e=0;e<n.length;e++)n[e](...t)},r9=(n,t,e,i=!1)=>{Object.defineProperty(n,t,{configurable:!0,enumerable:!1,writable:i,value:e})},NC=n=>{const t=parseFloat(n);return isNaN(t)?n:t};let zH;const zA=()=>zH||(zH=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function QI(n){if(ve(n)){const t={};for(let e=0;e<n.length;e++){const i=n[e],r=Bn(i)?vst(i):QI(i);if(r)for(const s in r)t[s]=r[s]}return t}else if(Bn(n)||ji(n))return n}const pst=/;(?![^(]*\))/g,fst=/:([^]+)/,mst=/\/\*[^]*?\*\//g;function vst(n){const t={};return n.replace(mst,"").split(pst).forEach(e=>{if(e){const i=e.split(fst);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function y_(n){let t="";if(Bn(n))t=n;else if(ve(n))for(let e=0;e<n.length;e++){const i=y_(n[e]);i&&(t+=i+" ")}else if(ji(n))for(const e in n)n[e]&&(t+=e+" ");return t.trim()}const _st="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",bst=KI(_st);function s9(n){return!!n||n===""}function yst(n,t){if(n.length!==t.length)return!1;let e=!0;for(let i=0;e&&i<n.length;i++)e=hc(n[i],t[i]);return e}function hc(n,t){if(n===t)return!0;let e=HH(n),i=HH(t);if(e||i)return e&&i?n.getTime()===t.getTime():!1;if(e=Ya(n),i=Ya(t),e||i)return n===t;if(e=ve(n),i=ve(t),e||i)return e&&i?yst(n,t):!1;if(e=ji(n),i=ji(t),e||i){if(!e||!i)return!1;const r=Object.keys(n).length,s=Object.keys(t).length;if(r!==s)return!1;for(const o in n){const a=n.hasOwnProperty(o),l=t.hasOwnProperty(o);if(a&&!l||!a&&l||!hc(n[o],t[o]))return!1}}return String(n)===String(t)}function tO(n,t){return n.findIndex(e=>hc(e,t))}const o9=n=>!!(n&&n.__v_isRef===!0),Sg=n=>Bn(n)?n:n==null?"":ve(n)||ji(n)&&(n.toString===e9||!Ie(n.toString))?o9(n)?Sg(n.value):JSON.stringify(n,a9,2):String(n),a9=(n,t)=>o9(t)?a9(n,t.value):cp(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((e,[i,r],s)=>(e[ik(i,s)+" =>"]=r,e),{})}:Ef(t)?{[`Set(${t.size})`]:[...t.values()].map(e=>ik(e))}:Ya(t)?ik(t):ji(t)&&!ve(t)&&!i9(t)?String(t):t,ik=(n,t="")=>{var e;return Ya(n)?`Symbol(${(e=n.description)!=null?e:t})`:n};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Ts;class Cst{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Ts,!t&&Ts&&(this.index=(Ts.scopes||(Ts.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].pause();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,e;if(this.scopes)for(t=0,e=this.scopes.length;t<e;t++)this.scopes[t].resume();for(t=0,e=this.effects.length;t<e;t++)this.effects[t].resume()}}run(t){if(this._active){const e=Ts;try{return Ts=this,t()}finally{Ts=e}}}on(){Ts=this}off(){Ts=this.parent}stop(t){if(this._active){this._active=!1;let e,i;for(e=0,i=this.effects.length;e<i;e++)this.effects[e].stop();for(this.effects.length=0,e=0,i=this.cleanups.length;e<i;e++)this.cleanups[e]();if(this.cleanups.length=0,this.scopes){for(e=0,i=this.scopes.length;e<i;e++)this.scopes[e].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function Sst(){return Ts}let Li;const nk=new WeakSet;class l9{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Ts&&Ts.active&&Ts.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,nk.has(this)&&(nk.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||d9(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,WH(this),u9(this);const t=Li,e=ta;Li=this,ta=!0;try{return this.fn()}finally{c9(this),Li=t,ta=e,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)nO(t);this.deps=this.depsTail=void 0,WH(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?nk.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){uP(this)&&this.run()}get dirty(){return uP(this)}}let h9=0,sv,ov;function d9(n,t=!1){if(n.flags|=8,t){n.next=ov,ov=n;return}n.next=sv,sv=n}function eO(){h9++}function iO(){if(--h9>0)return;if(ov){let t=ov;for(ov=void 0;t;){const e=t.next;t.next=void 0,t.flags&=-9,t=e}}let n;for(;sv;){let t=sv;for(sv=void 0;t;){const e=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(i){n||(n=i)}t=e}}if(n)throw n}function u9(n){for(let t=n.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function c9(n){let t,e=n.depsTail,i=e;for(;i;){const r=i.prevDep;i.version===-1?(i===e&&(e=r),nO(i),xst(i)):t=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=r}n.deps=t,n.depsTail=e}function uP(n){for(let t=n.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(g9(t.dep.computed)||t.dep.version!==t.version))return!0;return!!n._dirty}function g9(n){if(n.flags&4&&!(n.flags&16)||(n.flags&=-17,n.globalVersion===C_))return;n.globalVersion=C_;const t=n.dep;if(n.flags|=2,t.version>0&&!n.isSSR&&n.deps&&!uP(n)){n.flags&=-3;return}const e=Li,i=ta;Li=n,ta=!0;try{u9(n);const r=n.fn(n._value);(t.version===0||ad(r,n._value))&&(n._value=r,t.version++)}catch(r){throw t.version++,r}finally{Li=e,ta=i,c9(n),n.flags&=-3}}function nO(n,t=!1){const{dep:e,prevSub:i,nextSub:r}=n;if(i&&(i.nextSub=r,n.prevSub=void 0),r&&(r.prevSub=i,n.nextSub=void 0),e.subs===n&&(e.subs=i,!i&&e.computed)){e.computed.flags&=-5;for(let s=e.computed.deps;s;s=s.nextDep)nO(s,!0)}!t&&!--e.sc&&e.map&&e.map.delete(e.key)}function xst(n){const{prevDep:t,nextDep:e}=n;t&&(t.nextDep=e,n.prevDep=void 0),e&&(e.prevDep=t,n.nextDep=void 0)}let ta=!0;const p9=[];function Hd(){p9.push(ta),ta=!1}function zd(){const n=p9.pop();ta=n===void 0?!0:n}function WH(n){const{cleanup:t}=n;if(n.cleanup=void 0,t){const e=Li;Li=void 0;try{t()}finally{Li=e}}}let C_=0;class wst{constructor(t,e){this.sub=t,this.dep=e,this.version=e.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class rO{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!Li||!ta||Li===this.computed)return;let e=this.activeLink;if(e===void 0||e.sub!==Li)e=this.activeLink=new wst(Li,this),Li.deps?(e.prevDep=Li.depsTail,Li.depsTail.nextDep=e,Li.depsTail=e):Li.deps=Li.depsTail=e,f9(e);else if(e.version===-1&&(e.version=this.version,e.nextDep)){const i=e.nextDep;i.prevDep=e.prevDep,e.prevDep&&(e.prevDep.nextDep=i),e.prevDep=Li.depsTail,e.nextDep=void 0,Li.depsTail.nextDep=e,Li.depsTail=e,Li.deps===e&&(Li.deps=i)}return e}trigger(t){this.version++,C_++,this.notify(t)}notify(t){eO();try{for(let e=this.subs;e;e=e.prevSub)e.sub.notify()&&e.sub.dep.notify()}finally{iO()}}}function f9(n){if(n.dep.sc++,n.sub.flags&4){const t=n.dep.computed;if(t&&!n.dep.subs){t.flags|=20;for(let i=t.deps;i;i=i.nextDep)f9(i)}const e=n.dep.subs;e!==n&&(n.prevSub=e,e&&(e.nextSub=n)),n.dep.subs=n}}const cP=new WeakMap,Uu=Symbol(""),gP=Symbol(""),S_=Symbol("");function br(n,t,e){if(ta&&Li){let i=cP.get(n);i||cP.set(n,i=new Map);let r=i.get(e);r||(i.set(e,r=new rO),r.map=i,r.key=e),r.track()}}function El(n,t,e,i,r,s){const o=cP.get(n);if(!o){C_++;return}const a=l=>{l&&l.trigger()};if(eO(),t==="clear")o.forEach(a);else{const l=ve(n),h=l&&JI(e);if(l&&e==="length"){const d=Number(i);o.forEach((u,c)=>{(c==="length"||c===S_||!Ya(c)&&c>=d)&&a(u)})}else switch((e!==void 0||o.has(void 0))&&a(o.get(e)),h&&a(o.get(S_)),t){case"add":l?h&&a(o.get("length")):(a(o.get(Uu)),cp(n)&&a(o.get(gP)));break;case"delete":l||(a(o.get(Uu)),cp(n)&&a(o.get(gP)));break;case"set":cp(n)&&a(o.get(Uu));break}}iO()}function ig(n){const t=bi(n);return t===n?t:(br(t,"iterate",S_),yo(n)?t:t.map(yr))}function WA(n){return br(n=bi(n),"iterate",S_),n}const Ast={__proto__:null,[Symbol.iterator](){return rk(this,Symbol.iterator,yr)},concat(...n){return ig(this).concat(...n.map(t=>ve(t)?ig(t):t))},entries(){return rk(this,"entries",n=>(n[1]=yr(n[1]),n))},every(n,t){return dl(this,"every",n,t,void 0,arguments)},filter(n,t){return dl(this,"filter",n,t,e=>e.map(yr),arguments)},find(n,t){return dl(this,"find",n,t,yr,arguments)},findIndex(n,t){return dl(this,"findIndex",n,t,void 0,arguments)},findLast(n,t){return dl(this,"findLast",n,t,yr,arguments)},findLastIndex(n,t){return dl(this,"findLastIndex",n,t,void 0,arguments)},forEach(n,t){return dl(this,"forEach",n,t,void 0,arguments)},includes(...n){return sk(this,"includes",n)},indexOf(...n){return sk(this,"indexOf",n)},join(n){return ig(this).join(n)},lastIndexOf(...n){return sk(this,"lastIndexOf",n)},map(n,t){return dl(this,"map",n,t,void 0,arguments)},pop(){return Jf(this,"pop")},push(...n){return Jf(this,"push",n)},reduce(n,...t){return jH(this,"reduce",n,t)},reduceRight(n,...t){return jH(this,"reduceRight",n,t)},shift(){return Jf(this,"shift")},some(n,t){return dl(this,"some",n,t,void 0,arguments)},splice(...n){return Jf(this,"splice",n)},toReversed(){return ig(this).toReversed()},toSorted(n){return ig(this).toSorted(n)},toSpliced(...n){return ig(this).toSpliced(...n)},unshift(...n){return Jf(this,"unshift",n)},values(){return rk(this,"values",yr)}};function rk(n,t,e){const i=WA(n),r=i[t]();return i!==n&&!yo(n)&&(r._next=r.next,r.next=()=>{const s=r._next();return s.value&&(s.value=e(s.value)),s}),r}const Mst=Array.prototype;function dl(n,t,e,i,r,s){const o=WA(n),a=o!==n&&!yo(n),l=o[t];if(l!==Mst[t]){const u=l.apply(n,s);return a?yr(u):u}let h=e;o!==n&&(a?h=function(u,c){return e.call(this,yr(u),c,n)}:e.length>2&&(h=function(u,c){return e.call(this,u,c,n)}));const d=l.call(o,h,i);return a&&r?r(d):d}function jH(n,t,e,i){const r=WA(n);let s=e;return r!==n&&(yo(n)?e.length>3&&(s=function(o,a,l){return e.call(this,o,a,l,n)}):s=function(o,a,l){return e.call(this,o,yr(a),l,n)}),r[t](s,...i)}function sk(n,t,e){const i=bi(n);br(i,"iterate",S_);const r=i[t](...e);return(r===-1||r===!1)&&lO(e[0])?(e[0]=bi(e[0]),i[t](...e)):r}function Jf(n,t,e=[]){Hd(),eO();const i=bi(n)[t].apply(n,e);return iO(),zd(),i}const Tst=KI("__proto__,__v_isRef,__isVue"),m9=new Set(Object.getOwnPropertyNames(Symbol).filter(n=>n!=="arguments"&&n!=="caller").map(n=>Symbol[n]).filter(Ya));function kst(n){Ya(n)||(n=String(n));const t=bi(this);return br(t,"has",n),t.hasOwnProperty(n)}class v9{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,i){if(e==="__v_skip")return t.__v_skip;const r=this._isReadonly,s=this._isShallow;if(e==="__v_isReactive")return!r;if(e==="__v_isReadonly")return r;if(e==="__v_isShallow")return s;if(e==="__v_raw")return i===(r?s?Hst:C9:s?y9:b9).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(i)?t:void 0;const o=ve(t);if(!r){let l;if(o&&(l=Ast[e]))return l;if(e==="hasOwnProperty")return kst}const a=Reflect.get(t,e,Sr(t)?t:i);return(Ya(e)?m9.has(e):Tst(e))||(r||br(t,"get",e),s)?a:Sr(a)?o&&JI(e)?a:a.value:ji(a)?r?S9(a):oO(a):a}}class _9 extends v9{constructor(t=!1){super(!1,t)}set(t,e,i,r){let s=t[e];if(!this._isShallow){const l=dc(s);if(!yo(i)&&!dc(i)&&(s=bi(s),i=bi(i)),!ve(t)&&Sr(s)&&!Sr(i))return l?!1:(s.value=i,!0)}const o=ve(t)&&JI(e)?Number(e)<t.length:yi(t,e),a=Reflect.set(t,e,i,Sr(t)?t:r);return t===bi(r)&&(o?ad(i,s)&&El(t,"set",e,i):El(t,"add",e,i)),a}deleteProperty(t,e){const i=yi(t,e);t[e];const r=Reflect.deleteProperty(t,e);return r&&i&&El(t,"delete",e,void 0),r}has(t,e){const i=Reflect.has(t,e);return(!Ya(e)||!m9.has(e))&&br(t,"has",e),i}ownKeys(t){return br(t,"iterate",ve(t)?"length":Uu),Reflect.ownKeys(t)}}class Rst extends v9{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const Bst=new _9,Pst=new Rst,Est=new _9(!0);const pP=n=>n,zb=n=>Reflect.getPrototypeOf(n);function Lst(n,t,e){return function(...i){const r=this.__v_raw,s=bi(r),o=cp(s),a=n==="entries"||n===Symbol.iterator&&o,l=n==="keys"&&o,h=r[n](...i),d=e?pP:t?fP:yr;return!t&&br(s,"iterate",l?gP:Uu),{next(){const{value:u,done:c}=h.next();return c?{value:u,done:c}:{value:a?[d(u[0]),d(u[1])]:d(u),done:c}},[Symbol.iterator](){return this}}}}function Wb(n){return function(...t){return n==="delete"?!1:n==="clear"?void 0:this}}function Ist(n,t){const e={get(r){const s=this.__v_raw,o=bi(s),a=bi(r);n||(ad(r,a)&&br(o,"get",r),br(o,"get",a));const{has:l}=zb(o),h=t?pP:n?fP:yr;if(l.call(o,r))return h(s.get(r));if(l.call(o,a))return h(s.get(a));s!==o&&s.get(r)},get size(){const r=this.__v_raw;return!n&&br(bi(r),"iterate",Uu),Reflect.get(r,"size",r)},has(r){const s=this.__v_raw,o=bi(s),a=bi(r);return n||(ad(r,a)&&br(o,"has",r),br(o,"has",a)),r===a?s.has(r):s.has(r)||s.has(a)},forEach(r,s){const o=this,a=o.__v_raw,l=bi(a),h=t?pP:n?fP:yr;return!n&&br(l,"iterate",Uu),a.forEach((d,u)=>r.call(s,h(d),h(u),o))}};return Hr(e,n?{add:Wb("add"),set:Wb("set"),delete:Wb("delete"),clear:Wb("clear")}:{add(r){!t&&!yo(r)&&!dc(r)&&(r=bi(r));const s=bi(this);return zb(s).has.call(s,r)||(s.add(r),El(s,"add",r,r)),this},set(r,s){!t&&!yo(s)&&!dc(s)&&(s=bi(s));const o=bi(this),{has:a,get:l}=zb(o);let h=a.call(o,r);h||(r=bi(r),h=a.call(o,r));const d=l.call(o,r);return o.set(r,s),h?ad(s,d)&&El(o,"set",r,s):El(o,"add",r,s),this},delete(r){const s=bi(this),{has:o,get:a}=zb(s);let l=o.call(s,r);l||(r=bi(r),l=o.call(s,r)),a&&a.call(s,r);const h=s.delete(r);return l&&El(s,"delete",r,void 0),h},clear(){const r=bi(this),s=r.size!==0,o=r.clear();return s&&El(r,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=Lst(r,n,t)}),e}function sO(n,t){const e=Ist(n,t);return(i,r,s)=>r==="__v_isReactive"?!n:r==="__v_isReadonly"?n:r==="__v_raw"?i:Reflect.get(yi(e,r)&&r in i?e:i,r,s)}const Ost={get:sO(!1,!1)},Dst={get:sO(!1,!0)},Fst={get:sO(!0,!1)};const b9=new WeakMap,y9=new WeakMap,C9=new WeakMap,Hst=new WeakMap;function zst(n){switch(n){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Wst(n){return n.__v_skip||!Object.isExtensible(n)?0:zst(ust(n))}function oO(n){return dc(n)?n:aO(n,!1,Bst,Ost,b9)}function jst(n){return aO(n,!1,Est,Dst,y9)}function S9(n){return aO(n,!0,Pst,Fst,C9)}function aO(n,t,e,i,r){if(!ji(n)||n.__v_raw&&!(t&&n.__v_isReactive))return n;const s=r.get(n);if(s)return s;const o=Wst(n);if(o===0)return n;const a=new Proxy(n,o===2?i:e);return r.set(n,a),a}function gp(n){return dc(n)?gp(n.__v_raw):!!(n&&n.__v_isReactive)}function dc(n){return!!(n&&n.__v_isReadonly)}function yo(n){return!!(n&&n.__v_isShallow)}function lO(n){return n?!!n.__v_raw:!1}function bi(n){const t=n&&n.__v_raw;return t?bi(t):n}function Nst(n){return!yi(n,"__v_skip")&&Object.isExtensible(n)&&r9(n,"__v_skip",!0),n}const yr=n=>ji(n)?oO(n):n,fP=n=>ji(n)?S9(n):n;function Sr(n){return n?n.__v_isRef===!0:!1}function Us(n){return $st(n,!1)}function $st(n,t){return Sr(n)?n:new Vst(n,t)}class Vst{constructor(t,e){this.dep=new rO,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=e?t:bi(t),this._value=e?t:yr(t),this.__v_isShallow=e}get value(){return this.dep.track(),this._value}set value(t){const e=this._rawValue,i=this.__v_isShallow||yo(t)||dc(t);t=i?t:bi(t),ad(t,e)&&(this._rawValue=t,this._value=i?t:yr(t),this.dep.trigger())}}function Gst(n){return Sr(n)?n.value:n}const Ust={get:(n,t,e)=>t==="__v_raw"?n:Gst(Reflect.get(n,t,e)),set:(n,t,e,i)=>{const r=n[t];return Sr(r)&&!Sr(e)?(r.value=e,!0):Reflect.set(n,t,e,i)}};function x9(n){return gp(n)?n:new Proxy(n,Ust)}class Yst{constructor(t,e,i){this.fn=t,this.setter=e,this._value=void 0,this.dep=new rO(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=C_-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!e,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&Li!==this)return d9(this,!0),!0}get value(){const t=this.dep.track();return g9(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function Xst(n,t,e=!1){let i,r;return Ie(n)?i=n:(i=n.get,r=n.set),new Yst(i,r,e)}const jb={},$C=new WeakMap;let cu;function Kst(n,t=!1,e=cu){if(e){let i=$C.get(e);i||$C.set(e,i=[]),i.push(n)}}function qst(n,t,e=Ti){const{immediate:i,deep:r,once:s,scheduler:o,augmentJob:a,call:l}=e,h=y=>r?y:yo(y)||r===!1||r===0?Ll(y,1):Ll(y);let d,u,c,g,p=!1,f=!1;if(Sr(n)?(u=()=>n.value,p=yo(n)):gp(n)?(u=()=>h(n),p=!0):ve(n)?(f=!0,p=n.some(y=>gp(y)||yo(y)),u=()=>n.map(y=>{if(Sr(y))return y.value;if(gp(y))return h(y);if(Ie(y))return l?l(y,2):y()})):Ie(n)?t?u=l?()=>l(n,2):n:u=()=>{if(c){Hd();try{c()}finally{zd()}}const y=cu;cu=d;try{return l?l(n,3,[g]):n(g)}finally{cu=y}}:u=Va,t&&r){const y=u,C=r===!0?1/0:r;u=()=>Ll(y(),C)}const m=Sst(),v=()=>{d.stop(),m&&m.active&&ZI(m.effects,d)};if(s&&t){const y=t;t=(...C)=>{y(...C),v()}}let _=f?new Array(n.length).fill(jb):jb;const b=y=>{if(!(!(d.flags&1)||!d.dirty&&!y))if(t){const C=d.run();if(r||p||(f?C.some((S,w)=>ad(S,_[w])):ad(C,_))){c&&c();const S=cu;cu=d;try{const w=[C,_===jb?void 0:f&&_[0]===jb?[]:_,g];l?l(t,3,w):t(...w),_=C}finally{cu=S}}}else d.run()};return a&&a(b),d=new l9(u),d.scheduler=o?()=>o(b,!1):b,g=y=>Kst(y,!1,d),c=d.onStop=()=>{const y=$C.get(d);if(y){if(l)l(y,4);else for(const C of y)C();$C.delete(d)}},t?i?b(!0):_=d.run():o?o(b.bind(null,!0),!0):d.run(),v.pause=d.pause.bind(d),v.resume=d.resume.bind(d),v.stop=v,v}function Ll(n,t=1/0,e){if(t<=0||!ji(n)||n.__v_skip||(e=e||new Set,e.has(n)))return n;if(e.add(n),t--,Sr(n))Ll(n.value,t,e);else if(ve(n))for(let i=0;i<n.length;i++)Ll(n[i],t,e);else if(Ef(n)||cp(n))n.forEach(i=>{Ll(i,t,e)});else if(i9(n)){for(const i in n)Ll(n[i],t,e);for(const i of Object.getOwnPropertySymbols(n))Object.prototype.propertyIsEnumerable.call(n,i)&&Ll(n[i],t,e)}return n}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Y0(n,t,e,i){try{return i?n(...i):n()}catch(r){jA(r,t,e)}}function Xa(n,t,e,i){if(Ie(n)){const r=Y0(n,t,e,i);return r&&t9(r)&&r.catch(s=>{jA(s,t,e)}),r}if(ve(n)){const r=[];for(let s=0;s<n.length;s++)r.push(Xa(n[s],t,e,i));return r}}function jA(n,t,e,i=!0){const r=t?t.vnode:null,{errorHandler:s,throwUnhandledErrorInProduction:o}=t&&t.appContext.config||Ti;if(t){let a=t.parent;const l=t.proxy,h=`https://vuejs.org/error-reference/#runtime-${e}`;for(;a;){const d=a.ec;if(d){for(let u=0;u<d.length;u++)if(d[u](n,l,h)===!1)return}a=a.parent}if(s){Hd(),Y0(s,null,10,[n,l,h]),zd();return}}Zst(n,e,r,i,o)}function Zst(n,t,e,i=!0,r=!1){if(r)throw n;console.error(n)}const Lr=[];let Sa=-1;const pp=[];let Ih=null,xg=0;const w9=Promise.resolve();let VC=null;function Og(n){const t=VC||w9;return n?t.then(this?n.bind(this):n):t}function Jst(n){let t=Sa+1,e=Lr.length;for(;t<e;){const i=t+e>>>1,r=Lr[i],s=x_(r);s<n||s===n&&r.flags&2?t=i+1:e=i}return t}function hO(n){if(!(n.flags&1)){const t=x_(n),e=Lr[Lr.length-1];!e||!(n.flags&2)&&t>=x_(e)?Lr.push(n):Lr.splice(Jst(t),0,n),n.flags|=1,A9()}}function A9(){VC||(VC=w9.then(T9))}function Qst(n){ve(n)?pp.push(...n):Ih&&n.id===-1?Ih.splice(xg+1,0,n):n.flags&1||(pp.push(n),n.flags|=1),A9()}function NH(n,t,e=Sa+1){for(;e<Lr.length;e++){const i=Lr[e];if(i&&i.flags&2){if(n&&i.id!==n.uid)continue;Lr.splice(e,1),e--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function M9(n){if(pp.length){const t=[...new Set(pp)].sort((e,i)=>x_(e)-x_(i));if(pp.length=0,Ih){Ih.push(...t);return}for(Ih=t,xg=0;xg<Ih.length;xg++){const e=Ih[xg];e.flags&4&&(e.flags&=-2),e.flags&8||e(),e.flags&=-2}Ih=null,xg=0}}const x_=n=>n.id==null?n.flags&2?-1:1/0:n.id;function T9(n){try{for(Sa=0;Sa<Lr.length;Sa++){const t=Lr[Sa];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Y0(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;Sa<Lr.length;Sa++){const t=Lr[Sa];t&&(t.flags&=-2)}Sa=-1,Lr.length=0,M9(),VC=null,(Lr.length||pp.length)&&T9()}}let ho=null,k9=null;function GC(n){const t=ho;return ho=n,k9=n&&n.type.__scopeId||null,t}function tot(n,t=ho,e){if(!t||n._n)return n;const i=(...r)=>{i._d&&JH(-1);const s=GC(t);let o;try{o=n(...r)}finally{GC(s),i._d&&JH(1)}return o};return i._n=!0,i._c=!0,i._d=!0,i}function bh(n,t){if(ho===null)return n;const e=GA(ho),i=n.dirs||(n.dirs=[]);for(let r=0;r<t.length;r++){let[s,o,a,l=Ti]=t[r];s&&(Ie(s)&&(s={mounted:s,updated:s}),s.deep&&Ll(o),i.push({dir:s,instance:e,value:o,oldValue:void 0,arg:a,modifiers:l}))}return n}function tu(n,t,e,i){const r=n.dirs,s=t&&t.dirs;for(let o=0;o<r.length;o++){const a=r[o];s&&(a.oldValue=s[o].value);let l=a.dir[i];l&&(Hd(),Xa(l,e,8,[n.el,a,n,t]),zd())}}const eot=Symbol("_vte"),iot=n=>n.__isTeleport;function dO(n,t){n.shapeFlag&6&&n.component?(n.transition=t,dO(n.component.subTree,t)):n.shapeFlag&128?(n.ssContent.transition=t.clone(n.ssContent),n.ssFallback.transition=t.clone(n.ssFallback)):n.transition=t}function R9(n){n.ids=[n.ids[0]+n.ids[2]+++"-",0,0]}function UC(n,t,e,i,r=!1){if(ve(n)){n.forEach((p,f)=>UC(p,t&&(ve(t)?t[f]:t),e,i,r));return}if(av(i)&&!r){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&UC(n,t,e,i.component.subTree);return}const s=i.shapeFlag&4?GA(i.component):i.el,o=r?null:s,{i:a,r:l}=n,h=t&&t.r,d=a.refs===Ti?a.refs={}:a.refs,u=a.setupState,c=bi(u),g=u===Ti?()=>!1:p=>yi(c,p);if(h!=null&&h!==l&&(Bn(h)?(d[h]=null,g(h)&&(u[h]=null)):Sr(h)&&(h.value=null)),Ie(l))Y0(l,a,12,[o,d]);else{const p=Bn(l),f=Sr(l);if(p||f){const m=()=>{if(n.f){const v=p?g(l)?u[l]:d[l]:l.value;r?ve(v)&&ZI(v,s):ve(v)?v.includes(s)||v.push(s):p?(d[l]=[s],g(l)&&(u[l]=d[l])):(l.value=[s],n.k&&(d[n.k]=l.value))}else p?(d[l]=o,g(l)&&(u[l]=o)):f&&(l.value=o,n.k&&(d[n.k]=o))};o?(m.id=-1,Ss(m,e)):m()}}}zA().requestIdleCallback;zA().cancelIdleCallback;const av=n=>!!n.type.__asyncLoader,B9=n=>n.type.__isKeepAlive;function not(n,t){P9(n,"a",t)}function rot(n,t){P9(n,"da",t)}function P9(n,t,e=Ir){const i=n.__wdc||(n.__wdc=()=>{let r=e;for(;r;){if(r.isDeactivated)return;r=r.parent}return n()});if(NA(t,i,e),e){let r=e.parent;for(;r&&r.parent;)B9(r.parent.vnode)&&sot(i,t,e,r),r=r.parent}}function sot(n,t,e,i){const r=NA(t,n,i,!0);L9(()=>{ZI(i[t],r)},e)}function NA(n,t,e=Ir,i=!1){if(e){const r=e[n]||(e[n]=[]),s=t.__weh||(t.__weh=(...o)=>{Hd();const a=X0(e),l=Xa(t,e,n,o);return a(),zd(),l});return i?r.unshift(s):r.push(s),s}}const oh=n=>(t,e=Ir)=>{(!A_||n==="sp")&&NA(n,(...i)=>t(...i),e)},oot=oh("bm"),E9=oh("m"),aot=oh("bu"),lot=oh("u"),hot=oh("bum"),L9=oh("um"),dot=oh("sp"),uot=oh("rtg"),cot=oh("rtc");function got(n,t=Ir){NA("ec",n,t)}const pot=Symbol.for("v-ndc");function $H(n,t,e,i){let r;const s=e,o=ve(n);if(o||Bn(n)){const a=o&&gp(n);let l=!1;a&&(l=!yo(n),n=WA(n)),r=new Array(n.length);for(let h=0,d=n.length;h<d;h++)r[h]=t(l?yr(n[h]):n[h],h,void 0,s)}else if(typeof n=="number"){r=new Array(n);for(let a=0;a<n;a++)r[a]=t(a+1,a,void 0,s)}else if(ji(n))if(n[Symbol.iterator])r=Array.from(n,(a,l)=>t(a,l,void 0,s));else{const a=Object.keys(n);r=new Array(a.length);for(let l=0,h=a.length;l<h;l++){const d=a[l];r[l]=t(n[d],d,l,s)}}else r=[];return r}const mP=n=>n?eY(n)?GA(n):mP(n.parent):null,lv=Hr(Object.create(null),{$:n=>n,$el:n=>n.vnode.el,$data:n=>n.data,$props:n=>n.props,$attrs:n=>n.attrs,$slots:n=>n.slots,$refs:n=>n.refs,$parent:n=>mP(n.parent),$root:n=>mP(n.root),$host:n=>n.ce,$emit:n=>n.emit,$options:n=>O9(n),$forceUpdate:n=>n.f||(n.f=()=>{hO(n.update)}),$nextTick:n=>n.n||(n.n=Og.bind(n.proxy)),$watch:n=>Dot.bind(n)}),ok=(n,t)=>n!==Ti&&!n.__isScriptSetup&&yi(n,t),fot={get({_:n},t){if(t==="__v_skip")return!0;const{ctx:e,setupState:i,data:r,props:s,accessCache:o,type:a,appContext:l}=n;let h;if(t[0]!=="$"){const g=o[t];if(g!==void 0)switch(g){case 1:return i[t];case 2:return r[t];case 4:return e[t];case 3:return s[t]}else{if(ok(i,t))return o[t]=1,i[t];if(r!==Ti&&yi(r,t))return o[t]=2,r[t];if((h=n.propsOptions[0])&&yi(h,t))return o[t]=3,s[t];if(e!==Ti&&yi(e,t))return o[t]=4,e[t];vP&&(o[t]=0)}}const d=lv[t];let u,c;if(d)return t==="$attrs"&&br(n.attrs,"get",""),d(n);if((u=a.__cssModules)&&(u=u[t]))return u;if(e!==Ti&&yi(e,t))return o[t]=4,e[t];if(c=l.config.globalProperties,yi(c,t))return c[t]},set({_:n},t,e){const{data:i,setupState:r,ctx:s}=n;return ok(r,t)?(r[t]=e,!0):i!==Ti&&yi(i,t)?(i[t]=e,!0):yi(n.props,t)||t[0]==="$"&&t.slice(1)in n?!1:(s[t]=e,!0)},has({_:{data:n,setupState:t,accessCache:e,ctx:i,appContext:r,propsOptions:s}},o){let a;return!!e[o]||n!==Ti&&yi(n,o)||ok(t,o)||(a=s[0])&&yi(a,o)||yi(i,o)||yi(lv,o)||yi(r.config.globalProperties,o)},defineProperty(n,t,e){return e.get!=null?n._.accessCache[t]=0:yi(e,"value")&&this.set(n,t,e.value,null),Reflect.defineProperty(n,t,e)}};function VH(n){return ve(n)?n.reduce((t,e)=>(t[e]=null,t),{}):n}let vP=!0;function mot(n){const t=O9(n),e=n.proxy,i=n.ctx;vP=!1,t.beforeCreate&&GH(t.beforeCreate,n,"bc");const{data:r,computed:s,methods:o,watch:a,provide:l,inject:h,created:d,beforeMount:u,mounted:c,beforeUpdate:g,updated:p,activated:f,deactivated:m,beforeDestroy:v,beforeUnmount:_,destroyed:b,unmounted:y,render:C,renderTracked:S,renderTriggered:w,errorCaptured:x,serverPrefetch:A,expose:M,inheritAttrs:T,components:R,directives:B,filters:E}=t;if(h&&vot(h,i,null),o)for(const I in o){const O=o[I];Ie(O)&&(i[I]=O.bind(e))}if(r){const I=r.call(e,e);ji(I)&&(n.data=oO(I))}if(vP=!0,s)for(const I in s){const O=s[I],H=Ie(O)?O.bind(e,e):Ie(O.get)?O.get.bind(e,e):Va,z=!Ie(O)&&Ie(O.set)?O.set.bind(e):Va,F=rat({get:H,set:z});Object.defineProperty(i,I,{enumerable:!0,configurable:!0,get:()=>F.value,set:j=>F.value=j})}if(a)for(const I in a)I9(a[I],i,e,I);if(l){const I=Ie(l)?l.call(e):l;Reflect.ownKeys(I).forEach(O=>{xot(O,I[O])})}d&&GH(d,n,"c");function P(I,O){ve(O)?O.forEach(H=>I(H.bind(e))):O&&I(O.bind(e))}if(P(oot,u),P(E9,c),P(aot,g),P(lot,p),P(not,f),P(rot,m),P(got,x),P(cot,S),P(uot,w),P(hot,_),P(L9,y),P(dot,A),ve(M))if(M.length){const I=n.exposed||(n.exposed={});M.forEach(O=>{Object.defineProperty(I,O,{get:()=>e[O],set:H=>e[O]=H})})}else n.exposed||(n.exposed={});C&&n.render===Va&&(n.render=C),T!=null&&(n.inheritAttrs=T),R&&(n.components=R),B&&(n.directives=B),A&&R9(n)}function vot(n,t,e=Va){ve(n)&&(n=_P(n));for(const i in n){const r=n[i];let s;ji(r)?"default"in r?s=cC(r.from||i,r.default,!0):s=cC(r.from||i):s=cC(r),Sr(s)?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>s.value,set:o=>s.value=o}):t[i]=s}}function GH(n,t,e){Xa(ve(n)?n.map(i=>i.bind(t.proxy)):n.bind(t.proxy),t,e)}function I9(n,t,e,i){let r=i.includes(".")?K9(e,i):()=>e[i];if(Bn(n)){const s=t[n];Ie(s)&&hv(r,s)}else if(Ie(n))hv(r,n.bind(e));else if(ji(n))if(ve(n))n.forEach(s=>I9(s,t,e,i));else{const s=Ie(n.handler)?n.handler.bind(e):t[n.handler];Ie(s)&&hv(r,s,n)}}function O9(n){const t=n.type,{mixins:e,extends:i}=t,{mixins:r,optionsCache:s,config:{optionMergeStrategies:o}}=n.appContext,a=s.get(t);let l;return a?l=a:!r.length&&!e&&!i?l=t:(l={},r.length&&r.forEach(h=>YC(l,h,o,!0)),YC(l,t,o)),ji(t)&&s.set(t,l),l}function YC(n,t,e,i=!1){const{mixins:r,extends:s}=t;s&&YC(n,s,e,!0),r&&r.forEach(o=>YC(n,o,e,!0));for(const o in t)if(!(i&&o==="expose")){const a=_ot[o]||e&&e[o];n[o]=a?a(n[o],t[o]):t[o]}return n}const _ot={data:UH,props:YH,emits:YH,methods:Bm,computed:Bm,beforeCreate:Rr,created:Rr,beforeMount:Rr,mounted:Rr,beforeUpdate:Rr,updated:Rr,beforeDestroy:Rr,beforeUnmount:Rr,destroyed:Rr,unmounted:Rr,activated:Rr,deactivated:Rr,errorCaptured:Rr,serverPrefetch:Rr,components:Bm,directives:Bm,watch:yot,provide:UH,inject:bot};function UH(n,t){return t?n?function(){return Hr(Ie(n)?n.call(this,this):n,Ie(t)?t.call(this,this):t)}:t:n}function bot(n,t){return Bm(_P(n),_P(t))}function _P(n){if(ve(n)){const t={};for(let e=0;e<n.length;e++)t[n[e]]=n[e];return t}return n}function Rr(n,t){return n?[...new Set([].concat(n,t))]:t}function Bm(n,t){return n?Hr(Object.create(null),n,t):t}function YH(n,t){return n?ve(n)&&ve(t)?[...new Set([...n,...t])]:Hr(Object.create(null),VH(n),VH(t??{})):t}function yot(n,t){if(!n)return t;if(!t)return n;const e=Hr(Object.create(null),n);for(const i in t)e[i]=Rr(n[i],t[i]);return e}function D9(){return{app:null,config:{isNativeTag:hst,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Cot=0;function Sot(n,t){return function(i,r=null){Ie(i)||(i=Hr({},i)),r!=null&&!ji(r)&&(r=null);const s=D9(),o=new WeakSet,a=[];let l=!1;const h=s.app={_uid:Cot++,_component:i,_props:r,_container:null,_context:s,_instance:null,version:sat,get config(){return s.config},set config(d){},use(d,...u){return o.has(d)||(d&&Ie(d.install)?(o.add(d),d.install(h,...u)):Ie(d)&&(o.add(d),d(h,...u))),h},mixin(d){return s.mixins.includes(d)||s.mixins.push(d),h},component(d,u){return u?(s.components[d]=u,h):s.components[d]},directive(d,u){return u?(s.directives[d]=u,h):s.directives[d]},mount(d,u,c){if(!l){const g=h._ceVNode||Ga(i,r);return g.appContext=s,c===!0?c="svg":c===!1&&(c=void 0),n(g,d,c),l=!0,h._container=d,d.__vue_app__=h,GA(g.component)}},onUnmount(d){a.push(d)},unmount(){l&&(Xa(a,h._instance,16),n(null,h._container),delete h._container.__vue_app__)},provide(d,u){return s.provides[d]=u,h},runWithContext(d){const u=fp;fp=h;try{return d()}finally{fp=u}}};return h}}let fp=null;function xot(n,t){if(Ir){let e=Ir.provides;const i=Ir.parent&&Ir.parent.provides;i===e&&(e=Ir.provides=Object.create(i)),e[n]=t}}function cC(n,t,e=!1){const i=Ir||ho;if(i||fp){const r=fp?fp._context.provides:i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(r&&n in r)return r[n];if(arguments.length>1)return e&&Ie(t)?t.call(i&&i.proxy):t}}const F9={},H9=()=>Object.create(F9),z9=n=>Object.getPrototypeOf(n)===F9;function wot(n,t,e,i=!1){const r={},s=H9();n.propsDefaults=Object.create(null),W9(n,t,r,s);for(const o in n.propsOptions[0])o in r||(r[o]=void 0);e?n.props=i?r:jst(r):n.type.props?n.props=r:n.props=s,n.attrs=s}function Aot(n,t,e,i){const{props:r,attrs:s,vnode:{patchFlag:o}}=n,a=bi(r),[l]=n.propsOptions;let h=!1;if((i||o>0)&&!(o&16)){if(o&8){const d=n.vnode.dynamicProps;for(let u=0;u<d.length;u++){let c=d[u];if($A(n.emitsOptions,c))continue;const g=t[c];if(l)if(yi(s,c))g!==s[c]&&(s[c]=g,h=!0);else{const p=Ad(c);r[p]=bP(l,a,p,g,n,!1)}else g!==s[c]&&(s[c]=g,h=!0)}}}else{W9(n,t,r,s)&&(h=!0);let d;for(const u in a)(!t||!yi(t,u)&&((d=Vc(u))===u||!yi(t,d)))&&(l?e&&(e[u]!==void 0||e[d]!==void 0)&&(r[u]=bP(l,a,u,void 0,n,!0)):delete r[u]);if(s!==a)for(const u in s)(!t||!yi(t,u))&&(delete s[u],h=!0)}h&&El(n.attrs,"set","")}function W9(n,t,e,i){const[r,s]=n.propsOptions;let o=!1,a;if(t)for(let l in t){if(rv(l))continue;const h=t[l];let d;r&&yi(r,d=Ad(l))?!s||!s.includes(d)?e[d]=h:(a||(a={}))[d]=h:$A(n.emitsOptions,l)||(!(l in i)||h!==i[l])&&(i[l]=h,o=!0)}if(s){const l=bi(e),h=a||Ti;for(let d=0;d<s.length;d++){const u=s[d];e[u]=bP(r,l,u,h[u],n,!yi(h,u))}}return o}function bP(n,t,e,i,r,s){const o=n[e];if(o!=null){const a=yi(o,"default");if(a&&i===void 0){const l=o.default;if(o.type!==Function&&!o.skipFactory&&Ie(l)){const{propsDefaults:h}=r;if(e in h)i=h[e];else{const d=X0(r);i=h[e]=l.call(null,t),d()}}else i=l;r.ce&&r.ce._setProp(e,i)}o[0]&&(s&&!a?i=!1:o[1]&&(i===""||i===Vc(e))&&(i=!0))}return i}const Mot=new WeakMap;function j9(n,t,e=!1){const i=e?Mot:t.propsCache,r=i.get(n);if(r)return r;const s=n.props,o={},a=[];let l=!1;if(!Ie(n)){const d=u=>{l=!0;const[c,g]=j9(u,t,!0);Hr(o,c),g&&a.push(...g)};!e&&t.mixins.length&&t.mixins.forEach(d),n.extends&&d(n.extends),n.mixins&&n.mixins.forEach(d)}if(!s&&!l)return ji(n)&&i.set(n,up),up;if(ve(s))for(let d=0;d<s.length;d++){const u=Ad(s[d]);XH(u)&&(o[u]=Ti)}else if(s)for(const d in s){const u=Ad(d);if(XH(u)){const c=s[d],g=o[u]=ve(c)||Ie(c)?{type:c}:Hr({},c),p=g.type;let f=!1,m=!0;if(ve(p))for(let v=0;v<p.length;++v){const _=p[v],b=Ie(_)&&_.name;if(b==="Boolean"){f=!0;break}else b==="String"&&(m=!1)}else f=Ie(p)&&p.name==="Boolean";g[0]=f,g[1]=m,(f||yi(g,"default"))&&a.push(u)}}const h=[o,a];return ji(n)&&i.set(n,h),h}function XH(n){return n[0]!=="$"&&!rv(n)}const N9=n=>n[0]==="_"||n==="$stable",uO=n=>ve(n)?n.map(Ba):[Ba(n)],Tot=(n,t,e)=>{if(t._n)return t;const i=tot((...r)=>uO(t(...r)),e);return i._c=!1,i},$9=(n,t,e)=>{const i=n._ctx;for(const r in n){if(N9(r))continue;const s=n[r];if(Ie(s))t[r]=Tot(r,s,i);else if(s!=null){const o=uO(s);t[r]=()=>o}}},V9=(n,t)=>{const e=uO(t);n.slots.default=()=>e},G9=(n,t,e)=>{for(const i in t)(e||i!=="_")&&(n[i]=t[i])},kot=(n,t,e)=>{const i=n.slots=H9();if(n.vnode.shapeFlag&32){const r=t._;r?(G9(i,t,e),e&&r9(i,"_",r,!0)):$9(t,i)}else t&&V9(n,t)},Rot=(n,t,e)=>{const{vnode:i,slots:r}=n;let s=!0,o=Ti;if(i.shapeFlag&32){const a=t._;a?e&&a===1?s=!1:G9(r,t,e):(s=!t.$stable,$9(t,r)),o=t}else t&&(V9(n,t),o={default:1});if(s)for(const a in r)!N9(a)&&o[a]==null&&delete r[a]},Ss=$ot;function Bot(n){return Pot(n)}function Pot(n,t){const e=zA();e.__VUE__=!0;const{insert:i,remove:r,patchProp:s,createElement:o,createText:a,createComment:l,setText:h,setElementText:d,parentNode:u,nextSibling:c,setScopeId:g=Va,insertStaticContent:p}=n,f=(W,N,K,nt=null,X=null,ht=null,_t=void 0,ct=null,U=!!N.dynamicChildren)=>{if(W===N)return;W&&!Qf(W,N)&&(nt=st(W),j(W,X,ht,!0),W=null),N.patchFlag===-2&&(U=!1,N.dynamicChildren=null);const{type:ut,ref:lt,shapeFlag:At}=N;switch(ut){case VA:m(W,N,K,nt);break;case uc:v(W,N,K,nt);break;case gC:W==null&&_(N,K,nt,_t);break;case jo:R(W,N,K,nt,X,ht,_t,ct,U);break;default:At&1?C(W,N,K,nt,X,ht,_t,ct,U):At&6?B(W,N,K,nt,X,ht,_t,ct,U):(At&64||At&128)&&ut.process(W,N,K,nt,X,ht,_t,ct,U,pt)}lt!=null&&X&&UC(lt,W&&W.ref,ht,N||W,!N)},m=(W,N,K,nt)=>{if(W==null)i(N.el=a(N.children),K,nt);else{const X=N.el=W.el;N.children!==W.children&&h(X,N.children)}},v=(W,N,K,nt)=>{W==null?i(N.el=l(N.children||""),K,nt):N.el=W.el},_=(W,N,K,nt)=>{[W.el,W.anchor]=p(W.children,N,K,nt,W.el,W.anchor)},b=({el:W,anchor:N},K,nt)=>{let X;for(;W&&W!==N;)X=c(W),i(W,K,nt),W=X;i(N,K,nt)},y=({el:W,anchor:N})=>{let K;for(;W&&W!==N;)K=c(W),r(W),W=K;r(N)},C=(W,N,K,nt,X,ht,_t,ct,U)=>{N.type==="svg"?_t="svg":N.type==="math"&&(_t="mathml"),W==null?S(N,K,nt,X,ht,_t,ct,U):A(W,N,X,ht,_t,ct,U)},S=(W,N,K,nt,X,ht,_t,ct)=>{let U,ut;const{props:lt,shapeFlag:At,transition:ft,dirs:Ct}=W;if(U=W.el=o(W.type,ht,lt&&lt.is,lt),At&8?d(U,W.children):At&16&&x(W.children,U,null,nt,X,ak(W,ht),_t,ct),Ct&&tu(W,null,nt,"created"),w(U,W,W.scopeId,_t,nt),lt){for(const Xt in lt)Xt!=="value"&&!rv(Xt)&&s(U,Xt,null,lt[Xt],ht,nt);"value"in lt&&s(U,"value",null,lt.value,ht),(ut=lt.onVnodeBeforeMount)&&pa(ut,nt,W)}Ct&&tu(W,null,nt,"beforeMount");const Ht=Eot(X,ft);Ht&&ft.beforeEnter(U),i(U,N,K),((ut=lt&&lt.onVnodeMounted)||Ht||Ct)&&Ss(()=>{ut&&pa(ut,nt,W),Ht&&ft.enter(U),Ct&&tu(W,null,nt,"mounted")},X)},w=(W,N,K,nt,X)=>{if(K&&g(W,K),nt)for(let ht=0;ht<nt.length;ht++)g(W,nt[ht]);if(X){let ht=X.subTree;if(N===ht||Z9(ht.type)&&(ht.ssContent===N||ht.ssFallback===N)){const _t=X.vnode;w(W,_t,_t.scopeId,_t.slotScopeIds,X.parent)}}},x=(W,N,K,nt,X,ht,_t,ct,U=0)=>{for(let ut=U;ut<W.length;ut++){const lt=W[ut]=ct?Oh(W[ut]):Ba(W[ut]);f(null,lt,N,K,nt,X,ht,_t,ct)}},A=(W,N,K,nt,X,ht,_t)=>{const ct=N.el=W.el;let{patchFlag:U,dynamicChildren:ut,dirs:lt}=N;U|=W.patchFlag&16;const At=W.props||Ti,ft=N.props||Ti;let Ct;if(K&&eu(K,!1),(Ct=ft.onVnodeBeforeUpdate)&&pa(Ct,K,N,W),lt&&tu(N,W,K,"beforeUpdate"),K&&eu(K,!0),(At.innerHTML&&ft.innerHTML==null||At.textContent&&ft.textContent==null)&&d(ct,""),ut?M(W.dynamicChildren,ut,ct,K,nt,ak(N,X),ht):_t||O(W,N,ct,null,K,nt,ak(N,X),ht,!1),U>0){if(U&16)T(ct,At,ft,K,X);else if(U&2&&At.class!==ft.class&&s(ct,"class",null,ft.class,X),U&4&&s(ct,"style",At.style,ft.style,X),U&8){const Ht=N.dynamicProps;for(let Xt=0;Xt<Ht.length;Xt++){const ae=Ht[Xt],re=At[ae],be=ft[ae];(be!==re||ae==="value")&&s(ct,ae,re,be,X,K)}}U&1&&W.children!==N.children&&d(ct,N.children)}else!_t&&ut==null&&T(ct,At,ft,K,X);((Ct=ft.onVnodeUpdated)||lt)&&Ss(()=>{Ct&&pa(Ct,K,N,W),lt&&tu(N,W,K,"updated")},nt)},M=(W,N,K,nt,X,ht,_t)=>{for(let ct=0;ct<N.length;ct++){const U=W[ct],ut=N[ct],lt=U.el&&(U.type===jo||!Qf(U,ut)||U.shapeFlag&70)?u(U.el):K;f(U,ut,lt,null,nt,X,ht,_t,!0)}},T=(W,N,K,nt,X)=>{if(N!==K){if(N!==Ti)for(const ht in N)!rv(ht)&&!(ht in K)&&s(W,ht,N[ht],null,X,nt);for(const ht in K){if(rv(ht))continue;const _t=K[ht],ct=N[ht];_t!==ct&&ht!=="value"&&s(W,ht,ct,_t,X,nt)}"value"in K&&s(W,"value",N.value,K.value,X)}},R=(W,N,K,nt,X,ht,_t,ct,U)=>{const ut=N.el=W?W.el:a(""),lt=N.anchor=W?W.anchor:a("");let{patchFlag:At,dynamicChildren:ft,slotScopeIds:Ct}=N;Ct&&(ct=ct?ct.concat(Ct):Ct),W==null?(i(ut,K,nt),i(lt,K,nt),x(N.children||[],K,lt,X,ht,_t,ct,U)):At>0&&At&64&&ft&&W.dynamicChildren?(M(W.dynamicChildren,ft,K,X,ht,_t,ct),(N.key!=null||X&&N===X.subTree)&&U9(W,N,!0)):O(W,N,K,lt,X,ht,_t,ct,U)},B=(W,N,K,nt,X,ht,_t,ct,U)=>{N.slotScopeIds=ct,W==null?N.shapeFlag&512?X.ctx.activate(N,K,nt,_t,U):E(N,K,nt,X,ht,_t,U):k(W,N,U)},E=(W,N,K,nt,X,ht,_t)=>{const ct=W.component=Jot(W,nt,X);if(B9(W)&&(ct.ctx.renderer=pt),Qot(ct,!1,_t),ct.asyncDep){if(X&&X.registerDep(ct,P,_t),!W.el){const U=ct.subTree=Ga(uc);v(null,U,N,K)}}else P(ct,W,N,K,X,ht,_t)},k=(W,N,K)=>{const nt=N.component=W.component;if(jot(W,N,K))if(nt.asyncDep&&!nt.asyncResolved){I(nt,N,K);return}else nt.next=N,nt.update();else N.el=W.el,nt.vnode=N},P=(W,N,K,nt,X,ht,_t)=>{const ct=()=>{if(W.isMounted){let{next:At,bu:ft,u:Ct,parent:Ht,vnode:Xt}=W;{const _i=Y9(W);if(_i){At&&(At.el=Xt.el,I(W,At,_t)),_i.asyncDep.then(()=>{W.isUnmounted||ct()});return}}let ae=At,re;eu(W,!1),At?(At.el=Xt.el,I(W,At,_t)):At=Xt,ft&&uC(ft),(re=At.props&&At.props.onVnodeBeforeUpdate)&&pa(re,Ht,At,Xt),eu(W,!0);const be=qH(W),Xe=W.subTree;W.subTree=be,f(Xe,be,u(Xe.el),st(Xe),W,X,ht),At.el=be.el,ae===null&&Not(W,be.el),Ct&&Ss(Ct,X),(re=At.props&&At.props.onVnodeUpdated)&&Ss(()=>pa(re,Ht,At,Xt),X)}else{let At;const{el:ft,props:Ct}=N,{bm:Ht,m:Xt,parent:ae,root:re,type:be}=W,Xe=av(N);eu(W,!1),Ht&&uC(Ht),!Xe&&(At=Ct&&Ct.onVnodeBeforeMount)&&pa(At,ae,N),eu(W,!0);{re.ce&&re.ce._injectChildStyle(be);const _i=W.subTree=qH(W);f(null,_i,K,nt,W,X,ht),N.el=_i.el}if(Xt&&Ss(Xt,X),!Xe&&(At=Ct&&Ct.onVnodeMounted)){const _i=N;Ss(()=>pa(At,ae,_i),X)}(N.shapeFlag&256||ae&&av(ae.vnode)&&ae.vnode.shapeFlag&256)&&W.a&&Ss(W.a,X),W.isMounted=!0,N=K=nt=null}};W.scope.on();const U=W.effect=new l9(ct);W.scope.off();const ut=W.update=U.run.bind(U),lt=W.job=U.runIfDirty.bind(U);lt.i=W,lt.id=W.uid,U.scheduler=()=>hO(lt),eu(W,!0),ut()},I=(W,N,K)=>{N.component=W;const nt=W.vnode.props;W.vnode=N,W.next=null,Aot(W,N.props,nt,K),Rot(W,N.children,K),Hd(),NH(W),zd()},O=(W,N,K,nt,X,ht,_t,ct,U=!1)=>{const ut=W&&W.children,lt=W?W.shapeFlag:0,At=N.children,{patchFlag:ft,shapeFlag:Ct}=N;if(ft>0){if(ft&128){z(ut,At,K,nt,X,ht,_t,ct,U);return}else if(ft&256){H(ut,At,K,nt,X,ht,_t,ct,U);return}}Ct&8?(lt&16&&tt(ut,X,ht),At!==ut&&d(K,At)):lt&16?Ct&16?z(ut,At,K,nt,X,ht,_t,ct,U):tt(ut,X,ht,!0):(lt&8&&d(K,""),Ct&16&&x(At,K,nt,X,ht,_t,ct,U))},H=(W,N,K,nt,X,ht,_t,ct,U)=>{W=W||up,N=N||up;const ut=W.length,lt=N.length,At=Math.min(ut,lt);let ft;for(ft=0;ft<At;ft++){const Ct=N[ft]=U?Oh(N[ft]):Ba(N[ft]);f(W[ft],Ct,K,null,X,ht,_t,ct,U)}ut>lt?tt(W,X,ht,!0,!1,At):x(N,K,nt,X,ht,_t,ct,U,At)},z=(W,N,K,nt,X,ht,_t,ct,U)=>{let ut=0;const lt=N.length;let At=W.length-1,ft=lt-1;for(;ut<=At&&ut<=ft;){const Ct=W[ut],Ht=N[ut]=U?Oh(N[ut]):Ba(N[ut]);if(Qf(Ct,Ht))f(Ct,Ht,K,null,X,ht,_t,ct,U);else break;ut++}for(;ut<=At&&ut<=ft;){const Ct=W[At],Ht=N[ft]=U?Oh(N[ft]):Ba(N[ft]);if(Qf(Ct,Ht))f(Ct,Ht,K,null,X,ht,_t,ct,U);else break;At--,ft--}if(ut>At){if(ut<=ft){const Ct=ft+1,Ht=Ct<lt?N[Ct].el:nt;for(;ut<=ft;)f(null,N[ut]=U?Oh(N[ut]):Ba(N[ut]),K,Ht,X,ht,_t,ct,U),ut++}}else if(ut>ft)for(;ut<=At;)j(W[ut],X,ht,!0),ut++;else{const Ct=ut,Ht=ut,Xt=new Map;for(ut=Ht;ut<=ft;ut++){const He=N[ut]=U?Oh(N[ut]):Ba(N[ut]);He.key!=null&&Xt.set(He.key,ut)}let ae,re=0;const be=ft-Ht+1;let Xe=!1,_i=0;const Gt=new Array(be);for(ut=0;ut<be;ut++)Gt[ut]=0;for(ut=Ct;ut<=At;ut++){const He=W[ut];if(re>=be){j(He,X,ht,!0);continue}let ci;if(He.key!=null)ci=Xt.get(He.key);else for(ae=Ht;ae<=ft;ae++)if(Gt[ae-Ht]===0&&Qf(He,N[ae])){ci=ae;break}ci===void 0?j(He,X,ht,!0):(Gt[ci-Ht]=ut+1,ci>=_i?_i=ci:Xe=!0,f(He,N[ci],K,null,X,ht,_t,ct,U),re++)}const Ge=Xe?Lot(Gt):up;for(ae=Ge.length-1,ut=be-1;ut>=0;ut--){const He=Ht+ut,ci=N[He],Vr=He+1<lt?N[He+1].el:nt;Gt[ut]===0?f(null,ci,K,Vr,X,ht,_t,ct,U):Xe&&(ae<0||ut!==Ge[ae]?F(ci,K,Vr,2):ae--)}}},F=(W,N,K,nt,X=null)=>{const{el:ht,type:_t,transition:ct,children:U,shapeFlag:ut}=W;if(ut&6){F(W.component.subTree,N,K,nt);return}if(ut&128){W.suspense.move(N,K,nt);return}if(ut&64){_t.move(W,N,K,pt);return}if(_t===jo){i(ht,N,K);for(let At=0;At<U.length;At++)F(U[At],N,K,nt);i(W.anchor,N,K);return}if(_t===gC){b(W,N,K);return}if(nt!==2&&ut&1&&ct)if(nt===0)ct.beforeEnter(ht),i(ht,N,K),Ss(()=>ct.enter(ht),X);else{const{leave:At,delayLeave:ft,afterLeave:Ct}=ct,Ht=()=>i(ht,N,K),Xt=()=>{At(ht,()=>{Ht(),Ct&&Ct()})};ft?ft(ht,Ht,Xt):Xt()}else i(ht,N,K)},j=(W,N,K,nt=!1,X=!1)=>{const{type:ht,props:_t,ref:ct,children:U,dynamicChildren:ut,shapeFlag:lt,patchFlag:At,dirs:ft,cacheIndex:Ct}=W;if(At===-2&&(X=!1),ct!=null&&UC(ct,null,K,W,!0),Ct!=null&&(N.renderCache[Ct]=void 0),lt&256){N.ctx.deactivate(W);return}const Ht=lt&1&&ft,Xt=!av(W);let ae;if(Xt&&(ae=_t&&_t.onVnodeBeforeUnmount)&&pa(ae,N,W),lt&6)G(W.component,K,nt);else{if(lt&128){W.suspense.unmount(K,nt);return}Ht&&tu(W,null,N,"beforeUnmount"),lt&64?W.type.remove(W,N,K,pt,nt):ut&&!ut.hasOnce&&(ht!==jo||At>0&&At&64)?tt(ut,N,K,!1,!0):(ht===jo&&At&384||!X&&lt&16)&&tt(U,N,K),nt&&$(W)}(Xt&&(ae=_t&&_t.onVnodeUnmounted)||Ht)&&Ss(()=>{ae&&pa(ae,N,W),Ht&&tu(W,null,N,"unmounted")},K)},$=W=>{const{type:N,el:K,anchor:nt,transition:X}=W;if(N===jo){Y(K,nt);return}if(N===gC){y(W);return}const ht=()=>{r(K),X&&!X.persisted&&X.afterLeave&&X.afterLeave()};if(W.shapeFlag&1&&X&&!X.persisted){const{leave:_t,delayLeave:ct}=X,U=()=>_t(K,ht);ct?ct(W.el,ht,U):U()}else ht()},Y=(W,N)=>{let K;for(;W!==N;)K=c(W),r(W),W=K;r(N)},G=(W,N,K)=>{const{bum:nt,scope:X,job:ht,subTree:_t,um:ct,m:U,a:ut}=W;KH(U),KH(ut),nt&&uC(nt),X.stop(),ht&&(ht.flags|=8,j(_t,W,N,K)),ct&&Ss(ct,N),Ss(()=>{W.isUnmounted=!0},N),N&&N.pendingBranch&&!N.isUnmounted&&W.asyncDep&&!W.asyncResolved&&W.suspenseId===N.pendingId&&(N.deps--,N.deps===0&&N.resolve())},tt=(W,N,K,nt=!1,X=!1,ht=0)=>{for(let _t=ht;_t<W.length;_t++)j(W[_t],N,K,nt,X)},st=W=>{if(W.shapeFlag&6)return st(W.component.subTree);if(W.shapeFlag&128)return W.suspense.next();const N=c(W.anchor||W.el),K=N&&N[eot];return K?c(K):N};let ot=!1;const rt=(W,N,K)=>{W==null?N._vnode&&j(N._vnode,null,null,!0):f(N._vnode||null,W,N,null,null,null,K),N._vnode=W,ot||(ot=!0,NH(),M9(),ot=!1)},pt={p:f,um:j,m:F,r:$,mt:E,mc:x,pc:O,pbc:M,n:st,o:n};return{render:rt,hydrate:void 0,createApp:Sot(rt)}}function ak({type:n,props:t},e){return e==="svg"&&n==="foreignObject"||e==="mathml"&&n==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:e}function eu({effect:n,job:t},e){e?(n.flags|=32,t.flags|=4):(n.flags&=-33,t.flags&=-5)}function Eot(n,t){return(!n||n&&!n.pendingBranch)&&t&&!t.persisted}function U9(n,t,e=!1){const i=n.children,r=t.children;if(ve(i)&&ve(r))for(let s=0;s<i.length;s++){const o=i[s];let a=r[s];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=r[s]=Oh(r[s]),a.el=o.el),!e&&a.patchFlag!==-2&&U9(o,a)),a.type===VA&&(a.el=o.el)}}function Lot(n){const t=n.slice(),e=[0];let i,r,s,o,a;const l=n.length;for(i=0;i<l;i++){const h=n[i];if(h!==0){if(r=e[e.length-1],n[r]<h){t[i]=r,e.push(i);continue}for(s=0,o=e.length-1;s<o;)a=s+o>>1,n[e[a]]<h?s=a+1:o=a;h<n[e[s]]&&(s>0&&(t[i]=e[s-1]),e[s]=i)}}for(s=e.length,o=e[s-1];s-- >0;)e[s]=o,o=t[o];return e}function Y9(n){const t=n.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:Y9(t)}function KH(n){if(n)for(let t=0;t<n.length;t++)n[t].flags|=8}const Iot=Symbol.for("v-scx"),Oot=()=>cC(Iot);function hv(n,t,e){return X9(n,t,e)}function X9(n,t,e=Ti){const{immediate:i,deep:r,flush:s,once:o}=e,a=Hr({},e),l=t&&i||!t&&s!=="post";let h;if(A_){if(s==="sync"){const g=Oot();h=g.__watcherHandles||(g.__watcherHandles=[])}else if(!l){const g=()=>{};return g.stop=Va,g.resume=Va,g.pause=Va,g}}const d=Ir;a.call=(g,p,f)=>Xa(g,d,p,f);let u=!1;s==="post"?a.scheduler=g=>{Ss(g,d&&d.suspense)}:s!=="sync"&&(u=!0,a.scheduler=(g,p)=>{p?g():hO(g)}),a.augmentJob=g=>{t&&(g.flags|=4),u&&(g.flags|=2,d&&(g.id=d.uid,g.i=d))};const c=qst(n,t,a);return A_&&(h?h.push(c):l&&c()),c}function Dot(n,t,e){const i=this.proxy,r=Bn(n)?n.includes(".")?K9(i,n):()=>i[n]:n.bind(i,i);let s;Ie(t)?s=t:(s=t.handler,e=t);const o=X0(this),a=X9(r,s.bind(i),e);return o(),a}function K9(n,t){const e=t.split(".");return()=>{let i=n;for(let r=0;r<e.length&&i;r++)i=i[e[r]];return i}}const Fot=(n,t)=>t==="modelValue"||t==="model-value"?n.modelModifiers:n[`${t}Modifiers`]||n[`${Ad(t)}Modifiers`]||n[`${Vc(t)}Modifiers`];function Hot(n,t,...e){if(n.isUnmounted)return;const i=n.vnode.props||Ti;let r=e;const s=t.startsWith("update:"),o=s&&Fot(i,t.slice(7));o&&(o.trim&&(r=e.map(d=>Bn(d)?d.trim():d)),o.number&&(r=e.map(NC)));let a,l=i[a=ek(t)]||i[a=ek(Ad(t))];!l&&s&&(l=i[a=ek(Vc(t))]),l&&Xa(l,n,6,r);const h=i[a+"Once"];if(h){if(!n.emitted)n.emitted={};else if(n.emitted[a])return;n.emitted[a]=!0,Xa(h,n,6,r)}}function q9(n,t,e=!1){const i=t.emitsCache,r=i.get(n);if(r!==void 0)return r;const s=n.emits;let o={},a=!1;if(!Ie(n)){const l=h=>{const d=q9(h,t,!0);d&&(a=!0,Hr(o,d))};!e&&t.mixins.length&&t.mixins.forEach(l),n.extends&&l(n.extends),n.mixins&&n.mixins.forEach(l)}return!s&&!a?(ji(n)&&i.set(n,null),null):(ve(s)?s.forEach(l=>o[l]=null):Hr(o,s),ji(n)&&i.set(n,o),o)}function $A(n,t){return!n||!FA(t)?!1:(t=t.slice(2).replace(/Once$/,""),yi(n,t[0].toLowerCase()+t.slice(1))||yi(n,Vc(t))||yi(n,t))}function qH(n){const{type:t,vnode:e,proxy:i,withProxy:r,propsOptions:[s],slots:o,attrs:a,emit:l,render:h,renderCache:d,props:u,data:c,setupState:g,ctx:p,inheritAttrs:f}=n,m=GC(n);let v,_;try{if(e.shapeFlag&4){const y=r||i,C=y;v=Ba(h.call(C,y,d,u,g,c,p)),_=a}else{const y=t;v=Ba(y.length>1?y(u,{attrs:a,slots:o,emit:l}):y(u,null)),_=t.props?a:zot(a)}}catch(y){dv.length=0,jA(y,n,1),v=Ga(uc)}let b=v;if(_&&f!==!1){const y=Object.keys(_),{shapeFlag:C}=b;y.length&&C&7&&(s&&y.some(qI)&&(_=Wot(_,s)),b=Gp(b,_,!1,!0))}return e.dirs&&(b=Gp(b,null,!1,!0),b.dirs=b.dirs?b.dirs.concat(e.dirs):e.dirs),e.transition&&dO(b,e.transition),v=b,GC(m),v}const zot=n=>{let t;for(const e in n)(e==="class"||e==="style"||FA(e))&&((t||(t={}))[e]=n[e]);return t},Wot=(n,t)=>{const e={};for(const i in n)(!qI(i)||!(i.slice(9)in t))&&(e[i]=n[i]);return e};function jot(n,t,e){const{props:i,children:r,component:s}=n,{props:o,children:a,patchFlag:l}=t,h=s.emitsOptions;if(t.dirs||t.transition)return!0;if(e&&l>=0){if(l&1024)return!0;if(l&16)return i?ZH(i,o,h):!!o;if(l&8){const d=t.dynamicProps;for(let u=0;u<d.length;u++){const c=d[u];if(o[c]!==i[c]&&!$A(h,c))return!0}}}else return(r||a)&&(!a||!a.$stable)?!0:i===o?!1:i?o?ZH(i,o,h):!0:!!o;return!1}function ZH(n,t,e){const i=Object.keys(t);if(i.length!==Object.keys(n).length)return!0;for(let r=0;r<i.length;r++){const s=i[r];if(t[s]!==n[s]&&!$A(e,s))return!0}return!1}function Not({vnode:n,parent:t},e){for(;t;){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===n&&(i.el=n.el),i===n)(n=t.vnode).el=e,t=t.parent;else break}}const Z9=n=>n.__isSuspense;function $ot(n,t){t&&t.pendingBranch?ve(n)?t.effects.push(...n):t.effects.push(n):Qst(n)}const jo=Symbol.for("v-fgt"),VA=Symbol.for("v-txt"),uc=Symbol.for("v-cmt"),gC=Symbol.for("v-stc"),dv=[];let Ds=null;function dr(n=!1){dv.push(Ds=n?null:[])}function Vot(){dv.pop(),Ds=dv[dv.length-1]||null}let w_=1;function JH(n,t=!1){w_+=n,n<0&&Ds&&t&&(Ds.hasOnce=!0)}function J9(n){return n.dynamicChildren=w_>0?Ds||up:null,Vot(),w_>0&&Ds&&Ds.push(n),n}function Tr(n,t,e,i,r,s){return J9(Ei(n,t,e,i,r,s,!0))}function Got(n,t,e,i,r){return J9(Ga(n,t,e,i,r,!0))}function Q9(n){return n?n.__v_isVNode===!0:!1}function Qf(n,t){return n.type===t.type&&n.key===t.key}const tY=({key:n})=>n??null,pC=({ref:n,ref_key:t,ref_for:e})=>(typeof n=="number"&&(n=""+n),n!=null?Bn(n)||Sr(n)||Ie(n)?{i:ho,r:n,k:t,f:!!e}:n:null);function Ei(n,t=null,e=null,i=0,r=null,s=n===jo?0:1,o=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:n,props:t,key:t&&tY(t),ref:t&&pC(t),scopeId:k9,slotScopeIds:null,children:e,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:i,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:ho};return a?(cO(l,e),s&128&&n.normalize(l)):e&&(l.shapeFlag|=Bn(e)?8:16),w_>0&&!o&&Ds&&(l.patchFlag>0||s&6)&&l.patchFlag!==32&&Ds.push(l),l}const Ga=Uot;function Uot(n,t=null,e=null,i=0,r=null,s=!1){if((!n||n===pot)&&(n=uc),Q9(n)){const a=Gp(n,t,!0);return e&&cO(a,e),w_>0&&!s&&Ds&&(a.shapeFlag&6?Ds[Ds.indexOf(n)]=a:Ds.push(a)),a.patchFlag=-2,a}if(nat(n)&&(n=n.__vccOpts),t){t=Yot(t);let{class:a,style:l}=t;a&&!Bn(a)&&(t.class=y_(a)),ji(l)&&(lO(l)&&!ve(l)&&(l=Hr({},l)),t.style=QI(l))}const o=Bn(n)?1:Z9(n)?128:iot(n)?64:ji(n)?4:Ie(n)?2:0;return Ei(n,t,e,i,r,o,s,!0)}function Yot(n){return n?lO(n)||z9(n)?Hr({},n):n:null}function Gp(n,t,e=!1,i=!1){const{props:r,ref:s,patchFlag:o,children:a,transition:l}=n,h=t?Kot(r||{},t):r,d={__v_isVNode:!0,__v_skip:!0,type:n.type,props:h,key:h&&tY(h),ref:t&&t.ref?e&&s?ve(s)?s.concat(pC(t)):[s,pC(t)]:pC(t):s,scopeId:n.scopeId,slotScopeIds:n.slotScopeIds,children:a,target:n.target,targetStart:n.targetStart,targetAnchor:n.targetAnchor,staticCount:n.staticCount,shapeFlag:n.shapeFlag,patchFlag:t&&n.type!==jo?o===-1?16:o|16:o,dynamicProps:n.dynamicProps,dynamicChildren:n.dynamicChildren,appContext:n.appContext,dirs:n.dirs,transition:l,component:n.component,suspense:n.suspense,ssContent:n.ssContent&&Gp(n.ssContent),ssFallback:n.ssFallback&&Gp(n.ssFallback),el:n.el,anchor:n.anchor,ctx:n.ctx,ce:n.ce};return l&&i&&dO(d,l.clone(d)),d}function Xot(n=" ",t=0){return Ga(VA,null,n,t)}function QH(n,t){const e=Ga(gC,null,n);return e.staticCount=t,e}function lk(n="",t=!1){return t?(dr(),Got(uc,null,n)):Ga(uc,null,n)}function Ba(n){return n==null||typeof n=="boolean"?Ga(uc):ve(n)?Ga(jo,null,n.slice()):Q9(n)?Oh(n):Ga(VA,null,String(n))}function Oh(n){return n.el===null&&n.patchFlag!==-1||n.memo?n:Gp(n)}function cO(n,t){let e=0;const{shapeFlag:i}=n;if(t==null)t=null;else if(ve(t))e=16;else if(typeof t=="object")if(i&65){const r=t.default;r&&(r._c&&(r._d=!1),cO(n,r()),r._c&&(r._d=!0));return}else{e=32;const r=t._;!r&&!z9(t)?t._ctx=ho:r===3&&ho&&(ho.slots._===1?t._=1:(t._=2,n.patchFlag|=1024))}else Ie(t)?(t={default:t,_ctx:ho},e=32):(t=String(t),i&64?(e=16,t=[Xot(t)]):e=8);n.children=t,n.shapeFlag|=e}function Kot(...n){const t={};for(let e=0;e<n.length;e++){const i=n[e];for(const r in i)if(r==="class")t.class!==i.class&&(t.class=y_([t.class,i.class]));else if(r==="style")t.style=QI([t.style,i.style]);else if(FA(r)){const s=t[r],o=i[r];o&&s!==o&&!(ve(s)&&s.includes(o))&&(t[r]=s?[].concat(s,o):o)}else r!==""&&(t[r]=i[r])}return t}function pa(n,t,e,i=null){Xa(n,t,7,[e,i])}const qot=D9();let Zot=0;function Jot(n,t,e){const i=n.type,r=(t?t.appContext:n.appContext)||qot,s={uid:Zot++,vnode:n,type:i,parent:t,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Cst(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(r.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:j9(i,r),emitsOptions:q9(i,r),emit:null,emitted:null,propsDefaults:Ti,inheritAttrs:i.inheritAttrs,ctx:Ti,data:Ti,props:Ti,attrs:Ti,slots:Ti,refs:Ti,setupState:Ti,setupContext:null,suspense:e,suspenseId:e?e.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=t?t.root:s,s.emit=Hot.bind(null,s),n.ce&&n.ce(s),s}let Ir=null,XC,yP;{const n=zA(),t=(e,i)=>{let r;return(r=n[e])||(r=n[e]=[]),r.push(i),s=>{r.length>1?r.forEach(o=>o(s)):r[0](s)}};XC=t("__VUE_INSTANCE_SETTERS__",e=>Ir=e),yP=t("__VUE_SSR_SETTERS__",e=>A_=e)}const X0=n=>{const t=Ir;return XC(n),n.scope.on(),()=>{n.scope.off(),XC(t)}},tz=()=>{Ir&&Ir.scope.off(),XC(null)};function eY(n){return n.vnode.shapeFlag&4}let A_=!1;function Qot(n,t=!1,e=!1){t&&yP(t);const{props:i,children:r}=n.vnode,s=eY(n);wot(n,i,s,t),kot(n,r,e);const o=s?tat(n,t):void 0;return t&&yP(!1),o}function tat(n,t){const e=n.type;n.accessCache=Object.create(null),n.proxy=new Proxy(n.ctx,fot);const{setup:i}=e;if(i){Hd();const r=n.setupContext=i.length>1?iat(n):null,s=X0(n),o=Y0(i,n,0,[n.props,r]),a=t9(o);if(zd(),s(),(a||n.sp)&&!av(n)&&R9(n),a){if(o.then(tz,tz),t)return o.then(l=>{ez(n,l)}).catch(l=>{jA(l,n,0)});n.asyncDep=o}else ez(n,o)}else iY(n)}function ez(n,t,e){Ie(t)?n.type.__ssrInlineRender?n.ssrRender=t:n.render=t:ji(t)&&(n.setupState=x9(t)),iY(n)}function iY(n,t,e){const i=n.type;n.render||(n.render=i.render||Va);{const r=X0(n);Hd();try{mot(n)}finally{zd(),r()}}}const eat={get(n,t){return br(n,"get",""),n[t]}};function iat(n){const t=e=>{n.exposed=e||{}};return{attrs:new Proxy(n.attrs,eat),slots:n.slots,emit:n.emit,expose:t}}function GA(n){return n.exposed?n.exposeProxy||(n.exposeProxy=new Proxy(x9(Nst(n.exposed)),{get(t,e){if(e in t)return t[e];if(e in lv)return lv[e](n)},has(t,e){return e in t||e in lv}})):n.proxy}function nat(n){return Ie(n)&&"__vccOpts"in n}const rat=(n,t)=>Xst(n,t,A_),sat="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let CP;const iz=typeof window<"u"&&window.trustedTypes;if(iz)try{CP=iz.createPolicy("vue",{createHTML:n=>n})}catch{}const nY=CP?n=>CP.createHTML(n):n=>n,oat="http://www.w3.org/2000/svg",aat="http://www.w3.org/1998/Math/MathML",kl=typeof document<"u"?document:null,nz=kl&&kl.createElement("template"),lat={insert:(n,t,e)=>{t.insertBefore(n,e||null)},remove:n=>{const t=n.parentNode;t&&t.removeChild(n)},createElement:(n,t,e,i)=>{const r=t==="svg"?kl.createElementNS(oat,n):t==="mathml"?kl.createElementNS(aat,n):e?kl.createElement(n,{is:e}):kl.createElement(n);return n==="select"&&i&&i.multiple!=null&&r.setAttribute("multiple",i.multiple),r},createText:n=>kl.createTextNode(n),createComment:n=>kl.createComment(n),setText:(n,t)=>{n.nodeValue=t},setElementText:(n,t)=>{n.textContent=t},parentNode:n=>n.parentNode,nextSibling:n=>n.nextSibling,querySelector:n=>kl.querySelector(n),setScopeId(n,t){n.setAttribute(t,"")},insertStaticContent(n,t,e,i,r,s){const o=e?e.previousSibling:t.lastChild;if(r&&(r===s||r.nextSibling))for(;t.insertBefore(r.cloneNode(!0),e),!(r===s||!(r=r.nextSibling)););else{nz.innerHTML=nY(i==="svg"?`<svg>${n}</svg>`:i==="mathml"?`<math>${n}</math>`:n);const a=nz.content;if(i==="svg"||i==="mathml"){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}t.insertBefore(a,e)}return[o?o.nextSibling:t.firstChild,e?e.previousSibling:t.lastChild]}},hat=Symbol("_vtc");function dat(n,t,e){const i=n[hat];i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?n.removeAttribute("class"):e?n.setAttribute("class",t):n.className=t}const KC=Symbol("_vod"),rY=Symbol("_vsh"),uat={beforeMount(n,{value:t},{transition:e}){n[KC]=n.style.display==="none"?"":n.style.display,e&&t?e.beforeEnter(n):tm(n,t)},mounted(n,{value:t},{transition:e}){e&&t&&e.enter(n)},updated(n,{value:t,oldValue:e},{transition:i}){!t!=!e&&(i?t?(i.beforeEnter(n),tm(n,!0),i.enter(n)):i.leave(n,()=>{tm(n,!1)}):tm(n,t))},beforeUnmount(n,{value:t}){tm(n,t)}};function tm(n,t){n.style.display=t?n[KC]:"none",n[rY]=!t}const cat=Symbol(""),gat=/(^|;)\s*display\s*:/;function pat(n,t,e){const i=n.style,r=Bn(e);let s=!1;if(e&&!r){if(t)if(Bn(t))for(const o of t.split(";")){const a=o.slice(0,o.indexOf(":")).trim();e[a]==null&&fC(i,a,"")}else for(const o in t)e[o]==null&&fC(i,o,"");for(const o in e)o==="display"&&(s=!0),fC(i,o,e[o])}else if(r){if(t!==e){const o=i[cat];o&&(e+=";"+o),i.cssText=e,s=gat.test(e)}}else t&&n.removeAttribute("style");KC in n&&(n[KC]=s?i.display:"",n[rY]&&(i.display="none"))}const rz=/\s*!important$/;function fC(n,t,e){if(ve(e))e.forEach(i=>fC(n,t,i));else if(e==null&&(e=""),t.startsWith("--"))n.setProperty(t,e);else{const i=fat(n,t);rz.test(e)?n.setProperty(Vc(i),e.replace(rz,""),"important"):n[i]=e}}const sz=["Webkit","Moz","ms"],hk={};function fat(n,t){const e=hk[t];if(e)return e;let i=Ad(t);if(i!=="filter"&&i in n)return hk[t]=i;i=n9(i);for(let r=0;r<sz.length;r++){const s=sz[r]+i;if(s in n)return hk[t]=s}return t}const oz="http://www.w3.org/1999/xlink";function az(n,t,e,i,r,s=bst(t)){i&&t.startsWith("xlink:")?e==null?n.removeAttributeNS(oz,t.slice(6,t.length)):n.setAttributeNS(oz,t,e):e==null||s&&!s9(e)?n.removeAttribute(t):n.setAttribute(t,s?"":Ya(e)?String(e):e)}function lz(n,t,e,i,r){if(t==="innerHTML"||t==="textContent"){e!=null&&(n[t]=t==="innerHTML"?nY(e):e);return}const s=n.tagName;if(t==="value"&&s!=="PROGRESS"&&!s.includes("-")){const a=s==="OPTION"?n.getAttribute("value")||"":n.value,l=e==null?n.type==="checkbox"?"on":"":String(e);(a!==l||!("_value"in n))&&(n.value=l),e==null&&n.removeAttribute(t),n._value=e;return}let o=!1;if(e===""||e==null){const a=typeof n[t];a==="boolean"?e=s9(e):e==null&&a==="string"?(e="",o=!0):a==="number"&&(e=0,o=!0)}try{n[t]=e}catch{}o&&n.removeAttribute(r||t)}function Il(n,t,e,i){n.addEventListener(t,e,i)}function mat(n,t,e,i){n.removeEventListener(t,e,i)}const hz=Symbol("_vei");function vat(n,t,e,i,r=null){const s=n[hz]||(n[hz]={}),o=s[t];if(i&&o)o.value=i;else{const[a,l]=_at(t);if(i){const h=s[t]=Cat(i,r);Il(n,a,h,l)}else o&&(mat(n,a,o,l),s[t]=void 0)}}const dz=/(?:Once|Passive|Capture)$/;function _at(n){let t;if(dz.test(n)){t={};let i;for(;i=n.match(dz);)n=n.slice(0,n.length-i[0].length),t[i[0].toLowerCase()]=!0}return[n[2]===":"?n.slice(3):Vc(n.slice(2)),t]}let dk=0;const bat=Promise.resolve(),yat=()=>dk||(bat.then(()=>dk=0),dk=Date.now());function Cat(n,t){const e=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=e.attached)return;Xa(Sat(i,e.value),t,5,[i])};return e.value=n,e.attached=yat(),e}function Sat(n,t){if(ve(t)){const e=n.stopImmediatePropagation;return n.stopImmediatePropagation=()=>{e.call(n),n._stopped=!0},t.map(i=>r=>!r._stopped&&i&&i(r))}else return t}const uz=n=>n.charCodeAt(0)===111&&n.charCodeAt(1)===110&&n.charCodeAt(2)>96&&n.charCodeAt(2)<123,xat=(n,t,e,i,r,s)=>{const o=r==="svg";t==="class"?dat(n,i,o):t==="style"?pat(n,e,i):FA(t)?qI(t)||vat(n,t,e,i,s):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):wat(n,t,i,o))?(lz(n,t,i),!n.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&az(n,t,i,o,s,t!=="value")):n._isVueCE&&(/[A-Z]/.test(t)||!Bn(i))?lz(n,Ad(t),i,s,t):(t==="true-value"?n._trueValue=i:t==="false-value"&&(n._falseValue=i),az(n,t,i,o))};function wat(n,t,e,i){if(i)return!!(t==="innerHTML"||t==="textContent"||t in n&&uz(t)&&Ie(e));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&n.tagName==="INPUT"||t==="type"&&n.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const r=n.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return uz(t)&&Bn(e)?!1:t in n}const Md=n=>{const t=n.props["onUpdate:modelValue"]||!1;return ve(t)?e=>uC(t,e):t};function Aat(n){n.target.composing=!0}function cz(n){const t=n.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Co=Symbol("_assign"),gz={created(n,{modifiers:{lazy:t,trim:e,number:i}},r){n[Co]=Md(r);const s=i||r.props&&r.props.type==="number";Il(n,t?"change":"input",o=>{if(o.target.composing)return;let a=n.value;e&&(a=a.trim()),s&&(a=NC(a)),n[Co](a)}),e&&Il(n,"change",()=>{n.value=n.value.trim()}),t||(Il(n,"compositionstart",Aat),Il(n,"compositionend",cz),Il(n,"change",cz))},mounted(n,{value:t}){n.value=t??""},beforeUpdate(n,{value:t,oldValue:e,modifiers:{lazy:i,trim:r,number:s}},o){if(n[Co]=Md(o),n.composing)return;const a=(s||n.type==="number")&&!/^0\d/.test(n.value)?NC(n.value):n.value,l=t??"";a!==l&&(document.activeElement===n&&n.type!=="range"&&(i&&t===e||r&&n.value.trim()===l)||(n.value=l))}},sY={deep:!0,created(n,t,e){n[Co]=Md(e),Il(n,"change",()=>{const i=n._modelValue,r=Up(n),s=n.checked,o=n[Co];if(ve(i)){const a=tO(i,r),l=a!==-1;if(s&&!l)o(i.concat(r));else if(!s&&l){const h=[...i];h.splice(a,1),o(h)}}else if(Ef(i)){const a=new Set(i);s?a.add(r):a.delete(r),o(a)}else o(oY(n,s))})},mounted:pz,beforeUpdate(n,t,e){n[Co]=Md(e),pz(n,t,e)}};function pz(n,{value:t,oldValue:e},i){n._modelValue=t;let r;if(ve(t))r=tO(t,i.props.value)>-1;else if(Ef(t))r=t.has(i.props.value);else{if(t===e)return;r=hc(t,oY(n,!0))}n.checked!==r&&(n.checked=r)}const Mat={created(n,{value:t},e){n.checked=hc(t,e.props.value),n[Co]=Md(e),Il(n,"change",()=>{n[Co](Up(n))})},beforeUpdate(n,{value:t,oldValue:e},i){n[Co]=Md(i),t!==e&&(n.checked=hc(t,i.props.value))}},Pm={deep:!0,created(n,{value:t,modifiers:{number:e}},i){const r=Ef(t);Il(n,"change",()=>{const s=Array.prototype.filter.call(n.options,o=>o.selected).map(o=>e?NC(Up(o)):Up(o));n[Co](n.multiple?r?new Set(s):s:s[0]),n._assigning=!0,Og(()=>{n._assigning=!1})}),n[Co]=Md(i)},mounted(n,{value:t}){fz(n,t)},beforeUpdate(n,t,e){n[Co]=Md(e)},updated(n,{value:t}){n._assigning||fz(n,t)}};function fz(n,t){const e=n.multiple,i=ve(t);if(!(e&&!i&&!Ef(t))){for(let r=0,s=n.options.length;r<s;r++){const o=n.options[r],a=Up(o);if(e)if(i){const l=typeof a;l==="string"||l==="number"?o.selected=t.some(h=>String(h)===String(a)):o.selected=tO(t,a)>-1}else o.selected=t.has(a);else if(hc(Up(o),t)){n.selectedIndex!==r&&(n.selectedIndex=r);return}}!e&&n.selectedIndex!==-1&&(n.selectedIndex=-1)}}function Up(n){return"_value"in n?n._value:n.value}function oY(n,t){const e=t?"_trueValue":"_falseValue";return e in n?n[e]:t}const mz={created(n,t,e){Nb(n,t,e,null,"created")},mounted(n,t,e){Nb(n,t,e,null,"mounted")},beforeUpdate(n,t,e,i){Nb(n,t,e,i,"beforeUpdate")},updated(n,t,e,i){Nb(n,t,e,i,"updated")}};function Tat(n,t){switch(n){case"SELECT":return Pm;case"TEXTAREA":return gz;default:switch(t){case"checkbox":return sY;case"radio":return Mat;default:return gz}}}function Nb(n,t,e,i,r){const o=Tat(n.tagName,e.props&&e.props.type)[r];o&&o(n,t,e,i)}const kat=Hr({patchProp:xat},lat);let vz;function Rat(){return vz||(vz=Bot(kat))}const Bat=(...n)=>{const t=Rat().createApp(...n),{mount:e}=t;return t.mount=i=>{const r=Eat(i);if(!r)return;const s=t._component;!Ie(s)&&!s.render&&!s.template&&(s.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const o=e(r,!1,Pat(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),o},t};function Pat(n){if(n instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&n instanceof MathMLElement)return"mathml"}function Eat(n){return Bn(n)?document.querySelector(n):n}let Nn=class aY{static GenAutoIncrementId(){return aY.auto_increment_id++}};Nn.auto_increment_id=0;let pe=class{constructor(t){this.id=Nn.GenAutoIncrementId(),this.registry=t}};const UA="named",lY="inject",hY="multi_inject",dY="inversify:tagged",uY="inversify:paramtypes";let gO=class{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===UA?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}};const mp=function(n){var t;return function(e){const i=typeof Symbol=="function",r=i&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",s=Object.getPrototypeOf(Function),o=Map,a=new WeakMap;function l(k,P,I,O){if(!S(I))throw new TypeError;return v(k,P,I,O)}function h(k,P,I){if(!S(P))throw new TypeError;return b(I)||(I=T(I)),g(k,P,I)}function d(k,P,I){if(!S(P))throw new TypeError;return b(I)||(I=T(I)),p(k,P,I)}function u(k,P,I){if(!S(P))throw new TypeError;return b(I)||(I=T(I)),f(k,P,I)}function c(k,P,I){let O=a.get(k);if(b(O)){if(!I)return;O=new o,a.set(k,O)}let H=O.get(P);if(b(H)){if(!I)return;H=new o,O.set(P,H)}return H}function g(k,P,I){if(p(k,P,I))return!0;const O=E(P);return!y(O)&&g(k,O,I)}function p(k,P,I){const O=c(P,I,!1);return!b(O)&&A(O.has(k))}function f(k,P,I){if(p(k,P,I))return m(k,P,I);const O=E(P);return y(O)?void 0:f(k,O,I)}function m(k,P,I){const O=c(P,I,!1);if(!b(O))return O.get(k)}function v(k,P,I,O){c(I,O,!0).set(k,P)}function _(k){if(k===null)return 1;switch(typeof k){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return k===null?1:6;default:return 6}}function b(k){return k===void 0}function y(k){return k===null}function C(k){return typeof k=="symbol"}function S(k){return typeof k=="object"?k!==null:typeof k=="function"}function w(k,P){switch(_(k)){case 0:case 1:case 2:case 3:case 4:case 5:return k}const I="string",O=B(k,r);if(O!==void 0){const H=O.call(k,I);if(S(H))throw new TypeError;return H}return x(k)}function x(k,P){{const I=k.toString;if(R(I)){const H=I.call(k);if(!S(H))return H}const O=k.valueOf;if(R(O)){const H=O.call(k);if(!S(H))return H}}throw new TypeError}function A(k){return!!k}function M(k){return""+k}function T(k){const P=w(k);return C(P)?P:M(P)}function R(k){return typeof k=="function"}function B(k,P){const I=k[P];if(I!=null){if(!R(I))throw new TypeError;return I}}function E(k){const P=Object.getPrototypeOf(k);if(typeof k!="function"||k===s||P!==s)return P;const I=k.prototype,O=I&&Object.getPrototypeOf(I);if(O==null||O===Object.prototype)return P;const H=O.constructor;return typeof H!="function"||H===k?P:H}e("defineMetadata",l),e("hasMetadata",h),e("hasOwnMetadata",d),e("getMetadata",u)}((t=n,function(e,i){typeof t[e]!="function"&&Object.defineProperty(t,e,{configurable:!0,writable:!0,value:i})})),n}({});function Lat(n,t,e,i){const r=[i];let s={};mp.hasOwnMetadata(n,t)&&(s=mp.getMetadata(n,t));let o=s[e];o===void 0&&(o=[]),o.push(...r),s[e]=o,mp.defineMetadata(n,s,t)}function Iat(n,t,e,i){Lat(dY,n,e.toString(),i)}function cY(n){return(t,e,i)=>{Iat(t,e,i,n)}}function gY(n){return t=>(e,i,r)=>cY(new gO(n,t))(e,i,r)}const xe=gY(lY),pY=gY(hY);function Bt(){return function(n){return mp.defineMetadata(uY,null,n),n}}function Sn(n){return cY(new gO(UA,n))}const cc={Singleton:"Singleton",Transient:"Transient"},Uh={ConstantValue:"ConstantValue",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid"};let Oat=class fY{constructor(t,e){this.id=Nn.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=Uh.Invalid,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new fY(this.serviceIdentifier,this.scope);return t.activated=t.scope===cc.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}},Dat=class{getConstructorMetadata(t){return{compilerGeneratedMetadata:mp.getMetadata(uY,t),userGeneratedMetadata:mp.getMetadata(dY,t)||{}}}getPropertiesMetadata(t){throw new Error("")}};const Fat=n=>t=>{const e=i=>{if(i==null)return!1;if(i.key===n&&i.value===t)return!0;if(i.constructorArgsMetadata==null)return!1;const r=i.constructorArgsMetadata;for(let s=0;s<r.length;s++)if(r[s].key===n&&r[s].value===t)return!0;return!1};return e.metaData=new gO(n,t),e},Hat=Fat(UA);let $b=class{constructor(t){this._binding=t}inRequestScope(){throw new Error("")}inSingletonScope(){return this._binding.scope=cc.Singleton,this}inTransientScope(){return this._binding.scope=cc.Transient,this}whenTargetNamed(t){return this._binding.constraint=Hat(t),this}},zat=class{constructor(t){this._binding=t}to(t){return this._binding.type=Uh.Instance,this._binding.implementationType=t,new $b(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=Uh.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new $b(this._binding)}toConstantValue(t){return this._binding.type=Uh.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=cc.Singleton,new $b(this._binding)}toFactory(t){return this._binding.type=Uh.Factory,this._binding.factory=t,this._binding.scope=cc.Singleton,new $b(this._binding)}toService(t){this.toDynamicValue(e=>e.container.get(t))}},Wat=class{constructor(t){const e=t||{};e.defaultScope=e.defaultScope||cc.Transient,this.options=e,this.id=Nn.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new Dat}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const r=this._getNotAllArgs(t,!1,e,i);return this._get(r)}getNamed(t,e){return this.getTagged(t,UA,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new Oat(t,e),r=this._bindingDictionary.get(t)||[];return r.push(i),this._bindingDictionary.set(t,r),new zat(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(o,a)=>{o._binding.moduleId=a},e=o=>a=>{const l=this.bind(a);return t(l,o),l},i=()=>o=>this.unbind(o),r=()=>o=>this.isBound(o),s=o=>a=>{const l=this.rebind(a);return t(l,o),l};return o=>({bindFunction:e(o),isboundFunction:r(),rebindFunction:s(o),unbindFunction:i(),unbindAsyncFunction:a=>null})}_getNotAllArgs(t,e,i,r){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:r}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter(i=>i.constraint(t)).forEach(i=>{e.push(this._resolveFromBinding(i))}),t.isMultiInject||e.length!==1?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),r=Object.keys(i),s=[];for(let o=0;o<r.length;o++){const a=i[o],l={};a.forEach(g=>{l[g.key]=g.value});const h={inject:l[lY],multiInject:l[hY]},d=h.inject||h.multiInject,u={serviceIdentifier:d,constructorArgsMetadata:a},c=(this._bindingDictionary.get(d)||[]).filter(g=>g.constraint(u));if(c.length){const g={injectIdentifier:d,metadata:a,bindings:c};s.push(g)}}return s}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case Uh.ConstantValue:case Uh.Function:e=t.cache;break;case Uh.Instance:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map(e=>e.bindings.length>1?e.bindings.map(i=>this._resolveFromBinding(i)):this._resolveFromBinding(e.bindings[0]))}_saveToScope(t,e){t.scope===cc.Singleton&&(t.cache=e,t.activated=!0)}};const tn=Symbol("ContributionProvider");let mY=class{constructor(t,e){this.serviceIdentifier=t,this.container=e,vY.setStore(this.serviceIdentifier,this)}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}refresh(){this.caches&&(this.caches.length=0,this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier)))}};function nr(n,t){n(tn).toDynamicValue(({container:e})=>new mY(t,e)).inSingletonScope().whenTargetNamed(t)}function jat(n,t){n(tn).toDynamicValue(({container:e})=>new mY(t,e)).whenTargetNamed(t)}class vY{static getStore(t){return this.store.get(t)}static setStore(t,e){this.store.set(t,e)}static refreshAllContributions(){this.store.forEach(t=>{t.refresh()})}}vY.store=new Map;let Nat=class{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i=typeof t=="string"?t.trim():t.name;i&&(this.taps=this.taps.filter(r=>!(r.name===i&&(!e||r.fn===e))))}_parseOptions(t,e,i){let r;if(typeof e=="string")r={name:e.trim()};else if(typeof e!="object"||e===null)throw new Error("Invalid tap options");if(typeof r.name!="string"||r.name==="")throw new Error("Missing name for tap");return r=Object.assign({type:t,fn:i},r),r}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;typeof t.before=="string"?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;typeof t.stage=="number"&&(i=t.stage);let r=this.taps.length;for(;r>0;){r--;const s=this.taps[r];this.taps[r+1]=s;const o=s.stage||0;if(e){if(e.has(s.name)){e.delete(s.name);continue}if(e.size>0)continue}if(!(o>i)){r++;break}}this.taps[r]=t}},qr=class extends Nat{call(...t){this.taps.map(e=>e.fn).forEach(e=>e(...t))}};const YA=Symbol.for("EnvContribution"),pO=Symbol.for("VGlobal");class _Y{constructor(){this._listenerMap=new Map,this._eventListenerTransformer=t=>t}setEventListenerTransformer(t){this._eventListenerTransformer=t||(e=>e)}addEventListener(t,e,i){if(!e)return;const r=s=>{const o=this._eventListenerTransformer(s);typeof e=="function"?e(o):e.handleEvent&&e.handleEvent(o)};this._listenerMap.has(t)||this._listenerMap.set(t,new Map),this._listenerMap.get(t).set(e,r),this._nativeAddEventListener(t,r,i)}removeEventListener(t,e,i){var r;if(!e)return;const s=(r=this._listenerMap.get(t))===null||r===void 0?void 0:r.get(e);s&&(this._nativeRemoveEventListener(t,s,i),this._listenerMap.get(t).delete(e),this._listenerMap.get(t).size===0&&this._listenerMap.delete(t))}dispatchEvent(t){return this._nativeDispatchEvent(t)}clearAllEventListeners(){this._listenerMap.forEach((t,e)=>{t.forEach((i,r)=>{this._nativeRemoveEventListener(e,i,void 0)})}),this._listenerMap.clear()}_nativeAddEventListener(t,e,i){throw new Error("_nativeAddEventListener must be implemented by derived classes")}_nativeRemoveEventListener(t,e,i){throw new Error("_nativeRemoveEventListener must be implemented by derived classes")}_nativeDispatchEvent(t){throw new Error("_nativeDispatchEvent must be implemented by derived classes")}}var $at=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Vat=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},_z=function(n,t){return function(e,i){t(e,i,n)}},Gat=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};let SP=class extends _Y{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(t){this._isImageAnonymous=t}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(t){this._env||this.setEnv("browser"),this.envContribution.supportEvent=t}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=t}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=t}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(t){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=t}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(t){this._env||this.setEnv("browser"),this.envContribution.applyStyles=t}constructor(t){super(),this.contributions=t,this._isImageAnonymous=!0,this.eventListenerTransformer=e=>e,this.id=Nn.GenAutoIncrementId(),this.hooks={onSetEnv:new qr(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}_nativeAddEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(t,e,i)}_nativeRemoveEventListener(t,e,i){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(t,e,i)}_nativeDispatchEvent(t){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(t)}bindContribution(t){const e=[];if(this.contributions.getContributions().forEach(i=>{const r=i.configure(this,t);r&&r.then&&e.push(r)}),e.length)return Promise.all(e)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(t,e){if(e&&e.force===!0||this._env!==t)return this.deactiveCurrentEnv(),this.activeEnv(t,e)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(t,e){const i=this._env;this._env=t;const r=this.bindContribution(e);if(r&&r.then)return r.then(()=>{this.envParams=e,this.hooks.onSetEnv.call(i,t,this)});this.envParams=e,this.hooks.onSetEnv.call(i,t,this)}setActiveEnvContribution(t){this.envContribution=t}createCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(t)}createOffscreenCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(t)}releaseCanvas(t){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(t)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(t){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(t):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(t,e){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(t,e):null}loadImage(t){return this._env||this.setEnv("browser"),this.envContribution.loadImage(t)}loadSvg(t){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(t)}loadJson(t){return this._env||this.setEnv("browser"),this.envContribution.loadJson(t)}loadArrayBuffer(t){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(t)}loadBlob(t){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(t)}loadFont(t,e,i){return Gat(this,void 0,void 0,function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(t,e,i)})}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(t){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(t)}removeDom(t){return this._env||this.setEnv("browser"),this.envContribution.removeDom(t)}createDom(t){return this._env||this.setEnv("browser"),this.envContribution.createDom(t)}updateDom(t,e){return this._env||this.setEnv("browser"),this.envContribution.updateDom(t,e)}getElementTop(t,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(t,e)}getElementLeft(t,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(t,e)}getElementTopLeft(t,e=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(t,e)}isMacOS(){return this._env||this.setEnv("browser"),this.envContribution.isMacOS()}copyToClipBoard(t){return this._env||this.setEnv("browser"),this.envContribution.copyToClipBoard(t)}};SP=$at([Bt(),_z(0,xe(tn)),_z(0,Sn(YA)),Vat("design:paramtypes",[Object])],SP);var Yu;(function(n){n[n.estimate=0]="estimate",n[n.actualBounding=1]="actualBounding",n[n.fontBounding=2]="fontBounding"})(Yu||(Yu={}));var Vb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function XA(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var uk={exports:{}},bz;function Uat(){return bz||(bz=1,function(n){var t=Object.prototype.hasOwnProperty,e="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(e=!1));function r(l,h,d){this.fn=l,this.context=h,this.once=d||!1}function s(l,h,d,u,c){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new r(d,u||l,c),p=e?e+h:h;return l._events[p]?l._events[p].fn?l._events[p]=[l._events[p],g]:l._events[p].push(g):(l._events[p]=g,l._eventsCount++),l}function o(l,h){--l._eventsCount===0?l._events=new i:delete l._events[h]}function a(){this._events=new i,this._eventsCount=0}a.prototype.eventNames=function(){var h=[],d,u;if(this._eventsCount===0)return h;for(u in d=this._events)t.call(d,u)&&h.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?h.concat(Object.getOwnPropertySymbols(d)):h},a.prototype.listeners=function(h){var d=e?e+h:h,u=this._events[d];if(!u)return[];if(u.fn)return[u.fn];for(var c=0,g=u.length,p=new Array(g);c<g;c++)p[c]=u[c].fn;return p},a.prototype.listenerCount=function(h){var d=e?e+h:h,u=this._events[d];return u?u.fn?1:u.length:0},a.prototype.emit=function(h,d,u,c,g,p){var f=e?e+h:h;if(!this._events[f])return!1;var m=this._events[f],v=arguments.length,_,b;if(m.fn){switch(m.once&&this.removeListener(h,m.fn,void 0,!0),v){case 1:return m.fn.call(m.context),!0;case 2:return m.fn.call(m.context,d),!0;case 3:return m.fn.call(m.context,d,u),!0;case 4:return m.fn.call(m.context,d,u,c),!0;case 5:return m.fn.call(m.context,d,u,c,g),!0;case 6:return m.fn.call(m.context,d,u,c,g,p),!0}for(b=1,_=new Array(v-1);b<v;b++)_[b-1]=arguments[b];m.fn.apply(m.context,_)}else{var y=m.length,C;for(b=0;b<y;b++)switch(m[b].once&&this.removeListener(h,m[b].fn,void 0,!0),v){case 1:m[b].fn.call(m[b].context);break;case 2:m[b].fn.call(m[b].context,d);break;case 3:m[b].fn.call(m[b].context,d,u);break;case 4:m[b].fn.call(m[b].context,d,u,c);break;default:if(!_)for(C=1,_=new Array(v-1);C<v;C++)_[C-1]=arguments[C];m[b].fn.apply(m[b].context,_)}}return!0},a.prototype.on=function(h,d,u){return s(this,h,d,u,!1)},a.prototype.once=function(h,d,u){return s(this,h,d,u,!0)},a.prototype.removeListener=function(h,d,u,c){var g=e?e+h:h;if(!this._events[g])return this;if(!d)return o(this,g),this;var p=this._events[g];if(p.fn)p.fn===d&&(!c||p.once)&&(!u||p.context===u)&&o(this,g);else{for(var f=0,m=[],v=p.length;f<v;f++)(p[f].fn!==d||c&&!p[f].once||u&&p[f].context!==u)&&m.push(p[f]);m.length?this._events[g]=m.length===1?m[0]:m:o(this,g)}return this},a.prototype.removeAllListeners=function(h){var d;return h?(d=e?e+h:h,this._events[d]&&o(this,d)):(this._events=new i,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,n.exports=a}(uk)),uk.exports}var Yat=Uat();const us=XA(Yat),Lf=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,Re=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||Lf(n,"Boolean"),it=n=>typeof n=="function",D=n=>n==null,L=n=>n!=null,kt=n=>{const t=typeof n;return n!==null&&t==="object"||t==="function"},Xat=n=>typeof n=="object"&&n!==null,os=function(n){if(!Xat(n)||!Lf(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t},ce=n=>n===void 0,yt=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||Lf(n,"String")},V=n=>Array.isArray?Array.isArray(n):Lf(n,"Array"),fO=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)},Kat=n=>Lf(n,"Date"),J=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||Lf(n,"Number")},qat=n=>typeof n=="string"&&!isNaN(Number(n))&&!isNaN(parseFloat(n)),et=n=>J(n)&&Number.isFinite(n),mO=n=>new RegExp(/^(http(s)?:\/\/)\w+[^\s]+(\.[^\s]+){1,}$/).test(n),vO=n=>new RegExp(/^data:image\/(?:gif|png|jpeg|bmp|webp|svg\+xml)(?:;charset=utf-8)?;base64,(?:[A-Za-z0-9]|[+/])+={0,2}/g).test(n),Zat=n=>({}).toString.call(n).replace(/^\[object /,"").replace(/]$/,""),Jat=Object.prototype,Qat=function(n){const t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||Jat)},tlt=Object.prototype.hasOwnProperty;function xt(n){if(D(n))return!0;if(fO(n))return!n.length;const t=Zat(n);if(t==="Map"||t==="Set")return!n.size;if(Qat(n))return!Object.keys(n).length;for(const e in n)if(tlt.call(n,e))return!1;return!0}const Dt=(n,t,e)=>{const i=yt(t)?t.split("."):t;for(let r=0;r<i.length;r++)n=n?n[i[r]]:void 0;return n===void 0?e:n},elt=Object.prototype.hasOwnProperty,Qr=(n,t)=>n!=null&&elt.call(n,t);function Pn(n,t,e){let i;if(!L(n)||typeof n!="object"||t&&t(n))return n;const r=V(n),s=n.length;i=r?new Array(s):typeof n=="object"?{}:Re(n)||J(n)||yt(n)?n:Kat(n)?new Date(+n):void 0;const o=r?void 0:Object.keys(Object(n));let a=-1;if(i)for(;++a<(o||n).length;){const l=o?o[a]:a,h=n[l];e&&e.includes(l.toString())?i[l]=h:i[l]=Pn(h,t,e)}return i}function _O(n,t,e=!1,i=!1){if(t){if(n===t)return;if(L(t)&&typeof t=="object"){const r=Object(t),s=[];for(const l in r)s.push(l);let{length:o}=s,a=-1;for(;o--;){const l=s[++a];!L(r[l])||typeof r[l]!="object"||i&&V(n[l])?bY(n,l,r[l]):ilt(n,t,l,e,i)}}}}function ilt(n,t,e,i=!1,r=!1){const s=n[e],o=t[e];let a=t[e],l=!0;if(V(o)){if(i)a=[];else if(V(s))a=s;else if(fO(s)){a=new Array(s.length);let h=-1;const d=s.length;for(;++h<d;)a[h]=s[h]}}else os(o)?(a=s??{},typeof s!="function"&&typeof s=="object"||(a={})):l=!1;l&&_O(a,o,i,r),bY(n,e,a)}function bY(n,t,e){(e!==void 0&&!nlt(n[t],e)||e===void 0&&!(t in n))&&(n[t]=e)}function nlt(n,t){return n===t||Number.isNaN(n)&&Number.isNaN(t)}function Z(n,...t){let e=-1;const i=t.length;for(;++e<i;)_O(n,t[e],!0);return n}function Jl(n,t){if(!n||!os(n))return n;const e={};return Object.keys(n).forEach(i=>{const r=n[i];let s=!1;t.forEach(o=>{(yt(o)&&o===i||o instanceof RegExp&&i.match(o))&&(s=!0)}),s||(e[i]=r)}),e}function yz(n){return Object.prototype.toString.call(n)}function Cz(n){return Object.keys(n)}function Oe(n,t,e){if(n===t)return!0;if(typeof n!=typeof t||n==null||t==null)return!1;if(Number.isNaN(n)&&Number.isNaN(t))return!0;if(yz(n)!==yz(t)||it(n)||typeof n!="object")return!1;if(V(n)){if(n.length!==t.length)return!1;for(let s=n.length-1;s>=0;s--)if(!Oe(n[s],t[s]))return!1;return!0}if(!os(n))return!1;const i=Cz(n),r=Cz(t);if(i.length!==r.length)return!1;i.sort(),r.sort();for(let s=i.length-1;s>=0;s--)if(i[s]!=r[s])return!1;for(let s=i.length-1;s>=0;s--){const o=i[s];if(!Oe(n[o],t[o]))return!1}return!0}function rlt(n){if(!n)return[];if(Object.keys)return Object.keys(n);const t=[];for(const e in n)n.hasOwnProperty(e)&&t.push(e);return t}function slt(n,t,e){const i=rlt(t);for(let r=0;r<i.length;r++){const s=i[r];(e?t[s]!=null:n[s]==null)&&(n[s]=t[s])}return n}function Ye(n,t,e=!0){if(n="prototype"in n?n.prototype:n,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(t);for(let r=0;r<i.length;r++){const s=i[r];s!=="constructor"&&(e?t[s]!=null:n[s]==null)&&(n[s]=t[s])}}else slt(n,t,e)}function Q(n){return L(n)?V(n)?n:[n]:[]}function de(n){if(fO(n))return n[n.length-1]}const Mi=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const s=n[r];((e=t==null?void 0:t(s,i))!==null&&e!==void 0?e:s-i)>0&&(i=s)}return i},Ri=(n,t)=>{var e;if(n.length===0)return;let i=n[0];for(let r=1;r<n.length;r++){const s=n[r];((e=t==null?void 0:t(s,i))!==null&&e!==void 0?e:s-i)<0&&(i=s)}return i};function Hl(n,t){if(!V(n)||!V(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0}function olt(n){return n&&V(n)?Array.from(new Set(Q(n))):n}function yY(n,t=Math.random){let e,i,r=n.length;for(;r;)e=Math.floor(t()*r),i=n[--r],n[r]=n[e],n[e]=i;return n}function M_(n){if(!V(n))return[n];const t=[];for(const e of n)t.push(...M_(e));return t}function bO(n,t,e){L(t)||(t=n,n=0),L(e)||(e=1);let i=-1;const r=0|Math.max(0,Math.ceil((t-n)/e)),s=new Array(r);for(;++i<r;)s[i]=n+i*e;return s}function CY(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function zl(n){return Number(n)}function alt(n,t,e=zl){const i=n.length;if(!i)return;if(i<2)return e(n[0],0,n);const r=(i-1)*t,s=Math.floor(r),o=e(n[s],s,n);return o+(e(n[s+1],s+1,n)-o)*(r-s)}const llt=typeof console<"u";function Gb(n,t,e){const i=[t].concat([].slice.call(e));llt&&console[n].apply(console,i)}var ks;(function(n){n[n.None=0]="None",n[n.Error=1]="Error",n[n.Warn=2]="Warn",n[n.Info=3]="Info",n[n.Debug=4]="Debug"})(ks||(ks={}));let ge=class bs{static getInstance(t,e){return bs._instance&&J(t)?bs._instance.level(t):bs._instance||(bs._instance=new bs(t,e)),bs._instance}static setInstance(t){return bs._instance=t}static setInstanceLevel(t){bs._instance?bs._instance.level(t):bs._instance=new bs(t)}static clearInstance(){bs._instance=null}constructor(t=ks.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find(e=>e===t)||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex(i=>i===t);e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach(e=>e(...t))}canLogInfo(){return this._level>=ks.Info}canLogDebug(){return this._level>=ks.Debug}canLogError(){return this._level>=ks.Error}canLogWarn(){return this._level>=ks.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=ks.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):Gb((e=this._method)!==null&&e!==void 0?e:"error","ERROR",t)),this}warn(...t){return this._level>=ks.Warn&&Gb(this._method||"warn","WARN",t),this}info(...t){return this._level>=ks.Info&&Gb(this._method||"log","INFO",t),this}debug(...t){return this._level>=ks.Debug&&Gb(this._method||"log","DEBUG",t),this}};ge._instance=null;function yO(n,t,e=0,i){for(D(i)&&(i=n.length);e<i;){const r=e+i>>>1;CY(n[r],t)>0?i=r:e=r+1}return e}const Sz=(n,t)=>CO(0,n.length,e=>t(n[e])),CO=(n,t,e)=>{let i=n,r=t;for(;i<r;){const s=Math.floor((i+r)/2);e(s)>=0?r=s:i=s+1}return i},hlt=(n,t)=>{let e=n;return e=n.sort(CY),alt(e,.5)},dlt=1e-10,ult=1e-10;function di(n,t,e=ult,i=dlt){const r=i,s=e*Math.max(n,t);return Math.abs(n-t)<=Math.max(r,s)}function Rl(n,t,e,i){return n>t&&!di(n,t,e,i)}function xa(n,t,e,i){return n<t&&!di(n,t,e,i)}const Gc=n=>{let t=null,e=null;return(...i)=>(t&&i.every((r,s)=>r===t[s])||(t=i,e=n(...i)),e)},Ne=function(n,t,e){return n<t?t:n>e?e:n},ts=(n,t,e)=>{let[i,r]=n;r<i&&(i=n[1],r=n[0]);const s=r-i;return s>=e-t?[t,e]:(i=Math.min(Math.max(i,t),e-s),[i,i+s])};function gc(n,t){let e;return n>t&&(e=n,n=t,t=e),i=>Math.max(n,Math.min(t,i))}let qC=!1;try{qC=typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"}catch{qC=!1}function ah(n,t,e){let i,r,s,o,a,l,h=0,d=!1,u=!1,c=!0;const g=!t&&t!==0&&qC;if(typeof n!="function")throw new TypeError("Expected a function");function p(y){const C=i,S=r;return i=r=void 0,h=y,o=n.apply(S,C),o}function f(y,C){return g?(cancelAnimationFrame(a),requestAnimationFrame(y)):setTimeout(y,C)}function m(y){const C=y-l;return l===void 0||C>=t||C<0||u&&y-h>=s}function v(){const y=Date.now();if(m(y))return _(y);a=f(v,function(C){const S=C-h,w=t-(C-l);return u?Math.min(w,s-S):w}(y))}function _(y){return a=void 0,c&&i?p(y):(i=r=void 0,o)}function b(...y){const C=Date.now(),S=m(C);if(i=y,r=this,l=C,S){if(a===void 0)return function(w){return h=w,a=f(v,t),d?p(w):o}(l);if(u)return a=f(v,t),p(l)}return a===void 0&&(a=f(v,t)),o}return t=+t||0,kt(e)&&(d=!!e.leading,u="maxWait"in e,u&&(s=Math.max(et(e.maxWait)?e.maxWait:0,t)),c="trailing"in e?!!e.trailing:c),b.cancel=function(){a!==void 0&&function(y){if(g)return cancelAnimationFrame(y);clearTimeout(y)}(a),h=0,i=l=r=a=void 0},b.flush=function(){return a===void 0?o:_(Date.now())},b.pending=function(){return a!==void 0},b}qC=!1;function ha(n,t,e){let i=!0,r=!0;if(typeof n!="function")throw new TypeError("Expected a function");return kt(e)&&(i="leading"in e?!!e.leading:i,r="trailing"in e?!!e.trailing:r),ah(n,t,{leading:i,trailing:r,maxWait:t})}function Nl(n,t){return e=>n*(1-e)+t*e}function SY(n,t){return function(e){return Math.round(n*(1-e)+t*e)}}function xY(n,t){const e=n.valueOf(),i=t.valueOf(),r=new Date;return s=>(r.setTime(e*(1-s)+i*s),r)}const xP=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ck=new RegExp(xP.source,"g");function clt(n){return function(){return n}}function glt(n){return function(t){return n(t)+""}}function plt(n,t){let e,i,r,s=xP.lastIndex=ck.lastIndex=0,o=-1;const a=[],l=[];for(n+="",t+="";(e=xP.exec(n))&&(i=ck.exec(t));)(r=i.index)>s&&(r=t.slice(s,r),a[o]?a[o]+=r:a[++o]=r),(e=e[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:Nl(e,i)})),s=ck.lastIndex;return s<t.length&&(r=t.slice(s),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?glt(l[0].x):clt(t):(t=l.length,function(h){for(let d,u=0;u<t;++u)a[(d=l[u]).i]=d.x(h);return a.join("")})}function wu(n){if(et(n))return n;const t=+n;return et(t)?t:0}function flt(n){return parseFloat("0."+Math.sin(n).toString().substring(6))}const $t=1e-12,Kt=Math.PI,An=Kt/2,Ci=2*Kt,Ft=2*Math.PI,Et=Math.abs,zt=Math.atan2,me=Math.cos,ti=Math.max,we=Math.min,ee=Math.sin,Rn=Math.sqrt,ng=Math.pow;function wY(n){return n>1?0:n<-1?Kt:Math.acos(n)}function ZC(n){return n>=1?An:n<=-1?-An:Math.asin(n)}function JC(n,t,e,i,r){let s=e,o=i;return typeof n=="number"&&typeof e=="number"&&(s=(1-r)*n+r*e),typeof t=="number"&&typeof i=="number"&&(o=(1-r)*t+r*i),{x:s,y:o}}function QC(n,t){return n[0]*t[1]-n[1]*t[0]}function mlt(n,t){return Et(n[0]-t[0])+Et(n[1]-t[1])<1e-12}function AY(n,t=10){return Math.round(n*t)/t}function Td(n){const t=n.toString().split(/[eE]/),e=(t[0].split(".")[1]||"").length-(+t[1]||0);return e>0?e:0}function Vo(n,t){return AY(n+t,10**Math.max(Td(n),Td(t)))}function tS(n,t){return AY(n-t,10**Math.max(Td(n),Td(t)))}class Yt{constructor(t=0,e=0,i,r){this.x=0,this.y=0,this.x=t,this.y=e,this.x1=i,this.y1=r}clone(){return new Yt(this.x,this.y)}copyFrom(t){return this.x=t.x,this.y=t.y,this.x1=t.x1,this.y1=t.y1,this.defined=t.defined,this.context=t.context,this}set(t,e){return this.x=t,this.y=e,this}add(t){return J(t)?(this.x+=t,void(this.y+=t)):(this.x+=t.x,this.y+=t.y,this)}sub(t){return J(t)?(this.x-=t,void(this.y-=t)):(this.x-=t.x,this.y-=t.y,this)}multi(t){throw new Error("")}div(t){throw new Error("")}}class hi{static distancePP(t,e){return Rn(ng(t.x-e.x,2)+ng(t.y-e.y,2))}static distanceNN(t,e,i,r){return Rn(ng(t-i,2)+ng(e-r,2))}static distancePN(t,e,i){return Rn(ng(e-t.x,2)+ng(i-t.y,2))}static pointAtPP(t,e,i){return new Yt((e.x-t.x)*i+t.x,(e.y-t.y)*i+t.y)}}function Te(n){return n*(Math.PI/180)}function T_(n){return 180*n/Math.PI}const vlt=(n=0)=>{if(n<0)for(;n<-Ci;)n+=Ci;else if(n>0)for(;n>Ci;)n-=Ci;return n},MY=vlt;function ui(n,t,e){return t?{x:n.x+t*Math.cos(e),y:n.y+t*Math.sin(e)}:{x:n.x,y:n.y}}function k_(n,t={x:0,y:0},e=0,i=2*Math.PI){const{x:r,y:s}=n,{x:o,y:a}=t;let l=r-o,h=s-a;const d=Math.sqrt(l*l+h*h);if(d===0)return{radius:0,angle:0};l/=d,h/=d;let u=Math.atan2(h,l);if(u<e)for(;u<=e;)u+=2*Math.PI;if(u>i)for(;u>=i;)u-=2*Math.PI;return{radius:d,angle:u}}function TY(n,t){return Math.atan2(t.y-n.y,t.x-n.x)}function Ka(n){for(;n<0;)n+=2*Math.PI;for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function _lt(n,t){const e=Math.abs(t-n);if(e>=2*Math.PI||2*Math.PI-e<1e-6)return[0,Math.PI/2,Math.PI,1.5*Math.PI];const i=Ka(Math.min(n,t)),r=i+e,s=[i,r];let o=Math.floor(i/Math.PI)*Math.PI/2;for(;o<r;)o>i&&s.push(o),o+=Math.PI/2;return s}function blt(n,t,e,i){const{x:r,y:s}=t,o=_lt(e,i),{width:a,height:l}=n,h=[];return o.forEach(d=>{const u=Math.sin(d),c=Math.cos(d);u===1?h.push(l-s):u===-1?h.push(s):c===1?h.push(a-r):c===-1?h.push(r):(u>0?h.push(Math.abs((l-s)/u)):h.push(Math.abs(s/u)),c>0?h.push(Math.abs((a-r)/c)):h.push(Math.abs(r/c)))}),Math.min.apply(null,h)}function kY(n){return(n=Ka(n))>0&&n<=Math.PI/2?2:n>Math.PI/2&&n<=Math.PI?3:n>Math.PI&&n<=3*Math.PI/2?4:1}function gk(n,t,e){n[0]=t[0]-e[0],n[1]=t[1]-e[1]}function RY(n,t,e,i){let r=n[0],s=t[0],o=e[0],a=i[0];return s<r&&([r,s]=[s,r]),a<o&&([a,o]=[o,a]),!(s<o||a<r)&&(r=n[1],s=t[1],o=e[1],a=i[1],s<r&&([r,s]=[s,r]),a<o&&([a,o]=[o,a]),!(s<o||a<r))}function ylt(n,t,e,i){if(!RY(n,t,e,i))return!1;const r=[0,0],s=[0,0],o=[0,0];if(gk(r,t,n),gk(s,i,e),mlt(r,s))return!0;gk(o,e,n);const a=QC(o,s)/QC(r,s);return a>=0&&a<=1&&[n[0]+r[0]*a,n[1]+r[1]*a]}function KA(n,t,e){if(n===null)return t;if(t===null)return n;const{x11:i,x12:r,y11:s,y12:o,x21:a,x22:l,y21:h,y22:d}=SO(n,t,e);return i>=l||r<=a||s>=d||o<=h?{x1:0,y1:0,x2:0,y2:0}:{x1:Math.max(i,a),y1:Math.max(s,h),x2:Math.min(r,l),y2:Math.min(o,d)}}var Dg;(function(n){n[n.NONE=0]="NONE",n[n.BBOX1=1]="BBOX1",n[n.BBOX2=2]="BBOX2"})(Dg||(Dg={}));const SO=(n,t,e)=>{let i=n.x1,r=n.x2,s=n.y1,o=n.y2,a=t.x1,l=t.x2,h=t.y1,d=t.y2;return e&&(i>r&&([i,r]=[r,i]),s>o&&([s,o]=[o,s]),a>l&&([a,l]=[l,a]),h>d&&([h,d]=[d,h])),{x11:i,x12:r,y11:s,y12:o,x21:a,x22:l,y21:h,y22:d}};function BY(n,t,e){if(!n||!t)return Dg.NONE;const{x11:i,x12:r,y11:s,y12:o,x21:a,x22:l,y21:h,y22:d}=SO(n,t,e);return i>a&&r<l&&s>h&&o<d?Dg.BBOX1:a>i&&l<r&&h>s&&d<o?Dg.BBOX2:Dg.NONE}function kd(n,t,e){if(n&&t){if(!e)return!(n.x1>t.x2||n.x2<t.x1||n.y1>t.y2||n.y2<t.y1);const{x11:i,x12:r,y11:s,y12:o,x21:a,x22:l,y21:h,y22:d}=SO(n,t,!0);return!(i>l||r<a||s>d||o<h)}return!0}function vp(n,t,e){if(!t)return!0;if(!e)return n.x>=t.x1&&n.x<=t.x2&&n.y>=t.y1&&n.y<=t.y2;let i=t.x1,r=t.x2,s=t.y1,o=t.y2;return i>r&&([i,r]=[r,i]),s>o&&([s,o]=[o,s]),n.x>=i&&n.x<=r&&n.y>=s&&n.y<=o}function pk(n,t){return Math.abs(t[0]*n[0]+t[1]*n[1])}function uo({x:n,y:t},e,i={x:0,y:0}){return{x:(n-i.x)*Math.cos(e)-(t-i.y)*Math.sin(e)+i.x,y:(n-i.x)*Math.sin(e)+(t-i.y)*Math.cos(e)+i.y}}function wP(n){return{x:(n.x1+n.x2)/2,y:(n.y1+n.y2)/2}}function xz(n,t){const e=t?Te(n.angle):n.angle,i=wP(n);return[uo({x:n.x1,y:n.y1},e,i),uo({x:n.x2,y:n.y1},e,i),uo({x:n.x2,y:n.y2},e,i),uo({x:n.x1,y:n.y2},e,i)]}function xO(n,t,e=!1){const i=xz(n,e),r=xz(t,e),s=(m,v)=>[v.x-m.x,v.y-m.y],o=s(wP(n),wP(t)),a=s(i[0],i[1]),l=s(i[1],i[2]),h=s(r[0],r[1]),d=s(r[1],r[2]),u=e?Te(n.angle):n.angle;let c=e?Te(90-n.angle):n.angle+An;const g=e?Te(t.angle):t.angle;let p=e?Te(90-t.angle):t.angle+An;c>Ft&&(c-=Ft),p>Ft&&(p-=Ft);const f=(m,v,_,b)=>{const y=[Math.cos(v),Math.sin(v)];return m+(pk(y,_)+pk(y,b))/2>pk(y,o)};return f((n.x2-n.x1)/2,u,h,d)&&f((n.y2-n.y1)/2,c,h,d)&&f((t.x2-t.x1)/2,g,a,l)&&f((t.y2-t.y1)/2,p,a,l)}let Ub,Yb,Xb,Kb;function Clt(n){return Ub=1/0,Yb=1/0,Xb=-1/0,Kb=-1/0,n.forEach(t=>{Ub>t.x&&(Ub=t.x),Xb<t.x&&(Xb=t.x),Yb>t.y&&(Yb=t.y),Kb<t.y&&(Kb=t.y)}),{x1:Ub,y1:Yb,x2:Xb,y2:Kb}}const Slt=1e-8;function xlt(n,t,e,i,r){for(let s=0,o=r[r.length-1];s<r.length;s++){const a=r[s];if(RY([n,t],[e,i],[a.x,a.y],[o.x,o.y]))return!0;o=a}return!1}function wO(n,t,e){let i=0,r=n[0];if(!r)return!1;for(let o=1;o<n.length;o++){const a=n[o];i+=wz(r.x,r.y,a.x,a.y,t,e),r=a}const s=n[0];return Az(r.x,s.x)&&Az(r.y,s.y)||(i+=wz(r.x,r.y,s.x,s.y,t,e)),i!==0}function wz(n,t,e,i,r,s){if(s>t&&s>i||s<t&&s<i||i===t)return 0;const o=(s-t)/(i-t);let a=i<t?1:-1;o!==1&&o!==0||(a=i<t?.5:-.5);const l=o*(e-n)+n;return l===r?1/0:l>r?a:0}function Az(n,t){return Math.abs(n-t)<Slt}function wlt(n,t){for(let e=0;e<t.length;e++)if(wO(n,t[e].x,t[e].y)||e>0&&xlt(t[e-1].x,t[e-1].y,t[e].x,t[e].y,n))return!0;return!1}const Mz=n=>{let t=n.charCodeAt(0),e=n.length===2?n.charCodeAt(1):0,i=t;return 55296<=t&&t<=56319&&56320<=e&&e<=57343&&(t&=1023,e&=1023,i=t<<10|e,i+=65536),i===12288||65281<=i&&i<=65376||65504<=i&&i<=65510?"F":i===8361||65377<=i&&i<=65470||65474<=i&&i<=65479||65482<=i&&i<=65487||65490<=i&&i<=65495||65498<=i&&i<=65500||65512<=i&&i<=65518?"H":4352<=i&&i<=4447||4515<=i&&i<=4519||4602<=i&&i<=4607||9001<=i&&i<=9002||11904<=i&&i<=11929||11931<=i&&i<=12019||12032<=i&&i<=12245||12272<=i&&i<=12283||12289<=i&&i<=12350||12353<=i&&i<=12438||12441<=i&&i<=12543||12549<=i&&i<=12589||12593<=i&&i<=12686||12688<=i&&i<=12730||12736<=i&&i<=12771||12784<=i&&i<=12830||12832<=i&&i<=12871||12880<=i&&i<=13054||13056<=i&&i<=19903||19968<=i&&i<=42124||42128<=i&&i<=42182||43360<=i&&i<=43388||44032<=i&&i<=55203||55216<=i&&i<=55238||55243<=i&&i<=55291||63744<=i&&i<=64255||65040<=i&&i<=65049||65072<=i&&i<=65106||65108<=i&&i<=65126||65128<=i&&i<=65131||110592<=i&&i<=110593||127488<=i&&i<=127490||127504<=i&&i<=127546||127552<=i&&i<=127560||127568<=i&&i<=127569||131072<=i&&i<=194367||177984<=i&&i<=196605||196608<=i&&i<=262141?"W":32<=i&&i<=126||162<=i&&i<=163||165<=i&&i<=166||i===172||i===175||10214<=i&&i<=10221||10629<=i&&i<=10630?"Na":i===161||i===164||167<=i&&i<=168||i===170||173<=i&&i<=174||176<=i&&i<=180||182<=i&&i<=186||188<=i&&i<=191||i===198||i===208||215<=i&&i<=216||222<=i&&i<=225||i===230||232<=i&&i<=234||236<=i&&i<=237||i===240||242<=i&&i<=243||247<=i&&i<=250||i===252||i===254||i===257||i===273||i===275||i===283||294<=i&&i<=295||i===299||305<=i&&i<=307||i===312||319<=i&&i<=322||i===324||328<=i&&i<=331||i===333||338<=i&&i<=339||358<=i&&i<=359||i===363||i===462||i===464||i===466||i===468||i===470||i===472||i===474||i===476||i===593||i===609||i===708||i===711||713<=i&&i<=715||i===717||i===720||728<=i&&i<=731||i===733||i===735||768<=i&&i<=879||913<=i&&i<=929||931<=i&&i<=937||945<=i&&i<=961||963<=i&&i<=969||i===1025||1040<=i&&i<=1103||i===1105||i===8208||8211<=i&&i<=8214||8216<=i&&i<=8217||8220<=i&&i<=8221||8224<=i&&i<=8226||8228<=i&&i<=8231||i===8240||8242<=i&&i<=8243||i===8245||i===8251||i===8254||i===8308||i===8319||8321<=i&&i<=8324||i===8364||i===8451||i===8453||i===8457||i===8467||i===8470||8481<=i&&i<=8482||i===8486||i===8491||8531<=i&&i<=8532||8539<=i&&i<=8542||8544<=i&&i<=8555||8560<=i&&i<=8569||i===8585||8592<=i&&i<=8601||8632<=i&&i<=8633||i===8658||i===8660||i===8679||i===8704||8706<=i&&i<=8707||8711<=i&&i<=8712||i===8715||i===8719||i===8721||i===8725||i===8730||8733<=i&&i<=8736||i===8739||i===8741||8743<=i&&i<=8748||i===8750||8756<=i&&i<=8759||8764<=i&&i<=8765||i===8776||i===8780||i===8786||8800<=i&&i<=8801||8804<=i&&i<=8807||8810<=i&&i<=8811||8814<=i&&i<=8815||8834<=i&&i<=8835||8838<=i&&i<=8839||i===8853||i===8857||i===8869||i===8895||i===8978||9312<=i&&i<=9449||9451<=i&&i<=9547||9552<=i&&i<=9587||9600<=i&&i<=9615||9618<=i&&i<=9621||9632<=i&&i<=9633||9635<=i&&i<=9641||9650<=i&&i<=9651||9654<=i&&i<=9655||9660<=i&&i<=9661||9664<=i&&i<=9665||9670<=i&&i<=9672||i===9675||9678<=i&&i<=9681||9698<=i&&i<=9701||i===9711||9733<=i&&i<=9734||i===9737||9742<=i&&i<=9743||9748<=i&&i<=9749||i===9756||i===9758||i===9792||i===9794||9824<=i&&i<=9825||9827<=i&&i<=9829||9831<=i&&i<=9834||9836<=i&&i<=9837||i===9839||9886<=i&&i<=9887||9918<=i&&i<=9919||9924<=i&&i<=9933||9935<=i&&i<=9953||i===9955||9960<=i&&i<=9983||i===10045||i===10071||10102<=i&&i<=10111||11093<=i&&i<=11097||12872<=i&&i<=12879||57344<=i&&i<=63743||65024<=i&&i<=65039||i===65533||127232<=i&&i<=127242||127248<=i&&i<=127277||127280<=i&&i<=127337||127344<=i&&i<=127386||917760<=i&&i<=917999||983040<=i&&i<=1048573||1048576<=i&&i<=1114109?"A":"N"};function pc(n,t={},e){e||(e=1);const{fontStyle:i=t.fontStyle,fontVariant:r=t.fontVariant,fontWeight:s=t.fontWeight,fontSize:o=t.fontSize,fontFamily:a=t.fontFamily}=n;return(i?i+" ":"")+(r?r+" ":"")+(s?s+" ":"")+o*e+"px "+(a||"sans-serif")}class Wi{constructor(t,e){this._numberCharSize=null,this._fullCharSize=null,this._letterCharSize=null,this._specialCharSizeMap={},this._canvas=null,this._context=null,this._contextSaved=!1,this._notSupportCanvas=!1,this._notSupportVRender=!1,this._userSpec={},this.specialCharSet=`-/: .,@%'"~`,this._option=t,this._userSpec=e??{},this.textSpec=this._initSpec(),L(t.specialCharSet)&&(this.specialCharSet=t.specialCharSet),this._standardMethod=L(t.getTextBounds)?this.fullMeasure.bind(this):this.measureWithNaiveCanvas.bind(this)}initContext(){if(this._notSupportCanvas)return!1;if(D(this._canvas)&&(L(this._option.getCanvasForMeasure)&&(this._canvas=this._option.getCanvasForMeasure()),D(this._canvas)&&typeof window<"u"&&window.document!==void 0&&globalThis&&L(globalThis.document)&&(this._canvas=globalThis.document.createElement("canvas"))),D(this._context)&&L(this._canvas)){const t=this._canvas.getContext("2d");L(t)&&(t.save(),t.font=pc(this.textSpec),this._contextSaved=!0,this._context=t)}return!D(this._context)||(this._notSupportCanvas=!0,!1)}_initSpec(){var t,e,i;const{defaultFontParams:r={}}=this._option,{fontStyle:s=r.fontStyle,fontVariant:o=r.fontVariant,fontWeight:a=(t=r.fontWeight)!==null&&t!==void 0?t:"normal",fontSize:l=(e=r.fontSize)!==null&&e!==void 0?e:12,fontFamily:h=(i=r.fontFamily)!==null&&i!==void 0?i:"sans-serif",align:d,textAlign:u=d??"center",baseline:c,textBaseline:g=c??"middle",ellipsis:p,limit:f}=this._userSpec;let{lineHeight:m=l}=this._userSpec;if(yt(m)&&m[m.length-1]==="%"){const v=Number.parseFloat(m.substring(0,m.length-1))/100;m=l*v}return{fontStyle:s,fontVariant:o,fontFamily:h,fontSize:l,fontWeight:a,textAlign:u,textBaseline:g,ellipsis:p,limit:f,lineHeight:m}}measure(t,e){switch(e){case"vrender":case"canopus":return this.fullMeasure(t);case"canvas":return this.measureWithNaiveCanvas(t);case"simple":return this.quickMeasureWithoutCanvas(t);default:return this.quickMeasure(t)}}fullMeasure(t){if(D(t))return{width:0,height:0};if(D(this._option.getTextBounds)||!this._notSupportVRender)return this.measureWithNaiveCanvas(t);const{fontFamily:e,fontSize:i,fontWeight:r,textAlign:s,textBaseline:o,ellipsis:a,limit:l,lineHeight:h}=this.textSpec;let d;try{const u=this._option.getTextBounds({text:t,fontFamily:e,fontSize:i,fontWeight:r,textAlign:s,textBaseline:o,ellipsis:!!a,maxLineWidth:l||1/0,lineHeight:h});d={width:u.width(),height:u.height()}}catch{this._notSupportVRender=!0,d=this.measureWithNaiveCanvas(t)}return d}measureWithNaiveCanvas(t){return this._measureReduce(t,this._measureWithNaiveCanvas.bind(this))}_measureWithNaiveCanvas(t){var e;if(!this.initContext())return this._quickMeasureWithoutCanvas(t);const i=this._context.measureText(t),{fontSize:r,lineHeight:s}=this.textSpec;return{width:i.width,height:(e=s)!==null&&e!==void 0?e:r,fontBoundingBoxAscent:i.fontBoundingBoxAscent,fontBoundingBoxDescent:i.fontBoundingBoxDescent}}quickMeasure(t){return this._measureReduce(t,this._quickMeasure.bind(this))}_quickMeasure(t){const e={width:0,height:0};for(let i=0;i<t.length;i++){const r=t[i];let s=this._measureSpecialChar(r);D(s)&&Wi.NUMBERS_CHAR_SET.includes(r)&&(s=this._measureNumberChar()),D(s)&&["F","W"].includes(Mz(r))&&(s=this._measureFullSizeChar()),D(s)&&(s=this._measureLetterChar()),e.width+=s.width,e.height=Math.max(e.height,s.height),!D(s.fontBoundingBoxAscent)&&(e.fontBoundingBoxAscent=s.fontBoundingBoxAscent),!D(s.fontBoundingBoxDescent)&&(e.fontBoundingBoxDescent=s.fontBoundingBoxDescent)}return e}quickMeasureWithoutCanvas(t){return this._measureReduce(t,this._quickMeasureWithoutCanvas.bind(this))}_quickMeasureWithoutCanvas(t){var e;const i={width:0,height:0},{fontSize:r,lineHeight:s}=this.textSpec;for(let o=0;o<t.length;o++){const a=t[o],l=["F","W"].includes(Mz(a))?1:.53;i.width+=l*r}return i.height=(e=s)!==null&&e!==void 0?e:r,i}_measureReduce(t,e){var i;const{fontSize:r,lineHeight:s}=this.textSpec,o={width:0,height:0};if(D(t))return o;if(V(t)){const a=t.filter(L).map(l=>l.toString());return a.length===0?o:a.length===1?e(a[0]):{width:a.reduce((l,h)=>Math.max(l,e(h).width),0),height:a.length*(((i=s)!==null&&i!==void 0?i:r)+1)+1}}return e(t.toString())}_measureNumberChar(){if(D(this._numberCharSize)){const t=this._standardMethod(Wi.NUMBERS_CHAR_SET);this._numberCharSize={width:t.width/Wi.NUMBERS_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._numberCharSize}_measureFullSizeChar(){return D(this._fullCharSize)&&(this._fullCharSize=this._standardMethod(Wi.FULL_SIZE_CHAR)),this._fullCharSize}_measureLetterChar(){if(D(this._letterCharSize)){const t=this._standardMethod(Wi.ALPHABET_CHAR_SET);this._letterCharSize={width:t.width/Wi.ALPHABET_CHAR_SET.length,height:t.height,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent}}return this._letterCharSize}_measureSpecialChar(t){return L(this._specialCharSizeMap[t])?this._specialCharSizeMap[t]:this.specialCharSet.includes(t)?(this._specialCharSizeMap[t]=this._standardMethod(t),this._specialCharSizeMap[t]):null}release(){L(this._canvas)&&(this._canvas=null),L(this._context)&&(this._contextSaved&&(this._context.restore(),this._contextSaved=!1),this._context=null)}}Wi.ALPHABET_CHAR_SET="abcdefghijklmnopqrstuvwxyz",Wi.NUMBERS_CHAR_SET="0123456789",Wi.FULL_SIZE_CHAR="";const PY=(n,t)=>{const{x1:e,x2:i,y1:r,y2:s}=n,o=Math.abs(i-e),a=Math.abs(s-r);let l=(e+i)/2,h=(r+s)/2,d=0,u=0;switch(t){case"top":case"inside-top":u=-.5;break;case"bottom":case"inside-bottom":u=.5;break;case"left":case"inside-left":d=-.5;break;case"right":case"inside-right":d=.5;break;case"top-right":d=.5,u=-.5;break;case"top-left":d=-.5,u=-.5;break;case"bottom-right":d=.5,u=.5;break;case"bottom-left":d=-.5,u=.5}return l+=d*o,h+=u*a,{x:l,y:h}},eS=(n,t)=>Math.max(t.x1-n.x2,n.x1-t.x2,t.y1-n.y2,n.y1-t.y2),EY=(n,t)=>{const e=[{x:Math.cos(n.angle),y:Math.sin(n.angle)},{x:-Math.sin(n.angle),y:Math.cos(n.angle)},{x:Math.cos(t.angle),y:Math.sin(n.angle)},{x:-Math.sin(t.angle),y:Math.cos(n.angle)}];function i(s,o,a){const l=s.getRotatedCorners().map(h=>h.x*o+h.y*a);return{min:Math.min(...l),max:Math.max(...l)}}let r=0;for(const s of e){const o=i(n,s.x,s.y),a=i(t,s.x,s.y);let l;l=o.max<a.min?a.min-o.max:a.max<o.min?o.min-a.max:0,r=Math.max(r,l)}return r};function K0(n,t,e){const{x1:i,y1:r,x2:s,y2:o}=t;return e.onlyTranslate()?(n!==t&&n.setValue(t.x1,t.y1,t.x2,t.y2),n.translate(e.e,e.f),t):(n.clear(),n.add(e.a*i+e.c*r+e.e,e.b*i+e.d*r+e.f),n.add(e.a*s+e.c*r+e.e,e.b*s+e.d*r+e.f),n.add(e.a*s+e.c*o+e.e,e.b*s+e.d*o+e.f),n.add(e.a*i+e.c*o+e.e,e.b*i+e.d*o+e.f),t)}class Bi{constructor(t){t?this.setValue(t.x1,t.y1,t.x2,t.y2):this.clear()}clone(){return new Bi(this)}clear(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this}empty(){return this.x1===+Number.MAX_VALUE&&this.y1===+Number.MAX_VALUE&&this.x2===-Number.MAX_VALUE&&this.y2===-Number.MAX_VALUE}equals(t){return this.x1===t.x1&&this.y1===t.y1&&this.x2===t.x2&&this.y2===t.y2}setValue(t=0,e=0,i=0,r=0){return this.x1=t,this.y1=e,this.x2=i,this.y2=r,this}set(t=0,e=0,i=0,r=0){return i<t?(this.x2=t,this.x1=i):(this.x1=t,this.x2=i),r<e?(this.y2=e,this.y1=r):(this.y1=e,this.y2=r),this}add(t=0,e=0){return t<this.x1&&(this.x1=t),e<this.y1&&(this.y1=e),t>this.x2&&(this.x2=t),e>this.y2&&(this.y2=e),this}expand(t=0){return V(t)?(this.y1-=t[0],this.x2+=t[1],this.y2+=t[2],this.x1-=t[3]):(this.x1-=t,this.y1-=t,this.x2+=t,this.y2+=t),this}round(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this}translate(t=0,e=0){return this.x1+=t,this.x2+=t,this.y1+=e,this.y2+=e,this}rotate(t=0,e=0,i=0){const r=this.rotatedPoints(t,e,i);return this.clear().add(r[0],r[1]).add(r[2],r[3]).add(r[4],r[5]).add(r[6],r[7])}scale(t=0,e=0,i=0,r=0){const s=this.scalePoints(t,e,i,r);return this.clear().add(s[0],s[1]).add(s[2],s[3])}union(t){return t.x1<this.x1&&(this.x1=t.x1),t.y1<this.y1&&(this.y1=t.y1),t.x2>this.x2&&(this.x2=t.x2),t.y2>this.y2&&(this.y2=t.y2),this}intersect(t){return t.x1>this.x1&&(this.x1=t.x1),t.y1>this.y1&&(this.y1=t.y1),t.x2<this.x2&&(this.x2=t.x2),t.y2<this.y2&&(this.y2=t.y2),this}encloses(t){return t&&this.x1<=t.x1&&this.x2>=t.x2&&this.y1<=t.y1&&this.y2>=t.y2}alignsWith(t){return t&&(this.x1===t.x1||this.x2===t.x2||this.y1===t.y1||this.y2===t.y2)}intersects(t){return t&&!(this.x2<t.x1||this.x1>t.x2||this.y2<t.y1||this.y1>t.y2)}contains(t=0,e=0){return!(t<this.x1||t>this.x2||e<this.y1||e>this.y2)}containsPoint(t){return!(t.x<this.x1||t.x>this.x2||t.y<this.y1||t.y>this.y2)}width(){return this.empty()?0:this.x2-this.x1}height(){return this.empty()?0:this.y2-this.y1}scaleX(t=0){return this.x1*=t,this.x2*=t,this}scaleY(t=0){return this.y1*=t,this.y2*=t,this}transformWithMatrix(t){return K0(this,this,t),this}copy(t){return this.x1=t.x1,this.y1=t.y1,this.x2=t.x2,this.y2=t.y2,this}rotatedPoints(t,e,i){const{x1:r,y1:s,x2:o,y2:a}=this,l=Math.cos(t),h=Math.sin(t),d=e-e*l+i*h,u=i-e*h-i*l;return[l*r-h*s+d,h*r+l*s+u,l*r-h*a+d,h*r+l*a+u,l*o-h*s+d,h*o+l*s+u,l*o-h*a+d,h*o+l*a+u]}scalePoints(t,e,i,r){const{x1:s,y1:o,x2:a,y2:l}=this;return[t*s+(1-t)*i,e*o+(1-e)*r,t*a+(1-t)*i,e*l+(1-e)*r]}}class ie extends Bi{}class qA extends Bi{constructor(t,e=0){var i;super(t),t&&(this.angle=(i=t.angle)!==null&&i!==void 0?i:e)}intersects(t){return xO(this,t)}setValue(t=0,e=0,i=0,r=0,s=0){return super.setValue(t,e,i,r),this.angle=s,this}clone(){return new qA(this)}getRotatedCorners(){const t={x:(this.x1+this.x2)/2,y:(this.y1+this.y2)/2};return[uo({x:this.x1,y:this.y1},this.angle,t),uo({x:this.x2,y:this.y1},this.angle,t),uo({x:this.x1,y:this.y2},this.angle,t),uo({x:this.x2,y:this.y2},this.angle,t)]}}class Pe{constructor(t=1,e=0,i=0,r=1,s=0,o=0){this.a=t,this.b=e,this.c=i,this.d=r,this.e=s,this.f=o}equalToMatrix(t){return!(this.e!==t.e||this.f!==t.f||this.a!==t.a||this.d!==t.d||this.b!==t.b||this.c!==t.c)}equalTo(t,e,i,r,s,o){return!(this.e!==s||this.f!==o||this.a!==t||this.d!==r||this.b!==e||this.c!==i)}setValue(t,e,i,r,s,o){return this.a=t,this.b=e,this.c=i,this.d=r,this.e=s,this.f=o,this}reset(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}getInverse(){const t=this.a,e=this.b,i=this.c,r=this.d,s=this.e,o=this.f,a=new Pe,l=t*r-e*i;return a.a=r/l,a.b=-e/l,a.c=-i/l,a.d=t/l,a.e=(i*o-r*s)/l,a.f=-(t*o-e*s)/l,a}rotate(t){const e=Math.cos(t),i=Math.sin(t),r=this.a*e+this.c*i,s=this.b*e+this.d*i,o=this.a*-i+this.c*e,a=this.b*-i+this.d*e;return this.a=r,this.b=s,this.c=o,this.d=a,this}rotateByCenter(t,e,i){const r=Math.cos(t),s=Math.sin(t),o=(1-r)*e+s*i,a=(1-r)*i-s*e,l=r*this.a-s*this.b,h=s*this.a+r*this.b,d=r*this.c-s*this.d,u=s*this.c+r*this.d,c=r*this.e-s*this.f+o,g=s*this.e+r*this.f+a;return this.a=l,this.b=h,this.c=d,this.d=u,this.e=c,this.f=g,this}scale(t,e){return this.a*=t,this.b*=t,this.c*=e,this.d*=e,this}setScale(t,e){return this.b=this.b/this.a*t,this.c=this.c/this.d*e,this.a=t,this.d=e,this}transform(t,e,i,r,s,o){return this.multiply(t,e,i,r,s,o),this}translate(t,e){return this.e+=this.a*t+this.c*e,this.f+=this.b*t+this.d*e,this}transpose(){const{a:t,b:e,c:i,d:r,e:s,f:o}=this;return this.a=e,this.b=t,this.c=r,this.d=i,this.e=o,this.f=s,this}multiply(t,e,i,r,s,o){const a=this.a,l=this.b,h=this.c,d=this.d,u=a*t+h*e,c=l*t+d*e,g=a*i+h*r,p=l*i+d*r,f=a*s+h*o+this.e,m=l*s+d*o+this.f;return this.a=u,this.b=c,this.c=g,this.d=p,this.e=f,this.f=m,this}interpolate(t,e){const i=new Pe;return i.a=this.a+(t.a-this.a)*e,i.b=this.b+(t.b-this.b)*e,i.c=this.c+(t.c-this.c)*e,i.d=this.d+(t.d-this.d)*e,i.e=this.e+(t.e-this.e)*e,i.f=this.f+(t.f-this.f)*e,i}transformPoint(t,e){const{a:i,b:r,c:s,d:o,e:a,f:l}=this,h=i*o-r*s,d=o/h,u=-r/h,c=-s/h,g=i/h,p=(s*l-o*a)/h,f=-(i*l-r*a)/h,{x:m,y:v}=t;e.x=m*d+v*c+p,e.y=m*u+v*g+f}onlyTranslate(t=1){return this.a===t&&this.b===0&&this.c===0&&this.d===t}clone(){return new Pe(this.a,this.b,this.c,this.d,this.e,this.f)}toTransformAttrs(){const t=this.a,e=this.b,i=this.c,r=this.d,s=t*r-e*i,o={x:this.e,y:this.f,rotateDeg:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(t!==0||e!==0){const a=Math.sqrt(t*t+e*e);o.rotateDeg=e>0?Math.acos(t/a):-Math.acos(t/a),o.scaleX=a,o.scaleY=s/a,o.skewX=(t*i+e*r)/s,o.skewY=0}else if(i!==0||r!==0){const a=Math.sqrt(i*i+r*r);o.rotateDeg=Math.PI/2-(r>0?Math.acos(-i/a):-Math.acos(i/a)),o.scaleX=s/a,o.scaleY=a,o.skewX=0,o.skewY=(t*i+e*r)/s}return o.rotateDeg=T_(o.rotateDeg),o}}function LY(n,t,e,i,r,s,o,a){const l=t.a,h=t.b,d=t.c,u=t.d,c=t.e,g=t.f,p=me(o),f=ee(o);let m,v;a?(m=a[0],v=a[1]):(m=e,v=i);const _=m-e,b=v-i,y=l*p+d*f,C=h*p+u*f,S=d*p-l*f,w=u*p-h*f;n.a=r*y,n.b=r*C,n.c=s*S,n.d=s*w,n.e=c+l*m+d*v-y*_-S*b,n.f=g+h*m+u*v-C*_-w*b}class IY{constructor(){this.CLEAN_THRESHOLD=1e3,this.L_TIME=1e3,this.R_COUNT=1,this.R_TIMESTAMP_MAX_SIZE=20}clearCache(t,e){const{CLEAN_THRESHOLD:i=this.CLEAN_THRESHOLD,L_TIME:r=this.L_TIME,R_COUNT:s=this.R_COUNT}=e;if(t.size<i)return 0;let o=0;const a=h=>{o++,t.delete(h)},l=Date.now();return t.forEach((h,d)=>{if(h.timestamp.length<s)return a(d);let u=0;for(;l-h.timestamp[h.timestamp.length-1-u]<r&&(u++,!(u>=s)););if(u<s)return a(d);for(;l-h.timestamp[0]>r;)h.timestamp.shift()}),o}addLimitedTimestamp(t,e,i){const{R_TIMESTAMP_MAX_SIZE:r=this.R_TIMESTAMP_MAX_SIZE}=i;t.timestamp.length>r&&t.timestamp.shift(),t.timestamp.push(e)}clearTimeStamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();t.forEach(s=>{for(;r-s.timestamp[0]>i;)s.timestamp.shift()})}clearItemTimestamp(t,e){const{L_TIME:i=this.L_TIME}=e,r=Date.now();for(;r-t.timestamp[0]>i;)t.timestamp.shift()}}function iS(n,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,r=i*(1-Math.abs(n/60%2-1)),s=e-i/2;let o=0,a=0,l=0;return 0<=n&&n<60?(o=i,a=r,l=0):60<=n&&n<120?(o=r,a=i,l=0):120<=n&&n<180?(o=0,a=i,l=r):180<=n&&n<240?(o=0,a=r,l=i):240<=n&&n<300?(o=r,a=0,l=i):300<=n&&n<360&&(o=i,a=0,l=r),o=Math.round(255*(o+s)),a=Math.round(255*(a+s)),l=Math.round(255*(l+s)),{r:o,g:a,b:l}}function ZA(n,t,e){n/=255,t/=255,e/=255;const i=Math.min(n,t,e),r=Math.max(n,t,e),s=r-i;let o=0,a=0,l=0;return o=s===0?0:r===n?(t-e)/s%6:r===t?(e-n)/s+2:(n-t)/s+4,o=Math.round(60*o),o<0&&(o+=360),l=(r+i)/2,a=s===0?0:s/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:o,s:a,l}}const Alt=/^#([0-9a-f]{3,8})$/,Tz={transparent:4294967040},mC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function qb(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function OY(n){return J(n)?new Cr(n>>16,n>>8&255,255&n,1):V(n)?new Cr(n[0],n[1],n[2]):new Cr(255,255,255)}function Mlt(n){return J(n)?new Cr(n>>>24,n>>>16&255,n>>>8&255,255&n):V(n)?new Cr(n[0],n[1],n[2],n[3]):new Cr(255,255,255,1)}function fk(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function mk(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const kz=(n,t)=>{const e=Alt.exec(n);if(t||e){const i=parseInt(e[1],16),r=e[1].length;return r===3?new Cr((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):r===6?OY(i):r===8?new Cr(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}};let Tn=class gu{static Brighter(t,e=1){return e===1?t:new gu(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new gu(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof gu?t:new gu(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3();case"wcag":return i.getLuminanceWCAG()}}static parseColorString(t){if(L(Tz[t]))return Mlt(Tz[t]);if(L(mC[t]))return OY(mC[t]);const e=`${t}`.trim().toLowerCase(),i=kz(e);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const r=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Cr(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const r=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),s=iS(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new Cr(s.r,s.g,s.b,parseFloat(r[3]))}}constructor(t){const e=gu.parseColorString(t);e?this.color=e:(console.warn(`Warn: ${t}Color`),this.color=new Cr(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,s=ZA(this.color.r,this.color.g,this.color.b),o=iS(D(t)?s.h:Ne(t,0,360),D(e)?s.s:e>=0&&e<=1?100*e:e,D(i)?s.l:i<=1&&i>=0?100*i:i);return this.color=new Cr(o.r,o.g,o.b,r),this}setRGB(t,e,i){return!D(t)&&(this.color.r=t),!D(e)&&(this.color.g=e),!D(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=kz(e,!0);return i??this}setColorName(t){const e=mC[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}getLuminanceWCAG(){const t=this.color.r/255,e=this.color.g/255,i=this.color.b/255;let r,s,o;return r=t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4),s=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),o=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),.2126*r+.7152*s+.0722*o}clone(){return new gu(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=fk(t.color.r),this.color.g=fk(t.color.g),this.color.b=fk(t.color.b),this}copyLinearToSRGB(t){return this.color.r=mk(t.color.r),this.color.g=mk(t.color.g),this.color.b=mk(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}},Cr=class{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),L(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${qb(this.r)+qb(this.g)+qb(this.b)+(this.opacity===1?"":qb(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=ZA(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${r}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}};function DY(n){let t="",e="",i="";const r=n[0]==="#"?1:0;for(let s=r;s<n.length;s++)n[s]!=="#"&&(s<r+2?t+=n[s]:s<r+4?e+=n[s]:s<r+6&&(i+=n[s]));return[parseInt(t,16),parseInt(e,16),parseInt(i,16)]}function Tlt(n,t,e){return Number((1<<24)+(n<<16)+(t<<8)+e).toString(16).slice(1)}function klt(n,t){const e=n.r,i=t.r,r=n.g,s=t.g,o=n.b,a=t.b,l=n.opacity,h=t.opacity;return d=>{const u=Math.round(e*(1-d)+i*d),c=Math.round(r*(1-d)+s*d),g=Math.round(o*(1-d)+a*d);return new Cr(u,c,g,l*(1-d)+h*d)}}const FY=Object.freeze(Object.defineProperty({__proto__:null,Color:Tn,DEFAULT_COLORS:mC,RGB:Cr,hexToRgb:DY,hslToRgb:iS,interpolateRgb:klt,rgbToHex:Tlt,rgbToHsl:ZA},Symbol.toStringTag,{value:"Module"}));function Fi(n){if(et(n))return[n,n,n,n];if(V(n)){const t=n.length;if(t===1){const e=n[0];return[e,e,e,e]}if(t===2){const[e,i]=n;return[e,i,e,i]}if(t===3){const[e,i,r]=n;return[e,i,r,i]}if(t===4)return n}if(kt(n)){const{top:t=0,right:e=0,bottom:i=0,left:r=0}=n;return[t,e,i,r]}return[0,0,0,0]}function AP(n,t=0,e=0){if(!n)return{width:t,height:e};let i;try{i=window==null?void 0:window.getComputedStyle}catch{i=()=>({})}const r=i(n);if(/^(\d*\.?\d+)(px)$/.exec(r.width)){const s=parseFloat(r.width)-parseFloat(r.paddingLeft)-parseFloat(r.paddingRight)||n.clientWidth-1,o=parseFloat(r.height)-parseFloat(r.paddingTop)-parseFloat(r.paddingBottom)||n.clientHeight-1;return{width:s<=0?t:s,height:o<=0?e:o}}return{width:t,height:e}}function Rlt(n){const{x:t,y:e}=n.getBoundingClientRect();return{x:t,y:e}}const Blt=(n="")=>{const t={};return n.split(";").forEach(e=>{if(e){const i=e.split(":");if(i.length===2){const r=i[0].trim(),s=i[1].trim();r&&s&&(t[r]=s)}}}),t},Rz=n=>n.replace(/([A-Z])/g,"-$1").toLowerCase();var Gr=63710088e-1,Plt={centimeters:Gr*100,centimetres:Gr*100,degrees:Gr/111325,feet:Gr*3.28084,inches:Gr*39.37,kilometers:Gr/1e3,kilometres:Gr/1e3,meters:Gr,metres:Gr,miles:Gr/1609.344,millimeters:Gr*1e3,millimetres:Gr*1e3,nauticalmiles:Gr/1852,radians:1,yards:Gr*1.0936};function Bz(n,t,e){e===void 0&&(e={});var i={type:"Feature"};return(e.id===0||e.id)&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.properties=t||{},i.geometry=n,i}function HY(n,t){t===void 0&&(t={});var e={type:"FeatureCollection"};return t.id&&(e.id=t.id),t.bbox&&(e.bbox=t.bbox),e.features=n,e}function Elt(n,t){t===void 0&&(t="kilometers");var e=Plt[t];if(!e)throw new Error(t+" units is invalid");return n/e}function Llt(n){return!!n&&n.constructor===Object}function Ilt(n){return n.type==="Feature"?n.geometry:n}function Olt(n,t){if(!n||!t)return!1;const e=Ilt(t),i=e.type,r=t.bbox;let s=e.coordinates;if(r&&vp(n,{x1:r[0],x2:r[1],y1:r[1],y2:r[3]},!0)===!0)return!1;i==="Polygon"&&(s=[s]);let o=!1;for(let a=0;a<s.length;++a)for(let l=0;l<s[a].length;++l)if(wO(s[a][l].map(h=>({x:h[0],y:h[1]})),n.x,n.y))return o=!0,o;return o}function Dlt(n,t,e,i={}){const r=Te(n[0]),s=Te(n[1]),o=Te(e),a=Elt(t,i.units),l=Math.asin(Math.sin(s)*Math.cos(a)+Math.cos(s)*Math.sin(a)*Math.cos(o)),h=r+Math.atan2(Math.sin(o)*Math.sin(a)*Math.cos(s),Math.cos(a)-Math.sin(s)*Math.sin(l));return{x:T_(h),y:T_(l)}}class Xo{static getInstance(){return Xo.instance||(Xo.instance=new Xo),Xo.instance}constructor(){this.locale_shortWeekdays=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.locale_periods=["AM","PM"],this.locale_weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],this.locale_shortMonths=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.numberRe=/^\s*\d+/,this.pads={"-":"",_:" ",0:"0"},this.requoteRe=/[\\^$*+?|[\]().{}]/g,this.locale_months=["January","February","March","April","May","June","July","August","September","October","November","December"],this.formatShortWeekday=t=>this.locale_shortWeekdays[t.getDay()],this.formatWeekday=t=>this.locale_weekdays[t.getDay()],this.formatShortMonth=t=>this.locale_shortMonths[t.getMonth()],this.formatMonth=t=>this.locale_months[t.getMonth()],this.formatDayOfMonth=(t,e)=>this.pad(t.getDate(),e,2),this.formatHour24=(t,e)=>this.pad(t.getHours(),e,2),this.formatHour12=(t,e)=>this.pad(t.getHours()%12||12,e,2),this.formatMilliseconds=(t,e)=>this.pad(t.getMilliseconds(),e,3),this.formatMonthNumber=(t,e)=>this.pad(t.getMonth()+1,e,2),this.formatMinutes=(t,e)=>this.pad(t.getMinutes(),e,2),this.formatPeriod=t=>this.locale_periods[+(t.getHours()>=12)],this.formatSeconds=(t,e)=>this.pad(t.getSeconds(),e,2),this.formatFullYear=(t,e)=>this.pad(t.getFullYear()%1e4,e,4),this.formatUTCShortWeekday=t=>this.locale_shortWeekdays[t.getUTCDay()],this.formatUTCWeekday=t=>this.locale_weekdays[t.getUTCDay()],this.formatUTCShortMonth=t=>this.locale_shortMonths[t.getUTCMonth()],this.formatUTCMonth=t=>this.locale_months[t.getUTCMonth()],this.formatUTCDayOfMonth=(t,e)=>this.pad(t.getUTCDate(),e,2),this.formatUTCHour24=(t,e)=>this.pad(t.getUTCHours(),e,2),this.formatUTCHour12=(t,e)=>this.pad(t.getUTCHours()%12||12,e,2),this.formatUTCMilliseconds=(t,e)=>this.pad(t.getUTCMilliseconds(),e,3),this.formatUTCMonthNumber=(t,e)=>this.pad(t.getUTCMonth()+1,e,2),this.formatUTCMinutes=(t,e)=>this.pad(t.getUTCMinutes(),e,2),this.formatUTCPeriod=t=>this.locale_periods[+(t.getUTCHours()>=12)],this.formatUTCSeconds=(t,e)=>this.pad(t.getUTCSeconds(),e,2),this.formatUTCFullYear=(t,e)=>this.pad(t.getUTCFullYear()%1e4,e,4),this.formats={a:this.formatShortWeekday,A:this.formatWeekday,b:this.formatShortMonth,B:this.formatMonth,d:this.formatDayOfMonth,e:this.formatDayOfMonth,H:this.formatHour24,I:this.formatHour12,L:this.formatMilliseconds,m:this.formatMonthNumber,M:this.formatMinutes,p:this.formatPeriod,S:this.formatSeconds,Y:this.formatFullYear},this.utcFormats={a:this.formatUTCShortWeekday,A:this.formatUTCWeekday,b:this.formatUTCShortMonth,B:this.formatUTCMonth,d:this.formatUTCDayOfMonth,e:this.formatUTCDayOfMonth,H:this.formatUTCHour24,I:this.formatUTCHour12,L:this.formatUTCMilliseconds,m:this.formatUTCMonthNumber,M:this.formatUTCMinutes,p:this.formatUTCPeriod,S:this.formatUTCSeconds,Y:this.formatUTCFullYear},this.parseShortWeekday=(t,e,i)=>{const r=this.shortWeekdayRe.exec(e.slice(i));return r?(t.w=this.shortWeekdayLookup.get(r[0].toLowerCase()),i+r[0].length):-1},this.parseWeekday=(t,e,i)=>{const r=this.weekdayRe.exec(e.slice(i));return r?(t.w=this.weekdayLookup.get(r[0].toLowerCase()),i+r[0].length):-1},this.parseShortMonth=(t,e,i)=>{const r=this.shortMonthRe.exec(e.slice(i));return r?(t.m=this.shortMonthLookup.get(r[0].toLowerCase()),i+r[0].length):-1},this.parseMonth=(t,e,i)=>{const r=this.monthRe.exec(e.slice(i));return r?(t.m=this.monthLookup.get(r[0].toLowerCase()),i+r[0].length):-1},this.parseDayOfMonth=(t,e,i)=>{const r=this.numberRe.exec(e.slice(i,i+2));return r?(t.d=+r[0],i+r[0].length):-1},this.parseHour24=(t,e,i)=>{const r=this.numberRe.exec(e.slice(i,i+2));return r?(t.H=+r[0],i+r[0].length):-1},this.parseMilliseconds=(t,e,i)=>{const r=this.numberRe.exec(e.slice(i,i+3));return r?(t.L=+r[0],i+r[0].length):-1},this.parseMonthNumber=(t,e,i)=>{const r=this.numberRe.exec(e.slice(i,i+2));return r?(t.m=r-1,i+r[0].length):-1},this.parseMinutes=(t,e,i)=>{const r=this.numberRe.exec(e.slice(i,i+2));return r?(t.M=+r[0],i+r[0].length):-1},this.parsePeriod=(t,e,i)=>{const r=this.periodRe.exec(e.slice(i));return r?(t.p=this.periodLookup.get(r[0].toLowerCase()),i+r[0].length):-1},this.parseSeconds=(t,e,i)=>{const r=this.numberRe.exec(e.slice(i,i+2));return r?(t.S=+r[0],i+r[0].length):-1},this.parseFullYear=(t,e,i)=>{const r=this.numberRe.exec(e.slice(i,i+4));return r?(t.y=+r[0],i+r[0].length):-1},this.parses={a:this.parseShortWeekday,A:this.parseWeekday,b:this.parseShortMonth,B:this.parseMonth,d:this.parseDayOfMonth,e:this.parseDayOfMonth,H:this.parseHour24,I:this.parseHour24,L:this.parseMilliseconds,m:this.parseMonthNumber,M:this.parseMinutes,p:this.parsePeriod,S:this.parseSeconds,Y:this.parseFullYear},this.timeFormat=(t,e)=>this.newFormat(t,this.formats)(new Date(this.getFullTimeStamp(e))),this.timeUTCFormat=(t,e)=>this.newFormat(t,this.utcFormats)(new Date(this.getFullTimeStamp(e))),this.timeParse=(t,e)=>this.newParse(t,!1)(e+""),this.requoteF=this.requote.bind(this),this.periodRe=this.formatRe(this.locale_periods),this.periodLookup=this.formatLookup(this.locale_periods),this.weekdayRe=this.formatRe(this.locale_weekdays),this.weekdayLookup=this.formatLookup(this.locale_weekdays),this.shortWeekdayRe=this.formatRe(this.locale_shortWeekdays),this.shortWeekdayLookup=this.formatLookup(this.locale_shortWeekdays),this.monthRe=this.formatRe(this.locale_months),this.monthLookup=this.formatLookup(this.locale_months),this.shortMonthRe=this.formatRe(this.locale_shortMonths),this.shortMonthLookup=this.formatLookup(this.locale_shortMonths)}requote(t){return t.replace(this.requoteRe,"\\$&")}localDate(t){if(0<=t.y&&t.y<100){const e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}utcDate(t){if(0<=t.y&&t.y<100){const e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}newDate(t,e,i){return{y:t,m:e,d:i,H:0,M:0,S:0,L:0}}formatRe(t){return new RegExp("^(?:"+t.map(this.requoteF).join("|")+")","i")}formatLookup(t){return new Map(t.map((e,i)=>[e.toLowerCase(),i]))}pad(t,e,i){const r=t<0?"-":"",s=(r?-t:t)+"",o=s.length;return r+(o<i?new Array(i-o+1).join(e)+s:s)}parseSpecifier(t,e,i,r){let s=0;const o=e.length,a=i.length;let l,h;for(;s<o;){if(r>=a)return-1;if(l=e.charCodeAt(s++),l===37){if(l=e.charAt(s++),h=this.parses[l in this.pads?e.charAt(s++):l],!h||(r=h(t,i,r))<0)return-1}else if(l!==i.charCodeAt(r++))return-1}return r}newParse(t,e){const i=this;return function(r){const s=i.newDate(1900,void 0,1);return i.parseSpecifier(s,t,r+="",0)!==r.length?null:"Q"in s?new Date(s.Q):"s"in s?new Date(1e3*s.s+("L"in s?s.L:0)):(e&&!("Z"in s)&&(s.Z=0),"p"in s&&(s.H=s.H%12+12*s.p),s.m===void 0&&(s.m="q"in s?s.q:0),"Z"in s?(s.H+=s.Z/100|0,s.M+=s.Z%100,i.utcDate(s)):i.localDate(s))}}newFormat(t,e){const i=this;return function(r){const s=[];let o=-1,a=0;const l=t.length;let h,d,u;for(r instanceof Date||(r=new Date(+r));++o<l;)t.charCodeAt(o)===37&&(s.push(t.slice(a,o)),(d=i.pads[h=t.charAt(++o)])?h=t.charAt(++o):d=h==="e"?" ":"0",u=e[h],h=u(r,d),s.push(h),a=o+1);return s.push(t.slice(a,o)),s.join("")}}getFullTimeStamp(t){const e=parseInt(t+"",10);return String(e).length===10?1e3*e:e}}function Flt(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function nS(n,t){const e=t?n.toExponential(t-1):n.toExponential(),i=e.indexOf("e");if(i<0)return null;const r=e.slice(0,i);return[r.length>1?r[0]+r.slice(2):r,+e.slice(i+1)]}function Hlt(n,t){return function(e,i){let r=e.length;const s=[];let o=0,a=n[0],l=0;for(;r>0&&a>0&&(l+a+1>i&&(a=Math.max(1,i-l)),s.push(e.substring(r-=a,r+a)),!((l+=a+1)>i));)a=n[o=(o+1)%n.length];return s.reverse().join(t)}}let zY;function zlt(n,t){const e=nS(n,t);if(!e)return n+"";const i=e[0],r=e[1],s=r-(zY=3*Math.max(-8,Math.min(8,Math.floor(r/3))))+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+nS(n,Math.max(0,t+s-1))[0]}function Pz(n,t){const e=nS(n,t);if(!e)return n+"";const i=e[0],r=e[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}function Wlt(n){const t=n.length;let e,i=-1;t:for(let r=1;r<t;++r)switch(n[r]){case".":i=e=r;break;case"0":i===0&&(i=r),e=r;break;default:if(!+n[r])break t;i>0&&(i=0)}return i>0?n.slice(0,i)+n.slice(e+1):n}class jlt{constructor(t={}){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}toString(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,0|this.width))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type}}const WY=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ez(n){let t;if(t=WY.exec(n))return new jlt({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]});ge.getInstance().error("invalid format: "+n)}const Lz=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];class Pu{constructor(){this.locale={thousands:",",grouping:[3],currency:["$",""]},this.group=this.locale.grouping===void 0||this.locale.thousands===void 0?t=>t:Hlt([...this.locale.grouping].map(Number),`${this.locale.thousands}`),this.currencyPrefix=this.locale.currency===void 0?"":this.locale.currency[0]+"",this.currencySuffix=this.locale.currency===void 0?"":this.locale.currency[1]+"",this.decimal=this.locale.decimal===void 0?".":this.locale.decimal+"",this.numerals=this.locale.numerals===void 0?t=>t:$lt([...this.locale.numerals].map(String)),this.percent=this.locale.percent===void 0?"%":this.locale.percent+"",this.minus=this.locale.minus===void 0?"":this.locale.minus+"",this.nan=this.locale.nan===void 0?"NaN":this.locale.nan+"",this.formatter=t=>this.newFormat(t),this.format=(t,e)=>this.formatter(t)(e),this.formatPrefix=(t,e)=>this._formatPrefix(t,e)}static getInstance(){return Pu.instance||(Pu.instance=new Pu),Pu.instance}newFormat(t){const e=Ez(t);let i=e.fill,r=e.align;const s=e.sign,o=e.symbol;let a=e.zero;const l=e.width;let h=e.comma,d=e.precision,u=e.trim,c=e.type;c==="n"?(h=!0,c="g"):Iz[c]||(d===void 0&&(d=12),u=!0,c="g"),(a||i==="0"&&r==="=")&&(a=!0,i="0",r="=");const g=o==="$"?this.currencyPrefix:o==="#"&&/[boxX]/.test(c)?"0"+c.toLowerCase():"",p=o==="$"?this.currencySuffix:/[%p]/.test(c)?this.percent:"",f=Iz[c],m=/[defgprstz%]/.test(c);d=d===void 0?6:/[gprs]/.test(c)?Math.max(1,Math.min(21,d)):Math.max(0,Math.min(20,d));const{nan:v,minus:_,decimal:b,group:y,numerals:C}=this;function S(w){let x,A,M,T=g,R=p,B=w;if(c==="c")R=f(B)+R,B="";else{B=+B;let P=B<0||1/B<0;if(B=isNaN(B)?v:f(Math.abs(B),d),u&&(B=Wlt(B)),P&&+B==0&&s!=="+"&&(P=!1),T=(P?s==="("?s:_:s==="-"||s==="("?"":s)+T,R=(c==="s"?Lz[8+zY/3]:"")+R+(P&&s==="("?")":""),m){for(x=-1,A=B.length;++x<A;)if(M=B.charCodeAt(x),48>M||M>57){R=(M===46?b+B.slice(x+1):B.slice(x))+R,B=B.slice(0,x);break}}}h&&!a&&(B=y(B,1/0));let E=T.length+B.length+R.length,k=E<l?new Array(l-E+1).join(i):"";switch(h&&a&&(B=y(k+B,k.length?l-R.length:1/0),k=""),r){case"<":B=T+B+R+k;break;case"=":B=T+k+B+R;break;case"^":B=k.slice(0,E=k.length>>1)+T+B+R+k.slice(E);break;default:B=k+T+B+R}return C(B)}return S.toString=function(){return t+""},S}_formatPrefix(t,e){const i=Ez(t);i.type="f";const r=this.newFormat(i.toString()),s=3*Math.max(-8,Math.min(8,Math.floor(Nlt(e)/3))),o=Math.pow(10,-s),a=Lz[8+s/3];return function(l){return r(o*l)+a}}}const Iz={"%":(n,t)=>(100*n).toFixed(t),b:n=>Math.round(n).toString(2),c:n=>n+"",d:Flt,f:(n,t)=>n.toFixed(t),e:(n,t)=>n.toExponential(t),g:(n,t)=>n.toPrecision(t),o:n=>Math.round(n).toString(8),p:(n,t)=>Pz(100*n,t),r:Pz,s:zlt,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16),t:(n,t)=>Number.isInteger(n)?n.toFixed(2):Math.floor(n*Math.pow(10,t))/Math.pow(10,t)+"",z:(n,t)=>n%1==0?n+"":n.toFixed(t)};function Nlt(n){const t=nS(Math.abs(n));return t?t[1]:NaN}function $lt(n){return function(t){return t.replace(/[0-9]/g,e=>n[+e])}}const Vlt=Ci-1e-8;let AO=class{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,r,s,o){if(Math.abs(s-r)>Vlt)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let a,l,h,d,u=1/0,c=-1/0,g=1/0,p=-1/0;function f(m){h=i*Math.cos(m),d=i*Math.sin(m),h<u&&(u=h),h>c&&(c=h),d<g&&(g=d),d>p&&(p=d)}if(f(r),f(s),s!==r)if((r%=Ci)<0&&(r+=Ci),(s%=Ci)<0&&(s+=Ci),s<r&&(o=!o,a=r,r=s,s=a),o)for(s-=Ci,a=r-r%An,l=0;l<4&&a>s;++l,a-=An)f(a);else for(a=r-r%An+An,l=0;l<4&&a<s;++l,a+=An)f(a);this.bounds.add(t+u,e+g),this.bounds.add(t+c,e+p)}arcTo(t,e,i,r,s){this.bounds.add(t,e)}bezierCurveTo(t,e,i,r,s,o){this.bounds.add(t,e),this.bounds.add(i,r),this.bounds.add(s,o)}closePath(){}ellipse(){throw new Error("ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,r){this.bounds.add(t,e),this.bounds.add(i,r)}rect(t,e,i,r){this.bounds.add(t,e),this.bounds.add(t+i,e+r)}clear(){this.bounds.clear()}release(...t){}},Glt=class{constructor(){this._curves=[],this.bounds=new ie}get curves(){return this._curves}getCurveLengths(){return this._curves.map(t=>t.getLength())}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}};const Ult=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,Ylt={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},ei={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let vk,Oz,Zb,Dz,_k,Jb;function Xlt(n){if(!n)return[];const t=n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(t===null)return[];let e,i;const r=[];for(let s=0,o=t.length;s<o;s++)if(vk=t[s],Oz=vk.slice(1),Zb=vk[0],e=[Zb],i=Oz.match(Ult),i!==null){for(let a=0,l=i.length;a<l;a++)Dz=i[a],_k=parseFloat(Dz),Number.isNaN(_k)||e.push(_k);if(Jb=Ylt[Zb],e.length-1>Jb){let a,l=Zb;for(let h=1,d=e.length;h<d;h+=Jb){a=[l];for(let u=h,c=h+Jb;u<c;u++)a.push(e[u]);r.push(a),l==="m"?l="l":l==="M"&&(l="L")}}else r.push(e)}else r.push(e);return r}var pi;(function(n){n[n.NONE=0]="NONE",n[n.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",n[n.UPDATE_SHAPE=2]="UPDATE_SHAPE",n[n.CLEAR_SHAPE=253]="CLEAR_SHAPE",n[n.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",n[n.INIT=179]="INIT",n[n.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",n[n.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",n[n.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",n[n.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",n[n.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",n[n.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",n[n.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",n[n.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(pi||(pi={}));var R_;(function(n){n[n.GLOBAL=1]="GLOBAL",n[n.LOCAL=16]="LOCAL",n[n.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",n[n.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"})(R_||(R_={}));var Yr;(function(n){n[n.INIT=0]="INIT",n[n.DEFAULT=1]="DEFAULT",n[n.STATE=2]="STATE",n[n.ANIMATE_BIND=10]="ANIMATE_BIND",n[n.ANIMATE_PLAY=11]="ANIMATE_PLAY",n[n.ANIMATE_START=12]="ANIMATE_START",n[n.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",n[n.ANIMATE_END=14]="ANIMATE_END",n[n.TRANSLATE=20]="TRANSLATE",n[n.TRANSLATE_TO=21]="TRANSLATE_TO",n[n.SCALE=22]="SCALE",n[n.SCALE_TO=23]="SCALE_TO",n[n.ROTATE=24]="ROTATE",n[n.ROTATE_TO=25]="ROTATE_TO"})(Yr||(Yr={}));var gr;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSED=2]="PAUSED",n[n.END=3]="END"})(gr||(gr={}));var rS;(function(n){n[n.NORMAL=0]="NORMAL",n[n.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"})(rS||(rS={}));var Fg;(function(n){n.wait="wait",n.from="from",n.to="to",n.customAnimate="customAnimate"})(Fg||(Fg={}));var ai;(function(n){n[n.ROW=1]="ROW",n[n.COLUMN=2]="COLUMN"})(ai||(ai={}));var B_;(function(n){n[n.CubicBezierCurve=0]="CubicBezierCurve",n[n.QuadraticBezierCurve=1]="QuadraticBezierCurve",n[n.ArcCurve=2]="ArcCurve",n[n.LineCurve=3]="LineCurve",n[n.EllipseCurve=4]="EllipseCurve",n[n.MoveCurve=5]="MoveCurve"})(B_||(B_={}));var Ze;(function(n){n[n.beforeFillStroke=0]="beforeFillStroke",n[n.afterFillStroke=1]="afterFillStroke"})(Ze||(Ze={}));function Klt(n,t,e,i,r,s,o,a,l){const h=Te(o),d=Math.sin(h),u=Math.cos(h),c=u*(a-n)*.5+d*(l-t)*.5,g=u*(l-t)*.5-d*(a-n)*.5;let p=c*c/((e=Math.abs(e))*e)+g*g/((i=Math.abs(i))*i);p>1&&(p=Math.sqrt(p),e*=p,i*=p);const f=u/e,m=d/e,v=-d/i,_=u/i,b=f*a+m*l,y=v*a+_*l,C=f*n+m*t,S=v*n+_*t;let w=1/((C-b)*(C-b)+(S-y)*(S-y))-.25;w<0&&(w=0);let x=Math.sqrt(w);s===r&&(x=-x);const A=.5*(b+C)-x*(S-y),M=.5*(y+S)+x*(C-b),T=Math.atan2(y-M,b-A);let R=Math.atan2(S-M,C-A)-T;R<0&&s===1?R+=Ci:R>0&&s===0&&(R-=Ci);const B=Math.ceil(Math.abs(R/(An+.001))),E=[];for(let k=0;k<B;++k){const P=T+k*R/B,I=T+(k+1)*R/B;E[k]=[A,M,P,I,e,i,d,u]}return E}function qlt(n){const t=n[0],e=n[1],i=n[2],r=n[3],s=n[4],o=n[5],a=n[6],l=n[7],h=l*s,d=-a*o,u=a*s,c=l*o,g=Math.cos(i),p=Math.sin(i),f=Math.cos(r),m=Math.sin(r),v=.5*(r-i),_=Math.sin(.5*v),b=8/3*_*_/Math.sin(v),y=t+g-b*p,C=e+p+b*g,S=t+f,w=e+m,x=S+b*m,A=w-b*f;return[h*y+d*C,u*y+c*C,h*x+d*A,u*x+c*A,h*S+d*w,u*S+c*w]}function Fz(n,t,e,i){const r=Klt(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,e);for(let s=0;s<r.length;++s){const o=qlt(r[s]);n.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const Zlt=(n,t,e,i,r,s,o)=>{const a=Math.abs(e-t),l=a>.5*Math.PI?Math.ceil(2*a/Math.PI):1,h=(e-t)/l;for(let d=0;d<l;d++){const u=t+h*d,c=t+h*(d+1),g=4*Math.tan(Math.abs(h)/4)/3,p=c<u?-1:1,f=Math.cos(u),m=Math.sin(u),v=Math.cos(c),_=Math.sin(c),b=f*s+i,y=m*o+r,C=v*s+i,S=_*o+r,w=s*g*p,x=o*g*p;n.push(b-w*m,y+x*f,C+w*_,S-x*v,C,S)}},Jlt=[(n,t,e,i,r,s,o)=>t.arc(n[1]*r+e,n[2]*s+i,n[3]*(r+s)/2,n[4],n[5],n[6],o),(n,t,e,i,r,s,o)=>t.arcTo(n[1]*r+e,n[2]*s+i,n[3]*r+e,n[4]*s+i,n[5]*(r+s)/2,o),(n,t,e,i,r,s,o)=>t.bezierCurveTo(n[1]*r+e,n[2]*s+i,n[3]*r+e,n[4]*s+i,n[5]*r+e,n[6]*s+i,o),(n,t,e,i)=>t.closePath(),(n,t,e,i,r,s)=>t.ellipse(n[1]*r+e,n[2]*s+i,n[3]*r,n[4]*s,n[5],n[6],n[7],n[8]),(n,t,e,i,r,s,o)=>t.lineTo(n[1]*r+e,n[2]*s+i,o),(n,t,e,i,r,s,o)=>t.moveTo(n[1]*r+e,n[2]*s+i,o),(n,t,e,i,r,s,o)=>t.quadraticCurveTo(n[1]*r+e,n[2]*s+i,n[3]*r+e,n[4]*s+i,o),(n,t,e,i,r,s,o)=>t.rect(n[1]*r+e,n[2]*s+i,n[3]*r,n[4]*s,o)];function Ql(n,t,e=0,i=0,r=1,s=1,o){for(let a=0;a<n.length;a++){const l=n[a];Jlt[l[0]](l,t,e,i,r,s,o)}}let MO=class{getLength(t){return t!=null?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}};function jY(n,t){let e=0;const i=n.length;for(let r=0;r<i;r++){const s=n[r],o=t[r],a=n[(r+1)%i],l=t[(r+1)%i];e+=hi.distanceNN(s,o,a,l)}return e/2}function Qlt(n,t,e,i,r){return jY([n.x,t.x,e.x,i.x],[n.y,t.y,e.y,i.y])}function Hz(n,t,e,i,r){const s=1-r;return s*s*s*n+3*t*r*s*s+3*e*r*r*s+i*r*r*r}function NY(n,t,e,i,r){const s=Hz(n.x,t.x,e.x,i.x,r),o=Hz(n.y,t.y,e.y,i.y,r);return new Yt(s,o)}function zz(n,t,e,i){const r=1-i;return r*r*n+2*r*i*t+i*i*e}function $Y(n,t,e,i){const r=zz(n.x,t.x,e.x,i),s=zz(n.y,t.y,e.y,i);return new Yt(r,s)}function tht(n,t,e,i){return jY([n.x,t.x,e.x],[n.y,t.y,e.y])}let MP=class extends MO{constructor(t,e,i){super(),this.type=B_.QuadraticBezierCurve,this.p0=t,this.p1=e,this.p2=i}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(t){if(this.defined!==!1)return $Y(this.p0,this.p1,this.p2,t);throw new Error("definedfalsegetPointAt")}calcLength(){return this._validPoint()?tht(this.p0,this.p1,this.p2):60}calcProjLength(t){return t===ai.ROW?Et(this.p0.x-this.p2.x):t===ai.COLUMN?Et(this.p0.y-this.p2.y):0}getAngleAt(t){const e=ti(t-.01,0),i=we(t+.01,1),r=this.getPointAt(e),s=this.getPointAt(i);return zt(s.y-r.y,s.x-r.x)}draw(t,e,i,r,s,o){if(t.moveTo(this.p0.x*r+e,this.p0.y*s+i),o>=1)t.quadraticCurveTo(this.p1.x*r+e,this.p1.y*s+i,this.p2.x*r+e,this.p2.y*s+i);else if(o>0){const[a]=eht(this,o);t.quadraticCurveTo(a.p1.x*r+e,a.p1.y*s+i,a.p2.x*r+e,a.p2.y*s+i)}}getYAt(t){throw new Error("QuadraticBezierCurvegetYAt")}includeX(t){throw new Error("QuadraticBezierCurveincludeX")}};function sS(n,t){const{p0:e,p1:i,p2:r,p3:s}=n,o=NY(e,i,r,s,t),a=hi.pointAtPP(e,i,t),l=hi.pointAtPP(i,r,t),h=hi.pointAtPP(r,s,t),d=hi.pointAtPP(a,l,t),u=hi.pointAtPP(l,h,t);return[new oS(e,a,d,o),new oS(o,u,h,s)]}function eht(n,t){const{p0:e,p1:i,p2:r}=n,s=$Y(e,i,r,t),o=hi.pointAtPP(e,i,t),a=hi.pointAtPP(i,r,t);return[new MP(e,o,s),new MP(s,a,r)]}let oS=class extends MO{constructor(t,e,i,r){super(),this.type=B_.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(this.defined!==!1)return NY(this.p0,this.p1,this.p2,this.p3,t);throw new Error("definedfalsegetPointAt")}calcLength(){return this._validPoint()?Qlt(this.p0,this.p1,this.p2,this.p3):60}calcProjLength(t){return t===ai.ROW?Et(this.p0.x-this.p3.x):t===ai.COLUMN?Et(this.p0.y-this.p3.y):0}getAngleAt(t){const e=ti(t-.01,0),i=we(t+.01,1),r=this.getPointAt(e),s=this.getPointAt(i);return zt(s.y-r.y,s.x-r.x)}draw(t,e,i,r,s,o){if(t.moveTo(this.p0.x*r+e,this.p0.y*s+i),o>=1)t.bezierCurveTo(this.p1.x*r+e,this.p1.y*s+i,this.p2.x*r+e,this.p2.y*s+i,this.p3.x*r+e,this.p3.y*s+i);else if(o>0){const[a]=sS(this,o);t.bezierCurveTo(a.p1.x*r+e,a.p1.y*s+i,a.p2.x*r+e,a.p2.y*s+i,a.p3.x*r+e,a.p3.y*s+i)}}includeX(t){const e=we(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=ti(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return t>=e&&t<=i}getYAt(t){const e=we(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=(t-e)/(ti(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-e);return this.getPointAt(i).y}};function Wz(n,t){const{p0:e,p1:i}=n,r=hi.pointAtPP(e,i,t);return[new aS(e,r),new aS(r,i)]}let aS=class extends MO{constructor(t,e){super(),this.type=B_.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(this.defined!==!1)return hi.pointAtPP(this.p0,this.p1,t);throw new Error("definedfalsegetPointAt")}getAngleAt(t){return this.angle==null&&(this.angle=zt(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?hi.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===ai.ROW?Et(this.p0.x-this.p1.x):t===ai.COLUMN?Et(this.p0.y-this.p1.y):0}draw(t,e,i,r,s,o){if(t.moveTo(this.p0.x*r+e,this.p0.y*s+i),o>=1)t.lineTo(this.p1.x*r+e,this.p1.y*s+i);else if(o>0){const a=this.getPointAt(o);t.lineTo(a.x*r+e,a.y*s+i)}}includeX(t){return t>=this.p0.x&&t<=this.p1.x||t>=this.p1.x&&t<=this.p0.x}getYAt(t){if(this.includeX(t)){let e=this.p0,i=this.p1;this.p0.x>this.p1.x&&(e=this.p1,i=this.p0);const r=(t-e.x)/(i.x-e.x);return e.y+r*(i.y-e.y)}return 1/0}},JA=class{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,r,s,o,a,l){const h=new oS(new Yt(this._lastX,this._lastY),new Yt(t,e),new Yt(i,r),new Yt(s,o));h.originP1=this._lastOriginP,h.originP2=l,h.defined=a,this.curves.push(h),this._lastX=s,this._lastY=o,this._lastOriginP=l}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContextellipse")}lineTo(t,e,i,r){const s=this.addLinearCurve(t,e,i,this._lastOriginP,r);this.curves.push(s),this._lastX=t,this._lastY=e,this._lastOriginP=r}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,r){throw new Error("SegContextquadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,r,s){const o=new aS(new Yt(this._lastX,this._lastY),new Yt(t,e));return o.originP1=r,o.originP2=s,o.defined=i,o}getPointAt(t){throw new Error("")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===ai.COLUMN){if(!this.curves.length)return 0;const r=this.curves[0],s=this.curves[this.curves.length-1],o=(e=s.p3)!==null&&e!==void 0?e:s.p1;return Et(r.p0.y-o.y)}if(t===ai.ROW){if(!this.curves.length)return 0;const r=this.curves[0],s=this.curves[this.curves.length-1],o=(i=s.p3)!==null&&i!==void 0?i:s.p1;return Et(r.p0.x-o.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce((r,s)=>r+s.getLength(),0)),this.length}},iht=class extends JA{bezierCurveTo(t,e,i,r,s,o,a,l){return super.bezierCurveTo(e,t,r,i,o,s,a,l)}lineTo(t,e,i,r){return super.lineTo(e,t,i,r)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}};function Uc(n,t,e=1){let i=!1;for(let r=0,s=t.length;r<=s;r++)r>=s===i&&((i=!i)?n.lineStart():n.lineEnd()),i&&n.point(t[r])}function If(n,t,e){const i=t??(Et(e[e.length-1].x-e[0].x)>Et(e[e.length-1].y-e[0].y)?ai.ROW:ai.COLUMN);return n==="monotoneY"?new iht(n,i):new JA(n,i)}let VY=class{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}};function q0(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=If("linear",e,n);return nht(new VY(r,i),n),r}function nht(n,t){return Uc(n,t,1)}function jz(n,t,e,i,r){n.context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+t)/6,(n._y0+4*n._y1+e)/6,i,n.lastPoint1)}let rht=class{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&jz(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:jz(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}};function sht(n,t){return Uc(n,t,2)}function oht(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return q0(n,t);const r=If("basis",e,n);return sht(new rht(r,i),n),r}function Nz(n){return n<0?-1:1}function $z(n,t,e){const i=n._x1-n._x0,r=t-n._x1,s=(n._y1-n._y0)/(i||Number(r<0&&-0)),o=(e-n._y1)/(r||Number(i<0&&-0)),a=(s*r+o*i)/(i+r);return(Nz(s)+Nz(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function Vz(n,t){const e=n._x1-n._x0;return e?(3*(n._y1-n._y0)/e-t)/2:t}function bk(n,t,e,i,r){const s=n._x0,o=n._y0,a=n._x1,l=n._y1,h=(a-s)/3;n.context.bezierCurveTo(s+h,o+h*t,a-h,l-h*e,a,l,i,n.lastPoint1)}let GY=class{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:bk(this,this._t0,Vz(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,r=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,r,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(i,r,t);break;case 1:this._point=2;break;case 2:this._point=3,bk(this,Vz(this,e=$z(this,i,r)),e,this._lastDefined1!==!1&&this._lastDefined2!==!1);break;default:bk(this,this._t0,e=$z(this,i,r),this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=r,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}},aht=class extends GY{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}};function lht(n,t){return Uc(n,t,2)}function hht(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return q0(n,t);const r=If("monotoneX",e,n);return lht(new GY(r,i),n),r}function dht(n,t){return Uc(n,t,2)}function uht(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return q0(n,t);const r=If("monotoneY",e,n);return dht(new aht(r,i),n),r}let UY=class{constructor(t,e=.5,i){this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t);else{const r=this._x*(1-this._t)+e*this._t;this._t===.5?this.context.lineTo(r,this._y,this._lastDefined!==!1,this.lastPoint):this.context.lineTo(r,this._y,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(r,i,this._lastDefined!==!1&&t.defined!==!1,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}},cht=class extends UY{lineEnd(){this.context.closePath()}};function yk(n,t,e={}){const{direction:i,startPoint:r}=e;if(n.length<2-+!!r)return null;const s=new JA("step",i??(Et(n[n.length-1].x-n[0].x)>Et(n[n.length-1].y-n[0].y)?ai.ROW:ai.COLUMN));return YY(new UY(s,t,r),n),s}function YY(n,t){return Uc(n,t,1)}function ght(n,t,e={}){const{direction:i,startPoint:r}=e;if(n.length<2-+!!r)return null;const s=new JA("step",i??(Et(n[n.length-1].x-n[0].x)>Et(n[n.length-1].y-n[0].y)?ai.ROW:ai.COLUMN));return YY(new cht(s,t,r),n),s}let pht=class extends VY{lineEnd(){this.context.closePath()}};function fht(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=If("linear",e,n);return mht(new pht(r,i),n),r}function mht(n,t){return Uc(n,t,1)}function XY(n,t,e,i,r){let s=n._x1,o=n._y1,a=n._x2,l=n._y2;if(n._l01_a>$t){const h=2*n._l01_2a+3*n._l01_a*n._l12_a+n._l12_2a,d=3*n._l01_a*(n._l01_a+n._l12_a);s=(s*h-n._x0*n._l12_2a+n._x2*n._l01_2a)/d,o=(o*h-n._y0*n._l12_2a+n._y2*n._l01_2a)/d}if(n._l23_a>$t){const h=2*n._l23_2a+3*n._l23_a*n._l12_a+n._l12_2a,d=3*n._l23_a*(n._l23_a+n._l12_a);a=(a*h+n._x1*n._l23_2a-t*n._l12_2a)/d,l=(l*h+n._y1*n._l23_2a-e*n._l12_2a)/d}n.context.bezierCurveTo(s,o,a,l,n._x2,n._y2,i,n.lastPoint1)}let vht=class{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const{x:e,y:i}=t;if(this._point){const r=this._x2-e,s=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1):this.context.moveTo(e,i);break;case 1:this._point=2;break;case 2:this._point=3;default:XY(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}};function KY(n,t){return function(e,i,r={}){const{direction:s,startPoint:o}=r;if(e.length<2-+!!o)return null;if(e.length<3-+!!o)return q0(e,r);const a=If(n,s,e),l=new t(a,i,o);return Uc(l,e,2),a}}const _ht=KY("catmullRom",vht);let bht=class{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(t){const{x:e,y:i}=t;if(this._point){const r=this._x2-e,s=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=e,this._y4=i,t);break;case 2:this._point=3,this._x5=e,this._y5=i;break;default:XY(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}};const yht=KY("catmullRomClosed",bht);let Cht=class{constructor(t){this.path=t,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(t,e){return this._lastX=this._startX=t,this._lastY=this._startY=e,this}lineTo(t,e){const i=this.addLinearCurve(t,e);this.path.addCurve(i),this._lastX=t,this._lastY=e}addLinearCurve(t,e){return new aS(new Yt(this._lastX,this._lastY),new Yt(t,e))}quadraticCurveTo(t,e,i,r){const s=new MP(new Yt(this._lastX,this._lastY),new Yt(t,e),new Yt(i,r));this.path.addCurve(s),this._lastX=i,this._lastY=r}bezierCurveTo(t,e,i,r,s,o){const a=new oS(new Yt(this._lastX,this._lastY),new Yt(t,e),new Yt(i,r),new Yt(s,o));this.path.addCurve(a),this._lastX=s,this._lastY=o}arcTo(t,e,i,r,s){throw new Error("CurveContextarcTo")}ellipse(t,e,i,r,s,o,a,l){throw new Error("CurveContextellipse")}rect(t,e,i,r){throw new Error("CurveContextrect")}arc(t,e,i,r,s,o){throw new Error("CurveContextarc")}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}};function Eu(n,t,e){var i,r;switch(t){case"linear":default:return q0(n,e);case"basis":return oht(n,e);case"monotoneX":return hht(n,e);case"monotoneY":return uht(n,e);case"step":return yk(n,.5,e);case"stepClosed":return ght(n,.5,e);case"stepBefore":return yk(n,0,e);case"stepAfter":return yk(n,1,e);case"catmullRom":return _ht(n,(i=e==null?void 0:e.curveTension)!==null&&i!==void 0?i:.5,e);case"catmullRomClosed":return yht(n,(r=e==null?void 0:e.curveTension)!==null&&r!==void 0?r:.5,e);case"linearClosed":return fht(n,e)}}let Gn=class extends Glt{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new AO(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([ei.M,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([ei.L,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.commandList.push([ei.Q,t,e,i,r]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,s,o){return this.commandList.push([ei.C,t,e,i,r,s,o]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,r,s,o),this}arcTo(t,e,i,r,s){return this.commandList.push([ei.AT,t,e,i,r,s]),this._ctx&&this._ctx.arcTo(t,e,i,r,s),this}ellipse(t,e,i,r,s,o,a,l){return this.commandList.push([ei.E,t,e,i,r,s,o,a,l]),this._ctx&&this._ctx.ellipse(t,e,i,r,s,o,a,l),this}rect(t,e,i,r){return this.commandList.push([ei.R,t,e,i,r]),this._ctx&&this._ctx.rect(t,e,i,r),this}arc(t,e,i,r,s,o){return this.commandList.push([ei.A,t,e,i,r,s,o]),this._ctx&&this._ctx.arc(t,e,i,r,s,o),this}closePath(){return this.commandList.push([ei.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this._curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){const t=new Cht(this);Ql(this.commandList,t,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){const i=[];i[ei.M]=r=>`M${r[1]} ${r[2]}`,i[ei.L]=r=>`L${r[1]} ${r[2]}`,i[ei.Q]=r=>`Q${r[1]} ${r[2]} ${r[3]} ${r[4]}`,i[ei.C]=r=>`C${r[1]} ${r[2]} ${r[3]} ${r[4]} ${r[5]} ${r[6]}`,i[ei.A]=r=>{const s=[];Zlt(s,r[4],r[5],r[1],r[2],r[3],r[3]);let o="";for(let a=0;a<s.length;a+=6)o+=`C${s[a]} ${s[a+1]} ${s[a+2]} ${s[a+3]} ${s[a+4]} ${s[a+5]}`;return o},i[ei.R]=r=>`M${r[1]} ${r[2]} h${r[3]} v${r[4]} H${r[1]}Z`,i[ei.Z]=r=>"Z",this.toStringCbList=i}const t=this.toStringCbList;let e="";return this.commandList.forEach(i=>{e+=t[i[0]](i)}),e}fromString(t,e,i,r,s){this.clear();const o=Xlt(t);return this._runCommandStrList(o,e,i,r,s),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:r}=t.attribute;if(!e)return;const s=Eu(e,i);r==="x"?this.direction=ai.ROW:r==="y"?this.direction=ai.COLUMN:r==="auto"&&(this.direction=s.direction),this._curves=s.curves}fromCustomPath2D(t,e,i,r,s){return this.clear(),this._runCommandList(t.commandList,e,i,r,s),this._updateBounds(),this}transform(t,e,i,r){const s=this.commandList;if(!this.transformCbList){const o=[];o[ei.M]=this.moveToTransform,o[ei.L]=this.lineToTransform,o[ei.Q]=this.quadraticCurveToTransform,o[ei.C]=this.bezierCurveToTransform,o[ei.AT]=this.arcToTransform,o[ei.E]=this.ellipseTransform,o[ei.R]=this.rectTransform,o[ei.A]=this.arcTransform,o[ei.Z]=this.closePathTransform,this.transformCbList=o}s.forEach(o=>{this.transformCbList[o[0]](o,t,e,i,r)}),this._updateBounds()}moveToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i}lineToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i}quadraticCurveToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r+e,t[4]=t[4]*s+i}bezierCurveToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r+e,t[4]=t[4]*s+i,t[5]=t[5]*r+e,t[6]=t[6]*s+i}arcToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r+e,t[4]=t[4]*s+i,t[5]=t[5]*(r+s)/2}ellipseTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r,t[4]=t[4]*s}rectTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r,t[4]=t[4]*s}arcTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*(r+s)/2}closePathTransform(){}_runCommandStrList(t,e=0,i=0,r=1,s=1){let o,a,l,h,d,u=null,c=0,g=0,p=0,f=0;for(let m=0,v=t.length;m<v;++m){switch(o=t[m],r===1&&s===1||(o=Sht(o,r,s)),o[0]){case"l":c+=o[1],g+=o[2],this.lineTo(c+e,g+i);break;case"L":c=o[1],g=o[2],this.lineTo(c+e,g+i);break;case"h":c+=o[1],this.lineTo(c+e,g+i);break;case"H":c=o[1],this.lineTo(c+e,g+i);break;case"v":g+=o[1],this.lineTo(c+e,g+i);break;case"V":g=o[1],this.lineTo(c+e,g+i);break;case"m":c+=o[1],g+=o[2],this.moveTo(c+e,g+i);break;case"M":c=o[1],g=o[2],this.moveTo(c+e,g+i);break;case"c":a=c+o[5],l=g+o[6],p=c+o[3],f=g+o[4],this.bezierCurveTo(c+o[1]+e,g+o[2]+i,p+e,f+i,a+e,l+i),c=a,g=l;break;case"C":c=o[5],g=o[6],p=o[3],f=o[4],this.bezierCurveTo(o[1]+e,o[2]+i,p+e,f+i,c+e,g+i);break;case"s":a=c+o[3],l=g+o[4],u[0].match(/[CcSs]/)===null?(p=c,f=g):(p=2*c-p,f=2*g-f),h=c+o[1],d=g+o[2],this.bezierCurveTo(p+e,f+i,h+e,d+i,a+e,l+i),p=h,f=d,c=a,g=l;break;case"S":a=o[3],l=o[4],u[0].match(/[CcSs]/)===null?(p=c,f=g):(p=2*c-p,f=2*g-f),h=o[1],d=o[2],this.bezierCurveTo(p+e,f+i,h+e,d+i,a+e,l+i),p=h,f=d,c=a,g=l;break;case"q":a=c+o[3],l=g+o[4],p=c+o[1],f=g+o[2],this.quadraticCurveTo(p+e,f+i,a+e,l+i),c=a,g=l;break;case"Q":a=o[3],l=o[4],this.quadraticCurveTo(o[1]+e,o[2]+i,a+e,l+i),c=a,g=l,p=o[1],f=o[2];break;case"t":a=c+o[1],l=g+o[2],u[0].match(/[QqTt]/)===null?(p=c,f=g):u[0]==="t"?(p=2*c-h,f=2*g-d):u[0]==="q"&&(p=2*c-p,f=2*g-f),h=p,d=f,this.quadraticCurveTo(p+e,f+i,a+e,l+i),c=a,g=l,p=c+o[1],f=g+o[2];break;case"T":a=o[1],l=o[2],p=2*c-p,f=2*g-f,this.quadraticCurveTo(p+e,f+i,a+e,l+i),c=a,g=l;break;case"a":Fz(this,c+e,g+i,[o[1],o[2],o[3],o[4],o[5],o[6]+c+e,o[7]+g+i]),c+=o[6],g+=o[7];break;case"A":Fz(this,c+e,g+i,[o[1],o[2],o[3],o[4],o[5],o[6]+e,o[7]+i]),c=o[6],g=o[7];break;case"z":case"Z":this.closePath()}u=o}}_runCommandList(t,e=0,i=0,r=1,s=1){if(e!==0||i!==0||r!==1||s!==1)for(let o=0,a=t.length;o<a;++o){const l=t[o].slice();switch(l[0]){case ei.L:this.lineToTransform(l,e,i,r,s);break;case ei.M:this.moveToTransform(l,e,i,r,s);break;case ei.C:this.bezierCurveToTransform(l,e,i,r,s);break;case ei.Q:this.quadraticCurveToTransform(l,e,i,r,s);break;case ei.A:this.arcToTransform(l,e,i,r,s);break;case ei.E:this.ellipseTransform(l,e,i,r,s);break;case ei.R:this.rectTransform(l,e,i,r,s);break;case ei.AT:this.arcToTransform(l,e,i,r,s);break;case ei.Z:this.closePath()}}else this.commandList=t.map(o=>o.slice())}_updateBounds(){this.bounds.clear(),Ql(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===ai.COLUMN){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return Et(t.p0.y-e.p1.y)}if(this.direction===ai.ROW){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return Et(t.p0.x-e.p1.x)}return this._curves.reduce((t,e)=>t+e.getLength(),0)}getYAt(t){if(!this.curves)return 1/0;for(let e=0;e<this.curves.length;e++){const i=this.curves[e];if(i.includeX(t))return i.getYAt(t)}return 1/0}getAttrAt(t){if(!this._curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let s=0;s<this._curves.length;s++){e=this._curves[s];const o=e.getLength(this.direction);if(i+o>=t)break;i+=o}const r=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(r),angle:e.getAngleAt(r)}}drawWithClipRange(t,e,i,r,s){this.tryBuildCurves();const o=this.getLength()*s;let a=0;for(let l=0;l<this._curves.length;l++){const h=this._curves[l],d=h.getLength(this.direction);if(!(a+d<=o)){const u=1-(a+d-o)/d;h.draw(t,i,r,e,e,u);break}h.draw(t,i,r,e,e,1),a+=d}}};const Ys=["l",0,0,0,0,0,0,0];function Sht(n,t,e){const i=Ys[0]=n[0];if(i==="a"||i==="A")Ys[1]=t*n[1],Ys[2]=e*n[2],Ys[3]=n[3],Ys[4]=n[4],Ys[5]=n[5],Ys[6]=t*n[6],Ys[7]=e*n[7];else if(i==="h"||i==="H")Ys[1]=t*n[1];else if(i==="v"||i==="V")Ys[1]=e*n[1];else for(let r=1,s=n.length;r<s;++r)Ys[r]=(r%2==1?t:e)*n[r];return Ys}const xht={alignSelf:"auto"},Fn={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Pe},qY={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},Ck={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},ZY=Object.assign({outerBorder:Object.assign(Object.assign({},Ck),{distance:0}),innerBorder:Object.assign(Object.assign({},Ck),{distance:0})},Ck),is={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol`,fontWeight:"",ellipsis:"",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:Yu.fontBounding,keepCenterInLine:!1},wht={pickStrokeBuffer:0},Aht=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:"",cursor:null,html:null,react:null,vue:null},qY),ZY),xht),wht),JY={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},Mht={_debug_bounds:!1},Yi=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1,clipConfig:null},Mht),Aht),Fn),Tht=Object.assign(Object.assign({},Yi),{startAngle:0,endAngle:Ft,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),kht=Object.assign(Object.assign(Object.assign({},Yi),JY),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),Rht=Object.assign(Object.assign({},Yi),{radius:1,startAngle:0,endAngle:Ft}),Bht=Object.assign(Object.assign({},Yi),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1,cornerType:"round"}),Pht=Object.assign(Object.assign({},Yi),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),Eht=Object.assign(Object.assign(Object.assign({},Yi),JY),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),Lht=Object.assign(Object.assign({},Yi),{path:new Gn,fillStrokeOrder:1,clipRange:1,customPath:()=>{ge.getInstance().warn("")}}),Iht=Object.assign(Object.assign({},Yi),{points:[],cornerRadius:0,closePath:!0}),Oht=Object.assign(Object.assign({},Yi),{width:100,height:100,spikes:5,thickness:.5}),Dht=Object.assign(Object.assign({},Yi),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:"round"});Object.assign(Object.assign({},Yi),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:"round"});const Fht=Object.assign(Object.assign({},Yi),{symbolType:"circle",size:10,keepDirIn3d:!0,clipRange:1}),QY=Object.assign(Object.assign(Object.assign({},Yi),is),{strokeBoundsBuffer:0,keepDirIn3d:!0}),xl=Object.assign(Object.assign(Object.assign({},Yi),is),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:"actual",width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),P_=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0,maxWidth:500,maxHeight:500},Yi),{fill:!0,cornerRadius:0,cornerType:"round"}),Hht=Object.assign(Object.assign({},P_),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});let zht=class{};const St=new zht,Wht=function(){const n={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i};let t="";function e(y){const C=new Error(t+": "+y);throw C.source=t,C}function i(){const y=g(r);return t.length>0&&e("Invalid input not EOF"),y}function r(){return s("linear",n.linearGradient,o)||s("radial",n.radialGradient,l)||s("conic",n.conicGradient,a)}function s(y,C,S){return function(w,x){const A=_(w);if(A){_(n.startCall)||e("Missing (");const M=x(A);return _(n.endCall)||e("Missing )"),M}}(C,function(w){const x=S();return x&&(_(n.comma)||e("Missing comma before color stops")),{type:y,orientation:x,colorStops:g(p)}})}function o(){return v("directional",n.sideOrCorner,1)||v("angular",n.angleValue,1)}function a(){return v("angular",n.fromAngleValue,1)}function l(){let y,C,S=h();return S&&(y=[],y.push(S),C=t,_(n.comma)&&(S=h(),S?y.push(S):t=C)),y}function h(){let y=function(){const C=v("shape",/^(circle)/i,0);return C&&(C.style=m()||d()),C}()||function(){const C=v("shape",/^(ellipse)/i,0);return C&&(C.style=f()||d()),C}();if(y)y.at=u();else{const C=d();if(C){y=C;const S=u();S&&(y.at=S)}else{const S=c();S&&(y={type:"default-radial",at:S})}}return y}function d(){return v("extent-keyword",n.extentKeywords,1)}function u(){if(v("position",/^at/,0)){const y=c();return y||e("Missing positioning value"),y}}function c(){const y={x:f(),y:f()};if(y.x||y.y)return{type:"position",value:y}}function g(y){let C=y();const S=[];if(C)for(S.push(C);_(n.comma);)C=y(),C?S.push(C):e("One extra comma");return S}function p(){const y=v("hex",n.hexColor,1)||v("rgba",n.rgbaColor,1)||v("rgb",n.rgbColor,1)||v("literal",n.literalColor,0);return y||e("Expected color definition"),y.length=f(),y}function f(){return v("%",n.percentageValue,1)||v("position-keyword",n.positionKeywords,1)||m()}function m(){return v("px",n.pixelValue,1)||v("em",n.emValue,1)}function v(y,C,S){const w=_(C);if(w)return{type:y,value:w[S]}}function _(y){const C=/^[\n\r\t\s]+/.exec(t);C&&b(C[0].length);const S=y.exec(t);return S&&b(S[0].length),S}function b(y){t=t.substr(y)}return function(y){return t=y.toString(),i()}}();let jht=class Em{static IsGradient(t){return!(typeof t=="string"&&!t.includes("gradient"))}static IsGradientStr(t){return typeof t=="string"&&t.includes("gradient")}static Parse(t){if(Em.IsGradientStr(t))try{const e=Wht(t)[0];if(e){if(e.type==="linear")return Em.ParseLinear(e);if(e.type==="radial")return Em.ParseRadial(e);if(e.type==="conic")return Em.ParseConic(e)}}catch{return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,r=Kt/2,s=parseFloat(e.value)/180*Kt-r;return{gradient:"conical",x:.5,y:.5,startAngle:s,endAngle:s+Ft,stops:i.map(o=>({color:o.value,offset:parseFloat(o.length.value)/100}))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map(i=>({color:i.value,offset:parseFloat(i.length.value)/100}))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,r=Kt/2;let s=e.type==="angular"?parseFloat(e.value)/180*Kt:0;for(;s<0;)s+=Ft;for(;s>=Ft;)s-=Ft;let o=0,a=0,l=0,h=0;return s<r?(o=0,a=1,l=Math.sin(s),h=a-Math.cos(s)):s<Kt?(o=0,a=0,l=Math.cos(s-r),h=Math.sin(s-r)):s<Kt+r?(o=1,a=0,l=o-Math.sin(s-Kt),h=Math.cos(s-Kt)):(o=1,l=o-Math.cos(s-r-Kt),h-=Math.sin(s-r-Kt)),{gradient:"linear",x0:o,y0:a,x1:l,y1:h,stops:i.map(d=>({color:d.value,offset:parseFloat(d.length.value)/100}))}}};function lh(n,t,e){let i=t;const{a:r,b:s,c:o,d:a}=n.currentMatrix,l=Math.sign(r)*Math.sqrt(r*r+s*s),h=Math.sign(a)*Math.sqrt(o*o+a*a);return l+h===0?0:(i=i/Math.abs(l+h)*2*e,i)}function lS(n,t,e,i=0,r=0){var s,o,a,l;if(!t||t===!0)return"black";let h,d;if(V(t))for(let u=0;u<t.length&&(d=t[u],!d);u++);else d=t;if(d=jht.Parse(d),typeof d=="string")return d;if(e.AABBBounds&&(!e.attribute||e.attribute.scaleX!==0||e.attribute.scaleY!==0)){const u=e.AABBBounds;let c=u.x2-u.x1,g=u.y2-u.y1,p=u.x1-i,f=u.y1-r;if(e.attribute){const{scaleX:m=1,scaleY:v=1,angle:_=0}=e.attribute;c/=m,g/=v,p/=m,f/=v,(_||m!==1||v!==1)&&(p=(s=e.x1WithoutTransform)!==null&&s!==void 0?s:0,f=(o=e.y1WithoutTransform)!==null&&o!==void 0?o:0,c=(a=e.widthWithoutTransform)!==null&&a!==void 0?a:c,g=(l=e.heightWithoutTransform)!==null&&l!==void 0?l:g)}d.gradient==="linear"?h=Nht(n,d,p,f,c,g):d.gradient==="conical"?h=Vht(n,d,p,f,c,g):d.gradient==="radial"&&(h=$ht(n,d,p,f,c,g))}return h||"orange"}function Nht(n,t,e,i,r,s){var o,a,l,h;const d=n.createLinearGradient(e+((o=t.x0)!==null&&o!==void 0?o:0)*r,i+((a=t.y0)!==null&&a!==void 0?a:0)*s,e+((l=t.x1)!==null&&l!==void 0?l:1)*r,i+((h=t.y1)!==null&&h!==void 0?h:0)*s);return t.stops.forEach(u=>{d.addColorStop(u.offset,u.color)}),d}function $ht(n,t,e,i,r,s){var o,a,l,h,d,u;const c=n.createRadialGradient(e+((o=t.x0)!==null&&o!==void 0?o:.5)*r,i+((a=t.y0)!==null&&a!==void 0?a:.5)*s,Math.max(r,s)*((l=t.r0)!==null&&l!==void 0?l:0),e+((h=t.x1)!==null&&h!==void 0?h:.5)*r,i+((d=t.y1)!==null&&d!==void 0?d:.5)*s,Math.max(r,s)*((u=t.r1)!==null&&u!==void 0?u:.5));return t.stops.forEach(g=>{c.addColorStop(g.offset,g.color)}),c}function Vht(n,t,e,i,r,s){var o,a;const l=n.createConicGradient(e+((o=t.x)!==null&&o!==void 0?o:0)*r,i+((a=t.y)!==null&&a!==void 0?a:0)*s,t.startAngle,t.endAngle);return t.stops.forEach(h=>{l.addColorStop(h.offset,h.color)}),l.GetPattern?l.GetPattern(r+e,s+i,void 0):l}const TO={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},tX={fill:!0,stroke:!1},hS=/\w|\(|\)|-/,eX=/[.?!,;:/]/,Ght=/\S/,iX=(n,t)=>{let e=t.fontSize||16;switch(t.script){case"super":case"sub":e*=.8}n.setTextStyle({textAlign:"left",textBaseline:t.textBaseline||"alphabetic",fontStyle:t.fontStyle||"",fontWeight:t.fontWeight||"",fontSize:e,fontFamily:t.fontFamily})};function Uht(n,t,e){const i=t&&t.fill||tX.fill,{fillOpacity:r=1,opacity:s=1}=t;n.globalAlpha=r*s,n.fillStyle=e?lS(n,i,{AABBBounds:e}):i,iX(n,t)}function Yht(n,t){const e=t&&t.stroke||tX.stroke;if(!e)return void(n.globalAlpha=0);const{strokeOpacity:i=1,opacity:r=1}=t;n.globalAlpha=i*r,n.lineWidth=t&&typeof t.lineWidth=="number"?t.lineWidth:1,n.strokeStyle=e,iX(n,t)}function vC(n,t,e,i,r){if(n.length<=1||!t||t<=0)return 0;const s=St.graphicUtil.textMeasure;let o=i,a=n.slice(0,o),l=Math.floor(s.measureText(a,e).width),h=n.slice(0,o+1),d=Math.floor(s.measureText(h,e).width);for(;l>t||d<=t;){if(l>t?o--:o++,o>n.length){o=n.length;break}if(o<0){o=0;break}a=n.slice(0,o),l=Math.floor(s.measureText(a,e).width),h=n.slice(0,o+1),d=Math.floor(s.measureText(h,e).width)}return r&&(o=_C(n,o)),o}function _C(n,t,e=!1){let i=t;for(;hS.test(n[i-1])&&hS.test(n[i])||eX.test(n[i]);)if(i--,i<=0)return e?Xht(n,t):t;return i}function Xht(n,t){let e=t;for(;hS.test(n[e+1])&&hS.test(n[e])||eX.test(n[e]);)if(e++,e>=n.length)return e;return e+1}function Au(n,t,e="actual"){var i;if(n==="")return{ascent:0,height:0,descent:0,width:0};const r=St.graphicUtil.textMeasure.measureText(n,t),s={ascent:0,height:0,descent:0,width:0},o=e==="actual"?r.actualBoundingBoxAscent:r.fontBoundingBoxAscent,a=e==="actual"?r.actualBoundingBoxDescent:r.fontBoundingBoxDescent;typeof o!="number"||typeof a!="number"?(s.width=Math.floor(r.width),s.height=t.fontSize||0,s.ascent=s.height,s.descent=0):(s.width=Math.floor(r.width),s.height=Math.floor(o+a),s.ascent=Math.floor(o),s.descent=s.height-s.ascent);const l=(i=t.space)!==null&&i!==void 0?i:0;return s.width+=l,s}var Kht=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let TP=class{configure(t,e){this.canvas=t.canvas,this.context=t.context,t.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(t,e,i){this.context.setTextStyleWithoutAlignBaseline(e);const r=this.context.measureText(t);return i?this.compatibleMetrics(r,e):r}_measureTextWithAlignBaseline(t,e,i){this.context.setTextStyle(e);const r=this.context.measureText(t);return i?this.compatibleMetrics(r,e):r}compatibleMetrics(t,e){if(t.actualBoundingBoxAscent==null||t.actualBoundingBoxDescent==null||t.fontBoundingBoxAscent==null||t.fontBoundingBoxDescent==null){t={width:t.width};const{ascent:i,descent:r}=this.measureTextBoundADscentEstimate(e);t.actualBoundingBoxAscent=i,t.actualBoundingBoxDescent=r,t.fontBoundingBoxAscent=i,t.fontBoundingBoxDescent=r}if(t.actualBoundingBoxLeft==null||t.actualBoundingBoxRight==null){t={width:t.width,actualBoundingBoxAscent:t.actualBoundingBoxAscent,actualBoundingBoxDescent:t.actualBoundingBoxDescent,fontBoundingBoxAscent:t.fontBoundingBoxAscent,fontBoundingBoxDescent:t.fontBoundingBoxDescent};const{left:i,right:r}=this.measureTextBoundLeftRightEstimate(e);t.actualBoundingBoxLeft=i,t.actualBoundingBoxRight=r}return t}estimate(t,{fontSize:e=QY.fontSize}){let i=0,r=0;for(let s=0;s<t.length;s++)t.charCodeAt(s)<128?i++:r++;return{width:~~(.8*i*e+r*e),height:e}}measureTextWidth(t,e,i){return this.context?(i=i??this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsWidth(t,e,i){return this.context?(i=i??this._measureTextWithoutAlignBaseline(t,e)).width:this.estimate(t,e).width}measureTextBoundsLeftRight(t,e,i){return this.context?{left:(i=i??this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxLeft,right:i.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(e)}measureTextPixelHeight(t,e,i){var r;return this.context?(i=i??this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.actualBoundingBoxAscent-i.actualBoundingBoxDescent)):(r=e.fontSize)!==null&&r!==void 0?r:is.fontSize}measureTextPixelADscent(t,e,i){return this.context?{ascent:(i=i??this._measureTextWithAlignBaseline(t,e,!0)).actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundHieght(t,e,i){var r;return this.context?(i=i??this._measureTextWithoutAlignBaseline(t,e,!0),Math.abs(i.fontBoundingBoxAscent-i.fontBoundingBoxDescent)):(r=e.fontSize)!==null&&r!==void 0?r:is.fontSize}measureTextBoundADscent(t,e,i){return this.context?{ascent:(i=i??this._measureTextWithAlignBaseline(t,e,!0)).fontBoundingBoxAscent,descent:i.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(e)}measureTextBoundADscentEstimate(t){var e;const i=(e=t.fontSize)!==null&&e!==void 0?e:is.fontSize;return{ascent:.79*i,descent:.21*i}}measureTextBoundLeftRightEstimate(t){var e;const i=(e=t.fontSize)!==null&&e!==void 0?e:is.fontSize,{textAlign:r}=t;return r==="center"?{left:i/2,right:i/2}:r==="right"||r==="end"?{left:i,right:0}:{left:0,right:i}}measureTextPixelADscentAndWidth(t,e,i){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:this.estimate(t,e).width});const r=this._measureTextWithoutAlignBaseline(t,e,!0);if(i===Yu.actualBounding)return{ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,width:r.width};if(i===Yu.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(e)),{width:r.width});if(i===Yu.fontBounding){let s=r.fontBoundingBoxAscent,o=r.fontBoundingBoxDescent;if(r.actualBoundingBoxDescent&&o<r.actualBoundingBoxDescent){const a=r.actualBoundingBoxDescent-o;o+=a,s-=a}else if(r.actualBoundingBoxAscent&&s<r.actualBoundingBoxAscent){const a=r.actualBoundingBoxAscent-s;s+=a,o-=a}return{ascent:s,descent:o,width:r.width}}return{ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,width:r.width}}measureText(t,e){return this.context?(this.context.setTextStyleWithoutAlignBaseline(e),this.context.measureText(t)):this.estimate(t,e)}clipTextVertical(t,e,i,r){if(t.length===0)return{verticalList:t,width:0};const{fontSize:s=12}=e;t.forEach(h=>{h.width=h.direction===0?s:this.measureTextWidth(h.text,e)});const o=[];let a=0,l=0;for(;l<t.length&&a+t[l].width<i;l++)a+=t[l].width,o.push(t[l]);if(t[l]&&t[l].text.length>1){const h=this._clipText(t[l].text,e,i-a,0,t[l].text.length-1,"end",!1);if(r&&h.str!==t[l].text){let d="",u=0;for(let p=0;p<l;p++){const f=t[p];d+=f.text,u+=f.text.length}d+=t[l].text;const c=u+h.str.length;let g=_C(d,c);g-=u,g!==h.str.length-1&&(h.str=h.str.substring(0,g),h.width=this.measureTextWidth(h.str,e))}o.push(Object.assign(Object.assign({},t[l]),{text:h.str,width:h.width})),a+=h.width}return{verticalList:o,width:a}}clipText(t,e,i,r,s){if(t.length===0)return{str:"",width:0};let o=this.measureTextWidth(t,e);if(o<=i)return{str:t,width:o};if(o=this.measureTextWidth(t[0],e),o>i)return{str:"",width:0};const a=this._clipText(t,e,i,0,t.length-1,"end",!1);if(r&&a.str!==t){let l=_C(t,a.str.length,s);l!==a.str.length&&(l>a.str.length&&(a.wordBreaked=l,l=a.str.length),a.str=t.substring(0,l),a.width=this.measureTextWidth(a.str,e))}return a}_clipText(t,e,i,r,s,o,a){let l;if(o==="start")l=this._clipTextStart(t,e,i,r,s),a&&(l.result=a+l.str);else if(o==="middle"){const h=this._clipTextMiddle(t,e,i,"","",0,0,1);l={str:"none",width:h.width,result:h.left+a+h.right}}else l=this._clipTextEnd(t,e,i,r,s),a&&(l.result=l.str+a);return l}_clipTextEnd(t,e,i,r,s){if(r===s){ge.getInstance().warn(`_clipTextEnd${t}, ${r}, ${s}`);const d=t.substring(0,s+1);return{str:d,width:this.measureTextWidth(d,e)}}const o=Math.floor((r+s)/2),a=t.substring(0,o+1),l=this.measureTextWidth(a,e);let h;if(l>i){if(a.length<=1)return{str:"",width:0};const d=t.substring(0,o);return h=this.measureTextWidth(d,e),h<=i?{str:d,width:h}:this._clipTextEnd(t,e,i,r,o)}if(l<i){if(o>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const d=t.substring(0,o+2);return h=this.measureTextWidth(d,e),h>=i?{str:a,width:l}:this._clipTextEnd(t,e,i,o,s)}return{str:a,width:l}}_clipTextStart(t,e,i,r,s){const o=Math.ceil((r+s)/2),a=t.substring(o-1,t.length),l=this.measureTextWidth(a,e);let h;if(l>i){if(a.length<=1)return{str:"",width:0};const d=t.substring(o,t.length);return h=this.measureTextWidth(d,e),h<=i?{str:d,width:h}:this._clipTextStart(t,e,i,o,t.length)}if(l<i){if(o<=0)return{str:t,width:this.measureTextWidth(t,e)};const d=t.substring(o-2,t.length);return h=this.measureTextWidth(d,e),h>=i?{str:a,width:l}:this._clipTextStart(t,e,i,r,o)}return{str:a,width:l}}_clipTextMiddle(t,e,i,r,s,o,a,l){const h=t.substring(0,l),d=this.measureTextWidth(h,e);if(d+a>i)return{left:r,right:s,width:o+a};const u=t.substring(t.length-l,t.length),c=this.measureTextWidth(u,e);return d+c>i?{left:h,right:s,width:d+a}:this._clipTextMiddle(t,e,i,h,u,d,c,l+1)}clipTextWithSuffixVertical(t,e,i,r,s,o){if(r==="")return this.clipTextVertical(t,e,i,s);if(t.length===0)return{verticalList:t,width:0};const a=this.clipTextVertical(t,e,i,s);if(a.verticalList.length===t.length&&a.verticalList[a.verticalList.length-1].width===t[t.length-1].width)return a;const l=this.measureTextWidth(r,e);if(l>i)return a;let h;if(i-=l,o==="start"){const d=this.revertVerticalList(t);h=this.clipTextVertical(d,e,i,s);const u=this.revertVerticalList(h.verticalList);u.unshift({text:r,direction:1,width:l}),h.verticalList=u}else if(o==="middle"){const d=this.clipTextVertical(t,e,i/2,s),u=this.revertVerticalList(t),c=this.clipTextVertical(u,e,i/2,s);d.verticalList.push({text:r,direction:1,width:l}),this.revertVerticalList(c.verticalList).forEach(g=>d.verticalList.push(g)),h={verticalList:d.verticalList,width:d.width+c.width}}else h=this.clipTextVertical(t,e,i,s),h.verticalList.push({text:r,direction:1,width:l});return h.width+=l,h}revertVerticalList(t){return t.reverse().map(e=>{const i=e.text.split("").reverse().join("");return Object.assign(Object.assign({},e),{text:i})})}clipTextWithSuffix(t,e,i,r,s,o,a=!1){if(r==="")return this.clipText(t,e,i,s);if(t.length===0)return{str:"",width:0};const l=this.measureTextWidth(t,e);if(!a&&l<=i)return{str:t,width:l};const h=this.measureTextWidth(r,e);if(h>i)return{str:"",width:0};if(a&&l+h<=i)return{str:t+r,width:l+h};i-=h;const d=this._clipText(t,e,i,0,t.length-1,o,r);if(s&&d.str!==t){const u=_C(t,d.str.length);u!==d.str.length&&(d.result=t.substring(0,u),d.width=this.measureTextWidth(d.str,e))}else a&&d.str===t&&(d.result=t+r);return d.str=d.result,d.width+=h,d}};TP=Kht([Bt()],TP);var qht=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const $l=Symbol.for("TextMeasureContribution");let Yp=class extends TP{};Yp=qht([Bt()],Yp);const he=new Wat,nX=Symbol.for("CanvasFactory"),Zht=Symbol.for("Context2dFactory");function kP(n){return he.getNamed(nX,St.global.env)(n)}let Jht=class{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const i=kP(Object.assign({nativeCanvas:St.global.createCanvas(t)},t));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const i={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},r=kP(Object.assign({nativeCanvas:St.global.createCanvas(i)},i));return this.allocatedCanvas.push(r),r}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}};const Xu=new Jht;var Qht=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},tdt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const E_=Symbol.for("VWindow"),kO=Symbol.for("WindowHandlerContribution");let RP=class extends _Y{get width(){if(this._handler){const t=this._handler.getWH();return this._width=t.width}return this._width}get height(){if(this._handler){const t=this._handler.getWH();return this._height=t.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){super(),this.hooks={onChange:new qr(["x","y","width","height"])},this.active=()=>{const t=this.global;!t.env||this.actived||(he.getNamed(kO,t.env).configure(this,t),this.actived=!0)},this._uid=Nn.GenAutoIncrementId(),this.global=St.global,this.postInit()}_nativeAddEventListener(t,e,i){return this._handler.addEventListener(t,e,i)}_nativeRemoveEventListener(t,e,i){return this._handler.removeEventListener(t,e,i)}_nativeDispatchEvent(t){return this._handler.dispatchEvent(t)}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var t;return(t=this._handler.getStyle())!==null&&t!==void 0?t:{}}set style(t){this._handler.setStyle(t)}create(t){var e,i;this._handler.createWindow(t);const r=this._handler.getWH();this._width=r.width,this._height=r.height,t.viewBox?this.setViewBox(t.viewBox):t.canvasControled!==!1?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:(e=t.width)!==null&&e!==void 0?e:this._width,y2:(i=t.height)!==null&&i!==void 0?i:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(t){this._handler=t}setDpr(t){return this._handler.setDpr(t)}resize(t,e){return this._handler.resizeWindow(t,e)}configure(){throw new Error("")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this.clearAllEventListeners(),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(t){return this._handler.getImageBuffer?this._handler.getImageBuffer(t):null}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(t){this._handler.clearViewBox(t)}setViewBox(t){this._handler.setViewBox(t)}setViewBoxTransform(t,e,i,r,s,o){this._handler.setViewBoxTransform(t,e,i,r,s,o)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(t,e){const i=this._handler.getViewBox(),r={x:t,y:e};return this._handler.getViewBoxTransform().transformPoint({x:t,y:e},r),r.x-=i.x1,r.y-=i.y1,r}hasSubView(){const t=this._handler.getViewBox();return!(t.x1===0&&t.y1===0&&di(this.width,t.width())&&di(this.height,t.height()))}isVisible(t){return this._handler.isVisible(t)}onVisibleChange(t){return this._handler.onVisibleChange(t)}getTopLeft(t){return this._handler.getTopLeft(t)}};RP=Qht([Bt(),tdt("design:paramtypes",[])],RP);var rX=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},sX=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Gz=function(n,t){return function(e,i){t(e,i,n)}};let BP=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(t){this.contributions=t,this.configured=!1,this.global=St.global,this.global.hooks.onSetEnv.tap("graphic-util",(e,i,r)=>{this.configured=!1,this.configure(r,i)})}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(t,e){this.configured||(this.contributions.getContributions().forEach(i=>{i.configure(this,e)}),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const t=Xu.shareCanvas();this._canvas=t,this._context=t.getContext("2d")}}bindTextMeasure(t){this._textMeasure=t}measureText(t,e,i="native"){var r;this.configure(this.global,this.global.env);const s=this.global.measureTextMethod;this.global.measureTextMethod=i;const o={width:this._textMeasure.measureTextWidth(t,e),height:(r=e.fontSize)!==null&&r!==void 0?r:is.fontSize};return this.global.measureTextMethod=s,o}createTextMeasureInstance(t,e,i){return this.configure(this.global,this.global.env),new Wi(Object.assign({defaultFontParams:{fontFamily:is.fontFamily,fontSize:is.fontSize},getCanvasForMeasure:i||(()=>this.canvas),getTextBounds:void 0,specialCharSet:`-/: .,@%'"~`+Wi.ALPHABET_CHAR_SET+Wi.ALPHABET_CHAR_SET.toUpperCase()},e??{}),t)}drawGraphicToCanvas(t,e,i){if(!e.defaultLayer)return null;const r=he.get(E_),s=t.AABBBounds,o=s.width(),a=s.height(),l=-s.x1,h=-s.y1;r.create({viewBox:{x1:l,y1:h,x2:s.x2,y2:s.y2},width:o,height:a,canvas:i,dpr:e.window.dpr,canvasControled:!0,offscreen:!0,title:""});const d=e.params.optimize.disableCheckGraphicWidthOutRange;e.params.optimize.disableCheckGraphicWidthOutRange=!0,e.defaultLayer.getNativeHandler().drawTo(r,[t],{transMatrix:r.getViewBoxTransform(),viewBox:r.getViewBox(),stage:e,layer:e.defaultLayer,renderService:e.renderService,background:"transparent",clear:!0,updateBounds:!1}),e.params.optimize.disableCheckGraphicWidthOutRange=d;const u=r.getNativeHandler();return u.nativeCanvas?u.nativeCanvas:null}};BP=rX([Bt(),Gz(0,xe(tn)),Gz(0,Sn($l)),sX("design:paramtypes",[Object])],BP);var Dh;(function(n){n[n.transform=0]="transform",n[n.matrix=1]="matrix"})(Dh||(Dh={}));const fn=new Pe;let PP=class{constructor(){this.matrix=new Pe}init(t){return this.mode=Dh.transform,this.originTransform=t,this.matrix.reset(),this}fromMatrix(t,e){return this.mode=Dh.matrix,this.outSourceMatrix=t,this.outTargetMatrix=e,this}scaleMatrix(t,e,i){const r=this.outSourceMatrix;if(fn.setValue(r.a,r.b,r.c,r.d,r.e,r.f),this.outTargetMatrix.reset(),i){const{x:s,y:o}=i;this.outTargetMatrix.translate(s,o),this.outTargetMatrix.scale(t,e),this.outTargetMatrix.translate(-s,-o)}else this.outTargetMatrix.scale(t,e);return this.outTargetMatrix.multiply(fn.a,fn.b,fn.c,fn.d,fn.e,fn.f),this}rotateMatrix(t,e){const i=this.outSourceMatrix;if(fn.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:r,y:s}=e;this.outTargetMatrix.translate(r,s),this.outTargetMatrix.rotate(t),this.outTargetMatrix.translate(-r,-s)}else this.outTargetMatrix.rotate(t);return this.outTargetMatrix.multiply(fn.a,fn.b,fn.c,fn.d,fn.e,fn.f),this}scale(t,e,i){return this.mode===Dh.matrix?this.scaleMatrix(t,e,i):this}rotate(t,e){return this.mode===Dh.matrix?this.rotateMatrix(t,e):this}translateMatrix(t,e){const i=this.outSourceMatrix;return fn.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(t,e),this.outTargetMatrix.multiply(fn.a,fn.b,fn.c,fn.d,fn.e,fn.f),this}translate(t,e){return this.mode===Dh.matrix?this.translateMatrix(t,e):this}simplify(t){return this.mode===Dh.matrix?this.simplifyMatrix(t):this}simplifyMatrix(t){return this}};PP=rX([Bt(),sX("design:paramtypes",[])],PP);const ur={arc:Tht,area:kht,circle:Rht,line:Eht,path:Lht,symbol:Fht,text:QY,rect:Dht,polygon:Iht,star:Oht,richtext:xl,richtextIcon:Hht,image:P_,group:Bht,glyph:Pht},Sk=Object.keys(ur);function edt(){return{arc:Object.assign({},ur.arc),area:Object.assign({},ur.area),circle:Object.assign({},ur.circle),line:Object.assign({},ur.line),path:Object.assign({},ur.path),symbol:Object.assign({},ur.symbol),text:Object.assign({},ur.text),rect:Object.assign({},ur.rect),polygon:Object.assign({},ur.polygon),star:Object.assign({},ur.star),richtext:Object.assign({},ur.richtext),richtextIcon:Object.assign({},ur.richtextIcon),image:Object.assign({},ur.image),group:Object.assign({},ur.group),glyph:Object.assign({},ur.glyph)}}function Qb(n,t){Object.keys(t).forEach(e=>{n[e]=t[e]})}const Uz=edt();let L_=class{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},Sk.forEach(t=>{this._defaultTheme[t]=Object.create(Uz[t])}),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e,i=!1){if(this.dirty){const r=this.getParentWithTheme(t);if(r){const s=r.theme;(s.dirty||i)&&s.applyTheme(r,e,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,ge.getInstance().warn("")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;Sk.forEach(r=>{const s=Object.create(Uz[r]);t&&t[r]&&Qb(s,t[r]),i[r]&&Qb(s,i[r]),e[r]&&Qb(s,e[r]),this.combinedTheme[r]=s}),e.common&&Sk.forEach(r=>{Qb(this.combinedTheme[r],e.common)}),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach(r=>{i[r]?Object.assign(i[r],t[r]):i[r]=Object.assign({},t[r])}):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren(e=>{e.isContainer&&(e.theme&&(e.theme.dirty=!0),this.dirtyChildren(e))})}};const oX=new L_;function _e(n,t){return n.glyphHost?_e(n.glyphHost):t?(n.isContainer,t):idt(n)||n.attachedThemeGraphic&&_e(n.attachedThemeGraphic)||oX.getTheme()}function idt(n){let t;if(t=n.isContainer?n:n.parent,t){for(;t&&!t.theme;)t=t.parent;return t?(t.theme||t.createTheme(),t.theme.getTheme(t)):oX.getTheme()}return null}var ndt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};let rdt=class extends us{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=Nn.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t,e=!1){if(e){let i=this._lastChild,r=0;for(;i;){if(t(i,r++))return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){if(t(i,r++))return;i=i._next}}}forEachChildrenAsync(t,e=!1){return ndt(this,void 0,void 0,function*(){if(e){let i=this._lastChild,r=0;for(;i;){let s=t(i,r++);if(s.then&&(s=yield s),s)return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){let s=t(i,r++);if(s.then&&(s=yield s),s)return;i=i._next}}})}forEach(t){return this.forEachChildren(t)}appendChild(t,e=!0){if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("Node::appendChildappend");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t,e=!1){return console.error(""),t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("Node::insertBeforeinsert");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("Node::insertAfterinsert");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&ge.getInstance().warn("insertIntoKeepIdxinsertInto"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("Node::insertBeforeinsert");if(t.parent&&t.parent.removeChild(t),t.parent=this,e===0)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let r=0;r<e;r++){if(!i)return null;r>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const s=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,s)}let i;this._nodeList[e]=t;for(let s=e-1;s>=0&&(i=this._nodeList[s],!i);s--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const r=this.insertInto(t,0);return this._ignoreWarn=!1,r}removeChild(t){if(!this._idMap||!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex(i=>i===t);e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){const i=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=i}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("")}find(t,e=!1){let i=null;return this.forEachChildren((r,s)=>!(r===this||!t(r,s))&&(i=r,!0)),e&&this.forEachChildren(r=>{if(r.isContainer){const s=r.find(t,!0);if(s)return i=s,!0}return!1}),i}findAll(t,e=!1){let i=[];return this.forEachChildren((r,s)=>{r!==this&&t(r,s)&&i.push(r)}),e&&this.forEachChildren(r=>{if(r.isContainer){const s=r.findAll(t,!0);s.length&&(i=i.concat(s))}}),i}getElementById(t){return this.find(e=>e.id===t,!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll(e=>e.name===t,!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll(e=>e.type===t,!0)}getChildByName(t,e=!1){return this.find(i=>i.name===t,e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;t!=null&&t.parent;)t=t.parent;return t||this}hasChildNodes(){return this._firstChild!==null}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(e!==null);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do e._count+=t,e=e.parent;while(e!==null)}clone(){throw new Error("")}cloneTo(t){throw new Error("")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const r=Re(i,!0)&&i||kt(i)&&i.capture,s=kt(i)&&i.once,o=it(e)?void 0:e;return t=r?`${t}capture`:t,e=it(e)?e:e.handleEvent,s?super.once(t,e,o):super.on(t,e,o),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const r=Re(i,!0)&&i||kt(i)&&i.capture,s=it(e)?void 0:e;t=r?`${t}capture`:t,e=it(e)?e:e.handleEvent;const o=kt(i)&&i.once;return super.off(t,e,s,o),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return kt(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t,...e){return super.emit(t.type,t,...e),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}},RO=class aX{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=aX.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){const e=t.graphic;if(e.stage){const i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&it(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&it(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}},dS=class extends RO{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,s,o,a,l,h,d,u,c,g,p,f){throw new Error("Method not implemented.")}},Do=class lX extends dS{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const r=new lX(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyPointerData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const s=this.composedDetailPath();return r.detailPath=s&&s.slice(),r.type=this.type,r}},_p=class hX extends dS{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const r=new hX(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyWheelData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const s=this.composedDetailPath();return r.detailPath=s&&s.slice(),r.type=this.type,r}};_p.DOM_DELTA_PIXEL=0,_p.DOM_DELTA_LINE=1,_p.DOM_DELTA_PAGE=2;let BO=class extends RO{constructor(t,e){super(),this.type=t,this.detail=e}};const dX="*",Lu=typeof performance=="object"&&performance.now?performance:Date;function yh(n){return n==="mouse"||n==="pen"}let sdt=class{constructor(t,e){this.dispatch=new us,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(i,r)=>{if(!(i instanceof Do))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(s,"pointerdown"),s.pointerType==="touch")this.dispatchEvent(s,"touchstart");else if(yh(s.pointerType)){const o=s.button===2;this.dispatchEvent(s,o?"rightdown":"mousedown")}this.trackingData(i.pointerId).pressTargetsByButton[i.button]=s.composedPath(),this.freeEvent(s)},this.onPointerMove=(i,r)=>{var s,o;if(!(i instanceof Do))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.createPointerEvent(i,i.type,r),l=yh(a.pointerType),h=this.trackingData(i.pointerId),d=this.findMountedTarget(h.overTargets);if(h.overTargets&&d&&d!==this.rootTarget&&d!==a.target){const u=i.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(i,u,d||void 0);if(this.dispatchEvent(c,"pointerout"),l&&this.dispatchEvent(c,"mouseout"),!a.composedPath().includes(d)){const g=this.createPointerEvent(i,"pointerleave",d||void 0);for(g.eventPhase=g.AT_TARGET;g.target&&!a.composedPath().includes(g.target);)g.currentTarget=g.target,this.notifyTarget(g),l&&this.notifyTarget(g,"mouseleave"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(c)}if(d!==a.target){const u=i.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(a,u);this.dispatchEvent(c,"pointerover"),l&&this.dispatchEvent(c,"mouseover");let g=d==null?void 0:d.parent;for(;g&&g!==this.rootTarget.parent&&g!==a.target;)g=g.parent;if(!g||g===this.rootTarget.parent){const p=this.clonePointerEvent(a,"pointerenter");p.eventPhase=p.AT_TARGET;let f=p.target;const m=new Set;let v=d;for(;v&&v!==this.rootTarget;)m.add(v),v=v.parent;for(;f&&f!==d&&f!==this.rootTarget.parent;)m.has(f)||(p.currentTarget=f,this.notifyTarget(p),l&&this.notifyTarget(p,"mouseenter")),f=f.parent;this.freeEvent(p)}this.freeEvent(c)}this.dispatchEvent(a,"pointermove"),a.pointerType==="touch"&&this.dispatchEvent(a,"touchmove"),l&&(this.dispatchEvent(a,"mousemove"),this.cursorTarget=a.target,this.cursor=((o=(s=a.target)===null||s===void 0?void 0:s.attribute)===null||o===void 0?void 0:o.cursor)||this.rootTarget.getCursor()),h.overTargets=a.composedPath(),this.freeEvent(a)},this.onPointerOver=(i,r)=>{var s,o;if(!(i instanceof Do))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.trackingData(i.pointerId),l=this.createPointerEvent(i,i.type,r),h=yh(l.pointerType);this.dispatchEvent(l,"pointerover"),h&&this.dispatchEvent(l,"mouseover"),l.pointerType==="mouse"&&(this.cursorTarget=l.target,this.cursor=((o=(s=l.target)===null||s===void 0?void 0:s.attribute)===null||o===void 0?void 0:o.cursor)||this.rootTarget.getCursor());const d=this.clonePointerEvent(l,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),h&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;a.overTargets=l.composedPath(),this.freeEvent(l),this.freeEvent(d)},this.onPointerOut=(i,r)=>{if(!(i instanceof Do))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=this.trackingData(i.pointerId);if(s.overTargets){const o=yh(i.pointerType),a=this.findMountedTarget(s.overTargets),l=this.createPointerEvent(i,"pointerout",a||void 0);this.dispatchEvent(l),o&&this.dispatchEvent(l,"mouseout");const h=this.createPointerEvent(i,"pointerleave",a||void 0);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),o&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;s.overTargets=[],this.freeEvent(l),this.freeEvent(h)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(i,r)=>{var s;if(!(i instanceof Do))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=Lu.now(),a=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(a,"pointerup"),a.pointerType==="touch")this.dispatchEvent(a,"touchend");else if(yh(a.pointerType)){const u=a.button===2;this.dispatchEvent(a,u?"rightup":"mouseup")}const l=this.trackingData(i.pointerId),h=this.findMountedTarget(l.pressTargetsByButton[i.button]);let d=h;if(h&&!a.composedPath().includes(h)){let u=h;for(;u&&!a.composedPath().includes(u);){if(a.currentTarget=u,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch")this.notifyTarget(a,"touchendoutside");else if(yh(a.pointerType)){const c=a.button===2;this.notifyTarget(a,c?"rightupoutside":"mouseupoutside")}u=u.parent}delete l.pressTargetsByButton[i.button],d=u}if(d){const u=this.clonePointerEvent(a,"click");u.target=d,u.path=[],u.detailPath=[],l.clicksByButton[i.button]||(l.clicksByButton[i.button]={clickCount:0,target:u.target,timeStamp:o});const c=l.clicksByButton[i.button];c.target===u.target&&o-c.timeStamp<((s=this._config.clickInterval)!==null&&s!==void 0?s:200)?++c.clickCount:c.clickCount=1,c.target=u.target,c.timeStamp=o,u.detail=c.clickCount,yh(u.pointerType)?(this.dispatchEvent(u,"click"),c.clickCount===2&&this.dispatchEvent(u,"dblclick")):u.pointerType==="touch"&&this._config.supportsTouchEvents&&(this.dispatchEvent(u,"tap"),c.clickCount===2&&this.dispatchEvent(u,"dbltap")),this.dispatchEvent(u,"pointertap"),this.freeEvent(u)}this.freeEvent(a)},this.onPointerUpOutside=(i,r)=>{if(!(i instanceof Do))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=this.trackingData(i.pointerId),o=this.findMountedTarget(s.pressTargetsByButton[i.button]),a=this.createPointerEvent(i,i.type,r);if(o){let l=o;for(;l;)a.currentTarget=l,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch"?this.notifyTarget(a,"touchendoutside"):yh(a.pointerType)&&this.notifyTarget(a,a.button===2?"rightupoutside":"mouseupoutside"),l=l.parent;delete s.pressTargetsByButton[i.button]}this.freeEvent(a)},this.onWheel=(i,r)=>{if(!(i instanceof _p))return void ge.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const s=this.createWheelEvent(i,r);this.dispatchEvent(s),this.freeEvent(s)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,r)=>i.priority-r.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,r,s,o,a,l;if(!this.rootTarget)return;const h=this.mappingTable[t.type];let d;const u=`${t.canvasX}-${t.canvasY}`;if(!((e=this._prePointTargetCache)===null||e===void 0)&&e[u]&&(!((r=(i=this._prePointTargetCache)===null||i===void 0?void 0:i[u])===null||r===void 0)&&r.stage)&&((o=(s=this._prePointTargetCache)===null||s===void 0?void 0:s[u])===null||o===void 0?void 0:o.stage.renderCount)===((a=this._prePointTargetCache)===null||a===void 0?void 0:a.stageRenderCount)?d=this._prePointTargetCache[u]:(d=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[u]:d,stageRenderCount:(l=d==null?void 0:d.stage.renderCount)!==null&&l!==void 0?l:-1})),h)for(let c=0,g=h.length;c<g;c++)h[c].fn(t,d);else ge.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,s=i.length-1;r<s;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=e??t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var r,s;const o=this.allocateEvent(Do);return this.copyPointerData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=i||this.pickTarget((r=o.viewX)!==null&&r!==void 0?r:o.global.x,(s=o.viewY)!==null&&s!==void 0?s:o.global.y,o),typeof e=="string"&&(o.type=e),o}createWheelEvent(t,e){var i,r;const s=this.allocateEvent(_p);return this.copyWheelData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=e||this.pickTarget((i=s.viewX)!==null&&i!==void 0?i:s.global.x,(r=s.viewY)!==null&&r!==void 0?r:s.global.y,s),s}clonePointerEvent(t,e){const i=this.allocateEvent(Do);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();const r=t.composedDetailPath();return i.detailPath=r&&r.slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Do&&e instanceof Do&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof dS&&e instanceof dS&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach(i=>{e[i].x=t[i].x,e[i].y=t[i].y}))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=Lu.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=((e=this.eventPool.get(t))===null||e===void 0?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),(e=this.eventPool.get(i))===null||e===void 0||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let r=0,s=i.length;r<s&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeEventListener(e,i[r].fn,{once:!0}),i[r].fn.call(i[r].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events[dX];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let r=0,s=i.length;r<s&&!t.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,t,e)}pickTarget(t,e,i){let r;const s=this.rootTarget.pick(t,e);return r=s&&s.graphic?s.graphic:s&&s.group?s.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=s.params),r}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}};const odt={dispatchEvent(n){var t;if(!(n instanceof RO))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=[],n.detailPath&&(n.detailPath=[]),n.target=this,(t=n==null?void 0:n.manager)===null||t===void 0||t.dispatchEvent(n),!n.defaultPrevented},emit(n,t){return this.dispatchEvent(new BO(n,t))}},adt={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};let ldt=class{constructor(t){this.resolution=1,this.onPointerDown=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const u=this.normalizeToPointerData(d);this.autoPreventDefault&&u[0].isNormalized&&(d.cancelable||!("cancelable"in d))&&d.preventDefault();for(let c=0,g=u.length;c<g;c++){const p=u[c],f=this.bootstrapEvent(this.rootPointerEvent,p);this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch"||this.isEventOutsideOfTargetElement(d))return;const u=this.normalizeToPointerData(d);for(let c=0,g=u.length;c<g;c++){const p=this.bootstrapEvent(this.rootPointerEvent,u[c]);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const u=this.isEventOutsideOfTargetViewPort(d)?"outside":"",c=this.normalizeToPointerData(d);for(let g=0,p=c.length;g<p;g++){const f=this.bootstrapEvent(this.rootPointerEvent,c[g]);f.type+=u,this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const u=this.normalizeToPointerData(d);for(let c=0,g=u.length;c<g;c++){const p=this.bootstrapEvent(this.rootPointerEvent,u[c]);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=d=>{const u=this.normalizeWheelEvent(d);this.manager.mapEvent(u)};const{targetElement:e,resolution:i,rootNode:r,global:s,autoPreventDefault:o=!1,clickInterval:a,supportsTouchEvents:l=s.supportsTouchEvents,supportsPointerEvents:h=s.supportsPointerEvents}=t;this.manager=new sdt(r,{clickInterval:a,supportsTouchEvents:l}),this.globalObj=s,this.supportsPointerEvents=h,this.supportsTouchEvents=l,this.supportsMouseEvents=s.supportsMouseEvents,this.applyStyles=s.applyStyles,this.autoPreventDefault=o,this.eventsAdded=!1,this.rootPointerEvent=new Do,this.rootWheelEvent=new _p,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:r}=this;if(this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];s?typeof s=="string"&&i?r.style.cursor=s:typeof s=="function"?s(t):typeof s=="object"&&i&&Object.assign(r.style,s):i&&yt(t)&&!Qr(this.cursorStyles,t)&&(r.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.addEventListener("pointermove",this.onPointerMove,!0),t.addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.addEventListener("mousemove",this.onPointerMove,!0),t.addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.removeEventListener("pointermove",this.onPointerMove,!0),t.removeEventListener("pointerup",this.onPointerUp,!0)):(e.removeEventListener("pointermove",this.onPointerMove,!0),e.removeEventListener("pointerup",this.onPointerUp,!0)),e.removeEventListener("pointerdown",this.onPointerDown,!0),e.removeEventListener("pointerleave",this.onPointerOverOut,!0),e.removeEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.removeEventListener("mousemove",this.onPointerMove,!0),t.removeEventListener("mouseup",this.onPointerUp,!0)):(e.removeEventListener("mousemove",this.onPointerMove,!0),e.removeEventListener("mouseup",this.onPointerUp,!0)),e.removeEventListener("mousedown",this.onPointerDown,!0),e.removeEventListener("mouseout",this.onPointerOverOut,!0),e.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.removeEventListener("touchstart",this.onPointerDown,!0),e.removeEventListener("touchend",this.onPointerUp,!0),e.removeEventListener("touchmove",this.onPointerMove,!0)),e.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const r=(e=this.globalObj)===null||e===void 0?void 0:e.mapToCanvasPoint(t,this.domElement);if(r)return r;let s=0,o=0;if(t.changedTouches){const l=(i=t.changedTouches[0])!==null&&i!==void 0?i:{};s=l.clientX||0,o=l.clientY||0}else s=t.clientX||0,o=t.clientY||0;const a=this.domElement.getBoundingClientRect();return{x:s-a.left,y:o-a.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,r=t.changedTouches.length;i<r;i++){const s=t.changedTouches[i];ce(s.button)&&(s.button=0),ce(s.buttons)&&(s.buttons=1),ce(s.isPrimary)&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),ce(s.width)&&(s.width=s.radiusX||1),ce(s.height)&&(s.height=s.radiusY||1),ce(s.tiltX)&&(s.tiltX=0),ce(s.tiltY)&&(s.tiltY=0),ce(s.pointerType)&&(s.pointerType="touch"),ce(s.pointerId)&&(s.pointerId=s.identifier||0),ce(s.pressure)&&(s.pressure=s.force||.5),ce(s.twist)&&(s.twist=0),ce(s.tangentialPressure)&&(s.tangentialPressure=0),ce(s.layerX)&&(s.layerX=s.offsetX=s.clientX),ce(s.layerY)&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(this.globalObj.supportsMouseEvents&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof PointerEvent))e.push(t);else{const i=t;ce(i.isPrimary)&&(i.isPrimary=!0),ce(i.width)&&(i.width=1),ce(i.height)&&(i.height=1),ce(i.tiltX)&&(i.tiltX=0),ce(i.tiltY)&&(i.tiltY=0),ce(i.pointerType)&&(i.pointerType="mouse"),ce(i.pointerId)&&(i.pointerId=1),ce(i.pressure)&&(i.pressure=.5),ce(i.twist)&&(i.twist=0),ce(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:r}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=r,e.global.x=i,e.global.y=r,e.offset.x=i,e.offset.y=r;const{x:s,y:o}=this.mapToViewportPoint(e);return e.viewport.x=s,e.viewport.y=o,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:r}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=r,t.global.x=i,t.global.y=r,t.offset.x=i,t.offset.y=r;const{x:s,y:o}=this.mapToViewportPoint(t);return t.viewport.x=s,t.viewport.y=o,t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=adt[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=Lu.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),r=i.width(),s=i.height();return!(e.x<r&&e.y<s&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}};var xs;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSE=2]="PAUSE"})(xs||(xs={}));let xk=class uX{static Avaliable(){return!!St.global.getRequestAnimationFrame()}avaliable(){return uX.Avaliable()}tick(t,e){St.global.getRequestAnimationFrame()(()=>{this.released||e(this)})}release(){this.released=!0}getTime(){return Date.now()}},Yz=class cX{static Avaliable(){return!0}avaliable(){return cX.Avaliable()}tick(t,e){this.timerId=setTimeout(()=>{e(this)},t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}},gX=class extends us{set mode(t){this._mode!==t&&(this._mode=t,this.setupTickHandler())}get mode(){return this._mode}constructor(t=[]){super(),this.handleTick=(e,i)=>{const{once:r=!1}=i??{};this.ifCanStop()?this.stop():(this._handlerTick(),r||e.tick(this.interval,this.handleTick))},this._handlerTick=()=>{const e=this.tickerHandler.getTime();let i=0;this.lastFrameTime>=0&&(i=e-this.lastFrameTime),this.lastFrameTime=e,this.status===xs.RUNNING&&(this.tickCounts++,this.timelines.forEach(r=>{r.tick(i)}),this.emit("tick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=t,this.autoStop=!0}init(){this.interval=NaN,this.status=xs.INITIAL,St.global.hooks.onSetEnv.tap("default-ticker",()=>{this.initHandler()}),St.global.env&&this.initHandler()}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter(e=>e!==t)}getTimelines(){return this.timelines}initHandler(){if(this._mode)return null;const t=[{mode:"raf",cons:xk},{mode:"timeout",cons:Yz}];for(let e=0;e<t.length;e++)if(t[e].cons.Avaliable()){this.mode=t[e].mode;break}return null}setupTickHandler(){let t;switch(this._mode){case"raf":t=new xk;break;case"timeout":t=new Yz;break;default:ge.getInstance().warn(""),t=new xk}return!!t.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0)}setInterval(t){this.interval=t}getInterval(){return this.interval}setFPS(t){this.setInterval(1e3/t)}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,e=>{this.handleTick(e,{once:!0})})}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,e=>{this.handleTick(e,{once:!0})})}pause(){return this.status!==xs.INITIAL&&(this.status=xs.PAUSE,!0)}resume(){return this.status!==xs.INITIAL&&(this.status=xs.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce((t,e)=>t+e.animateCount,0)===0))}start(t=!1){return this.status===xs.RUNNING||!this.tickerHandler||!t&&(this.status===xs.PAUSE||!this.timelines.length||this.timelines.reduce((e,i)=>e+i.animateCount,0)===0)?!1:(this.status=xs.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=xs.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}release(){this.stop(),this.timelines=[],this.tickerHandler.release(),this.emit("afterTick")}trySyncTickStatus(){this.status===xs.RUNNING&&this._handlerTick()}},Me=class Lm{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return t===0?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return t===0?0:Math.pow(2,10*t-10)}static expoOut(t){return t===1?1:1-Math.pow(2,-10*t)}static expoInOut(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-Lm.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*Lm.bounceIn(2*t):.5*Lm.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(i===0||i===1)return i;const r=e/Ft*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Ft/e)}}static getElasticOut(t,e){return function(i){if(i===0||i===1)return i;const r=e/Ft*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-r)*Ft/e)+1}}static getElasticInOut(t,e){return function(i){const r=e/Ft*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Ft/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-r)*Ft/e)*.5+1}}static registerFunc(t,e){Lm[t]=e}};function hdt(n,t){const e=1/t;let i=1;for(;n>e;)n-=e,i*=-1;const r=i*n/e;return r>0?r:1+r}Me.quadIn=Me.getPowIn(2),Me.quadOut=Me.getPowOut(2),Me.quadInOut=Me.getPowInOut(2),Me.cubicIn=Me.getPowIn(3),Me.cubicOut=Me.getPowOut(3),Me.cubicInOut=Me.getPowInOut(3),Me.quartIn=Me.getPowIn(4),Me.quartOut=Me.getPowOut(4),Me.quartInOut=Me.getPowInOut(4),Me.quintIn=Me.getPowIn(5),Me.quintOut=Me.getPowOut(5),Me.quintInOut=Me.getPowInOut(5),Me.backIn=Me.getBackIn(1.7),Me.backOut=Me.getBackOut(1.7),Me.backInOut=Me.getBackInOut(1.7),Me.elasticIn=Me.getElasticIn(1,.3),Me.elasticOut=Me.getElasticOut(1,.3),Me.elasticInOut=Me.getElasticInOut(1,.3*1.5),Me.easeInOutQuad=n=>(n/=.5)<1?.5*Math.pow(n,2):-.5*((n-=2)*n-2),Me.easeOutElastic=n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((10*n-.75)*t)+1},Me.easeInOutElastic=n=>{const t=2*Math.PI/4.5;return n===0?0:n===1?1:n<.5?-Math.pow(2,20*n-10)*Math.sin((20*n-11.125)*t)/2:Math.pow(2,-20*n+10)*Math.sin((20*n-11.125)*t)/2+1};for(let n=0;n<10;n++)Me[`flicker${n}`]=t=>hdt(t,n);for(let n=2;n<10;n++)Me[`aIn${n}`]=t=>n*t*t+(1-n)*t;let PO=class{constructor(){this.id=Nn.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===gr.END?this.removeAnimate(e):e.status===gr.RUNNING||e.status===gr.INITIAL?(this.animateCount++,e.advance(t)):e.status===gr.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t,e=!0){t._onRemove&&t._onRemove.forEach(i=>i()),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}};const uS=new PO;let EO=class{constructor(t,e,i,r,s){this.from=t,this.to=e,this.duration=i,this.easing=r,this.params=s,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var t;const e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},(t=this.step.prev.getLastProps())!==null&&t!==void 0?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(this.updateCount===0){this.onFirstRun();const r=this.step.getLastProps();Object.keys(r).forEach(s=>{this.subAnimate.animate.validAttr(s)&&(i[s]=r[s])})}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}},ddt=class extends EO{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}},cS=class Im{constructor(t=Nn.GenAutoIncrementId(),e=uS,i){this.id=t,this.timeline=e||uS,this.status=gr.INITIAL,this.tailAnimate=new Xz(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=i}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce((t,e)=>t+e.totalDuration,0)}after(t){const e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach(i=>{e=ti(i.getDuration(),e)}),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){Im.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.totalDuration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t,e=Im.mode){t&&e&rS.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:Yr.ANIMATE_PLAY})}runCb(t){const e=new ddt(()=>{t(this,e.step.prev)});return this.tailAnimate.play(e),this}customInterpolate(t,e,i,r,s,o){const a=Im.interpolateMap.get(t)||Im.interpolateMap.get("");return!!a&&a(t,e,i,r,s,o)}pause(){this.status===gr.RUNNING&&(this.status=gr.PAUSED)}resume(){this.status===gr.PAUSED&&(this.status=gr.RUNNING)}to(t,e,i,r){if(this.tailAnimate.to(t,e,i,r),this.target){const s=this.target.stage;s&&s.renderNextFrame()}return this}from(t,e,i,r){if(this.tailAnimate.from(t,e,i,r),this.target){const s=this.target.stage;s&&s.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}subAnimate(){const t=new Xz(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach(e=>this.preventAttr(e))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach(e=>{e.bind(t)}),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===gr.INITIAL&&(this.status=gr.RUNNING,this._onStart&&this._onStart.forEach(e=>e())),this.setPosition(Math.max(this.rawPosition,0)+t*this.timeScale)&&this.status===gr.RUNNING&&(this.status=gr.END,this._onEnd&&this._onEnd.forEach(e=>e()))}setPosition(t){let e,i=0;const r=this.rawPosition,s=this.subAnimates.reduce((a,l)=>a+l.totalDuration,0);t<0&&(t=0);const o=t>=s;if(o&&(t=s),t===r)return o;for(let a=0;a<this.subAnimates.length&&(e=this.subAnimates[a],!(i+e.totalDuration>=t));a++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),o}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=gr.END}stop(t){t||this.target.onStop(),t==="start"?this.target.onStop(this.getStartProps()):t==="end"?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}};cS.mode=rS.NORMAL,cS.interpolateMap=new Map;let Xz=class{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new Kz(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(e==null||e<0)&&(e=0);const i=t.easing,r=typeof i=="string"?Me[i]:i,s=this._addStep(e,null,r);return s.type=Fg.customAnimate,this._appendProps(t.getEndProps(),s,!1),this._appendCustomAnimate(t,s),this}to(t,e,i,r){(e==null||e<0)&&(e=0);const s=typeof i=="string"?Me[i]:i,o=this._addStep(e,null,s);return o.type=Fg.to,this._appendProps(t,o,!!r&&r.tempProps),o.propKeys||(o.propKeys=Object.keys(o.props)),r&&r.noPreventAttrs||this.target.animates&&this.target.animates.forEach(a=>{a.id!==this.animate.id&&a.preventAttrs(o.propKeys)}),this}from(t,e,i,r){this.to(t,0,i,r);const s={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach(o=>{s[o]=this.getLastPropByName(o,this.stepTail)}),this.to(s,e,i,r),this.stepTail.type=Fg.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return(t=this.stepHead)===null||t===void 0?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){const e=this._addStep(+t,null);e.type=Fg.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){const r=new Kz(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(r),this.stepTail=r,r}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let r=e.prev;const s=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach(a=>{e.props[a]===void 0&&(e.props[a]=this.target.getDefaultAttribute(a))});r.prev;)r.props&&(r.propKeys||(r.propKeys=Object.keys(r.props)),r.propKeys.forEach(a=>{s[a]===void 0&&(s[a]=r.props[a])})),e.propKeys=Object.keys(e.props),r=r.prev;const o=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(s)),e.propKeys.forEach(a=>{if(o[a]===void 0){const l=this.animate.getStartProps();o[a]=l[a]=this.target.getComputedAttribute(a)}}),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;const i=this.duration,r=this.loop,s=this.rawPosition;let o,a,l=!1;const h=(e=this._startAt)!==null&&e!==void 0?e:0;if(t<0&&(t=0),t<h)return this.rawPosition=t,!1;if(t-=h,i<=0&&(l=!0,i<0)||(o=Math.floor(t/i),a=t-o*i,l=t>=r*i+i,l&&(a=i,o=r,t=a*o+i),t===s))return l;const d=!this.reversed!=!(this.bounce&&o%2);return d&&(a=i-a),this._deltaPosition=a-this.position,this.position=a,this.rawPosition=t+h,this.updatePosition(l,d),l}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next;const r=this.position,s=this.duration;if(this.target&&i){let o=i.next;for(;o&&o.position<=r;)i=o,o=i.next;let a=t?s===0?1:r/s:(r-i.position)/i.duration;i.easing&&(a=i.easing(a)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,a,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach(l=>l(i,a))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let r=e.prev;for(;r&&r!==t;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let r=e.next;for(;r&&r!==t;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=r.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&i.props[t]!==void 0)return i.props[t];if(i.customAnimate){const r=i.customAnimate.getEndProps()[t];if(r!==void 0)return r}i=i.prev}return ge.getInstance().warn("step"),e.props[t]}updateTarget(t,e,i){t.props==null&&t.customAnimate==null||this.target.onStep(this,this.animate,t,e,i)}},Kz=class{constructor(t,e,i,r){this.duration=e,this.position=t,this.props=i,this.easing=r}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}};const qz={duration:200,easing:"cubicOut"};var Zz;(function(n){n[n.Top=1]="Top",n[n.Right=2]="Right",n[n.Bottom=4]="Bottom",n[n.Left=8]="Left",n[n.ALL=15]="ALL"})(Zz||(Zz={}));const ul=[!1,!1,!1,!1],udt=n=>{var t;let e=!0;if(Re(n,!0)){for(let i=0;i<4;i++)ul[i]=n,e&&(e=!((t=ul[i])!==null&&t!==void 0&&!t));e=n}else if(Array.isArray(n))for(let i=0;i<4;i++)ul[i]=!!n[i],e&&(e=!!ul[i]);else ul[0]=!1,ul[1]=!1,ul[2]=!1,ul[3]=!1;return{isFullStroke:e,stroke:ul}},em=[0,0,0,0],gS=n=>n?V(n)?n.length===0?0:n.length===1?n[0]:n.length===2?(em[0]=n[0],em[2]=n[0],em[1]=n[1],em[3]=n[1],em):n:n:0,rg=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],ty=[1,2,3,0,1,2,3,0];function EP(n,t,e,i){for(;n>=Ft;)n-=Ft;for(;n<0;)n+=Ft;for(;n>t;)t+=Ft;rg[0].x=e,rg[1].y=e,rg[2].x=-e,rg[3].y=-e;const r=Math.ceil(n/An)%4,s=Math.ceil(t/An)%4;if(i.add(me(n)*e,ee(n)*e),i.add(me(t)*e,ee(t)*e),r!==s||t-n>Kt){let o=!1;for(let a=0;a<ty.length;a++)if(o||r!==ty[a]){if(o&&s===ty[a])break;if(o){const l=rg[ty[a]];i.add(l.x,l.y)}}else{o=!0;const l=rg[r];i.add(l.x,l.y)}}}function Jz(n,t,e){const{x:i,y:r}=JC(n.x,n.y,t.x,t.y,e),{x:s,y:o}=JC(n.x1,n.y1,t.x1,t.y1,e),a=new Yt(i,r,s,o);return a.defined=t.defined,a}function pX(n,t,e){if(!n||!t)return[];Array.isArray(n)||(n=[n]),Array.isArray(t)||(t=[t]);let i=[];if(n.length>t.length){i=t.map(r=>{const s=new Yt(r.x,r.y,r.x1,r.y1);return s.defined=r.defined,s});for(let r=0;r<t.length;r++)i[r]=Jz(n[r],t[r],e)}else{i=t.map(r=>{const s=new Yt(r.x,r.y,r.x1,r.y1);return s.defined=r.defined,s});for(let r=0;r<n.length;r++)i[r]=Jz(n[r],t[r],e)}return i}function ey(n,t){if(V(n)){let e;for(let i=0;i<n.length&&e===void 0;i++)e=n[i][t];return e}return n[t]}let fX=class mX{constructor(t=mX.TimeOut){this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout(()=>{this.appendDuration(Date.now()-this.lastDate),t(0)},this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce((e,i)=>e+i,0)/this.durations.length,1e3/60),1e3/30)}};fX.TimeOut=1e3/60;const Qz=new fX,cdt=(n,t)=>yt(n)&&n[n.length-1]==="%"?t*(Number.parseFloat(n.substring(0,n.length-1))/100):n,Z0=(n,t)=>{const e=cdt(n,t);return isNaN(e)?e:Math.max(t,e)};var t3;(function(n){n[n.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",n[n.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT",n[n.TOP_TO_BOTTOM=2]="TOP_TO_BOTTOM",n[n.BOTTOM_TO_TOP=3]="BOTTOM_TO_TOP",n[n.STROKE=4]="STROKE"})(t3||(t3={}));let e3=class extends EO{constructor(){super(...arguments),this.fromText="",this.toText=""}getEndProps(){return this.valid===!1?{}:{text:this.to}}onBind(){var t,e,i;this.fromText=(e=(t=this.from)===null||t===void 0?void 0:t.text)!==null&&e!==void 0?e:"",this.toText=((i=this.to)===null||i===void 0?void 0:i.text)||"",(!this.toText||V(this.toText)&&this.toText.length===0)&&(this.valid=!1),V(this.toText)&&(this.toText=this.toText.map(r=>(r||"").toString()))}onEnd(){this.target.detachShadow()}onUpdate(t,e,i){if(this.valid===!1)return;const r=this.fromText.length,s=V(this.toText),o=s?this.toText.reduce((l,h)=>l+(h||"").length,0):this.toText.length,a=Math.ceil(r+(o-r)*e);if(s){i.text=[];let l=0;this.toText.forEach(h=>{l+h.length>a?(i.text.push(h.substr(0,a-l)),l=a):(i.text.push(h),l+=h.length)})}else i.text=this.toText.substr(0,a)}};const gdt=n=>{if(!n)return{x:0,y:0,width:0,height:0};let t=D(n.width)?n.x1-n.x:n.width,e=D(n.height)?n.y1-n.y:n.height,i=0,r=0;return t<0?(i=t,t=-t):Number.isNaN(t)&&(t=0),e<0?(r=e,e=-e):Number.isNaN(e)&&(e=0),{x:i,y:r,width:t,height:e}};var Vl;(function(n){n[n.Color255=0]="Color255",n[n.Color1=1]="Color1"})(Vl||(Vl={}));let Xp=class ys{static Get(t,e=Vl.Color1,i=[0,0,0,1]){if(e===Vl.Color1){const o=ys.store1[t];if(o)return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i;const a=Tn.parseColorString(t);if(a){const l=[a.r/255,a.g/255,a.b/255,a.opacity];ys.store1[t]=l,ys.store255[t]=[a.r,a.g,a.b,a.opacity],i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3]}return i}const r=ys.store255[t];if(r)return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i;const s=Tn.parseColorString(t);return s&&(ys.store1[t]=[s.r/255,s.g/255,s.b/255,s.opacity],ys.store255[t]=[s.r,s.g,s.b,s.opacity],i[0]=s.r,i[1]=s.g,i[2]=s.b,i[3]=s.opacity),i}static Set(t,e,i){if(e===Vl.Color1){if(ys.store1[t])return;ys.store1[t]=i,ys.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(ys.store255[t])return;ys.store255[t]=i,ys.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}};Xp.store255={},Xp.store1={};function iy(n,t=!1){return Array.isArray(n)&&J(n[0])?t?`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])},${n[3].toFixed(2)})`:`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])})`:n}function bp(n,t,e,i,r){return Array.isArray(n)&&!J(n[0])||Array.isArray(t)&&!J(t[0])?new Array(4).fill(0).map((s,o)=>i3(V(n)?n[o]:n,V(t)?t[o]:t,e,i)):i3(n,t,e,i,r)}function i3(n,t,e,i,r){if(!n||!t)return n&&iy(n)||t&&iy(t)||!1;let s,o,a=!1,l=!1;if(Array.isArray(n)?s=n:typeof n=="string"?s=Xp.Get(n,Vl.Color255):a=!0,Array.isArray(t)?o=t:typeof t=="string"?o=Xp.Get(t,Vl.Color255):l=!0,a!==l){const h=a?n:t,d=a?t:n,u=Object.assign(Object.assign({},h),{stops:h.stops.map(c=>Object.assign(Object.assign({},c),{color:iy(d)}))});return a?bp(h,u,e,i,r):bp(u,h,e,i,r)}if(a){if(n.gradient===t.gradient){const h=n,d=t,u=h.stops,c=d.stops;if(u.length!==c.length)return!1;if(h.gradient==="linear")return pdt(h,d,e);if(h.gradient==="radial")return fdt(h,d,e);if(h.gradient==="conical")return mdt(h,d,e)}return!1}return r&&r(s,o),iy(vdt(s,o,e),i)}function pdt(n,t,e){const i=n.stops,r=t.stops;return{gradient:"linear",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,stops:new Array(i.length).fill(0).map((s,o)=>({color:LO(i[o].color,r[o].color,e),offset:i[o].offset+(r[o].offset-i[o].offset)*e}))}}function fdt(n,t,e){const i=n.stops,r=t.stops;return{gradient:"radial",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,r0:n.r0+(t.r0-n.r0)*e,r1:n.r1+(t.r1-n.r1)*e,stops:new Array(i.length).fill(0).map((s,o)=>({color:LO(i[o].color,r[o].color,e),offset:i[o].offset+(r[o].offset-i[o].offset)*e}))}}function mdt(n,t,e){const i=n.stops,r=t.stops;return{gradient:"conical",startAngle:n.startAngle+(t.startAngle-n.startAngle)*e,endAngle:n.endAngle+(t.endAngle-n.endAngle)*e,x:n.x+(t.x-n.x)*e,y:n.y+(t.y-n.y)*e,stops:new Array(i.length).fill(0).map((s,o)=>({color:LO(i[o].color,r[o].color,e),offset:i[o].offset+(r[o].offset-i[o].offset)*e}))}}function vdt(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e,n[2]+(t[2]-n[2])*e,n[3]+(t[3]-n[3])*e]}const cl=[0,0,0,0],im=[0,0,0,0];function LO(n,t,e){return Xp.Get(n,Vl.Color255,cl),Xp.Get(t,Vl.Color255,im),`rgba(${Math.round(cl[0]+(im[0]-cl[0])*e)},${Math.round(cl[1]+(im[1]-cl[1])*e)},${Math.round(cl[2]+(im[2]-cl[2])*e)},${cl[3]+(im[3]-cl[3])*e})`}let Yh=class $i{static GetImage(t,e){var i;const r=$i.cache.get(t);r?r.loadState==="fail"?St.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):$i.loadImage(t,e)}static GetSvg(t,e){var i;let r=$i.cache.get(t);r?r.loadState==="fail"?St.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):(r={type:"image",loadState:"init"},$i.cache.set(t,r),r.dataPromise=St.global.loadSvg(t),r.dataPromise?(r.waitingMark=[e],r.dataPromise.then(s=>{var o;r.loadState=s!=null&&s.data?"success":"fail",r.data=s==null?void 0:s.data,(o=r.waitingMark)===null||o===void 0||o.map((a,l)=>{s!=null&&s.data?(r.loadState="success",r.data=s.data,a.imageLoadSuccess(t,s.data)):(r.loadState="fail",a.imageLoadFail(t))}),r.waitingMark&&(r.waitingMark=[])})):(r.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=$i.cache.get(t);return i?i.loadState==="fail"?Promise.reject():i.loadState==="init"||i.loadState==="loading"?i.dataPromise.then(r=>r.data):Promise.resolve(i.data):(i={type:e,loadState:"init"},$i.cache.set(t,i),e==="arrayBuffer"?i.dataPromise=St.global.loadArrayBuffer(t):e==="blob"?i.dataPromise=St.global.loadBlob(t):e==="json"&&(i.dataPromise=St.global.loadJson(t)),i.dataPromise.then(r=>r.data))}static loading(){setTimeout(()=>{if(!$i.isLoading&&$i.toLoadAueue.length){$i.isLoading=!0;const t=$i.toLoadAueue.splice(0,10),e=[];t.forEach(i=>{const{url:r,marks:s}=i,o={type:"image",loadState:"init"};if($i.cache.set(r,o),o.dataPromise=St.global.loadImage(r),o.dataPromise){o.waitingMark=s;const a=o.dataPromise.then(l=>{var h;o.loadState=l!=null&&l.data?"success":"fail",o.data=l==null?void 0:l.data,(h=o.waitingMark)===null||h===void 0||h.map((d,u)=>{l!=null&&l.data?(o.loadState="success",o.data=l.data,d.imageLoadSuccess(r,l.data)):(o.loadState="fail",d.imageLoadFail(r))}),o.waitingMark&&(o.waitingMark=[])});e.push(a)}else o.loadState="fail",s.forEach(a=>a.imageLoadFail(r))}),Promise.all(e).then(()=>{$i.isLoading=!1,this.onLoadSuccessCb.forEach(i=>i()),$i.loading()}).catch(i=>{console.error(i),$i.isLoading=!1,this.onLoadSuccessCb.forEach(r=>r()),$i.loading()})}},0)}static loadImage(t,e){const i=n3(t,$i.toLoadAueue);if(i!==-1)return $i.toLoadAueue[i].marks.push(e),void $i.loading();$i.toLoadAueue.push({url:t,marks:[e]}),$i.loading()}static improveImageLoading(t){const e=n3(t,$i.toLoadAueue);if(e!==-1){const i=$i.toLoadAueue.splice(e,1);$i.toLoadAueue.unshift(i[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}};function n3(n,t){for(let e=0;e<t.length;e++)if(t[e].url===n)return e;return-1}Yh.cache=new Map,Yh.isLoading=!1,Yh.toLoadAueue=[],Yh.onLoadSuccessCb=[];let gn=class{bounds(t,e){if(J(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return J(t)?t:Math.min(t[0],t[1])}};function r3(n,t,e,i,r){return r?n.arc(e,i,t,0,Ci,!1,r):n.arc(e,i,t,0,Ci),!1}let _dt=class extends gn{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,r,s){return r3(t,this.parseSize(e)/2,i,r,s)}drawOffset(t,e,i,r,s,o){return r3(t,this.parseSize(e)/2+s,i,r,o)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e-s}, ${i} a ${s},${s} 0 1,0 ${2*s},0 a ${s},${s} 0 1,0 -${2*s},0`}};const bdt=new _dt;function ydt(n,t,e,i,r){return n.moveTo(-3*t+e,-t+i,r),n.lineTo(-t+e,-t+i,r),n.lineTo(-t+e,-3*t+i,r),n.lineTo(t+e,-3*t+i,r),n.lineTo(t+e,-t+i,r),n.lineTo(3*t+e,-t+i,r),n.lineTo(3*t+e,t+i,r),n.lineTo(t+e,t+i,r),n.lineTo(t+e,3*t+i,r),n.lineTo(-t+e,3*t+i,r),n.lineTo(-t+e,t+i,r),n.lineTo(-3*t+e,t+i,r),n.closePath(),!0}function Cdt(n,t,e,i,r,s){return n.moveTo(-3*t+e-r,-t+i-r,s),n.lineTo(-t+e-r,-t+i-r,s),n.lineTo(-t+e-r,-3*t+i-r,s),n.lineTo(t+e+r,-3*t+i-r,s),n.lineTo(t+e+r,-t+i-r,s),n.lineTo(3*t+e+r,-t+i-r,s),n.lineTo(3*t+e+r,t+i+r,s),n.lineTo(t+e+r,t+i+r,s),n.lineTo(t+e+r,3*t+i+r,s),n.lineTo(-t+e-r,3*t+i+r,s),n.lineTo(-t+e-r,t+i+r,s),n.lineTo(-3*t+e-r,t+i+r,s),n.closePath(),!0}let Sdt=class extends gn{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,r,s){return ydt(t,this.parseSize(e)/6,i,r,s)}drawOffset(t,e,i,r,s,o){return Cdt(t,this.parseSize(e)/6,i,r,s,o)}};const xdt=new Sdt;function wk(n,t,e,i,r){return n.moveTo(e,i-t,r),n.lineTo(t+e,i,r),n.lineTo(e,i+t,r),n.lineTo(e-t,i,r),n.closePath(),!0}let wdt=class extends gn{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,r,s){return wk(t,this.parseSize(e)/2,i,r,s)}drawFitDir(t,e,i,r,s){return wk(t,this.parseSize(e)/2,i,r,s)}drawOffset(t,e,i,r,s,o){return wk(t,this.parseSize(e)/2+s,i,r,o)}};const Adt=new wdt;function s3(n,t,e,i){const r=2*t;return n.rect(e-t,i-t,r,r),!1}let Mdt=class extends gn{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,r){return s3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return s3(t,this.parseSize(e)/2+s,i,r)}};const Tdt=new Mdt;function o3(n,t,e,i,r=0){return n.moveTo(e+t+2*r,t+i+r),n.lineTo(e-t-2*r,t+i+r),n.lineTo(e,i-t-2*r),n.closePath(),!0}let vX=class extends gn{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,r){return o3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return o3(t,this.parseSize(e)/2,i,r,s)}};const kdt=new vX;let Rdt=class extends vX{constructor(){super(...arguments),this.type="triangle"}};const Bdt=new Rdt,_X=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),Pdt=Math.sin(Ci/10)*_X,Edt=-Math.cos(Ci/10)*_X;function a3(n,t,e,i){const r=Pdt*t,s=Edt*t;n.moveTo(e,-t+i),n.lineTo(r+e,s+i);for(let o=1;o<5;++o){const a=Ci*o/5,l=Math.cos(a),h=Math.sin(a);n.lineTo(h*t+e,-l*t+i),n.lineTo(l*r-h*s+e,h*r+l*s+i)}return n.closePath(),!0}let Ldt=class extends gn{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,r){return a3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return a3(t,this.parseSize(e)/2+s,i,r)}};const Idt=new Ldt,Odt=Rn(3);function l3(n,t,e,i){const r=t,s=r/Odt,o=s/5,a=t;return n.moveTo(0+e,-r+i),n.lineTo(s/2+e,i),n.lineTo(o/2+e,i),n.lineTo(o/2+e,a+i),n.lineTo(-o/2+e,a+i),n.lineTo(-o/2+e,i),n.lineTo(-s/2+e,i),n.closePath(),!0}let Ddt=class extends gn{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,r){return l3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return l3(t,this.parseSize(e)/2+s,i,r)}};const Fdt=new Ddt;function h3(n,t,e,i){const r=2*t;return n.moveTo(e,-t+i),n.lineTo(r/3/2+e,t+i),n.lineTo(-r/3/2+e,t+i),n.closePath(),!0}let Hdt=class extends gn{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,r){return h3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return h3(t,this.parseSize(e)/2+s,i,r)}};const zdt=new Hdt;function d3(n,t,e,i){return n.moveTo(-t+e,i),n.lineTo(e,t+i),!1}let Wdt=class extends gn{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,r){return d3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return d3(t,this.parseSize(e)/2+s,i,r)}};const jdt=new Wdt,Xs=-.5,Ks=Rn(3)/2,u3=1/Rn(12);function c3(n,t,e,i){const r=t/2,s=t*u3,o=r,a=t*u3+t,l=-o,h=a;return n.moveTo(r+e,s+i),n.lineTo(o+e,a+i),n.lineTo(l+e,h+i),n.lineTo(Xs*r-Ks*s+e,Ks*r+Xs*s+i),n.lineTo(Xs*o-Ks*a+e,Ks*o+Xs*a+i),n.lineTo(Xs*l-Ks*h+e,Ks*l+Xs*h+i),n.lineTo(Xs*r+Ks*s+e,Xs*s-Ks*r+i),n.lineTo(Xs*o+Ks*a+e,Xs*a-Ks*o+i),n.lineTo(Xs*l+Ks*h+e,Xs*h-Ks*l+i),n.closePath(),!1}let Ndt=class extends gn{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,r){return c3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return c3(t,this.parseSize(e)/2+s,i,r)}};const $dt=new Ndt;function g3(n,t,e,i,r){return n.moveTo(-t+e-2*r,i),n.lineTo(t+e+r,t+i+2*r),n.lineTo(t+e+r,i-t-2*r),n.closePath(),!0}let Vdt=class extends gn{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,r){return g3(t,this.parseSize(e)/2,i,r,0)}drawOffset(t,e,i,r,s){return g3(t,this.parseSize(e)/2,i,r,s)}};const Gdt=new Vdt;function p3(n,t,e,i,r=0){return n.moveTo(e-t-r,t+i+2*r),n.lineTo(t+e+2*r,i),n.lineTo(e-t-r,i-t-2*r),n.closePath(),!0}let Udt=class extends gn{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,r){return p3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return p3(t,this.parseSize(e)/2,i,r,s)}};const Ydt=new Udt;function f3(n,t,e,i,r=0){return n.moveTo(e-t-2*r,i-t-r),n.lineTo(e+t+2*r,i-t-r),n.lineTo(e,i+t+2*r),n.closePath(),!0}let Xdt=class extends gn{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,r){return f3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return f3(t,this.parseSize(e)/2,i,r,s)}};const Kdt=new Xdt,LP=Rn(3);function m3(n,t,e,i){const r=t*LP;return n.moveTo(e,i+-r/3*2),n.lineTo(t+e,i+r),n.lineTo(e-t,i+r),n.closePath(),!0}let qdt=class extends gn{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,r){return m3(t,this.parseSize(e)/2/LP,i,r)}drawOffset(t,e,i,r,s){return m3(t,this.parseSize(e)/2/LP+s,i,r)}};const Zdt=new qdt;function v3(n,t,e,i){const r=2*t;return n.moveTo(t+e,i-r),n.lineTo(e-t,i),n.lineTo(t+e,r+i),!0}let Jdt=class extends gn{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,r){return v3(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return v3(t,this.parseSize(e)/4+s,i,r)}};const Qdt=new Jdt;function _3(n,t,e,i){const r=2*t;return n.moveTo(e-t,i-r),n.lineTo(e+t,i),n.lineTo(e-t,r+i),!0}let tut=class extends gn{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,r){return _3(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return _3(t,this.parseSize(e)/4+s,i,r)}};const eut=new tut;function b3(n,t,e,i){const r=2*t;return n.moveTo(e-r,i+t),n.lineTo(e,i-t),n.lineTo(e+r,i+t),!0}let iut=class extends gn{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,r){return b3(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return b3(t,this.parseSize(e)/4+s,i,r)}};const nut=new iut;function y3(n,t,e,i){const r=2*t;return n.moveTo(e-r,i-t),n.lineTo(e,i+t),n.lineTo(e+r,i-t),!0}let rut=class extends gn{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,r){return y3(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return y3(t,this.parseSize(e)/4+s,i,r)}};const sut=new rut;function C3(n,t,e,i,r){return n.moveTo(e,i-t),n.lineTo(e,i+t),!0}let out=class extends gn{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,r,s){return C3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s,o){return C3(t,this.parseSize(e)/2+s,i,r)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e}, ${i-s} L ${e},${i+s}`}};const aut=new out;function S3(n,t,e,i,r){return n.moveTo(e-t,i),n.lineTo(e+t,i),!0}let lut=class extends gn{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,r,s){return S3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s,o){return S3(t,this.parseSize(e)/2+s,i,r)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e-s}, ${i} L ${e+s},${i}`}};const hut=new lut;function x3(n,t,e,i,r){return n.moveTo(e-t,i-t),n.lineTo(e+t,i+t),n.moveTo(e+t,i-t),n.lineTo(e-t,i+t),!0}let dut=class extends gn{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,r,s){return x3(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s,o){return x3(t,this.parseSize(e)/2+s,i,r)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e-s}, ${i-s} L ${e+s},${i+s} M ${e+s}, ${i-s} L ${e-s},${i+s}`}};const uut=new dut;function w3(n,t,e,i){return n.rect(e-t[0]/2,i-t[1]/2,t[0],t[1]),!1}function A3(n,t,e,i){const r=t,s=t/2;return n.rect(e-r/2,i-s/2,r,s),!1}let cut=class extends gn{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,r){return J(e)?A3(t,e,i,r):w3(t,e,i,r)}drawWithClipRange(t,e,i,r,s,o,a){J(e)&&(e=[e,e/2]);const l=2*(e[0]+e[1])*s,h=[{x:i+e[0]/2,y:r-e[1]/2},{x:i+e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r-e[1]/2}];let d=0,u=h[3];t.moveTo(u.x,u.y);for(let c=0;c<h.length;c++){const g=h[c],p=Math.sqrt((g.x-u.x)*(g.x-u.x)+(g.y-u.y)*(g.y-u.y));if(d+p>l){const f=(g.x-u.x)*(l-d)/p,m=(g.y-u.y)*(l-d)/p;t.lineTo(u.x+f,u.y+m);break}t.lineTo(g.x,g.y),u=g,d+=p}return!1}drawOffset(t,e,i,r,s){return J(e)?A3(t,e+2*s,i,r):w3(t,[e[0]+2*s,e[1]+2*s],i,r)}};const gut=new cut,nm=new ie;let M3=class{constructor(t,e,i=!1){this.pathStr="",this.type=t,V(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,r,s,o,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{t.beginPath(),Ql(l.path.commandList,t,i,r,e,e),a&&a(l.path,l.attribute)}),!1):(Ql(this.path.commandList,t,i,r,e+s,e+s),!1)}draw(t,e,i,r,s,o){return e=this.parseSize(e),this.drawOffset(t,e,i,r,0,s,o)}parseSize(t){return J(t)?t:Math.min(t[0],t[1])}drawWithClipRange(t,e,i,r,s,o,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{l.path.drawWithClipRange(t,e,i,r,s),a&&a(l.path,l.attribute)}),!1):(this.path.drawWithClipRange(t,e,i,r,s),!1)}bounds(t,e){if(t=this.parseSize(t),this.isSvg)return this.svgCache?(e.clear(),void this.svgCache.forEach(({path:i})=>{nm.x1=i.bounds.x1*t,nm.y1=i.bounds.y1*t,nm.x2=i.bounds.x2*t,nm.y2=i.bounds.y2*t,e.union(nm)})):void 0;this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}};const put=[bdt,xdt,Adt,Tdt,Zdt,Bdt,Idt,Fdt,zdt,jdt,$dt,Gdt,Ydt,kdt,Kdt,Qdt,eut,nut,sut,gut,aut,hut,uut],bX={};put.forEach(n=>{bX[n.type]=n});const fut={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"};function mut(n,t){const e=[];let i=t.exec(n);for(;i;){const r=[];r.startIndex=t.lastIndex-i[0].length;const s=i.length;for(let o=0;o<s;o++)r.push(i[o]);e.push(r),i=t.exec(n)}return e}let Ak=class{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}};function T3(n,t,e,i){const r=n.indexOf(t,e);if(r===-1)throw new Error(i);return r+t.length-1}function vut(n,t,e=">"){let i,r="";for(let s=t;s<n.length;s++){let o=n[s];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===e[0]){if(!e[1])return{data:r,index:s};if(n[s+1]===e[1])return{data:r,index:s}}else o==="	"&&(o=" ");r+=o}}function k3(n,t,e,i=">"){const r=vut(n,t+1,i);if(!r)return;let s=r.data;const o=r.index,a=s.search(/\s/);let l=s,h=!0;return a!==-1&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:h,rawTagName:l}}const _ut=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");let but=class{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const r=e.tagname;typeof r=="string"&&(e.tagname=r),t.addChild(e)}buildAttributesMap(t,e,i){const r={};if(!t)return;const s=mut(t,_ut),o=s.length;for(let a=0;a<o;a++){const l=s[a][1],h=s[a][4],d=l;l&&(r[d]=h===void 0||(isNaN(h)?h:Number(h)))}return r}parseXml(t){t=t.replace(/\r\n?/g,`
`);const e=new Ak("!xml");let i=e,r="",s="";for(let o=0;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="/"){const a=T3(t,">",o,"Closing Tag is not closed."),l=s.lastIndexOf(".");s=s.substring(0,l),i=this.tagsNodeStack.pop(),i&&i.child&&r&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=r),r="",o=a}else if(t[o+1]==="?")o=k3(t,o,!1,"?>").closeIndex+1;else if(t.substr(o+1,3)==="!--")o=T3(t,"-->",o+4,"Comment is not closed.");else{const a=k3(t,o);let l=a.tagName,h=a.tagExp;const d=a.attrExpPresent,u=a.closeIndex;if(l!==e.tagname&&(s+=s?"."+l:l),h.length>0&&h.lastIndexOf("/")===h.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),s=s.substr(0,s.length-1),h=l):h=h.substr(0,h.length-1);const c=new Ak(l);l!==h&&d&&(c[":@"]=this.buildAttributesMap(h,s,l)),this.addChild(i,c,s),s=s.substr(0,s.lastIndexOf("."))}else{const c=new Ak(l);this.tagsNodeStack.push(i),l!==h&&d&&(c[":@"]=this.buildAttributesMap(h,s,l)),this.addChild(i,c,s),i=c}r="",o=u}else r+=t[o];return e.child}};function yut(n,t){return yX(n)}function yX(n,t){const e={};for(let i=0;i<n.length;i++){const r=n[i],s=Cut(r);if(s!==void 0&&r[s]){const o=yX(r[s]);xut(o),r[":@"]&&Sut(o,r[":@"]),e[s]!==void 0&&e.hasOwnProperty(s)?(Array.isArray(e[s])||(e[s]=[e[s]]),e[s].push(o)):e[s]=o}}return e}function Cut(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function Sut(n,t,e){if(t){const i=Object.keys(t),r=i.length;for(let s=0;s<r;s++){const o=i[s];n[o]=t[o]}}}function xut(n){return Object.keys(n).length===0}let CX=class SX{constructor(t){this.options=Object.assign({},SX.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;const e=new but(this.options).parseXml(t);return yut(e,this.options)}};CX.defaultOptions={};function wut(n){return n.startsWith("<svg")||n.startsWith("<?xml")}function pS(n,t,e,i=0){return n.expand(t+(i/2+(e?Aut(e,t):0))),n}function Aut(n,t){return n?t:0}let Mut=0;function Xn(){return Mut++}var yp;(function(n){n[n.HORIZONTAL=0]="HORIZONTAL",n[n.VERTICAL=1]="VERTICAL"})(yp||(yp={}));function Tut(n){const t=[];let e=0,i="";for(let r=0;r<n.length;r++)But(n[r])?e?i+=n[r]:(e=1,i=n[r]):(e&&(t.push({text:i,direction:yp.VERTICAL}),i="",e=0),t.push({text:n[r],direction:yp.HORIZONTAL}));return i&&t.push({text:i,direction:yp.VERTICAL}),t}const kut=["","","","","","","","","",""],xX=new Map;kut.forEach(n=>xX.set(n,!0));const Rut=[""],wX=new Map;function But(n){if(xX.has(n))return!0;if(wX.has(n))return!1;let t=!1;return n.codePointAt(0)<256&&(t=!0),t}Rut.forEach(n=>wX.set(n,!0));const QA=Xn(),Put=Xn(),AX=Xn(),tM=Xn();Xn();const IO=Xn(),eM=Xn(),J0=Xn(),iM=Xn(),nM=Xn();Xn();const OO=Xn();Xn();const DO=Xn();Xn();const rM=Xn(),sM=Xn(),MX=Symbol.for("GraphicService"),TX=Symbol.for("GraphicCreator"),kX={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},Eut=Object.keys(kX),ny=new ie,Lut=new Pe;new ie;const wo=["lineWidth","scaleX","scaleY","angle","anchor","visible"],R3=["x","y"],B3=["scaleX","scaleY"],P3=["angle"],rm=new Yt,da={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};let js=class Om extends rdt{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(Om.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(t={}){var e;super(),this._AABBBounds=new ie,this._updateTag=pi.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage((e=t.background.background)!==null&&e!==void 0?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t,e=!1){var i,r;const{dx:s=t.dx,dy:o=t.dy}=this.attribute;if(e&&this.parent){const a=this.parent.attribute;rm.x=s+((i=a.scrollX)!==null&&i!==void 0?i:0),rm.y=o+((r=a.scrollY)!==null&&r!==void 0?r:0)}else rm.x=s,rm.y=o;return rm}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(){const t=this.attribute.boundsMode==="imprecise";if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;St.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return St.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),this.attribute.boundsMode==="empty"&&e.clear(),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new qA),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){const{clipConfig:t}=this.attribute;if(!t)return null;this.clipPathMap||(this.clipPathMap=new Map);const{shape:e}=t;let i=this.clipPathMap.get(e)||null;return i||(this.clipPathMap.size>10&&this.clipPathMap.clear(),i=this.parsePath(e),i&&this.clipPathMap.set(e,i)),i}parsePath(t){if(!t)return null;let e=bX[t];if(e||(e=Om.userSymbolMap[t],e))return e;const i=fut[t];if(wut(t=i||t)===!0){const h=new CX,{svg:d}=h.parse(t);if(!d)return null;const u=V(d.path)?d.path:[d.path];ny.clear();const c=[];u.forEach(v=>{const _=new Gn().fromString(v.d),b={};Eut.forEach(y=>{v[y]&&(b[kX[y]]=v[y])}),c.push({path:_,attribute:b}),ny.union(_.bounds)});const g=ny.width(),p=ny.height(),f=1/ti(g,p);c.forEach(v=>v.path.transform(0,0,f,f));const m=new M3(t,c,!0);return Om.userSymbolMap[t]=m,m}const r=new Gn().fromString(t),s=r.bounds.width(),o=r.bounds.height(),a=1/ti(s,o);r.transform(0,0,a,a);const l=new M3(t,r);return Om.userSymbolMap[t]=l,l}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;const e=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,r=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:s=e.boundsPadding}=i,o=gS(s);return o&&r.expand(o),this.clearUpdateBoundTag(),r}updatePathProxyAABBBounds(t){const e=typeof this.pathProxy=="function"?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;const i=new AO(t);return Ql(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(t=!0){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(t=!0){return this._transMatrix||(this._transMatrix=new Pe),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&pi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&St.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&pi.UPDATE_BOUNDS)&&St.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&pi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&pi.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&pi.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite(((t=i.x)!==null&&t!==void 0?t:0)+((e=i.y)!==null&&e!==void 0?e:0))}_validNumber(t){return t==null||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&pi.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=pi.CLEAR_SHAPE}containsPoint(t,e,i,r){if(!r)return!1;if(i===R_.GLOBAL){const s=new Yt(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(s,s),t=s.x,e=s.y}return r.containsPoint(this,{x:t,y:e})}setWidthHeightWithoutTransform(t){this.widthWithoutTransform=t.x2-t.x1,this.heightWithoutTransform=t.y2-t.y1}setAttributes(t,e=!1,i){(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i)}_setAttributes(t,e=!1,i){const r=Object.keys(t);for(let s=0;s<r.length;s++){const o=r[s];this.attribute[o]=t[o]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,r){var s;const o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);o?this._setAttributes(o,i,r):D((s=this.normalAttrs)===null||s===void 0?void 0:s[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[t]=e,t==="background"?this.loadImage(e,!0):t==="shadowGraphic"&&this.setShadowGraphic(e)}needUpdateTags(t,e=wo){for(let i=0;i<e.length;i++){const r=e[i];if(t.indexOf(r)!==-1)return!0}return!1}needUpdateTag(t,e=wo){for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:Yr.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=pi.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,r;if(t===0&&e===0)return this;const s={type:Yr.TRANSLATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,R3,s);o&&(t=o.x,e=o.y,delete o.x,delete o.y,this._setAttributes(o));const a=this.attribute,l=a.postMatrix;return l?St.transformUtil.fromMatrix(l,l).translate(t,e):(a.x=((i=a.x)!==null&&i!==void 0?i:Fn.x)+t,a.y=((r=a.y)!==null&&r!==void 0?r:Fn.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const r={type:Yr.TRANSLATE_TO},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,R3,r);return s?(this._setAttributes(s,!1,r),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(t,e,i){var r,s;if(t===1&&e===1)return this;const o={type:Yr.SCALE},a=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,B3,o);a&&(t=a.scaleX,e=a.scaleY,delete a.scaleX,delete a.scaleY,this._setAttributes(a));const l=this.attribute;if(i){let{postMatrix:h}=this.attribute;h||(h=new Pe,l.postMatrix=h),St.transformUtil.fromMatrix(h,h).scale(t,e,i)}else l.scaleX=((r=l.scaleX)!==null&&r!==void 0?r:Fn.scaleX)*t,l.scaleY=((s=l.scaleY)!==null&&s!==void 0?s:Fn.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const r={type:Yr.SCALE_TO},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,B3,r);return s?(this._setAttributes(s,!1,r),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(t,e){var i;if(t===0)return this;const r={type:Yr.ROTATE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,P3,r);s&&(delete s.angle,this._setAttributes(s,!1,r));const o=this.attribute;if(e){let{postMatrix:a}=this.attribute;a||(a=new Pe,o.postMatrix=a),St.transformUtil.fromMatrix(a,a).rotate(t,e)}else o.angle=((i=o.angle)!==null&&i!==void 0?i:Fn.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:Yr.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,P3,i);return r?(this._setAttributes(r,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){var e;this.animates||(this.animates=new Map);const i=new cS(t==null?void 0:t.id,(e=t==null?void 0:t.timeline)!==null&&e!==void 0?e:this.stage&&this.stage.getTimeline(),t==null?void 0:t.slience);if(i.bind(this),t){const{onStart:r,onFrame:s,onEnd:o,onRemove:a}=t;r!=null&&i.onStart(r),s!=null&&i.onFrame(s),o!=null&&i.onEnd(o),a!=null&&i.onRemove(a),i.interpolateFunc=t.interpolate}return this.animates.set(i.id,i),i.onRemove(()=>{i.stop(),this.animates.delete(i.id)}),i}onAttributeUpdate(t){t&&t.skipUpdateCallback||(St.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!D(t)||this.currentStates.includes(t))}getState(t){var e;return(e=this.states)===null||e===void 0?void 0:e[t]}applyStateAttrs(t,e,i,r){var s,o,a,l;if(i){const h=Object.keys(t),d=this.getNoWorkAnimateAttr(),u={};let c;h.forEach(p=>{d[p]?(c||(c={}),c[p]=t[p]):u[p]=r&&t[p]===void 0?this.getDefaultAttribute(p):t[p]});const g=this.animate({slience:!0});g.stateNames=e,g.to(u,(o=(s=this.stateAnimateConfig)===null||s===void 0?void 0:s.duration)!==null&&o!==void 0?o:qz.duration,(l=(a=this.stateAnimateConfig)===null||a===void 0?void 0:a.easing)!==null&&l!==void 0?l:qz.easing),c&&this.setAttributes(c,!1,{type:Yr.STATE})}else this.stopStateAnimates(),this.setAttributes(t,!1,{type:Yr.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach(i=>{i in this.normalAttrs?(e[i]=this.normalAttrs[i],delete this.normalAttrs[i]):e[i]=this.getNormalAttribute(i)}),Object.keys(this.normalAttrs).forEach(i=>{t[i]=this.normalAttrs[i]})):Object.keys(t).forEach(i=>{e[i]=this.getNormalAttribute(i)}),this.normalAttrs=e}stopStateAnimates(t="end"){this.animates&&this.animates.forEach(e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))})}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach(i=>{if(i.stateNames){const r=i.getEndProps();Qr(r,t)&&(e=r[t])}}),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if(this.currentStates){const i=V(t)?s=>!t.includes(s):s=>s!==t,r=this.currentStates.filter(i);r.length!==this.currentStates.length&&this.useStates(r,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var r;if(this.currentStates&&this.currentStates.includes(t)&&(e||this.currentStates.length===1))return;const s=e&&(!((r=this.currentStates)===null||r===void 0)&&r.length)?this.currentStates.concat([t]):[t];this.useStates(s,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some((s,o)=>this.currentStates[o]!==s)))return;const r={};t.forEach(s=>{var o;const a=this.stateProxy?this.stateProxy(s,t):(o=this.states)===null||o===void 0?void 0:o[s];a&&Object.assign(r,a)}),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}addUpdateBoundTag(){this._updateTag|=pi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=pi.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=pi.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&pi.UPDATE_SHAPE_AND_BOUNDS)===pi.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=pi.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=pi.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=pi.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=pi.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=pi.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=pi.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=pi.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&pi.UPDATE_LAYOUT)}getAnchor(t,e,i){const r=[0,0],s=()=>{if(e.b)return e.b;const o=this.clone();return o.attribute.angle=0,o.attribute.scaleCenter=null,i&&(o.attribute.scaleX=1,o.attribute.scaleY=1),e.b=o.AABBBounds,e.b};if(typeof t[0]=="string"){const o=parseFloat(t[0])/100,a=s();r[0]=a.x1+(a.x2-a.x1)*o}else r[0]=t[0];if(typeof t[1]=="string"){const o=parseFloat(t[1])/100,a=s();r[1]=a.y1+(a.y2-a.y1)*o}else r[1]=t[1];return r}doUpdateLocalMatrix(){const{x:t=Fn.x,y:e=Fn.y,scaleX:i=Fn.scaleX,scaleY:r=Fn.scaleY,angle:s=Fn.angle,scaleCenter:o,anchor:a,postMatrix:l}=this.attribute;let h=[0,0];const d={};if(a&&s&&(h=this.getAnchor(a,d)),!o||i===1&&r===1)LY(this._transMatrix,this._transMatrix.reset(),t,e,i,r,s,a&&h);else{const c=this._transMatrix;c.reset(),c.translate(h[0],h[1]),c.rotate(s),c.translate(-h[0],-h[1]),c.translate(t,e),h=this.getAnchor(o,d,!0),St.transformUtil.fromMatrix(c,c).scale(i,r,{x:h[0],y:h[1]})}const u=this.getOffsetXY(Fn);if(this._transMatrix.e+=u.x,this._transMatrix.f+=u.y,l){const c=Lut.setValue(l.a,l.b,l.c,l.d,l.e,l.f),g=this._transMatrix;c.multiply(g.a,g.b,g.c,g.d,g.e,g.f),g.setValue(c.a,c.b,c.c,c.d,c.e,c.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const i=t.getTimeline();this.animates.forEach(r=>{r.timeline===uS&&r.setTimeline(i)})}this._onSetStage&&this._onSetStage(this,t,e),St.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:Yr.ANIMATE_END})}onStep(t,e,i,r,s){const o={};if(i.customAnimate)i.customAnimate.update(s,r,o);else{const a=i.props,l=i.parsedProps,h=i.propKeys;this.stepInterpolate(t,e,o,i,r,s,a,void 0,l,h)}this.setAttributes(o,!1,{type:Yr.ANIMATE_UPDATE,animationState:{ratio:r,end:s,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,r,s,o,a,l,h,d){d||(d=Object.keys(a),r.propKeys=d),o?r.propKeys.forEach(u=>{e.validAttr(u)&&(i[u]=a[u])}):d.forEach(u=>{var c;if(!e.validAttr(u))return;const g=a[u],p=(c=l&&l[u])!==null&&c!==void 0?c:t.getLastPropByName(u,r);if(g==null||p==null||g===p)return void(i[u]=g);let f;f=e.interpolateFunc&&e.interpolateFunc(u,s,p,g,i),f||(f=e.customInterpolate(u,s,p,g,this,i),f||this.defaultInterpolate(g,p,u,i,h,s)||this._interpolate(u,s,p,g,i))}),r.parsedProps=h}defaultInterpolate(t,e,i,r,s,o){if(Number.isFinite(t)&&Number.isFinite(e))return r[i]=e+(t-e)*o,!0;if(i==="fill"){s||(s={});const a=s.fillColorArray,l=bp(e,a??t,o,!1,(h,d)=>{s.fillColorArray=d});return l&&(r[i]=l),!0}if(i==="stroke"){s||(s={});const a=s.strokeColorArray,l=bp(e,a??t,o,!1,(h,d)=>{s.strokeColorArray=d});return l&&(r[i]=l),!0}if(i==="shadowColor"){s||(s={});const a=s.shadowColorArray,l=bp(e,a??t,o,!0,(h,d)=>{s.shadowColorArray=d});return l&&(r[i]=l),!0}if(Array.isArray(t)&&t.length===e.length){const a=[];let l=!0;for(let h=0;h<t.length;h++){const d=e[h],u=d+(t[h]-d)*o;if(!Number.isFinite(u)){l=!1;break}a.push(u)}l&&(r[i]=a)}return!1}_interpolate(t,e,i,r,s){}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return(e=this.attribute[t])!==null&&e!==void 0?e:this.getDefaultAttribute(t)}onSetStage(t,e=!1){this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=t??St.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot.release(!0),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map(t=>t.toJson())}}createPathProxy(t){return yt(t,!0)?this.pathProxy=new Gn().fromString(t):this.pathProxy=new Gn,this.pathProxy}loadImage(t,e=!1){if(!t||e&&Iut(t))return;const i=t;this.resources||(this.resources=new Map);const r={data:"init",state:null};this.resources.set(i,r),typeof t=="string"?(r.state="loading",t.startsWith("<svg")?(Yh.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(mO(t)||t.includes("/")||vO(t))&&(Yh.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):kt(t)?(r.state="success",r.data=t,this.backgroundImg=this.backgroundImg||e):r.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;const r=this.resources.get(t);r&&(r.state="success",r.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach(e=>{e.stop()})}stopAnimates(t=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren(e=>{e.stopAnimates(t)})}release(){this.releaseStatus="released",this.stopAnimates(),St.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,r;if(this._events&&t in this._events){const s=new BO(t,e);s.bubbles=!1,s.manager=(r=(i=this.stage)===null||i===void 0?void 0:i.eventSystem)===null||r===void 0?void 0:r.manager,this.dispatchEvent(s)}}};function Iut(n){return!(!n.fill&&!n.stroke)}js.userSymbolMap={},js.mixin(odt);var E3;(function(n){n[n.LESS_GROUP=0]="LESS_GROUP",n[n.MORE_GROUP=1]="MORE_GROUP"})(E3||(E3={}));let el=class IP extends js{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=IO,this._childUpdateTag=pi.UPDATE_BOUNDS}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new L_),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new L_)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren(e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)})}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===R_.GLOBAL){const r=new Yt(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(r,r),this.AABBBounds.contains(r.x,r.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&pi.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;St.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),St.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),this.attribute.boundsMode==="empty"&&e.clear(),e}doUpdateLocalMatrix(){const{x:t=Fn.x,y:e=Fn.y,dx:i=Fn.dx,dy:r=Fn.dy,scaleX:s=Fn.scaleX,scaleY:o=Fn.scaleY,angle:a=Fn.angle,postMatrix:l}=this.attribute;if(t!==0||e!==0||i!==0||r!==0||s!==1||o!==1||a!==0||l)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return _e(this).group}updateAABBBounds(t,e,i){const r=i;i=i.clone();const{width:s,height:o,path:a,clip:l=e.clip}=t;if(a&&a.length?a.forEach(h=>{i.union(h.AABBBounds)}):s!=null&&o!=null&&i.set(0,0,Math.max(0,s),Math.max(0,o)),!l){this.forEachChildren(u=>{i.union(u.AABBBounds)});const{scrollX:h=0,scrollY:d=0}=t;i.translate(h,d)}return St.graphicService.updateTempAABBBounds(i),St.graphicService.transformAABBBounds(t,i,e,!1,this),r.copy(i),r}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=pi.CLEAR_BOUNDS,this._childUpdateTag&=pi.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=pi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&pi.UPDATE_BOUNDS||(this._childUpdateTag|=pi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),St.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),St.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t,e=!0){const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){const e=super.removeChild(t);return t.stage=null,St.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(t=!1){this.forEachChildren(e=>{St.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)}),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),St.graphicService.onSetStage(this,t),this.forEachChildren(i=>{i.setStage(t,this.layer)}))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&pi.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find(i=>i.name===t,e)}createOrUpdateChild(t,e,i){let r=this._getChildByName(t);return r?r.setAttributes(e):(r=St.graphicService.creator[i](e),r.name=t,this.add(r)),r}clone(){return new IP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return IP.NOWORK_ANIMATE_ATTR}release(t){t&&this.forEachChildren(e=>{e.release(t)}),super.release()}};el.NOWORK_ANIMATE_ATTR=da;function fS(n){return new el(n)}let Out=class extends el{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("")}get dpr(){return this._dpr}constructor(t,e,i,r){var s;super({}),this.stage=t,this.global=e,this.window=i,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,i,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(s=r.zIndex)!==null&&s!==void 0?s:0}),this.layer=this,this.subLayers=new Map,this.theme=new L_,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(t=!0){const e=Array.from(this.subLayers.values()).sort((i,r)=>i.zIndex-r.zIndex);this.layerHandler.merge(e.map(i=>(i.layer.subLayers.size&&i.layer.combineSubLayer(t),i.layer.getNativeHandler()))),t&&e.forEach(i=>{i.group&&(i.group.incremental=0)}),e.forEach(i=>{St.layerService.releaseLayer(this.stage,i.layer)}),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach(i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)})}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:(i=t.background)!==null&&i!==void 0?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach(r=>r(this)),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("")}setToFrame(t){throw new Error("")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach(t=>{St.layerService.releaseLayer(this.stage,t.layer)})}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:(i=e.background)!==null&&i!==void 0?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach(r=>r(this))}};const RX=Symbol.for("TransformUtil"),BX=Symbol.for("GraphicUtil"),FO=Symbol.for("LayerService"),PX=Symbol.for("StaticLayerHandlerContribution"),Dut=Symbol.for("DynamicLayerHandlerContribution"),Fut=Symbol.for("VirtualLayerHandlerContribution");var Dm,Hut=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},zut=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Fm=Dm=class{static GenerateLayerId(){return`${Dm.idprefix}_${Dm.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=St.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(n){return this.layerMap.get(n)}getRecommendedLayerType(n){return n||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(n){let t;return t=n==="static"?he.get(PX):n==="dynamic"?he.get(Dut):he.get(Fut),t}createLayer(n,t={main:!1}){var e;this.tryInit();let i=this.getRecommendedLayerType(t.layerMode);i=t.main||t.canvasId?"static":i;const r=this.getLayerHandler(i),s=new Out(n,this.global,n.window,Object.assign(Object.assign({main:!1},t),{layerMode:i,canvasId:(e=t.canvasId)!==null&&e!==void 0?e:Dm.GenerateLayerId(),layerHandler:r})),o=this.layerMap.get(n)||[];return o.push(s),this.layerMap.set(n,o),this.staticLayerCountInEnv--,s}prepareStageLayer(n){let t;n.forEachChildren(e=>{const i=e.getNativeHandler();i.type==="virtual"?(i.mainHandler=t,t.secondaryHandlers.push(i)):(t=i,t.secondaryHandlers=[])})}releaseLayer(n,t){t.release();const e=this.layerMap.get(n)||[];this.layerMap.set(n,e.filter(i=>i!==t))}layerCount(n){return(this.layerMap.get(n)||[]).length}restLayerCount(n){return this.global.env==="browser"?10:0}releaseStage(n){this.layerMap.delete(n)}};Fm.idprefix="visactor_layer",Fm.prefix_count=0,Fm=Dm=Hut([Bt(),zut("design:paramtypes",[])],Fm);const Wut=new pe(n=>{n(pO).to(SP).inSingletonScope(),n(E_).to(RP),n(BX).to(BP).inSingletonScope(),n(RX).to(PP).inSingletonScope(),n(FO).to(Fm).inSingletonScope()});function Kp(n,t){return!(!n&&!t)}function I_(n,t){let e;return e=V(n)?n.some(i=>i||i===void 0):!!n,e&&t>0}function fc(n,t,e){return e&&n*t>0}function EX(n,t,e,i,r){return r&&n*t>0&&e!==0&&i!==0}function OP(n,t){return n*t>0}function LX(n,t,e,i){return n*t>0&&e!==0&&i!==0}function jut(n,t,e,i,r,s,o,a){const l=e-n,h=i-t,d=o-r,u=a-s;let c=u*l-d*h;return c*c<$t?[]:(c=(d*(t-s)-u*(n-r))/c,[n+c*l,t+c*h])}function Xh(n,t,e,i,r,s,o){const a=n-e,l=t-i,h=(o?s:-s)/Math.sqrt(a*a+l*l),d=h*l,u=-h*a,c=n+d,g=t+u,p=e+d,f=i+u,m=(c+p)/2,v=(g+f)/2,_=p-c,b=f-g,y=_*_+b*b,C=r-s,S=c*f-p*g,w=(b<0?-1:1)*Math.sqrt(Math.max(0,C*C*y-S*S));let x=(S*b-_*w)/y,A=(-S*_-b*w)/y;const M=(S*b+_*w)/y,T=(-S*_+b*w)/y,R=x-m,B=A-v,E=M-m,k=T-v;return R*R+B*B>E*E+k*k&&(x=M,A=T),{cx:x,cy:A,x01:-d,y01:-u,x11:x*(r/C-1),y11:A*(r/C-1)}}function IX(n,t,e,i,r){const s=Et(e-t),o=n.getParsedCornerRadius(),a=V(o),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:d,outerEndAngle:u,innerEndAngle:c,innerStartAngle:g}=n.getParsePadAngle(t,e),p=a?o[0]:o,f=a?o[1]:o,m=a?o[2]:o,v=a?o[3]:o,_=Math.max(f,p),b=Math.max(m,v);let y=_,C=b;const S=r*me(d),w=r*ee(d),x=i*me(c),A=i*ee(c);let M,T,R,B;if((b>$t||_>$t)&&(M=r*me(u),T=r*ee(u),R=i*me(g),B=i*ee(g),s<Kt)){const E=jut(S,w,R,B,M,T,x,A);if(E){const k=S-E[0],P=w-E[1],I=M-E[0],O=T-E[1],H=1/ee(wY((k*I+P*O)/(Rn(k*k+P*P)*Rn(I*I+O*O)))/2),z=Rn(E[0]*E[0]+E[1]*E[1]);C=we(b,(i-z)/(H-1)),y=we(_,(r-z)/(H+1))}}return{outerDeltaAngle:l,xors:S,yors:w,xirs:R,yirs:B,xore:M,yore:T,xire:x,yire:A,limitedOcr:y,limitedIcr:C,outerCornerRadiusStart:p,outerCornerRadiusEnd:f,maxOuterCornerRadius:_,maxInnerCornerRadius:b,outerStartAngle:d,outerEndAngle:u,innerDeltaAngle:h,innerEndAngle:c,innerStartAngle:g,innerCornerRadiusStart:v,innerCornerRadiusEnd:m}}function DP(n,t,e,i,r,s,o){const{startAngle:a,endAngle:l}=n.getParsedAngle(),h=Et(l-a),d=l>a;let u=!1;if(r<s){const c=r;r=s,s=c}if(r<=$t)t.moveTo(e,i);else if(h>=Ft-$t)t.moveTo(e+r*me(a),i+r*ee(a)),t.arc(e,i,r,a,l,!d),s>$t&&(t.moveTo(e+s*me(l),i+s*ee(l)),t.arc(e,i,s,l,a,d));else{const{outerDeltaAngle:c,xors:g,yors:p,xirs:f,yirs:m,limitedOcr:v,outerCornerRadiusStart:_,outerCornerRadiusEnd:b,maxOuterCornerRadius:y,xore:C,yore:S,xire:w,yire:x,outerStartAngle:A,outerEndAngle:M,limitedIcr:T,innerDeltaAngle:R,innerEndAngle:B,innerStartAngle:E,innerCornerRadiusStart:k,innerCornerRadiusEnd:P,maxInnerCornerRadius:I}=IX(n,a,l,s,r);if(c<.001)o&&(o[3]||o[1])&&t.moveTo(e+g,i+p),u=!0;else if(v>$t){const O=we(_,v),H=we(b,v),z=Xh(f,m,g,p,r,O,Number(d)),F=Xh(C,S,w,x,r,H,Number(d));v<y&&O===H?!o||o[0]?(t.moveTo(e+z.cx+z.x01,i+z.cy+z.y01),t.arc(e+z.cx,i+z.cy,v,zt(z.y01,z.x01),zt(F.y01,F.x01),!d)):t.moveTo(e+z.cx+v*me(zt(F.y01,F.x01)),i+z.cy+v*ee(zt(F.y01,F.x01))):!o||o[0]?(t.moveTo(e+z.cx+z.x01,i+z.cy+z.y01),O>0&&t.arc(e+z.cx,i+z.cy,O,zt(z.y01,z.x01),zt(z.y11,z.x11),!d),t.arc(e,i,r,zt(z.cy+z.y11,z.cx+z.x11),zt(F.cy+F.y11,F.cx+F.x11),!d),H>0&&t.arc(e+F.cx,i+F.cy,H,zt(F.y11,F.x11),zt(F.y01,F.x01),!d)):H>0?t.moveTo(e+F.cx+H*me(zt(F.y01,F.x01)),i+F.cy+H*ee(zt(F.y01,F.x01))):t.moveTo(e+C,i+r*ee(M))}else!o||o[0]?(t.moveTo(e+g,i+p),t.arc(e,i,r,A,M,!d)):t.moveTo(e+r*me(M),i+r*ee(M));if(!(s>$t)||R<.001)!o||o[1]?t.lineTo(e+w,i+x):t.moveTo(e+w,i+x),u=!0;else if(T>$t){const O=we(k,T),H=we(P,T),z=Xh(w,x,C,S,s,-H,Number(d)),F=Xh(g,p,f,m,s,-O,Number(d));if(!o||o[1]?t.lineTo(e+z.cx+z.x01,i+z.cy+z.y01):t.moveTo(e+z.cx+z.x01,i+z.cy+z.y01),T<I&&O===H){const j=zt(F.y01,F.x01);!o||o[2]?t.arc(e+z.cx,i+z.cy,T,zt(z.y01,z.x01),j,!d):t.moveTo(e+z.cx+me(j),i+z.cy+ee(j))}else!o||o[2]?(H>0&&t.arc(e+z.cx,i+z.cy,H,zt(z.y01,z.x01),zt(z.y11,z.x11),!d),t.arc(e,i,s,zt(z.cy+z.y11,z.cx+z.x11),zt(F.cy+F.y11,F.cx+F.x11),d),O>0&&t.arc(e+F.cx,i+F.cy,O,zt(F.y11,F.x11),zt(F.y01,F.x01),!d)):O>0?t.moveTo(e+F.cx+O*me(zt(F.y01,F.x01)),i+F.cy+O*ee(zt(F.y01,F.x01))):t.moveTo(e+f,i+m)}else!o||o[1]?t.lineTo(e+w,i+x):t.moveTo(e+w,i+x),!o||o[2]?t.arc(e,i,s,B,E,d):t.moveTo(e+s*me(E),i+s*ee(E))}return o?o[3]&&t.lineTo(e+r*me(a),i+r*ee(a)):t.closePath(),u}let mS=class Bh{static GetCanvas(){try{return Bh.canvas||(Bh.canvas=St.global.createCanvas({})),Bh.canvas}catch{return null}}static GetCtx(){if(!Bh.ctx){const t=Bh.GetCanvas();Bh.ctx=t.getContext("2d")}return Bh.ctx}},Nut=class wg extends IY{static getInstance(){return wg._instance||(wg._instance=new wg),wg._instance}constructor(t=[],e=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=mS.GetCanvas(),r=mS.GetCtx();if(i.width=e,i.height=1,!r)return;if(r.translate(0,0),!r)throw new Error("ctx");const s=r.createLinearGradient(0,0,e,0);t.forEach(o=>{s.addColorStop(o[0],o[1])}),r.fillStyle=s,r.fillRect(0,0,e,1),this.rgbaSet=r.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,r,s=[],o=100){let a=`${t}${e}${i}${r}`;s.forEach(h=>a+=h.join()),a+=o;let l=this.dataMap.get(a);return l||(l={data:new wg(s,o),timestamp:[]},this.addLimitedTimestamp(l,Date.now(),{}),this.dataMap.set(a,l)),this.clearCache(this.dataMap,this.cacheParams),l.data}},Hg=class Ca{static GetSize(t){for(let e=0;e<Ca.ImageSize.length;e++)if(Ca.ImageSize[e]>=t)return Ca.ImageSize[e];return t}static Get(t,e,i,r,s,o,a){const l=Ca.GenKey(t,e,i,r,s),h=Ca.cache[l];if(!h||h.length===0)return null;for(let d=0;d<h.length;d++)if(h[d].width>=o&&h[d].height>=a)return h[d].pattern;return null}static Set(t,e,i,r,s,o,a,l){const h=Ca.GenKey(t,e,i,r,s);Ca.cache[h]?Ca.cache[h].push({width:a,height:l,pattern:o}):Ca.cache[h]=[{width:a,height:l,pattern:o}]}static GenKey(t,e,i,r,s){return`${e},${i},${r},${s},${t.join()}`}};Hg.cache={},Hg.ImageSize=[20,40,80,160,320,640,1280,2560];function $ut(n,t,e,i){const{stops:r,startAngle:s,endAngle:o}=i;for(;e<0;)e+=Ft;for(;e>Ft;)e-=Ft;if(e<s||e>o)return r[0].color;let a,l,h=(e-s)/(o-s);for(let d=0;d<r.length;d++)if(r[d].offset>=h){a=r[d-1],l=r[d];break}return h=(h-a.offset)/(l.offset-a.offset),bp(a.color,l.color,h,!1)}function Vut(n,t,e,i,r,s,o,a,l){const h=Math.floor(180*r/Math.PI),d=mS.GetCanvas(),u=mS.GetCtx();if(!u)return null;const c=Hg.GetSize(a),g=Hg.GetSize(l);let p=Hg.Get(t,e,i,s,o,c,g);if(p)return p;const f=Math.sqrt(Math.max(Math.max(Math.pow(e,2)+Math.pow(i,2),Math.pow(c-e,2)+Math.pow(i,2)),Math.max(Math.pow(c-e,2)+Math.pow(g-i,2),Math.pow(e,2)+Math.pow(g-i,2)))),m=h+1,v=r/Math.max(1,m-1),_=Nut.getInstance().GetOrCreate(e,i,c,g,t,m),b=2*Math.PI*f/360;d.width=c,d.height=g,u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,c,g),u.translate(e,i),u.rotate(s);for(let C=0,S=m-1;C<S&&!(s+C*v>o);C++){const w=_.getColor(C);u.beginPath(),u.rotate(v),u.moveTo(0,0),u.lineTo(f,-2*b),u.lineTo(f,0),u.fillStyle=w,u.closePath(),u.fill()}const y=u.getImageData(0,0,c,g);return d.width=y.width,d.height=y.height,u.putImageData(y,0,0),p=n.createPattern(d,"no-repeat"),p&&Hg.Set(t,e,i,s,o,p,c,g),p}const FP=Symbol.for("ArcRenderContribution"),Gut=Symbol.for("AreaRenderContribution"),HP=Symbol.for("CircleRenderContribution"),Fo=Symbol.for("GroupRenderContribution"),Iu=Symbol.for("ImageRenderContribution"),zP=Symbol.for("PathRenderContribution"),WP=Symbol.for("PolygonRenderContribution"),Ou=Symbol.for("RectRenderContribution"),jP=Symbol.for("SymbolRenderContribution"),vS=Symbol.for("TextRenderContribution"),HO=Symbol.for("InteractiveSubRenderContribution");function qp(n,t){return n==="end"||n==="right"?-t:n==="center"?-t/2:0}function O_(n,t,e,i=0){return n==="middle"?-t/2:n==="top"?0:n==="bottom"?i-t:n&&n!=="alphabetic"?0:(e||(e=t),-(t-e)/2-.79*e)}function OX(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function Uut(n,t,e){const i=Math.sin(e),r=Math.cos(e),s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],d=t[9],u=t[10],c=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=s*r+h*i,n[5]=o*r+d*i,n[6]=a*r+u*i,n[7]=l*r+c*i,n[8]=h*r-s*i,n[9]=d*r-o*i,n[10]=u*r-a*i,n[11]=c*r-l*i,n}function Yut(n,t,e){const i=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],l=t[3],h=t[8],d=t[9],u=t[10],c=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=s*r-h*i,n[1]=o*r-d*i,n[2]=a*r-u*i,n[3]=l*r-c*i,n[8]=s*i+h*r,n[9]=o*i+d*r,n[10]=a*i+u*r,n[11]=l*i+c*r,n}function Xut(n,t,e){const i=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],l=t[3],h=t[4],d=t[5],u=t[6],c=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=s*r+h*i,n[1]=o*r+d*i,n[2]=a*r+u*i,n[3]=l*r+c*i,n[4]=h*r-s*i,n[5]=d*r-o*i,n[6]=u*r-a*i,n[7]=c*r-l*i,n}function sm(n,t,e){const i=e[0],r=e[1],s=e[2];let o,a,l,h,d,u,c,g,p,f,m,v;return t===n?(n[12]=t[0]*i+t[4]*r+t[8]*s+t[12],n[13]=t[1]*i+t[5]*r+t[9]*s+t[13],n[14]=t[2]*i+t[6]*r+t[10]*s+t[14],n[15]=t[3]*i+t[7]*r+t[11]*s+t[15]):(o=t[0],a=t[1],l=t[2],h=t[3],d=t[4],u=t[5],c=t[6],g=t[7],p=t[8],f=t[9],m=t[10],v=t[11],n[0]=o,n[1]=a,n[2]=l,n[3]=h,n[4]=d,n[5]=u,n[6]=c,n[7]=g,n[8]=p,n[9]=f,n[10]=m,n[11]=v,n[12]=o*i+d*r+p*s+t[12],n[13]=a*i+u*r+f*s+t[13],n[14]=l*i+c*r+m*s+t[14],n[15]=h*i+g*r+v*s+t[15]),n}function NP(n,t){n[0]=t.a,n[1]=t.b,n[2]=0,n[3]=0,n[4]=t.c,n[5]=t.d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t.e,n[13]=t.f,n[14]=0,n[15]=1}function Kut(n,t,e){const i=e[0],r=e[1],s=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*s,n[9]=t[9]*s,n[10]=t[10]*s,n[11]=t[11]*s,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Q0(n,t,e){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],d=t[7],u=t[8],c=t[9],g=t[10],p=t[11],f=t[12],m=t[13],v=t[14],_=t[15];let b=e[0],y=e[1],C=e[2],S=e[3];return n[0]=b*i+y*a+C*u+S*f,n[1]=b*r+y*l+C*c+S*m,n[2]=b*s+y*h+C*g+S*v,n[3]=b*o+y*d+C*p+S*_,b=e[4],y=e[5],C=e[6],S=e[7],n[4]=b*i+y*a+C*u+S*f,n[5]=b*r+y*l+C*c+S*m,n[6]=b*s+y*h+C*g+S*v,n[7]=b*o+y*d+C*p+S*_,b=e[8],y=e[9],C=e[10],S=e[11],n[8]=b*i+y*a+C*u+S*f,n[9]=b*r+y*l+C*c+S*m,n[10]=b*s+y*h+C*g+S*v,n[11]=b*o+y*d+C*p+S*_,b=e[12],y=e[13],C=e[14],S=e[15],n[12]=b*i+y*a+C*u+S*f,n[13]=b*r+y*l+C*c+S*m,n[14]=b*s+y*h+C*g+S*v,n[15]=b*o+y*d+C*p+S*_,n}function Lo(n,t,e){const i=t[0],r=t[1],s=t[2];let o=e[3]*i+e[7]*r+e[11]*s+e[15];return o=o||1,n[0]=(e[0]*i+e[4]*r+e[8]*s+e[12])/o,n[1]=(e[1]*i+e[5]*r+e[9]*s+e[13])/o,n[2]=(e[2]*i+e[6]*r+e[10]*s+e[14])/o,n}function L3(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}let qut=class{constructor(){this.pools=[]}allocate(t,e,i,r,s,o){if(!this.pools.length)return new Pe(t,e,i,r,s,o);const a=this.pools.pop();return a.a=t,a.b=e,a.c=i,a.d=r,a.e=s,a.f=o,a}allocateByObj(t){if(!this.pools.length)return new Pe(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}},Zut=class DX{constructor(){this.pools=[]}static identity(t){return OX(t)}allocate(){if(!this.pools.length)return L3();const t=this.pools.pop();return DX.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():L3();for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}};const ns=new qut,yn=new Zut;var Jut=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Qut=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},tct=function(n,t){return function(e,i){t(e,i,n)}};function FX(n,t,e){var i;const{x:r=e.x,y:s=e.y,z:o=e.z,dx:a=e.dx,dy:l=e.dy,dz:h=e.dz,scaleX:d=e.scaleX,scaleY:u=e.scaleY,scaleZ:c=e.scaleZ,alpha:g=e.alpha,beta:p=e.beta,angle:f=e.angle,anchor3d:m=t.attribute.anchor,anchor:v}=t.attribute,_=[0,0,0];if(m){if(typeof m[0]=="string"){const b=parseFloat(m[0])/100,y=t.AABBBounds;_[0]=y.x1+(y.x2-y.x1)*b}else _[0]=m[0];if(typeof m[1]=="string"){const b=parseFloat(m[1])/100,y=t.AABBBounds;_[1]=y.x1+(y.x2-y.x1)*b}else _[1]=m[1];_[2]=(i=m[2])!==null&&i!==void 0?i:0}if(OX(n),sm(n,n,[r+a,s+l,o+h]),sm(n,n,[_[0],_[1],_[2]]),Uut(n,n,p),Yut(n,n,g),sm(n,n,[-_[0],-_[1],_[2]]),Kut(n,n,[d,u,c]),f){const b=yn.allocate(),y=[0,0];if(v){if(typeof m[0]=="string"){const C=parseFloat(m[0])/100,S=t.AABBBounds;y[0]=S.x1+(S.x2-S.x1)*C}else y[0]=m[0];if(typeof m[1]=="string"){const C=parseFloat(m[1])/100,S=t.AABBBounds;y[1]=S.x1+(S.x2-S.x1)*C}else y[1]=m[1]}sm(b,b,[y[0],y[1],0]),Xut(b,b,f),sm(b,b,[-y[0],-y[1],0]),Q0(n,n,b)}}function ect(n){const{alpha:t,beta:e}=n.attribute;return t||e}let $P=class{constructor(t){this.creator=t,this.hooks={onAttributeUpdate:new qr(["graphic"]),onSetStage:new qr(["graphic","stage"]),onRemove:new qr(["graphic"]),onRelease:new qr(["graphic"]),onAddIncremental:new qr(["graphic","group","stage"]),onClearIncremental:new qr(["graphic","group","stage"]),beforeUpdateAABBBounds:new qr(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new qr(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new qr(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new ie,this.tempAABBBounds2=new ie}onAttributeUpdate(t){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(t)}onSetStage(t,e){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(t,e)}onRemove(t){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(t)}onRelease(t){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(t)}onAddIncremental(t,e,i){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(t,e,i)}onClearIncremental(t,e){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(t,e)}beforeUpdateAABBBounds(t,e,i,r){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(t,e,i,r)}afterUpdateAABBBounds(t,e,i,r,s){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(t,e,i,r,s)}clearAABBBounds(t,e,i){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(t,e,i)}updatePathProxyAABBBounds(t,e){const i=typeof e.pathProxy=="function"?e.pathProxy(e.attribute):e.pathProxy;if(!i)return!1;const r=new AO(t);return Ql(i.commandList,r,0,0),!0}updateHTMLTextAABBBounds(t,e,i,r){const{textAlign:s,textBaseline:o}=t;if(t.forceBoundsHeight!=null){const a=J(t.forceBoundsHeight)?t.forceBoundsHeight:t.forceBoundsHeight(),l=O_(o,a,a);i.set(i.x1,l,i.x2,l+a)}if(t.forceBoundsWidth!=null){const a=J(t.forceBoundsWidth)?t.forceBoundsWidth:t.forceBoundsWidth(),l=qp(s,a);i.set(l,i.y1,l+a,i.y2)}}combindShadowAABBBounds(t,e){if(e&&e.shadowRoot){const i=e.shadowRoot.AABBBounds;t.union(i)}}transformAABBBounds(t,e,i,r,s){if(!e.empty()){const{scaleX:l=i.scaleX,scaleY:h=i.scaleY,stroke:d=i.stroke,shadowBlur:u=i.shadowBlur,lineWidth:c=i.lineWidth,pickStrokeBuffer:g=i.pickStrokeBuffer,strokeBoundsBuffer:p=i.strokeBoundsBuffer}=t,f=this.tempAABBBounds1,m=this.tempAABBBounds2;if(d&&c){const v=(c+g)/Math.abs(l+h);pS(f,v,r,p),e.union(f),f.setValue(m.x1,m.y1,m.x2,m.y2)}if(u){const{shadowOffsetX:v=i.shadowOffsetX,shadowOffsetY:_=i.shadowOffsetY}=t,b=u/Math.abs(l+h)*2;pS(f,b,!1,p+1),f.translate(v,_),e.union(f)}}if(this.combindShadowAABBBounds(e,s),e.empty())return;let o=!0;const a=s.transMatrix;s&&s.isContainer&&(o=!(a.a===1&&a.b===0&&a.c===0&&a.d===1&&a.e===0&&a.f===0)),o&&K0(e,e,a)}validCheck(t,e,i,r){if(!r||t.forceBoundsHeight!=null||t.forceBoundsWidth!=null||r.shadowRoot||r.isContainer)return!0;const{visible:s=e.visible}=t;return!(!r.valid||!s)||(i.empty()||(r.parent&&i.transformWithMatrix(r.parent.globalTransMatrix),St.graphicService.clearAABBBounds(r,r.stage,i),i.clear()),!1)}updateTempAABBBounds(t){const e=this.tempAABBBounds1,i=this.tempAABBBounds2;return e.setValue(t.x1,t.y1,t.x2,t.y2),i.setValue(t.x1,t.y1,t.x2,t.y2),{tb1:e,tb2:i}}};$P=Jut([Bt(),tct(0,xe(TX)),Qut("design:paramtypes",[Object])],$P);const tb=(n,t,e)=>{const{outerBorder:i,shadowBlur:r=t.shadowBlur}=n;if(i){const s=t.outerBorder,{distance:o=s.distance,lineWidth:a=s.lineWidth}=i;e.expand(o+(r+a)/2)}return e},I3=["radius","startAngle","endAngle",...wo];let zO=class VP extends js{constructor(t={radius:1}){super(t),this.type="circle",this.numberType=tM}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}getGraphicTheme(){return _e(this).circle}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateCircleAABBBoundsImprecise(t,e,i):this.updateCircleAABBBoundsAccurate(t,e,i));const{tb1:s,tb2:o}=St.graphicService.updateTempAABBBounds(i);return tb(t,e,s),i.union(s),s.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,St.graphicService.transformAABBBounds(t,i,e,!1,this),i}updateCircleAABBBoundsImprecise(t,e,i){const{radius:r=e.radius}=t;return i.set(-r,-r,r,r),i}updateCircleAABBBoundsAccurate(t,e,i){const{startAngle:r=e.startAngle,endAngle:s=e.endAngle,radius:o=e.radius}=t;return s-r>Ft-$t?i.set(-o,-o,o,o):EP(r,s,o,i),i}needUpdateTags(t){return super.needUpdateTags(t,I3)}needUpdateTag(t){return super.needUpdateTag(t,I3)}toCustomPath(){var t,e,i;const r=this.attribute,s=(t=r.radius)!==null&&t!==void 0?t:this.getDefaultAttribute("radius"),o=(e=r.startAngle)!==null&&e!==void 0?e:this.getDefaultAttribute("startAngle"),a=(i=r.endAngle)!==null&&i!==void 0?i:this.getDefaultAttribute("endAngle"),l=new Gn;return l.arc(0,0,s,o,a),l}clone(){return new VP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return VP.NOWORK_ANIMATE_ATTR}};zO.NOWORK_ANIMATE_ATTR=da;function HX(n){return new zO(n)}let GP=class{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,r){if(t.xOffset=e==="left"||e==="start"?0:e==="center"?t.width/-2:e==="right"||e==="end"?-t.width:0,i==="top")t.yOffset=0;else if(i==="middle")t.yOffset=t.height/-2;else if(i==="alphabetic"){let s=.79;if(r.length===1){const o=r[0];s=o.ascent/(o.ascent+o.descent)}t.yOffset=t.height*-s}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,r,s="",o,a){const{lineWidth:l,suffixPosition:h="end",measureMode:d=Yu.actualBounding,keepCenterInLine:u=!1}=a??{};t=t.map(f=>f.toString());const c=[],g=[0,0];if(typeof l=="number"&&l!==1/0){let f;for(let m=0,v=t.length;m<v;m++){const _=this.textMeasure.measureTextPixelADscentAndWidth(t[m],this.textOptions,d);let b=t[m].toString();if(_.width>l){const y=this.textMeasure.clipTextWithSuffix(t[m],this.textOptions,l,s,o,h);b=y.str,f=y.width}else f=_.width;c.push({str:b,width:f,ascent:_.ascent,descent:_.descent,keepCenterInLine:u})}g[0]=l}else{let f,m,v=0;for(let _=0,b=t.length;_<b;_++){m=t[_];const y=this.textMeasure.measureTextPixelADscentAndWidth(t[_],this.textOptions,d);f=y.width,v=Math.max(v,f),c.push({str:m,width:f,ascent:y.ascent,descent:y.descent,keepCenterInLine:u})}g[0]=v}g[1]=c.length*r,g[0]=c.reduce((f,m)=>Math.max(f,m.width),0);const p={xOffset:0,yOffset:0,width:g[0],height:g[1]};return this.LayoutBBox(p,e,i,c),this.layoutWithBBox(p,c,e,i,r)}layoutWithBBox(t,e,i,r,s){const o=[0,0],a=e.length*s;r==="top"||(r==="middle"?o[1]=(t.height-a)/2:r==="bottom"&&(o[1]=t.height-a));for(let l=0;l<e.length;l++)this.lineOffset(t,e[l],i,r,s,o);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:s,textAlign:i,textBaseline:r}}lineOffset(t,e,i,r,s,o){if(i==="left"||i==="start"?e.leftOffset=0:i==="center"?e.leftOffset=(t.width-e.width)/2:i!=="right"&&i!=="end"||(e.leftOffset=t.width-e.width),e.topOffset=s/2+(e.ascent-e.descent)/2+o[1],!e.keepCenterInLine){const l=e.ascent+e.descent+0;if(l<s-0&&(r==="bottom"?e.topOffset+=(s-l)/2:r==="top"&&(e.topOffset-=(s-l)/2)),r==="alphabetic"){const h=s/(e.ascent+e.descent);e.topOffset=s/2+(e.ascent-e.descent)/2*h+o[1]}}return o[1]+=s,e}};const O3=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...wo];let Wn=class Ph extends js{get font(){const t=this.getGraphicTheme();return this._font||(this._font=pc(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=this.getGraphicTheme(),r=this.getMaxWidth(i);return Number.isFinite(r)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((t=e.text)!==null&&t!==void 0?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;const i=this.getGraphicTheme(),r=this.attribute,s=this.getMaxWidth(i);if(!Number.isFinite(s))return!1;const{text:o}=this.attribute;if(this.tryUpdateAABBBounds(),(e=(t=this.cache)===null||t===void 0?void 0:t.layoutData)===null||e===void 0?void 0:e.lines){let a="";return this.cache.layoutData.lines.forEach(l=>{a+=l.str}),(Array.isArray(o)?o.join(""):o)!==a}return r.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map(a=>a.text).join("")!==r.text.toString():this.clipedText!=null&&this.clipedText!==r.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(t={text:"",fontSize:16}){super(t),this.type="text",this.numberType=sM,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return V(t)?!t.every(e=>e==null||e===""):t!=null&&t!==""}getGraphicTheme(){return _e(this).text}doUpdateOBBBounds(){const t=this.getGraphicTheme();this._OBBBounds.clear();const e=this.attribute,{angle:i=t.angle}=e;if(!i){const h=this.AABBBounds;return this._OBBBounds.setValue(h.x1,h.y1,h.x2,h.y2),this._OBBBounds}this.obbText||(this.obbText=new Ph({})),this.obbText.setAttributes(Object.assign(Object.assign({},e),{angle:0}));const r=this.obbText.AABBBounds,{x:s,y:o}=e,a={x:(r.x1+r.x2)/2,y:(r.y1+r.y2)/2},l=uo(a,i,{x:s,y:o});return this._OBBBounds.copy(r),this._OBBBounds.translate(l.x-a.x,l.y-a.y),this._OBBBounds.angle=i,this._OBBBounds}updateAABBBounds(t,e,i){const{text:r=e.text}=this.attribute;Array.isArray(r)?this.updateMultilineAABBBounds(r):this.updateSingallineAABBBounds(r);const{tb1:s}=St.graphicService.updateTempAABBBounds(i),{scaleX:o=e.scaleX,scaleY:a=e.scaleY,shadowBlur:l=e.shadowBlur,strokeBoundsBuffer:h=e.strokeBoundsBuffer}=t;if(l){const d=l/Math.abs(o+a);pS(s,d,!0,h),i.union(s)}return St.graphicService.combindShadowAABBBounds(i,this),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||St.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,K0(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);const e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){const i=e.lines[0];this.cache.clipedText=i.str,this.cache.clipedWidth=i.width}return this._AABBBounds}updateMultilineAABBBounds(t){const e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,s=i==="horizontal"?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return i==="horizontal"&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),s}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e;const i=this.getGraphicTheme(),r=this.attribute,{fontFamily:s=i.fontFamily,textAlign:o=i.textAlign,textBaseline:a=i.textBaseline,fontSize:l=i.fontSize,fontWeight:h=i.fontWeight,ellipsis:d=i.ellipsis,maxLineWidth:u,stroke:c=i.stroke,wrap:g=i.wrap,measureMode:p=i.measureMode,lineWidth:f=i.lineWidth,whiteSpace:m=i.whiteSpace,suffixPosition:v=i.suffixPosition,ignoreBuf:_=i.ignoreBuf,keepCenterInLine:b=i.keepCenterInLine}=r,y=_?0:this.guessLineHeightBuf(l),C=this.getLineHeight(r,i,y);if(m==="normal"||g)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const A=this.cache.layoutData.bbox;return this._AABBBounds.set(A.xOffset,A.yOffset,A.xOffset+A.width,A.yOffset+A.height),c&&this._AABBBounds.expand(f/2),this._AABBBounds}const S=St.graphicUtil.textMeasure,w=new GP(s,{fontSize:l,fontWeight:h,fontFamily:s,lineHeight:C},S).GetLayoutByLines(t,o,a,C,d===!0?i.ellipsis:d||void 0,!1,{lineWidth:u,suffixPosition:v,measureMode:p,keepCenterInLine:b}),{bbox:x}=w;return this.cache.layoutData=w,this.clearUpdateShapeTag(),this._AABBBounds.set(x.xOffset,x.yOffset,x.xOffset+x.width,x.yOffset+x.height),c&&this._AABBBounds.expand(f/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,r;const s=this.getGraphicTheme(),{fontFamily:o=s.fontFamily,textAlign:a=s.textAlign,textBaseline:l=s.textBaseline,fontSize:h=s.fontSize,ellipsis:d=s.ellipsis,maxLineWidth:u,stroke:c=s.stroke,lineWidth:g=s.lineWidth,wordBreak:p=s.wordBreak,fontWeight:f=s.fontWeight,ignoreBuf:m=s.ignoreBuf,measureMode:v=s.measureMode,suffixPosition:_=s.suffixPosition,heightLimit:b=0,lineClamp:y,keepCenterInLine:C=s.keepCenterInLine}=this.attribute,S=m?0:this.guessLineHeightBuf(h),w=this.getLineHeight(this.attribute,s,S);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const I=this.cache.layoutData.bbox;return this._AABBBounds.set(I.xOffset,I.yOffset,I.xOffset+I.width,I.yOffset+I.height),c&&this._AABBBounds.expand(g/2),this._AABBBounds}const x=St.graphicUtil.textMeasure,A={fontSize:h,fontWeight:f,fontFamily:o,lineHeight:w},M=new GP(o,A,x),T=V(t)?t.map(I=>I.toString()):[t.toString()],R=[],B=[0,0];let E=1/0;if(b>0&&(E=Math.max(Math.floor(b/w),1)),y&&(E=Math.min(E,y)),typeof u=="number"&&u!==1/0){if(u>0)for(let O=0;O<T.length;O++){const H=T[O];let z=!0;if(O===E-1){const Y=x.clipTextWithSuffix(H,A,u,d,!1,_,O!==T.length-1),G=x.measureTextPixelADscentAndWidth(Y.str,A,v);R.push({str:Y.str,width:Y.width,ascent:G.ascent,descent:G.descent,keepCenterInLine:C});break}const F=x.clipText(H,A,u,p!=="break-all",p==="keep-all");if(H!==""&&F.str===""||F.wordBreaked){if(d){const Y=x.clipTextWithSuffix(H,A,u,d,!1,_);F.str=(i=Y.str)!==null&&i!==void 0?i:"",F.width=(r=Y.width)!==null&&r!==void 0?r:0}else F.str="",F.width=0;z=!1}const j=x.measureTextPixelADscentAndWidth(F.str,A,v);R.push({str:F.str,width:F.width,ascent:j.ascent,descent:j.descent,keepCenterInLine:C});let $=F.str.length;if(!F.wordBreaked||H!==""&&F.str===""||(z=!0,$=F.wordBreaked),F.str.length!==H.length){if(z){let Y=H.substring($);p==="keep-all"&&(Y=Y.replace(/^\s+/g,"")),T.splice(O+1,0,Y)}}}let I=0;R.forEach(O=>{I=Math.max(I,O.width)}),B[0]=I}else{let I,O,H=0;for(let z=0,F=T.length;z<F;z++){if(z===E-1){const $=x.clipTextWithSuffix(T[z],A,u,d,!1,_),Y=x.measureTextPixelADscentAndWidth($.str,A,v);R.push({str:$.str,width:$.width,ascent:Y.ascent,descent:Y.descent,keepCenterInLine:C}),H=Math.max(H,$.width);break}O=T[z],I=x.measureTextWidth(O,A),H=Math.max(H,I);const j=x.measureTextPixelADscentAndWidth(O,A,v);R.push({str:O,width:I,ascent:j.ascent,descent:j.descent,keepCenterInLine:C})}B[0]=H}B[1]=R.length*w;const k={xOffset:0,yOffset:0,width:B[0],height:B[1]};M.LayoutBBox(k,a,l,R);const P=M.layoutWithBBox(k,R,a,l,w);return this.cache.layoutData=P,this.clearUpdateShapeTag(),this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),c&&this._AABBBounds.expand(g/2),this._AABBBounds}updateVerticalMultilineAABBBounds(t){var e,i;const r=this.getGraphicTheme(),s=St.graphicUtil.textMeasure;let o;const a=this.attribute,{maxLineWidth:l=r.maxLineWidth,ellipsis:h=r.ellipsis,fontFamily:d=r.fontFamily,fontSize:u=r.fontSize,fontWeight:c=r.fontWeight,stroke:g=r.stroke,lineWidth:p=r.lineWidth,verticalMode:f=r.verticalMode,suffixPosition:m=r.suffixPosition}=a,v=this.getLineHeight(a,r,0);let{textAlign:_=r.textAlign,textBaseline:b=r.textBaseline}=a;if(!f){const x=_;_=(e=Ph.baselineMapAlign[b])!==null&&e!==void 0?e:"left",b=(i=Ph.alignMapBaseline[x])!==null&&i!==void 0?i:"top"}if(o=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach(T=>{const R=T.reduce((B,E)=>B+E.width,0);o=ti(R,o)});const x=qp(_,o),A=this.cache.verticalList.length*v,M=O_(b,A,u);return this._AABBBounds.set(M,x,M+A,x+o),g&&this._AABBBounds.expand(p/2),this._AABBBounds}const y=t.map(x=>Tut(x.toString()));y.forEach((x,A)=>{if(Number.isFinite(l))if(h){const M=h===!0?r.ellipsis:h,T=s.clipTextWithSuffixVertical(x,{fontSize:u,fontWeight:c,fontFamily:d},l,M,!1,m);y[A]=T.verticalList,o=T.width}else{const M=s.clipTextVertical(x,{fontSize:u,fontWeight:c,fontFamily:d},l,!1);y[A]=M.verticalList,o=M.width}else o=0,x.forEach(M=>{const T=M.direction===yp.HORIZONTAL?u:s.measureTextWidth(M.text,{fontSize:u,fontWeight:c,fontFamily:d});o+=T,M.width=T})}),this.cache.verticalList=y,this.clearUpdateShapeTag(),this.cache.verticalList.forEach(x=>{const A=x.reduce((M,T)=>M+T.width,0);o=ti(A,o)});const C=qp(_,o),S=this.cache.verticalList.length*v,w=O_(b,S,u);return this._AABBBounds.set(w,C,w+S,C+o),g&&this._AABBBounds.expand(p/2),this._AABBBounds}getMaxWidth(t){var e,i;const r=this.attribute;return(i=(e=r.maxLineWidth)!==null&&e!==void 0?e:r.maxWidth)!==null&&i!==void 0?i:t.maxWidth}getLineHeight(t,e,i){var r;return(r=Z0(t.lineHeight,t.fontSize||e.fontSize))!==null&&r!==void 0?r:(t.fontSize||e.fontSize)+i}needUpdateTags(t,e=O3){return super.needUpdateTags(t,e)}needUpdateTag(t,e=O3){return super.needUpdateTag(t,e)}_interpolate(t,e,i,r,s){t==="text"&&(s.text=r)}clone(){return new Ph(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Ph.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return Ph.baselineMapAlign}getAlignMapBaseline(){return Ph.alignMapBaseline}};Wn.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},da),Wn.baselineMapAlign={top:"left",bottom:"right",middle:"center"},Wn.alignMapBaseline={left:"top",right:"bottom",center:"middle"};function UP(n){return new Wn(n)}const ry=["heightLimit","lineClamp"];class WO extends Wn{constructor(t){super(Object.assign(Object.assign({},t),{wrap:!0}))}_isValid(){const{text:t}=this.attribute;return V(t)?!t.every(e=>e==null||e===""):t!=null&&t!==""}updateMultilineAABBBounds(t){var e,i,r,s;const o=this.getGraphicTheme(),{fontFamily:a=o.fontFamily,textAlign:l=o.textAlign,textBaseline:h=o.textBaseline,fontSize:d=o.fontSize,ellipsis:u=o.ellipsis,maxLineWidth:c,stroke:g=o.stroke,lineWidth:p=o.lineWidth,wordBreak:f=o.wordBreak,fontWeight:m=o.fontWeight,ignoreBuf:v=o.ignoreBuf,heightLimit:_=0,suffixPosition:b=o.suffixPosition,lineClamp:y}=this.attribute,C=(e=Z0(this.attribute.lineHeight,this.attribute.fontSize||o.fontSize))!==null&&e!==void 0?e:this.attribute.fontSize||o.fontSize,S=v?0:2;if(!this.shouldUpdateShape()&&(!((i=this.cache)===null||i===void 0)&&i.layoutData)){const k=this.cache.layoutData.bbox;return this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),g&&this._AABBBounds.expand(p/2),this._AABBBounds}const w=St.graphicUtil.textMeasure,x=new GP(a,{fontSize:d,fontWeight:m,fontFamily:a},w),A=t.map(k=>k.toString()),M=[],T=[0,0];let R=1/0;if(_>0&&(R=Math.max(Math.floor(_/C),1)),y&&(R=Math.min(R,y)),typeof c=="number"&&c!==1/0){if(c>0)for(let P=0;P<A.length;P++){const I=A[P];let O=!0;if(P===R-1){const z=x.textMeasure.clipTextWithSuffix(I,x.textOptions,c,u,!1,b);M.push({str:z.str,width:z.width,ascent:0,descent:0,keepCenterInLine:!1});break}const H=x.textMeasure.clipText(I,x.textOptions,c,f==="break-word");if(I!==""&&H.str===""){if(u){const z=x.textMeasure.clipTextWithSuffix(I,x.textOptions,c,u,!1,b);H.str=(r=z.str)!==null&&r!==void 0?r:"",H.width=(s=z.width)!==null&&s!==void 0?s:0}else H.str="",H.width=0;O=!1}if(M.push({str:H.str,width:H.width,ascent:0,descent:0,keepCenterInLine:!1}),H.str.length!==I.length){if(O){const z=I.substring(H.str.length);A.splice(P+1,0,z)}}}let k=0;M.forEach(P=>{k=Math.max(k,P.width)}),T[0]=k}else{let k,P,I=0;for(let O=0,H=A.length;O<H;O++){if(O===R-1){const z=x.textMeasure.clipTextWithSuffix(A[O],x.textOptions,c,u,!1,b);M.push({str:z.str,width:z.width,ascent:0,descent:0,keepCenterInLine:!1}),I=Math.max(I,z.width);break}P=A[O],k=x.textMeasure.measureTextWidth(P,x.textOptions,f==="break-word"),I=Math.max(I,k),M.push({str:P,width:k,ascent:0,descent:0,keepCenterInLine:!1})}T[0]=I}T[1]=M.length*(C+S);const B={xOffset:0,yOffset:0,width:T[0],height:T[1]};x.LayoutBBox(B,l,h);const E=x.layoutWithBBox(B,M,l,h,C);return this.cache.layoutData=E,this.clearUpdateShapeTag(),this._AABBBounds.set(B.xOffset,B.yOffset,B.xOffset+B.width,B.yOffset+B.height),g&&this._AABBBounds.expand(p/2),this._AABBBounds}needUpdateTags(t){for(let e=0;e<ry.length;e++){const i=ry[e];if(t.indexOf(i)!==-1)return!0}return super.needUpdateTags(t)}needUpdateTag(t){for(let e=0;e<ry.length;e++)if(t===ry[e])return!0;return super.needUpdateTag(t)}getNoWorkAnimateAttr(){return WO.NOWORK_ANIMATE_ATTR}}function ict(n){return new WO(n)}const nct=(n,t,e)=>{const{outerBorder:i,shadowBlur:r=t.shadowBlur,strokeBoundsBuffer:s=t.strokeBoundsBuffer}=n;if(i){const o=t.outerBorder,{distance:a=o.distance,lineWidth:l=o.lineWidth}=i;pS(e,a+(r+l)/2,!0,s)}return e},D3=["symbolType","size",...wo];let zX=class YP extends js{constructor(t={symbolType:"circle"}){super(t),this.type="symbol",this.numberType=rM}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(t=0,e=0,i=1){let r=null;try{r=new Path2D}catch{return null}const s=this.getParsedPath();if(!s)return null;s.draw(r,i,t,e)}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return V(t)?t.length===2&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const{symbolType:t="circle"}=this.attribute;return super.parsePath(t)}getGraphicTheme(){return _e(this).symbol}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));const{tb1:s,tb2:o}=St.graphicService.updateTempAABBBounds(i);nct(t,e,s),i.union(s),s.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,this.x1WithoutTransform=i.x1,this.y1WithoutTransform=i.y1;const{lineJoin:a=e.lineJoin}=t;return St.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateSymbolAABBBoundsImprecise(t,e,i){const{size:r=e.size}=t;if(V(r))i.set(-r[0]/2,-r[1]/2,r[0]/2,r[1]/2);else{const s=r/2;i.set(-s,-s,s,s)}return i}updateSymbolAABBBoundsAccurate(t,e,i){const{size:r=e.size}=t;return this.getParsedPath().bounds(r,i),i}needUpdateTags(t){return super.needUpdateTags(t,D3)}needUpdateTag(t){return super.needUpdateTag(t,D3)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=V(e)?e:[e,e];return t.path?new Gn().fromCustomPath2D(t.path,0,0,i[0],i[1]):new Gn().fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new YP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return YP.NOWORK_ANIMATE_ATTR}};zX.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},da);function Zp(n){return new zX(n)}const F3=["segments","points","curveType","curveTension",...wo];let WX=class XP extends js{constructor(t={}){super(t),this.type="line",this.numberType=J0}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&!(t.length<=1)}_interpolate(t,e,i,r,s){t==="points"&&(s.points=pX(i,r,e))}getGraphicTheme(){return _e(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),St.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return St.graphicService.transformAABBBounds(t,i,e,r==="miter",this),i}updateLineAABBBoundsByPoints(t,e,i,r){const{points:s=e.points,connectedType:o}=t,a=i;return s.forEach(l=>{l.defined===!1&&o!=="connect"||a.add(l.x,l.y)}),a}updateLineAABBBoundsBySegments(t,e,i,r){const{segments:s=e.segments,connectedType:o}=t,a=i;return s.forEach(l=>{l.points.forEach(h=>{h.defined===!1&&o!=="connect"||a.add(h.x,h.y)})}),a}needUpdateTags(t){return super.needUpdateTags(t,F3)}needUpdateTag(t){return super.needUpdateTag(t,F3)}toCustomPath(){const t=this.attribute,e=new Gn,i=t.segments,r=s=>{if(s&&s.length){let o=!0;s.forEach(a=>{a.defined!==!1&&(o?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y),o=!1)})}};return i&&i.length?i.forEach(s=>{r(s.points)}):t.points&&r(t.points),e}clone(){return new XP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return XP.NOWORK_ANIMATE_ATTR}};WX.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},da);function Os(n){return new WX(n)}const H3=["width","x1","y1","height","cornerRadius",...wo];let eb=class KP extends js{constructor(t){super(t),this.type="rect",this.numberType=OO}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return _e(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:o,height:a}=t;const{x1:l,y1:h,x:d,y:u}=t;o=o??l-d,a=a??h-u,(isFinite(o)||isFinite(a)||isFinite(d)||isFinite(u))&&i.set(0,0,o||0,a||0)}const{tb1:r,tb2:s}=St.graphicService.updateTempAABBBounds(i);return tb(t,e,r),i.union(r),r.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,St.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,H3)}needUpdateTag(t){return super.needUpdateTag(t,H3)}toCustomPath(){const t=this.attribute,{x:e,y:i,width:r,height:s}=gdt(t),o=new Gn;return o.moveTo(e,i),o.rect(e,i,r,s),o}clone(){return new KP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return KP.NOWORK_ANIMATE_ATTR}};eb.NOWORK_ANIMATE_ATTR=da;function wi(n){return new eb(n)}let rct=class{constructor(t,e,i,r,s,o,a,l,h,d,u,c,g,p){this.left=t,this.top=e,this.width=i,this.height=r,this.actualHeight=0,this.bottom=e+r,this.right=t+i,this.ellipsis=s,this.wordBreak=o,this.verticalDirection=a,this.lines=[],this.globalAlign=l,this.globalBaseline=h,this.layoutDirection=d,this.directionKey=TO[this.layoutDirection],this.isWidthMax=u,this.isHeightMax=c,this.singleLine=g,p?(p.clear(),this.icons=p):this.icons=new Map}draw(t,e){const{width:i,height:r}=this.getActualSize(),s=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let o=this.isHeightMax?Math.min(this.height,r):this.height||r||0;o=Math.min(o,r);let a=0;switch(this.globalBaseline){case"top":a=0;break;case"middle":a=-o/2;break;case"bottom":a=-o}let l=0;this.globalAlign==="right"||this.globalAlign==="end"?l=-s:this.globalAlign==="center"&&(l=-s/2);let h=this[this.directionKey.height];this.singleLine&&(h=this.lines[0].height+1);let d=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=h&&h!==0)for(let u=0;u<this.lines.length;u++){const{top:c,height:g}=this.lines[u];if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return d;let p=!1;this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+h&&(p=!0,d=!0),this.lines[u].draw(t,p,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+a,this.ellipsis,e)}else{const u=Math.floor((h-this.actualHeight)/2);this.layoutDirection==="vertical"?l+=u:a+=u;for(let c=0;c<this.lines.length;c++)this.lines[c].draw(t,!1,this.lines[c][this.directionKey.left]+l,this.lines[c][this.directionKey.top]+a,this.ellipsis,e)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let u=0;u<this.lines.length;u++){const{top:c,height:g}=this.lines[u],p=h-this.lines[u].top-this.lines[u].height;if(h===0)this.lines[u].draw(t,!1,l,p+a,this.ellipsis,e);else{if(p+g>this[this.directionKey.top]+h||p<this[this.directionKey.top])return d;{let f=!1;this.ellipsis&&this.lines[u+1]&&p-this.lines[u+1].height<this[this.directionKey.top]&&(f=!0,d=!0),this.lines[u].draw(t,f,l,p+a,this.ellipsis,e)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(l+=this.lines[0].height+1);for(let u=0;u<this.lines.length;u++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(l-=this.lines[u].height+this.lines[u].top);const{top:c,height:g}=this.lines[u];if(h===0)this.lines[u].draw(t,!1,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+a,this.ellipsis,e);else{if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return d;{let p=!1;this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+h&&(p=!0,d=!0),this.lines[u].draw(t,p,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+a,this.ellipsis,e)}}}}return d}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];r.actualWidth>t&&(t=r.actualWidth),e+=r.height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:r}=this.getRawActualSize();this.width,this.height;let s=this[this.directionKey.height];if(this.singleLine&&(s=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=s&&s!==0)for(let o=0;o<this.lines.length;o++){const{top:a,height:l}=this.lines[o];if(!(a+l<this[this.directionKey.top]||a+l>this[this.directionKey.top]+s))if(this.ellipsis&&this.lines[o+1]&&this.lines[o+1].top+this.lines[o+1].height>this[this.directionKey.top]+s){const h=this.ellipsis===!0?"...":this.ellipsis||"",d=this.lines[o].getWidthWithEllips(h);d>t&&(t=d),e+=this.lines[o].height}else this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}else{Math.floor((s-this.actualHeight)/2);for(let o=0;o<this.lines.length;o++)this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}else if(this.verticalDirection==="bottom")for(let o=0;o<this.lines.length;o++){const{top:a,height:l}=this.lines[o],h=s-this.lines[o].top-this.lines[o].height;if(s===0)this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height;else if(!(h+l>this[this.directionKey.top]+s||h<this[this.directionKey.top]))if(this.ellipsis&&this.lines[o+1]&&h-this.lines[o+1].height<this[this.directionKey.top]){const d=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[o].getWidthWithEllips(d);u>t&&(t=u),e+=this.lines[o].height}else this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}else for(let o=0;o<this.lines.length;o++){const{top:a,height:l}=this.lines[o];if(s===0)this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height;else if(!(a+l<this[this.directionKey.top]||a+l>this[this.directionKey.top]+s))if(this.ellipsis&&this.lines[o+1]&&this.lines[o+1].top+this.lines[o+1].height>this[this.directionKey.top]+s){const h=this.ellipsis===!0?"...":this.ellipsis||"",d=this.lines[o].getWidthWithEllips(h);d>t&&(t=d),e+=this.lines[o].height}else this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}};function om(n,t,e,i){const r=Math.round(n),s=Math.round(e),o=Math.round(t),a=Math.round(i);return{left:n>r?r:r-.5,top:e>s?s:s-.5,right:o>t?o:o+.5,bottom:a>i?a:a+.5}}let Du=class{constructor(t,e,i,r){var s,o;this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic",this.ascentDescentMode=r;const a=Z0(i.lineHeight,this.fontSize);this.lineHeight=typeof a=="number"?a>this.fontSize?a:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:l,height:h,descent:d,width:u}=Au(t,i,this.ascentDescentMode);let c=0,g=0,p=0;this.height>h&&(c=(this.height-h)/2,g=Math.ceil(c),p=Math.floor(c)),this.textBaseline==="top"?(this.ascent=c,this.descent=h-c):this.textBaseline==="bottom"?(this.ascent=h-c,this.descent=c):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=l+g,this.descent=d+p),this.length=t.length,this.width=u||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,this.space=i.space,this.dx=(s=i.dx)!==null&&s!==void 0?s:0,this.dy=(o=i.dy)!==null&&o!==void 0?o:0,i.direction==="vertical"&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:t}=Au(this.text,this.character,this.ascentDescentMode);this.width=t,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(t,e,i,r,s,o,a){if(this.text===""||this.text===`
`||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let l=e+i,h=this.text,d=this.left+r;l+=this.top;let u=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,u="vertical",l-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")h+=this.ellipsisStr,o!=="right"&&o!=="end"||(d-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const g=vC(h,(u==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,g),h+=this.ellipsisStr,(o==="right"||o==="end")&&u!=="vertical"){const{width:p}=Au(this.text.slice(g),this.character,this.ascentDescentMode);d-=this.ellipsisWidth-p}}}const c=om(d,d+(this.widthOrigin||this.width),e,e+a);return Object.assign(Object.assign({},c),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(t,e,i,r,s,o,a){var l;let h=e+i,d=this.text,u=this.left+r+((l=this.space)!==null&&l!==void 0?l:0)/2;h+=this.top;let c=this.direction;if(this.verticalEllipsis)d=this.ellipsisStr,c="vertical",h-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")d+=this.ellipsisStr,o!=="right"&&o!=="end"||(u-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const p=vC(d,(c==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,d.length-1);if(d=d.slice(0,p),d+=this.ellipsisStr,(o==="right"||o==="end")&&c!=="vertical"){const{width:f}=Au(this.text.slice(p),this.character,this.ascentDescentMode);u-=this.ellipsisWidth-f}}}switch(this.character.script){case"super":h-=this.ascent*(1/3);break;case"sub":h+=this.descent/2}c==="vertical"&&(t.save(),t.rotateAbout(Math.PI/2,u,h),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(u,h),u=0,h=0);const{lineWidth:g=1}=this.character;if(this.character.stroke&&g&&t.strokeText(d,u,h+this.dy),this.character.fill&&t.fillText(d,u,h+this.dy),this.character.fill){if(this.character.lineThrough||this.character.underline){if(this.character.underline){const p=1+h,f=om(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){const p=1+h-this.ascent/2,f=om(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h-this.ascent/2,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if(this.character.textDecoration==="underline"){const p=1+h,f=om(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if(this.character.textDecoration==="line-through"){const p=1+h-this.ascent/2,f=om(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h-this.ascent/2,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}c==="vertical"&&t.restore()}getWidthWithEllips(t){let e=this.text;const i=t==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return i;if(this.ellipsis==="add")return i+this.ellipsisWidth;if(this.ellipsis==="replace"){const r=vC(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,r),e+=this.ellipsisStr;const{width:s}=Au(this.text.slice(r),this.character,this.ascentDescentMode);return i+this.ellipsisWidth-s}return i}};function sct(n,t){const e=n.text.slice(0,t),i=n.text.slice(t);return[new Du(e,n.newLine,n.character,n.ascentDescentMode),new Du(i,!0,n.character,n.ascentDescentMode)]}const z3=["width","height","image",...wo];let mc=class qP extends js{constructor(t){super(t),this.type="image",this.numberType=eM,this.loadImage(this.attribute.image)}getImageElement(){const{image:t}=this.attribute;if(!t||!this.resources)return null;const e=this.resources.get(t);return e.state!=="success"?null:e.data}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){var t;return(t=this.attribute.repeatX)!==null&&t!==void 0?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return(t=this.attribute.repeatY)!==null&&t!==void 0?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,()=>{this.successCallback&&this.successCallback()}),this.addUpdateBoundTag()}imageLoadFail(t,e){super.imageLoadFail(t,()=>{this.failCallback&&this.failCallback()})}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,r){return t==="image"&&this.loadImage(e),super.setAttribute(t,e,i,r)}getGraphicTheme(){return _e(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const{maxWidth:o=e.maxWidth,maxHeight:a=e.maxHeight}=t;let{width:l,height:h}=t;if(l==null||h==null){const d=this.getImageElement();if(d){const u=d.width,c=d.height;if(l!=null)h=l*(c/u);else if(h!=null)l=h*(u/c);else{const g=u/c;g>o/a?(l=o,h=o/g):(h=a,l=a*g)}}else l=o,h=a}this._actualWidth=l,this._actualHeight=h,i.set(0,0,l,h)}const{tb1:r,tb2:s}=St.graphicService.updateTempAABBBounds(i);return tb(t,e,r),i.union(r),r.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,St.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return P_[t]}needUpdateTags(t){return super.needUpdateTags(t,z3)}needUpdateTag(t){return super.needUpdateTag(t,z3)}clone(){return new qP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return qP.NOWORK_ANIMATE_ATTR}};mc.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},da);function oM(n){return new mc(n)}let Ta=class extends mc{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],t.backgroundShowMode==="always"&&(this._hovered=!0),t.margin){const e=gS(t.margin);this._marginArray=typeof e=="number"?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(e,i,r)=>{if(V(r)&&r.indexOf("margin")!==-1||r==="margin")if(i.margin){const s=gS(i.margin);this._marginArray=typeof s=="number"?[s,s,s,s]:s}else this._marginArray=[0,0,0,0]}}get width(){var t;return((t=this.attribute.width)!==null&&t!==void 0?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return((t=this.attribute.height)!==null&&t!==void 0?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=P_.width,height:e=P_.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:r=e}=this.attribute,s=(i-t)/2,o=(r-e)/2;return this._AABBBounds.expand([0,2*s,2*o,0]),this._AABBBounds}setHoverState(t){this.attribute.backgroundShowMode==="hover"&&this._hovered!==t&&(this._hovered=t)}},oct=class{constructor(t,e,i,r,s,o,a,l){this.left=t,this.width=e,this.baseline=i,this.ascent=r,this.descent=s,this.top=i-r,this.paragraphs=o.map(d=>d),this.textAlign=(this.paragraphs[0]instanceof Ta?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=a,this.directionKey=TO[this.direction],this.actualWidth=0;let h=0;this.paragraphs.forEach((d,u)=>{if(u===0&&d instanceof Du){const c=Ght.exec(d.text);(c==null?void 0:c.index)!==0&&(d.text=d.text.slice(c==null?void 0:c.index),d.updateWidth())}this.actualWidth+=d[this.directionKey.width],h=Math.max(d[this.directionKey.height],h)}),this.height=h,this.blankWidth=l?0:this.width-this.actualWidth,this.calcOffset(e,l)}calcOffset(t,e){const i=this.directionKey,r=this.height;let s=this.left,o=0;this.actualWidth<t&&!e&&(this.textAlign==="right"||this.textAlign==="end"?s=t-this.actualWidth:this.textAlign==="center"?s=(t-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?s=(t-this.actualWidth)/2:o=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map(function(a){a instanceof Ta?(a["_"+i.x]=s,s+=a[i.width]+o,a["_"+i.y]=a.attribute.textBaseline==="top"?0:a.attribute.textBaseline==="bottom"?r-a.height:(r-a.height)/2):(a[i.left]=s,s+=a[i.width]+o)})}draw(t,e,i,r,s,o){if(s&&(e||this.paragraphs.some(u=>u.overflow))){let u=!0,c=!1;for(let p=this.paragraphs.length-1;p>=0;p--){const f=this.paragraphs[p];if(f.overflow)u=u&&f.text==="";else if(u){c=!0;break}}let g=0;if(!c)for(let p=this.paragraphs.length-1;p>=0;p--){const f=this.paragraphs[p];if(f.overflow){if(f.text==="")break;continue}if(f instanceof Ta)break;if(this.direction==="vertical"&&f.direction!=="vertical"){f.verticalEllipsis=!0;break}const m=s===!0?"...":s||"";f.ellipsisStr=m;const{width:v}=Au(m,f.character,f.ascentDescentMode),_=v||0;if(_<=this.blankWidth+g){e&&(f.ellipsis="add");break}if(_<=this.blankWidth+g+f.width){f.ellipsis="replace",f.ellipsisWidth=_,f.ellipsisOtherParagraphWidth=this.blankWidth+g;break}f.ellipsis="hide",g+=f.width}}let a="",l=-1,h=[];const d=[h];this.paragraphs.forEach((u,c)=>{if(u instanceof Ta)return;const g=u.drawBackground(t,r,this.ascent,i,c===0,this.textAlign,this.height);g&&(a===g.fillStyle&&l===g.globalAlpha||(h=[],d.push(h),a=g.fillStyle,l=g.globalAlpha),h.push(g))}),d.forEach(u=>{if(u.length===0)return;const c=u[0],g=u[u.length-1];t.fillStyle=c.fillStyle,t.globalAlpha=c.globalAlpha,t.fillRect(c.left,c.top,g.right-c.left,g.bottom-c.top)}),this.paragraphs.forEach((u,c)=>{if(u instanceof Ta)return u.setAttributes({x:i+u._x,y:r+u._y}),void o(u,t,i+u._x,r+u._y,this.ascent);const g={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};Yht(t,u.character),Uht(t,u.character,g),u.draw(t,r,this.ascent,i,c===0,this.textAlign,this.height)})}getWidthWithEllips(t){let e=0;for(let r=this.paragraphs.length-1;r>=0;r--){const s=this.paragraphs[r];if(s instanceof Ta)break;const{width:o}=Au(t,s.character,s.ascentDescentMode),a=o||0;if(a<=this.blankWidth+e){s.ellipsis="add",s.ellipsisWidth=a;break}if(a<=this.blankWidth+e+s.width){s.ellipsis="replace",s.ellipsisWidth=a,s.ellipsisOtherParagraphWidth=this.blankWidth+e;break}s.ellipsis="hide",e+=s.width}let i=0;return this.paragraphs.forEach((r,s)=>{i+=r instanceof Ta?r.width:r.getWidthWithEllips(this.direction)}),i}},act=class{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=TO[this.direction]}store(t){if(t instanceof Ta){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;t.attribute.textBaseline==="top"?(e=0,i=t.height):t.attribute.textBaseline==="bottom"?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),t.text.length!==0?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(this.lineBuffer.length===0)return;const t=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,e=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,i=new oct(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t,e=!1){t instanceof Ta?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineBuffer.length===0?(this.store(t),this.send()):(this.send(),this.deal(t)):typeof this.width!="number"||this.width<0||(t.newLine&&this.send(),(t.text.length!==0||this.newLine)&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){const i=this[this.directionKey.width]-this.lineWidth||0,r=Math.ceil(i/t[this.directionKey.width]*t.length)||0,s=vC(t.text,i,t.character,r,this.frame.wordBreak==="break-word");if(s!==0){const[o,a]=sct(t,s);this.store(o),e?this.send():this.deal(a)}else this.lineBuffer.length!==0&&(this.send(),this.deal(t))}},ZP=!1;try{ZP=Intl&&typeof Intl.Segmenter=="function"}catch{ZP=!1}const W3=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...wo];let Wd=class Eh extends js{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=DO,this.onBeforeAttributeUpdate=(e,i,r)=>{for(const s in e)if(s==="hoverIconId"){if(e[s]===i[s])continue;const o=this._frameCache.icons.get(e[s]);this.updateHoverIconState(o)}}}get width(){var t;return(t=this.attribute.width)!==null&&t!==void 0?t:xl.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return(t=this.attribute.height)!==null&&t!==void 0?t:xl.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return(t=this.attribute.ellipsis)!==null&&t!==void 0?t:xl.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return(t=this.attribute.wordBreak)!==null&&t!==void 0?t:xl.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return(t=this.attribute.verticalDirection)!==null&&t!==void 0?t:xl.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return(t=this.attribute.textAlign)!==null&&t!==void 0?t:xl.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return(t=this.attribute.textBaseline)!==null&&t!==void 0?t:xl.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return(t=this.attribute.textConfig)!==null&&t!==void 0?t:xl.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return _e(this).richtext}static AllSingleCharacter(t){return t.lines?t.lines.every(e=>e.paragraphs.every(i=>!(i.text&&yt(i.text)&&Eh.splitText(i.text).length>1))):t.every(e=>e.isComposing||!(e.text&&yt(e.text)&&Eh.splitText(e.text).length>1))}static splitText(t){if(ZP){const e=new Intl.Segmenter(void 0,{granularity:"grapheme"}),i=[];for(const{segment:r}of e.segment(t))i.push(r);return i}return Array.from(t)}static TransformTextConfig2SingleCharacter(t){const e=[];return t.forEach(i=>{const r=Eh.splitText(i.text.toString());if(yt(i.text)&&r.length>1)for(let s=0;s<r.length;s++){const o=r[s];e.push(Object.assign(Object.assign({},i),{text:o}))}else e.push(i)}),e}updateAABBBounds(t,e,i){var r,s,o,a;const{width:l=e.width,height:h=e.height,maxWidth:d=e.maxWidth,maxHeight:u=e.maxHeight,textAlign:c=e.textAlign,textBaseline:g=(s=(r=t.textBaseline)!==null&&r!==void 0?r:e.textBaseline)!==null&&s!==void 0?s:"top",editOptions:p}=t;if(l>0&&h>0)i.set(0,0,l,h);else{const v=this.getFrameCache(),{width:_,height:b}=v.getActualSize();let y=l||_||0,C=h||b||0;C=typeof u=="number"&&C>u?u:C||0,y=typeof d=="number"&&y>d?d:y||0,i.set(0,0,y,C)}p&&p.keepHeightWhileEmpty&&!i.height()&&!(!((o=t.textConfig)===null||o===void 0)&&o.length)&&(i.y2=i.y1+((a=t.fontSize)!==null&&a!==void 0?a:12),i.x2=i.x1+2);let f=0;switch(g){case"top":f=0;break;case"middle":f=-i.height()/2;break;case"bottom":f=-i.height()}let m=0;switch(c){case"left":m=0;break;case"center":m=-i.width()/2;break;case"right":m=-i.width()}return i.translate(m,f),St.graphicService.updateTempAABBBounds(i),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||St.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,St.graphicService.transformAABBBounds(t,i,e,!1,this),i.width()===0&&i.height()===0&&i.clear(),i}needUpdateTags(t){return super.needUpdateTags(t,W3)}needUpdateTag(t){return super.needUpdateTag(t,W3)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const t=this.getFrameCache();if(t.actualHeight>t.height)return!0;const{disableAutoWrapLine:e}=this.attribute;if(e)for(let i=0;i<t.lines.length;i++){const r=t.lines[i];for(let s=0;s<r.paragraphs.length;s++){const o=r.paragraphs[s];if(o.overflow&&o.text!=="")return!0}}return!1}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:r,fontFamily:s,fontStyle:o,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:d,lineHeight:u,strokeOpacity:c,upgradeAttrs:g}=this.attribute,p=Object.assign({fill:e,stroke:i,fontSize:r,fontFamily:s,fontStyle:o,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:d,strokeOpacity:c},t);return g!=null&&g.lineHeight&&(p.lineHeight=u),p}doUpdateFrameCache(t){var e;const{maxWidth:i,maxHeight:r,width:s,height:o,ellipsis:a,wordBreak:l,verticalDirection:h,textAlign:d,textBaseline:u,layoutDirection:c,singleLine:g,disableAutoWrapLine:p,editable:f,ascentDescentMode:m,upgradeAttrs:v}=this.attribute,_=v&&v.multiBreakLine;let{textConfig:b=[]}=this.attribute;f&&b.length>0&&!Eh.AllSingleCharacter(b)&&(b=Eh.TransformTextConfig2SingleCharacter(b),this.attribute.textConfig=b);const y=[],C=t??b;for(let R=0;R<C.length;R++)if("image"in C[R]){const B=this.combinedStyleToCharacter(C[R]);B.lineWidth=void 0;const E=B.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(B.id);if(E)y.push(E);else{const k=new Ta(B);k.successCallback=()=>{var P;this.addUpdateBoundTag(),(P=this.stage)===null||P===void 0||P.renderNextFrame()},k.richtextId=B.id,y.push(k)}}else{const B=this.combinedStyleToCharacter(C[R]);if(J(B.text)&&(B.text=`${B.text}`),B.text&&B.text.includes(`
`)){const E=B.text.split(`
`);for(let k=0;k<E.length;k++)if(k===0)y.push(new Du(E[k],!1,B,m));else if(E[k]||R===C.length-1)y.push(new Du(E[k],!0,B,m));else{const P=this.combinedStyleToCharacter(C[R+1]);y.push(new Du(E[k],!0,P,m))}}else B.text&&y.push(new Du(B.text,!1,B,m))}const S=typeof i=="number"&&Number.isFinite(i)&&i>0,w=typeof r=="number"&&Number.isFinite(r)&&r>0,x=typeof s=="number"&&Number.isFinite(s)&&s>0&&(!S||s<=i),A=typeof o=="number"&&Number.isFinite(o)&&o>0&&(!w||o<=r),M=new rct(0,0,(x?s:S?i:0)||0,(A?o:w?r:0)||0,a,l,h,d,u,c||"horizontal",!x&&S,!A&&w,g||!1,(e=this._frameCache)===null||e===void 0?void 0:e.icons),T=new act(M);if(T.newLine=_,p){let R=0,B=!1;for(let E=0;E<y.length;E++){const k=y[E];B?(k.overflow=!0,k.left=1/0,k.top=1/0,!k.newLine&&M.lines[M.lines.length-1].paragraphs.push(k)):T.deal(k,!0),M.lines.length!==R&&(R=M.lines.length,T.lineBuffer.length=0,k.overflow=!0,k.left=1e3,k.top=1e3,M.lines[M.lines.length-1].paragraphs.push(k),B=!0),k.newLine&&(B=!1,T.lineWidth=0),T.send()}}else for(let R=0;R<y.length;R++)T.deal(y[R]);if(T.send(),!(M.layoutDirection==="horizontal"?x:A)){const R=M.getActualSizeWidthEllipsis();let B=M.layoutDirection==="horizontal"?R.width:R.height;(M.layoutDirection==="horizontal"?S:w)&&(B=Math.min(B,M.layoutDirection==="horizontal"?i:r)),M.lines.forEach(function(E){E.calcOffset(B,!1)})}_&&M.lines.forEach(R=>{const B=R.paragraphs;R.paragraphs=R.paragraphs.filter(E=>E.text!==""),R.paragraphs.length===0&&B.length&&(B[0].text=`
`,R.paragraphs.push(B[0]))}),this._frameCache=M}clone(){return new Eh(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach(i=>{i.setStage(t,e)})}bindIconEvent(){this.addEventListener("pointermove",t=>{const e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))}),this.addEventListener("pointerleave",t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)})}updateHoverIconState(t){var e,i,r,s,o;t?((e=this._currentHoverIcon)===null||e===void 0||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),(i=this.stage)===null||i===void 0||i.setCursor(t.attribute.cursor),(r=this.stage)===null||r===void 0||r.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(s=this.stage)===null||s===void 0||s.setCursor(),(o=this.stage)===null||o===void 0||o.renderNextFrame())}pickIcon(t){const e=this.getFrameCache(),{e:i,f:r}=this.globalTransMatrix;let s;return e.icons.forEach((o,a)=>{var l,h;const d=o.AABBBounds.clone();d.translate(o._marginArray[3],o._marginArray[0]),d.containsPoint({x:t.x-i,y:t.y-r})&&(s=o,s.globalX=((l=s.attribute.x)!==null&&l!==void 0?l:0)+i+o._marginArray[3],s.globalY=((h=s.attribute.y)!==null&&h!==void 0?h:0)+r+o._marginArray[0])}),s}getNoWorkAnimateAttr(){return Eh.NOWORK_ANIMATE_ATTR}};Wd.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},da);function lct(n){return new Wd(n)}const j3=["path","customPath",...wo];let jX=class JP extends js{constructor(t){super(t),this.type="path",this.numberType=iM}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return t!=null&&t!==""}getParsedPathShape(){const t=this.getGraphicTheme();if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof Gn?e.path:(D(this.cache)&&this.doUpdatePathShape(),this.cache instanceof Gn?this.cache:t.path)}getGraphicTheme(){return _e(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const a=this.getParsedPathShape();i.union(a.getBounds())}const{tb1:r,tb2:s}=St.graphicService.updateTempAABBBounds(i);tb(t,e,r),i.union(r),r.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:o=e.lineJoin}=t;return St.graphicService.transformAABBBounds(t,i,e,o==="miter",this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){const t=this.attribute;yt(t.path,!0)?this.cache=new Gn().fromString(t.path):t.customPath&&(this.cache=new Gn,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,j3)}needUpdateTag(t){return super.needUpdateTag(t,j3)}toCustomPath(){return new Gn().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new JP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return JP.NOWORK_ANIMATE_ATTR}};jX.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},da);function hct(n){return new jX(n)}const N3=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...wo];let jO=class QP extends js{constructor(t){super(t),this.type="arc",this.numberType=QA}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:r}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(r)}getParsedCornerRadius(){const t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:r=t.outerPadding}=this.attribute;let{outerRadius:s=t.outerRadius,innerRadius:o=t.innerRadius}=this.attribute;if(s+=r,o-=i,e===0||e==="0%")return 0;const a=Math.abs(s-o),l=h=>Math.min(J(h,!0)?h:a*parseFloat(h)/100,a/2);if(V(e)){const h=e.map(d=>l(d)||0);return h.length===0?[h[0],h[0],h[0],h[0]]:h.length===2?[h[0],h[1],h[0],h[1]]:(h.length===3&&h.push(0),h)}return l(e)}getParsedAngle(){const t=this.getGraphicTheme();let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:r=t.cap}=this.attribute,s=i-e>=0?1:-1,o=i-e;if(e=MY(e),i=e+o,r&&Et(o)<Ft-$t){let a=1,l=1;r.length&&(a=Number(r[0]),l=Number(r[1]));let{outerRadius:h=t.outerRadius,innerRadius:d=t.innerRadius}=this.attribute;const{outerPadding:u=t.outerPadding,innerPadding:c=t.innerPadding}=this.attribute;h+=u,d-=c;const g=Math.abs(h-d)/2,p=g/h;if(g>$t&&h>$t)return{startAngle:e-s*p*a,endAngle:i+s*p*l,sc:s*p*a,ec:s*p*l}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=this.getGraphicTheme(),{innerPadding:r=i.innerPadding,outerPadding:s=i.outerPadding,padAngle:o=i.padAngle}=this.attribute;let{outerRadius:a=i.outerRadius,innerRadius:l=i.innerRadius}=this.attribute;a+=s,l-=r;const{padRadius:h=Rn(a*a+l*l)}=this.attribute,d=Et(e-t);let u=t,c=e,g=t,p=e;const f=o/2;let m=d,v=d;if(f>$t&&h>$t){const _=e>t?1:-1;let b=ZC(Number(h)/l*ee(f)),y=ZC(Number(h)/a*ee(f));return(m-=2*b)>$t?(b*=_,g+=b,p-=b):(m=0,g=p=(t+e)/2),(v-=2*y)>$t?(y*=_,u+=y,c-=y):(v=0,u=c=(t+e)/2),{outerStartAngle:u,outerEndAngle:c,innerStartAngle:g,innerEndAngle:p,innerDeltaAngle:m,outerDeltaAngle:v}}return{outerStartAngle:u,outerEndAngle:c,innerStartAngle:g,innerEndAngle:p,innerDeltaAngle:m,outerDeltaAngle:v}}getGraphicTheme(){return _e(this).arc}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));const{tb1:s,tb2:o}=St.graphicService.updateTempAABBBounds(i);tb(t,e,s),i.union(s),s.setValue(o.x1,o.y1,o.x2,o.y2),this.setWidthHeightWithoutTransform(i);const{lineJoin:a=e.lineJoin}=t;return St.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:s=e.innerRadius}=t;const{outerPadding:o=e.outerPadding,innerPadding:a=e.innerPadding}=t;return r+=o,s-=a,r<s&&(r=s),i.set(-r,-r,r,r),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:s=e.innerRadius}=t;const{outerPadding:o=e.outerPadding,innerPadding:a=e.innerPadding}=t;if(r+=o,s-=a,r<s){const d=r;r=s,s=d}let{endAngle:l=e.endAngle,startAngle:h=e.startAngle}=t;if(h>l){const d=h;h=l,l=d}return r<=$t?i.set(0,0,0,0):Math.abs(l-h)>Ft-$t?i.set(-r,-r,r,r):(EP(h,l,r,i),EP(h,l,s,i)),i}needUpdateTags(t){return super.needUpdateTags(t,N3)}needUpdateTag(t){return super.needUpdateTag(t,N3)}toCustomPath(){var t,e,i,r;const s=this.attribute,{startAngle:o,endAngle:a}=this.getParsedAngle();let l=((t=s.innerRadius)!==null&&t!==void 0?t:0)-((e=s.innerPadding)!==null&&e!==void 0?e:0),h=((i=s.outerRadius)!==null&&i!==void 0?i:0)-((r=s.outerPadding)!==null&&r!==void 0?r:0);const d=Et(a-o),u=a>o;if(h<l){const g=h;h=l,l=g}const c=new Gn;if(h<=$t)c.moveTo(0,0);else if(d>=Ft-$t)c.moveTo(0+h*me(o),0+h*ee(o)),c.arc(0,0,h,o,a,!u),l>$t&&(c.moveTo(0+l*me(a),0+l*ee(a)),c.arc(0,0,l,a,o,u));else{const g=h*me(o),p=h*ee(o),f=l*me(a),m=l*ee(a);c.moveTo(0+g,0+p),c.arc(0,0,h,o,a,!u),c.lineTo(0+f,0+m),c.arc(0,0,l,a,o,u),c.closePath()}return c}clone(){return new QP(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return QP.NOWORK_ANIMATE_ATTR}};jO.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},da);function _S(n){return new jO(n)}const $3=["points","cornerRadius",...wo];let NX=class tE extends js{constructor(t){super(t),this.type="polygon",this.numberType=nM}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return _e(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),St.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return St.graphicService.transformAABBBounds(t,i,e,r==="miter",this),i}updatePolygonAABBBoundsImprecise(t,e,i){const{points:r=e.points}=t;return r.forEach(s=>{i.add(s.x,s.y)}),i}_interpolate(t,e,i,r,s){t==="points"&&(s.points=pX(i,r,e))}needUpdateTags(t){return super.needUpdateTags(t,$3)}needUpdateTag(t){return super.needUpdateTag(t,$3)}toCustomPath(){const t=this.attribute.points,e=new Gn;return t.forEach((i,r)=>{r===0?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)}),e.closePath(),e}clone(){return new tE(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return tE.NOWORK_ANIMATE_ATTR}};NX.NOWORK_ANIMATE_ATTR=da;function $X(n){return new NX(n)}let dct=class extends el{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}};function uct(n){return new dct(n)}let cct=class{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}};const Ut=new cct;let sy;function aM(n){return sy||(sy=Ut.CreateGraphic("text",{})),sy.initAttributes(n),sy.AABBBounds}var gct=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},pct=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},V3=function(n,t){return function(e,i){t(e,i,n)}};let lM=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){var p;const{background:f,backgroundOpacity:m=(p=t.attribute.fillOpacity)!==null&&p!==void 0?p:h.backgroundOpacity,opacity:v=h.opacity,backgroundMode:_=h.backgroundMode,backgroundFit:b=h.backgroundFit,backgroundKeepAspectRatio:y=h.backgroundKeepAspectRatio,backgroundScale:C=h.backgroundScale,backgroundOffsetX:S=h.backgroundOffsetX,backgroundOffsetY:w=h.backgroundOffsetY,backgroundClip:x=h.backgroundClip}=t.attribute;if(f)if(t.backgroundImg&&t.resources){const A=t.resources.get(f);if(A.state!=="success"||!A.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const T=_e(t.parent).group,{scrollX:R=T.scrollX,scrollY:B=T.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(R,B)}x&&e.clip();const M=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,r,h),e.globalAlpha=m*v,this.doDrawImage(e,A.data,M,{backgroundMode:_,backgroundFit:b,backgroundKeepAspectRatio:y,backgroundScale:C,backgroundOffsetX:S,backgroundOffsetY:w}),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.globalAlpha=m*v,e.fillStyle=f,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,r){const{backgroundMode:s,backgroundFit:o,backgroundKeepAspectRatio:a,backgroundScale:l=1,backgroundOffsetX:h=0,backgroundOffsetY:d=0}=r,u=i.width(),c=i.height();let g=u,p=c;if(s==="no-repeat")if(o)if(a){const f=Math.max(u/e.width,c/e.height);t.drawImage(e,i.x1+h,i.y1+d,e.width*f*l,e.height*f*l)}else t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const f=e.width*l,m=e.height*l;t.drawImage(e,i.x1+h,i.y1+d,f,m)}else{if(o&&s!=="repeat"&&(e.width||e.height)){const v=e.width,_=e.height;s==="repeat-x"?(g=v*(c/_),p=c):s==="repeat-y"&&(p=_*(u/v),g=u);const b=t.dpr,y=Xu.allocate({width:g,height:p,dpr:b}),C=y.getContext("2d");C&&(C.inuse=!0,C.clearMatrix(),C.setTransformForCurrent(!0),C.clearRect(0,0,g,p),C.drawImage(e,0,0,g,p),e=y.nativeCanvas),Xu.free(y)}const f=t.dpr,m=t.createPattern(e,s);m.setTransform&&m.setTransform(new DOMMatrix([1/f,0,0,1/f,0,0])),t.fillStyle=m,t.translate(i.x1,i.y1),t.fillRect(0,0,u,c),t.translate(-i.x1,-i.y1)}}};const jd=new lM;let ia=class{constructor(t){this.subRenderContribitions=t,this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach(p=>{p.render(t,e,i,r,s,o,a,l,h,d,u,c,g)})}};ia=gct([Bt(),V3(0,xe(tn)),V3(0,Sn(HO)),pct("design:paramtypes",[Object])],ia);let fct=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){var p,f;const{clipConfig:m}=t.attribute;if(!m)return;const v=t.getClipPath();if(!v)return;const _=!(u||c),b=t.AABBBounds,y=(p=t.attribute.width)!==null&&p!==void 0?p:b.width(),C=(f=t.attribute.height)!==null&&f!==void 0?f:b.height();_&&e.save(),e.beginPath(),v.draw(e,[y,C],i+y/2,r+C/2,0)===!1&&e.closePath(),u&&u(e,t.attribute,h,!0),_&&e.clip()}};const mct=new fct;let vct=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){const{clipConfig:p}=t.attribute;p&&t.getClipPath()&&(u||c||e.restore())}};const _ct=new vct;function bct(n){return n<=.5?4*n-1:-4*n+3}function yct(n,t,e,i,r,s,o){const{fill:a="orange",percent:l=.6,frequency:h=4,opacity:d,phi:u=0}=r;let{amplitude:c=10}=r;c*=bct(t);const g=i*(1-l),p=e,f=Math.max(Math.round(p/70),2);n.beginPath(),n.moveTo(0+s,i+o),n.lineTo(0+s,g+o);const m=p/h*t,v=p/Math.PI/(2*h);for(let _=0;_<p;_+=f){const b=c*Math.sin((_+m+u)/v+u);n.lineTo(_+s,g+b+o)}n.lineTo(p+s,i+o),n.closePath(),n.fillStyle=a,isFinite(d)&&(n.globalAlpha=d),n.fill()}let NO=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(t,e,i,r,s){const o=(t-2*e)/2,a=r.dpr,l=Xu.allocate({width:t,height:t,dpr:a}),h=l.getContext("2d");if(!h)return null;h.inuse=!0,h.clearMatrix(),h.setTransformForCurrent(!0),h.clearRect(0,0,t,t),s(o,h);const d=r.createPattern(l.nativeCanvas,"repeat");return d.setTransform&&d.setTransform(new DOMMatrix([1/a,0,0,1/a,0,0])),Xu.free(l),d}createCirclePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{o.fillStyle=i,o.arc(s,s,s,0,Ft),o.fill()})}createDiamondPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=t/2,l=a;o.fillStyle=i,o.moveTo(a,l-s),o.lineTo(s+a,l),o.lineTo(a,l+s),o.lineTo(a-s,l),o.closePath(),o.fill()})}createRectPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e,l=a;o.fillStyle=i,o.fillRect(a,l,2*s,2*s)})}createVerticalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e;o.fillStyle=i,o.fillRect(a,0,2*s,t)})}createHorizontalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e;o.fillStyle=i,o.fillRect(0,a,t,2*s)})}createBiasLRLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{o.strokeStyle=i,o.lineWidth=s,o.moveTo(0,0),o.lineTo(t,t);const a=t/2,l=-a;o.moveTo(a,l),o.lineTo(a+t,l+t),o.moveTo(-a,-l),o.lineTo(-a+t,-l+t),o.stroke()})}createBiasRLLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{o.strokeStyle=i,o.lineWidth=s,o.moveTo(t,0),o.lineTo(0,t);const a=t/2,l=a;o.moveTo(t+a,l),o.lineTo(a,l+t),o.moveTo(t-a,-l),o.lineTo(-a,-l+t),o.stroke()})}createGridPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e,l=a;o.fillStyle=i,o.fillRect(a,l,s,s),o.fillRect(a+s,l+s,s,s)})}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){this.textureMap||this.initTextureMap(e,t.stage);const{texture:p=h.texture,textureColor:f=h.textureColor,textureSize:m=h.textureSize,texturePadding:v=h.texturePadding}=t.attribute;p&&this.drawTexture(p,t,e,i,r,h,f,m,v)}drawTexture(t,e,i,r,s,o,a,l,h){var d;const{textureRatio:u=o.textureRatio,textureOptions:c=null}=e.attribute;let g=this.textureMap.get(t);if(!g)switch(t){case"circle":g=this.createCirclePattern(l,h,a,i);break;case"diamond":g=this.createDiamondPattern(l,h,a,i);break;case"rect":g=this.createRectPattern(l,h,a,i);break;case"vertical-line":g=this.createVerticalLinePattern(l,h,a,i);break;case"horizontal-line":g=this.createHorizontalLinePattern(l,h,a,i);break;case"bias-lr":g=this.createBiasLRLinePattern(l,h,a,i);break;case"bias-rl":g=this.createBiasRLLinePattern(l,h,a,i);break;case"grid":g=this.createGridPattern(l,h,a,i)}if(c&&c.dynamicTexture){const{gridConfig:p={},useNewCanvas:f}=c,m=e.AABBBounds;r=m.x1,s=m.y1;const v=i;let _;if(f){_=Xu.allocate({width:m.width(),height:m.height(),dpr:i.dpr});const E=_.getContext("2d");E.clearRect(0,0,m.width(),m.height()),r=0,s=0,i=E}if(v.save(),e.parent&&!e.transMatrix.onlyTranslate()){const{scrollX:E=0,scrollY:k=0}=e.parent.attribute;v.setTransformFromMatrix(e.parent.globalTransMatrix),v.translate(E,k,!0)}v.setCommonStyle(e,e.attribute,r,s,o),v.clip();const b=m.width(),y=m.height(),C=h,S=l,w=p.columns?p.columns:Math.ceil(b/S),x=p.rows?p.rows:Math.ceil(y/S),A=p.gutterColumn?p.gutterColumn:2*C,M=p.gutterRow?p.gutterRow:2*C;this._tempSymbolGraphic||(this._tempSymbolGraphic=Zp({}));const T=p.columns?b/p.columns:S,R=p.rows?y/p.rows:S;this._tempSymbolGraphic.setAttributes({size:[T-A,R-M],symbolType:t});const B=this._tempSymbolGraphic.getParsedPath();for(let E=0;E<x;E++)for(let k=0;k<w;k++){const P=r+S/2+k*S,I=s+S/2+E*S;(d=c.beforeDynamicTexture)===null||d===void 0||d.call(c,i,E,k,x,w,u,e,m.width(),m.height()),i.beginPath(),B.draw(i,Math.min(T-A,R-M),P,I,0)===!1&&i.closePath(),i.fillStyle=a,c.dynamicTexture(i,E,k,x,w,u,e,m.width(),m.height())}f&&(v.globalAlpha=1,v.drawImage(_.nativeCanvas,0,0,_.nativeCanvas.width,_.nativeCanvas.height,m.x1,m.y1,m.width()*v.dpr,m.height()*v.dpr)),v.restore()}else if(g)i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,r,s,o),i.fillStyle=g,i.fill(),i.highPerformanceRestore();else if(t==="wave"){i.save(),i.setCommonStyle(e,e.attribute,r,s,o),i.clip();const p=e.AABBBounds;yct(i,u,p.width(),p.height(),Object.assign(Object.assign({},c||{}),{fill:a}),r+p.x1-r,s+p.y1-s),i.restore()}}};const Of=new NO;let Cct=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&g.visible!==!1,m=p&&p.visible!==!1;if(!f&&!m)return;const{innerPadding:v=h.innerPadding,outerPadding:_=h.outerPadding,startAngle:b=h.startAngle,endAngle:y=h.endAngle,opacity:C=h.opacity,x:S=h.x,y:w=h.y,scaleX:x=h.scaleX,scaleY:A=h.scaleY,keepStrokeScale:M=h.keepStrokeScale}=t.attribute;let{innerRadius:T=h.innerRadius,outerRadius:R=h.outerRadius}=t.attribute;R+=_,T-=v;const B=(E,k)=>{const P=!(!E||!E.stroke),{distance:I=h[k].distance}=E,O=M?I:lh(e,I,e.dpr),H=I/R,z=k==="outerBorder"?1:-1;if(t.setAttributes({outerRadius:R+z*O,innerRadius:T-z*O,startAngle:b-z*H,endAngle:y+z*H}),e.beginPath(),DP(t,e,i,r,R+z*O,T-z*O),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,E,h[k]);else if(P){const F=h[k].opacity;h[k].opacity=C,e.setStrokeStyle(t,E,(S-i)/x,(w-r)/A,h[k]),h[k].opacity=F,e.stroke()}};f&&B(g,"outerBorder"),m&&B(p,"innerBorder"),t.setAttributes({outerRadius:R,innerRadius:T,startAngle:b,endAngle:y})}};const Sct=new Cct,xct=Of,wct=jd;let Act=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&g.visible!==!1,m=p&&p.visible!==!1;if(!f&&!m)return;const{radius:v=h.radius,startAngle:_=h.startAngle,endAngle:b=h.endAngle,opacity:y=h.opacity,x:C=h.x,y:S=h.y,scaleX:w=h.scaleX,scaleY:x=h.scaleY,keepStrokeScale:A=h.keepStrokeScale}=t.attribute,M=(T,R)=>{const B=!(!T||!T.stroke),{distance:E=h[R].distance}=T,k=A?E:lh(e,E,e.dpr),P=R==="outerBorder"?1:-1;if(e.beginPath(),e.arc(i,r,v+P*k,_,b),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,T,h[R]);else if(B){const I=h[R].opacity;h[R].opacity=y,e.setStrokeStyle(t,T,(C-i)/w,(S-r)/x,h[R]),h[R].opacity=I,e.stroke()}};f&&M(g,"outerBorder"),m&&M(p,"innerBorder")}};const Mct=new Act,Tct=Of,kct=jd;let Rct=class extends lM{constructor(){super(...arguments),this.time=Ze.beforeFillStroke}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{background:g,backgroundMode:p=h.backgroundMode,backgroundFit:f=h.backgroundFit,backgroundKeepAspectRatio:m=h.backgroundKeepAspectRatio,backgroundScale:v=h.backgroundScale,backgroundOffsetX:_=h.backgroundOffsetX,backgroundOffsetY:b=h.backgroundOffsetY}=t.attribute;if(g)if(t.backgroundImg&&t.resources){const y=t.resources.get(g);if(y.state!=="success"||!y.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const C=t.AABBBounds;this.doDrawImage(e,y.data,C,{backgroundMode:p,backgroundFit:f,backgroundKeepAspectRatio:m,backgroundScale:v,backgroundOffsetX:_,backgroundOffsetY:b}),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=g,e.fill(),e.highPerformanceRestore()}};const G3=new Rct,oy=Kt/2;function il(n,t,e,i,r,s,o=!0,a){let l;if(Array.isArray(o)&&(a=o,o=!0),i<0&&(t+=i,i=-i),r<0&&(e+=r,r=-r),J(s,!0))l=[s=Et(s),s,s,s];else if(Array.isArray(s)){const w=s;let x,A;switch(w.length){case 0:l=[0,0,0,0];break;case 1:x=Et(w[0]),l=[x,x,x,x];break;case 2:case 3:x=Et(w[0]),A=Et(w[1]),l=[x,A,x,A];break;default:l=w,l[0]=Et(l[0]),l[1]=Et(l[1]),l[2]=Et(l[2]),l[3]=Et(l[3])}}else l=[0,0,0,0];if(i<0||l[0]+l[1]+l[2]+l[3]<1e-12)return n.rect(t,e,i,r);const[h,d,u,c]=[[t,e],[t+i,e],[t+i,e+r],[t,e+r]],g=Math.min(i/2,r/2),p=[Math.min(g,l[0]),Math.min(g,l[1]),Math.min(g,l[2]),Math.min(g,l[3])],f=[h[0]+p[0],h[1]],m=[h[0],h[1]+p[0]],v=[d[0]-p[1],d[1]],_=[d[0],d[1]+p[1]],b=[u[0]-p[2],u[1]],y=[u[0],u[1]-p[2]],C=[c[0]+p[3],c[1]],S=[c[0],c[1]-p[3]];if(n.moveTo(f[0],f[1]),o){if(a&&a[0]?a[0](f[0],f[1],v[0],v[1]):n.lineTo(v[0],v[1]),!Hl(v,_)){a&&a[0]&&n.moveTo(v[0],v[1]);const w=v[0],x=v[1]+p[1];n.arc(w,x,p[1],-oy,0,!1)}if(a&&a[1]?a[1](_[0],_[1],y[0],y[1]):n.lineTo(y[0],y[1]),!Hl(b,y)){const w=y[0]-p[2],x=y[1];a&&a[1]&&n.moveTo(y[0],y[1]),n.arc(w,x,p[2],0,oy,!1)}if(a&&a[2]?a[2](b[0],b[1],C[0],C[1]):n.lineTo(C[0],C[1]),!Hl(C,S)){const w=C[0],x=C[1]-p[3];a&&a[2]&&n.moveTo(C[0],C[1]),n.arc(w,x,p[3],oy,Kt,!1)}if(a&&a[3]?a[3](S[0],S[1],m[0],m[1]):n.lineTo(m[0],m[1]),!Hl(f,m)){const w=f[0],x=f[1]+p[0];a&&a[3]&&n.moveTo(m[0],m[1]),n.arc(w,x,p[0],Kt,Kt+oy,!1)}}else a&&a[0]?a[0](f[0],f[1],v[0],v[1]):n.lineTo(v[0],v[1]),a&&a[1]?a[1](v[0],v[1],b[0],b[1]):n.lineTo(b[0],b[1]),a&&a[2]?a[2](b[0],b[1],C[0],C[1]):n.lineTo(C[0],C[1]),a&&a[2]?a[2](C[0],C[1],f[0],f[1]):n.lineTo(f[0],f[1]);return!a&&n.closePath(),n}var VX=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let GX=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&g.visible!==!1,m=p&&p.visible!==!1;if(!f&&!m)return;const{cornerRadius:v=h.cornerRadius,cornerType:_=h.cornerType,opacity:b=h.opacity,x:y=h.x,y:C=h.y,scaleX:S=h.scaleX,scaleY:w=h.scaleY,x1:x,y1:A,keepStrokeScale:M=h.keepStrokeScale}=t.attribute;let{width:T,height:R}=t.attribute;T=(T??x-i)||0,R=(R??A-r)||0;const B=(E,k)=>{const P=!(!E||!E.stroke),I=k==="outerBorder"?-1:1,{distance:O=h[k].distance}=E,H=M?O:lh(e,O,e.dpr),z=i+I*H,F=r+I*H,j=2*H;if(v===0||V(v)&&v.every($=>$===0)?(e.beginPath(),e.rect(z,F,T-I*j,R-I*j)):(e.beginPath(),il(e,z,F,T-I*j,R-I*j,v,_!=="bevel")),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,E,h[k]);else if(P){const $=h[k].opacity;h[k].opacity=b,e.setStrokeStyle(t,E,(y-i)/S,(C-r)/w,h[k]),h[k].opacity=$,e.stroke()}};f&&B(g,"outerBorder"),m&&B(p,"innerBorder")}},Jp=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){const{stroke:p=h.stroke}=t.attribute;Array.isArray(p)&&p.some(f=>f===!1)&&(g.doStroke=!1)}};Jp=VX([Bt()],Jp);let Qp=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{x1:g,y1:p,x:f=h.x,y:m=h.y,stroke:v=h.stroke,cornerRadius:_=h.cornerRadius,cornerType:b=h.cornerType}=t.attribute;let{width:y,height:C}=t.attribute;if(y=(y??g-f)||0,C=(C??p-m)||0,Array.isArray(v)&&v.some(S=>S===!1)){if(e.setStrokeStyle(t,t.attribute,i,r,h),!(_===0||V(_)&&_.every(S=>S===0))){let S,w=0;return il(e,i,r,y,C,_,b!=="bevel",new Array(4).fill(0).map((x,A)=>(M,T,R,B)=>{v[A]&&(w===A-1&&v[A]===S||(e.setStrokeStyle(t,Object.assign(Object.assign({},t.attribute),{stroke:v[A]}),i,r,h),e.beginPath(),e.moveTo(M,T),S=v[A]),w=A,e.lineTo(R,B),e.stroke(),A===3&&e.beginPath())})),void e.stroke()}if(e.beginPath(),e.moveTo(i,r),v[0]?e.lineTo(i+y,r):e.moveTo(i+y,r),v[1]?e.lineTo(i+y,r+C):e.moveTo(i+y,r+C),v[2]?e.lineTo(i,r+C):e.moveTo(i,r+C),v[3]){const S=v[0]?r-e.lineWidth/2:r;e.lineTo(i,S)}else e.moveTo(i,r);e.stroke()}}};Qp=VX([Bt()],Qp);const Bct=new GX,Pct=Of,Ect=jd;let Lct=class extends GX{constructor(){super(...arguments),this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){return super.drawShape(t,e,i,r,s,o,a,l,h,d,u,c)}};const Ict=new Lct,Oct=jd;let Dct=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const g=t.getParsedPath();if(!g)return;const{outerBorder:p,innerBorder:f}=t.attribute,m=p&&p.visible!==!1,v=f&&f.visible!==!1;if(!m&&!v)return;const{size:_=h.size,opacity:b=h.opacity,x:y=h.x,y:C=h.y,scaleX:S=h.scaleX,scaleY:w=h.scaleY,keepStrokeScale:x=h.keepStrokeScale}=t.attribute,A=(M,T)=>{const R=!(!M||!M.stroke),{distance:B=h[T].distance}=M,E=x?B:lh(e,B,e.dpr),k=T==="outerBorder"?1:-1;if(e.beginPath(),g.drawOffset(e,_,i,r,k*E)===!1&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,M,h[T]);else if(R){const P=h[T].opacity;h[T].opacity=b,e.setStrokeStyle(t,M,(y-i)/S,(C-r)/w,h[T]),h[T].opacity=P,e.stroke()}};m&&A(p,"outerBorder"),v&&A(f,"innerBorder")}},Fct=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){const{clipRange:p=h.clipRange,x:f=h.x,y:m=h.y,z:v=h.z,size:_=h.size,scaleX:b=h.scaleX,scaleY:y=h.scaleY}=t.attribute,C=t.getParsedPath();C&&p<1&&p>0&&(e.beginPath(),C.drawWithClipRange&&C.drawWithClipRange(e,_,i,r,p,v,(S,w)=>{var x,A,M,T;if(t._parsedPath.svgCache){const R=Object.assign({},w);R.fill=(x=w.fill)!==null&&x!==void 0?x:t.attribute.fill,R.opacity=(A=w.opacity)!==null&&A!==void 0?A:t.attribute.opacity,R.fillOpacity=t.attribute.fillOpacity,R.stroke=(M=w.stroke)!==null&&M!==void 0?M:t.attribute.stroke,R.lineWidth=(T=w.lineWidth)!==null&&T!==void 0?T:t.attribute.lineWidth,w=R}w.stroke&&(c?c(e,t.attribute,h):l&&(e.setStrokeStyle(t,w,(f-i)/b,(m-r)/y,h),e.stroke()))}),o&&!C.isSvg&&(c?c(e,t.attribute,h):l&&(e.setStrokeStyle(t,t.attribute,(f-i)/b,(m-r)/y,h),e.stroke())))}};const Hct=new Dct,zct=new Fct,Wct=Of,jct=jd;let Nct=class extends NO{constructor(){super(...arguments),this.time=Ze.afterFillStroke}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){var p,f,m,v;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:_=t.attribute}=g||{},{texture:b=(p=t.attribute.texture)!==null&&p!==void 0?p:ey(h,"texture"),textureColor:y=(f=t.attribute.textureColor)!==null&&f!==void 0?f:ey(h,"textureColor"),textureSize:C=(m=t.attribute.textureSize)!==null&&m!==void 0?m:ey(h,"textureSize"),texturePadding:S=(v=t.attribute.texturePadding)!==null&&v!==void 0?v:ey(h,"texturePadding")}=_;b&&this.drawTexture(b,t,e,i,r,h,y,C,S)}};const rn={x:0,y:0,z:0,lastModelMatrix:null};let cs=class{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions||(this.builtinContributions=[]),this.builtinContributions.push(mct),this.builtinContributions.push(_ct),this.builtinContributions.forEach(e=>this._renderContribitions.push(e)),this._renderContribitions.length&&(this._renderContribitions.sort((e,i)=>i.order-e.order),this._beforeRenderContribitions=this._renderContribitions.filter(e=>e.time===Ze.beforeFillStroke),this._afterRenderContribitions=this._renderContribitions.filter(e=>e.time===Ze.afterFillStroke))}reInit(){this.init(this.graphicRenderContributions)}beforeRenderStep(t,e,i,r,s,o,a,l,h,d,u,c,g){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach(p=>{p.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(p.supportedAppName)?p.supportedAppName:[p.supportedAppName]).includes(t.stage.params.context.appName)||p.drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g)})}afterRenderStep(t,e,i,r,s,o,a,l,h,d,u,c,g){this._afterRenderContribitions&&this._afterRenderContribitions.forEach(p=>{p.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(p.supportedAppName)?p.supportedAppName:[p.supportedAppName]).includes(t.stage.params.context.appName)||p.drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g)})}drawPathProxy(t,e,i,r,s,o,a,l){if(!t.pathProxy)return!1;const h=_e(t,o==null?void 0:o.theme)[t.type.replace("3d","")],{fill:d=h.fill,stroke:u=h.stroke,opacity:c=h.opacity,fillOpacity:g=h.fillOpacity,lineWidth:p=h.lineWidth,strokeOpacity:f=h.strokeOpacity,visible:m=h.visible,x:v=h.x,y:_=h.y}=t.attribute,b=fc(c,g,d),y=OP(c,f),C=Kp(d),S=I_(u,p);if(!m||!C&&!S||!(b||y||a||l))return!0;e.beginPath();const w=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;return Ql(w.commandList,e,i,r),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,C,S,b,y,h,s,a,l),S&&(l?l(e,t.attribute,h):y&&(e.setStrokeStyle(t,t.attribute,i-v,r-_,h),e.stroke())),C&&(a?a(e,t.attribute,h):b&&(e.setCommonStyle(t,t.attribute,i-v,r-_,h),e.fill())),this.afterRenderStep(t,e,i,r,C,S,b,y,h,s,a,l),!0}valid(t,e,i,r){const{fill:s=e.fill,background:o,stroke:a=e.stroke,opacity:l=e.opacity,fillOpacity:h=e.fillOpacity,lineWidth:d=e.lineWidth,strokeOpacity:u=e.strokeOpacity,visible:c=e.visible}=t.attribute,g=fc(l,h,s),p=OP(l,u),f=Kp(s,o),m=I_(a,d);return!(!t.valid||!c)&&!(!f&&!m)&&!!(g||p||i||r||o)&&{fVisible:g,sVisible:p,doFill:f,doStroke:m}}transform(t,e,i,r=!1){const{x:s=e.x,y:o=e.y,z:a=e.z,scaleX:l=e.scaleX,scaleY:h=e.scaleY,angle:d=e.angle,postMatrix:u}=t.attribute,c=i.modelMatrix,g=i.camera;rn.x=s,rn.y=o,rn.z=a,rn.lastModelMatrix=c;const p=g&&(r||ect(t)),f=p?t.transMatrix.onlyTranslate()&&!u:l===1&&h===1&&d===0&&!u;if(p){const m=yn.allocate(),v=yn.allocate();FX(v,t,e),Q0(m,c||m,v),rn.x=0,rn.y=0,rn.z=0,i.modelMatrix=m,i.setTransform(1,0,0,1,0,0,!0),yn.free(v)}if(f&&!c){const m=t.getOffsetXY(e);rn.x+=m.x,rn.y+=m.y,rn.z=a,i.setTransformForCurrent()}else if(p)rn.x=0,rn.y=0,rn.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(g&&i.project){const m=t.getOffsetXY(e);rn.x+=m.x,rn.y+=m.y,this.transformWithoutTranslate(i,rn.x,rn.y,rn.z,l,h,d)}else i.transformFromMatrix(t.transMatrix,!0),rn.x=0,rn.y=0,rn.z=0;return rn}transformUseContext2d(t,e,i,r){const s=r.camera;if(this.camera=s,s){const o=t.AABBBounds,a=o.x2-o.x1,l=o.y2-o.y1,h=r.project(0,0,i),d=r.project(a,0,i),u=r.project(a,l,i),c={x:0,y:0},g={x:a,y:0},p={x:a,y:l};r.camera=null;const f=1/(c.x*(p.y-g.y)-g.x*p.y+p.x*g.y+(g.x-p.x)*c.y),m=-(c.y*(u.x-d.x)-g.y*u.x+p.y*d.x+(g.y-p.y)*h.x)*f,v=(g.y*u.y+c.y*(d.y-u.y)-p.y*d.y+(p.y-g.y)*h.y)*f,_=(c.x*(u.x-d.x)-g.x*u.x+p.x*d.x+(g.x-p.x)*h.x)*f,b=-(g.x*u.y+c.x*(d.y-u.y)-p.x*d.y+(p.x-g.x)*h.y)*f,y=(c.x*(p.y*d.x-g.y*u.x)+c.y*(g.x*u.x-p.x*d.x)+(p.x*g.y-g.x*p.y)*h.x)*f,C=(c.x*(p.y*d.y-g.y*u.y)+c.y*(g.x*u.y-p.x*d.y)+(p.x*g.y-g.x*p.y)*h.y)*f;r.setTransform(m,v,_,b,y,C,!0)}}restoreTransformUseContext2d(t,e,i,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(t,e,i,r,s,o,a){const l=t.project(e,i,r);t.translate(l.x,l.y,!1),t.scale(s,o,!1),t.rotate(a,!1),t.translate(-l.x,-l.y,!1),t.setTransformForCurrent()}_draw(t,e,i,r,s){const{context:o}=r;if(!o)return;const{renderable:a}=t.attribute;if(a===!1)return;o.highPerformanceSave();const l=this.transform(t,e,o,i),{x:h,y:d,z:u,lastModelMatrix:c}=l;this.z=u,this.drawPathProxy(t,o,h,d,r,s)||(this.drawShape(t,o,h,d,r,s),this.z=0,o.modelMatrix!==c&&yn.free(o.modelMatrix),o.modelMatrix=c),o.highPerformanceRestore()}};var $ct=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Vct=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},U3=function(n,t){return function(e,i){t(e,i,n)}};let bS=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=QA,this.builtinContributions=[Sct,wct,xct],this.init(t)}drawArcTailCapPath(t,e,i,r,s,o,a,l){const h=l-a,d=t.getParsedAngle(),u=d.startAngle;let c=d.endAngle;c=l;const g=c>u;let p=!1;if(s<o){const I=s;s=o,o=I}const{xors:f,yors:m,xirs:v,yirs:_,limitedOcr:b,outerCornerRadiusStart:y,outerCornerRadiusEnd:C,maxOuterCornerRadius:S,xore:w,yore:x,xire:A,yire:M,limitedIcr:T,innerDeltaAngle:R,innerStartAngle:B,innerCornerRadiusStart:E,innerCornerRadiusEnd:k,maxInnerCornerRadius:P}=IX(t,u,c,o,s);if(b>$t){const I=we(y,b),O=we(C,b),H=Xh(v,_,f,m,s,I,Number(g)),z=Xh(w,x,A,M,s,O,Number(g));if(b<S&&I===O)e.moveTo(i+H.cx+H.x01,r+H.cy+H.y01),e.arc(i+H.cx,r+H.cy,b,zt(H.y01,H.x01),zt(z.y01,z.x01),!g);else{const F=c-h-.03,j=zt(z.y11,z.x11);e.arc(i,r,s,F,j,!g),O>0&&e.arc(i+z.cx,r+z.cy,O,zt(z.y11,z.x11),zt(z.y01,z.x01),!g)}}else e.moveTo(i+f,r+m);if(!(o>$t)||R<.001)e.lineTo(i+A,r+M),p=!0;else if(T>$t){const I=we(E,T),O=we(k,T),H=Xh(A,M,w,x,o,-O,Number(g)),z=Xh(f,m,v,_,o,-I,Number(g));if(e.lineTo(i+H.cx+H.x01,r+H.cy+H.y01),T<P&&I===O){const F=zt(z.y01,z.x01);e.arc(i+H.cx,r+H.cy,T,zt(H.y01,H.x01),F,!g)}else{O>0&&e.arc(i+H.cx,r+H.cy,O,zt(H.y01,H.x01),zt(H.y11,H.x11),!g);const F=zt(H.cy+H.y11,H.cx+H.x11),j=c-h-.03;e.arc(i,r,o,F,j,g)}}else e.lineTo(i+o*me(B),r+o*ee(B));return p}drawShape(t,e,i,r,s,o,a,l){const h=_e(t,o==null?void 0:o.theme).arc,{fill:d=h.fill,stroke:u=h.stroke,x:c=h.x,y:g=h.y,fillStrokeOrder:p=h.fillStrokeOrder}=t.attribute,f=this.valid(t,h,a,l);if(!f)return;const{fVisible:m,sVisible:v,doFill:_,doStroke:b}=f,{outerPadding:y=h.outerPadding,innerPadding:C=h.innerPadding,cap:S=h.cap,forceShowCap:w=h.forceShowCap}=t.attribute;let{outerRadius:x=h.outerRadius,innerRadius:A=h.innerRadius}=t.attribute;x+=y,A-=C;let M=0;const T=(Re(S)&&S||S[0])&&d.gradient==="conical";if(T){const{sc:k,startAngle:P,endAngle:I}=t.getParsedAngle();Et(I-P)<Ft-$t&&(M=k||0,d.startAngle-=M,d.endAngle-=M)}let R=!1;const{isFullStroke:B,stroke:E}=udt(u);if(_||B){e.beginPath(),DP(t,e,i,r,x,A),R=!0,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,_,b,m,v,h,s,a,l);const k=()=>{_&&(a?a(e,t.attribute,h):m&&(e.setCommonStyle(t,t.attribute,c-i,g-r,h),e.fill()))},P=()=>{b&&B&&(l?l(e,t.attribute,h):v&&(e.setStrokeStyle(t,t.attribute,c-i,g-r,h),e.stroke()))};p?(P(),k()):(k(),P())}if(!B&&b&&(e.beginPath(),DP(t,e,i,r,x,A,E),R||this.beforeRenderStep(t,e,i,r,_,b,m,v,h,s,a,l),l?l(e,t.attribute,h):v&&(e.setStrokeStyle(t,t.attribute,i,r,h),e.stroke())),(Re(S)&&S||S[1])&&w){const{startAngle:k,endAngle:P}=t.getParsedAngle();if(Et(P-k)>=Ft-$t){e.beginPath();const I=Math.abs(x-A)/2/x,{endAngle:O=h.endAngle,fill:H=h.fill}=t.attribute,z=O;this.drawArcTailCapPath(t,e,i,r,x,A,z,z+I),R||this.beforeRenderStep(t,e,i,r,_,b,m,v,h,s,a,l);const F=()=>{if(_){const $=H;if($.gradient==="conical"){const Y=$ut(0,0,O,$);a||fc&&(e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=Y,e.fill())}}},j=()=>{b&&(l||v&&(e.setStrokeStyle(t,t.attribute,i,r,h),e.stroke()))};F(),j()}}this.afterRenderStep(t,e,i,r,_,b,m,v,h,s,a,l),T&&(d.startAngle+=M,d.endAngle+=M)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).arc;this._draw(t,s,!1,i,r)}};bS=$ct([Bt(),U3(0,xe(tn)),U3(0,Sn(FP)),Vct("design:paramtypes",[Object])],bS);var Gct=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Uct=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Y3=function(n,t){return function(e,i){t(e,i,n)}};let yS=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=tM,this.builtinContributions=[Mct,kct,Tct],this.init(t)}drawShape(t,e,i,r,s,o,a,l){const h=_e(t,o==null?void 0:o.theme).circle,{radius:d=h.radius,startAngle:u=h.startAngle,endAngle:c=h.endAngle,x:g=h.x,y:p=h.y,fillStrokeOrder:f=h.fillStrokeOrder}=t.attribute,m=this.valid(t,h,a,l);if(!m)return;const{fVisible:v,sVisible:_,doFill:b,doStroke:y}=m;e.beginPath(),e.arc(i,r,d,u,c),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,b,y,v,_,h,s,a,l);const C=()=>{b&&(a?a(e,t.attribute,h):v&&(e.setCommonStyle(t,t.attribute,g-i,p-r,h),e.fill()))},S=()=>{y&&(l?l(e,t.attribute,h):_&&(e.setStrokeStyle(t,t.attribute,g-i,p-r,h),e.stroke()))};f?(S(),C()):(C(),S()),this.afterRenderStep(t,e,i,r,b,y,v,_,h,s,a,l)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).circle;this._draw(t,s,!1,i,r)}};yS=Gct([Bt(),Y3(0,xe(tn)),Y3(0,Sn(HP)),Uct("design:paramtypes",[Object])],yS);function CS(n,t,e,i){if(!t.p1)return;const{offsetX:r=0,offsetY:s=0,offsetZ:o=0}=i||{};if(e===1)t.p2&&t.p3?n.bezierCurveTo(r+t.p1.x,s+t.p1.y,r+t.p2.x,s+t.p2.y,r+t.p3.x,s+t.p3.y,o):n.lineTo(r+t.p1.x,s+t.p1.y,o);else if(t.p2&&t.p3){const[a]=sS(t,e);n.bezierCurveTo(r+a.p1.x,s+a.p1.y,r+a.p2.x,s+a.p2.y,r+a.p3.x,s+a.p3.y,o)}else{const a=t.getPointAt(e);n.lineTo(r+a.x,s+a.y,o)}}function X3(n,t,e,i,r,s,o){var a;let l=t.p0,h=i;if(e&&e.originP1===e.originP2&&(l=e.p0),t.defined)i||(n.lineTo(l.x+r,l.y+s,o),h=!i);else{const{originP1:d,originP2:u}=t;let c;if(d&&d.defined!==!1&&!e?c=l:d&&u.defined!==!1&&(c=(a=t.p3)!==null&&a!==void 0?a:t.p1),i){h=!i;const g=c?c.x:t.p0.x,p=c?c.y:t.p0.y;n.moveTo(g+r,p+s,o)}else c&&(h=!i,n.lineTo(c.x+r,c.y+s,o))}return h}function UX(n,t,e,i,r){const{offsetX:s=0,offsetY:o=0,offsetZ:a=0,mode:l="none",drawConnect:h=!1}=r||{};if(h&&l==="none"||!t)return;let d=!0;const{curves:u}=t;if(e>=1){if(h){let v,_=!0;u.forEach((b,y)=>{b.originP1!==b.originP2&&(_=X3(n,b,v,_,s,o,a)),v=b})}else u.forEach(v=>{v.defined?(d&&n.moveTo(v.p0.x+s,v.p0.y+o,a),CS(n,v,1,r),d=!1):d=!0});return}if(e<=0)return;let c;i==="x"?c=ai.ROW:i==="y"?c=ai.COLUMN:i==="auto"&&(c=t.direction);const g=e*t.tryUpdateLength(c);let p=0,f=!0,m=null;for(let v=0,_=u.length;v<_;v++){const b=u[v],y=b.getLength(c),C=(g-p)/y;if(p+=y,C<0)break;if(h){if(b.originP1===b.originP2){m=b;continue}f=X3(n,b,m,f,s,o,a),m=b}else{if(!b.defined){d=!0;continue}d&&n.moveTo(b.p0.x+s,b.p0.y+o,a),CS(n,b,we(C,1),r),d=!1}}}function Yct(n,t,e,i){const{offsetX:r=0,offsetY:s=0}=i||{},o=t?t.points[t.points.length-1]:e.points[0];n.moveTo(o.x+r,o.y+s),e.points.forEach(a=>{a.defined!==!1?n.lineTo(a.x+r,a.y+s):n.moveTo(a.x+r,a.y+s)})}function Xct(n,t,e,i){const{offsetX:r=0,offsetY:s=0}=i||{},{points:o}=e,a=[];for(let l=0;l<o.length;l++)o[l].defined;a.push(o),a.forEach((l,h)=>{var d,u,c,g;const p=t&&h===0?t.points[t.points.length-1]:l[0];n.moveTo(p.x+r,p.y+s),l.forEach(f=>{f.defined!==!1?n.lineTo(f.x+r,f.y+s):n.moveTo(f.x+r,f.y+s)});for(let f=l.length-1;f>=0;f--){const m=l[f];n.lineTo((d=m.x1)!==null&&d!==void 0?d:m.x,(u=m.y1)!==null&&u!==void 0?u:m.y)}n.lineTo((c=p.x1)!==null&&c!==void 0?c:p.x,(g=p.y1)!==null&&g!==void 0?g:p.y),n.closePath()})}var Kct=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let D_=class extends cs{constructor(){super(...arguments),this.numberType=J0}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).line;this._draw(t,s,!1,i,r)}drawSegmentItem(t,e,i,r,s,o,a,l,h,d,u,c,g,p,f){var m;if(!e)return;t.beginPath();const v=(m=this.z)!==null&&m!==void 0?m:0;UX(t.camera?t:t.nativeContext,e,h,d,{offsetX:u,offsetY:c,offsetZ:v}),g.cache&&!V(g.cache)&&g.cache.curves.every(y=>y.defined)&&g.attribute.curveType&&g.attribute.curveType.includes("Closed")&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(g,a,l);const{x:_=0,x:b=0}=a;return i!==!1&&(p?p(t,a,l):s&&(t.setCommonStyle(g,a,_-u,b-c,l),t.fill())),r!==!1&&(f?f(t,a,l):o&&(t.setStrokeStyle(g,a,_-u,b-c,l),t.stroke())),!1}drawLinearLineHighPerformance(t,e,i,r,s,o,a,l,h,d,u,c,g){var p;e.beginPath();const f=(p=this.z)!==null&&p!==void 0?p:0,{points:m}=t.attribute,v=m[0];e.moveTo(v.x+a,v.y+l,f);for(let y=1;y<m.length;y++){const C=m[y];e.lineTo(C.x+a,C.y+l,f)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h);const{x:_=0,x:b=0}=t.attribute;i!==!1&&(c?c(e,t.attribute,h):s&&(e.setCommonStyle(t,t.attribute,_-a,b-l,h),e.fill())),r!==!1&&(g?g(e,t.attribute,h):o&&(e.setStrokeStyle(t,t.attribute,_-a,b-l,h),e.stroke()))}drawShape(t,e,i,r,s,o,a,l){const h=_e(t,o==null?void 0:o.theme).line,{fill:d=h.fill,stroke:u=h.stroke,fillOpacity:c=h.fillOpacity,strokeOpacity:g=h.strokeOpacity,segments:p,points:f,closePath:m,curveTension:v=h.curveTension,connectedType:_=h.connectedType}=t.attribute;if(!this.valid(t,h,a,l))return;let{curveType:b=h.curveType}=t.attribute;m&&b==="linear"&&(b="linearClosed");const{clipRange:y=h.clipRange,clipRangeByDimension:C=h.clipRangeByDimension}=t.attribute;if(y===1&&!p&&!f.some(w=>w.defined===!1)&&b==="linear")return this.drawLinearLineHighPerformance(t,e,!!d,!!u,c,g,i,r,h,s,o,a,l);function S(w,x){return x==="none"?w:w.filter(A=>A.defined!==!1)}if(t.shouldUpdateShape()){const{points:w,segments:x}=t.attribute,A=w;if(x&&x.length){let M,T;if(t.cache=x.map((R,B)=>{if(R.points.length<=1&&B===0)return R.points[0]&&(T={endX:R.points[0].x,endY:R.points[0].y,curves:[{defined:R.points[0].defined!==!1}]}),null;B===1?M={x:T.endX,y:T.endY,defined:T.curves[T.curves.length-1].defined}:B>1&&(M.x=T.endX,M.y=T.endY,M.defined=T.curves[T.curves.length-1].defined);const E=Eu(S(R.points,_),b,{startPoint:M,curveTension:v});return T=E,E}).filter(R=>!!R),b==="linearClosed"){let R;for(let B=0;B<t.cache.length;B++){const E=t.cache[B];for(let k=0;k<E.curves.length;k++)if(E.curves[k].defined){R=E.curves[k].p0;break}if(R)break}t.cache[t.cache.length-1]&&t.cache[t.cache.length-1].lineTo(R.x,R.y,!0)}}else{if(!w||!w.length)return t.cache=null,void t.clearUpdateShapeTag();t.cache=Eu(S(A,_),b,{curveTension:v})}t.clearUpdateShapeTag()}if(Array.isArray(t.cache)){const w=t.attribute.segments.filter(x=>x.points.length);if(w[0].points.length===1&&w.shift(),y===1){let x=!1;t.cache.forEach((A,M)=>{x||(x=this.drawSegmentItem(e,A,!!d,!!u,c,g,w[M],[h,t.attribute],y,C,i,r,t,a,l))})}else{const x=t.cache.reduce((R,B)=>R+B.getLength(),0),A=y*x;let M=0,T=!1;t.cache.forEach((R,B)=>{if(T)return;const E=R.getLength(),k=(A-M)/E;M+=E,k>0&&(T=this.drawSegmentItem(e,R,!!d,!!u,c,g,w[B],[h,t.attribute],we(k,1),C,i,r,t,a,l))})}}else this.drawSegmentItem(e,t.cache,!!d,!!u,c,g,t.attribute,h,y,C,i,r,t,a,l)}};D_=Kct([Bt()],D_);function qct(n,t,e,i){var r;const{top:s,bottom:o}=t;if(s.curves.length!==o.curves.length)return;if(e>=1){const v=[],_=[];let b=!0;for(let y=0,C=s.curves.length;y<C;y++){const S=s.curves[y];b!==S.defined?(b?(ay(n,v,_,i),v.length=0,_.length=0):(v.push(S),_.push(o.curves[C-y-1])),b=!b):b&&(v.push(S),_.push(o.curves[C-y-1]))}return void ay(n,v,_,i)}if(e<=0)return;let{direction:a}=i||{};const{curves:l}=s,h=(r=l[l.length-1].p3)!==null&&r!==void 0?r:l[l.length-1].p1,d=Et(h.x-l[0].p0.x),u=Et(h.y-l[0].p0.y);a=a??(d>u?ai.ROW:ai.COLUMN),Number.isFinite(d)||(a=ai.COLUMN),Number.isFinite(u)||(a=ai.ROW);const c=e*(a===ai.ROW?d:u);let g=0,p=!0;const f=[],m=[];for(let v=0,_=s.curves.length;v<_;v++){const b=s.curves[v],y=b.getLength(a),C=(c-g)/y;if(C<0)break;g+=y;let S=null,w=null;p!==b.defined?(p?(ay(n,f,m,i),f.length=0,m.length=0):(S=b,w=o.curves[_-v-1]),p=!p):p&&(S=b,w=o.curves[_-v-1]),S&&w&&(C<1&&(S=S.p2&&S.p3?sS(S,C)[0]:Wz(S,C)[0],w=w.p2&&w.p3?sS(w,1-C)[1]:Wz(w,1-C)[1]),S.defined=p,w.defined=p,f.push(S),m.push(w)),S=null,w=null}ay(n,f,m,i)}function ay(n,t,e,i){const{offsetX:r=0,offsetY:s=0,offsetZ:o=0}=i||{};let a=!0;t.forEach(l=>{l.defined?(a&&n.moveTo(l.p0.x+r,l.p0.y+s,o),CS(n,l,1,i),a=!1):a=!0}),a=!0;for(let l=e.length-1;l>=0;l--){const h=e[l];h.defined?(a&&n.lineTo(h.p0.x+r,h.p0.y+s,o),CS(n,h,1,i),a=!1):a=!0}n.closePath()}const Zct=new Nct,Jct=jd;var Qct=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},tgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},K3=function(n,t){return function(e,i){t(e,i,n)}};let eE=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=AX,this.builtinContributions=[Zct,Jct],this.init(t)}drawLinearAreaHighPerformance(t,e,i,r,s,o,a,l,h,d,u,c,g){var p,f,m;const{points:v}=t.attribute;if(v.length<2)return;e.beginPath();const _=(p=this.z)!==null&&p!==void 0?p:0,b=v[0];e.moveTo(b.x+a,b.y+l,_);for(let S=1;S<v.length;S++){const w=v[S];e.lineTo(w.x+a,w.y+l,_)}for(let S=v.length-1;S>=0;S--){const w=v[S];e.lineTo(((f=w.x1)!==null&&f!==void 0?f:w.x)+a,((m=w.y1)!==null&&m!==void 0?m:w.y)+l,_)}e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,a,l,!!s,!1,i,!1,h,d,c,null,{attribute:t.attribute});const{x:y=0,x:C=0}=t.attribute;i!==!1&&(c?c(e,t.attribute,h):s&&(e.setCommonStyle(t,t.attribute,y-a,C-l,h),e.fill())),this.afterRenderStep(t,e,a,l,!!s,!1,i,!1,h,d,c,null,{attribute:t.attribute}),(()=>{var S,w;if(r){const{stroke:x=h&&h.stroke}=t.attribute;if(V(x)&&(x[0]||x[2])&&x[1]===!1){if(e.beginPath(),x[0]){e.moveTo(b.x+a,b.y+l,_);for(let A=1;A<v.length;A++){const M=v[A];e.lineTo(M.x+a,M.y+l,_)}}else if(x[2]){const A=v[v.length-1];e.moveTo(A.x+a,A.y+l,_);for(let M=v.length-2;M>=0;M--){const T=v[M];e.lineTo(((S=T.x1)!==null&&S!==void 0?S:T.x)+a,((w=T.y1)!==null&&w!==void 0?w:T.y)+l,_)}}}g?g(e,t.attribute,h):(e.setStrokeStyle(t,t.attribute,y-a,C-l,h),e.stroke())}})()}drawShape(t,e,i,r,s,o,a,l){var h,d,u,c,g,p;const f=_e(t,o==null?void 0:o.theme).area,{fill:m=f.fill,stroke:v=f.stroke,fillOpacity:_=f.fillOpacity,z:b=f.z,strokeOpacity:y=f.strokeOpacity,curveTension:C=f.curveTension,connectedType:S=f.connectedType}=t.attribute,w=this.valid(t,f,a,l);if(!w)return;const{doFill:x}=w,A=w.doStroke&&w.sVisible,{clipRange:M=f.clipRange,closePath:T,points:R,segments:B}=t.attribute;let{curveType:E=f.curveType}=t.attribute;function k(P,I){return I!=="connect"?P:P.filter(O=>O.defined!==!1)}if(T&&E==="linear"&&(E="linearClosed"),M===1&&!B&&!R.some(P=>P.defined===!1)&&E==="linear")return this.drawLinearAreaHighPerformance(t,e,!!m,A,_,y,i,r,f,s,o,a,l);if(t.shouldUpdateShape()){if(B&&B.length){let P,I;const O=B.map((F,j)=>{if(F.points.length<=1&&j===0)return F.points[0]&&(I={endX:F.points[0].x,endY:F.points[0].y}),null;j===1?P={x:I.endX,y:I.endY}:j>1&&(P.x=I.endX,P.y=I.endY);const $=Eu(k(F.points,S),E,{startPoint:P,curveTension:C});return I=$,$}).filter(F=>!!F);let H;const z=[];for(let F=B.length-1;F>=0;F--){const j=B[F].points,$=[];for(let Y=j.length-1;Y>=0;Y--)$.push({x:(h=j[Y].x1)!==null&&h!==void 0?h:j[Y].x,y:(d=j[Y].y1)!==null&&d!==void 0?d:j[Y].y});if(F!==0){const Y=B[F-1].points,G=Y[Y.length-1];G&&$.push({x:(u=G.x1)!==null&&u!==void 0?u:G.x,y:(c=G.y1)!==null&&c!==void 0?c:G.y})}$.length>1&&(H=Eu(k($,S),E==="stepBefore"?"stepAfter":E==="stepAfter"?"stepBefore":E,{curveTension:C}),z.unshift(H))}t.cacheArea=z.map((F,j)=>({top:O[j],bottom:F}))}else{if(!R||!R.length)return t.cacheArea=null,void t.clearUpdateShapeTag();{const P=k(R,S),I=[];for(let z=P.length-1;z>=0;z--)I.push({x:(g=P[z].x1)!==null&&g!==void 0?g:P[z].x,y:(p=P[z].y1)!==null&&p!==void 0?p:P[z].y});const O=Eu(P,E,{curveTension:C}),H=Eu(I,E==="stepBefore"?"stepAfter":E==="stepAfter"?"stepBefore":E,{curveTension:C});t.cacheArea={top:O,bottom:H}}}t.clearUpdateShapeTag()}if(Array.isArray(t.cacheArea)){const P=t.attribute.segments.filter(I=>I.points.length);if(P[0].points.length===1&&P.shift(),M===1){let I=!1;t.cacheArea.forEach((O,H)=>{I||(I=this.drawSegmentItem(e,O,x,_,A,y,P[H],[f,t.attribute],M,i,r,b,t,s,a,l))})}else{const I=t.cacheArea.reduce((F,j)=>F+j.top.getLength(),0),O=M*I;let H=0,z=!1;t.cacheArea.forEach((F,j)=>{if(z)return;const $=F.top.getLength(),Y=(O-H)/$;H+=$,Y>0&&(z=this.drawSegmentItem(e,F,x,_,A,y,P[j],[f,t.attribute],we(Y,1),i,r,b,t,s,a,l))})}}else this.drawSegmentItem(e,t.cacheArea,x,_,A,y,t.attribute,f,M,i,r,b,t,s,a,l)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).area;this._draw(t,s,!1,i,r)}drawSegmentItem(t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m){return this._drawSegmentItem(t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m)}_drawSegmentItem(t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m){if(!(e&&e.top&&e.bottom&&e.top.curves&&e.top.curves.length&&e.bottom.curves&&e.bottom.curves.length))return;t.beginPath();const{points:v,segments:_}=g.attribute;let b,y,C=ai.ROW;if(_){const M=_[_.length-1];y=_[0].points[0],b=M.points[M.points.length-1]}else y=v[0],b=v[v.length-1];const S=Et(b.x-y.x),w=Et(b.y-y.y);C=b.x1==null?ai.ROW:b.y1==null?ai.COLUMN:Number.isFinite(S+w)?S>w?ai.ROW:ai.COLUMN:ai.ROW,qct(t.camera?t:t.nativeContext,e,h,{offsetX:d,offsetY:u,offsetZ:c,direction:C}),this.beforeRenderStep(g,t,d,u,!!r,!1,i,!1,l,p,f,null,{attribute:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(g,a,l);const{x=0,x:A=0}=a;return i!==!1&&(f?f(t,a,l):r&&(t.setCommonStyle(g,a,x-d,A-u,l),t.fill())),this.afterRenderStep(g,t,d,u,!!r,!1,i,!1,l,p,f,null,{attribute:a}),(()=>{if(s!==!1)if(m)m(t,a,l);else{const{stroke:M=l&&l[1]&&l[1].stroke}=a;V(M)&&(M[0]||M[2])&&M[1]===!1&&(t.beginPath(),UX(t.camera?t:t.nativeContext,M[0]?e.top:e.bottom,h,C===ai.ROW?"x":"y",{offsetX:d,offsetY:u,offsetZ:c})),t.setStrokeStyle(g,a,x-d,A-u,l),t.stroke()}})(),!1}};eE=Qct([Bt(),K3(0,xe(tn)),K3(0,Sn(Gut)),tgt("design:paramtypes",[Object])],eE);const egt=Of,igt=jd;var ngt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},rgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},q3=function(n,t){return function(e,i){t(e,i,n)}};let SS=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=iM,this.builtinContributions=[igt,egt],this.init(t)}drawShape(t,e,i,r,s,o,a,l){var h,d,u;const c=(h=this.tempTheme)!==null&&h!==void 0?h:_e(t,o==null?void 0:o.theme).path,{x:g=c.x,y:p=c.y,fillStrokeOrder:f=c.fillStrokeOrder}=t.attribute,m=(d=this.z)!==null&&d!==void 0?d:0,v=this.valid(t,c,a,l);if(!v)return;const{fVisible:_,sVisible:b,doFill:y,doStroke:C}=v;if(e.beginPath(),t.pathShape)Ql(t.pathShape.commandList,e,i,r,1,1,m);else{const x=(u=t.attribute.path)!==null&&u!==void 0?u:c.path;Ql(x.commandList,e,i,r,1,1,m)}e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,c),this.beforeRenderStep(t,e,i,r,y,C,_,b,c,s,a,l);const S=()=>{C&&(l?l(e,t.attribute,c):b&&(e.setStrokeStyle(t,t.attribute,g-i,p-r,c),e.stroke()))},w=()=>{y&&(a?a(e,t.attribute,c):_&&(e.setCommonStyle(t,t.attribute,g-i,p-r,c),e.fill()))};f?(S(),w()):(w(),S()),this.afterRenderStep(t,e,i,r,y,C,_,b,c,s,a,l)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).path;this.tempTheme=s,this._draw(t,s,!1,i,r),this.tempTheme=null}};SS=ngt([Bt(),q3(0,xe(tn)),q3(0,Sn(zP)),rgt("design:paramtypes",[Object])],SS);var sgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},ogt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Z3=function(n,t){return function(e,i){t(e,i,n)}};let xS=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.type="rect",this.numberType=OO,this.builtinContributions=[Bct,Ect,Pct],this.init(t)}drawShape(t,e,i,r,s,o,a,l){var h;const d=(h=this.tempTheme)!==null&&h!==void 0?h:_e(t,o==null?void 0:o.theme).rect,{fill:u=d.fill,background:c,stroke:g=d.stroke,cornerRadius:p=d.cornerRadius,cornerType:f=d.cornerType,opacity:m=d.opacity,fillOpacity:v=d.fillOpacity,lineWidth:_=d.lineWidth,strokeOpacity:b=d.strokeOpacity,visible:y=d.visible,x1:C,y1:S,x:w=d.x,y:x=d.y,fillStrokeOrder:A=d.fillStrokeOrder}=t.attribute;let{width:M,height:T}=t.attribute;M=(M??C-w)||0,T=(T??S-x)||0;const R=EX(m,v,M,T,u),B=LX(m,b,M,T),E=Kp(u,c),k=I_(g,_);if(!t.valid||!y||!E&&!k||!(R||B||a||l||c))return;p===0||V(p)&&p.every(H=>H===0)?(e.beginPath(),e.rect(i,r,M,T)):(e.beginPath(),il(e,i,r,M,T,p,f!=="bevel"));const P={doFill:E,doStroke:k};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,d),this.beforeRenderStep(t,e,i,r,E,k,R,B,d,s,a,l,P);const I=()=>{P.doFill&&(a?a(e,t.attribute,d):R&&(e.setCommonStyle(t,t.attribute,w-i,x-r,d),e.fill()))},O=()=>{P.doStroke&&(l?l(e,t.attribute,d):B&&(e.setStrokeStyle(t,t.attribute,w-i,x-r,d),e.stroke()))};A?(O(),I()):(I(),O()),this.afterRenderStep(t,e,i,r,E,k,R,B,d,s,a,l)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).rect;this.tempTheme=s,this._draw(t,s,!1,i,r),this.tempTheme=null}};xS=sgt([Bt(),Z3(0,xe(tn)),Z3(0,Sn(Ou)),ogt("design:paramtypes",[Object])],xS);var agt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},lgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},J3=function(n,t){return function(e,i){t(e,i,n)}};let wS=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=rM,this.builtinContributions=[Hct,jct,Wct,zct],this.init(t)}drawShape(t,e,i,r,s,o,a,l){var h;const d=_e(t,o==null?void 0:o.theme).symbol,{size:u=d.size,x:c=d.x,y:g=d.y,scaleX:p=d.scaleX,scaleY:f=d.scaleY,fillStrokeOrder:m=d.fillStrokeOrder,clipRange:v=d.clipRange}=t.attribute,_=this.valid(t,d,a,l);if(!_)return;const{fVisible:b,sVisible:y,doFill:C,doStroke:S}=_,w=t.getParsedPath();if(!w)return;const{keepDirIn3d:x=d.keepDirIn3d}=t.attribute,A=(h=this.z)!==null&&h!==void 0?h:0;e.beginPath();let M=i,T=r,R=A;const B=e.camera;if(x&&B&&e.project){const P=e.project(i,r,A);e.camera=null,V(u)?(u[0]*p,u[1]*f):u*p,M=P.x,T=P.y,R=void 0}w.draw(e,u,M,T,R,(P,I)=>{var O,H,z,F;if(t._parsedPath.svgCache){const Y=Object.assign({},I);Y.fill=(O=I.fill)!==null&&O!==void 0?O:t.attribute.fill,Y.opacity=(H=I.opacity)!==null&&H!==void 0?H:t.attribute.opacity,Y.fillOpacity=t.attribute.fillOpacity,Y.stroke=(z=I.stroke)!==null&&z!==void 0?z:t.attribute.stroke,Y.lineWidth=(F=I.lineWidth)!==null&&F!==void 0?F:t.attribute.lineWidth,I=Y}const j=()=>{I.fill&&(a?a(e,t.attribute,d):(e.setCommonStyle(t,I,c-i,g-r,d),e.fill()))},$=()=>{I.stroke&&(l?l(e,t.attribute,d):y&&v>=1&&(e.setStrokeStyle(t,I,(c-i)/p,(g-r)/f,d),e.stroke()))};m?($(),j()):(j(),$())})===!1&&e.closePath(),e.camera=B,e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,d),this.beforeRenderStep(t,e,i,r,C,S,b,y,d,s,a,l);const E=()=>{C&&!w.isSvg&&(a?a(e,t.attribute,d):b&&(e.setCommonStyle(t,t.attribute,c-i,g-r,d),e.fill()))},k=()=>{S&&!w.isSvg&&(l?l(e,t.attribute,d):y&&v>=1&&(e.setStrokeStyle(t,t.attribute,(c-i)/p,(g-r)/f,d),e.stroke()))};m?(k(),E()):(E(),k()),this.afterRenderStep(t,e,i,r,C,S,b,y,d,s,a,l)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).symbol;this._draw(t,s,!1,i,r)}};wS=agt([Bt(),J3(0,xe(tn)),J3(0,Sn(jP)),lgt("design:paramtypes",[Object])],wS);let hgt=class{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new ie)}allocate(t,e,i,r){if(!this.pools.length)return new ie().setValue(t,e,i,r);const s=this.pools.pop();return s.x1=t,s.y1=e,s.x2=i,s.y2=r,s}allocateByObj(t){if(!this.pools.length)return new ie(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}};const AS=new hgt;let dgt=class extends lM{constructor(){super(...arguments),this.time=Ze.beforeFillStroke}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){var g,p,f,m,v,_,b,y,C,S;const{backgroundMode:w=h.backgroundMode,backgroundFit:x=h.backgroundFit,backgroundKeepAspectRatio:A=h.backgroundKeepAspectRatio}=t.attribute;let M,{background:T}=t.attribute;if(!T)return;const R=()=>{t.type==="richtext"&&(e.restore(),e.save(),M&&e.setTransformFromMatrix(M,!0,1))};let B;t.type==="richtext"&&(M=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());const E=kt(T)&&T.background,k=t.transMatrix.onlyTranslate();if(E){const P=t.AABBBounds,I=((g=T.x)!==null&&g!==void 0?g:P.x1)+((p=T.dx)!==null&&p!==void 0?p:0),O=((f=T.y)!==null&&f!==void 0?f:P.y1)+((m=T.dy)!==null&&m!==void 0?m:0),H=(v=T.width)!==null&&v!==void 0?v:P.width(),z=(_=T.height)!==null&&_!==void 0?_:P.height();if(B=AS.allocate(I,O,I+H,O+z),T=T.background,!k){const F=B.width(),j=B.height();B.set(((b=T.x)!==null&&b!==void 0?b:0)+((y=T.dx)!==null&&y!==void 0?y:0),((C=T.y)!==null&&C!==void 0?C:0)+((S=T.dy)!==null&&S!==void 0?S:0),F,j)}}else B=t.AABBBounds,k||(B=aM(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const P=t.resources.get(T);if(P.state!=="success"||!P.data)return void R();e.highPerformanceSave(),k&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,r,h),this.doDrawImage(e,P.data,B,{backgroundMode:w,backgroundFit:x,backgroundKeepAspectRatio:A}),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:P}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=T,P?(il(e,B.x1,B.y1,B.width(),B.height(),P,!0),e.fill()):e.fillRect(B.x1,B.y1,B.width(),B.height()),e.highPerformanceRestore()}E&&AS.free(B),R()}};const YX=new dgt;var ugt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},cgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Q3=function(n,t){return function(e,i){t(e,i,n)}};let iE=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=sM,this.builtinContributions=[YX],this.init(t)}drawShape(t,e,i,r,s,o,a,l){var h,d,u;const c=_e(t,o==null?void 0:o.theme).text,{text:g,underline:p=c.underline,lineThrough:f=c.lineThrough,keepDirIn3d:m=c.keepDirIn3d,direction:v=c.direction,fontSize:_=c.fontSize,verticalMode:b=c.verticalMode,x:y=c.x,y:C=c.y}=t.attribute,S=(h=Z0(t.attribute.lineHeight,_))!==null&&h!==void 0?h:_,w=this.valid(t,c,a,l);if(!w)return;const{fVisible:x,sVisible:A,doFill:M,doStroke:T}=w,R=!m,B=this.z||0;e.beginPath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,c),this.beforeRenderStep(t,e,i,r,M,T,x,A,c,s,a,l),R&&this.transformUseContext2d(t,c,B,e);const E=(k,P,I,O)=>{let H=i+P;const z=r+I;if(O){e.highPerformanceSave(),H+=_;const F=ns.allocate(1,0,0,1,0,0);F.rotateByCenter(Math.PI/2,H,z),e.transformFromMatrix(F,!0),ns.free(F)}T&&(l?l(e,t.attribute,c):A&&(e.setStrokeStyle(t,t.attribute,y-i,C-r,c),e.strokeText(k,H,z,B))),M&&(a?a(e,t.attribute,c):x&&(e.setCommonStyle(t,t.attribute,y-i,C-r,c),e.fillText(k,H,z,B))),O&&(e.highPerformanceRestore(),e.setTransformForCurrent())};if(e.setTextStyleWithoutAlignBaseline(t.attribute,c,B),v==="horizontal"){const{multilineLayout:k}=t;if(!k)return void e.highPerformanceRestore();const{xOffset:P,yOffset:I}=k.bbox;T&&(l?l(e,t.attribute,c):A&&(e.setStrokeStyle(t,t.attribute,y-i,C-r,c),k.lines.forEach(O=>{e.strokeText(O.str,(O.leftOffset||0)+P+i,(O.topOffset||0)+I+r,B)}))),M&&(a?a(e,t.attribute,c):x&&(e.setCommonStyle(t,t.attribute,y-i,C-r,c),k.lines.forEach(O=>{e.fillText(O.str,(O.leftOffset||0)+P+i,(O.topOffset||0)+I+r,B),this.drawUnderLine(p,f,t,(O.leftOffset||0)+P+i,(O.topOffset||0)+I+r,O.descent,(O.descent-O.ascent)/2,B,c,e,{width:O.width})})))}else{let{textAlign:k=c.textAlign,textBaseline:P=c.textBaseline}=t.attribute;if(!b){const $=k;k=(d=t.getBaselineMapAlign()[P])!==null&&d!==void 0?d:"left",P=(u=t.getAlignMapBaseline()[$])!==null&&u!==void 0?u:"top"}t.tryUpdateAABBBounds();const I=t.cache,{verticalList:O}=I;e.textAlign="left",e.textBaseline="top";const H=S*O.length;let z=0;O.forEach($=>{const Y=$.reduce((G,tt)=>G+(tt.width||0),0);z=ti(Y,z)});let F=0,j=0;P==="bottom"?j=-H:P==="middle"&&(j=-H/2),k==="center"?F-=z/2:k==="right"&&(F-=z),O.forEach(($,Y)=>{const G=$.reduce((ot,rt)=>ot+(rt.width||0),0),tt=z-G;let st=F;k==="center"?st+=tt/2:k==="right"&&(st+=tt),$.forEach(ot=>{const{text:rt,width:pt,direction:at}=ot;E(rt,H-(Y+1)*S+j,st,at),st+=pt})})}R&&this.restoreTransformUseContext2d(t,c,B,e),this.afterRenderStep(t,e,i,r,M,T,x,A,c,s,a,l)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).text,{keepDirIn3d:o=s.keepDirIn3d}=t.attribute,a=!o;this._draw(t,s,a,i,r)}drawUnderLine(t,e,i,r,s,o,a,l,h,d,u){if(e+t<=0)return;const{textAlign:c=h.textAlign,fill:g=h.fill,opacity:p=h.opacity,underlineOffset:f=h.underlineOffset,underlineDash:m=h.underlineDash,fillOpacity:v=h.fillOpacity}=i.attribute,_=!D(u),b=_?u.width:i.clipedWidth,y=_?0:qp(c,b),C={lineWidth:0,stroke:g,opacity:p,strokeOpacity:v};if(t){C.lineWidth=t,d.setStrokeStyle(i,C,r,s,h),m&&d.setLineDash(m),d.beginPath();const S=s+o+f;d.moveTo(r+y,S,l),d.lineTo(r+y+b,S,l),d.stroke()}if(e){C.lineWidth=e,d.setStrokeStyle(i,C,r,s,h),d.beginPath();const S=s+a;d.moveTo(r+y,S,l),d.lineTo(r+y+b,S,l),d.stroke()}}};iE=ugt([Bt(),Q3(0,xe(tn)),Q3(0,Sn(vS)),cgt("design:paramtypes",[Object])],iE);function XX(n,t,e,i){n.moveTo(t[0].x+e,t[0].y+i);for(let r=1;r<t.length;r++)n.lineTo(t[r].x+e,t[r].y+i)}function ggt(n,t,e,i,r,s=!0){var o;if(t.length<3)return void XX(n,t,e,i);let a=0,l=t.length-1;s||(a+=1,l-=1,n.moveTo(t[0].x+e,t[0].y+i));for(let h=a;h<=l;h++){const d=t[h===0?l:(h-1)%t.length],u=t[h%t.length],c=t[(h+1)%t.length],g=u.x-d.x,p=u.y-d.y,f=u.x-c.x,m=u.y-c.y,v=(Math.atan2(p,g)-Math.atan2(m,f))/2,_=Math.abs(Math.tan(v));let b=Array.isArray(r)?(o=r[h%t.length])!==null&&o!==void 0?o:0:r,y=b/_;const C=ly(g,p),S=ly(f,m),w=Math.min(C,S);y>w&&(y=w,b=w*_);const x=Mk(u,y,C,g,p),A=Mk(u,y,S,f,m),M=2*u.x-x.x-A.x,T=2*u.y-x.y-A.y,R=ly(M,T),B=Mk(u,ly(y,b),R,M,T);let E=Math.atan2(x.y-B.y,x.x-B.x);const k=Math.atan2(A.y-B.y,A.x-B.x);let P=k-E;P<0&&(E=k,P=-P),P>Math.PI&&(P-=Math.PI),h===0?n.moveTo(x.x+e,x.y+i):n.lineTo(x.x+e,x.y+i),P&&n.arcTo(u.x+e,u.y+i,A.x+e,A.y+i,b),n.lineTo(A.x+e,A.y+i)}s||n.lineTo(t[l+1].x+e,t[l+1].y+i)}function ly(n,t){return Math.sqrt(n*n+t*t)}function Mk(n,t,e,i,r){const s=t/e;return{x:n.x-i*s,y:n.y-r*s}}const pgt=Of,fgt=jd;var mgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},vgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},tW=function(n,t){return function(e,i){t(e,i,n)}};let nE=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=nM,this.builtinContributions=[fgt,pgt],this.init(t)}drawShape(t,e,i,r,s,o,a,l){const h=_e(t,o==null?void 0:o.theme).polygon,{points:d=h.points,cornerRadius:u=h.cornerRadius,x:c=h.x,y:g=h.y,closePath:p=h.closePath,fillStrokeOrder:f=h.fillStrokeOrder}=t.attribute,m=this.valid(t,h,a,l);if(!m)return;const{fVisible:v,sVisible:_,doFill:b,doStroke:y}=m;e.beginPath(),u<=0||V(u)&&u.every(w=>w===0)?XX(e.camera?e:e.nativeContext,d,i,r):ggt(e.camera?e:e.nativeContext,d,i,r,u,p),p&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,b,y,v,_,h,s,a,l);const C=()=>{b&&(a?a(e,t.attribute,h):v&&(e.setCommonStyle(t,t.attribute,c-i,g-r,h),e.fill()))},S=()=>{y&&(l?l(e,t.attribute,h):_&&(e.setStrokeStyle(t,t.attribute,c-i,g-r,h),e.stroke()))};f?(S(),C()):(C(),S()),this.afterRenderStep(t,e,i,r,b,y,v,_,h,s,a,l)}draw(t,e,i,r){const s=_e(t,r==null?void 0:r.theme).polygon;this._draw(t,s,!1,i,r)}};nE=mgt([Bt(),tW(0,xe(tn)),tW(0,Sn(WP)),vgt("design:paramtypes",[Object])],nE);var _gt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},bgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},eW=function(n,t){return function(e,i){t(e,i,n)}};let rE=class{constructor(t){this.groupRenderContribitions=t,this.numberType=IO}reInit(){this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(G3)}drawShape(t,e,i,r,s,o,a,l){const h=_e(t,o==null?void 0:o.theme).group,{fill:d=h.fill,background:u,stroke:c=h.stroke,opacity:g=h.opacity,width:p=h.width,height:f=h.height,clip:m=h.clip,fillOpacity:v=h.fillOpacity,strokeOpacity:_=h.strokeOpacity,cornerRadius:b=h.cornerRadius,path:y=h.path,lineWidth:C=h.lineWidth,visible:S=h.visible,fillStrokeOrder:w=h.fillStrokeOrder,cornerType:x=h.cornerType,x:A=h.x,y:M=h.y}=t.attribute,T=EX(g,v,p,f,d),R=LX(g,_,p,f),B=Kp(d,u),E=I_(c,C);if(!t.valid||!S||!m&&(!B&&!E||!(T||R||a||l||u)))return;if(y&&y.length&&s.drawContribution){const O=e.disableFill,H=e.disableStroke,z=e.disableBeginPath;e.disableFill=!0,e.disableStroke=!0,e.disableBeginPath=!0,y.forEach(F=>{s.drawContribution.getRenderContribution(F).draw(F,s.renderService,s,o)}),e.disableFill=O,e.disableStroke=H,e.disableBeginPath=z}else b===0||V(b)&&b.every(O=>O===0)?(e.beginPath(),e.rect(i,r,p,f)):(e.beginPath(),il(e,i,r,p,f,b,x!=="bevel"));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(G3));const k={doFill:B,doStroke:E};e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this._groupRenderContribitions.forEach(O=>{O.time===Ze.beforeFillStroke&&O.drawShape(t,e,i,r,B,E,T,R,h,s,a,l,k)}),m&&e.clip();const P=()=>{k.doFill&&(a?a(e,t.attribute,h):T&&(e.setCommonStyle(t,t.attribute,A-i,M-r,h),e.fill()))},I=()=>{k.doStroke&&(l?l(e,t.attribute,h):R&&(e.setStrokeStyle(t,t.attribute,A-i,M-r,h),e.stroke()))};w?(I(),P()):(P(),I()),this._groupRenderContribitions.forEach(O=>{O.time===Ze.afterFillStroke&&O.drawShape(t,e,i,r,B,E,T,R,h,s,a,l)})}draw(t,e,i,r){const{context:s}=i;if(!s)return;const{clip:o,baseOpacity:a=1,drawMode:l,x:h,y:d,width:u,height:c}=t.attribute,g=s.nativeContext,p=s.canvas.nativeCanvas;if(l>0){const C=s.canvas,S=oi.createCanvas({width:C.width,height:C.height,dpr:1}),w=S.getContext("2d"),x=s.nativeContext.getTransform();w.setTransform(x.a,x.b,x.c,x.d,x.e,x.f),l===1&&(w.save(),w.clearRect(0,0,C.width,C.height),w.beginPath(),w.rect(h,d,u,c),w.clip(),w.drawImage(C.nativeCanvas,0,0,C.width,C.height,0,0,C.displayWidth,C.displayHeight),w.restore()),s.nativeContext=w,C.nativeCanvas=S}o?s.save():s.highPerformanceSave();const f=s.baseGlobalAlpha;s.baseGlobalAlpha*=a;const m=_e(t,r==null?void 0:r.theme).group,v=s.modelMatrix;if(s.camera){const C=yn.allocate(),S=yn.allocate();FX(S,t,m),Q0(C,v||C,S),s.modelMatrix=C,yn.free(S),s.setTransform(1,0,0,1,0,0,!0)}else s.transformFromMatrix(t.transMatrix,!0);s.beginPath(),r.skipDraw?this.drawShape(t,s,0,0,i,r,()=>!1,()=>!1):this.drawShape(t,s,0,0,i);const{scrollX:_=m.scrollX,scrollY:b=m.scrollY}=t.attribute;let y;if((_||b)&&s.translate(_,b),r&&r.drawingCb&&(y=r.drawingCb()),s.modelMatrix!==v&&yn.free(s.modelMatrix),s.modelMatrix=v,s.baseGlobalAlpha=f,l>0){const C=s.nativeContext,S=s.canvas.nativeCanvas;g.save(),g.setTransform(s.dpr,0,0,s.dpr,0,0,!0),l===1&&C.rect(h,d,u,c),g.drawImage(S,0,0,S.width,S.height,0,0,s.canvas.displayWidth,s.canvas.displayHeight);const w=C.getTransform();g.setTransform(w.a,w.b,w.c,w.d,w.e,w.f),s.nativeContext=g,s.canvas.nativeCanvas=p,g.restore()}y&&y.then?y.then(()=>{o?s.restore():s.highPerformanceRestore()}):o?s.restore():s.highPerformanceRestore()}};rE=_gt([Bt(),eW(0,xe(tn)),eW(0,Sn(Fo)),bgt("design:paramtypes",[Object])],rE);var ygt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Cgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},iW=function(n,t){return function(e,i){t(e,i,n)}};const Sgt=["","repeat-x","repeat-y","repeat"];let sE=class extends cs{constructor(t){super(),this.graphicRenderContributions=t,this.numberType=eM,this.builtinContributions=[Ict,Oct],this.init(t)}drawShape(t,e,i,r,s,o,a,l){const h=_e(t).image,{repeatX:d=h.repeatX,repeatY:u=h.repeatY,x:c=h.x,y:g=h.y,cornerRadius:p=h.cornerRadius,fillStrokeOrder:f=h.fillStrokeOrder,cornerType:m=h.cornerType,image:v}=t.attribute,_=this.valid(t,h,a);if(!_)return;const{fVisible:b,sVisible:y,doFill:C,doStroke:S}=_;if(!v||!t.resources)return;const w=t.resources.get(v);if(w.state!=="success")return;const x=t.width,A=t.height;e.beginPath();let M=!1;p===0||V(p)&&p.every(B=>B===0)?e.rect(i,r,x,A):(il(e,i,r,x,A,p,m!=="bevel"),M=!0),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h);const T=()=>{if(C){if(a)a(e,t.attribute,h);else if(b){e.setCommonStyle(t,t.attribute,i,r,h);let B=0;if(d==="repeat"&&(B|=1),u==="repeat"&&(B|=2),B){const E=e.createPattern(w.data,Sgt[B]);e.fillStyle=E,e.translate(i,r,!0),e.fillRect(0,0,x,A),e.translate(-i,-r,!0)}else e.drawImage(w.data,i,r,x,A)}}},R=()=>{S&&(l?l(e,t.attribute,h):y&&(e.setStrokeStyle(t,t.attribute,c-i,g-r,h),e.stroke()))};f?(R(),M&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,r,C,!1,b,!1,h,s,a),T(),M&&e.restore()):(M&&(e.save(),e.clip()),this.beforeRenderStep(t,e,i,r,C,!1,b,!1,h,s,a),T(),M&&e.restore(),R()),this.afterRenderStep(t,e,i,r,C,!1,b,!1,h,s,a)}draw(t,e,i){const{image:r}=t.attribute;if(!r||!t.resources)return;const s=t.resources.get(r);if(s.state==="loading"&&yt(r))return void Yh.improveImageLoading(r);if(s.state!=="success")return;const{context:o}=e.drawParams;if(!o)return;const a=_e(t).image;this._draw(t,a,!1,i)}};sE=ygt([Bt(),iW(0,xe(tn)),iW(0,Sn(Iu)),Cgt("design:paramtypes",[Object])],sE);const KX=Symbol.for("IncrementalDrawContribution"),MS=Symbol.for("ArcRender"),TS=Symbol.for("CircleRender"),zr=Symbol.for("GraphicRender"),nW=Symbol.for("GroupRender"),kS=Symbol.for("LineRender"),RS=Symbol.for("PathRender"),BS=Symbol.for("PolygonRender"),PS=Symbol.for("RectRender"),ES=Symbol.for("SymbolRender"),oE=Symbol.for("TextRender"),aE=Symbol.for("RichTextRender"),lE=Symbol.for("ImageRender"),$O=Symbol.for("DrawContribution"),qX=(n,t,e,i)=>{let r,s=!1,o=!1;if(t.forEachChildren(a=>(s=a.numberType===Put,!s)),t.forEachChildren(a=>(o=!!a.findFace,!o)),s){const a=t.getChildren(),l=[...a];l.sort((h,d)=>{var u,c,g,p;let f=((c=(u=h.attribute.startAngle)!==null&&u!==void 0?u:0+h.attribute.endAngle)!==null&&c!==void 0?c:0)/2,m=((p=(g=d.attribute.startAngle)!==null&&g!==void 0?g:0+d.attribute.endAngle)!==null&&p!==void 0?p:0)/2;for(;f<0;)f+=Ft;for(;m<0;)m+=Ft;return m-f}),l.forEach(h=>{h._next=null,h._prev=null}),t.removeAllChild(),t.update(),l.forEach(h=>{t.appendChild(h)}),i.hack_pieFace="outside",r=e(s,o),r&&r.graphic||(i.hack_pieFace="inside",r=e(s,o)),r&&r.graphic||(i.hack_pieFace="top",r=e(s,o)),t.removeAllChild(),a.forEach(h=>{h._next=null,h._prev=null}),a.forEach(h=>{t.appendChild(h)})}else if(o){const a=t.getChildren(),l=a.map(h=>({ave_z:h.findFace().vertices.map(d=>{var u;return n.view(d[0],d[1],(u=d[2]+h.attribute.z)!==null&&u!==void 0?u:0)[2]}).reduce((d,u)=>d+u,0),g:h}));l.sort((h,d)=>d.ave_z-h.ave_z),t.removeAllChild(),l.forEach(h=>{h.g._next=null,h.g._prev=null}),t.update(),l.forEach(h=>{t.add(h.g)}),r=e(s,o),t.removeAllChild(),a.forEach(h=>{h._next=null,h._prev=null}),t.update(),a.forEach(h=>{t.add(h)})}else r=e(s,o);return r};var xgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},wgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const F_=Symbol.for("DrawItemInterceptor"),rW=new ie,sW=new ie;let Agt=class{constructor(){this.order=1}afterDrawItem(t,e,i,r,s){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,r,s),!1}beforeDrawItem(t,e,i,r,s){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,r,s),!1}drawItem(t,e,i,r,s){if(!t.shadowRoot)return!1;const{context:o}=i;if(o.highPerformanceSave(),o.transformFromMatrix(t.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){rW.copy(r.dirtyBounds),sW.copy(r.backupDirtyBounds);const a=t.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(a),r.backupDirtyBounds.copy(r.dirtyBounds)}return r.renderGroup(t.shadowRoot,i,ns.allocate(1,0,0,1,0,0)),o.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&(r.dirtyBounds.copy(rW),r.backupDirtyBounds.copy(sW)),!0}},Mgt=class{constructor(){this.order=1}afterDrawItem(t,e,i,r,s){return t.attribute._debug_bounds&&this.drawItem(t,e,i,r,s),!1}drawItem(t,e,i,r,s){if(!t.attribute._debug_bounds)return!1;const{context:o}=i;o.highPerformanceSave(),t.parent&&o.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&o.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const a=t.AABBBounds;return t.attribute._debug_bounds!==!0&&t.attribute._debug_bounds(o,t),o.strokeRect(a.x1,a.y1,a.width(),a.height()),o.highPerformanceRestore(),!0}},LS=class{constructor(){this.order=1,this.interceptors=[new Agt,new kgt,new Tgt,new Mgt]}afterDrawItem(t,e,i,r,s){for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].afterDrawItem&&this.interceptors[o].afterDrawItem(t,e,i,r,s))return!0;return!1}beforeDrawItem(t,e,i,r,s){if((!t.in3dMode||i.in3dInterceptor)&&!t.shadowRoot&&!(t.baseGraphic||t.attribute.globalZIndex||t.interactiveGraphic))return!1;for(let o=0;o<this.interceptors.length;o++)if(this.interceptors[o].beforeDrawItem&&this.interceptors[o].beforeDrawItem(t,e,i,r,s))return!0;return!1}};LS=xgt([Bt(),wgt("design:paramtypes",[])],LS);let Tgt=class{constructor(){this.order=1}beforeDrawItem(t,e,i,r,s){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,r,s):this.beforeSetInteractive(t,e,i,r,s))}beforeSetInteractive(t,e,i,r,s){let o=t.interactiveGraphic;if(t.attribute.globalZIndex){o||(o=t.clone(),t.interactiveGraphic=o,o.baseGraphic=t),o.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");return a&&this.getShadowRoot(a).add(o),!0}if(o){i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");a&&this.getShadowRoot(a).removeChild(o),t.interactiveGraphic=null,o.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,r,s){const o=t.baseGraphic;let a=!!o.stage,l=o.parent;for(;a&&l&&l.stage!==l;)a=!!l.stage,l=l.parent;if(!a){const h=i.stage.getLayer("_builtin_interactive");return h&&this.getShadowRoot(h).removeChild(t),!0}if(o){this.processing=!0;const{context:h}=i;return h.highPerformanceSave(),h.setTransformFromMatrix(o.parent.globalTransMatrix,!0),o.isContainer?r.renderGroup(o,i,o.parent.globalTransMatrix):r.renderItem(o,i),h.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=Ut.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),(e=i.shadowRoot)!==null&&e!==void 0?e:i.attachShadow()}},kgt=class{constructor(){this.order=1}beforeDrawItem(t,e,i,r,s){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:o,stage:a}=e.drawParams;o.canvas,o.save(),this.initCanvasCtx(o),o.camera=a.camera;const l=o.currentMatrix;l.a/=o.dpr,l.b/=o.dpr,l.c/=o.dpr,l.d/=o.dpr,l.e/=o.dpr,l.f/=o.dpr;const h=yn.allocate();NP(h,l);const d=o.modelMatrix;if(d){if(h){const u=yn.allocate();o.modelMatrix=Q0(u,d,h)}}else o.modelMatrix=h;return o.setTransform(1,0,0,1,0,0,!0),t.isContainer?qX(o,t,(u,c)=>r.renderGroup(t,i,t.parent.globalTransMatrix,!u&&c),i):r.renderItem(t,i),o.camera=null,o.restore(),o.modelMatrix!==d&&yn.free(o.modelMatrix),o.modelMatrix=d,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}};var Rgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Bgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Pgt=function(n,t){return function(e,i){t(e,i,n)}};const ZX=Symbol.for("RenderService");let hE=class{constructor(t){this.drawContribution=t}prepare(t){t&&this.renderTreeRoots.forEach(e=>{this._prepare(e,t)})}_prepare(t,e){t.forEachChildren(i=>{this._prepare(i,e)}),t.update({bounds:e,trans:!0})}prepareRenderList(){}beforeDraw(t){}draw(t){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(t){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}reInit(){this.drawContribution.reInit()}render(t,e){this.renderTreeRoots=t,this.drawParams=e;const i=e.updateBounds;this.prepare(i),this.prepareRenderList(),this.beforeDraw(e),this.draw(e),this.afterDraw(e),this.drawParams=null}};hE=Rgt([Bt(),Pgt(0,xe($O)),Bgt("design:paramtypes",[Object])],hE);const Egt=new pe(n=>{n(ZX).to(hE)}),Cp=Symbol.for("PickerService"),oW=Symbol.for("GlobalPickerService"),zg=Symbol.for("PickItemInterceptor"),IS=Symbol.for("PickServiceInterceptor");var hM=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let OS=class{constructor(){this.order=1}afterPickItem(t,e,i,r,s){if(t.graphic){let o=t.graphic;for(;o.parent;)o=o.parent;o.shadowHost&&(t.params={shadowTarget:t.graphic},t.graphic=o.shadowHost)}return t}};OS=hM([Bt()],OS);let DS=class{constructor(){this.order=1}afterPickItem(t,e,i,r,s){return t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx?this._pickItem(t,e,i,r,s):null}beforePickItem(t,e,i,r,s){return t.attribute.shadowRootIdx<0?this._pickItem(t,e,i,r,s):null}_pickItem(t,e,i,r,s){var o;if(!t.shadowRoot)return null;const{parentMatrix:a}=s||{};if(!a)return null;const l=e.pickContext;l.highPerformanceSave();const h=(o=_e(t))===null||o===void 0?void 0:o[t.type],{shadowPickMode:d=h==null?void 0:h.shadowPickMode}=t.attribute,u=t.shadowRoot,c=ns.allocateByObj(a),g=new Yt(c.a*i.x+c.c*i.y+c.e,c.b*i.x+c.d*i.y+c.f),p=e.pickGroup(u,g,c,r);return l.highPerformanceRestore(),!p.graphic&&p.group&&d==="full"&&(p.graphic=p.group),p}};DS=hM([Bt()],DS);let FS=class{constructor(){this.order=1}beforePickItem(t,e,i,r,s){const o=t.baseGraphic;if(o&&o.parent){const a=new Yt(i.x,i.y),l=e.pickContext;l.highPerformanceSave();const h=o.parent.globalTransMatrix;h.transformPoint(a,a);const d=o.isContainer?e.pickGroup(o,a.clone(),h,r):e.pickItem(o,a.clone(),h,r);return l.highPerformanceRestore(),d}return null}};FS=hM([Bt()],FS);let HS=class{constructor(){this.order=1}beforePickItem(t,e,i,r,s){if(!t.in3dMode||r.in3dInterceptor)return null;const o=e.pickContext,a=t.stage;if(!o||!a)return null;if(r.in3dInterceptor=!0,o.save(),this.initCanvasCtx(o),o.camera=a.camera,t.isContainer){const l=qX(o,t,()=>e.pickGroup(t,i,s.parentMatrix,r),r);return o.camera=null,r.in3dInterceptor=!1,o.restore(),l}return o.restore(),null}initCanvasCtx(t){t.setTransformForCurrent()}};HS=hM([Bt()],HS);const Lgt=new pe((n,t,e)=>{e(Cp)||(n(oW).toSelf(),n(Cp).toService(oW)),n(HS).toSelf().inSingletonScope(),n(zg).toService(HS),n(DS).toSelf().inSingletonScope(),n(zg).toService(DS),n(FS).toSelf().inSingletonScope(),n(zg).toService(FS),nr(n,zg),n(OS).toSelf().inSingletonScope(),n(IS).toService(OS),nr(n,IS)}),Igt=new pe(n=>{n(MX).to($P).inSingletonScope(),n(TX).toConstantValue(Ut)}),H_=Symbol.for("AutoEnablePlugins"),JX=Symbol.for("PluginService");var Ogt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Dgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},aW=function(n,t){return function(e,i){t(e,i,n)}};let dE=class{constructor(t){this.autoEnablePlugins=t,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(t,e){this.stage=t,this.actived=!0;const{pluginList:i}=e;i&&he.isBound(H_)&&this.autoEnablePlugins.getContributions().forEach(r=>{i.includes(r.name)&&this.register(r)})}findPluginsByName(t){const e=[];return this.onStartupFinishedPlugin.forEach(i=>{i.name===t&&e.push(i)}),this.onRegisterPlugin.forEach(i=>{i.name===t&&e.push(i)}),e}register(t){t.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(t):t.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(t),t.activate(this))}unRegister(t){t.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1):t.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(t),1),t.deactivate(this)}release(...t){this.onStartupFinishedPlugin.forEach(e=>{e.deactivate(this)}),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach(e=>{e.deactivate(this)}),this.onRegisterPlugin=[]}};dE=Ogt([Bt(),aW(0,xe(tn)),aW(0,Sn(H_)),Dgt("design:paramtypes",[Object])],dE);const Fgt=new pe(n=>{n(JX).to(dE),jat(n,H_)}),Hgt=new pe(n=>{nr(n,YA)}),zgt=new pe(n=>{n($l).to(Yp).inSingletonScope(),nr(n,$l)});var Wgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},jgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let zS=class{constructor(){this.type="static",this.offscreen=!1,this.global=St.global}setDpr(t){this.canvas.dpr=t}init(t,e,i){if(this.layer=t,this.window=e,i.main)this.main=!0,this.context=e.getContext(),this.canvas=this.context.getCanvas();else{let r;this.main=!1,i.canvasId&&(r=this.global.getElementById(i.canvasId)),r||(r=this.global.createCanvas({width:e.width,height:e.height})),r.style&&(r.style["pointer-events"]="none");const s=e.getContext().getCanvas().nativeCanvas,o=kP({nativeCanvas:r,width:e.width,height:e.height,dpr:e.dpr,id:i.canvasId,canvasControled:!0,container:e.getContainer(),x:s.offsetLeft,y:s.offsetTop});o.applyPosition(),this.canvas=o,this.context=o.getContext()}}resize(t,e){this.canvas.resize(t,e)}resizeView(t,e){}render(t,e,i){var r;if(!this.main){const s=this.window.getContext().getCanvas().nativeCanvas;!s||this.canvas.x===s.offsetLeft&&this.canvas.y===s.offsetTop||(this.canvas.x=s.offsetLeft,this.canvas.y=s.offsetTop,this.canvas.applyPosition())}e.renderService.render(t,Object.assign(Object.assign({context:this.context,clear:(r=e.background)!==null&&r!==void 0?r:"#ffffff"},e),i))}merge(t){t.forEach(e=>{const i=e.getContext().canvas.nativeCanvas;this.context.drawImage(i,0,0)})}prepare(t,e){}drawTo(t,e,i){var r;const s=t.getContext();i.renderService.render(e,Object.assign(Object.assign({context:s},i),{clear:i.clear?(r=i.background)!==null&&r!==void 0?r:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};zS=Wgt([Bt(),jgt("design:paramtypes",[])],zS);const Ngt=new pe(n=>{n(zS).toSelf(),n(PX).toService(zS)});function $gt(n){n.load(Hgt),n.load(zgt),n.load(Ngt)}var Vgt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function QX(n,t,e){const i={},r=[];return n.forEachChildren(s=>{const{zIndex:o=t}=s.attribute;i[o]?i[o].push(s):(i[o]=[s],r.push(o))},e),r.sort((s,o)=>e?o-s:s-o),{childMap:i,zIdxArray:r}}function tK(n,t,e,i=!1,r=!1){let s=!1;if(r)s=!0;else{let o;n.forEachChildren((a,l)=>{const{zIndex:h=t}=a.attribute;if(l===0)o=h;else if(o!==h)return s=!0,!0;return!1},i)}if(s){const{childMap:o,zIdxArray:a}=QX(n,t,i);let l=!1;for(let h=0;h<a.length&&!l;h++){const d=o[a[h]];r&&d.sort((u,c)=>{var g,p;return(i?-1:1)*(((g=c.attribute.z)!==null&&g!==void 0?g:0)-((p=u.attribute.z)!==null&&p!==void 0?p:0))});for(let u=0;u<d.length;u++)if(e(d[u],u)){l=!0;break}}}else n.forEachChildren(e,i)}function lW(n,t,e,i=!1){return Vgt(this,void 0,void 0,function*(){yield n.forEachChildrenAsync(e,i)})}function Ggt(n,t,e,i=!1){let r=!1;n.forEachChildren((a,l)=>{const{zIndex:h=e}=a.attribute;if(l!==0){if(h!==void 0)return r=!0,!0}return!1},i);let s=null,o=!1;if(r){const{childMap:a,zIdxArray:l}=QX(n,e,i);let h=!1;for(let d=0;d<l.length&&!h;d++){const u=a[l[d]];for(let c=0;c<u.length;c++){if(o){h=!0,s=u[c];break}u[c]._uid!==t||(o=!0)}}}else n.forEachChildren(a=>o?(s=a,!0):(a._uid===t&&(o=!0),!1),i);return s}var Ugt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Ygt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Tk=function(n,t){return function(e,i){t(e,i,n)}};let WS=class{constructor(t,e){this.contributions=t,this.drawItemInterceptorContributions=e,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Bi,this.backupDirtyBounds=new Bi,this.global=St.global,this.layerService=St.layerService,V(this.contributions)||(this.contributions=[this.contributions]),this.init()}reInit(){this.init(),this.contributions.forEach(t=>{t.reInit()})}init(){this.contributions.forEach(t=>{if(t.style){const e=this.styleRenderMap.get(t.style)||new Map;e.set(t.numberType,t),this.styleRenderMap.set(t.style,e)}else this.defaultRenderMap.set(t.numberType,t)}),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort((t,e)=>t.order-e.order)}prepareForDraw(t,e){e.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!e.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(t,e){this.prepareForDraw(t,e),e.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(e.renderStyle)||this.defaultRenderMap,this.currentRenderService=t;const{context:i,stage:r,viewBox:s,transMatrix:o}=e;if(!i)return;const a=this.dirtyBounds.setValue(0,0,s.width(),s.height());if(r.dirtyBounds&&!r.dirtyBounds.empty()){const h=KA(a,r.dirtyBounds,!1);a.x1=Math.floor(h.x1),a.y1=Math.floor(h.y1),a.x2=Math.ceil(h.x2),a.y2=Math.ceil(h.y2)}const l=i.dpr%1;(l||l!==.5)&&(a.x1=Math.floor(a.x1*i.dpr)/i.dpr,a.y1=Math.floor(a.y1*i.dpr)/i.dpr,a.x2=Math.ceil(a.x2*i.dpr)/i.dpr,a.y2=Math.ceil(a.y2*i.dpr)/i.dpr),this.backupDirtyBounds.copy(a),i.inuse=!0,i.setClearMatrix(o.a,o.b,o.c,o.d,o.e,o.f),i.clearMatrix(),i.setTransformForCurrent(!0),i.translate(s.x1,s.y1,!0),i.beginPath(),i.rect(a.x1,a.y1,a.width(),a.height()),i.clip(),r.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(t,i,e),i.save(),t.renderTreeRoots.sort((h,d)=>{var u,c;return((u=h.attribute.zIndex)!==null&&u!==void 0?u:Yi.zIndex)-((c=d.attribute.zIndex)!==null&&c!==void 0?c:Yi.zIndex)}).forEach(h=>{h.isContainer?this.renderGroup(h,e,ns.allocate(1,0,0,1,0,0)):this.renderItem(h,e)}),i.restore(),i.setClearMatrix(1,0,0,1,0,0),i.inuse=!1,i.draw()}doRegister(){throw new Error("")}_findNextGraphic(t){let e=t.parent,i=t._uid;for(;e;){const r=Ggt(e,i,Yi.zIndex);if(r)return r;i=e._uid,e=e.parent}return null}renderGroup(t,e,i,r){if(e.break||t.attribute.visibleAll===!1)return;if(t.incremental&&(e.startAtId==null||e.startAtId===t._uid))return e.break=!0,void this._increaseRender(t,e);if(this.useDirtyBounds&&!kd(t.AABBBounds,this.dirtyBounds,!1)&&t.attribute.boundsMode!=="empty")return;let s,o=i;if(this.useDirtyBounds){s=AS.allocateByObj(this.dirtyBounds);const a=t.transMatrix;o=ns.allocateByObj(i).multiply(a.a,a.b,a.c,a.d,a.e,a.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(o.getInverse())}this.renderItem(t,e,{drawingCb:()=>{var a;r?t.forEachChildren(l=>{e.break||(l.isContainer?this.renderGroup(l,e,o):this.renderItem(l,e))}):tK(t,Yi.zIndex,l=>{e.break||(l.isContainer?this.renderGroup(l,e,o):this.renderItem(l,e))},!1,!!(!((a=e.context)===null||a===void 0)&&a.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(s),AS.free(s),ns.free(o))}_increaseRender(t,e){const{layer:i,stage:r}=e,{subLayers:s}=i;let o=s.get(t._uid);o||(o={layer:this.layerService.createLayer(r),zIndex:s.size,group:t},s.set(t._uid,o));const a=o.layer.getNativeHandler().getContext(),l=o.drawContribution||he.get(KX);l.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),l.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),l.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:l,clear:"transparent",layer:o.layer,context:a,startAtId:t._uid,break:!1})),o.drawContribution=l;const h=this._findNextGraphic(t);if(h)if(h.isContainer&&h.incremental)this._increaseRender(h,e);else{let d=s.get(h._uid);d||(d={layer:this.layerService.createLayer(r),zIndex:s.size},s.set(h._uid,d));const u=d.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},e),{drawContribution:l,clear:"transparent",layer:d.layer,context:u,startAtId:h._uid,break:!1}))}}getRenderContribution(t){let e;return e||(e=this.selectRenderByNumberType(t.numberType,t)),e||(e=this.selectRenderByType(t.type)),e}renderItem(t,e,i){if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.beforeDrawItem&&h.beforeDrawItem(t,this.currentRenderService,e,this,i))return}const r=this.getRenderContribution(t);if(!r)return;let s,o=this.scrollMatrix&&(this.scrollMatrix.e!==0||this.scrollMatrix.f!==0);if(t.parent){const{scrollX:l=0,scrollY:h=0}=t.parent.attribute;(l||h)&&(o=!0,this.scrollMatrix||(this.scrollMatrix=ns.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-l,-h))}if(o&&(s=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!t.isContainer&&t.attribute.boundsMode!=="empty"&&!kd(t.AABBBounds,s??this.dirtyBounds,!1)){if(o&&t.parent){const{scrollX:l=0,scrollY:h=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(l,h)}return}const a=e.startAtId!=null&&t._uid!==e.startAtId;if(t._uid===e.startAtId&&(e.startAtId=null),i&&(i.skipDraw=a),a?t.isContainer&&r.draw(t,this.currentRenderService,e,i):r.draw(t,this.currentRenderService,e,i),o&&t.parent){const{scrollX:l=0,scrollY:h=0}=t.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(l,h)}if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.afterDrawItem&&h.afterDrawItem(t,this.currentRenderService,e,this))return}}selectRenderByType(t){return ge.getInstance().warn(""),null}selectRenderByNumberType(t,e){let i;if(e.attribute.renderStyle){const r=this.styleRenderMap.get(e.attribute.renderStyle);i=r&&r.get(t)}return i||this.currentRenderMap.get(t)||this.defaultRenderMap.get(t)}clearScreen(t,e,i){var r,s;const{clear:o,viewBox:a}=i,l=a.width(),h=a.height();if(o){e.clearRect(0,0,l,h);const d=(r=t.drawParams)===null||r===void 0?void 0:r.stage;if(d&&(e.globalAlpha=(s=d.attribute.opacity)!==null&&s!==void 0?s:1),d&&d.backgroundImg&&d.resources){const u=d.resources.get(o);u&&u.state==="success"&&u.data&&e.drawImage(u.data,0,0,l,h)}else e.fillStyle=lS(e,o,{AABBBounds:{x1:0,y1:0,x2:0+l,y2:0+h}},0,0),e.fillRect(0,0,l,h)}}afterDraw(t,e){}};WS=Ugt([Bt(),Tk(0,pY(zr)),Tk(1,xe(tn)),Tk(1,Sn(F_)),Ygt("design:paramtypes",[Array,Object])],WS);var Xgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let jS=class extends D_{constructor(){super(...arguments),this.numberType=J0}drawShape(t,e,i,r,s,o,a,l){if(t.incremental&&s.multiGraphicOptions){const{startAtIdx:h,length:d}=s.multiGraphicOptions,{segments:u=[]}=t.attribute;if(h>u.length)return;const c=_e(t).line,{fill:g=c.fill,stroke:p=c.stroke,opacity:f=c.opacity,fillOpacity:m=c.fillOpacity,strokeOpacity:v=c.strokeOpacity,lineWidth:_=c.lineWidth,visible:b=c.visible}=t.attribute,y=fc(f,m,g),C=OP(f,v),S=Kp(g),w=I_(p,_);if(!t.valid||!b||!S&&!w||!(y||C||a||l))return;const{context:x}=s;for(let A=h;A<h+d;A++)this.drawIncreaseSegment(t,x,u[A-1],u[A],t.attribute.segments[A],[c,t.attribute],i,r)}else super.drawShape(t,e,i,r,s,o,a,l)}drawIncreaseSegment(t,e,i,r,s,o,a,l){r&&(e.beginPath(),Yct(e.nativeContext,i,r,{offsetX:a,offsetY:l}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,s,o),e.setStrokeStyle(t,s,a,l,o),e.stroke())}};jS=Xgt([Bt()],jS);var Kgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let uE=class extends eE{constructor(){super(...arguments),this.numberType=AX}drawShape(t,e,i,r,s,o,a){if(t.incremental&&s.multiGraphicOptions){const{startAtIdx:l,length:h}=s.multiGraphicOptions,{segments:d=[]}=t.attribute;if(l>d.length)return;const u=_e(t).area,{fill:c=u.fill,fillOpacity:g=u.fillOpacity,opacity:p=u.opacity,visible:f=u.visible}=t.attribute,m=fc(p,g,c),v=Kp(c);if(!t.valid||!f||!v||!m&&!a)return;for(let _=l;_<l+h;_++)this.drawIncreaseSegment(t,e,d[_-1],d[_],t.attribute.segments[_],[u,t.attribute],i,r)}else super.drawShape(t,e,i,r,s,o,a)}drawIncreaseSegment(t,e,i,r,s,o,a,l){r&&(e.beginPath(),Xct(e.camera?e:e.nativeContext,i,r,{offsetX:a,offsetY:l}),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,s,o),e.setCommonStyle(t,s,a,l,o),e.fill())}};uE=Kgt([Bt()],uE);var Wg,qgt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Zgt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},am=function(n,t){return function(e,i){t(e,i,n)}},fa=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};(function(n){n[n.NORMAL=0]="NORMAL",n[n.STOP=1]="STOP"})(Wg||(Wg={}));let cE=class extends WS{constructor(t,e,i,r){super(t,r),this.contributions=t,this.lineRender=e,this.areaRender=i,this.drawItemInterceptorContributions=r,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=Wg.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new qr([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(t,e){return fa(this,void 0,void 0,function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=t,this.lastDrawContext=e,this.checkingForDrawPromise=this.checkForDraw(e);const i=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,i)return;this.currentRenderService=t;const{context:r,viewBox:s}=e;r&&(r.inuse=!0,r.clearMatrix(),r.setTransformForCurrent(!0),r.save(),e.restartIncremental&&this.clearScreen(this.currentRenderService,r,e),r.translate(s.x1,s.y1,!0),r.save(),t.renderTreeRoots.sort((o,a)=>{var l,h;return((l=o.attribute.zIndex)!==null&&l!==void 0?l:Yi.zIndex)-((h=a.attribute.zIndex)!==null&&h!==void 0?h:Yi.zIndex)}).forEach(o=>{this.renderGroup(o,e)}),this.hooks.completeDraw.tap("top-draw",()=>{r.restore(),r.restore(),r.draw(),r.inuse=!1,this.rendering=!1}))})}_increaseRender(t,e){return fa(this,void 0,void 0,function*(){this.rendering=!0,yield this._renderIncrementalGroup(t,e)})}_renderIncrementalGroup(t,e){return fa(this,void 0,void 0,function*(){this.count=t.count,yield new Promise(i=>{this.renderItem(t,e,{drawingCb:()=>fa(this,void 0,void 0,function*(){if(t.count!==2)yield lW(t,Yi.zIndex,(r,s)=>{if(this.status===Wg.STOP)return!0;if(r.isContainer||s<this.currentIdx)return!1;const o=this.currFrameStartAt+t.incremental;return s<o&&(this.currentIdx=s+1,this.renderItem(r,e)),s===o-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())}),i(!1);else{const r=t.getChildAt(0);if(r.incremental&&r.attribute.segments)for(r.incrementalAt||(r.incrementalAt=0);r.incrementalAt<r.attribute.segments.length;)e.multiGraphicOptions={startAtIdx:r.incrementalAt,length:r.incremental},this.renderItem(r,e),r.incrementalAt+=r.incremental,yield this.waitToNextFrame();else this.renderItem(r,e);i(!1)}})})}),this.hooks.completeDraw.call()})}waitToNextFrame(){return fa(this,void 0,void 0,function*(){return new Promise(t=>{this.global.getRequestAnimationFrame()(()=>{t(!1)})})})}checkForDraw(t){return fa(this,void 0,void 0,function*(){let e=this.rendering;return t.restartIncremental&&(e=!1,yield this.forceStop(),this.resetToInit()),e})}forceStop(){return fa(this,void 0,void 0,function*(){this.rendering&&(this.status=Wg.STOP,yield new Promise(t=>{this.hooks.completeDraw.tap("stopCb",()=>{this.status=Wg.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter(e=>e.name!=="stopCb"),t(!1)})}))})}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(t,e){return fa(this,void 0,void 0,function*(){if(!e.break&&t.attribute.visibleAll!==!1)return t.incremental&&e.startAtId===t._uid?(yield this._increaseRender(t,e),void(e.break=!0)):void(yield new Promise(i=>{this.renderItem(t,e,{drawingCb:()=>fa(this,void 0,void 0,function*(){yield lW(t,Yi.zIndex,r=>fa(this,void 0,void 0,function*(){e.break||r.isContainer&&(yield this.renderGroup(r,e))})),i(!1)})})}))})}};cE=qgt([Bt(),am(0,pY(zr)),am(1,xe(jS)),am(2,xe(uE)),am(3,xe(tn)),am(3,Sn(F_)),Zgt("design:paramtypes",[Array,Object,Object,Object])],cE);const Jgt=new pe(n=>{n(lM).toSelf().inSingletonScope(),n(NO).toSelf().inSingletonScope(),n($O).to(WS),n(KX).to(cE),n(nW).to(rE).inSingletonScope(),n(zr).toService(nW),nr(n,Fo),n(ia).toSelf().inSingletonScope(),nr(n,HO),nr(n,zr),n(LS).toSelf().inSingletonScope(),n(F_).toService(LS),nr(n,F_)});function Qgt(n){n.load(Jgt)}function z_(){z_.__loaded||(z_.__loaded=!0,he.load(Wut),he.load(Igt),he.load(Egt),he.load(Lgt),he.load(Fgt),$gt(he),Qgt(he))}z_.__loaded=!1,z_();const oi=he.get(pO);St.global=oi;const tpt=he.get(BX);St.graphicUtil=tpt;const ept=he.get(RX);St.transformUtil=ept;const ipt=he.get(MX);St.graphicService=ipt;const npt=he.get(FO);St.layerService=npt;let rpt=class{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=Nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,St.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),St.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),St.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(t){const e=i=>i.filter(r=>r.name!==this.key);St.graphicService.hooks.onAttributeUpdate.taps=e(St.graphicService.hooks.onAttributeUpdate.taps),St.graphicService.hooks.onSetStage.taps=e(St.graphicService.hooks.onSetStage.taps),St.graphicService.hooks.onRemove.taps=e(St.graphicService.hooks.onRemove.taps)}},spt=class{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=Nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=St.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const t=St.global.getRequestAnimationFrame();this.rafId=t(()=>{St.global.devicePixelRatio!==this.dpr&&(this.dpr=St.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()})}_refreshByMediaQuery(){try{const t=`(resolution: ${window.devicePixelRatio}dppx)`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},i=matchMedia(t);i&&i.addEventListener("change",e),this.autoRefreshCbs||(this.autoRefreshCbs=[]),this.autoRefreshCbs.push(()=>{i&&i.removeEventListener("change",e)})}catch{return!1}return!0}deactivate(t){var e;const i=St.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId),(e=this.autoRefreshCbs)===null||e===void 0||e.forEach(r=>{r()}),this.autoRefreshCbs=void 0}},opt=class{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=Nn.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,St.graphicService.hooks.onAddIncremental.tap(this.key,(e,i,r)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))}),St.graphicService.hooks.onClearIncremental.tap(this.key,(e,i)=>{e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))})}deactivate(t){St.graphicService.hooks.onAddIncremental.taps=St.graphicService.hooks.onAddIncremental.taps.filter(e=>e.name!==this.key),St.graphicService.hooks.onClearIncremental.taps=St.graphicService.hooks.onClearIncremental.taps.filter(e=>e.name!==this.key)}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,St.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach(e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const r=e.layer.subLayers.get(e._uid);r&&r.drawContribution&&r.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))}),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}};const hW=new ie;let apt=class{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=Nn.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,e=>{e&&e===this.pluginService.stage&&e.dirtyBounds.clear()}),St.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(e,i,r,s)=>{e.glyphHost&&(e=e.glyphHost),i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!e.shouldSelfChangeUpdateAABBBounds()||r&&(hW.setValue(s.x1,s.y1,s.x2,s.y2),i.dirty(hW,e.parent&&e.parent.globalTransMatrix)))}),St.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(e,i,r,s,o)=>{i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!o||i.dirty(s.globalAABBBounds))}),St.graphicService.hooks.clearAABBBounds.tap(this.key,(e,i,r)=>{i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(r)}),St.graphicService.hooks.onRemove.tap(this.key,e=>{const i=e.stage;i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(e.globalAABBBounds)})}deactivate(t){St.graphicService.hooks.beforeUpdateAABBBounds.taps=St.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(e=>e.name!==this.key),St.graphicService.hooks.afterUpdateAABBBounds.taps=St.graphicService.hooks.afterUpdateAABBBounds.taps.filter(e=>e.name!==this.key),St.graphicService.hooks.clearAABBBounds.taps=St.graphicService.hooks.clearAABBBounds.taps.filter(e=>e.name!==this.key),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter(e=>e.name!==this.key),St.graphicService.hooks.onRemove.taps=St.graphicService.hooks.onRemove.taps.filter(e=>e.name!==this.key)}};const VO=new gX;VO.addTimeline(uS);VO.setFPS(60);let Mu;function eK(){if(Mu==null)try{const n=document.createElement("canvas"),t=n.getContext("2d");Mu=!!(window&&n.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&t&&t.isPointInPath&&t.isPointInStroke),Mu&&(Mu=!!document.createElement)}catch{Mu=!1}}function GO(){eK();const n=St.global&&St.global.env;return n?n==="browser":Mu}function lpt(){eK();const n=St.global&&St.global.env;return n?n==="node":!Mu}let Fh=class gE{static registerPlugin(t,e){gE._pluginClasses[t]=e}static getPlugin(t){return gE._pluginClasses[t]}};Fh._pluginClasses={};const dW={BACKGROUND:"white"};let hpt=class extends el{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return(t=this._background)!==null&&t!==void 0?t:dW.BACKGROUND}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(t={}){var e;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=i=>{if(!(this._skipRender<0))if(i){if(this.dirtyBounds){const r=this.window.getViewBox();this.dirtyBounds.setValue(r.x1,r.y1,r.width(),r.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=i=>{this._beforeRender&&this._beforeRender(i)},this.afterRender=i=>{this.renderCount++,this._afterRender&&this._afterRender(i),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach(r=>r(i)),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var i;this.tickedBeforeRender=!0,((i=this.params.optimize)===null||i===void 0?void 0:i.tickRenderMode)==="performance"||this.state!=="rendering"&&this.render()},this.params=t,this.theme=new L_,this.hooks={beforeRender:new qr(["stage"]),afterRender:new qr(["stage"])},this.global=St.global,!this.global.env&&GO()&&this.global.setEnv("browser"),this.window=he.get(E_),this.renderService=he.get(ZX),this.pluginService=he.get(JX),this.layerService=he.get(FO),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:t.canvasControled!==!1,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=(e=t.background)!==null&&e!==void 0?e:dW.BACKGROUND,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),t.disableDirtyBounds===!1&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||VO,this.supportInteractiveLayer=t.interactiveLayer!==!1,this.timeline=new PO,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&yt(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(t=-1){this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new ldt(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(t=!1){t&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:r=0,beta:s=0,camera:o,fieldRatio:a=1,fieldDepth:l}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:r,beta:s,camera:o,fieldRatio:a,fieldDepth:l})}set3dOptions(t){var e,i,r,s,o,a;this.option3d=t;const l=this.get3dOptions(t),{light:h,center:d,camera:u,alpha:c,beta:g,fieldRatio:p,fieldDepth:f}=l,{dir:m=[1,1,-1],color:v="white",ambient:_}=h,b=((e=d.x)!==null&&e!==void 0?e:this.width/2)+((i=d.dx)!==null&&i!==void 0?i:0),y=((r=d.y)!==null&&r!==void 0?r:this.height/2)+((s=d.dy)!==null&&s!==void 0?s:0),C=[b,y,((o=d.z)!==null&&o!==void 0?o:0)+((a=d.dz)!==null&&a!==void 0?a:0)];let S=0,w=0,x=0;u||(S=Math.sin(c)+b,w=Math.sin(g)+y,x=Math.cos(c)*Math.cos(g)*1);const A=Fh.getPlugin("DirectionalLight");A&&(this.light=new A(m,v,_));const M={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:p,fieldDepth:f,viewParams:{pos:[S,w,x],center:C,up:[0,1,0]}};if(this.camera)this.camera.params=M;else{const T=Fh.getPlugin("OrthoCamera");T&&(this.camera=new T(M))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const t=Fh.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new rpt))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new spt))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new opt))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Bi;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new apt,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const t=Fh.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableHtmlAttribute(t){if(this.htmlAttribute)return;const e=Fh.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableReactAttribute(t){if(this.reactAttribute)return;const e=Fh.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("")}createLayer(t,e){if(this.releaseStatus==="released")return;const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach(i=>{this.appendChild(i)})}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){this.releaseStatus!=="released"&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if(this.releaseStatus==="released")return;this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env==="harmony"){const t=this.window.getContext().nativeContext;this.forEachChildren((e,i)=>{if(i>0){const r=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(r)}})}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach(i=>{this.nextFrameRenderLayerSet.add(i)}),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){if(this.releaseStatus==="released")return;this.timeline.resume(),this.ticker.start();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let r=0;r<t.length;r++){let s=t[r];s.layerMode==="virtual"&&(s=s.getNativeHandler().mainHandler.layer),i.includes(s)||i.push(s)}i.forEach(r=>{r.renderCount>this.renderCount||(r.renderCount=this.renderCount+1,r===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),r.render({renderService:this.renderService,background:r===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e,i=!0){this.window.resize(t,e),i&&this.render()}resize(t,e,i=!0){this.releaseStatus!=="released"&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren(r=>{r.resize(t,e)}),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e,i=!0){this.releaseStatus!=="released"&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren(r=>{r.resizeView(t,e)}),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,r,s){let o=!0;typeof t=="object"?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),e===!1&&(o=!1)):(this.viewBox.setValue(t,e,t+i,e+r),s===!1&&(o=!1)),this.forEachChildren(a=>{a.resizeView(this.viewBox.width(),this.viewBox.height())}),o&&this.render()}setDpr(t,e=!0){this.forEachChildren(i=>{i.setDpr(t)}),e&&this.render()}setOrigin(t,e){throw new Error("")}export(t){throw new Error("")}pick(t,e){if(this.releaseStatus==="released")return;const i=this.getPickerService().pick(this.children,new Yt(t,e),{bounds:this.AABBBounds});return!(!(i!=null&&i.graphic)&&!(i!=null&&i.group))&&i}startAnimate(t){throw new Error("")}setToFrame(t){throw new Error("")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach(t=>{t.release()}),this.interactiveLayer&&(this.interactiveLayer.forEachChildren(t=>{t.setStage&&t.setStage(null,null),this.interactiveLayer.removeChild(t)}),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){this.releaseStatus!=="released"&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter(e=>e.name===t)[0]}renderTo(t){this.releaseStatus!=="released"&&this.forEachChildren((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:i===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})})}renderToNewWindow(t=!0,e){if(this.releaseStatus==="released")return;const i=he.get(E_),r=e?-e.x1:0,s=e?-e.y1:0,o=e?e.x2:this.viewWidth,a=e?e.y2:this.viewHeight,l=e?e.width():this.viewWidth,h=e?e.height():this.viewHeight;return i.create({viewBox:{x1:r,y1:s,x2:o,y2:a},width:l,height:h,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(i),i}toCanvas(t=!0,e){if(this.releaseStatus==="released")return;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){const e=this.global.mapToCanvasPoint(t,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=he.get(Cp)),this.pickerService}reInit(){this.renderService.reInit(),this.pickerService.reInit()}};function dpt(n){return new hpt(n)}const kk={WIDTH:500,HEIGHT:500,DPR:1};let UO=class{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(t){this._nativeCanvas=t}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:r=kk.WIDTH,height:s=kk.HEIGHT,dpr:o=kk.DPR,x:a,y:l,id:h,canvasControled:d=!0}=t;this._x=a??0,this._y=l??0,this._pixelWidth=r*o,this._pixelHeight=s*o,this._visiable=t.visiable!==!1,this.controled=d,this._displayWidth=r,this._displayHeight=s,this._dpr=o,this._nativeCanvas=i,this._id=(e=i.id)!==null&&e!==void 0?e:h,h&&(i.id=h),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,r){return this._context.getImageData(t,e,i,r)}convertToBlob(t){throw new Error("")}transferToImageBitmap(){throw new Error("")}release(...t){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}};UO.env="browser";var upt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},cpt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};let NS=class{configure(t,...e){t.env===this.type&&t.setActiveEnvContribution(this)}getNativeAABBBounds(t){return new ie}removeDom(t){return!1}createDom(t){return null}updateDom(t,e){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}loadJson(t){const e=fetch(t).then(i=>i.json());return e.then(i=>({data:i,state:"success"})).catch(()=>({data:null,state:"fail"})),e}loadArrayBuffer(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadBlob(t){return fetch(t).then(e=>e.blob()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}getElementTop(t,e){return 0}getElementLeft(t,e){return 0}getElementTopLeft(t,e){return{top:0,left:0}}loadFont(t,e,i){return cpt(this,void 0,void 0,function*(){return{loadState:"fail"}})}isMacOS(){return!1}copyToClipBoard(t){return Promise.resolve(null)}};NS=upt([Bt()],NS);var gpt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},ppt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let $S=class{constructor(){this._uid=Nn.GenAutoIncrementId(),this.viewBox=new ie,this.modelMatrix=new Pe(1,0,0,1,0,0)}onChange(t){this._onChangeCb=t}configure(t,e){e.env===this.type&&t.setWindowHandler(this)}release(...t){this.releaseWindow()}isVisible(t){return!0}onVisibleChange(t){}getTopLeft(t){return{top:0,left:0}}setViewBox(t){this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(t,e,i,r,s,o){this.modelMatrix.setValue(t,e,i,r,s,o)}getViewBoxTransform(){return this.modelMatrix}};$S=gpt([Bt(),ppt("design:paramtypes",[])],$S);var fpt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},mpt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},hy=function(n,t){return function(e,i){t(e,i,n)}};let pE=class{constructor(t,e){this.pickItemInterceptorContributions=t,this.pickServiceInterceptorContributions=e,this.type="default",this.global=St.global}reInit(){this._init()}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort((t,e)=>t.order-e.order),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort((t,e)=>t.order-e.order)}pick(t,e,i){let r={graphic:null,group:null};i.pickerService=this;const s=i.bounds.width(),o=i.bounds.height();if(!new ie().setValue(0,0,s,o).containsPoint(e))return r;this.pickContext&&(this.pickContext.inuse=!0),i.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const a=new Pe(1,0,0,1,0,0);let l;for(let h=t.length-1;h>=0&&(r=t[h].isContainer?this.pickGroup(t[h],e,a,i):this.pickItem(t[h],e,a,i),!r.graphic);h--)l||(l=r.group);if(r.graphic||(r.group=l),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let h=0;h<this.pickerServiceInterceptorContributions.length;h++){const d=this.pickerServiceInterceptorContributions[h];d.afterPickItem&&(r=d.afterPickItem(r,this,e,i,{parentMatrix:a}))}return r}containsPoint(t,e,i){var r;return!!(!((r=this.pickItem(t,e,null,i??{pickContext:this.pickContext,pickerService:this}))===null||r===void 0)&&r.graphic)}pickGroup(t,e,i,r){let s={group:null,graphic:null};if(t.attribute.visibleAll===!1)return s;const o=r.pickContext,a=o.modelMatrix;if(o.camera){const p=t.transMatrix,f=yn.allocate();if(NP(f,p),a){if(f){const m=yn.allocate();o.modelMatrix=Q0(m,a,f),yn.free(f)}}else NP(f,t.globalTransMatrix),o.modelMatrix=f}if(this.InterceptorContributions.length)for(let p=0;p<this.InterceptorContributions.length;p++){const f=this.InterceptorContributions[p];if(f.beforePickItem){const m=f.beforePickItem(t,this,e,r,{parentMatrix:i});if(m)return o.modelMatrix!==a&&yn.free(o.modelMatrix),o.modelMatrix=a,m}}const l=t.transMatrix,h=ns.allocateByObj(i),d=new Yt(e.x,e.y);h.transformPoint(d,d);const u=t.AABBBounds.containsPoint(d);if(!u&&!t.stage.camera)return s;const c=this.pickItem(t,d.clone(),i,r);c&&c.graphic&&(s.graphic=c.graphic,s.params=c.params);const g=t.attribute.pickable!==!1&&u;return h.multiply(l.a,l.b,l.c,l.d,l.e,l.f),t.attribute.childrenPickable===!1||c&&c.graphic||tK(t,Yi.zIndex,p=>{if(p.isContainer){const f=new Yt(e.x,e.y),m=_e(t).group,{scrollX:v=m.scrollX,scrollY:_=m.scrollY}=t.attribute;f.x-=v,f.y-=_,s=this.pickGroup(p,f,h,r)}else{const f=new Yt(e.x,e.y);h.transformPoint(f,f);const m=_e(t).group,{scrollX:v=m.scrollX,scrollY:_=m.scrollY}=t.attribute;f.x-=v,f.y-=_;const b=this.pickItem(p,f,i,r);b&&b.graphic&&(s.graphic=b.graphic,s.params=b.params)}return!!s.graphic||!!s.group},!0,!!o.camera),o.modelMatrix!==a&&yn.free(o.modelMatrix),o.modelMatrix=a,s.graphic||s.group||!g||t.stage.camera||(s.group=t),ns.free(h),s}selectPicker(t){return this.pickerMap.get(t.numberType)||null}};pE=fpt([Bt(),hy(0,xe(tn)),hy(0,Sn(zg)),hy(1,xe(tn)),hy(1,Sn(IS)),mpt("design:paramtypes",[Object,Object])],pE);let uW=!1;const vpt=new pe(n=>{uW||(uW=!0,n(bS).toSelf().inSingletonScope(),n(MS).to(bS).inSingletonScope(),n(zr).toService(MS),n(FP).toService(ia),nr(n,FP))});let cW=!1;const _pt=new pe(n=>{cW||(cW=!0,n(xS).toSelf().inSingletonScope(),n(PS).to(xS).inSingletonScope(),n(zr).toService(PS),n(Qp).toSelf(),n(Jp).toSelf(),n(Ou).toService(Qp),n(Ou).toService(Jp),n(Ou).toService(ia),nr(n,Ou))});let gW=!1;const bpt=new pe(n=>{gW||(gW=!0,n(D_).toSelf().inSingletonScope(),n(jS).toSelf().inSingletonScope(),n(kS).to(D_).inSingletonScope(),n(zr).toService(kS))});let pW=!1;const ypt=new pe(n=>{pW||(pW=!0,n(wS).toSelf().inSingletonScope(),n(ES).to(wS).inSingletonScope(),n(zr).toService(ES),n(jP).toService(ia),nr(n,jP))});let fW=!1;const Cpt=new pe(n=>{fW||(fW=!0,n(yS).toSelf().inSingletonScope(),n(TS).to(yS).inSingletonScope(),n(zr).toService(TS),n(HP).toService(ia),nr(n,HP))});let mW=!1;const Spt=new pe(n=>{mW||(mW=!0,n(oE).to(iE).inSingletonScope(),n(zr).toService(oE),n(vS).toService(ia),nr(n,vS))});let vW=!1;const xpt=new pe(n=>{vW||(vW=!0,n(SS).toSelf().inSingletonScope(),n(RS).to(SS).inSingletonScope(),n(zr).toService(RS),n(zP).toService(ia),nr(n,zP))});let _W=!1;const wpt=new pe(n=>{_W||(_W=!0,n(BS).to(nE).inSingletonScope(),n(zr).toService(BS),n(WP).toService(ia),nr(n,WP))});var Apt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Mpt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let fE=class extends cs{constructor(){super(),this.numberType=DO,this.builtinContributions=[YX],this.init()}drawShape(t,e,i,r,s){const o=_e(t).richtext,{strokeOpacity:a=o.strokeOpacity,opacity:l=o.opacity,fillOpacity:h=o.fillOpacity,visible:d=o.visible}=t.attribute;if(!t.valid||!d)return;const u=fc(l,h,!0),c=fc(l,a,!0);u&&(e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,o),e.translate(i,r),this.beforeRenderStep(t,e,i,r,u,c,u,c,o,s),t.getFrameCache().draw(e,this.drawIcon),this.afterRenderStep(t,e,i,r,u,c,u,c,o,s))}drawIcon(t,e,i,r,s){var o;const a=_e(t).richtextIcon,{width:l=a.width,height:h=a.height,opacity:d=a.opacity,image:u,backgroundFill:c=a.backgroundFill,backgroundFillOpacity:g=a.backgroundFillOpacity,backgroundStroke:p=a.backgroundStroke,backgroundStrokeOpacity:f=a.backgroundStrokeOpacity,backgroundRadius:m=a.backgroundRadius,margin:v}=t.attribute,{backgroundWidth:_=l,backgroundHeight:b=h}=t.attribute;if(v&&(i+=t._marginArray[3],r+=t._marginArray[0]),t._hovered){const C=(_-l)/2,S=(b-h)/2;m===0?(e.beginPath(),e.rect(i-C,r-S,_,b)):(e.beginPath(),il(e,i-C,r-S,_,b,m,!0)),c&&(e.globalAlpha=g,e.fillStyle=c,e.fill()),p&&(e.globalAlpha=f,e.strokeStyle=p,e.stroke())}const y=u&&((o=t==null?void 0:t.resources)===null||o===void 0?void 0:o.get(u));y&&y.state==="success"&&(e.globalAlpha=d,e.drawImage(y.data,i,r,l,h))}draw(t,e,i){const r=_e(t).richtext;this._draw(t,r,!1,i)}};fE=Apt([Bt(),Mpt("design:paramtypes",[])],fE);let bW=!1;const Tpt=new pe(n=>{bW||(bW=!0,n(aE).to(fE).inSingletonScope(),n(zr).toService(aE))});let yW=!1;const kpt=new pe(n=>{yW||(yW=!0,n(lE).to(sE).inSingletonScope(),n(zr).toService(lE),n(Iu).toService(ia),nr(n,Iu))});function Rpt(){Ut.RegisterGraphicCreator("arc",_S)}function Bpt(){Ut.RegisterGraphicCreator("circle",HX)}function Ppt(){Ut.RegisterGraphicCreator("group",fS)}function Ept(){Ut.RegisterGraphicCreator("image",oM)}function Lpt(){Ut.RegisterGraphicCreator("line",Os)}function Ipt(){Ut.RegisterGraphicCreator("path",hct)}function Opt(){Ut.RegisterGraphicCreator("polygon",$X)}function Dpt(){Ut.RegisterGraphicCreator("rect",wi)}function Fpt(){Ut.RegisterGraphicCreator("richtext",lct)}function Hpt(){Ut.RegisterGraphicCreator("symbol",Zp)}function zpt(){Ut.RegisterGraphicCreator("text",UP)}function Wpt(){Ut.RegisterGraphicCreator("shadowRoot",uct)}function jpt(){Ut.RegisterGraphicCreator("wrapText",ict)}const CW=new ie;class Npt{constructor(){this.name="FlexLayoutPlugin",this.activeEvent="onRegister",this.id=Nn.GenAutoIncrementId(),this.key=this.name+this.id,this.tempBounds=new ie}pauseLayout(t){this.pause=t}tryLayoutChildren(t){t.firstChild&&this.tryLayout(t.firstChild)}tryLayout(t,e=!0){if(this.pause)return;const i=t.parent;if(!(e||i&&t.needUpdateLayout()))return;const r=_e(i).group,{display:s=r.display}=i.attribute;if(s!=="flex")return;const{flexDirection:o=r.flexDirection,flexWrap:a=r.flexWrap,alignItems:l=r.alignItems,clip:h=r.clip}=i.attribute,{alignContent:d=l??r.alignContent}=i.attribute;let{width:u,height:c,justifyContent:g=r.justifyContent}=i.attribute;const p=i.getChildren();if(u==null||c==null){let x=0,A=0,M=0;if(p.forEach(T=>{const R=this.getAABBBounds(T);R.empty()||(o==="column"||o==="column-reverse"?(A+=R.height(),x=Math.max(x,R.width())):(x+=R.width(),A=Math.max(A,R.height())),M+=R.x1,M+=R.y1,M+=R.x2,M+=R.y2)}),!isFinite(M))return;u=x,c=A}i.attribute.width==null?i.attribute.width=u:u=i.attribute.width,i.attribute.height==null?i.attribute.height=c:c=i.attribute.height,this.tempBounds.copy(i._AABBBounds);const f={main:{len:u,field:"x"},cross:{len:c,field:"y"}},m=f.main,v=f.cross;o!=="column"&&o!=="column-reverse"||(m.len=c,v.len=u,m.field="y",v.field="x"),o!=="row-reverse"&&o!=="column-reverse"||(g==="flex-start"?g="flex-end":g==="flex-end"?g="flex-start":p.reverse());let _=0,b=0;const y=[];p.forEach(x=>{const A=this.getAABBBounds(x);if(A.empty())return;const M=m.field==="x"?A.width():A.height(),T=v.field==="x"?A.width():A.height();y.push({mainLen:M,crossLen:T}),_+=M,b=Math.max(b,T)});const C=[];if(_>m.len&&a==="wrap"){let x=0,A=0;y.forEach(({mainLen:M,crossLen:T},R)=>{x+M>m.len?x===0?(C.push({idx:R,mainLen:x+M,crossLen:T}),x=0,A=0):(C.push({idx:R-1,mainLen:x,crossLen:A}),x=M,A=T):(x+=M,A=Math.max(A,T))}),C.push({idx:y.length-1,mainLen:x,crossLen:A})}else C.push({idx:y.length-1,mainLen:_,crossLen:b});let S=0;if(C.forEach(x=>{this.layoutMain(i,p,g,m,y,S,x),S=x.idx+1}),b=C.reduce((x,A)=>x+A.crossLen,0),C.length===1){const x={"flex-start":0,"flex-end":v.len,center:v.len/2};this.layoutCross(p,l,v,x,y,C[0],0)}else if(d==="flex-start"){S=0;let x=0;C.forEach((A,M)=>{const T={"flex-start":x,"flex-end":x+A.crossLen,center:x+A.crossLen/2};this.layoutCross(p,"flex-start",v,T,y,C[M],S),S=A.idx+1,x+=A.crossLen})}else if(d==="center"){S=0;let x=Math.max(0,(v.len-b)/2);C.forEach((A,M)=>{const T={"flex-start":x,"flex-end":x+A.crossLen,center:x+A.crossLen/2};this.layoutCross(p,"center",v,T,y,C[M],S),S=A.idx+1,x+=A.crossLen})}else if(d==="space-around"){S=0;const x=Math.max(0,(v.len-b)/C.length/2);let A=x;C.forEach((M,T)=>{const R={"flex-start":A,"flex-end":A+M.crossLen,center:A+M.crossLen/2};this.layoutCross(p,"flex-start",v,R,y,C[T],S),S=M.idx+1,A+=M.crossLen+2*x})}else if(d==="space-between"){S=0;const x=Math.max(0,(v.len-b)/(2*C.length-2));let A=0;C.forEach((M,T)=>{const R={"flex-start":A,"flex-end":A+M.crossLen,center:A+M.crossLen/2};this.layoutCross(p,"flex-start",v,R,y,C[T],S),S=M.idx+1,A+=M.crossLen+2*x})}p.forEach((x,A)=>{x.addUpdateBoundTag(),x.addUpdatePositionTag(),x.clearUpdateLayoutTag()}),i.addUpdateLayoutTag();const w=this.getAABBBounds(i);h||this.tempBounds.equals(w)||this.tryLayout(i,!1)}getAABBBounds(t){this.skipBoundsTrigger=!0;const e=t.AABBBounds;return this.skipBoundsTrigger=!1,e}updateChildPos(t,e,i){return t+(e??0)-i}layoutMain(t,e,i,r,s,o,a){if(i==="flex-start"){let l=0;for(let h=o;h<=a.idx;h++){const d=l+ma(e[h],r.field),u=this.getAABBBounds(e[h]);!u.empty()&&(e[h].attribute[r.field]=this.updateChildPos(d,e[h].attribute[r.field],u[`${r.field}1`])),l+=s[h].mainLen}}else if(i==="flex-end"){let l=r.len;for(let h=a.idx;h>=o;h--){l-=s[h].mainLen;const d=l+ma(e[h],r.field),u=this.getAABBBounds(e[h]);!u.empty()&&(e[h].attribute[r.field]=this.updateChildPos(d,e[h].attribute[r.field],u[`${r.field}1`]))}}else if(i==="space-around")if(a.mainLen>=r.len){let l=0;for(let h=o;h<=a.idx;h++){const d=l+ma(e[h],r.field),u=this.getAABBBounds(e[h]);!u.empty()&&(e[h].attribute[r.field]=this.updateChildPos(d,e[h].attribute[r.field],u[`${r.field}1`])),l+=s[h].mainLen}}else{const l=a.idx-o+1,h=(r.len-a.mainLen)/l/2;let d=h;for(let u=o;u<=a.idx;u++){const c=d+ma(e[u],r.field),g=this.getAABBBounds(e[u]);!g.empty()&&(e[u].attribute[r.field]=this.updateChildPos(c,e[u].attribute[r.field],g[`${r.field}1`])),d+=s[u].mainLen+2*h}}else if(i==="space-between")if(a.mainLen>=r.len){let l=0;for(let h=o;h<=a.idx;h++){const d=l+ma(e[h],r.field),u=this.getAABBBounds(e[h]);!u.empty()&&(e[h].attribute[r.field]=this.updateChildPos(d,e[h].attribute[r.field],u[`${r.field}1`])),l+=s[h].mainLen}}else{const l=a.idx-o+1,h=(r.len-a.mainLen)/(2*l-2);let d=0;for(let u=o;u<=a.idx;u++){const c=d+ma(e[u],r.field),g=this.getAABBBounds(e[u]);!g.empty()&&(e[u].attribute[r.field]=this.updateChildPos(c,e[u].attribute[r.field],g[`${r.field}1`])),d+=s[u].mainLen+2*h}}else if(i==="center"){let l=(r.len-a.mainLen)/2;for(let h=o;h<=a.idx;h++){const d=l+ma(e[h],r.field),u=this.getAABBBounds(e[h]);!u.empty()&&(e[h].attribute[r.field]=this.updateChildPos(d,e[h].attribute[r.field],u[`${r.field}1`])),l+=s[h].mainLen}}}layoutCross(t,e,i,r,s,o,a){var l;for(let h=a;h<=o.idx;h++){const d=t[h];let{alignSelf:u}=d.attribute;u&&u!=="auto"||(u=e);const c=this.getAABBBounds(d),g=(l=r[u])!==null&&l!==void 0?l:r["flex-start"];u==="flex-end"?!c.empty()&&(d.attribute[i.field]=this.updateChildPos(g-s[h].crossLen+ma(d,i.field),d.attribute[i.field],c[`${i.field}1`])):u==="center"?!c.empty()&&(d.attribute[i.field]=this.updateChildPos(g-s[h].crossLen/2+ma(d,i.field),d.attribute[i.field],c[`${i.field}1`])):!c.empty()&&(d.attribute[i.field]=this.updateChildPos(g+ma(d,i.field),d.attribute[i.field],c[`${i.field}1`]))}}activate(t){this.pluginService=t,St.graphicService.hooks.onAttributeUpdate.tap(this.key,e=>{e.glyphHost&&(e=e.glyphHost),e.stage&&e.stage===this.pluginService.stage&&this.tryLayout(e,!1)}),St.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(e,i,r,s)=>{e.glyphHost&&(e=e.glyphHost),i&&i===this.pluginService.stage&&e.isContainer&&!this.skipBoundsTrigger&&CW.copy(s)}),St.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(e,i,r,s,o)=>{i&&i===this.pluginService.stage&&e.isContainer&&!this.skipBoundsTrigger&&(CW.equals(r)||this.tryLayout(e,!1))}),St.graphicService.hooks.onSetStage.tap(this.key,e=>{e.glyphHost&&(e=e.glyphHost),this.tryLayout(e,!1)})}deactivate(t){St.graphicService.hooks.onAttributeUpdate.taps=St.graphicService.hooks.onAttributeUpdate.taps.filter(e=>e.name!==this.key),St.graphicService.hooks.beforeUpdateAABBBounds.taps=St.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(e=>e.name!==this.key),St.graphicService.hooks.afterUpdateAABBBounds.taps=St.graphicService.hooks.afterUpdateAABBBounds.taps.filter(e=>e.name!==this.key),St.graphicService.hooks.onSetStage.taps=St.graphicService.hooks.onSetStage.taps.filter(e=>e.name!==this.key)}}function ma(n,t){return 0}const SW=()=>{Fh.registerPlugin("FlexLayoutPlugin",Npt)},$pt=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];let Gs=class extends el{constructor(t,e){super(t),this._skipRenderAttributes=$pt,e!=null&&e.mode&&(this.mode=e.mode,this.setMode(e.mode)),e!=null&&e.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage(()=>{this.render(),this.bindEvents()})}setAttribute(t,e,i,r){const s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);if(s)return this._setAttributes(s,i);os(this.attribute[t])&&os(e)&&!it(this.attribute[t])&&!it(e)?Z(this.attribute[t],e):this.attribute[t]=e,this._skipRenderAttributes.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every(r=>this._skipRenderAttributes.includes(r))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){D(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const r=e[i];!os(this.attribute[r])||it(this.attribute[r])||it(t[r])?this.attribute[r]=t[r]:Z(this.attribute[r],t[r])}}bindEvents(){}_getNodeId(t){var e;return`${(e=this.id)!==null&&e!==void 0?e:this._uid}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const r=new BO(t,e);r.manager=(i=this.stage)===null||i===void 0?void 0:i.eventSystem.manager,this.dispatchEvent(r)}};const Nd=Symbol.for("MathPickerContribution"),xW=Symbol.for("MathArcPicker"),wW=Symbol.for("MathCirclePicker"),VS=Symbol.for("MathImagePicker"),AW=Symbol.for("MathLinePicker"),MW=Symbol.for("MathPathPicker"),TW=Symbol.for("MathRectPicker"),kW=Symbol.for("MathSymbolPicker"),RW=Symbol.for("MathTextPicker"),BW=Symbol.for("MathPolygonPicker"),PW=Symbol.for("CanvasArcPicker"),EW=Symbol.for("CanvasCirclePicker"),LW=Symbol.for("CanvasImagePicker"),IW=Symbol.for("CanvasLinePicker"),OW=Symbol.for("CanvasPathPicker"),DW=Symbol.for("CanvasRectPicker"),FW=Symbol.for("CanvasSymbolPicker"),HW=Symbol.for("CanvasTextPicker"),zW=Symbol.for("CanvasPolygonPicker"),WW=Symbol.for("CanvasRichTextPicker"),jW=Symbol.for("CanvasGroupPicker"),hs=Symbol.for("CanvasPickerContribution"),Vpt={onPointerDown:"pointerdown",onPointerUp:"pointerup",onPointerUpOutside:"pointerupoutside",onPointerTap:"pointertap",onPointerOver:"pointerover",onPointerMove:"pointermove",onPointerEnter:"pointerenter",onPointerLeave:"pointerleave",onPointerOut:"pointerout",onMouseDown:"mousedown",onMouseUp:"mouseup",onMouseUpOutside:"mouseupoutside",onMouseMove:"mousemove",onMouseOver:"mouseover",onMouseOut:"mouseout",onMouseEnter:"mouseenter",onMouseLeave:"mouseleave",onPinch:"pinch",onPinchStart:"pinchstart",onPinchEnd:"pinchend",onPan:"pan",onPanStart:"panstart",onPanEnd:"panend",onDrag:"drag",onDragStart:"dragstart",onDragEnter:"dragenter",onDragLeave:"dragleave",onDragOver:"dragover",onDragEnd:"dragend",onRightDown:"rightdown",onRightUp:"rightup",onRightUpOutside:"rightupoutside",onTouchStart:"touchstart",onTouchEnd:"touchend",onTouchEndOutside:"touchendoutside",onTouchMove:"touchmove",onTouchCancel:"touchcancel",onPress:"press",onPressUp:"pressup",onPressEnd:"pressend",onSwipe:"swipe",onDrop:"drop",onWeel:"wheel",onClick:"click",onDblClick:"dblclick"},NW=(n,t)=>{const e=t.x-n.x,i=t.y-n.y;return Math.abs(e)>Math.abs(i)?e>0?"right":"left":i>0?"down":"up"},dy=(n,t)=>{const e=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y);return Math.sqrt(e*e+i*i)},Gpt=n=>{const t=n.length;if(t===1)return{x:Math.round(n[0].x),y:Math.round(n[0].y)};let e=0,i=0,r=0;for(;r<t;)e+=n[r].x,i+=n[r].y,r++;return{x:Math.round(e/t),y:Math.round(i/t)}};let Upt=class extends us{constructor(t,e={}){var i,r,s,o,a,l,h,d,u,c;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=g=>{this.startTime=Lu.now();const{cachedEvents:p,startPoints:f}=this;g&&p.push(g.clone()),f.length=p.length;for(let m=0;m<p.length;m++){const{x:v,y:_}=p[m],b={x:v,y:_};f[m]=b}if(f.length!==1)this.startDistance=dy(f[0],f[1]),this.center=Gpt([f[0],f[1]]);else{const m=p[0];this.pressTimeout=setTimeout(()=>{m.direction="none",m.deltaX=0,m.deltaY=0,m.points=f,this.triggerStartEvent("press",m),this.triggerEvent("press",m),this.eventType="press",this.direction="none",this.pressTimeout=null},this.config.press.time)}},this.onMove=g=>{this.clearPressTimeout();const{startPoints:p,cachedEvents:f}=this;if(!p.length)return;const m=g.clone(),{x:v,y:_,pointerId:b}=m;for(let A=0,M=f.length;A<M;A++)if(b===f[A].pointerId){f[A]=m;break}const y={x:v,y:_},C=f.map(A=>({x:A.x,y:A.y})),S=Lu.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=S,this.lastMovePoint=y,p.length===1){const A=p[0],M=v-A.x,T=_-A.y,R=this.direction||NW(A,y);this.direction=R;const B=this.getEventType(y);return m.direction=R,m.deltaX=M,m.deltaY=T,m.points=C,this.triggerStartEvent(B,m),void this.triggerEvent(B,m)}const{startDistance:w}=this,x=dy(C[0],C[1]);m.scale=x/w,m.center=this.center,m.points=C,this.triggerStartEvent("pinch",m),this.triggerEvent("pinch",m)},this.onEnd=g=>{const p=g.clone(),{cachedEvents:f,startPoints:m}=this,v=f.map(_=>({x:_.x,y:_.y}));if(p.points=v,this.triggerEndEvent(p),f.length===1){const _=Lu.now(),b=this.lastMoveTime;if(_-b<100){const y=b-(this.prevMoveTime||this.startTime);if(y>0){const C=this.prevMovePoint||m[0],S=this.lastMovePoint||m[0],w=dy(C,S),x=w/y;if(x>this.config.swipe.velocity&&w>this.config.swipe.threshold)return p.velocity=x,p.direction=NW(C,S),this.triggerEvent("swipe",p),this.cachedEvents=[],this.startPoints=[],void this.reset()}}_-this.startTime<this.config.press.time&&(_-this.lastTapTime<this.config.tap.interval&&g.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=_,this.lastTapTarget=g.target,this.tapCount===1?this.triggerEvent("tap",p):this.tapCount===2&&(this.triggerEvent("doubletap",p),this.tapCount=0))}for(let _=0,b=f.length;_<b;_++)if(f[_].pointerId===p.pointerId){f.splice(_,1),m.splice(_,1);break}this.reset(),f.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(r=(i=e==null?void 0:e.press)===null||i===void 0?void 0:i.time)!==null&&r!==void 0?r:251,threshold:(o=(s=e==null?void 0:e.press)===null||s===void 0?void 0:s.threshold)!==null&&o!==void 0?o:9},swipe:{threshold:(l=(a=e==null?void 0:e.swipe)===null||a===void 0?void 0:a.threshold)!==null&&l!==void 0?l:10,velocity:(d=(h=e==null?void 0:e.swipe)===null||h===void 0?void 0:h.velocity)!==null&&d!==void 0?d:.3},tap:{interval:(c=(u=e==null?void 0:e.tap)===null||u===void 0?void 0:u.interval)!==null&&c!==void 0?c:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerleave",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerleave",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:r}=this;if(e==="press")return e;let s;return s=Lu.now()-i>this.config.press.time&&dy(r[0],t)<this.config.press.threshold?"press":"pan",this.eventType=s,s}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,r={type:t,ev:e};for(let s=0,o=i.length;s<o;s++)if(i[s].type===t)return void i.splice(s,1,r);i.push(r)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:r}=this;i||(this.throttleTimer=St.global.getRequestAnimationFrame()(()=>{St.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let s=0,o=r.length;s<o;s++){const{type:a,ev:l}=r[s];this.emitEvent(a,l)}this.emitThrottles.length=0}))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach(i=>{this.triggerEvent(`${i}end`,t),i==="press"&&this.triggerEvent(`${i}up`,t),delete e[i]})}emitEvent(t,e){if(!this.element)return;const i=this.element._events[dX];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let r=0,s=i.length;r<s&&!e.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,e,t);this.emit(t,e)}};var Ypt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Xpt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const ye=[0,0,0],Kpt=(n,t,e,i,r,s,o,a)=>{if(a)for(;e>t;)e-=Ft;else for(;e<t;)e+=Ft;const l=Kt/3*(e>t?1:-1);let h=t,d=h;for(;d!==e;){d=l>0?Math.min(d+l,e):Math.max(d+l,e);const u=Math.abs(d-h),c=4*Math.tan(u/4)/3,g=d<h?-1:1,p=Math.cos(h),f=Math.sin(h),m=Math.cos(d),v=Math.sin(d),_=p*s+i,b=f*o+r,y=m*s+i,C=v*o+r,S=s*c*g,w=o*c*g;n.push([_-S*f,b+w*p,y+S*v,C-w*m,y,C]),h=d}};let Sp=class{set fillStyle(t){this.nativeContext.fillStyle=t}get fillStyle(){return this.nativeContext.fillStyle}set font(t){this.nativeContext.font=t}get font(){return this.nativeContext.font}set globalAlpha(t){this.nativeContext.globalAlpha=t*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(t){this.nativeContext.lineCap=t}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(t){this.nativeContext.lineDashOffset=t}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(t){this.nativeContext.lineJoin=t}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(t){this.nativeContext.lineWidth=t}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(t){this.nativeContext.miterLimit=t}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(t){this.nativeContext.shadowBlur=t}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(t){this.nativeContext.shadowColor=t}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(t){this.nativeContext.shadowOffsetX=t}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(t){this.nativeContext.shadowOffsetY=t}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(t){this.nativeContext.strokeStyle=t}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(t){this.nativeContext.textAlign=t}get textAlign(){return this.nativeContext.textAlign}set textBaseline(t){this.nativeContext.textBaseline=t}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(t){t!==!!this._inuse&&(this._inuse=t,t?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(t,e){this.fillAttributes=Object.assign(Object.assign({},qY),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},ZY),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},is),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("2d");this.nativeContext=i,this.canvas=t,this.matrix=new Pe(1,0,0,1,0,0),this.stack=[],this.dpr=e,this.applyedMatrix=new Pe(1,0,0,1,0,0),this._clearMatrix=new Pe(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&ge.getInstance().warn("bugmatrix"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Pe(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(t=!1){!t&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(t){return ns.allocateByObj(t)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(ns.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(ns.free(this.matrix),this.matrix=this.stack.pop())}rotate(t,e=!0){this.matrix.rotate(t),e&&this.setTransformForCurrent()}save(){const t=this.cloneMatrix(this.matrix);this.stack.push(t),this.nativeContext.save()}highPerformanceSave(){const t=this.cloneMatrix(this.matrix);this.stack.push(t)}scale(t,e,i=!0){this.matrix.scale(t,e),i&&this.setTransformForCurrent()}setScale(t,e,i=!0){this.matrix.setScale(t,e),i&&this.setTransformForCurrent()}scalePoint(t,e,i,r,s=!0){this.translate(i,r,!1),this.scale(t,e,!1),this.translate(-i,-r,!1),s&&this.setTransformForCurrent()}setTransform(t,e,i,r,s,o,a=!0,l=this.dpr){this.matrix.setValue(l*t,l*e,l*i,l*r,l*s,l*o),a&&this.setTransformForCurrent()}setTransformFromMatrix(t,e=!0,i=this.dpr){this.matrix.setValue(t.a*i,t.b*i,t.c*i,t.d*i,t.e*i,t.f*i),e&&this.setTransformForCurrent()}resetTransform(t=!0,e=this.dpr){this.setTransform(e,0,0,e,0,0),t&&this.setTransformForCurrent()}transform(t,e,i,r,s,o,a=!0){this.matrix.multiply(t,e,i,r,s,o),a&&this.setTransformForCurrent()}transformFromMatrix(t,e){this.matrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f),e&&this.setTransformForCurrent()}translate(t,e,i=!0){this.matrix.translate(t,e),i&&this.setTransformForCurrent()}rotateDegrees(t,e=!0){const i=t*Math.PI/180;this.rotate(i,e)}rotateAbout(t,e,i,r=!0){this.translate(e,i,!1),this.rotate(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}rotateDegreesAbout(t,e,i,r=!0){this.translate(e,i,!1),this.rotateDegrees(t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(t,e){t?typeof t=="string"?this.nativeContext.clip(t):this.nativeContext.clip(t,e):this.nativeContext.clip()}arc(t,e,i,r,s,o,a){if(a=a||0,this.camera){const l=[];Kpt(l,r,s,t,e,i,i,o);for(let h=0;h<l.length;++h){const d=l[h];this.bezierCurveTo(d[0],d[1],d[2],d[3],d[4],d[5],a)}}else this.nativeContext.arc(t,e,Math.max(0,i),r,s,o)}arcTo(t,e,i,r,s){this.nativeContext.arcTo(t,e,i,r,s)}bezierCurveTo(t,e,i,r,s,o,a){if(a=a||0,this.camera){let l=a,h=a;this.modelMatrix&&(Lo(ye,[t,e,a],this.modelMatrix),t=ye[0],e=ye[1],l=ye[2],Lo(ye,[i,r,a],this.modelMatrix),i=ye[0],r=ye[1],h=ye[2],Lo(ye,[s,o,a],this.modelMatrix),s=ye[0],o=ye[1],a=ye[2]);let d=this.camera.vp(s,o,a);s=d.x,o=d.y,d=this.camera.vp(t,e,l),t=d.x,e=d.y,d=this.camera.vp(i,r,h),i=d.x,r=d.y}this.nativeContext.bezierCurveTo(t,e,i,r,s,o)}closePath(){this.nativeContext.closePath()}ellipse(t,e,i,r,s,o,a,l){l==null?this.nativeContext.ellipse(t,e,i,r,s,o,a):this.nativeContext.ellipse(t,e,i,r,s,o,a,l)}lineTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Lo(ye,[t,e,i],this.modelMatrix),t=ye[0],e=ye[1],i=ye[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.lineTo(t,e)}moveTo(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Lo(ye,[t,e,i],this.modelMatrix),t=ye[0],e=ye[1],i=ye[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.moveTo(t,e)}quadraticCurveTo(t,e,i,r,s){if(s=s||0,this.camera){let o=s;this.modelMatrix&&(Lo(ye,[t,e,s],this.modelMatrix),t=ye[0],e=ye[1],o=ye[2],Lo(ye,[i,r,s],this.modelMatrix),i=ye[0],r=ye[1],s=ye[2]);let a=this.camera.vp(i,r,s);i=a.x,r=a.y,a=this.camera.vp(t,e,o),t=a.x,e=a.y}this.nativeContext.quadraticCurveTo(t,e,i,r)}rect(t,e,i,r,s){s=s||0,this.camera?(this.moveTo(t,e,s),this.lineTo(t+i,e,s),this.lineTo(t+i,e+r,s),this.lineTo(t,e+r,s),this.closePath()):this.nativeContext.rect(t,e,i,r)}createImageData(){const t=arguments;return t.length===2?this.nativeContext.createImageData(t[0],t[1]):t.length===1?this.nativeContext.createImageData(t[0]):null}createLinearGradient(t,e,i,r){return isFinite(t+e+i+r)||(t=0,e=0,i=0,r=0),this.nativeContext.createLinearGradient(t,e,i,r)}createPattern(t,e){return t.width===0||t.height===0?null:this.nativeContext.createPattern(t,e)}createRadialGradient(t,e,i,r,s,o){return this.nativeContext.createRadialGradient(t,e,i,r,s,o)}createConicGradient(t,e,i,r){if(this.nativeContext.createConicGradient&&Math.abs(r-i-2*Math.PI)<.001)return this.nativeContext.createConicGradient(i,t,e);let s,o=!1;const a=this;return{stops:[],addColorStop(l,h){this.stops.push([l,h]),o=!0},GetPattern(l,h,d){return o&&(d||(d=r-i),s=Vut(a,this.stops,t,e,d,i,r,l,h),o=!1),s}}}fill(t,e){this.disableFill||(t?this.nativeContext.fill(t):this.nativeContext.fill())}fillRect(t,e,i,r){this.nativeContext.fillRect(t,e,i,r)}clearRect(t,e,i,r){this.nativeContext.clearRect(t,e,i,r)}project(t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(Lo(ye,[t,e,i],this.modelMatrix),t=ye[0],e=ye[1],i=ye[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}return{x:t,y:e}}view(t,e,i){return i=i||0,this.camera?(this.modelMatrix&&(Lo(ye,[t,e,i],this.modelMatrix),t=ye[0],e=ye[1],i=ye[2]),this.camera.view(t,e,i)):[t,e,i]}fillText(t,e,i,r){if(r=r||0,this.camera){this.modelMatrix&&(Lo(ye,[e,i,r],this.modelMatrix),e=ye[0],i=ye[1],r=ye[2]);const s=this.camera.vp(e,i,r);e=s.x,i=s.y}this.nativeContext.fillText(t,e,i)}getImageData(t,e,i,r){return this.nativeContext.getImageData(t,e,i,r)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(t,e){return this.nativeContext.isPointInPath(t,e)}isPointInStroke(t,e){return this.nativeContext.isPointInStroke(t,e)}measureText(t,e=St.global.measureTextMethod){var i,r;if(!e||e==="native")return this.nativeContext.measureText(t);this.mathTextMeasure||(this.mathTextMeasure=St.graphicUtil.createTextMeasureInstance({},{},()=>this.canvas.nativeCanvas));const s=(i=this.fontFamily)!==null&&i!==void 0?i:is.fontFamily,o=(r=this.fontSize)!==null&&r!==void 0?r:is.fontSize;return this.mathTextMeasure.textSpec.fontFamily===s&&this.mathTextMeasure.textSpec.fontSize===o||(this.mathTextMeasure.textSpec.fontFamily=s,this.mathTextMeasure.textSpec.fontSize=o,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(t,e)}putImageData(t,e,i){this.nativeContext.putImageData(t,e,i)}setLineDash(t){const e=arguments,i=this.nativeContext;this.nativeContext.setLineDash?e[0]&&i.setLineDash(e[0]):"mozDash"in i?i.mozDash=e[0]:"webkitLineDash"in i&&(i.webkitLineDash=e[0])}stroke(t){this.disableStroke||(t?this.nativeContext.stroke(t):this.nativeContext.stroke())}strokeRect(t,e,i,r){this.nativeContext.strokeRect(t,e,i,r)}strokeText(t,e,i,r){if(r=r||0,this.camera){this.modelMatrix&&(Lo(ye,[e,i,r],this.modelMatrix),e=ye[0],i=ye[1],r=ye[2]);const s=this.camera.vp(e,i,r);e=s.x,i=s.y}this.nativeContext.strokeText(t,e,i)}drawImage(){const t=this.nativeContext,e=arguments;e.length===3?t.drawImage(e[0],e[1],e[2]):e.length===5?t.drawImage(e[0],e[1],e[2],e[3],e[4]):e.length===9&&t.drawImage(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}setCommonStyle(t,e,i,r,s){if(Array.isArray(s)){if(s.length<=1)return this._setCommonStyle(t,e,i,r,s[0]);const o=Object.create(s[0]);return s.forEach((a,l)=>{l!==0&&Object.assign(o,a)}),this._setCommonStyle(t,e,i,r,o)}return this._setCommonStyle(t,e,i,r,s)}_setCommonStyle(t,e,i,r,s){const o=this.nativeContext;s||(s=this.fillAttributes);const{fillOpacity:a=s.fillOpacity,opacity:l=s.opacity,fill:h=s.fill}=e;o.globalAlpha=a*l*this.baseGlobalAlpha,a>1e-12&&l>1e-12&&(o.fillStyle=lS(this,h,t,i,r))}setShadowBlendStyle(t,e,i){if(Array.isArray(i)){if(i.length<=1)return this._setShadowBlendStyle(t,i[0]);const r=Object.create(i[0]);return i.forEach((s,o)=>{o!==0&&Object.assign(r,s)}),this._setShadowBlendStyle(t,e,r)}return this._setShadowBlendStyle(t,e,i)}_setShadowBlendStyle(t,e,i){const r=this.nativeContext;i||(i=this.fillAttributes);const{opacity:s=i.opacity,shadowBlur:o=i.shadowBlur,shadowColor:a=i.shadowColor,shadowOffsetX:l=i.shadowOffsetX,shadowOffsetY:h=i.shadowOffsetY,blur:d=i.blur,filter:u=i.filter,globalCompositeOperation:c=i.globalCompositeOperation}=e;s<=1e-12||(o||l||h?(r.shadowBlur=o*this.dpr,r.shadowColor=a,r.shadowOffsetX=l*this.dpr,r.shadowOffsetY=h*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(r.shadowBlur=0,r.shadowOffsetX=0,r.shadowOffsetY=0),d?(r.filter=`blur(${d}px)`,this._clearFilterStyle=!0):u?(r.filter=u,this._clearFilterStyle=!0):this._clearFilterStyle&&(r.filter="blur(0px)",this._clearFilterStyle=!1),c?(r.globalCompositeOperation=c,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(r.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(t,e,i,r,s){if(Array.isArray(s)){if(s.length<=1)return this._setStrokeStyle(t,e,i,r,s[0]);const o=Object.create(s[0]);return s.forEach((a,l)=>{l!==0&&Object.assign(o,a)}),this._setStrokeStyle(t,e,i,r,o)}return this._setStrokeStyle(t,e,i,r,s)}_setStrokeStyle(t,e,i,r,s){const o=this.nativeContext;s||(s=this.strokeAttributes);const{strokeOpacity:a=s.strokeOpacity,opacity:l=s.opacity}=e;if(o.globalAlpha=a*l*this.baseGlobalAlpha,a>1e-12&&l>1e-12){const{lineWidth:h=s.lineWidth,stroke:d=s.stroke,lineJoin:u=s.lineJoin,lineDash:c=s.lineDash,lineDashOffset:g=s.lineDashOffset,lineCap:p=s.lineCap,miterLimit:f=s.miterLimit,keepStrokeScale:m=s.keepStrokeScale}=e;o.lineWidth=m?h:lh(this,h,this.dpr),o.strokeStyle=lS(this,d,t,i,r),o.lineJoin=u,c&&(o.setLineDash(c),o.lineDashOffset=g),o.lineCap=p,o.miterLimit=f}}setTextStyleWithoutAlignBaseline(t,e,i){const r=this.nativeContext;e||(e=this.textAttributes);const{scaleIn3d:s=e.scaleIn3d}=t;t.font?r.font=t.font:r.font=pc(t,e,s&&this.camera&&this.camera.getProjectionScale(i));const{fontFamily:o=e.fontFamily,fontSize:a=e.fontSize}=t;this.fontFamily=o,this.fontSize=a,r.textAlign="left",r.textBaseline="alphabetic"}setTextStyle(t,e,i){var r,s;const o=this.nativeContext;e||(e=this.textAttributes),t.font?o.font=t.font:o.font=pc(t,e,this.camera&&this.camera.getProjectionScale(i));const{fontFamily:a=e.fontFamily,fontSize:l=e.fontSize}=t;this.fontFamily=a,this.fontSize=l,o.textAlign=(r=t.textAlign)!==null&&r!==void 0?r:e.textAlign,o.textBaseline=(s=t.textBaseline)!==null&&s!==void 0?s:e.textBaseline}draw(){}clearMatrix(t=!0,e=this.dpr){this.setTransformFromMatrix(this._clearMatrix,t,e)}setClearMatrix(t,e,i,r,s,o){this._clearMatrix.setValue(t,e,i,r,s,o)}onlyTranslate(t=this.dpr){return this.matrix.a===t&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===t}release(...t){this.stack.forEach(e=>ns.free(e)),this.stack.length=0}};Sp.env="browser",Sp=Ypt([Bt(),Xpt("design:paramtypes",[Object,Number])],Sp);var qpt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Zpt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let xp=class extends UO{constructor(t){super(t)}init(t){const{container:e}=t;if(typeof e=="string"){const i=St.global.getElementById(e);i&&(this._container=i)}else this._container=e;this._context=new Sp(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:t}=this;t.width=this._pixelWidth,t.height=this._pixelHeight,!t.style||this.setCanvasStyle(t,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(t),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const t=this._nativeCanvas;t.style.position="absolute",t.style.top=`${this._y}px`,t.style.left=`${this._x}px`}resetStyle(t){if(!this.controled)return;const{width:e=this._displayWidth,height:i=this._displayHeight,dpr:r=this._dpr,x:s=this._x,y:o=this._y}=t,{nativeCanvas:a}=this;a.width=e*r,a.height=i*r,!a.style||this.setCanvasStyle(a,s,o,e,i),t.id&&(a.id=t.id),this.visiable||this.hide()}setCanvasStyle(t,e,i,r,s){this.controled&&(t.style.width=`${r}px`,t.style.height=`${s}px`)}toDataURL(t,e){return t==="image/jpeg"?this._nativeCanvas.toDataURL(t,e):t==="image/png"?this._nativeCanvas.toDataURL(t):this._nativeCanvas.toDataURL(t,e)}resize(t,e){this.controled&&(this._pixelWidth=t*this._dpr,this._pixelHeight=e*this._dpr,this._displayWidth=t,this._displayHeight=e,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${t}px`,this._nativeCanvas.style.height=`${e}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};xp.env="browser",xp=qpt([Bt(),Zpt("design:paramtypes",[Object])],xp);function iK(n,t){return new pe(e=>{e(nX).toDynamicValue(()=>i=>new n(i)).whenTargetNamed(n.env),e(Zht).toDynamicValue(()=>(i,r)=>new t(i,r)).whenTargetNamed(t.env)})}const Jpt=iK(xp,Sp);var Qpt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},tft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},iu=function(n,t){return function(e,i){t(e,i,n)}};let jg=class extends pE{constructor(t,e,i,r){super(i,r),this.contributions=t,this.drawContribution=e,this.pickItemInterceptorContributions=i,this.pickServiceInterceptorContributions=r,this.global.hooks.onSetEnv.tap("canvas-picker-service",(s,o,a)=>{this.configure(a,o)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(t=>{this.pickerMap.set(t.numberType,t)}),super._init()}configure(t,e){this.pickCanvas=Xu.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(t,e,i,r){if(t.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let h=0;h<this.InterceptorContributions.length;h++){const d=this.InterceptorContributions[h];if(d.beforePickItem){const u=d.beforePickItem(t,this,e,r,{parentMatrix:i});if(u)return u}}const s=this.pickerMap.get(t.numberType);if(!s)return null;const o=s.contains(t,e,r),a=o?t:null,l={graphic:a,params:o};if(a)return l;if(this.InterceptorContributions.length)for(let h=0;h<this.InterceptorContributions.length;h++){const d=this.InterceptorContributions[h];if(d.afterPickItem){const u=d.afterPickItem(t,this,e,r,{parentMatrix:i});if(u)return u}}return l}};jg=Qpt([Bt(),iu(0,xe(tn)),iu(0,Sn(hs)),iu(1,xe($O)),iu(2,xe(tn)),iu(2,Sn(zg)),iu(3,xe(tn)),iu(3,Sn(IS)),tft("design:paramtypes",[Object,Object,Object,Object])],jg);var eft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let mE=class{constructor(){this.type="group",this.numberType=IO}contains(t,e,i){return!1}};mE=eft([Bt()],mE);const GS=new pe((n,t,e,i)=>{GS.__vloaded||(GS.__vloaded=!0,n(jW).to(mE).inSingletonScope(),n(hs).toService(jW),nr(n,hs))});GS.__vloaded=!1;const ift=new pe((n,t,e,i)=>{e(jg)||n(jg).toSelf().inSingletonScope(),e(Cp)?i(Cp).toService(jg):n(Cp).toService(jg)});function nft(n){n.load(GS),n.load(ift)}var Hm,rft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},sft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let jh=Hm=class extends $S{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${Hm.idprefix}_${Hm.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=St.global,this.viewBox=new ie,this.modelMatrix=new Pe(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{console.error("IntersectionObserver")}}isElementVisible(n){const t=n.getBoundingClientRect(),e=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return!(t.right<0||t.bottom<0||t.left>e||t.top>i)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const n=new IntersectionObserver((t,e)=>{t.forEach(i=>{this._canvasIsIntersecting!==i.isIntersecting?(this._canvasIsIntersecting=i.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(i.isIntersecting)):this._canvasIsIntersecting=i.isIntersecting})});n&&n.observe(this.canvas.nativeCanvas)}createWindowByConfig(n){const t=this.global.createCanvas({width:n.width,height:n.height});let e;if(e=typeof n.container=="string"?this.global.getElementById(n.container):n.container?n.container:this.global.getRootElement(),!e)throw new Error("containerId");n.offscreen?e=null:e.appendChild(t);const i={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:t,container:e,id:Hm.GenerateCanvasId(),canvasControled:!0};this.canvas=new xp(i)}createWindowByCanvas(n){var t;let e;if(typeof n.canvas=="string"){if(e=this.global.getElementById(n.canvas),!e)throw new Error("canvasId canvasdom")}else e=n.canvas;if(!e)throw new Error("canvas");let i=n.width,r=n.height;if(i==null||r==null||!n.canvasControled){const o=e.getBoundingClientRect();i=o.width,r=o.height}let s=n.dpr;s==null&&(s=(t=e.getContext("2d").pixelRatio)!==null&&t!==void 0?t:e.width/i),this.canvas=new xp({width:i,height:r,dpr:s,nativeCanvas:e,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,t){this.canvas.resize(n,t)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(n,t,e){return this.canvas.nativeCanvas.addEventListener(n,t,e)}removeEventListener(n,t,e){return this.canvas.nativeCanvas.removeEventListener(n,t,e)}dispatchEvent(n){return this.canvas.nativeCanvas.dispatchEvent(n)}getStyle(){var n;return(n=this.canvas.nativeCanvas.style)!==null&&n!==void 0?n:{}}setStyle(n){this.canvas.nativeCanvas.style=n}getBoundingClientRect(){const n=this.canvas.nativeCanvas,t=this.getWH();return n.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:t.width,height:t.height,left:0,top:0,right:0,bottom:0}}clearViewBox(n){const t=this.viewBox,e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),n&&(e.fillStyle=n,e.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),e.nativeContext.restore()}isVisible(n){return this._canvasIsIntersecting}onVisibleChange(n){this._onVisibleChangeCb=n}getTopLeft(n){return this.global.getElementTopLeft(this.canvas.nativeCanvas,n)}};jh.env="browser",jh.idprefix="visactor_window",jh.prefix_count=0,jh=Hm=rft([Bt(),sft("design:paramtypes",[])],jh);const oft=new pe(n=>{n(jh).toSelf(),n(kO).toDynamicValue(t=>t.container.get(jh)).whenTargetNamed(jh.env)});var aft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},lft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},hft=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};let dft=class{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}};function $W(n,t=!1){const e=document.createElement("img");if(St.global.isImageAnonymous&&(e.crossOrigin="anonymous"),t){const i=new Blob([n],{type:"image/svg+xml"});n=window.URL.createObjectURL(i)}return e.src=n,e.complete?Promise.resolve(e):new Promise((i,r)=>{e.onload=()=>{i(e)},e.onerror=()=>{r(new Error(""))}})}let US=class extends NS{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(t,e){var i,r;let s=0,o=0,a=0,l=0;if(t.changedTouches){const h=(i=t.changedTouches[0])!==null&&i!==void 0?i:{};s=h.clientX||0,o=h.clientY||0,a=s,l=o}else s=t.clientX||0,o=t.clientY||0,a=t.offsetX||0,l=t.offsetY||0;if(e){const h=s,d=o,u=e.getBoundingClientRect(),c=(r=e.getNativeHandler)===null||r===void 0?void 0:r.call(e).nativeCanvas;let g,p;return c&&(g=u.width/c.offsetWidth,p=u.height/c.offsetHeight),{x:(h-u.left)/(et(g)?g:1),y:(d-u.top)/(et(p)?p:1)}}return{x:a,y:l}}getNativeAABBBounds(t){let e=t;if(typeof t=="string"&&(e=new DOMParser().parseFromString(t,"text/html").firstChild,e.lastChild&&(e=e.lastChild.firstChild)),e.getBoundingClientRect){const i=e.getBoundingClientRect();return new dft(i)}return new ie}removeDom(t){return t.parentElement.removeChild(t),!0}updateDom(t,e){const{width:i,height:r,style:s}=e;return s&&(yt(s)?t.setAttribute("style",s):Object.keys(s).forEach(o=>{t.style[o]=s[o]})),i!=null&&(t.style.width=`${i}px`),r!=null&&(t.style.height=`${r}px`),!0}createDom(t){const{tagName:e="div",parent:i}=t,r=document.createElement(e);if(this.updateDom(r,t),i){const s=yt(i)?this.getElementById(i):i;s&&s.appendChild&&s.appendChild(r)}return r}loadImage(t){return $W(t,!1).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadSvg(t){return $W(t,!0).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}createCanvas(t){var e,i;const r=document.createElement("canvas");t.id&&(r.id=(e=t.id)!==null&&e!==void 0?e:Nn.GenAutoIncrementId().toString());const s=(i=t.dpr)!==null&&i!==void 0?i:window.devicePixelRatio;return t.width&&t.height&&(r.style.width=`${t.width}px`,r.style.height=`${t.height}px`,r.width=t.width*s,r.height=t.height*s),r}createOffscreenCanvas(t){var e;const i=(e=t.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return new OffscreenCanvas(t.width*i,t.height*i)}releaseCanvas(t){let e;e=typeof t=="string"?document.getElementById(t):t,e&&e.parentElement&&e.parentElement.removeChild(e)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(t,e,i){return document.addEventListener(t,e,i)}removeEventListener(t,e,i){return document.removeEventListener(t,e,i)}dispatchEvent(t){return document.dispatchEvent(t)}getElementById(t){return document.getElementById(t)}getRootElement(){return document.body}getDocument(){return document}release(...t){}getElementTop(t,e){let i=t.offsetTop,r=t.offsetParent;for(;r!==null;)i+=r.offsetTop,r=r.offsetParent;return i}getElementLeft(t,e){let i=t.offsetLeft,r=t.offsetParent;for(;r!==null;)i+=r.offsetLeft,r=r.offsetParent;return i}getElementTopLeft(t,e){let i=t.offsetTop,r=t.offsetLeft,s=t.offsetParent;for(;s!==null;)i+=s.offsetTop,r+=s.offsetLeft,s=s.offsetParent;return{top:i,left:r}}loadFont(t,e,i){return hft(this,void 0,void 0,function*(){return new FontFace(t,yt(e)?`url(${e})`:e,i).load().then(function(r){return document.fonts.add(r),{loadState:"success"}}).catch(function(r){return console.error("Failed to load font:",r),{loadState:"fail"}})})}isMacOS(){if(this._isMacOS===void 0)try{this._isMacOS=navigator.platform.toUpperCase().indexOf("MAC")>=0}catch{this._isMacOS=!1}return this._isMacOS}copyToClipBoard(t){return navigator.clipboard.writeText(t).then(()=>{}).catch(e=>{})}};US=aft([Bt(),lft("design:paramtypes",[])],US);const YS=new pe(n=>{YS.isBrowserBound||(YS.isBrowserBound=!0,n(US).toSelf().inSingletonScope(),n(YA).toService(US))});YS.isBrowserBound=!1;function XS(n,t=!0){XS.__loaded||(XS.__loaded=!0,n.load(YS),n.load(Jpt),n.load(oft),t&&nft(n))}XS.__loaded=!1;let nl=class{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise"||!this.canvasRenderer)return!0;const{pickContext:r}=i??{};if(!r)return!1;const s=t.getGraphicTheme();r.highPerformanceSave();let{x:o=s.x,y:a=s.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const d=t.getOffsetXY(s);o+=d.x,a+=d.y,r.setTransformForCurrent()}else o=0,a=0,r.transformFromMatrix(t.transMatrix,!0);let l=!1,h=!1;return this.canvasRenderer.drawShape(t,r,o,a,{},null,(d,u,c,g)=>!(!l&&!h)||(l=d.isPointInPath(e.x,e.y),h=g||h,l),(d,u,c,g)=>{if(l||h)return!0;const p=u.lineWidth||c.lineWidth,f=u.pickStrokeBuffer||c.pickStrokeBuffer,m=u.keepStrokeScale||c.keepStrokeScale;return r.lineWidth=m?p+f:lh(r,p+f,r.dpr),l=d.isPointInStroke(e.x,e.y),h=g||h,l}),r.highPerformanceRestore(),l}};var uft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},cft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},gft=function(n,t){return function(e,i){t(e,i,n)}};let vE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=QA}};vE=uft([Bt(),gft(0,xe(MS)),cft("design:paramtypes",[Object])],vE);let VW=!1;const pft=new pe((n,t,e,i)=>{VW||(VW=!0,n(xW).to(vE).inSingletonScope(),n(Nd).toService(xW))});var fft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},mft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},vft=function(n,t){return function(e,i){t(e,i,n)}};let _E=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=tM}};_E=fft([Bt(),vft(0,xe(TS)),mft("design:paramtypes",[Object])],_E);let GW=!1;const _ft=new pe((n,t,e,i)=>{GW||(GW=!0,n(wW).to(_E).inSingletonScope(),n(Nd).toService(wW))});var bft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let tf=class{constructor(){this.type="image",this.numberType=eM}contains(t,e,i){const{pickContext:r}=i??{};return!!r&&!!t.AABBBounds.containsPoint(e)}};tf=bft([Bt()],tf);let UW=!1;const yft=new pe((n,t,e,i)=>{UW||(UW=!0,n(VS).to(tf).inSingletonScope(),n(tf).toService(VS))});var Cft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Sft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},xft=function(n,t){return function(e,i){t(e,i,n)}};let bE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=J0}};bE=Cft([Bt(),xft(0,xe(kS)),Sft("design:paramtypes",[Object])],bE);let YW=!1;const wft=new pe((n,t,e,i)=>{YW||(YW=!0,n(AW).to(bE).inSingletonScope(),n(Nd).toService(AW))});var Aft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Mft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Tft=function(n,t){return function(e,i){t(e,i,n)}};let yE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=nM}};yE=Aft([Bt(),Tft(0,xe(BS)),Mft("design:paramtypes",[Object])],yE);let XW=!1;const kft=new pe((n,t,e,i)=>{XW||(XW=!0,n(BW).to(yE).inSingletonScope(),n(Nd).toService(BW))});var Rft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Bft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Pft=function(n,t){return function(e,i){t(e,i,n)}};let CE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=iM}};CE=Rft([Bt(),Pft(0,xe(RS)),Bft("design:paramtypes",[Object])],CE);let KW=!1;const Eft=new pe((n,t,e,i)=>{KW||(KW=!0,n(MW).to(CE).inSingletonScope(),n(Nd).toService(MW))}),Rk=new ie;let nK=class{constructor(){this.type="rect",this.numberType=OO}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;const s=t.getGraphicTheme(),{cornerRadius:o=s.cornerRadius}=t.attribute;let{x:a=s.x,y:l=s.y}=t.attribute;r.highPerformanceSave();let h=!0;if(t.transMatrix.onlyTranslate()){const u=t.getOffsetXY(s);a+=u.x,l+=u.y,r.setTransformForCurrent()}else a=0,l=0,h=!1,r.transformFromMatrix(t.transMatrix,!0);let d=!0;if(!h||t.shadowRoot||J(o,!0)&&o!==0||V(o)&&o.some(u=>u!==0))d=!1,this.canvasRenderer.drawShape(t,r,a,l,{},null,(u,c,g)=>!!d||(d=u.isPointInPath(e.x,e.y),d),(u,c,g)=>{if(d)return!0;const p=c.lineWidth||g.lineWidth,f=c.pickStrokeBuffer||g.pickStrokeBuffer,m=c.keepStrokeScale||g.keepStrokeScale;return r.lineWidth=m?p+f:lh(r,p+f,r.dpr),d=u.isPointInStroke(e.x,e.y),d});else{const{fill:u=s.fill,stroke:c=s.stroke,lineWidth:g=s.lineWidth}=t.attribute;if(u)d=!0;else if(c){const p=t.AABBBounds;Rk.setValue(p.x1,p.y1,p.x2,p.y2),Rk.expand(-g/2),d=!Rk.containsPoint(e)}}return r.highPerformanceRestore(),d}};var Lft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Ift=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Oft=function(n,t){return function(e,i){t(e,i,n)}};let SE=class extends nK{constructor(t){super(),this.canvasRenderer=t}};SE=Lft([Bt(),Oft(0,xe(PS)),Ift("design:paramtypes",[Object])],SE);let qW=!1;const Dft=new pe((n,t,e,i)=>{qW||(qW=!0,n(TW).to(SE).inSingletonScope(),n(Nd).toService(TW))});let ZW=!1;const Fft=new pe((n,t,e,i)=>{ZW||(ZW=!0,n(VS).to(tf).inSingletonScope(),n(tf).toService(VS))});var Hft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},zft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Wft=function(n,t){return function(e,i){t(e,i,n)}};let xE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=rM}};xE=Hft([Bt(),Wft(0,xe(ES)),zft("design:paramtypes",[Object])],xE);let JW=!1;const jft=new pe((n,t,e,i)=>{JW||(JW=!0,n(kW).to(xE).inSingletonScope(),n(Nd).toService(kW))});var Nft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let wE=class{constructor(){this.type="text",this.numberType=sM}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};wE=Nft([Bt()],wE);let QW=!1;const $ft=new pe((n,t,e,i)=>{QW||(QW=!0,n(RW).to(wE).inSingletonScope(),n(Nd).toService(RW))});var Vft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Gft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let uv=class extends Sp{constructor(t,e){super(t,e);const i=t.nativeCanvas.getContext("2d");if(!i)throw new Error("2d");this.nativeContext=i,this.canvas=t,this.matrix=new Pe(1,0,0,1,0,0),this.stack=[],this.dpr=e??1}release(...t){}};uv.env="node",uv=Vft([Bt(),Gft("design:paramtypes",[Object,Number])],uv);var Uft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Yft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let wp=class extends UO{constructor(t){super(t)}init(){this._context=new uv(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...t){this._nativeCanvas.release&&it(this._nativeCanvas.release)&&this._nativeCanvas.release()}};wp.env="node",wp=Uft([Bt(),Yft("design:paramtypes",[Object])],wp);const Xft=iK(wp,uv);var Kft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},qft=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Zft=function(n,t){return function(e,i){t(e,i,n)}};let Ap=class extends $S{get container(){return null}constructor(t){super(),this.global=t,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(t){t.canvas?this.createWindowByCanvas(t):this.createWindowByConfig(t)}createWindowByConfig(t){const e=this.global.createCanvas({width:t.width,height:t.height}),i={width:t.width,height:t.height,dpr:t.dpr,nativeCanvas:e,id:Nn.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new wp(i)}createWindowByCanvas(t){var e;const i=t.canvas,r=(e=t.dpr)!==null&&e!==void 0?e:1;let s=t.width,o=t.height;s!=null&&o!=null&&t.canvasControled||(s=i.width/r,o=i.height/r),this.canvas=new wp({width:s,height:o,dpr:r,nativeCanvas:i,canvasControled:t.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(t,e){this.canvas.resize(t,e)}setDpr(t){this.canvas.dpr=t}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(t="image/png"){return this.canvas.nativeCanvas.toBuffer(t)}addEventListener(t,e,i){}dispatchEvent(t){return!0}removeEventListener(t,e,i){}getStyle(){}setStyle(t){}getBoundingClientRect(){return null}clearViewBox(t){}};Ap.env="node",Ap=Kft([Bt(),Zft(0,xe(pO)),qft("design:paramtypes",[Object])],Ap);const Jft=new pe(n=>{n(Ap).toSelf(),n(kO).toDynamicValue(t=>t.container.get(Ap)).whenTargetNamed(Ap.env)});var Qft=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let KS=class extends NS{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(t,e){t.env===this.type&&(t.setActiveEnvContribution(this),this.pkg=e)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(t){const e=fetch(t).then(i=>i.json());return e.then(i=>({data:i,state:"success"})).catch(()=>({data:null,state:"fail"})),e}loadArrayBuffer(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>({data:e,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadImage(t){const{loadImage:e}=this.pkg;return e?e(t).then(i=>({loadState:i?"success":"fail",data:i})).catch(()=>({loadState:"fail",data:null})):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(t){const e=this.pkg.Resvg;if(!e)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const i=new e(t).render().asPng();return this.loadImage(i)}createCanvas(t){return this.pkg.createCanvas(t.width,t.height)}releaseCanvas(t){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(t){return Qz.call(t)}}getCancelAnimationFrame(){return t=>{Qz.clear(t)}}addEventListener(t,e,i){}removeEventListener(t,e,i){}getElementById(t){return null}getRootElement(){return null}dispatchEvent(t){}release(...t){}createOffscreenCanvas(t){}};KS=Qft([Bt()],KS);const qS=new pe(n=>{qS.isNodeBound||(qS.isNodeBound=!0,n(KS).toSelf().inSingletonScope(),n(YA).toService(KS))});qS.isNodeBound=!1;function ZS(n,t=!0){ZS.__loaded||(ZS.__loaded=!0,n.load(qS),n.load(Xft),n.load(Jft))}ZS.__loaded=!1;var tmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},emt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},imt=function(n,t){return function(e,i){t(e,i,n)}};let AE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="arc",this.numberType=QA}};AE=tmt([Bt(),imt(0,xe(MS)),emt("design:paramtypes",[Object])],AE);let tj=!1;const nmt=new pe((n,t,e,i)=>{tj||(tj=!0,n(PW).to(AE).inSingletonScope(),n(hs).toService(PW))});var rmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},smt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},omt=function(n,t){return function(e,i){t(e,i,n)}};let ME=class extends nK{constructor(t){super(),this.canvasRenderer=t}};ME=rmt([Bt(),omt(0,xe(PS)),smt("design:paramtypes",[Object])],ME);let ej=!1;const amt=new pe((n,t,e,i)=>{ej||(ej=!0,n(DW).to(ME).inSingletonScope(),n(hs).toService(DW))});let rK=class extends cs{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;r.highPerformanceSave();const s=t.getGraphicTheme(),o=this.transform(t,s,r),{x:a,y:l,z:h,lastModelMatrix:d}=o;let u=e;if(r.camera){u=e.clone();const g=t.parent.globalTransMatrix;u.x=g.a*e.x+g.c*e.y+g.e,u.y=g.b*e.x+g.d*e.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(t,r,a,l,{},null,g=>!!c||(c=g.isPointInPath(u.x,u.y),c),(g,p,f)=>{if(c)return!0;const m=p.lineWidth||f.lineWidth,v=p.pickStrokeBuffer||f.pickStrokeBuffer,_=p.keepStrokeScale||f.keepStrokeScale;return r.lineWidth=_?m+v:lh(r,m+v,r.dpr),c=g.isPointInStroke(u.x,u.y),c}),this.canvasRenderer.z=0,r.modelMatrix!==d&&yn.free(r.modelMatrix),r.modelMatrix=d,r.highPerformanceRestore(),c}};var lmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},hmt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},dmt=function(n,t){return function(e,i){t(e,i,n)}};let TE=class extends rK{constructor(t){super(),this.canvasRenderer=t,this.type="line",this.numberType=J0}};TE=lmt([Bt(),dmt(0,xe(kS)),hmt("design:paramtypes",[Object])],TE);let ij=!1;const umt=new pe((n,t,e,i)=>{ij||(ij=!0,n(IW).to(TE).inSingletonScope(),n(hs).toService(IW))});let sK=class extends cs{contains(t,e,i){const{pickContext:r}=i??{};if(!r)return!1;const s=t.getGraphicTheme();r.highPerformanceSave();const o=this.transform(t,s,r),{x:a,y:l,z:h,lastModelMatrix:d}=o;let u=e;if(r.camera){u=e.clone();const g=t.parent.globalTransMatrix;u.x=g.a*e.x+g.c*e.y+g.e,u.y=g.b*e.x+g.d*e.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(t,r,a,l,i,null,(g,p,f)=>!!c||(c=g.isPointInPath(u.x,u.y),c)),this.canvasRenderer.z=0,r.modelMatrix!==d&&yn.free(r.modelMatrix),r.modelMatrix=d,r.highPerformanceRestore(),c}};var cmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},gmt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},pmt=function(n,t){return function(e,i){t(e,i,n)}};let kE=class extends sK{constructor(t){super(),this.canvasRenderer=t,this.type="symbol",this.numberType=rM}contains(t,e,i){const{pickContext:r}=i??{};if(!r)return!1;const s=t.getParsedPath();if(!r.camera){if(!t.AABBBounds.containsPoint(e))return!1;if(s.isSvg||t.attribute.pickMode==="imprecise")return!0}r.highPerformanceSave();const o=t.getGraphicTheme(),a=this.transform(t,o,r),{x:l,y:h,z:d,lastModelMatrix:u}=a;let c=e;if(r.camera){c=e.clone();const p=t.parent.globalTransMatrix;c.x=p.a*e.x+p.c*e.y+p.e,c.y=p.b*e.x+p.d*e.y+p.f}this.canvasRenderer.z=d;let g=!1;return this.canvasRenderer.drawShape(t,r,l,h,{},null,(p,f,m)=>!!g||(g=p.isPointInPath(c.x,c.y),g),(p,f,m)=>{if(g)return!0;const v=f.lineWidth||m.lineWidth,_=f.pickStrokeBuffer||m.pickStrokeBuffer,b=f.keepStrokeScale||m.keepStrokeScale;return r.lineWidth=b?v+_:lh(r,v+_,r.dpr),g=p.isPointInStroke(c.x,c.y),g}),this.canvasRenderer.z=0,r.modelMatrix!==u&&yn.free(r.modelMatrix),r.modelMatrix=u,r.highPerformanceRestore(),g}};kE=cmt([Bt(),pmt(0,xe(ES)),gmt("design:paramtypes",[Object])],kE);let nj=!1;const fmt=new pe((n,t,e,i)=>{nj||(nj=!0,n(FW).to(kE).inSingletonScope(),n(hs).toService(FW))});var mmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},vmt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},_mt=function(n,t){return function(e,i){t(e,i,n)}};let RE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="circle",this.numberType=tM}};RE=mmt([Bt(),_mt(0,xe(TS)),vmt("design:paramtypes",[Object])],RE);let rj=!1;const bmt=new pe((n,t,e,i)=>{rj||(rj=!0,n(EW).to(RE).inSingletonScope(),n(hs).toService(EW))});var ymt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Cmt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Smt=function(n,t){return function(e,i){t(e,i,n)}};let BE=class extends sK{constructor(t){super(),this.canvasRenderer=t,this.type="text",this.numberType=sM}contains(t,e,i){const{pickContext:r}=i??{};if(!r)return!1;const s=t.AABBBounds;if(!r.camera)return!!s.containsPoint(e);r.highPerformanceSave();const o=t.getGraphicTheme(),{keepDirIn3d:a=o.keepDirIn3d}=t.attribute,l=!a,h=this.transform(t,o,r,l),{x:d,y:u,z:c,lastModelMatrix:g}=h;this.canvasRenderer.z=c;let p=e;if(r.camera){p=e.clone();const m=t.parent.globalTransMatrix;p.x=m.a*e.x+m.c*e.y+m.e,p.y=m.b*e.x+m.d*e.y+m.f}let f=!1;return this.canvasRenderer.drawShape(t,r,d,u,{},null,(m,v,_)=>{if(f)return!0;const{fontSize:b=o.fontSize,textBaseline:y=o.textBaseline,textAlign:C=o.textAlign}=t.attribute,S=t.AABBBounds,w=S.height(),x=S.width(),A=O_(y,w,b),M=qp(C,x);return m.rect(M+d,A+u,x,w,c),f=m.isPointInPath(p.x,p.y),f},(m,v,_)=>f),this.canvasRenderer.z=0,r.modelMatrix!==g&&yn.free(r.modelMatrix),r.modelMatrix=g,r.highPerformanceRestore(),f}};BE=ymt([Bt(),Smt(0,xe(oE)),Cmt("design:paramtypes",[Object])],BE);let sj=!1;const xmt=new pe((n,t,e,i)=>{sj||(sj=!0,n(HW).to(BE).inSingletonScope(),n(hs).toService(HW))});var wmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Amt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Mmt=function(n,t){return function(e,i){t(e,i,n)}};let PE=class extends rK{constructor(t){super(),this.canvasRenderer=t,this.type="path",this.numberType=iM}};PE=wmt([Bt(),Mmt(0,xe(RS)),Amt("design:paramtypes",[Object])],PE);let oj=!1;const Tmt=new pe((n,t,e,i)=>{oj||(oj=!0,n(OW).to(PE).inSingletonScope(),n(hs).toService(OW))});var kmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Rmt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Bmt=function(n,t){return function(e,i){t(e,i,n)}};let EE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="polygon",this.numberType=nM}};EE=kmt([Bt(),Bmt(0,xe(BS)),Rmt("design:paramtypes",[Object])],EE);let aj=!1;const Pmt=new pe((n,t,e,i)=>{aj||(aj=!0,n(zW).to(EE).inSingletonScope(),n(hs).toService(zW))});var Emt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Lmt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Imt=function(n,t){return function(e,i){t(e,i,n)}};let LE=class{constructor(t){this.canvasRenderer=t,this.type="richtext",this.numberType=DO}contains(t,e,i){return!!t.AABBBounds.containsPoint(e)}};LE=Emt([Bt(),Imt(0,xe(aE)),Lmt("design:paramtypes",[Object])],LE);let lj=!1;const Omt=new pe((n,t,e,i)=>{lj||(lj=!0,n(WW).to(LE).inSingletonScope(),n(hs).toService(WW))});var Dmt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Fmt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Hmt=function(n,t){return function(e,i){t(e,i,n)}};let IE=class extends nl{constructor(t){super(),this.canvasRenderer=t,this.type="image",this.numberType=eM}};IE=Dmt([Bt(),Hmt(0,xe(lE)),Fmt("design:paramtypes",[Object])],IE);let hj=!1;const zmt=new pe((n,t,e,i)=>{hj||(hj=!0,n(LW).to(IE).inSingletonScope(),n(hs).toService(LW))});var gl={},Bk={},pl={},dj;function oK(){if(dj)return pl;dj=1,Object.defineProperty(pl,"__esModule",{value:!0}),pl.loop=pl.conditional=pl.parse=void 0;var n=function i(r,s){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:o;if(Array.isArray(s))s.forEach(function(h){return i(r,h,o,a)});else if(typeof s=="function")s(r,o,a,i);else{var l=Object.keys(s)[0];Array.isArray(s[l])?(a[l]={},i(r,s[l],o,a[l])):a[l]=s[l](r,o,a,i)}return o};pl.parse=n;var t=function(r,s){return function(o,a,l,h){s(o,a,l)&&h(o,r,a,l)}};pl.conditional=t;var e=function(r,s){return function(o,a,l,h){for(var d=[],u=o.pos;s(o,a,l);){var c={};if(h(o,r,a,c),o.pos===u)break;u=o.pos,d.push(c)}return d}};return pl.loop=e,pl}var mn={},uj;function aK(){if(uj)return mn;uj=1,Object.defineProperty(mn,"__esModule",{value:!0}),mn.readBits=mn.readArray=mn.readUnsigned=mn.readString=mn.peekBytes=mn.readBytes=mn.peekByte=mn.readByte=mn.buildStream=void 0;var n=function(u){return{data:u,pos:0}};mn.buildStream=n;var t=function(){return function(u){return u.data[u.pos++]}};mn.readByte=t;var e=function(){var u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(c){return c.data[c.pos+u]}};mn.peekByte=e;var i=function(u){return function(c){return c.data.subarray(c.pos,c.pos+=u)}};mn.readBytes=i;var r=function(u){return function(c){return c.data.subarray(c.pos,c.pos+u)}};mn.peekBytes=r;var s=function(u){return function(c){return Array.from(i(u)(c)).map(function(g){return String.fromCharCode(g)}).join("")}};mn.readString=s;var o=function(u){return function(c){var g=i(2)(c);return u?(g[1]<<8)+g[0]:(g[0]<<8)+g[1]}};mn.readUnsigned=o;var a=function(u,c){return function(g,p,f){for(var m=typeof c=="function"?c(g,p,f):c,v=i(u),_=new Array(m),b=0;b<m;b++)_[b]=v(g);return _}};mn.readArray=a;var l=function(u,c,g){for(var p=0,f=0;f<g;f++)p+=u[c+f]&&Math.pow(2,g-f-1);return p},h=function(u){return function(c){for(var g=t()(c),p=new Array(8),f=0;f<8;f++)p[7-f]=!!(g&1<<f);return Object.keys(u).reduce(function(m,v){var _=u[v];return _.length?m[v]=l(p,_.index,_.length):m[v]=p[_.index],m},{})}};return mn.readBits=h,mn}var cj;function Wmt(){return cj||(cj=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var t=oK(),e=aK(),i={blocks:function(c){for(var g=0,p=[],f=c.data.length,m=0,v=(0,e.readByte)()(c);v!==g&&v;v=(0,e.readByte)()(c)){if(c.pos+v>=f){var _=f-c.pos;p.push((0,e.readBytes)(_)(c)),m+=_;break}p.push((0,e.readBytes)(v)(c)),m+=v}for(var b=new Uint8Array(m),y=0,C=0;C<p.length;C++)b.set(p[C],y),y+=p[C].length;return b}},r=(0,t.conditional)({gce:[{codes:(0,e.readBytes)(2)},{byteSize:(0,e.readByte)()},{extras:(0,e.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,e.readUnsigned)(!0)},{transparentColorIndex:(0,e.readByte)()},{terminator:(0,e.readByte)()}]},function(u){var c=(0,e.peekBytes)(2)(u);return c[0]===33&&c[1]===249}),s=(0,t.conditional)({image:[{code:(0,e.readByte)()},{descriptor:[{left:(0,e.readUnsigned)(!0)},{top:(0,e.readUnsigned)(!0)},{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{lct:(0,e.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,t.conditional)({lct:(0,e.readArray)(3,function(u,c,g){return Math.pow(2,g.descriptor.lct.size+1)})},function(u,c,g){return g.descriptor.lct.exists}),{data:[{minCodeSize:(0,e.readByte)()},i]}]},function(u){return(0,e.peekByte)()(u)===44}),o=(0,t.conditional)({text:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{preData:function(c,g,p){return(0,e.readBytes)(p.text.blockSize)(c)}},i]},function(u){var c=(0,e.peekBytes)(2)(u);return c[0]===33&&c[1]===1}),a=(0,t.conditional)({application:[{codes:(0,e.readBytes)(2)},{blockSize:(0,e.readByte)()},{id:function(c,g,p){return(0,e.readString)(p.blockSize)(c)}},i]},function(u){var c=(0,e.peekBytes)(2)(u);return c[0]===33&&c[1]===255}),l=(0,t.conditional)({comment:[{codes:(0,e.readBytes)(2)},i]},function(u){var c=(0,e.peekBytes)(2)(u);return c[0]===33&&c[1]===254}),h=[{header:[{signature:(0,e.readString)(3)},{version:(0,e.readString)(3)}]},{lsd:[{width:(0,e.readUnsigned)(!0)},{height:(0,e.readUnsigned)(!0)},{gct:(0,e.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,e.readByte)()},{pixelAspectRatio:(0,e.readByte)()}]},(0,t.conditional)({gct:(0,e.readArray)(3,function(u,c){return Math.pow(2,c.lsd.gct.size+1)})},function(u,c){return c.lsd.gct.exists}),{frames:(0,t.loop)([r,a,l,s,o],function(u){var c=(0,e.peekByte)()(u);return c===33||c===44})}],d=h;n.default=d}(Bk)),Bk}var lm={},gj;function jmt(){if(gj)return lm;gj=1,Object.defineProperty(lm,"__esModule",{value:!0}),lm.deinterlace=void 0;var n=function(e,i){for(var r=new Array(e.length),s=e.length/i,o=function(g,p){var f=e.slice(p*i,(p+1)*i);r.splice.apply(r,[g*i,i].concat(f))},a=[0,4,2,1],l=[8,8,4,2],h=0,d=0;d<4;d++)for(var u=a[d];u<s;u+=l[d])o(u,h),h++;return r};return lm.deinterlace=n,lm}var hm={},pj;function Nmt(){if(pj)return hm;pj=1,Object.defineProperty(hm,"__esModule",{value:!0}),hm.lzw=void 0;var n=function(e,i,r){var s=4096,o=-1,a=r,l,h,d,u,c,g,p,w,f,m,S,v,x,A,T,M,_=new Array(r),b=new Array(s),y=new Array(s),C=new Array(s+1);for(v=e,h=1<<v,c=h+1,l=h+2,p=o,u=v+1,d=(1<<u)-1,f=0;f<h;f++)b[f]=0,y[f]=f;var S,w,x,A,M,T;for(S=w=x=A=M=T=0,m=0;m<a;){if(A===0){if(w<u){S+=i[T]<<w,w+=8,T++;continue}if(f=S&d,S>>=u,w-=u,f>l||f==c)break;if(f==h){u=v+1,d=(1<<u)-1,l=h+2,p=o;continue}if(p==o){C[A++]=y[f],p=f,x=f;continue}for(g=f,f==l&&(C[A++]=x,f=p);f>h;)C[A++]=y[f],f=b[f];x=y[f]&255,C[A++]=x,l<s&&(b[l]=p,y[l]=x,l++,(l&d)===0&&l<s&&(u++,d+=l)),p=g}A--,_[M++]=C[A],m++}for(m=M;m<a;m++)_[m]=0;return _};return hm.lzw=n,hm}var fj;function $mt(){if(fj)return gl;fj=1,Object.defineProperty(gl,"__esModule",{value:!0}),gl.decompressFrames=gl.decompressFrame=gl.parseGIF=void 0;var n=s(Wmt()),t=oK(),e=aK(),i=jmt(),r=Nmt();function s(d){return d&&d.__esModule?d:{default:d}}var o=function(u){var c=new Uint8Array(u);return(0,t.parse)((0,e.buildStream)(c),n.default)};gl.parseGIF=o;var a=function(u){for(var c=u.pixels.length,g=new Uint8ClampedArray(c*4),p=0;p<c;p++){var f=p*4,m=u.pixels[p],v=u.colorTable[m]||[0,0,0];g[f]=v[0],g[f+1]=v[1],g[f+2]=v[2],g[f+3]=m!==u.transparentIndex?255:0}return g},l=function(u,c,g){if(!u.image){console.warn("gif frame does not have associated image.");return}var p=u.image,f=p.descriptor.width*p.descriptor.height,m=(0,r.lzw)(p.data.minCodeSize,p.data.blocks,f);p.descriptor.lct.interlaced&&(m=(0,i.deinterlace)(m,p.descriptor.width));var v={pixels:m,dims:{top:u.image.descriptor.top,left:u.image.descriptor.left,width:u.image.descriptor.width,height:u.image.descriptor.height}};return p.descriptor.lct&&p.descriptor.lct.exists?v.colorTable=p.lct:v.colorTable=c,u.gce&&(v.delay=(u.gce.delay||10)*10,v.disposalType=u.gce.extras.disposal,u.gce.extras.transparentColorGiven&&(v.transparentIndex=u.gce.transparentColorIndex)),g&&(v.patch=a(v)),v};gl.decompressFrame=l;var h=function(u,c){return u.frames.filter(function(g){return g.image}).map(function(g){return l(g,u.gct,c)})};return gl.decompressFrames=h,gl}var mj=$mt();const rl=GO();function JS(){JS.__loaded||(JS.__loaded=!0,Rpt(),he.load(vpt),he.load(rl?nmt:pft))}JS.__loaded=!1;const Vmt=JS;function QS(){QS.__loaded||(QS.__loaded=!0,Bpt(),he.load(Cpt),he.load(rl?bmt:_ft))}QS.__loaded=!1;const lK=QS;function tx(){tx.__loaded||(tx.__loaded=!0,Ppt())}tx.__loaded=!1;const gs=tx;function ex(){ex.__loaded||(ex.__loaded=!0,Ept(),he.load(kpt),he.load(rl?zmt:yft))}ex.__loaded=!1;const dM=ex;function ix(){ix.__loaded||(ix.__loaded=!0,Lpt(),he.load(bpt),he.load(rl?umt:wft))}ix.__loaded=!1;const YO=ix;function nx(){nx.__loaded||(nx.__loaded=!0,Ipt(),he.load(xpt),he.load(rl?Tmt:Eft))}nx.__loaded=!1;const Gmt=nx;function rx(){rx.__loaded||(rx.__loaded=!0,Opt(),he.load(wpt),he.load(rl?Pmt:kft))}rx.__loaded=!1;const Umt=rx;function sx(){sx.__loaded||(sx.__loaded=!0,Dpt(),he.load(_pt),he.load(rl?amt:Dft))}sx.__loaded=!1;const hh=sx;function ox(){ox.__loaded||(ox.__loaded=!0,Fpt(),he.load(Tpt),he.load(rl?Omt:Fft))}ox.__loaded=!1;const uM=ox;function ax(){ax.__loaded||(ax.__loaded=!0,Wpt())}ax.__loaded=!1;const Ymt=ax;function lx(){lx.__loaded||(lx.__loaded=!0,Hpt(),he.load(ypt),he.load(rl?fmt:jft))}lx.__loaded=!1;const Df=lx;function hx(){hx.__loaded||(hx.__loaded=!0,zpt(),he.load(Spt),he.load(rl?xmt:$ft))}hx.__loaded=!1;const sl=hx;function dx(){dx.__loaded||(dx.__loaded=!0,jpt())}dx.__loaded=!1;const Xmt=dx;function hK(){gs(),hh()}const dK="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",Kmt=14;var Or;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(Or||(Or={}));const sg={[Or.selectedReverse]:{},[Or.selected]:{},[Or.hover]:{},[Or.hoverReverse]:{}},vj={container:"",width:30,height:30,style:{}},qmt="scrollDown",Zmt="scrollDrag",Jmt="scrollUp";function cv(){return oi.env==="browser"?["pointerup","pointerleave","pointercancel"]:["pointerup","pointerleave","pointerupoutside"]}const _j={debounce:ah,throttle:ha};hK();let W_=class uK extends Gs{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},uK.defaultAttributes,t)),this.name="scrollbar",this._handleTouchMove=i=>{L(this._prePos)&&i.preventDefault()},this._onRailPointerDown=i=>{const{viewX:r,viewY:s}=i,{direction:o,width:a,height:l,range:h}=this.attribute,d=this._sliderSize,[u,c]=this._getScrollRange();let g;if(o==="vertical"){const p=s-this._viewPosition.y,f=Ne(p-d/2,u,c);g=p/l,this._slider.setAttribute("y",f,!0)}else{const p=r-this._viewPosition.x,f=Ne(p-d/2,u,c);g=p/a,this._slider.setAttribute("x",f,!0)}this.setScrollRange([g-(h[1]-h[0])/2,g+(h[1]-h[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=i=>{this._clearDragEvents();const{stopSliderDownPropagation:r=!0}=this.attribute;r&&i.stopPropagation();const{direction:s}=this.attribute,{x:o,y:a}=this.stage.eventPointTransform(i);this._prePos=s==="horizontal"?o:a,this._dispatchEvent(qmt,{pos:this._prePos,event:i});const l=cv(),h=oi.env==="browser"?oi:this.stage;h.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),l.forEach(d=>{h.addEventListener(d,this._onSliderPointerUp)})},this._computeScrollValue=i=>{const{direction:r}=this.attribute,{x:s,y:o}=this.stage.eventPointTransform(i);let a,l,h=0;const{width:d,height:u}=this.getSliderRenderBounds();return r==="vertical"?(l=o,h=l-this._prePos,a=h/u):(l=s,h=l-this._prePos,a=h/d),[l,a]},this._onSliderPointerMove=i=>{const{stopSliderMovePropagation:r=!0}=this.attribute;r&&i.stopPropagation();const s=this.getScrollRange(),[o,a]=this._computeScrollValue(i);this.setScrollRange([s[0]+a,s[1]+a],!0),this._prePos=o},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:_j[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=i=>{const{range:r,limitRange:s=[0,1]}=this.attribute,o=this.getScrollRange(),[a,l]=this._computeScrollValue(i),h=[o[0]+l,o[1]+l];this._prePos=null,this._dispatchEvent(Jmt,{pre:r,value:ts(h,s[0],s[1])}),this._clearDragEvents()}}setScrollRange(t,e=!0){const{direction:i="horizontal",limitRange:r=[0,1],range:s,realTime:o=!0}=this.attribute,a=ts(t,r[0],r[1]);if(e){const l=this._getSliderPos(a);if(this._slider){const h=l[1]-l[0];this._sliderSize=h,i==="horizontal"?this._slider.setAttributes({x:l[0],width:h},!0):this._slider.setAttributes({y:l[0],height:h},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=a,o&&this._dispatchEvent(Zmt,{pre:s,value:a})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",_j[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown),(oi.env==="browser"?oi:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1})}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:r,limitRange:s=[0,1],railStyle:o,sliderStyle:a,padding:l=2}=this.attribute,h=this.createOrUpdateChild("scrollbar-container",{},"group"),d=h.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},o),"rect");this._rail=d;const u=this.getSliderRenderBounds(),c=this._getSliderPos(ts(r,s[0],s[1])),g=c[1]-c[0];let p;this._sliderSize=g,p=t==="horizontal"?{x:c[0],y:u.y1,width:g,height:u.height}:{x:u.x1,y:c[0],width:u.width,height:g};const f=h.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},p),{cornerRadius:this._getDefaultSliderCornerRadius()}),a),{boundsPadding:Fi(l),pickMode:"imprecise"}),"rect");this._slider=f,this._container=h;const m=this._container.AABBBounds;this._viewPosition={x:m.x1,y:m.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[r,s,o,a]=Fi(i),l={x1:a,y1:r,x2:t-s,y2:e-o,width:Math.max(0,t-(a+s)),height:Math.max(0,e-(r+o))};return this._sliderRenderBounds=l,l}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:i,height:r}=this.getSliderRenderBounds();return t==="horizontal"?r:i}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:r,x1:s,y1:o}=this.getSliderRenderBounds();return e==="horizontal"?[i*t[0]+s,i*t[1]+s]:[r*t[0]+o,r*t[1]+o]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,r]=ts(t,0,1),{width:s,height:o,x1:a,y1:l}=this.getSliderRenderBounds(),h=this._sliderSize;return e==="horizontal"?ts([a+i*s,a+r*s],a,s-h):ts([l+i*o,l+r*o],l,o-h)}_clearDragEvents(){const t=cv(),e=oi.env==="browser"?oi:this.stage;e.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),t.forEach(i=>{e.removeEventListener(i,this._onSliderPointerUp)})}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}release(t){super.release(t),(oi.env==="browser"?oi:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearDragEvents()}};W_.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};function ef(n,t){n.forEachChildren(e=>{const i=t(e);e.isContainer&&!i&&ef(e,t)})}function cK(n,t){return[n[0]*t,n[1]*t]}function gK(n){const[t,e]=n;return Math.sqrt(t*t+e*e)}function Qmt(n){let t=gK(n);return t>0&&(t=1/t),[n[0]*t,n[1]*t]}function tvt(n,t){const[e,i]=n,[r,s]=t,o=Math.sqrt((e*e+i*i)*(r*r+s*s)),a=o&&(e*r+i*s)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function evt(n,t,e){const i=tvt(n,t),r=QC(n,t)>=0;return e?r?2*Math.PI-i:i:r?i:2*Math.PI-i}const pK=(n,t,e,i)=>new Wi(Object.assign({defaultFontParams:Object.assign({fontFamily:dK,fontSize:Kmt},i),getTextBounds:aM,specialCharSet:`-/: .,@%'"~`+Wi.ALPHABET_CHAR_SET+Wi.ALPHABET_CHAR_SET.toUpperCase()},{}),n);function cM(n,t,e={}){if(!n)return{width:0,height:0};const i=aM({text:n,fontFamily:t.fontFamily||e.fontFamily||dK,fontSize:t.fontSize||e.fontSize||12,fontWeight:t.fontWeight||e.fontWeight,textAlign:t.textAlign||"center",textBaseline:t.textBaseline,ellipsis:!!t.ellipsis,maxLineWidth:t.maxLineWidth||1/0,lineHeight:t.fontSize||e.fontSize||12});return{width:i.width(),height:i.height()}}function ivt(n,t="type"){return fK(n,t)==="rich"}function fK(n,t="type"){var e,i;return kt(n.text)&&"type"in n.text?(e=n.text.type)!==null&&e!==void 0?e:"text":t in n&&(i=n[t])!==null&&i!==void 0?i:"text"}function mK(n){var t,e;return L(n.maxLineWidth)&&(n.maxWidth=n.maxLineWidth,delete n.maxLineWidth),n.width=(t=n.width)!==null&&t!==void 0?t:0,n.height=(e=n.height)!==null&&e!==void 0?e:0,n.textConfig=n.text.text||n.text,n}function nvt(n){const{text:t,_originText:e}=n,{text:i}=t;return n.html=i,n.text=e,n.renderable=!1,n}function rvt(n){const{text:t,_originText:e}=n,{text:i}=t;return n.react=i,n.text=e,n.renderable=!1,n}function OE(n,t="type"){const e=fK(n,t);return e==="rich"?Ut.richtext(mK(n)):(e==="html"?n=nvt(n):e==="react"&&(n=rvt(n)),Ut.text(n))}function vK(){gs(),hh(),Df(),uM(),sl()}var bj=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};vK();let ib=class DE extends Gs{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},DE.defaultAttributes,t)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();const{text:r="",textStyle:s={},shape:o={},panel:a={},space:l=4,minWidth:h,maxWidth:d,padding:u=4,visible:c,state:g,type:p,textAlwaysCenter:f,containerTextAlign:m}=this.attribute,v=Fi(u),_=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let b,y=-v[3],C=-v[0],S=v[1]+v[3],w=v[0]+v[2],x=0,A=0;const{visible:M}=o,T=bj(o,["visible"]);if(Re(M)){const G=(T==null?void 0:T.size)||10,tt=J(G)?G:Math.max(G[0],G[1]);b=_.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:G,strokeBoundsBuffer:0},T),{visible:M,x:tt/2,y:tt/2}),"symbol"),xt(g==null?void 0:g.shape)||(b.states=g.shape),M&&(A=tt+l)}let R,B,E;if(S+=A,x+=A,ivt({text:r})||p==="rich"){const G=Object.assign(Object.assign(Object.assign({},mK(Object.assign({type:p,text:r},s))),s),{visible:L(r)&&c!==!1,x,y:0});D(G.lineHeight)&&(G.lineHeight=s.fontSize),R=_.createOrUpdateChild("tag-text",G,"richtext"),B=R.AABBBounds.width(),E=R.AABBBounds.height()}else{const G=Object.assign(Object.assign({text:kt(r)&&"type"in r&&r.type==="text"?r.text:r,visible:L(r)&&c!==!1,lineHeight:s==null?void 0:s.fontSize},s),{x,y:0});D(G.lineHeight)&&(G.lineHeight=s.fontSize),R=_.createOrUpdateChild("tag-text",G,"text");const tt=cM(G.text,s,(e=(t=this.stage)===null||t===void 0?void 0:t.getTheme())===null||e===void 0?void 0:e.text);B=tt.width,E=tt.height}S+=B;const k=(i=o.size)!==null&&i!==void 0?i:10,P=J(k)?k:Math.max(k[0],k[1]);w+=Math.max(E,o.visible?P:0);const{textAlign:I,textBaseline:O}=s;(L(h)||L(d))&&(L(h)&&S<h&&(S=h),L(d)&&S>d&&(S=d,R.setAttribute("maxLineWidth",d-v[1]-v[2]))),y=0,C=0;let H=0;I==="left"||I==="start"?H=1:I==="right"||I==="end"?H=-1:I==="center"&&(H=0),H?H<0?(y-=S,b&&b.setAttribute("x",(b.attribute.x||0)-B),_.setAttribute("x",-v[1]-A)):H>0&&_.setAttribute("x",v[3]):(y-=S/2,b&&b.setAttribute("x",(b.attribute.x||0)-B/2),_.setAttribute("x",-A/2));const z=m==="right"||m==="end",F=m==="left"||m==="start",j=(G,tt)=>{R.type==="richtext"?R.setAttributes({x:G,textAlign:tt,textConfig:Q(R.attribute.textConfig).map(st=>Object.assign(Object.assign({},st),{textAlign:tt}))}):R.setAttributes({x:G,textAlign:tt})};if((m?m==="center":f)&&H){const G=S-v[1]-v[3],tt=B+A,st=H===1?(G-tt)/2+A+B/2:v[0]+A-(S/2+tt/2-A)+B/2;if(j(st,"center"),b){const ot=st-B/2-A+P/2;b.setAttributes({x:ot})}}if(F&&H!==1){const G=S-v[1]-v[3],tt=H===0?-G/2+A/2:-S+v[3]+v[1]+A;if(j(tt+A,"left"),b){const st=tt+P/2;b.setAttributes({x:st})}}if(z&&H!==-1){const G=S-v[1]-v[3],tt=H===0?G/2+A/2:G;if(j(tt,"right"),b){const st=tt-B-A+P/2;b.setAttributes({x:st})}}O==="middle"?(C-=w/2,b&&b.setAttribute("y",0)):O==="bottom"?(C-=w,b&&b.setAttribute("y",-E/2),_.setAttribute("y",-v[2])):O==="top"&&(_.setAttribute("y",v[0]),b&&b.setAttribute("y",E/2)),xt(g==null?void 0:g.text)||(R.states=g.text);const{visible:$}=a,Y=bj(a,["visible"]);if(c&&Re($)){const G=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},Y),{visible:$&&!!r,width:S,height:w,x:y,y:C}),"rect");if(xt(g==null?void 0:g.panel)||(G.states=g.panel),Y.customShape){const tt=Y.customShape;G.pathProxy=st=>tt(this,st,new Gn)}this._bgRect=G}this._textShape=R,this._symbol=b,this.resetStates()}initAttributes(t,e){t=e!=null&&e.skipDefault?t:Z({},DE.defaultAttributes,t),super.initAttributes(t),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p;this._tagStates=(e=(t=this.currentStates)===null||t===void 0?void 0:t.slice())!==null&&e!==void 0?e:[],this._rectStates=(s=(r=(i=this._bgRect)===null||i===void 0?void 0:i.currentStates)===null||r===void 0?void 0:r.slice())!==null&&s!==void 0?s:[],this._symbolStates=(l=(a=(o=this._symbol)===null||o===void 0?void 0:o.currentStates)===null||a===void 0?void 0:a.slice())!==null&&l!==void 0?l:[],this._textStates=(u=(d=(h=this._textShape)===null||h===void 0?void 0:h.currentStates)===null||d===void 0?void 0:d.slice())!==null&&u!==void 0?u:[],this.clearStates(),(c=this._bgRect)===null||c===void 0||c.clearStates(),(g=this._symbol)===null||g===void 0||g.clearStates(),(p=this._textShape)===null||p===void 0||p.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((t=this._bgRect)===null||t===void 0||t.useStates(this._rectStates)),this._symbolStates.length&&((e=this._symbol)===null||e===void 0||e.useStates(this._symbolStates)),this._textStates.length&&((i=this._textShape)===null||i===void 0||i.useStates(this._textStates))}};ib.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const _K={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},bK={poptip:Z({},_K)};function svt(){gs(),sl(),Df(),hh()}function ovt(n){Z(bK.poptip,_K,n)}var avt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const yj=new ie;svt();const Cj="M -0.5 -0.5, L -0.5 0.5, L 0.5 -0.5, Z",Sj="M -0.5 -0.5, L -0.5 0.5, L 0.5 0.5, Z",xj="M -0.5 -0.5, L 0.5 -0.5, L 0.5 0.5, Z",wj="M 0.5 -0.5, L 0.5 0.5, L -0.5 0.5, Z",lvt={tl:Cj,tr:xj,bl:Sj,br:wj,lt:Cj,lb:Sj,rt:xj,rb:wj};let FE=class yK extends Gs{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},yK.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,r,s,o,a,l,h;const{titleStyle:d={},position:u,contentStyle:c={},panel:g,logoSymbol:p,poptipAnchor:f="position",logoText:m,logoTextStyle:v={},triangleMode:_="default",space:b=4,minWidth:y=0,maxWidth:C=1/0,padding:S=4,maxWidthPercent:w,visible:x,state:A,dx:M=0,dy:T=0,positionBounds:R}=this.attribute;let{title:B="",content:E=""}=this.attribute;B=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(B):B,E=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(E):E;const k=Fi(S),P=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group");this.group=P;const I=C-k[1]-k[3],O=L(B)&&x!==!1,H=Object.assign(Object.assign({text:V(B)?B:[B],visible:O,wrap:!0},d),{x:k[3],y:k[0],maxLineWidth:I,textAlign:"left",textBaseline:"top"}),z=P.createOrUpdateChild("poptip-title",H,"text");xt(A==null?void 0:A.title)||(z.states=A.title);const F=z.AABBBounds,j=F.height(),$=F.width();let Y=j+b;O||(Y=0);const G=L(E)&&x!==!1,tt=Object.assign(Object.assign({text:V(E)?E:[E],visible:G,wrap:!0},c),{x:k[3],y:k[0]+Y,maxLineWidth:I,textAlign:"left",textBaseline:"top"}),st=P.createOrUpdateChild("poptip-content",tt,"text");xt(A==null?void 0:A.content)||(st.states=A.content);const ot=st.AABBBounds,rt=ot.height(),pt=ot.width();G&&(Y+=rt),this.titleShape=z,this.contentShape=st;let at=ti($+k[1]+k[3],pt+k[1]+k[3]);at>C?at=C:at<y&&(at=y);let W=k[0]+k[2]+Y;const{visible:N,square:K}=g,nt=avt(g,["visible","square"]);if(K){const ft=ti(at,W);at=ft;const Ct=ft-W;W=ft,z.setAttributes({dy:Ct/2}),st.setAttributes({dy:Ct/2})}const X=(t=nt.size)!==null&&t!==void 0?t:12,ht=V(X)?[X[0]+((e=nt.space)!==null&&e!==void 0?e:0),X[1]+((i=nt.space)!==null&&i!==void 0?i:0)]:X+((r=nt.space)!==null&&r!==void 0?r:0),_t=(s=nt.lineWidth)!==null&&s!==void 0?s:1,ct=this.stage?[(o=this.stage.viewWidth)!==null&&o!==void 0?o:this.stage.width,(a=this.stage.viewHeight)!==null&&a!==void 0?a:this.stage.height]:void 0;if(ct){const ft=this.AABBBounds,Ct=(l=this.attribute.x)!==null&&l!==void 0?l:ft.x1,Ht=ct[0]-ft.x1;let Xt=Math.max(Ct,Ht);const ae=(V(X)?X[0]:12)+3;if(Xt=Math.min(Xt-ae,Xt*w),Xt<at){at=Xt;const re=k[1]+k[3];z.setAttribute("maxLineWidth",Xt-re),st.setAttribute("maxLineWidth",Xt-re),W=k[0]+k[2],O&&(W+=z.AABBBounds.height()+b),W+=st.AABBBounds.height()}}const U=u==="auto"||V(u),ut=V(u)?u:this.positionList;let lt,At=-1/0;for(let ft=0;ft<ut.length+1;ft++){const Ct=U?ut[ft===ut.length?lt:ft]:u;let Ht="arrow2Left",Xt=(V(X)?X[0]:X)/4,ae=0;Ct==="top"||Ct==="bottom"||Ct==="left"||Ct==="right"?Ht="arrow2Left":_==="concise"&&(Ht=lvt[Ct],Xt=["tl","bl","rt","rb"].includes(Ct)?(V(X)?X[0]:X)/2:-(V(X)?X[0]:X)/2,ae=["tl","tr","lb","rb"].includes(Ct)?-(V(X)?X[1]:X)/2:(V(X)?X[1]:X)/2);const{angle:re,offset:be}=this.getAngleAndOffset(Ct,at,W,V(ht)?ht:[ht,ht-_t],Ht);let Xe,_i={x:0,y:0};if(f==="bounds"&&R&&(_i=this.calculateAnchorPoint(Ct,R)),Re(N)){let Gt;Xe=P.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},nt),{visible:N&&(G||O),x:Xt,y:ae,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:Ht,angle:re,dx:be[0],dy:be[1]-((h=nt.space)!==null&&h!==void 0?h:0),size:X,zIndex:9}),"symbol"),xt(A==null?void 0:A.panel)||(Xe.states=A.panel),Gt=g.panelSymbolType?P.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},nt),{visible:N&&(G||O),x:0,y:0,symbolType:"rect",size:[at,W],zIndex:-8}),"symbol"):P.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},nt),{visible:N&&(G||O),x:0,y:0,width:at,height:W,zIndex:-8}),"rect"),xt(A==null?void 0:A.panel)||(Gt.states=A.panel)}if(P.setAttributes({x:-be[0]+M+_i.x,y:-be[1]+T+_i.y,anchor:[Xt,ae]}),p){const{size:Gt=12}=p,Ge=V(Gt)?Gt:[Gt,Gt];Ge[1]==="auto"&&(Ge[1]=W),Ge[0]==="auto"&&(Ge[0]=W);const He=Ge[0];P.createOrUpdateChild("poptip-logo",Object.assign(Object.assign({},p),{x:0,y:W/2,visible:N&&(G||O),zIndex:10,size:Ge}),"symbol"),P.setAttributes({x:-be[0]+M+He/2,y:-be[1]+T}),m&&P.createOrUpdateChild("poptip-logo-text",Object.assign(Object.assign({},v),{x:0,y:W/2,visible:N&&(G||O),text:m,textAlign:"center",textBaseline:"middle",zIndex:10}),"text")}if(!ct)break;{yj.setValue(0,0,at,W).transformWithMatrix(P.globalTransMatrix);const Gt=yj,Ge=new Bi().setValue(0,0,ct[0],ct[1]);if(U){if(BY(Gt,Ge,!1))break;{const He=KA(Gt,Ge,!1),ci=(He.x2-He.x1)*(He.y2-He.y1);ci>At&&(At=ci,lt=ft)}}if(["top","bottom","left","right"].includes(Ct)){const He=Ct==="top"||Ct==="bottom",ci=Ct==="left"||Ct==="right";let Vr=!1;if(He?Vr=Ct==="top"&&Gt.y1<0||Ct==="bottom"&&Gt.y2>Ge.y2:ci&&(Vr=Ct==="left"&&Gt.x1<0||Ct==="right"&&Gt.x2>Ge.x2),!Vr){let Ln=0;const Mr=(V(X)?X[1]:X)/2;He?(Gt.x1<0?Ln=-Gt.x1:Gt.x2>Ge.x2&&(Ln=Ge.x2-Gt.x2),P.setAttribute("x",P.attribute.x+Ln),Xe.setAttribute("dx",we(ti(Xe.attribute.dx-Ln,Mr),Gt.width()-Mr))):ci&&(Gt.y1<0?Ln=-Gt.y1:Gt.y2>Ge.y2&&(Ln=Ge.y2-Gt.y2),P.setAttribute("y",P.attribute.y+Ln),Xe.setAttribute("dy",we(ti(Xe.attribute.dy-Ln,Mr),Gt.height()-Mr)));break}}if(!U)break}}}calculateAnchorPoint(t,e){if(!e)return{x:0,y:0};const{x:i,y:r}=this.attribute,{x1:s,y1:o,x2:a,y2:l}=e,h=a-s,d=l-o;switch(t){case"top":case"tl":case"tr":return{x:s+h/2-i,y:o-r};case"bottom":case"bl":case"br":return{x:s+h/2-i,y:l-r};case"left":case"lt":case"lb":return{x:s-i,y:o+d/2-r};case"right":case"rt":case"rb":return{x:a-i,y:o+d/2-r};default:return{x:0,y:0}}}getAngleAndOffset(t,e,i,r,s){const o=s==="arrow2Left"?r[1]/2:r[1];switch(t){case"tl":return{angle:s==="arrow2Left"?Kt/2*3:0,offset:s==="arrow2Left"?[e/4,i+o]:[0,i+o]};case"top":return{angle:Kt/2*3,offset:[e/2,i+o]};case"tr":return{angle:s==="arrow2Left"?Kt/2*3:0,offset:s==="arrow2Left"?[e/4*3,i+o]:[e,i+o]};case"rt":return{angle:0,offset:s==="arrow2Left"?[-o,i/5]:[-o,0]};case"right":return{angle:0,offset:[-o,i/2]};case"rb":return{angle:0,offset:s==="arrow2Left"?[-o,i/5*4]:[-o,i]};case"bl":return{angle:s==="arrow2Left"?Kt/2:0,offset:s==="arrow2Left"?[e/4,-o]:[0,-o]};case"bottom":return{angle:Kt/2,offset:[e/2,-o]};case"br":return{angle:s==="arrow2Left"?Kt/2:0,offset:s==="arrow2Left"?[e/4*3,-o]:[e,-o]};case"lt":return{angle:s==="arrow2Left"?Kt:0,offset:s==="arrow2Left"?[e+o,i/5]:[e+o,0]};case"left":return{angle:Kt,offset:[e+o,i/2]};case"lb":return{angle:s==="arrow2Left"?Kt:0,offset:s==="arrow2Left"?[e+o,i/5*4]:[e+o,i]}}}appearAnimate(t){const{duration:e=1e3,easing:i="quadOut"}=t;if(this.setAttributes({scaleX:0,scaleY:0}),this.animate().to({scaleX:1,scaleY:1},e/3*2,i),this.titleShape&&this.titleShape.animate().play(new e3({text:""},{text:this.titleShape.attribute.text},e,i)),this.contentShape&&this.contentShape.animate().play(new e3({text:""},{text:this.contentShape.attribute.text},e,i)),t.wave){const r=e/6;this.group.animate().to({angle:t.wave},r,i).to({angle:-t.wave},2*r,i).to({angle:t.wave},2*r,i).to({angle:0},r,i)}}disappearAnimate(t){const{duration:e=1e3,easing:i="quadOut"}=t;this.animate().to({scaleX:0,scaleY:0},e,i)}};FE.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},panel:{},maxWidthPercent:.8,space:8,padding:10};var hvt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};function dvt(n,t){return Z(n,bK.poptip,t),n}let gv=class{render(t,e,i,r,s,o,a,l,h,d,u,c,g){var p,f;if(t._showPoptip===1){const{visible:m,visibleCb:v}=t.attribute.poptip||{};if(m===!1||v&&v(t)===!1)return;const _={};Z(_,FE.defaultAttributes,t.attribute.poptip?t.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(_):this.poptipComponent=new FE(_);let b=t.attribute.poptip||{};if(t.type==="text"&&b.title==null&&b.content==null){const S={};dvt(S,b),b=S,b.content=(p=b.content)!==null&&p!==void 0?p:t.attribute.text}const y=t.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1,poptipAnchor:"bounds"},b),{x:y.e,y:y.f,positionBounds:t.globalAABBBounds})),d.stage.tryInitInteractiveLayer();const C=d.stage.getLayer("_builtin_interactive");C&&C.add(this.poptipComponent)}else t._showPoptip===2&&(t._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),(f=this.poptipComponent.parent)===null||f===void 0||f.removeChild(this.poptipComponent),this.poptipComponent=null))}};gv=hvt([Bt()],gv);var CK=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let SK=class{constructor(){this.activeEvent="onRegister",this._uid=Nn.GenAutoIncrementId(),this.poptip=t=>{const e=t.target;this.needHide(e)?this.unpoptip(t):e!==this.activeGraphic&&(this.needShow(e)&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0))},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip)}needHide(t){return t.isContainer||!t.attribute}needShow(t){return!!t.attribute.poptip}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip)}},pv=class extends SK{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};pv=CK([Bt()],pv);let fv=class extends SK{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=t=>{const{stage:e}=this.pluginService;t.target===e&&this.unpoptip(t)}}activate(t){super.activate(t);const{stage:e}=this.pluginService;e.addEventListener("pointerleave",this.pointerlave)}needHide(t){return t.type!=="text"||!t.cliped||t.isContainer||!t.attribute||t.attribute.disableAutoClipedPoptip}needShow(t){return!0}deactivate(t){const{stage:e}=this.pluginService;super.deactivate(t),e.removeEventListener("pointerleave",this.pointerlave)}};fv=CK([Bt()],fv);const uvt=new pe((n,t,e,i)=>{e(gv)||(n(gv).toSelf().inSingletonScope(),n(HO).toService(gv)),e(pv)||(n(pv).toSelf(),n(H_).toService(pv)),e(fv)||(n(fv).toSelf(),n(H_).toService(fv))});function cvt(){he.load(uvt)}function gvt(){gs(),YO(),Umt(),Df()}gvt();let xK=class wK extends Gs{getStartAngle(){return Ka(this._startAngle)}getEndAngle(){return Ka(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},wK.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:r,visible:s=!0,multiSegment:o,mainSegmentIndex:a}=this.attribute;if(!s)return;this._computeLineAngle();const l=this._getMainSegmentPoints(),h=this._renderSymbol(t,l,"start"),d=this._renderSymbol(e,l,"end");if(this.startSymbol=h,this.endSymbol=d,o){const u=[...this.attribute.points];if(et(a))u[a]=this._clipPoints(u[a]);else{const c=this._clipPoints(M_(u));u[0][0]=c[0],u[u.length-1][u[u.length-1].length-1]=c[c.length-1]}u.forEach((c,g)=>{var p,f;const m=Ut.line(Object.assign(Object.assign({points:c},V(i)?(p=i[g])!==null&&p!==void 0?p:i[i.length-1]:i),{fill:!1}));m.name=`${this.name}-line`,m.id=this._getNodeId("line"+g),xt(r==null?void 0:r.line)||(m.states=V(r.line)?(f=r.line[g])!==null&&f!==void 0?f:r.line[r.line.length-1]:r.line),this.add(m),this.lines.push(m)})}else{let u=Ut.line;Q(i)[0].cornerRadius&&(u=Ut.polygon);const c=u(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},Q(i)[0]),{fill:!1,closePath:!1}));c.name=`${this.name}-line`,c.id=this._getNodeId("line"),xt(r==null?void 0:r.line)||(c.states=[].concat(r.line)[0]),this.add(c),this.lines.push(c)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:r=!0}=t;let s;if(t&&t.visible){const o=this.getStartAngle(),a=this.getEndAngle(),{state:l}=this.attribute,h=e[0],d=e[e.length-1],{refX:u=0,refY:c=0,refAngle:g=0,style:p,symbolType:f,size:m=12}=t;let v,_;i==="start"?(v={x:h.x+(et(o)?u*Math.cos(o)+c*Math.cos(o-Math.PI/2):0),y:h.y+(et(o)?u*Math.sin(o)+c*Math.sin(o-Math.PI/2):0)},_=this._computeStartRotate(this._startAngle)):(v={x:d.x+(et(a)?u*Math.cos(a)+c*Math.cos(a-Math.PI/2):0),y:d.y+(et(a)?u*Math.sin(a)+c*Math.sin(a-Math.PI/2):0)},_=this._computeEndRotate(this._endAngle)),s=Ut.symbol(Object.assign(Object.assign(Object.assign({},v),{symbolType:f,size:m,angle:r?_+g:0,strokeBoundsBuffer:0}),p)),s.name=`${this.name}-${i}-symbol`,s.id=this._getNodeId(`${i}-symbol`),xt(l==null?void 0:l.symbol)||(s.states=l.symbol),i==="start"?xt(l==null?void 0:l.startSymbol)||(s.states=l.startSymbol):xt(l==null?void 0:l.endSymbol)||(s.states=l.endSymbol),this.add(s)}return s}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let r;return r=e?et(i)?t[i]:M_(t):t,this._mainSegmentPoints=r,r}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let r=t;if(e.visible){const s=e.clip?e.size||10:0;r=[{x:t[0].x-s/2*(Math.cos(this._startAngle)||0),y:t[0].y-s/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(i.visible){const s=i.clip?i.size||10:0,o={x:t[t.length-1].x-s/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-s/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),o]}return r}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],r=t[t.length-2],s=t[t.length-1],o=[e.x-i.x,e.y-i.y],a=Math.atan2(o[1],o[0]),l=[s.x-r.x,s.y-r.y],h=Math.atan2(l[1],l[0]);this._startAngle=a,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}};xK.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};var tr;(function(n){n.innerView="inner-view",n.axisContainer="axis-container",n.labelContainer="axis-label-container",n.tickContainer="axis-tick-container",n.tick="axis-tick",n.subTick="axis-sub-tick",n.label="axis-label",n.title="axis-title",n.gridContainer="axis-grid-container",n.grid="axis-grid",n.gridRegion="axis-grid-region",n.line="axis-line",n.background="axis-background",n.axisLabelBackground="axis-label-background",n.axisBreak="axis-break",n.axisBreakSymbol="axis-break-symbol"})(tr||(tr={}));var Ng;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(Ng||(Ng={}));const og={[Ng.selectedReverse]:{},[Ng.selected]:{},[Ng.hover]:{},[Ng.hoverReverse]:{}},pvt=999,HE={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},Aj={size:8,stroke:"#000",lineWidth:1,zIndex:1};function fvt(n){const t=n.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:n.attribute.x,centerY:n.attribute.y,angle:n.attribute.angle}}function mvt(n){n.forEach(t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=fvt(t),i=uo({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),r=i.x-e.centerX,s=i.y-e.centerY;e.x1+=r,e.x2+=r,e.y1+=s,e.y2+=s,e.centerX+=r,e.centerY+=s,t.rotatedBounds=e})}function vvt(n,t){var e,i;return!((e=n.OBBBounds)===null||e===void 0)&&e.empty()||!((i=t.OBBBounds)===null||i===void 0)&&i.empty()?kd(n.AABBBounds,t.AABBBounds,!1)&&(!n.rotatedBounds||!t.rotatedBounds||xO(n.rotatedBounds,t.rotatedBounds,!0)):n.OBBBounds.intersects(t.OBBBounds)}const AK=Math.sin(Math.PI/10);function MK(n,t=AK){const e=!D(n)&&n!==0,i=e?Math.cos(n):1;return e&&Math.abs(i)<=t}function XO(n,t=AK){const e=!D(n)&&n!==0,i=e?Math.sin(n):0;return!e||Math.abs(i)<=t}function _vt(n,t){return{x:n.x+t[0],y:n.y+t[1]}}function bvt(n={}){var t,e;const{style:i={},angle:r=.5*Math.PI}=n,s=Z({},Aj,i),o=(t=s.size)!==null&&t!==void 0?t:Aj.size;return Object.assign(Object.assign({},s),{symbolType:(e=s.symbolType)!==null&&e!==void 0?e:`M ${-o/2} ${o*Math.sin(r)} L ${o/2} ${-o*Math.sin(r)}`,symbolSize:o})}function yvt(n){const t={};return ef(n,e=>{e.type!=="group"&&e.id&&(t[e.id]=e)}),t}function TK(n,t){return{x:n.x+t[0],y:n.y+t[1]}}function Mj(n,t,e,i=!1,r=!1){const s=[t.x-e.x,t.y-e.y];return cK(s,(i?-1:1)*(r?-1:1)*n/gK(s))}function Cvt(n,t,e,i,r){const s=ui({x:0,y:0},e,n),o=TK(s,Mj(i,s,t,r));return _vt(o,Mj(i||1,o,t,r))}function Ko(n,t,e){var i;const r=(i=n.attribute)===null||i===void 0?void 0:i.angle;if(XO(r,Number.EPSILON))return e>eS(n.AABBBounds,t.AABBBounds);const s=n.OBBBounds,o=t.OBBBounds;return!s||!o||s.empty()||o.empty()?e>eS(n.AABBBounds,t.AABBBounds):s.intersects(o)||e>EY(s,o)}function zE(n,t){for(let e,i=1,r=n.length,s=n[0];i<r;s=e,++i)if(e=n[i],Ko(s,e,t))return!0;return!1}const Svt=(n,t,e)=>{const i=n.target;return i!==e&&i.name&&!xt(i.states)?(i.addState(Or.hover,!0),ef(t,r=>{r!==i&&r.name&&!xt(r.states)&&r.addState(Or.hoverReverse,!0)}),i):e},xvt=(n,t,e)=>e&&(ef(t,i=>{i.name&&!xt(i.states)&&(i.removeState(Or.hoverReverse),i.removeState(Or.hover))}),null),wvt=(n,t,e)=>{const i=n.target;return e===i&&i.hasState(Or.selected)?(ef(t,r=>{r.name&&!xt(r.states)&&(r.removeState(Or.selectedReverse),r.removeState(Or.selected))}),null):i.name&&!xt(i.states)?(i.addState(Or.selected,!0),ef(t,r=>{r!==i&&r.name&&!xt(r.states)&&r.addState(Or.selectedReverse,!0)}),i):e};let Avt=class extends Gs{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=Svt(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=xvt(t,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=wvt(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=Pn(this.attribute);Z(this.attribute,t);const i=Ut.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&yvt(this._innerView),this.removeAllChild(!0),this._innerView=Ut.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:r,line:s,items:o}=this.attribute,a=Ut.group({x:0,y:0,zIndex:1,pickable:!1});if(a.name=tr.axisContainer,a.id=this._getNodeId("container"),a.setMode(this.mode),this.axisContainer=a,t.add(a),s&&s.visible&&this.renderLine(a),o&&o.length&&(this.data=this._transformItems(o[0]),r&&r.visible&&this.renderTicks(a),i&&i.visible)){const l=Ut.group({x:0,y:0,pickable:!1});l.name=tr.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,a.add(l),o.forEach((h,d)=>{const u=this.renderLabels(l,h,d),c=u.getChildren();this.beforeLabelsOverlap(c,h,u,d,o.length),this.handleLabelsOverlap(c,h,u,d,o.length),this.afterLabelsOverlap(c,h,u,d,o.length);let g=0,p=0,f="center",m="middle",v=0;c.forEach((_,b)=>{var y;const C=_.attribute,S=(y=C.angle)!==null&&y!==void 0?y:0,w=_.AABBBounds;let x=w.width(),A=w.height();S&&(x=Math.abs(x*Math.cos(S)),A=Math.abs(A*Math.sin(S))),g=Math.max(g,x),p=Math.max(p,A),f=C.textAlign,m=C.textBaseline,b===0&&(v=C.x)}),this.axisLabelLayerSize[d]={width:g,height:p,labelPos:v,textAlign:f,textBaseline:m}})}e&&e.visible&&this.renderTitle(a)}renderTicks(t){const e=this.getTickLineItems(),i=Ut.group({x:0,y:0,pickable:!1});i.name=tr.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach((s,o)=>{var a;const l=Ut.line(Object.assign({},this._getTickLineAttribute("tick",s,o,e)));if(l.name=tr.tick,l.id=this._getNodeId(s.id),xt((a=this.attribute.tick)===null||a===void 0?void 0:a.state))l.states=sg;else{const h=this.data[o],d=Z({},sg,this.attribute.tick.state);Object.keys(d).forEach(u=>{it(d[u])&&(d[u]=d[u](h.rawValue,o,h,this.data))}),l.states=d}i.add(l)}),this.tickLineItems=e;const{subTick:r}=this.attribute;if(r&&r.visible){const s=this.getSubTickLineItems();s.length&&s.forEach((o,a)=>{const l=Ut.line(Object.assign({},this._getTickLineAttribute("subTick",o,a,e)));if(l.name=tr.subTick,l.id=this._getNodeId(`${a}`),xt(r.state))l.states=sg;else{const h=Z({},sg,r.state);Object.keys(h).forEach(d=>{it(h[d])&&(h[d]=h[d](o.value,a,o,e))}),l.states=h}i.add(l)}),this.subTickLineItems=s}}renderLabels(t,e,i){const{dataFilter:r}=this.attribute.label;r&&it(r)&&(e=r(e,i));const s=this._transformItems(e),o=Ut.group({x:0,y:0,pickable:!1});return o.name=`${tr.labelContainer}-layer-${i}`,o.id=this._getNodeId(`label-container-layer-${i}`),t.add(o),s.forEach((a,l)=>{var h;const d=this._getLabelAttribute(a,l,s,i),u=OE(d);if(u.name=tr.label,u.id=this._getNodeId(`layer${i}-label-${a.id}`),xt((h=this.attribute.label)===null||h===void 0?void 0:h.state))u.states=sg;else{const c=Z({},sg,this.attribute.label.state);Object.keys(c).forEach(g=>{it(c[g])&&(c[g]=c[g](a,l,s,i))}),u.states=c}u.data=Object.assign(Object.assign({},a),{index:l,layer:i}),o.add(u)}),o}renderTitle(t){const e=this.getTitleAttribute(),i=new ib(Object.assign({},e));i.name=tr.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return TK(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:r,inside:s=!1,length:o,dataFilter:a}=t;let l=1;return e.length>=2&&(l=e[1].value-e[0].value),(a&&it(a)?a(e):e).forEach(h=>{let d=h.point,u=h.value;if(!r){const g=h.value-l/2;if(this.isInValidValue(g))return;d=this.getTickCoord(g),u=g}const c=this.getVerticalCoord(d,o,s);if(this.mode==="3d"){const g=this.getVerticalVector(o,s,d);let p=0,f=0;Et(g[0])>Et(g[1])?p=Kt/2*(c.x>d.x?1:-1):f=Kt/2*(c.y>d.y?-1:1),i.push({start:d,end:c,value:u,id:`tick-${h.id}`,anchor:[d.x,d.y],alpha:p,beta:f})}else i.push({start:d,end:c,value:u,id:`tick-${h.id}`})}),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:r=!1,length:s=2}=t,o=this.tickLineItems,a=o.length;if(a>=2)for(let l=0;l<a-1;l++){const h=o[l],d=o[l+1];for(let u=0;u<i;u++){const c=(u+1)/(i+1),g=(1-c)*h.value+c*d.value,p=this.getTickCoord(g),f=this.getVerticalCoord(p,s,r);e.push({start:p,end:f,value:g,id:`sub-tick-${g}`})}}return e}_getTickLineAttribute(t,e,i,r){let s=Dt(this.attribute,`${t}.style`);const o=this.data[i];s=it(s)?Z({},Dt(HE,`${t}.style`),t==="tick"?s(o.rawValue,i,o,this.data):s(e.value,i,e,r)):s;const{start:a,end:l,anchor:h,alpha:d,beta:u}=e;return Object.assign({points:[a,l],anchor:h,alpha:d,beta:u},s)}_getLabelAttribute(t,e,i,r){var s,o;const{space:a=4,inside:l=!1,formatMethod:h,type:d="text",text:u}=this.attribute.label;let c=a,g=0;!((s=this.attribute.tick)===null||s===void 0)&&s.visible&&this.attribute.tick.inside===l&&(g=this.attribute.tick.length||4),!((o=this.attribute.subTick)===null||o===void 0)&&o.visible&&this.attribute.subTick.inside===l&&(g=Math.max(g,this.attribute.subTick.length||2)),c+=g;const p=this.getRelativeVector(t.point);r>0&&(p[1]===0?c+=(this.axisLabelLayerSize[r-1].height+Dt(this.attribute,"label.space",4))*r:c+=(this.axisLabelLayerSize[r-1].width+Dt(this.attribute,"label.space",4))*r);const f=this.getVerticalCoord(t.point,c,l),m=this.getVerticalVector(c||1,l,f),v=h?h(`${t.label}`,t,e,i,r):t.label;let{style:_}=this.attribute.label;_=it(_)?Z({},HE.label.style,_(t,e,i,r)):_;const b=this.getLabelAlign(m,l,_.angle);return _=Z(b,_),it(_.text)&&(_.text=_.text({label:t.label,value:t.rawValue,index:t.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(f,m,v,_)),{text:u??v,_originText:t.label,lineHeight:_==null?void 0:_.fontSize,type:d}),_)}getLabelPosition(t,e,i,r){return t}_transformItems(t){const e=[];return t.forEach(i=>{var r;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(r=i.id)!==null&&r!==void 0?r:i.label}))}),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}};const Tj={parity:function(n){return n.filter((t,e)=>e%2?t.setAttribute("opacity",0):1)},greedy:function(n,t){let e;return n.filter((i,r)=>r&&Ko(e,i,t)?i.setAttribute("opacity",0):(e=i,1))}};function Mvt(n){let t;return t=n.OBBBounds.empty()?n.AABBBounds:n.OBBBounds,t.width()>1&&t.height()>1}function Tvt(n){return n.forEach(t=>t.setAttribute("opacity",1)),n}function kj(n,t,e,i,r=!1){if(e&&!n.attribute.opacity){const s=t.length;if(s>1){n.setAttribute("opacity",1);for(let o=0;o<s;o++){const a=r?t[s-1-o]:t[o];if(!i(a))break;a.setAttribute("opacity",0)}}}}function kvt(n,t){if(xt(n))return;const e=n.filter(Mvt);if(xt(e))return;let i;i=Tvt(e);const{method:r="parity",separation:s=0}=t,o=it(r)?r:Tj[r]||Tj.parity;if(i.length>=3&&zE(i,s)){do i=o(i,s);while(i.length>=3&&zE(i,s));const a=(c,g,p=!0)=>p&&c<3||g,l=a(i.length,t.firstVisible,!1);let h=a(i.length,t.lastVisible);const d=e[0],u=de(e);Ko(d,u,s)&&l&&h&&(u.setAttribute("opacity",0),h=!1),kj(d,i,l,c=>Ko(c,d,s)),kj(u,i,h,c=>Ko(c,u,s)||!(!l||c===d)&&Ko(c,d,s),!0)}e.forEach(a=>{a.setAttribute("visible",!!a.attribute.opacity)})}function Rvt(n,t){if(xt(n))return;const{orient:e,labelRotateAngle:i=[0,45,90]}=t;if(i.length===0||n.some(o=>!!o.attribute.angle))return;let r=0,s=0;for(i&&i.length>0&&(s=i.length);r<s;){const o=i[r++];if(n.forEach(a=>{a.attribute.angle=Te(o)}),Pvt(e,n),!Bvt(n))break}}function Bvt(n){for(let t=1;t<n.length;t++)if(vvt(n[t-1],n[t]))return!0;return!1}function Pvt(n,t){n!=="bottom"&&n!=="top"||Lvt(n,t),n!=="left"&&n!=="right"||Evt(n,t),mvt(t)}function gM(n=0){if(n<0)for(;n<0;)n+=2*Math.PI;if(n>0)for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function Evt(n,t){t.forEach((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},RK(n,e.attribute.angle)),{angle:gM(e.attribute.angle)}))})}function Lvt(n,t){t.forEach(e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},kK(n,e.attribute.angle)),{angle:gM(e.attribute.angle)}))})}function kK(n,t=0){let e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];n==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const r=(t=gM(t))/(.5*Math.PI);let s;return s=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[s],textBaseline:i[s]}}function RK(n,t=0){let e=["right","right","center","left","left","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];n==="right"&&(e=["left","left","center","right","right","right","center","left","left"],i=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const r=(t=gM(t))/(.5*Math.PI);let s;return s=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[s],textBaseline:i[s]}}function Ivt(n){return et(n)?{left:n,right:n}:kt(n)?{left:n.left||0,right:n.right||0}:{left:0,right:0}}function Ovt(n,t){const{limitLength:e,verticalLimitLength:i,ellipsis:r="...",orient:s,axisLength:o}=t;if(xt(n)||!et(e))return;const a=Ivt(t.overflowLimitLength),l=n[0],h=l.attribute.angle,d=!D(h),u=d?Math.cos(h):1,c=d?Math.sin(h):0,g=XO(h),p=MK(h),f=s==="top"||s==="bottom",m=l.attribute.direction,v=!g&&!p&&f&&(n.length<2||n.some(_=>Math.abs(_.AABBBounds.width()-l.AABBBounds.width())>=2))&&l.AABBBounds.width()>Math.abs(e/c);n.forEach(_=>{var b;if(f&&(p&&Math.floor(_.AABBBounds.height())<=e||g&&Math.floor(_.AABBBounds.width())<=i)||!f&&(m==="vertical"&&Math.floor(_.AABBBounds.height())<=i||m!=="vertical"&&(g&&Math.floor(_.AABBBounds.width())<=e||p&&Math.floor(_.AABBBounds.height())<=i)))return;let y=null;if(g||p)y=f?g?i:e:m==="vertical"||p?i:e;else if(f){const{x1:C,x2:S}=_.AABBBounds,w=c/u,x=Math.abs(e/c);if(v&&w>0&&C<=o+a.right&&e/w+C>o+a.right){const A=(o-C+a.right)/Math.abs(u);y=Math.min(A,x)}else if(v&&w<0&&S>=-a.left&&e/w+S<-a.left){const A=(S+a.left)/Math.abs(u);y=Math.min(A,x)}else y=x}else y=Math.abs(e/u);et(_.attribute.maxLineWidth)&&(y=et(y)?Math.min(_.attribute.maxLineWidth,y):_.attribute.maxLineWidth),_.setAttributes({maxLineWidth:y,ellipsis:(b=_.attribute.ellipsis)!==null&&b!==void 0?b:r})})}function Dvt(n,t){const{limitLength:e,axisLength:i,ellipsis:r="...",orient:s}=t;if(xt(n)||!et(e))return;const o=n[0].attribute.angle,a=XO(o),l=MK(o),h=s==="top"||s==="bottom";let d=i/n.length;n.forEach((u,c)=>{var g,p,f,m,v;if(h){if(l&&Math.floor(u.AABBBounds.height())<=e)return;if(a){const y=Rj(u.attribute.x,(g=n[c+1])===null||g===void 0?void 0:g.attribute.x,(p=n[c-1])===null||p===void 0?void 0:p.attribute.x);et(y)&&(d=we(d,y))}}else{if(l){const y=Rj(u.attribute.y,(f=n[c+1])===null||f===void 0?void 0:f.attribute.y,(m=n[c-1])===null||m===void 0?void 0:m.attribute.y);et(y)&&(d=we(d,y))}if(a&&Math.floor(u.AABBBounds.width())<=e)return}let _=null,b=null;h?l?(_=e,b=d):(_=d,b=e):l?(_=d,b=e):(_=e,b=d),u.setAttributes({maxLineWidth:_,ellipsis:(v=u.attribute.ellipsis)!==null&&v!==void 0?v:r,whiteSpace:"normal",heightLimit:b})})}function Rj(n,t,e){let i;return et(t)&&(i=Math.abs(t-n)),et(e)&&(i=et(i)?Math.min(Math.abs(n-e),i):Math.abs(n-e)),i}function Fvt(n,t,e,i,r){i==="left"||i==="right"?r==="left"?n.forEach(s=>{var o;s.setAttributes({dx:((o=s.attribute.dx)!==null&&o!==void 0?o:0)+t-s.AABBBounds.x1})}):r==="right"?n.forEach(s=>{var o;s.setAttributes({dx:((o=s.attribute.dx)!==null&&o!==void 0?o:0)+t+e-s.AABBBounds.x2})}):r==="center"&&n.forEach(s=>{var o;s.setAttributes({dx:((o=s.attribute.dx)!==null&&o!==void 0?o:0)+t+e/2-(s.AABBBounds.x1+s.AABBBounds.x2)/2})}):i!=="bottom"&&i!=="top"||(r==="top"?n.forEach(s=>{var o;s.setAttributes({dy:((o=s.attribute.dy)!==null&&o!==void 0?o:0)+t-s.AABBBounds.y1})}):r==="bottom"?n.forEach(s=>{var o;s.setAttributes({dy:((o=s.attribute.dy)!==null&&o!==void 0?o:0)+t+e-s.AABBBounds.y2})}):r==="middle"&&n.forEach(s=>{var o;s.setAttributes({dy:((o=s.attribute.dy)!==null&&o!==void 0?o:0)+t+e/2-(s.AABBBounds.y1+s.AABBBounds.y2)/2})}))}let Hvt=class{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){const{verticalFactor:r=1}=this.attribute,s=this.getRelativeVector(),o=Qmt(s),a=[o[1],-1*o[0]];return cK(a,t*(e?1:-1)*r)}};function zvt(){gs(),YO(),uM(),sl()}function Wvt(){zvt(),hh()}var Bj=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};Wvt();let WE=class BK extends Avt{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},BK.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const r=[];for(let s=0;s<this.attribute.breaks.length;s++){const o=this.attribute.breaks[s],{range:a,breakSymbol:l,rawRange:h}=o;r.push({startPoint:this.getTickCoord(a[0]),endPoint:this.getTickCoord(a[1]),range:a,breakSymbol:l,rawRange:h})}this._breaks=r}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach((r,s)=>{const{startPoint:o,endPoint:a,breakSymbol:l,rawRange:h}=r;if((l==null?void 0:l.visible)!==!1){const d=Ut.group({zIndex:pvt});d.name=tr.axisBreak,d.id=this._getNodeId(`${tr.axisBreak}-${s}`),d.data=h;const u=bvt(l),c=Ut.symbol(Object.assign({x:o.x,y:o.y},u));c.name=tr.axisBreakSymbol;const g=Ut.symbol(Object.assign({x:a.x,y:a.y},u));g.name=tr.axisBreakSymbol,d.add(c),d.add(g),t.add(d)}});const{panel:i}=this.attribute;if(i&&i.visible){const r=this.axisContainer,s=r.AABBBounds,o=Ut.rect(Object.assign({x:s.x1,y:s.y1,width:s.width(),height:s.height()},i.style));o.name=tr.background,o.id=this._getNodeId("background"),o.states=Z({},og,(e=i.state)!==null&&e!==void 0?e:{}),r.insertBefore(o,r.firstChild)}}renderLine(t){const{start:e,end:i,line:r}=this.attribute,s=r,{startSymbol:o,endSymbol:a,style:l,state:h}=s,d=Bj(s,["startSymbol","endSymbol","style","state"]),u=Object.assign({startSymbol:o,endSymbol:a,lineStyle:l},d);if(this._breaks&&this._breaks.length){const g=[];let p=e;this._breaks.forEach(f=>{const{startPoint:m,endPoint:v}=f;g.push([p,m]),p=v}),g.push([p,i]),u.points=g,u.multiSegment=!0}else u.points=[e,i];xt(h)||(u.state={line:Z({},og,h),symbol:Z({},og,h)});const c=new xK(u);c.name=tr.line,c.id=this._getNodeId("line"),t.add(c)}getTextAlign(t){let e="center";return di(t[0],0)?di(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const r=this.attribute.title,{position:s="middle",space:o=4,textStyle:a={},autoRotate:l=!0,shape:h,background:d,state:u={},maxWidth:c}=r,g=Bj(r,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let p=.5;s==="start"?p=0:s==="end"&&(p=1);const{verticalFactor:f=1}=this.attribute,m=-1*f,v=this.getTickCoord(p),_=this.getRelativeVector();let b=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){const B=+Dt(this.attribute,"label.space",4);b+=B;const E=Object.keys(this.axisLabelLayerSize).length;if(_[1]===0){const k=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(k)?b+=k+(E-1)*B:b=0}else if(_[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const k=this.axisLabelLayerSize[0].labelPos,P=this.axisLabelsContainer.AABBBounds;b+=(m===1?P.x2>k?Math.min(P.x2-k,P.width()):0:P.x1<k?Math.min(k-P.x1,P.width()):0)+(E-1)*B}else b=0;else Object.keys(this.axisLabelLayerSize).forEach((k,P)=>{b+=this.axisLabelLayerSize[k].width+(P>0?B:0)})}let y=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(y=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(y=Math.max(y,this.attribute.subTick.length||2));const C=y+b+o,S=this.getVerticalCoord(v,C,!1),w=this.getVerticalVector(C,!1,{x:0,y:0});let x,A,{angle:M}=g;if(x=s==="start"?"start":s==="end"?"end":"center",D(M)&&l){M=evt(_,[1,0],!0);const{verticalFactor:B=1}=this.attribute;A=-1*B===1?"bottom":"top"}else x=this.getTextAlign(w),A=this.getTextBaseline(w,!1);let T=c;if(D(T)){const{verticalLimitSize:B,verticalMinSize:E,orient:k}=this.attribute,P=Math.min(B||1/0,E||1/0);if(et(P))if(k==="bottom"||k==="top")if(M!==Math.PI/2){const I=Math.abs(Math.cos(M??0));T=I<1e-6?1/0:this.attribute.end.x/I}else T=P-C;else if(M&&M!==0){const I=Math.abs(Math.sin(M));T=I<1e-6?1/0:this.attribute.end.y/I}else T=P-C}const R=Object.assign(Object.assign(Object.assign({},S),g),{maxWidth:T,textStyle:Object.assign({textAlign:x,textBaseline:A},a),state:{text:Z({},og,u.text),shape:Z({},og,u.shape),panel:Z({},og,u.background)}});return R.angle=M,h&&h.visible&&(R.shape=Object.assign({visible:!0},h.style),h.space&&(R.space=h.space)),d&&d.visible&&(R.panel=Object.assign({visible:!0},d.style)),R}getTextBaseline(t,e){let i="middle";const{verticalFactor:r=1}=this.attribute,s=(e?1:-1)*r;return di(t[1],0)?i=!di(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":s===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const r=this.attribute.orient;if(["top","bottom","right","left"].includes(r)||t[0]===0&&t[1]===0){if(r==="top"||r==="bottom")return kK(e?r==="bottom"?"top":"bottom":r,i);if(r==="left"||r==="right")return RK(e?r==="left"?"right":"left":r,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,r,s){var o,a,l,h;const{flush:d=!1}=this.attribute.label||{};if(d&&t.length){const{orient:u,start:c,end:g}=this.attribute,p=u==="bottom"||u==="top",f=t[0],m=de(t),v=p?f.attribute.x>m.attribute.x:f.attribute.y<m.attribute.y;if(p){const _=v?m:f,b=v?f:m,y=c.x,C=g.x,S=_.AABBBounds.x1,w=b.AABBBounds.x2;S<y&&(_.attribute.angle?_.setAttributes({dx:((o=_.attribute.dx)!==null&&o!==void 0?o:0)+y-S}):_.setAttributes({x:y,textAlign:"left"})),w>C&&(b.attribute.angle?b.setAttributes({dx:((a=b.attribute.dx)!==null&&a!==void 0?a:0)+C-w}):b.setAttributes({x:C,textAlign:"right"}))}else{const _=v?m:f,b=v?f:m,y=_.AABBBounds.y2,C=b.AABBBounds.y1,S=c.y,w=g.y;C<S&&(b.attribute.angle?b.setAttributes({dy:((l=b.attribute.dy)!==null&&l!==void 0?l:0)+S-C}):b.setAttributes({y:S,textBaseline:"top"})),y>w&&(_.attribute.angle?_.setAttributes({dy:((h=_.attribute.dy)!==null&&h!==void 0?h:0)+w-y}):_.setAttributes({y:w,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,r,s){if(xt(t))return;const{verticalLimitSize:o,label:a,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(o,s),{layoutFunc:d,autoRotate:u,autoRotateAngle:c,autoLimit:g,limitEllipsis:p,autoHide:f,autoHideMethod:m,autoHideSeparation:v,lastVisible:_,firstVisible:b,autoWrap:y,overflowLimitLength:C}=a;if(it(d))d(t,e,r,this);else{if(u)Rvt(t,{labelRotateAngle:c,orient:l});else if(y){const S=Math.abs(l==="left"||l==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);Dvt(t,{orient:l,limitLength:h,axisLength:S,ellipsis:p})}if(!y&&g&&et(h)&&h>0){const S=l==="left"||l==="right",w=Math.abs(S?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),x=S?w/t.length:f||u?1/0:w/t.length;Ovt(t,{limitLength:h,verticalLimitLength:x,ellipsis:p,orient:l,axisLength:w,overflowLimitLength:C})}f&&kvt(t,{method:m,separation:v,lastVisible:_,firstVisible:b})}}afterLabelsOverlap(t,e,i,r,s){const{verticalLimitSize:o,orient:a}=this.attribute,l=a==="bottom"||a==="top",h=i.AABBBounds;let d=l?h.height():h.width();const{verticalMinSize:u}=this.attribute;if(et(u)&&(!et(o)||u<=o)){const c=this._getAxisLabelLimitLength(u,s);let g,p;d=Math.max(d,c),a==="left"?(g=h.x2-d,p=h.y1):a==="right"?(g=h.x1,p=h.y1):a==="top"?(g=h.x1,p=h.y2-d):a==="bottom"&&(g=h.x1,p=h.y1);const f=Ut.rect({x:g,y:p,width:l?h.width():d,height:l?d:h.height(),pickable:!1});f.name=tr.axisLabelBackground,f.id=this._getNodeId("axis-label-background"),i.insertBefore(f,i.firstChild)}if(L(this.attribute.label.containerAlign)){let c;a==="left"?c=h.x2-d:a==="right"?c=h.x1:a==="top"?c=h.y2-d:a==="bottom"&&(c=h.y1),Fvt(t,c,d,a,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,r,s,o,a;const{label:l,title:h,line:d,tick:u}=this.attribute,c=(i=l.space)!==null&&i!==void 0?i:4;let g=t,p=0,f=0;const m=d&&d.visible?(r=d.style.lineWidth)!==null&&r!==void 0?r:1:0,v=u&&u.visible?(s=u.length)!==null&&s!==void 0?s:4:0;if(h&&h.visible&&typeof h.text=="string"){p=cM(h.text,h.textStyle,(a=(o=this.stage)===null||o===void 0?void 0:o.getTheme())===null||a===void 0?void 0:a.text).height;const _=Fi(h.padding);f=h.space+_[0]+_[2]}return g&&(g=(g-c-f-p-m-v)/e),g}release(){super.release(),this._breaks=null}};WE.defaultAttributes=HE,Ye(WE,Hvt);const Gl=n=>n.map((t,e)=>({index:e,value:t})),Pj=(n,t,e=0)=>{const i=new ie(n).expand(e/2),r=new ie(t).expand(e/2);return i.intersects(r)},Ej=12,uy=(n,t,e,i)=>e<n?Math.max(n-t/2,e):e>n?Math.min(n-t/2,e-t):e<i?e:e-t,jE=(n,t,e)=>{var i;const{labelStyle:r,axisOrientType:s,labelFlush:o,labelFormatter:a,startAngle:l=0}=e;let h=(i=r.angle)!==null&&i!==void 0?i:0;r.direction==="vertical"&&(h+=Te(90));const d=["bottom","top"].includes(s),u=["left","right"].includes(s);let c=1,g=0;d||(u?(c=0,g=1):l&&(c=Math.cos(l),g=-Math.sin(l)));const p=pK(r),f=n.range();return t.map((v,_)=>{var b,y;const C=a?a(v):`${v}`,{width:S,height:w}=p.quickMeasure(C),x=Math.max(S,12),A=Math.max(w,12),M=n.scale(v),T=c*M,R=g*M;let B,E,k=T,P=R;o&&d&&_===0?k=uy(T,x,f[0],f[f.length-1]):o&&d&&_===t.length-1?k=uy(T,x,f[f.length-1],f[0]):B=(b=r.textAlign)!==null&&b!==void 0?b:"center",B==="right"?k-=x:B==="center"&&(k-=x/2),o&&u&&_===0?P=uy(R,A,f[0],f[f.length-1]):o&&u&&_===t.length-1?P=uy(R,A,f[f.length-1],f[0]):E=(y=r.textBaseline)!==null&&y!==void 0?y:"middle",E==="bottom"?P-=A:E==="middle"&&(P-=A/2);const I=new ie().set(k,P,k+x,P+A);return h&&I.rotate(h,T,R),I})},jvt=n=>["bottom","top","z"].includes(n);var Ls;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(Ls||(Ls={}));Object.values(Ls).forEach(n=>{});function PK(n){switch(n){case Ls.Linear:case Ls.Log:case Ls.Pow:case Ls.Sqrt:case Ls.Symlog:case Ls.Time:return!0;default:return!1}}function Nvt(n){switch(n){case Ls.Ordinal:case Ls.Point:case Ls.Band:return!0;default:return!1}}function dm(n){return n}function NE(n,t){if(n=Number(n),t=Number(t),t-=n)return i=>(i-n)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function Lj(n,t,e){const i=n[0],r=n[1],s=t[0],o=t[1];let a,l;return r<i?(a=NE(r,i),l=e(o,s)):(a=NE(i,r),l=e(s,o)),h=>l(a(h))}function $vt(n,t){const e=(n[1]-n[0])/(t[1]-t[0]),i=n[0]-e*t[0];return[i,e+i]}function Vvt(n,t,e){const i=Math.min(n.length,t.length)-1,r=new Array(i),s=new Array(i);let o=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=NE(n[o],n[o+1]),s[o]=e(t[o],t[o+1]);return function(a){const l=yO(n,a,1,i)-1;return s[l](r[l](a))}}let Gvt=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=$vt(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every(r=>r>=0&&r<=1)&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):L(this._rangeFactorStart)&&L(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return D(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!D(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return D(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!D(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,s=this.range(),o=s[0],a=s[s.length-1],l=Math.min(o,a),h=Math.max(o,a),d=Ne((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),u=D(r)?(h-l)*i:r;let c=Math.exp(e);c=c/(c-1)*u;const g=e/u;this._fishEyeTransform=p=>{const f=Math.abs(p-d);if(f>=u)return p;if(f<=1e-6)return d;const m=c*(1-Math.exp(-f*g))/f*.75+.25;return d+(p-d)*m}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return(i=this==null?void 0:this[t])!==null&&i!==void 0?i:e}};const{interpolateRgb:Pk}=FY;function Uvt(n,t){const e=typeof t;let i;if(D(t)||e==="boolean")return()=>t;if(e==="number")return Nl(n,t);if(e==="string"){if(i=Tn.parseColorString(t)){const r=Pk(Tn.parseColorString(n),i);return s=>r(s).formatRgb()}return Nl(Number(n),Number(t))}return t instanceof Cr?Pk(n,t):t instanceof Tn?Pk(n.color,t.color):t instanceof Date?xY(n,t):Nl(Number(n),Number(t))}let Yvt=class extends Gvt{constructor(t=dm,e=dm){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=dm,this._piecewise=Lj,this._interpolate=Uvt}calculateVisibleDomain(t){var e;return L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),Nl)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,zl);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=SY,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,r=i.length,s=this._range.length;let o=Math.min(r,s);if(r&&r<s&&this._forceAlign){const a=s-r+1,l=i[r-1],h=r>=2?(l-i[r-2])/a:0;for(let d=1;d<=a;d++)i[r-2+d]=l-h*(a-d);o=s}return this._autoClamp&&(this._clamp=gc(i[0],i[o-1])),this._piecewise=o>2?Vvt:Lj,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:dm),this.rescale(i)):this._clamp!==dm}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(e??[]).map((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return D(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return D(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};const Xvt=Math.sqrt(50),Kvt=Math.sqrt(10),qvt=Math.sqrt(2),cy=[1,2,5,10],Ij=(n,t,e)=>{let i=1,r=n;const s=Math.floor((t-1)/2),o=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(t-1):!e&&o<1?i=EK(o).step:(e||o>1)&&(r=Math.floor(n)-s*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(t-1)*i)),bO(0,t).map(a=>r+a*i)):n>0?ux(0,-(t-1)/i,i):ux((t-1)/i,0,i)},Zvt=Gc((n,t,e,i)=>{let r,s,o,a,l=-1;if(e=+e,(n=+n)==(t=+t))return[n];if(Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return[n];if((r=t<n)&&(s=n,n=t,t=s),a=KO(n,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(n/a),d=Math.round(t/a);for(h*a<n&&++h,d*a>t&&--d,o=new Array(s=d-h+1);++l<s;)o[l]=(h+l)*a}else if(a<0&&(i!=null&&i.noDecimals)){a=1;const h=Math.ceil(n),d=Math.floor(t);if(!(h<=d))return[];for(o=new Array(s=d-h+1);++l<s;)o[l]=h+l}else{a=-a;let h=Math.round(n*a),d=Math.round(t*a);for(h/a<n&&++h,d/a>t&&--d,o=new Array(s=d-h+1);++l<s;)o[l]=(h+l)/a}return r&&o.reverse(),o}),ux=(n,t,e)=>{let i,r,s=-1;if(e>0){let o=Math.floor(n/e),a=Math.ceil(t/e);for((o+1)*e<n&&++o,(a-1)*e>t&&--a,r=new Array(i=a-o+1);++s<i;)r[s]=(o+s)*e}else{e=-e;let o=Math.floor(n*e),a=Math.ceil(t*e);for((o+1)/e<n&&++o,(a-1)/e>t&&--a,r=new Array(i=a-o+1);++s<i;)r[s]=(o+s)/e}return r},Jvt=(n,t,e)=>{let i;const r=n[0],s=n[n.length-1],o=t-n.length;if(s<=0){const h=[];for(i=o;i>=1;i--)h.push(r-i*e);return h.concat(n)}if(r>=0){for(i=1;i<=o;i++)n.push(s+i*e);return n}let a=[];const l=[];for(i=1;i<=o;i++)i%2==0?a=[r-Math.floor(i/2)*e].concat(a):l.push(s+Math.ceil(i/2)*e);return a.concat(n).concat(l)},Qvt=Gc((n,t,e,i)=>{let r,s,o;if(e=+e,(n=+n)==(t=+t)||Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return Ij(n,e,i==null?void 0:i.noDecimals);(r=t<n)&&(o=n,n=t,t=o);const a=KO(n,t,e);let l=a.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:d,gap:u}=a,c=u===10?2*10**d:1*10**d;for(;h<=5&&(s=ux(n,t,l),s.length>e+1)&&e>2;)l+=c,h+=1;e>2&&s.length<e-1&&(s=Jvt(s,e,l))}else i!=null&&i.noDecimals&&l<0&&(l=1),s=ux(n,t,l);return r&&s.reverse(),s}),EK=n=>{const t=Math.floor(Math.log(n)/Math.LN10),e=n/10**t;let i=cy[0];return e>=Xvt?i=cy[3]:e>=Kvt?i=cy[2]:e>=qvt&&(i=cy[1]),t>=0?{step:i*10**t,gap:i,power:t}:{step:-(10**-t)/i,gap:i,power:t}};function KO(n,t,e){const i=(t-n)/Math.max(0,e);return EK(i)}function t_t(n,t,e){let i;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if(e<=0||(i=e_t(n,t,e))===0||!isFinite(i))return[];const r=new Array(e);for(let s=0;s<e;s++)r[s]=n+s*i;return r}function e_t(n,t,e){return(t-n)/Math.max(1,e-1)}function i_t(n,t,e){let i,r,s=-1;if(e=+e,(r=(t=+t)<(n=+n))&&(i=n,n=t,t=i),!isFinite(e)||t-n<=e)return[n];const o=Math.floor((t-n)/e+1),a=new Array(o);for(;++s<o;)a[s]=n+s*e;return r&&a.reverse(),a}function Ek(n,t=10){let e,i,r=0,s=n.length-1,o=n[r],a=n[s],l=10;for(a<o&&(i=o,o=a,a=i,i=r,r=s,s=i);l-- >0;){if(i=KO(o,a,t).step,i===e)return n[r]=o,n[s]=a,n;if(i>0)o=Math.floor(o/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;o=Math.ceil(o*i)/i,a=Math.floor(a*i)/i}e=i}}function n_t(n,t){const e=J(t.forceMin),i=J(t.forceMax);let r=null;const s=[];let o=null;const a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?s[0]=t.forceMin:J(t.min)&&t.min<=Math.min(n[0],n[n.length-1])&&(s[0]=t.min),i?s[1]=t.forceMax:J(t.max)&&t.max>=Math.max(n[0],n[n.length-1])&&(s[1]=t.max),J(s[0])&&J(s[1])?(o=n.slice(),o[0]=s[0],o[o.length-1]=s[1]):r=J(s[0])||J(s[1])?J(s[0])?"max":"min":"all",{niceType:r,niceDomain:o,niceMinMax:s,domainValidator:a}}let r_t=class LK extends Yvt{constructor(){super(...arguments),this.type=Ls.Linear}clone(){var t;const e=new LK;return e.domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate),this._niceType&&(e._niceType=this._niceType,e._domainValidator=this._domainValidator,e._niceDomain=(t=this._niceDomain)===null||t===void 0?void 0:t.slice()),e}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return Zvt(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(it(e==null?void 0:e.customTicks))return e.customTicks(this,t);if(L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,s=this._domain,o=r[0],a=r[r.length-1];let l=Qvt(s[0],s[s.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==o||l[l.length-1]!==a)&&this._niceType){const h=r.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==o?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const d=Math.min(h[0],h[h.length-1]),u=Math.max(h[0],h[h.length-1]);l=l.filter(c=>c>=d&&c<=u)}}return l}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return t_t(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return i_t(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const s=this._domain;let o=[];if(e){const a=n_t(s,e);if(o=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const a=Ek(s.slice(),t);this._niceType==="min"?a[a.length-1]=(i=o[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(r=o[0])!==null&&r!==void 0?r:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=Ek(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=Ek(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}};function Lk(n,t,e,i){let r;const{breakData:s}=n;if(s&&s()){const{breakDomains:o}=s(),a=t.domain();r=[];for(let l=0;l<a.length-1;l++)i(e,[a[l],a[l+1]]).forEach(h=>{o.some(d=>h>=d[0]&&h<=d[1])||r.push(h)});t.domain(a)}else r=i(e);return r}function Oj(n,t,e,i,r=!1){if(e&&!t.includes(n)){let s=t.length;if(s>1){r?t.push(n):t.unshift(n);for(let o=0;o<s;o++){const a=r?s-1-o:o;if(!i(t[a]))break;t.splice(a,1),o--,s--}}}}const s_t=(n,t)=>{var e,i;if(!PK(n.type))return Gl(n.domain());const r=n.range(),s=Math.abs(r[r.length-1]-r[0]);if(s<2)return Gl([n.domain()[0]]);const{tickCount:o,forceTickCount:a,tickStep:l,noDecimals:h=!1,labelStyle:d,breakData:u}=t;let c;if(L(l))g=n.stepTicks(l),p=u&&u()?u().breakDomains:null,c=p&&p.length?g.filter(m=>p.every(v=>m<v[0]||m>v[1])):g;else if(L(a))c=Lk(t,n,a,(m,v)=>v&&v.length?n.domain(v,!0).forceTicks(m):n.forceTicks(m));else if(t.tickMode==="d3"){const m=(e=it(o)?o({axisLength:s,labelStyle:d}):o)!==null&&e!==void 0?e:5;c=Lk(t,n,m,(v,_)=>_&&_.length?n.domain(_,!0).d3Ticks(v,{noDecimals:h}):n.d3Ticks(v,{noDecimals:h}))}else{const m=(i=it(o)?o({axisLength:s,labelStyle:d}):o)!==null&&i!==void 0?i:5,v=it(t.tickMode)?t.tickMode:void 0;c=Lk(t,n,m,(_,b)=>b&&b.length?n.domain(b,!0).ticks(_,{noDecimals:h,customTicks:v}):n.ticks(_,{noDecimals:h,customTicks:v}))}var g,p;const f=n.domain();if(t.labelFirstVisible&&f[0]!==c[0]&&!c.includes(f[0])&&c.unshift(f[0]),t.labelLastVisible&&f[f.length-1]!==c[c.length-1]&&!c.includes(f[f.length-1])&&c.push(f[f.length-1]),t.sampling&&c.length>1&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){const{labelGap:m=4,labelFlush:v}=t,_=6;let b;if(c.length*_>s){const M=[],T=Math.floor(c.length*_/s);c.forEach((R,B)=>{B%T!=0&&B!==c.length-1||M.push(R)}),b=jE(n,M,t).map((R,B)=>({AABBBounds:R,value:M[B]}))}else b=jE(n,c,t).map((M,T)=>({AABBBounds:M,value:c[T]}));const y=b[0],C=de(b),S=u&&u()?Dj.greedy:Dj.parity;for(;b.length>=3&&zE(b,m);)b=S(b,m);const w=t.labelFirstVisible;let x=t.labelLastVisible;Ko(y,C,m)&&b.includes(C)&&b.length>1&&w&&x&&(b.splice(b.indexOf(C),1),x=!1),Oj(y,b,w,M=>Ko(M,y,m)),Oj(C,b,x,M=>Ko(M,C,m)||!(!w||M===y)&&Ko(M,y,m),!0);const A=b.map(M=>M.value);A.length<3&&v&&(A.length>1&&A.pop(),de(A)!==de(c)&&A.push(de(c))),c=A}return Gl(c)},Dj={parity:function(n){return n.filter((t,e)=>e%2==0)},greedy:function(n,t){let e;return n.filter((i,r)=>(!r||!Ko(e,i,t))&&(e=i,!0))}},Fj=(n,t,e,i)=>jE(n,t,e).map(r=>i?[r.x1,r.x2,r.width()]:[r.y1,r.y2,r.height()]),Hj=(n,t,e=0)=>Math.max(n[0],t[0])-e/2<=Math.min(n[1],t[1])+e/2,zj=(n,t)=>n[1]<t[0]?t[0]-n[1]:t[1]<n[0]?n[0]-t[1]:0,o_t=(n,t)=>{var e;const i=n.domain();if(!i.length)return[];const{tickCount:r,forceTickCount:s,tickStep:o,labelGap:a=4,axisOrientType:l,labelStyle:h}=t,d=jvt(l),u=n.range(),c=n.calculateWholeRangeSize();if(c<2)return t.labelLastVisible?Gl([i[i.length-1]]):Gl([i[0]]);let g;if(L(o))g=n.stepTicks(o);else if(L(s))g=n.forceTicks(s);else if(L(r)){const p=it(r)?r({axisLength:c,labelStyle:h}):r;g=n.ticks(p)}else if(t.sampling){const p=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,f=Ri(u),m=Mi(u);if(i.length<=c/p){const v=(m-f)/i.length,_=Fj(n,i,t,d),b=Math.min(..._.map(C=>C[2])),y=a_t(i,_,a,t.labelLastVisible,Math.floor(b/v));g=n.stepTicks(y.step),t.labelLastVisible&&(y.delCount&&(g=g.slice(0,g.length-y.delCount)),g.push(i[i.length-1]))}else{const v=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],_=Fj(n,v,t,d);let b=null;_.forEach(C=>{b?b[2]<C[2]&&(b=C):b=C});const y=m-f-a>0?Math.ceil(i.length*(a+b[2])/(m-f-a)):i.length-1;g=n.stepTicks(y),!t.labelLastVisible||g.length&&g[g.length-1]===i[i.length-1]||(g.length&&Math.abs(n.scale(g[g.length-1])-n.scale(i[i.length-1]))<b[2]&&(g=g.slice(0,-1)),g.push(i[i.length-1]))}}else g=n.domain();return Gl(g)},a_t=(n,t,e,i,r,s)=>{let o=0,a=0,l=-1,h=Number.MAX_VALUE;const d=g=>{let p=!0,f=0;do f+g<n.length&&Hj(t[f],t[f+g],e)&&(p=!1),f+=g;while(p&&f<n.length);return p},u=CO(r,n.length,g=>d(g)?1:-1);let c=u;do if(c>u&&!d(c))c++;else{if(!i){a=c;break}{const g=n.length-1;let p,f=0;p=n.length%c>0?n.length-n.length%c+c:n.length;do{if(p-=c,p!==g&&!Hj(t[p],t[g],e))break;f++}while(p>0);if(p===g){a=c,o=f;break}{const m=Math.floor(n.length/c)-f+1;if(m<l)break;{l=m;const v=zj(t[p],t[g]),_=p-c>=0?zj(t[p-c],t[p]):v,b=Math.abs(v-_);if(b<h&&(h=b,a=c,o=f),v<=_)break}}}c++}while(c<=n.length);return{step:a,delCount:o}},l_t=(n,t,e)=>{var i;const{labelStyle:r,getRadius:s,labelOffset:o,labelFormatter:a,inside:l}=e,h=s==null?void 0:s(),d=(i=r.angle)!==null&&i!==void 0?i:0,u=pK(r);return t.map(c=>{const g=a?a(c):`${c}`,{width:p,height:f}=u.quickMeasure(g),m=Math.max(p,Ej),v=Math.max(f,Ej),_=n.scale(c),b={x:0,y:0};let y=0,C=0;const S={align:r.textAlign,baseline:r.textBaseline},{x:w,y:x}=Cvt(_,b,h,o,l);return S.align||(di(w,b.x)?S.baseline||(S.baseline=x>b.y?"top":"bottom"):w>b.x?S.align="left":w<b.x&&(S.align="right")),y=w+(S.align==="right"?-m:S.align==="left"?0:-m/2),C=x+(S.baseline==="bottom"?-v:S.baseline==="top"?0:-v/2),new ie().set(y,C,y+m,C+v).rotate(d,y+m/2,C+v/2)})},h_t=(n,t)=>{const{tickCount:e,forceTickCount:i,tickStep:r,getRadius:s,labelOffset:o,labelGap:a=0,labelStyle:l}=t,h=s==null?void 0:s();if(!h)return Gl(n.domain());let d;if(L(r))d=n.stepTicks(r);else if(L(i))d=n.forceTicks(i);else if(L(e)){const u=n.range(),c=Math.abs(u[u.length-1]-u[0]),g=it(e)?e({axisLength:c,labelStyle:l}):e;d=n.ticks(g)}else if(t.sampling){const u=n.domain(),c=n.range(),g=l_t(n,u,t),p=Ri(c),f=Mi(c),m=Math.abs(f-p)*(h+o)/u.length,{step:v,delCount:_}=d_t(u,g,a,Math.floor(g.reduce((b,y)=>Math.min(b,y.width(),y.height()),Number.MAX_VALUE)/m));d=n.stepTicks(v),d=d.slice(0,d.length-_)}else d=n.domain();return Gl(d)},d_t=(n,t,e,i)=>{let r=i;do{let o=!0;r++;let a=0;do a+r<n.length&&Pj(t[a],t[a+r],e)&&(o=!1),a+=r;while(o&&a<n.length);if(o)break}while(r<=n.length);let s=0;if(n.length>2){let o=n.length-n.length%r;for(o>=n.length&&(o-=r);o>0&&Pj(t[0],t[o]);)s++,o-=r}return{step:r,delCount:s}},u_t=(n,t)=>{if(PK(n.type))return s_t(n,t);if(Nvt(n.type)){if(t.coordinateType==="cartesian")return o_t(n,t);if(t.coordinateType==="polar"&&t.axisOrientType==="angle")return h_t(n,t)}return Gl(n.domain())};function IK(){gs(),Df(),sl()}const OK={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};IK();let $E=class DK extends Gs{getCurrent(){return this._current}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},DK.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=i=>{const r=i.target;r.hasState("disable")||r.addState("hover")},this._onUnHover=i=>{i.target.removeState("hover")},this._onClick=i=>{const r=i.target;if(r.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:i})}if(r.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:i})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:r="horizontal",handler:s=OK,total:o,defaultCurrent:a=1,textStyle:l,padding:h=0}=this.attribute;this._current=a;const d=Fi(h),u=r==="horizontal",c=Ut.group({x:0,y:0}),g=s.style||{},p=g.size||15,f=(t=s.space)!==null&&t!==void 0?t:8,m=s.state||{};let{preShape:v,nextShape:_}=s;v||(v=u?"triangleLeft":"triangleUp"),_||(_=u?"triangleRight":"triangleDown");const b=Ut.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:0,y:0,symbolType:v,size:p}));b.states=m,b.name="preHandler",this.preHandler=b,c.add(b);const{width:y,height:C}=cM(this._getPageText(o),Object.assign({textAlign:"center",textBaseline:"middle"},l),(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),S=J(p)?p:p[0],w=J(p)?p:p[1],x=Ut.text(Object.assign({x:u?S/2+f+y/2:0,y:u?0:w/2+f+C/2,text:this._getPageText(a),textAlign:"center",textBaseline:"middle",lineHeight:l==null?void 0:l.fontSize},l));this.text=x,c.add(x);const A=Ut.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:u?S+2*f+y:0,y:u?0:w+2*f+C,symbolType:_,size:p}));A.name="nextHandler",A.states=m,this.nextHandler=A,c.add(A),this._total===1?(b.addState("disable"),A.addState("disable")):this._current===1?b.addState("disable"):this._current===o&&A.addState("disable");const M=c.AABBBounds,T=M.width(),R=M.height();c.translateTo(0-M.x1+d[3],0-M.y1+d[0]),this.add(c),this.attribute.width=T+d[1]+d[3],this.attribute.height=R+d[0]+d[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?it(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,this._current!==1&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}};$E.defaultAttributes={handler:OK,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const cx=10,FK=8,HK=8,c_t=8,bC=16,yC=8,nb=12,VE=12;var qt;(function(n){n.selected="selected",n.unSelected="unSelected",n.selectedHover="selectedHover",n.unSelectedHover="unSelectedHover",n.focus="focus"})(qt||(qt={}));var io;(function(n){n.legendItemHover="legendItemHover",n.legendItemUnHover="legendItemUnHover",n.legendItemClick="legendItemClick",n.legendItemAttributeUpdate="legendItemAttributeUpdate"})(io||(io={}));var Jn;(function(n){n.innerView="innerView",n.title="legendTitle",n.item="legendItem",n.itemShape="legendItemShape",n.itemLabel="legendItemLabel",n.itemValue="legendItemValue",n.focus="legendItemFocus"})(Jn||(Jn={}));let qO=class extends Gs{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=Fi(i);const r=Ut.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});r.name=Jn.innerView,this.add(r),this._innerView=r,e!=null&&e.visible&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const s=this._innerView.AABBBounds;this.attribute.width=s.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=s.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:r=0,background:s,minWidth:o,maxWidth:a,shape:l}=t,h={x:0,y:0,text:e,textStyle:i,padding:Fi(r),minWidth:o,maxWidth:a};l&&l.visible&&(h.shape=Object.assign({visible:!0},l.style),L(l.space)&&(h.space=l.space)),s&&s.visible&&(h.panel=Object.assign({visible:!0},s.style));const d=new ib(h);d.name=Jn.title,this._title=d,this._innerView.add(d)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),r=(t=this.attribute.title)===null||t===void 0?void 0:t.align;r==="center"?this._title.setAttribute("x",(e-i)/2):r==="end"&&this._title.setAttribute("x",e-i)}}};function ZO(){gs(),sl(),hh(),Df()}function JO(){gs(),vK()}function g_t(){JO(),IK(),hK()}function p_t(){JO(),ZO()}function f_t(){JO(),ZO(),Gmt()}var Wj=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const m_t={[qt.focus]:{},[qt.selected]:{},[qt.selectedHover]:{},[qt.unSelected]:{},[qt.unSelectedHover]:{}};g_t();let zK=class WK extends qO{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},WK.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=i=>{const r=i.target;if(r&&r.name&&r.name.startsWith(Jn.item)){const s=r.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===s.id)return;this._unHover(this._lastActiveItem,i)}this._hover(s,i)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onUnHover=i=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onClick=i=>{var r,s,o,a;const l=i.target;if(l&&l.name&&l.name.startsWith(Jn.item)){const h=l.delegate,{selectMode:d="multiple"}=this.attribute;if(l.name===Jn.focus||d==="focus"){const u=h.hasState(qt.focus);h.toggleState(qt.focus),u?(r=this._itemsContainer)===null||r===void 0||r.getChildren().forEach(c=>{this._removeLegendItemState(c,[qt.unSelected,qt.unSelectedHover,qt.focus],i),this._setLegendItemState(c,qt.selected,i)}):(this._setLegendItemState(h,qt.selected,i),this._removeLegendItemState(h,[qt.unSelected,qt.unSelectedHover],i),(s=this._itemsContainer)===null||s===void 0||s.getChildren().forEach(c=>{h!==c&&(this._removeLegendItemState(c,[qt.selected,qt.selectedHover,qt.focus],i),this._setLegendItemState(c,qt.unSelected,i))}))}else{(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach(p=>{p.removeState(qt.focus)});const{allowAllCanceled:u=!0}=this.attribute,c=h.hasState(qt.selected),g=this._getSelectedLegends();if(d==="multiple"){if(u===!1&&c&&g.length===1)return void this._dispatchLegendEvent(io.legendItemClick,h,i);c?(this._removeLegendItemState(h,[qt.selected,qt.selectedHover],i),this._setLegendItemState(h,qt.unSelected,i)):(this._setLegendItemState(h,qt.selected,i),this._removeLegendItemState(h,[qt.unSelected,qt.unSelectedHover],i))}else this._setLegendItemState(h,qt.selected,i),this._removeLegendItemState(h,[qt.unSelected,qt.unSelectedHover],i),(a=this._itemsContainer)===null||a===void 0||a.getChildren().forEach(p=>{h!==p&&(this._removeLegendItemState(p,[qt.selected,qt.selectedHover],i),this._setLegendItemState(p,qt.unSelected,i))})}this._dispatchLegendEvent(io.legendItemClick,h,i)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;((e=this._itemsContainer)===null||e===void 0?void 0:e.getChildren()).forEach(i=>{const r=i.data;t.includes(r.label)?(this._setLegendItemState(i,qt.selected),this._removeLegendItemState(i,[qt.unSelected,qt.unSelectedHover])):(this._removeLegendItemState(i,[qt.selected,qt.selectedHover]),this._setLegendItemState(i,qt.unSelected))})}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:r,defaultSelected:s,lazyload:o,autoPage:a}=this.attribute,{spaceCol:l=bC,spaceRow:h=yC,verticalAlign:d="middle"}=t,u=this._itemsContainer,{items:c,isHorizontal:g,startIndex:p,isScrollbar:f}=this._itemContext,m=f?1:g?i:e,v=this._contentMaxHeight;let _,{doWrap:b,maxWidthInCol:y,startX:C,startY:S,pages:w}=this._itemContext,x=0,A=0;const M=[];for(let T=p,R=c.length;T<R&&!(o&&w>this._itemContext.currentPage*m);T++){o&&(this._itemContext.startIndex=T+1),_=c[T],_.id||(_.id=_.label),_.index=T;let B=!0;V(s)&&(B=s.includes(_.label));const E=this._renderEachItem(_,B,T,c),k=E.attribute.width,P=E.attribute.height;this._itemHeight=Math.max(this._itemHeight,P),y=Math.max(k,y),this._itemMaxWidth=Math.max(k,this._itemMaxWidth),g?(L(r)&&(f&&a?(w=Math.ceil((C+k)/r),b=w>1):C+k>r&&(b=!0,C>0&&(d!=="middle"&&d!=="bottom"||M.forEach(I=>{I.setAttributes({y:I.attribute.y+(A-I.attribute.height)/(d==="middle"?2:1)})}),w+=1,C=0,S+=A+h,A=0,M.length=0))),C===0&&S===0||E.setAttributes({x:C,y:S}),C+=l+k,A=Math.max(A,P),M.push(E)):(L(v)&&(f&&a?(w=Math.ceil((S+P)/v),b=w>1):v<=P?(w+=1,b=!0,S=0,T>0&&(C+=x+l)):v<S+P&&(w+=1,b=!0,S=0,C+=y+l,y=0)),C===0&&S===0||E.setAttributes({x:C,y:S}),S+=h+P),u.add(E),x=k}return!g||d!=="middle"&&d!=="bottom"||M.forEach(T=>{T.setAttributes({y:T.attribute.y+(A-T.attribute.height)/(d==="middle"?2:1)})}),this._itemContext.doWrap=b,this._itemContext.startX=C,this._itemContext.startY=S,this._itemContext.maxWidthInCol=y,this._itemContext.pages=w,this._itemContext.maxPages=m,f&&(this._itemContext.totalPage=w),o||(this._itemContext.startIndex=c.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:r,maxHeight:s}=this.attribute;if(t.visible===!1||xt(e))return;let o=e;i&&(o=e==null?void 0:e.reverse()),this._contentMaxHeight=Math.max(0,s-this._parsedPadding[0]-this._parsedPadding[2]);const a=Ut.group({x:0,y:0});this._itemsContainer=a;const{layout:l,autoPage:h}=this.attribute,d=l==="horizontal",{maxWidth:u,width:c,height:g}=t,p=[];L(u)&&p.push(u),L(c)&&p.push(c),p.length&&(L(r)&&p.push(r),this._itemWidthByUser=Ri(p)),L(g)&&(this._itemHeightByUser=g);const f=this.attribute.pager;this._itemContext={currentPage:f&&f.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:o,isHorizontal:d,totalPage:1/0,isScrollbar:f&&f.type==="scrollbar",clipContainer:void 0},this._itemContext=this._renderItems();let m=!1;this._itemContext.doWrap&&h&&this._itemContext.pages>this._itemContext.maxPages&&(m=this._renderPagerComponent()),m||(a.setAttribute("y",this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",8):0),this._innerView.add(a))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;if(t){let i="pointermove",r="pointerleave";kt(t)&&(t.trigger&&(i=t.trigger),t.triggerOff&&(r=t.triggerOff)),this._itemsContainer.addEventListener(i,this._onHover),this._itemsContainer.addEventListener(r,this._onUnHover)}if(e){let i="pointerdown";kt(e)&&e.trigger&&(i=e.trigger),this._itemsContainer.addEventListener(i,this._onClick)}}_autoEllipsis(t,e,i,r){var s,o;const{label:a,value:l}=this.attribute.item,h=r.AABBBounds,d=i.AABBBounds,u=h.width(),c=d.width();let g=!1;t==="labelFirst"?c>e?g=!0:r.setAttribute("maxLineWidth",e-c):t==="valueFirst"?u>e?g=!0:i.setAttribute("maxLineWidth",e-u):u+c>e&&(g=!0),g&&(r.setAttribute("maxLineWidth",Math.max(e*((s=a.widthRatio)!==null&&s!==void 0?s:.5),e-c)),i.setAttribute("maxLineWidth",Math.max(e*((o=l.widthRatio)!==null&&o!==void 0?o:.5),e-u)))}_renderEachItem(t,e,i,r){var s,o;const{id:a,label:l,value:h,shape:d}=t,{padding:u=0,focus:c,focusIconStyle:g,align:p,autoEllipsisStrategy:f}=this.attribute.item,{shape:m,label:v,value:_,background:b}=this.attribute.item,y=this._handleStyle(m,t,e,i,r),C=this._handleStyle(v,t,e,i,r),S=this._handleStyle(_,t,e,i,r),w=this._handleStyle(b,t,e,i,r),x=Fi(u);let A;b.visible===!1?(A=Ut.group({x:0,y:0,cursor:(s=w.style)===null||s===void 0?void 0:s.cursor}),this._appendDataToShape(A,Jn.item,t,A)):(A=Ut.group(Object.assign({x:0,y:0},w.style)),this._appendDataToShape(A,Jn.item,t,A,w.state)),A.id=`${a??l}-${i}`,A.addState(e?qt.selected:qt.unSelected);const M=Ut.group({x:0,y:0,pickable:!1});A.add(M);let T,R=0,B=0,E=0;if(m&&m.visible!==!1){const G=Dt(y,"style.size",cx);B=V(G)?G[0]||0:G,E=Dt(m,"space",FK);const tt=Ut.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},d),y.style));Object.keys(y.state||{}).forEach(st=>{const ot=y.state[st].fill||y.state[st].stroke;d.fill&&D(y.state[st].fill)&&ot&&(y.state[st].fill=ot),d.stroke&&D(y.state[st].stroke)&&ot&&(y.state[st].stroke=ot)}),this._appendDataToShape(tt,Jn.itemShape,t,A,y.state),tt.addState(e?qt.selected:qt.unSelected),M.add(tt)}let k=0;if(c){const G=Dt(g,"size",cx);T=Ut.symbol(Object.assign(Object.assign({x:0,y:-G/2-1,strokeBoundsBuffer:0,boundsPadding:x},g),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(T,Jn.focus,t,A),k=G}const P=v.formatMethod?v.formatMethod(l,t,i):l,I=Object.assign(Object.assign({x:B/2+E,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(o=C.style)===null||o===void 0?void 0:o.fontSize},C.style),{text:P,_originText:v.formatMethod?l:void 0}),O=OE(I);this._appendDataToShape(O,Jn.itemLabel,t,A,C.state),O.addState(e?qt.selected:qt.unSelected),M.add(O);const H=Dt(v,"space",HK);if(L(h)){const G=Dt(_,"space",c?c_t:0),tt=_.formatMethod?_.formatMethod(h,t,i):h,st=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:S.style.fontSize},S.style),{text:tt,_originText:_.formatMethod?h:void 0}),ot=OE(st);if(this._appendDataToShape(ot,Jn.itemValue,t,A,S.state),ot.addState(e?qt.selected:qt.unSelected),this._itemWidthByUser){const rt=this._itemWidthByUser-x[1]-x[3]-B-E-H-k-G;this._autoEllipsis(f,rt,O,ot),_.alignRight?ot.setAttributes({textAlign:"right",x:this._itemWidthByUser-B/2-x[1]-x[3]-k-G}):ot.setAttribute("x",H+(O.AABBBounds.empty()?0:O.AABBBounds.x2))}else ot.setAttribute("x",H+(O.AABBBounds.empty()?0:O.AABBBounds.x2));R=G+(ot.AABBBounds.empty()?0:ot.AABBBounds.x2),M.add(ot)}else this._itemWidthByUser&&O.setAttribute("maxLineWidth",this._itemWidthByUser-x[1]-x[3]-B-E-k),R=H+(O.AABBBounds.empty()?0:O.AABBBounds.x2);T&&(T.setAttribute("x",R),M.add(T));const z=M.AABBBounds,F=z.width();if(p==="right"){const G=z.x2,tt=z.x1;M.forEachChildren((st,ot)=>{st.type!=="symbol"&&st.attribute.textAlign!=="right"||st===T?st.setAttribute("x",tt+G-st.attribute.x-st.AABBBounds.width()):st.type!=="symbol"?st.setAttributes({x:tt+G-st.attribute.x,textAlign:"left"}):st.setAttribute("x",tt+G-st.attribute.x)})}const j=z.height(),$=L(this.attribute.item.width)?this.attribute.item.width:F+x[1]+x[3],Y=this._itemHeightByUser||j+x[0]+x[2];return A.attribute.width=$,A.attribute.height=Y,T&&T.setAttribute("visible",!1),M.translateTo(-z.x1+x[3],-z.y1+x[0]),A}_createPager(t){var e,i;const{disableTriggerEvent:r,maxRow:s}=this.attribute,o=a=>a<=99?99:a<=999?999:9999;return this._itemContext.isHorizontal?new $E(Object.assign(Object.assign({layout:s===1?"horizontal":"vertical",total:o(this._itemContext.pages)},Z({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:(e=this.attribute.pager)===null||e===void 0?void 0:e.defaultCurrent,disableTriggerEvent:r})):new $E(Object.assign({layout:"horizontal",total:o(this._itemContext.pages),disableTriggerEvent:r,defaultCurrent:(i=this.attribute.pager)===null||i===void 0?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new W_(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:t.visible===!1?0:12},t),{width:e})):new W_(Object.assign(Object.assign({direction:"vertical",width:t.visible===!1?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){const{pager:r}=this.attribute,{totalPage:s,isHorizontal:o}=this._itemContext,a=r&&r.position||"middle";if(this._pagerComponent.setTotal(s),o){let l;l=a==="start"?t:a==="end"?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:l})}else{let l;l=a==="start"?0:a==="end"?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:l,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,r=e.AABBBounds;let s,o;return t?(o=r.width(),s=o/i.width()):(o=r.height(),s=o/i.height()),s}_updatePositionOfScrollbar(t,e,i){const{isHorizontal:r,currentPage:s,totalPage:o}=this._itemContext,a=(s-1)/o;this._pagerComponent.setScrollRange([a,a+this._computeScrollbarDelta()]),r?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:r=!0,animationDuration:s=450,animationEasing:o="quadIn"}=i,a=this._itemContext.isScrollbar?d=>{const{value:u}=d.detail;let c;return c=u[0]===0?1:u[1]===1?this._itemContext.totalPage:u[0]*this._itemContext.totalPage+1,c}:d=>d.detail.current,l=d=>{const u=this._pagerComponent,c=u.getScrollRange(),{direction:g}=u.attribute,{width:p,height:f}=u.getSliderRenderBounds(),m=g==="vertical"?d.deltaY/f:d.deltaX/p;u.setScrollRange([c[0]+m,c[1]+m],!0),this.updateScrollMask()},h=d=>{const u=a(d);if(u!==this._itemContext.currentPage){if(this._itemContext.currentPage=u,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const c=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=c,this._itemContext.isScrollbar&&this._pagerComponent){const g=this._computeScrollbarDelta(),[p]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([p,p+g])}}if(this._itemContext.isScrollbar){const[c]=this._pagerComponent.getScrollRange();let g;g=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const p=g*c;this.updateScrollMask(),r?this._itemsContainer.animate().to({[e]:-p},s,o):this._itemsContainer.setAttribute(e,-p)}else r?this._itemsContainer.animate().to({[e]:-(u-1)*t},s,o):this._itemsContainer.setAttribute(e,-(u-1)*t)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",h),this._pagerComponent.addEventListener("scrollUp",h),this.attribute.pager.roamScroll&&(this.addEventListener("wheel",u=>u.nativeEvent.preventDefault()),this.addEventListener("wheel",ha(l,50)))):(this._pagerComponent.addEventListener("toPrev",h),this._pagerComponent.addEventListener("toNext",h))}_renderPager(){const t=this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:r=2,item:s={},pager:o={}}=this.attribute,{spaceCol:a=bC,spaceRow:l=yC}=s,h=this._itemsContainer,{space:d=VE,defaultCurrent:u=1}=o,c=Wj(o,["space","defaultCurrent"]),{isHorizontal:g}=this._itemContext,p=this._contentMaxHeight;let f,m=0,v=0,_=0,b=0,y=0,C=0,S=1;if(g){if(v=(r-1)*l+this._itemHeight*r,m=e,f=this._createPager(c),this._pagerComponent=f,this._innerView.add(f),_=e-f.AABBBounds.width()-d,_<=0)return this._innerView.removeChild(f),!1;h.getChildren().forEach((A,M)=>{const{width:T,height:R}=A.attribute;_<y+T&&(y=0,C+=R+l,S+=1),M>0&&A.setAttributes({x:y,y:C}),y+=a+T}),this._itemContext.startX=y,this._itemContext.startY=C,this._itemContext.pages=S;const x=Math.ceil(S/r);this._itemContext.totalPage=x,this._updatePositionOfPager(t,m,v)}else{if(m=this._itemMaxWidth*i+(i-1)*a,v=p,_=m,f=this._createPager(c),this._pagerComponent=f,this._innerView.add(f),b=p-f.AABBBounds.height()-d-t,b<=0)return this._innerView.removeChild(f),!1;h.getChildren().forEach((A,M)=>{const{height:T}=A.attribute;b<C+T&&(C=0,y+=this._itemMaxWidth+a,S+=1),M>0&&A.setAttributes({x:y,y:C}),C+=l+T});const x=Math.ceil(S/i);this._itemContext.totalPage=x,this._updatePositionOfPager(t,m,v)}u>1&&(g?h.setAttribute("y",-(u-1)*(v+l)):h.setAttribute("x",-(u-1)*(m+a)));const w=Ut.group({x:0,y:t,width:g?_:m,height:g?v:b,clip:!0,pickable:!1});return w.add(h),this._innerView.add(w),this._itemContext.clipContainer=w,this._bindEventsOfPager(g?v+l:m+a,g?"y":"x"),!0}_renderScrollbar(){var t;const e=this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",8):0,{maxWidth:i,item:r={},pager:s={}}=this.attribute,{spaceCol:o=bC,spaceRow:a=yC}=r,l=this._itemsContainer,{space:h=VE,defaultCurrent:d=1}=s,u=Wj(s,["space","defaultCurrent"]),{isHorizontal:c}=this._itemContext,g=this._contentMaxHeight;let p,f=0,m=0,v=0,_=1;if(c)f=i,m=this._itemHeight,p=this._createScrollbar(u,f),this._pagerComponent=p,this._innerView.add(p);else{if(m=g-e,f=this._itemMaxWidth,p=this._createScrollbar(u,m),this._pagerComponent=p,this._innerView.add(p),m<=0)return this._innerView.removeChild(p),!1;const y=l.getChildren(),C=y.map(S=>S.attribute.height);if(C.length===1||C.every(S=>S===C[0])){const S=C[0],w=m,x=Math.floor(w/(a+S));m=x*(a+S),_=Math.ceil(y.length/x)}else y.forEach((S,w)=>{const{height:x}=S.attribute,A=_,M=v;_=Math.floor((v+x)/m)+1,v+=a+x,A!==_&&w===l.getChildren().length-1&&v-m>=1/3*x&&(m=M+x,_-=1)});this._itemContext.totalPage=_,this._itemContext.pages=_}if(d>1)if(c){const y=this._itemsContainer.AABBBounds.width()-f;l.setAttribute("x",-Math.min((d-1)*(f+o),y))}else{const y=this._itemsContainer.AABBBounds.height()-m;l.setAttribute("y",-Math.min((d-1)*(m+a),y))}const b=Ut.group({x:0,y:e,width:f,height:m,clip:!0,pickable:!1});return b.add(l),this._innerView.add(b),this._itemContext.clipContainer=b,this._updatePositionOfScrollbar(f,m,e),!((t=s.scrollMask)===null||t===void 0)&&t.visible&&this.renderScrollMask(b),this._bindEventsOfPager(c?f:m,c?"x":"y"),!0}renderScrollMask(t){const{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:r=16,gradientStops:s}=e;if(!i||!s)return;const o=t.AABBBounds.width(),a=t.AABBBounds.height(),l=this._itemContext.isHorizontal?o:a,h=s.map(c=>({offset:r*c.offset/l,color:c.color})),d=s.map(c=>({offset:(l-r*c.offset)/l,color:c.color})),u=Ut.rect({x:0,y:0,width:o,height:a});this._scrollMask=u,this._scrollMaskContext={startStops:h,endStops:d},this.updateScrollMask(),t.add(u)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;const[t,e]=this._pagerComponent.getScrollRange(),i=[];di(Ne(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),di(Ne(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(qt.selected)?this._setLegendItemState(t,qt.selectedHover,e):this._setLegendItemState(t,qt.unSelectedHover,e);const i=t.getChildren()[0].find(r=>r.name===Jn.focus,!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(io.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(qt.unSelectedHover)||t.hasState(qt.selectedHover))&&(i=!0),t.removeState(qt.unSelectedHover),t.removeState(qt.selectedHover),t.getChildren()[0].getChildren().forEach(s=>{i||!s.hasState(qt.unSelectedHover)&&!s.hasState(qt.selectedHover)||(i=!0),s.removeState(qt.unSelectedHover),s.removeState(qt.selectedHover)});const r=t.getChildren()[0].find(s=>s.name===Jn.focus,!1);r&&r.setAttribute("visible",!1),i&&this._dispatchLegendEvent(io.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(io.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let r=!1;t.hasState(e)||(r=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach(s=>{s.name!==Jn.focus&&(r||s.hasState(e)||(r=!0),s.addState(e,!0))}),r&&this._dispatchLegendEvent(io.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let r=!1;e.forEach(s=>{!r&&t.hasState(s)&&(r=!0),t.removeState(s)}),t.getChildren()[0].getChildren().forEach(s=>{s.name!==Jn.focus&&e.forEach(o=>{!r&&s.hasState(o)&&(r=!0),s.removeState(o)})}),r&&this._dispatchLegendEvent(io.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return(t=this._itemsContainer)===null||t===void 0||t.getChildren().forEach(i=>{i.hasState(qt.selected)&&e.push(i.data)}),e}_appendDataToShape(t,e,i,r,s={}){t.name=e,t.data=i,t.delegate=r,t.states=Z({},m_t,s)}_dispatchLegendEvent(t,e,i){const r=this._getSelectedLegends();r.sort((o,a)=>o.index-a.index);const s=r.map(o=>o.label);this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(qt.selected),currentSelectedItems:r,currentSelected:s,event:i})}_handleStyle(t,e,i,r,s){const o={};return t.style&&(it(t.style)?o.style=t.style(e,i,r,s):o.style=t.style),t.state&&(o.state={},Object.keys(t.state).forEach(a=>{t.state[a]&&(it(t.state[a])?o.state[a]=t.state[a](e,i,r,s):o.state[a]=t.state[a])})),o}release(){super.release(),this.removeAllEventListeners()}};zK.defaultAttributes={layout:"horizontal",title:{align:"start",space:nb,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:bC,spaceRow:yC,shape:{space:FK,style:{size:cx,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:HK,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:cx,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:VE,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var qn;(function(n){n.innerView="innerView",n.railContainer="sliderRailContainer",n.rail="sliderRail",n.startText="sliderStartText",n.endText="sliderEndText",n.startHandler="sliderStartHandler",n.startHandlerText="startHandlerText",n.endHandler="sliderEndHandler",n.endHandlerText="sliderEndHandlerText",n.track="sliderTrack",n.trackContainer="sliderTrackContainer"})(qn||(qn={}));function Ik(n){return V(n)?n:[n,n]}function gy(n){return n?"ew-resize":"ns-resize"}ZO();let QO=class jK extends Gs{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},jK.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=i=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(i),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=i=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const r=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),s=Ne(this._isHorizontal?(i.viewX-this._rail.globalAABBBounds.x1)/r:(i.viewY-this._rail.globalAABBBounds.y1)/r,0,1);s!==this._tooltipState.pos&&(this._tooltipState.pos=s,this._tooltipState.value=this.calculateValueByPos(s*r),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:i}=this.attribute;i&&i.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:r,y:s}=this.stage.eventPointTransform(i);this._currentHandler=i.target,this._prePos=this._isHorizontal?r:s;const o=cv(),a=oi.env==="browser"?oi:this.stage;a.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),o.forEach(l=>{a.addEventListener(l,this._onHandlerPointerUp)})},this._onHandlerPointerMove=i=>{var r,s;this._isChanging=!0;const{railWidth:o,railHeight:a,min:l,max:h}=this.attribute;if(h===l)return;const{x:d,y:u}=this.stage.eventPointTransform(i);let c,g,p,f=0;this._isHorizontal?(c=d,f=c-this._prePos,g=(s=this._currentHandler)===null||s===void 0?void 0:s.attribute.x,p=o):(c=u,f=c-this._prePos,g=(r=this._currentHandler)===null||r===void 0?void 0:r.attribute.y,p=a);const m=Ne(g+f,0,p),v=this.calculateValueByPos(m);this._currentHandler.type==="text"?this._updateHandlerText(this._currentHandler,m,v):this._updateHandler(this._currentHandler,m,v),this._updateTrack(),this._prePos=c,this._dispatchChangeEvent()},this._onHandlerPointerUp=i=>{this._isChanging=!1,this._currentHandler=null,this._clearAllDragEvents()},this._handleTouchMove=i=>{this._isChanging&&i.preventDefault()},this._onTrackPointerdown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:r,y:s}=this.stage.eventPointTransform(i);this._prePos=this._isHorizontal?r:s;const o=cv(),a=oi.env==="browser"?oi:this.stage;a.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),o.forEach(l=>{a.addEventListener(l,this._onTrackPointerUp)})},this._onTrackPointerMove=i=>{this._isChanging=!0;const{railWidth:r,railHeight:s,min:o,max:a,inverse:l}=this.attribute;if(a===o)return;const{startHandler:h,endHandler:d}=this._getHandlers();let u,c,g;const{x:p,y:f}=this.stage.eventPointTransform(i);this._isHorizontal?(u=p,c=this._track.attribute.width,g=r):(u=f,c=this._track.attribute.height,g=s);const m=u-this._prePos;if(h){const v=this._isHorizontal?h.attribute.x:h.attribute.y,_=l?Ne(v+m,c,g):Ne(v+m,0,g-c),b=this.calculateValueByPos(_);this._updateHandler(h,_,b)}if(d){const v=this._isHorizontal?d.attribute.x:d.attribute.y,_=l?Ne(v+m,0,g-c):Ne(v+m,c,g),b=this.calculateValueByPos(_),y=h==null?void 0:h.attribute;this._updateHandler(d,_,b),this._track.setAttributes(this._isHorizontal?{x:Math.min(y.x,d.attribute.x),width:Math.abs(y.x-d.attribute.x)}:{y:Math.min(y.y,d.attribute.y),height:Math.abs(y.y-d.attribute.y)})}this._prePos=u,this._dispatchChangeEvent()},this._onTrackPointerUp=i=>{this._isChanging=!1,this._clearAllDragEvents()},this._onRailPointerDown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{railWidth:r,railHeight:s,min:o,max:a}=this.attribute;if(a===o)return;const l=this._startHandler,h=this._endHandler;let d,u,c;this._isHorizontal?(d=i.viewX-this._rail.globalAABBBounds.x1,u=l==null?void 0:l.attribute.x,c=h==null?void 0:h.attribute.x):(d=i.viewY-this._rail.globalAABBBounds.y1,u=l==null?void 0:l.attribute.y,c=h==null?void 0:h.attribute.y);const g=this.calculateValueByPos(d);if(L(c)){const p=Math.abs(d-u)>Math.abs(d-c)?h:l;this._updateHandler(p,d,g)}else this._updateHandler(l,d,g);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){const{layout:i,railWidth:r,railHeight:s,min:o,max:a,inverse:l}=this.attribute;let h=0;return h=o===a?e==="start"?0:e==="end"?1:0:(t-o)/(a-o),(l?1-h:h)*(i==="vertical"?s:r)}calculateValueByPos(t){const{layout:e,railWidth:i,railHeight:r,min:s,max:o,inverse:a}=this.attribute,l=e==="vertical"?r:i;return s+(o-s)*(a?1-t/l:t/l)}setValue(t){const{min:e,max:i}=this.attribute;if(i===e)return;const[r,s]=Q(t),{startHandler:o,endHandler:a}=this._getHandlers();o&&this._updateHandler(o,this.calculatePosByValue(r),r),a&&this._updateHandler(a,this.calculatePosByValue(s),s),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:r,railHeight:s,startText:o,endText:a,min:l,max:h,showHandler:d=!0,showTooltip:u}=this.attribute;let{value:c}=this.attribute;D(c)&&(c=[l,h]),this._currentValue={startValue:Ik(c)[0],endValue:Ik(c)[1]};const g=i==="horizontal";this._isHorizontal=g;const p=Ut.group({x:0,y:0});p.name=qn.innerView,this.add(p),this._innerView=p;let f,m=0;if(o&&o.visible){f=Ut.text(Object.assign({x:g?0:r/2,y:g?s/2:0,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:o.text,lineHeight:(t=o.style)===null||t===void 0?void 0:t.fontSize},o.style)),f.name=qn.startText,p.add(f);const y=L(o.space)?o.space:0;m+=(g?f.AABBBounds.width():f.AABBBounds.height())+y}const v=Ut.group({x:g?m:0,y:g?0:m});p.add(v);const _=Ut.group({x:0,y:0});let b;if(_.name=qn.railContainer,this._railContainer=_,v.add(_),this._mainContainer=v,this._renderRail(_),m+=g?r:s,a&&a.visible){const y=L(a.space)?a.space:0;b=Ut.text(Object.assign({x:g?m+y:r/2,y:g?s/2:m+y,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:a.text,lineHeight:(e=a.style)===null||e===void 0?void 0:e.fontSize},a.style)),b.name=qn.endText,p.add(b)}this._renderTrack(_),d&&(this._renderHandlers(v),this._bindEvents()),u&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:r,slidable:s}=this.attribute;let o="default";s!==!1&&(o="pointer");const a=Ut.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:o},r));return a.name=qn.rail,t.add(a),this._rail=a,a}_renderHandlers(t){const{range:e,min:i,max:r,handlerSize:s=14,handlerStyle:o,handlerText:a,railHeight:l,railWidth:h,slidable:d}=this.attribute;let{value:u}=this.attribute;D(u)&&(u=[i,r]);const c=a&&a.visible,g=this._isHorizontal,[p,f]=Ik(u),m=this.calculatePosByValue(p,e?"start":"end"),v=this._renderHandler(Object.assign({x:g?m:h/2,y:g?l/2:m,size:s,strokeBoundsBuffer:0,cursor:d===!1?"default":gy(g)},o));if(v.name=qn.startHandler,this._startHandler=v,t.add(v),this._currentValue.startPos=m,c){const _=this._renderHandlerText(p,e?"start":"end");_.name=qn.startHandlerText,t.add(_),this._startHandlerText=_}if(e){const _=this.calculatePosByValue(f,"end"),b=this._renderHandler(Object.assign({x:g?_:h/2,y:g?l/2:_,size:s,strokeBoundsBuffer:0,cursor:d===!1?"default":gy(g)},o));if(b.name=qn.endHandler,this._endHandler=b,t.add(b),this._currentValue.endPos=_,c){const y=this._renderHandlerText(f,"end");y.name=qn.endHandlerText,t.add(y),this._endHandlerText=y}}}_renderTrack(t){const{range:e,min:i,max:r,railHeight:s,railWidth:o,trackStyle:a,railStyle:l,slidable:h,value:d}=this.attribute;let u,c;if(D(d))e?(u=i,c=r):u=c=i;else if(e){const y=ts(d,i,r);u=y[0],c=y[1]}else u=i,c=Ne(d,i,r);const g=this._isHorizontal;e||(u=i);const p=Ut.group({x:0,y:0,width:o,height:s,cornerRadius:l==null?void 0:l.cornerRadius,clip:!0,pickable:!1});p.name=qn.trackContainer;const f=kt(e)&&e.draggableTrack===!0;let m;m=h===!1?"default":e===!1||f===!1?"pointer":gy(g);const v=this.calculatePosByValue(u,"start"),_=this.calculatePosByValue(c,e?"end":"start"),b=Ut.rect(Object.assign({x:g?Math.min(v,_):0,y:g?0:Math.min(v,_),width:g?Math.abs(_-v):o,height:g?s:Math.abs(_-v),cursor:m},a));b.name=qn.track,this._track=b,p.add(b),t.add(p)}_renderHandler(t){return Ut.symbol(t)}_renderHandlerText(t,e){var i,r,s;const{align:o,handlerSize:a=14,handlerText:l={},railHeight:h,railWidth:d,slidable:u}=this.attribute,c=this._isHorizontal,g=this.calculatePosByValue(t,e),p=(i=l.space)!==null&&i!==void 0?i:4,f={text:l.formatter?l.formatter(t):t.toFixed((r=l.precision)!==null&&r!==void 0?r:0),lineHeight:(s=l.style)===null||s===void 0?void 0:s.lineHeight,cursor:u===!1?"default":gy(c)};return c?o==="top"?(f.textBaseline="bottom",f.textAlign="center",f.x=g,f.y=(h-a)/2-p):(f.textBaseline="top",f.textAlign="center",f.x=g,f.y=(h+a)/2+p):o==="left"?(f.textBaseline="middle",f.textAlign="end",f.x=(d-a)/2-p,f.y=g):(f.textBaseline="middle",f.textAlign="start",f.x=(d+a)/2+p,f.y=g),Ut.text(Object.assign(Object.assign({},f),l.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:r,align:s}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const o=this._isHorizontal?0:r/2,a=this._isHorizontal?i/2:0;if(e&&e.shape){const c=Ut.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:o,y:a,symbolType:"circle"},e.shapeStyle));this._tooltipShape=c,this._mainContainer.add(c)}const l=e&&e.text||{},h=(t=l.space)!==null&&t!==void 0?t:6,d={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(d.x=o,d.y=s==="top"?a-i/2-h:a+i/2+h,d.textAlign="center",d.textBaseline=s==="top"?"bottom":"top"):(d.y=a,d.x=s==="left"?o-r/2-h:a+r/2+h,d.textAlign=s==="left"?"end":"start",d.textBaseline="middle");const u=Ut.text(Object.assign(Object.assign({},d),l.style));this._mainContainer.add(u),this._tooltipText=u,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:r}=this.attribute,s=this._isHorizontal?i:r,o=this._tooltipState.pos*s,a=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[a]:o});const{align:l}=this.attribute;if(this._tooltipText){const h=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[a]:o,text:h.formatter?h.formatter(this._tooltipState.value):this._isHorizontal||l!=="left"?` ${this._tooltipState.value.toFixed((e=h.precision)!==null&&e!==void 0?e:0)}`:`${this._tooltipState.value.toFixed((t=h.precision)!==null&&t!==void 0?t:0)} `})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),kt(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown),(oi.env==="browser"?oi:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_clearAllDragEvents(){const t=cv(),e=oi.env==="browser"?oi:this.stage;e.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),t.forEach(i=>{e.removeEventListener(i,this._onHandlerPointerUp)}),e.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),t.forEach(i=>{e.removeEventListener(i,this._onTrackPointerUp)})}_updateTrack(){const{inverse:t,railWidth:e,railHeight:i}=this.attribute,r=this._startHandler,s=this._endHandler;if(this._isHorizontal){const o=r==null?void 0:r.attribute.x;if(s){const a=s==null?void 0:s.attribute.x;this._track.setAttributes({x:Math.min(o,a),width:Math.abs(o-a)})}else t?this._track.setAttributes({x:o,width:e-o}):this._track.setAttributes({width:o})}else{const o=r==null?void 0:r.attribute.y;if(s){const a=s==null?void 0:s.attribute.y;this._track.setAttributes({y:Math.min(o,a),height:Math.abs(o-a)})}else t?this._track.setAttributes({y:o,height:i-o}):this._track.setAttributes({height:o})}}_updateHandler(t,e,i){var r;const s=this._isHorizontal;t.setAttribute(s?"x":"y",e);const o=t.name===qn.startHandler?this._startHandlerText:this._endHandlerText;if(o){const{handlerText:a={}}=this.attribute;o.setAttributes({text:a.formatter?a.formatter(i):i.toFixed((r=a.precision)!==null&&r!==void 0?r:0),[s?"x":"y"]:e})}t.name===qn.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var r;const s=this._isHorizontal,{handlerText:o={}}=this.attribute;t.setAttributes({[s?"x":"y"]:e,text:o.formatter?o.formatter(i):i.toFixed((r=o.precision)!==null&&r!==void 0?r:0)});const a=t.name===qn.startHandlerText?this._startHandler:this._endHandler;a&&a.setAttributes({[s?"x":"y"]:e}),t.name===qn.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:t}=this.attribute;let e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<(e==null?void 0:e.attribute.x)||t&&i.attribute.x>(e==null?void 0:e.attribute.x))&&([e,i]=[i,e]):(!t&&i.attribute.y<(e==null?void 0:e.attribute.y)||t&&i.attribute.y>(e==null?void 0:e.attribute.y))&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}release(t){super.release(t),(oi.env==="browser"?oi:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearAllDragEvents()}};QO.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}};p_t();let NK=class $K extends qO{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},$K.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=i=>{const r=this._slider.tooltipShape;if(r&&i.detail&&!D(i.detail.value)){const s=this._colorScale.scale(i.detail.value);r.setAttribute("fill",s)}this.dispatchEvent(i)},this._onSliderChange=i=>{this._updateColor(),this.dispatchEvent(i)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:r,min:s,max:o,value:a,railWidth:l,railHeight:h,showHandler:d=!0,handlerSize:u,handlerStyle:c,railStyle:g,trackStyle:p,startText:f,endText:m,handlerText:v,showTooltip:_,tooltip:b,inverse:y,disableTriggerEvent:C}=this.attribute,S=[],w=(o-s)/(t.length-1);for(let A=0;A<t.length;A++)S.push(s+w*A);this._colorScale=new r_t().domain(S,!0).range(t),this._color=this._getTrackColor();const x=new QO({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:r,min:s,max:o,value:a,railWidth:l,railHeight:h,showHandler:d,handlerSize:u,handlerStyle:c,railStyle:g,trackStyle:Object.assign({fill:this._color},p),startText:f,endText:m,handlerText:v,showTooltip:_,tooltip:b,disableTriggerEvent:C,inverse:y});this._innerView.add(x),this._slider=x,x.translateTo(0-x.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",nb):0)-x.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e,inverse:i}=this.attribute;if(xt(t))return;const r=t.length;if(r===1)return t[0];const s=[];for(let l=0;l<r;l++){const h=l/(r-1);s.push({offset:h,color:t[l]})}const o=e==="horizontal",a={gradient:"linear",stops:s,x0:0,y0:0,x1:o?1:0,y1:o?0:1};return i&&(o?(a.x0=1,a.x1=0):(a.y0=1,a.y1=0)),a}_updateColor(){var t;const{layout:e="horizontal",colors:i,railWidth:r,railHeight:s}=this.attribute,{startHandler:o,endHandler:a,track:l,attribute:h}=this._slider,{startValue:d,endValue:u,startPos:c,endPos:g}=this._slider.currentValue,p=(t=h.handlerStyle)===null||t===void 0?void 0:t.fill;if(o&&!p){const m=this._colorScale.scale(d);o.setAttribute("fill",m)}if(a&&!p){const m=this._colorScale.scale(u);a.setAttribute("fill",m)}const f=e==="horizontal"?r:s;if(Math.abs(c-g)!==f&&i&&i.length>1){const m=this._color.stops,v=Math.min(c,g),_=Math.max(c,g),b=v/f,y=_/f,C=y-b,S=m.filter(R=>R.offset>b&&R.offset<y),w=Math.min(d,u),x=Math.max(d,u),A=this._colorScale.scale(w),M=this._colorScale.scale(x),T=[{offset:0,color:A}];S.forEach(R=>{T.push({offset:(R.offset-b)/C,color:R.color})}),T.push({offset:1,color:M}),l.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:T}))}}};NK.defaultAttributes={layout:"horizontal",title:{align:"start",space:nb,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}};function v_t(n="bottom"){let t=0;return n==="top"?`
    M${t},-6L${t-3.5},-2.5
    v5
    h7
    v-5
    Z
`:n==="left"?(t=1,`
    M${t-6},0L${t-6+2.5},-3.5
    h5
    v7
    h-5
    Z
`):n==="right"?(t=-1,`
    M${t+6},0L${t+6-2.5},-3.5
    h-5
    v7
    h5
    Z
  `):`
    M${t},6L${t-3.5},2.5
    v-5
    h7
    v5
    Z
`}f_t();let VK=class GK extends qO{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},GK.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=i=>{this.dispatchEvent(i)},this._onSliderToolipChange=i=>{this.dispatchEvent(i)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:r,max:s,value:o,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:d,handlerStyle:u,railStyle:c,trackStyle:g,startText:p,endText:f,handlerText:m,showTooltip:v,tooltip:_,sizeBackground:b,disableTriggerEvent:y,inverse:C}=this.attribute,S=Ut.group({x:0,y:0});this._innerView.add(S);const w=new QO({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:r,max:s,value:o,railWidth:a,railHeight:l,showHandler:h,handlerSize:d,handlerStyle:Object.assign({symbolType:v_t(i)},u),railStyle:c,trackStyle:g,startText:p,endText:f,handlerText:m,showTooltip:v,tooltip:_,disableTriggerEvent:y,inverse:C});S.add(w);let x,A=0;e==="horizontal"?i==="top"?(x=`M0,0L${a},0L${C?0:a},12Z`,A=l):(x=`M0,12L${a},12L${C?0:a},0Z`,w.setAttribute("y",12)):i==="left"?x=`M${a},0L${a+12},${C?0:l}L${a},${l}Z`:(x=`M0,${C?0:l}L12,${l}L12,0Z`,w.setAttribute("x",12));const M=Ut.path(Object.assign(Object.assign({x:0,y:A,path:x},b),{zIndex:0}));S.add(M);const T=this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",nb):0;S.translate(0-S.AABBBounds.x1,T-S.AABBBounds.y1),this._slider=w}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}};VK.defaultAttributes={layout:"horizontal",title:{align:"start",space:nb,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}};function __t(){gs(),sl(),uM()}__t();let UK=class YK extends Gs{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},YK.defaultAttributes,t)),this.name="title"}render(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y;const{textType:C,text:S,subtextType:w,textStyle:x={},subtext:A,subtextStyle:M={},width:T,height:R,minWidth:B,maxWidth:E,minHeight:k,maxHeight:P,align:I,verticalAlign:O,padding:H=0}=this.attribute,z=Fi(H),F=this.createOrUpdateChild("title-container",{x:z[3],y:z[0],zIndex:1},"group"),j=(t=x.height)!==null&&t!==void 0?t:R;if(this.attribute.visible!==!1&&x.visible!==!1){const{width:rt,maxHeight:pt,maxWidth:at,x:W=0,y:N=0,ellipsis:K=!0,wordBreak:nt="break-word",maxWidth:X,lineClamp:ht}=x;if(C==="rich"||L(x.character)){const _t=Object.assign({x:W,y:N,width:(e=rt??T)!==null&&e!==void 0?e:0,height:j??0,ellipsis:K==null||K,wordBreak:nt??"break-word",maxHeight:pt??P,maxWidth:at??X,textConfig:(i=x.character)!==null&&i!==void 0?i:S},x);this._mainTitle=F.createOrUpdateChild("mainTitle",_t,"richtext")}else if(C==="html"){const _t=Object.assign({html:Object.assign(Object.assign({dom:S},vj),x),x:W,y:N,width:(r=rt??T)!==null&&r!==void 0?r:0,height:j??0,ellipsis:K,wordBreak:nt,maxHeight:pt??P,maxWidth:at??X,textConfig:[]},x);this._mainTitle=F.createOrUpdateChild("mainTitle",_t,"richtext")}else L(S)&&(this._mainTitle=F.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:V(S)?S:[S],whiteSpace:"normal"},x),{maxLineWidth:(o=(s=x.maxLineWidth)!==null&&s!==void 0?s:rt)!==null&&o!==void 0?o:T,heightLimit:(a=x.height)!==null&&a!==void 0?a:P,lineClamp:ht,ellipsis:K,x:W,y:N}),"text"))}const $=this._mainTitle?this._mainTitle.AABBBounds.height():0,Y=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(this.attribute.visible!==!1&&M.visible!==!1){const{width:rt,height:pt,maxWidth:at,maxHeight:W,x:N=0,y:K=0,ellipsis:nt=!0,wordBreak:X="break-word",lineClamp:ht}=M,_t=Math.max(Number.MIN_VALUE,P-$);if(w==="rich"||L(M.character)){const ct=Object.assign({x:N,y:K,width:(l=rt??T)!==null&&l!==void 0?l:0,height:(h=pt??R)!==null&&h!==void 0?h:0,ellipsis:nt,wordBreak:X,maxHeight:W??_t,maxWidth:at??E,textConfig:(d=M.character)!==null&&d!==void 0?d:A},M);this._subTitle=F.createOrUpdateChild("subTitle",ct,"richtext")}else if(w==="html"){const ct=Object.assign({html:Object.assign(Object.assign({dom:A},vj),M),x:N,y:K,width:(u=rt??T)!==null&&u!==void 0?u:0,height:(c=pt??R)!==null&&c!==void 0?c:0,ellipsis:nt,wordBreak:X,maxHeight:W??_t,maxWidth:at??E,textConfig:[]},M);this._subTitle=F.createOrUpdateChild("subTitle",ct,"richtext")}else L(A)&&(this._subTitle=F.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:V(A)?A:[A],whiteSpace:"normal"},M),{maxLineWidth:(g=M.maxLineWidth)!==null&&g!==void 0?g:T,heightLimit:(p=M.heightLimit)!==null&&p!==void 0?p:_t,lineClamp:ht,ellipsis:nt,x:0,y:$}),"text"))}const G=this._subTitle?this._subTitle.AABBBounds.height():0,tt=this._subTitle?this._subTitle.AABBBounds.width():0;let st=Math.max(Y,tt),ot=$+((f=M.height)!==null&&f!==void 0?f:G);if(L(T)&&(st=T),L(R)&&(ot=R),L(B)&&st<B&&(st=B),L(E)&&st>E&&(st=E),L(k)&&ot<k&&(ot=k),L(P)&&ot>P&&(ot=P),F.attribute.width=st,F.attribute.height=ot,F.attribute.boundsPadding=z,this._mainTitle){if(L(I)||L(x.align)){const at=x.align?x.align:I,W=(m=x.width)!==null&&m!==void 0?m:st;at==="center"?(this._mainTitle.setAttribute("x",W/2),this._mainTitle.setAttribute("textAlign","center")):at==="right"?(this._mainTitle.setAttribute("x",W),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}const rt=x.verticalAlign?x.verticalAlign:O,pt=j??(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height());rt==="middle"?(this._mainTitle.setAttribute("y",pt/2),this._mainTitle.setAttribute("textBaseline","middle")):rt==="bottom"?(this._mainTitle.setAttribute("y",pt),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}if(this._subTitle){if(L(I)||L(M.align)){const W=M.align?M.align:I,N=(_=(v=M.width)!==null&&v!==void 0?v:x.width)!==null&&_!==void 0?_:st;W==="center"?(this._subTitle.setAttribute("x",N/2),this._subTitle.setAttribute("textAlign","center")):W==="right"?(this._subTitle.setAttribute("x",N),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}const rt=M.verticalAlign?M.verticalAlign:O,pt=this._mainTitle?L(j)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height(),j):this._mainTitle.AABBBounds.y2:0,at=(y=(b=M.height)!==null&&b!==void 0?b:R)!==null&&y!==void 0?y:this._subTitle.AABBBounds.empty()?0:this._subTitle.AABBBounds.height();rt==="middle"?(this._subTitle.setAttribute("y",pt+at/2),this._subTitle.setAttribute("textBaseline","middle")):rt==="bottom"?(this._subTitle.setAttribute("y",pt+at),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",pt),this._subTitle.setAttribute("textBaseline","top"))}}};UK.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};function b_t(){gs(),hh(),sl(),dM()}const y_t='<svg width="200" height="200" viewBox="0 0 1024 1024" fill="#fff" xmlns="http://www.w3.org/2000/svg"><path d="M877.44815445 206.10060629a64.72691371 64.72691371 0 0 0-95.14856334 4.01306852L380.73381888 685.46812814 235.22771741 533.48933518a64.72691371 64.72691371 0 0 0-92.43003222-1.03563036l-45.82665557 45.82665443a64.72691371 64.72691371 0 0 0-0.90617629 90.61767965l239.61903446 250.10479331a64.72691371 64.72691371 0 0 0 71.19960405 15.14609778 64.33855261 64.33855261 0 0 0 35.08198741-21.23042702l36.24707186-42.71976334 40.5190474-40.77795556-3.36579926-3.49525333 411.40426297-486.74638962a64.72691371 64.72691371 0 0 0-3.88361443-87.64024149l-45.3088404-45.43829334z"></path></svg>',C_t='<svg width="200" height="200" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none"><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="5" d="M5 12h14"/></svg>';b_t();class nf extends Gs{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},nf.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?(this.setAttribute("checked",!1),this.setAttribute("indeterminate",!1)):(this.setAttribute("checked",!0),this.setAttribute("indeterminate",!1)),this._dispatchEvent("checkbox_state_change",{eventType:"checkbox_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,s)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderIcon(),this.renderText(),this.layout()}renderBox(){this._box=new eb(Z({},this.attribute.box));const t=this.attribute.checked||this.attribute.indeterminate;t&&this.attribute.disabled?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill,stroke:this.attribute.box.disableCheckedStroke}):t?this._box.setAttributes({fill:this.attribute.box.checkedFill,stroke:this.attribute.box.checkedStroke}):this.attribute.disabled&&this._box.setAttributes({fill:this.attribute.box.disableFill}),this.appendChild(this._box)}renderIcon(){this._checkIcon=new mc(Z({image:this.attribute.icon.checkIconImage},this.attribute.icon)),this.appendChild(this._checkIcon),this._indeterminateIcon=new mc(Z({image:this.attribute.icon.indeterminateIconImage},this.attribute.icon)),this.appendChild(this._indeterminateIcon),this.attribute.checked?(this._checkIcon.setAttribute("visible",!0),this._indeterminateIcon.setAttribute("visible",!1)):this.attribute.indeterminate?(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!0)):(this._checkIcon.setAttribute("visible",!1),this._indeterminateIcon.setAttribute("visible",!1))}renderText(){this._text=new Wn(Z({wrap:!0},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=this.attribute.box.height,e=this.attribute.icon.height,i=this._text.AABBBounds.height(),r=Math.max(t,e,i),s=r/2-t/2,o=r/2-e/2,a=r/2-i/2,l=this.attribute.box.width,h=this.attribute.icon.width,d=Math.max(l,h),u=d/2-l/2,c=d/2-h/2,g=d+this.attribute.spaceBetweenTextAndIcon;this._box.setAttributes({x:u,y:s}),this._checkIcon.setAttributes({x:c,y:o}),this._indeterminateIcon.setAttributes({x:c,y:o}),this._text.setAttributes({x:g,y:a})}initAttributes(t,e){t=e!=null&&e.skipDefault?t:Z({},nf.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}nf.defaultAttributes={interactive:!0,disabled:!1,checked:!1,indeterminate:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},icon:{checkIconImage:y_t,indeterminateIconImage:C_t,width:10,height:10,pickable:!1},box:{width:14,height:14,cornerRadius:2,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};function S_t(){gs(),hh(),Xmt(),dM()}S_t();class rf extends Gs{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},rf.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||this.attribute.checked||(this.setAttribute("checked",!0),this._dispatchEvent("radio_checked",{eventType:"radio_checked",target:this}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,s)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderCircle(),this.renderText(),this.layout()}renderCircle(){this._circle=new jO(Z({},this.attribute.circle));const t=this.attribute.checked;t&&this.attribute.disabled?this._circle.setAttributes({fill:this.attribute.circle.disableCheckedFill,stroke:this.attribute.circle.disableCheckedStroke}):t?this._circle.setAttributes({fill:this.attribute.circle.checkedFill,stroke:this.attribute.circle.checkedStroke}):this.attribute.disabled&&this._circle.setAttributes({fill:this.attribute.circle.disableFill}),this.appendChild(this._circle)}renderText(){this._text=new Wn(Z({},this.attribute.text)),this.attribute.disabled&&this._text.setAttribute("fill",this.attribute.text.disableFill),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){const t=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),e=this._text.AABBBounds.height(),i=Math.max(t,e),r=i/2-t/2+this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,s=i/2-e/2,o=2*(this.attribute.circle.outerRadius+this.attribute.circle.lineWidth),a=this.attribute.circle.outerRadius+this.attribute.circle.lineWidth,l=o+this.attribute.spaceBetweenTextAndIcon;this._circle.setAttributes({x:a,y:r}),this._text.setAttributes({x:l,y:s})}initAttributes(t,e){t=e!=null&&e.skipDefault?t:Z({},rf.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}rf.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",spaceBetweenTextAndIcon:8,text:{text:"text",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",textBaseline:"top",pickable:!1},circle:{outerRadius:7,innerRadius:3,startAngle:0,endAngle:2*Math.PI,lineWidth:1,fill:"#fff",stroke:"rgb(229,230,235)",disableFill:"rgb(242,243,245)",checkedFill:"rgb(22, 93, 255)",checkedStroke:"rgb(22, 93, 255)",disableCheckedFill:"rgb(148, 191, 255)",disableCheckedStroke:"rgb(148, 191, 255)",pickable:!1}};function x_t(){gs(),sl(),dM()}const w_t='<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>';x_t();let XK=class KK extends Gs{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},KK.defaultAttributes,t))}render(){this.removeAllChild(!0),this.renderIcon(),this.renderText(),this.layout()}renderIcon(){this._emptyTipIcon=new mc(Z({image:this.attribute.icon.image},this.attribute.icon)),this.appendChild(this._emptyTipIcon)}renderText(){this._text=new Wn(Z({wrap:!0},this.attribute.text)),this.appendChild(this._text)}layout(){const t=this.attribute.icon.height,e=this._text.AABBBounds.height(),i=this.attribute.icon.width,{width:r,height:s,spaceBetweenTextAndIcon:o}=this.attribute;this._emptyTipIcon.setAttribute("x",r/2-i/2),this._emptyTipIcon.setAttribute("y",s/2-t/2-e/2-o/2),this._text.setAttribute("x",r/2),this._text.setAttribute("textAlign","center"),this._text.setAttribute("y",s/2+t/2+o/2),this._text.setAttribute("textBaseline","middle")}};XK.defaultAttributes={spaceBetweenTextAndIcon:20,text:{text:"no data",fontSize:14,fill:"#000",disableFill:"rgb(201,205,212)",pickable:!1},icon:{image:w_t,width:100,height:100,pickable:!1}};function A_t(){gs(),hh(),sl(),lK()}A_t();class j_ extends Gs{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},j_.defaultAttributes,t)),this._handlePointerUp=()=>{this.attribute.disabled||(this.attribute.checked?this.setAttribute("checked",!1):this.setAttribute("checked",!0),this._dispatchEvent("switch_state_change",{eventType:"switch_state_change",checked:this.attribute.checked}),this.stage.renderNextFrame())},this.renderGroup(),this.onBeforeAttributeUpdate=(i,r,s)=>{"interactive"in i&&this.setAttribute("pickable",i.interactive),"disabled"in i&&this.setAttribute("cursor",i.disable?this.attribute.disableCursor:this.attribute.cursor)},this.addEventListener("pointerup",this._handlePointerUp)}render(){this.removeAllChild(!0),this.renderBox(),this.renderCircle(),this.renderText(),this.layout()}renderBox(){this._box=new eb(Z({},this.attribute.box)),this.attribute.disabled&&this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableCheckedFill}):this.attribute.disabled&&!this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.disableUncheckedFill}):this.attribute.checked?this._box.setAttributes({fill:this.attribute.box.checkedFill}):this._box.setAttributes({fill:this.attribute.box.uncheckedFill}),this.appendChild(this._box)}renderCircle(){this._circle=new zO(Z({},this.attribute.circle)),this.appendChild(this._circle)}renderText(){var t,e,i;this._text=new Wn(Z({},(t=this.attribute.text)!==null&&t!==void 0?t:{})),this.attribute.checked&&(!((e=this.attribute.text)===null||e===void 0)&&e.checkedText)?this._text.setAttributes({text:this.attribute.text.checkedText}):!((i=this.attribute.text)===null||i===void 0)&&i.uncheckedText&&this._text.setAttributes({text:this.attribute.text.uncheckedText}),this.appendChild(this._text)}renderGroup(){this.attribute.interactive||this.setAttribute("pickable",!1),this.attribute.disabled&&this.setAttribute("cursor",this.attribute.disableCursor)}layout(){var t,e,i,r,s,o,a,l,h,d;const u=this.attribute.spaceBetweenTextAndCircle,c=this.attribute.circle.radius,g=this.attribute.box.height,p=2*c,f=this._text.AABBBounds.height(),m=Math.max(g,p,f),v=m/2-p/2+c,_=m/2-f/2,b=this.attribute.box.width,y=2*c,C=cM(((i=(e=(t=this.attribute.text)===null||t===void 0?void 0:t.checkedText)===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0)>((o=(s=(r=this.attribute.text)===null||r===void 0?void 0:r.uncheckedText)===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:0)?(l=(a=this.attribute.text)===null||a===void 0?void 0:a.checkedText)!==null&&l!==void 0?l:"":(d=(h=this.attribute.text)===null||h===void 0?void 0:h.uncheckedText)!==null&&d!==void 0?d:"",this._text.attribute).width,S=Math.max(b,y+C+3*u),w=g/2-y/2+c,x=w+c+u;this._box.setAttributes({width:S,height:m}),this._circle.setAttributes({y:v,x:this.attribute.checked?S-w:w}),this._text.setAttributes({x:this.attribute.checked?S-x-C:x,y:_})}initAttributes(t,e){t=e!=null&&e.skipDefault?t:Z({},j_.defaultAttributes,t),super.initAttributes(t),this.renderGroup(),this.render()}}j_.defaultAttributes={interactive:!0,disabled:!1,checked:!1,cursor:"pointer",disableCursor:"not-allowed",circle:{radius:8,fill:"#FFF",pickable:!1},box:{width:40,height:24,cornerRadius:12,uncheckedFill:"rgb(201,205,212)",checkedFill:"#165DFF",disableUncheckedFill:"rgb(242,243,245)",disableCheckedFill:"rgb(148,191,255)",pickable:!1},text:{textAlign:"left",textBaseline:"top",pickable:!1},spaceBetweenTextAndCircle:6};let jj=!1;function M_t(){jj||(jj=!0,z_(),GO()?XS(he):lpt()&&ZS(he),Vmt(),lK(),gs(),dM(),YO(),hh(),uM(),Ymt(),Df(),sl(),SW(),cvt(),SW())}var oe;(function(n){n.default="default",n.grabing="grabing",n.scrolling="scrolling"})(oe||(oe={}));var qe;(function(n){n.single="single",n.column="column",n.row="row",n.cross="cross",n.none="none"})(qe||(qe={}));const T_t=["bgColor","color","strokeColor","borderColor","linkColor"];var Ji;(function(n){n.RECORD="RECORD",n.NONE="NONE",n.SUM="SUM",n.MIN="MIN",n.MAX="MAX",n.AVG="AVG",n.COUNT="COUNT",n.CUSTOM="CUSTOM",n.RECALCULATE="RECALCULATE"})(Ji||(Ji={}));var Nj;(function(n){n.ASC="ASC",n.DESC="DESC",n.NORMAL="NORMAL",n.desc="desc",n.asc="asc",n.normal="normal"})(Nj||(Nj={}));var Rs;(function(n){n.top="top",n.bottom="bottom",n.left="left",n.right="right"})(Rs||(Rs={}));var se;(function(n){n.expand="expand",n.collapse="collapse",n.none="none",n.loading="loading"})(se||(se={}));var ri;(function(n){n.inlineFront="inlineFront",n.inlineEnd="inlineEnd",n.left="left",n.right="right",n.absoluteRight="absoluteRight",n.contentLeft="contentLeft",n.contentRight="contentRight",n.absolute="absolute"})(ri||(ri={}));var si;(function(n){n.frozen="frozen",n.sort="sort",n.dropDown="dropDown",n.dropDownState="dropDownState",n.play="play",n.damagePic="damagePic",n.expand="expand",n.collapse="collapse",n.drillDown="drillDown",n.drillUp="drillUp",n.dragReorder="dragReorder"})(si||(si={}));var Er;(function(n){n.upwardIconName="sort_upward",n.downwardIconName="sort_downward",n.normalIconName="sort_normal",n.freezeIconName="freeze",n.frozenIconName="frozen",n.frozenCurrentIconName="frozenCurrent",n.dropdownIconName="dropdownIcon",n.expandIconName="expand",n.collapseIconName="collapse",n.dragReorderIconName="dragReorder",n.loadingIconName="loading"})(Er||(Er={}));class $d{constructor(t){var e;this.isAggregator=!0,this.isRecord=!0,this.records=[],this.key=t.key,this.field=t.field,this.formatFun=t.formatFun,this.isRecord=(e=t.isRecord)!==null&&e!==void 0?e:this.isRecord}clearCacheValue(){this._formatedValue=void 0}formatValue(t,e,i){return this._formatedValue||(this.formatFun?this._formatedValue=this.formatFun(this.value(),t,e,i):this._formatedValue=this.value()),this._formatedValue}reset(){this.records=[],this.clearCacheValue()}}class k_t extends $d{constructor(){super(...arguments),this.type=Ji.RECORD,this.isRecord=!0}push(t){t&&this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.clearCacheValue()}deleteRecord(t){t&&this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),this.clearCacheValue())}value(){return this.records}reset(){this.records=[]}recalculate(){}}class R_t extends $d{constructor(){super(...arguments),this.type=Ji.NONE,this.isRecord=!0}push(t){t&&(this.isRecord&&(this.records=[t]),this.field&&(this.fieldValue=t[this.field])),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),this.field&&this.records.length&&(this.fieldValue=this.records[this.records.length-1][this.field]),this.clearCacheValue())}value(){return this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){}}class B_t extends $d{constructor(t){super(t),this.type=Ji.CUSTOM,this.isRecord=!0,this.values=[],this.aggregationFun=t.aggregationFun}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),this.field&&this.values.push(t[this.field])),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),this.field&&this.records.length&&(this.values=this.records.map(i=>i[this.field])),this.clearCacheValue())}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),this.field&&this.records.length&&(this.values=this.records.map(e=>e[this.field]))),this.clearCacheValue()}value(){var t;return this.fieldValue||(this.fieldValue=(t=this.aggregationFun)===null||t===void 0?void 0:t.call(this,this.values,this.records,this.field)),this.fieldValue}reset(){this.records=[],this.fieldValue=void 0}recalculate(){this.fieldValue=void 0,this._formatedValue=void 0}}class P_t extends $d{constructor(t){var e;super(t),this.type=Ji.SUM,this.sum=0,this.positiveSum=0,this.nagetiveSum=0,this.needSplitPositiveAndNegativeForSum=!1,this.needSplitPositiveAndNegativeForSum=(e=t.needSplitPositiveAndNegative)!==null&&e!==void 0&&e}push(t){if(t){if(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator){const e=t.value();this.sum+=e??0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum+=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum+=e:e<0&&(this.nagetiveSum+=e))}}this.clearCacheValue()}deleteRecord(t){if(t){if(this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),t.isAggregator){const e=t.value();this.sum-=e??0,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const e=parseFloat(t[this.field]);this.sum-=e,this.needSplitPositiveAndNegativeForSum&&(e>0?this.positiveSum-=e:e<0&&(this.nagetiveSum-=e))}}this.clearCacheValue()}updateRecord(t,e){if(t&&e){if(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),t.isAggregator){const i=t.value(),r=e.value();this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}else if(this.field&&!isNaN(parseFloat(t[this.field]))){const i=parseFloat(t[this.field]),r=parseFloat(e[this.field]);this.sum+=r-i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum-=i:i<0&&(this.nagetiveSum-=i),r>0?this.positiveSum+=r:r<0&&(this.nagetiveSum+=r))}this.clearCacheValue()}}value(){var t;return((t=this.records)===null||t===void 0?void 0:t.length)>=1?this.sum:void 0}positiveValue(){return this.positiveSum}negativeValue(){return this.nagetiveSum}reset(){super.reset(),this.records=[],this.sum=0}recalculate(){if(this.sum=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];if(e.isAggregator){const i=e.value();this.sum+=i??0,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}else if(this.field&&!isNaN(parseFloat(e[this.field]))){const i=parseFloat(e[this.field]);this.sum+=i,this.needSplitPositiveAndNegativeForSum&&(i>0?this.positiveSum+=i:i<0&&(this.nagetiveSum+=i))}}}}class E_t extends $d{constructor(){super(...arguments),this.type=Ji.COUNT,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.count+=t.value():this.count++),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),t.isAggregator?this.count-=t.value():this.count--),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),t.isAggregator&&(this.count+=e.value()-t.value()))}value(){return this.count}reset(){this.records=[],this.count=0}recalculate(){if(this.count=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.count+=e.value():this.count++}}}class L_t extends $d{constructor(){super(...arguments),this.type=Ji.AVG,this.sum=0,this.count=0}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator&&t.type===Ji.AVG?(this.sum+=t.sum,this.count+=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(t[this.field]),this.count++)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),t.isAggregator&&t.type===Ji.AVG?(this.sum-=t.sum,this.count-=t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum-=parseFloat(t[this.field]),this.count--)),this.clearCacheValue()}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),t.isAggregator&&t.type===Ji.AVG?(this.sum+=e.sum-t.sum,this.count+=e.count-t.count):this.field&&!isNaN(parseFloat(t[this.field]))&&(this.sum+=parseFloat(e[this.field])-parseFloat(t[this.field])),this.clearCacheValue())}value(){var t;return((t=this.records)===null||t===void 0?void 0:t.length)>=1?this.sum/this.count:void 0}reset(){this.records=[],this.sum=0,this.count=0}recalculate(){if(this.sum=0,this.count=0,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator&&e.type===Ji.AVG?(this.sum+=e.sum,this.count+=e.count):this.field&&!isNaN(parseFloat(e[this.field]))&&(this.sum+=parseFloat(e[this.field]),this.count++)}}}class I_t extends $d{constructor(){super(...arguments),this.type=Ji.MAX,this.max=Number.MIN_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.max=t.max>this.max?t.max:this.max:typeof t=="number"?this.max=t>this.max?t:this.max:this.field&&typeof t[this.field]=="number"?this.max=t[this.field]>this.max?t[this.field]:this.max:this.field&&!isNaN(t[this.field])&&(this.max=parseFloat(t[this.field])>this.max?parseFloat(t[this.field]):this.max)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),this.recalculate())}value(){var t;return((t=this.records)===null||t===void 0?void 0:t.length)>=1?this.max:void 0}reset(){this.records=[],this.max=Number.MIN_SAFE_INTEGER}recalculate(){if(this.max=Number.MIN_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.max=e.max>this.max?e.max:this.max:typeof e=="number"?this.max=e>this.max?e:this.max:this.field&&typeof e[this.field]=="number"?this.max=e[this.field]>this.max?e[this.field]:this.max:this.field&&!isNaN(e[this.field])&&(this.max=parseFloat(e[this.field])>this.max?parseFloat(e[this.field]):this.max)}}}class O_t extends $d{constructor(){super(...arguments),this.type=Ji.MIN,this.min=Number.MAX_SAFE_INTEGER}push(t){t&&(this.isRecord&&this.records&&(t.isAggregator?this.records.push(...t.records):this.records.push(t)),t.isAggregator?this.min=t.min<this.min?t.min:this.min:typeof t=="number"?this.min=t<this.min?t:this.min:this.field&&typeof t[this.field]=="number"?this.min=t[this.field]<this.min?t[this.field]:this.min:this.field&&!isNaN(t[this.field])&&(this.min=parseFloat(t[this.field])<this.min?parseFloat(t[this.field]):this.min)),this.clearCacheValue()}deleteRecord(t){t&&(this.isRecord&&this.records&&(this.records=this.records.filter(e=>e!==t)),this.recalculate())}updateRecord(t,e){t&&e&&(this.isRecord&&this.records&&(this.records=this.records.map(i=>i===t?e:i)),this.recalculate())}value(){var t;return((t=this.records)===null||t===void 0?void 0:t.length)>=1?this.min:void 0}reset(){this.records=[],this.min=Number.MAX_SAFE_INTEGER}recalculate(){if(this.min=Number.MAX_SAFE_INTEGER,this._formatedValue=void 0,this.records)for(let t=0;t<this.records.length;t++){const e=this.records[t];e.isAggregator?this.min=e.min<this.min?e.min:this.min:typeof e=="number"?this.min=e<this.min?e:this.min:this.field&&typeof e[this.field]=="number"?this.min=e[this.field]<this.min?e[this.field]:this.min:this.field&&!isNaN(e[this.field])&&(this.min=parseFloat(e[this.field])<this.min?parseFloat(e[this.field]):this.min)}}}let D_t=1,pM=class{constructor(){this.listenersData={listeners:{},listenerData:{}}}on(t,e){const i=this.listenersData.listeners[t]||(this.listenersData.listeners[t]=[]);i.push(e);const r=D_t++;return this.listenersData.listenerData[r]={type:t,listener:e,remove:()=>{delete this.listenersData.listenerData[r];const s=i.indexOf(e);i.splice(s,1),this.listenersData.listeners[t].length||delete this.listenersData.listeners[t]}},r}off(t,e){var i;if(e){const r=t;this.removeEventListener(r,e)}else{const r=t;if(!this.listenersData)return;(i=this.listenersData.listenerData[r])===null||i===void 0||i.remove()}}addEventListener(t,e,i){this.on(t,e)}removeEventListener(t,e){if(this.listenersData)for(const i in this.listenersData.listenerData){const r=this.listenersData.listenerData[i];r.type===t&&r.listener===e&&this.off(i)}}hasListeners(t){return!!this.listenersData&&!!this.listenersData.listeners[t]}fireListeners(t,e){if(!this.listenersData)return[];const i=this.listenersData.listeners[t];return i?i.map(r=>r.call(this,e)).filter(r=>L(r)):[]}release(){delete this.listenersData}},$j;const F_t={CHANGE_STYLE:"change_style"};let na=class GE extends pM{static get EVENT_TYPE(){return F_t}static get DEFAULT(){return $j||($j=new GE)}constructor(t={},e={}){var i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I;super(),this._defaultPadding=[10,16,10,16],this._textAlign=(i=t==null?void 0:t.textAlign)!==null&&i!==void 0?i:e==null?void 0:e.textAlign,this._textBaseline=(r=t==null?void 0:t.textBaseline)!==null&&r!==void 0?r:e==null?void 0:e.textBaseline,this._color=(s=t==null?void 0:t.color)!==null&&s!==void 0?s:e==null?void 0:e.color,this._strokeColor=(o=t==null?void 0:t.strokeColor)!==null&&o!==void 0?o:e==null?void 0:e.strokeColor,this._fontSize=(a=t.fontSize)!==null&&a!==void 0?a:e==null?void 0:e.fontSize,this._fontFamily=(l=t.fontFamily)!==null&&l!==void 0?l:e==null?void 0:e.fontFamily,this._fontWeight=(h=t.fontWeight)!==null&&h!==void 0?h:e==null?void 0:e.fontWeight,this._fontVariant=(d=t.fontVariant)!==null&&d!==void 0?d:e==null?void 0:e.fontVariant,this._fontStyle=(u=t.fontStyle)!==null&&u!==void 0?u:e==null?void 0:e.fontStyle,this._padding=(g=(c=t==null?void 0:t.padding)!==null&&c!==void 0?c:e==null?void 0:e.padding)!==null&&g!==void 0?g:this._defaultPadding,this._borderColor=(p=t==null?void 0:t.borderColor)!==null&&p!==void 0?p:e==null?void 0:e.borderColor,this._textOverflow=(f=t==null?void 0:t.textOverflow)!==null&&f!==void 0?f:e==null?void 0:e.textOverflow,this._textStick=(v=(m=t.textStick)!==null&&m!==void 0?m:e==null?void 0:e.textStick)!==null&&v!==void 0&&v,this._textStickBaseOnAlign=(b=(_=t.textStickBaseOnAlign)!==null&&_!==void 0?_:e==null?void 0:e.textStickBaseOnAlign)!==null&&b!==void 0&&b,this._bgColor=(y=t==null?void 0:t.bgColor)!==null&&y!==void 0?y:e==null?void 0:e.bgColor,this._lineHeight=(C=t==null?void 0:t.lineHeight)!==null&&C!==void 0?C:e==null?void 0:e.lineHeight,this._underline=(S=t==null?void 0:t.underline)!==null&&S!==void 0?S:e==null?void 0:e.underline,this._underlineColor=(w=t==null?void 0:t.underlineColor)!==null&&w!==void 0?w:e==null?void 0:e.underlineColor,this._underlineDash=(x=t==null?void 0:t.underlineDash)!==null&&x!==void 0?x:e==null?void 0:e.underlineDash,this._underlineOffset=(A=t==null?void 0:t.underlineOffset)!==null&&A!==void 0?A:e==null?void 0:e.underlineOffset,this._lineThrough=(M=t==null?void 0:t.lineThrough)!==null&&M!==void 0?M:e==null?void 0:e.lineThrough,this._lineThroughColor=(T=t==null?void 0:t.lineThroughColor)!==null&&T!==void 0?T:e==null?void 0:e.lineThroughColor,this._lineThroughDash=(R=t==null?void 0:t.lineThroughDash)!==null&&R!==void 0?R:e==null?void 0:e.lineThroughDash,this._linkColor=(B=t==null?void 0:t.linkColor)!==null&&B!==void 0?B:e==null?void 0:e.linkColor,this._cursor=(E=t.cursor)!==null&&E!==void 0?E:e==null?void 0:e.cursor,this._borderLineWidth=(k=t.borderLineWidth)!==null&&k!==void 0?k:e==null?void 0:e.borderLineWidth,this._borderLineDash=(P=t.borderLineDash)!==null&&P!==void 0?P:e==null?void 0:e.borderLineDash,this._marked=(I=t.marked)!==null&&I!==void 0?I:e==null?void 0:e.marked}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get padding(){return this._padding}set padding(t){this._padding=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}get marked(){return this._marked}set marked(t){this._marked=t}clone(){return new GE(this,null)}},Vj,H_t=class UE extends na{static get DEFAULT(){return Vj||(Vj=new UE)}constructor(t={},e={}){super(t,e)}clone(){return new UE(this,null)}},Gj;class N_ extends na{static get DEFAULT(){return Gj||(Gj=new N_)}constructor(t={},e={}){var i,r;super(t,e),this._autoWrapText=(i=t==null?void 0:t.autoWrapText)!==null&&i!==void 0?i:e==null?void 0:e.autoWrapText,this._lineClamp=(r=t==null?void 0:t.lineClamp)!==null&&r!==void 0?r:e==null?void 0:e.lineClamp}clone(){return new N_(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let Uj,YE=class CC extends na{static get DEFAULT(){return Uj||(Uj=new CC)}constructor(t={},e={},i={}){var r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A;super(t,e),this._size=((s=(r=t==null?void 0:t.size)!==null&&r!==void 0?r:e==null?void 0:e.size)!==null&&s!==void 0?s:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((a=(o=t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&o!==void 0?o:e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=(h=(l=t==null?void 0:t.checkboxStyle)===null||l===void 0?void 0:l.defaultFill)!==null&&h!==void 0?h:i==null?void 0:i.defaultFill,this._defaultStroke=(u=(d=t==null?void 0:t.checkboxStyle)===null||d===void 0?void 0:d.defaultStroke)!==null&&u!==void 0?u:i==null?void 0:i.defaultStroke,this._disableFill=(g=(c=t==null?void 0:t.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i==null?void 0:i.disableFill,this._checkedFill=(f=(p=t==null?void 0:t.checkboxStyle)===null||p===void 0?void 0:p.checkedFill)!==null&&f!==void 0?f:i==null?void 0:i.checkedFill,this._checkedStroke=(v=(m=t==null?void 0:t.checkboxStyle)===null||m===void 0?void 0:m.checkedStroke)!==null&&v!==void 0?v:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(b=(_=t==null?void 0:t.checkboxStyle)===null||_===void 0?void 0:_.disableCheckedFill)!==null&&b!==void 0?b:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(C=(y=t==null?void 0:t.checkboxStyle)===null||y===void 0?void 0:y.disableCheckedStroke)!==null&&C!==void 0?C:i==null?void 0:i.disableCheckedStroke,this._checkIconImage=(w=(S=t==null?void 0:t.checkboxStyle)===null||S===void 0?void 0:S.checkIconImage)!==null&&w!==void 0?w:i==null?void 0:i.checkIconImage,this._indeterminateIconImage=(A=(x=t==null?void 0:t.checkboxStyle)===null||x===void 0?void 0:x.indeterminateIconImage)!==null&&A!==void 0?A:i==null?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new CC(t,this)}clone(){return new CC(this)}},Yj;class Ku extends na{static get DEFAULT(){return Yj||(Yj=new Ku)}constructor(t={},e={},i={}){var r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T;super(t,e),this._size=((s=(r=t==null?void 0:t.size)!==null&&r!==void 0?r:e==null?void 0:e.size)!==null&&s!==void 0?s:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((a=(o=t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&o!==void 0?o:e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._spaceBetweenRadio=((h=(l=t==null?void 0:t.spaceBetweenRadio)!==null&&l!==void 0?l:e==null?void 0:e.spaceBetweenRadio)!==null&&h!==void 0?h:i==null?void 0:i.spaceBetweenRadio)||2,this._innerRadius=(u=(d=t==null?void 0:t.radioStyle)===null||d===void 0?void 0:d.innerRadius)!==null&&u!==void 0?u:i==null?void 0:i.innerRadius,this._outerRadius=(g=(c=t==null?void 0:t.radioStyle)===null||c===void 0?void 0:c.outerRadius)!==null&&g!==void 0?g:i==null?void 0:i.outerRadius,this._defaultFill=(f=(p=t==null?void 0:t.radioStyle)===null||p===void 0?void 0:p.defaultFill)!==null&&f!==void 0?f:i==null?void 0:i.defaultFill,this._defaultStroke=(v=(m=t==null?void 0:t.radioStyle)===null||m===void 0?void 0:m.defaultStroke)!==null&&v!==void 0?v:i==null?void 0:i.defaultStroke,this._disableFill=(b=(_=t==null?void 0:t.radioStyle)===null||_===void 0?void 0:_.disableFill)!==null&&b!==void 0?b:i==null?void 0:i.disableFill,this._checkedFill=(C=(y=t==null?void 0:t.radioStyle)===null||y===void 0?void 0:y.checkedFill)!==null&&C!==void 0?C:i==null?void 0:i.checkedFill,this._checkedStroke=(w=(S=t==null?void 0:t.radioStyle)===null||S===void 0?void 0:S.checkedStroke)!==null&&w!==void 0?w:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(A=(x=t==null?void 0:t.radioStyle)===null||x===void 0?void 0:x.disableCheckedFill)!==null&&A!==void 0?A:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(T=(M=t==null?void 0:t.radioStyle)===null||M===void 0?void 0:M.disableCheckedStroke)!==null&&T!==void 0?T:i==null?void 0:i.disableCheckedStroke}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get spaceBetweenRadio(){return this._spaceBetweenRadio}set spaceBetweenRadio(t){this._spaceBetweenRadio=t}get innerRadius(){return this._innerRadius}set innerRadius(t){this._innerRadius=t}get outerRadius(){return this._outerRadius}set outerRadius(t){this._outerRadius=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}getStyle(t){return new Ku(t,this)}clone(){return new Ku(this)}}let Xj;class qu extends na{static get DEFAULT(){return Xj||(Xj=new qu)}constructor(t={},e={},i={}){var r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C;super(t,e),this._spaceBetweenTextAndCircle=((s=(r=t==null?void 0:t.spaceBetweenTextAndCircle)!==null&&r!==void 0?r:e==null?void 0:e.spaceBetweenTextAndCircle)!==null&&s!==void 0?s:i==null?void 0:i.spaceBetweenTextAndCircle)||6,this._circleRadius=((a=(o=t==null?void 0:t.switchStyle)===null||o===void 0?void 0:o.circleRadius)!==null&&a!==void 0?a:i==null?void 0:i.circleRadius)||8,this._boxWidth=((h=(l=t==null?void 0:t.switchStyle)===null||l===void 0?void 0:l.boxWidth)!==null&&h!==void 0?h:i==null?void 0:i.boxWidth)||40,this._boxHeight=((u=(d=t==null?void 0:t.switchStyle)===null||d===void 0?void 0:d.boxHeight)!==null&&u!==void 0?u:i==null?void 0:i.boxHeight)||24,this._checkedFill=((g=(c=t==null?void 0:t.switchStyle)===null||c===void 0?void 0:c.checkedFill)!==null&&g!==void 0?g:i==null?void 0:i.checkedFill)||"#165DFF",this._uncheckedFill=((f=(p=t==null?void 0:t.switchStyle)===null||p===void 0?void 0:p.uncheckedFill)!==null&&f!==void 0?f:i==null?void 0:i.uncheckedFill)||"#c9cdd4",this._disableCheckedFill=((v=(m=t==null?void 0:t.switchStyle)===null||m===void 0?void 0:m.disableCheckedFill)!==null&&v!==void 0?v:i==null?void 0:i.disableCheckedFill)||"#94bfff",this._disableUncheckedFill=((b=(_=t==null?void 0:t.switchStyle)===null||_===void 0?void 0:_.disableUncheckedFill)!==null&&b!==void 0?b:i==null?void 0:i.disableUncheckedFill)||"#f2f3f5",this._circleFill=((C=(y=t==null?void 0:t.switchStyle)===null||y===void 0?void 0:y.circleFill)!==null&&C!==void 0?C:i==null?void 0:i.circleFill)||"#FFF"}get spaceBetweenTextAndCircle(){return this._spaceBetweenTextAndCircle}set spaceBetweenTextAndCircle(t){this._spaceBetweenTextAndCircle=t}get circleRadius(){return this._circleRadius}set circleRadius(t){this._circleRadius=t}get boxWidth(){return this._boxWidth}set boxWidth(t){this._boxWidth=t}get boxHeight(){return this._boxHeight}set boxHeight(t){this._boxHeight=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get uncheckedFill(){return this._uncheckedFill}set uncheckedFill(t){this._uncheckedFill=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableUncheckedFill(){return this._disableUncheckedFill}set disableUncheckedFill(t){this._disableUncheckedFill=t}get circleFill(){return this._circleFill}set circleFill(t){this._circleFill=t}getStyle(t){return new qu(t,this)}clone(){return new qu(this)}}let Kj;class Zu extends na{static get DEFAULT(){return Kj||(Kj=new Zu)}constructor(t={},e={},i={}){var r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A;super(t,e),this._buttonColor=((s=(r=t==null?void 0:t.buttonStyle)===null||r===void 0?void 0:r.buttonColor)!==null&&s!==void 0?s:i==null?void 0:i.buttonColor)||"#165DFF",this._buttonBorderColor=((a=(o=t==null?void 0:t.buttonStyle)===null||o===void 0?void 0:o.buttonBorderColor)!==null&&a!==void 0?a:i==null?void 0:i.buttonBorderColor)||"#165DFF",this._buttonLineWidth=((h=(l=t==null?void 0:t.buttonStyle)===null||l===void 0?void 0:l.buttonLineWidth)!==null&&h!==void 0?h:i==null?void 0:i.buttonLineWidth)||1,this._buttonBorderRadius=((u=(d=t==null?void 0:t.buttonStyle)===null||d===void 0?void 0:d.buttonBorderRadius)!==null&&u!==void 0?u:i==null?void 0:i.buttonBorderRadius)||2,this._buttonHoverColor=((g=(c=t==null?void 0:t.buttonStyle)===null||c===void 0?void 0:c.buttonHoverColor)!==null&&g!==void 0?g:i==null?void 0:i.buttonHoverColor)||"#4080FF",this._buttonHoverBorderColor=((f=(p=t==null?void 0:t.buttonStyle)===null||p===void 0?void 0:p.buttonHoverBorderColor)!==null&&f!==void 0?f:i==null?void 0:i.buttonHoverBorderColor)||"#4080FF",this._buttonTextHoverColor=(v=(m=t==null?void 0:t.buttonStyle)===null||m===void 0?void 0:m.buttonTextHoverColor)!==null&&v!==void 0?v:i==null?void 0:i.buttonTextHoverColor,this._buttonDisableColor=((b=(_=t==null?void 0:t.buttonStyle)===null||_===void 0?void 0:_.buttonDisableColor)!==null&&b!==void 0?b:i==null?void 0:i.buttonDisableColor)||"#94bfff",this._buttonDisableBorderColor=((C=(y=t==null?void 0:t.buttonStyle)===null||y===void 0?void 0:y.buttonDisableBorderColor)!==null&&C!==void 0?C:i==null?void 0:i.buttonDisableBorderColor)||"#94bfff",this._buttonTextDisableColor=(w=(S=t==null?void 0:t.buttonStyle)===null||S===void 0?void 0:S.buttonTextDisableColor)!==null&&w!==void 0?w:i==null?void 0:i.buttonTextDisableColor,this._buttonPadding=((A=(x=t==null?void 0:t.buttonStyle)===null||x===void 0?void 0:x.buttonPadding)!==null&&A!==void 0?A:i==null?void 0:i.buttonPadding)||10}get buttonColor(){return this._buttonColor}set buttonColor(t){this._buttonColor=t}get buttonBorderColor(){return this._buttonBorderColor}set buttonBorderColor(t){this._buttonBorderColor=t}get buttonLineWidth(){return this._buttonLineWidth}set buttonLineWidth(t){this._buttonLineWidth=t}get buttonBorderRadius(){return this._buttonBorderRadius}set buttonBorderRadius(t){this._buttonBorderRadius=t}get buttonHoverColor(){return this._buttonHoverColor}set buttonHoverColor(t){this._buttonHoverColor=t}get buttonHoverBorderColor(){return this._buttonHoverBorderColor}set buttonHoverBorderColor(t){this._buttonHoverBorderColor=t}get buttonTextHoverColor(){return this._buttonTextHoverColor}set buttonTextHoverColor(t){this._buttonTextHoverColor=t}get buttonDisableColor(){return this._buttonDisableColor}set buttonDisableColor(t){this._buttonDisableColor=t}get buttonDisableBorderColor(){return this._buttonDisableBorderColor}set buttonDisableBorderColor(t){this._buttonDisableBorderColor=t}get buttonTextDisableColor(){return this._buttonTextDisableColor}set buttonTextDisableColor(t){this._buttonTextDisableColor=t}get buttonTextHoverBorderColor(){return this._buttonTextHoverBorderColor}set buttonTextHoverBorderColor(t){this._buttonTextHoverBorderColor=t}get buttonPadding(){return this._buttonPadding}set buttonPadding(t){this._buttonPadding=t}getStyle(t){return new Zu(t,this)}clone(){return new Zu(this)}}const{EVENT_TYPE:XJt}=na;function tD(n,t,e,i=na,r,s){var o,a,l,h;return n||t?n instanceof na?n:typeof n=="function"?tD(n(e),t,e,i,r,s):(n||(n={}),r&&!L(n.autoWrapText)&&(n.autoWrapText=!0),i===YE?new YE(n??{},t??{},(o=s.checkboxStyle)!==null&&o!==void 0?o:{}):i===Ku?new Ku(n??{},t??{},(a=s.radioStyle)!==null&&a!==void 0?a:{}):i===qu?new qu(n??{},t??{},(l=s.switchStyle)!==null&&l!==void 0?l:{}):i===Zu?new Zu(n??{},t??{},(h=s.buttonStyle)!==null&&h!==void 0?h:{}):new i(n??{},t??{})):i.DEFAULT}class We{static get mode(){return We._mode||(We._mode=z_t()),We._mode}static set mode(t){We._mode=t}static RegisterCreateCanvas(t){We.CreateCanvas=t}static RegisterLoadImage(t){We.LoadImage=t}static GetCreateCanvasFunc(){return We.CreateCanvas?We.CreateCanvas:We.mode==="worker"?(t=200,e=200)=>new OffscreenCanvas(t,e):void 0}static RegisterRequestAnimationFrame(t){We.RequestAnimationFrame=t()}static GetRequestAnimationFrame(){if(We.RequestAnimationFrame)return We.RequestAnimationFrame}static RegisterCancelAnimationFrame(t){We.CancelAnimationFrame=t()}static GetCancelAnimationFrame(){if(We.CancelAnimationFrame)return We.CancelAnimationFrame}}function z_t(){let n="browser";try{window.type==="node"?n="node":typeof window>"u"||window.performance?typeof window>"u"&&(n="node"):n="miniApp"}catch{n="node"}return n}We.dpr=0;function W_t(){if(We.mode==="node")return;const n=document.createElement("style");n.id="vtable-style-styleSheet",n.textContent=`
.vtable .input-container {
	position: absolute;
	top:0px;
}
.vtable .table-scrollable {
	position: absolute;
	overflow: scroll;
}
.vtable .table-scrollable::-webkit-scrollbar-button{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-track-piece{
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-corner {
	background-color: transparent;
}
.vtable .table-scrollable::-webkit-scrollbar-thumb {
	border-radius      : 4px;
	background-color   : rgba(100, 100, 100, .5);
}

.vtable .table-scroll-end-point {
	opacity: 0;
	position: relative;
}
.vtable {
	/* overflow: auto  auto domvtable ;auto  */
	/* overflow: auto; */
	position: relative;
	width: 100%;
	height: 100%;
	text-align: left;
  -webkit-font-smoothing:auto;

  overflow: hidden; // for react-vtable dom custom element
}

.vtable-gantt {
	/* overflow: auto  auto domvtable ;auto  */
	/* overflow: auto; */
	position: absolute;
	width: 100%;
	height: 100%;
	text-align: left;
  -webkit-font-smoothing:auto;

  overflow: hidden; // for react-vtable dom custom element
}
.vtable .table-component-container {
  pointer-events: none;
  overflow: hidden;
  position: absolute;
  top: 0px;
  left: 0px;
}
.vtable > canvas {
	position: absolute;
	width: 0;
	height: 0;
}
.vtable .table-focus-control {
	position: relative !important;
	width: 1px;
	height: 1px;
	opacity: 0;
	padding: 0;
	margin: 0;
	box-sizing: border-box;
	pointer-events: none;
	max-width: 500px;
	max-height: 500px;
	float: none !important;
}
.vtable input.table-focus-control::-ms-clear {
	visibility: hidden;
}
.vtable input.table-focus-control.composition {
	opacity: 1;
	max-width: none;
	max-height: none;
}
`,document.head.appendChild(n)}function j_t(n){var t;return n!=null&&n.hoverOn||n!=null&&n.horizontalVisible&&(n==null?void 0:n.horizontalVisible)==="none"||!(n!=null&&n.horizontalVisible)&&(n==null?void 0:n.visible)==="none"?0:(t=n==null?void 0:n.width)!==null&&t!==void 0?t:7}function N_t(n){var t;return n!=null&&n.hoverOn||n!=null&&n.verticalVisible&&(n==null?void 0:n.verticalVisible)==="none"||!(n!=null&&n.verticalVisible)&&(n==null?void 0:n.visible)==="none"?0:(t=n==null?void 0:n.width)!==null&&t!==void 0?t:7}function $_t(n){return!!L(n)&&(!V(n)||n.some(t=>L(t)))}function V_t(n){return n===0||V(n)&&n.every(t=>t===0)}const G_t=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},fM=(n,t)=>G_t(n)===t,py=n=>fM(n,"object"),U_t=n=>fM(n,"string"),Y_t=n=>fM(n,"number"),X_t=n=>fM(n,"boolean");function Si(n,...t){if(!t.length)return n||{};const e=t.shift();if(py(n)&&py(e))for(const i in e)py(e[i])?(n[i]||Object.assign(n,{[i]:{}}),py(n[i])||Object.assign(n,{[i]:e[i]}),Si(n[i],e[i])):e[i]!==null&&e[i]!==void 0&&Object.assign(n,{[i]:e[i]});return Si(n,...t)}function qj(n){return typeof n=="function"&&(n=n()),L(n)?`${n}`:""}function Zj(n,t){let e=null;return function(...i){e||(n.apply(this,i),e=setTimeout(()=>{e=null},t))}}function K_t(n,t){let e=null;return function(...i){e||(e=setTimeout(()=>{n.apply(this,i),e=null},t))}}function Ok(n,t){for(n=`${n}`;n.length<t;)n="0"+n;return n}function Ch(n,t,e){n=(n=n.replace(/^\s*|\s*$/,"")).replace(/^#?([a-f0-9])([a-f0-9])([a-f0-9])$/i,"#$1$1$2$2$3$3");const i=Math.round(256*t)*1,r=n.match(new RegExp("^rgba?\\(\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])\\s*,\\s*(\\d|[1-9]\\d|1\\d{2}|2[0-4][0-9]|25[0-5])(?:\\s*,\\s*(0|1|0?\\.\\d+))?\\s*\\)$","i")),s=r&&L(r[4])?r[4]:null,o=r?[r[1],r[2],r[3]]:n.replace(/^#?([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])([a-f0-9][a-f0-9])/i,function(){return`${parseInt(arguments[1],16)},${parseInt(arguments[2],16)},${parseInt(arguments[3],16)}`}).split(/,/);return r?`rgb${s!==null?"a":""}(${Math.min(parseInt(o[0],10)+i,255)}, ${Math.min(parseInt(o[1],10)+i,255)}, ${Math.min(parseInt(o[2],10)+i,255)}${s!==null?`, ${s}`:""})`:["#",Ok(Math.min(parseInt(o[0],10)+i,255).toString(16),2),Ok(Math.min(parseInt(o[1],10)+i,255).toString(16),2),Ok(Math.min(parseInt(o[2],10)+i,255).toString(16),2)].join("")}function mM(n){return U_t(n)||Y_t(n)||X_t(n)?n.toString():""}function XE(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)}function gx(n,t,e){return e!=="desc"?n===t?0:n>t?1:-1:n===t?0:n<t?1:-1}function q_t(n,t){let e,i=n;for(;(e=t.shift())&&(i=i[e],i););return i}function Z_t(n){return/^-?\d+(\.\d+)?$/.test(n)}function mv(n){const t=[];for(let e=0;e<n.length;e++)t.indexOf(n[e])===-1&&t.push(n[e]);return t}function J_t(n){const t=window.getSelection();if(t.rangeCount){const e=t.getRangeAt(0);return e.endOffset>e.startOffset&&n.contains(e.commonAncestorContainer)}return!1}function eD(n,t,e){e(n),n!=null&&n[t]&&Array.isArray(n==null?void 0:n[t])&&n[t].forEach(i=>eD(i,t,e))}const qK=typeof window>"u"||window.window===void 0;let Dk,Fk;const ZK={get find(){return Dk||(Dk=Array.prototype.find?(n,t)=>Array.prototype.find.call(n,t):(n,t)=>{const e=ZK.findIndex(n,t);return e>=0?n[e]:void 0},Dk)},get findIndex(){return Fk||(Fk=Array.prototype.findIndex?(n,t)=>Array.prototype.findIndex.call(n,t):(n,t)=>{const{length:e}=n;for(let i=0;i<e;i++)if(t(n[i],i,n))return i;return-1},Fk)}};function Q_t(){if(qK)return{IE:!1,Edge:!1,Chrome:!1,Firefox:!1,Safari:!1};const n=window.navigator.userAgent.toLowerCase();return{IE:!!/(msie|trident)/.exec(n),Edge:n.indexOf("edge")>-1,Chrome:n.indexOf("chrome")>-1&&n.indexOf("edge")===-1,Firefox:n.indexOf("firefox")>-1,Safari:n.indexOf("safari")>-1&&n.indexOf("edge")===-1}}const{IE:t0t,Chrome:KJt,Firefox:qJt,Edge:ZJt,Safari:JJt}=Q_t();function e0t(n){return n===Object(n)}function rb(...n){const t={};return n.forEach(e=>{for(const i in e)Object.defineProperty(t,i,{get:()=>e[i],set(r){e[i]=r},configurable:!0,enumerable:!0})}),t}function JK(n,t,...e){let i=n;for(let r=0;r<e.length&&i!=null;r++)i=t(i,e[r]);return i}function fy(n,...t){return JK(n,(e,i)=>e[i],...t)}function ni(n,...t){return typeof n=="function"?n(...t):n}function i0t(n,t,e){const i=mM(n);(typeof e!="number"||!isFinite(e)||Math.floor(e)!==e||e>i.length)&&(e=i.length),e-=t.length;const r=i.lastIndexOf(t,e);return r!==-1&&r===e}function ua(n){return!!(n&&typeof n.then=="function")}function px(n,t){ua(n)?n.then(e=>{t(e)}).catch(e=>{}):t(n)}function n0t(n){return!!n.changedTouches}function r0t(n,t){if(n[t])return n[t];const e=t.toLowerCase();if(n[e])return n[e];const i=t.toLowerCase();if(n[i])return n[i];for(const r in n)if(r.toLowerCase()===e)return n[r]}function QK(n){return Array.isArray(n)?n.length===3?[n[0],n[1],n[2],n[1]]:n.length===2?[n[0],n[1],n[0],n[1]]:n.length===1?[n[0],n[0],n[0],n[0]]:[n[0],n[1],n[2],n[3]]:[n,n,n,n]}function So(n,t,e){return n.start.col<=t&&t<=n.end.col&&n.start.row<=e&&e<=n.end.row||n.end.col<=t&&t<=n.start.col&&n.end.row<=e&&e<=n.start.row||n.end.col<=t&&t<=n.start.col&&n.start.row<=e&&e<=n.end.row||n.start.col<=t&&t<=n.end.col&&n.end.row<=e&&e<=n.start.row}function s0t(n,t,e){for(let i=0;i<n.length;i++){const r=n[i],s=Math.min(r.start.col,r.end.col),o=Math.max(r.start.col,r.end.col),a=Math.min(r.start.row,r.end.row),l=Math.max(r.start.row,r.end.row);if(s<=t&&t<=o&&a<=e&&e<=l||o<=t&&t<=s&&l<=e&&e<=a)return!0}return!1}function Jj(n){return{start:{col:Math.min(n.start.col,n.end.col),row:Math.min(n.start.row,n.end.row)},end:{col:Math.max(n.start.col,n.end.col),row:Math.max(n.start.row,n.end.row)}}}function o0t(n,t){const e=Jj(n),i=Jj(t);return Math.max(e.start.col,i.start.col)<=Math.min(e.end.col,i.end.col)&&Math.max(e.start.row,i.start.row)<=Math.min(e.end.row,i.end.row)}const a0t={IE:t0t},tq={isObject:e0t},my={endsWith:i0t},l0t={isTouchEvent:n0t},h0t={toBoxArray:QK},d0t=Function.prototype,mt={CLICK_CELL:"click_cell",DBLCLICK_CELL:"dblclick_cell",MOUSEDOWN_CELL:"mousedown_cell",MOUSEUP_CELL:"mouseup_cell",SELECTED_CELL:"selected_cell",SELECTED_CLEAR:"selected_clear",BEFORE_KEYDOWN:"before_keydown",KEYDOWN:"keydown",MOUSEENTER_TABLE:"mouseenter_table",MOUSELEAVE_TABLE:"mouseleave_table",MOUSEDOWN_TABLE:"mousedown_table",MOUSEMOVE_TABLE:"mousemove_table",MOUSEMOVE_CELL:"mousemove_cell",MOUSEENTER_CELL:"mouseenter_cell",MOUSELEAVE_CELL:"mouseleave_cell",CONTEXTMENU_CELL:"contextmenu_cell",RESIZE_COLUMN:"resize_column",RESIZE_COLUMN_END:"resize_column_end",RESIZE_ROW:"resize_row",RESIZE_ROW_END:"resize_row_end",CHANGE_HEADER_POSITION_START:"change_header_position_start",CHANGE_HEADER_POSITION:"change_header_position",CHANGING_HEADER_POSITION:"changing_header_position",CHANGE_HEADER_POSITION_FAIL:"change_header_position_fail",SORT_CLICK:"sort_click",AFTER_SORT:"after_sort",FREEZE_CLICK:"freeze_click",SCROLL:"scroll",CAN_SCROLL:"can_scroll",SCROLL_HORIZONTAL_END:"scroll_horizontal_end",SCROLL_VERTICAL_END:"scroll_vertical_end",DROPDOWN_MENU_CLICK:"dropdown_menu_click",MOUSEOVER_CHART_SYMBOL:"mouseover_chart_symbol",DRAG_SELECT_END:"drag_select_end",COPY_DATA:"copy_data",DROPDOWN_ICON_CLICK:"dropdown_icon_click",DROPDOWN_MENU_CLEAR:"dropdown_menu_clear",TREE_HIERARCHY_STATE_CHANGE:"tree_hierarchy_state_change",SHOW_MENU:"show_menu",HIDE_MENU:"hide_menu",ICON_CLICK:"icon_click",LEGEND_ITEM_CLICK:"legend_item_click",LEGEND_ITEM_HOVER:"legend_item_hover",LEGEND_ITEM_UNHOVER:"legend_item_unHover",LEGEND_CHANGE:"legend_change",MOUSEENTER_AXIS:"mouseenter_axis",MOUSELEAVE_AXIS:"mouseleave_axis",CHECKBOX_STATE_CHANGE:"checkbox_state_change",RADIO_STATE_CHANGE:"radio_state_change",SWITCH_STATE_CHANGE:"switch_state_change",BEFORE_SET_SIZE:"before_set_size",BEFORE_INIT:"before_init",AFTER_RENDER:"after_render",INITIALIZED:"initialized",CHANGE_CELL_VALUE:"change_cell_value",DRAG_FILL_HANDLE_END:"drag_fill_handle_end",MOUSEDOWN_FILL_HANDLE:"mousedown_fill_handle",DBLCLICK_FILL_HANDLE:"dblclick_fill_handle",EMPTY_TIP_CLICK:"empty_tip_click",EMPTY_TIP_DBLCLICK:"empty_tip_dblclick",BUTTON_CLICK:"button_click",BEFORE_CACHE_CHART_IMAGE:"before_cache_chart_image"},u0t=n=>{switch(Object.prototype.toString.call(n)){case"[object Object]":return"object";case"[object Function]":return"function";case"[object Array]":return"array";case"[object String]":return"string";case"[object Number]":return"number";case"[object RegExp]":return"regExp";case"[object Boolean]":return"boolean";case"[object Symbol]":return"symbol";case"[object Date]":return"date";case"[object Undefined]":return"undefined";case"[object Null]":return"null";case"[object Error]":return"error";case"[object HTMLDocument]":return"document";case"[object global]":return"global";default:return null}},c0t=(n,t)=>u0t(n)===t,g0t=n=>c0t(n,"object");function eq(n,t,e){let i,r,s,o,a,l,h=0,d=!1,u=!1,c=!0;const g=!t&&t!==0&&typeof requestAnimationFrame=="function";if(typeof n!="function")throw new TypeError("Expected a function");function p(_){const b=i,y=r;return r=void 0,i=void 0,h=_,o=n.apply(y,b),o}function f(_,b){return g?requestAnimationFrame(_):setTimeout(_,b)}function m(_){const b=_-l;return l===void 0||b>=t||b<0||d&&_-h>=s}function v(){const _=Date.now();if(m(_))return function(b){return a=void 0,c&&i?p(b):(r=void 0,i=void 0,o)}(_);a=f(v,function(b){const y=b-h,C=t&&-(b-l);return d?Math.min(C,s-y):C}(_))}return t=+t||0,g0t(e)&&(u=!!e.leading,d="maxWait"in e,d&&(s=Math.max(+e.maxWait||0,t)),c="trailing"in e?!!e.trailing:c),function(..._){const b=Date.now(),y=m(b);if(i=_,r=this,l=b,y){if(a===void 0)return function(C){return h=C,a=f(v,t),u?p(C):o}(l);if(d)return a=f(v,t),p(l)}return a===void 0&&(a=f(v,t)),o}}let p0t=1;class f0t{constructor(t,e,i){var r;if(this.resizeTime=100,this.lastSize={width:0,height:0},this.mutationResize=()=>{this.onResize()},this.callBack=()=>{const s=this.getSize();let o=!1;s.width===this.lastSize.width&&s.height===this.lastSize.height&&(o=!0),this.lastSize=s,this.cb&&this.cb(Object.assign(Object.assign({},this.lastSize),{windowSizeNotChange:o}))},this.onResize=()=>{this.callBackDebounce()},this.element=t,this.cb=e,this.lastSize=this.getSize(),i&&(this.resizeTime=Math.max(i,16)),this.callBackDebounce=eq(this.callBack,this.resizeTime),window==null||window.addEventListener("resize",this.onResize),"ResizeObserver"in window){const s=window.ResizeObserver;this.observer=new s(this.mutationResize),(r=this.observer)===null||r===void 0||r.observe(this.element)}else"MutationObserver"in window&&(this.observer=new MutationObserver(this.mutationResize),this.observer.observe(this.element,{attributes:!0,attributeFilter:["style"]}))}disConnect(){window.removeEventListener("resize",this.onResize),this.observer&&(this.observer.disconnect(),this.observer=void 0)}setSize(t){this.lastSize=t}checkSize(){const t=this.getSize();return t.width!==this.lastSize.width||t.height!==this.lastSize.height}getSize(){return this.element?{width:Math.floor(this.element.clientWidth),height:Math.floor(this.element.clientHeight)}:Object.assign({},this.lastSize)}}class vM{constructor(){this.listeners={},this.reseizeListeners={}}on(t,e,i,...r){if(We.mode==="node")return-1;const s=p0t++;if(t!=null&&t.addEventListener)if(e!=="resize"||t===window)t==null||t.addEventListener(e,i,...r);else{const a=new f0t(t,i,this.resizeTime);this.reseizeListeners[s]=a}const o={target:t,type:e,listener:i,options:r};return this.listeners[s]=o,s}once(t,e,i,...r){if(We.mode==="node")return-1;const s=this.on(t,e,(...o)=>{this.off(s),i(...o)},...r);return s}off(t){var e;if(We.mode==="node"||t===null)return;const i=(e=this.listeners)===null||e===void 0?void 0:e[t];i&&(delete this.listeners[t],i.target.removeEventListener&&i.target.removeEventListener(i.type,i.listener,...i.options))}fire(t,e,...i){if(We.mode!=="node")for(const r in this.listeners){const s=this.listeners[r];s.target===t&&s.type===e&&s.listener.call(s.target,...i)}}hasListener(t,e){if(We.mode==="node")return!1;let i=!1;for(const r in this.listeners){const s=this.listeners[r];s.target===t&&s.type===e&&(i=!0)}return i}clear(){if(We.mode!=="node"){for(const t in this.listeners){const e=this.listeners[t];e.target.removeEventListener&&e.target.removeEventListener(e.type,e.listener,...e.options)}for(const t in this.reseizeListeners){const e=this.reseizeListeners[t];e==null||e.disConnect()}this.listeners={}}}release(){We.mode!=="node"&&(this.clear(),this.listeners={})}}const nu=(n,t)=>{let e=0,i=n.length-1;for(;e<=i;){const r=Math.floor((e+i)/2);if(n[r]===t)return r;n[r]>t?i=r-1:e=r+1}return i<0?0:i};class Kh{constructor(){this._keys=[],this._vals={},this._sorted=!1}count(){return this._keys.length}values(){return this._vals}valueArr(){return Object.values(this._vals)}adjustOrder(t,e,i){const{_keys:r}=this;if(this._sorted||(r.sort((o,a)=>o<a?-1:o>a?1:0),this._sorted=!0),t>e){const o=[];for(let a=nu(r,t+i-1);a>=0;a--){const l=r[a];if(l>=t)o.push(this.get(l));else if(e<=l&&l<t)this.put(l+i,this.get(l));else if(l<e)break}for(let a=0;a<i;a++)this.put(e+a,o[i-1-a])}const{length:s}=r;if(t<e){const o=[];for(let a=nu(r,t);a<s;a++){const l=r[a];if(l>=t&&l<t+i)o.push(this.get(l));else if(t+i<=l&&l<=e)this.put(l-i,this.get(l));else if(l>e)break}for(let a=0;a<i;a++)this.put(e+a,o[a])}}exchangeOrder(t,e,i,r,s){const{_keys:o}=this;if(this._sorted||(o.sort((a,l)=>a<l?-1:a>l?1:0),this._sorted=!0),t>i){const a=[],l=[];for(let h=nu(o,i);h<nu(o,t)+e;h++){const d=o[h];d>=t&&d<t+e?l.push(this.get(d)):a.push(this.get(d))}for(let h=0;h<e;h++)this.put(s+h,l[h]);for(let h=0;h<a.length;h++)this.put(s+e+h,a[h])}else{const a=[],l=[];for(let h=nu(o,t);h<nu(o,i)+r;h++){const d=o[h];d>=t&&d<t+e?l.push(this.get(d)):a.push(this.get(d))}for(let h=0;h<e;h++)this.put(s+h,l[h]);for(let h=0;h<a.length;h++)this.put(t+h,a[h])}}del(t){delete this._vals[t];const e=this._keys.indexOf(t);e!==-1&&this._keys.splice(e,1)}put(t,e){t in this._vals||(this._keys.push(t),this._sorted=!1),this._vals[t]=e}get(t){return this._vals[t]}has(t){return L(this._vals[t])}contain(t){return Object.values(this._vals).indexOf(t)>=0}each(t,e,i){const{_keys:r}=this,{length:s}=r;this._sorted||(r.sort((o,a)=>o<a?-1:o>a?1:0),this._sorted=!0);for(let o=nu(r,t);o<s;o++){const a=r[o];if(t<=a&&a<=e){if(i(this.get(a),a)===!1)break}else if(e<a)return}}clear(){this._keys.length=0,this._vals={},this._sorted=!1}getLastIndex(){return this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.del(t)}delAndReorder(t){if(!this.has(t))return;const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}addAndReorder(t,e){if(L(e)){const i=this.getLastIndex();this.adjustOrder(t,t+1,i-t),this.put(t,e)}}}let Tu=class KE{constructor(t,e,i,r){this.bounds=new Bi,this.bounds.set(t,e,t+i,e+r)}static bounds(t,e,i,r){return new KE(t,e,Math.round(i-t),Math.round(r-e))}get left(){return this.bounds.x1}set left(t){this.bounds.x1=t}get top(){return this.bounds.y1}set top(t){this.bounds.y1=t}get right(){return this.bounds.x2}set right(t){this.bounds.x2=t}get bottom(){return this.bounds.y2}set bottom(t){this.bounds.y2=t}get width(){return this.bounds.width()}set width(t){this.bounds.x2=this.bounds.x1+t}get height(){return this.bounds.height()}set height(t){this.bounds.y2=this.bounds.y1+t}offsetLeft(t){this.bounds.translate(t,0)}offsetTop(t){this.bounds.translate(0,t)}copy(){return new KE(this.left,this.top,this.width,this.height)}contains(t){return this.bounds.encloses(t.bounds)}inPoint(t,e){return this.bounds.contains(t,e)}};function m0t(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#282a2e":"#2d3137"}const Qj={name:"DARK",underlayBackgroundColor:"transparent",defaultStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},headerStyle:{color:"#D3D5DA",bgColor:"#373b45",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#2F4774"}},rowHeaderStyle:{},cornerHeaderStyle:{},bodyStyle:{color:"#e5e7ea",bgColor:m0t,fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#444A54",padding:[8,12,8,12],hover:{cellBgColor:"#29364D"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:10,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(255, 255, 255, 0.1)",cellBorderColor:"#4284FF",cellBorderLineWidth:2},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"},functionalIconsStyle:{sort_color:"#FFFFFF",sort_color_opacity:"0.75",sort_color_2:"#416EFF",sort_color_opacity_2:"1",frozen_color:"#FFFFFF",frozen_color_opacity:"0.75",collapse_color:"#FFF",collapse_color_opacity:"0.75",expand_color:"#FFF",expand_color_opacity:"0.75",dragReorder_color:"#FFF",dragReorder_color_opacity:"0.75"}};function v0t(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#FFF":"#F4F8FF"}const t5={name:"BRIGHT",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#5286FA",hover:{cellBgColor:"#2E67E3"}},headerStyle:{color:"#FFF",bgColor:"#5389FF",borderColor:"#A1C1FF",hover:{cellBgColor:"#2E67E3"}},bodyStyle:{color:"#000",bgColor:v0t,borderColor:"#E0EAFE",hover:{cellBgColor:"#E9EFFD"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"#CBDCFE",endColor:"#CBDCFE",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function _0t(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#fbfbfc":"#FFF"}const e5={name:"ARCO",underlayBackgroundColor:"#FFF",defaultStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12]},headerStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:600,lineHeight:14,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},rowHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},cornerHeaderStyle:{color:"#1B1F23",bgColor:"#EEF1F5",fontSize:12,fontFamily:"PingFang SC",fontWeight:500,lineHeight:12,borderColor:"#e1e4e8",padding:[8,12,8,12],hover:{cellBgColor:"#c8daf6"}},bodyStyle:{padding:[8,12,8,12],color:"#141414",fontSize:14,fontFamily:"Arial,sans-serif",fontWeight:400,textAlign:"left",bgColor:_0t,borderColor:"#e1e4e8",lineHeight:14,hover:{cellBgColor:"#F7F8FA",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#d1d5da",borderLineWidth:1,borderLineDash:[],cornerRadius:4,shadowBlur:6,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"rgba(00, 24, 47, 0.06)"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:4,startColor:"rgba(00, 24, 47, 0.05)",endColor:"rgba(00, 24, 47, 0)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#3073f2"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function b0t(n){const{row:t,table:e}=n;return 1&t-e.frozenRowCount?"#FDFDFD":"#FAF9FB"}const i5={name:"DEFAULT",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:"#E1E4E8",color:"#000",bgColor:"#ECF1F5"},headerStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},rowHeaderStyle:{fontSize:16,fontWeight:"bold",bgColor:"#ECF1F5",hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},cornerHeaderStyle:{fontSize:16,fontWeight:"bold"},bodyStyle:{fontSize:14,bgColor:b0t,hover:{cellBgColor:"#CCE0FF",inlineRowBgColor:"#F3F8FF",inlineColumnBgColor:"#F3F8FF"}},frameStyle:{borderColor:"#E1E4E8",borderLineWidth:1,borderLineDash:[],cornerRadius:0,shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"black"},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF",width:3},frozenColumnLine:{shadow:{width:3,startColor:"rgba(225, 228, 232, 0.6)",endColor:"rgba(225, 228, 232, 0.6)",visible:"always"}},selectionStyle:{cellBgColor:"rgba(0, 0, 255,0.1)",cellBorderLineWidth:2,cellBorderColor:"#0000ff"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}};function y0t(n){const{row:t,table:{frozenRowCount:e}}=n;return e-1===t?["#f2f2f2","#f2f2f2","#ccc7c7","#f2f2f2"]:["#f2f2f2"]}function C0t(n){const{col:t,table:e}=n,{colCount:i,frozenColCount:r}=e,s="#ccc7c7";return r-1===t||i-1===t?[s,"#f2f2f2","#ccc7c7",null]:[s,null,"#ccc7c7",null]}const n5={name:"SIMPLIFY",underlayBackgroundColor:"#FFF",defaultStyle:{borderColor:C0t,hover:{cellBorderColor:"#0000FF",cellBgColor:"#D0E0E3"},bgColor:"#FFF"},headerStyle:{color:"rgba(0, 0, 0, 0.87)",borderColor:y0t},bodyStyle:{color:"rgba(0, 0, 0, 0.87)"},frameStyle:{borderColor:"#f2f2f2",borderLineWidth:1},columnResize:{lineWidth:1,lineColor:"#416EFF",bgColor:"#D9E2FF"},selectionStyle:{cellBorderColor:"#FD5",cellBgColor:"rgba(111, 168, 220, 0.1)"},tooltipStyle:{bgColor:"#FFF",color:"#000",fontSize:12,fontFamily:"Arial,sans-serif"}},S0t={},r5=16,s5="Arial,sans-serif",x0t="#FFF",w0t="#000",A0t=1,M0t=[],T0t="#000",iD=/^(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/,vy="$$indicator$$",k0t='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path  d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM549.333333 288a5.333333 5.333333 0 0 1 5.333334 5.333333V469.333333h176a5.333333 5.333333 0 0 1 5.333333 5.333334v74.666666a5.333333 5.333333 0 0 1-5.333333 5.333334H554.666667v176a5.333333 5.333333 0 0 1-5.333334 5.333333h-74.666666a5.333333 5.333333 0 0 1-5.333334-5.333333V554.666667H293.333333a5.333333 5.333333 0 0 1-5.333333-5.333334v-74.666666a5.333333 5.333333 0 0 1 5.333333-5.333334H469.333333V293.333333a5.333333 5.333333 0 0 1 5.333334-5.333333h74.666666z"></path></svg>',R0t='<svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="200" height="200"><rect x="0" y="0" width="1024" height="1024" rx="20%" ry="20%" fill="#ffffff" /><path d="M810.666667 85.333333c70.688 0 128 57.312 128 128v597.333334c0 70.688-57.312 128-128 128H213.333333c-70.688 0-128-57.312-128-128V213.333333c0-70.688 57.312-128 128-128h597.333334z m0 85.333334H213.333333a42.666667 42.666667 0 0 0-42.613333 40.533333L170.666667 213.333333v597.333334a42.666667 42.666667 0 0 0 40.533333 42.613333L213.333333 853.333333h597.333334a42.666667 42.666667 0 0 0 42.613333-40.533333L853.333333 810.666667V213.333333a42.666667 42.666667 0 0 0-40.533333-42.613333L810.666667 170.666667zM693.333333 469.333333a42.666667 42.666667 0 1 1 0 85.333334H330.666667a42.666667 42.666667 0 1 1 0-85.333334h362.666666z"></path></svg>',B0t={type:"line"};function P0t(n){return{defaultAxisStyle:um(n.defaultAxisStyle),leftAxisStyle:um(n.leftAxisStyle),rightAxisStyle:um(n.rightAxisStyle),topAxisStyle:um(n.topAxisStyle),bottomAxisStyle:um(n.bottomAxisStyle)}}function um(n){return n||{}}const E0t={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:12,fontWeight:"bold",fill:"#4E5969"},contentStyle:{fontSize:12,fill:"#4E5969"},panel:{visible:!0,fill:"#fff",stroke:"#ffffff",lineWidth:0,cornerRadius:3,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:"rgba(0, 0, 0, 0.1)",size:0,space:12}};function ag(n,t,e,i){var r,s,o;return(o=(s=(r=fy(n,...e))!==null&&r!==void 0?r:fy(t,...e))!==null&&s!==void 0?s:i&&fy(n,...i))!==null&&o!==void 0?o:i&&fy(t,...i)}class Fs{constructor(t,e){this._defaultStyle=null,this._header=null,this._cornerHeader=null,this._cornerRightTopCell=null,this._cornerLeftBottomCell=null,this._cornerRightBottomCell=null,this._rightFrozen=null,this._bottomFrozen=null,this._rowHeader=null,this._body=null,this._groupTitle=null,this._scroll=null,this._tooltip=null,this._frameStyle=null,this._columnResize=null,this._dragHeaderSplitLine=null,this._frozenColumnLine=null,this._selectionStyle=null,this._axisStyle=null,this._checkboxStyle=null,this._radioStyle=null,this._switchStyle=null,this._buttonStyle=null,this._textPopTipStyle=null,this._internalIconsStyle=null,this.isPivot=!1,this.name="",this.internalTheme={obj:t,superTheme:e},this.name=ag(t,e,["name"])}getExtendTheme(){return this.internalTheme.obj}clearBodyStyleCache(){this._body=null}get font(){const{obj:t,superTheme:e}=this.internalTheme;return ag(t,e,["font"],["bodyStyle","font"])}get underlayBackgroundColor(){const{obj:t,superTheme:e}=this.internalTheme;return ag(t,e,["underlayBackgroundColor"])}get cellInnerBorder(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=ag(e,i,["cellInnerBorder"]))===null||t===void 0||t}get cellBorderClipDirection(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=ag(e,i,["cellBorderClipDirection"]))!==null&&t!==void 0?t:"top-left"}get _contentOffset(){var t;const{obj:e,superTheme:i}=this.internalTheme;return(t=ag(e,i,["_contentOffset"]))!==null&&t!==void 0?t:0}get defaultStyle(){const t=this;if(!this._defaultStyle){const{obj:e,superTheme:i}=this.internalTheme,r=Si({},i.defaultStyle,e.defaultStyle);this._defaultStyle={get fontSize(){var s;return(s=r.fontSize)!==null&&s!==void 0?s:r5},get fontFamily(){var s;return(s=r.fontFamily)!==null&&s!==void 0?s:s5},get fontWeight(){return r.fontWeight},get fontVariant(){return r.fontVariant},get fontStyle(){return r.fontStyle},get bgColor(){var s;return(s=r.bgColor)!==null&&s!==void 0?s:x0t},get color(){var s;return(s=r.color)!==null&&s!==void 0?s:T0t},get borderColor(){var s;return(s=r.borderColor)!==null&&s!==void 0?s:w0t},get borderLineWidth(){var s;return(s=r.borderLineWidth)!==null&&s!==void 0?s:A0t},get borderLineDash(){var s;return(s=r.borderLineDash)!==null&&s!==void 0?s:M0t},get hover(){if(r.hover)return{get cellBgColor(){var s,o;return(o=(s=r.hover)===null||s===void 0?void 0:s.cellBgColor)!==null&&o!==void 0?o:void 0},get inlineColumnBgColor(){var s,o,a,l,h,d;return(d=(o=(s=r.hover)===null||s===void 0?void 0:s.inlineColumnBgColor)!==null&&o!==void 0?o:!((a=r.hover)===null||a===void 0)&&a.cellBgColor&&typeof((l=r.hover)===null||l===void 0?void 0:l.cellBgColor)=="string"?Ch((h=r.hover)===null||h===void 0?void 0:h.cellBgColor,.1):void 0)!==null&&d!==void 0?d:void 0},get inlineRowBgColor(){var s,o,a,l,h,d;return(d=(o=(s=r.hover)===null||s===void 0?void 0:s.inlineRowBgColor)!==null&&o!==void 0?o:!((a=r.hover)===null||a===void 0)&&a.cellBgColor&&typeof((l=r.hover)===null||l===void 0?void 0:l.cellBgColor)=="string"?Ch((h=r.hover)===null||h===void 0?void 0:h.cellBgColor,.1):void 0)!==null&&d!==void 0?d:void 0}}},get select(){if(r.select)return{get inlineColumnBgColor(){var s,o,a,l,h,d;return(d=(l=(o=(s=r.select)===null||s===void 0?void 0:s.inlineColumnBgColor)!==null&&o!==void 0?o:(a=t.selectionStyle)===null||a===void 0?void 0:a.inlineColumnBgColor)!==null&&l!==void 0?l:!((h=t.selectionStyle)===null||h===void 0)&&h.cellBgColor&&typeof t.selectionStyle.cellBgColor=="string"?Ch(t.selectionStyle.cellBgColor,.1):void 0)!==null&&d!==void 0?d:void 0},get inlineRowBgColor(){var s,o,a,l,h;return(h=(a=(o=(s=r.select)===null||s===void 0?void 0:s.inlineRowBgColor)!==null&&o!==void 0?o:t.selectionStyle.inlineRowBgColor)!==null&&a!==void 0?a:!((l=t.selectionStyle)===null||l===void 0)&&l.cellBgColor&&typeof t.selectionStyle.cellBgColor=="string"?Ch(t.selectionStyle.cellBgColor,.1):void 0)!==null&&h!==void 0?h:void 0}}},get padding(){var s;return(s=r.padding)!==null&&s!==void 0?s:[10,16,10,16]},get textAlign(){var s;return(s=r.textAlign)!==null&&s!==void 0?s:"left"},get textBaseline(){var s;return(s=r.textBaseline)!==null&&s!==void 0?s:"middle"},get textOverflow(){var s;return(s=r.textOverflow)!==null&&s!==void 0?s:"ellipsis"},get lineHeight(){return r.lineHeight},get autoWrapText(){var s;return(s=r.autoWrapText)!==null&&s!==void 0&&s},get lineClamp(){var s;return(s=r.lineClamp)!==null&&s!==void 0?s:"auto"},get linkColor(){var s;return(s=r.linkColor)!==null&&s!==void 0?s:"#3772ff"},get cursor(){var s;return(s=r.cursor)!==null&&s!==void 0?s:"auto"},get marked(){var s;return(s=r.marked)!==null&&s!==void 0&&s},get underline(){var s;return(s=r.underline)!==null&&s!==void 0&&s},get underlineColor(){return r.underlineColor},get underlineDash(){return r.underlineDash},get underlineOffset(){return r.underlineOffset},get lineThrough(){var s;return(s=r.lineThrough)!==null&&s!==void 0&&s},get lineThroughColor(){return r.lineThroughColor},get lineThroughDash(){return r.lineThroughDash}}}return this._defaultStyle}get cornerHeaderStyle(){if(!this._cornerHeader){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},this.defaultStyle,e.cornerHeaderStyle,t.cornerHeaderStyle);this._cornerHeader=this.getStyle(i)}return this._cornerHeader}get cornerRightTopCellStyle(){if(!this._cornerRightTopCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightTopCellStyle&&!t.cornerRightTopCellStyle)return this._cornerRightTopCell;const i=Si({},this.defaultStyle,e.cornerRightTopCellStyle,t.cornerRightTopCellStyle);this._cornerRightTopCell=this.getStyle(i)}return this._cornerRightTopCell}get cornerLeftBottomCellStyle(){if(!this._cornerLeftBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerLeftBottomCellStyle&&!t.cornerLeftBottomCellStyle)return this._cornerLeftBottomCell;const i=Si({},this.defaultStyle,e.cornerLeftBottomCellStyle,t.cornerLeftBottomCellStyle);this._cornerLeftBottomCell=this.getStyle(i)}return this._cornerLeftBottomCell}get cornerRightBottomCellStyle(){if(!this._cornerRightBottomCell){const{obj:t,superTheme:e}=this.internalTheme;if(!e.cornerRightBottomCellStyle&&!t.cornerRightBottomCellStyle)return this._cornerRightBottomCell;const i=Si({},this.defaultStyle,e.cornerRightBottomCellStyle,t.cornerRightBottomCellStyle);this._cornerRightBottomCell=this.getStyle(i)}return this._cornerRightBottomCell}get rightFrozenStyle(){if(!this._rightFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.rightFrozenStyle&&!t.rightFrozenStyle)return this._rightFrozen;const i=Si({},this.defaultStyle,this.rowHeaderStyle,e.rightFrozenStyle,t.rightFrozenStyle);this._rightFrozen=this.getStyle(i)}return this._rightFrozen}get bottomFrozenStyle(){if(!this._bottomFrozen){const{obj:t,superTheme:e}=this.internalTheme;if(!e.bottomFrozenStyle&&!t.bottomFrozenStyle)return this._bottomFrozen;const i=Si({},this.defaultStyle,this.headerStyle,e.bottomFrozenStyle,t.bottomFrozenStyle);this._bottomFrozen=this.getStyle(i)}return this._bottomFrozen}get rowHeaderStyle(){var t;if(!this._rowHeader){const{obj:e,superTheme:i}=this.internalTheme,r=Si({},this.defaultStyle,i.rowHeaderStyle,(t=e.rowHeaderStyle)!==null&&t!==void 0?t:this.isPivot?null:e.headerStyle);this._rowHeader=this.getStyle(r)}return this._rowHeader}get headerStyle(){if(!this._header){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},this.defaultStyle,e.headerStyle,t.headerStyle);this._header=this.getStyle(i)}return this._header}get bodyStyle(){if(!this._body){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},this.defaultStyle,e.bodyStyle,t.bodyStyle);this._body=this.getStyle(i)}return this._body}get groupTitleStyle(){if(!this._groupTitle){const{obj:t,superTheme:e}=this.internalTheme;if(!e.groupTitleStyle&&!t.groupTitleStyle)return this._groupTitle;const i=Si({},this.defaultStyle,e.groupTitleStyle,t.groupTitleStyle);this._groupTitle=this.getStyle(i)}return this._groupTitle}get frameStyle(){if(!this._frameStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.frameStyle,t.frameStyle);this._frameStyle={get borderColor(){return i.borderColor},get borderLineWidth(){return i.borderLineWidth},get borderLineDash(){return i.borderLineDash},get innerBorder(){return i.innerBorder},get shadowBlur(){return i.shadowBlur},get shadowColor(){return i.shadowColor},get shadowOffsetX(){return i.shadowOffsetX},get shadowOffsetY(){return i.shadowOffsetY},get cornerRadius(){return i.cornerRadius}}}return this._frameStyle}get scrollStyle(){if(!this._scroll){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.scrollStyle,t.scrollStyle);this._scroll={get scrollSliderColor(){var r;return(r=i.scrollSliderColor)!==null&&r!==void 0?r:"#C0C0C0"},get scrollSliderCornerRadius(){return i.scrollSliderCornerRadius},get scrollRailColor(){return i.scrollRailColor},get visible(){var r;return(r=i.visible)!==null&&r!==void 0?r:"scrolling"},get verticalVisible(){return i.verticalVisible},get horizontalVisible(){return i.horizontalVisible},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:7},get hoverOn(){var r;return(r=i.hoverOn)===null||r===void 0||r},get barToSide(){var r;return(r=i.barToSide)!==null&&r!==void 0&&r},get horizontalPadding(){var r;return(r=i.horizontalPadding)!==null&&r!==void 0?r:0},get verticalPadding(){var r;return(r=i.verticalPadding)!==null&&r!==void 0?r:0}}}return this._scroll}get tooltipStyle(){if(!this._tooltip){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.tooltipStyle,t.tooltipStyle);this._tooltip={get fontFamily(){var r;return(r=i.fontFamily)!==null&&r!==void 0?r:s5},get fontSize(){var r;return(r=i.fontSize)!==null&&r!==void 0?r:r5},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#000"},get padding(){var r;return(r=i.padding)!==null&&r!==void 0?r:[6,8]},get color(){var r;return(r=i.color)!==null&&r!==void 0?r:"#FFF"},get maxWidth(){return i.maxWidth},get maxHeight(){return i.maxHeight}}}return this._tooltip}get columnResize(){if(!this._columnResize){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.columnResize,t.columnResize);this._columnResize={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"#416EFF"},get bgColor(){var r;return(r=i.bgColor)!==null&&r!==void 0?r:"#D9E2FF"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:1},get width(){var r;return(r=i.width)!==null&&r!==void 0?r:i.lineWidth+2},get resizeHotSpotSize(){var r;return(r=i.resizeHotSpotSize)!==null&&r!==void 0?r:16},get labelColor(){var r;return(r=i.labelColor)!==null&&r!==void 0?r:"#FFF"},get labelFontSize(){var r;return(r=i.labelFontSize)!==null&&r!==void 0?r:10},get labelFontFamily(){var r;return(r=i.labelFontFamily)!==null&&r!==void 0?r:"sans-serif"},get labelBackgroundFill(){var r;return(r=i.labelBackgroundFill)!==null&&r!==void 0?r:"#3073F2"},get labelBackgroundCornerRadius(){var r;return(r=i.labelBackgroundCornerRadius)!==null&&r!==void 0?r:5},get labelVisible(){var r;return(r=i.labelVisible)===null||r===void 0||r},get visibleOnHover(){var r;return(r=i.visibleOnHover)!==null&&r!==void 0&&r}}}return this._columnResize}get dragHeaderSplitLine(){if(!this._dragHeaderSplitLine){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.dragHeaderSplitLine,t.dragHeaderSplitLine);this._dragHeaderSplitLine={get lineColor(){var r;return(r=i.lineColor)!==null&&r!==void 0?r:"blue"},get lineWidth(){var r;return(r=i.lineWidth)!==null&&r!==void 0?r:2},get shadowBlockColor(){var r;return(r=i.shadowBlockColor)!==null&&r!==void 0?r:"rgba(204,204,204,0.3)"}}}return this._dragHeaderSplitLine}get frozenColumnLine(){if(!this._frozenColumnLine){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.frozenColumnLine,t.frozenColumnLine);this._frozenColumnLine={get shadow(){if(i.shadow)return{get width(){var r,s;return(s=(r=i.shadow)===null||r===void 0?void 0:r.width)!==null&&s!==void 0?s:24},get startColor(){var r,s;return(s=(r=i.shadow)===null||r===void 0?void 0:r.startColor)!==null&&s!==void 0?s:"rgba(00, 24, 47, 0.06)"},get endColor(){var r,s;return(s=(r=i.shadow)===null||r===void 0?void 0:r.endColor)!==null&&s!==void 0?s:"rgba(00, 24, 47, 0)"},get visible(){var r,s;return(s=(r=i.shadow)===null||r===void 0?void 0:r.visible)!==null&&s!==void 0?s:"always"}}},get border(){if(i.border)return{get lineColor(){var r,s;return(s=(r=i.border)===null||r===void 0?void 0:r.lineColor)!==null&&s!==void 0?s:"rgba(00, 24, 47, 0.06)"},get bgColor(){var r,s,o,a;return(a=(s=(r=i.border)===null||r===void 0?void 0:r.bgColor)!==null&&s!==void 0?s:(o=i.border)===null||o===void 0?void 0:o.lineColor)!==null&&a!==void 0?a:"rgba(00, 24, 47, 0.06)"},get lineWidth(){var r,s;return(s=(r=i.border)===null||r===void 0?void 0:r.lineWidth)!==null&&s!==void 0?s:4},get width(){var r,s,o,a;return(a=(s=(r=i.border)===null||r===void 0?void 0:r.width)!==null&&s!==void 0?s:(o=i.border)===null||o===void 0?void 0:o.lineWidth)!==null&&a!==void 0?a:4}}}}}return this._frozenColumnLine}get selectionStyle(){if(!this._selectionStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.selectionStyle,t.selectionStyle);this._selectionStyle={get cellBgColor(){var r;return(r=i==null?void 0:i.cellBgColor)!==null&&r!==void 0?r:"rgba(0, 0, 255,0.1)"},get cellBorderColor(){var r;return(r=i==null?void 0:i.cellBorderColor)!==null&&r!==void 0?r:"#3073f2"},get cellBorderLineWidth(){var r;return(r=i==null?void 0:i.cellBorderLineWidth)!==null&&r!==void 0?r:2},get inlineColumnBgColor(){return i==null?void 0:i.inlineColumnBgColor},get inlineRowBgColor(){return i==null?void 0:i.inlineRowBgColor},get selectionFillMode(){var r;return(r=i==null?void 0:i.selectionFillMode)!==null&&r!==void 0?r:"overlay"},get dynamicUpdateSelectionSize(){var r;return(r=i==null?void 0:i.dynamicUpdateSelectionSize)!==null&&r!==void 0&&r}}}return this._selectionStyle}get axisStyle(){if(!this._axisStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.axisStyle,t.axisStyle);this._axisStyle=P0t(i)}return this._axisStyle}get checkboxStyle(){if(!this._checkboxStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.checkboxStyle,t.checkboxStyle);this._checkboxStyle=i}return this._checkboxStyle}get radioStyle(){if(!this._radioStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.radioStyle,t.radioStyle);this._radioStyle=i}return this._radioStyle}get switchStyle(){if(!this._switchStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.switchStyle,t.switchStyle);this._switchStyle=i}return this._switchStyle}get buttonStyle(){if(!this._buttonStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.buttonStyle,t.buttonStyle);this._buttonStyle=i}return this._buttonStyle}get textPopTipStyle(){if(!this._textPopTipStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},E0t,e.textPopTipStyle,t.textPopTipStyle);this._textPopTipStyle=i}return this._textPopTipStyle}get functionalIconsStyle(){if(!this._internalIconsStyle){const{obj:t,superTheme:e}=this.internalTheme,i=Si({},e.functionalIconsStyle,t.functionalIconsStyle);this._internalIconsStyle=i}return this._internalIconsStyle}hasProperty(t){const{obj:e,superTheme:i}=this.internalTheme;return o5(e,t)||o5(i,t)}extends(t){return new Fs(Si({},t),Si(this.internalTheme.superTheme,this.internalTheme.obj))}getStyle(t){const e=this;return{get fontSize(){return t.fontSize},get fontFamily(){return t.fontFamily},get fontWeight(){return t.fontWeight},get fontVariant(){return t.fontVariant},get fontStyle(){return t.fontStyle},get bgColor(){return t.bgColor},get color(){return t.color},get strokeColor(){return t.strokeColor},get borderColor(){return t.borderColor},get borderLineWidth(){return t.borderLineWidth},get borderLineDash(){return t.borderLineDash},get hover(){if(t.hover)return{get cellBgColor(){var i,r;return(r=(i=t.hover)===null||i===void 0?void 0:i.cellBgColor)!==null&&r!==void 0?r:void 0},get inlineColumnBgColor(){var i,r,s,o,a,l;return(l=(r=(i=t.hover)===null||i===void 0?void 0:i.inlineColumnBgColor)!==null&&r!==void 0?r:!((s=t.hover)===null||s===void 0)&&s.cellBgColor&&typeof((o=t.hover)===null||o===void 0?void 0:o.cellBgColor)=="string"?Ch((a=t.hover)===null||a===void 0?void 0:a.cellBgColor,.1):void 0)!==null&&l!==void 0?l:void 0},get inlineRowBgColor(){var i,r,s,o,a,l;return(l=(r=(i=t.hover)===null||i===void 0?void 0:i.inlineRowBgColor)!==null&&r!==void 0?r:!((s=t.hover)===null||s===void 0)&&s.cellBgColor&&typeof((o=t.hover)===null||o===void 0?void 0:o.cellBgColor)=="string"?Ch((a=t.hover)===null||a===void 0?void 0:a.cellBgColor,.1):void 0)!==null&&l!==void 0?l:void 0}}},get select(){return{get inlineColumnBgColor(){var i,r,s,o,a,l;return(l=(o=(r=(i=t.select)===null||i===void 0?void 0:i.inlineColumnBgColor)!==null&&r!==void 0?r:(s=e.selectionStyle)===null||s===void 0?void 0:s.inlineColumnBgColor)!==null&&o!==void 0?o:!((a=e.selectionStyle)===null||a===void 0)&&a.cellBgColor&&typeof e.selectionStyle.cellBgColor=="string"?Ch(e.selectionStyle.cellBgColor,.1):void 0)!==null&&l!==void 0?l:void 0},get inlineRowBgColor(){var i,r,s,o,a;return(a=(s=(r=(i=t.select)===null||i===void 0?void 0:i.inlineRowBgColor)!==null&&r!==void 0?r:e.selectionStyle.inlineRowBgColor)!==null&&s!==void 0?s:!((o=e.selectionStyle)===null||o===void 0)&&o.cellBgColor&&typeof e.selectionStyle.cellBgColor=="string"?Ch(e.selectionStyle.cellBgColor,.1):void 0)!==null&&a!==void 0?a:void 0},get cellBgColor(){var i,r,s;if(e.selectionStyle.selectionFillMode==="replace")return(s=(r=(i=t.select)===null||i===void 0?void 0:i.cellBgColor)!==null&&r!==void 0?r:e.selectionStyle.cellBgColor)!==null&&s!==void 0?s:void 0}}},get frameStyle(){if(t.frameStyle)return{get borderColor(){var i,r;return(r=(i=t.frameStyle)===null||i===void 0?void 0:i.borderColor)!==null&&r!==void 0?r:void 0},get borderLineWidth(){var i,r;return(r=(i=t.frameStyle)===null||i===void 0?void 0:i.borderLineWidth)!==null&&r!==void 0?r:void 0},get borderLineDash(){var i,r;return(r=(i=t.frameStyle)===null||i===void 0?void 0:i.borderLineDash)!==null&&r!==void 0?r:void 0}}},get padding(){return t.padding},get textAlign(){return t.textAlign},get textBaseline(){return t.textBaseline},get textOverflow(){return t.textOverflow},get lineHeight(){return t.lineHeight},get autoWrapText(){return t.autoWrapText},get lineClamp(){return t.lineClamp},get linkColor(){return t.linkColor},get cursor(){return t.cursor},get textStick(){return t.textStick},get marked(){return t.marked},get underline(){var i;return(i=t.underline)!==null&&i!==void 0&&i},get underlineColor(){return t.underlineColor},get underlineDash(){return t.underlineDash},get underlineOffset(){return t.underlineOffset},get lineThrough(){var i;return(i=t.lineThrough)!==null&&i!==void 0&&i},get lineThroughColor(){return t.lineThroughColor},get lineThroughDash(){return t.lineThroughDash}}}}function o5(n,t){if(n instanceof Fs)return n.hasProperty(t);let e=n;if(!e)return!1;for(let i=0;i<t.length;i++)if(e=e[t[i]],!e)return!1;return!!e}const iq=new Fs(Qj,Qj),nq=new Fs(t5,t5),rq=new Fs(e5,e5),sq=new Fs(i5,i5),oq=new Fs(n5,n5),L0t={DEFAULT:sq,SIMPLIFY:oq,ARCO:rq,DARK:iq,BRIGHT:nq},I0t={TableTheme:Fs};function O0t(n){if(!n)return null;if(typeof n=="string"){const t=r0t(aq(),n);return t?t instanceof Fs?t:new Fs(t,t):null}return n instanceof Fs?n:new Fs(n,n)}function aq(){return rb(L0t,S0t)}const Sh={DARK:iq,BRIGHT:nq,ARCO:rq,DEFAULT:sq,SIMPLIFY:oq,theme:I0t,of:O0t,get:aq};function un(n,t,e){var i;if(n.internalProps.customMergeCell){const s=n.getCustomMerge(t,e);if(s)return s.range}if(!n.internalProps.enableTreeNodeMerge&&!n.isHeader(t,e)&&!(!((i=n.getBodyColumnDefine(t,e))===null||i===void 0)&&i.mergeCell))return!1;const r=n.getCellRange(t,e);return!(r.start.col===r.end.col&&r.start.row===r.end.row)&&r}let Jt=class pu{static registerComponent(t,e){pu._components[t]=e}static getComponent(t){return pu._components[t]}static registerFunction(t,e){pu._functions[t]=e}static getFunction(t){return pu._functions[t]}static registerCellType(t,e){pu._cellTypes[t]=e}static getCellType(t){return pu._cellTypes[t]}};Jt._components={},Jt._functions={},Jt._cellTypes={};function D0t(n,t){const e=new Array(t);for(let i=0;i<t;i++)e[i]=n(i);return e}function F0t(n,t,e,i,r,s){const o=D0t(n,e);o.sort((a,l)=>i(s(a),s(l),r));for(let a=0;a<e;a++)t(a,o[a])}function H0t(n){if(tq.isObject(n)){const t=n;if(L(t.get)&&L(t.set))return!0}return!1}const _y={SOURCE_LENGTH_UPDATE:"source_length_update",CHANGE_ORDER:"change_order"};function Nh(n,t){const e=ni(n);if(ua(e)){const i=e.then(r=>(t(r),r));return t(i),i}return e}function fx(n,t,e,i,r,s){if(n==null)return;if(ua(n))return n.then(l=>fx(l,t,e,i,r,s));const o=H0t(t)?t.get:t;if((o===void 0||o==="")&&Array.isArray(n))return n[e-r.leftRowSeriesNumberCount];if(kt(n)&&o in n)return Nh(n[o],s);if(typeof o=="function")return Nh(o(n,e,i,r),s);if(Array.isArray(o))return Nh(q_t(n,[...o]),s);const a=`${o}`.split(".");return a.length<=1?Nh(n[o],s):Nh(JK(n,(l,h)=>fx(l,h,e,i,r,d0t),...a),s)}function lg(n,t){if(!n)return t;const e=n[t];return L(e)?e:t}class Ul extends pM{static get EVENT_TYPE(){return _y}constructor(t,e,i,r,s,o){var a;super(),this.currentIndexedData=[],this.hierarchyExpandLevel=0,this.hasHierarchyStateExpand=!1,this.beforeChangedRecordsMap=new Map,this.registedAggregators={},this.rowHierarchyType="grid",this.fieldAggregators=[],this.registerAggregators(),this.dataSourceObj=t,this.dataConfig=e,this._get=t==null?void 0:t.get,this.columns=r,this._source=t!=null&&t.records?this.processRecords(t==null?void 0:t.records):t,this._sourceLength=((a=this._source)===null||a===void 0?void 0:a.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=i,this.pagination=i||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},o>=1&&(this.hierarchyExpandLevel=o),this.currentIndexedData=Array.from({length:this._sourceLength},(l,h)=>h),s==="tree"&&this.initTreeHierarchyState(),this.rowHierarchyType=s,this.updatePagerData()}initTreeHierarchyState(){var t;this.currentIndexedData=Array.from({length:this._sourceLength},(i,r)=>r);let e=this._sourceLength;for(let i=0;i<e;i++){const r=this.currentIndexedData[i],s=this.getOriginalRecord(r),o=(t=s.filteredChildren)!==null&&t!==void 0?t:s.children;if((o==null?void 0:o.length)>0){if(this.hierarchyExpandLevel>1?!s.hierarchyState&&(s.hierarchyState=se.expand):!s.hierarchyState&&(s.hierarchyState=se.collapse),this.hasHierarchyStateExpand=!0,s.hierarchyState===se.collapse)continue;const a=this.initChildrenNodeHierarchy(r,this.hierarchyExpandLevel,2,s);i+=a,e+=a}else s.children===!0&&!s.hierarchyState&&(s.hierarchyState=se.collapse)}}supplementConfig(t,e,i,r){var s;this.columns=e,this._sourceLength=((s=this._source)===null||s===void 0?void 0:s.length)||0,this.sortedIndexMap=new Map,this._currentPagerIndexedData=[],this.userPagination=t,this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},r>=1&&(this.hierarchyExpandLevel=r),this.currentIndexedData=Array.from({length:this._sourceLength},(o,a)=>a),i==="tree"&&this.initTreeHierarchyState(),this.rowHierarchyType=i,this.updatePagerData()}registerAggregator(t,e){this.registedAggregators[t]=e}registerAggregators(){this.registerAggregator(Ji.RECORD,k_t),this.registerAggregator(Ji.SUM,P_t),this.registerAggregator(Ji.COUNT,E_t),this.registerAggregator(Ji.MAX,I_t),this.registerAggregator(Ji.MIN,O_t),this.registerAggregator(Ji.AVG,L_t),this.registerAggregator(Ji.NONE,R_t),this.registerAggregator(Ji.CUSTOM,B_t)}updateColumns(t){this.columns=t}_generateFieldAggragations(){const t=this.columns;this.fieldAggregators=[];const e=r=>{delete r.vtable_aggregator;const s=r.field,o=r.aggregation;if(o)if(Array.isArray(o))for(const a of o){const l=new this.registedAggregators[a.aggregationType]({field:s,formatFun:a.formatFun,isRecord:!0,aggregationFun:a.aggregationFun});this.fieldAggregators.push(l),r.vtable_aggregator||(r.vtable_aggregator=[]),r.vtable_aggregator.push(l)}else{const a=new this.registedAggregators[o.aggregationType]({field:s,formatFun:o.formatFun,isRecord:!0,aggregationFun:o.aggregationFun});this.fieldAggregators.push(a),r.vtable_aggregator=a}},i=r=>{if(r&&r.length!==0)for(const s of r)e(s),s.columns&&i(s.columns)};i(t)}processRecords(t){var e,i,r,s,o,a,l,h;this._generateFieldAggragations();const d=[],u=this.fieldAggregators.length>=1;if(((i=(e=this.dataConfig)===null||e===void 0?void 0:e.filterRules)===null||i===void 0?void 0:i.length)>=1||((r=this.lastFilterRules)===null||r===void 0?void 0:r.length)>=1||u){for(let c=0,g=t.length;c<g;c++){const p=t[c];((o=(s=this.dataConfig)===null||s===void 0?void 0:s.filterRules)===null||o===void 0?void 0:o.length)>=1?this.filterRecord(p)&&(d.push(p),this.rowHierarchyType==="tree"&&p.children&&(p.filteredChildren=this.filteredChildren(p.children)),u&&this.processRecord(p)):((a=this.lastFilterRules)===null||a===void 0?void 0:a.length)>=1?(this.clearFilteredChildren(p),u&&this.processRecord(p)):u&&this.processRecord(p)}if(((h=(l=this.dataConfig)===null||l===void 0?void 0:l.filterRules)===null||h===void 0?void 0:h.length)>=1)return d}return t}filteredChildren(t){const e=[];for(let i=0,r=t.length;i<r;i++){const s=t[i];this.filterRecord(s)&&(e.push(s),s.children&&(s.filteredChildren=this.filteredChildren(s.children)))}return e}processRecord(t){for(let e=0;e<this.fieldAggregators.length;e++)this.fieldAggregators[e].push(t)}initChildrenNodeHierarchy(t,e,i,r){var s,o,a;let l=0;const h=r.filteredChildren?r.filteredChildren.length:(o=(s=r.children)===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:0;for(let d=0;d<h;d++){(i<=e||r.hierarchyState===se.expand)&&(l+=1);const u=r.filteredChildren?r.filteredChildren[d]:r.children[d],c=Array.isArray(t)?t.concat(d):[t,d];(i<=e||r.hierarchyState===se.expand)&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+l,0,c),(u.filteredChildren?u.filteredChildren.length>0:((a=u.children)===null||a===void 0?void 0:a.length)>0)&&(i<e||u.hierarchyState===se.expand?(!u.hierarchyState&&(u.hierarchyState=se.expand),this.hasHierarchyStateExpand=!0):!u.hierarchyState&&(u.hierarchyState=se.collapse)),u.hierarchyState===se.expand&&(l+=this.initChildrenNodeHierarchy(c,e,i+1,u)),u.children===!0&&!u.hierarchyState&&(u.hierarchyState=se.collapse)}return l}updatePagination(t){this.pagination=t||{totalCount:this._sourceLength,perPageCount:this._sourceLength,currentPage:0},this.updatePagerData()}updatePagerData(){const{currentIndexedData:t}=this,{perPageCount:e,currentPage:i}=this.pagination,r=e*(i||0),s=r+e;if(this._currentPagerIndexedData.length=0,t&&t.length>0){let o=-1;for(let a=0;a<t.length;a++)if((Array.isArray(t[a])&&t[a].length===1||!Array.isArray(t[a]))&&o++,o>=r&&o<s)this._currentPagerIndexedData.push(t[a]);else if(o>=s)break}else if(this._sourceLength>0)throw new Error("currentIndexedData should has values!")}getRecordIndexPaths(t){return this._currentPagerIndexedData[t]}get records(){return Array.isArray(this._source)?this._source:[]}get source(){return this._source}get(t){return this.getOriginalRecord(lg(this.currentPagerIndexedData,t))}getRaw(t){return this.getRawRecord(lg(this.currentPagerIndexedData,t))}getIndexKey(t){return lg(this.currentPagerIndexedData,t)}getTableIndex(t){return Array.isArray(t)?this.rowHierarchyType==="tree"?this.currentPagerIndexedData.findIndex(e=>Hl(e,t)):this.currentPagerIndexedData.findIndex(e=>e===t[0]):this.currentPagerIndexedData.findIndex(e=>e===t)}getField(t,e,i,r,s){return this.getOriginalField(lg(this.currentPagerIndexedData,t),e,i,r,s)}getRawField(t,e,i,r,s){return this.getRawFieldData(lg(this.currentPagerIndexedData,t),e,i,r,s)}hasField(t,e){return this.hasOriginalField(lg(this.currentPagerIndexedData,t),e)}getHierarchyState(t){var e;const i=this.getOriginalRecord(this.currentPagerIndexedData[t]);if(i!=null&&i.hierarchyState){const r=i.hierarchyState;if(((e=i.children)===null||e===void 0?void 0:e.length)>0||i.children===!0)return r}return null}toggleHierarchyState(t,e,i){const r=this.currentIndexedData.slice(0),s=this.getIndexKey(t),o=this.getHierarchyState(t),a=this.getOriginalRecord(s);if(this.clearSortedIndexMap(),o===se.collapse)a.hierarchyState=se.expand,this.pushChildrenNode(s,se.expand,a),this.hasHierarchyStateExpand=!0;else if(o===se.expand){let d=0;const u=(c,g,p)=>{if(!g||g===se.collapse||g===se.none)return;const f=p.filteredChildren?p.filteredChildren:p.children;if(f)for(let m=0;m<f.length;m++){d+=1;const v=Array.isArray(c)?c.concat([m]):[c,m];u(v,f[m].hierarchyState,f[m])}};u(s,o,a),this.currentIndexedData.splice(this.currentIndexedData.indexOf(s)+1,d),a.hierarchyState=se.collapse}this.updatePagerData();const l=[],h=[];if(o===se.collapse){const d=this.currentIndexedData.length-r.length;for(let u=0;u<d;u++)l.push(t+u+1)}else if(o===se.expand){const d=r.length-this.currentIndexedData.length;for(let u=0;u<d;u++)h.push(t+u+1)}return{add:l,remove:h}}pushChildrenNode(t,e,i){var r,s;if(!e||e===se.collapse||e===se.none)return 0;let o=0;const a=i.filteredChildren?i.filteredChildren:i.children;if(a){const l=Array.from({length:a.length},(h,d)=>d);(r=this.lastSortStates)===null||r===void 0||r.forEach(h=>{h.order!=="normal"&&F0t(d=>L(l[d])?l[d]:l[d]=d,(d,u)=>{l[d]=u},a.length,h.orderFn,h.order,d=>this.getOriginalField(Array.isArray(t)?t.concat([d]):[t,d],h.field))});for(let h=0;h<l.length;h++){o+=1;const d=Array.isArray(t)?t.concat([l[h]]):[t,l[h]];this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+o,0,d);const u=this.getOriginalRecord(d);!u.hierarchyState&&((s=u.filteredChildren)!==null&&s!==void 0?s:u.children)&&(u.hierarchyState=se.collapse),o+=this.pushChildrenNode(d,u.hierarchyState,a[l[h]])}}return o}changeFieldValue(t,e,i,r,s,o){var a;if(i!==null&&e>=0){const l=this.getIndexKey(e);if(this.cacheBeforeChangedRecord(l,o),i!==void 0&&i!==""||(i=r-o.leftRowSeriesNumberCount),typeof i=="string"||typeof i=="number"){const h=(a=this.beforeChangedRecordsMap.get(l.toString()))===null||a===void 0?void 0:a[i],d=this.getOriginalRecord(l);let u=t;typeof h=="number"&&Z_t(t)&&(u=parseFloat(t)),ua(d)?d.then(c=>{c[i]=u}).catch(c=>{}):d?d[i]=u:(this.records[l]={},this.records[l][i]=u)}}}cacheBeforeChangedRecord(t,e){var i;if(!this.beforeChangedRecordsMap.has(t.toString())){const r=this.getOriginalRecord(t);this.beforeChangedRecordsMap.set(t.toString(),(i=Pn(r,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))!==null&&i!==void 0?i:{})}}setRecord(t,e){var i,r;let s=!0;if(((r=(i=this.dataConfig)===null||i===void 0?void 0:i.filterRules)===null||r===void 0?void 0:r.length)>=1&&(this.filterRecord(t)?this.rowHierarchyType==="tree"&&t.children&&(t.filteredChildren=this.filteredChildren(t.children)):s=!1),s&&Array.isArray(this.records)){const o=this.getIndexKey(e);Array.isArray(o)||this.records.splice(o,1,t)}}addRecord(t,e){var i;if(Array.isArray(this.records)){this.records.splice(e,0,t),this.adjustBeforeChangedRecordsMap(e,1),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1;for(let r=0;r<this.fieldAggregators.length;r++)this.fieldAggregators[r].push(t);if(this.rowHierarchyType==="tree"&&this.initTreeHierarchyState(),this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:r,currentPage:s}=this.pagination;e<r*(s||0)+r&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();!((i=this.dataSourceObj)===null||i===void 0)&&i.added&&this.dataSourceObj.added(e,1)}}addRecords(t,e){var i;if(Array.isArray(this.records)){if(Array.isArray(t)){this.records.splice(e,0,...t),this.adjustBeforeChangedRecordsMap(e,t.length);for(let r=0;r<t.length;r++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length;for(let r=0;r<this.fieldAggregators.length;r++)for(let s=0;s<t.length;s++)this.fieldAggregators[r].push(t[s])}if(this.userPagination){this.pagination.totalCount=this._sourceLength;const{perPageCount:r,currentPage:s}=this.pagination;e<r*(s||0)+r&&this.updatePagerData()}else this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.updatePagerData();!((i=this.dataSourceObj)===null||i===void 0)&&i.added&&this.dataSourceObj.added(e,t.length)}}addRecordForSorted(t){Array.isArray(this.records)&&(this.beforeChangedRecordsMap.clear(),this.records.push(t),this.currentIndexedData.push(this.currentIndexedData.length),this._sourceLength+=1,this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength))}addRecordsForSorted(t){if(Array.isArray(this.records)){if(this.beforeChangedRecordsMap.clear(),Array.isArray(t)){this.records.push(...t);for(let e=0;e<t.length;e++)this.currentIndexedData.push(this.currentIndexedData.length);this._sourceLength+=t.length,this.sortedIndexMap.clear()}this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}}adjustBeforeChangedRecordsMap(t,e,i="add"){for(let r=this.beforeChangedRecordsMap.size-1;r>=t;r--){const s=this.beforeChangedRecordsMap.get(r.toString());this.beforeChangedRecordsMap.delete(r.toString()),this.beforeChangedRecordsMap.set((r+(i==="add"?e:-e)).toString(),s)}}deleteRecords(t){var e;if(Array.isArray(this.records)){const i=[],r=t.sort((s,o)=>o-s);for(let s=0;s<r.length;s++){const o=r[s];if(o>=this._sourceLength||o<0)continue;this.adjustBeforeChangedRecordsMap(o,1,"delete"),i.push(o);const a=this.records[o];for(let l=0;l<this.fieldAggregators.length;l++)this.fieldAggregators[l].deleteRecord(a);this.records.splice(o,1),this.currentIndexedData.pop(),this._sourceLength-=1}return this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.updatePagerData(),!((e=this.dataSourceObj)===null||e===void 0)&&e.deleted&&this.dataSourceObj.deleted(i),i}return[]}deleteRecordsForSorted(t){if(Array.isArray(this.records)){const e=t.sort((i,r)=>r-i);for(let i=0;i<e.length;i++){const r=e[i];if(r>=this._sourceLength||r<0)continue;const s=this.currentIndexedData[r];this.records.splice(s,1),this._sourceLength-=1}this.sortedIndexMap.clear(),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength),this.beforeChangedRecordsMap.clear()}}updateRecords(t,e){const i=[];for(let r=0;r<e.length;r++){const s=e[r];if(Array.isArray(s))this.beforeChangedRecordsMap.delete(s.toString()),i.push(s),s.slice(0,-1).reduce((o,a)=>(o[a]===void 0&&(o[a]={}),o[a].children),this.records)[s[s.length-1]]=t[r];else{if(s>=this._sourceLength||s<0)continue;this.beforeChangedRecordsMap.delete(s.toString()),i.push(s);for(let o=0;o<this.fieldAggregators.length;o++)this.fieldAggregators[o].updateRecord(this.records[s],t[r]);this.records[s]=t[r]}}return this.userPagination&&this.updatePagerData(),i}updateRecordsForSorted(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(r>=this._sourceLength||r<0)continue;const s=this.currentIndexedData[r];if(typeof s!="number")return;this.beforeChangedRecordsMap.delete(s.toString()),this.records[s]=t[i]}this.sortedIndexMap.clear()}sort(t){t=(Array.isArray(t)?t:[t]).filter(s=>{const o=this.columns.find(a=>a.field===s.field);return(o==null?void 0:o.sort)!==!1&&s.order!=="normal"}),this.lastSortStates=t;let e=t.map(s=>this.sortedIndexMap.get(s==null?void 0:s.field)||{asc:[],desc:[],normal:[]}),i=null;if(e.length>0&&(i=t.reduce((s,o,a)=>{var l;const h=(l=e[a])===null||l===void 0?void 0:l[o.order];return h&&h.length>0?h:s},null),i&&i.length>0))return this.currentIndexedData=i,this.updatePagerData(),void this.fireListeners(_y.CHANGE_ORDER,null);const r=Array.from({length:this._sourceLength},(s,o)=>o);if(r.sort((s,o)=>t.reduce((a,l)=>a!==0?a:(l.orderFn||(l.order!=="desc"?(h,d)=>h===d?0:h>d?1:-1:(h,d)=>h===d?0:h<d?1:-1))(this.getOriginalField(s,l.field),this.getOriginalField(o,l.field),l.order),0)),this.currentIndexedData=r,this.hierarchyExpandLevel){let s=r.length;for(let o=0;o<s;o++){const a=this.getOriginalRecord(r[o]),l=this.pushChildrenNode(r[o],a.hierarchyState,this.getOriginalRecord(r[o]));s+=l,o+=l}}if(!e.length){e=t.map(()=>({asc:[],desc:[],normal:[]}));for(let s=0;s<t.length;s++)this.sortedIndexMap.set(t[s].field,e[s])}t.forEach((s,o)=>{e[o][s.order]=r.slice()}),this.updatePagerData(),this.fireListeners(_y.CHANGE_ORDER,null)}setSortedIndexMap(t,e){this.sortedIndexMap.set(t,e)}clearFilteredChildren(t){var e,i;t.filteredChildren=void 0;for(let r=0;r<((i=(e=t.children)===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0);r++)this.clearFilteredChildren(t.children[r])}filterRecord(t){var e,i,r;let s=!0;for(let o=0;o<((e=this.dataConfig.filterRules)===null||e===void 0?void 0:e.length);o++){const a=(i=this.dataConfig)===null||i===void 0?void 0:i.filterRules[o];if(a.filterKey){const l=t[a.filterKey];if(a.filteredValues.indexOf(l)===-1){s=!1;break}}else if(!(!((r=a.filterFunc)===null||r===void 0)&&r.call(a,t))){s=!1;break}}return s}updateFilterRulesForSorted(t){var e,i,r;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords((i=(e=this.dataSourceObj)===null||e===void 0?void 0:e.records)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this._sourceLength},(s,o)=>o),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength)}updateFilterRules(t){var e,i,r;this.lastFilterRules=this.dataConfig.filterRules,this.dataConfig.filterRules=t,this._source=this.processRecords((i=(e=this.dataSourceObj)===null||e===void 0?void 0:e.records)!==null&&i!==void 0?i:this.dataSourceObj),this._sourceLength=((r=this._source)===null||r===void 0?void 0:r.length)||0,this.currentIndexedData=Array.from({length:this._sourceLength},(s,o)=>o),this.userPagination||(this.pagination.perPageCount=this._sourceLength,this.pagination.totalCount=this._sourceLength,this.rowHierarchyType==="tree"&&this.initTreeHierarchyState()),this.updatePagerData()}clearSortedIndexMap(){this.lastSortStates&&this.lastSortStates.length>0&&this.sortedIndexMap.forEach((t,e)=>{this.lastSortStates.some(i=>i.field===e)?this.lastSortStates.forEach(i=>{i.order==="asc"?(t.desc=[],t.normal=[]):i.order==="desc"?(t.asc=[],t.normal=[]):(t.asc=[],t.desc=[])}):this.sortedIndexMap.delete(e)})}get sourceLength(){return this._sourceLength}set sourceLength(t){this._sourceLength!==t&&(this._sourceLength=t,this.fireListeners(_y.SOURCE_LENGTH_UPDATE,this._sourceLength))}get length(){return this.currentPagerIndexedData.length}get dataSource(){return this}get currentPagerIndexedData(){return this._currentPagerIndexedData.length>0?this._currentPagerIndexedData:[]}release(){var t;(t=super.release)===null||t===void 0||t.call(this),this.lastFilterRules=null,this.clearSortedMap(),this.clearCurrentIndexedData(),this.currentPagerIndexedData.length=0}clearSortedMap(){this.currentIndexedData&&(this.currentIndexedData.length=0),this.currentIndexedData=null,this.sortedIndexMap.forEach(t=>{t.asc&&(t.asc.length=0),t.desc&&(t.desc.length=0)}),this.sortedIndexMap.clear()}clearCurrentIndexedData(){this.currentIndexedData=null,this.currentPagerIndexedData.length=0}getOriginalRecord(t){let e;return e=this.dataSourceObj.records?Array.isArray(t)?qE(this.records,t):this.records[t]:this._get(t),Nh(e,i=>{this.recordPromiseCallBack(t,i)})}getRawRecord(t){var e,i;if(!((e=this.beforeChangedRecordsMap)===null||e===void 0)&&e.has(t.toString()))return(i=this.beforeChangedRecordsMap)===null||i===void 0?void 0:i.get(t.toString());let r;return r=this.dataSourceObj.records?Array.isArray(t)?qE(this.records,t):this.records[t]:this._get(t),Nh(r,s=>{this.recordPromiseCallBack(t,s)})}getOriginalField(t,e,i,r,s){if(e!==null)return fx(this.getOriginalRecord(t),e,i,r,s,o=>{this.fieldPromiseCallBack(t,e,o)})}getRawFieldData(t,e,i,r,s){if(e!==null)return fx(this.getRawRecord(t),e,i,r,s,o=>{this.fieldPromiseCallBack(t,e,o)})}hasOriginalField(t,e){if(e===null)return!1;if(typeof e=="function")return!0;const i=this.getOriginalRecord(t);return!!(i&&e in i)}fieldPromiseCallBack(t,e,i){}recordPromiseCallBack(t,e){}canChangeOrder(t,e){var i;if(!((i=this.dataSourceObj)===null||i===void 0)&&i.canChangeOrder)return this.dataSourceObj.canChangeOrder(t,e);if(this.hasHierarchyStateExpand){let r=this.currentPagerIndexedData[t],s=this.currentPagerIndexedData[e];if(r=Array.isArray(r)?[...r]:[r],s=Array.isArray(s)?[...s]:[s],e>t&&s.length>r.length){let o=this.currentPagerIndexedData[e+1];o=Array.isArray(o)?[...o]:[o],o.length<s.length&&s.splice(s.length-1,1)}if(r.length===s.length){for(let o=0;o<=r.length-2;o++)if(r[o]!==s[o])return!1;return!0}return!1}return!0}changeOrder(t,e){var i,r,s;if(!((i=this.dataSourceObj)===null||i===void 0)&&i.changeOrder)this.dataSourceObj.changeOrder(t,e);else if(!(!((r=this.lastSortStates)===null||r===void 0)&&r.some(o=>o.order==="asc"||o.order==="desc"))&&this.canChangeOrder(t,e))if(this.hasHierarchyStateExpand){let o,a,l=this.currentPagerIndexedData[t],h=this.currentPagerIndexedData[e];if(l=Array.isArray(l)?[...l]:[l],h=Array.isArray(h)?[...h]:[h],l.length>1||h.length>1){if(e>t&&h.length>l.length){let d=this.currentPagerIndexedData[e+1];d=Array.isArray(d)?[...d]:[d],d.length<h.length&&h.splice(h.length-1,1)}if(o=l.splice(l.length-1,1)[0],a=h.splice(h.length-1,1)[0],l.length>=1){const d=this.getOriginalRecord(l),u=d.filteredChildren?d.filteredChildren.splice(o,1):d.children.splice(o,1);u.unshift(a,0),Array.prototype.splice.apply((s=d.filteredChildren)!==null&&s!==void 0?s:d.children,u)}else{const d=this.records.splice(o,1);d.unshift(a,0),Array.prototype.splice.apply(this.records,d)}}else{o=this.currentPagerIndexedData[t],a=this.currentPagerIndexedData[e];const d=this.records.splice(o,1);d.unshift(a,0),Array.prototype.splice.apply(this.records,d)}this.restoreTreeHierarchyState(),this.updatePagerData()}else{const o=this.records.splice(t,1);o.unshift(e,0),Array.prototype.splice.apply(this.records,o)}}restoreTreeHierarchyState(){var t,e;if(this.hierarchyExpandLevel){for(let r=0;r<this._sourceLength;r++){const s=this.getOriginalRecord(r);((t=s.filteredChildren)!==null&&t!==void 0?t:s.children)&&!s.hierarchyState&&(s.hierarchyState=se.collapse)}this.currentIndexedData=Array.from({length:this._sourceLength},(r,s)=>s);let i=this._sourceLength;for(let r=0;r<i;r++){const s=this.currentIndexedData[r],o=this.getOriginalRecord(s),a=(e=o.filteredChildren)!==null&&e!==void 0?e:o.children;if((a==null?void 0:a.length)>0&&o.hierarchyState===se.expand){this.hasHierarchyStateExpand=!0;const l=this.restoreChildrenNodeHierarchy(s,o);r+=l,i+=l}else o.children===!0&&!o.hierarchyState&&(o.hierarchyState=se.collapse)}}}restoreChildrenNodeHierarchy(t,e){var i,r;let s=0;const o=(i=e.filteredChildren)!==null&&i!==void 0?i:e.children,a=(r=o==null?void 0:o.length)!==null&&r!==void 0?r:0;for(let l=0;l<a;l++){e.hierarchyState===se.expand&&(s+=1);const h=o[l],d=Array.isArray(t)?t.concat(l):[t,l];e.hierarchyState===se.expand&&this.currentIndexedData.splice(this.currentIndexedData.indexOf(t)+s,0,d),s+=this.restoreChildrenNodeHierarchy(d,h)}return s}}Ul.EMPTY=new Ul({get(){},length:0});function qE(n,t){var e;let i=n;for(let r=0;r<t.length;r++){const s=t[r];if(!i[s])return;i=i[s];const o=(e=i.filteredChildren)!==null&&e!==void 0?e:i==null?void 0:i.children;o&&r+1<t.length&&(i=o)}return i}function a5(n,t){return n.sort((e,i)=>{var r,s;J(e)&&(e=[e]),J(i)&&(i=[i]);const o=Math.max(e.length,i.length);for(let a=0;a<o;a++){const l=(r=e[a])!==null&&r!==void 0?r:-1,h=(s=i[a])!==null&&s!==void 0?s:-1;if(l!==h)return h-l}return 0})}var Hk,l5;function nD(){if(l5)return Hk;l5=1;var n=Array.isArray;return Hk=n,Hk}var zk,h5;function z0t(){if(h5)return zk;h5=1;var n=typeof Vb=="object"&&Vb&&Vb.Object===Object&&Vb;return zk=n,zk}var Wk,d5;function rD(){if(d5)return Wk;d5=1;var n=z0t(),t=typeof self=="object"&&self&&self.Object===Object&&self,e=n||t||Function("return this")();return Wk=e,Wk}var jk,u5;function sD(){if(u5)return jk;u5=1;var n=rD(),t=n.Symbol;return jk=t,jk}var Nk,c5;function W0t(){if(c5)return Nk;c5=1;var n=sD(),t=Object.prototype,e=t.hasOwnProperty,i=t.toString,r=n?n.toStringTag:void 0;function s(o){var a=e.call(o,r),l=o[r];try{o[r]=void 0;var h=!0}catch{}var d=i.call(o);return h&&(a?o[r]=l:delete o[r]),d}return Nk=s,Nk}var $k,g5;function j0t(){if(g5)return $k;g5=1;var n=Object.prototype,t=n.toString;function e(i){return t.call(i)}return $k=e,$k}var Vk,p5;function lq(){if(p5)return Vk;p5=1;var n=sD(),t=W0t(),e=j0t(),i="[object Null]",r="[object Undefined]",s=n?n.toStringTag:void 0;function o(a){return a==null?a===void 0?r:i:s&&s in Object(a)?t(a):e(a)}return Vk=o,Vk}var Gk,f5;function N0t(){if(f5)return Gk;f5=1;function n(t){return t!=null&&typeof t=="object"}return Gk=n,Gk}var Uk,m5;function oD(){if(m5)return Uk;m5=1;var n=lq(),t=N0t(),e="[object Symbol]";function i(r){return typeof r=="symbol"||t(r)&&n(r)==e}return Uk=i,Uk}var Yk,v5;function $0t(){if(v5)return Yk;v5=1;var n=nD(),t=oD(),e=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,i=/^\w*$/;function r(s,o){if(n(s))return!1;var a=typeof s;return a=="number"||a=="symbol"||a=="boolean"||s==null||t(s)?!0:i.test(s)||!e.test(s)||o!=null&&s in Object(o)}return Yk=r,Yk}var Xk,_5;function hq(){if(_5)return Xk;_5=1;function n(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}return Xk=n,Xk}var Kk,b5;function V0t(){if(b5)return Kk;b5=1;var n=lq(),t=hq(),e="[object AsyncFunction]",i="[object Function]",r="[object GeneratorFunction]",s="[object Proxy]";function o(a){if(!t(a))return!1;var l=n(a);return l==i||l==r||l==e||l==s}return Kk=o,Kk}var qk,y5;function G0t(){if(y5)return qk;y5=1;var n=rD(),t=n["__core-js_shared__"];return qk=t,qk}var Zk,C5;function U0t(){if(C5)return Zk;C5=1;var n=G0t(),t=function(){var i=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}();function e(i){return!!t&&t in i}return Zk=e,Zk}var Jk,S5;function Y0t(){if(S5)return Jk;S5=1;var n=Function.prototype,t=n.toString;function e(i){if(i!=null){try{return t.call(i)}catch{}try{return i+""}catch{}}return""}return Jk=e,Jk}var Qk,x5;function X0t(){if(x5)return Qk;x5=1;var n=V0t(),t=U0t(),e=hq(),i=Y0t(),r=/[\\^$.*+?()[\]{}|]/g,s=/^\[object .+?Constructor\]$/,o=Function.prototype,a=Object.prototype,l=o.toString,h=a.hasOwnProperty,d=RegExp("^"+l.call(h).replace(r,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function u(c){if(!e(c)||t(c))return!1;var g=n(c)?d:s;return g.test(i(c))}return Qk=u,Qk}var tR,w5;function K0t(){if(w5)return tR;w5=1;function n(t,e){return t==null?void 0:t[e]}return tR=n,tR}var eR,A5;function dq(){if(A5)return eR;A5=1;var n=X0t(),t=K0t();function e(i,r){var s=t(i,r);return n(s)?s:void 0}return eR=e,eR}var iR,M5;function _M(){if(M5)return iR;M5=1;var n=dq(),t=n(Object,"create");return iR=t,iR}var nR,T5;function q0t(){if(T5)return nR;T5=1;var n=_M();function t(){this.__data__=n?n(null):{},this.size=0}return nR=t,nR}var rR,k5;function Z0t(){if(k5)return rR;k5=1;function n(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}return rR=n,rR}var sR,R5;function J0t(){if(R5)return sR;R5=1;var n=_M(),t="__lodash_hash_undefined__",e=Object.prototype,i=e.hasOwnProperty;function r(s){var o=this.__data__;if(n){var a=o[s];return a===t?void 0:a}return i.call(o,s)?o[s]:void 0}return sR=r,sR}var oR,B5;function Q0t(){if(B5)return oR;B5=1;var n=_M(),t=Object.prototype,e=t.hasOwnProperty;function i(r){var s=this.__data__;return n?s[r]!==void 0:e.call(s,r)}return oR=i,oR}var aR,P5;function tbt(){if(P5)return aR;P5=1;var n=_M(),t="__lodash_hash_undefined__";function e(i,r){var s=this.__data__;return this.size+=this.has(i)?0:1,s[i]=n&&r===void 0?t:r,this}return aR=e,aR}var lR,E5;function ebt(){if(E5)return lR;E5=1;var n=q0t(),t=Z0t(),e=J0t(),i=Q0t(),r=tbt();function s(o){var a=-1,l=o==null?0:o.length;for(this.clear();++a<l;){var h=o[a];this.set(h[0],h[1])}}return s.prototype.clear=n,s.prototype.delete=t,s.prototype.get=e,s.prototype.has=i,s.prototype.set=r,lR=s,lR}var hR,L5;function ibt(){if(L5)return hR;L5=1;function n(){this.__data__=[],this.size=0}return hR=n,hR}var dR,I5;function nbt(){if(I5)return dR;I5=1;function n(t,e){return t===e||t!==t&&e!==e}return dR=n,dR}var uR,O5;function bM(){if(O5)return uR;O5=1;var n=nbt();function t(e,i){for(var r=e.length;r--;)if(n(e[r][0],i))return r;return-1}return uR=t,uR}var cR,D5;function rbt(){if(D5)return cR;D5=1;var n=bM(),t=Array.prototype,e=t.splice;function i(r){var s=this.__data__,o=n(s,r);if(o<0)return!1;var a=s.length-1;return o==a?s.pop():e.call(s,o,1),--this.size,!0}return cR=i,cR}var gR,F5;function sbt(){if(F5)return gR;F5=1;var n=bM();function t(e){var i=this.__data__,r=n(i,e);return r<0?void 0:i[r][1]}return gR=t,gR}var pR,H5;function obt(){if(H5)return pR;H5=1;var n=bM();function t(e){return n(this.__data__,e)>-1}return pR=t,pR}var fR,z5;function abt(){if(z5)return fR;z5=1;var n=bM();function t(e,i){var r=this.__data__,s=n(r,e);return s<0?(++this.size,r.push([e,i])):r[s][1]=i,this}return fR=t,fR}var mR,W5;function lbt(){if(W5)return mR;W5=1;var n=ibt(),t=rbt(),e=sbt(),i=obt(),r=abt();function s(o){var a=-1,l=o==null?0:o.length;for(this.clear();++a<l;){var h=o[a];this.set(h[0],h[1])}}return s.prototype.clear=n,s.prototype.delete=t,s.prototype.get=e,s.prototype.has=i,s.prototype.set=r,mR=s,mR}var vR,j5;function hbt(){if(j5)return vR;j5=1;var n=dq(),t=rD(),e=n(t,"Map");return vR=e,vR}var _R,N5;function dbt(){if(N5)return _R;N5=1;var n=ebt(),t=lbt(),e=hbt();function i(){this.size=0,this.__data__={hash:new n,map:new(e||t),string:new n}}return _R=i,_R}var bR,$5;function ubt(){if($5)return bR;$5=1;function n(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}return bR=n,bR}var yR,V5;function yM(){if(V5)return yR;V5=1;var n=ubt();function t(e,i){var r=e.__data__;return n(i)?r[typeof i=="string"?"string":"hash"]:r.map}return yR=t,yR}var CR,G5;function cbt(){if(G5)return CR;G5=1;var n=yM();function t(e){var i=n(this,e).delete(e);return this.size-=i?1:0,i}return CR=t,CR}var SR,U5;function gbt(){if(U5)return SR;U5=1;var n=yM();function t(e){return n(this,e).get(e)}return SR=t,SR}var xR,Y5;function pbt(){if(Y5)return xR;Y5=1;var n=yM();function t(e){return n(this,e).has(e)}return xR=t,xR}var wR,X5;function fbt(){if(X5)return wR;X5=1;var n=yM();function t(e,i){var r=n(this,e),s=r.size;return r.set(e,i),this.size+=r.size==s?0:1,this}return wR=t,wR}var AR,K5;function mbt(){if(K5)return AR;K5=1;var n=dbt(),t=cbt(),e=gbt(),i=pbt(),r=fbt();function s(o){var a=-1,l=o==null?0:o.length;for(this.clear();++a<l;){var h=o[a];this.set(h[0],h[1])}}return s.prototype.clear=n,s.prototype.delete=t,s.prototype.get=e,s.prototype.has=i,s.prototype.set=r,AR=s,AR}var MR,q5;function vbt(){if(q5)return MR;q5=1;var n=mbt(),t="Expected a function";function e(i,r){if(typeof i!="function"||r!=null&&typeof r!="function")throw new TypeError(t);var s=function(){var o=arguments,a=r?r.apply(this,o):o[0],l=s.cache;if(l.has(a))return l.get(a);var h=i.apply(this,o);return s.cache=l.set(a,h)||l,h};return s.cache=new(e.Cache||n),s}return e.Cache=n,MR=e,MR}var TR,Z5;function _bt(){if(Z5)return TR;Z5=1;var n=vbt(),t=500;function e(i){var r=n(i,function(o){return s.size===t&&s.clear(),o}),s=r.cache;return r}return TR=e,TR}var kR,J5;function bbt(){if(J5)return kR;J5=1;var n=_bt(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,e=/\\(\\)?/g,i=n(function(r){var s=[];return r.charCodeAt(0)===46&&s.push(""),r.replace(t,function(o,a,l,h){s.push(l?h.replace(e,"$1"):a||o)}),s});return kR=i,kR}var RR,Q5;function ybt(){if(Q5)return RR;Q5=1;function n(t,e){for(var i=-1,r=t==null?0:t.length,s=Array(r);++i<r;)s[i]=e(t[i],i,t);return s}return RR=n,RR}var BR,tN;function Cbt(){if(tN)return BR;tN=1;var n=sD(),t=ybt(),e=nD(),i=oD(),r=n?n.prototype:void 0,s=r?r.toString:void 0;function o(a){if(typeof a=="string")return a;if(e(a))return t(a,o)+"";if(i(a))return s?s.call(a):"";var l=a+"";return l=="0"&&1/a==-1/0?"-0":l}return BR=o,BR}var PR,eN;function Sbt(){if(eN)return PR;eN=1;var n=Cbt();function t(e){return e==null?"":n(e)}return PR=t,PR}var ER,iN;function xbt(){if(iN)return ER;iN=1;var n=nD(),t=$0t(),e=bbt(),i=Sbt();function r(s,o){return n(s)?s:t(s,o)?[s]:e(i(s))}return ER=r,ER}var LR,nN;function wbt(){if(nN)return LR;nN=1;var n=oD();function t(e){if(typeof e=="string"||n(e))return e;var i=e+"";return i=="0"&&1/e==-1/0?"-0":i}return LR=t,LR}var IR,rN;function Abt(){if(rN)return IR;rN=1;var n=xbt(),t=wbt();function e(i,r){r=n(r,i);for(var s=0,o=r.length;i!=null&&s<o;)i=i[t(r[s++])];return s&&s==o?i:void 0}return IR=e,IR}var OR,sN;function Mbt(){if(sN)return OR;sN=1;var n=Abt();function t(e,i,r){var s=e==null?void 0:n(e,i);return s===void 0?r:s}return OR=t,OR}var Tbt=Mbt();const kbt=XA(Tbt);function Rbt(n,t,e,i){(n[t]||(n[t]=new Map)).set(e,i)}class CM extends Ul{static get EVENT_TYPE(){return Ul.EVENT_TYPE}static ofArray(t,e,i,r,s,o){return new CM({get:a=>t[a],length:t.length,records:t},e,i,r,s,o)}constructor(t,e,i,r,s,o){let a;V(e==null?void 0:e.groupByRules)&&(s="tree",a=!0),super(t,e,i,r,s,o),this._isGrouped=a,this._recordCache=[],this._fieldCache={}}getOriginalRecord(t){return J(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:super.getOriginalRecord(t)}getRawRecord(t){var e,i,r,s;let o,a;if(this._isGrouped){if(o=this.getOriginRecordIndexForGroup(t),L(o)&&((e=this.beforeChangedRecordsMap)===null||e===void 0?void 0:e.has(o.toString())))return(i=this.beforeChangedRecordsMap)===null||i===void 0?void 0:i.get(o.toString())}else if(!((r=this.beforeChangedRecordsMap)===null||r===void 0)&&r.has(t.toString()))return(s=this.beforeChangedRecordsMap)===null||s===void 0?void 0:s.get(t.toString());return J(t)&&this._recordCache&&this._recordCache[t]?this._recordCache[t]:(a=this.dataSourceObj.records?Array.isArray(t)?qE(this.records,t):this.records[t]:this._get(t),Nh(a,l=>{this.recordPromiseCallBack(t,l)}))}getOriginalField(t,e,i,r,s){const o=this._fieldCache&&this._fieldCache[t];if(o){const a=o.get(e);if(a)return a}return super.getOriginalField(t,e,i,r,s)}clearCache(){this._recordCache&&(this._recordCache=[]),this._fieldCache&&(this._fieldCache={})}fieldPromiseCallBack(t,e,i){Rbt(this._fieldCache,t,e,i)}recordPromiseCallBack(t,e){this._recordCache&&(this._recordCache[t]=e)}get records(){return Array.isArray(this._recordCache)&&this._recordCache.length>0?this._recordCache:super.records}release(){var t;(t=super.release)===null||t===void 0||t.call(this),this._recordCache=null,this._fieldCache=null}_generateFieldAggragations(){var t;if(super._generateFieldAggragations(),V((t=this.dataConfig)===null||t===void 0?void 0:t.groupByRules)){const e=this.dataConfig.groupByRules;this.groupAggregator=new this.registedAggregators[Ji.CUSTOM]({field:"",aggregationFun:(i,r,s)=>{const o=new Map,a=[];for(let l=0;l<r.length;l++)ZE(r[l],a,o,e,0);return a}}),this.fieldAggregators.push(this.groupAggregator)}}processRecords(t){var e;const i=super.processRecords(t);return((e=this.groupAggregator)===null||e===void 0?void 0:e.value())||i}getGroupLength(){var t,e,i;return(i=(e=(t=this.dataConfig)===null||t===void 0?void 0:t.groupByRules)===null||e===void 0?void 0:e.length)!==null&&i!==void 0?i:0}updateGroup(){var t,e,i;this.clearCache();const r=this.source;this._source=this.processRecords((e=(t=this.dataSourceObj)===null||t===void 0?void 0:t.records)!==null&&e!==void 0?e:this.dataSourceObj),r&&uq(r,this.source),this.sourceLength=((i=this.source)===null||i===void 0?void 0:i.length)||0,this.sortedIndexMap.clear(),this.currentIndexedData=Array.from({length:this.sourceLength},(s,o)=>o),this.userPagination||(this.pagination.perPageCount=this.sourceLength,this.pagination.totalCount=this.sourceLength),this.initTreeHierarchyState(),this.updatePagerData()}getOriginRecordIndexForGroup(t){const e=this.getOriginalRecord(t);if(L(e)&&!(e.children&&e.children.length>0)){for(let i=0;i<this.dataSourceObj.records.length;i++)if(this.dataSourceObj.records[i]===e)return i}}addRecordsForGroup(t,e){if(!V(t)||t.length===0)return;let i=this.getOriginRecordIndexForGroup(e);(i===void 0||i>this.dataSourceObj.records)&&(i=this.dataSourceObj.records.length),this.dataSourceObj.records.splice(i,0,...t),this.adjustBeforeChangedRecordsMap(i,t.length),this.updateGroup()}deleteRecordsForGroup(t){if(!V(t)||t.length===0)return;const e=a5(t);for(let i=0;i<e.length;i++){const r=e[i];if(J(r)&&(r>=this.sourceLength||r<0))continue;const s=this.getOriginRecordIndexForGroup(r);this.beforeChangedRecordsMap.delete(s.toString()),this.dataSourceObj.records.splice(s,1),this.sourceLength-=1,this.adjustBeforeChangedRecordsMap(s,1,"delete")}this.updateGroup()}updateRecordsForGroup(t,e){for(let i=0;i<e.length;i++){const r=e[i];if(J(r)&&(r>=this.sourceLength||r<0))continue;const s=this.getOriginRecordIndexForGroup(r);this.beforeChangedRecordsMap.delete(s.toString()),this.dataSourceObj.records[s]=t[i]}this.updateGroup()}addRecordsForTree(t,e){if(V(t)&&t.length!==0){if(this.adjustBeforeChangedRecordsMap(e,t.length),J(e))this.dataSourceObj.records.splice(e,0,...t);else{const i=e.pop(),r=this.getOriginalRecord(e);r.children?r.children.splice(i,0,...t):r.children=t}this.initTreeHierarchyState(),this.updatePagerData()}}deleteRecordsForTree(t){if(!V(t)||t.length===0)return;const e=a5(t);for(let i=0;i<e.length;i++){const r=e[i];if(!J(r)||!(r>=this.sourceLength||r<0)){if(this.beforeChangedRecordsMap.delete(r.toString()),J(r))this.dataSourceObj.records.splice(r,1);else{const s=r.pop();this.getOriginalRecord(r).children.splice(s,1)}this.adjustBeforeChangedRecordsMap(r,1,"delete")}}this.initTreeHierarchyState(),this.updatePagerData()}updateRecordsForTree(t,e){for(let i=0;i<e.length;i++){const r=e[i],s=t[i];if(!J(r)||!(r>=this.sourceLength||r<0))if(this.beforeChangedRecordsMap.delete(r.toString()),J(r))this.dataSourceObj.records.splice(r,1,s);else{const o=r.pop();this.getOriginalRecord(r).children.splice(o,1,s)}}this.initTreeHierarchyState(),this.updatePagerData()}adjustBeforeChangedRecordsMap(t,e,i="add"){if(this.rowHierarchyType==="tree"){let r;r=J(t)?[t]:t;const s=[];this.beforeChangedRecordsMap.forEach((o,a)=>{var l,h;const d=a.split(","),u=Math.max(d.length,r.length);for(let c=0;c<u;c++){const g=(l=r[c])!==null&&l!==void 0?l:-1,p=(h=Number(d[c]))!==null&&h!==void 0?h:-1;if(g<p||g===p&&c===d.length-1&&c===r.length-1)return d[c]=(p+(i==="add"?e:-e)).toString(),void s.push({originKey:a,targetKey:d.toString(),value:o})}}),s.forEach(({originKey:o,targetKey:a,value:l})=>{this.beforeChangedRecordsMap.delete(o),this.beforeChangedRecordsMap.set(a,l)})}else super.adjustBeforeChangedRecordsMap(t,e,i)}cacheBeforeChangedRecord(t,e){var i;const r=this.getOriginalRecord(t);e.options.groupBy&&(t=this.getOriginRecordIndexForGroup(t)),this.beforeChangedRecordsMap.has(t.toString())||this.beforeChangedRecordsMap.set(t.toString(),(i=Pn(r,void 0,["vtable_gantt_linkedFrom","vtable_gantt_linkedTo"]))!==null&&i!==void 0?i:{})}getGroupSeriesNumber(t){const e=this.dataSource.currentIndexedData[t],i=e.length-1;let r=e.length,s=1;for(;r>i;s++){const o=this.dataSource.currentIndexedData[t-s];r=J(o)?1:o.length}return s-1}}function ZE(n,t,e,i,r){const s=i[r];if(!L(s))return void t.push(n);const o=kbt(n,s);if(o!==void 0){if(e.has(o)){const a=e.get(o);return ZE(n,t[a].children,t[a].map,i,r+1)}return e.set(o,t.length),t.push({vtableMerge:!0,vtableMergeName:o,children:[],map:new Map}),ZE(n,t[t.length-1].children,t[t.length-1].map,i,r+1)}}function uq(n,t,e,i){if(!e){e=new Map;for(let r=0;r<n.length;r++){const s=n[r];s.vtableMerge&&e.set(s.vtableMergeName,r)}}if(!i){i=new Map;for(let r=0;r<t.length;r++){const s=t[r];s.vtableMerge&&i.set(s.vtableMergeName,r)}}for(let r=0;r<n.length;r++){const s=n[r],o=t[i.get(s.vtableMergeName)];L(o)&&(o.hierarchyState=n[r].hierarchyState),V(s.children)&&V(o.children)&&s.map.size!==0&&o.map.size!==0&&uq(s.children,o.children,s.map,o.map)}}var by={exports:{}},oN;function Bbt(){if(oN)return by.exports;oN=1;var n={},t=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))",`?\\s*([-,\\"\\'\\sa-z]+?)\\s*$`].join(""),"i"),e=["style","variant","weight","size","lineHeight","family"],i=/([\.0-9]+)(.*)/,r=function(l,h,d){var u=l.match(i);if(u){l=parseFloat(u[1]);var c=u[2].toLowerCase().trim(),g=Math.round(l);switch(g===l&&(l=g),c){case"em":return h===null?void 0:l*h;case"px":return l;case"pt":return l/(72/d);case"pc":return l/(6/d);case"mm":return l*(d/25.4);case"cm":return l*(d/2.54);case"in":return l*d;case"%":return h===null?void 0:h*(l/100)}}},s={size:r,lineHeight:r},o={serif:1,"sans-serif":1,cursive:1,fantasy:1,monospace:1},a=by.exports=function(l,h,d){var u=l+"-"+(h||"null")+"@"+d;if(d=d||96,typeof n[u]<"u")return n[u];if(h&&(h=a(h,null,d)),l==="inherit")return h;var c=t.exec(l);if(!c){n[u]=null;return}c.shift();for(var g={},p=0;p<c.length;p++){var f=e[p],m=c[p];if(s[f]&&m){var v=h&&h[f]||null,_=s[f](m,v,d);typeof _>"u"&&f==="lineHeight"&&m?m=g.size*parseFloat(m):m=_}if(!(!m||m==="normal")){if(m==="inherit"){if(!h)return;m=h[f]}m.trim&&(m=m.trim()),g[f]=m}}Object.keys(g).length||(g=null),n[u]=g;var b=[];g.style&&b.push(g.style),g.variant&&b.push(g.variant),g.weight&&g.weight!=="400"&&g.weight!=="normal"&&b.push(g.weight),b.push(g.size+"px"),g.lineHeight&&(b[b.length-1]+="/"+g.lineHeight+"px");var y=g.family.split(",");return g.family=y.map(function(C){return C=C.trim(),o[C.toLowerCase()]&&(C=C.toLowerCase()),C}),b.push(g.family),Object.defineProperty(g,"toString",{value:function(){return b.map(function(C){return Array.isArray(C)?C.map(function(S){return S.indexOf(" ")>-1?'"'+S.replace(/["']/g,"")+'"':S}).join(", "):C}).join(" ")}}),g};return by.exports.generics=o,by.exports}var Pbt=Bbt();const Ebt=XA(Pbt);function Lbt(n){return Ebt(n)}function Be(n){var t,e,i,r;if(J(n)||yt(n)||V(n)){let s=gS(n);return typeof s=="number"||typeof s=="string"?s=[s,s,s,s]:Array.isArray(s)&&(s=s.slice(0)),s}return n&&(isFinite(n.bottom)||isFinite(n.left)||isFinite(n.right)||isFinite(n.top))?[(t=n.top)!==null&&t!==void 0?t:0,(e=n.right)!==null&&e!==void 0?e:0,(i=n.bottom)!==null&&i!==void 0?i:0,(r=n.left)!==null&&r!==void 0?r:0]:[0,0,0,0]}const SC=0,cq=1,mx=2,gq=3,pq=10,fq=11,mq=12,Ibt=9,Obt=13,Dbt=10,Fbt=12,Hbt=32,zbt=37,Wbt=46,jbt=48,Nbt=57,$bt=65,Vbt=90,Gbt=97,Ubt=122;function Ybt(n){return n>=$bt&&n<=Vbt}function Xbt(n){return n>=Gbt&&n<=Ubt}function Kbt(n){return Xbt(n)||Ybt(n)}function qbt(n){return n===Ibt||n===Dbt||n===Fbt||n===Obt||n===Hbt}function DR(n){return n>=jbt&&n<=Nbt}function aN(n){return n===Wbt}function lN(n){return Kbt(n)||n===zbt}function vv(n){return new Error(`calc parse error: ${n}`)}function Zbt(n){const t=n.replace(/calc\(/g,"(").trim(),e=[],i=t.length;for(let a=0;a<i;a++){const l=t[a],h=l.charCodeAt(0);if(l==="("||l===")")e.push({value:l,type:SC});else if(l==="*"||l==="/")e.push({value:l,type:mx});else if(l==="+"||l==="-")a=r(l,a+1)-1;else if(DR(h)||aN(h))a=s(l,a+1)-1;else if(!qbt(h))throw vv(n)}function r(a,l){if(l<i){const h=t[l],d=h.charCodeAt(0);if(DR(d)||aN(d))return s(a+h,l+1)}return e.push({value:a,type:mx}),l}function s(a,l){let h=l;for(;h<i;h++){const d=t[h],u=d.charCodeAt(0);if(DR(u))a+=d;else{if(d!=="."){if(lN(u))return o(a,d,h+1);break}if(a.indexOf(".")>=0)throw vv(n);a+=d}}if(a===".")throw vv(n);return e.push({value:parseFloat(a),type:gq}),h}function o(a,l,h){let d=h;for(;d<i;d++){const u=t[d];if(!lN(u.charCodeAt(0)))break;l+=u}return e.push({value:parseFloat(a),unit:l,type:cq}),d}return e}const hN={"*":3,"/":3,"+":2,"-":2};function vq(n,t){function e(r){const s=r.pop(),o=r.pop(),a=r.pop();if(!(a&&a.nodeType&&o&&o.type===mx&&s&&s.nodeType))throw vv(t);return{nodeType:fq,left:a,op:o,right:s}}const i=[];for(;n.length;){const r=n.shift();if(r.type===SC&&r.value==="("){let s=0;const o=ZK.findIndex(n,a=>{if(a.type===SC&&a.value==="(")s++;else if(a.type===SC&&a.value===")"){if(!s)return!0;s--}return!1});if(o===-1)throw vv(t);i.push(vq(n.splice(0,o),t)),n.shift()}else if(r.type===mx){if(i.length>=3){const s=i[i.length-2].value;hN[r.value]<=hN[s]&&i.push(e(i))}i.push(r)}else if(r.type===cq){const{value:s,unit:o}=r;i.push({nodeType:pq,value:s,unit:o})}else r.type===gq&&i.push({nodeType:mq,value:r.value})}for(;i.length>1;)i.push(e(i));return i[0]}function Jbt(n){return vq(Zbt(n),n)}function JE(n,t){if(n.nodeType===fq){const e=JE(n.left,t),i=JE(n.right,t);switch(n.op.value){case"+":return e+i;case"-":return e-i;case"*":return e*i;case"/":return e/i;default:throw new Error(`calc error. unknown operator: ${n.op.value}`)}}else if(n.nodeType===pq)switch(n.unit){case"%":return n.value*t.full/100;case"px":return n.value;default:throw new Error(`calc error. unknown unit: ${n.unit}`)}else if(n.nodeType===mq)return n.value;throw new Error("calc error.")}function Qbt(n,t){return JE(Jbt(n),t)}function tyt(n,t){return typeof n=="string"?Qbt(n.trim(),t):n-0}function eyt(n){return!D(n)&&(!!J(n)||+n==+n)}function FR(n){return!!yt(n)&&!!n.endsWith("%")&&eyt(n.substring(0,n.length-1))}function iyt(n,t="vtable"){var e,i;const r=document.createElement("div");r.setAttribute("tabindex","0"),r.classList.add(t),r.style.outline="none",r.style.margin=`${n.top}px ${n.right}px ${n.bottom}px ${n.left}px`;const s=(r.offsetWidth||((e=r.parentElement)===null||e===void 0?void 0:e.offsetWidth)||1)-1,o=(r.offsetHeight||((i=r.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;return r.style.width=s&&s-n.left-n.right+"px"||"0px",r.style.height=o&&o-n.top-n.bottom+"px"||"0px",r}function nyt(n,t){var e,i;n.style.margin=`${t.top}px ${t.right}px ${t.bottom}px ${t.left}px`;const r=(n.offsetWidth||((e=n.parentElement)===null||e===void 0?void 0:e.offsetWidth)||1)-1,s=(n.offsetHeight||((i=n.parentElement)===null||i===void 0?void 0:i.offsetHeight)||1)-1;n.style.width=r&&r-t.left-t.right+"px"||"0px",n.style.height=s&&s-t.top-t.bottom+"px"||"0px"}function _q(n,t){const{dataSourceEventIds:e}=n.internalProps;e&&e.forEach(i=>n.internalProps.handler.off(i)),t(n),n.internalProps.dataSourceEventIds=[n.internalProps.handler.on(n.internalProps.dataSource,Ul.EVENT_TYPE.CHANGE_ORDER,()=>{n.dataSource.hierarchyExpandLevel&&n.refreshRowColCount(),n.render()})]}function dN(n,t=[]){_q(n,()=>{n.internalProps.records=t;const e=n.internalProps.dataSource=CM.ofArray(t,n.internalProps.dataConfig,n.pagination,n.internalProps.columns,n.internalProps.layoutMap.rowHierarchyType,bq(n));n.addReleaseObj(e)})}function bq(n){var t;return n.options.hierarchyExpandLevel?n.options.hierarchyExpandLevel:n.options.groupBy?1/0:!((t=n._hasHierarchyTreeHeader)===null||t===void 0)&&t.call(n)?1:void 0}function ryt(n,t){_q(n,()=>{n.internalProps.dataSource&&n.internalProps.releaseList.forEach(e=>{e instanceof Ul&&(e.release(),n.internalProps.releaseList.splice(n.internalProps.releaseList.indexOf(e),1))}),t?t instanceof Ul?(n.internalProps.dataSource=t,n.internalProps.dataSource.supplementConfig(n.pagination,n.options.columns,n.internalProps.layoutMap.rowHierarchyType,bq(n))):n.internalProps.dataSource=new CM(t):n.internalProps.dataSource=Ul.EMPTY,n.addReleaseObj(n.internalProps.dataSource),n.internalProps.records=null})}function syt(n,t){if(!n.internalProps.frozenRowCount)return null;let{scrollTop:e}=n;const i=n.internalProps.frozenRowCount;for(let r=0;r<i;r++){const s=n.getRowHeight(r),o=e+s;if(o>t)return{top:e,row:r,bottom:o,height:s};e=o}return null}function oyt(n,t){if(!n.internalProps.frozenColCount)return null;let{scrollLeft:e}=n;const i=n.internalProps.frozenColCount;for(let r=0;r<i;r++){const s=n.getColWidth(r),o=e+s;if(o>t)return{left:e,col:r,right:o,width:s};e=o}return null}function hg(n,t){return Math.round(tyt(t,n.internalProps.calcWidthContext))}function ayt(n,t){return n?n.min&&n.min>t?n.min:n.max&&n.max<t?n.max:t:t}function lyt(n){let t=0,e=0;n.frozenColCount>0&&(t=n.getFrozenColsWidth()),n.rightFrozenColCount>0&&(e=n.getRightFrozenColsWidth());let i=0,r=0;return n.frozenRowCount>0&&(i=n.getFrozenRowsHeight()),n.bottomFrozenRowCount>0&&(r=n.getBottomFrozenRowsHeight()),new Tu(n.scrollLeft+t,n.scrollTop+i,n.tableNoFrameWidth-t-e,n.tableNoFrameHeight-i-r)}function Vd(n,t,e,i,r,s=!0){const o=Be(r("padding",n,e,i,t)),a=r("bgColor",n,e,i,t),l=r("font",n,e,i,t);let h,d,u,c,g;if(l){const{family:P,size:I,weight:O,style:H,variant:z}=Lbt(l);h=P.join(" "),d=I,u=O,c=H,c=z}else h=r("fontFamily",n,e,i,t),d=r("fontSize",n,e,i,t),u=r("fontWeight",n,e,i,t),c=r("fontStyle",n,e,i,t),g=r("fontVariant",n,e,i,t);const p=r("textAlign",n,e,i,t),f=r("textBaseline",n,e,i,t),m=r("color",n,e,i,t),v=r("strokeColor",n,e,i,t),_=r("lineHeight",n,e,i,t),b=r("underline",n,e,i,t),y=r("underlineDash",n,e,i,t),C=r("underlineOffset",n,e,i,t),S=r("lineThrough",n,e,i,t),w=Math.max(1,Math.floor(d/10)),x=r("textOverflow",n,e,i,t),A=r("borderColor",n,e,i,t),M=r("borderLineWidth",n,e,i,t),T=r("borderLineDash",n,e,i,t),R=r("marked",n,e,i,t),B=r("cursor",n,e,i,t),E=!(o&&a&&l&&p&&f&&m&&x&&A&&M&&T&&typeof b=="boolean"&&typeof S=="boolean"&&typeof R=="boolean");if(!s)return{hasFunctionPros:E};const k={text:{fontFamily:h,fontSize:d,fontWeight:u,fontStyle:c,fontVariant:g,fill:m,stroke:v!=null&&v,textAlign:p,textBaseline:f,lineHeight:_??d,underline:b?w:void 0,underlineDash:y,underlineOffset:C,lineThrough:S?w:void 0,ellipsis:x==="clip"?"":x==="ellipsis"?"...":L(x)?x:void 0},group:{fill:a,lineDash:T,lineWidth:M,stroke:A,cursor:B==="auto"||B==="default"?void 0:B},_vtable:{padding:o,marked:R}};if(Array.isArray(M)&&(k.group.strokeArrayWidth=Be(M)),Array.isArray(A)){const P=Be(A);k.group.stroke=!P.every(I=>!I)&&P,k.group.strokeArrayColor=Be(A)}return{theme:k,hasFunctionPros:E}}function SM(n,t,e){const i=e.theme.frameStyle.cornerRadius;if(e.theme.cellInnerBorder){if(Array.isArray(i)){const r=[0,0,0,0];return n===0&&t===0&&(r[0]=i[0]),n===e.colCount-1&&t===0&&(r[1]=i[1]),n===0&&t===e.rowCount-1&&(r[3]=i[3]),n===e.colCount-1&&t===e.rowCount-1&&(r[2]=i[2]),r}if(i){const r=[0,0,0,0];return n===0&&t===0&&(r[0]=i),n===e.colCount-1&&t===0&&(r[1]=i),n===0&&t===e.rowCount-1&&(r[3]=i),n===e.colCount-1&&t===e.rowCount-1&&(r[2]=i),r}}return 0}function yy(n){for(let t=0;t<n.internalProps.columns.length;t++){const e=n.internalProps.columns[t];if(!e.aggregation){if(n.options.aggregation){let i;if(i=typeof n.options.aggregation=="function"?n.options.aggregation({col:t,field:e.field}):n.options.aggregation,i)if(Array.isArray(i)){const r=[];i.forEach(s=>{r.push(Object.assign({showOnTop:!1},s))}),e.aggregation=r}else e.aggregation=Object.assign({showOnTop:!1},i)}}}}function hyt(n){for(let t=0;t<n.length;t++)if(n[t].aggregation)return!0;return!1}function dyt(n){if(n.options.widthMode==="autoWidth"||n.options.defaultHeaderColWidth==="auto"||Array.isArray(n.options.defaultHeaderColWidth)&&n.options.defaultHeaderColWidth.includes("auto"))return!0;const t=n.internalProps.layoutMap.columnObjects;for(let e=0;e<t.length;e++)if(t[e].width==="auto")return!0;return!1}class vc extends mc{constructor(t){super(t),this.attribute.visibleTime!=="mouseenter_cell"&&this.attribute.visibleTime!=="click_cell"||(this.attribute.opacity=0),this.attribute.hoverImage&&(this.attribute.originImage=this.attribute.image),this.attribute.isGif&&this.attribute.gif&&this.loadGif()}loadGif(){this.playing=!1,Yh.GetFile(this.attribute.gif+`?role=gif&radom=${Math.random()}`,"arrayBuffer").then(t=>{const e=mj.parseGIF(t),i=mj.decompressFrames(e,!0);this.renderGIF(i),this.resources.set(this.attribute.image,{state:"success",data:this.gifCanvas})}).catch(t=>{})}get backgroundWidth(){var t,e;return(e=(t=this.attribute.backgroundWidth)!==null&&t!==void 0?t:this.attribute.width)!==null&&e!==void 0?e:0}get backgroundHeight(){var t,e;return(e=(t=this.attribute.backgroundHeight)!==null&&t!==void 0?t:this.attribute.height)!==null&&e!==void 0?e:0}renderGIF(t){this.loadedFrames=t,this.frameIndex=0,this.tempCanvas||(this.tempCanvas=document.createElement("canvas"),this.tempCtx=this.tempCanvas.getContext("2d")),this.gifCanvas||(this.gifCanvas=document.createElement("canvas"),this.gifCtx=this.gifCanvas.getContext("2d")),this.gifCanvas.width=t[0].dims.width,this.gifCanvas.height=t[0].dims.height,this.playing=!0,this.lastTime=new Date().getTime(),this.animate().to({},1e3,"linear").loop(1/0)}renderFrame(t,e,i){const r=this.loadedFrames[this.frameIndex||0];r.disposalType===2&&this.gifCtx.clearRect(0,0,this.gifCanvas.width,this.gifCanvas.height),this.drawPatch(r),this.manipulate(t,e,i);const s=new Date().getTime()-this.lastTime;r.delay<s&&(this.frameIndex++,this.lastTime=new Date().getTime()),this.frameIndex>=this.loadedFrames.length&&(this.frameIndex=0)}drawPatch(t){const e=t.dims;this.frameImageData&&e.width===this.frameImageData.width&&e.height===this.frameImageData.height||(this.tempCanvas.width=e.width,this.tempCanvas.height=e.height,this.frameImageData=this.tempCtx.createImageData(e.width,e.height)),this.frameImageData.data.set(t.patch),this.tempCtx.putImageData(this.frameImageData,0,0),this.gifCtx.drawImage(this.tempCanvas,e.left,e.top)}manipulate(t,e,i){t.drawImage(this.gifCanvas,0,0,this.gifCanvas.width,this.gifCanvas.height,e,i,this.attribute.width,this.attribute.height)}setAttribute(t,e,i,r){super.setAttribute(t,e,i,r),t==="gif"&&this.loadGif()}setAttributes(t,e,i){super.setAttributes(t,e,i),t.gif&&this.loadGif()}}class yq extends Wn{constructor(t){var e,i,r,s,o;t.fill=(e=t.fill)!==null&&e!==void 0?e:"#00F",t.fontSize=(i=t.fontSize)!==null&&i!==void 0?i:12,t.underline=(r=t.underline)!==null&&r!==void 0?r:1,t.textBaseline=(s=t.textBaseline)!==null&&s!==void 0?s:"top",t.cursor=(o=t.cursor)!==null&&o!==void 0?o:"pointer",super(t)}}function $_(n){return{rootContainer:new el({}),renderDefault:!0}}class uyt{constructor(t){this.table=t,this.customLayoutFuncCache=new Map,this.reactRemoveGraphicCache=new Map,this.reactRemoveAllGraphicCache=new Map,this.headerCustomLayoutFuncCache=new Map,this.headerReactRemoveGraphicCache=new Map,this.headerReactRemoveAllGraphicCache=new Map}hasReactCreateGraphic(t,e){return e?this.headerCustomLayoutFuncCache.has(t):this.customLayoutFuncCache.has(t)}setReactCreateGraphic(t,e,i){i?this.headerCustomLayoutFuncCache.set(t,e):this.customLayoutFuncCache.set(t,e)}setReactRemoveGraphic(t,e,i){i?this.headerReactRemoveGraphicCache.set(t,e):this.reactRemoveGraphicCache.set(t,e)}setReactRemoveAllGraphic(t,e,i){i?this.headerReactRemoveAllGraphicCache.set(t,e):this.reactRemoveAllGraphicCache.set(t,e)}updateCustomCell(t,e){const i=this.table;if(i.widthMode==="autoWidth"&&i.scenegraph.recalculateColWidths(),(i.isAutoRowHeight()||i.internalProps.defaultRowHeight==="auto"&&!e||i.internalProps.defaultHeaderRowHeight==="auto"&&e)&&i.scenegraph.recalculateRowHeights(),i.isPivotTable()){const r=gyt(t,i,e);for(let s=0;s<r.length;s++){const o=r[s];for(let a=o.start.col;a<=o.end.col;a++)for(let l=o.start.row;l<=o.end.row;l++)i.scenegraph.updateCellContent(a,l)}}else{const r=cyt(t,i,e);for(let s=r.start.col;s<=r.end.col;s++)for(let o=r.start.row;o<=r.end.row;o++)i.scenegraph.updateCellContent(s,o)}i.scenegraph.renderSceneGraph()}getCustomLayoutFunc(t,e){var i;if(this.table.isHeader(t,e)){const{componentId:s}=this.table.getHeaderDefine(t,e);return(i=this.headerCustomLayoutFuncCache.get(s))!==null&&i!==void 0?i:$_}const{componentId:r}=this.table.getBodyColumnDefine(t,e);return this.customLayoutFuncCache.get(r)||$_}removeCustomCell(t,e){let i;if(this.table.isHeader(t,e)){const r=this.table.getHeaderDefine(t,e),{componentId:s}=r;i=this.headerReactRemoveGraphicCache.get(s)}else{const r=this.table.getBodyColumnDefine(t,e),{componentId:s}=r;i=this.reactRemoveGraphicCache.get(s)}i&&i(t,e)}clearCache(){this.reactRemoveAllGraphicCache.forEach(t=>{t()}),this.headerReactRemoveAllGraphicCache.forEach(t=>{t()})}updateAllCustomCell(){this.customLayoutFuncCache.forEach((t,e)=>{this.updateCustomCell(e)}),this.headerCustomLayoutFuncCache.forEach((t,e)=>{this.updateCustomCell(e,!0)})}}function cyt(n,t,e){const i=t.internalProps.rowSeriesNumber?1:0;if(e){const s=t.internalProps.layoutMap,{headerObjects:o}=t.internalProps.layoutMap;let a;for(let h=0;h<o.length;h++){const d=o[h];if(d.define.componentId===n){a=d.id;break}}const l=s.getHeaderCellAdressById(a);return s.getCellRange(l.col,l.row)}const{columnObjects:r}=t.internalProps.layoutMap;for(let s=0;s<r.length;s++)if(r[s].define.componentId===n)return{start:{col:i+s,row:t.columnHeaderLevelCount},end:{col:i+s,row:t.rowCount-1}};return{start:{col:0,row:0},end:{col:t.colCount-1,row:t.rowCount-1}}}function gyt(n,t,e){const i=t.internalProps.rowSeriesNumber?1:0,r=[],s=t.internalProps.layoutMap;if(e){const{headerObjects:o}=s,a=[];for(let l=0;l<o.length;l++){const h=o[l];h&&h.define.componentId===n&&a.push(h.id)}for(let l=0;l<a.length;l++){const h=a[l],d=s.getHeaderCellAdressById(h),u=s.getCellRange(d.col,d.row);r.push(u)}}else{let o;const{columnObjects:a,indicatorsAsCol:l}=s;for(let h=0;h<a.length;h++)if(a[h].define.componentId===n){o=h;break}if(l)for(let h=s.rowHeaderLevelCount+o;h<s.colCount;h+=a.length){const d={start:{col:h+i,row:s.columnHeaderLevelCount},end:{col:h+i,row:s.rowCount-1}};r.push(d)}else for(let h=s.columnHeaderLevelCount+o;h<s.rowCount;h+=a.length){const d={start:{col:s.rowHeaderLevelCount+i,row:h},end:{col:s.colCount-1,row:h}};r.push(d)}}return r}function In(n){const t={abstractPos:{x:n.viewport.x,y:n.viewport.y}},e=_c(n.target);return e&&(t.eventArgs={col:e.col,row:e.row,event:n,targetCell:e,mergeInfo:pyt(e),target:n.target}),t}function _c(n){for(;n&&n.parent;){if(n.role==="cell")return n;n=n.parent}return null}function pyt(n){if(L(n.mergeStartCol)&&L(n.mergeStartRow)&&L(n.mergeEndCol)&&L(n.mergeEndRow))return{colStart:n.mergeStartCol,colEnd:n.mergeEndCol,rowStart:n.mergeStartRow,rowEnd:n.mergeEndRow}}const fyt=/radio-\d+-\d+-(\d+)/,Cq="_custom_",qa="custom-container",vx=Cq+"_0";function Rd(n,t,e,i,r,s,o,a,l,h,d){var u,c,g;let p,f,m,v=!0,_=!1;if(n==="react-custom-layout"&&(n=((u=d.reactCustomLayout)===null||u===void 0?void 0:u.getCustomLayoutFunc(e,i))||$_),typeof n=="function"){const b=n({col:(c=h==null?void 0:h.start.col)!==null&&c!==void 0?c:e,row:(g=h==null?void 0:h.start.row)!==null&&g!==void 0?g:i,dataValue:d.getCellOriginValue(e,i),value:d.getCellValue(e,i)||"",rect:{left:0,top:0,right:r,bottom:s,width:r,height:s},table:d,originCol:e,originRow:i});if(!b)return{renderDefault:!0};b.rootContainer&&(b.rootContainer=V_(b.rootContainer,d.animationManager.timeline)),b.rootContainer instanceof el&&(m=b.rootContainer,m.name=qa,m.col=e,m.row=i),v=b.renderDefault,_=b.enableCellPadding}else if(typeof t=="function"){const b=t({col:e,row:i,dataValue:d.getCellOriginValue(e,i),value:d.getCellValue(e,i)||"",rect:{left:0,top:0,right:r,bottom:s,width:r,height:s},table:d});b&&(f=b.elements,v=b.renderDefault,b.expectedWidth,p=b.expectedHeight)}else t&&(t.expectedWidth,p=t.expectedHeight,f=t.elements,v=t.renderDefault);return f&&(m=myt(f,r,a?p:s,d.getCellValue(e,i))),_&&m.setAttributes({x:l[3],y:l[0],width:r-l[1]-l[3],height:s-l[0]-l[2]}),xM(m,r,s),!h||h.start.col===h.end.col&&h.start.row===h.end.row||Sq(m,e,i,0),{elementsGroup:m,renderDefault:v}}function myt(n,t,e,i){const r=new el({x:0,y:0,width:t,height:e,fill:!1,stroke:!1,pickable:!1});return r.name=qa,vyt(n,t,e,i).forEach(s=>{var o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I;switch(s.clickable&&(s.pickable=s.clickable),s.type){case"arc":const O=_S({x:s.x,y:s.y,dx:(o=s.dx)!==null&&o!==void 0?o:0,dy:(a=s.dy)!==null&&a!==void 0?a:0,fill:s.fill,stroke:s.stroke,outerRadius:s.radius,startAngle:s.startAngle,endAngle:s.endAngle,pickable:!!s.pickable,cursor:s.cursor});O.name=s.name,r.appendChild(O);break;case"text":if(s.background){const G=(h=(l=s.background)===null||l===void 0?void 0:l.expandX)!==null&&h!==void 0?h:0,tt=(u=(d=s.background)===null||d===void 0?void 0:d.expandY)!==null&&u!==void 0?u:0,st=wi({x:s.x-G,y:s.y-tt,dx:(c=s.dx)!==null&&c!==void 0?c:0,dy:(g=s.dy)!==null&&g!==void 0?g:0,width:s.width+2*G,height:s.height+2*tt,cornerRadius:(f=(p=s.background)===null||p===void 0?void 0:p.cornerRadius)!==null&&f!==void 0?f:0,fill:(v=(m=s.background)===null||m===void 0?void 0:m.fill)!==null&&v!==void 0?v:"#888"});r.appendChild(st)}const H=new Wn(Object.assign({pickable:!!s.pickable,fill:(_=s.color)!==null&&_!==void 0?_:s.fill},s));H.name=s.name,r.appendChild(H);break;case"rect":const z=wi({x:s.x,y:s.y,dx:(b=s.dx)!==null&&b!==void 0?b:0,dy:(y=s.dy)!==null&&y!==void 0?y:0,width:s.width,height:s.height,cornerRadius:s.radius,fill:s.fill,stroke:s.stroke,pickable:!!s.pickable,cursor:s.cursor});z.name=s.name,r.appendChild(z);break;case"circle":const F=HX({x:s.x,y:s.y,dx:(C=s.dx)!==null&&C!==void 0?C:0,dy:(S=s.dy)!==null&&S!==void 0?S:0,radius:s.radius,fill:s.fill,stroke:s.stroke,pickable:!!s.pickable,cursor:s.cursor});F.name=s.name,r.appendChild(F);break;case"icon":const j=new vc({x:s.x,y:s.y,dx:(w=s.dx)!==null&&w!==void 0?w:0,dy:(x=s.dy)!==null&&x!==void 0?x:0,width:s.width,height:s.height,image:s.svg,backgroundWidth:s.hover?(A=s.hover.width)!==null&&A!==void 0?A:s.width:void 0,backgroundHeight:s.hover?(M=s.hover.width)!==null&&M!==void 0?M:s.width:void 0,backgroundColor:s.hover?(T=s.hover.bgColor)!==null&&T!==void 0?T:"rgba(22,44,66,0.2)":void 0,pickable:!!s.pickable,cursor:s.cursor});j.name=s.name,j.role="icon-custom",r.appendChild(j);break;case"image":const $=new vc({x:s.x,y:s.y,dx:(R=s.dx)!==null&&R!==void 0?R:0,dy:(B=s.dy)!==null&&B!==void 0?B:0,width:s.width,height:s.height,image:s.src,backgroundWidth:s.hover?(E=s.hover.width)!==null&&E!==void 0?E:s.width:void 0,backgroundHeight:s.hover?(k=s.hover.width)!==null&&k!==void 0?k:s.width:void 0,backgroundColor:s.hover?(P=s.hover.bgColor)!==null&&P!==void 0?P:"rgba(22,44,66,0.2)":void 0,pickable:!!s.pickable,cursor:s.cursor,shape:s.shape});$.name=s.name,$.role="image-custom",r.appendChild($);break;case"line":const Y=Os({points:s.points,lineWidth:(I=s.lineWidth)!==null&&I!==void 0?I:1,stroke:s.stroke,pickable:!!s.pickable,cursor:s.cursor});Y.name=s.name,r.appendChild(Y)}}),r}function vyt(n,t,e,i){const r=[],s=[0,0,0,0];for(let o=0;o<n.length;o++){const a=n[o],l=Object.assign({},a);for(const d in l)l.hasOwnProperty(d)&&it(l[d])&&(l[d]=l[d](i));const h=l;L(h.x)&&(h.x=yt(h.x)?fl(h.x,t-s[1]):Number(h.x)),L(h.y)&&(h.y=yt(h.y)?fl(h.y,e-s[2]):Number(h.y)),"width"in l&&(l.width=yt(l.width)?fl(l.width,t-s[1]):Number(l.width)),"height"in l&&(l.height=yt(l.height)?fl(l.height,e-s[2]):Number(l.height)),"radius"in l&&(l.radius=yt(l.radius)?fl(l.radius,Math.min(t-s[1],e-s[2])):Number(l.radius)),"hover"in l&&(l.hover.x=yt(l.hover.x)?fl(l.hover.x,t-s[1]):Number(l.hover.x),l.hover.y=yt(l.hover.y)?fl(l.hover.y,e-s[2]):Number(l.hover.y),l.hover.width=yt(l.hover.width)?fl(l.hover.width,t-s[1]):Number(l.hover.width),l.hover.height=yt(l.hover.height)?fl(l.hover.height,e-s[2]):Number(l.hover.height),l.hover.x+=0,l.hover.y+=0),h.x=h.x+0,h.y=h.y+0,r.push(l)}return r}function fl(n,t){return n.endsWith("px")?parseInt(n,10):n.endsWith("%")&&t?parseInt(n,10)/100*t:parseInt(n,10)}function xM(n,t,e){n&&n.forEachChildren(i=>{var r,s;i&&(kt(i.attribute.width)&&i.attribute.width.percent&&i.setAttribute("width",Math.max(0,i.attribute.width.percent/100*t+((r=i.attribute.width.delta)!==null&&r!==void 0?r:0))),i.attribute.width<0&&i.setAttribute("width",0),kt(i.attribute.height)&&i.attribute.height.percent&&i.setAttribute("height",Math.max(0,i.attribute.height.percent/100*e+((s=i.attribute.height.delta)!==null&&s!==void 0?s:0))),i.attribute.height<0&&i.setAttribute("height",0),i.type==="group"&&xM(i,i.attribute.width,i.attribute.height))})}function V_(n,t){if(!n||!L(n.$$typeof)&&!L(n.vtype))return n;const e=n.type,{attribute:i,children:r,stateProxy:s,animation:o}=n.props,a=e({attribute:i});if(_yt(a,n.props),s&&(a.stateProxy=s),a.id=i.id,a.name=i.name,V(r)?r.forEach(l=>{const h=V_(l,t);h&&h.type&&a.add(h)}):r&&a.add(V_(r,t)),V(o)&&t){const l=a.animate();l.setTimeline(t),o.forEach(h=>{l[h[0]](...h.slice(1))})}return a}function _yt(n,t){let e=!1;switch(n.type){case"richtext":case"rich/image":break;default:e=!0}e&&Object.keys(t).forEach(i=>{const r=Vpt[i];r&&n.on(r,t[i])})}function Sq(n,t,e,i,r){n&&(n.name=`${Cq}${r??""}_${i}`,n.onBeforeAttributeUpdate=byt,n.type==="group"&&n.childrenCount&&n.forEachChildren((s,o)=>{Sq(s,t,e,o,(r??"")+"_"+i)}))}function byt(n,t){const e=this;if(e.skipMergeUpdate)return;const i=_c(e);if(!i||!i.stage)return;const r=i.stage.table;e.skipAttributeUpdate=!0;const{mergeStartCol:s,mergeEndCol:o,mergeStartRow:a,mergeEndRow:l}=i;if(L(s)&&L(o)&&L(a)&&L(l)&&(s!==o||a!==l)){for(let h=s;h<=o;h++)for(let d=a;d<=l;d++){if(h===i.col&&d===i.row)continue;const u=r.scenegraph.highPerformanceGetCell(h,d);if(u.role==="cell"){const c=u.getChildByName(e.name,!0);if(!c||c.skipAttributeUpdate)continue;for(const g in n)n[g]!==c.attribute[g]&&g!=="dx"&&g!=="dy"&&c.setAttribute(g,n[g])}}e.skipAttributeUpdate=void 0}}let zm,Wm,QE,tL,fu,mu,eL,xq,wq,Aq,Mq,vu,_u,Tq,kq,iL,nL,Rq,Bq,rL,sL,bu,yu,oL;function Cy(n){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x;zm=(t=n==null?void 0:n.sort_color)!==null&&t!==void 0?t:"#282F38",Wm=(e=n==null?void 0:n.sort_color_opacity)!==null&&e!==void 0?e:"0.35",QE=(i=n==null?void 0:n.sort_color_2)!==null&&i!==void 0?i:"#416EFF",tL=(r=n==null?void 0:n.sort_color_opacity_2)!==null&&r!==void 0?r:"1",fu=(s=n==null?void 0:n.sort_size)!==null&&s!==void 0?s:16,mu=(o=n==null?void 0:n.sort_size_2)!==null&&o!==void 0?o:22,eL=(a=n==null?void 0:n.frozen_color)!==null&&a!==void 0?a:"#282F38",xq=(l=n==null?void 0:n.frozen_color_opacity)!==null&&l!==void 0?l:"0.35",wq=(h=n==null?void 0:n.frozen_color_opacity)!==null&&h!==void 0?h:"0.2",Aq=(d=n==null?void 0:n.frozen_color_2)!==null&&d!==void 0?d:"#416EFF",Mq=(u=n==null?void 0:n.frozen_color_opacity_2)!==null&&u!==void 0?u:"1",vu=(c=n==null?void 0:n.frozen_size)!==null&&c!==void 0?c:22,_u=(g=n==null?void 0:n.frozen_size_2)!==null&&g!==void 0?g:22,Tq=(p=n==null?void 0:n.collapse_color)!==null&&p!==void 0?p:"#141414",kq=(f=n==null?void 0:n.collapse_color_opacity)!==null&&f!==void 0?f:"0.65",iL=(m=n==null?void 0:n.collapse_size)!==null&&m!==void 0?m:16,nL=(v=n==null?void 0:n.frozen_size_2)!==null&&v!==void 0?v:22,Rq=(_=n==null?void 0:n.expand_color)!==null&&_!==void 0?_:"#141414",Bq=(b=n==null?void 0:n.expand_color_opacity)!==null&&b!==void 0?b:"0.65",rL=(y=n==null?void 0:n.expand_size)!==null&&y!==void 0?y:16,sL=(C=n==null?void 0:n.expand_size_2)!==null&&C!==void 0?C:22,bu=(S=n==null?void 0:n.dragReorder_color)!==null&&S!==void 0?S:"#666666",yu=(w=n==null?void 0:n.dragReorder_color_opacity)!==null&&w!==void 0?w:"1",oL=(x=n==null?void 0:n.dragReorder_size)!==null&&x!==void 0?x:20}const yyt={get sort_downward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> <path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${QE}"  fill-opacity="${tL}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${zm}" fill-opacity="${Wm}"/></svg> `,width:fu,height:fu,funcType:si.sort,name:"sort_downward",positionType:ri.contentRight,marginLeft:3,hover:{width:mu,height:mu,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_upward(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${zm}"  fill-opacity="${Wm}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${QE}"  fill-opacity="${tL}"/> </svg>`,width:fu,height:fu,funcType:si.sort,positionType:ri.contentRight,name:"sort_upward",marginLeft:3,hover:{width:mu,height:mu,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get sort_normal(){return{type:"svg",svg:`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M4.6665 9H11.3332L7.99984 13.1667L4.6665 9Z" fill="${zm}" fill-opacity="${Wm}"/><path d="M11.3335 7L4.66683 7L8.00016 2.83333L11.3335 7Z" fill="${zm}" fill-opacity="${Wm}"/></svg> `,width:fu,height:fu,funcType:si.sort,positionType:ri.contentRight,name:"sort_normal",marginLeft:3,hover:{width:mu,height:mu,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get freeze(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0)"><path d="M17.1313 8.42047C17.1932 8.48238 17.2423 8.55587 17.2759 8.63676C17.3094 8.71764 17.3266 8.80434 17.3266 8.89189C17.3266 8.97944 17.3094 9.06613 17.2759 9.14702C17.2423 9.2279 17.1932 9.3014 17.1313 9.3633L13.3843 13.1103C13.7007 14.3048 13.5305 15.4443 12.8388 16.2395C12.8104 16.2781 12.7778 16.3136 12.7417 16.3451L12.712 16.3755C12.6501 16.4374 12.5766 16.4865 12.4957 16.52C12.4148 16.5535 12.3281 16.5707 12.2406 16.5707C12.153 16.5707 12.0663 16.5535 11.9854 16.52C11.9046 16.4865 11.8311 16.4374 11.7692 16.3755L9.17633 13.7826L6.05316 16.9058L5.11983 17.0925C5.09291 17.0979 5.06508 17.0965 5.03881 17.0886C5.01254 17.0806 4.98863 17.0663 4.96923 17.0469C4.94982 17.0275 4.9355 17.0036 4.92755 16.9773C4.9196 16.951 4.91827 16.9232 4.92366 16.8963L5.11033 15.963L8.23333 12.8396L5.64066 10.2471C5.57875 10.1852 5.52964 10.1117 5.49614 10.0309C5.46263 9.94997 5.44539 9.86327 5.44539 9.77572C5.44539 9.68817 5.46263 9.60148 5.49614 9.52059C5.52964 9.43971 5.57875 9.36621 5.64066 9.3043C5.65066 9.2943 5.66066 9.2843 5.67099 9.27464C5.70266 9.2383 5.73833 9.20547 5.77766 9.17664C6.57283 8.48564 7.71199 8.31564 8.90599 8.63197L12.6528 4.88497C12.7147 4.82306 12.7882 4.77395 12.8691 4.74045C12.95 4.70694 13.0367 4.6897 13.1242 4.6897C13.2118 4.6897 13.2985 4.70694 13.3794 4.74045C13.4603 4.77395 13.5338 4.82306 13.5957 4.88497L17.1312 8.42047H17.1313ZM15.7172 8.8918L13.1243 6.29914L9.56483 9.8588C9.47574 9.94788 9.36323 10.0099 9.24034 10.0376C9.11746 10.0654 8.98922 10.0578 8.87049 10.0156C8.22783 9.78764 7.63899 9.7553 7.17749 9.89814L12.1182 14.8388C12.261 14.3771 12.2287 13.7885 12.0007 13.146C11.9585 13.0272 11.9509 12.899 11.9787 12.7761C12.0064 12.6532 12.0684 12.5407 12.1575 12.4516L15.7172 8.89164V8.8918Z" fill="${eL}" fill-opacity="${wq}"/></g><defs><clipPath id="clip0"><rect width="22" height="22" fill="white"/></clipPath></defs></svg>`,width:vu,height:vu,name:"freeze",funcType:si.frozen,positionType:ri.right,marginRight:0,hover:{width:_u,height:_u,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozen(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z" fill="${eL}" fill-opacity="${xq}"/></svg>`,width:vu,height:vu,name:"frozen",funcType:si.frozen,positionType:ri.right,marginRight:0,hover:{width:_u,height:_u,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get frozenCurrent(){return{type:"svg",svg:`<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.49975 3.66663C8.32294 3.66663 8.15337 3.73686 8.02835 3.86189C7.90332 3.98691 7.83309 4.15648 7.83309 4.33329V9.63246C6.76475 10.2533 6.07942 11.1795 6.00625 12.2308C5.99892 12.2786 5.99692 12.3268 6.00009 12.3741L5.99975 12.4166C5.99975 12.5934 6.06999 12.763 6.19501 12.888C6.32004 13.0131 6.48961 13.0833 6.66642 13.0833H10.3333L10.3331 17.5L10.8611 18.292C10.8763 18.3148 10.8969 18.3335 10.9211 18.3464C10.9453 18.3594 10.9723 18.3662 10.9998 18.3662C11.0272 18.3662 11.0542 18.3594 11.0784 18.3464C11.1026 18.3335 11.1232 18.3148 11.1384 18.292L11.6664 17.5L11.6666 13.0833H15.3331C15.5099 13.0833 15.6795 13.0131 15.8045 12.888C15.9295 12.763 15.9998 12.5934 15.9998 12.4166C15.9998 12.4025 15.9998 12.3883 15.9994 12.3741C16.0028 12.3263 16.0008 12.2776 15.9933 12.2295C15.9196 11.1786 15.2343 10.2528 14.1664 9.63229V4.33329C14.1664 4.15648 14.0962 3.98691 13.9712 3.86189C13.8461 3.73686 13.6766 3.66663 13.4998 3.66663H8.49975Z"  fill="${Aq}" fill-opacity="${Mq}"/></svg>`,width:vu,height:vu,funcType:si.frozen,positionType:ri.right,name:"frozenCurrent",marginRight:0,hover:{width:_u,height:_u,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get dropdownIcon(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="white"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#959DA5"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="#4F5965"/></svg>',width:24,height:24,funcType:si.dropDown,positionType:ri.absoluteRight,name:"dropdownIcon",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)",image:'<svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g><rect x="2" y="1" width="20" height="20" rx="10" fill="#1E54C9"/><rect x="2.5" y="1.5" width="19" height="19" rx="9.5" stroke="#141414" stroke-opacity="0.2"/></g><path d="M14.9492 9.39531C15.0086 9.31911 15.0165 9.21887 14.9698 9.1356C14.923 9.05234 14.8294 9 14.7273 9L9.27273 9C9.17057 9 9.07697 9.05234 9.03023 9.1356C8.98348 9.21887 8.99142 9.31911 9.0508 9.39531L11.7781 12.8953C11.8293 12.961 11.9119 13 12 13C12.0881 13 12.1707 12.961 12.2219 12.8953L14.9492 9.39531Z" fill="white"/></svg>'},cursor:"pointer",visibleTime:"mouseenter_cell"}},get play(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="48" height="48" fill="white" fill-opacity="0.01" /><path d="M24 44C35.0457 44 44 35.0457 44 24C44 12.9543 35.0457 4 24 4C12.9543 4 4 12.9543 4 24C4 35.0457 12.9543 44 24 44Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /><path d="M20 24V17.0718L26 20.5359L32 24L26 27.4641L20 30.9282V24Z" fill="none" stroke="#686a6e" stroke-width="4" stroke-linejoin="round" stroke-opacity="0.7" /></svg>',width:24,height:24,funcType:si.play,positionType:ri.right,name:"play",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get damage_pic(){return{type:"svg",svg:'<svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5 10V38C5 39.1046 5.89543 40 7 40H14H18L15 29L22 27L21 20L29 16L27 13L30 8H7C5.89543 8 5 8.89543 5 10Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path d="M43 38V10C43 8.89543 42.1046 8 41 8H38L34 14L37 19L28 23L29 31L22 33L24 40H41C42.1046 40 43 39.1046 43 38Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5 18C15.3284 18 16 17.3284 16 16.5C16 15.6716 15.3284 15 14.5 15C13.6716 15 13 15.6716 13 16.5C13 17.3284 13.6716 18 14.5 18Z" fill="none" stroke="#333" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>',width:24,height:24,funcType:si.damagePic,positionType:ri.left,name:"damage_pic",marginRight:0,hover:{width:24,height:24,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get loading_pic(){return{type:"svg",svg:'<svg viewBox="0 0 400 300" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="a" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="50" y="65" width="301" height="170"><path d="M350.3 65H50v169.8h300.3V65Z" fill="#fff"/></mask><g mask="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M58.3 233.2h32.8v-36.8H58.3v36.8Z" fill="#C7DEFF"/><path d="M91.1 224.5v8.8H58.3M82.4 196.2H58.3" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M305.4 182.5s-2.7 12.6 0 17.4c2.7 4.8 8.3 6.7 12.4 4.4 4.2-2.4 5.3-8.1 2.6-12.9-2.7-4.8-15-8.9-15-8.9ZM336 204.7c4.3 2 9.7-.4 12-5.4 2.3-5-1.5-17.3-1.5-17.3s-11.8 5.1-14.1 10.1c-2.3 5-.7 10.6 3.6 12.6Z" fill="#00E4E5"/><path fill-rule="evenodd" clip-rule="evenodd" d="M326.7 174s-10 11.8-10 18.6c0 6.7 4.5 12.2 10 12.2s10-5.5 10-12.3c0-6.8-10-18.5-10-18.5Z" fill="#00E4E5"/><path d="M332.3 181.5c2.3 3.6 4.4 7.8 4.4 10.9M316.7 192.5c0-3.1 2.1-7.2 4.3-10.8" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M343.1 227.3v-9.7h-34v9.7c0 3.7 3 6.6 6.6 6.6h20.9c3.6 0 6.5-2.9 6.5-6.6Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M350.4 220.8V198H302v22.8c0 5.9 4.8 10.7 10.7 10.7h26.9c5.9 0 10.7-4.8 10.8-10.7Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M331.7 74.2H117.8L87.4 203h213.8l30.5-128.8Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M337 74.2h-6.2l-30.6 129.2h6.2L337 74.2Z" fill="#fff"/><path fill-rule="evenodd" clip-rule="evenodd" d="M303.8 203.5h2.4l30.7-129.3h-1.8l-31.3 129.3Z" fill="#C7DEFF"/><path d="m337 74.2-30.6 129.2h-5.9" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M229.9 202.1h-47.6l2 9.6h47.3l-1.7-9.6Z" fill="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M94.7 172.6 87.4 203h213.1l7.8-30.4H94.7Z" fill="#006EFF"/><path d="M138.5 74.2h193.2l-23.4 98.6M94.5 172.7l11-46.3M104.8 155.4l-2.3 11.5h6.7M316 112.1l1.1-4.5" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M148.3 138.1h97V119h-97v19.1Z" fill="#00E4E5"/><path d="M303.1 80.6h20.3l-4.6 19.6M228.3 234.3c3.6 0 6.3-3.2 5.7-6.8l-4.1-24.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M226.2 229.5h-68.9v1.2c0 2 1.6 3.7 3.7 3.7h60.1c2.8 0 5-2.2 5.1-4.9Z" fill="#C7DEFF"/><path d="M180.699 226.8h-19.9c-2.8 0-4.6 3-3.3 5.5m0 0c.6 1.2 1.9 2 3.3 2h57.8M175.9 203.4l3.6 17.6M241.2 234.3h65.1M104.6 234.3h41.3" stroke="#071F4D"/><path d="M206.2 234.3h14.9c3.1 0 5.5-2.8 5-5.9l-4.3-24.9M160.7 226.8h46M62.2 226.1h-9.5c-1.2 0-2.2-1-2.2-2.2v-18.3c0-1.2 1-2.2 2.2-2.2h9.5" stroke="#071F4D"/><path d="M53.4 171.7H68c2.1 0 3.7 1.7 3.7 3.7v16.1M79.1 192v-21.8c0-2.5 2-4.6 4.6-4.6h2.2c2.5 0 4.5-2 4.5-4.5m0 0c0-2.5-2-4.5-4.5-4.5H56.1c-2.4 0-4.3-1.9-4.3-4.3V148M71.2 165.2h-18M64 181.7v10.1" stroke="#C7DEFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.7 120H124c4.3 0 7.7-3.5 7.7-7.7V65.5H94.2c-4.7 0-8.5 4.9-8.5 11V120Z" fill="#C7DEFF"/><path d="M85.7 110.7V73c0-4.1 3.4-7.5 7.5-7.5h38.5M146.2 73.8v-2.5c0-3.2-2-5.8-5.8-5.8-2.8 0-6 1.1-6 5.8v42.4c0 4.7-3.8 8.5-8.5 8.5h-15.6" stroke="#071F4D"/><path d="M119.7 122.3H87c-6.1 0-11.1-5-11.1-11.1m0 0h39M126.1 122.3c-6.1 0-11.1-5-11.1-11.1" stroke="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M85.4 122.1h37.2c-6.5-1.8-8-10.5-8-10.5H76.2c.6 8.8 9.2 10.5 9.2 10.5Z" fill="#071F4D"/><path fill-rule="evenodd" clip-rule="evenodd" d="M95.8 102.9h4.8V83.6h-4.8v19.3ZM106.6 102.9h4.8V77.6h-4.8v25.3ZM117.3 102.9h4.8V89.1h-4.8v13.8Z" fill="#fff"/><path d="M273.2 195.9h16.9M261.2 195.9h5" stroke="#fff"/><path d="M62.4 201.9v2.9M62.4 224.5v2.9" stroke="#071F4D"/><path d="m153.6 138.1 9.7-19.1M168.8 138.1l9.7-19.1M184.1 138.1l9.7-19.1M199.4 138.1l9.7-19.1M214.6 138.1l9.8-19.1M229.9 138.1l9.7-19.1" stroke="#fff"/><path d="M148.3 138.1h121.6V119H148.3v19.1Z" stroke="#071F4D"/></g></svg>',width:400,height:300,name:"loading_pic",positionType:ri.left}},get expand(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M4.64988 6.81235C4.38797 6.48497 4.62106 6 5.04031 6L10.9597 6C11.3789 6 11.612 6.48497 11.3501 6.81235L8.39043 10.512C8.19027 10.7622 7.80973 10.7622 7.60957 10.512L4.64988 6.81235Z" fill="${Rq}" fill-opacity="${Bq}"/>
      </svg>`,width:rL,height:rL,funcType:si.expand,name:"expand",positionType:ri.contentLeft,marginLeft:0,marginRight:4,hover:{width:sL,height:sL,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get collapse(){return{type:"svg",svg:`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path d="M5.81235 11.3501C5.48497 11.612 5 11.3789 5 10.9597L5 5.04031C5 4.62106 5.48497 4.38797 5.81235 4.64988L9.51196 7.60957C9.76216 7.80973 9.76216 8.19027 9.51196 8.39044L5.81235 11.3501Z"  fill="${Tq}" fill-opacity="${kq}"/>
      </svg>`,width:iL,height:iL,funcType:si.collapse,name:"collapse",positionType:ri.contentLeft,marginLeft:0,marginRight:4,hover:{width:nL,height:nL,bgColor:"rgba(101, 117, 168, 0.1)"},cursor:"pointer"}},get drillDown(){return{name:"drillDown",type:"svg",positionType:ri.absolute,funcType:si.drillDown,svg:k0t,width:13,height:13,cursor:"pointer"}},get drillUp(){return{name:"drillUp",type:"svg",positionType:ri.absolute,funcType:si.drillUp,svg:R0t,width:13,height:13,cursor:"pointer"}},get dragReorder(){return{type:"svg",svg:`<svg t="1710129136961" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5166" width="200" height="200"><path d="M362.666667 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${bu}"  fill-opacity="${yu}" p-id="5167"></path><path d="M661.333333 192m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${bu}"  fill-opacity="${yu}" p-id="5168"></path><path d="M362.666667 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${bu}"  fill-opacity="${yu}" p-id="5169"></path><path d="M661.333333 512m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${bu}"  fill-opacity="${yu}" p-id="5170"></path><path d="M362.666667 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${bu}"  fill-opacity="${yu}" p-id="5171"></path><path d="M661.333333 832m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="${bu}"  fill-opacity="${yu}" p-id="5172"></path></svg>`,width:oL,height:oL,funcType:si.dragReorder,positionType:ri.left,name:"dragReorder",marginLeft:-10,marginRight:10,cursor:"grab"}}},Cyt={};function ra(){return rb(yyt,Cyt)}let De=class extends el{clear(){this.removeAllChild()}getChildByName(t,e){let i=null;return this.forEachChildren(r=>r.name===t&&(i=r,!0)),e&&this.forEachChildren(r=>{if(r.getChildByName){const s=r.getChildByName(t,!0);if(s)return i=s,!0}return!1}),i}get width(){var t;let e=this.AABBBounds.width();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,(t=this.attribute.width)!==null&&t!==void 0?t:0)}get height(){var t;let e=this.AABBBounds.height();return e!==1/0&&e!==-1/0||(e=0),Math.max(e,(t=this.attribute.height)!==null&&t!==void 0?t:0)}setDeltaWidth(t){var e;t!==0&&(this.setAttribute("width",((e=this.attribute.width)!==null&&e!==void 0?e:0)+t),this.border&&(this.border.setAttribute("width",this.border.attribute.width+t),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.width+t)))}setDeltaHeight(t){var e;t!==0&&(this.setAttribute("height",((e=this.attribute.height)!==null&&e!==void 0?e:0)+t),this.border&&(this.border.setAttribute("height",this.border.attribute.height+t),this.border.type==="group"&&this.border.firstChild.setAttribute("width",this.border.firstChild.attribute.height+t)))}setDeltaX(t){t!==0&&this.setAttribute("x",this.attribute.x+t)}setDeltaY(t){t!==0&&this.setAttribute("y",this.attribute.y+t)}forEachChildrenSkipChild(t,e="border-rect",i=!1){if(i){let r=this._lastChild,s=0;for(;r;){if(r.name!==e&&t(r,s++))return;r=r._prev}}else{let r=this._firstChild,s=0;for(;r;){if(r.name!==e&&t(r,s++))return;r=r._next}}}getColGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.col===t)return e;e=e._next}return null}getRowGroup(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<this.childrenCount;i++){if(e.row===t)return e;e=e._next}return null}addCellGroup(t){if(this.childrenCount===0||this.lastChild.row===t.row-1)this.addChild(t);else{let e=this._firstChild;for(let i=0;i<this.childrenCount;i++){if(e.row===t.row-1)return void this.insertAfter(t,e);e=e._next}this.addChild(t)}}getChildAt(t){const e=super.getChildAt(t);return e&&e.name==="border-rect"?e._next:e}tryUpdateAABBBounds(){if(this.role==="cell"){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),Syt(this,t),e}return super.tryUpdateAABBBounds()}doUpdateAABBBounds(){if(this.role==="cell"){const t=this.attribute,{x:e,y:i,width:r,height:s}=t;return this._AABBBounds.setValue(e,i,e+r,i+s),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds}return this.role==="body"||this.role==="row-header"||this.role==="col-header"||this.role==="right-frozen"||this.role==="bottom-frozen"||this.role==="corner-header"||this.role==="corner-right-top-header"||this.role==="corner-right-bottom-header"||this.role==="corner-left-bottom-header"?(this._AABBBounds.setValue(-1/0,-1/0,1/0,1/0),this.parent&&this.parent.addChildUpdateBoundTag(),this.clearUpdateBoundTag(),this.shadowRoot&&this.shadowRoot.tryUpdateAABBBounds(),this._AABBBounds):super.doUpdateAABBBounds()}updateColumnRowNumber(t){this.rowNumber?this.rowNumber=Math.max(this.rowNumber,t):this.rowNumber=t}updateColumnHeight(t){this.colHeight?this.colHeight+=t:this.colHeight=t}};function Syt(n,t){n.stage&&n.stage.dirtyBounds&&n.stage.renderCount&&(n.isContainer&&!t||n.stage.dirty(n.globalAABBBounds))}function wM(n,t,e,i){const r=n/t;let s,o;return r>e/i?(s=e,o=s/r,(i-o)/2):(o=i,s=o*r,(e-s)/2),{width:s,height:o}}function aD(n,t,e,i,r,s,o="left",a="middle",l=[0,0,0,0],h=0,d=0,u=0,c=0){const g=n+e,p=t+i;let f=n+l[3]+h;o==="right"||o==="end"?f=g-r-l[1]-d:o==="center"&&(f=n+(e-r+h-d)/2);let m=t+l[0]+u;return a==="bottom"||a==="alphabetic"||a==="ideographic"?m=p-s-l[2]-c:a==="middle"&&(m=t+(i-s+u-c)/2),{x:f,y:m}}function Mt(n,t,e,i,r){const s=t&&L(t[n])?t[n]:void 0;return typeof s=="function"?s({col:e,row:i,table:r,value:r.getCellValue(e,i),dataValue:r.getCellOriginValue(e,i),cellHeaderPaths:r.getCellHeaderPaths(e,i)}):s}function AM(n,t,e,i,r){const s=t&&L(t[n])?t[n]:void 0;if(typeof s=="function")return s({col:e,row:i,table:r,value:r.getCellValue(e,i),dataValue:r.getCellOriginValue(e,i),cellHeaderPaths:r.getCellHeaderPaths(e,i)})}function ol(n,t,e,i){var r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C;let S=(s=(r=e==null?void 0:e.group)===null||r===void 0?void 0:r.strokeArrayWidth)!==null&&s!==void 0?s:void 0;return i.theme.cellInnerBorder||!$_t(i.theme.frameStyle.borderLineWidth)||V_t(i.theme.frameStyle.borderLineWidth)||(n===0&&(S=S??[(o=e==null?void 0:e.group)===null||o===void 0?void 0:o.lineWidth,(a=e==null?void 0:e.group)===null||a===void 0?void 0:a.lineWidth,(l=e==null?void 0:e.group)===null||l===void 0?void 0:l.lineWidth,(h=e==null?void 0:e.group)===null||h===void 0?void 0:h.lineWidth],S[3]=0),n===i.colCount-1&&(S=S??[(d=e==null?void 0:e.group)===null||d===void 0?void 0:d.lineWidth,(u=e==null?void 0:e.group)===null||u===void 0?void 0:u.lineWidth,(c=e==null?void 0:e.group)===null||c===void 0?void 0:c.lineWidth,(g=e==null?void 0:e.group)===null||g===void 0?void 0:g.lineWidth],S[1]=0),t===0&&(S=S??[(p=e==null?void 0:e.group)===null||p===void 0?void 0:p.lineWidth,(f=e==null?void 0:e.group)===null||f===void 0?void 0:f.lineWidth,(m=e==null?void 0:e.group)===null||m===void 0?void 0:m.lineWidth,(v=e==null?void 0:e.group)===null||v===void 0?void 0:v.lineWidth],S[0]=0),t===i.rowCount-1&&(S=S??[(_=e==null?void 0:e.group)===null||_===void 0?void 0:_.lineWidth,(b=e==null?void 0:e.group)===null||b===void 0?void 0:b.lineWidth,(y=e==null?void 0:e.group)===null||y===void 0?void 0:y.lineWidth,(C=e==null?void 0:e.group)===null||C===void 0?void 0:C.lineWidth],S[2]=0)),S}class xyt extends De{constructor(t){super(t),this._autoWidth=!1,this._autoHeight=!1,this._leftGroup=new De({pickable:!1,fill:!1,stroke:!1}),this._leftGroup.role="content-left",this._rightGroup=new De({pickable:!1,fill:!1,stroke:!1}),this._rightGroup.role="content-right",this._centerGroup=new De({pickable:!1,fill:!1,stroke:!1}),this._centerGroup.role="content-center",this.appendChild(this._leftGroup),this.appendChild(this._rightGroup),this.appendChild(this._centerGroup)}setCellContentOption(t){this._autoWidth=t.autoWidth,this._autoHeight=t.autoHeight,this._cellWidth=t.cellWidth,this._originCellWidth=t.cellWidth,this._cellHeight=t.cellHeight,this._align=t.align,this._baseline=t.baseline}addLeftOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._leftGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._leftGroup.appendChild(t),this._leftGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addRightOccupyingIcon(t){var e,i,r;t.setAttribute("x",this._rightGroup.width+((e=t.attribute.marginLeft)!==null&&e!==void 0?e:0)),this._rightGroup.appendChild(t),this._rightGroup.setDeltaWidth(((i=t.attribute.marginLeft)!==null&&i!==void 0?i:0)+((r=t.attribute.marginRight)!==null&&r!==void 0?r:0)+t.attribute.width)}addContent(t){const e=this._centerGroup.lastChild;e&&t.setAttributes({x:e.attribute.x+e.AABBBounds.width()}),this._centerGroup.appendChild(t),t instanceof Wn&&(this._centerGroup.setAttribute("pickable",!1),t.setAttribute("textAlign","left"))}layout(){let t=this._leftGroup.width;t===1/0&&(t=0);let e=this._rightGroup.width;if(e===-1/0&&(e=0),this._autoWidth){const o=this._centerGroup.width;this._cellWidth=t+e+o,this.setAttribute("width",this._cellWidth)}else{const o=this._cellWidth-t-e;this.updateCenterLayout(o);const a=this._centerGroup.width;this._cellWidth=t+e+a,this.setAttribute("width",this._cellWidth)}this.updateHorizontalPos();const i=this._leftGroup.height,r=this._rightGroup.height,s=this._centerGroup.height;this._cellHeight=Math.max(i,r,s),this.setAttribute("height",this._cellHeight),this.updateVerticalPos()}updateCenterLayout(t){let e=t;this._centerGroup.forEachChildren(s=>{(s instanceof vc||s instanceof yq)&&(e-=s.AABBBounds.width())});const i=this._centerGroup.getChildByName("text");i instanceof Wd?i.setAttribute("width",e):i instanceof Wn&&i.setAttribute("maxLineWidth",e);let r=0;this._centerGroup.forEachChildren(s=>{s.setAttribute("x",r),r+=s.AABBBounds.width()})}updateHorizontalPos(){this._leftGroup.setAttribute("x",0),this._rightGroup.setAttribute("x",this._cellWidth-this._rightGroup.width),this._centerGroup.setAttribute("x",this._leftGroup.width),this._align==="left"||this._align==="start"?this.setAttribute("dx",0):this._align==="center"?this.setAttribute("dx",-this.attribute.width/2):this._align!=="right"&&this._align!=="end"||this.setAttribute("dx",-this.attribute.width)}updateVerticalPos(){this._baseline==="top"?(this._leftGroup.setAttribute("y",0),this._rightGroup.setAttribute("y",0),this._centerGroup.setAttribute("y",0)):this._baseline==="middle"?(this._leftGroup.forEachChildren(t=>{t.setAttribute("y",(this._leftGroup.height-t.AABBBounds.height())/2)}),this._rightGroup.forEachChildren(t=>{t.setAttribute("y",(this._rightGroup.height-t.AABBBounds.height())/2)}),this._leftGroup.setAttribute("y",this._cellHeight/2-this._leftGroup.height/2),this._rightGroup.setAttribute("y",this._cellHeight/2-this._rightGroup.height/2),this._centerGroup.setAttribute("y",this._cellHeight/2-this._centerGroup.height/2)):this._baseline==="bottom"&&(this._leftGroup.forEachChildren(t=>{t.setAttribute("y",this._leftGroup.height-t.AABBBounds.height())}),this._rightGroup.forEachChildren(t=>{t.setAttribute("y",this._rightGroup.height-t.AABBBounds.height())}),this._leftGroup.setAttribute("y",this._cellHeight-this._leftGroup.height),this._rightGroup.setAttribute("y",this._cellHeight-this._rightGroup.height),this._centerGroup.setAttribute("y",this._cellHeight-this._centerGroup.height))}updateWidth(t){this._cellWidth=t,this._originCellWidth=t,this.layout()}updateHeight(t){this._cellHeight=t,this._cellWidth=this._originCellWidth;const e=this.getChildByName("text",!0);e&&e.setAttribute("heightLimit",t),this.layout()}}function Hs(n,t,e){var i,r,s,o,a;let l=0;const h=e.internalProps.layoutMap;if(h.isHeader(n,t)){const d=h.getHeader(n,t);L(d==null?void 0:d.hierarchyLevel)&&(l=((i=d.hierarchyLevel)!==null&&i!==void 0?i:0)*(h.rowHierarchyType==="tree"&&(r=h.rowHierarchyIndent)!==null&&r!==void 0?r:0),h.rowHierarchyTextStartAlignment&&!e.internalProps.headerHelper.getHierarchyIcon(n,t)&&(l+=e.internalProps.headerHelper.getHierarchyIconWidth()))}else if(e.options.groupBy||!((s=e.getBodyColumnDefine(n,t))===null||s===void 0)&&s.tree){const d=e.dataSource.getIndexKey(e.getRecordShowIndexByCell(n,t)),u=(o=e.dataSource.getGroupLength())!==null&&o!==void 0?o:0;let c=V(d)?d.length-1:0;u>0&&c===u&&(c=0),l=Array.isArray(d)&&e.getHierarchyState(n,t)!==se.none?c*((a=h.hierarchyIndent)!==null&&a!==void 0?a:0):0,h.hierarchyTextStartAlignment&&!e.internalProps.bodyHelper.getHierarchyIcon(n,t)&&(l+=e.internalProps.bodyHelper.getHierarchyIconWidth())}return l}function G_(n,t){var e,i;let r,s=!1;for(yt(n)&&n.length>(t.options.maxCharactersNumber||200)&&(n=n.slice(0,t.options.maxCharactersNumber||200),n+="",s=!0),r=t.internalProps.enableLineBreak||!((e=t.options.customConfig)===null||e===void 0)&&e.multilinesForXTable?qj(n).replace(/\r?\n/g,`
`).replace(/\r/g,`
`).split(`
`)||[]:[qj(n)];r.length&&r.length>1&&!r[r.length-1];)r.pop();if(!((i=t.options.customConfig)===null||i===void 0)&&i.multilinesForXTable&&!t.internalProps.autoWrapText)for(;r.length&&r.length>1&&!r[0];)r.shift();return{text:r,moreThanMaxCharacters:s}}function wyt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){var f,m,v,_,b,y,C,S,w;let x,A=0,M=0,T=0;if(Array.isArray(t)&&t.length!==0){const{inlineFrontIcons:E,inlineEndIcons:k,contentLeftIcons:P,contentRightIcons:I,leftIconWidth:O,rightIconWidth:H,absoluteRightIconWidth:z}=Ff(t,n,p,c);let F;if(A=O,M=H,T=z,E.length===0&&k.length===0){let j=0;J(c.theme._contentOffset)&&(d==="left"?j=c.theme._contentOffset:d==="right"&&(j=-c.theme._contentOffset));const $=p?Hs(p.start.col,p.start.row,c):Hs(n.col,n.row,c),{text:Y,moreThanMaxCharacters:G}=G_(e,c),tt={text:Y.length===1?Y[0]:Y,moreThanMaxCharacters:G,maxLineWidth:r?1/0:l-(i[1]+i[3])-A-M-$,textBaseline:"top",heightLimit:((_=c.options.customConfig)===null||_===void 0?void 0:_.limitContentHeight)===!1||s&&!(!((b=c.options.customConfig)===null||b===void 0)&&b.multilinesForXTable)?-1:h-Math.floor(i[0]+i[2]),pickable:!1,autoWrapText:o,lineClamp:a,wordBreak:"break-word",whiteSpace:((y=c.options.customConfig)===null||y===void 0?void 0:y.limitContentHeight)===!1||Y.length!==1||o?"normal":"no-wrap",dx:(d==="left"?P.length?0:$:0)+j,keepCenterInLine:!0},st=new Wn(g.text?Object.assign({},g.text,tt):tt);st.name="text",F=st}else{const j=Object.assign({text:e==null?void 0:e.toString()},((w=(S=(C=n.parent)===null||C===void 0?void 0:C.theme)===null||S===void 0?void 0:S.userTheme)===null||w===void 0?void 0:w.text)||{});g.text&&Object.assign(j,g.text),j.textBaseline="middle";const $=[...E.map(G=>_x(G)),j,...k.map(G=>_x(G))];$[0].textAlign=d;const Y=new Wd({width:r?0:l-(i[1]+i[3])-A-M,height:s&&o?0:Math.ceil(h-(i[0]+i[2])),textConfig:$,verticalDirection:s&&o?"top":u,ellipsis:j.ellipsis});Y.name="text",F=Y,Y.bindIconEvent(),!p||p.start.col===p.end.col&&p.start.row===p.end.row||(Y.onBeforeAttributeUpdate=Myt)}if(P.length!==0||I.length!==0){const j=new xyt({x:0,y:0,fill:!1,stroke:!1,pickable:!1});j.name="content",j.setCellContentOption({autoWidth:r,autoHeight:s,cellWidth:l-(i[1]+i[3])-A-M,cellHeight:h-(i[0]+i[2]),align:d,baseline:u});const $={addedHierarchyOffset:0};P.forEach(Y=>{const G=co(Y,void 0,n.col,n.row,p,c,$);G.role="icon-content-left",G.name=Y.name,j.addLeftOccupyingIcon(G)}),I.forEach(Y=>{const G=co(Y,void 0,n.col,n.row,p,c,$);G.role="icon-content-right",G.name=Y.name,j.addRightOccupyingIcon(G)}),j.addContent(F),n.appendChild(j),j.layout(),x=j.AABBBounds.width(),j.AABBBounds.height()}else n.firstChild?n.insertBefore(F,n.firstChild):n.appendChild(F),x=F.AABBBounds.width(),F.AABBBounds.height()}else if(L(e)){const{text:E,moreThanMaxCharacters:k}=G_(e,c),P=p?Hs(p.start.col,p.start.row,c):Hs(n.col,n.row,c);let I=0;J(c.theme._contentOffset)&&(d==="left"?I=c.theme._contentOffset:d==="right"&&(I=-c.theme._contentOffset));const O={text:E.length===1?E[0]:E,moreThanMaxCharacters:k,maxLineWidth:r?1/0:l-(i[1]+i[3]+P),textBaseline:"top",autoWrapText:o,lineClamp:a,wordBreak:"break-word",heightLimit:((f=c.options.customConfig)===null||f===void 0?void 0:f.limitContentHeight)===!1||s&&!(!((m=c.options.customConfig)===null||m===void 0)&&m.multilinesForXTable)?-1:h-Math.floor(i[0]+i[2]),pickable:!1,dx:(d==="left"?P:0)+I,whiteSpace:((v=c.options.customConfig)===null||v===void 0?void 0:v.limitContentHeight)===!1||E.length!==1||o?"normal":"no-wrap",keepCenterInLine:!0},H=new Wn(g.text?Object.assign({},g.text,O):O);H.name="text",H.textBaseline=u,n.appendChild(H),x=H.AABBBounds.width(),H.AABBBounds.height()}const R=r?A+x+M:l-(i[1]+i[3]),B=h-(i[0]+i[2]);n.forEachChildren(E=>{E.role==="icon-left"?E.setAttribute("x",E.attribute.x+i[3]):E.role==="icon-right"?E.setAttribute("x",E.attribute.x+R-M+i[3]):E.role==="icon-absolute-right"?E.setAttribute("x",E.attribute.x+R-T+i[3]+i[1]):E.name!=="content"&&E.name!=="text"||(d==="center"&&E.type!=="richtext"?E.setAttribute("x",i[3]+A+(R-A-M)/2):d==="right"&&E.type!=="richtext"?E.setAttribute("x",i[3]+R-M):E.setAttribute("x",i[3]+A))}),n.forEachChildren(E=>{E.name!==qa&&(u==="middle"?E.setAttribute("y",i[0]+(B-E.AABBBounds.height())/2):u==="bottom"?E.setAttribute("y",i[0]+B-E.AABBBounds.height()):E.setAttribute("y",i[0]))}),n.setAttributes({width:R+i[1]+i[3],height:B+i[0]+i[2]})}function co(n,t,e,i,r,s,o){var a,l,h,d,u,c;const g={};n.type==="image"?(n.isGif&&(g.gif=n.src),g.image=n.src):(n.type==="svg"||"svg"in n)&&(g.image=n.svg),g.width=n.width,g.height=n.height,g.visibleTime=(a=n.visibleTime)!==null&&a!==void 0?a:"always",g.funcType=n.funcType,g.interactive=n.interactive,g.isGif=n.isGif;let p,f=0;return o&&(o==null?void 0:o.addedHierarchyOffset)!==0||!J(e)||!J(i)||!s||n.funcType!==si.collapse&&n.funcType!==si.expand&&n.positionType!==ri.contentLeft&&n.positionType!==ri.contentRight||(f=r?Hs(r.start.col,r.start.row,s):Hs(e,i,s),o&&(o.addedHierarchyOffset=1)),g.marginLeft=((l=n.marginLeft)!==null&&l!==void 0?l:0)+f,g.marginRight=(h=n.marginRight)!==null&&h!==void 0?h:0,n.interactive===!1&&(g.pickable=!1),n.hover&&(g.backgroundWidth=(d=n.hover.width)!==null&&d!==void 0?d:n.width,g.backgroundHeight=(u=n.hover.width)!==null&&u!==void 0?u:n.width,g.backgroundColor=(c=n.hover.bgColor)!==null&&c!==void 0?c:"rgba(22,44,66,0.2)",g.hoverImage=n.hover.image),n.cursor&&(g.cursor=n.cursor),"shape"in n&&n.shape==="circle"&&(g.shape=n.shape),t?(t.setAttributes(g),t.loadImage(g.image),t.tooltip=n.tooltip,t.name=n.name,t):(n.type==="text"?(g.text=n.content,Z(g,n.style),p=new yq(g),p.tooltip=n.tooltip,p.name=n.name):(p=new vc(g),p.tooltip=n.tooltip,p.name=n.name),p)}function _x(n){var t,e,i,r,s,o;const a={};return n.type==="image"?a.image=n.src:(n.type==="svg"||"svg"in n)&&(a.image=n.svg),a.visibleTime=(t=n.visibleTime)!==null&&t!==void 0?t:"always",a.funcType=n.funcType,a.id=n.name,a.width=n.width,a.height=n.height,(n.marginRight||n.marginLeft)&&(a.margin=[0,(e=n.marginRight)!==null&&e!==void 0?e:0,0,(i=n.marginLeft)!==null&&i!==void 0?i:0]),n.hover&&(a.backgroundWidth=(r=n.hover.width)!==null&&r!==void 0?r:n.width,a.backgroundHeight=(s=n.hover.height)!==null&&s!==void 0?s:n.height,a.backgroundShowMode="hover",a.hoverImage=n.hover.image,a.backgroundStroke=!1,a.backgroundFill=(o=n.hover.bgColor)!==null&&o!==void 0?o:"rgba(22,44,66,0.2)"),n.cursor&&(a.cursor=n.cursor),a.tooltip=n.tooltip,a}function bx(n,t,e,i,r,s,o,a,l){var h,d,u,c;et(n.contentWidth)&&(i=t-((h=n.contentWidth)!==null&&h!==void 0?h:n.attribute.width));let g,p=0,f=0,m=0,v=0;n.forEachChildren(S=>{var w,x,A,M;S.role==="icon-left"?(p+=S.AABBBounds.width()+((w=S.attribute.marginLeft)!==null&&w!==void 0?w:0)+((x=S.attribute.marginRight)!==null&&x!==void 0?x:0),f=Math.max(f,S.AABBBounds.height())):S.role==="icon-right"&&(m+=S.AABBBounds.width()+((A=S.attribute.marginLeft)!==null&&A!==void 0?A:0)+((M=S.attribute.marginRight)!==null&&M!==void 0?M:0),v=Math.max(v,S.AABBBounds.height()))});const _=n.getChildByName("text"),b=n.getChildByName("content");let y;_ instanceof Wn?(g=_.AABBBounds.height(),_.setAttribute("maxLineWidth",t-p-m-(s[1]+s[3])-((d=_.attribute.dx)!==null&&d!==void 0?d:0)-((u=l.table.theme._contentOffset)!==null&&u!==void 0?u:0)),y=_.AABBBounds.height()):_ instanceof Wd?(g=_.AABBBounds.height(),_.setAttribute("width",t-p-m-(s[1]+s[3])),y=_.AABBBounds.height()):b&&(g=b.AABBBounds.height(),b.updateWidth(t-p-m-(s[1]+s[3])),y=b.AABBBounds.height());const C=Math.round(Math.max(f,v,g)+s[0]+s[2]);if(n.forEachChildren(S=>{var w;if(S.role!=="icon-left")if(S.role==="icon-right")S.setAttribute("x",S.attribute.x+i);else if(S.role==="icon-absolute-right")S.setAttribute("x",S.attribute.x+i);else if(S.name==="content"||S.name==="text"&&S.type!=="richtext"){const x=(w=S.attribute.textAlign)!==null&&w!==void 0?w:o;x==="center"?S.setAttribute("x",s[3]+p+(t-(s[1]+s[3])-p-m)/2):x==="right"&&S.setAttribute("x",s[3]+t-(s[1]+s[3])-m)}else S.name==="mark"&&S.setAttribute("x",n.attribute.width)}),r){let S=Math.max(f,y,v);if(Ayt(l,n,Math.round(S+s[0]+s[2]),C))return!0;S=((c=n.contentHeight)!==null&&c!==void 0?c:e)-(s[0]+s[2]),n.forEachChildren(w=>{w.type!=="rect"&&w.type!=="chart"&&w.name!==qa&&(w.name==="mark"?w.setAttribute("y",0):a==="middle"?w.setAttribute("y",s[0]+(S-w.AABBBounds.height())/2):a==="bottom"?w.setAttribute("y",s[0]+S-w.AABBBounds.height()):w.setAttribute("y",s[0]))})}else a!=="middle"&&a!=="bottom"||n.forEachChildren(S=>{S.type!=="rect"&&S.type!=="chart"&&S.name!==qa&&(S.name==="mark"?S.setAttribute("y",0):a==="middle"?S.setAttribute("y",(e-s[2]+s[0]-S.AABBBounds.height())/2):a==="bottom"?S.setAttribute("y",e-S.AABBBounds.height()-s[2]):S.setAttribute("y",s[0]))});return!1}function yx(n,t,e,i,r,s,o,a){var l;const h=t-Math.floor(r[0]+r[2]),d=n.getChildByName("text");d instanceof Wn&&!i?d.setAttributes({heightLimit:((l=a.options.customConfig)===null||l===void 0?void 0:l.limitContentHeight)===!1?-1:h}):d instanceof Wd&&!i?d.setAttributes({height:h}):n.getChildByName("content")&&n.getChildByName("content").updateHeight(h),n.forEachChildren(u=>{u.setAttribute("dy",0),u.type==="rect"||u.type==="chart"||u.name===qa||(u.name==="mark"?u.setAttribute("y",0):o==="middle"?u.setAttribute("y",r[0]+(h-u.AABBBounds.height())/2):o==="bottom"?u.setAttribute("y",r[0]+h-u.AABBBounds.height()):u.setAttribute("y",r[0]))})}function Ayt(n,t,e,i){const r=n.table,s=un(r,t.col,t.row);if(s&&s.end.row-s.start.row){i/=s.end.row-s.start.row+1,e/=s.end.row-s.start.row+1;for(let o=s.start.row;o<=s.end.row;o++){const a=r.getRowHeight(o);if(a===i&&e!==a||e>a)return!0}}else{const o=r.getRowHeight(t.row);if(o===i&&e!==o||e>o)return!0}return!1}function Ff(n,t,e,i){const r=[],s=[],o=[],a=[],l=[],h=[],d=[],u=[];let c=0,g=0,p=0,f=0,m=0,v=0;return n.forEach(_=>{switch(_.positionType){case ri.left:r.push(_);break;case ri.right:s.push(_);break;case ri.contentLeft:o.push(_);break;case ri.contentRight:a.push(_);break;case ri.absoluteRight:u.push(_);break;case ri.inlineFront:l.push(_);break;case ri.inlineEnd:h.push(_)}}),r.forEach(_=>{var b,y,C;const S=co(_,void 0,t.col,t.row,e,i);S.role="icon-left",S.name=_.name,S.setAttribute("x",c+((b=S.attribute.marginLeft)!==null&&b!==void 0?b:0)),c+=S.AABBBounds.width()+((y=S.attribute.marginLeft)!==null&&y!==void 0?y:0)+((C=S.attribute.marginRight)!==null&&C!==void 0?C:0),g=Math.max(g,S.AABBBounds.height()),t.appendChild(S)}),s.forEach(_=>{var b,y,C;const S=co(_,void 0,t.col,t.row,e,i);S.role="icon-right",S.name=_.name,S.setAttribute("x",p+((b=S.attribute.marginLeft)!==null&&b!==void 0?b:0)),p+=S.AABBBounds.width()+((y=S.attribute.marginLeft)!==null&&y!==void 0?y:0)+((C=S.attribute.marginRight)!==null&&C!==void 0?C:0),f=Math.max(f,S.AABBBounds.height()),t.appendChild(S)}),d.forEach(_=>{var b,y,C;const S=co(_,void 0,t.col,t.row,e,i);S.role="icon-absolute-left",S.name=_.name,S.setAttribute("x",m+((b=S.attribute.marginLeft)!==null&&b!==void 0?b:0)),m+=S.AABBBounds.width()+((y=S.attribute.marginLeft)!==null&&y!==void 0?y:0)+((C=S.attribute.marginRight)!==null&&C!==void 0?C:0),t.appendChild(S)}),u.forEach(_=>{var b,y,C;const S=co(_,void 0,t.col,t.row,e,i);S.role="icon-absolute-right",S.name=_.name,S.setAttribute("x",v+((b=S.attribute.marginLeft)!==null&&b!==void 0?b:0)),v+=S.AABBBounds.width()+((y=S.attribute.marginLeft)!==null&&y!==void 0?y:0)+((C=S.attribute.marginRight)!==null&&C!==void 0?C:0),t.appendChild(S)}),{leftIcons:r,rightIcons:s,contentLeftIcons:o,contentRightIcons:a,inlineFrontIcons:l,inlineEndIcons:h,absoluteLeftIcons:d,absoluteRightIcons:u,leftIconWidth:c,leftIconHeight:g,rightIconWidth:p,rightIconHeight:f,absoluteLeftIconWidth:m,absoluteRightIconWidth:v}}function Myt(n,t){if(n.hasOwnProperty("hoverIconId")){const e=this;if(e.skipMergeUpdate)return;const i=_c(e);if(!i||!i.stage)return;const r=i.stage.table;e.skipAttributeUpdate=!0;const{mergeStartCol:s,mergeEndCol:o,mergeStartRow:a,mergeEndRow:l}=i;if(L(s)&&L(o)&&L(a)&&L(l)&&(s!==o||a!==l)){for(let h=s;h<=o;h++)for(let d=a;d<=l;d++){if(h===i.col&&d===i.row){if(n.hoverIconId!==e.attribute.hoverIconId){const c=e._frameCache.icons.get(n.hoverIconId);e.updateHoverIconState(c)}continue}const u=r.scenegraph.highPerformanceGetCell(h,d);if(u.role==="cell"){const c=u.getChildByName(e.name,!0);if(!c||c.skipAttributeUpdate)continue;n.hoverIconId!==c.attribute.hoverIconId&&(c.setAttribute("hoverIconId",n.hoverIconId),u.addUpdateBoundTag())}}e.skipAttributeUpdate=void 0}}}function Tyt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m){var v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G,tt,st,ot,rt,pt;const at=g._getCellStyle(i,r),W=AM("padding",at,i,r,g);!((v=g.options.customConfig)===null||v===void 0)&&v.imageMargin?h=Be((_=g.options.customConfig)===null||_===void 0?void 0:_.imageMargin):L(W)&&(h=W),!((b=p==null?void 0:p.text)===null||b===void 0)&&b.textAlign&&(d=(y=p==null?void 0:p.text)===null||y===void 0?void 0:y.textAlign),!((C=p==null?void 0:p.text)===null||C===void 0)&&C.textBaseline&&(u=(S=p==null?void 0:p.text)===null||S===void 0?void 0:S.textBaseline);const N=ol(i,r,p,g);let K,nt;if(m&&(K=g.scenegraph.highPerformanceGetCell(i,r,!0),K&&K.role==="cell"&&K.setAttributes({x:t,y:e,width:s,height:o,lineWidth:(x=(w=p==null?void 0:p.group)===null||w===void 0?void 0:w.lineWidth)!==null&&x!==void 0?x:void 0,fill:(M=(A=p==null?void 0:p.group)===null||A===void 0?void 0:A.fill)!==null&&M!==void 0?M:void 0,stroke:(R=(T=p==null?void 0:p.group)===null||T===void 0?void 0:T.stroke)!==null&&R!==void 0?R:void 0,strokeArrayWidth:N??void 0,strokeArrayColor:(E=(B=p==null?void 0:p.group)===null||B===void 0?void 0:B.strokeArrayColor)!==null&&E!==void 0?E:void 0,cursor:(P=(k=p==null?void 0:p.group)===null||k===void 0?void 0:k.cursor)!==null&&P!==void 0?P:void 0,lineDash:(O=(I=p==null?void 0:p.group)===null||I===void 0?void 0:I.lineDash)!==null&&O!==void 0?O:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),K&&K.role==="cell"||(K=new De({x:t,y:e,width:s,height:o,lineWidth:(z=(H=p==null?void 0:p.group)===null||H===void 0?void 0:H.lineWidth)!==null&&z!==void 0?z:void 0,fill:(j=(F=p==null?void 0:p.group)===null||F===void 0?void 0:F.fill)!==null&&j!==void 0?j:void 0,stroke:(Y=($=p==null?void 0:p.group)===null||$===void 0?void 0:$.stroke)!==null&&Y!==void 0?Y:void 0,strokeArrayWidth:N??void 0,strokeArrayColor:(tt=(G=p==null?void 0:p.group)===null||G===void 0?void 0:G.strokeArrayColor)!==null&&tt!==void 0?tt:void 0,cursor:(ot=(st=p==null?void 0:p.group)===null||st===void 0?void 0:st.cursor)!==null&&ot!==void 0?ot:void 0,lineDash:(pt=(rt=p==null?void 0:p.group)===null||rt===void 0?void 0:rt.lineDash)!==null&&pt!==void 0?pt:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),K.role="cell",K.col=i,K.row=r,n==null||n.addCellGroup(K)),c){let ut=i,lt=r;f&&(ut=f.start.col,lt=f.start.row),nt=g.getCellIcons(ut,lt)}let X=0,ht=0,_t=0;if(Array.isArray(nt)&&nt.length!==0){const{leftIconWidth:ut,rightIconWidth:lt,absoluteRightIconWidth:At}=Ff(nt,K,f,g);X=ut+lt,ht=ut,_t=lt,K.forEachChildren(ft=>{ft.role==="icon-left"?ft.setAttribute("x",ft.attribute.x+h[3]):ft.role==="icon-right"?ft.setAttribute("x",ft.attribute.x+s-lt-h[1]):ft.role==="icon-absolute-right"&&ft.setAttribute("x",ft.attribute.x+s-At-h[1])}),K.forEachChildren(ft=>{u==="middle"?ft.setAttribute("y",(o-ft.AABBBounds.height())/2):u==="bottom"?ft.setAttribute("y",o-ft.AABBBounds.height()-h[2]):ft.setAttribute("y",h[0])}),K._cellLeftIconWidth=ht,K._cellRightIconWidth=_t}const ct=g.getCellValue(i,r),U=oM({x:h[3],y:h[0],width:s-h[1]-h[3]-X,height:o-h[0]-h[2],image:ct,cursor:"pointer"});return U.name="image",U.keepAspectRatio=a,U.textAlign=d,U.textBaseline=u,a||l?U.resources&&U.resources.has(U.attribute.image)&&U.resources.get(U.attribute.image).state==="success"?(U.setAttribute("opacity",0),setTimeout(()=>{U.setAttribute("opacity",1),uN(l,a,h,d,u,U,K,g),g.scenegraph.updateNextFrame()},0)):U.successCallback=()=>{uN(l,a,h,d,u,U,K,g),g.scenegraph.updateNextFrame()}:U.resources&&U.resources.has(U.attribute.image)&&U.resources.get(U.attribute.image).state==="success"?U_(K,i,r,0,0,g):U.successCallback=()=>{U_(K,i,r,0,0,g)},U.failCallback=()=>{const ut=ra();U.image=ut.damage_pic.svg},K.appendChild(U),K}function Pq(n,t,e,i,r,s,o){let a=!1,l=null,h=null;const{width:d,height:u,isMerge:c}=sf(o,r.table);if(d<e+s[1]+s[3]&&(l=e+s[1]+s[3],a=!0),u<i+s[2]+s[0]&&(h=i+s[2]+s[0],a=!0),a){if(typeof l=="number")if(c)for(let g=o.mergeStartCol;g<=o.mergeEndCol;g++)r.setColWidth(g,l/(o.mergeEndCol-o.mergeStartCol+1));else r.setColWidth(n,l);if(typeof h=="number")if(c)for(let g=o.mergeStartRow;g<=o.mergeEndRow;g++)r.setRowHeight(g,h/(o.mergeEndRow-o.mergeStartRow+1));else r.setRowHeight(t,h);return r.component.updateScrollBar(),!0}return!1}function U_(n,t,e,i,r,s){var o,a,l,h,d,u,c,g,p,f,m,v;const _=n.getChildByName("image");if(!_)return;const b=typeof _.attribute.image!="string"&&_.attribute.image||((o=_.resources)===null||o===void 0?void 0:o.get(_.attribute.image).data);if(!b)return;const y=s._getCellStyle(t,e),C=(a=Mt("textAlign",y,t,e,s))!==null&&a!==void 0?a:"left",S=(l=Mt("textBaseline",y,t,e,s))!==null&&l!==void 0?l:"middle";let w;w=!((h=s.options.customConfig)===null||h===void 0)&&h.imageMargin?Be((d=s.options.customConfig)===null||d===void 0?void 0:d.imageMargin):(u=Be(Mt("padding",y,t,e,s)))!==null&&u!==void 0?u:[0,0,0,0];const{width:x,height:A,isMerge:M}=sf(n,s),T=(c=n.mergeStartCol)!==null&&c!==void 0?c:n.col,R=(g=n.mergeStartRow)!==null&&g!==void 0?g:n.row,B=(p=n.mergeEndCol)!==null&&p!==void 0?p:n.col,E=(f=n.mergeEndCol)!==null&&f!==void 0?f:n.row,k=(m=n._cellLeftIconWidth)!==null&&m!==void 0?m:0,P=(v=n._cellRightIconWidth)!==null&&v!==void 0?v:0;if(_.keepAspectRatio){const{width:I,height:O}=wM(b.width||b.videoWidth,b.height||b.videoHeight,x-(w[1]+w[3]),A-(w[0]+w[2])),H=aD(0,0,x,A,I,O,C,S,w);for(let z=T;z<=B;z++)for(let F=R;F<=E;F++){const j=s.scenegraph.getCell(z,F).getChildByName("image");j==null||j.setAttributes({x:H.x,y:H.y,width:I,height:O})}}else for(let I=T;I<=B;I++)for(let O=R;O<=E;O++){const H=s.scenegraph.getCell(I,O).getChildByName("image");H==null||H.setAttributes({x:k+w[3],y:w[0],width:x-w[1]-w[3]-P-k,height:A-w[0]-w[2]})}if(n.getChildByName("play-icon")){const{width:H,height:z}=sf(n,s),F=Math.floor(Math.min(H-w[1]-w[3],z-w[2]-w[0])/2),j=0+(H>_.attribute.width?_.attribute.x-0+_.attribute.width/2:H/2),$=0+(z>_.attribute.height?_.attribute.y-0+_.attribute.height/2:z/2);for(let Y=T;Y<=B;Y++)for(let G=R;G<=E;G++)s.scenegraph.getCell(Y,G).getChildByName("play-icon").setAttributes({x:j-F/2,y:$-F/2,width:F,height:F})}n.forEachChildren(I=>{I.role==="icon-left"||(I.role==="icon-right"||I.role==="icon-absolute-right")&&I.setAttribute("x",I.attribute.x+i)}),n.forEachChildren(I=>{(I.type==="rect"||I.role&&I.role.startsWith("icon"))&&(S==="middle"?I.setAttribute("y",w[0]+(A-w[0]-w[2]-I.AABBBounds.height())/2):S==="bottom"?I.setAttribute("y",w[0]+A-w[0]-w[2]-I.AABBBounds.height()):I.setAttribute("y",w[0]))}),M&&lD(n.mergeStartCol,n.mergeEndCol,n.mergeStartRow,n.mergeEndRow,s)}function sf(n,t){return n.role==="cell"&&L(n.mergeStartCol)&&L(n.mergeEndCol)&&L(n.mergeStartRow)&&L(n.mergeEndRow)?{width:t.getColsWidth(n.mergeStartCol,n.mergeEndCol),height:t.getRowsHeight(n.mergeStartRow,n.mergeEndRow),isMerge:!0}:{width:n.attribute.width,height:n.attribute.height,isMerge:!1}}function lD(n,t,e,i,r){for(let s=n;s<=t;s++)for(let o=e;o<=i;o++){const a=r.scenegraph.getCell(s,o);if(a){const l=a.getChildByName("image");l&&l.setAttributes({dx:-r.getColsWidth(a.mergeStartCol,s-1),dy:-r.getRowsHeight(a.mergeStartRow,o-1)});const h=a.getChildByName("play-icon");h&&h.setAttributes({dx:-r.getColsWidth(a.mergeStartCol,s-1),dy:-r.getRowsHeight(a.mergeStartRow,o-1)})}}}function uN(n,t,e,i,r,s,o,a){const l=s.resources.get(s.attribute.image).data,{col:h,row:d}=o;if(n&&!cN(s)&&Pq(h,d,l.width,l.height,a.scenegraph,e,o),t||cN(s)){const{width:u,height:c,isMerge:g}=sf(o,a),{width:p,height:f}=wM(l.width,l.height,u-e[1]-e[3],c-e[0]-e[2]),m=aD(0,0,u,c,p,f,i,r,e);s.setAttributes({x:m.x,y:m.y,width:p,height:f}),g&&lD(o.mergeStartCol,o.mergeEndCol,o.mergeStartRow,o.mergeEndRow,a)}}function cN(n){const t=ra();return n.attribute.image===t.damage_pic.svg}function Eq(n,t,e){n.then(()=>{e(),t.scenegraph.updateNextFrame()}).catch(i=>{})}function kyt(n,t){var e,i;const r=this;if(r.shadowRoot&&r.shadowRoot.childrenCount&&(L(n.width)||L(n.height))){const s=r.shadowRoot.findChildrenByName("shadow-rect")[0];s&&s.setAttributes({width:(e=n.width)!==null&&e!==void 0?e:s.attribute.width,height:(i=n.height)!==null&&i!==void 0?i:s.attribute.height})}}function hD(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v){var _,b;let y,C=!1;if(ua(t)){if(i.scenegraph.highPerformanceGetCell(r,s).role!=="cell")return y;t=i.getCellValue(r,s),C=!0}if(n==="text"||n==="link"||v){if(n==="link"){const A=t,M=i.getCellOriginValue(r,s),T=i._getCellStyle(r,s);n==="link"&&("templateLink"in e&&e.templateLink||!("linkDetect"in e)||!ni(e.linkDetect,{col:r,row:s,table:i,value:A,dataValue:M,cellHeaderPaths:void 0})||iD.test(A))&&(f?(f.text.fill=Mt("linkColor",T,r,s,i),f.group.cursor="pointer"):f={text:{fill:Mt("linkColor",T,r,s,i)},group:{cursor:"pointer"}})}const{customElementsGroup:S,renderDefault:w}=gN(i,e,r,s,a,l,u,m,v);y=Jt.getFunction("createTextCellGroup")(i,t,h,0,d,r,s,o,a,l,u,c,g,p,S,w,f,m,C);const x=i.internalProps.layoutMap.getAxisConfigInPivotChart(r,s);if(x){const A=new(Jt.getComponent("axis"))(x,y.attribute.width,y.attribute.height,(_=x.__vtablePadding)!==null&&_!==void 0?_:u,i);y.clear(),y.appendChild(A.component),A.overlap()}else i.internalProps.layoutMap.isEmpty(r,s)?(y.setAttributes({fill:!1,stroke:!1}),y.clear()):i.internalProps.layoutMap.isAxisCell(r,s)&&y.clear()}else if(n==="image")y=Jt.getFunction("createImageCellGroup")(h,0,d,r,s,a,l,e.keepAspectRatio,e.imageAutoSizing,u,c,g,p,i,f,m,C);else if(n==="video")y=Jt.getFunction("createVideoCellGroup")(h,0,d,r,s,a,l,e.keepAspectRatio,e.imageAutoSizing,u,c,g,p,i,f,m,C);else if(n==="chart"){const S=i.internalProps.layoutMap.getChartInstance(r,s);y=Jt.getFunction("createChartCellGroup")(null,h,0,d,r,s,a,l,u,t,e.chartModule,i.internalProps.layoutMap.getChartSpec(r,s),S,(b=i.internalProps.layoutMap.getChartDataId(r,s))!==null&&b!==void 0?b:"data",i,f,i.internalProps.layoutMap.isShareChartSpec(r,s),C,i.internalProps.layoutMap.isNoChartDataRenderNothing(r,s))}else if(n==="progressbar"){const{customElementsGroup:S,renderDefault:w}=gN(i,e,r,s,a,l,u,m,v),x=i._getCellStyle(r,s),A=i.getCellOriginValue(r,s);y=Jt.getFunction("createTextCellGroup")(i,t,h,0,d,r,s,o,a,l,u,c,g,!1,S,w,f,m,C);const M=Jt.getFunction("createProgressBarCell")(e,x,o,t,A,r,s,u,i,m);y.firstChild?y.insertBefore(M,y.firstChild):y.appendChild(M)}else if(n==="sparkline")y=Jt.getFunction("createSparkLineCellGroup")(null,h,0,d,r,s,a,l,u,i,f,C);else if(n==="checkbox"){const S="isAggregation"in i.internalProps.layoutMap&&i.internalProps.layoutMap.isAggregation(r,s),w=i.internalProps.layoutMap.isSeriesNumber(r,s);S&&w?y=Jt.getFunction("createTextCellGroup")(i,t,h,0,d,r,s,o,a,l,u,c,g,!1,void 0,!0,f,m,C):y=Jt.getFunction("createCheckboxCellGroup")(null,h,0,d,r,s,o,a,l,u,c,g,p,i,f,e,m,C)}else n==="radio"?y=Jt.getFunction("createRadioCellGroup")(null,h,0,d,r,s,o,a,l,u,c,g,i,f,e,m):n==="switch"?y=Jt.getFunction("createSwitchCellGroup")(null,h,0,d,r,s,o,a,l,u,c,g,p,i,f,e,m,C):n==="button"&&(y=Jt.getFunction("createButtonCellGroup")(null,h,0,d,r,s,o,a,l,u,c,g,p,i,f,e,m,C));return y.onBeforeAttributeUpdate=kyt,y}function gN(n,t,e,i,r,s,o,a,l){let h,d=!0;if(l)h=l.elementsGroup,d=l.renderDefault;else if(!(a!=null&&a.isCustom&&!n.isCornerHeader(e,i))){let u,c;if(n.getCellLocation(e,i)!=="body"?(u=t==null?void 0:t.headerCustomRender,c=t==null?void 0:t.headerCustomLayout):(u=(t==null?void 0:t.customRender)||n.customRender,c=t==null?void 0:t.customLayout),c||u){const g=Rd(c,u,e,i,r,s,!1,n.isAutoRowHeight(i),o,a,n);h=g.elementsGroup,d=g.renderDefault}}return{customElementsGroup:h,renderDefault:d}}function go(n,t,e,i,r,s){var o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w;const x=e.scenegraph.highPerformanceGetCell(n,t,!0);if(x.role!=="cell"&&!i)return;const A=e.getCellLocation(n,t);let M,T,R,B,E=e.getCellValue(n,t),k=!1;if(e.internalProps.customMergeCell){const at=e.getCustomMerge(n,t);if(at){const{range:W,text:N,style:K,customLayout:nt,customRender:X}=at;T=W,M=T.start.col!==T.end.col||T.start.row!==T.end.row,E=N,R=K,(nt||X)&&(B=Rd(nt,X,W.start.col,W.start.row,e.getColsWidth(W.start.col,W.end.col),e.getRowsHeight(W.start.row,W.end.row),!1,e.isAutoRowHeight(t),[0,0,0,0],T,e)),k=!0}}let P=n,I=t;T&&(P=T.start.col,I=T.start.row);const O=A!=="body"?e.getHeaderDefine(P,I):e.getBodyColumnDefine(P,I);let H=A!=="body"||(O==null?void 0:O.dragOrder)||!!(O!=null&&O.icon)||!!(O!=null&&O.tree);T||!e.internalProps.enableTreeNodeMerge&&A==="body"&&!(O!=null&&O.mergeCell)||(T=e.getCellRange(n,t),M=T.start.col!==T.end.col||T.start.row!==T.end.row);let z=!1;if(e.internalProps.enableTreeNodeMerge&&M){const at=e.getCellRawRecord(T.start.col,T.start.row),{vtableMergeName:W,vtableMerge:N}=at??{};z=N,N&&(H=!0,e.options.groupTitleCustomLayout&&(B=Rd(e.options.groupTitleCustomLayout,void 0,T.start.col,T.start.row,e.getColsWidth(T.start.col,T.end.col),e.getRowsHeight(T.start.row,T.end.row),!1,e.isAutoRowHeight(t),[0,0,0,0],T,e)),e.options.groupTitleFieldFormat?E=e.options.groupTitleFieldFormat(at,n,t,e):W&&(E=W))}const F=R||e._getCellStyle(T?T.start.col:n,T?T.start.row:t),j=(o=F.autoWrapText)!==null&&o!==void 0?o:e.internalProps.autoWrapText,$=Vd(F,e,M?T.start.col:n,M?T.start.row:t,Mt).theme;if($.group.cornerRadius=SM(n,t,e),!i&&!M&&!(O!=null&&O.customLayout||O!=null&&O.customRender||O!=null&&O.headerCustomLayout||O!=null&&O.headerCustomRender)&&(s||Ryt(n,t,x,j,H,e))){const at=e.getColWidth(n),W=e.getRowHeight(t),N=ol(n,t,$,e);x.setAttributes({width:at,height:W,lineWidth:(l=(a=$==null?void 0:$.group)===null||a===void 0?void 0:a.lineWidth)!==null&&l!==void 0?l:void 0,fill:(d=(h=$==null?void 0:$.group)===null||h===void 0?void 0:h.fill)!==null&&d!==void 0?d:void 0,stroke:(c=(u=$==null?void 0:$.group)===null||u===void 0?void 0:u.stroke)!==null&&c!==void 0?c:void 0,strokeArrayWidth:N??void 0,strokeArrayColor:(p=(g=$==null?void 0:$.group)===null||g===void 0?void 0:g.strokeArrayColor)!==null&&p!==void 0?p:void 0,cursor:(m=(f=$==null?void 0:$.group)===null||f===void 0?void 0:f.cursor)!==null&&m!==void 0?m:void 0,cornerRadius:(_=(v=$==null?void 0:$.group)===null||v===void 0?void 0:v.cornerRadius)!==null&&_!==void 0?_:0,lineDash:(y=(b=$==null?void 0:$.group)===null||b===void 0?void 0:b.lineDash)!==null&&y!==void 0?y:void 0,y:e.scenegraph.getCellGroupY(t)}),x.forEachChildren(nt=>{nt.setAttributes({dx:0,dy:0})});const K=x.getChildByName("text");if(s&&K){const nt={textBaseline:"top"};K.setAttributes($.text?Object.assign({},$.text,nt):nt)}else if(K){const nt=e.getCellValue(n,t),{text:X,moreThanMaxCharacters:ht}=G_(nt,e),_t=Hs(n,t,e),ct=F.lineClamp,U=(C=Be(Mt("padding",F,n,t,e)))!==null&&C!==void 0?C:[0,0,0,0],ut=$.text.textAlign;let lt=0;lt=ut==="center"?U[3]+(at-(U[1]+U[3]))/2:ut==="right"?U[3]+at-(U[1]+U[3]):U[3];const At={text:X.length!==1||j?X:X[0],moreThanMaxCharacters:ht,maxLineWidth:at-(U[1]+U[3]+_t),textBaseline:"top",autoWrapText:j,lineClamp:ct,wordBreak:"break-word",heightLimit:W-Math.floor(U[0]+U[2]),pickable:!1,dx:ut==="left"?_t:0,x:lt};if(K.setAttributes($.text?Object.assign({},$.text,At):At),K.attribute.text){const ft=$.text.textBaseline,Ct=W-(U[0]+U[2]);let Ht=0;Ht=ft==="middle"?U[0]+(Ct-K.AABBBounds.height())/2:ft==="bottom"?U[0]+Ct-K.AABBBounds.height():U[0],K.setAttributes({y:Ht})}}return x}if(!i&&x.role==="empty")return;const Y=z||k?"text":e.isHeader(n,t)?(S=e._getHeaderLayoutMap(n,t).headerType)!==null&&S!==void 0?S:"text":(w=e.getBodyColumnType(n,t))!==null&&w!==void 0?w:"text",G=$._vtable.padding,tt=$.text.textAlign,st=$.text.textBaseline;let ot,rt,pt;if(T?(rt=e.getColsWidth(T.start.col,T.end.col),pt=e.getRowsHeight(T.start.row,T.end.row)):(rt=e.getColWidth(n),pt=e.getRowHeight(t)),ua(E)?(x.removeAllChild(),Eq(E,e,Byt.bind(null,{type:Y,value:E,define:O,table:e,col:n,row:t,cellWidth:rt,cellHeight:pt,oldCellGroup:x,padding:G,textAlign:tt,textBaseline:st,mayHaveIcon:H,addNew:i,range:T,customResult:B,customStyle:R}))):ot=Lq(Y,E,O,e,n,t,rt,pt,x,G,tt,st,H,i,$,T,B),M){const{width:at}=ot.attribute,{height:W}=ot.attribute;ot.contentWidth=at,ot.contentHeight=W,r?Pyt(T,rt,pt,G,tt,st,e,ot):Iq(T,rt,pt,G,tt,st,e)}return ot}function Lq(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m){var v,_;if(ua(t)&&(t=i.getCellValue(r,s)),!g&&(l.row!==s||l.col!==r))return null;if(!g&&l.parent&&i.reactCustomLayout){const y=l.getChildByName("custom-container");if(y){const{col:C,row:S}=y;J(C)&&J(S)&&i.reactCustomLayout.removeCustomCell(C,S)}}const b=hD(n,t,e,i,r,s,i.getColWidth(r),o,a,g?i.scenegraph.getColGroup(r):l.parent,g?0:i.scenegraph.getCellGroupY(s),h,d,u,c,p,f,m);return!g&&l.parent&&(l.parent.insertAfter(b,l),l.parent.removeChild(l),!((v=i.scenegraph)===null||v===void 0)&&v.proxy.cellCache.get(r)&&((_=i.scenegraph)===null||_===void 0||_.proxy.cellCache.set(r,b))),b}function Ryt(n,t,e,i,r,s){var o;const a=s.getBodyColumnType(n,t),l=s.isAutoRowHeight(t),h=s.getCellValue(n,t);return!(s.isHeader(n,t)||e.role!=="cell"||a!=="text"||i||l||r||((o=e.firstChild)===null||o===void 0?void 0:o.type)!=="text"||ua(h))}function Byt(n){const{type:t,value:e,define:i,table:r,col:s,row:o,cellWidth:a,cellHeight:l,oldCellGroup:h,padding:d,textAlign:u,textBaseline:c,mayHaveIcon:g,addNew:p,range:f,customResult:m,customStyle:v}=n,_=v||r._getCellStyle(f?f.start.col:s,f?f.start.row:o),b=Vd(_,r,f?f.start.col:s,f?f.start.row:o,Mt).theme;b.group.cornerRadius=SM(s,o,r),Lq(t,e,i,r,s,o,a,l,h,d,u,c,g,p,b,f,m)}function Iq(n,t,e,i,r,s,o){for(let a=n.start.col;a<=n.end.col;a++)for(let l=n.start.row;l<=n.end.row;l++){const h=o.scenegraph.highPerformanceGetCell(a,l,!0);if(h.role!=="cell")continue;n.start.row!==n.end.row&&h.contentHeight!==e&&yx(h,e,e,o.isAutoRowHeight(l),i,r,s,o),n.start.col!==n.end.col&&h.contentWidth!==t&&bx(h,t,e,0,o.isAutoRowHeight(l),i,r,s,o.scenegraph),h.contentWidth=t,h.contentHeight=e;const d=o.getRowHeight(l);sb(h,o.getColWidth(a),d,n,o)}}function Pyt(n,t,e,i,r,s,o,a){const{col:l,row:h}=a;n.start.row!==n.end.row&&a.contentHeight!==e&&yx(a,e,e,o.isAutoRowHeight(h),i,r,s,o),n.start.col!==n.end.col&&a.contentWidth!==t&&bx(a,t,e,0,o.isAutoRowHeight(h),i,r,s,o.scenegraph),a.contentWidth=t,a.contentHeight=e;const d=o.getRowHeight(h);sb(a,o.getColWidth(l),d,n,o)}function sb(n,t,e,i,r){var s,o;const{col:a,row:l}=n,h=-r.getColsWidth(i.start.col,a-1);let d=0;if(!((s=r.options.customConfig)===null||s===void 0)&&s._disableColumnAndRowSizeRound)for(let m=i.start.row;m<=l-1;m++)d-=r.getRowHeight(m);else d=-r.getRowsHeight(i.start.row,l-1);n.forEachChildren(m=>{var v,_,b,y,C,S;typeof m._dx=="number"?(m.skipMergeUpdate=!0,m.setAttributes({dx:((v=m._dx)!==null&&v!==void 0?v:0)+h}),m.skipMergeUpdate=!1):(m.skipMergeUpdate=!0,m._dx=(_=m.attribute.dx)!==null&&_!==void 0?_:0,m.setAttributes({dx:((b=m.attribute.dx)!==null&&b!==void 0?b:0)+h}),m.skipMergeUpdate=!1),typeof m._dy=="number"?(m.skipMergeUpdate=!0,m.setAttributes({dy:((y=m._dy)!==null&&y!==void 0?y:0)+d}),m.skipMergeUpdate=!1):(m._dy=(C=m.attribute.dy)!==null&&C!==void 0?C:0,m.skipMergeUpdate=!0,m.setAttributes({dy:((S=m.attribute.dy)!==null&&S!==void 0?S:0)+d}),m.skipMergeUpdate=!1)});const u=(o=n.attribute.strokeArrayWidth)!==null&&o!==void 0?o:n.attribute.lineWidth,c=V(u),g=[0,0,0,0];a===i.start.col&&(g[3]=c?u[3]:u),l===i.start.row&&(g[0]=c?u[0]:u),a===i.end.col&&(g[1]=c?u[1]:u),l===i.end.row&&(g[2]=c?u[2]:u);const p=t!==n.attribute.width,f=e!==n.attribute.height;return n.skipMergeUpdate=!0,n.setAttributes({width:t,height:e,strokeArrayWidth:g}),n.skipMergeUpdate=!1,n.mergeStartCol=i.start.col,n.mergeStartRow=i.start.row,n.mergeEndCol=i.end.col,n.mergeEndRow=i.end.row,{widthChange:p,heightChange:f}}function Cx(n,t,e,i){if(i.internalProps.customMergeCell){const r=i.getCustomMerge(n,t);if(r){const{range:s,text:o,style:a,customLayout:l,customRender:h}=r;if(l||h){const d=Rd(l,h,s.start.col,s.start.row,i.getColsWidth(s.start.col,s.end.col),i.getRowsHeight(s.start.row,s.end.row),!1,i.isAutoRowHeight(t),[0,0,0,0],s,i).elementsGroup;e.childrenCount>0&&d?e.insertBefore(d,e.firstChild):d&&e.appendChild(d);const u=i.getRowHeight(t),c=i.getColWidth(n),{width:g}=e.attribute,{height:p}=e.attribute;return e.contentWidth=g,e.contentHeight=p,sb(e,c,u,s,i),s}}}}function ld(n){return!!(n.role==="cell"&&J(n.mergeStartCol)&&J(n.mergeStartRow)&&J(n.mergeEndCol)&&J(n.mergeEndRow))}const HR=new nf({}),_v=new rf({}),Eyt=new ib({});function Lyt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){const f=kt(n)?n.text:n,m=mM(f).split(`
`)||[],v=p.getColsWidth(t,i),_=Mt("size",r,t,e,p);let b=0;if(s){const y=Mt("spaceBetweenTextAndIcon",r,t,e,p),C=v-(g[1]+g[3])-o-_-y;HR.setAttributes({text:{maxLineWidth:C,text:m,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:u,wordBreak:"break-word",lineClamp:c},icon:{width:Math.floor(_/1.4),height:Math.floor(_/1.4)},box:{width:_,height:_},spaceBetweenTextAndIcon:y}),HR.render(),b=HR.AABBBounds.height()}else b=Math.max(_,m.length*u);return b}function Iyt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){var f;if(V(n)){let m=0;const v=p.getBodyColumnDefine(t,e),_=Mt("spaceBetweenRadio",r,t,e,p),b=(f=v==null?void 0:v.radioDirectionInCell)!==null&&f!==void 0?f:"vertical";return b==="vertical"?n.forEach((y,C)=>{const S=zR(y,t,e,i,r,s,o,a,l,h,d,u,c,g,p);m+=S,C!==n.length-1&&(m+=_)}):b==="horizontal"&&n.forEach(y=>{const C=zR(y,t,e,i,r,s,o,a,l,h,d,u,c,g,p);m=Math.max(C,m)}),m}return zR(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p)}function zR(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){const f=kt(n)?n.text:n,m=mM(f).split(`
`)||[],v=p.getColsWidth(t,i),_=Mt("size",r,t,e,p);let b=Mt("outerRadius",r,t,e,p);const y=J(b)?2*b:_;let C=0;if(s){const S=Mt("spaceBetweenTextAndIcon",r,t,e,p),w=v-(g[1]+g[3])-o-y-S;J(b)||(b=Math.round(_/2)),_v.setAttributes({text:{maxLineWidth:w,text:m,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:u,wordBreak:"break-word",lineClamp:c},circle:{outerRadius:b},spaceBetweenTextAndIcon:S}),_v.render(),C=_v.AABBBounds.height()}else C=Math.max(_,m.length*u);return C}function Oyt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){return Mt("boxWidth",r,t,e,p)}function Dyt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){const f=kt(n)?n.text:n,m=mM(f).split(`
`)||[],v=p.getColsWidth(t,i),_=Mt("buttonPadding",r,t,e,p),b=Mt("buttonLineWidth",r,t,e,p);let y=0;if(s){const C=v-(g[1]+g[3]);Eyt.setAttributes({text:m,textStyle:{maxLineWidth:C,fontSize:a,fontStyle:l,fontWeight:h,fontFamily:d,lineHeight:u,wordBreak:"break-word",lineClamp:c},padding:_,panel:{visible:!0,fill:"red",stroke:"red",lineWidth:b}}),_v.render(),y=_v.AABBBounds.height()}else y=m.length*u+2*_;return y}let Fyt="",aL="quick";const Hyt=new pe((n,t,e,i)=>{e($l)?i($l).to(fN).inSingletonScope():n($l).to(fN).inSingletonScope()});new pe((n,t,e,i)=>{e($l)?i($l).to(Yp).inSingletonScope():n($l).to(Yp).inSingletonScope()});const pN=new Map;function lL(n,t,e,i="normal"){const r=`${n}-${t}-${e}-${i}`,s=pN.get(r);if(s)return s;const o=(a={fontSize:n,fontFamily:e,fontWeight:t,fontStyle:i},new Wi(Object.assign({defaultFontParams:{fontFamily:is.fontFamily,fontSize:is.fontSize},getTextBounds:aM,specialCharSet:`{}()//&-/: .,@%'"~=${Wi.ALPHABET_CHAR_SET}${Wi.ALPHABET_CHAR_SET.toUpperCase()}0123456789${Fyt}`},{}),a));var a;return pN.set(r,o),o}class fN extends Yp{_fastMeasure(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:s="normal",fontStyle:o="normal"}=e,a=lL(i,s,r,o).measure(t,aL);if(!L(a.fontBoundingBoxAscent)&&!L(a.fontBoundingBoxDescent)){const{ascent:l,descent:h}=this.measureTextBoundADscentEstimate(e);a.fontBoundingBoxAscent=l,a.fontBoundingBoxDescent=h}return a}measureTextWidth(t,e){return this._fastMeasure(t,e).width}measureText(t,e){return this._fastMeasure(t,e)}_measureTextWithoutAlignBaseline(t,e,i){return this._fastMeasure(t,e)}_measureTextWithAlignBaseline(t,e,i){return this._fastMeasure(t,e)}}class zyt{measureText(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:s="normal",fontStyle:o="normal"}=e;return lL(i,s,r,o).measure(t,aL)}measureTextWidth(t,e){const{fontSize:i,fontFamily:r="Arial,sans-serif",fontWeight:s="normal",fontStyle:o="normal"}=e;return lL(i,s,r,o).measure(t,aL).width}clipText(t,e,i){if(t.length===0)return{str:"",width:0};let r=this.measureTextWidth(t,e);return r<=i?{str:t,width:r}:(r=this.measureTextWidth(t[0],e),r>i?{str:"",width:0}:this._clipText(t,e,i,0,t.length-1))}_clipText(t,e,i,r,s){const o=Math.floor((r+s)/2),a=t.substring(0,o+1),l=this.measureTextWidth(a,e);let h;if(l>i){if(a.length<=1)return{str:"",width:0};const d=t.substring(0,o);return h=this.measureTextWidth(d,e),h<=i?{str:d,width:h}:this._clipText(t,e,i,r,o)}if(l<i){if(o>=t.length-1)return{str:t,width:this.measureTextWidth(t,e)};const d=t.substring(0,o+2);return h=this.measureTextWidth(d,e),h>=i?{str:a,width:l}:this._clipText(t,e,i,o,s)}return{str:a,width:l}}clipTextWithSuffix(t,e,i,r){if(r==="")return this.clipText(t,e,i);if(t.length===0)return{str:"",width:0};const s=this.measureTextWidth(t,e);if(s<=i)return{str:t,width:s};const o=this.measureTextWidth(r,e);if(o>i)return{str:"",width:0};i-=o;const a=this._clipText(t,e,i,0,t.length-1);return a.str+=r,a.width+=o,a}}const Oq=new zyt,mN=new Wn({ignoreBuf:!0});function Dq(n){return mN.initAttributes(Object.assign(Object.assign({},n),{ignoreBuf:!0})),mN.AABBBounds}const vN=new Wd({width:0,height:0,textConfig:[]});function po(n,t,e,i=!0,r){var s,o,a,l,h,d,u,c,g,p,f;typeof window<"u"&&window.performance.now();const m=[],v=[];if(r)for(let S=t;S<=e;S++)m[S]=n.getRowHeight(S);const _=n.internalProps.layoutMap;n.isPivotTable()&&(_.enableUseGetBodyCache(),_.enableUseHeaderPathCache()),n.defaultHeaderRowHeight,n.defaultHeaderColWidth;const b=n.defaultHeaderRowHeight==="auto"||V(n.defaultHeaderRowHeight)&&n.defaultHeaderRowHeight.some(S=>S==="auto"),y=n.isAutoRowHeight(t)||n.heightMode==="adaptive"&&n.options.autoHeightInAdaptiveMode!==!1,C=n.options.defaultRowHeight==="auto";if(y||b||C){t=t??0,e=e??n.rowCount-1,(t===0&&e===n.rowCount-1||i)&&n._clearRowRangeHeightsMap();for(let S=t;S<n.columnHeaderLevelCount;S++){let w=0,x=n.colCount-1;if((n.isPivotTable()&&!n.isPivotChart()||n.isPivotChart()&&!n.internalProps.layoutMap.indicatorsAsCol)&&Nyt(n,S)&&!un(n,n.rowHeaderLevelCount,S)&&(w=0,x=n.rowHeaderLevelCount),y||n.getDefaultRowHeight(S)==="auto"){const A=no(S,w,x,n);v[S]=Math.round(A),n.heightAdaptiveMode!=="only-body"&&r||n._setRowHeight(S,A)}}for(let S=n.rowCount-n.bottomFrozenRowCount;S<=e;S++)if(y||n.getDefaultRowHeight(S)==="auto"){const w=no(S,0,n.colCount-1,n);r?v[S]=Math.round(w):n._setRowHeight(S,w)}if(!(e<n.columnHeaderLevelCount||!y&&!C))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol||n.options.customComputeRowHeight||!Wyt(n,t))if(n.internalProps.transpose||n.isPivotTable()&&!n.internalProps.layoutMap.indicatorsAsCol)for(let S=Math.max(t,n.columnHeaderLevelCount);S<=e;S++){let w;w=jyt(n,S)?no(S,0,n.rowHeaderLevelCount,n):no(S,0,n.colCount-1,n),r?v[S]=Math.round(w):n._setRowHeight(S,w)}else for(let S=Math.max(t,n.columnHeaderLevelCount);S<=e;S++){const w=no(S,0,n.colCount-1,n);r?v[S]=Math.round(w):n._setRowHeight(S,w)}else{$yt(no(n.columnHeaderLevelCount,0,n.colCount-1,n),n.columnHeaderLevelCount,n.rowCount-1-n.bottomFrozenRowCount,n,r?v:void 0);for(let S=n.rowCount-n.bottomFrozenRowCount;S<=e;S++){const w=no(S,0,n.colCount-1,n);r?v[S]=Math.round(w):n._setRowHeight(S,w)}}}else if((n.heightMode==="adaptive"||n.autoFillHeight)&&n.clearRowHeightCache(),r)for(let S=t;S<=e;S++)v[S]=n.getRowHeight(S);if((t===0&&e===n.rowCount-1||i)&&n._clearRowRangeHeightsMap(),n.heightMode==="adaptive"){n._clearRowRangeHeightsMap();let S=n.tableNoFrameHeight,w=0,x=n.rowCount;if(n.heightAdaptiveMode==="only-body"){const T=n.getRowsHeight(0,n.columnHeaderLevelCount-1),R=n.isPivotChart()?n.getBottomFrozenRowsHeight():0;S=n.tableNoFrameHeight-T-R,w=n.columnHeaderLevelCount,x=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount}let A=0;for(let T=w;T<x;T++)A+=r&&(s=v[T])!==null&&s!==void 0?s:n.getRowHeight(T);const M=S/A;for(let T=w;T<x;T++){let R;R=T===x-1?S-(r?v.reduce((B,E,k)=>k>=w&&k<=x-2?B+E:B,0):n.getRowsHeight(w,x-2)):Math.round((r&&(o=v[T])!==null&&o!==void 0?o:n.getRowHeight(T))*M),r?v[T]=R:n._setRowHeight(T,R,!1)}}else if(n.autoFillHeight){n._clearRowRangeHeightsMap();const S=n.tableNoFrameHeight;let w=0,x=0;for(let A=0;A<n.rowCount;A++){const M=r&&(a=v[A])!==null&&a!==void 0?a:n.getRowHeight(A);(A<n.columnHeaderLevelCount||n.isPivotChart()&&A>=n.rowCount-n.bottomFrozenRowCount)&&(x+=M),w+=M}if(n.scenegraph._dealAutoFillHeightOriginRowsHeight=w,w<S&&w-x>0){const A=n.columnHeaderLevelCount,M=n.isPivotChart()?n.rowCount-n.bottomFrozenRowCount:n.rowCount,T=(S-x)/(w-x);for(let R=A;R<M;R++){let B;B=R===M-1?S-x-(r?v.reduce((E,k,P)=>P>=A&&P<=M-2?E+k:E,0):n.getRowsHeight(A,M-2)):Math.round((r&&(l=v[R])!==null&&l!==void 0?l:n.getRowHeight(R))*T),r?v[R]=B:n._setRowHeight(R,B,!1)}}}if(r){for(let S=t;S<=e;S++){const w=(h=v[S])!==null&&h!==void 0?h:n.getRowHeight(S);L(w)&&n._setRowHeight(S,w)}for(let S=0;S<=n.frozenRowCount-1;S++){const w=n.getRowHeight(S);w!==((d=m[S])!==null&&d!==void 0?d:n.getRowHeight(S))&&n.scenegraph.updateRowHeight(S,w-((u=m[S])!==null&&u!==void 0?u:n.getRowHeight(S)),!0)}for(let S=n.rowCount-n.bottomFrozenRowCount;S<=n.rowCount-1;S++){const w=n.getRowHeight(S);w!==((c=m[S])!==null&&c!==void 0?c:n.getRowHeight(S))&&n.scenegraph.updateRowHeight(S,w-((g=m[S])!==null&&g!==void 0?g:n.getRowHeight(S)),!0)}for(let S=n.scenegraph.proxy.rowStart;S<=n.scenegraph.proxy.rowEnd;S++){const w=n.getRowHeight(S);w!==((p=m[S])!==null&&p!==void 0?p:n.getRowHeight(S))&&n.scenegraph.updateRowHeight(S,w-((f=m[S])!==null&&f!==void 0?f:n.getRowHeight(S)),!0)}}n.isPivotTable()&&(_.disableUseGetBodyCache(),_.disableUseHeaderPathCache())}function no(n,t,e,i){var r;if(!(i.isAutoRowHeight(n)||i.heightMode==="adaptive"&&i.options.autoHeightInAdaptiveMode!==!1)&&i.getDefaultRowHeight(n)!=="auto")return i.getDefaultRowHeight(n);let s;if(i.options.customComputeRowHeight){const a=i.options.customComputeRowHeight({row:n,table:i});if(typeof a=="number")return a;if(a!=="auto")return i.getDefaultRowHeight(n)}if(i.isPivotChart()&&n>=i.columnHeaderLevelCount&&n<i.rowCount-i.bottomFrozenRowCount)if(i.internalProps.layoutMap.indicatorsAsCol){const a=i.internalProps.layoutMap.getOptimunHeightForChart(n);if(a>0)return a}else{const a=i.getDefaultRowHeight(n);if(J(a))return a}for(let a=t;a<=e;a++){const l=Vyt(a,n,i);if(l&&(s=L(s)?Math.max(l.height,s):l.height,!l.renderDefault))continue;if(i.isPivotChart()){const d=i.internalProps.layoutMap.getAxisConfigInPivotChart(a,n);if(d){const u=Jt.getFunction("computeAxisComponentHeight")(d,i);if(typeof u=="number"){s=L(s)?Math.max(u,s):u;continue}}}if(i.isPivotChart()&&(i.isLeftFrozenColumn(a)&&i.isBottomFrozenRow(n)||i.isRightFrozenColumn(a)&&i.isBottomFrozenRow(n)))continue;const h=Gyt(a,n,i.isHeader(a,n)?(r=i._getHeaderLayoutMap(a,n))===null||r===void 0?void 0:r.headerType:i.getBodyColumnType(a,n),i);s=L(s)?Math.max(h,s):h}if(L(s))return s;const o=i.getDefaultRowHeight(n);return J(o)?o:i.defaultRowHeight}function Wyt(n,t){var e,i,r;const{layoutMap:s}=n.internalProps,o=n.columnHeaderLevelCount;if((n.internalProps.autoWrapText||n.internalProps.enableLineBreak||n.isPivotChart())&&(n.isAutoRowHeight(t)||n.options.heightMode==="adaptive"))return!1;for(let a=0;a<n.colCount;a++){const l=s.getBody(a,o);if(l.cellType==="radio"||typeof l.style=="function"||typeof l.icon=="function"||!((e=l.define)===null||e===void 0)&&e.customRender||!((i=l.define)===null||i===void 0)&&i.customLayout||typeof((r=l.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const h=n._getCellStyle(a,o);if(typeof h.padding=="function"||typeof h.fontSize=="function"||typeof h.lineHeight=="function"||h.autoWrapText===!0)return!1}return!0}function jyt(n,t){var e,i,r;const{layoutMap:s}=n.internalProps;if((n.internalProps.autoWrapText||n.internalProps.enableLineBreak)&&(n.isAutoRowHeight(t)||n.options.heightMode==="adaptive"))return!1;const o=s.getBody(n.rowHeaderLevelCount,t);if(typeof o.style=="function"||typeof o.icon=="function"||!((e=o.define)===null||e===void 0)&&e.customRender||!((i=o.define)===null||i===void 0)&&i.customLayout||typeof((r=o.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const a=n._getCellStyle(n.rowHeaderLevelCount,t);return typeof a.padding!="function"&&typeof a.fontSize!="function"&&typeof a.lineHeight!="function"&&a.autoWrapText!==!0}function Nyt(n,t){var e,i,r;const{layoutMap:s}=n.internalProps;if(n.internalProps.autoWrapText&&(n.isAutoRowHeight(t)||n.options.heightMode==="adaptive"))return!1;const o=s.getHeader(n.rowHeaderLevelCount,t);if(typeof o.style=="function"||typeof o.icons=="function"||!((e=o.define)===null||e===void 0)&&e.headerCustomRender||!((i=o.define)===null||i===void 0)&&i.headerCustomLayout||typeof((r=o.define)===null||r===void 0?void 0:r.icon)=="function")return!1;const a=n._getCellStyle(n.rowHeaderLevelCount,t);return typeof a.padding!="function"&&typeof a.fontSize!="function"&&typeof a.lineHeight!="function"&&a.autoWrapText!==!0}function $yt(n,t,e,i,r){if(!i.internalProps.useOneRowHeightFillAll){for(let s=t;s<=e;s++)r?r[s]=n:i._setRowHeight(s,n);i.internalProps.useOneRowHeightFillAll=!0}}function Vyt(n,t,e){var i,r,s,o,a,l,h;const d=e.getCustomRender(n,t);let u=e.getCustomLayout(n,t);if(d||u){let c,g=1,p=0,f=!1,m=!1;(e.isHeader(n,t)||!((i=e.getBodyColumnDefine(n,t))===null||i===void 0)&&i.mergeCell||e.hasCustomMerge())&&(c=e.getCellRange(n,t),g=c.end.row-c.start.row+1);const v={col:(r=c==null?void 0:c.start.col)!==null&&r!==void 0?r:n,row:(s=c==null?void 0:c.start.row)!==null&&s!==void 0?s:t,dataValue:e.getCellOriginValue(n,t),value:e.getCellValue(n,t)||"",rect:Uyt(n,t,e),table:e,originCol:n,originRow:t,forComputation:!0};if(u==="react-custom-layout"&&(u=((o=e.reactCustomLayout)===null||o===void 0?void 0:o.getCustomLayoutFunc(n,t))||$_),it(u)){const _=u(v);_.rootContainer?(_.rootContainer=V_(_.rootContainer),xM(_.rootContainer,e.getColWidth(n),0),_.rootContainer.setStage(e.scenegraph.stage),p=(a=_.rootContainer.AABBBounds.height())!==null&&a!==void 0?a:0,f=_.renderDefault,m=_.enableCellPadding):(p=0,f=_.renderDefault,m=_.enableCellPadding)}else if(typeof d=="function"){const _=d(v);p=(l=_==null?void 0:_.expectedHeight)!==null&&l!==void 0?l:0,f=_==null?void 0:_.renderDefault}else p=(h=d==null?void 0:d.expectedHeight)!==null&&h!==void 0?h:0,f=d==null?void 0:d.renderDefault;if(m){const _=e._getCellStyle(n,t),b=Be(Mt("padding",_,n,t,e));p+=b[0]+b[2]}return{height:p/g,renderDefault:f}}}function Gyt(n,t,e,i){var r,s,o,a;let l=0;const h=i.getCellValue(n,t),d=i._getCellStyle(n,t);let u=0,c=0;const g=[];let p=0;const f=[];let m=0,v=!1;if(i.getCellLocation(n,t)!=="body")v=!0;else{const k=i.getBodyColumnDefine(n,t);v=!!(k!=null&&k.icon)||!!(k!=null&&k.tree)||(k==null?void 0:k.dragOrder)}if(v){const k=i.getCellIcons(n,t);k==null||k.forEach(P=>{var I,O,H,z,F,j,$,Y,G,tt;P.positionType!==ri.absoluteRight&&P.positionType!==ri.inlineFront&&P.positionType!==ri.inlineEnd?(c+=((I=P.width)!==null&&I!==void 0?I:0)+((O=P.marginLeft)!==null&&O!==void 0?O:0)+((H=P.marginRight)!==null&&H!==void 0?H:0),u=Math.max(u,(z=P.height)!==null&&z!==void 0?z:0)):P.positionType===ri.inlineFront?(g.push(P),p=Math.max(p,((F=P.height)!==null&&F!==void 0?F:0)+((j=P.marginLeft)!==null&&j!==void 0?j:0)+(($=P.marginRight)!==null&&$!==void 0?$:0))):P.positionType===ri.inlineEnd&&(f.push(P),m=Math.max(m,((Y=P.height)!==null&&Y!==void 0?Y:0)+((G=P.marginLeft)!==null&&G!==void 0?G:0)+((tt=P.marginRight)!==null&&tt!==void 0?tt:0)))})}let _=1,b=n;if(i.isHeader(n,t)||!((r=i.getBodyColumnDefine(n,t))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const k=i.getCellRange(n,t);_=k.end.row-k.start.row+1,n=k.start.col,b=k.end.col}const y=Be(Mt("padding",d,n,t,i)),C=Mt("fontSize",d,n,t,i),S=Mt("fontStyle",d,n,t,i),w=Mt("fontWeight",d,n,t,i),x=(s=Mt("lineHeight",d,n,t,i))!==null&&s!==void 0?s:C,A=Mt("fontFamily",d,n,t,i),M=Mt("autoWrapText",d,n,t,i),T=Mt("lineClamp",d,n,t,i),R=Mt("underline",d,n,t,i),B=(o=Mt("underlineOffset",d,n,t,i))!==null&&o!==void 0?o:0;let E;if(e!=="text"&&e!=="link"&&e!=="progressbar"&&e!=="checkbox"&&e!=="radio"&&e!=="switch"&&e!=="button")l=x;else if(e==="checkbox")l=Lyt(h,n,t,b,d,M,c,C,S,w,A,x,T,y,i);else if(e==="radio")l=Iyt(h,n,t,b,d,M,c,C,S,w,A,x,T,y,i);else if(e==="switch")l=Oyt(h,n,t,b,d,M,c,C,S,w,A,x,T,y,i);else if(e==="button")l=Dyt(h,n,t,b,d,M,c,C,S,w,A,x,T,y,i);else{E=h;const k=G_(E,i).text,P=i.getColsWidth(n,b);if(g.length||f.length)if(M){const I=Object.assign({text:h==null?void 0:h.toString(),fontFamily:A,fontSize:C,fontStyle:S,fontWeight:w,lineHeight:x});I.textBaseline="middle";const O=[...g.map(H=>_x(H)),I,...f.map(H=>_x(H))];vN.setAttributes({width:P-(y[1]+y[3])-c,height:0,textConfig:O}),l=vN.AABBBounds.height()}else l=0,k.forEach((I,O)=>{var H;!((H=i.options.customConfig)===null||H===void 0)&&H.multilinesForXTable&&O!==0||(O===0&&g.length?l+=Math.max(x,p):O===k.length-1&&f.length?l+=Math.max(x,m):l+=x)});else if(M){const I=Hs(n,t,i),O=P-(y[1]+y[3])-c-I;l=(Dq({maxLineWidth:O,text:k,fontSize:C,fontStyle:S,fontWeight:w,fontFamily:A,lineHeight:x,wordBreak:"break-word",whiteSpace:k.length!==1||M?"normal":"no-wrap",lineClamp:T}).height()||(typeof x=="number"?x:C))+(R?B:0)}else l=!((a=i.options.customConfig)===null||a===void 0)&&a.multilinesForXTable?x:k.length*x}return(Math.max(l,u)+y[0]+y[2])/_}function Uyt(n,t,e){return{left:0,top:0,right:e.getColWidth(n),bottom:e.getRowHeight(t),width:e.getColWidth(n),height:0}}function Gd(n,t){if(!t||!t.proxy)return{colStart:0,colEnd:0,rowStart:0,rowEnd:0};const{mergeStartCol:e,mergeEndCol:i,mergeStartRow:r,mergeEndRow:s,col:o,row:a}=n;return{colStart:e,colEnd:i,rowStart:r,rowEnd:s}}function Yyt(n,t){const e=n.start.col,i=n.end.col,r=n.start.row,s=n.end.row;let o=e,a=i,l=r,h=s;for(let d=e;d<=i;d++)for(let u=r;u<=s;u++){const c=t.getCellRange(d,u);c&&(o=Math.min(o,c.start.col),a=Math.max(a,c.end.col),l=Math.min(l,c.start.row),h=Math.max(h,c.end.row))}return n.start.col=o,n.end.col=a,n.start.row=l,n.end.row=h,n}function _N(n,t,e,i){i||n.table._setRowHeight(t,n.table.getRowHeight(t)+e,!0);for(let o=0;o<n.table.colCount;o++){const a=n.getCell(o,t);if(a.role==="empty")continue;const l=un(n.table,o,t);l&&l.start.col!==o||(Fq(n,a,o,t,a.attribute.height+e,e,n.table.isHeader(o,t)),n.updateCellContentWhileResize(o,t))}let r=0,s=0;t<n.table.frozenRowCount?(r=t+1,s=n.table.frozenRowCount-1):t>=n.table.rowCount-n.table.bottomFrozenRowCount?(r=t+1,s=n.table.rowCount-1):(r=t+1,s=Math.min(n.proxy.rowEnd,n.table.rowCount-n.table.bottomFrozenRowCount-1));for(let o=0;o<n.table.colCount;o++)for(let a=r;a<=s;a++){const l=n.highPerformanceGetCell(o,a);l.role==="cell"&&l.setAttribute("y",l.attribute.y+e)}}function Fq(n,t,e,i,r,s,o){t&&Xyt(n,t,e,i,r,s)}function Xyt(n,t,e,i,r,s,o){var a,l,h,d,u;if(t.attribute.height===r&&!t.needUpdateHeight)return;t.needUpdateHeight=!1,t.setAttribute("height",r);const c=(a=n.table.getCellRawRecord(e,i))===null||a===void 0?void 0:a.vtableMerge,g=!!n.table.getCustomMerge(e,i),p=c||g?"text":n.table.isHeader(e,i)?(l=n.table._getHeaderLayoutMap(e,i).headerType)!==null&&l!==void 0?l:"text":(h=n.table.getBodyColumnType(e,i))!==null&&h!==void 0?h:"text";if(p==="progressbar"){const f=n.table.getBodyColumnDefine(e,i),m=n.table._getCellStyle(e,i),v=n.table.getCellValue(e,i),_=n.table.getCellOriginValue(e,i),b=Be(Mt("padding",m,e,i,n.table));let y;f!=null&&f.mergeCell&&(y=n.table.getCellRange(e,i));const C=Jt.getFunction("createProgressBarCell")(f,m,t.attribute.width,v,_,e,i,b,n.table,y),S=t.getChildByName("progress-bar");t.insertBefore(C,S),t.removeChild(S),S.removeAllChild(),S.release(),bN(t,r,s,n.table.isAutoRowHeight(i),!0,n.table)}else if(p==="sparkline"){t.removeAllChild();const f=n.table._getCellStyle(e,i),m=Be(Mt("padding",f,e,i,n.table));Jt.getFunction("createSparkLineCellGroup")(t,t.parent,t.attribute.x,t.attribute.y,e,i,t.attribute.width,t.attribute.height,m,n.table,Vd(f,n.table,e,i,Mt).theme,!1)}else if(p==="image"||p==="video")U_(t,e,i,0,s,n.table);else if(((d=t.firstChild)===null||d===void 0?void 0:d.name)==="axis")(u=t.firstChild)===null||u===void 0||u.originAxis.resize(t.attribute.width,t.attribute.height);else{let f=!0;const m=t.getChildByName(qa)||t.getChildByName(vx);if(m){let v;t.removeChild(m);const _=Cx(e,i,t,n.table);if(_)for(let b=_.start.row;b<=_.end.row;b++){if(b===i)continue;const y=n.getCell(e,b),C=y.getChildByName(qa)||y.getChildByName(vx);C.removeAllChild(),y.removeChild(C),Cx(e,b,y,n.table)}else{let b,y;const C=n.table.getCellLocation(e,i),{vtableMerge:S}=n.table.getCellRawRecord(e,i)||{};if(S&&n.table.options.groupTitleCustomLayout)y=n.table.options.groupTitleCustomLayout;else if(C!=="body"){const w=n.table.getHeaderDefine(e,i);b=w==null?void 0:w.headerCustomRender,y=w==null?void 0:w.headerCustomLayout}else{const w=n.table.getBodyColumnDefine(e,i);b=(w==null?void 0:w.customRender)||n.table.customRender,y=w==null?void 0:w.customLayout}if((b||y)&&ld(t))for(let w=t.mergeStartCol;w<=t.mergeEndCol;w++)for(let x=t.mergeStartRow;x<=t.mergeEndRow;x++)x!==i&&n.updateCellContent(w,x);if(y||b){const w=n.table._getCellStyle(e,i),x=Be(Mt("padding",w,e,i,n.table));let A=t.attribute.width,M=t.attribute.height;ld(t)&&(A=n.table.getColsWidth(t.mergeStartCol,t.mergeEndCol),M=n.table.getRowsHeight(t.mergeStartRow,t.mergeEndRow));const T=Rd(y,b,e,i,A,M,!1,n.table.isAutoRowHeight(i),x,ld(t)?{start:{col:t.mergeStartCol,row:t.mergeStartRow},end:{col:t.mergeEndCol,row:t.mergeEndRow}}:void 0,n.table);v=T.elementsGroup,f=T.renderDefault}t.childrenCount>0&&v?t.insertBefore(v,t.firstChild):v&&t.appendChild(v)}}bN(t,r,s,n.table.isAutoRowHeight(i),f,n.table)}}function bN(n,t,e,i,r,s){if(ld(n)){t=0;for(let d=n.mergeStartRow;d<=n.mergeEndRow;d++)t+=s.getRowHeight(d);const{colStart:o,colEnd:a,rowStart:l,rowEnd:h}=Gd(n,s.scenegraph);for(let d=o;d<=a;d++)for(let u=l;u<=h;u++){const c=s.scenegraph.getCell(d,u);if(c.role!=="cell")continue;if(c.forEachChildren(m=>{m.setAttributes({dx:0,dy:0})}),r){const m=s._getCellStyle(o,l),v=Be(Mt("padding",m,d,u,s));yx(c,t,e,i,v,m.textAlign,m.textBaseline,s)}const g=s.getRowHeight(u),p=s.getColWidth(d);c.contentHeight=t;const{widthChange:f}=sb(c,p,g,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},s);f&&(c.needUpdateWidth=!0)}}else{const o=s._getCellStyle(n.col,n.row),a=Be(Mt("padding",o,n.col,n.row,s));yx(n,t,e,i,a,o.textAlign,o.textBaseline,s)}}function Kyt(n,t,e,i){i||n.table._setColWidth(t,n.table.getColWidth(t)+e,!0);const r=n.getColGroup(t,!0),s=n.getColGroupInRightTopCorner(t);r&&!s&&dg(r,e,"col-corner",n),s&&dg(s,e,"right-top",n);const o=n.getColGroup(t);o&&dg(o,e,"row-body",n);const a=n.getColGroupInLeftBottomCorner(t);a&&dg(a,e,"left-bottom",n);const l=n.getColGroupInBottom(t);l&&dg(l,e,"bottom",n);const h=n.getColGroupInRightBottomCorner(t);h&&dg(h,e,"right-bottom",n),t<n.frozenColCount?(n.cornerHeaderGroup.forEachChildrenSkipChild((d,u)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),n.rowHeaderGroup.forEachChildrenSkipChild((d,u)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)})):(n.colHeaderGroup.forEachChildrenSkipChild((d,u)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),n.bodyGroup.forEachChildrenSkipChild((d,u)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)})),a&&n.leftBottomCornerGroup.forEachChildrenSkipChild((d,u)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),l&&n.bottomFrozenGroup.forEachChildrenSkipChild((d,u)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)}),h&&n.rightBottomCornerGroup.forEachChildrenSkipChild((d,u)=>{d.col>t&&d.setAttribute("x",d.attribute.x+e)})}function dg(n,t,e,i){var r,s,o,a,l,h,d;let u=!1;const c=(r=n==null?void 0:n.attribute.width)!==null&&r!==void 0?r:0;if(n==null||n.setAttribute("width",c+t),n==null||n.forEachChildren((g,p)=>{if(qyt(i,g,g.col,g.row,c,c+t,t,e!=="row-body"||g.col<i.table.rowHeaderLevelCount,i.table.internalProps.autoWrapText)){const f=un(i.table,g.col,g.row);if(f&&f.end.row-f.start.row)for(let m=f.start.row;m<=f.end.row;m++)CN(i,m);else CN(i,g.row);u=!0}}),u){let g,p,f,m=0;for(let v=0;v<i.table.colCount;v++){if(e==="col-corner"?(f=0,g=i.getColGroup(v,!0),p=(s=i.colHeaderGroup.attribute.height)!==null&&s!==void 0?s:0):e==="row-body"?(f=i.table.frozenRowCount,g=i.getColGroup(v,!1),p=(o=i.bodyGroup.attribute.height)!==null&&o!==void 0?o:0):e==="bottom"?(f=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInBottom(v),p=(a=i.bottomFrozenGroup.attribute.height)!==null&&a!==void 0?a:0):e==="left-bottom"?(f=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInLeftBottomCorner(v),p=(l=i.leftBottomCornerGroup.attribute.height)!==null&&l!==void 0?l:0):e==="right-top"?(f=0,g=i.getColGroupInRightTopCorner(v),p=(h=i.rightTopCornerGroup.attribute.height)!==null&&h!==void 0?h:0):e==="right-bottom"&&(f=i.table.rowCount-i.table.bottomFrozenRowCount,g=i.getColGroupInRightBottomCorner(v),p=(d=i.rightBottomCornerGroup.attribute.height)!==null&&d!==void 0?d:0),!g)continue;let _=0;g.forEachChildren(b=>{var y;b.setAttribute("y",_),_+=(y=i.table.getRowHeight(b.row))!==null&&y!==void 0?y:0}),m=_}i.updateContainerHeight(f,m-p);for(let v=0;v<i.table.frozenColCount;v++){const _=i.getColGroupInLeftBottomCorner(v);let b=0;_==null||_.forEachChildren(y=>{y.setAttribute("y",b),b+=i.table.getRowHeight(y.row)})}for(let v=i.table.colCount-i.table.rightFrozenColCount;v<i.table.colCount;v++){const _=i.getColGroupInRightBottomCorner(v);let b=0;_==null||_.forEachChildren(y=>{y.setAttribute("y",b),b+=i.table.getRowHeight(y.row)})}for(let v=i.table.frozenColCount;v<i.table.colCount-i.table.rightFrozenColCount;v++){const _=i.getColGroupInBottom(v);let b=0;_==null||_.forEachChildren(y=>{y.setAttribute("y",b),b+=i.table.getRowHeight(y.row)})}}}function qyt(n,t,e,i,r,s,o,a,l){var h,d,u,c,g,p,f;if(t.attribute.width===s&&!t.needUpdateWidth)return!1;t.needUpdateWidth=!1,t.setAttribute("width",s);const m=t;if(!m)return!1;const v=n.table.isAutoRowHeight(i),_=(h=n.table.getCellRawRecord(e,i))===null||h===void 0?void 0:h.vtableMerge,b=!!n.table.getCustomMerge(e,i),y=_||b?"text":n.table.isHeader(e,i)?(d=n.table._getHeaderLayoutMap(e,i).headerType)!==null&&d!==void 0?d:"text":(u=n.table.getBodyColumnType(e,i))!==null&&u!==void 0?u:"text";let C=!1;if(y==="progressbar"){const S=n.table.getBodyColumnDefine(e,i),w=n.table._getCellStyle(e,i),x=n.table.getCellValue(e,i),A=n.table.getCellOriginValue(e,i),M=Be(Mt("padding",w,e,i,n.table));let T;S!=null&&S.mergeCell&&(T=n.table.getCellRange(e,i));const R=Jt.getFunction("createProgressBarCell")(S,w,m.attribute.width,x,A,e,i,M,n.table,T),B=m.getChildByName("progress-bar");m.insertBefore(R,B),m.removeChild(B),B.removeAllChild(),B.release();const E=yN(m,s,o,v,!0,n.table);C=C||E}else if(y==="sparkline"){m.removeAllChild();const S=n.table._getCellStyle(e,i),w=Be(Mt("padding",S,e,i,n.table));Jt.getFunction("createSparkLineCellGroup")(m,m.parent,m.attribute.x,m.attribute.y,e,i,m.attribute.width,m.attribute.height,w,n.table,Vd(S,n.table,e,i,Mt).theme,!1)}else if(y==="image"||y==="video")U_(m,e,i,o,0,n.table);else if(((c=m.firstChild)===null||c===void 0?void 0:c.name)==="axis"){const S=n.table.internalProps.layoutMap.getAxisConfigInPivotChart(e,i),w=n.table._getCellStyle(e,i),x=Be(Mt("padding",w,e,i,n.table));if(S){const A=new(Jt.getComponent("axis"))(S,m.attribute.width,m.attribute.height,(g=S.__vtablePadding)!==null&&g!==void 0?g:x,n.table);m.clear(),m.appendChild(A.component),A.overlap()}}else if(((p=t.firstChild)===null||p===void 0?void 0:p.name)==="axis")(f=t.firstChild)===null||f===void 0||f.originAxis.resize(t.attribute.width,t.attribute.height);else{let S=!0;const w=t.getChildByName(qa)||t.getChildByName(vx);if(w){let A;t.removeChild(w);const M=Cx(e,i,t,n.table);if(M)for(let T=M.start.col;T<=M.end.col;T++){if(T===e)continue;const R=n.getCell(T,i),B=R.getChildByName(qa)||R.getChildByName(vx);B.removeAllChild(),R.removeChild(B),Cx(T,i,R,n.table)}else{let T,R;const B=n.table.getCellLocation(e,i),{vtableMerge:E}=n.table.getCellRawRecord(e,i)||{};if(E&&n.table.options.groupTitleCustomLayout)R=n.table.options.groupTitleCustomLayout;else if(B!=="body"){const k=n.table.getHeaderDefine(e,i);T=k==null?void 0:k.headerCustomRender,R=k==null?void 0:k.headerCustomLayout}else{const k=n.table.getBodyColumnDefine(e,i);T=(k==null?void 0:k.customRender)||n.table.customRender,R=k==null?void 0:k.customLayout}if((T||R)&&ld(m)){for(let k=m.mergeStartCol;k<=m.mergeEndCol;k++)if(k!==e)for(let P=m.mergeStartRow;P<=m.mergeEndRow;P++)n.updateCellContent(k,P)}if(R||T){const k=n.table._getCellStyle(e,i),P=Be(Mt("padding",k,e,i,n.table));let I=m.attribute.width,O=m.attribute.height;ld(m)&&(I=n.table.getColsWidth(m.mergeStartCol,m.mergeEndCol),O=n.table.getRowsHeight(m.mergeStartRow,m.mergeEndRow));const H=Rd(R,T,e,i,I,O,!1,n.table.isAutoRowHeight(i),P,ld(m)?{start:{col:m.mergeStartCol,row:m.mergeStartRow},end:{col:m.mergeEndCol,row:m.mergeEndRow}}:void 0,n.table);A=H.elementsGroup,S=H.renderDefault,C=!0}t.childrenCount>0&&A?t.insertBefore(A,t.firstChild):A&&t.appendChild(A)}}const x=yN(m,s,o,v,S,n.table);C=C||x}return l||(l=n.table._getCellStyle(e,i).autoWrapText),!(!v||!l)&&C}function yN(n,t,e,i,r,s){if(ld(n)){t=0;let d=!1;for(let m=n.mergeStartCol;m<=n.mergeEndCol;m++)t+=s.getColWidth(m);let u=0;for(let m=n.mergeStartRow;m<=n.mergeEndRow;m++)u+=s.getRowHeight(m);const{colStart:c,colEnd:g,rowStart:p,rowEnd:f}=Gd(n,s.scenegraph);for(let m=c;m<=g;m++)for(let v=p;v<=f;v++){if(m===n.col&&v!==n.row)continue;const _=s.scenegraph.getCell(m,v);if(_.role!=="cell")continue;_.forEachChildren(w=>{w.setAttributes({dx:0,dy:0})});let b=!1;if(r){const w=s._getCellStyle(c,p),x=Be(Mt("padding",w,m,v,s)),A=w.textAlign,M=w.textBaseline;b=bx(_,t,u,e,i,x,A,M,s.scenegraph);const T=Hs(_.col,_.row,s);if(T){const R=_.getChildByName("text"),B=_.getChildByName("expand")||_.getChildByName("collapse");(B==null?void 0:B.role)!=="icon-left"&&R&&R.setAttribute("dx",T)}}const y=s.getRowHeight(v),C=s.getColWidth(m);_.contentWidth=t;const{heightChange:S}=sb(_,C,y,{start:{col:n.mergeStartCol,row:n.mergeStartRow},end:{col:n.mergeEndCol,row:n.mergeEndRow}},s);S&&(_.needUpdateHeight=!0),d=d||b}return d}const o=s._getCellStyle(n.col,n.row),a=Be(Mt("padding",o,n.col,n.row,s)),l=o.textAlign,h=o.textBaseline;return bx(n,t,s.getRowHeight(n.row),e,i,a,l,h,s.scenegraph)}function CN(n,t){const e=Math.round(no(t,0,n.table.colCount-1,n.table));n.table._setRowHeight(t,e,!0);for(let i=0;i<n.table.colCount;i++){const r=e,s=n.highPerformanceGetCell(i,t);s.role!=="empty"&&Fq(n,s,i,t,r,r-s.attribute.height,n.table.isHeader(i,t))}}var Bs;(function(n){n.dropDown="dropDown",n.contextmenu="contextmenu",n.custom="custom"})(Bs||(Bs={}));const zi={fontSize:12,fontFamily:"Arial,sans-serif",color:"#000",highlightColor:"#2E68CF",hoverBgColor:"#EEE",lineHeight:30,bgColor:"#FFF",cornerRadius:4,borderWidth:.5,borderColor:"#CCC",menuPadding:6,menuItemPadding:9,maxLineWidth:200};let Zyt=class{constructor(t){this._table=t,this._menuInstance=new De({x:0,y:0,fill:zi.bgColor,stroke:zi.borderColor,cornerRadius:zi.cornerRadius,lineWidth:zi.borderWidth}),this._menuInfo={x:-1,y:-1,col:-1,row:-1,type:Bs.dropDown,menuInfo:[],highlightIndex:-1}}bindTableComponent(t){t.appendChild(this._menuInstance),this.bindEvent()}release(){}attach(t,e,i,r,s,o){if(s===Bs.dropDown&&this.checkDropDownMenuChange(i,r)){const a=this.getMenuInfo(i,r,s);if(!a)return;const{menuInfo:l,highlightIndex:h}=a;this.updateMenuInfo(i,r,s,l,h),this.updateMenuInstance(l,h)}else if(s===Bs.contextmenu&&this.checkContextMenuChange(t,e)){const a=this.getMenuInfo(i,r,s);if(!a)return;const{menuInfo:l,highlightIndex:h}=a;this.updateMenuInfo(i,r,s,l,h),this.updateMenuInstance(l,h)}this.updatePosition(t-this._table.scenegraph.x,e-this._table.scenegraph.y),this.addToScene()}updateMenuInfo(t,e,i,r,s){this._menuInfo.col=t,this._menuInfo.row=e,this._menuInfo.type=i,this._menuInfo.menuInfo=r,this._menuInfo.highlightIndex=s}checkDropDownMenuChange(t,e){const{type:i,col:r,row:s}=this._menuInfo;return i!==Bs.dropDown||t!==r||e!==s}checkContextMenuChange(t,e){var i;const{type:r,menuInfo:s}=this._menuInfo;return r!==Bs.contextmenu||s!==((i=this._table.internalProps.menu)===null||i===void 0?void 0:i.contextMenuItems)}updateMenuInstance(t,e){this._menuInstance.removeAllChild();let i=zi.menuPadding;const r=zi.menuPadding;let s=0;t.forEach((o,a)=>{var l,h;const d=e===a;let u,c;typeof o=="string"?c=o:typeof o=="object"&&(c=o.text,u=d?o.selectedIcon:o.icon);const g=new De({y:i,x:r,height:zi.lineHeight,fill:zi.bgColor});g.role="menu-item",this._menuInstance.appendChild(g),g.stateProxy=f=>f==="hover"?{fill:zi.hoverBgColor}:{fill:zi.bgColor},g.addEventListener("pointerenter",f=>{g.addState("hover",!0,!1),this._table.scenegraph.updateNextFrame()}),g.addEventListener("pointerleave",f=>{g.removeState("hover",!1),this._table.scenegraph.updateNextFrame()});const p=new Wn({x:zi.menuItemPadding,y:zi.menuItemPadding,fill:d?zi.highlightColor:zi.color,text:c,textBaseline:"top",fontSize:zi.fontSize,fontFamily:zi.fontFamily,pickable:!1,maxLineWidth:zi.maxLineWidth,ellipsis:""});if(g.addChild(p),u){p.AABBBounds.height();const f=(l=u.width)!==null&&l!==void 0?l:16,m=(h=u.height)!==null&&h!==void 0?h:16,v=new vc({x:zi.menuItemPadding,y:(zi.lineHeight-m)/2,width:f,height:m,image:u.svg,pickable:!1});v.role="menu-icon",g.insertBefore(v,p),p.setAttribute("x",f+zi.menuItemPadding)}s=Math.max(g.AABBBounds.width(),s),i+=zi.lineHeight}),this._menuInstance.setAttributes({width:s+2*zi.menuItemPadding+2*zi.menuPadding,height:i+zi.menuPadding}),this._menuInstance.forEachChildren(o=>{o.setAttribute("width",s+2*zi.menuItemPadding)})}updatePosition(t,e){this._menuInstance.setAttributes({x:this._menuInfo.type===Bs.dropDown?t-this._menuInstance.attribute.width:t,y:e}),this._menuInfo.x=Bs.dropDown?t-this._menuInstance.attribute.width:t,this._menuInfo.y=e}addToScene(){this._table.scenegraph.updateNextFrame()}detach(){this._menuInstance.setAttributes({x:-1e3,y:-1e3}),this._table.scenegraph.updateNextFrame()}getMenuInfo(t,e,i){var r;if(i===Bs.dropDown){let s=this._table.globalDropDownMenu;s=this._table._getHeaderLayoutMap(t,e).dropDownMenu,typeof s=="function"&&(s=s({row:e,col:t,table:this._table}));let o=-1;if(Array.isArray(s)){for(let a=0;a<s.length;a++)if(this._table._dropDownMenuIsHighlight(t,e,a)){o=a;break}}return{menuInfo:s,highlightIndex:o}}if(i===Bs.contextmenu){const s=(r=this._table.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems;let o;if(Array.isArray(s))o=s;else if(typeof s=="function"){const{field:a}=this._table.isHeader(t,e)?this._table.getHeaderDefine(t,e):this._table.getBodyColumnDefine(t,e);o=s(a,e,t)}return{menuInfo:o,highlightIndex:-1}}}bindEvent(){this._menuInstance.addEventListener("click",t=>{const{target:e}=t;if(e&&e.role==="menu-item"){const i=this.getEventInfo(e),r=this._table.getMenuInfo(this._menuInfo.col,this._menuInfo.row,this._menuInfo.type),s=Object.assign(i,r);s.event=t.nativeEvent,this._table.fireListeners(mt.DROPDOWN_MENU_CLICK,s)}})}getEventInfo(t){const e=t.parent;let i=0;e.forEachChildren((o,a)=>o===t&&(i=a-1,!0));const r=typeof this._menuInfo.menuInfo[i]=="string"?this._menuInfo.menuInfo[i]:this._menuInfo.menuInfo[i].text,s=typeof this._menuInfo.menuInfo[i]=="string"?r:this._menuInfo.menuInfo[i].menuKey||r;return{col:this._menuInfo.col,row:this._menuInfo.row,dropDownIndex:i,highlight:i===this._menuInfo.highlightIndex,text:r,menuKey:s}}get bounds(){return this._menuInstance.globalAABBBounds}};const WR=ra();class Jyt{constructor(){const t=WR.drillDown;this.icon=new vc({x:-1e3,y:-1e3,image:t.svg,width:t.width,height:t.height,dx:-t.width/2,dy:-t.height/2,visible:!1,funcType:t.funcType,cursor:t.cursor}),this.icon.role="icon-drill"}appand(t){t.appendChild(this.icon)}update(t,e,i,r,s,o){if(!t||r&&s)return this.icon.setAttributes({x:-1e3,y:-1e3,visible:!1}),void o.updateNextFrame();const a=WR.drillDown,l=WR.drillUp;this.icon.setAttributes({x:e,y:i,image:r?a.svg:l.svg,visible:!0}),this.icon.loadImage(this.icon.attribute.image),o.updateNextFrame()}}class Qyt{constructor(t){const e=t.theme.dragHeaderSplitLine.lineWidth,i=t.theme.dragHeaderSplitLine.lineColor,r=t.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel=Zp({visible:!1,pickable:!1,x:0,y:0,symbolType:"triangle",fill:i}),this.columnMoverLine=Os({visible:!1,pickable:!1,stroke:i,lineWidth:e,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnMoverBack=wi({visible:!1,pickable:!1,fill:r,x:0,y:0,width:0,height:0}),this.table=t}appand(t){t.appendChild(this.columnMoverLabel),t.appendChild(this.columnMoverLine),t.appendChild(this.columnMoverBack)}show(t,e,i){const r=this.table.getCellLocation(t,e),s=un(this.table,t,e);s&&(t=s.start.col,e=s.start.row);let o=0,a=0,l=0,h=0,d=0,u=0,c=0,g=0,p=Math.PI;const f=[];return r==="columnHeader"?(o=this.table.getColsWidth(0,t-1)-this.table.stateManager.scroll.horizontalBarPos,a=this.table.getRowsHeight(0,this.table.frozenRowCount-1),h=this.table.tableNoFrameHeight,l=s?this.table.getColsWidth(s.start.col,s.end.col):this.table.getColWidth(t),d=o-i,c=o+l,g=2,f.push({x:0,y:0}),f.push({x:0,y:this.table.tableNoFrameHeight})):(r==="rowHeader"||this.table.internalProps.layoutMap.isSeriesNumberInBody(t,e))&&(a=this.table.getRowsHeight(0,e-1)-this.table.stateManager.scroll.verticalBarPos,o=this.table.getColsWidth(0,this.table.frozenColCount-1),l=this.table.tableNoFrameWidth,h=s?this.table.getRowsHeight(s.start.row,s.end.row):this.table.getRowHeight(e),u=a-i,c=2,g=a+h,p=Math.PI/2,f.push({x:0,y:0}),f.push({x:this.table.tableNoFrameWidth,y:0})),this.columnMoverBack.setAttributes({visible:!0,x:o-d,y:a-u,width:l,height:h,dx:d,dy:u}),this.columnMoverLine.setAttributes({x:c,y:g,visible:!0,points:f}),this.columnMoverLabel.setAttributes({visible:!0,x:c,y:g,angle:p}),{backX:o-d,lineX:c,backY:a-u,lineY:g}}hide(){this.columnMoverLabel.setAttribute("visible",!1),this.columnMoverLine.setAttribute("visible",!1),this.columnMoverBack.setAttribute("visible",!1)}update(t,e,i,r){typeof t=="number"&&typeof e=="number"?(this.columnMoverLabel.setAttribute("x",e),this.columnMoverLine.setAttribute("x",e),this.columnMoverBack.setAttribute("x",t)):typeof i=="number"&&typeof r=="number"&&(this.columnMoverLabel.setAttribute("y",r),this.columnMoverLine.setAttribute("y",r),this.columnMoverBack.setAttribute("y",i))}updateStyle(){const t=this.table.theme.dragHeaderSplitLine.lineWidth,e=this.table.theme.dragHeaderSplitLine.lineColor,i=this.table.theme.dragHeaderSplitLine.shadowBlockColor;this.columnMoverLabel.setAttributes({fill:e}),this.columnMoverLine.setAttributes({stroke:e,lineWidth:t}),this.columnMoverBack.setAttributes({fill:i})}}function Sy(n,t,e){if(e)return Math.min(t.tableNoFrameWidth,t.getAllColsWidth())-t.getColsWidth(n,t.colCount-1);let i=t.getColsWidth(0,n);return n>=t.frozenColCount&&(i-=t.scrollLeft),i}function SN(n,t,e){if(e)return Math.min(t.tableNoFrameWidth,t.getAllRowsHeight())-t.getRowsHeight(n,t.rowCount-1);let i=t.getRowsHeight(0,n);return n>=t.frozenRowCount&&(i-=t.scrollTop),i}class tCt{constructor(t){var e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y;this.table=t;const C=this.table.theme;this.createScrollBar();const S=(e=C.columnResize)===null||e===void 0?void 0:e.lineColor,w=(i=C.columnResize)===null||i===void 0?void 0:i.lineWidth,x=(r=C.columnResize)===null||r===void 0?void 0:r.bgColor,A=(s=C.columnResize)===null||s===void 0?void 0:s.width,M=(a=(o=C.columnResize)===null||o===void 0?void 0:o.labelVisible)===null||a===void 0||a,T=(l=C.columnResize)===null||l===void 0?void 0:l.labelColor,R=(h=C.columnResize)===null||h===void 0?void 0:h.labelFontSize,B=(d=C.columnResize)===null||d===void 0?void 0:d.labelFontFamily,E=(u=C.columnResize)===null||u===void 0?void 0:u.labelBackgroundFill,k=(c=C.columnResize)===null||c===void 0?void 0:c.labelBackgroundCornerRadius;this.labelVisible=M,this.columnResizeLine=Os({visible:!1,pickable:!1,stroke:S,lineWidth:w,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.columnResizeBgLine=Os({visible:!1,pickable:!1,stroke:x,lineWidth:A,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const P=UP({visible:!1,pickable:!1,x:0,y:0,fontSize:R,fill:T,fontFamily:B,text:"",textBaseline:"top",dx:16,dy:-R/2}),I=wi({visible:!1,pickable:!1,fill:E,x:0,y:0,width:5*R*.8,height:R+8,cornerRadius:k,dx:12,dy:-R/2-4});this.columnResizeLabel=fS({visible:!1,pickable:!1,x:0,y:0}),this.columnResizeLabel.appendChild(I),this.columnResizeLabel.appendChild(P),this.rowResizeLine=Os({visible:!1,pickable:!1,stroke:S,lineWidth:w,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]}),this.rowResizeBgLine=Os({visible:!1,pickable:!1,stroke:x,lineWidth:A,x:0,y:0,points:[{x:0,y:0},{x:0,y:0}]});const O=UP({visible:!1,pickable:!1,x:0,y:0,fontSize:R,fill:T,fontFamily:B,text:"",textBaseline:"top",dx:16,dy:-R/2}),H=wi({visible:!1,pickable:!1,fill:E,x:0,y:0,width:5*R*.8,height:R+8,cornerRadius:k,dx:12,dy:-R/2-4});this.rowResizeLabel=fS({visible:!1,pickable:!1,x:0,y:0}),this.rowResizeLabel.appendChild(H),this.rowResizeLabel.appendChild(O),this.cellMover=new Qyt(this.table);const z=(p=(g=C.frozenColumnLine)===null||g===void 0?void 0:g.shadow)===null||p===void 0?void 0:p.width,F=(m=(f=C.frozenColumnLine)===null||f===void 0?void 0:f.shadow)===null||m===void 0?void 0:m.startColor,j=(_=(v=C.frozenColumnLine)===null||v===void 0?void 0:v.shadow)===null||_===void 0?void 0:_.endColor,$=(y=(b=C.frozenColumnLine)===null||b===void 0?void 0:b.shadow)===null||y===void 0?void 0:y.visible;this.frozenShadowLine=wi({visible:$==="always",pickable:!1,x:0,y:0,width:z,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:F,offset:0},{color:j,offset:1}]}}),this.rightFrozenShadowLine=wi({visible:$==="always",pickable:!1,x:0,y:0,width:z,height:0,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:j,offset:0},{color:F,offset:1}]}}),this.menu=new Zyt(this.table),this.drillIcon=new Jyt}addToGroup(t){t.addChild(this.frozenShadowLine),t.addChild(this.rightFrozenShadowLine),t.addChild(this.columnResizeBgLine),t.addChild(this.columnResizeLine),t.addChild(this.columnResizeLabel),t.addChild(this.rowResizeBgLine),t.addChild(this.rowResizeLine),t.addChild(this.rowResizeLabel),this.table.theme.scrollStyle.hoverOn&&!this.table.theme.scrollStyle.barToSide?(t.addChild(this.hScrollBar),t.addChild(this.vScrollBar)):(t.stage.defaultLayer.addChild(this.hScrollBar),t.stage.defaultLayer.addChild(this.vScrollBar)),this.menu.bindTableComponent(t),this.drillIcon.appand(t),this.cellMover.appand(t)}createScrollBar(){var t,e,i,r,s,o;const a=this.table.theme,l=(t=a.scrollStyle)===null||t===void 0?void 0:t.scrollRailColor,h=(e=a.scrollStyle)===null||e===void 0?void 0:e.scrollSliderColor,d=(i=a.scrollStyle)===null||i===void 0?void 0:i.scrollSliderCornerRadius,u=(r=a.scrollStyle)===null||r===void 0?void 0:r.width,c=(s=a.scrollStyle)===null||s===void 0?void 0:s.horizontalPadding,g=(o=a.scrollStyle)===null||o===void 0?void 0:o.verticalPadding;let p;p=L(d)?{cornerRadius:d,fill:h}:{fill:h},this.hScrollBar=new W_({direction:"horizontal",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:this.table.tableNoFrameWidth,height:u,padding:c,railStyle:{fill:l},sliderStyle:p,range:[0,.1],visible:!1}),this.hScrollBar.render(),this.hScrollBar.hideAll(),this.vScrollBar=new W_({direction:"vertical",x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:u,height:this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight(),padding:g,railStyle:{fill:l},sliderStyle:p,range:[0,.1],visible:!1}),this.vScrollBar.render(),this.vScrollBar.hideAll()}updateScrollBar(){var t,e,i,r,s,o,a;const l=this.table.stateManager.scroll.horizontalBarPos,h=this.table.stateManager.scroll.verticalBarPos,d=this.table.theme,u=(t=d.scrollStyle)===null||t===void 0?void 0:t.width,c=(e=d.scrollStyle)===null||e===void 0?void 0:e.visible,g=(r=(i=d.scrollStyle)===null||i===void 0?void 0:i.horizontalVisible)!==null&&r!==void 0?r:c,p=(o=(s=d.scrollStyle)===null||s===void 0?void 0:s.verticalVisible)!==null&&o!==void 0?o:c,f=Math.ceil(this.table.scenegraph.tableGroup.attribute.width),m=Math.ceil(this.table.scenegraph.tableGroup.attribute.height),v=this.table.getAllRowsHeight(),_=this.table.getAllColsWidth(),b=this.table.getFrozenRowsHeight(),y=this.table.getFrozenColsWidth(),C=this.table.getBottomFrozenRowsHeight(),S=this.table.getRightFrozenColsWidth(),w=!((a=this.table.options.customConfig)===null||a===void 0)&&a._disableColumnAndRowSizeRound?1:0;if(_>f+w){const x=Math.min(m,v),A=Math.max(.05,(f-y)/(_-y)),M=this.table.theme.scrollStyle.hoverOn;let T=0;T=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameHeight-(M?u:-this.table.scenegraph.tableGroup.attribute.y)+this.table.tableY:x-(M?u:-this.table.scenegraph.tableGroup.attribute.y),this.hScrollBar.setAttributes({x:y+(M?0:this.table.scenegraph.tableGroup.attribute.x),y:T,width:f-y-S,range:[0,A],visible:g==="always"});const R=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:R.x1,y:R.y1},g==="always"&&this.hScrollBar.showAll()}else this.hScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,width:0,visible:!1});if(v>m+w){const x=Math.min(f,_),A=Math.max(.05,(m-b)/(v-b));let M=0;const T=this.table.theme.scrollStyle.hoverOn;M=this.table.theme.scrollStyle.barToSide?this.table.tableNoFrameWidth-(T?u:-this.table.scenegraph.tableGroup.attribute.x)+this.table.tableX:x-(T?u:-this.table.scenegraph.tableGroup.attribute.x),this.vScrollBar.setAttributes({x:M,y:b+(T?0:this.table.scenegraph.tableGroup.attribute.y),height:m-b-C,range:[0,A],visible:p==="always"});const R=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:R.x1,y:R.y1},p==="always"&&this.vScrollBar.showAll()}else this.vScrollBar.setAttributes({x:2*-this.table.tableNoFrameWidth,y:2*-this.table.tableNoFrameHeight,height:0,visible:!1});this.table.stateManager.setScrollLeft(l),this.table.stateManager.setScrollTop(h)}hideResizeCol(){this.columnResizeLine.setAttribute("visible",!1),this.columnResizeBgLine.setAttribute("visible",!1),this.columnResizeLabel.setAttribute("visible",!1),this.columnResizeLabel.hideAll()}showResizeCol(t,e,i){const r=Sy(t,this.table,i);this.columnResizeLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({visible:!0,x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.showAll(),this.columnResizeLabel.setAttributes({visible:!0,x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${this.table.getColWidth(t)}px`))}updateResizeCol(t,e,i){const r=Sy(t,this.table,i);this.columnResizeLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.columnResizeBgLine.setAttributes({x:r,points:[{x:0,y:0},{x:0,y:this.table.getRowsHeight(0,this.table.rowCount-1)}]}),this.labelVisible&&(this.columnResizeLabel.setAttributes({x:r,y:e}),this.columnResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getColWidth(t))}px`))}hideResizeRow(){this.rowResizeLine.setAttribute("visible",!1),this.rowResizeBgLine.setAttribute("visible",!1),this.rowResizeLabel.setAttribute("visible",!1),this.rowResizeLabel.hideAll()}showResizeRow(t,e,i){const r=SN(t,this.table,i);this.rowResizeLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({visible:!0,y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.showAll(),this.rowResizeLabel.setAttributes({visible:!0,y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${this.table.getRowHeight(t)}px`))}updateResizeRow(t,e,i){const r=SN(t,this.table,i);this.rowResizeLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.rowResizeBgLine.setAttributes({y:r,points:[{y:0,x:0},{y:0,x:this.table.getColsWidth(0,this.table.colCount-1)}]}),this.labelVisible&&(this.rowResizeLabel.setAttributes({y:r,x:e}),this.rowResizeLabel.lastChild.setAttribute("text",`${Math.floor(this.table.getRowHeight(t))}px`))}hideMoveCol(){this.cellMover.hide()}showMoveCol(t,e,i){return this.cellMover.show(t,e,i)}updateMoveCol(t,e,i,r){this.cellMover.update(t,e,i,r)}setFrozenColumnShadow(t,e){var i,r;const s=Sy(t,this.table,e);t<0||((r=(i=this.table.theme.frozenColumnLine)===null||i===void 0?void 0:i.shadow)===null||r===void 0?void 0:r.visible)!=="always"?this.frozenShadowLine.setAttributes({visible:!1,x:s,height:this.table.getDrawRange().height}):this.frozenShadowLine.setAttributes({visible:!0,x:s,height:this.table.getDrawRange().height})}setRightFrozenColumnShadow(t){var e,i;const r=Sy(t,this.table,!0);t>=this.table.colCount||((i=(e=this.table.theme.frozenColumnLine)===null||e===void 0?void 0:e.shadow)===null||i===void 0?void 0:i.visible)!=="always"?this.rightFrozenShadowLine.setAttributes({visible:!1,x:r-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height}):this.rightFrozenShadowLine.setAttributes({visible:!0,x:r-this.rightFrozenShadowLine.attribute.width,height:this.table.getDrawRange().height})}hideFrozenColumnShadow(){var t,e,i,r,s;const o=(e=(t=this.table.theme.frozenColumnLine)===null||t===void 0?void 0:t.shadow)===null||e===void 0?void 0:e.visible;((s=(r=(i=this.table.theme.frozenColumnLine)===null||i===void 0?void 0:i.shadow)===null||r===void 0?void 0:r.visible)!==null&&s!==void 0?s:o)==="scrolling"&&(this.frozenShadowLine.setAttribute("visible",!1),this.rightFrozenShadowLine.setAttribute("visible",!1),this.table.scenegraph.updateNextFrame())}showFrozenColumnShadow(){var t,e,i,r,s;const o=(e=(t=this.table.theme.frozenColumnLine)===null||t===void 0?void 0:t.shadow)===null||e===void 0?void 0:e.visible;((s=(r=(i=this.table.theme.frozenColumnLine)===null||i===void 0?void 0:i.shadow)===null||r===void 0?void 0:r.visible)!==null&&s!==void 0?s:o)==="scrolling"&&(this.frozenShadowLine.setAttribute("visible",!0),this.rightFrozenShadowLine.setAttribute("visible",!0),this.table.scenegraph.updateNextFrame())}hideVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.verticalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.vScrollBar.setAttribute("visible",!1),this.vScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showVerticalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.verticalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.vScrollBar.setAttribute("visible",!0),this.vScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}hideHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.horizontalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.hScrollBar.setAttribute("visible",!1),this.hScrollBar.hideAll(),this.table.scenegraph.updateNextFrame())}showHorizontalScrollBar(){var t;const e=this.table.theme.scrollStyle.visible,i=(t=this.table.theme.scrollStyle.horizontalVisible)!==null&&t!==void 0?t:e;i!=="focus"&&i!=="scrolling"||(this.hScrollBar.setAttribute("visible",!0),this.hScrollBar.showAll(),this.table.scenegraph.updateNextFrame())}updateVerticalScrollBarPos(t){const e=this.vScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.vScrollBar.setAttribute("range",[r,r+i]);const s=this.vScrollBar.AABBBounds&&this.vScrollBar.globalAABBBounds;this.vScrollBar._viewPosition={x:s.x1,y:s.y1}}updateHorizontalScrollBarPos(t){const e=this.hScrollBar.attribute.range,i=e[1]-e[0],r=t*(1-i);this.hScrollBar.setAttribute("range",[r,r+i]);const s=this.hScrollBar.AABBBounds&&this.hScrollBar.globalAABBBounds;this.hScrollBar._viewPosition={x:s.x1,y:s.y1}}updateStyle(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w;const x=this.table.theme,A=(t=x.scrollStyle)===null||t===void 0?void 0:t.scrollRailColor,M=(e=x.scrollStyle)===null||e===void 0?void 0:e.scrollSliderColor,T=(i=x.scrollStyle)===null||i===void 0?void 0:i.scrollSliderCornerRadius,R=(r=x.scrollStyle)===null||r===void 0?void 0:r.width,B=(s=x.scrollStyle)===null||s===void 0?void 0:s.horizontalPadding,E=(o=x.scrollStyle)===null||o===void 0?void 0:o.verticalPadding;let k;k=L(T)?{cornerRadius:T,fill:M}:{fill:M},this.hScrollBar.setAttributes({height:R,padding:B,railStyle:{fill:A},sliderStyle:k}),this.vScrollBar.setAttributes({width:R,padding:E,railStyle:{fill:A},sliderStyle:k});const P=(a=x.columnResize)===null||a===void 0?void 0:a.lineColor,I=(l=x.columnResize)===null||l===void 0?void 0:l.lineWidth,O=(h=x.columnResize)===null||h===void 0?void 0:h.bgColor,H=(d=x.columnResize)===null||d===void 0?void 0:d.width;this.columnResizeLine.setAttributes({stroke:P,lineWidth:I}),this.columnResizeBgLine=Os({stroke:O,lineWidth:H});const z=(u=x.columnResize)===null||u===void 0?void 0:u.labelColor,F=(c=x.columnResize)===null||c===void 0?void 0:c.labelFontSize,j=(g=x.columnResize)===null||g===void 0?void 0:g.labelFontFamily,$=(p=x.columnResize)===null||p===void 0?void 0:p.labelBackgroundFill,Y=(f=x.columnResize)===null||f===void 0?void 0:f.labelBackgroundCornerRadius,G=(v=(m=x.columnResize)===null||m===void 0?void 0:m.labelVisible)===null||v===void 0||v;this.labelVisible=G,this.columnResizeLabel.lastChild.setAttributes({fontSize:F,fill:z,fontFamily:j,dy:-F/2}),this.columnResizeLabel.firstChild.setAttributes({fill:$,width:5*F*.8,height:F+8,cornerRadius:Y,dy:-F/2-4}),this.rowResizeLabel.lastChild.setAttributes({fontSize:F,fill:z,fontFamily:j,dy:-F/2}),this.rowResizeLabel.firstChild.setAttributes({fill:$,width:5*F*.8,height:F+8,cornerRadius:Y,dy:-F/2-4});const tt=(b=(_=x.frozenColumnLine)===null||_===void 0?void 0:_.shadow)===null||b===void 0?void 0:b.width,st=(C=(y=x.frozenColumnLine)===null||y===void 0?void 0:y.shadow)===null||C===void 0?void 0:C.startColor,ot=(w=(S=x.frozenColumnLine)===null||S===void 0?void 0:S.shadow)===null||w===void 0?void 0:w.endColor;this.frozenShadowLine.setAttributes({width:tt,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:st,offset:0},{color:ot,offset:1}]}}),this.rightFrozenShadowLine.setAttributes({width:tt,fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:[{color:ot,offset:0},{color:st,offset:1}]}}),this.cellMover.updateStyle()}}function Io(n,t,e,i,r){var s,o,a,l,h,d;if(!t)return;const u=e==="table",{shadowBlur:c,shadowOffsetX:g,shadowOffsetY:p,shadowColor:f,cornerRadius:m,borderColor:v,borderLineWidth:_,borderLineDash:b}=t;let y=!1;const C={},S={pickable:!1};c&&u&&(S.shadowBlur=c,S.shadowOffsetX=g,S.shadowOffsetY=p,S.shadowColor=f,S.stroke=!0,S.stroke=f,S.lineWidth=1,y=!0),_&&(S.stroke=!0,S.fill=!1,S.stroke=dD(v??"#E1E4E8",i,_),S.lineWidth=_,b&&(S.lineDash=b),S.lineCap="butt"),Array.isArray(v)&&(S.strokeArrayColor=Be(v)),Array.isArray(_)&&(S.strokeArrayWidth=Be(_),S.lineWidth=1),m&&(S.cornerRadius=m,C.cornerRadius=m);const w=S.strokeArrayWidth?S.strokeArrayWidth[0]:(s=S.lineWidth)!==null&&s!==void 0?s:0,x=S.strokeArrayWidth?S.strokeArrayWidth[1]:(o=S.lineWidth)!==null&&o!==void 0?o:0,A=S.strokeArrayWidth?S.strokeArrayWidth[2]:(a=S.lineWidth)!==null&&a!==void 0?a:0,M=S.strokeArrayWidth?S.strokeArrayWidth[3]:(l=S.lineWidth)!==null&&l!==void 0?l:0;if(n.setAttributes(C),!r)if(S.stroke)if(S.x=M/2,S.y=w/2,S.pickable=!1,u){if(m)if(Array.isArray(m)){const B=Be(m);S.cornerRadius=B,C.cornerRadius=B,B[0]&&(B[0]=B[0]+Math.min(M,w)/2),B[1]&&(B[1]=B[1]+Math.min(w,x)/2),B[2]&&(B[2]=B[2]+Math.min(x,A)/2),B[3]&&(B[3]=B[3]+Math.min(A,M)/2)}else if(V(_)){const B=[];S.cornerRadius=B,C.cornerRadius=B,B[0]=m+Math.min(M,w)/2,B[1]=m+Math.min(w,x)/2,B[2]=m+Math.min(x,A)/2,B[3]=m+Math.min(A,M)/2}else S.cornerRadius=m+((h=S.lineWidth)!==null&&h!==void 0?h:0)/2,C.cornerRadius=m+((d=S.lineWidth)!==null&&d!==void 0?d:0)/2;let T,R;if(t.innerBorder?(S.x=n.attribute.x+M/2,S.y=n.attribute.y+w/2,S.width=n.attribute.width-M/2-x/2,S.height=n.attribute.height-w/2-A/2):(S.x=n.attribute.x-M/2,S.y=n.attribute.y-w/2,S.width=n.attribute.width+M/2+x/2,S.height=n.attribute.height+w/2+A/2),y){S.fill="white",S.notAdjustPos=!0,R=fS(S),R.name="table-border-rect",T=wi({x:M/2,y:w/2,width:n.attribute.width,height:n.attribute.height,fill:"red",cornerRadius:n.attribute.cornerRadius,globalCompositeOperation:"destination-out"}),R.addChild(T);const B=wi({x:M/2,y:w/2,width:n.attribute.width,height:n.attribute.height,fill:"transparent",pickable:!1,globalCompositeOperation:"source-over"});R.addChild(B)}else R=wi(S),R.name="table-border-rect";t.innerBorder&&!y?n.parent.insertAfter(R,n):n.parent.insertBefore(R,n),n.border=R}else{S.width=n.attribute.width-M/2-x/2,S.height=n.attribute.height-w/2-A/2;const T=wi(S);T.name="border-rect",n.addChild(T),n.border=T}else{const T=wi({fill:!1,stroke:!1,pickable:!1,lineWidth:0});T.name="border-rect",n.addChild(T),n.border=T}}function xN(n,t,e){var i;if(!t)return;const{borderColor:r}=t;(i=n.border)===null||i===void 0||i.setAttribute("stroke",dD(r,e))}function dD(n,t,e){let i=!0;return!t&&!V(e)||V(n)?t?i=t:t||V(n)?V(n)&&(i=!0):i=n:i=(t??e).map(r=>!!r&&n),i}function ml(n){var t,e,i,r;if(!n.border)return;const s=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[0]:(t=n.border.attribute.lineWidth)!==null&&t!==void 0?t:0,o=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[1]:(e=n.border.attribute.lineWidth)!==null&&e!==void 0?e:0,a=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[2]:(i=n.border.attribute.lineWidth)!==null&&i!==void 0?i:0,l=n.border.attribute.strokeArrayWidth?n.border.attribute.strokeArrayWidth[3]:(r=n.border.attribute.lineWidth)!==null&&r!==void 0?r:0;n.border.setAttributes({borderLeft:l,borderTop:s,borderRight:o,borderBottom:a,width:n.attribute.width-l/2-o/2,height:n.attribute.height-s/2-a/2}),n.border.type==="group"&&n.border.firstChild.setAttributes({width:n.attribute.width,height:n.attribute.height})}function eCt(n){if(!n.theme.frameStyle.cornerRadius)return;const t=n.theme.frameStyle.cornerRadius,{cornerHeaderGroup:e,colHeaderGroup:i,rowHeaderGroup:r,bodyGroup:s,rightTopCornerGroup:o,leftBottomCornerGroup:a,rightBottomCornerGroup:l,rightFrozenGroup:h,bottomFrozenGroup:d}=n.scenegraph;e.setAttribute("cornerRadius",0),i.setAttribute("cornerRadius",0),r.setAttribute("cornerRadius",0),s.setAttribute("cornerRadius",0),o.setAttribute("cornerRadius",0),a.setAttribute("cornerRadius",0),l.setAttribute("cornerRadius",0),h.setAttribute("cornerRadius",0),d.setAttribute("cornerRadius",0);const u=QK(t);e.attribute.width>0&&e.attribute.height>0?hr(e,[u[0],0,0,0]):i.attribute.height>0?hr(i,[u[0],0,0,0]):r.attribute.width>0?hr(r,[u[0],0,0,0]):hr(s,[u[0],0,0,0]),a.attribute.width>0&&a.attribute.height>0?hr(a,[0,0,0,u[3]]):d.attribute.height>0?hr(d,[0,0,0,u[3]]):r.attribute.width>0?hr(r,[0,0,0,u[3]]):hr(s,[0,0,0,u[3]]),o.attribute.width>0&&o.attribute.height>0?hr(o,[0,u[1],0,0]):i.attribute.height>0?hr(i,[0,u[1],0,0]):h.attribute.width>0?hr(h,[0,u[1],0,0]):hr(s,[0,u[1],0,0]),l.attribute.width>0&&l.attribute.height>0?hr(l,[0,0,u[2],0]):h.attribute.width>0?hr(h,[0,0,u[2],0]):d.attribute.height>0?hr(d,[0,0,u[2],0]):hr(s,[0,0,u[2],0])}function hr(n,t){n.setAttribute("cornerRadius",t),n.border&&n.border.setAttribute("cornerRadius",t)}const uD=Xn();class Mp extends eb{constructor(t,e){if(super(e),this.type="chart",this.numberType=uD,this.isShareChartSpec=t,e.chartInstance)this.chartInstance=e.chartInstance;else{const i=this.chartInstance=new e.ClassType(e.spec,Z({},this.attribute.tableChartOption,{renderCanvas:e.canvas,mode:this.attribute.mode==="node"?"node":"desktop-browser",modeParams:this.attribute.modeParams,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:e.dpr,interactive:!1,animation:!1,autoFit:!1}));i.renderSync(),i.getStage().enableDirtyBounds(),e.chartInstance=this.chartInstance=i}}activate(t){var e,i,r,s,o;this.active=!0;const{col:a,row:l}=this.parent,{x1:h,y1:d,x2:u,y2:c}=this.getViewBox(),g=iCt(a,l,t).intersect({x1:h-t.scrollLeft,x2:u-t.scrollLeft,y1:d-t.scrollTop,y2:c-t.scrollTop});(e=this.activeChartInstance)===null||e===void 0||e.release(),this.activeChartInstance=new this.attribute.ClassType(this.attribute.spec,Z({},this.attribute.tableChartOption,{renderCanvas:this.attribute.canvas,mode:"desktop-browser",canvasControled:!1,viewBox:{x1:0,x2:u-h,y1:0,y2:c-d},dpr:t.internalProps.pixelRatio,animation:!1,interactive:!0,autoFit:!1,beforeRender:v=>{const _=this.stage,b=v.window.getContext(),y=_.window.getViewBoxTransform(),C=_.window.getViewBox();b.inuse=!0,b.clearMatrix(),b.setTransform(y.a,y.b,y.c,y.d,y.e,y.f,!0),b.translate(C.x1,C.y1),b.setTransformForCurrent(!0),b.beginPath(),b.rect(g.x1,g.y1,g.x2-g.x1,g.y2-g.y1),b.clip(),b.clearMatrix(),t.options.canvas&&!v.needRender&&(v.pauseRender(),t.scenegraph.stage.dirtyBounds.union(this.globalAABBBounds),t.scenegraph.updateNextFrame())},afterRender(v){v.window.getContext().inuse=!1,v.needRender=!1,p.resumeRender()}}));const p=this.activeChartInstance.getStage(),f=this.globalTransMatrix.clone(),m=this.stage.window.getViewBoxTransform();f.multiply(m.a,m.b,m.c,m.d,m.e,m.f),p.window.setViewBoxTransform&&p.window.setViewBoxTransform(f.a,f.b,f.c,f.d,f.e,f.f),this.activeChartInstance.renderSync(),(r=(i=t.internalProps.layoutMap)===null||i===void 0?void 0:i.updateDataStateToActiveChartInstance)===null||r===void 0||r.call(i,this.activeChartInstance),this.activeChartInstance.on("click",v=>{var _;((_=this.attribute.spec.select)===null||_===void 0?void 0:_.enable)===!1?t.scenegraph.updateChartState(null):Mp.temp&&t.scenegraph.updateChartState(v==null?void 0:v.datum)}),this.activeChartInstance.on("brushEnd",v=>{var _;t.scenegraph.updateChartState((_=v==null?void 0:v.value)===null||_===void 0?void 0:_.inBrushData),Mp.temp=0,setTimeout(()=>{Mp.temp=1},0)}),(o=(s=t)._bindChartEvent)===null||o===void 0||o.call(s,this.activeChartInstance)}deactivate(){var t,e;this.active=!1,(t=this.activeChartInstance)===null||t===void 0||t.updateViewBox({x1:-1e3,x2:-800,y1:-1e3,y2:-800},!1,!1),(e=this.activeChartInstance)===null||e===void 0||e.release(),this.activeChartInstance=null}updateData(t){this.attribute.data=t}getViewBox(){var t,e,i,r,s,o,a,l;const h=this.parent,d=this.attribute.cellPadding,u=this.stage.table,{x1:c,y1:g,x2:p,y2:f}=h.globalAABBBounds;return{x1:Math.ceil(c+d[3]+u.scrollLeft+((e=(t=u.options.viewBox)===null||t===void 0?void 0:t.x1)!==null&&e!==void 0?e:0)),x2:Math.ceil(c+h.attribute.width-d[1]+u.scrollLeft+((r=(i=u.options.viewBox)===null||i===void 0?void 0:i.x1)!==null&&r!==void 0?r:0)),y1:Math.ceil(g+d[0]+u.scrollTop+((o=(s=u.options.viewBox)===null||s===void 0?void 0:s.y1)!==null&&o!==void 0?o:0)),y2:Math.ceil(g+h.attribute.height-d[2]+u.scrollTop+((l=(a=u.options.viewBox)===null||a===void 0?void 0:a.y1)!==null&&l!==void 0?l:0))}}}function iCt(n,t,e){var i,r,s,o,a,l,h,d;const{layoutMap:u}=e.internalProps,c=new Bi,g=e.scenegraph.tableGroup.globalAABBBounds;return c.x1=g.x1,c.x2=g.x2,c.y1=g.y1,c.y2=g.y2,u.isLeftBottomCorner(n,t)||u.isRightTopCorner(n,t)||u.isLeftTopCorner(n,t)||u.isRightBottomCorner(n,t)||(u.isFrozenColumn(n,t)?(c.y1=g.y1+e.getFrozenRowsHeight(),c.y2=g.y2-e.getBottomFrozenRowsHeight()):u.isFrozenRow(n,t)?(c.x1=g.x1+e.getFrozenColsWidth(),c.x2=g.x2-e.getRightFrozenColsWidth()):u.isRightFrozenColumn(n,t)?(c.y1=g.y1+e.getFrozenRowsHeight(),c.y2=g.y2-e.getBottomFrozenRowsHeight()):u.isBottomFrozenRow(n,t)?(c.x1=g.x1+e.getFrozenColsWidth(),c.x2=g.x2-e.getRightFrozenColsWidth()):u.isFrozenColumn(n,t)||u.isRightFrozenColumn(n,t)||(c.x1=g.x1+e.getFrozenColsWidth(),c.x2=g.x2-e.getRightFrozenColsWidth(),c.y1=g.y1+e.getFrozenRowsHeight(),c.y2=g.y2-e.getBottomFrozenRowsHeight())),c.x1=c.x1+((r=(i=e.options.viewBox)===null||i===void 0?void 0:i.x1)!==null&&r!==void 0?r:0),c.x2=c.x2+((o=(s=e.options.viewBox)===null||s===void 0?void 0:s.x1)!==null&&o!==void 0?o:0),c.y1=c.y1+((l=(a=e.options.viewBox)===null||a===void 0?void 0:a.y1)!==null&&l!==void 0?l:0),c.y2=c.y2+((d=(h=e.options.viewBox)===null||h===void 0?void 0:h.y1)!==null&&d!==void 0?d:0),c}Mp.temp=1;let Sx=[],xx=[],Hq,hL=5,wx=!1;function wN(n){L(n)&&(hL=n)}function dL(){Sx=[],xx=[],wx=!1,cancelAnimationFrame(Hq)}function nCt(){return wx}function zq(n){var t,e,i,r,s,o,a;const{axes:l,dataId:h,data:d,spec:u,ClassType:c,canvas:g,mode:p,modeParams:f,dpr:m}=n.attribute;let{chartInstance:v}=n;v||(v=new c(u,{renderCanvas:g,mode:p==="node"?"node":"desktop-browser",modeParams:f,canvasControled:!1,viewBox:{x1:0,x2:0,y1:0,y2:0},dpr:m,interactive:!1,animation:!1,autoFit:!1}),v.renderSync(),n.chartInstance=v);const _=n.getViewBox();_.x2<=_.x1&&(_.x2=_.x1+1),_.y2<=_.y1&&(_.y2=_.y1+1),v.updateViewBox({x1:0,x2:_.x2-_.x1,y1:0,y2:_.y2-_.y1},!1,!1);const b=v.getStage(),y=n.globalTransMatrix.clone(),C=n.stage.window.getViewBoxTransform();y.multiply(C.a,C.b,C.c,C.d,C.e,C.f),b.window.setViewBoxTransform&&b.window.setViewBoxTransform(y.a,y.b,y.c,y.d,y.e,y.f);const{table:S}=n.getRootNode();let w=!1;if(S.options.specFormat){const x=S.options.specFormat(n.attribute.spec,v,n);if(x.needFormatSpec&&x.spec){const A=x.spec;v.updateSpecSync(A),w=(t=x.updateSpec)===null||t===void 0||t}}if(!w)if(l==null||l.forEach((x,A)=>{var M,T,R,B,E;x.type==="band"?v.updateModelSpec({type:"axes",index:A},{domain:x.domain.slice(0)},!0):v.updateModelSpecSync({type:"axes",index:A},{min:(T=(M=x.range)===null||M===void 0?void 0:M.min)!==null&&T!==void 0?T:0,max:(B=(R=x.range)===null||R===void 0?void 0:R.max)!==null&&B!==void 0?B:0,tick:{tickMode:(E=x.tick)===null||E===void 0?void 0:E.tickMode}},!0)}),(i=(e=S.internalProps.layoutMap)===null||e===void 0?void 0:e.updateDataStateToActiveChartInstance)===null||i===void 0||i.call(e,v),typeof h=="string")v.updateDataSync(h,d??[]);else{const x=[];for(const A in h){const M=h[A],T=u.series.find(R=>{var B;return((B=R==null?void 0:R.data)===null||B===void 0?void 0:B.id)===A});x.push({id:A,values:M?(r=d==null?void 0:d.filter(R=>R.hasOwnProperty(M)))!==null&&r!==void 0?r:[]:d??[],fields:(s=T==null?void 0:T.data)===null||s===void 0?void 0:s.fields}),v.updateFullDataSync||v.updateDataSync(A,M?(o=d==null?void 0:d.filter(R=>R.hasOwnProperty(M)))!==null&&o!==void 0?o:[]:d??[])}(a=v.updateFullDataSync)===null||a===void 0||a.call(v,x)}S.fireListeners("before_cache_chart_image",{chartInstance:v}),rCt(v.getStage(),n)}function Wq(n){wx=!0,xx.length>0?Hq=requestAnimationFrame(()=>{const t=xx.splice(0,hL);Sx.splice(0,hL),t.forEach(e=>{zq(e),e.addUpdateBoundTag()}),n.render(),Wq(n)}):wx=!1}const va=2e3;function rCt(n,t){var e;const{viewWidth:i,viewHeight:r}=n;if(i<va&&r<va)return t.cacheCanvas=AN(n),void(t.isShareChartSpec||((e=t.chartInstance)===null||e===void 0||e.release(),t.chartInstance=null,t.setAttribute("chartInstance",null)));const s=Math.ceil(r/va),o=Math.ceil(i/va),a=[];for(let l=0;l<s;l++)for(let h=0;h<o;h++){const d=h*va,u=l*va,c=d+va>i?i:d+va,g=u+va>r?r:u+va,p=c-d,f=g-u,m=new Bi;m.setValue(d,u,c,g);const v=AN(n,!1,m);a.push({canvas:v,x:d,y:u,width:p,height:f})}t.cacheCanvas=a}function AN(n,t=!0,e){if(n.releaseStatus==="released")return null;const i=n.window.getViewBoxTransform(),r=sCt(n,t,e);r.setViewBoxTransform(i.a,i.b,i.c,i.d,0,0),n.renderTo(r);const s=r.getNativeHandler();return s.nativeCanvas?s.nativeCanvas:null}function sCt(n,t=!0,e){const i=n.window.getViewBoxTransform(),r=he.get(E_),s=e?-e.x1:0,o=e?-e.y1:0,a=e?e.x2:n.viewWidth,l=e?e.y2:n.viewHeight,h=e?e.width():n.viewWidth,d=e?e.height():n.viewHeight;return r.create({viewBox:{x1:s,y1:o,x2:a,y2:l},width:h*i.a,height:d*i.d,dpr:n.window.dpr,canvasControled:!0,offscreen:!0,title:""}),n.renderTo(r),r}var oCt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const aCt=Symbol.for("ChartRender");let bv=class extends cs{constructor(){super(...arguments),this.numberType=uD}drawShape(n,t,e,i,r,s,o,a){var l,h,d,u;const c=_e(n,s==null?void 0:s.theme).group,{dataId:g,data:p,spec:f}=n.attribute,{width:m=c.width,height:v=c.height}=(n.getViewBox(),n.attribute),{table:_}=n.getRootNode(),{active:b,cacheCanvas:y,activeChartInstance:C}=n;if(!b&&y)V(y)?y.forEach(S=>{const{x:w,y:x,width:A,height:M,canvas:T}=S;t.drawImage(T,w,x,A,M)}):t.drawImage(y,e,i,m,v);else if(C){if(_.options.specFormat){const M=_.options.specFormat(n.attribute.spec,C,n);if(M.needFormatSpec&&M.spec){const T=M.spec;C.updateSpecSync(T)}}const S=n.getViewBox();C.updateViewBox({x1:0,x2:S.x2-S.x1,y1:0,y2:S.y2-S.y1},!1,!1);const w=C.getStage();w.needRender=!0;const x=n.globalTransMatrix.clone(),A=n.stage.window.getViewBoxTransform().clone();if(A.multiply(x.a,x.b,x.c,x.d,x.e,x.f),w.window.setViewBoxTransform(A.a,A.b,A.c,A.d,A.e,A.f),typeof g=="string")C.updateDataSync(g,p??[]);else{const M=[];for(const T in g){const R=g[T],B=f.series.find(E=>{var k;return((k=E==null?void 0:E.data)===null||k===void 0?void 0:k.id)===T});M.push({id:T,values:R?(l=p==null?void 0:p.filter(E=>E.hasOwnProperty(R)))!==null&&l!==void 0?l:[]:p??[],fields:(h=B==null?void 0:B.data)===null||h===void 0?void 0:h.fields}),C.updateFullDataSync||C.updateDataSync(T,R?(d=p==null?void 0:p.filter(E=>E.hasOwnProperty(R)))!==null&&d!==void 0?d:[]:p??[])}(u=C.updateFullDataSync)===null||u===void 0||u.call(C,M)}}else _.internalProps.renderChartAsync?(Sx.indexOf(`${n.parent.col}+${n.parent.row}`)===-1&&(Sx.push(`${n.parent.col}+${n.parent.row}`),xx.push(n)),nCt()||Wq(_)):zq(n)}draw(n,t,e,i){this._draw(n,{},!1,e,i)}};bv=oCt([Bt()],bv);var MM=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let Ax=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){const{shape:g}=n.attribute;if(g==="circle"){const{width:p=l.width,height:f=l.height}=n.attribute;t.beginPath(),t.arc(e+p/2,i+f/2,Math.min(p,f)/2,0,2*Math.PI),t.closePath(),t.save(),t.clip()}}};Ax=MM([Bt()],Ax);let Mx=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){const{shape:g}=n.attribute;g==="circle"&&t.restore()}};Mx=MM([Bt()],Mx);let Tx=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){const{isGif:g}=n.attribute;g&&n.playing&&(n.attribute.opacity=0)}};Tx=MM([Bt()],Tx);let kx=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){const{isGif:g}=n.attribute;g&&n.playing&&(n.attribute.opacity=1,t.globalAlpha=n.attribute.opacity,n.renderFrame(t,e,i))}};kx=MM([Bt()],kx);function lCt(n,t){var e,i,r,s,o,a,l,h,d,u,c;let g,p;if(n.role==="cell"&&L(n.mergeStartCol)&&L(n.mergeStartRow)&&L(n.mergeEndCol)&&L(n.mergeEndRow)){const{colStart:m,colEnd:v,rowStart:_,rowEnd:b}=Gd(n,t.scenegraph);for(let y=m;y<=v;y++)for(let C=_;C<=b;C++){const S=MN(t.stateManager,y,C,n);!S||g&&S!=="cellBgColor"||(g=S)}}else n.role==="cell"&&(g=MN(t.stateManager,n.col,n.row,n));if(!g)return;const f=t.internalProps.layoutMap;return f.isCornerHeader(n.col,n.row)?p=((e=t.theme.cornerHeaderStyle)===null||e===void 0?void 0:e.hover)||((i=t.theme.headerStyle)===null||i===void 0?void 0:i.hover):f.isColumnHeader(n.col,n.row)?p=(r=t.theme.headerStyle)===null||r===void 0?void 0:r.hover:f.isRowHeader(n.col,n.row)?p=(s=t.theme.rowHeaderStyle)===null||s===void 0?void 0:s.hover:f.isBottomFrozenRow(n.col,n.row)?p=((o=t.theme.bottomFrozenStyle)===null||o===void 0?void 0:o.hover)||(t.isListTable()?(a=t.theme.bodyStyle)===null||a===void 0?void 0:a.hover:(l=t.theme.headerStyle)===null||l===void 0?void 0:l.hover):f.isRightFrozenColumn(n.col,n.row)?p=((h=t.theme.rightFrozenStyle)===null||h===void 0?void 0:h.hover)||(t.isListTable()?(d=t.theme.bodyStyle)===null||d===void 0?void 0:d.hover:(u=t.theme.rowHeaderStyle)===null||u===void 0?void 0:u.hover):t.isHeader(n.col,n.row)||(p=(c=t.theme.bodyStyle)===null||c===void 0?void 0:c.hover),Mt(g,p,n.col,n.row,t)}function MN(n,t,e,i){var r;const{highlightScope:s,disableHeader:o,cellPos:a}=n.hover,l=n.table,h=l.isHeader(t,e);if(h&&o)return;let d;if(s===qe.single&&a.col===t&&a.row===e?d="cellBgColor":s===qe.column&&a.col===t?d=a.col===t&&a.row===e?"cellBgColor":"inlineColumnBgColor":s===qe.row&&a.row===e?d=a.col===t&&a.row===e?"cellBgColor":"inlineRowBgColor":s===qe.cross&&(a.col===t&&a.row===e?d="cellBgColor":a.col===t?d="inlineColumnBgColor":a.row===e&&(d="inlineRowBgColor")),d){let u;if(h){const c=l.getHeaderDefine(t,e);u=c==null?void 0:c.disableHeaderHover,i.firstChild&&i.firstChild.name==="axis"&&(!((r=l.options.hover)===null||r===void 0)&&r.disableAxisHover)&&(u=!0)}else{const c=l.getBodyColumnDefine(t,e);u=c==null?void 0:c.disableHover}u&&(d=void 0)}return d}function hCt(n,t){var e,i,r,s,o,a,l,h,d,u,c;let g,p;if(n.role==="cell"&&L(n.mergeStartCol)&&L(n.mergeStartRow)&&L(n.mergeEndCol)&&L(n.mergeEndRow)){const{colStart:m,colEnd:v,rowStart:_,rowEnd:b}=Gd(n,t.scenegraph);for(let y=m;y<=v;y++)for(let C=_;C<=b;C++){const S=TN(t.stateManager,y,C);!S||g&&S!=="cellBgColor"||(g=S)}}else n.role==="cell"&&(g=TN(t.stateManager,n.col,n.row));if(!g)return;const f=t.internalProps.layoutMap;return f.isCornerHeader(n.col,n.row)?p=((e=t.theme.cornerHeaderStyle)===null||e===void 0?void 0:e.select)||((i=t.theme.headerStyle)===null||i===void 0?void 0:i.select):f.isColumnHeader(n.col,n.row)?p=(r=t.theme.headerStyle)===null||r===void 0?void 0:r.select:f.isRowHeader(n.col,n.row)?p=(s=t.theme.rowHeaderStyle)===null||s===void 0?void 0:s.select:f.isBottomFrozenRow(n.col,n.row)?p=((o=t.theme.bottomFrozenStyle)===null||o===void 0?void 0:o.select)||(t.isListTable()?(a=t.theme.bodyStyle)===null||a===void 0?void 0:a.select:(l=t.theme.headerStyle)===null||l===void 0?void 0:l.select):f.isRightFrozenColumn(n.col,n.row)?p=((h=t.theme.rightFrozenStyle)===null||h===void 0?void 0:h.select)||(t.isListTable()?(d=t.theme.bodyStyle)===null||d===void 0?void 0:d.select:(u=t.theme.rowHeaderStyle)===null||u===void 0?void 0:u.select):t.isHeader(n.col,n.row)||(p=(c=t.theme.bodyStyle)===null||c===void 0?void 0:c.select),Mt(g,p,n.col,n.row,t)}function dCt(n){return n.start.col!==n.end.col||n.start.row!==n.end.row}function uCt(n,t,e){let i;const{highlightScope:r,cellPos:s,ranges:o}=n.select,a=o[0],l=Math.min(a.start.col,a.end.col),h=Math.max(a.start.col,a.end.col),d=Math.min(a.start.row,a.end.row),u=Math.max(a.start.row,a.end.row);return r===qe.single&&s.col===t&&s.row===e?i="cellBgColor":r===qe.column&&t>=l&&t<=h?i=So(o[0],t,e)?"cellBgColor":"inlineColumnBgColor":r===qe.row&&e>=d&&e<=u?i=So(o[0],t,e)?"cellBgColor":"inlineRowBgColor":r===qe.cross&&(So(o[0],t,e)?i="cellBgColor":t>=l&&t<=h?i="inlineColumnBgColor":e>=d&&e<=u&&(i="inlineRowBgColor")),i}function cCt(n,t,e){let i;const{highlightScope:r,cellPos:s}=n.select;return r===qe.single&&s.col===t&&s.row===e?i="cellBgColor":r===qe.column&&s.col===t?i=s.col===t&&s.row===e?"cellBgColor":"inlineColumnBgColor":r===qe.row&&s.row===e?i=s.col===t&&s.row===e?"cellBgColor":"inlineRowBgColor":r===qe.cross&&(s.col===t&&s.row===e?i="cellBgColor":s.col===t?i="inlineColumnBgColor":s.row===e&&(i="inlineRowBgColor")),i}function TN(n,t,e,i){const{highlightInRange:r,disableHeader:s,ranges:o}=n.select;let a;const l=o.length===1&&dCt(o==null?void 0:o[0])&&r;if(l?(o==null?void 0:o.length)===1&&o[0].start&&o[0].end:(o==null?void 0:o.length)===1&&o[0].end.col===o[0].start.col&&o[0].end.row===o[0].start.row){if(n.table.isHeader(t,e)&&s)return;a=l?uCt(n,t,e):cCt(n,t,e),a&&qh(n.table,t,e)&&(a=void 0)}else if(n.table.theme.selectionStyle.selectionFillMode==="replace")for(let h=0;h<o.length;h++){const d=o[h],u=Math.min(d.start.col,d.end.col),c=Math.max(d.start.col,d.end.col),g=Math.min(d.start.row,d.end.row),p=Math.max(d.start.row,d.end.row);if(u<=t&&g<=e&&c>=t&&p>=e){a="cellBgColor";break}}return a}function qh(n,t,e){var i,r;const s=(i=n.options.select)===null||i===void 0?void 0:i.disableSelect;if(typeof s=="function"?s(t,e,n):s)return!0;if(n.isHeader(t,e)){let o=(r=n.options.select)===null||r===void 0?void 0:r.disableHeaderSelect;if(o)return!0;const a=n.getHeaderDefine(t,e);if(o=a==null?void 0:a.disableHeaderSelect,o)return!0}else{const o=n.getBodyColumnDefine(t,e),a=o==null?void 0:o.disableSelect;if(typeof a=="function"?a(t,e,n):a)return!0}return!1}var dh=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let Rx=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){const{stroke:g=l.stroke,strokeArrayWidth:p=l.strokeArrayWidth,strokeArrayColor:f=l.strokeArrayColor}=n.attribute;g&&(Array.isArray(p)||Array.isArray(f))&&(c.doStroke=!1)}};Rx=dh([Bt()],Rx);let Bx=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u){var c,g;const{stroke:p=l.stroke,strokeArrayColor:f=l.strokeArrayColor,strokeArrayWidth:m=l.strokeArrayWidth,lineWidth:v=l.lineWidth,strokeColor:_=l.stroke,cornerRadius:b=l.cornerRadius}=n.attribute;let y,C,{width:S=l.width,height:w=l.height}=n.attribute;if(p&&(Array.isArray(m)||v!==0)&&(Array.isArray(f)||Array.isArray(m))){if(typeof v=="number"&&1&v||Array.isArray(m)&&m.some(x=>1&x)){const x=n.stage.table;if(!x)return;const A=((c=x==null?void 0:x.theme)===null||c===void 0?void 0:c.cellBorderClipDirection)==="bottom-right";if(A){if(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"){const R=n.col,B=n.row;R===0&&(e+=1),B===0&&(i+=1)}}else e=Math.floor(e)+.5,i=Math.floor(i)+.5;!((g=x.options.customConfig)===null||g===void 0)&&g._disableColumnAndRowSizeRound&&(S=Math.round(S),w=Math.round(w));const{width:M,height:T}=cD(n,Math.ceil(S),Math.ceil(w),A);y=M,C=T}else y=Math.ceil(S),C=Math.ceil(w);b===0||V(b)&&b.every(x=>x===0)?Nq(n,t,e,i,l,p,m||v,f||_,y,C):(t.beginPath(),il(t,e,i,y,C,b,!0,new Array(4).fill(0).map((x,A)=>(M,T,R,B)=>{Vq(A,M,T,R,B,n,t,e,i,l,p,m||v,f||_,y,C)})),t.stroke())}}};Bx=dh([Bt()],Bx);function jq(n){if(!Array.isArray(n))return{isSplitDraw:!1,width:n};let t;for(let e=0;e<n.length;e++){const i=n[e];if(i)if(t){if(i!==t)return{isSplitDraw:!0}}else t=i}return{isSplitDraw:!1,width:t}}function Nq(n,t,e,i,r,s,o,a,l,h,d,u){var c,g,p,f;const m=jq(o),v=!Array.isArray(o),_=!Array.isArray(s),b=Array.isArray(u),y=Array.isArray(a)||m.isSplitDraw;t.setStrokeStyle(n,n.attribute,e,i,r);const{lineDash:C=r.lineDash}=n.attribute;let S=!1;C.length&&C.some(T=>Array.isArray(T))&&(S=!0),t.beginPath(),t.moveTo(e,i);const w=(_||s[0])&&(v||o[0]),x=(_||s[1])&&(v||o[1]),A=(_||s[2])&&(v||o[2]),M=(_||s[3])&&(v||o[3]);if(w){const T=(v?m.width:o[0])/2,R=(v?m.width:o[0])/2;b&&Array.isArray(u[0])?(t.moveTo(e-T+(l+T+R)*u[0][0],i),t.lineTo(e-T+(l+T+R)*(u[0][1]-u[0][0]),i),t.moveTo(e+l+R,i)):(t.moveTo(e-T,i),t.lineTo(e+l+R,i)),(y||S)&&(a&&a[0]?t.strokeStyle=a[0]:a&&!a[0]&&(t.strokeStyle="transparent"),v||(t.lineWidth=o[0]),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,S&&t.setLineDash((c=C[0])!==null&&c!==void 0?c:[]),t.stroke(),t.beginPath(),t.moveTo(e+l,i))}else t.moveTo(e+l,i);if(x){const T=(v?m.width:o[1])/2,R=(v?m.width:o[1])/2;b&&Array.isArray(u[1])?(t.moveTo(e+l,i-T+h*u[1][0]),t.lineTo(e+l,i-T+(h+T+R)*(u[1][1]-u[1][0])),t.moveTo(e+l,i+h+R)):(t.moveTo(e+l,i-T),t.lineTo(e+l,i+h+R)),(y||S)&&(a&&a[1]?t.strokeStyle=a[1]:a&&!a[1]&&(t.strokeStyle="transparent"),v||(t.lineWidth=o[1]),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,S&&t.setLineDash((g=C[1])!==null&&g!==void 0?g:[]),t.stroke(),t.beginPath(),t.moveTo(e+l,i+h))}else t.moveTo(e+l,i+h);if(A){const T=(v?m.width:o[2])/2,R=(v?m.width:o[2])/2;b&&Array.isArray(u[2])?(t.moveTo(e-T+(l+T+R)*u[2][0],i+h),t.lineTo(e-T+(l+T+R)*(u[2][1]-u[2][0]),i+h),t.moveTo(e-T,i+h)):(t.moveTo(e-T,i+h),t.lineTo(e+l+R,i+h)),(y||S)&&(a&&a[2]?t.strokeStyle=a[2]:a&&!a[2]&&(t.strokeStyle="transparent"),v||(t.lineWidth=o[2]),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,S&&t.setLineDash((p=C[2])!==null&&p!==void 0?p:[]),t.stroke(),t.beginPath(),t.moveTo(e,i+h))}else t.moveTo(e,i+h);if(M){const T=(v?m.width:o[3])/2,R=(v?m.width:o[3])/2;b&&Array.isArray(u[3])?(t.moveTo(e,i-T+(h+T+R)*u[3][0]),t.lineTo(e,i-T+(h+T+R)*(u[3][1]-u[3][0])),t.moveTo(e,i-T)):(t.moveTo(e,i-T),t.lineTo(e,i+h+R)),(y||S)&&(a&&a[3]?t.strokeStyle=a[3]:a&&!a[3]&&(t.strokeStyle="transparent"),v||(t.lineWidth=o[3]),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,S&&t.setLineDash((f=C[3])!==null&&f!==void 0?f:[]),t.stroke(),t.beginPath(),t.moveTo(e,i))}else t.moveTo(e,i);y||S||(!v&&m.width&&(t.lineWidth=m.width),t.stroke()),t.lineDashOffset=0,t.setLineDash([])}let Px=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){var g;const{lineDash:p=l.lineDash,stroke:f=l.stroke,strokeArrayColor:m=l.strokeArrayColor,strokeArrayWidth:v=l.strokeArrayWidth}=n.attribute;f&&Array.isArray(p)&&p.length&&(!((g=p[0])===null||g===void 0)&&g.length)&&!Array.isArray(m)&&!Array.isArray(v)&&(c.doStroke=!1)}};Px=dh([Bt()],Px);let Ex=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u){var c,g,p,f,m,v;const{lineDash:_=l.lineDash,stroke:b=l.stroke,strokeArrayColor:y=l.strokeArrayColor,strokeArrayWidth:C=l.strokeArrayWidth,lineWidth:S=l.lineWidth}=n.attribute;if(!b||!(Array.isArray(_)&&_.length&&(!((c=_[0])===null||c===void 0)&&c.length))||Array.isArray(y)||Array.isArray(C))return;const w=n.stage.table;if(!w)return;const x=V(_[0])?gCt(_):[_,_,_,_];let A,M,{width:T=l.width,height:R=l.height}=n.attribute;if(!((g=w.options.customConfig)===null||g===void 0)&&g._disableColumnAndRowSizeRound?(T=Math.round(T),R=Math.round(R)):(T=Math.ceil(T),R=Math.ceil(R)),1&S){const B=w.theme.cellBorderClipDirection==="bottom-right",E=0,k=0;B?(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"&&(n.col===0&&(e+=1),n.row===0&&(i+=1))):(e=Math.floor(e)+.5,i=Math.floor(i)+.5);const{width:P,height:I}=cD(n,Math.ceil(T+E),Math.ceil(R+k),B);A=P,M=I}else A=Math.ceil(T),M=Math.ceil(R);t.setStrokeStyle(n,n.attribute,e,i,l),t.beginPath(),t.moveTo(e,i),t.lineTo(e+A,i),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.setLineDash((p=x[0])!==null&&p!==void 0?p:[]),t.stroke(),t.beginPath(),t.moveTo(e+A,i),t.lineTo(e+A,i+M),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.setLineDash((f=x[1])!==null&&f!==void 0?f:[]),t.stroke(),t.beginPath(),t.moveTo(e,i+M),t.lineTo(e+A,i+M),t.lineDashOffset=t.currentMatrix.e/t.currentMatrix.a,t.setLineDash((m=x[2])!==null&&m!==void 0?m:[]),t.stroke(),t.beginPath(),t.moveTo(e,i),t.lineTo(e,i+M),t.lineDashOffset=t.currentMatrix.f/t.currentMatrix.d,t.setLineDash((v=x[3])!==null&&v!==void 0?v:[]),t.stroke(),t.lineDashOffset=0,t.setLineDash([])}};Ex=dh([Bt()],Ex);let Lx=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){const{lineWidth:g=l.lineWidth,stroke:p=l.stroke,lineDash:f=l.lineDash,strokeArrayWidth:m=l.strokeArrayWidth,strokeArrayColor:v=l.strokeArrayColor,notAdjustPos:_}=n.attribute;_!==!0&&p&&Array.isArray(f)&&!f.length&&!Array.isArray(v)&&!Array.isArray(m)&&1&g&&(c.doStroke=!1)}};Lx=dh([Bt()],Lx);let Ix=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u){var c,g;const{lineWidth:p=l.lineWidth,stroke:f=l.stroke,lineDash:m=l.lineDash,strokeArrayWidth:v=l.strokeArrayWidth,strokeArrayColor:_=l.strokeArrayColor,notAdjustPos:b,cornerRadius:y=l.cornerRadius}=n.attribute;let{width:C=l.width,height:S=l.height}=n.attribute;if(b!==!0&&f&&Array.isArray(m)&&!m.length&&!Array.isArray(_)&&!Array.isArray(v)&&1&p){const w=n.stage.table;if(!w)return;!((c=w.options.customConfig)===null||c===void 0)&&c._disableColumnAndRowSizeRound&&(C=Math.round(C),S=Math.round(S)),t.beginPath();const x=((g=w==null?void 0:w.theme)===null||g===void 0?void 0:g.cellBorderClipDirection)==="bottom-right",A=0,M=0;x?(e=Math.floor(e)-.5,i=Math.floor(i)-.5,n.role==="cell"&&(n.col===0&&(e+=1),n.row===0&&(i+=1))):(e=Math.floor(e)+.5,i=Math.floor(i)+.5);const{width:T,height:R}=cD(n,Math.ceil(C),Math.ceil(S),x);y?il(t,e,i,T+A,R+M,y):t.rect(e,i,T,R),t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke()}}};Ix=dh([Bt()],Ix);let Ox=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){if(n.role==="cell"){const g=n.stage.table;if(g){const p=hCt(n,g);if(p)n.attribute._vtableHightLightFill=p;else if(g.stateManager.interactionState!==oe.scrolling){const f=lCt(n,g);f&&(n.attribute._vtableHightLightFill=f)}}}}};Ox=dh([Bt()],Ox);let Dx=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u){if(n.attribute._vtableHightLightFill&&!d){if(o){const c=n.attribute.fill;n.attribute.fill=n.attribute._vtableHightLightFill,t.setCommonStyle(n,n.attribute,e,i,l),t.fill(),n.attribute.fill=c,n.attribute._vtableHightLightFill=void 0}}}};Dx=dh([Bt()],Dx);let Fx=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){var g,p,f,m,v,_;const b=n.stage.table;b&&(n.role==="body"?vl(t,-((g=n.attribute.x)!==null&&g!==void 0?g:0)+b.getFrozenColsWidth(),-((p=n.attribute.y)!==null&&p!==void 0?p:0)+b.getFrozenRowsHeight(),n.parent.attribute.width-b.getFrozenColsWidth()-b.getRightFrozenColsWidth(),n.parent.attribute.height-b.getFrozenRowsHeight()-b.getBottomFrozenRowsHeight()):n.role==="row-header"?vl(t,0,-((f=n.attribute.y)!==null&&f!==void 0?f:0)+b.getFrozenRowsHeight(),b.getFrozenColsWidth(),n.parent.attribute.height-b.getFrozenRowsHeight()-b.getBottomFrozenRowsHeight()):n.role==="col-header"?vl(t,-((m=n.attribute.x)!==null&&m!==void 0?m:0)+b.getFrozenColsWidth(),0,n.parent.attribute.width-b.getFrozenColsWidth()-b.getRightFrozenColsWidth(),b.getFrozenRowsHeight()):n.role==="right-frozen"?vl(t,0,-((v=n.attribute.y)!==null&&v!==void 0?v:0)+b.getFrozenRowsHeight(),b.getRightFrozenColsWidth(),n.parent.attribute.height-b.getFrozenRowsHeight()-b.getBottomFrozenRowsHeight()):n.role==="bottom-frozen"?vl(t,-((_=n.attribute.x)!==null&&_!==void 0?_:0)+b.getFrozenColsWidth(),0,n.parent.attribute.width-b.getFrozenColsWidth()-b.getRightFrozenColsWidth(),b.getBottomFrozenRowsHeight()):n.role==="corner-header"?vl(t,0,0,b.getFrozenColsWidth(),b.getFrozenRowsHeight()):n.role==="corner-right-top-header"?vl(t,0,0,b.getRightFrozenColsWidth(),b.getFrozenRowsHeight()):n.role==="corner-right-bottom-header"?vl(t,0,0,b.getRightFrozenColsWidth(),b.getBottomFrozenRowsHeight()):n.role==="corner-left-bottom-header"&&vl(t,0,0,b.getFrozenColsWidth(),b.getBottomFrozenRowsHeight()))}};Fx=dh([Bt()],Fx);const ug=Math.pow(2,24);function vl(n,t,e,i,r){n.beginPath();const s=n.applyedMatrix;Math.abs(s.f)>ug||Math.abs(s.g)>ug?n.rect(t-ug,e-ug,i+2*ug,r+2*ug):n.rect(t,e,i,r)}function cD(n,t,e,i){const r=n.stage.table;if(!r)return{width:t,height:e};if(n.role==="cell"){let s=n.col,o=n.row;const a=un(r,s,o);a&&(s=a.end.col,o=a.end.row),s!==r.colCount-1||i?(s===r.frozenColCount-1&&r.scrollLeft&&!i||s===0&&i)&&(t-=1):t-=1,o!==r.rowCount-1||i?(o===r.frozenRowCount-1&&r.scrollTop&&!i||o===0&&i)&&(e-=1):e-=1}else n.role==="corner-frozen"&&(r.scrollLeft&&!i&&(t-=1),r.scrollTop&&!i&&(e-=1));return{width:t,height:e}}function gCt(n){return n.length===1?[n[0],n[0],n[0],n[0]]:n.length===2?[n[0],n[1],n[0],n[1]]:n}var $q=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let yv=class{constructor(){this.time=Ze.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){const{stroke:p=h.stroke,strokeArrayWidth:f=h.strokeArrayWidth,strokeArrayColor:m=h.strokeArrayColor}=t.attribute;p&&(Array.isArray(p)||Array.isArray(f)||Array.isArray(m))&&(g.doStroke=!1)}};yv=$q([Bt()],yv);let Cv=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{width:g=h.width,height:p=h.height,stroke:f=h.stroke,strokeArrayColor:m=h.strokeArrayColor,strokeArrayWidth:v=h.strokeArrayWidth,lineWidth:_=h.lineWidth,strokeColor:b=h.stroke,cornerRadius:y=h.cornerRadius}=t.attribute;f&&(Array.isArray(v)||_!==0)&&(Array.isArray(f)||Array.isArray(m)||Array.isArray(v))&&(t.name!=="border-rect"&&t.name!=="table-border-rect"&&(typeof _=="number"&&1&_||Array.isArray(v)&&v.some(w=>1&w))&&(i=Math.floor(i)+.5,r=Math.floor(r)+.5),y===0||V(y)&&y.every(w=>w===0)?Nq(t,e,i,r,h,f,v||_,m||b,t.name!=="table-border-rect"?Math.ceil(g+0):g+0,t.name!=="table-border-rect"?Math.ceil(p+0):p+0):(e.beginPath(),il(e,i,r,g,p,y,!0,new Array(4).fill(0).map((w,x)=>(A,M,T,R)=>{Vq(x,A,M,T,R,t,e,i,r,h,f,v||_,m||b,Math.ceil(g+0),Math.ceil(p+0))})),e.stroke()))}};Cv=$q([Bt()],Cv);function Vq(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){var f,m,v,_;const b=s,y=h,C=jq(u),S=!Array.isArray(u),w=!Array.isArray(d),x=Array.isArray(c)||C.isSplitDraw;o.stroke(),o.setStrokeStyle(s,s.attribute,a,l,h);const{lineDash:A=y.lineDash}=b.attribute;let M=!1;A.length&&A.some(k=>Array.isArray(k))&&(M=!0),o.beginPath(),o.moveTo(a,l);const T=(w||d[0])&&(S||u[0]),R=(w||d[1])&&(S||u[1]),B=(w||d[2])&&(S||u[2]),E=(w||d[3])&&(S||u[3]);T&&n===0?(S?C.width:u[0],S?C.width:u[0],o.moveTo(t,e),o.lineTo(i,r),(x||M)&&(c&&c[0]?o.strokeStyle=c[0]:c&&!c[0]&&(o.strokeStyle="transparent"),S||(o.lineWidth=u[0]),o.lineDashOffset=o.currentMatrix.e/o.currentMatrix.a,M&&o.setLineDash((f=A[0])!==null&&f!==void 0?f:[]),o.stroke(),o.beginPath())):n===0&&o.moveTo(a+g,l),R&&n===1?(S?C.width:u[1],S?C.width:u[1],o.moveTo(t,e),o.lineTo(i,r),(x||M)&&(c&&c[1]?o.strokeStyle=c[1]:c&&!c[1]&&(o.strokeStyle="transparent"),S||(o.lineWidth=u[1]),o.lineDashOffset=o.currentMatrix.f/o.currentMatrix.d,M&&o.setLineDash((m=A[1])!==null&&m!==void 0?m:[]),o.stroke(),o.beginPath(),o.moveTo(a+g,l+p))):n===1&&o.moveTo(a+g,l+p),B&&n===2?(S?C.width:u[2],S?C.width:u[2],o.moveTo(t,e),o.lineTo(i,r),(x||M)&&(c&&c[2]?o.strokeStyle=c[2]:c&&!c[2]&&(o.strokeStyle="transparent"),S||(o.lineWidth=u[2]),o.lineDashOffset=o.currentMatrix.e/o.currentMatrix.a,M&&o.setLineDash((v=A[2])!==null&&v!==void 0?v:[]),o.stroke(),o.beginPath(),o.moveTo(a,l+p))):n===2&&o.moveTo(a,l+p),E&&n===3?(S?C.width:u[3],S?C.width:u[3],o.moveTo(t,e),o.lineTo(i,r),(x||M)&&(c&&c[3]?o.strokeStyle=c[3]:c&&!c[3]&&(o.strokeStyle="transparent"),S||(o.lineWidth=u[3]),o.lineDashOffset=o.currentMatrix.f/o.currentMatrix.d,M&&o.setLineDash((_=A[3])!==null&&_!==void 0?_:[]),o.stroke(),o.beginPath(),o.moveTo(a,l))):n===3&&o.moveTo(a,l),o.closePath(),x||M||(!S&&C.width&&(o.lineWidth=C.width),o.stroke()),o.lineDashOffset=0,o.setLineDash([]),o.beginPath()}var pCt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let cm,Hx=class{constructor(){this.order=1,this.interceptors=[new fCt]}afterDrawItem(n,t,e,i,r){for(let s=0;s<this.interceptors.length;s++)if(this.interceptors[s].afterDrawItem&&this.interceptors[s].afterDrawItem(n,t,e,i,r))return!0;return!1}beforeDrawItem(n,t,e,i,r){if((!n.in3dMode||e.in3dInterceptor)&&!n.shadowRoot&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let s=0;s<this.interceptors.length;s++)if(this.interceptors[s].beforeDrawItem&&this.interceptors[s].beforeDrawItem(n,t,e,i,r))return!0;return!1}};Hx=pCt([Bt()],Hx);class fCt{constructor(){this.order=1}afterDrawItem(t,e,i,r,s){return t.type==="image"&&this.drawItem(t,e,i,r,s),!1}drawItem(t,e,i,r,s){const{image:o,gif:a}=t.attribute;if(a&&t.playing||!o||!t.resources)return!1;const l=t.resources.get(o);if(!l||l.state!=="loading")return!1;if(!cm){const f=ra(),m=f.loading_pic.svg,v=f.loading_pic.width,_=f.loading_pic.height;cm=oM({width:v,height:_,image:m})}const{image:h}=cm.attribute;if(!o||!cm.resources)return!1;const d=cm.resources.get(h);if(d.state!=="success")return!1;const{context:u}=i;u.highPerformanceSave(),t.parent&&u.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&u.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const c=t.AABBBounds,{width:g,height:p}=wM(d.data.width,d.data.height,c.width(),c.height());return u.drawImage(d.data,c.x1+(c.width()-g)/2,c.y1+(c.height()-p)/2,g,p),u.highPerformanceRestore(),!0}}var mCt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let zx=class{constructor(){this.time=Ze.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){var g,p;const{text:f,underline:m=l.underline,lineThrough:v=l.lineThrough,direction:_=l.direction,whiteSpace:b=l.whiteSpace,fontSize:y=l.fontSize,verticalMode:C=l.verticalMode,ellipsis:S=l.ellipsis,textAlign:w=l.textAlign,textBaseline:x=l.textBaseline,x:A=l.x,y:M=l.y}=n.attribute;let T=!1;if(Array.isArray(n)){const k=(g=n.cache)===null||g===void 0?void 0:g.layoutData;S&&k&&k.lines.every(P=>P.str==="")&&(T=!0)}else{const{cache:k}=n;S&&k&&k.clipedText===""&&k.clipedWidth===0&&(T=!0)}if(!T)return;const R=yt(S)?S:"...",B=(p=Z0(n.attribute.lineHeight,y))!==null&&p!==void 0?p:y;let E=0;B!==y&&(x==="top"?E=(B-y)/2:x==="middle"||x==="bottom"&&(E=-(B-y)/2)),s&&(u?u(t,n.attribute,l):a&&(t.setStrokeStyle(n,n.attribute,A-e,M-i,l),t.strokeText(R,A,M+E))),r&&(d?d(t,n.attribute,l):o&&(t.setCommonStyle(n,n.attribute,A-e,M-i,l),t.fillText(R,A,M+E),this.drawUnderLine(m,v,n,A,M+E,0,l,t,R)))}drawUnderLine(n,t,e,i,r,s,o,a,l){if(t+n<=0)return;const{textAlign:h=o.textAlign,textBaseline:d=o.textBaseline,fontSize:u=o.fontSize,fontFamily:c=o.fontFamily,fontWeight:g=o.fontWeight,fontStyle:p=o.fontStyle,fill:f=o.fill,opacity:m=o.opacity,underlineOffset:v=o.underlineOffset,underlineDash:_=o.underlineDash,fillOpacity:b=o.fillOpacity}=e.attribute;if(!n&&!t)return;const y=Oq.measureTextWidth(l,{fontSize:u,fontFamily:c,fontWeight:g,fontStyle:p}),C=qp(h,y),S=O_(d,u,u),w={lineWidth:0,stroke:f,opacity:m,strokeOpacity:b};if(n){w.lineWidth=n,a.setStrokeStyle(e,w,i,r,o),a.setLineDash(_),a.beginPath();const x=r+S+u+v;a.moveTo(i+C,x,s),a.lineTo(i+C+y,x,s),a.stroke()}if(t){w.lineWidth=t,a.setStrokeStyle(e,w,i,r,o),a.beginPath();const x=r+S+u/2;a.moveTo(i+C,x,s),a.lineTo(i+C+y,x,s),a.stroke()}}};zx=mCt([Bt()],zx);var vCt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let Wx=class{constructor(){this.type="chart",this.numberType=uD}contains(n,t,e){return!!n.AABBBounds.containsPoint(t)}};Wx=vCt([Bt()],Wx);const _Ct=new pe((n,t,e,i)=>{e(Jp)?i(Jp).to(yv).inSingletonScope():(n(yv).toSelf().inSingletonScope(),n(Ou).toService(yv)),e(Qp)?i(Qp).to(Cv).inSingletonScope():(n(Cv).toSelf().inSingletonScope(),n(Ou).toService(Cv)),n(bv).toSelf().inSingletonScope(),n(aCt).to(bv),n(zr).to(bv),n(Wx).toSelf().inSingletonScope(),n(hs).toService(Wx),n(Ax).toSelf().inSingletonScope(),n(Iu).toService(Ax),n(Mx).toSelf().inSingletonScope(),n(Iu).toService(Mx),n(Tx).toSelf().inSingletonScope(),n(Iu).toService(Tx),n(kx).toSelf().inSingletonScope(),n(Iu).toService(kx),n(Ox).toSelf().inSingletonScope(),n(Fo).toService(Ox),n(Dx).toSelf().inSingletonScope(),n(Fo).toService(Dx),n(Bx).toSelf().inSingletonScope(),n(Fo).toService(Bx),n(Rx).toSelf().inSingletonScope(),n(Fo).toService(Rx),n(Px).toSelf().inSingletonScope(),n(Fo).toService(Px),n(Ex).toSelf().inSingletonScope(),n(Fo).toService(Ex),n(Lx).toSelf().inSingletonScope(),n(Fo).toService(Lx),n(Ix).toSelf().inSingletonScope(),n(Fo).toService(Ix),n(Fx).toSelf().inSingletonScope(),n(Fo).toService(Fx),n(Hx).toSelf().inSingletonScope(),n(F_).toService(Hx),n(zx).toSelf().inSingletonScope(),n(vS).toService(zx)});function fo(n,t,e,i){var r,s,o,a,l,h,d,u;n.internalProps.columnWidthConfig&&n._parseColumnWidthConfig(n.internalProps.columnWidthConfig),n.isPivotTable()&&n.internalProps.columnWidthConfigForRowHeader&&n._parseColumnWidthConfigForRowHeader(n.internalProps.columnWidthConfigForRowHeader),t=t??0,e=e??n.colCount-1,t===0&&e===n.colCount-1&&n._clearColRangeWidthsMap();const c=n.internalProps.layoutMap;n.isPivotTable()&&(c.enableUseGetBodyCache(),c.enableUseHeaderPathCache());const g=[],p=[];if(i)for(let f=0;f<n.colCount;f++)g[f]=n.getColWidth(f);for(let f=t;f<=e;f++){let m;if(n.internalProps.transpose||((s=(r=n.internalProps.layoutMap.columnObjects)===null||r===void 0?void 0:r[f])===null||s===void 0?void 0:s.columnWidthComputeMode)!=="only-header"&&n.columnWidthComputeMode!=="only-header"||!("showHeader"in n.internalProps.layoutMap))m=n.internalProps.transpose||((a=(o=n.internalProps.layoutMap.columnObjects)===null||o===void 0?void 0:o[f])===null||a===void 0?void 0:a.columnWidthComputeMode)!=="only-body"&&n.columnWidthComputeMode!=="only-body"?Tp(f,0,n.rowCount-1,n):Tp(f,n.internalProps.layoutMap.getBodyRange().start.row,n.internalProps.layoutMap.getBodyRange().end.row,n);else{const v=n.internalProps.layoutMap.showHeader;n.internalProps.layoutMap.showHeader=!0,m=Tp(f,0,n.internalProps.layoutMap.headerLevelCount-1,n),n.internalProps.layoutMap.showHeader=v}n._setColContentWidth(f,m),n.getColWidth(f)!==m&&n._clearColRangeWidthsMap(f),i?p[f]=Math.round(n._adjustColWidth(f,m)):n._setColWidth(f,n._adjustColWidth(f,m),!1,!0)}if(n.widthMode==="adaptive"){n._clearColRangeWidthsMap();const f=n.tableNoFrameWidth;let m=0,v=0,_=n.colCount;if(n.widthAdaptiveMode==="only-body"){for(let b=0;b<n.colCount;b++){const y=i&&(l=p[b])!==null&&l!==void 0?l:n.getColWidth(b);(b<n.rowHeaderLevelCount||n.isPivotChart()&&b>=n.colCount-n.rightFrozenColCount)&&(m+=y)}v=n.rowHeaderLevelCount,_=n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount}jx(f-m,v,_,i,p,n)}else if(n.autoFillWidth){n._clearColRangeWidthsMap();const f=n.tableNoFrameWidth;let m=0,v=0;for(let _=0;_<n.colCount;_++){const b=i&&(h=p[_])!==null&&h!==void 0?h:n.getColWidth(_);(_<n.rowHeaderLevelCount+n.leftRowSeriesNumberCount||n.isPivotChart()&&_>=n.colCount-n.rightFrozenColCount)&&(m+=b),v+=b}v<f&&v>m&&jx(f-m,n.rowHeaderLevelCount+n.leftRowSeriesNumberCount,n.isPivotChart()?n.colCount-n.rightFrozenColCount:n.colCount,i,p,n)}if(i){for(let f=0;f<n.colCount;f++){const m=(u=(d=p[f])!==null&&d!==void 0?d:n.getColWidth(f))!==null&&u!==void 0?u:n.getColWidth(f);m!==g[f]&&n._setColWidth(f,m,!1,!0)}n.stateManager.checkFrozen();for(let f=0;f<n.colCount;f++){const m=n.getColWidth(f);m!==g[f]&&n.scenegraph.updateColWidth(f,m-g[f],!0,!0)}n.scenegraph.updateContainer(!0)}n.isPivotTable()&&(c.disableUseGetBodyCache(),c.disableUseHeaderPathCache())}function Tp(n,t,e,i,r=!1){let s=SCt(n,i);return i.internalProps.transpose&&s==="auto"&&(i.columnWidthComputeMode==="only-header"&&n>=i.rowHeaderLevelCount||i.columnWidthComputeMode==="only-body"&&n<i.rowHeaderLevelCount)&&(s=i.getDefaultColumnWidth(n)),r&&!i.internalProps.transpose?kN(s,n,t,e,r,i):typeof s=="number"?s:s!=="auto"&&typeof s=="string"?i._adjustColWidth(n,i._colWidthDefineToPxWidth(s)):kN(s,n,t,e,r,i)}function kN(n,t,e,i,r,s){var o,a,l,h,d;let u=0,c=1,g=1;if(i-e>5e3&&(g=Math.ceil((i-e)/5e3)),s.isPivotChart()&&t>=s.rowHeaderLevelCount&&t<s.colCount-s.rightFrozenColCount){if(s.internalProps.layoutMap.indicatorsAsCol)return s.defaultColWidth;{const m=s.internalProps.layoutMap.getOptimunWidthForChart(t);if(m>0)return m}}for(let m=e;m<=i;m+=c){if(s.isPivotChart()){const w=s.internalProps.layoutMap,x=w.getAxisConfigInPivotChart(t,m);if(x){const A=Jt.getFunction("computeAxisComponentWidth")(x,s);if(typeof A=="number"){u=Math.max(A,u);continue}}else if(w.isLeftBottomCorner(t,m)||w.isRightTopCorner(t,m)||w.isRightBottomCorner(t,m))continue}const v=bCt(t,m,s);if(v&&(u=Math.max(v.width,u),!v.renderDefault))continue;const _=n;if(typeof _=="number"&&s.widthMode==="standard"&&!r){u=Math.max(_,u);continue}const b=s.isHeader(t,m)?(o=s._getHeaderLayoutMap(t,m))===null||o===void 0?void 0:o.headerType:s.getBodyColumnType(t,m);if(L(b)&&b!=="text"&&b!=="link"&&b!=="progressbar"&&b!=="checkbox"&&b!=="radio"&&b!=="switch"&&b!=="button"){u=Math.max(u,s.getColWidthDefinedNumber(t)||0);continue}let y=0;const C=s.internalProps.layoutMap;if(C.isHeader(t,m)){const w=C.getHeader(t,m);if(((a=w==null?void 0:w.define)===null||a===void 0?void 0:a.columnWidthComputeMode)==="only-body")continue;L(w==null?void 0:w.hierarchyLevel)&&(y=((l=w.hierarchyLevel)!==null&&l!==void 0?l:0)*(C.rowHierarchyType==="tree"&&(h=C.rowHierarchyIndent)!==null&&h!==void 0?h:0),C.rowHierarchyTextStartAlignment&&!s.internalProps.headerHelper.getHierarchyIcon(t,m)&&(y+=s.internalProps.headerHelper.getHierarchyIconWidth()))}else if(s.isListTable()){c=g;const w=s.getBodyColumnDefine(t,m);if(w!=null&&w.tree){const x=s.dataSource.getIndexKey(s.getRecordShowIndexByCell(t,m));y=Array.isArray(x)&&s.getHierarchyState(t,m)!==se.none?(x.length-1)*((d=C.hierarchyIndent)!==null&&d!==void 0?d:0):0,C.hierarchyTextStartAlignment&&!s.internalProps.bodyHelper.getHierarchyIcon(t,m)&&(y+=s.internalProps.headerHelper.getHierarchyIconWidth())}}const S=yCt(t,m,b,s);u=Math.max(S+y,u),c>1&&s.bottomFrozenRowCount>0&&m<s.rowCount-s.bottomFrozenRowCount&&m+c>=s.rowCount-s.bottomFrozenRowCount&&(m=s.rowCount-s.bottomFrozenRowCount-c,c=1,g=1)}const p=s.getMinColWidth(t),f=s.getMaxColWidth(t);return u<p?p:u>f?f:(u<=0&&(u=s.defaultColWidth),u)}function bCt(n,t,e){var i,r,s,o,a,l,h;const d=e.getCustomRender(n,t);let u=e.getCustomLayout(n,t);if(d||u){let c,g=1,p=0,f=!1,m=!1;(e.isHeader(n,t)||!((i=e.getBodyColumnDefine(n,t))===null||i===void 0)&&i.mergeCell||e.hasCustomMerge())&&(c=e.getCellRange(n,t),g=c.end.col-c.start.col+1);const v={col:(r=c==null?void 0:c.start.col)!==null&&r!==void 0?r:n,row:(s=c==null?void 0:c.start.row)!==null&&s!==void 0?s:t,dataValue:e.getCellOriginValue(n,t),value:e.getCellValue(n,t)||"",rect:CCt(n,t,e),table:e,originCol:n,originRow:t,forComputation:!0};if(u==="react-custom-layout"&&(u=((o=e.reactCustomLayout)===null||o===void 0?void 0:o.getCustomLayoutFunc(n,t))||$_),it(u)){const _=u(v);if(_.rootContainer){_.rootContainer=V_(_.rootContainer),xM(_.rootContainer,0,e.getRowHeight(t));const b=_.rootContainer.attribute.width;_.rootContainer.setStage(e.scenegraph.stage),p=b>0?b:(a=_.rootContainer.AABBBounds.width())!==null&&a!==void 0?a:0,f=_.renderDefault,m=_.enableCellPadding}else p=0,f=_.renderDefault,m=_.enableCellPadding}else if(typeof d=="function"){const _=d(v);p=(l=_==null?void 0:_.expectedWidth)!==null&&l!==void 0?l:0,f=_==null?void 0:_.renderDefault}else p=(h=d==null?void 0:d.expectedWidth)!==null&&h!==void 0?h:0,f=d==null?void 0:d.renderDefault;if(p=Math.ceil(p),m){const _=e._getCellStyle(n,t),b=Be(Mt("padding",_,n,t,e));p+=b[1]+b[3]}return{width:p/g,renderDefault:f}}}function yCt(n,t,e,i){var r,s,o,a;let l=0;const h=i.getCellValue(n,t),d=i._getCellStyle(n,t);let u=0,c=!1;if(i.getCellLocation(n,t)!=="body")c=!0;else{const C=i.getBodyColumnDefine(n,t);c=!!(C!=null&&C.icon)||!!(C!=null&&C.tree)||(C==null?void 0:C.dragOrder)}if(c){const C=i.getCellIcons(n,t);C==null||C.forEach(S=>{var w,x,A;S.positionType!==ri.absoluteRight&&(u+=((w=S.width)!==null&&w!==void 0?w:0)+((x=S.marginLeft)!==null&&x!==void 0?x:0)+((A=S.marginRight)!==null&&A!==void 0?A:0))})}let g=1;if(i.isHeader(n,t)||!((r=i.getBodyColumnDefine(n,t))===null||r===void 0)&&r.mergeCell||i.hasCustomMerge()){const C=i.getCellRange(n,t);g=C.end.col-C.start.col+1}const p=Be(Mt("padding",d,n,t,i)),f=p[1]+p[3],m=Mt("fontSize",d,n,t,i),v=Mt("fontFamily",d,n,t,i),_=Mt("fontWeight",d,n,t,i);let b;if(e==="checkbox")b=kt(h)?h.text:h;else if(e==="radio")if(V(h)){b="";const C=i.getBodyColumnDefine(n,t),S=(s=C==null?void 0:C.radioDirectionInCell)!==null&&s!==void 0?s:"vertical";S==="vertical"?h.forEach(w=>{b+=(kt(w)?w.text:w).toString()+`
`}):S==="horizontal"&&h.forEach(w=>{b+=(kt(w)?w.text:w).toString()})}else b=kt(h)?h.text:h;else if(e==="button"){const C=i.getBodyColumnDefine(n,t),S=ni(C.text,{col:n,row:t,table:i,context:null,value:h,dataValue:i.getCellOriginValue(n,t)});b=(o=S??h)!==null&&o!==void 0?o:""}else b=h;const y=G_(b,i).text;if(y.length>=1&&(y.length!==1||y[0]!=="")?y.forEach(C=>{const S=i.measureText(C,{fontSize:m,fontFamily:v,fontWeight:_}).width;l=Math.max((S+f+4+u)/g,l)}):l=Math.max((f+4+u)/g,l),i.internalProps.limitMaxAutoWidth!==!1&&(l=Math.min(typeof i.internalProps.limitMaxAutoWidth=="number"?i.internalProps.limitMaxAutoWidth:450,l)),e==="checkbox"){const C=Mt("size",d,n,t,i);if(l+=C,b){const S=Mt("spaceBetweenTextAndIcon",d,n,t,i);l+=S}}else if(e==="radio"){const C=Mt("size",d,n,t,i),S=Mt("outerRadius",d,n,t,i),w=J(S)?2*S:C,x=Mt("spaceBetweenTextAndIcon",d,n,t,i);if(V(h)){const A=i.getBodyColumnDefine(n,t),M=Mt("spaceBetweenRadio",d,n,t,i),T=(a=A==null?void 0:A.radioDirectionInCell)!==null&&a!==void 0?a:"vertical";T==="vertical"?(l+=w,l+=x):T==="horizontal"&&(l+=(w+x)*h.length,l+=M*(h.length-1))}else l+=w,b&&(l+=x)}else if(e==="switch")l=Mt("boxWidth",d,n,t,i);else if(e==="button"){const C=Mt("buttonPadding",d,n,t,i);l+=2*C}return l}function CCt(n,t,e){return{left:0,top:0,right:e.getColWidth(n),bottom:e.getRowHeight(t),width:null,height:null}}function SCt(n,t){const e=t.getColWidthDefined(n);return t.internalProps._widthResizedColMap.has(n)?t.getColWidth(n):e}function jx(n,t,e,i,r,s,o){var a,l,h,d;let u=0;const c=[],g=[];let p=0;for(let m=t;m<e;m++){const v=i&&(a=r[m])!==null&&a!==void 0?a:s.getColWidth(m),_=s.getMaxColWidth(m),b=s.getMinColWidth(m);v!==_&&v!==b?(u+=v,c.push(m)):n-=v,!((l=s.options.customConfig)===null||l===void 0)&&l.shrinkSparklineFirst&&s.getBodyColumnType(m,0)==="sparkline"&&(g.push({col:m,width:v}),p+=v-s.defaultColWidth)}const f=n/u;if(!((h=s.options.customConfig)===null||h===void 0)&&h.shrinkSparklineFirst&&f<1&&u-n<p)for(let m=0;m<g.length;m++){const{col:v,width:_}=g[m],b=(u-n)/g.length,y=Math.floor(_-b);i?r[v]=s._adjustColWidth(v,y):o?s.scenegraph.setColWidth(v,s._adjustColWidth(v,y)):s._setColWidth(v,s._adjustColWidth(v,y),!1,!0)}else for(let m=0;m<c.length;m++){const v=c[m];let _;_=m===c.length-1?n-c.reduce((b,y,C)=>{var S;return y!==v?b+(i?(S=r[y])!==null&&S!==void 0?S:s.getColWidth(v):s.getColWidth(y)):b},0):Math.round((i&&(d=r[v])!==null&&d!==void 0?d:s.getColWidth(v))*f),i?r[v]=s._adjustColWidth(v,_):o?s.scenegraph.setColWidth(v,s._adjustColWidth(v,_)):s._setColWidth(v,s._adjustColWidth(v,_),!1,!0)}}const Nx=new De({});Nx.role="empty";function xC(n,t,e,i,r,s,o,a,l){var h,d;let u,c,g,p=0;n.lastChild&&n.lastChild.row===i-1?p=n.lastChild.attribute.y+n.lastChild.attribute.height:n.colHeight&&(p=n.colHeight);for(let f=i;f<=r;f++){const m=f;let v,_,b,y,C=a.getCellLocation(t,m),S=a.getCellValue(t,m),w=e,x=a.getRowHeight(m),A=!1;if(a.internalProps.customMergeCell){const O=a.getCustomMerge(t,m);if(O){const{range:H,text:z,style:F,customLayout:j,customRender:$}=O;if(v=H,_=v.start.col!==v.end.col||v.start.row!==v.end.row,_){const Y=RN(v,s,a,i>v.start.row);w=Y.cellWidth,x=Y.cellHeight}S=z,b=F,(j||$)&&(y=Rd(j,$,H.start.col,H.start.row,a.getColsWidth(H.start.col,H.end.col),a.getRowsHeight(H.start.row,H.end.row),!1,a.isAutoRowHeight(m),[0,0,0,0],v,a)),A=!0}}let M,T=t,R=m;v&&(T=v.start.col,R=v.start.row),!a.isPivotTable()&&(C==="columnHeader"||C==="cornerHeader")&&m>=a.columnHeaderLevelCount&&(C="body"),M=!a.isPivotTable()&&a.isSeriesNumberInBody(t,m)?a.getBodyColumnDefine(T,R):C!=="body"?a.getHeaderDefine(T,R):a.getBodyColumnDefine(T,R);const B="isAggregation"in a.internalProps.layoutMap&&a.internalProps.layoutMap.isAggregation(t,m),E=a.internalProps.layoutMap.isSeriesNumber(t,m);let k=C!=="body"||((M==null?void 0:M.dragOrder)||!!(M!=null&&M.icon)||!!(M!=null&&M.tree))&&!(B&&E);if(!v&&(a.internalProps.enableTreeNodeMerge||C!=="body"||M!=null&&M.mergeCell)&&(v=a.getCellRange(t,m),_=v.start.col!==v.end.col||v.start.row!==v.end.row,_)){const O=RN(v,s,a,i>v.start.row);w=O.cellWidth,x=O.cellHeight}let P=!1;if(a.internalProps.enableTreeNodeMerge&&_){const O=a.getCellRawRecord(v.start.col,v.start.row),{vtableMergeName:H,vtableMerge:z}=O??{};P=z,z&&(k=!0,a.options.groupTitleCustomLayout&&(y=Rd(a.options.groupTitleCustomLayout,void 0,v.start.col,v.start.row,a.getColsWidth(v.start.col,v.end.col),a.getRowsHeight(v.start.row,v.end.row),!1,a.isAutoRowHeight(m),[0,0,0,0],v,a)),a.options.groupTitleFieldFormat?S=a.options.groupTitleFieldFormat(O,t,m,a):H&&(S=H))}const I=P||A?"text":(d=a.isHeader(t,m)?(h=a._getHeaderLayoutMap(t,m).headerType)!==null&&h!==void 0?h:"text":a.getBodyColumnType(t,m))!==null&&d!==void 0?d:"text";if(ua(S)){wCt(t,m,0,p,w,x,n),Eq(S,a,xCt.bind(null,{type:I,value:S,define:M,table:a,col:t,row:m,colWidth:e,cellWidth:w,cellHeight:x,columnGroup:n,y:p,customStyle:b,mayHaveIcon:k,cellLocation:C,range:v,customResult:y,defaultRowHeight:o})),n.updateColumnRowNumber(m);const O=a.getRowHeight(m);n.updateColumnHeight(O),p+=O}else{const O=b||a._getCellStyle(v?v.start.col:t,v?v.start.row:m),H=Vd(O,a,v?v.start.col:t,v?v.start.row:m,Mt).theme;H.group.cornerRadius=SM(t,m,a),H.group.width=e,H.group.height=Array.isArray(o)?o[m]:o,H._vtable.padding&&(u=H._vtable.padding),H.text.textAlign&&(c=H.text.textAlign),H.text.textBaseline&&(g=H.text.textBaseline),C==="body"||H.group.fill||(H.group.fill="#fff");const z=hD(I,S,M,a,t,m,e,w,x,n,p,u,c,g,k,H,v,y);if(n.updateColumnRowNumber(m),_){const F=a.getRowHeight(m),{width:j}=(a.getColWidth(t),z.attribute),{height:$}=z.attribute;z.contentWidth=j,z.contentHeight=$,Iq(v,j,$,u,c,g,a),n.updateColumnHeight(F),p+=F}else n.updateColumnHeight(x),p+=x}}return n.setAttribute("width",e),{width:e,height:p}}function xCt(n){let t,e,i;const{type:r,value:s,define:o,table:a,col:l,row:h,colWidth:d,cellWidth:u,cellHeight:c,columnGroup:g,y:p,cellLocation:f,mayHaveIcon:m,customStyle:v,range:_,customResult:b,defaultRowHeight:y}=n,C=v||a._getCellStyle(_?_.start.col:l,_?_.start.row:h),S=Vd(C,a,_?_.start.col:l,_?_.start.row:h,Mt).theme;S.group.cornerRadius=SM(l,h,a),S.group.width=d,S.group.height=Array.isArray(y)?y[h]:y,S._vtable.padding&&(t=S._vtable.padding),S.text.textAlign&&(e=S.text.textAlign),S.text.textBaseline&&(i=S.text.textBaseline),f==="body"||S.group.fill||(S.group.fill="#fff"),hD(r,s,o,a,l,h,d,u,c,g,p,t,e,i,m,S,_,b)}function RN(n,t,e,i){let r=0,s=0;const o=t.get(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`);if(!o||i){for(let a=n.start.col;a<=n.end.col;a++)r+=e.getColWidth(a);for(let a=n.start.row;a<=n.end.row;a++)s+=e.getRowHeight(a);t.set(`${n.start.col},${n.start.row};${n.end.col},${n.end.row}`,{cellWidth:r,cellHeight:s})}else r=o.cellWidth,s=o.cellHeight;return{cellWidth:r,cellHeight:s}}function wCt(n,t,e,i,r,s,o){const a=new De({x:e,y:i,width:r,height:s});a.role="cell",a.col=n,a.row=t,o.addChild(a)}function On(n,t,e,i,r,s,o,a,l,h){if(i>r||s>o)return;const{layoutMap:d,defaultHeaderRowHeight:u,defaultColWidth:c}=l.internalProps,g=l.defaultRowHeight;let p=0,f=0;for(let m=i;m<=r;m++){const v=m,_=l.getColWidth(v),b=new De({x:t+p,y:e,width:_,height:0,clip:!1,pickable:!1});b.role="column",b.col=m,n.addChild(b);const{width:y,height:C}=xC(b,v,_,s,o,l.scenegraph.mergeMap,a==="columnHeader"&&J(u)?u:g,l);p+=y,f=Math.max(f,C)}n.setAttribute("width",p),n.setAttribute("height",f)}function ACt(n,t,e,i,r,s,o,a,l){var h,d,u,c,g,p,f,m,v,_,b,y;const{table:C}=l,{leftBottomCornerGroup:S,rightTopCornerGroup:w,rightBottomCornerGroup:x}=C.scenegraph;let A,M,T,R;l.setParamsForRow(),l.setParamsForColumn(),(C.widthMode==="adaptive"||C.options.autoWrapText&&(C.heightMode==="adaptive"||C.isAutoRowHeight(C.columnHeaderLevelCount)))&&(T=C.colCount-1),A=Math.min(l.firstScreenColLimit-1,C.colCount-1),C.heightMode==="adaptive"&&(R=C.rowCount-1),M=Math.min(l.firstScreenRowLimit-1,C.rowCount-1),C.internalProps._widthResizedColMap.size===0&&fo(C,0,T??A),C.internalProps._heightResizedRowMap.size===0&&po(C,0,C.options.canvasHeight==="auto"?C.rowCount-1:R??M),A<C.colCount-C.rightFrozenColCount&&C.colCount-C.rightFrozenColCount<=C.colCount-1&&fo(C,C.colCount-C.rightFrozenColCount,C.colCount-1),M<C.rowCount-C.bottomFrozenRowCount&&C.rowCount-C.bottomFrozenRowCount<=C.rowCount-1&&po(C,C.rowCount-C.bottomFrozenRowCount,C.rowCount-1),C.scenegraph.colHeaderGroup.setAttribute("x",C.getFrozenColsWidth()),C.scenegraph.rowHeaderGroup.setAttribute("y",C.getFrozenRowsHeight()),C.scenegraph.bottomFrozenGroup.setAttribute("x",C.getFrozenColsWidth()),C.scenegraph.rightFrozenGroup.setAttribute("y",C.getFrozenRowsHeight()),C.scenegraph.bodyGroup.setAttributes({x:C.getFrozenColsWidth(),y:C.getFrozenRowsHeight()}),On(n,o,a,0,C.frozenColCount-1,0,C.frozenRowCount-1,C.isListTable()?"columnHeader":"cornerHeader",C),A-C.rightFrozenColCount>=C.frozenColCount&&On(t,o,a,C.frozenColCount,A-C.rightFrozenColCount,0,C.frozenRowCount-1,"columnHeader",C),C.frozenColCount>0&&(C.leftRowSeriesNumberCount>0&&On(e,o,a,0,C.leftRowSeriesNumberCount-1,C.frozenRowCount,M-C.bottomFrozenRowCount,"rowHeader",C),C.frozenColCount>C.leftRowSeriesNumberCount&&On(e,o,a,C.leftRowSeriesNumberCount,Math.min(C.frozenColCount-1,C.rowHeaderLevelCount+C.leftRowSeriesNumberCount-1),C.frozenRowCount,M-C.bottomFrozenRowCount,"rowHeader",C),C.frozenColCount>C.rowHeaderLevelCount+C.leftRowSeriesNumberCount&&On(e,o,a,C.rowHeaderLevelCount+C.leftRowSeriesNumberCount,C.frozenColCount-1,C.frozenRowCount,M-C.bottomFrozenRowCount,"body",C)),C.bottomFrozenRowCount>0&&(C.frozenColCount>0&&(C.leftRowSeriesNumberCount>0&&On(S,o,a,0,C.leftRowSeriesNumberCount-1,C.rowCount-1-C.bottomFrozenRowCount+1,C.rowCount-1,"rowHeader",C),C.rowHeaderLevelCount>0&&On(S,o,a,C.leftRowSeriesNumberCount,C.leftRowSeriesNumberCount+C.rowHeaderLevelCount-1,C.rowCount-1-C.bottomFrozenRowCount+1,C.rowCount-1,"rowHeader",C),C.frozenColCount>C.rowHeaderLevelCount+C.leftRowSeriesNumberCount&&On(S,o,a,C.rowHeaderLevelCount+C.leftRowSeriesNumberCount,C.frozenColCount-1,C.rowCount-1-C.bottomFrozenRowCount+1,C.rowCount-1,"body",C)),A-C.rightFrozenColCount>=C.frozenColCount&&On(r,o,a,C.frozenColCount,A-C.rightFrozenColCount,C.rowCount-1-C.bottomFrozenRowCount+1,C.rowCount-1,C.isPivotChart()?"rowHeader":"body",C)),C.rightFrozenColCount>0&&(On(w,o,a,C.colCount-1-C.rightFrozenColCount+1,C.colCount-1,0,C.frozenRowCount-1,"columnHeader",C),On(i,o,a,C.colCount-1-C.rightFrozenColCount+1,C.colCount-1,C.frozenRowCount,M-C.bottomFrozenRowCount,C.isPivotChart()?"rowHeader":"body",C)),C.bottomFrozenRowCount>0&&C.rightFrozenColCount>0&&On(x,o,a,C.colCount-1-C.rightFrozenColCount+1,C.colCount-1,C.rowCount-1-C.bottomFrozenRowCount+1,C.rowCount-1,"body",C),A-C.rightFrozenColCount>=C.frozenColCount&&On(s,o,a,C.frozenColCount,A-C.rightFrozenColCount,C.frozenRowCount,M-C.bottomFrozenRowCount,"body",C),s.firstChild||t.firstChild||n.firstChild||e.firstChild?(l.currentRow=(c=(d=(h=s.firstChild)===null||h===void 0?void 0:h.rowNumber)!==null&&d!==void 0?d:(u=e.firstChild)===null||u===void 0?void 0:u.rowNumber)!==null&&c!==void 0?c:l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=(y=(_=(m=(p=(g=s.lastChild)===null||g===void 0?void 0:g.col)!==null&&p!==void 0?p:(f=t.lastChild)===null||f===void 0?void 0:f.col)!==null&&m!==void 0?m:(v=e.lastChild)===null||v===void 0?void 0:v.col)!==null&&_!==void 0?_:(b=n.lastChild)===null||b===void 0?void 0:b.col)!==null&&y!==void 0?y:l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2),l.progress()):(l.currentRow=l.totalRow,l.rowEnd=l.currentRow,l.rowUpdatePos=l.rowEnd+1,l.referenceRow=l.rowStart+Math.floor((l.rowEnd-l.rowStart)/2),l.currentCol=l.totalCol,l.colEnd=l.currentCol,l.colUpdatePos=l.colEnd+1,l.referenceCol=l.colStart+Math.floor((l.colEnd-l.colStart)/2))}function BN(n){let t=n.firstChild;for(;t&&t.type!=="group";)t=t._next;return t}function Y_(n){let t=n.lastChild;for(;t&&t.type!=="group";)t=t._prev;return t}function MCt(n){let t=n._prev;for(;t&&t.type!=="group";)t=t._prev;return t}function TCt(n){let t=n._next;for(;t&&t.type!=="group";)t=t._next;return t}function uL(n,t,e,i="left"){for(let a=n;a<=t;a++){const l=e.scenegraph.getColGroup(a);l&&jR(l,e,i);const h=e.scenegraph.getColGroup(a,!0);h&&jR(h,e,i);const d=e.scenegraph.getColGroupInBottom(a);d&&jR(d,e,i)}const r=Math.min(e.scenegraph.proxy.colLimit,e.scenegraph.proxy.bodyRightCol-e.scenegraph.proxy.bodyLeftCol+1),s=e.getColsWidth(e.frozenColCount,e.frozenColCount+r),o=e.getColsWidth(e.frozenColCount,e.colCount-1);e.scenegraph.proxy.xLimitLeft=s/2,e.scenegraph.proxy.xLimitRight=o-s/2}function jR(n,t,e="left"){if(e==="left"){let i;const r=MCt(n);i=r?r.attribute.x+t.getColWidth(n._prev.col):t.getColsWidth(t.frozenColCount,n.col-1),n.setAttribute("x",i)}else{let i;const r=TCt(n);i=r?r.attribute.x-t.getColWidth(n.col):t.getColsWidth(t.frozenColCount,n.col-1),n.setAttribute("x",i)}}var Gq=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function kCt(n,t,e,i){return Gq(this,void 0,void 0,function*(){if(!t)return;const r=t.col,s=t.left;let o;if(o=e?i.bodyRightCol-i.colEnd:i.screenLeftCol-i.referenceCol,RCt(o,r,s,n,i),e){const a=i.table.scenegraph.getColGroup(i.colEnd);if(a){const l=a.attribute.x+a.attribute.width-(i.table.tableNoFrameWidth-i.table.getFrozenColsWidth()-i.table.getRightFrozenColsWidth())-n;i.deltaX=-l,i.table.scenegraph.setBodyAndColHeaderX(-n+i.deltaX)}}i.table.scenegraph.updateNextFrame()})}function RCt(n,t,e,i,r){n>0?(PN(n,"left",r.screenLeftCol,e,i,r),r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):n<0?(PN(-n,"right",r.screenLeftCol,e,i,r),r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX)):(r.updateDeltaX(i,e,t),r.table.scenegraph.setBodyAndColHeaderX(-i+r.deltaX))}function PN(n,t,e,i,r,s){return Gq(this,void 0,void 0,function*(){if(t==="left"&&s.colEnd+n>s.bodyRightCol?n=s.bodyRightCol-s.colEnd:t==="right"&&s.colStart-n<s.bodyLeftCol&&(n=s.colStart-s.bodyLeftCol),n!==0)if(n<0&&(t=t==="left"?"right":"left",n=-n),n<s.colEnd-s.colStart){const o=t==="left"?s.colStart:s.colEnd-n+1,a=t==="left"?s.colStart+n-1:s.colEnd,l=t==="left"?s.colEnd+1:s.colStart-n,h=t==="left"?s.colEnd+n:s.colStart-1;fo(s.table,l,h),PCt(o,a,t,s);const d=l,u=h;s.colStart=t==="left"?s.colStart+n:s.colStart-n,s.colEnd=t==="left"?s.colEnd+n:s.colEnd-n,X_(d,u,s),uL(d,u,s.table,t);const c=s.table.scenegraph.getColGroup(e)||s.table.scenegraph.getColGroup(e,!0),g=i-(c.attribute.x+s.table.getFrozenColsWidth()+s.table.scenegraph.proxy.deltaX);s.table.scenegraph.proxy.deltaX+=g,s.currentCol=t==="left"?s.currentCol+n:s.currentCol-n,s.totalCol=Math.max(0,Math.min(s.table.colCount-1,t==="left"?s.totalCol+n:s.totalCol-n)),s.referenceCol=s.colStart+Math.floor((s.colEnd-s.colStart)/2),s.colUpdatePos=l,s.colUpdateDirection=t,s.table.scenegraph.updateNextFrame()}else{const o=t==="left"?s.colStart+n:s.colStart-n,a=t==="left"?s.colEnd+n:s.colEnd-n;fo(s.table,o,a),ECt(s.table.getColsWidth(s.bodyLeftCol,o-1),n,t,s);const l=o,h=a;s.colStart=o,s.colEnd=a,X_(l,h,s),uL(l,h,s.table,a>s.bodyRightCol-(s.colEnd-s.colStart+1)?"right":"left"),s.currentCol=t==="left"?s.currentCol+n:s.currentCol-n,s.totalCol=Math.max(0,Math.min(s.table.colCount-1,t==="left"?s.totalCol+n:s.totalCol-n)),s.referenceCol=s.colStart+Math.floor((s.colEnd-s.colStart)/2),s.colUpdatePos=s.colStart,s.colUpdateDirection=a>s.bodyRightCol-(s.colEnd-s.colStart+1)?"right":"left",s.table.scenegraph.updateNextFrame()}})}function Sv(n,t,e){n.col=t,n.forEachChildren(i=>{i.col=t,i.needUpdate=!0}),n.setAttribute("x",e),n.needUpdate=!0}function xy(n,t){if(!n)return;let e=n.firstChild;for(;e;)e=t.updateCellGroupContent(e)._next;n.needUpdate=!1,n.setAttribute("width",t.table.getColWidth(n.col))}function BCt(n,t){if(!n)return;const e=t.screenTopRow,i=Math.max(t.bodyTopRow,e-1*t.screenRowCount),r=Math.min(t.bodyBottomRow,e+2*t.screenRowCount,t.table.rowCount-1);for(let s=i;s<=r;s++){const o=t.highPerformanceGetCell(n.col,s,!0);t.updateCellGroupContent(o)}t.rowUpdatePos=t.rowStart,n.needUpdate=!1,n.setAttribute("width",t.table.getColWidth(n.col))}function PCt(n,t,e,i){for(let r=n;r<=t;r++)i.table.scenegraph.bodyGroup.childrenCount>0&&i.table.scenegraph.bodyGroup.firstChild.type==="group"&&NR(i.table.scenegraph.bodyGroup,e,i),i.table.scenegraph.colHeaderGroup.childrenCount>0&&i.table.scenegraph.colHeaderGroup.firstChild.type==="group"&&NR(i.table.scenegraph.colHeaderGroup,e,i),i.table.scenegraph.bottomFrozenGroup.childrenCount>0&&i.table.scenegraph.bottomFrozenGroup.firstChild.type==="group"&&NR(i.table.scenegraph.bottomFrozenGroup,e,i)}function NR(n,t,e){if(t==="left"){const i=BN(n),r=Y_(n);Sv(i,r.col+1,r.attribute.x+e.table.getColWidth(r.col)),n.appendChild(i),n.border&&n.appendChild(n.border)}else{const i=Y_(n),r=BN(n);Sv(i,r.col-1,r.attribute.x-e.table.getColWidth(r.col-1)),n.insertBefore(i,n.firstChild)}}function X_(n,t,e){for(let i=n;i<=t;i++){const r=e.table.scenegraph.getColGroup(i,!0);r&&xy(r,e);const s=e.table.scenegraph.getColGroupInBottom(i);s&&xy(s,e);const o=e.table.scenegraph.getColGroupInRightTopCorner(i);o&&xy(o,e);const a=e.table.scenegraph.getColGroupInRightBottomCorner(i);a&&xy(a,e);const l=e.table.scenegraph.getColGroup(i);l&&BCt(l,e)}$R(e.table.scenegraph.colHeaderGroup),$R(e.table.scenegraph.bottomFrozenGroup),$R(e.table.scenegraph.bodyGroup),e.progress()}function ECt(n,t,e,i){i.table.scenegraph.colHeaderGroup.forEachChildren((r,s)=>{r.type==="group"&&Sv(r,e==="left"?r.col+t:r.col-t,s===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))}),i.table.scenegraph.bottomFrozenGroup.forEachChildren((r,s)=>{r.type==="group"&&Sv(r,e==="left"?r.col+t:r.col-t,s===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))}),i.table.scenegraph.bodyGroup.forEachChildren((r,s)=>{r.type==="group"&&Sv(r,e==="left"?r.col+t:r.col-t,s===0?n:r._prev.attribute.x+i.table.getColWidth(r._prev.col))})}function $R(n){var t,e;const i=Y_(n);if(i&&(n.setAttribute("width",i.attribute.x+i.attribute.width),n.border)){const r=n.border;r.setAttribute("width",i.attribute.x+i.attribute.width-((t=r.attribute.borderLeft)!==null&&t!==void 0?t:0)/2-((e=r.attribute.borderRight)!==null&&e!==void 0?e:0)/2)}}function Is(n,t,e,i,r,s="up",o){var a,l;if(s==="up")for(let c=n;c<=t;c++)for(let g=e;g<=i;g++){const p=r.scenegraph.highPerformanceGetCell(c,g,!0);if(p.role!=="cell"||!p.row)continue;let f;if(p._prev)f=((a=p._prev)===null||a===void 0?void 0:a.attribute.y)+r.getRowHeight(p._prev.row);else if(o){const m=i===r.rowCount-r.bottomFrozenRowCount-1?i:i+1;if(f=r.scenegraph.highPerformanceGetCell(c,m,!0).attribute.y,L(f))for(let v=g;v<m;v++)f-=r.getRowHeight(v)}else f=EN(p.row,r);L(f)&&p.setAttribute("y",f)}else for(let c=n;c<=t;c++)for(let g=i;g>=e;g--){const p=r.scenegraph.highPerformanceGetCell(c,g,!0);if(p.role!=="cell"||!p.row)continue;let f;if(p._next)f=((l=p._next)===null||l===void 0?void 0:l.attribute.y)-r.getRowHeight(p.row);else if(o){const m=e<=r.frozenRowCount?r.frozenRowCount:e-1;e<=r.frozenRowCount?f=0:f=r.scenegraph.highPerformanceGetCell(c,m,!0).attribute.y;for(let v=m;v<g;v++)f+=r.getRowHeight(v)}else f=EN(p.row,r);L(f)&&p.setAttribute("y",f)}const h=Math.min(r.scenegraph.proxy.rowLimit,r.scenegraph.proxy.bodyBottomRow-r.scenegraph.proxy.bodyTopRow+1),d=r.getRowsHeight(r.frozenRowCount,r.frozenRowCount+h),u=r.getRowsHeight(r.frozenRowCount,r.rowCount-1);r.scenegraph.proxy.yLimitTop=d/2,r.scenegraph.proxy.yLimitBottom=u-d/2}function EN(n,t){let e;return e=n<t.frozenRowCount?t.getRowsHeight(0,n-1):n>=t.rowCount-t.bottomFrozenRowCount?t.getRowsHeight(t.rowCount-t.bottomFrozenRowCount,n-1):t.getRowsHeight(t.frozenRowCount,n-1),e}var Uq=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function LCt(n,t,e,i){return Uq(this,void 0,void 0,function*(){if(!t)return;const r=t.row,s=t.top;let o;if(o=e?i.bodyBottomRow-i.rowEnd:r-i.referenceRow,ICt(o,r,s,n,i),e){const a=i.table.scenegraph.highPerformanceGetCell(i.colStart,i.rowEnd,!0);if(a.role==="cell"){const l=a.attribute.y+a.attribute.height-(i.table.tableNoFrameHeight-i.table.getFrozenRowsHeight()-i.table.getBottomFrozenRowsHeight())-n;i.deltaY=-l,i.updateBody(n-i.deltaY)}}})}function ICt(n,t,e,i,r){n>0?(LN(n,"up",t,e,i,r),r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY)):n<0?(LN(-n,"down",t,e,i,r),r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY)):(r.updateDeltaY(i,e,t),r.updateBody(i-r.deltaY))}function LN(n,t,e,i,r,s){return Uq(this,void 0,void 0,function*(){if(t==="up"&&s.rowEnd+n>s.bodyBottomRow?n=s.bodyBottomRow-s.rowEnd:t==="down"&&s.rowStart-n<s.bodyTopRow&&(n=s.rowStart-s.bodyTopRow),n!==0)if(n<0&&(t=t==="up"?"down":"up",n=-n),n<s.rowEnd-s.rowStart){const o=t==="up"?s.rowStart:s.rowEnd-n+1,a=t==="up"?s.rowStart+n-1:s.rowEnd,l=t==="up"?s.rowEnd+1:s.rowStart-n,h=t==="up"?s.rowEnd+n:s.rowStart-1;let d,u;s.table.isAutoRowHeight(o)?(d=l,u=h):(d=Math.max(s.bodyTopRow,e-1*s.screenRowCount),u=Math.min(s.bodyBottomRow,e+2*s.screenRowCount,s.table.rowCount-1)),po(s.table,d,u,!1),OCt(o,a,t,s),s.rowStart=t==="up"?s.rowStart+n:s.rowStart-n,s.rowEnd=t==="up"?s.rowEnd+n:s.rowEnd-n;const c=K_(d,u,s,!0);s.table.isAutoRowHeight(o)&&(Is(s.bodyLeftCol,s.bodyRightCol,d,u,s.table,h>s.bodyBottomRow-(s.rowEnd-s.rowStart+1)?"down":"up",!0),Is(0,s.table.frozenColCount-1,d,u,s.table,h>s.bodyBottomRow-(s.rowEnd-s.rowStart+1)?"down":"up",!0),Is(s.table.colCount-s.table.rightFrozenColCount,s.table.colCount-1,d,u,s.table,h>s.bodyBottomRow-(s.rowEnd-s.rowStart+1)?"down":"up",!0)),s.currentRow=t==="up"?s.currentRow+n:s.currentRow-n,s.totalRow=Math.max(0,Math.min(s.bodyBottomRow,t==="up"?s.totalRow+n:s.totalRow-n,s.table.rowCount-1)),s.referenceRow=s.rowStart+Math.floor((s.rowEnd-s.rowStart)/2),s.table.isAutoRowHeight(o)&&c?s.rowUpdatePos=Math.min(s.rowUpdatePos,s.rowEnd+1):s.rowUpdatePos=Math.min(s.rowUpdatePos,l),s.rowUpdateDirection=t,s.table.scenegraph.updateNextFrame(),yield s.progress()}else{const o=t==="up"?s.rowStart+n:s.rowStart-n,a=Math.min(s.table.rowCount-1,t==="up"?s.rowEnd+n:s.rowEnd-n),l=s.table.getRowsHeight(s.bodyTopRow,o-1);let h,d;s.table.isAutoRowHeight(o)?(h=o,d=a):(h=Math.max(s.bodyTopRow,e-1*s.screenRowCount),d=Math.min(s.bodyBottomRow,e+2*s.screenRowCount,s.table.rowCount-1)),po(s.table,h,d,!1),DCt(l,n,t,s),s.rowStart=o,s.rowEnd=a;const u=K_(h,d,s,!0);s.table.isAutoRowHeight(o)&&(Is(s.bodyLeftCol,s.bodyRightCol,h,d,s.table,a>s.bodyBottomRow-(s.rowEnd-s.rowStart+1)?"down":"up"),Is(0,s.table.frozenColCount-1,h,d,s.table,a>s.bodyBottomRow-(s.rowEnd-s.rowStart+1)?"down":"up"),Is(s.table.colCount-s.table.rightFrozenColCount,s.table.colCount-1,h,d,s.table,a>s.bodyBottomRow-(s.rowEnd-s.rowStart+1)?"down":"up")),s.currentRow=t==="up"?s.currentRow+n:s.currentRow-n,s.totalRow=Math.max(0,Math.min(s.bodyBottomRow,t==="up"?s.totalRow+n:s.totalRow-n,s.table.rowCount-1)),s.referenceRow=s.rowStart+Math.floor((s.rowEnd-s.rowStart)/2),s.table.isAutoRowHeight(o)&&u?s.rowUpdatePos=s.rowEnd+1:s.rowUpdatePos=s.rowStart,s.rowUpdateDirection=a>s.bodyBottomRow-(s.rowEnd-s.rowStart+1)?"down":"up",s.table.scenegraph.updateNextFrame(),yield s.progress()}})}function OCt(n,t,e,i){for(let r=0;r<i.table.frozenColCount;r++){const s=i.table.scenegraph.getColGroup(r);if(s)for(let o=n;o<=t;o++)VR(s,e,i)}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const s=i.table.scenegraph.getColGroup(r);if(s)for(let o=n;o<=t;o++)VR(s,e,i)}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const s=i.table.scenegraph.getColGroup(r);if(s)for(let o=n;o<=t;o++)VR(s,e,i)}}function VR(n,t,e){if(n.childrenCount>=1)if(t==="up"){const i=n.firstChild;e.updateCellGroupPosition(i,n.lastChild.row+1,n.lastChild.attribute.y+e.table.getRowHeight(n.lastChild.row)),n.appendChild(i)}else{const i=n.lastChild;e.updateCellGroupPosition(i,n.firstChild.row-1,n.firstChild.attribute.y-e.table.getRowHeight(i.row)),n.insertBefore(i,n.firstChild)}}function DCt(n,t,e,i){for(let r=0;r<i.table.frozenColCount;r++){const s=i.table.scenegraph.getColGroup(r);s==null||s.forEachChildren((o,a)=>{i.updateCellGroupPosition(o,e==="up"?o.row+t:o.row-t,a===0?n:o._prev.attribute.y+i.table.getRowHeight(o._prev.row))})}for(let r=i.table.colCount-i.table.rightFrozenColCount;r<i.table.colCount;r++){const s=i.table.scenegraph.getColGroup(r);s==null||s.forEachChildren((o,a)=>{i.updateCellGroupPosition(o,e==="up"?o.row+t:o.row-t,a===0?n:o._prev.attribute.y+i.table.getRowHeight(o._prev.row))})}for(let r=i.bodyLeftCol;r<=i.bodyRightCol;r++){const s=i.table.scenegraph.getColGroup(r);s==null||s.forEachChildren((o,a)=>{i.updateCellGroupPosition(o,e==="up"?o.row+t:o.row-t,a===0?n:o._prev.attribute.y+i.table.getRowHeight(o._prev.row))})}}function K_(n,t,e,i=!1){for(let a=0;a<e.table.frozenColCount;a++)for(let l=n;l<=t;l++){const h=e.highPerformanceGetCell(a,l,!0);e.updateCellGroupContent(h)}for(let a=e.table.colCount-e.table.rightFrozenColCount;a<e.table.colCount;a++)for(let l=n;l<=t;l++){const h=e.highPerformanceGetCell(a,l);e.updateCellGroupContent(h)}let r=e.bodyLeftCol,s=e.bodyRightCol,o=!0;if(i){const a=e.screenLeftCol;r=Math.max(e.bodyLeftCol,a-1*e.screenColCount),s=Math.min(e.bodyRightCol,a+2*e.screenColCount),r===e.bodyLeftCol&&s===e.bodyRightCol||(o=!1)}for(let a=r;a<=s;a++)for(let l=n;l<=t;l++){const h=e.highPerformanceGetCell(a,l);e.updateCellGroupContent(h)}return GR(e.table.scenegraph.rowHeaderGroup),GR(e.table.scenegraph.rightFrozenGroup),GR(e.table.scenegraph.bodyGroup),e.table.scenegraph.updateNextFrame(),o}function GR(n){var t,e;const i=Y_(n);if(!i)return;const r=Y_(i);if(r&&(n.setAttribute("height",r.attribute.y+r.attribute.height),n.border)){const s=n.border;s.setAttribute("height",r.attribute.y+r.attribute.height-((t=s.attribute.borderTop)!==null&&t!==void 0?t:0)/2-((e=s.attribute.borderBottom)!==null&&e!==void 0?e:0)/2)}}var FCt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function HCt(n){var t;return FCt(this,void 0,void 0,function*(){let e,i;n.table.scenegraph.bodyGroup.forEachChildren((o,a)=>{o.type==="group"&&(o.needUpdate=!0,o==null||o.forEachChildren(l=>{l.needUpdate=!0}))}),n.table.isAutoRowHeight(n.rowStart)?(e=n.rowStart,i=n.rowEnd):(e=Math.max(n.bodyTopRow,n.screenTopRow-1*n.screenRowCount),i=Math.min(n.bodyBottomRow,n.screenTopRow+2*n.screenRowCount,n.table.rowCount-1));const r=n.table.getAllRowsHeight();po(n.table,e,i);const s=n.table.getAllRowsHeight();r!==s&&n.table.scenegraph.updateContainerHeight(n.table.frozenRowCount,s-r);for(let o=0;o<((t=n.table.frozenColCount)!==null&&t!==void 0?t:0);o++){const a=n.table.scenegraph.getColGroup(o);a==null||a.setAttribute("chartInstance",void 0);for(let l=n.rowStart;l<=n.rowEnd;l++)n.table.scenegraph.updateCellContent(o,l);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(o,l)}for(let o=n.colStart;o<=n.colEnd;o++){const a=n.table.scenegraph.getColGroup(o);a==null||a.setAttribute("chartInstance",void 0);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(o,l)}for(let o=n.table.colCount-n.table.rightFrozenColCount;o<n.table.colCount;o++){const a=n.table.scenegraph.getColGroup(o);a==null||a.setAttribute("chartInstance",void 0);for(let l=n.rowStart;l<=n.rowEnd;l++)n.table.scenegraph.updateCellContent(o,l);for(let l=n.table.rowCount-n.table.bottomFrozenRowCount;l<n.table.rowCount;l++)n.table.scenegraph.updateCellContent(o,l)}K_(e,i,n),n.table.isAutoRowHeight(e)&&Is(n.bodyLeftCol,n.bodyRightCol,e,i,n.table,n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up"),n.rowUpdatePos=n.rowStart,n.rowUpdateDirection=n.rowEnd>n.bodyBottomRow-(n.rowEnd-n.rowStart+1)?"down":"up",n.table.scenegraph.updateNextFrame(),n.table.isAutoRowHeight(n.rowStart)||(yield n.progress())})}var zCt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function WCt(n){return zCt(this,void 0,void 0,function*(){n.table.scenegraph.bodyGroup.forEachChildren((i,r)=>{i.type==="group"&&(i.needUpdate=!0,i==null||i.forEachChildren(s=>{s.needUpdate=!0}))});const t=Math.max(n.bodyLeftCol,n.screenLeftCol-1*n.screenColCount),e=Math.min(n.bodyRightCol,n.screenLeftCol+2*n.screenColCount);fo(n.table,t,e);for(let i=n.colStart;i<=n.colEnd;i++){const r=n.table.scenegraph.getColGroup(i);r==null||r.setAttribute("chartInstance",void 0);for(let s=n.table.rowCount-n.table.bottomFrozenRowCount;s<n.table.rowCount;s++)n.table.scenegraph.updateCellContent(i,s)}for(let i=n.table.colCount-n.table.rightFrozenColCount;i<n.table.colCount;i++){const r=n.table.scenegraph.getColGroup(i);r==null||r.setAttribute("chartInstance",void 0);for(let s=n.rowStart;s<=n.rowEnd;s++)n.table.scenegraph.updateCellContent(i,s);for(let s=n.table.rowCount-n.table.bottomFrozenRowCount;s<n.table.rowCount;s++)n.table.scenegraph.updateCellContent(i,s)}X_(t,e,n),n.colUpdatePos=n.colStart,n.colUpdateDirection=n.colEnd>n.bodyRightCol-(n.colEnd-n.colStart+1)?"right":"left",n.table.scenegraph.updateNextFrame(),yield n.progress()})}function gD(n){const{changedCells:t}=n.internalProps.stick;return t.forEach(e=>{n.scenegraph.getCell(e.col,e.row).forEachChildren(i=>{i.setAttributes({dx:e.dx,dy:e.dy})})}),t.clear(),t}function xv(n){const t=gD(n),{scrollTop:e,scrollLeft:i,frozenRowCount:r,frozenColCount:s}=n,o=n.getFrozenRowsHeight(),a=n.getFrozenColsWidth(),{row:l}=n.getRowAt(e+o+1),{col:h}=n.getColAt(i+a+1),d=Math.max(l,n.frozenRowCount),u=Math.max(h,n.frozenColCount),c=n.getAllRowsHeight()>n.tableNoFrameHeight?n.getRowAt(e+n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()-1).row:n.rowCount-n.bottomFrozenRowCount-1,g=n.getAllColsWidth()>n.tableNoFrameWidth?n.getColAt(i+n.tableNoFrameWidth-n.getRightFrozenColsWidth()-1).col:n.colCount-n.rightFrozenColCount-1;if(!(g<0||c<0)){for(let p=0;p<r&&!(g<u);p++)[u,g].forEach(f=>{const m=n._getCellStyle(f,p);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="vertical"&&DN(n.scenegraph.getCell(f,p),a+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,t,m==null?void 0:m.textStickBaseOnAlign,n)});for(let p=0;p<s&&!(c<d);p++)[d,c].forEach(f=>{const m=n._getCellStyle(p,f);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="horizontal"&&IN(n.scenegraph.getCell(p,f),o+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,t,m==null?void 0:m.textStickBaseOnAlign,n)});for(let p=u;p<=g&&!(c<d);p++)[d,c].forEach(f=>{const m=n._getCellStyle(p,f);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="horizontal"&&IN(n.scenegraph.getCell(p,f),o+n.tableY,n.tableNoFrameHeight-n.getBottomFrozenRowsHeight()+n.tableY,t,m==null?void 0:m.textStickBaseOnAlign,n)});for(let p=d;p<=c&&!(g<u);p++)[u,g].forEach(f=>{const m=n._getCellStyle(f,p);m!=null&&m.textStick&&(m==null?void 0:m.textStick)!=="vertical"&&DN(n.scenegraph.getCell(f,p),a+n.tableX,n.tableNoFrameWidth-n.getRightFrozenColsWidth()+n.tableX,t,m==null?void 0:m.textStickBaseOnAlign,n)})}}function IN(n,t,e,i,r,s){if(J(n.mergeStartCol)&&J(n.mergeStartRow)&&J(n.mergeEndCol)&&J(n.mergeEndRow)){const{colStart:o,colEnd:a,rowStart:l,rowEnd:h}=Gd(n,s.scenegraph);for(let d=o;d<=a;d++)for(let u=l;u<=h;u++){const c=s.scenegraph.getCell(d,u);c.role==="cell"&&ON(c,t,e,i,r)}}else ON(n,t,e,i,r)}function ON(n,t,e,i,r){var s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C;const S=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!S)return;if(S.type==="image"){const{image:M}=S.attribute;if(!M||!S.resources||S.resources.get(M).state!=="success")return}const w=(s=S.textBaseline)!==null&&s!==void 0?s:"top";S.AABBBounds.width();const x=S.globalAABBBounds.y1,A=S.globalAABBBounds.y2;if(w==="middle"&&r){const M=n.globalAABBBounds.y1+((a=(o=n.firstChild)===null||o===void 0?void 0:o.attribute.dy)!==null&&a!==void 0?a:0),T=M+((h=(l=n.contentHeight)!==null&&l!==void 0?l:n.attribute.height)!==null&&h!==void 0?h:0);if(M<t||T>e){const R=Math.max(M,t),B=Math.min(T,e),E=S.globalTransMatrix.f-(B+R)/2+S.AABBBounds.height()/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(u=(d=n.firstChild)===null||d===void 0?void 0:d.attribute.dx)!==null&&u!==void 0?u:0,dy:(g=(c=n.firstChild)===null||c===void 0?void 0:c.attribute.dy)!==null&&g!==void 0?g:0}),n.forEachChildren(k=>{var P;k.setAttribute("dy",((P=k.attribute.dy)!==null&&P!==void 0?P:0)-E+2)})}}else if(x<t){const M=x-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(f=(p=n.firstChild)===null||p===void 0?void 0:p.attribute.dx)!==null&&f!==void 0?f:0,dy:(v=(m=n.firstChild)===null||m===void 0?void 0:m.attribute.dy)!==null&&v!==void 0?v:0}),n.forEachChildren(T=>{var R;T.setAttribute("dy",((R=T.attribute.dy)!==null&&R!==void 0?R:0)-M+2)})}else if(A>e){const M=A-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(b=(_=n.firstChild)===null||_===void 0?void 0:_.attribute.dx)!==null&&b!==void 0?b:0,dy:(C=(y=n.firstChild)===null||y===void 0?void 0:y.attribute.dy)!==null&&C!==void 0?C:0}),n.forEachChildren(T=>{var R;T.setAttribute("dy",((R=T.attribute.dy)!==null&&R!==void 0?R:0)-M)})}}function DN(n,t,e,i,r,s){if(J(n.mergeStartCol)&&J(n.mergeStartRow)&&J(n.mergeEndCol)&&J(n.mergeEndRow)){const{colStart:o,colEnd:a,rowStart:l,rowEnd:h}=Gd(n,s.scenegraph);for(let d=o;d<=a;d++)for(let u=l;u<=h;u++){const c=s.scenegraph.getCell(d,u);c.role==="cell"&&FN(c,t,e,i,r)}}else FN(n,t,e,i,r)}function FN(n,t,e,i,r){var s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S;const w=n.getChildByName("text",!0)||n.getChildByName("image",!0);if(!w)return;if(w.type==="image"){const{image:T}=w.attribute;if(!T||!w.resources||w.resources.get(T).state!=="success")return}const x=(o=(s=w.attribute.textAlign)!==null&&s!==void 0?s:w.textAlign)!==null&&o!==void 0?o:"left";w.AABBBounds.width();const A=w.globalAABBBounds.x1,M=w.globalAABBBounds.x2;if(x==="center"&&r){const T=n.globalAABBBounds.x1+((l=(a=n.firstChild)===null||a===void 0?void 0:a.attribute.dx)!==null&&l!==void 0?l:0),R=T+((d=(h=n.contentWidth)!==null&&h!==void 0?h:n.attribute.width)!==null&&d!==void 0?d:0);if(T<t||R>e){const B=Math.max(T,t),E=Math.min(R,e),k=w.globalTransMatrix.e-(E+B)/2;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(c=(u=n.firstChild)===null||u===void 0?void 0:u.attribute.dx)!==null&&c!==void 0?c:0,dy:(p=(g=n.firstChild)===null||g===void 0?void 0:g.attribute.dy)!==null&&p!==void 0?p:0}),n.forEachChildren(P=>{var I;P.setAttribute("dx",((I=P.attribute.dx)!==null&&I!==void 0?I:0)-k+2)})}}else if(A<t){const T=A-t;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(m=(f=n.firstChild)===null||f===void 0?void 0:f.attribute.dx)!==null&&m!==void 0?m:0,dy:(_=(v=n.firstChild)===null||v===void 0?void 0:v.attribute.dy)!==null&&_!==void 0?_:0}),n.forEachChildren(R=>{var B;R.setAttribute("dx",((B=R.attribute.dx)!==null&&B!==void 0?B:0)-T+2)})}else if(M>e){const T=M-e;!i.has(`${n.col}-${n.row}`)&&i.set(`${n.col}-${n.row}`,{col:n.col,row:n.row,dx:(y=(b=n.firstChild)===null||b===void 0?void 0:b.attribute.dx)!==null&&y!==void 0?y:0,dy:(S=(C=n.firstChild)===null||C===void 0?void 0:C.attribute.dy)!==null&&S!==void 0?S:0}),n.forEachChildren(R=>{var B;R.setAttribute("dx",((B=R.attribute.dx)!==null&&B!==void 0?B:0)-T)})}}function $x(n){var t,e;const i=n.internalProps.layoutMap.headerObjects,r=n.internalProps.layoutMap.columnObjects;for(let s=0;s<i.length;s++){const o=i[s];if(o&&(!((t=o.style)===null||t===void 0)&&t.textStick))return!0}for(let s=0;s<r.length;s++){const o=r[s];if(o&&(!((e=o.style)===null||e===void 0)&&e.textStick))return!0}return!!(n.theme.headerStyle.textStick||n.theme.rowHeaderStyle.textStick||n.theme.bodyStyle.textStick)}var qs=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};class jCt{constructor(t){this.isRelease=!1,this.mode="column",this.rowLimit=200,this.currentRow=0,this.rowStart=0,this.rowEnd=0,this.referenceRow=0,this.screenTopRow=0,this.deltaY=0,this.deltaHeight=0,this.colLimit=100,this.screenLeftCol=0,this.deltaX=0,this.deltaWidth=0,this.cellCache=new Map,this.table=t,this.table.isPivotChart()?(this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))):this.table.isAutoRowHeight(t.columnHeaderLevelCount)?this.rowLimit=Math.max(100,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight)):(this.table.widthMode==="autoWidth"||(this.rowLimit=Math.max(200,Math.ceil(2*t.tableNoFrameHeight/t.defaultRowHeight))),this.colLimit=Math.max(100,Math.ceil(2*t.tableNoFrameWidth/t.defaultColWidth))),this.table.internalProps.transpose?this.mode="row":this.table.isPivotTable()&&(this.mode="pivot"),this.table.options.maintainedDataCount&&(this.rowLimit=this.table.options.maintainedDataCount),this.table.options.maintainedColumnCount&&(this.colLimit=this.table.options.maintainedColumnCount),this.table.heightMode==="adaptive"&&(this.rowLimit=this.table.rowCount),this.table.widthMode==="adaptive"&&(this.colLimit=this.table.colCount)}get bodyLeftCol(){return this.table.frozenColCount}get bodyTopRow(){return this.table.frozenRowCount}setParamsForColumn(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol;const e=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/e);const i=e*t,r=e*(this.bodyRightCol-this.bodyLeftCol+1);this.xLimitLeft=i/2,this.xLimitRight=r-i/2;const s=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/e),this.firstScreenColLimit=Math.max(15,this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(s/e))),this.colUpdatePos=this.bodyRightCol}setParamsForRow(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.bodyTopRow+t-1,this.rowStart=this.bodyTopRow,this.rowEnd=this.totalRow;const e=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/e);const i=e*t,r=e*(this.bodyBottomRow-this.bodyTopRow+1);this.yLimitTop=i/2,this.yLimitBottom=r-i/2;const s=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/e),this.firstScreenRowLimit=Math.max(30,this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(s/e))),this.rowUpdatePos=this.bodyBottomRow}refreshRowCount(){this.bodyBottomRow=this.table.rowCount-1-this.table.bottomFrozenRowCount;const t=Math.min(this.rowLimit,this.bodyBottomRow-this.bodyTopRow+1);this.totalActualBodyRowCount=t,this.totalRow=this.rowStart+t-1}refreshColCount(){this.bodyRightCol=this.table.colCount-1-this.table.rightFrozenColCount;const t=Math.min(this.colLimit,this.bodyRightCol-this.bodyLeftCol+1);this.totalActualBodyColCount=t,this.totalCol=this.bodyLeftCol+t-1,this.colStart=this.bodyLeftCol,this.colEnd=this.totalCol}resize(){const t=this.table.defaultColWidth;this.taskColCount=1*Math.ceil(this.table.tableNoFrameWidth/t);const e=5*this.table.tableNoFrameWidth;this.screenColCount=Math.ceil(this.table.tableNoFrameWidth/t),this.firstScreenColLimit=this.bodyLeftCol+Math.min(this.colLimit,Math.ceil(e/t));const i=this.table.defaultRowHeight;this.taskRowCount=1*Math.ceil(this.table.tableNoFrameHeight/i);const r=5*this.table.tableNoFrameHeight;this.screenRowCount=Math.ceil(this.table.tableNoFrameHeight/i),this.firstScreenRowLimit=this.bodyTopRow+Math.min(this.rowLimit,Math.ceil(r/i))}createGroupForFirstScreen(t,e,i,r,s,o,a,l){ACt(t,e,i,r,s,o,a,l,this)}progress(){return qs(this,void 0,void 0,function*(){if(!this.isProgressing)return this.isProgressing=!0,new Promise((t,e)=>{setTimeout(()=>qs(this,void 0,void 0,function*(){this.isProgressing=!1,this.isRelease||(this.colUpdatePos<=this.colEnd?(yield this.updateColCellGroupsAsync(),yield this.progress()):this.rowUpdatePos<=this.rowEnd?(yield this.updateRowCellGroupsAsync(),yield this.progress()):this.currentCol<this.totalCol?(yield this.createCol(),yield this.progress()):this.currentRow<this.totalRow&&(yield this.createRow(),yield this.progress()),xv(this.table),this.table.scenegraph.updateNextFrame(),t())}),16)})})}createRow(){return qs(this,void 0,void 0,function*(){this.taskRowCount&&this.createRowCellGroup(this.taskRowCount)})}createCol(){return qs(this,void 0,void 0,function*(){this.taskColCount&&this.createColGroup(this.taskRowCount)})}createRowCellGroup(t){const e=Math.min(this.totalRow,this.currentRow+t);if(this.table.heightMode!=="adaptive"&&po(this.table,this.currentRow+1,e,!1),this.rowEnd=e,this.table.frozenColCount){let r=0;for(let s=0;s<this.table.frozenColCount;s++){const o=this.table.scenegraph.getColGroup(s),{height:a}=(this.table.isListTable(),xC(o,s,o.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));r=Math.max(r,a),this.table.scenegraph.rowHeaderGroup.setAttribute("height",r)}}if(this.table.rightFrozenColCount){let r=0;for(let s=this.table.colCount-this.table.rightFrozenColCount;s<this.table.colCount;s++){const o=this.table.scenegraph.getColGroup(s),{height:a}=(this.table.isPivotChart(),xC(o,s,o.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table));r=Math.max(r,a),this.table.scenegraph.rightFrozenGroup.setAttribute("height",r)}}let i=0;for(let r=this.bodyLeftCol;r<=this.bodyRightCol;r++){const s=this.table.scenegraph.getColGroup(r);if(!s)continue;this.table.rowHeaderLevelCount;const{height:o}=xC(s,r,s.attribute.width,this.currentRow+1,e,this.table.scenegraph.mergeMap,this.table.defaultRowHeight,this.table);i=Math.max(i,o)}this.table.scenegraph.bodyGroup.setAttribute("height",i),this.currentRow=e,this.rowUpdatePos=this.rowEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}createColGroup(t){const e=Math.min(this.totalCol,this.currentCol+t);this.table.widthMode!=="adaptive"&&fo(this.table,this.currentCol+1,e),this.colEnd=e;for(let o=0;o<this.table.rowCount;o++){const a=this.highPerformanceGetCell(this.currentCol,o);a.role==="cell"&&J(a.mergeStartCol)&&a.mergeStartCol>this.currentCol&&this.table.scenegraph.updateCellContent(a.col,a.row)}if(this.table.frozenRowCount){const o=this.table.scenegraph.colHeaderGroup.lastChild instanceof De?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev,a=o.attribute.x+o.attribute.width,l=o.attribute.y;On(this.table.scenegraph.colHeaderGroup,a,l,this.currentCol+1,e,0,this.table.frozenRowCount-1,"columnHeader",this.table)}if(this.table.bottomFrozenRowCount){const o=this.table.scenegraph.bottomFrozenGroup.lastChild instanceof De?this.table.scenegraph.bottomFrozenGroup.lastChild:this.table.scenegraph.bottomFrozenGroup.lastChild._prev,a=o.attribute.x+o.attribute.width,l=o.attribute.y;On(this.table.scenegraph.bottomFrozenGroup,a,l,this.currentCol+1,e,this.table.rowCount-this.table.bottomFrozenRowCount,this.table.rowCount-1,"columnHeader",this.table)}let i=this.table.scenegraph.bodyGroup.lastChild&&(this.table.scenegraph.bodyGroup.lastChild instanceof De?this.table.scenegraph.bodyGroup.lastChild:this.table.scenegraph.bodyGroup.lastChild._prev);i||(i=this.table.scenegraph.colHeaderGroup.lastChild&&(this.table.scenegraph.colHeaderGroup.lastChild instanceof De?this.table.scenegraph.colHeaderGroup.lastChild:this.table.scenegraph.colHeaderGroup.lastChild._prev));const r=i.attribute.x+i.attribute.width,s=i.attribute.y;On(this.table.scenegraph.bodyGroup,r,s,this.currentCol+1,e,this.rowStart,this.rowEnd,"body",this.table),this.currentCol=e,this.colUpdatePos=this.colEnd,this.table.scenegraph.updateContainer(),this.table.scenegraph.updateBorderSizeAndPosition()}setY(t,e=!1){return qs(this,void 0,void 0,function*(){const i=this.table.getRowsHeight(this.bodyTopRow,this.bodyTopRow+(this.rowEnd-this.rowStart+1))/2,r=this.table.getAllRowsHeight()-i,s=this.table.getTargetRowAt(t+this.table.scenegraph.colHeaderGroup.attribute.height);s&&(this.screenTopRow=s.row),t<i&&this.rowStart===this.bodyTopRow||t>r&&this.rowEnd===this.bodyBottomRow?(this.updateDeltaY(t),this.updateBody(t-this.deltaY)):this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.type==="group"&&this.table.scenegraph.bodyGroup.firstChild.childrenCount!==0||this.table.scenegraph.rowHeaderGroup.firstChild&&this.table.scenegraph.rowHeaderGroup.firstChild.type==="group"&&this.table.scenegraph.rowHeaderGroup.firstChild.childrenCount!==0?this.dynamicSetY(t,s,e):(this.updateDeltaY(t),this.updateBody(t-this.deltaY))})}setX(t,e=!1){return qs(this,void 0,void 0,function*(){const i=this.table.getColsWidth(this.bodyLeftCol,this.bodyLeftCol+(this.colEnd-this.colStart+1))/2,r=this.table.getAllColsWidth()-i,s=this.table.getTargetColAt(t+this.table.scenegraph.rowHeaderGroup.attribute.width);s&&(this.screenLeftCol=s.col),t<i&&this.colStart===this.bodyLeftCol||t>r&&this.colEnd===this.bodyRightCol||this.table.scenegraph.bodyGroup.firstChild&&this.table.scenegraph.bodyGroup.firstChild.type==="group"&&this.table.scenegraph.bodyGroup.firstChild.childrenCount===0?(this.updateDeltaX(t),this.table.scenegraph.setBodyAndColHeaderX(-t+this.deltaX)):this.dynamicSetX(t,s,e)})}dynamicSetY(t,e,i=!1){return qs(this,void 0,void 0,function*(){LCt(t,e,i,this)})}dynamicSetX(t,e,i=!1){return qs(this,void 0,void 0,function*(){kCt(t,e,i,this)})}updateBody(t){this.table.scenegraph.setBodyAndRowHeaderY(-t)}updateRowCellGroupsAsync(){return qs(this,void 0,void 0,function*(){this.updateCellGroups(this.taskRowCount)})}updateCellGroups(t){const e=Math.min(this.bodyBottomRow,this.rowUpdatePos+t);this.table.isAutoRowHeight(this.rowUpdatePos)&&po(this.table,this.rowUpdatePos,e,!1),K_(this.rowUpdatePos,e,this),this.table.isAutoRowHeight(this.rowUpdatePos)&&(Is(this.bodyLeftCol,this.bodyRightCol,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),Is(0,this.table.frozenColCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0),Is(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,this.rowUpdatePos,e,this.table,this.rowUpdateDirection,!0)),this.rowUpdatePos=e+1}updateBottomFrozenCellGroups(){const t=this.table.rowCount-this.table.bottomFrozenRowCount,e=this.table.rowCount-1;this.table.isAutoRowHeight(t)&&po(this.table,t,e,!1),K_(t,e,this),this.table.isAutoRowHeight(t)&&(Is(this.bodyLeftCol,this.bodyRightCol,t,e,this.table,this.rowUpdateDirection),Is(0,this.table.frozenColCount-1,t,e,this.table,this.rowUpdateDirection),Is(this.table.colCount-this.table.rightFrozenColCount,this.table.colCount-1,t,e,this.table,this.rowUpdateDirection))}updateRightFrozenCellGroups(){const t=this.table.colCount-this.table.rightFrozenColCount,e=this.table.colCount-1;this.table.widthMode==="autoWidth"&&fo(this.table,t,e,!1),X_(t,e,this),this.table.isAutoRowHeight(this.rowStart)&&uL(t,e,this.table,this.colUpdateDirection)}updateColCellGroupsAsync(){return qs(this,void 0,void 0,function*(){this.updateColGroups(this.taskRowCount)})}updateColGroups(t){const e=Math.min(this.bodyRightCol,this.colUpdatePos+t);this.table.widthMode==="autoWidth"&&fo(this.table,this.colUpdatePos,e),X_(this.colUpdatePos,e,this),this.colUpdatePos=e+1}updateCellGroupPosition(t,e,i){t.row=e,t.mergeStartCol=void 0,t.mergeStartRow=void 0,t.mergeEndCol=void 0,t.mergeEndRow=void 0,t.setAttribute("y",i),t.needUpdate=!0,t.needUpdateForAutoRowHeight=!0}updateCellGroupContent(t){if(!t.needUpdate||t.role!=="cell")return t;const e=this.table.scenegraph.updateCellContent(t.col,t.row);return t.needUpdate=!1,e||t}sortCellVertical(){return qs(this,void 0,void 0,function*(){yield HCt(this)})}sortCellHorizontal(){return qs(this,void 0,void 0,function*(){yield WCt(this)})}highPerformanceGetCell(t,e,i){if(e>=this.table.frozenRowCount&&e<this.table.rowCount-this.table.bottomFrozenRowCount&&(e<this.rowStart||e>this.rowEnd)||t>=this.table.frozenColCount&&t<this.table.colCount-this.table.rightFrozenColCount&&(t<this.colStart||t>this.colEnd))return Nx;if(this.cellCache.get(t)){const s=this.cellCache.get(t);if((s._next||s._prev)&&Math.abs(s.row-e)<e){let a=cL(s,e);return a&&(i||a.role!=="shadow-cell")||(a=this.table.scenegraph.getCell(t,e,i)),a.row&&this.cellCache.set(t,a),a}const o=this.table.scenegraph.getCell(t,e,i);return o.col===t&&o.row&&this.cellCache.set(t,o),o}const r=this.table.scenegraph.getCell(t,e,i);return r.col===t&&r.row&&this.cellCache.set(t,r),r}updateDeltaY(t,e,i){if(this.rowStart===this.bodyTopRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowStart,!0);if(r.role==="cell"){const s=r.attribute.y;this.deltaY=-s}}else if(this.rowEnd===this.bodyBottomRow){const r=this.table.scenegraph.highPerformanceGetCell(this.colStart,this.rowEnd,!0);if(r.role==="cell"){const s=r.attribute.y+r.attribute.height-(this.table.getAllRowsHeight()-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight());this.deltaY=-s}}else if(L(e)&&L(i)){let r=this.table.scenegraph.highPerformanceGetCell(this.colStart,i,!0);r.role!=="cell"&&(r=this.table.scenegraph.highPerformanceGetCell(0,i,!0));const s=t-this.deltaY,o=e-s,a=r.attribute.y-s+this.table.getFrozenRowsHeight();this.deltaY=o-a}}updateDeltaX(t,e,i){if(this.colStart===this.bodyLeftCol){const r=this.table.scenegraph.getColGroup(this.colStart);if(r){const s=r.attribute.x;this.deltaX=-s}}else if(this.colEnd===this.bodyRightCol){const r=this.table.scenegraph.getColGroup(this.colEnd);if(r){const s=r.attribute.x+r.attribute.width-(this.table.getAllColsWidth()-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth());this.deltaX=-s}}else if(L(e)&&L(i)){const r=this.table.scenegraph.getColGroup(i)||this.table.scenegraph.getColGroup(i,!0),s=t-this.deltaX,o=e-s,a=r.attribute.x-s+this.table.getFrozenColsWidth();this.deltaX=o-a}}release(){this.isRelease=!0}}function cL(n,t){if(!n)return null;if(n.row===t)return n;const e=n._prev,i=n._next;return n.row>t&&e&&e.row===n.row-1?cL(e,t):n.row<t&&i&&i.row===n.row+1?cL(i,t):null}function NCt(n,t,e,i,r,s){const o=s.scenegraph;for(let a=n;a<=t;a++){const l=s.getColWidth(a),h=s.scenegraph.getColGroup(a,!0),d=s.scenegraph.getColGroup(a),u=s.scenegraph.getColGroupInBottom(a),c=s.scenegraph.getColGroupInLeftBottomCorner(a),g=s.scenegraph.getColGroupInRightBottomCorner(a);h&&(h.setAttribute("width",l),h.forEachChildren(p=>{p.setAttribute("width",l)})),d&&(d.setAttribute("width",l),d.forEachChildren(p=>{p.setAttribute("width",l)})),u&&(u.setAttribute("width",l),u.forEachChildren(p=>{p.setAttribute("width",l)})),g&&(g.setAttribute("width",l),g.forEachChildren(p=>{p.setAttribute("width",l)})),c&&(c.setAttribute("width",l),c.forEachChildren(p=>{p.setAttribute("width",l)}))}if(o.updateContainer(),r==="column")for(let a=n;a<=t;a++){const l=s.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=0;h<=s.frozenRowCount-1;h++)o.updateCellContent(a,h);for(let h=o.bodyRowStart;h<=o.bodyRowEnd;h++)o.updateCellContent(a,h);for(let h=s.rowCount-s.bottomFrozenRowCount;h<=s.rowCount-1;h++)o.updateCellContent(a,h)}else{for(let a=0;a<=s.frozenColCount-1;a++){const l=s.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)o.updateCellContent(a,h)}for(let a=o.bodyColStart;a<=o.bodyColEnd;a++){const l=s.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)o.updateCellContent(a,h)}for(let a=s.colCount-s.rightFrozenColCount;a<=s.colCount-1;a++){const l=s.scenegraph.getColGroup(a);l==null||l.setAttribute("chartInstance",void 0);for(let h=e;h<=i;h++)o.updateCellContent(a,h)}}}function Yq(n){n.customSelectedRangeComponents.forEach((t,e)=>{UR(t,e,n)}),n.selectingRangeComponents.forEach((t,e)=>{UR(t,e,n)}),n.selectedRangeComponents.forEach((t,e)=>{UR(t,e,n)})}function UR(n,t,e){var i,r,s,o,a,l,h,d,u,c;const g=e.table,[p,f,m,v]=t.split("-"),_=parseInt(p,10),b=parseInt(f,10),y=parseInt(m,10),C=parseInt(v,10);let S,w=_,x=b,A=y,M=C;switch(n.role){case"rowHeader":S=g.getBodyVisibleRowRange(),S&&(x=Math.max(b,S.rowStart-1),M=Math.min(C,S.rowEnd+1));break;case"columnHeader":case"bottomFrozen":S=g.getBodyVisibleCellRange(),S&&(w=Math.max(_,S.colStart-1),A=Math.min(y,S.colEnd+1));break;case"cornerHeader":case"rightTopCorner":case"leftBottomCorner":case"rightBottomCorner":break;case"rightFrozen":S=g.getBodyVisibleCellRange(),S&&(x=Math.max(b,S.rowStart-1),M=Math.min(C,S.rowEnd+1));break;default:S=g.getBodyVisibleCellRange(),S&&(x=Math.max(b,S.rowStart-1),M=Math.min(C,S.rowEnd+1),w=Math.max(_,S.colStart-1),A=Math.min(y,S.colEnd+1))}const T=g.getColsWidth(w,A),R=g.getRowsHeight(x,M),B=e.highPerformanceGetCell(w,x).globalAABBBounds;if(n.rect.setAttributes({x:B.x1-e.tableGroup.attribute.x,y:B.y1-e.tableGroup.attribute.y,width:T,height:R,visible:!0}),n.fillhandle){const z=(i=e.table.options.excelOptions)===null||i===void 0?void 0:i.fillHandle;let F,j=!0;typeof z=="function"&&(j=z({selectRanges:e.table.stateManager.select.ranges,table:e.table})),F=A<g.colCount-1?e.highPerformanceGetCell(A,M).globalAABBBounds:e.highPerformanceGetCell(w-1,M).globalAABBBounds;const $=F.x2-e.tableGroup.attribute.x-3;F=M<g.rowCount-1?e.highPerformanceGetCell(A,M).globalAABBBounds:e.highPerformanceGetCell(A,x-1).globalAABBBounds;const Y=F.y2-e.tableGroup.attribute.y-3;(r=n.fillhandle)===null||r===void 0||r.setAttributes({x:$,y:Y,width:6,height:6,visible:j})}let E=!!g.frozenColCount&&_===g.frozenColCount;!E&&g.frozenColCount&&g.scrollLeft>0&&_>=g.frozenColCount&&g.getColsWidth(0,_-1)-g.scrollLeft<g.getFrozenColsWidth()&&(E=!0);let k=!!g.rightFrozenColCount&&g.rightFrozenColCount>0&&y===g.colCount-g.rightFrozenColCount-1;!k&&g.rightFrozenColCount&&y<g.colCount-g.rightFrozenColCount&&g.getColsWidth(0,y)-g.scrollLeft>g.tableNoFrameWidth-g.getRightFrozenColsWidth()&&(k=!0);let P=!g.frozenRowCount||b===g.frozenRowCount;!P&&g.frozenRowCount&&g.scrollTop>0&&b>=g.frozenRowCount&&g.getRowsHeight(0,b-1)-g.scrollTop<g.getFrozenRowsHeight()&&(P=!0);let I=!!g.bottomFrozenRowCount&&C===g.rowCount-g.bottomFrozenRowCount-1;!I&&g.bottomFrozenRowCount&&C<g.rowCount-g.bottomFrozenRowCount&&g.getRowsHeight(0,C)-g.scrollTop>g.tableNoFrameHeight-g.getBottomFrozenRowsHeight()&&(I=!0);const{dynamicUpdateSelectionSize:O}=g.theme.selectionStyle;if(E&&(n.rect.attribute.stroke[3]||O)||k&&(n.rect.attribute.stroke[1]||O)||P&&(n.rect.attribute.stroke[0]||O)||I&&(n.rect.attribute.stroke[2]||O)){if(E&&n.rect.attribute.stroke[3]&&e.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?e.cornerHeaderGroup:n.role==="bottomFrozen"?e.leftBottomCornerGroup:e.rowHeaderGroup),I&&n.rect.attribute.stroke[2]&&e.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?e.leftBottomCornerGroup:n.role==="rightFrozen"?e.rightBottomCornerGroup:e.bottomFrozenGroup),P&&n.rect.attribute.stroke[0]&&e.tableGroup.insertAfter(n.rect,n.role==="rowHeader"?e.cornerHeaderGroup:n.role==="rightFrozen"?e.rightTopCornerGroup:e.colHeaderGroup),k&&n.rect.attribute.stroke[1]&&e.tableGroup.insertAfter(n.rect,n.role==="columnHeader"?e.rightTopCornerGroup:n.role==="bottomFrozen"?e.rightBottomCornerGroup:e.rightFrozenGroup),n.rect.attribute.x<g.getFrozenColsWidth()&&g.scrollLeft>0&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const z=n.rect.attribute.width-(g.getFrozenColsWidth()-n.rect.attribute.x);n.rect.setAttributes({x:n.rect.attribute.x+(g.getFrozenColsWidth()-n.rect.attribute.x),width:z>0?z:0}),(s=n.fillhandle)===null||s===void 0||s.setAttributes({visible:z>0})}if(g.getRightFrozenColsWidth()>0&&e.rightFrozenGroup.attribute.height>0&&n.rect.attribute.x+n.rect.attribute.width>e.rightFrozenGroup.attribute.x&&(n.role==="body"||n.role==="columnHeader"||n.role==="bottomFrozen")){const z=e.rightFrozenGroup.attribute.x-n.rect.attribute.x;n.rect.setAttributes({x:n.rect.attribute.x,width:z>0?z:0}),(o=n.fillhandle)===null||o===void 0||o.setAttributes({visible:z-T>0})}if(n.rect.attribute.y<e.colHeaderGroup.attribute.height&&g.scrollTop>0&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const z=n.rect.attribute.height-(e.colHeaderGroup.attribute.height-n.rect.attribute.y);n.rect.setAttributes({y:n.rect.attribute.y+(e.colHeaderGroup.attribute.height-n.rect.attribute.y),height:z>0?z:0}),(a=n.fillhandle)===null||a===void 0||a.setAttributes({visible:z>0})}if(e.bottomFrozenGroup.attribute.width>0&&e.bottomFrozenGroup.attribute.height>0&&n.rect.attribute.y+n.rect.attribute.height>e.bottomFrozenGroup.attribute.y&&(n.role==="body"||n.role==="rowHeader"||n.role==="rightFrozen")){const z=e.bottomFrozenGroup.attribute.y-n.rect.attribute.y;n.rect.setAttributes({y:n.rect.attribute.y,height:z>0?z:0}),(l=n.fillhandle)===null||l===void 0||l.setAttributes({visible:z-R>0})}}else e.tableGroup.insertAfter(n.rect,n.role==="body"?e.bodyGroup:n.role==="columnHeader"?e.colHeaderGroup:n.role==="rowHeader"?e.rowHeaderGroup:n.role==="cornerHeader"?e.cornerHeaderGroup:n.role==="rightTopCorner"?e.rightTopCornerGroup:n.role==="rightFrozen"?e.rightFrozenGroup:n.role==="leftBottomCorner"?e.leftBottomCornerGroup:n.role==="bottomFrozen"?e.bottomFrozenGroup:e.rightBottomCornerGroup);let H=0;typeof n.rect.attribute.lineWidth=="number"&&(H=Math.ceil(n.rect.attribute.lineWidth/2)),y===g.colCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(H=Math.ceil(((h=n.rect.attribute.lineWidth[1])!==null&&h!==void 0?h:0)/2)),n.rect.setAttributes({width:n.rect.attribute.width-H})),_===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(H=Math.ceil(((d=n.rect.attribute.lineWidth[3])!==null&&d!==void 0?d:0)/2)),n.rect.setAttributes({x:n.rect.attribute.x+H,width:n.rect.attribute.width-H})),C===g.rowCount-1&&(Array.isArray(n.rect.attribute.lineWidth)&&(H=Math.ceil(((u=n.rect.attribute.lineWidth[2])!==null&&u!==void 0?u:0)/2)),n.rect.setAttributes({height:n.rect.attribute.height-H})),b===0&&(Array.isArray(n.rect.attribute.lineWidth)&&(H=Math.ceil(((c=n.rect.attribute.lineWidth[0])!==null&&c!==void 0?c:0)/2)),n.rect.setAttributes({y:n.rect.attribute.y+H,height:n.rect.attribute.height-H}))}function HN(n,t,e=!0){const i=n.table,r=t.start.col,s=t.start.row,o=t.end.col,a=t.end.row,l=t.skipBodyMerge;let h=Math.max(Math.min(o,r),0),d=Math.max(Math.min(a,s),0),u=Math.min(Math.max(o,r),i.colCount-1),c=Math.min(Math.max(a,s),i.rowCount-1);const g=()=>{let w=!1;for(let x=h;x<=u;x++){if(x===h)for(let A=d;A<=c;A++){if(!i.isHeader(x,A)&&l)continue;const M=un(i,x,A);if(M&&M.start.col<h){h=M.start.col,w=!0;break}}if(!w&&x===u)for(let A=d;A<=c;A++){if(!i.isHeader(x,A)&&l)continue;const M=un(i,x,A);if(M&&Math.min(M.end.col,i.colCount-1)>u){u=M.end.col,w=!0;break}}if(w)break}if(!w)for(let x=d;x<=c;x++){if(x===d)for(let A=h;A<=u;A++){if(!i.isHeader(A,x)&&l)continue;const M=un(i,A,x);if(M&&M.start.row<d){d=M.start.row,w=!0;break}}if(!w&&x===c)for(let A=h;A<=u;A++){if(!i.isHeader(A,x)&&l)continue;const M=un(i,A,x);if(M&&Math.min(M.end.row,i.rowCount-1)>c){c=M.end.row,w=!0;break}}if(w)break}w&&g()};e&&(g(),t.start.col>t.end.col?(t.start.col=Math.max(h,u),t.end.col=Math.min(h,u)):(t.start.col=Math.min(h,u),t.end.col=Math.max(h,u)),t.start.row>t.end.row?(t.start.row=Math.max(d,c),t.end.row=Math.min(d,c)):(t.start.row=Math.min(d,c),t.end.row=Math.max(d,c))),n.selectingRangeComponents.forEach((w,x)=>{var A;w.rect.delete(),(A=w.fillhandle)===null||A===void 0||A.delete()}),n.selectingRangeComponents=new Map;let p=!1,f=!1,m=!1,v=!1,_=!1,b=!1,y=!1,C=!1,S=!1;if(h<=i.frozenColCount-1&&d<=i.frozenRowCount-1&&(b=!0),u>=i.colCount-i.rightFrozenColCount&&d<=i.frozenRowCount-1&&(y=!0),h<=i.frozenColCount-1&&c>=i.rowCount-i.bottomFrozenRowCount&&(S=!0),u>=i.colCount-i.rightFrozenColCount&&c>=i.rowCount-i.bottomFrozenRowCount&&(C=!0),h<=i.frozenColCount-1&&c>=i.frozenRowCount&&d<=i.rowCount-i.bottomFrozenRowCount-1&&(p=!0),u>=i.colCount-i.rightFrozenColCount&&c>=i.frozenRowCount&&d<=i.rowCount-i.bottomFrozenRowCount-1&&(f=!0),d<=i.frozenRowCount-1&&u>=i.frozenColCount&&h<=i.colCount-i.rightFrozenColCount-1&&(m=!0),c>=i.rowCount-i.bottomFrozenRowCount&&u>=i.frozenColCount&&h<=i.colCount-i.rightFrozenColCount-1&&(v=!0),h<=i.colCount-i.rightFrozenColCount-1&&u>=i.frozenColCount&&d<=i.rowCount-i.bottomFrozenRowCount-1&&c>=i.frozenRowCount&&(_=!0),b){const w=Math.min(u,i.frozenColCount-1),x=Math.min(c,i.frozenRowCount-1),A=[!0,!m,!p,!0];n.createCellSelectBorder(h,d,w,x,"cornerHeader",`${h}${d}${u}${c}`,A)}if(y){const w=Math.max(h,i.colCount-i.rightFrozenColCount),x=Math.min(c,i.frozenRowCount-1),A=[!0,!0,!f,!m];n.createCellSelectBorder(w,d,u,x,"rightTopCorner",`${h}${d}${u}${c}`,A)}if(S){const w=Math.min(u,i.frozenColCount-1),x=Math.max(d,i.rowCount-i.bottomFrozenRowCount),A=[!p,!v,!0,!0];n.createCellSelectBorder(h,x,w,c,"leftBottomCorner",`${h}${d}${u}${c}`,A)}if(C){const w=Math.max(h,i.colCount-i.rightFrozenColCount),x=Math.max(d,i.rowCount-i.bottomFrozenRowCount),A=[!f,!0,!0,!v];n.createCellSelectBorder(w,x,u,c,"rightBottomCorner",`${h}${d}${u}${c}`,A)}if(m){const w=Math.max(h,i.frozenColCount),x=Math.min(u,i.colCount-i.rightFrozenColCount-1),A=Math.min(c,i.frozenRowCount-1),M=[!0,!y,!_,!b];n.createCellSelectBorder(w,d,x,A,"columnHeader",`${h}${d}${u}${c}`,M)}if(v){const w=Math.max(h,i.frozenColCount),x=Math.min(u,i.colCount-i.rightFrozenColCount-1),A=Math.max(d,i.rowCount-i.bottomFrozenRowCount),M=[!_,!C,!0,!S];n.createCellSelectBorder(w,A,x,c,"bottomFrozen",`${h}${d}${u}${c}`,M)}if(p){const w=Math.max(d,i.frozenRowCount),x=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),A=Math.min(u,i.frozenColCount-1),M=[!b,!_,!S,!0];n.createCellSelectBorder(h,w,A,x,"rowHeader",`${h}${d}${u}${c}`,M)}if(f){const w=Math.max(d,i.frozenRowCount),x=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),A=Math.max(h,i.colCount-i.rightFrozenColCount),M=[!y,!0,!C,!_];n.createCellSelectBorder(A,w,u,x,"rightFrozen",`${h}${d}${u}${c}`,M)}if(_){const w=Math.max(h,i.frozenColCount),x=Math.max(d,i.frozenRowCount),A=Math.min(u,i.colCount-i.rightFrozenColCount-1),M=Math.min(c,i.rowCount-i.bottomFrozenRowCount-1),T=[!m,!f,!v,!p];n.createCellSelectBorder(w,x,A,M,"body",`${h}${d}${u}${c}`,T)}}function zN(n){n.selectingRangeComponents.forEach((t,e)=>{t.rect.setAttribute("opacity",0)}),n.selectedRangeComponents.forEach((t,e)=>{t.rect.setAttribute("opacity",0)})}function WN(n){n.selectingRangeComponents.forEach((t,e)=>{t.rect.setAttribute("opacity",1)}),n.selectedRangeComponents.forEach((t,e)=>{t.rect.setAttribute("opacity",1)})}function $Ct(n,t,e,i,r,s,o,a){var l,h,d,u,c,g,p,f,m;let v=!!(!((l=n.table.options.excelOptions)===null||l===void 0)&&l.fillHandle);if(((h=n.table.stateManager.select.ranges)===null||h===void 0?void 0:h.length)>1)v=!1,n.removeFillHandleFromSelectComponents();else if(((d=n.table.stateManager.select.ranges)===null||d===void 0?void 0:d.length)===1){const B=Math.max(n.table.stateManager.select.ranges[0].start.row,n.table.stateManager.select.ranges[0].end.row),E=Math.max(n.table.stateManager.select.ranges[0].start.col,n.table.stateManager.select.ranges[0].end.col);n.table.isHeader(E,B)&&(v=!1)}!Array.isArray(a)||a[1]!==!1&&a[2]!==!1||(v=!1);const _=Math.min(t,i),b=Math.min(e,r),y=Math.max(t,i),C=Math.max(e,r),S=n.highPerformanceGetCell(_,b).globalAABBBounds,w=n.highPerformanceGetCell(y,C).globalAABBBounds,x=n.table.theme,A=(u=x.selectionStyle)===null||u===void 0?void 0:u.cellBorderColor,M=(c=x.selectionStyle)===null||c===void 0?void 0:c.cellBorderLineWidth,T=wi({pickable:!1,fill:((g=x.selectionStyle)===null||g===void 0?void 0:g.selectionFillMode)!=="replace"&&((f=(p=x.selectionStyle)===null||p===void 0?void 0:p.cellBgColor)!==null&&f!==void 0?f:"rgba(0, 0, 255,0.1)"),lineWidth:M,stroke:a.map(B=>!!B&&A),x:S.x1-n.tableGroup.attribute.x,y:S.y1-n.tableGroup.attribute.y,width:0,height:0,visible:!0,cornerRadius:VCt(s,(m=n.table.theme.frameStyle)===null||m===void 0?void 0:m.cornerRadius,t,e,i,r,n.table)});let R;v&&(R=wi({pickable:!1,fill:A,stroke:A,x:w.x2-3,y:w.y2-3,width:6,height:6,visible:!0})),n.lastSelectId=o,n.selectingRangeComponents.set(`${_}-${b}-${y}-${C}-${o}`,{rect:T,fillhandle:R,role:s}),n.tableGroup.insertAfter(T,s==="body"?n.bodyGroup:s==="columnHeader"?n.colHeaderGroup:s==="rowHeader"?n.rowHeaderGroup:s==="cornerHeader"?n.cornerHeaderGroup:s==="rightTopCorner"?n.rightTopCornerGroup:s==="rightFrozen"?n.rightFrozenGroup:s==="leftBottomCorner"?n.leftBottomCornerGroup:s==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup),v&&n.tableGroup.insertAfter(R,s==="body"?n.bodyGroup:s==="columnHeader"?n.colHeaderGroup:s==="rowHeader"?n.rowHeaderGroup:s==="cornerHeader"?n.cornerHeaderGroup:s==="rightTopCorner"?n.rightTopCornerGroup:s==="rightFrozen"?n.rightFrozenGroup:s==="leftBottomCorner"?n.leftBottomCornerGroup:s==="bottomFrozen"?n.bottomFrozenGroup:n.rightBottomCornerGroup)}function VCt(n,t,e,i,r,s,o){if(!t)return;const a=Array.isArray(t)?t:[t,t,t,t],l=o.colCount-1,h=o.rowCount-1,d=[0,0,0,0];let u=!1;return e===0&&i===0?(d[0]=a[0],u=!0):r===l&&s===h?(d[2]=a[2],u=!0):e===0&&s===h?(d[3]=a[3],u=!0):r===l&&i===0&&(d[1]=a[1],u=!0),u?d:void 0}function jN(n){n.selectingRangeComponents.forEach((t,e)=>{var i;n.selectedRangeComponents.get(e)&&(n.selectingRangeComponents.get(e).rect.delete(),(i=n.selectingRangeComponents.get(e).fillhandle)===null||i===void 0||i.delete()),n.selectedRangeComponents.set(e,t)}),n.selectingRangeComponents=new Map,n.updateNextFrame()}function GCt(n){n.selectedRangeComponents.forEach((t,e)=>{var i;e.split("-")[4]===n.lastSelectId&&(t.rect.delete(),(i=t.fillhandle)===null||i===void 0||i.delete(),n.selectedRangeComponents.delete(e))})}function NN(n){n.selectedRangeComponents.forEach((t,e)=>{var i;t.rect.delete(),(i=t.fillhandle)===null||i===void 0||i.delete()}),n.selectedRangeComponents=new Map}function Xq(n){n.selectingRangeComponents.forEach((t,e)=>{var i;t.rect.delete(),(i=t.fillhandle)===null||i===void 0||i.delete()}),n.selectingRangeComponents=new Map}function UCt(n){n.selectedRangeComponents.forEach((t,e)=>{var i;(i=t.fillhandle)===null||i===void 0||i.delete(),t.fillhandle=void 0})}function YCt(n,t,e,i,r){var s,o;$x(i)&&gD(i);const a=i.scenegraph,l=mv(n.map(m=>m.row)).sort((m,v)=>v-m),h=mv(t.map(m=>m.row)).sort((m,v)=>m-v),d=mv(e.map(m=>m.row)).sort((m,v)=>m-v);let u;if(d.length&&(u=XR(d[0]-1,d[d.length-1]+1,a)),h.length){const m=XR(h[0]-1,h[h.length-1]+1,a);u=L(u)?L(m)?Math.min(u,m):u:m}if(l.length){const m=XR(l[0]-1,l[l.length-1]+1,a);u=L(u)?L(m)?Math.min(u,m):u:m}l.forEach(m=>{XCt(m,a,r)});const c=i.rowHeightsMap;if(l.forEach(m=>{c.delete(m)}),l.length){qCt(a);const m=YR(l[l.length-1]-1,l[0]-l.length+1,a);u=L(u)?L(m)?Math.min(u,m):u:m}let g;if(a.table._clearRowRangeHeightsMap(),h.forEach(m=>{const v=KCt(m,a,r);g=g??v,c.insert(m)}),ZCt(a),h.length){const m=YR(h[0]-1,h[h.length-1]+1,a);u=L(u)?L(m)?Math.min(u,m):u:m}for(let m=0;m<i.colCount;m++)d.forEach(v=>{if(v<i.frozenRowCount){const _=un(a.table,m,v);if(_)for(let b=_.start.col;b<=_.end.col;b++)for(let y=_.start.row;y<=_.end.row;y++)go(b,y,a.table,!1);else go(m,v,a.table,!1)}else if(v>i.rowCount-1||v<a.table.rowCount-a.table.bottomFrozenRowCount&&(v<a.proxy.rowStart||v>a.proxy.rowEnd))Kq(v,a);else{const _=un(a.table,m,v);if(_)for(let b=_.start.col;b<=_.end.col;b++)for(let y=_.start.row;y<=_.end.row;y++)go(b,y,a.table,!1);else go(m,v,a.table,!1)}});if(d.length){const m=YR(d[0]-1,d[d.length-1]+1,a);u=L(u)?L(m)?Math.min(u,m):u:m}if(J(g)){for(let m=0;m<Math.max(i.colCount,(s=i.internalProps._oldColCount)!==null&&s!==void 0?s:i.colCount);m++)for(let v=g;v<Math.max(i.rowCount,(o=i.internalProps._oldRowCount)!==null&&o!==void 0?o:i.rowCount);v++){const _=a.highPerformanceGetCell(m,v,!0);_&&(_.needUpdate=!0)}u=L(u)?L(g)?Math.min(u,g):u:g}if(J(u)&&(a.proxy.rowUpdatePos=Math.min(a.proxy.rowUpdatePos,u)),h.length){if(!J(g)){const m=Math.min(...h);a.proxy.rowUpdatePos=Math.min(m,a.proxy.rowUpdatePos)}a.proxy.rowUpdateDirection="up",a.proxy.updateCellGroups(2*a.proxy.screenRowCount),f()}else l.length&&(JCt(l[l.length-1],a),a.proxy.updateCellGroups(2*a.proxy.screenRowCount),f());a.proxy.progress();const p=i.getRowsHeight(i.frozenRowCount,i.rowCount-1-i.bottomFrozenRowCount);function f(){if((h==null?void 0:h[(h==null?void 0:h.length)-1])>=i.rowCount-i.bottomFrozenRowCount||(d==null?void 0:d[(d==null?void 0:d.length)-1])>=i.rowCount-i.bottomFrozenRowCount||(l==null?void 0:l[0])>=i.rowCount-i.bottomFrozenRowCount){for(let m=0;m<i.colCount;m++)for(let v=i.rowCount-i.bottomFrozenRowCount;v<i.rowCount;v++){const _=a.highPerformanceGetCell(m,v,!0);_&&(_.needUpdate=!0)}a.proxy.updateBottomFrozenCellGroups()}}a.updateContainerHeight(a.table.frozenRowCount,p-a.bodyGroup.attribute.height)}function XCt(n,t,e){const i=t.proxy;if(n>=i.rowStart&&n<=i.rowEnd&&(Kq(n,t),i.rowEnd--,i.currentRow--),!e){i.bodyBottomRow--;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);i.totalActualBodyRowCount=r,i.totalRow=Math.min(i.table.rowCount-1,i.rowStart+r-1)}}function KCt(n,t,e){const i=t.proxy;if(!e){i.bodyBottomRow++;const r=Math.min(i.rowLimit,i.bodyBottomRow-i.bodyTopRow+1);i.totalActualBodyRowCount=r,i.totalRow=i.rowStart+r-1}if(!(n<i.rowStart))return n>i.rowEnd?i.rowEnd-i.rowStart+1<i.rowLimit?(i.rowEnd++,i.currentRow++,$N(n,t),n):void 0:(i.rowEnd-i.rowStart+1<i.rowLimit&&(i.rowEnd++,i.currentRow++,$N(n,t)),n)}function qCt(n){function t(e,i){e.row=i;const r=un(n.table,e.col,e.row);r?(e.mergeStartCol=r.start.col,e.mergeEndCol=r.end.col,e.mergeStartRow=r.start.row,e.mergeEndRow=r.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}n.bodyGroup.forEachChildren(e=>{let i=n.bodyRowStart;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.rowHeaderGroup.forEachChildren(e=>{let i=n.bodyRowStart;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.rightFrozenGroup.forEachChildren(e=>{let i=n.bodyRowStart;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.bottomFrozenGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.leftBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e==null||e.forEachChildren(r=>{t(r,i),i++})}),n.rightBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount;e==null||e.forEachChildren(r=>{t(r,i),i++})})}function ZCt(n){function t(e,i,r){e.row=i,e.setAttribute("y",r);const s=un(n.table,e.col,e.row);s?(e.mergeStartCol=s.start.col,e.mergeEndCol=s.end.col,e.mergeStartRow=s.start.row,e.mergeEndRow=s.end.row):(e.mergeStartCol=void 0,e.mergeEndCol=void 0,e.mergeStartRow=void 0,e.mergeEndRow=void 0)}n.bodyGroup.forEachChildren(e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e==null||e.forEachChildren(s=>{t(s,i,r),i++,r+=s.attribute.height})}),n.rowHeaderGroup.forEachChildren(e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e==null||e.forEachChildren(s=>{t(s,i,r),i++,r+=s.attribute.height})}),n.rightFrozenGroup.forEachChildren(e=>{let i=n.bodyRowStart,r=n.getCellGroupY(i);e==null||e.forEachChildren(s=>{t(s,i,r),i++,r+=s.attribute.height})}),n.bottomFrozenGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e==null||e.forEachChildren(s=>{t(s,i,r),i++,r+=s.attribute.height})}),n.leftBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e==null||e.forEachChildren(s=>{t(s,i,r),i++,r+=s.attribute.height})}),n.rightBottomCornerGroup.forEachChildren(e=>{let i=n.table.rowCount-n.table.bottomFrozenRowCount,r=0;e==null||e.forEachChildren(s=>{t(s,i,r),i++,r+=s.attribute.height})})}function $N(n,t){for(let e=0;e<t.table.colCount;e++){const i=new De({x:0,y:0,width:t.table.getColWidth(e),height:t.table.getRowHeight(n)});if(i.role="cell",i.col=e,i.row=n,i.needUpdate=!0,!i)continue;const r=t.getColGroup(e);if(r)if(r.firstChild&&n<r.firstChild.row)r.insertBefore(i,r.firstChild),r.firstChild.row=r.firstChild.row+1;else if(r.lastChild&&n>r.lastChild.row)r.appendChild(i);else{const s=t.highPerformanceGetCell(e,n,!0);s!==i&&(r.insertBefore(i,s),s&&(s.row=s.row+1),s!==r.lastChild&&r.lastChild&&(r.lastChild.row=r.lastChild.row+1))}}}function Kq(n,t){for(let e=0;e<t.table.colCount;e++){const i=t.getColGroup(e,!1);if(!i)continue;let r;i.forEachChildren(s=>s.row===n&&(r=s,!0)),r&&(i.updateColumnHeight(-r.attribute.height),i.removeChild(r))}}function YR(n,t,e){let i;for(let r=0;r<e.table.colCount;r++){const s=e.table.getCellRange(r,n);let o;s.start.row<=n+1&&s.end.row>=n+1&&(Vx(s,e),o=s.start.row);const a=e.table.getCellRange(r,t);a.start.row<=t+1&&a.end.row>=t+1&&(Vx(a,e),o=a.start.row),L(o)&&(i=L(i)?Math.min(i,o):o)}return i}function XR(n,t,e){let i;for(let r=0;r<e.table.colCount;r++){let s;const o=e.highPerformanceGetCell(r,n);o.mergeStartRow&&o.mergeEndRow&&o.mergeEndRow>n&&(Vx({start:{row:o.mergeStartRow,col:e.table.isAutoRowHeight(t)?0:o.mergeStartCol},end:{row:o.mergeEndRow,col:e.table.isAutoRowHeight(t)?e.table.colCount-1:o.mergeEndCol}},e),s=o.mergeStartRow);const a=e.highPerformanceGetCell(r,t);a.mergeStartRow&&a.mergeEndRow&&a.mergeStartRow<t&&(Vx({start:{row:a.mergeStartRow,col:e.table.isAutoRowHeight(t)?0:a.mergeStartCol},end:{row:a.mergeEndRow,col:e.table.isAutoRowHeight(t)?e.table.colCount-1:a.mergeEndCol}},e),s=a.mergeStartRow),L(s)&&(i=L(i)?Math.min(i,s):s)}return i}function Vx(n,t){const{start:e,end:i}=n;for(let r=e.col;r<=i.col;r++)for(let s=e.row;s<=i.row;s++){const o=t.highPerformanceGetCell(r,s,!0);o&&(o.needUpdate=!0)}}function JCt(n,t){if(t.table.isHasSeriesNumber())for(let e=n;e<=t.table.rowCount-1;e++)go(0,e,t.table,!1)}function QCt(n){const{internalProps:t}=n;t.bodyDomContainer=document.createElement("div"),t.bodyDomContainer.id="vtable-body-dom-container",t.bodyDomContainer.classList.add("table-component-container"),t.element.appendChild(t.bodyDomContainer),t.headerDomContainer=document.createElement("div"),t.headerDomContainer.id="vtable-header-dom-container",t.headerDomContainer.classList.add("table-component-container"),t.element.appendChild(t.headerDomContainer),t.frozenBodyDomContainer=document.createElement("div"),t.frozenBodyDomContainer.id="vtable-frozen-body-dom-container",t.frozenBodyDomContainer.classList.add("table-component-container"),t.element.appendChild(t.frozenBodyDomContainer),t.frozenHeaderDomContainer=document.createElement("div"),t.frozenHeaderDomContainer.id="vtable-frozen-header-dom-container",t.frozenHeaderDomContainer.classList.add("table-component-container"),t.element.appendChild(t.frozenHeaderDomContainer),t.rightFrozenBodyDomContainer=document.createElement("div"),t.rightFrozenBodyDomContainer.id="vtable-right-frozen-body-dom-container",t.rightFrozenBodyDomContainer.classList.add("table-component-container"),t.element.appendChild(t.rightFrozenBodyDomContainer),t.rightFrozenHeaderDomContainer=document.createElement("div"),t.rightFrozenHeaderDomContainer.id="vtable-right-frozen-header-dom-container",t.rightFrozenHeaderDomContainer.classList.add("table-component-container"),t.element.appendChild(t.rightFrozenHeaderDomContainer),t.frozenBottomDomContainer=document.createElement("div"),t.frozenBottomDomContainer.id="vtable-frozen-bottom-dom-container",t.frozenBottomDomContainer.classList.add("table-component-container"),t.element.appendChild(t.frozenBottomDomContainer),t.bottomDomContainer=document.createElement("div"),t.bottomDomContainer.id="vtable-bottom-dom-container",t.bottomDomContainer.classList.add("table-component-container"),t.element.appendChild(t.bottomDomContainer),t.rightFrozenBottomDomContainer=document.createElement("div"),t.rightFrozenBottomDomContainer.id="vtable-right-frozen-bottom-dom-container",t.rightFrozenBottomDomContainer.classList.add("table-component-container"),t.element.appendChild(t.rightFrozenBottomDomContainer)}function tSt(n){const{headerDomContainer:t,bodyDomContainer:e,frozenBodyDomContainer:i,frozenHeaderDomContainer:r,rightFrozenBodyDomContainer:s,rightFrozenHeaderDomContainer:o,bottomDomContainer:a,frozenBottomDomContainer:l,rightFrozenBottomDomContainer:h}=n.internalProps;if(!(t||e||i||r||s||o||a||l||h))return;const d=n.getAllColsWidth(),u=Math.min(d,n.tableNoFrameWidth),c=n.getFrozenColsWidth(),g=n.getRightFrozenColsWidth(),p=c+g,f=Math.min(d-p,u-p),m=n.getAllRowsHeight(),v=Math.min(m,n.tableNoFrameHeight),_=n.getFrozenRowsHeight(),b=n.getBottomFrozenRowsHeight(),y=_+b,C=Math.min(m-y,v-y);n.frozenColCount>0?(t.style.left=`${n.tableX+c}px`,e.style.left=`${n.tableX+c}px`,a.style.left=`${n.tableX+c}px`):n.frozenColCount===0&&(t.style.left=`${n.tableX}px`,e.style.left=`${n.tableX}px`,a.style.left=`${n.tableX}px`),i.style.left=`${n.tableX}px`,r.style.left=`${n.tableX}px`,t.style.width=`${f}px`,t.style.height=`${_}px`,e.style.top=`${n.tableY}px`,e.style.width=`${f}px`,e.style.height=`${C}px`,e.style.top=`${n.tableY+_}px`,i.style.width=`${c}px`,i.style.height=`${C}px`,i.style.top=`${n.tableY+_}px`,r.style.width=`${c}px`,r.style.height=`${_}px`,r.style.top=`${n.tableY}px`,s.style.width=`${g}px`,s.style.height=`${C}px`,s.style.top=`${n.tableY+_}px`,s.style.left=n.tableX+u-g+"px",o.style.width=`${g}px`,o.style.height=`${_}px`,o.style.top=`${n.tableY}px`,o.style.left=n.tableX+u-g+"px",a.style.width=`${f}px`,a.style.height=`${b}px`,a.style.top=n.tableY+v-b+"px",l.style.width=`${c}px`,l.style.height=`${b}px`,l.style.top=n.tableY+v-b+"px",h.style.width=`${g}px`,h.style.height=`${b}px`,h.style.top=n.tableY+v-b+"px",h.style.left=n.tableX+u-g+"px"}function qq(n){if(!n.table.reactCustomLayout)return;const{table:t,stage:e}=n,i=e.pluginService.findPluginsByName("ReactAttributePlugin")[0],{htmlMap:r,renderId:s}=i;for(const o in r){const a=r[o],{graphic:l,wrapContainer:h,renderId:d}=a;if(d!==s)continue;let u;if(n.frozenColCount>t.frozenColCount){const c=_c(l);if(!c)continue;const{col:g,row:p}=c;p>=t.rowCount-t.bottomFrozenRowCount&&g<n.frozenColCount&&g>=t.frozenColCount&&l.attribute.react.container===t.frozenBottomDomContainer?u=t.bottomDomContainer:p>=t.frozenRowCount&&g<n.frozenColCount&&g>=t.frozenColCount&&l.attribute.react.container===t.frozenBodyDomContainer?u=t.bodyDomContainer:p<t.frozenRowCount&&g<n.frozenColCount&&g>=t.frozenColCount&&l.attribute.react.container===t.frozenHeaderDomContainer&&(u=t.headerDomContainer)}else if(n.frozenColCount<t.frozenColCount){const c=_c(l);if(!c)continue;const{col:g,row:p}=c;p>=t.rowCount-t.bottomFrozenRowCount&&g<t.frozenColCount&&g>=n.frozenColCount&&l.attribute.react.container===t.bottomDomContainer?u=t.frozenBottomDomContainer:p>=t.frozenRowCount&&g<t.frozenColCount&&g>=n.frozenColCount&&l.attribute.react.container===t.bodyDomContainer?u=t.frozenBodyDomContainer:p<t.frozenRowCount&&g<t.frozenColCount&&g>=n.frozenColCount&&l.attribute.react.container===t.headerDomContainer&&(u=t.frozenHeaderDomContainer)}u&&(u.appendChild(h),a.nativeContainer=u,a.container=u,l.attribute.react.container=u,i.updateStyleOfWrapContainer(l,e,h,u,l.attribute.react))}}function eSt(n){var t,e,i,r;if(n.table.frozenColCount>n.table.rowHeaderLevelCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let s=0;s<n.table.frozenColCount-n.table.rowHeaderLevelCount;s++)Zq(n),Jq(n),eZ(n)}else if(n.table.frozenColCount<n.table.rowHeaderLevelCount){n.bodyGroup.setAttribute("height",n.rowHeaderGroup.attribute.height),n.bodyGroup.setAttribute("y",n.rowHeaderGroup.attribute.y),n.colHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height);for(let s=0;s<n.table.rowHeaderLevelCount-n.table.frozenColCount;s++)Qq(n),tZ(n),iZ(n)}n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose?n.table.options.frozenColCount?n.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.frozenColCount&&n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):(n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)),n.hasFrozen=!0,n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(r=(e=(t=n.colHeaderGroup.firstChild)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:(i=n.cornerHeaderGroup.firstChild)===null||i===void 0?void 0:i.childrenCount)!==null&&r!==void 0?r:n.table.frozenRowCount}function iSt(n){var t,e,i,r,s,o;if(n.frozenColCount>n.table.frozenColCount){n.bodyGroup.setAttribute("height",n.rowHeaderGroup.attribute.height),n.bodyGroup.setAttribute("y",n.rowHeaderGroup.attribute.y),n.colHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height);for(let a=0;a<n.frozenColCount-n.table.frozenColCount;a++)Qq(n),tZ(n),iZ(n)}else if(n.frozenColCount<n.table.frozenColCount){n.rowHeaderGroup.setAttribute("height",n.bodyGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.bodyGroup.attribute.y),n.cornerHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height);for(let a=0;a<n.table.frozenColCount-n.frozenColCount;a++)Zq(n),Jq(n),eZ(n)}qq(n),n.recreateAllSelectRangeComponents(),n.frozenColCount=n.table.frozenColCount,n.frozenRowCount=(r=(e=(t=n.colHeaderGroup.firstChild)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:(i=n.cornerHeaderGroup.firstChild)===null||i===void 0?void 0:i.childrenCount)!==null&&r!==void 0?r:n.table.frozenRowCount,n.proxy.colStart=(o=(s=n.bodyGroup.firstChild)===null||s===void 0?void 0:s.col)!==null&&o!==void 0?o:n.table.frozenColCount,n.bodyGroup.setAttribute("x",n.rowHeaderGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.cornerHeaderGroup.attribute.width),n.updateContainer(),n.updateBorderSizeAndPosition(),n.isPivot||n.table.transpose?n.table.options.frozenColCount?n.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.rightFrozenColCount&&n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):(n.component.setFrozenColumnShadow(n.table.frozenColCount-1),n.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)),n.hasFrozen=!0}function Zq(n){const t=n.bodyGroup.firstChild instanceof De?n.bodyGroup.firstChild:null;t&&(n.rowHeaderGroup.appendChild(t),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width+t.attribute.width),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width-t.attribute.width))}function Jq(n){const t=n.colHeaderGroup.firstChild instanceof De?n.colHeaderGroup.firstChild:null;t&&(n.cornerHeaderGroup.appendChild(t),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width+t.attribute.width),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width-t.attribute.width))}function Qq(n){var t;const e=n.rowHeaderGroup.lastChild instanceof De?n.rowHeaderGroup.lastChild:(t=n.rowHeaderGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(xo(n.bodyGroup,e,n.bodyGroup.firstChild),n.bodyGroup.setAttribute("width",n.bodyGroup.attribute.width+e.attribute.width),n.rowHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width-e.attribute.width))}function tZ(n){var t;const e=n.cornerHeaderGroup.lastChild instanceof De?n.cornerHeaderGroup.lastChild:(t=n.cornerHeaderGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(xo(n.colHeaderGroup,e,n.colHeaderGroup.firstChild),n.colHeaderGroup.setAttribute("width",n.colHeaderGroup.attribute.width+e.attribute.width),n.cornerHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width-e.attribute.width))}function eZ(n){const t=n.bottomFrozenGroup.firstChild instanceof De?n.bottomFrozenGroup.firstChild:null;t&&(n.leftBottomCornerGroup.appendChild(t),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width+t.attribute.width),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width-t.attribute.width),n.table.isPivotChart()&&t.forEachChildren(e=>{e.setAttributes({stroke:!1,fill:!1})}))}function iZ(n){var t;const e=n.leftBottomCornerGroup.lastChild instanceof De?n.leftBottomCornerGroup.lastChild:(t=n.leftBottomCornerGroup.lastChild)===null||t===void 0?void 0:t._prev;e&&(xo(n.bottomFrozenGroup,e,n.bottomFrozenGroup.firstChild),n.bottomFrozenGroup.setAttribute("width",n.bottomFrozenGroup.attribute.width+e.attribute.width),n.leftBottomCornerGroup.setAttribute("width",n.leftBottomCornerGroup.attribute.width-e.attribute.width),n.table.isPivotChart()&&e.forEachChildren(i=>{var r,s,o,a;const l=n.table._getCellStyle(i.col,i.row),h=n.table.getCellRange(i.col,i.row),d=Vd(l,n.table,h?h.start.col:i.col,h?h.start.row:i.row,Mt).theme;i.setAttributes({fill:(s=(r=d==null?void 0:d.group)===null||r===void 0?void 0:r.fill)!==null&&s!==void 0?s:void 0,stroke:(a=(o=d==null?void 0:d.group)===null||o===void 0?void 0:o.stroke)!==null&&a!==void 0?a:void 0})}))}function nSt(n,t){const{table:e,proxy:i,rightTopCornerGroup:r,rightFrozenGroup:s,rightBottomCornerGroup:o,bottomFrozenGroup:a,bodyGroup:l,colHeaderGroup:h}=t,d=t.table.rightFrozenColCount;if(n>d){for(let c=e.colCount-d-1;c>=e.colCount-n;c--)xo(s,t.getColGroup(c),s.firstChild),xo(r,t.getColGroup(c,!0),r.firstChild),xo(o,t.getColGroupInBottom(c),o.firstChild);let u=0;s.forEachChildren(c=>{c.setAttribute("x",u),u+=c.attribute.width}),u=0,r.forEachChildren(c=>{c.setAttribute("x",u),u+=c.attribute.width}),u=0,o.forEachChildren(c=>{c.setAttribute("x",u),u+=c.attribute.width})}else if(n<d){for(let c=e.colCount-d;c<e.colCount-n;c++){const g=t.getColGroup(c);g.setAttribute("x",l.lastChild.attribute.x+e.getColWidth(l.lastChild.col)),l.appendChild(g);const p=t.getColGroupInRightTopCorner(c);p.setAttribute("x",h.lastChild.attribute.x+e.getColWidth(h.lastChild.col)),h.appendChild(p);const f=t.getColGroupInRightBottomCorner(c);f.setAttribute("x",a.lastChild.attribute.x+e.getColWidth(a.lastChild.col)),a.appendChild(f)}let u=0;s.forEachChildren(c=>{c.setAttribute("x",u),u+=c.attribute.width}),u=0,r.forEachChildren(c=>{c.setAttribute("x",u),u+=c.attribute.width}),u=0,o.forEachChildren(c=>{c.setAttribute("x",u),u+=c.attribute.width})}s.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),r.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),o.setAttribute("width",e.getColsWidth(e.colCount-n,e.colCount-1)),e.internalProps.rightFrozenColCount=n,t.updateContainer(),t.component.updateScrollBar(),t.updateNextFrame()}function rSt(n,t){const{table:e,proxy:i,bottomFrozenGroup:r,leftBottomCornerGroup:s,rightBottomCornerGroup:o}=t;r.childrenCount||(i.table.isPivotChart()||(On(s,0,0,0,e.frozenColCount-1,0,-1,"rowHeader",e),On(o,0,0,e.colCount-e.rightFrozenColCount,e.colCount-1,0,-1,"body",e)),On(r,0,0,i.colStart,i.colEnd,0,-1,"body",e));const a=t.table.bottomFrozenRowCount;if(n>a){for(let l=0;l<e.frozenColCount;l++){const h=t.getColGroupInLeftBottomCorner(l);for(let u=e.rowCount-a-1;u>=e.rowCount-n;u--)xo(h,t.getCell(l,u,!0),h.firstChild);let d=0;h.forEachChildren(u=>{u.setAttribute("y",d),d+=e.getRowHeight(u.row)})}for(let l=i.colStart;l<=i.colEnd;l++){const h=t.getColGroupInBottom(l);for(let u=e.rowCount-a-1;u>=e.rowCount-n;u--)xo(h,t.getCell(l,u,!0),h.firstChild);let d=0;h.forEachChildren(u=>{u.setAttribute("y",d),d+=e.getRowHeight(u.row)})}if(e.rightFrozenColCount>0)for(let l=e.colCount-e.rightFrozenColCount;l<e.colCount;l++){const h=t.getColGroupInRightBottomCorner(l);for(let u=e.rowCount-a-1;u>=e.rowCount-n;u--)xo(h,t.getCell(l,u,!0),h.firstChild);let d=0;h.forEachChildren(u=>{u.setAttribute("y",d),d+=e.getRowHeight(u.row)})}}else if(n<a){for(let l=0;l<e.rowHeaderLevelCount;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const d=t.getColGroupInLeftBottomCorner(l);let u=0;d.forEachChildren(c=>{c.setAttribute("y",u),u+=e.getRowHeight(c.row)})}for(let l=i.colStart;l<=i.colEnd;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const d=t.getColGroupInBottom(l);let u=0;d.forEachChildren(c=>{c.setAttribute("y",u),u+=e.getRowHeight(c.row)})}if(e.rightFrozenColCount>0)for(let l=e.colCount-e.rightFrozenColCount;l<e.colCount;l++){const h=t.getColGroup(l);for(let c=e.rowCount-a;c<e.rowCount-n;c++){const g=t.getCell(l,c,!0);g.setAttribute("y",h.lastChild.attribute.y+e.getRowHeight(h.lastChild.row)),h.appendChild(g)}const d=t.getColGroupInRightBottomCorner(l);let u=0;d.forEachChildren(c=>{c.setAttribute("y",u),u+=e.getRowHeight(c.row)})}}r.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),s.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),o.setAttribute("height",e.getRowsHeight(e.rowCount-n,e.rowCount-1)),e.internalProps.bottomFrozenRowCount=n,t.updateContainer(),t.component.updateScrollBar(),t.updateNextFrame()}function xo(n,t,e){t&&n&&(e?n.insertBefore(t,e):n.appendChild(t))}function sSt(n){var t,e,i,r,s;if(n.frozenRowCount>n.table.frozenRowCount){n.bodyGroup.setAttribute("width",n.colHeaderGroup.attribute.width),n.bodyGroup.setAttribute("x",n.colHeaderGroup.attribute.x),n.rowHeaderGroup.setAttribute("width",n.cornerHeaderGroup.attribute.width);for(let o=0;o<n.frozenRowCount-n.table.frozenRowCount;o++)hSt(n),dSt(n),uSt(n)}else if(n.frozenRowCount<n.table.frozenRowCount){n.colHeaderGroup.setAttribute("width",n.bodyGroup.attribute.width),n.colHeaderGroup.setAttribute("x",n.bodyGroup.attribute.x),n.cornerHeaderGroup.setAttribute("width",n.rowHeaderGroup.attribute.width);for(let o=0;o<n.table.frozenRowCount-n.frozenRowCount;o++)oSt(n),aSt(n),lSt(n)}qq(n),n.recreateAllSelectRangeComponents(),n.frozenRowCount=n.table.frozenRowCount,n.frozenColCount=(e=(t=n.rowHeaderGroup)===null||t===void 0?void 0:t.childrenCount)!==null&&e!==void 0?e:0,n.proxy.rowStart=(s=(r=(i=n.bodyGroup.firstChild)===null||i===void 0?void 0:i.firstChild)===null||r===void 0?void 0:r.row)!==null&&s!==void 0?s:n.table.frozenRowCount,n.bodyGroup.setAttribute("y",n.colHeaderGroup.attribute.height),n.rowHeaderGroup.setAttribute("y",n.cornerHeaderGroup.attribute.height),n.updateContainer(),n.updateBorderSizeAndPosition(),n.hasFrozen=!0}function oSt(n){var t;let e=!1;for(let i=0;i<n.bodyGroup.childrenCount;i++){const r=n.bodyGroup.children[i];if(!Hf(r))continue;const s=r.firstChild;(t=n.colHeaderGroup.children[i])===null||t===void 0||t.appendChild(s),e||(n.colHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height+s.attribute.height),n.bodyGroup.setAttribute("height",n.bodyGroup.attribute.height-s.attribute.height),e=!0)}}function aSt(n){var t;let e=!1;for(let i=0;i<n.rowHeaderGroup.childrenCount;i++){const r=n.rowHeaderGroup.children[i];if(!Hf(r))continue;const s=r.firstChild;(t=n.cornerHeaderGroup.children[i])===null||t===void 0||t.appendChild(s),e||(n.cornerHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height+s.attribute.height),n.rowHeaderGroup.setAttribute("height",n.rowHeaderGroup.attribute.height-s.attribute.height),e=!0)}}function lSt(n){var t;let e=!1;for(let i=0;i<n.rightFrozenGroup.childrenCount;i++){const r=n.rightFrozenGroup.children[i];if(!Hf(r))continue;const s=r.firstChild;(t=n.rightTopCornerGroup.children[i])===null||t===void 0||t.appendChild(s),e||(n.rightTopCornerGroup.setAttribute("height",n.rightTopCornerGroup.attribute.height+s.attribute.height),n.rightFrozenGroup.setAttribute("height",n.rightFrozenGroup.attribute.height-s.attribute.height),e=!0)}}function hSt(n){let t=!1;for(let e=0;e<n.colHeaderGroup.childrenCount;e++){const i=n.colHeaderGroup.children[e];if(!Hf(i))continue;const r=n.bodyGroup.children[e];if(!r)continue;const s=i.lastChild;xo(r,s,r.firstChild),t||(n.colHeaderGroup.setAttribute("height",n.colHeaderGroup.attribute.height-s.attribute.height),n.bodyGroup.setAttribute("height",n.bodyGroup.attribute.height+s.attribute.height),t=!0)}}function dSt(n){let t=!1;for(let e=0;e<n.cornerHeaderGroup.childrenCount;e++){const i=n.cornerHeaderGroup.children[e];if(!Hf(i))continue;const r=n.rowHeaderGroup.children[e];if(!r)continue;const s=i.lastChild;xo(r,s,r.firstChild),t||(n.cornerHeaderGroup.setAttribute("height",n.cornerHeaderGroup.attribute.height-s.attribute.height),n.rowHeaderGroup.setAttribute("height",n.rowHeaderGroup.attribute.height+s.attribute.height),t=!0)}}function uSt(n){let t=!1;for(let e=0;e<n.rightTopCornerGroup.childrenCount;e++){const i=n.rightTopCornerGroup.children[e];if(!Hf(i))continue;const r=n.rightFrozenGroup.children[e];if(!r)continue;const s=i.lastChild;xo(r,s,r.firstChild),t||(n.rightTopCornerGroup.setAttribute("height",n.rightTopCornerGroup.attribute.height-s.attribute.height),n.rightFrozenGroup.setAttribute("height",n.rightFrozenGroup.attribute.height+s.attribute.height),t=!0)}}function Hf(n){return n instanceof De&&(n==null?void 0:n.name)!=="table-border-rect"}function cSt(n,t){const{table:e}=n,i=e.internalProps.layoutMap,r=t===-1?"all":e.internalProps.columnResizeType;if(r==="column"){const s=n.getColGroup(t),o=n.getColGroup(t,!0),a=n.getColGroupInBottom(t,!0);if(s==null||s.forEachChildren(l=>{to(l,e.getColWidth(l.col),e.getRowHeight(l.row))}),o==null||o.forEachChildren(l=>{to(l,e.getColWidth(l.col),e.getRowHeight(l.row))}),a==null||a.forEachChildren(l=>{to(l,e.getColWidth(l.col),e.getRowHeight(l.row))}),e.widthMode==="adaptive"&&t<e.colCount-1){const l=n.getColGroup(t+1),h=n.getColGroup(t+1,!0),d=n.getColGroupInBottom(t+1,!0);l==null||l.forEachChildren(u=>{to(u,e.getColWidth(u.col),e.getRowHeight(u.row))}),h==null||h.forEachChildren(u=>{to(u,e.getColWidth(u.col),e.getRowHeight(u.row))}),d==null||d.forEachChildren(u=>{to(u,e.getColWidth(u.col),e.getRowHeight(u.row))})}}else{let s,o,a,l=e.rowHeaderLevelCount,h=e.colCount-1;if(r==="indicator")if(i.indicatorsAsCol)s=i.getIndicatorKey(t,e.columnHeaderLevelCount);else{const d=i.getCellHeaderPaths(t,e.columnHeaderLevelCount-1),u=d.colHeaderPaths[d.colHeaderPaths.length-1];o=u.dimensionKey,a=u.value}else if(r==="indicatorGroup"){const d=e.internalProps.layoutMap,u=d.getCellHeaderPaths(e.stateManager.columnResize.col,e.columnHeaderLevelCount),c=d.getHeadNodeByRowOrColDimensions(u.colHeaderPaths.slice(0,u.colHeaderPaths.length-1));l=c.startInTotal+e.frozenColCount,h=c.startInTotal+e.frozenColCount+c.size-1}for(let d=l;d<=h;d++){const u=n.getColGroup(d),c=n.getColGroup(d,!0),g=n.getColGroupInBottom(d,!0);if(u){if(r==="indicator"){const p=i.getIndicatorKey(d,e.columnHeaderLevelCount);if(i.indicatorsAsCol&&p!==s)continue;if(!i.indicatorsAsCol){const f=i.getCellHeaderPaths(d,e.columnHeaderLevelCount-1),m=f==null?void 0:f.colHeaderPaths[f.colHeaderPaths.length-1];if(!m||o!==m.dimensionKey||a!==m.value)continue}}u.forEachChildren(p=>{to(p,e.getColWidth(p.col),e.getRowHeight(p.row))}),c==null||c.forEachChildren(p=>{to(p,e.getColWidth(p.col),e.getRowHeight(p.row))}),g==null||g.forEachChildren(p=>{to(p,e.getColWidth(p.col),e.getRowHeight(p.row))})}}}}function gSt(n,t){var e;const{table:i}=n,r=i.internalProps.layoutMap,s=i.stateManager,o=t===-1?"all":i.internalProps.rowResizeType;let a,l,h,d=i.columnHeaderLevelCount,u=i.rowCount-1;if(o==="indicator")if(r.indicatorsAsCol){const g=r.getCellHeaderPaths(i.rowHeaderLevelCount-1,t),p=(e=g.rowHeaderPaths)===null||e===void 0?void 0:e[g.rowHeaderPaths.length-1];l=p==null?void 0:p.dimensionKey,h=p==null?void 0:p.value}else a=r.getIndicatorKey(i.rowHeaderLevelCount,t);else if(o==="indicatorGroup"){const g=i.internalProps.layoutMap,p=g.getCellHeaderPaths(i.rowHeaderLevelCount,t),f=g.getHeadNodeByRowOrColDimensions(p.rowHeaderPaths.slice(0,p.rowHeaderPaths.length-1));d=f.startInTotal+i.frozenRowCount,u=f.startInTotal+i.frozenRowCount+f.size-1}const c=[{startCol:n.proxy.colStart,endCol:n.proxy.colEnd}];i.frozenColCount&&c.push({startCol:0,endCol:i.frozenColCount-1}),i.rightFrozenColCount&&c.push({startCol:i.colCount-i.rightFrozenColCount,endCol:i.colCount-1}),c.forEach(({startCol:g,endCol:p})=>{for(let f=g;f<=p;f++)if(o==="row"){const m=n.highPerformanceGetCell(f,t);if(m.role!=="cell")continue;if(to(m,i.getColWidth(m.col),i.getRowHeight(m.row)),i.heightMode==="adaptive"&&t<i.rowCount-1){const v=n.highPerformanceGetCell(f,t+1);to(v,i.getColWidth(v.col),i.getRowHeight(v.row))}}else for(let m=d;m<=u;m++){if(o==="indicator"){const _=r.getIndicatorKey(s.table.rowHeaderLevelCount,m);if(!r.indicatorsAsCol&&_!==a)continue;if(r.indicatorsAsCol){const b=r.getCellHeaderPaths(s.table.rowHeaderLevelCount-1,m),y=b==null?void 0:b.rowHeaderPaths[b.rowHeaderPaths.length-1];if(!y||l!==y.dimensionKey||h!==y.value)continue}}const v=n.highPerformanceGetCell(f,m);v.role==="cell"&&to(v,i.getColWidth(v.col),i.getRowHeight(v.row))}})}function gL(n){var t;for(let e=n.proxy.colStart;e<=n.proxy.colEnd;e++){const i=n.getColGroup(e);(t=i==null?void 0:i.getChildren())===null||t===void 0||t.forEach(r=>{r.children.forEach(s=>{s.type==="chart"&&(s.cacheCanvas=null,s.addUpdateBoundTag())})})}}function pSt(n,t){const e=n.table;if(e.isPivotChart()){const i=e._selectedDataItemsInChart.length;if((t===null||(t==null?void 0:t.length)===0||Object.keys(t).length===0)&&i===0)return;const r=[];if(Array.isArray(t))t.forEach(s=>{if(s&&s.key!==0&&Object.keys(s).length>0){const o={};for(const a in s)a.startsWith("VGRAMMAR_")||a.startsWith("__VCHART")||(o[a]=s[a]);r.push(o)}});else if(t&&t.key!==0&&Object.keys(t).length>0){const s={};for(const o in t)o.startsWith("VGRAMMAR_")||o.startsWith("__VCHART")||(s[o]=t[o]);r.push(s)}Oe(e._selectedDataItemsInChart,r)||(e._selectedDataItemsInChart=r,e.internalProps.layoutMap.updateDataStateToChartInstance(),gL(n),e.scenegraph.updateNextFrame())}}function to(n,t,e){n.forEachChildren(i=>{i.type==="chart"&&(i.cacheCanvas=null,i.setAttributes({width:Math.ceil(t-i.attribute.cellPadding[3]-i.attribute.cellPadding[1]),height:Math.ceil(e-i.attribute.cellPadding[0]-i.attribute.cellPadding[2])}))})}function fSt(n){const t=n.table.tableNoFrameWidth,e=n.table.tableNoFrameHeight;n.tableGroup=new De({x:0,y:0,width:t,height:e,clip:!0,pickable:!1}),n.tableGroup.role="table";const i=_a(0,0,!n.table.options.enableTreeStickCell);i.role="col-header",n.colHeaderGroup=i;const r=_a(0,0,!n.table.options.enableTreeStickCell);r.role="corner-header",n.cornerHeaderGroup=r;const s=_a(0,0,!0);s.role="row-header",n.rowHeaderGroup=s;const o=_a(t,0,!0);o.role="body",n.bodyGroup=o;const a=_a(0,0,!0);a.role="right-frozen",n.rightFrozenGroup=a;const l=_a(0,0,!0);l.role="bottom-frozen",n.bottomFrozenGroup=l;const h=_a(0,0);h.role="component",n.componentGroup=h;const d=_a(0,0,!0);d.role="corner-right-top-header",n.rightTopCornerGroup=d;const u=_a(0,0,!0);u.role="corner-right-bottom-header",n.rightBottomCornerGroup=u;const c=_a(0,0,!0);c.role="corner-left-bottom-header",n.leftBottomCornerGroup=c,n.tableGroup.addChild(o),n.tableGroup.addChild(s),n.tableGroup.addChild(l),n.tableGroup.addChild(i),n.tableGroup.addChild(a),n.tableGroup.addChild(u),n.tableGroup.addChild(d),n.tableGroup.addChild(c),n.tableGroup.addChild(r),n.tableGroup.addChild(h)}function _a(n,t,e){return new De({x:0,y:0,width:n,height:t,clip:e!=null&&e,pickable:!1})}function _l(n,t){return n.forEachChildrenSkipChild((e,i)=>{e.setAttribute("x",t),t+=e.attribute.width}),t}function mSt(n,t,e){n!==-1&&t!==-1&&(ca(n,t,i=>i.attribute.visibleTime==="mouseenter_cell",i=>{i.setAttribute("opacity",0);const r=i.parent.getChildByName("icon-back");r&&r.setAttribute("visible",!1)},e),e.updateNextFrame())}function vSt(n,t,e){n!==-1&&t!==-1&&(ca(n,t,i=>i.attribute.visibleTime==="mouseenter_cell",i=>{i.setAttribute("opacity",1)},e),e.updateNextFrame())}function _St(n,t,e){n!==-1&&t!==-1&&(ca(n,t,i=>i.attribute.visibleTime==="click_cell",i=>{i.setAttribute("opacity",0)},e),e.updateNextFrame())}function bSt(n,t,e){n!==-1&&t!==-1&&(ca(n,t,i=>i.attribute.visibleTime==="click_cell",i=>{i.setAttribute("opacity",1)},e),e.updateNextFrame())}function ySt(n,t,e,i,r){let s;return r.getCell(n,t).forEachChildren(o=>{o.role&&o.role.startsWith("icon")&&o.containsPoint(e,i,R_.GLOBAL)&&(s=o)}),s}function CSt(n,t,e,i,r){var s,o;if((n.attribute.backgroundColor||n.attribute.hoverImage)&&ca(t,e,a=>a.name===n.name,a=>{var l,h,d,u,c,g,p,f;if(a.attribute.backgroundColor){let m=a.parent.getChildByName("icon-back");m?m.setAttributes({x:((l=a.attribute.x)!==null&&l!==void 0?l:0)+(a.AABBBounds.width()-a.backgroundWidth)/2,y:((h=a.attribute.y)!==null&&h!==void 0?h:0)+(a.AABBBounds.height()-a.backgroundHeight)/2,dx:(d=a.attribute.dx)!==null&&d!==void 0?d:0,dy:(u=a.attribute.dy)!==null&&u!==void 0?u:0,width:a.backgroundWidth,height:a.backgroundHeight,fill:a.attribute.backgroundColor,cornerRadius:5,visible:!0}):(m=wi({x:((c=a.attribute.x)!==null&&c!==void 0?c:0)+(a.AABBBounds.width()-a.backgroundWidth)/2,y:((g=a.attribute.y)!==null&&g!==void 0?g:0)+(a.AABBBounds.height()-a.backgroundHeight)/2,dx:(p=a.attribute.dx)!==null&&p!==void 0?p:0,dy:(f=a.attribute.dy)!==null&&f!==void 0?f:0,width:a.backgroundWidth,height:a.backgroundHeight,fill:a.attribute.backgroundColor,cornerRadius:5,pickable:!1,visible:!0}),m.name="icon-back"),a.parent.insertBefore(m,a)}a.attribute.hoverImage&&a.attribute.image!==a.attribute.hoverImage&&(a.image=a.attribute.hoverImage)},r),n.tooltip){const{x1:a,x2:l,y1:h,y2:d}=n.globalAABBBounds,u={content:n.tooltip.title,referencePosition:{rect:{left:a,right:l,top:h,bottom:d,width:n.globalAABBBounds.width(),height:n.globalAABBBounds.height()},placement:n.tooltip.placement},disappearDelay:n.tooltip.disappearDelay,style:Object.assign({},(s=r.table.internalProps.theme)===null||s===void 0?void 0:s.tooltipStyle,(o=n.tooltip)===null||o===void 0?void 0:o.style)};r.table.internalProps.tooltipHandler.isBinded(u)||r.table.showTooltip(t,e,u)}}function SSt(n,t,e,i){(n.attribute.backgroundColor||n.attribute.hoverImage)&&ca(t,e,r=>r.name===n.name,r=>{const s=r.parent.getChildByName("icon-back");s&&s.setAttribute("visible",!1),r.attribute.hoverImage&&r.attribute.image!==r.attribute.originImage&&(r.image=r.attribute.originImage)},i)}function VN(n,t,e,i,r){const s=n.name;ca(e,i,o=>o.name===s,o=>{co(t,o),o.name=t.name},r),r.updateNextFrame()}function xSt(n,t,e,i){const r=i.getCell(n,t);if(L(r.mergeStartCol)&&L(r.mergeStartRow)&&L(r.mergeEndCol)&&L(r.mergeEndRow))for(let s=r.mergeStartCol;s<=r.mergeEndCol;s++)for(let o=r.mergeStartRow;o<=r.mergeEndRow;o++){let a;i.getCell(s,o).forEachChildren(l=>l.attribute.funcType==="sort"&&(a=l,!0)),a&&(co(e,a),a.name=e.name)}else{let s;eD(r,"children",o=>o.attribute.funcType==="sort"&&(s=o,!0)),s&&(co(e,s),s.name=e.name)}}function wSt(n,t,e,i,r){const s=r.getCellRange(n,t),o=r.getCellRange(e,i);return s.start.col===o.start.col&&s.start.row===o.start.row&&s.end.col===o.end.col&&s.end.row===o.end.row}function ASt(n){const{col:t,row:e,iconMark:i,order:r,oldSortCol:s,oldSortRow:o,oldIconMark:a,scene:l}=n,h=l.table.internalProps.headerHelper.getSortIcon(r,l.table,t,e);if(i&&VN(i,h,t,e,l),!wSt(t,e,s,o,l.table)){const d=l.table.internalProps.headerHelper.getSortIcon("normal",l.table,s,o);a?VN(a,d,s,o,l):xSt(s,o,d,l)}}function MSt(n){for(let t=0;t<n.table.colCount;t++)for(let e=0;e<n.table.columnHeaderLevelCount;e++)ca(t,e,i=>i.attribute.funcType==="frozen",i=>{const r=n.table.internalProps.headerHelper.getFrozenIcon(t,e);co(r,i),i.name=r.name},n)}function TSt(n,t,e){let i;i=e.table.isHeader(n,t)?e.table.internalProps.headerHelper.getHierarchyIcon(n,t):e.table.internalProps.bodyHelper.getHierarchyIcon(n,t),ca(n,t,r=>r.attribute.funcType===si.collapse||r.attribute.funcType===si.expand,r=>{co(i,r),r.name=i.name},e)}function pL(n,t,e){n&&n.role!=="empty"&&n.forEachChildren(i=>{i.type==="group"?pL(i,t,e):t(i)&&e(i)})}function ca(n,t,e,i,r){const s=r.getCell(n,t);if(s.role==="cell"&&L(s.mergeStartCol)&&L(s.mergeStartRow)&&L(s.mergeEndCol)&&L(s.mergeEndRow)){const{colStart:o,colEnd:a,rowStart:l,rowEnd:h}=Gd(s,r);for(let d=o;d<=a;d++)for(let u=l;u<=h;u++)pL(r.highPerformanceGetCell(d,u),e,i)}else pL(s,e,i)}function kSt(n,t,e){ca(n,t,i=>i.attribute.funcType===si.dropDown,i=>{i.oldVisibleTime=i.attribute.visibleTime,i.setAttribute("visibleTime","always"),i.setAttribute("opacity",1)},e)}function RSt(n,t,e){ca(n,t,i=>i.attribute.funcType===si.dropDown,i=>{i.oldVisibleTime&&i.setAttribute("visibleTime",i.oldVisibleTime),i.setAttribute("opacity",i.attribute.visibleTime==="always"?1:0)},e)}function KR(n,t){const{bgColor:e,borderColor:i,borderLineWidth:r,borderLineDash:s}=t,o={x:0,y:0,width:0,height:0,visible:!1,pickable:!0,fill:e};return o.stroke=dD(i,void 0),o.lineWidth=r,s&&(o.lineDash=s),o.lineCap="butt",Array.isArray(i)&&(o.strokeArrayColor=Be(i)),Array.isArray(r)&&(o.strokeArrayWidth=Be(r),o.lineWidth=1),n.setAttributes(o),n.role="corner-frozen",n}function BSt(n,t,e,i){var r,s;$x(i)&&gD(i);const o=i.scenegraph,a=qR(n.map(p=>p.col)).sort((p,f)=>f-p),l=qR(t.map(p=>p.col)).sort((p,f)=>p-f),h=qR(e.map(p=>p.col)).sort((p,f)=>p-f);a.forEach(p=>{PSt(p,o)});const d=i.colWidthsMap;let u;if(a.forEach(p=>{d.delAndReorder(p)}),a.length&&GN(o),o.table._clearColRangeWidthsMap(),l.forEach(p=>{const f=ESt(p,o);GN(o),u=u??f,d.addAndReorder(p)}),LSt(o),h.forEach(p=>{for(let f=0;f<i.rowCount;f++){const m=un(o.table,p,f);if(m)for(let v=m.start.col;v<=m.end.col;v++)for(let _=m.start.col;_<=m.end.col;_++)go(_,f,o.table,!1);else go(p,f,o.table,!1)}}),J(u)){for(let p=u;p<Math.max(i.colCount,(r=i.internalProps._oldColCount)!==null&&r!==void 0?r:i.colCount);p++)for(let f=0;f<Math.max(i.rowCount,(s=i.internalProps._oldRowCount)!==null&&s!==void 0?s:i.rowCount);f++){const m=o.highPerformanceGetCell(p,f,!0);m&&(m.needUpdate=!0)}o.proxy.colUpdatePos=u}if(l.length){if(!J(u)){const p=Math.min(...l);o.proxy.colUpdatePos=p}o.proxy.colUpdateDirection="left",o.proxy.updateColGroups(2*o.proxy.screenColCount),g(),o.proxy.progress()}else a.length&&(o.proxy.updateColGroups(2*o.proxy.screenColCount),g(),o.proxy.progress());const c=i.getColsWidth(i.frozenColCount,i.colCount-1);function g(){if((l==null?void 0:l[(l==null?void 0:l.length)-1])>=i.colCount-i.rightFrozenColCount||(h==null?void 0:h[(h==null?void 0:h.length)-1])>=i.colCount-i.rightFrozenColCount||(a==null?void 0:a[0])>=i.colCount-i.rightFrozenColCount){for(let p=i.colCount-i.rightFrozenColCount;p<i.colCount;p++)for(let f=0;f<i.rowCount;f++){const m=o.highPerformanceGetCell(p,f,!0);m&&(m.needUpdate=!0)}o.proxy.updateRightFrozenCellGroups()}}o.updateContainerWidth(o.table.frozenColCount,c-o.bodyGroup.attribute.width)}function PSt(n,t){const e=t.proxy;if(n>=t.table.rowHeaderLevelCount&&!(n>=t.table.colCount-t.table.rightFrozenColCount)){const r=t.getColGroup(n,!1);r&&r.parent===t.bodyGroup&&t.bodyGroup.removeChild(r);const s=t.getColGroupInBottom(n);s&&s.parent===t.bottomFrozenGroup&&t.bottomFrozenGroup.removeChild(s);const o=t.getColGroup(n,!0);o&&o.parent===t.colHeaderGroup&&t.colHeaderGroup.removeChild(o)}n>=e.colStart&&n<=e.colEnd&&(e.colEnd--,e.currentCol--),e.bodyRightCol--;const i=Math.min(e.colLimit,e.bodyRightCol-e.bodyLeftCol+1);e.totalActualBodyColCount=i,e.totalCol=e.colStart+i-1}function ESt(n,t){const e=t.proxy;e.bodyRightCol++;const i=Math.min(e.colLimit,e.bodyRightCol-e.bodyLeftCol+1);if(e.totalActualBodyColCount=i,e.totalCol=e.colStart+i-1,!(n<e.colStart))return n>e.colEnd?e.colEnd-e.colStart+1<e.colLimit?(e.colEnd++,e.currentCol++,UN(n,t),n):void 0:(e.colEnd-e.colStart+1<e.colLimit&&(e.colEnd++,e.currentCol++,UN(n,t)),n)}function qR(n){const t=[];for(let e=0;e<n.length;e++)t.indexOf(n[e])===-1&&t.push(n[e]);return t}function GN(n){let t=n.bodyColStart;function e(i){i.col=t;const r=un(n.table,i.col,i.row);r&&(i.mergeStartCol=r.start.col,i.mergeStartCol=r.start.col,i.mergeEndCol=r.end.col,i.mergeEndCol=r.end.col),i.role}n.bodyGroup.forEachChildren(i=>{i.col=t,i==null||i.forEachChildren(r=>{e(r)}),t++}),t=n.bodyColStart,n.colHeaderGroup.forEachChildren(i=>{i.col=t,i==null||i.forEachChildren(r=>{e(r)}),t++}),t=n.bodyColStart,n.bottomFrozenGroup.forEachChildren(i=>{i.col=t,i==null||i.forEachChildren(r=>{e(r)}),t++})}function LSt(n){let t=n.bodyColStart,e=n.getCellGroupX(t);function i(r){r.col=t;const s=un(n.table,r.col,r.row);s&&(r.mergeStartCol=s.start.col,r.mergeStartCol=s.start.col,r.mergeEndCol=s.end.col,r.mergeEndCol=s.end.col),r.role}n.bodyGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(s=>{i(s)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.bodyColStart,e=n.getCellGroupX(t),n.colHeaderGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(s=>{i(s)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.bodyColStart,e=n.getCellGroupX(t),n.bottomFrozenGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(s=>{i(s)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightFrozenGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(s=>{i(s)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightTopCornerGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(s=>{i(s)}),r.setAttribute("x",e),e+=r.attribute.width,t++}),t=n.table.colCount-n.table.rightFrozenColCount,e=0,n.rightBottomCornerGroup.forEachChildren(r=>{r.col=t,r==null||r.forEachChildren(s=>{i(s)}),r.setAttribute("x",e),e+=r.attribute.width,t++})}function UN(n,t){if(t.colHeaderGroup&&t.table.columnHeaderLevelCount>0){const i=new De({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroup(n,!0);r?t.colHeaderGroup.insertBefore(i,r):t.colHeaderGroup.appendChild(i),e(i,n,0,t.table.columnHeaderLevelCount-1)}if(t.bodyGroup){const i=new De({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroup(n,!1);r?t.bodyGroup.insertBefore(i,r):t.bodyGroup.appendChild(i),e(i,n,t.bodyRowStart,t.bodyRowEnd)}if(t.bottomFrozenGroup&&t.table.bottomFrozenRowCount>0){const i=new De({x:0,y:0,width:t.table.getColWidth(n),height:0,clip:!1,pickable:!1});i.role="column",i.col=n;const r=t.getColGroupInBottom(n);r?t.bottomFrozenGroup.insertBefore(i,r):t.bottomFrozenGroup.appendChild(i),e(i,n,t.table.rowCount-t.table.bottomFrozenRowCount,t.table.rowCount-1)}function e(i,r,s,o){for(let a=s;a<=o;a++){const l=new De({x:0,y:0,width:t.table.getColWidth(r),height:t.table.getRowHeight(a)});l.role="cell",l.col=r,l.row=a,l.needUpdate=!0,i.appendChild(l)}}}function ISt(n){var t,e,i,r;if(!n.options.animationAppear)return;let s,o,a,l;n.options.animationAppear===!0?(s=500,o=0,a="one-by-one",l="column"):(s=(t=n.options.animationAppear.duration)!==null&&t!==void 0?t:500,o=(e=n.options.animationAppear.delay)!==null&&e!==void 0?e:0,a=(i=n.options.animationAppear.type)!==null&&i!==void 0?i:"one-by-one",l=(r=n.options.animationAppear.direction)!==null&&r!==void 0?r:"row");const{scenegraph:h,frozenColCount:d,frozenRowCount:u}=n,{colStart:c,colEnd:g,rowStart:p,rowEnd:f}=h.proxy;for(let m=0;m<=g;m++)for(let v=0;v<=f;v++){const _=h.highPerformanceGetCell(m,v);_&&_.role==="cell"&&_.forEachChildren(b=>{b.setAttribute("opacity",0),b.animate().wait(a==="one-by-one"?(l==="row"?v:m)*(s-o):o).to({opacity:1},s,"linear")})}}function OSt(n,t){const{selectedRangeComponents:e}=t;e.forEach((i,r)=>{i.rect.setAttributes(n)}),t.updateNextFrame()}M_t(),he.load(_Ct),he.load(Hyt);class DSt{constructor(t){let e,i;this._needUpdateContainer=!1,this.table=t,this.hasFrozen=!1,this.clear=!0,this.mergeMap=new Map,ovt(this.table.theme.textPopTipStyle),We.mode==="node"?(oi.setEnv("node",t.options.modeParams),e=t.canvasWidth,i=t.canvasHeight):t.options.canvas&&t.options.viewBox?(oi.setEnv("browser"),e=t.options.viewBox.x2-t.options.viewBox.x1,i=t.options.viewBox.y2-t.options.viewBox.y1):(oi.setEnv("browser"),e=t.canvas.width,i=t.canvas.height),this.stage=dpt(Object.assign({canvas:t.canvas,width:e,height:i,disableDirtyBounds:!1,background:t.theme.underlayBackgroundColor,dpr:t.internalProps.pixelRatio,enableLayout:!0,beforeRender:r=>{this.table.options.beforeRender&&this.table.options.beforeRender(r),this.table.animationManager.ticker.start()},afterRender:r=>{this.table.options.afterRender&&this.table.options.afterRender(r),this.table.fireListeners("after_render",null)},canvasControled:!t.options.canvas,viewBox:t.options.viewBox},t.options.renderOption)),this.stage.defaultLayer.setTheme({group:{boundsPadding:0,strokeBoundsBuffer:0,lineJoin:"round"},text:{ignoreBuf:!0}}),this.initSceneGraph(),this.stage.defaultLayer.add(this.tableGroup),this.stage.table=this.table,this.createComponent()}get width(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:0}get height(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.height)!==null&&e!==void 0?e:0}get x(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.x)!==null&&e!==void 0?e:0}get y(){var t,e;return(e=(t=this.tableGroup.attribute)===null||t===void 0?void 0:t.y)!==null&&e!==void 0?e:0}get bodyRowStart(){var t;return(t=this.proxy.rowStart)!==null&&t!==void 0?t:0}get bodyRowEnd(){var t;return(t=this.proxy.rowEnd)!==null&&t!==void 0?t:this.table.rowCount-1}get bodyColStart(){var t;return(t=this.proxy.colStart)!==null&&t!==void 0?t:0}get bodyColEnd(){var t;return(t=this.proxy.colEnd)!==null&&t!==void 0?t:this.table.colCount-1}initSceneGraph(){this.isPivot=this.table.isPivotTable(),fSt(this)}clearCells(){var t,e;this.table.animationManager.clear(),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.findPluginsByName("poptipForText").forEach(i=>{i.deactivate(this.stage.pluginService)}),this.clear=!0,this.hasFrozen=!1,this.mergeMap.clear(),this.colHeaderGroup.clear(),delete this.colHeaderGroup.border,this.rowHeaderGroup.clear(),delete this.rowHeaderGroup.border,this.cornerHeaderGroup.clear(),delete this.cornerHeaderGroup.border,this.bodyGroup.clear(),delete this.bodyGroup.border,this.bottomFrozenGroup.clear(),delete this.bottomFrozenGroup.border,this.rightFrozenGroup.clear(),delete this.rightFrozenGroup.border,this.rightTopCornerGroup.clear(),delete this.rightTopCornerGroup.border,this.rightBottomCornerGroup.clear(),delete this.rightBottomCornerGroup.border,this.leftBottomCornerGroup.clear(),delete this.leftBottomCornerGroup.border,this.colHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rowHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.cornerHeaderGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bodyGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.bottomFrozenGroup.setAttributes({x:0,y:0,width:0,height:0}),this.rightTopCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.leftBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.rightBottomCornerGroup.setAttributes({x:0,y:0,width:0,height:0,visible:!1}),this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:0,height:0}),this.tableGroup.border&&(this.tableGroup.parent.removeChild(this.tableGroup.border),delete this.tableGroup.border),(t=this.proxy)===null||t===void 0||t.release(),(e=this.table.reactCustomLayout)===null||e===void 0||e.clearCache()}updateStageBackground(){this.stage.background=this.table.theme.underlayBackgroundColor,this.stage.renderNextFrame()}createComponent(){this.component=new tCt(this.table),this.component.addToGroup(this.componentGroup),this.selectedRangeComponents=new Map,this.selectingRangeComponents=new Map,this.customSelectedRangeComponents=new Map}updateComponent(){this.component.updateStyle()}createSceneGraph(t=!1){t||(this.table.rowHeightsMap.clear(),this.table.internalProps.layoutMap.clearCellRangeMap()),(this.table.isPivotChart()||this.table._hasCustomRenderOrLayout())&&this.stage.pluginService.autoEnablePlugins.getContributions().forEach(e=>{e.name==="poptipForText"&&this.stage.pluginService.register(e)}),this.clear=!1,this.frozenColCount=this.table.frozenColCount,this.frozenRowCount=this.table.frozenRowCount,this.proxy=new jCt(this.table),Io(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0,!0),this.table.isPivotChart()&&(KR(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle||this.table.theme.cornerHeaderStyle||{}),KR(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle||this.table.theme.cornerHeaderStyle||{}),KR(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle||this.table.theme.cornerHeaderStyle||{})),this.proxy.createGroupForFirstScreen(this.cornerHeaderGroup,this.colHeaderGroup,this.rowHeaderGroup,this.rightFrozenGroup,this.bottomFrozenGroup,this.bodyGroup,0,0),this.afterScenegraphCreated()}renderSceneGraph(){this.stage.render()}getCell(t,e,i){var r,s,o,a,l,h;let d;if(d=this.table.rightFrozenColCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e<this.table.frozenRowCount?(r=this.rightTopCornerGroup.getColGroup(t))===null||r===void 0?void 0:r.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<this.table.frozenColCount?(s=this.leftBottomCornerGroup.getColGroup(t))===null||s===void 0?void 0:s.getRowGroup(e):this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0&&t>=this.table.colCount-this.table.rightFrozenColCount&&e>=this.table.rowCount-this.table.bottomFrozenRowCount?(o=this.rightBottomCornerGroup.getColGroup(t))===null||o===void 0?void 0:o.getRowGroup(e):this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?(a=this.rightFrozenGroup.getColGroup(t))===null||a===void 0?void 0:a.getRowGroup(e):this.table.bottomFrozenRowCount>0&&e>this.table.rowCount-1-this.table.bottomFrozenRowCount?(l=this.bottomFrozenGroup.getColGroup(t))===null||l===void 0?void 0:l.getRowGroup(e):(h=this.getColGroup(t,e<this.frozenRowCount))===null||h===void 0?void 0:h.getRowGroup(e),d&&d.role==="shadow-cell"&&!i){const u=this.table.getCellRange(t,e);u.start.col===t&&u.start.row===e||(d=this.getCell(u.start.col,u.start.row))}return d||Nx}highPerformanceGetCell(t,e,i){return this.proxy.highPerformanceGetCell(t,e,i)}getColGroup(t,e=!1){let i;return i=t<this.frozenColCount&&e?this.cornerHeaderGroup.getColGroup(t):t<this.frozenColCount?this.rowHeaderGroup.getColGroup(t):e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightTopCornerGroup.getColGroup(t):!e&&this.table.rightFrozenColCount>0&&t>this.table.colCount-1-this.table.rightFrozenColCount?this.rightFrozenGroup.getColGroup(t):e?this.colHeaderGroup.getColGroup(t):this.bodyGroup.getColGroup(t),i||void 0}getColGroupInBottom(t,e=!1){var i;if(e){const r=(i=this.getColGroupInLeftBottomCorner(t))!==null&&i!==void 0?i:this.getColGroupInRightBottomCorner(t);if(r)return r}if(this.table.bottomFrozenRowCount>0)return this.bottomFrozenGroup.getColGroup(t)}getColGroupInLeftBottomCorner(t){if(this.table.bottomFrozenRowCount>0)return this.leftBottomCornerGroup.getColGroup(t)}getColGroupInRightTopCorner(t){if(this.table.rightFrozenColCount>0)return this.rightTopCornerGroup.getColGroup(t)}getColGroupInRightBottomCorner(t){if(this.table.rightFrozenColCount>0&&this.table.bottomFrozenRowCount>0)return this.rightBottomCornerGroup.getColGroup(t)}getCellSize(t,e){const i=this.getCell(t,e),r=un(this.table,t,e);let s=i.attribute.width,o=i.attribute.height;return r&&(s/=r.end.col-r.start.col+1,o/=r.end.row-r.start.row+1),{width:s,height:o}}updateNextFrame(){this.updateContainerSync(),this.resetAllSelectComponent(),this.stage.renderNextFrame()}resetAllSelectComponent(){var t,e,i,r;(((e=(t=this.table.stateManager.select)===null||t===void 0?void 0:t.ranges)===null||e===void 0?void 0:e.length)>0||((r=(i=this.table.stateManager.select)===null||i===void 0?void 0:i.customSelectRanges)===null||r===void 0?void 0:r.length)>0)&&Yq(this)}hideHoverIcon(t,e){mSt(t,e,this)}showHoverIcon(t,e){vSt(t,e,this)}hideClickIcon(t,e){_St(t,e,this)}showClickIcon(t,e){bSt(t,e,this)}getIcon(t,e,i,r){return ySt(t,e,i,r,this)}setIconHoverStyle(t,e,i,r){CSt(t,e,i,r,this)}updateSortIcon(t){const{col:e,row:i,iconMark:r,order:s,oldSortCol:o,oldSortRow:a,oldIconMark:l}=t;ASt({col:e,row:i,iconMark:r,order:s,oldSortCol:o,oldSortRow:a,oldIconMark:l,scene:this})}updateFrozenIcon(t,e){MSt(this)}updateHierarchyIcon(t,e){TSt(t,e,this)}setIconNormalStyle(t,e,i){SSt(t,e,i,this)}residentHoverIcon(t,e){kSt(t,e,this)}resetResidentHoverIcon(t,e){RSt(t,e,this)}deactivateChart(t,e){var i,r;if(t===-1||e===-1)return;const s=this.getCell(t,e);(r=(i=s==null?void 0:s.firstChild)===null||i===void 0?void 0:i.deactivate)===null||r===void 0||r.call(i)}activateChart(t,e){var i,r,s;if(t===-1||e===-1)return;const o=this.getCell(t,e);return(r=(i=o==null?void 0:o.firstChild)===null||i===void 0?void 0:i.activate)===null||r===void 0||r.call(i,this.table),(s=o==null?void 0:o.firstChild)===null||s===void 0?void 0:s.activeChartInstance}removeInteractionBorder(t,e){const i=this.getCell(t,e);i.setAttribute("highlightStroke",void 0),i.setAttribute("highlightStrokeArrayWidth",void 0),i.setAttribute("highlightStrokeArrayColor",void 0)}createCellSelectBorder(t,e,i,r,s,o,a){$Ct(this,t,e,i,r,s,o,a)}moveSelectingRangeComponentsToSelectedRangeComponents(){jN(this)}deleteLastSelectedRangeComponents(){GCt(this)}deleteAllSelectBorder(){NN(this),Xq(this)}updateCellSelectBorder(t,e=!0){HN(this,t,e)}removeFillHandleFromSelectComponents(){UCt(this)}recreateAllSelectRangeComponents(){NN(this),this.table.stateManager.select.ranges.forEach(t=>{HN(this,t),jN(this)})}updateColWidth(t,e,i,r){Kyt(this,t,Math.round(e),r),i||this.updateContainer(!0)}updateChartSizeForResizeColWidth(t){cSt(this,t)}updateChartSizeForResizeRowHeight(t){gSt(this,t)}updateChartState(t){this.table.isPivotChart()&&pSt(this,t)}updateCheckboxCellState(t,e,i){var r,s;if(this.table.transpose)(r=this.bodyGroup.children)===null||r===void 0||r.forEach(o=>{var a;(a=o.getChildAt(e))===null||a===void 0||a.getChildren().forEach(l=>{l.name==="checkbox"&&(i==="indeterminate"?(l.setAttribute("indeterminate",!0),l.setAttribute("checked",void 0)):(l.setAttribute("indeterminate",void 0),l.setAttribute("checked",i)))})});else{const o=this.getColGroup(t);(s=o==null?void 0:o.children)===null||s===void 0||s.forEach(a=>{a.getChildren().find(l=>{l.name==="checkbox"&&(i==="indeterminate"?(l.setAttribute("indeterminate",!0),l.setAttribute("checked",void 0)):(l.setAttribute("indeterminate",void 0),l.setAttribute("checked",i)))})})}}updateHeaderCheckboxCellState(t,e,i){var r,s;this.table.transpose?(r=this.rowHeaderGroup.children)===null||r===void 0||r.forEach(o=>{o.getChildAt(e).getChildren().forEach(a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i)))})}):(s=this.getColGroup(t,!0).children)===null||s===void 0||s.forEach(o=>{o.getChildren().find(a=>{a.name==="checkbox"&&(i==="indeterminate"?(a.setAttribute("indeterminate",!0),a.setAttribute("checked",void 0)):(a.setAttribute("indeterminate",void 0),a.setAttribute("checked",i)))})})}updateAutoColWidth(t){this.table.internalProps._widthResizedColMap.delete(t);const e=this.table.getColWidth(t),i=Tp(t,0,this.table.rowCount-1,this.table,!0);i!==e&&this.updateColWidth(t,i-e)}recalculateColWidths(){const t=this.table;t.widthMode==="adaptive"||t.autoFillWidth||t.internalProps.transpose?fo(this.table,0,this.table.colCount-1,!0):(t._clearColRangeWidthsMap(),t.frozenColCount>0&&fo(this.table,0,t.frozenColCount-1,!0),t.rightFrozenColCount>0&&fo(this.table,t.rightFrozenColCount,t.colCount-1,!0),fo(t,this.proxy.colStart,this.proxy.colEnd,!0))}recalculateRowHeights(){const t=this.table;t.internalProps.useOneRowHeightFillAll=!1,t.heightMode==="adaptive"||t.autoFillHeight?po(this.table,0,this.table.rowCount-1,!0,!0):(t.frozenRowCount>0&&po(this.table,0,t.frozenRowCount-1,!0,!0),t.bottomFrozenRowCount>0&&po(this.table,t.bottomFrozenRowCount,t.rowCount-1,!0,!0),po(t,this.proxy.rowStart,this.proxy.rowEnd,!0,!0))}resize(){this.proxy.resize(),(this.table.widthMode==="adaptive"||this.table.autoFillWidth)&&(this.table.internalProps._widthResizedColMap.size===0?this.recalculateColWidths():this.dealWidthMode()),this.table.heightMode==="adaptive"?this.table.internalProps._heightResizedRowMap.size===0?this.recalculateRowHeights():this.dealHeightMode():this.table.autoFillHeight&&this.dealHeightMode(),this.resetFrozen(),this.updateTableSize(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),(this.table.widthMode==="adaptive"||this.table.heightMode==="adaptive"||this.table.autoFillWidth||this.table.autoFillHeight)&&this.updateChartSizeForResizeColWidth(-1),this.proxy.progress(),this.updateNextFrame()}updateTableSize(){var t,e,i,r,s,o,a,l,h,d,u,c,g;if(this.tableGroup.setAttributes({x:this.table.tableX,y:this.table.tableY,width:Math.min(this.table.tableNoFrameWidth,Math.max(this.colHeaderGroup.attribute.width,this.bodyGroup.attribute.width,this.bottomFrozenGroup.attribute.width,0)+Math.max(this.cornerHeaderGroup.attribute.width,this.rowHeaderGroup.attribute.width,this.leftBottomCornerGroup.attribute.width,0)+Math.max(this.rightTopCornerGroup.attribute.width,this.rightFrozenGroup.attribute.width,this.rightBottomCornerGroup.attribute.width,0)),height:Math.min(this.table.tableNoFrameHeight,Math.max(this.colHeaderGroup.attribute.height,this.cornerHeaderGroup.attribute.height,this.rightTopCornerGroup.attribute.height,0)+Math.max(this.rowHeaderGroup.attribute.height,this.bodyGroup.attribute.height,this.rightFrozenGroup.attribute.height,0)+Math.max(this.leftBottomCornerGroup.attribute.height,this.bottomFrozenGroup.attribute.height,this.rightBottomCornerGroup.attribute.height,0))}),this.tableGroup.border){const p=(t=this.tableGroup.border)===null||t===void 0?void 0:t.attribute;let f,m,v,_;p!=null&&p.strokeArrayWidth?(f=p.strokeArrayWidth?p.strokeArrayWidth[0]:(e=p.lineWidth)!==null&&e!==void 0?e:0,m=p.strokeArrayWidth?p.strokeArrayWidth[1]:(i=p.lineWidth)!==null&&i!==void 0?i:0,v=p.strokeArrayWidth?p.strokeArrayWidth[2]:(r=p.lineWidth)!==null&&r!==void 0?r:0,_=p.strokeArrayWidth?p.strokeArrayWidth[3]:(s=p.lineWidth)!==null&&s!==void 0?s:0):(f=(o=p==null?void 0:p.lineWidth)!==null&&o!==void 0?o:0,m=(a=p==null?void 0:p.lineWidth)!==null&&a!==void 0?a:0,v=(l=p==null?void 0:p.lineWidth)!==null&&l!==void 0?l:0,_=(h=p==null?void 0:p.lineWidth)!==null&&h!==void 0?h:0),this.tableGroup.border.type==="rect"?!((d=this.table.theme.frameStyle)===null||d===void 0)&&d.innerBorder?this.tableGroup.border.setAttributes({x:this.table.tableX+_/2,y:this.table.tableY+f/2,width:this.tableGroup.attribute.width-_/2-m/2,height:this.tableGroup.attribute.height-f/2-v/2}):this.tableGroup.border.setAttributes({x:this.table.tableX-_/2,y:this.table.tableY-f/2,width:this.tableGroup.attribute.width+_/2+m/2,height:this.tableGroup.attribute.height+f/2+v/2}):this.tableGroup.border.type==="group"&&(!((u=this.table.theme.frameStyle)===null||u===void 0)&&u.innerBorder?(this.tableGroup.border.setAttributes({x:this.table.tableX+_/2,y:this.table.tableY+f/2,width:this.tableGroup.attribute.width-_/2-m/2,height:this.tableGroup.attribute.height-f/2-v/2}),(c=this.tableGroup.border.firstChild)===null||c===void 0||c.setAttributes({x:0,y:0,width:this.tableGroup.attribute.width-_/2-m/2,height:this.tableGroup.attribute.height-f/2-v/2})):(this.tableGroup.border.setAttributes({x:this.table.tableX-_/2,y:this.table.tableY-f/2,width:this.tableGroup.attribute.width+_/2+m/2,height:this.tableGroup.attribute.height+f/2+v/2}),(g=this.tableGroup.border.firstChild)===null||g===void 0||g.setAttributes({x:_/2,y:f/2,width:this.tableGroup.attribute.width,height:this.tableGroup.attribute.height})))}this.table.bottomFrozenRowCount>0&&(this.bottomFrozenGroup.setAttribute("y",this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight()),this.leftBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight(),width:this.table.getFrozenColsWidth()}),this.rightBottomCornerGroup.setAttributes({visible:!0,y:this.tableGroup.attribute.height-this.table.getBottomFrozenRowsHeight(),height:this.table.getBottomFrozenRowsHeight()})),this.table.rightFrozenColCount>0&&(this.rightFrozenGroup.setAttribute("x",this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth()),this.rightTopCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth(),height:this.table.getFrozenRowsHeight()}),this.rightBottomCornerGroup.setAttributes({visible:!0,x:this.tableGroup.attribute.width-this.table.getRightFrozenColsWidth(),width:this.table.getRightFrozenColsWidth()})),this.updateDomContainer()}updateRowHeight(t,e,i){e=Math.round(e),_N(this,t,e,i),this.updateContainerHeight(t,e)}updateRowsHeight(t,e,i){for(let r=0;r<t.length;r++){const s=t[r];if(s>=this.proxy.rowStart&&s<=this.proxy.rowEnd){const o=e[r];_N(this,s,Math.round(o),i),this._updateContainerHeight(s,o)}}this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}updateContainerWidth(t,e){t<this.frozenColCount?(this.rowHeaderGroup.setDeltaWidth(e),this.cornerHeaderGroup.setDeltaWidth(e),this.colHeaderGroup.setDeltaX(e),this.bodyGroup.setDeltaX(e)):(this.colHeaderGroup.setDeltaWidth(e),this.bodyGroup.setDeltaWidth(e)),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}_updateContainerHeight(t,e){t<this.table.frozenRowCount?(this.colHeaderGroup.setDeltaHeight(e),this.cornerHeaderGroup.setDeltaHeight(e),this.rowHeaderGroup.setDeltaY(e),this.bodyGroup.setDeltaY(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaY(e)):t>=this.table.rowCount-this.table.bottomFrozenRowCount?(this.leftBottomCornerGroup.setDeltaHeight(e),this.bottomFrozenGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightBottomCornerGroup.setDeltaHeight(e)):(this.rowHeaderGroup.setDeltaHeight(e),this.bodyGroup.setDeltaHeight(e),this.table.rightFrozenColCount&&this.rightFrozenGroup.setDeltaHeight(e))}updateContainerHeight(t,e){this._updateContainerHeight(t,e),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame()}setColWidth(t,e){const i=this.table.getColWidth(t);i!==e&&(this.updateColWidth(t,e-i),this.table._clearColRangeWidthsMap(t))}setRowHeight(t,e){const i=this.table.getRowHeight(t);i!==e&&((t>=this.proxy.rowStart&&t<=this.proxy.rowEnd||t>=this.table.rowCount-this.table.bottomFrozenRowCount&&t<=this.table.rowCount-1||t<this.table.frozenRowCount)&&this.updateRowHeight(t,e-i),this.table._clearRowRangeHeightsMap(t))}setX(t,e=!1){this.table.scenegraph.proxy.setX(-t,e)}setY(t,e=!1){this.table.scenegraph.proxy.setY(-t,e)}setBodyAndRowHeaderY(t){var e,i,r,s,o,a;const l=(i=(e=this.bodyGroup.firstChild)===null||e===void 0?void 0:e.firstChild)!==null&&i!==void 0?i:(r=this.rowHeaderGroup.firstChild)===null||r===void 0?void 0:r.firstChild,h=(o=(s=this.bodyGroup.firstChild)===null||s===void 0?void 0:s.lastChild)!==null&&o!==void 0?o:(a=this.rowHeaderGroup.firstChild)===null||a===void 0?void 0:a.lastChild;t===0&&l&&l.row===this.table.frozenRowCount&&l.attribute.y+t<0?t=-l.attribute.y:h&&this.table.tableNoFrameHeight<this.table.getAllRowsHeight()&&h.row===this.table.rowCount-this.table.bottomFrozenRowCount-1&&h.attribute.y+h.attribute.height+t<this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()&&(t=this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()-h.attribute.y-h.attribute.height),this.colHeaderGroup.attribute.height+t!==this.bodyGroup.attribute.y&&(this.bodyGroup.setAttribute("y",this.colHeaderGroup.attribute.height+t),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height+t),this.table.rightFrozenColCount>0&&this.rightFrozenGroup.setAttribute("y",this.rightTopCornerGroup.attribute.height+t),this.updateNextFrame())}setBodyAndColHeaderX(t){const e=this.bodyGroup.firstChild,i=this.bodyGroup.lastChild;t===0&&e&&e.col===this.table.frozenColCount&&e.attribute.x+t<0?t=-e.attribute.x:i&&this.table.tableNoFrameWidth<this.table.getAllColsWidth()&&i.col===this.table.colCount-this.table.rightFrozenColCount-1&&i.attribute.x+i.attribute.width+t<this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()&&(t=this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()-i.attribute.x-i.attribute.width),this.table.getFrozenColsWidth()+t!==this.bodyGroup.attribute.x&&(this.bodyGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.colHeaderGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.table.bottomFrozenRowCount>0&&this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()+t),this.updateNextFrame())}afterScenegraphCreated(){this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount?this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):this.component.setFrozenColumnShadow(-1):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.table.stateManager.checkFrozen(),this.updateContainer(),this.createFrameBorder(),this.updateBorderSizeAndPosition(),this.component.updateScrollBar(),xv(this.table),this.table.options.animationAppear&&ISt(this.table),this.updateNextFrame()}dealWidthMode(){const t=this.table;if(t.widthMode==="adaptive"){t._clearColRangeWidthsMap();const o=t.tableNoFrameWidth;let a=0,l=0,h=t.colCount;if(t.widthAdaptiveMode==="only-body"){for(let d=0;d<t.colCount;d++)(d<t.rowHeaderLevelCount||t.isPivotChart()&&d>=t.colCount-t.rightFrozenColCount)&&(a+=t.getColWidth(d));l=t.rowHeaderLevelCount,h=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount}jx(o-a,l,h,!1,[],t,!0)}else if(t.autoFillWidth){t._clearColRangeWidthsMap();const o=t.tableNoFrameWidth;let a=0,l=0;for(let h=0;h<t.colCount;h++){const d=t.getColWidth(h);(h<t.rowHeaderLevelCount||t.isPivotChart()&&h>=t.colCount-t.rightFrozenColCount)&&(a+=d),l+=d}if(l<o&&l>a){const h=t.rowHeaderLevelCount,d=t.isPivotChart()?t.colCount-t.rightFrozenColCount:t.colCount;jx(o-a,h,d,!1,[],t,!0)}}let e=0;this.bodyGroup.forEachChildrenSkipChild(o=>{e+=o.attribute.width}),this.bodyGroup.setAttribute("width",e);let i=0;this.colHeaderGroup.forEachChildrenSkipChild(o=>{i+=o.attribute.width}),this.colHeaderGroup.setAttribute("width",i);let r=0;this.rowHeaderGroup.forEachChildrenSkipChild(o=>{r+=o.attribute.width}),this.rowHeaderGroup.setAttribute("width",r);let s=0;this.cornerHeaderGroup.forEachChildrenSkipChild(o=>{s+=o.attribute.width}),this.cornerHeaderGroup.setAttribute("width",s),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.rowHeaderGroup.setAttribute("y",this.cornerHeaderGroup.attribute.height),this.bodyGroup.setAttributes({x:this.rowHeaderGroup.attribute.width,y:this.colHeaderGroup.attribute.height})}dealHeightMode(){var t;const e=this.table;if(e.heightMode==="adaptive"){e._clearRowRangeHeightsMap();const i=e.getRowsHeight(0,e.columnHeaderLevelCount-1),r=e.isPivotChart()?e.getBottomFrozenRowsHeight():0,s=e.tableNoFrameHeight-i-r,o=e.columnHeaderLevelCount,a=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount;let l=0;for(let d=o;d<a;d++)l+=e.getRowHeight(d);const h=s/l;for(let d=o;d<a;d++){let u;u=d===a-1?s-e.getRowsHeight(o,a-2):Math.round(e.getRowHeight(d)*h),this.setRowHeight(d,u)}}else if(e.autoFillHeight){e._clearRowRangeHeightsMap();const i=e.tableNoFrameHeight;let r=0,s=0;for(let o=0;o<e.rowCount;o++){const a=e.getRowHeight(o);(o<e.columnHeaderLevelCount||e.isPivotChart()&&o>=e.rowCount-e.bottomFrozenRowCount)&&(s+=a),r+=a}if(((t=this._dealAutoFillHeightOriginRowsHeight)!==null&&t!==void 0?t:r)<i&&r-s>0){const o=e.columnHeaderLevelCount,a=e.isPivotChart()?e.rowCount-e.bottomFrozenRowCount:e.rowCount,l=(i-s)/(r-s);for(let h=o;h<a;h++){let d;d=h===a-1?i-s-e.getRowsHeight(o,a-2):Math.round(e.getRowHeight(h)*l),this.setRowHeight(h,d)}}}}dealFrozen(){eSt(this)}resetFrozen(){iSt(this)}resetRowFrozen(){sSt(this)}updateCellLayoutWidthCertainWidth(t,e,i){const r=t.attribute.width;let s=!1;return t.forEachChildren((o,a)=>{a+=e;const l=un(this.table,i,a);l?o=this.getCell(l.start.col,l.start.row):o.setAttribute("width",r);const h=this.table._getCellStyle(i,a),d=Be(Mt("padding",h,i,a,this.table)),u=o.getChildByName("text");let c=0,g=0;if(u)c=u.AABBBounds.height()+(d[0]+d[2]),u.setAttribute("maxLineWidth",r-(d[1]+d[3])),g=u.AABBBounds.height()+(d[0]+d[2]);else{const f=o.getChildAt(1);c=f.AABBBounds.height()+(d[0]+d[2]),f._cellWidth=r-(d[1]+d[3]),f.layout(),g=f.AABBBounds.height()+(d[0]+d[2])}const p=this.table.getRowHeight(a);o.attribute.height!==g&&(o.setAttribute("height",g),(p===c||g>p)&&(s=!0))}),s}updateHeaderPosition(t,e,i,r,s){NCt(t,e,i,r,s,this.table)}updateContainerAttrWidthAndX(){var t,e,i;const r=_l(this.cornerHeaderGroup,0),s=_l(this.rowHeaderGroup,0),o=this.colHeaderGroup.hasChildNodes()&&this.colHeaderGroup.firstChild?_l(this.colHeaderGroup,this.colHeaderGroup.firstChild.col>0?this.table.getColsWidth((t=this.table.frozenColCount)!==null&&t!==void 0?t:0,this.colHeaderGroup.firstChild.col-1):0):0,a=this.bodyGroup.hasChildNodes()&&this.bodyGroup.firstChild?_l(this.bodyGroup,this.bodyGroup.firstChild.col>0?this.table.getColsWidth((e=this.table.frozenColCount)!==null&&e!==void 0?e:0,this.bodyGroup.firstChild.col-1):0):0,l=_l(this.rightFrozenGroup.childrenCount>0?this.rightFrozenGroup:this.rightTopCornerGroup,0);this.bottomFrozenGroup.hasChildNodes()&&this.bottomFrozenGroup.firstChild&&_l(this.bottomFrozenGroup,this.bottomFrozenGroup.firstChild.col>0?this.table.getColsWidth((i=this.table.frozenColCount)!==null&&i!==void 0?i:0,this.bottomFrozenGroup.firstChild.col-1):0),_l(this.leftBottomCornerGroup,0),_l(this.rightTopCornerGroup,0),_l(this.rightBottomCornerGroup,0),this.cornerHeaderGroup.setDeltaWidth(r-this.cornerHeaderGroup.attribute.width),this.leftBottomCornerGroup.setDeltaWidth(r-this.leftBottomCornerGroup.attribute.width),this.colHeaderGroup.setDeltaWidth(o-this.colHeaderGroup.attribute.width),this.rowHeaderGroup.setDeltaWidth(s-this.rowHeaderGroup.attribute.width),this.bottomFrozenGroup.setDeltaWidth(o-this.bottomFrozenGroup.attribute.width),this.rightFrozenGroup.setDeltaWidth(l-this.rightFrozenGroup.attribute.width),this.rightTopCornerGroup.setDeltaWidth(l-this.rightTopCornerGroup.attribute.width),this.rightBottomCornerGroup.setDeltaWidth(l-this.rightBottomCornerGroup.attribute.width),this.bodyGroup.setDeltaWidth(a-this.bodyGroup.attribute.width),this.colHeaderGroup.setAttribute("x",this.cornerHeaderGroup.attribute.width),this.bottomFrozenGroup.setAttribute("x",this.table.getFrozenColsWidth()),this.bodyGroup.setAttribute("x",this.rowHeaderGroup.attribute.width)}updateContainer(t=!1){t?this._needUpdateContainer||(this._needUpdateContainer=!0,setTimeout(()=>{this.updateContainerSync()},0)):(this._needUpdateContainer=!0,this.updateContainerSync())}updateContainerSync(){this._needUpdateContainer&&(this._needUpdateContainer=!1,this.updateContainerAttrWidthAndX(),this.updateTableSize(),this.component.updateScrollBar(),this.updateNextFrame())}updateCellContentWhileResize(t,e){var i;const r=!((i=this.table.getCellRawRecord(t,e))===null||i===void 0)&&i.vtableMerge?"text":this.table.isHeader(t,e)?this.table._getHeaderLayoutMap(t,e).headerType:this.table.getBodyColumnType(t,e),s=this.getCell(t,e);r!=="image"&&r!=="video"||U_(s,t,e,0,0,this.table)}createFrameBorder(){var t,e,i,r,s;this.updateTableSize();const o=!this.isPivot&&!this.table.internalProps.transpose;Io(this.bodyGroup,this.table.theme.bodyStyle.frameStyle,this.bodyGroup.role,o?[!0,!0,!0,!1]:void 0),Io(this.rowHeaderGroup,this.isPivot||this.table.internalProps.transpose?this.table.theme.rowHeaderStyle.frameStyle:this.table.theme.bodyStyle.frameStyle,this.rowHeaderGroup.role,o?[!0,!1,!0,!0]:void 0),Io(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle,this.colHeaderGroup.role,o?[!0,!0,!0,!1]:void 0),Io(this.cornerHeaderGroup,this.isPivot?this.table.theme.cornerHeaderStyle.frameStyle:this.table.theme.headerStyle.frameStyle,this.cornerHeaderGroup.role,o?[!0,!1,!0,!0]:void 0),!((t=this.table.theme.cornerLeftBottomCellStyle)===null||t===void 0)&&t.frameStyle&&Io(this.leftBottomCornerGroup,this.table.theme.cornerLeftBottomCellStyle.frameStyle,this.leftBottomCornerGroup.role,o?[!0,!1,!0,!0]:void 0),!((e=this.table.theme.bottomFrozenStyle)===null||e===void 0)&&e.frameStyle&&Io(this.bottomFrozenGroup,this.table.theme.bottomFrozenStyle.frameStyle,this.bottomFrozenGroup.role,o?[!0,!0,!0,!1]:void 0),!((i=this.table.theme.rightFrozenStyle)===null||i===void 0)&&i.frameStyle&&Io(this.rightFrozenGroup,this.table.theme.rightFrozenStyle.frameStyle,this.rightFrozenGroup.role,void 0),!((r=this.table.theme.cornerRightTopCellStyle)===null||r===void 0)&&r.frameStyle&&Io(this.rightTopCornerGroup,this.table.theme.cornerRightTopCellStyle.frameStyle,this.rightTopCornerGroup.role,void 0),!((s=this.table.theme.cornerRightBottomCellStyle)===null||s===void 0)&&s.frameStyle&&Io(this.rightBottomCornerGroup,this.table.theme.cornerRightBottomCellStyle.frameStyle,this.rightBottomCornerGroup.role,void 0),Io(this.tableGroup,this.table.theme.frameStyle,this.tableGroup.role,void 0)}getResizeColAt(t,e,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;let s;if(!i){const o=this.table.getDrawRange();return e>=o.top&&e<=o.bottom&&(s=this.table.getCellAtRelativePosition(t-r,e),s.col===this.table.colCount-1)?s:{col:-1,row:-1}}return i.stage?(t<i.globalAABBBounds.x1+r?s={col:i.col-1,row:i.row,x:i.globalAABBBounds.x1}:i.globalAABBBounds.x2-r<t&&(s={col:i.col,row:i.row,x:i.globalAABBBounds.x2}),s&&this.table.rightFrozenColCount>0&&s.col>=this.table.colCount-this.table.rightFrozenColCount-1&&this.table.tableNoFrameWidth-this.table.getFrozenColsWidth()-this.table.getRightFrozenColsWidth()+this.table.scrollLeft<this.bodyGroup.attribute.width&&(s.col=s.col+1,s.rightFrozen=!0),s||{col:-1,row:-1}):{col:-1,row:-1}}getResizeRowAt(t,e,i){const r=this.table.theme.columnResize.resizeHotSpotSize/2;if(i){let s;if(e<i.globalAABBBounds.y1+r?s={col:i.col,row:i.row-1,y:i.globalAABBBounds.y1}:i.globalAABBBounds.y2-r<e&&(s={col:i.col,row:i.row,y:i.globalAABBBounds.y2}),s&&this.table.bottomFrozenRowCount>0&&s.row>=this.table.rowCount-this.table.bottomFrozenRowCount-1&&this.table.tableNoFrameHeight-this.table.getFrozenRowsHeight()-this.table.getBottomFrozenRowsHeight()+this.table.scrollTop<this.bodyGroup.attribute.height&&(s.row=s.row+1,s.bottomFrozen=!0),s)return s}return{col:-1,row:-1}}updateFrozen(){this.clear||(this.resetFrozen(),this.component.updateScrollBar())}updateRowFrozen(){this.clear||(this.resetRowFrozen(),this.component.updateScrollBar())}dealWidthRightFrozen(t){this.clear?this.table.internalProps.rightFrozenColCount=t:nSt(t,this)}dealWidthBottomFrozen(t){this.clear?this.table.internalProps.bottomFrozenRowCount=t:rSt(t,this)}updateBorderSizeAndPosition(){this.bodyGroup.border&&(this.bodyGroup.appendChild(this.bodyGroup.border),ml(this.bodyGroup),this.rowHeaderGroup.attribute.width,xN(this.bodyGroup,this.table.theme.bodyStyle.frameStyle)),this.colHeaderGroup.border&&(this.colHeaderGroup.appendChild(this.colHeaderGroup.border),ml(this.colHeaderGroup),this.cornerHeaderGroup.attribute.width,xN(this.colHeaderGroup,this.table.theme.headerStyle.frameStyle)),this.rowHeaderGroup.border&&(this.rowHeaderGroup.appendChild(this.rowHeaderGroup.border),ml(this.rowHeaderGroup)),this.cornerHeaderGroup.border&&(this.cornerHeaderGroup.appendChild(this.cornerHeaderGroup.border),ml(this.cornerHeaderGroup)),this.leftBottomCornerGroup.border&&(this.leftBottomCornerGroup.appendChild(this.leftBottomCornerGroup.border),ml(this.leftBottomCornerGroup)),this.bottomFrozenGroup.border&&(this.bottomFrozenGroup.appendChild(this.bottomFrozenGroup.border),ml(this.bottomFrozenGroup)),this.rightFrozenGroup.border&&(this.rightFrozenGroup.appendChild(this.rightFrozenGroup.border),ml(this.rightFrozenGroup)),this.rightTopCornerGroup.border&&(this.rightTopCornerGroup.appendChild(this.rightTopCornerGroup.border),ml(this.rightTopCornerGroup)),this.rightBottomCornerGroup.border&&(this.rightBottomCornerGroup.appendChild(this.rightBottomCornerGroup.border),ml(this.rightBottomCornerGroup)),eCt(this.table)}sortCell(){this.isPivot||(this.table.transpose?this.proxy.sortCellHorizontal():this.proxy.sortCellVertical())}getCellOverflowText(t,e){const i=this.getCell(t,e).getChildByName("text",!0);if(i&&i.type==="text"){if(i.attribute.moreThanMaxCharacters)return this.table.getCellValue(t,e);if(i.cliped)return this.table.getCellValue(t,e)}else if(i&&i.type==="richtext"){const r=i;if(r.attribute.ellipsis&&r._frameCache&&r.attribute.height<r._frameCache.actualHeight)return r.attribute.textConfig.find(s=>s.text),this.table.getCellValue(t,e)}return null}updateDrill(t,e,i,r,s){this.component.drillIcon.update(t,e,i,r,s,this)}updateCellContent(t,e,i=!1){if(!this.clear)return go(t,e,this.table,void 0,void 0,i)}setPixelRatio(t){this.stage.disableDirtyBounds(),this.stage.window.setDpr(t),this.stage.render(),this.stage.enableDirtyBounds()}updateRow(t,e,i=[],r=!0,s){this.table.internalProps.layoutMap.clearCellRangeMap(),this.table.internalProps.useOneRowHeightFillAll=!1;const o=mv(e.map(h=>h.row)).sort((h,d)=>h-d),a=mv(i.map(h=>h.row)).sort((h,d)=>h-d),l=this.table.getAllRowsHeight()-[...o,...a].reduce((h,d)=>h+this.table.getRowHeight(d),0)<=this.table.tableNoFrameHeight;if(YCt(t,e,i,this.table,s),r&&this.recalculateColWidths(),this.table.heightMode==="adaptive"||this.table.autoFillHeight&&(this.table.getAllRowsHeight()<=this.table.tableNoFrameHeight||l))this.table.scenegraph.recalculateRowHeights();else if(this.table.isAutoRowHeight(this.table.columnHeaderLevelCount))for(let h=0;h<a.length;h++){const d=a[h],u=this.table.getRowHeight(d),c=no(d,0,this.table.colCount-1,this.table);(d>=this.proxy.rowStart&&d<=this.proxy.rowEnd||d>=this.table.rowCount-this.table.bottomFrozenRowCount&&d<=this.table.rowCount-1)&&this.table.scenegraph.updateRowHeight(d,c-u)}this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCol(t,e,i=[]){BSt(t,e,i,this.table),this.recalculateColWidths(),this.recalculateRowHeights(),this.table.stateManager.checkFrozen(),this.isPivot||this.table.transpose?this.table.options.frozenColCount?this.component.setFrozenColumnShadow(this.table.frozenColCount-1):this.table.options.rightFrozenColCount&&this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount):(this.component.setFrozenColumnShadow(this.table.frozenColCount-1),this.component.setRightFrozenColumnShadow(this.table.colCount-this.table.rightFrozenColCount)),this.component.updateScrollBar(),this.updateNextFrame()}updateCornerHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=0;e<this.table.frozenRowCount;e++)go(t,e,this.table,!1)}updateRowHeaderCells(){for(let t=0;t<this.table.frozenColCount;t++)for(let e=this.table.frozenRowCount;e<this.table.rowCount;e++)go(t,e,this.table,!1)}updateColumnHeaderCells(){for(let t=0;t<this.table.frozenRowCount;t++)for(let e=this.table.frozenColCount;e<this.table.colCount;e++)go(e,t,this.table,!1)}getColumnGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupY(t){return t<this.table.frozenRowCount?this.table.getRowsHeight(0,t-1):t<this.table.rowCount-this.table.bottomFrozenRowCount?this.table.getRowsHeight(this.table.frozenRowCount,t-1):t<this.table.rowCount?this.table.getRowsHeight(this.table.rowCount-this.table.bottomFrozenRowCount,t-1):0}getCellGroupX(t){return t<this.table.rowHeaderLevelCount?this.table.getColsWidth(0,t-1):t<this.table.colCount-this.table.rightFrozenColCount?this.table.getColsWidth(this.table.rowHeaderLevelCount,t-1):t<this.table.colCount?this.table.getColsWidth(this.table.colCount-this.table.rightFrozenColCount,t-1):0}updateDomContainer(){tSt(this.table)}setLoadingHierarchyState(t,e){const i=this.getCell(t,e),r=i.getChildByName("collapse",!0)||i.getChildByName("expand",!0);if(r){const s=ra()[Er.loadingIconName];s&&co(s,r,t,e)}}temporarilyUpdateSelectRectStyle(t){OSt(t,this)}resetSelectRectStyle(){this.recreateAllSelectRangeComponents()}}function FSt(n,t,e){for(let i=0;i<e.length;i++){const r=e[i];if(So(r,n,t))return!0}return!1}function HSt(n,t,e,i){for(let r=0;r<e.length;r++){const s=e[r];if(o0t(s,{start:n,end:t}))return!0}return!1}function zf(n,t,e){const i=n.highPerformanceGetCell(t,e);if(i.role==="cell"&&L(i.mergeStartCol)&&L(i.mergeStartRow)&&L(i.mergeEndCol)&&L(i.mergeEndRow)){const{colStart:r,colEnd:s,rowStart:o,rowEnd:a}=Gd(i,n);for(let l=r;l<=s;l++)for(let h=o;h<=a;h++){const d=n.highPerformanceGetCell(l,h);d.role==="cell"&&d.addUpdateBoundTag()}}else i.addUpdateBoundTag()}function YN(n,t,e,i,r){const s=n.table;for(let a=0;a<s.columnHeaderLevelCount;a++)zf(n,t,a);const o=n.getColGroup(t);return o==null||o.addUpdateBoundTag(),!0}function XN(n,t,e,i,r,s){const o=n.table;for(let l=0;l<o.columnHeaderLevelCount;l++)zf(n,t,l);const a=n.getColGroup(t);return a==null||a.addUpdateBoundTag(),!0}function KN(n,t,e,i,r){const s=n.table;for(let o=0;o<s.colCount;o++)zf(n,o,e);return!0}function qN(n,t,e,i,r,s){const o=n.table;for(let a=0;a<o.colCount;a++)zf(n,a,e);return!0}function zSt(n,t,e,i,r){return zf(n,t,e),!0}function WSt(n,t,e,i,r){return zf(n,t,e),!0}function jSt(n,t,e){var i;const{table:r}=n,{scenegraph:s}=r,{highlightScope:o,singleStyle:a,disableHeader:l,cellPos:h,cellPosContainHeader:d}=n.hover,u=h.col,c=h.row;if(o===qe.none||l&&(d.col!==t||d.row!==e)){const m=d.col,v=d.row;s.hideHoverIcon(m,v),s.showHoverIcon(t,e),d.col=t,d.row=e}if((l&&r.isHeader(t,e)||o===qe.none)&&(t=-1,e=-1),u===t&&c===e)return;!((i=n.table.options.customConfig)===null||i===void 0)&&i.disableBuildInChartActive||(s.deactivateChart(u,c),s.activateChart(t,e));let g=!1;const{ranges:p,highlightScope:f}=n.select;if(u!==-1&&c!==-1&&(g=NSt(s,u,c,p,a,o),l||s.hideHoverIcon(u,c)),t===-1||e===-1)return h.col=-1,h.row=-1,void(!g||u===t&&c===e||n.table.scenegraph.updateNextFrame());o===qe.single?g=!!WSt(s,t,e):o===qe.row?g=!!qN(s,t,e):o===qe.column?g=!!XN(s,t):o===qe.cross&&(g=!!qN(s,t,e),g=!!XN(s,t)),o===qe.none||l||s.showHoverIcon(t,e),h.col=t,h.row=e,g&&n.table.scenegraph.updateNextFrame()}function NSt(n,t,e,i,r,s,o){let a=!1;return s===qe.single?a=!!zSt(n,t,e):s===qe.row?a=!!KN(n,t,e):s===qe.column?a=!!YN(n,t):s===qe.cross&&(a=!!KN(n,t,e),a=!!YN(n,t)),a}function $St(n,t,e){e.frozenColCount>0?n!==e.frozenColCount-1?e.setFrozenColCount(n+1):e.setFrozenColCount(0):e.setFrozenColCount(n+1)}function VSt(n,t,e,i){var r;let s,o=null,a=!1;if(Array.isArray(e.sortState))for(let c=0;c<e.sortState.length&&(s=e.sortState[c],s&&(o=e._getHeaderCellBySortState(s)),o&&(a=ZN(n,t,o.col,o.row,e)),!a);c++);else s=e.sortState,s&&(o=e._getHeaderCellBySortState(s)),o&&(a=ZN(n,t,o.col,o.row,e));const l=e.getHeaderDefine(n,t);if(s&&a&&(l!=null&&l.sort)?s.order=s.order==="asc"?"desc":s.order==="desc"?"normal":"asc":l!=null&&l.sort?s={field:e.getHeaderField(n,t),order:"asc"}:a&&(l!=null&&l.showSort)||(s={field:e.getHeaderField(n,t),order:"normal"}),s.event=i,e.fireListeners(mt.SORT_CLICK,s).includes(!1))return;let h=!1,d=e.internalProps.sortState?Array.isArray(e.internalProps.sortState)&&(h=!0)?e.internalProps.sortState:[e.internalProps.sortState]:[];if(Array.isArray(d)){const c=d.findIndex(g=>g.field===s.field);c>=0?d[c]=s:d.push(s)}d=d.filter(c=>c.order!=="normal"),d=e.internalProps.multipleSort&&(h=!0)?d:d.splice(-1),d=h&&d.length?d:d[0],e.internalProps.sortState=d,e.stateManager.setSortState(d),l!=null&&l.sort&&GSt(d,e),e.internalProps.useOneRowHeightFillAll=!1,e.internalProps.layoutMap.clearCellRangeMap(),e.scenegraph.sortCell();const u=!!(!((r=e.stateManager.select.ranges)===null||r===void 0)&&r.length);e.stateManager.updateSelectPos(-1,-1),e.stateManager.endSelectCells(!0,u)}function GSt(n,t,e){n=Array.isArray(n)||!n?n:[n],t.dataSource.sort((n||[]).map(i=>{var r,s;const o=t.internalProps.layoutMap.headerObjects.find(a=>a&&a.field===i.field);return{field:i.field,order:i.order||"asc",orderFn:typeof((r=o==null?void 0:o.define)===null||r===void 0?void 0:r.sort)=="function"?(s=o==null?void 0:o.define)===null||s===void 0?void 0:s.sort:gx}}))}function ZN(n,t,e,i,r){return r._getLayoutCellId(n,t)===r._getLayoutCellId(e,i)}function USt(n,t,e,i,r,s,o=!0,a=!1){var l,h;const{table:d,interactionState:u}=n,{scenegraph:c}=d,{highlightScope:g,disableHeader:p,cellPos:f,disableCtrlMultiSelect:m}=n.select;if(t!==-1&&e!==-1&&o&&d._makeVisibleCell(t,e),t!==-1&&e!==-1&&o)if(u===oe.grabing&&n.select.ranges.length>0){const v=n.select.ranges[n.select.ranges.length-1];t>v.start.col&&t>v.end.col&&d._makeVisibleCell(t+1,e),e>v.start.row&&e>v.end.row&&d._makeVisibleCell(t,e+1),t<v.start.col&&t<v.end.col&&d._makeVisibleCell(t-1,e),e<v.start.row&&e<v.end.row&&d._makeVisibleCell(t,e-1)}else d._makeVisibleCell(t,e);if(s){n.select.ranges=[],c.deleteAllSelectBorder();let v=0,_=0;const{disableHeaderSelect:b,disableRowSeriesNumberSelect:y}=((l=d.options.keyboardOptions)===null||l===void 0?void 0:l.selectAllOnCtrlA)||{};b&&(v=d.rowHeaderLevelCount,_=d.columnHeaderLevelCount),(y||b&&d.transpose)&&d.options.rowSeriesNumber&&(v+=1),n.select.ranges.push({start:{col:v,row:_},end:{col:d.colCount-1,row:d.rowCount-1}});const C=n.select.ranges[n.select.ranges.length-1];c.updateCellSelectBorder(C,!1)}else if(f.col===-1||f.row===-1||t!==-1&&e!==-1)if(u!==oe.default||d.eventManager.isDraging||d.stateManager.isResizeCol()){if((u===oe.grabing||d.eventManager.isDraging)&&!d.stateManager.isResizeCol()){let v=!0;f.col===-1&&(f.col=t),f.row===-1&&(f.row=e),f.col=t,f.row=e;const _=n.select.ranges[n.select.ranges.length-1];if(_){if(d.internalProps.layoutMap.isSeriesNumberInBody(_.start.col,_.start.row))v=!1,_.end={col:d.colCount-1,row:e};else if(n.fillHandle.isFilling){if(n.fillHandle.direction==="top")if(e===n.fillHandle.beforeFillMinRow&&e===n.fillHandle.beforeFillMaxRow)_.start.row=_.end.row=e;else if(e<=n.fillHandle.beforeFillMinRow){if(_.start.row<_.end.row){const b=_.start.row;_.start.row=_.end.row,_.end.row=b}_.end.row=e}else e===n.fillHandle.beforeFillMaxRow&&(_.start.row>_.end.row?_.start.row=e:_.end.row=e);else if(n.fillHandle.direction==="bottom"){if(e>=n.fillHandle.beforeFillMaxRow){if(_.start.row>_.end.row){const b=_.start.row;_.start.row=_.end.row,_.end.row=b}_.end.row=e}}else if(n.fillHandle.direction==="left")if(t===n.fillHandle.beforeFillMinCol&&t===n.fillHandle.beforeFillMaxCol)_.start.col=_.end.col=t;else if(t<=n.fillHandle.beforeFillMinCol){if(_.start.col<_.end.col){const b=_.start.col;_.start.col=_.end.col,_.end.col=b}_.end.col=t}else t===n.fillHandle.beforeFillMaxCol&&(_.start.col>_.end.col?_.start.col=t:_.end.col=t);else if(n.fillHandle.direction==="right"&&t>=n.fillHandle.beforeFillMaxCol){if(_.start.col>_.end.col){const b=_.start.col;_.start.col=_.end.col,_.end.col=b}_.end.col=t}}else{_.end={col:t,row:e};const b=a?{start:{col:t,row:e},end:{col:t,row:e}}:d.getCellRange(t,e);_.start.col<b.end.col?_.end.col=b.end.col:_.start.col>b.start.col&&(_.end.col=b.start.col),_.start.row<b.end.row?_.end.row=b.end.row:_.start.row>b.start.row&&(_.end.row=b.start.row),n.select.headerSelectMode==="body"&&(d.isRowHeader(t,e)?(_.start.col=d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,_.end.col=d.colCount-1):d.isColumnHeader(t,e)?(_.start.row=d.columnHeaderLevelCount,_.end.row=d.rowCount-1):d.internalProps.layoutMap.isSeriesNumberInBody(t,e)?(_.start.col=d.leftRowSeriesNumberCount,_.end.col=d.colCount-1):d.isCornerHeader(t,e)?(_.start.col=d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,_.start.row=d.columnHeaderLevelCount,_.end.col=d.colCount-1,_.end.row=d.rowCount-1):d.isSeriesNumber(t,e)&&(_.start.col=d.leftRowSeriesNumberCount,_.start.row=d.columnHeaderLevelCount,_.end.col=d.colCount-1,_.end.row=d.rowCount-1)),a&&(_.skipBodyMerge=!0)}_&&_.start.row<=d.rowCount-1&&_.end.row<=d.rowCount-1&&_.start.col<=d.colCount-1&&_.end.col<=d.colCount-1&&c.updateCellSelectBorder(_,v)}}}else{const v=n.select.ranges[n.select.ranges.length-1];if(i&&v){if(r&&!m||(f.col=t,f.row=e),n.select.headerSelectMode!=="cell"&&d.isColumnHeader(t,e)){const _=Math.min(v.start.col,v.end.col,t),b=Math.max(v.start.col,v.end.col,t),y=Math.min(v.start.row,v.end.row,e),C=d.rowCount-1;n.select.headerSelectMode==="body"?(v.start={col:_,row:d.columnHeaderLevelCount},v.end={col:b,row:d.rowCount-1}):(v.start={col:_,row:y},v.end={col:b,row:C})}else if(n.select.headerSelectMode!=="cell"&&d.isRowHeader(t,e)){const _=Math.min(v.start.col,v.end.col,t),b=d.colCount-1,y=Math.min(v.start.row,v.end.row,e),C=Math.max(v.start.row,v.end.row,e);n.select.headerSelectMode==="body"?(v.start={col:d.leftRowSeriesNumberCount+d.rowHeaderLevelCount,row:y},v.end={col:d.colCount-1,row:C}):(v.start={col:_,row:y},v.end={col:b,row:C})}else if(n.select.headerSelectMode!=="cell"&&d.isSeriesNumberInBody(t,e)){const _=Math.min(v.start.col,v.end.col,t),b=d.colCount-1,y=Math.min(v.start.row,v.end.row,e),C=Math.max(v.start.row,v.end.row,e);n.select.headerSelectMode==="body"?(v.start={col:d.leftRowSeriesNumberCount,row:y},v.end={col:d.colCount-1,row:C}):(v.start={col:_,row:y},v.end={col:b,row:C})}else v.end={col:t,row:e};c.deleteLastSelectedRangeComponents(),c.updateCellSelectBorder(v)}else{let _=!0;if(f.col===-1||f.row===-1||r&&!m||(n.select.ranges=[],c.deleteAllSelectBorder()),n.select.headerSelectMode!=="cell"&&d.isColumnHeader(t,e)){const y=d.getCellRange(t,e);n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:y.start.col,row:d.columnHeaderLevelCount},end:{col:y.end.col,row:d.rowCount-1},skipBodyMerge:!0}):n.select.ranges.push({start:{col:y.start.col,row:y.start.row},end:{col:y.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else if(n.select.headerSelectMode!=="cell"&&d.isRowHeader(t,e)){const y=d.getCellRange(t,e);n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,row:y.start.row},end:{col:d.colCount-1,row:y.end.row},skipBodyMerge:!0}):n.select.ranges.push({start:{col:y.start.col,row:y.start.row},end:{col:d.colCount-1,row:y.end.row},skipBodyMerge:!0})}else if(d.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){_=!1;const{cornerHeaderSelectMode:y}=n.select;if(y==="body")n.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:d.columnHeaderLevelCount},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0});else if(y==="inline"){const C=a?{start:{col:t,row:e},end:{col:t}}:d.getCellRange(t,e);n.select.ranges.push({start:{col:C.start.col,row:C.start.row},end:{col:C.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else if(y==="cell"){const C=a?{start:{col:t,row:e},end:{col:t,row:e}}:d.getCellRange(t,e);n.select.ranges.push({start:{col:C.start.col,row:C.start.row},end:{col:C.end.col,row:C.end.row},skipBodyMerge:a||void 0})}else n.select.ranges.push({start:{col:0,row:0},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0})}else if(d.internalProps.layoutMap.isSeriesNumberInBody(t,e))_=!1,n.select.headerSelectMode==="body"?n.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:e},end:{col:d.colCount-1,row:e},skipBodyMerge:!0}):n.select.ranges.push({start:{col:t,row:e},end:{col:d.colCount-1,row:e},skipBodyMerge:!0});else if(d.internalProps.layoutMap.isCornerHeader(t,e)){_=!1;const{cornerHeaderSelectMode:y}=n.select;if(y==="body")n.select.ranges.push({start:{col:d.rowHeaderLevelCount+d.leftRowSeriesNumberCount,row:d.columnHeaderLevelCount},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0});else if(y==="cell"){const C=a?{start:{col:t,row:e},end:{col:t,row:e}}:d.getCellRange(t,e);n.select.ranges.push({start:{col:C.start.col,row:C.start.row},end:{col:C.end.col,row:C.end.row},skipBodyMerge:a||void 0})}else if(y==="inline"){const C=a?{start:{col:t,row:e},end:{col:t}}:d.getCellRange(t,e);n.select.ranges.push({start:{col:C.start.col,row:C.start.row},end:{col:C.end.col,row:d.rowCount-1},skipBodyMerge:!0})}else n.select.ranges.push({start:{col:d.leftRowSeriesNumberCount,row:0},end:{col:d.colCount-1,row:d.rowCount-1},skipBodyMerge:!0})}else if(t>=0&&e>=0){const y=a?{start:{col:t,row:e},end:{col:t,row:e}}:d.getCellRange(t,e);n.select.ranges.push({start:{col:y.start.col,row:y.start.row},end:{col:y.end.col,row:y.end.row},skipBodyMerge:a||void 0})}f.col=t,f.row=e;const b=(h=n.select.ranges)===null||h===void 0?void 0:h[n.select.ranges.length-1];b&&b.start.row<=d.rowCount-1&&b.end.row<=d.rowCount-1&&b.start.col<=d.colCount-1&&b.end.col<=d.colCount-1&&c.updateCellSelectBorder(b,_)}}else f.col=-1,f.row=-1,n.select.ranges=[],c.deleteAllSelectBorder();c.updateNextFrame()}function YSt(n){n.moveSelectingRangeComponentsToSelectedRangeComponents()}const jm=rb(mt,{PIVOT_SORT_CLICK:"pivot_sort_click",DRILLMENU_CLICK:"drillmenu_click"});rb(mt,{VCHART_EVENT_TYPE:"vchart_event_type"});function XSt(n,t,e,i,r){const s=r.getCellLocation(n,t);let o=0,a=0,l=!1;s==="columnHeader"?(o=r.getColsWidth(0,r.rowHeaderLevelCount-1)-(r.frozenColCount===0?r.scrollLeft:0),a=r.getRowsHeight(0,t-1)+r.getRowHeight(t)/2,l=!0):s==="rowHeader"&&(a=r.getRowsHeight(0,r.columnHeaderLevelCount-1),o=r.getColsWidth(0,n-1)+r.getColWidth(n)/2,l=!0),r.scenegraph.updateDrill(l,o,a,e,i)}function KSt(n,t,e){const i=e.scenegraph.getCell(n,t).getChildByName("sparkline"),r=i==null?void 0:i.getChildByName("highlight-line"),s=i==null?void 0:i.getChildByName("highlight-symbol");r&&r.setAttributes({visible:!1,pickable:!1}),s&&s.setAttributes({visible:!1,pickable:!1}),e.scenegraph.updateNextFrame()}function qSt(n,t,e,i,r){var s,o;const a=r.scenegraph.getCell(n,t).getChildByName("sparkline"),l=a==null?void 0:a.getChildByName("sparkline-line"),h=a==null?void 0:a.getChildByName("sparkline-symbol-group");if(!l)return!1;const d=l.bandwidth,u=l.min,c=l.max,g=l.attribute.points;let p;e-=a.globalAABBBounds.x1,a.globalAABBBounds.y1;for(let f=0;f<g.length;f++){const{x:m,y:v,defined:_,rawData:b}=g[f];if(Math.abs(e-m)<d/2&&(p={point:g[f],points:g,pointsBandWidth:d,pointData:b},_)){const y=a.getChildByName("highlight-line");if(y)y.setAttributes({points:[{x:m,y:c},{x:m,y:u}],visible:!0,pickable:!0});else{const S=Os({points:[{x:m,y:c},{x:m,y:u}],lineWidth:(s=l.hover)===null||s===void 0?void 0:s.strokeWidth,stroke:(o=l.hover)===null||o===void 0?void 0:o.stroke});S.name="highlight-line",a.addChild(S)}const C=a.getChildByName("highlight-symbol");if(C)C.setAttributes({x:m,y:v,visible:!0,pickable:!0});else{const S=Zp({x:m,y:v,stroke:h.hover.stroke,lineWidth:h.hover.strokeWidth,fill:h.hover.fill,size:2*h.hover.size,symbolType:"circle"});S.name="highlight-symbol",a.addChild(S)}break}}if(r.scenegraph.updateNextFrame(),p){const f={col:n,row:t,field:r.getHeaderField(n,t),value:r.getCellValue(n,t),dataValue:r.getCellOriginValue(n,t),cellHeaderPaths:r.internalProps.layoutMap.getCellHeaderPaths(n,t),title:r.getBodyColumnDefine(n,t).title,cellRange:r.getCellRelativeRect(n,t),sparkline:{pointData:p.pointData},scaleRatio:r.canvas.getBoundingClientRect().width/r.canvas.offsetWidth};r.fireListeners(mt.MOUSEOVER_CHART_SYMBOL,f)}return!0}function ZSt(n,t,e){const i=e.getCellRange(n.col,n.row);if(e.isColumnHeader(n.col,n.row)){const r=e.getCellRange(t.col,i.start.row);t.row>=e.columnHeaderLevelCount&&(t.row=e.columnHeaderLevelCount-1),t.col>=n.col?t.col=r.end.col:t.col=r.start.col}else if(e.isRowHeader(n.col,n.row)){const r=e.internalProps.layoutMap,s=e.getCellRange(i.start.col,t.row);if(t.col>=e.rowHeaderLevelCount+r.leftRowSeriesNumberColumnCount&&(t.col=e.rowHeaderLevelCount+r.leftRowSeriesNumberColumnCount-1),r.rowHierarchyType==="tree"){const o=r.getCellHeaderPathsWithTreeNode(n.col,n.row).rowHeaderPaths,a=r.getCellHeaderPathsWithTreeNode(t.col,t.row).rowHeaderPaths;if(o.length<=a.length){const l=a[o.length-1];l&&(t.row>=n.row?t.row=l.startInTotal+l.size-1+e.columnHeaderLevelCount:t.row=l.startInTotal+e.columnHeaderLevelCount)}}else t.row>=n.row?t.row=s.end.row:t.row=s.start.row}return t}function JSt(n,t,e,i,r,s){var o;if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;r.columnMove.moving=!0,r.columnMove.colSource=n,r.columnMove.rowSource=t,r.columnMove.x=e-r.table.tableX,r.columnMove.y=i-r.table.tableY;const a=r.table.getCellLocation(n,t),l=a==="columnHeader"?r.columnMove.x:a==="rowHeader"||r.table.internalProps.layoutMap.isSeriesNumberInBody(n,t)?r.columnMove.y:0,{backX:h,lineX:d,backY:u,lineY:c}=r.table.scenegraph.component.showMoveCol(n,t,l);r.table.fireListeners(mt.CHANGE_HEADER_POSITION_START,{col:n,row:t,x:e,y:i,backX:h,lineX:d,backY:u,lineY:c,event:s});const g=!!(!((o=r.select.ranges)===null||o===void 0)&&o.length);r.table.stateManager.updateSelectPos(-1,-1),r.table.stateManager.endSelectCells(!0,g),r.table.scenegraph.updateNextFrame()}function QSt(n,t,e,i,r,s){if(!("canMoveHeaderPosition"in r.table.internalProps.layoutMap))return;const o=ZSt({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:n,row:t},r.table);if(r.table.internalProps.layoutMap.canMoveHeaderPosition({col:r.columnMove.colSource,row:r.columnMove.rowSource},{col:o.col,row:o.row})){let a,l,h,d;r.columnMove.x=e-r.table.tableX,r.columnMove.y=i-r.table.tableY,r.columnMove.colTarget=o.col,r.columnMove.rowTarget=o.row,r.updateCursor("grabbing");const u=r.table.getCellLocation(r.columnMove.colSource,r.columnMove.rowSource);u==="columnHeader"?(l=r.columnMove.x,a=r.table.isLeftFrozenColumn(n)?r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1):r.table.isRightFrozenColumn(n)?r.table.tableNoFrameWidth-r.table.getColsWidth(o.col+1,r.table.colCount-1):(r.columnMove.colTarget>=r.columnMove.colSource?r.table.getColsWidth(0,r.columnMove.colTarget):r.table.getColsWidth(0,r.columnMove.colTarget-1))-r.table.stateManager.scroll.horizontalBarPos):(u==="rowHeader"||r.table.internalProps.layoutMap.isSeriesNumberInBody(n,t))&&(d=r.columnMove.y,h=r.table.isFrozenRow(t)?r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1):r.table.isBottomFrozenRow(t)?r.table.tableNoFrameHeight-r.table.getRowsHeight(o.row+1,r.table.rowCount-1):(r.columnMove.rowTarget>=r.columnMove.rowSource?r.table.getRowsHeight(0,r.columnMove.rowTarget):r.table.getRowsHeight(0,r.columnMove.rowTarget-1))-r.table.stateManager.scroll.verticalBarPos),r.table.scenegraph.component.updateMoveCol(l,a,d,h),r.table.fireListeners(mt.CHANGING_HEADER_POSITION,{col:n,row:t,x:e,y:i,backX:l,lineX:a,backY:d,lineY:h,event:s}),r.table.scenegraph.updateNextFrame()}else r.updateCursor("not-allowed"),r.columnMove.colTarget=r.columnMove.colSource,r.columnMove.rowTarget=r.columnMove.rowSource}function txt(n){var t,e;let i=!1;if("canMoveHeaderPosition"in n.table.internalProps.layoutMap&&n.columnMove.moving&&n.columnMove.colSource>=0&&n.columnMove.rowSource>=0&&n.columnMove.colTarget>=0&&n.columnMove.rowTarget>=0&&((t=n.table.options.customConfig)===null||t===void 0?void 0:t.notUpdateInColumnRowMove)!==!0){const r=n.table.getCellRange(n.columnMove.colSource,n.columnMove.rowSource),s=n.table.getCellRange(n.columnMove.colTarget,n.columnMove.rowTarget),o=n.table._moveHeaderPosition({col:n.columnMove.colSource,row:n.columnMove.rowSource},{col:n.columnMove.colTarget,row:n.columnMove.rowTarget});if(!o||o.targetIndex===o.sourceIndex)return n.updateCursor(),n.columnMove.moving=!1,delete n.columnMove.colSource,delete n.columnMove.rowSource,delete n.columnMove.colTarget,delete n.columnMove.rowTarget,n.table.scenegraph.component.hideMoveCol(),n.table.scenegraph.updateNextFrame(),!1;{n.table.internalProps.useOneRowHeightFillAll=!1,n.table.internalProps.layoutMap.clearCellRangeMap();const a=n.table.getCellRange(n.columnMove.colSource,n.columnMove.rowSource),l=n.table.getCellRange(n.columnMove.colTarget,n.columnMove.rowTarget),h=Math.min(a.start.col,l.start.col,r.start.col,s.start.col),d=Math.max(a.end.col,l.end.col,r.end.col,s.end.col),u=Math.min(a.start.row,l.start.row,r.start.row,s.start.row);let c=Math.max(a.end.row,l.end.row,r.end.row,s.end.row);o.moveType==="row"&&n.table.internalProps.layoutMap.rowHierarchyType==="tree"&&(c=o.targetIndex>o.sourceIndex?c+o.targetSize-1:c+o.sourceSize-1),!n.table.transpose&&n.table.internalProps.layoutMap.isSeriesNumberInBody(n.columnMove.colSource,n.columnMove.rowSource)&&(n.table.changeRecordOrder(o.sourceIndex,o.targetIndex),n.changeCheckboxAndRadioOrder(o.sourceIndex,o.targetIndex)),o.moveType==="column"?JN(h,d,0,-1,n.table):JN(0,-1,u,c,n.table),n.table.clearCellStyleCache(),n.table.internalProps.layoutMap.isSeriesNumberInBody(n.columnMove.colSource,n.columnMove.rowSource)?n.table.scenegraph.updateHeaderPosition(n.table.scenegraph.proxy.colStart,n.table.scenegraph.proxy.colEnd,n.table.scenegraph.proxy.rowStart,n.table.scenegraph.proxy.rowEnd,o.moveType):o.moveType==="column"?n.table.scenegraph.updateHeaderPosition(h,d,0,-1,o.moveType):n.table.scenegraph.updateHeaderPosition(0,-1,u,c,o.moveType),n.table.internalProps.frozenColDragHeaderMode==="adjustFrozenCount"&&n.table.isListTable()&&(n.table.isLeftFrozenColumn(n.columnMove.colTarget)&&!n.table.isLeftFrozenColumn(n.columnMove.colSource)?n.table.frozenColCount+=a.end.col-a.start.col+1:n.table.isLeftFrozenColumn(n.columnMove.colSource)&&!n.table.isLeftFrozenColumn(n.columnMove.colTarget)&&(n.table.frozenColCount-=a.end.col-a.start.col+1),n.table.isRightFrozenColumn(n.columnMove.colTarget)&&!n.table.isRightFrozenColumn(n.columnMove.colSource)?n.table.rightFrozenColCount+=a.end.col-a.start.col+1:n.table.isRightFrozenColumn(n.columnMove.colSource)&&!n.table.isRightFrozenColumn(n.columnMove.colTarget)&&(n.table.rightFrozenColCount-=a.end.col-a.start.col+1)),i=!0}}return n.columnMove.moving=!1,setTimeout(()=>{delete n.columnMove.colSource,delete n.columnMove.rowSource,delete n.columnMove.colTarget,delete n.columnMove.rowTarget},0),n.table.scenegraph.component.hideMoveCol(),n.columnResize.col<n.table.frozenColCount&&!n.table.isPivotTable()&&!n.table.transpose?(n.table.scenegraph.component.setFrozenColumnShadow(n.table.frozenColCount-1,n.columnResize.isRightFrozen),n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount)):n.columnResize.col>=n.table.colCount-n.table.rightFrozenColCount&&!n.table.isPivotTable()&&!n.table.transpose?n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount):n.table.options.frozenColCount?n.table.scenegraph.component.setFrozenColumnShadow(n.table.frozenColCount-1):n.table.options.rightFrozenColCount&&n.table.scenegraph.component.setRightFrozenColumnShadow(n.table.colCount-n.table.rightFrozenColCount),n.table.scenegraph.updateNextFrame(),((e=n.table.options.customConfig)===null||e===void 0?void 0:e.notUpdateInColumnRowMove)===!0||i}function JN(n,t,e,i,r){for(let s=n;s<=t;s++)r._clearColRangeWidthsMap(s);for(let s=e;s<=i;s++)r._clearRowRangeHeightsMap(s)}function wv(n){var t;if(!n)return;const e=!((t=n.role)===null||t===void 0)&&t.startsWith("icon")?n:n.type==="richtext"?n._currentHoverIcon:void 0;return e?n.type==="richtext"?{icon:e,position:{left:n.globalAABBBounds.x1+e.globalAABBBounds.x1,right:n.globalAABBBounds.x1+e.globalAABBBounds.x2,top:n.globalAABBBounds.y1+e.globalAABBBounds.y1,bottom:n.globalAABBBounds.y1+e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"richtext-icon"}:{icon:e,position:{left:e.globalAABBBounds.x1,right:e.globalAABBBounds.x2,top:e.globalAABBBounds.y1,bottom:e.globalAABBBounds.y2,width:e.globalAABBBounds.x2-e.globalAABBBounds.x1,height:e.globalAABBBounds.y2-e.globalAABBBounds.y1},type:"icon"}:void 0}function ext(n,t,e){n=Math.ceil(n),t=Math.ceil(t);let i=e.columnResize.isRightFrozen?e.columnResize.x-n:n-e.columnResize.x;if(Math.abs(i)<1)return;const r=e.table.getColWidth(e.columnResize.col);let s=r;s+=i;const o=e.table.getMinColWidth(e.columnResize.col),a=e.table.getMaxColWidth(e.columnResize.col);if(s<o||s>a){if(r===o||r===a)return;i=r-o>a-r?a-r:o-r}let l=e.table.getColWidth(e.columnResize.col)+i;if(l<e.table.internalProps.limitMinWidth&&(l=e.table.internalProps.limitMinWidth,i=l-e.table.getColWidth(e.columnResize.col)),e.table.widthMode==="adaptive"&&e.columnResize.col<e.table.colCount-1){const h=e.table.getColWidth(e.columnResize.col+1),d=e.table.getMinColWidth(e.columnResize.col+1),u=e.table.getMaxColWidth(e.columnResize.col+1);let c=h;if(c-=i,c<d||c>u){if(h===d||h===u)return;i=h-d>u-h?u-h:d-h}c-i<e.table.internalProps.limitMinWidth&&(i=c-e.table.internalProps.limitMinWidth)}i=Math.ceil(i),e.columnResize.col<e.table.rowHeaderLevelCount||e.columnResize.col>=e.table.colCount-e.table.rightFrozenColCount?QN(i,e):e.table.internalProps.columnResizeType==="indicator"?nxt(i,e):e.table.internalProps.columnResizeType==="indicatorGroup"?rxt(i,e):e.table.internalProps.columnResizeType==="all"?ixt(i,e):QN(i,e),e.columnResize.x=n,e.table.scenegraph.component.updateResizeCol(e.columnResize.col,t,e.columnResize.isRightFrozen),e.columnResize.col<e.table.frozenColCount&&!e.table.isPivotTable()&&!e.table.transpose?e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1,e.columnResize.isRightFrozen):e.table.options.frozenColCount&&e.table.scenegraph.component.setFrozenColumnShadow(e.table.frozenColCount-1),(e.columnResize.col>=e.table.colCount-e.table.rightFrozenColCount&&!e.table.isPivotTable()&&!e.table.transpose||e.table.options.rightFrozenColCount)&&e.table.scenegraph.component.setRightFrozenColumnShadow(e.table.colCount-e.table.rightFrozenColCount),e.table.scenegraph.updateNextFrame()}function QN(n,t){t.table.widthMode==="adaptive"&&t.columnResize.col<t.table.colCount-1?(t.table.scenegraph.updateColWidth(t.columnResize.col,n),t.table.scenegraph.updateColWidth(t.columnResize.col+1,-n),t.table.internalProps._widthResizedColMap.add(t.columnResize.col),t.table.internalProps._widthResizedColMap.add(t.columnResize.col+1)):(t.table.scenegraph.updateColWidth(t.columnResize.col,n),t.table.internalProps._widthResizedColMap.add(t.columnResize.col))}function ixt(n,t){const e=t.table.internalProps.layoutMap;for(let i=t.table.frozenColCount;i<t.table.colCount-t.table.rightFrozenColCount;i++){if(!(t.table.internalProps.transpose||t.table.isPivotTable()&&!e.indicatorsAsCol)){const r=e.getBody(i,t.table.columnHeaderLevelCount);if(r!=null&&r.disableColumnResize)continue}t.table.scenegraph.updateColWidth(i,n),t.table.internalProps._widthResizedColMap.add(i)}}function nxt(n,t){const e=t.table.internalProps.layoutMap;let i,r,s;if(e.indicatorsAsCol)i=e.getIndicatorKey(t.columnResize.col,t.table.columnHeaderLevelCount);else{const o=e.getCellHeaderPaths(t.columnResize.col,t.table.columnHeaderLevelCount-1),a=o.colHeaderPaths[o.colHeaderPaths.length-1];r=a.dimensionKey,s=a.value}for(let o=t.table.rowHeaderLevelCount;o<t.table.colCount-t.table.rightFrozenColCount;o++){const a=e.getIndicatorKey(o,t.table.columnHeaderLevelCount);if(e.indicatorsAsCol&&a===i)t.table.scenegraph.updateColWidth(o,n),t.table.internalProps._widthResizedColMap.add(o);else if(!e.indicatorsAsCol){const l=e.getCellHeaderPaths(o,t.table.columnHeaderLevelCount-1),h=l==null?void 0:l.colHeaderPaths[l.colHeaderPaths.length-1];h&&r===h.dimensionKey&&s===h.value&&(t.table.scenegraph.updateColWidth(o,n),t.table.internalProps._widthResizedColMap.add(o))}}}function rxt(n,t){const e=t.table.internalProps.layoutMap,i=e.getCellHeaderPaths(t.columnResize.col,t.table.columnHeaderLevelCount),r=e.getHeadNodeByRowOrColDimensions(i.colHeaderPaths.slice(0,i.colHeaderPaths.length-1)),s=r.startInTotal+t.table.frozenColCount,o=r.startInTotal+t.table.frozenColCount+r.size-1,a=t.table.getColsWidth(s,o),l=n;for(let h=s;h<=o;h++){if(!(t.table.internalProps.transpose||t.table.isPivotTable()&&!e.indicatorsAsCol)){const u=e.getBody(h,t.table.columnHeaderLevelCount);if(u!=null&&u.disableColumnResize)continue}let d=t.table.getColWidth(h)/a*l;d>0&&d<.5?d=.5:d<0&&d>=-.5&&(d=-.5),t.table.scenegraph.updateColWidth(h,d),t.table.internalProps._widthResizedColMap.add(h)}}function sxt(n,t,e,i,r,s){const o=s.table.getRecordShowIndexByCell(n,t);if(o>=0){const a=s.table.dataSource.getIndexKey(o);i==="column"?J(r)?(s.radioState[e]={},s.radioState[e][a]=r):s.radioState[e]=a:(s.radioState[e]||(s.radioState[e]={}),J(r)?s.radioState[e][a]=r:s.radioState[e][a]=!0)}}function oxt(n,t,e){var i;const r=e.getBodyColumnDefine(n,t),s=r==null?void 0:r.field,o=e.getCellType(n,t);if(L(s)&&o==="radio"){const a=e.dataSource.getIndexKey(e.getRecordShowIndexByCell(n,t)),l=(i=e.stateManager.radioState)===null||i===void 0?void 0:i[s];if(J(l)){if(l===a)return!0}else if(kt(l)){const h=l[a];if(J(h))return h}}return!1}function axt(n,t,e,i,r,s,o){var a,l,h,d,u;const c=o.table.getRecordShowIndexByCell(n,t);if(c>=0){const g=o.table.dataSource.getIndexKey(c);if(i==="column"){if(!L(o.radioState[e])&&s)return J(r)?(o.radioState[e]={},o.radioState[e][g]=r):o.radioState[e]=g,!0;if(J(o.radioState[e])&&!J(r))return o.radioState[e]===g;if(J(o.radioState[e])&&J(r)||kt(o.radioState[e])&&!J(r))return!1;if(kt(o.radioState[e])&&J(r))return o.radioState[e][g]===r}else if(i==="cell"){if(!L(o.radioState[e])&&s)return o.radioState[e]={},J(r)?o.radioState[e][g]=r:o.radioState[e][g]=!0,!0;if(!L((a=o.radioState[e])===null||a===void 0?void 0:a[g])&&s)return J(r)?o.radioState[e][g]=r:o.radioState[e][g]=!0,!0;if(Re((l=o.radioState[e])===null||l===void 0?void 0:l[g])&&!J(r))return o.radioState[e][g];if(Re((h=o.radioState[e])===null||h===void 0?void 0:h[g])&&J(r)||J((d=o.radioState[e])===null||d===void 0?void 0:d[g])&&!J(r))return!1;if(J((u=o.radioState[e])===null||u===void 0?void 0:u[g])&&J(r))return o.radioState[e][g]===r}}return s}function lxt(n,t,e,i){const r=i.scenegraph.getCell(n,t);if(r)if(J(e)){const s=r.getChildAt(e);s==null||s._handlePointerUp()}else{const s=r.getChildByName("radio");s==null||s._handlePointerUp()}}function hxt(n,t,e){const{radioState:i,table:r}=e;if(r.internalProps.transpose?(n=r.getRecordShowIndexByCell(n,0),t=r.getRecordShowIndexByCell(t,0)):(n=r.getRecordShowIndexByCell(0,n),t=r.getRecordShowIndexByCell(0,t)),n>t){const s=i[n];for(let o=n;o>t;o--)i[o]=i[o-1];i[t]=s}else if(n<t){const s=i[n];for(let o=n;o<t;o++)i[o]=i[o+1];i[t]=s}}function dxt(n,t,e,i,r){const s=r.table.getCellRange(n,t);if(s.start.col!==s.end.col||s.start.row!==s.end.row)for(let o=s.start.col;o<=s.end.col;o++)for(let a=s.start.row;a<=s.end.row;a++)t$(o,a,e,i,r);else t$(n,t,e,i,r)}function t$(n,t,e,i,r){const s=r.table.getRecordShowIndexByCell(n,t);if(s>=0){const o=r.table.dataSource.getIndexKey(s).toString();r.checkedState.get(o)?r.checkedState.get(o)[e]=i:r.checkedState.set(o,{[e]:i})}}function uxt(n,t,e){var i;e.headerCheckedState[n]=t,(i=e.checkedState)===null||i===void 0||i.forEach(r=>{r[n]=t})}function cxt(n,t,e,i,r){var s,o;if(r.table.isHeader(n,t)){if(L(r.headerCheckedState[e]))return r.headerCheckedState[e];if(typeof i=="function")return;if(L(i))r.headerCheckedState[e]=i;else if(((s=r.checkedState)===null||s===void 0?void 0:s.size)>0)return r.updateHeaderCheckedState(e,n,t);return r.headerCheckedState[e]}const a=r.table.getRecordShowIndexByCell(n,t);if(a>=0){const l=r.table.dataSource.getIndexKey(a).toString();if(L((o=r.checkedState.get(l))===null||o===void 0?void 0:o[e]))return r.checkedState.get(l)[e];if(r.checkedState.get(l))r.checkedState.get(l)[e]=i;else if(l.includes(",")){const h=l.split(",").slice(0,-1).join(",");r.checkedState.has(h)&&r.checkedState.get(h)[e]===!0?r.checkedState.set(l,{[e]:!0}):r.checkedState.set(l,{[e]:i})}else r.checkedState.set(l,{[e]:i})}return i}function gxt(n,t){t.checkedState.clear(),t.headerCheckedState={},t.radioState={};let e=!1;if(t._checkboxCellTypeFields=[],t._headerCheckFuncs={},t.table.internalProps.layoutMap.headerObjects.forEach((i,r)=>{if(i.headerType==="checkbox"){const s=i.define.checked;s==null||typeof s=="function"?(e=!0,typeof s=="function"&&(t._headerCheckFuncs[i.field]=s)):t.headerCheckedState[i.field]=s,i.define.cellType!=="checkbox"&&!it(i.define.cellType)||i.fieldFormat||t._checkboxCellTypeFields.push(i.field)}}),t.table.leftRowSeriesNumberCount===1)t.headerCheckedState._vtable_rowSeries_number=!1,t._checkboxCellTypeFields.push("_vtable_rowSeries_number"),e=!0;else if(t.table.leftRowSeriesNumberCount>1){for(let i=0;i<t.table.leftRowSeriesNumberCount;i++)t.headerCheckedState[`_vtable_rowSeries_number_${i}`]=!1,t._checkboxCellTypeFields.push(`_vtable_rowSeries_number_${i}`);e=!0}e&&bxt(n,t)}function pxt(n,t,e,i){let r=!0,s=!0,o=!1;return t.checkedState.forEach((a,l)=>{var h,d;l=l.includes(",")?l.split(",").map(p=>Number(p)):Number(l);const u=t.table.getTableIndexByRecordIndex(l),c=t.table.transpose?t.table.getCustomMerge(u,i):t.table.getCustomMerge(e,u),g=(h=t.table.dataSource)===null||h===void 0?void 0:h.get(l);c||!(!((d=t.table.internalProps.rowSeriesNumber)===null||d===void 0)&&d.enableTreeCheckbox)&&(g!=null&&g.vtableMerge)||((a==null?void 0:a[n])!==!0?r=!1:(s=!1,o=!0))}),r?(t.headerCheckedState[n]=!0,r):s?(t.headerCheckedState[n]=!1,!1):!!o&&(t.headerCheckedState[n]="indeterminate","indeterminate")}function fxt(n,t){for(let e=t.checkedState.size;e<n.length;e++){const i=n[e];t._checkboxCellTypeFields.forEach(r=>{const s=i[r];let o;kt(s)?o=s.checked:typeof s=="boolean"&&(o=s);const a=e.toString();t.checkedState.get(a)||t.checkedState.set(a,{}),t.checkedState.get(a)[r]=o})}}function mxt(n,t,e,i){const r=i.scenegraph.getCell(n,t),s=r==null?void 0:r.getChildByName("checkbox");if(!s){const l=i.getHeaderField(n,t);if(i.isHeader(n,t))i.stateManager.setHeaderCheckedState(l,e),i.getCellType(n,t)==="checkbox"&&i.scenegraph.updateCheckboxCellState(n,t,e);else if(i.stateManager.setCheckedState(n,t,l,e),i.getCellType(n,t)==="checkbox"){const h=i.stateManager.headerCheckedState[l],d=i.stateManager.updateHeaderCheckedState(l,n,t);h!==d&&i.scenegraph.updateHeaderCheckboxCellState(n,t,d)}return}const{checked:o,indeterminate:a}=s.attribute;a?(e||s._handlePointerUp(),s._handlePointerUp()):o?e||s._handlePointerUp():e&&s._handlePointerUp()}function wC(n,t,e,i){const r=i.scenegraph.getCell(n,t),s=r==null?void 0:r.getChildByName("checkbox");s&&(e==="indeterminate"?(s.setAttribute("indeterminate",!0),s.setAttribute("checked",void 0)):(s.setAttribute("indeterminate",void 0),s.setAttribute("checked",e)))}function vxt(n,t,e){const{checkedState:i,table:r}=e;let s,o;if(r.internalProps.transpose?(n=r.getRecordShowIndexByCell(n,0),t=r.getRecordShowIndexByCell(t,0)):(s=r.isPivotTable()?void 0:r.getRecordIndexByCell(0,n),o=r.isPivotTable()?void 0:r.getRecordIndexByCell(0,t)),J(s)&&J(o)){if((n=s)>(t=o)){const a=i.get(n.toString());for(let l=n;l>t;l--)i.set(l.toString(),i.get((l-1).toString()));i.set(t.toString(),a)}else if(n<t){const a=i.get(n.toString());for(let l=n;l<t;l++)i.set(l.toString(),i.get((l+1).toString()));i.set(t.toString(),a)}}else if(V(s)&&V(o)){if((n=s[s.length-1])>(t=o[o.length-1])){const a=i.get(s.toString());for(let l=n;l>t;l--){const h=[...s];h[h.length-1]=l;const d=[...s];d[d.length-1]=l-1,i.set(h.toString(),i.get(d.toString()))}i.set(o.toString(),a)}else if(n<t){const a=i.get(s.toString());for(let l=n;l<t;l++){const h=[...s];h[h.length-1]=l;const d=[...s];d[d.length-1]=l+1,i.set(h.toString(),i.get(d.toString()))}i.set(o.toString(),a)}}}function _xt(n){const t=[],e=n.dataSource,i=e.dataConfig.groupByRules.length+1;return e.currentIndexedData.forEach((r,s)=>{if(V(r)&&r.length===i){const o=e.getOriginRecordIndexForGroup(r);t[o]=n.stateManager.checkedState.get(r.toString())}}),t}function bxt(n,t){const e=t.table,i=e.isPivotTable()?0:e.internalProps.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,r=e.isPivotTable()?V(n)?n.length:0:e.internalProps.transpose?e.colCount:e.rowCount;for(let s=0;s+i<r;s++){const o=e.isPivotTable()?n[s]:e.dataSource.get(s);t._checkboxCellTypeFields.forEach(a=>{const l=o&&o[a];let h;if(kt(l)?h=l.checked:typeof l=="boolean"&&(h=l),h==null){const u=t._headerCheckFuncs[a];if(u){const c=t.table.getCellAddrByFieldRecord(a,s);h=ni(u,{col:c.col,row:c.row,table:t.table,context:null,value:l})}}const d=e.isPivotTable()?s.toString():t.table.dataSource.getIndexKey(s).toString();t.checkedState.get(d)||t.checkedState.set(d,{}),t.checkedState.get(d)[a]=h})}}function yxt(n,t,e){n=Math.ceil(n),t=Math.ceil(t);let i=e.rowResize.isBottomFrozen?e.rowResize.y-t:t-e.rowResize.y;if(Math.abs(i)<1)return;e.table.getRowHeight(e.rowResize.row);let r=e.table.getRowHeight(e.rowResize.row)+i;if(r<e.table.internalProps.limitMinHeight&&(r=e.table.internalProps.limitMinHeight,i=r-e.table.getRowHeight(e.rowResize.row)),e.table.heightMode==="adaptive"&&e.rowResize.row<e.table.rowCount-1){let s=e.table.getRowHeight(e.rowResize.row+1);s-=i,s-i<e.table.internalProps.limitMinHeight&&(i=s-e.table.internalProps.limitMinHeight)}i=Math.ceil(i),e.rowResize.row<e.table.columnHeaderLevelCount||e.rowResize.row>=e.table.rowCount-e.table.bottomFrozenRowCount?e$(i,e):e.table.internalProps.rowResizeType==="indicator"?Sxt(i,e):e.table.internalProps.rowResizeType==="indicatorGroup"?xxt(i,e):e.table.internalProps.rowResizeType==="all"?Cxt(i,e):e$(i,e),e.rowResize.y=t,e.table.scenegraph.component.updateResizeRow(e.rowResize.row,n,e.rowResize.isBottomFrozen),e.table.scenegraph.updateNextFrame()}function e$(n,t){t.table.heightMode==="adaptive"&&t.rowResize.row<t.table.rowCount-1?(t.table.scenegraph.updateRowHeight(t.rowResize.row,n),t.table.scenegraph.updateRowHeight(t.rowResize.row+1,-n),t.table.internalProps._heightResizedRowMap.add(t.rowResize.row),t.table.internalProps._heightResizedRowMap.add(t.rowResize.row+1)):(t.table.scenegraph.updateRowHeight(t.rowResize.row,n),t.table.internalProps._heightResizedRowMap.add(t.rowResize.row))}function Cxt(n,t){for(let e=t.table.frozenRowCount;e<t.table.rowCount-t.table.bottomFrozenRowCount;e++)t.table.scenegraph.updateRowHeight(e,n),t.table.internalProps._heightResizedRowMap.add(e)}function Sxt(n,t){var e,i;const r=t.table.internalProps.layoutMap;let s,o,a;if(r.indicatorsAsCol){const l=r.getCellHeaderPaths(t.table.rowHeaderLevelCount-1,t.rowResize.row),h=(e=l.rowHeaderPaths)===null||e===void 0?void 0:e[l.rowHeaderPaths.length-1];o=h==null?void 0:h.dimensionKey,a=h==null?void 0:h.value}else s=r.getIndicatorKey(t.table.rowHeaderLevelCount,t.rowResize.row);for(let l=t.table.columnHeaderLevelCount;l<t.table.rowCount-t.table.bottomFrozenRowCount;l++){const h=r.getIndicatorKey(t.table.rowHeaderLevelCount,l);if(r.indicatorsAsCol||h!==s){if(r.indicatorsAsCol){const d=r.getCellHeaderPaths(t.table.rowHeaderLevelCount-1,l),u=(i=d==null?void 0:d.rowHeaderPaths)===null||i===void 0?void 0:i[d.rowHeaderPaths.length-1];u&&o===u.dimensionKey&&a===u.value&&(t.table.scenegraph.updateRowHeight(l,n),t.table.internalProps._heightResizedRowMap.add(l))}}else t.table.scenegraph.updateRowHeight(l,n),t.table.internalProps._heightResizedRowMap.add(l)}}function xxt(n,t){const e=t.table.internalProps.layoutMap,i=e.getCellHeaderPaths(t.table.rowHeaderLevelCount,t.rowResize.row),r=e.getHeadNodeByRowOrColDimensions(i.rowHeaderPaths.slice(0,i.rowHeaderPaths.length-1)),s=r.startInTotal+t.table.frozenRowCount,o=r.startInTotal+t.table.frozenRowCount+r.size-1,a=t.table.getRowsHeight(s,o),l=n;for(let h=s;h<=o;h++){let d=t.table.getRowHeight(h)/a*l;d>0&&d<.5?d=.5:d<0&&d>=-.5&&(d=-.51),t.table.scenegraph.updateRowHeight(h,d),t.table.internalProps._heightResizedRowMap.add(h)}}function wxt(n){const{customSelectedRangeComponents:t}=n.table.scenegraph;t.forEach((e,i)=>{e.rect.delete()}),t.clear(),n.select.customSelectRanges=[]}function Axt(n,t){const{customSelectedRangeComponents:e}=t.table.scenegraph;n.forEach(i=>{var r,s,o,a;const{range:l,style:h}=i,d=wi({fill:(r=h.cellBgColor)!==null&&r!==void 0&&r,stroke:(s=h.cellBorderColor)!==null&&s!==void 0&&s,lineWidth:(o=h.cellBorderLineWidth)!==null&&o!==void 0?o:0,lineDash:(a=h.cellBorderLineDash)!==null&&a!==void 0?a:[],pickable:!1});e.set(`${l.start.col}-${l.start.row}-${l.end.col}-${l.end.row}`,{rect:d,role:"body"})}),t.select.customSelectRanges=n,Yq(t.table.scenegraph),t.table.scenegraph.updateNextFrame()}let Mxt=class{constructor(t){this.fastScrolling=!1,this.checkedState=new Map,this.headerCheckedState={},this._checkboxCellTypeFields=[],this._headerCheckFuncs={},this.radioState={},this.resetInteractionState=eq(e=>{this.updateInteractionState(e??oe.default)},100),this.table=t,this.initState(),this.updateVerticalScrollBar=this.updateVerticalScrollBar.bind(this),this.updateHorizontalScrollBar=this.updateHorizontalScrollBar.bind(this)}initState(){this._initState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}updateOptionSetState(){this._updateOptionSetState(),this.setHoverState(),this.setSelectState(),this.setFrozenState()}_updateOptionSetState(){this.interactionState=oe.default,this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Bi,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}_initState(){this.interactionState=oe.default,this.select={highlightScope:qe.single,ranges:[],cellPos:{col:-1,row:-1},selecting:!1},this.fillHandle={isFilling:!1,startX:void 0,startY:void 0},this.hover={highlightScope:qe.single,cellPos:{col:-1,row:-1}},this.hoverIcon={col:-1,row:-1,icon:null},this.columnResize={col:-1,x:0,resizing:!1},this.rowResize={row:-1,y:0,resizing:!1},this.columnMove={colSource:-1,colTarget:-1,rowSource:-1,rowTarget:-1,x:0,y:0,moving:!1},this.menu={x:-1,y:-1,isShow:!1,itemList:[],bounds:new Bi,highlightIndex:-1,dropDownMenuHighlight:[]},this.sort=[{col:-1,row:-1,order:"normal"}],this.frozen={col:-1,row:-1},this.scroll={horizontalBarPos:0,verticalBarPos:0},this.tablePosition={absoluteX:0,absoluteY:0},this.drill={col:-1,row:-1},this.sparkLine={col:-1,row:-1}}setHoverState(){var t;const{highlightMode:e,disableHover:i,disableHeaderHover:r}=(t=this.table.options.hover)!==null&&t!==void 0?t:{highlightMode:"cell"};i?this.hover.highlightScope=qe.none:e==="cross"?this.hover.highlightScope=qe.cross:e==="row"?this.hover.highlightScope=qe.row:e==="column"?this.hover.highlightScope=qe.column:e==="cell"&&(this.hover.highlightScope=qe.single),this.hover.singleStyle=!i,this.hover.disableHeader=r,(this.hover.highlightScope===qe.none||r)&&(this.hover.cellPosContainHeader={col:-1,row:-1})}setSelectState(){var t,e,i,r,s;const{headerSelectMode:o,disableSelect:a,disableHeaderSelect:l,highlightMode:h,highlightInRange:d}=Object.assign({},{headerSelectMode:"inline",disableSelect:!1,disableHeaderSelect:!1,highlightMode:"cell",highlightInRange:!1},this.table.options.select),u=!((t=this.table.options.select)===null||t===void 0)&&t.cornerHeaderSelectMode?(e=this.table.options.select)===null||e===void 0?void 0:e.cornerHeaderSelectMode:((i=this.table.options.select)===null||i===void 0?void 0:i.headerSelectMode)==="body"?(r=this.table.options.select)===null||r===void 0?void 0:r.headerSelectMode:"all";this.select.highlightScope=a===!0?qe.none:h==="cross"?qe.cross:h==="row"?qe.row:h==="column"?qe.column:qe.single,this.select.singleStyle=!a,this.select.disableHeader=l,this.select.headerSelectMode=o,this.select.cornerHeaderSelectMode=u,this.select.highlightInRange=d,this.select.disableCtrlMultiSelect=((s=this.table.options.keyboardOptions)===null||s===void 0?void 0:s.ctrlMultiSelect)===!1}isSelected(t,e){let i=!1;return this.select.ranges.forEach(r=>{So(r,t,e)&&(i=!0)}),i}setSortState(t){const e=this,i=(t=!t||Array.isArray(t)?t:[t])&&t.reduce((r,s)=>{var o,a,l;const h=(o=function(d){const u=[];return function c(g,p=0){g.forEach(f=>{var m;const v=f.startInTotal?(m=f.startInTotal+e.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&m!==void 0?m:0:p;f.columns?c(f.columns,v):u.push(Object.assign(Object.assign({},f),{startIndex:v}))})}(d),u}(this.table.internalProps.columns))===null||o===void 0?void 0:o.find(d=>(d==null?void 0:d.field)===(s==null?void 0:s.field));return this.table.internalProps.transpose?r.push({field:s.field,order:s.order,row:(a=(h==null?void 0:h.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&a!==void 0?a:0,col:h==null?void 0:h.level}):r.push({field:s.field,order:s.order,col:(l=(h==null?void 0:h.startInTotal)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&l!==void 0?l:0,row:h==null?void 0:h.level}),r},[]);this.sort=i||[]}setFrozenState(){this.frozen.col=this.table.frozenColCount-1}updateInteractionState(t){if(this.interactionState===t)return;t===oe.scrolling&&(this.interactionStateBeforeScroll=this.interactionState);const e=this.interactionState;this.interactionState=t,e===oe.scrolling&&oe.default}updateHoverhighlightScope(t){this.hover.highlightScope!==t&&(this.hover.highlightScope=t)}updateHoverPos(t,e){jSt(this,t,e)}updateSelectPos(t,e,i=!1,r=!1,s=!1,o=!0,a=!1){e!==-1&&e!==-1&&(this.select.selecting=!0),t<0&&(t=-1),e<0&&(e=-1),t>this.table.colCount-1&&(t=this.table.colCount-1),e>this.table.rowCount-1&&(e=this.table.rowCount-1),USt(this,t,e,i,r,s,o,a)}checkCellRangeInSelect(t,e){return HSt(t,e,this.select.ranges,this.select.highlightScope)}updateHoverIcon(t,e,i,r){var s,o,a,l,h,d,u,c,g;if(!((s=this.residentHoverIcon)===null||s===void 0)&&s.icon&&i===((o=this.residentHoverIcon)===null||o===void 0?void 0:o.icon))return;const p=wv(i);if(p)if(p.type==="richtext-icon"){const f=p.icon;if(this.hoverIcon.icon&&this.hoverIcon.icon!==((l=this.residentHoverIcon)===null||l===void 0?void 0:l.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame()),f.attribute.tooltip){const m={content:f.attribute.tooltip.title,referencePosition:{rect:p.position,placement:f.attribute.tooltip.placement},style:Object.assign({},(h=this.table.internalProps.theme)===null||h===void 0?void 0:h.tooltipStyle,(d=f.tooltip)===null||d===void 0?void 0:d.style,(c=(u=f.attribute)===null||u===void 0?void 0:u.tooltip)===null||c===void 0?void 0:c.style),disappearDelay:f.attribute.tooltip.disappearDelay};this.table.internalProps.tooltipHandler.isBinded(m)||this.table.showTooltip(t,e,m)}}else{const f=p.icon;f!==this.hoverIcon.icon&&(this.hoverIcon.icon&&this.hoverIcon.icon!==((g=this.residentHoverIcon)===null||g===void 0?void 0:g.icon)&&this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=t,this.hoverIcon.row=e,this.hoverIcon.icon=f,this.table.scenegraph.setIconHoverStyle(f,t,e,r),this.table.scenegraph.updateNextFrame())}else this.hoverIcon.icon&&this.hoverIcon.icon!==((a=this.residentHoverIcon)===null||a===void 0?void 0:a.icon)&&(this.table.scenegraph.setIconNormalStyle(this.hoverIcon.icon,this.hoverIcon.col,this.hoverIcon.row),this.hoverIcon.col=-1,this.hoverIcon.col=-1,this.hoverIcon.icon=null,this.table.scenegraph.updateNextFrame())}isResizeCol(){return this.columnResize.resizing}isResizeRow(){return this.rowResize.resizing}isFillHandle(){return this.fillHandle.isFilling}isSelecting(){return this.select.selecting}endSelectCells(t=!0,e=!0){if(this.select.selecting){if(this.select.selecting=!1,this.select.ranges.length===0)return;const i=this.select.ranges[this.select.ranges.length-1];this.table.isSeriesNumber(this.select.cellPos.col,this.select.cellPos.row)||this.table.isHeader(this.select.cellPos.col,this.select.cellPos.row)||Yyt(i,this.table);let r=!1;for(let a=0;a<this.select.ranges.length-1;a++){const l=this.select.ranges[a];if(l&&l.start.col===i.start.col&&l.start.row===i.start.row&&l.end.col===i.end.col&&l.end.row===i.end.row){r=!0;break}}r?(this.select.ranges.pop(),Xq(this.table.scenegraph),this.table.scenegraph.selectingRangeComponents.clear()):YSt(this.table.scenegraph);const s=this.select.ranges[this.select.ranges.length-1].end.col,o=this.select.ranges[this.select.ranges.length-1].end.row;t&&this.table.fireListeners(mt.SELECTED_CELL,{ranges:this.select.ranges,col:s,row:o})}else e&&this.select.ranges.length===0&&this.table.fireListeners(mt.SELECTED_CLEAR,{})}endResizeCol(){setTimeout(()=>{this.columnResize.resizing=!1},0),this.table.scenegraph.updateChartSizeForResizeColWidth(this.columnResize.col),this.checkFrozen(),this.table.scenegraph.component.hideResizeCol(),this.table.scenegraph.updateNextFrame()}startResizeCol(t,e,i,r){this.columnResize.resizing=!0,this.columnResize.col=t,this.columnResize.x=e,this.columnResize.isRightFrozen=r,this.table.scenegraph.component.showResizeCol(t,i,r),this.table.scenegraph.updateNextFrame()}updateResizeCol(t,e){ext(t,e,this)}endResizeRow(){setTimeout(()=>{this.rowResize.resizing=!1},0),this.table.scenegraph.updateChartSizeForResizeRowHeight(this.rowResize.row),this.table.scenegraph.component.hideResizeRow(),this.table.scenegraph.updateNextFrame()}startResizeRow(t,e,i,r){this.rowResize.resizing=!0,this.rowResize.row=t,this.rowResize.y=i,this.rowResize.isBottomFrozen=r,this.table.scenegraph.component.showResizeRow(t,e,r),this.table.scenegraph.updateNextFrame()}updateResizeRow(t,e){yxt(t,e,this)}startFillSelect(t,e){this.fillHandle.isFilling=!0,this.fillHandle.startX=t,this.fillHandle.startY=e;const i=this.select.ranges[this.select.ranges.length-1];this.fillHandle.beforeFillMinCol=Math.min(i.start.col,i.end.col),this.fillHandle.beforeFillMinRow=Math.min(i.start.row,i.end.row),this.fillHandle.beforeFillMaxCol=Math.max(i.start.col,i.end.col),this.fillHandle.beforeFillMaxRow=Math.max(i.start.row,i.end.row),this.table.fireListeners(mt.MOUSEDOWN_FILL_HANDLE,{})}endFillSelect(){this.fillHandle.isFilling=!1,this.fillHandle.startX=void 0,this.fillHandle.startY=void 0,this.fillHandle.directionRow=void 0;const t=Math.min(this.select.ranges[0].start.col,this.select.ranges[0].end.col),e=Math.min(this.select.ranges[0].start.row,this.select.ranges[0].end.row),i=Math.max(this.select.ranges[0].start.col,this.select.ranges[0].end.col),r=Math.max(this.select.ranges[0].start.row,this.select.ranges[0].end.row);this.fillHandle.beforeFillMinCol===t&&this.fillHandle.beforeFillMinRow===e&&this.fillHandle.beforeFillMaxCol===i&&this.fillHandle.beforeFillMaxRow===r||this.table.eventManager.isDraging&&this.table.fireListeners(mt.DRAG_FILL_HANDLE_END,{direction:this.fillHandle.direction}),this.fillHandle.beforeFillMaxCol=void 0,this.fillHandle.beforeFillMaxRow=void 0,this.fillHandle.beforeFillMinCol=void 0,this.fillHandle.beforeFillMinRow=void 0}startMoveCol(t,e,i,r,s){JSt(t,e,i,r,this,s)}updateMoveCol(t,e,i,r,s){QSt(t,e,i,r,this,s)}isMoveCol(){return this.columnMove.moving}endMoveCol(){return txt(this)}checkFrozen(){var t;let e=this.table.options.frozenColCount?this.table.options.frozenColCount:this.table.isPivotTable()||this.table.isListTable()&&this.table.internalProps.transpose?((t=this.table.rowHeaderLevelCount)!==null&&t!==void 0?t:0)+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount:0;if(e){e>this.table.colCount&&(e=this.table.colCount);const i=this.table._getMaxFrozenWidth();if(this.table.getColsWidth(0,e-1)>i)if(this.table.internalProps.unfreezeAllOnExceedsMaxWidth)this.table._setFrozenColCount(0),this.setFrozenCol(-1);else{const r=this.table._getComputedFrozenColCount(e);this.table._setFrozenColCount(r),this.setFrozenCol(r)}else this.table.frozenColCount!==e&&(this.table._setFrozenColCount(e),this.setFrozenCol(e))}}setFrozenCol(t){t!==this.frozen.col?(this.frozen.col=t,this.table.scenegraph.updateFrozen(),this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)):this.table.scenegraph.updateFrozenIcon(0,this.table.colCount-1)}setFrozenRow(t){t!==this.frozen.row&&(this.frozen.row=t,this.table.scenegraph.updateRowFrozen())}checkVerticalScrollBarEnd(){var t,e;const i=this.table.getAllRowsHeight(),r=this.scroll.verticalBarPos,s=this.table.tableNoFrameHeight;r+s>=i&&this.table.fireListeners(mt.SCROLL_VERTICAL_END,{scrollTop:r,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,scrollWidth:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,viewHeight:s,viewWidth:this.table.tableNoFrameWidth})}checkHorizontalScrollBarEnd(){var t,e;const i=this.table.getAllColsWidth(),r=this.scroll.horizontalBarPos,s=this.table.tableNoFrameWidth;r+s>=i&&this.table.fireListeners(mt.SCROLL_HORIZONTAL_END,{scrollTop:this.scroll.verticalBarPos,scrollLeft:r,scrollHeight:(t=this.table.theme.scrollStyle)===null||t===void 0?void 0:t.width,scrollWidth:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:s})}updateVerticalScrollBar(t){var e,i,r,s;const o=this.table.getAllRowsHeight(),a=this.scroll.verticalBarPos;let l=Math.ceil(t*(o-this.table.scenegraph.height));L(l)&&!isNaN(l)||(l=0);const h=l-this.table.scenegraph.proxy.deltaY-a;if(this.table.fireListeners(mt.CAN_SCROLL,{event:void 0,scrollTop:l-this.table.scenegraph.proxy.deltaY,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:h}).some(d=>d===!1)){const d=this.scroll.verticalBarPos/(o-this.table.scenegraph.height);this.table.scenegraph.component.updateVerticalScrollBarPos(d)}else this.scroll.verticalBarPos=l,this.table.scenegraph.setY(-this.scroll.verticalBarPos,t===1),this.scroll.verticalBarPos-=this.table.scenegraph.proxy.deltaY,this.table.scenegraph.proxy.deltaY=0,this.updateHoverPos(-1,-1),this.table.fireListeners(mt.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(r=this.table.theme.scrollStyle)===null||r===void 0?void 0:r.width,scrollWidth:(s=this.table.theme.scrollStyle)===null||s===void 0?void 0:s.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:t,dy:h}),a!==this.scroll.verticalBarPos&&this.checkVerticalScrollBarEnd()}updateHorizontalScrollBar(t){var e,i,r,s;const o=this.table.getAllColsWidth(),a=this.scroll.horizontalBarPos;let l=Math.ceil(t*(o-this.table.scenegraph.width));L(l)&&!isNaN(l)||(l=0);const h=l-this.table.scenegraph.proxy.deltaX-a;if(this.table.fireListeners(mt.CAN_SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:l-this.table.scenegraph.proxy.deltaX,scrollHeight:(e=this.table.theme.scrollStyle)===null||e===void 0?void 0:e.width,scrollWidth:(i=this.table.theme.scrollStyle)===null||i===void 0?void 0:i.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:h}).some(d=>d===!1)){const d=this.scroll.horizontalBarPos/(o-this.table.scenegraph.width);this.table.scenegraph.component.updateHorizontalScrollBarPos(d)}else this.scroll.horizontalBarPos=l,this.table.scenegraph.setX(-this.scroll.horizontalBarPos,t===1),this.scroll.horizontalBarPos-=this.table.scenegraph.proxy.deltaX,this.table.scenegraph.proxy.deltaX=0,this.updateHoverPos(-1,-1),this.table.fireListeners(mt.SCROLL,{event:void 0,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(r=this.table.theme.scrollStyle)===null||r===void 0?void 0:r.width,scrollWidth:(s=this.table.theme.scrollStyle)===null||s===void 0?void 0:s.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:t,dx:h}),a!==this.scroll.horizontalBarPos&&this.checkHorizontalScrollBarEnd()}setScrollTop(t,e,i=!0){var r,s,o,a,l,h,d;const u=this.table.getAllRowsHeight(),c=!((r=this.table.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?1:0;t=Math.max(0,Math.min(t,u-this.table.scenegraph.height-c)),t=Math.ceil(t);const g=this.scroll.verticalBarPos,p=t/(u-this.table.scenegraph.height);if((g!==t||((o=(s=this.table.options)===null||s===void 0?void 0:s.customConfig)===null||o===void 0?void 0:o.scrollEventAlwaysTrigger)===!0)&&i){let m=t;L(m)&&!isNaN(m)||(m=0);const v=m-g;if(this.table.fireListeners(mt.CAN_SCROLL,{event:e==null?void 0:e.nativeEvent,scrollTop:m,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(a=this.table.theme.scrollStyle)===null||a===void 0?void 0:a.width,scrollWidth:(l=this.table.theme.scrollStyle)===null||l===void 0?void 0:l.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:p,dy:v}).some(_=>_===!1)){const _=this.scroll.verticalBarPos/(u-this.table.scenegraph.height);return void this.table.scenegraph.component.updateVerticalScrollBarPos(_)}}(t!==this.scroll.verticalBarPos||this.table.isPivotChart())&&this.updateHoverPos(-1,-1),this.scroll.verticalBarPos=t,L(this.scroll.verticalBarPos)&&!isNaN(this.scroll.verticalBarPos)||(this.scroll.verticalBarPos=0),this.table.scenegraph.setY(-t),this.table.scenegraph.component.updateVerticalScrollBarPos(p);const f=this.scroll.verticalBarPos-g;this.table.fireListeners(mt.SCROLL,{event:e==null?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(h=this.table.theme.scrollStyle)===null||h===void 0?void 0:h.width,scrollWidth:(d=this.table.theme.scrollStyle)===null||d===void 0?void 0:d.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"vertical",scrollRatioY:p,dy:f}),g!==t&&i&&this.checkVerticalScrollBarEnd()}setScrollLeft(t,e,i=!0){var r,s,o,a,l,h,d;this.table.scrollLeft;const u=this.table.getAllColsWidth(),c=(this.table.getFrozenColsWidth(),!((r=this.table.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?1:0);t=Math.max(0,Math.min(t,u-this.table.scenegraph.width-c)),t=Math.ceil(t);const g=this.scroll.horizontalBarPos,p=t/(u-this.table.scenegraph.width);if((g!==t||((o=(s=this.table.options)===null||s===void 0?void 0:s.customConfig)===null||o===void 0?void 0:o.scrollEventAlwaysTrigger)===!0)&&i){let m=t;L(m)&&!isNaN(m)||(m=0);const v=m-g;if(this.table.fireListeners(mt.CAN_SCROLL,{event:e==null?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:m,scrollHeight:(a=this.table.theme.scrollStyle)===null||a===void 0?void 0:a.width,scrollWidth:(l=this.table.theme.scrollStyle)===null||l===void 0?void 0:l.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:p,dx:v}).some(_=>_===!1)){const _=this.scroll.horizontalBarPos/(u-this.table.scenegraph.width);return void this.table.scenegraph.component.updateHorizontalScrollBarPos(_)}}t!==this.scroll.horizontalBarPos&&this.updateHoverPos(-1,-1),this.scroll.horizontalBarPos=t,L(this.scroll.horizontalBarPos)&&!isNaN(this.scroll.horizontalBarPos)||(this.scroll.horizontalBarPos=0),this.table.scenegraph.setX(-t),this.table.scenegraph.component.updateHorizontalScrollBarPos(p);const f=this.scroll.horizontalBarPos-g;this.table.fireListeners(mt.SCROLL,{event:e==null?void 0:e.nativeEvent,scrollTop:this.scroll.verticalBarPos,scrollLeft:this.scroll.horizontalBarPos,scrollHeight:(h=this.table.theme.scrollStyle)===null||h===void 0?void 0:h.width,scrollWidth:(d=this.table.theme.scrollStyle)===null||d===void 0?void 0:d.width,viewHeight:this.table.tableNoFrameHeight,viewWidth:this.table.tableNoFrameWidth,scrollDirection:"horizontal",scrollRatioX:p,dx:f}),g!==t&&i&&this.checkHorizontalScrollBarEnd()}hideVerticalScrollBar(){this.table.scenegraph.component.hideVerticalScrollBar()}showVerticalScrollBar(t){this.table.scenegraph.component.showVerticalScrollBar(),t&&(clearTimeout(this._clearVerticalScrollBar),this._clearVerticalScrollBar=setTimeout(()=>{var e;(e=this.table.scenegraph)===null||e===void 0||e.component.hideVerticalScrollBar()},1e3))}hideHorizontalScrollBar(){this.table.scenegraph.component.hideHorizontalScrollBar()}showHorizontalScrollBar(t){var e;this.table.scenegraph.component.showHorizontalScrollBar(),(e=this.table.scenegraph)===null||e===void 0||e.component.showFrozenColumnShadow(),t&&(clearTimeout(this._clearHorizontalScrollBar),this._clearHorizontalScrollBar=setTimeout(()=>{var i,r;(i=this.table.scenegraph)===null||i===void 0||i.component.hideFrozenColumnShadow(),(r=this.table.scenegraph)===null||r===void 0||r.component.hideHorizontalScrollBar()},1e3))}triggerContextMenu(t,e,i,r){this.menu.isShow&&this.menu.x===i&&this.menu.y===r?this.hideMenu():this.showContextMenu(t,e,i,r)}showContextMenu(t,e,i,r){var s;!((s=this.table.internalProps.menu)===null||s===void 0)&&s.contextMenuItems&&(this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.menu.x=i,this.menu.y=r,this.table.scenegraph.component.menu.attach(i,r,t,e,Bs.contextmenu)),this.table.fireListeners(mt.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"contextmenu"}))}triggerDropDownMenu(t,e,i,r,s){this.table.fireListeners(mt.DROPDOWN_ICON_CLICK,{col:t,row:e,event:s}),this.menu.isShow?this.hideMenu():this.showDropDownMenu(t,e,i,r)}showDropDownMenu(t,e,i,r){this.table.internalProps.menu.renderMode==="html"?this.menu.isShow=!0:(this.menu.isShow=!0,this.table.scenegraph.component.menu.attach(i,r,t,e,Bs.dropDown),this.menu.bounds=this.table.scenegraph.component.menu.bounds),this.table.fireListeners(mt.SHOW_MENU,{x:i,y:r,col:t,row:e,type:"dropDown"}),this.residentHoverIcon&&this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row);const s=this.table.scenegraph.getCell(t,e);let o;s.forEachChildren(a=>a.attribute.funcType===si.dropDown&&(o=a,!0)),o&&(this.residentHoverIcon={col:t,row:e,icon:o},this.table.scenegraph.setIconHoverStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row,s),this.table.scenegraph.residentHoverIcon(t,e))}hideMenu(){this.menu.isShow&&(this.table.fireListeners(mt.DROPDOWN_MENU_CLEAR,null),this.table.fireListeners(mt.HIDE_MENU,null),this.menu.isShow=!1,this.table.scenegraph.component.menu.detach(),this.residentHoverIcon&&(this.table.scenegraph.setIconNormalStyle(this.residentHoverIcon.icon,this.residentHoverIcon.col,this.residentHoverIcon.row),this.table.scenegraph.resetResidentHoverIcon(this.residentHoverIcon.col,this.residentHoverIcon.row),this.residentHoverIcon=null))}setDropDownMenuHighlight(t){this.menu.dropDownMenuHighlight=t;for(let e=0;e<t.length;e++){const{col:i,row:r}=t[e],s=this.table.getCellRange(i,r);if(s)for(let o=s.start.col;o<=s.end.col;o++)for(let a=s.start.row;a<=s.end.row;a++)this.table.scenegraph.updateCellContent(o,a)}}dropDownMenuIsHighlight(t,e,i){const r=this.menu.dropDownMenuHighlight;if(Array.isArray(r))for(let s=0;s<r.length;s++){const o=r[s];let{col:a,row:l}=o;const{field:h,menuKey:d}=o;if(typeof a!="number"||typeof l!="number")if(this.table.isPivotTable()){const u=this.table.internalProps.layoutMap.getPivotCellAdress(h);if(!u)continue;a=u.col,l=u.row}else{const u=this.table.internalProps.layoutMap.getHeaderCellAddressByField(h);if(!u)continue;a=u.col,l=u.row}if(L(a)&&L(l)&&this.table.isCellRangeEqual(t,e,a,l)){let u=this.table._getHeaderLayoutMap(a??t,l??e).dropDownMenu||this.table.globalDropDownMenu;if(typeof u=="function"&&(u=u({row:l,col:a,table:this.table})),u)for(let c=0;c<u.length;c++){const g=u[c];if(kt(g)&&(g.menuKey||g.text)===(d||"")&&c===i||yt(g)&&g===d&&c===i)return!0}}}return!1}triggerSort(t,e,i,r){if(this.table.isPivotTable()){const c=this.table.getPivotSortState(t,e),g=c?c.toUpperCase():"NORMAL",p=g==="ASC"?"DESC":g==="DESC"?"NORMAL":"ASC";return this.table.sort(t,e,p),void this.table.fireListeners(jm.PIVOT_SORT_CLICK,{col:t,row:e,order:g||"normal",dimensionInfo:this.table.internalProps.layoutMap.getPivotDimensionInfo(t,e),cellLocation:this.table.getCellLocation(t,e),event:r})}const s=[...this.sort],o=this.table.internalProps.multipleSort||!s.length?null:this.sort[this.sort.length-1];VSt(t,e,this.table,r);const a=this.table.getCellRange(t,e),l=this.sort.find(c=>c.col===a.start.col&&c.row===a.start.row),h=this.table.internalProps.multipleSort||!o?null:o.col,d=this.table.internalProps.multipleSort||!o?null:o.row,u=s.findIndex(c=>c.col===t&&c.row===e);u>=0&&s.splice(u,1),this.table.scenegraph.updateSortIcon({col:t,row:e,iconMark:i,order:l==null?void 0:l.order,oldSortCol:h,oldSortRow:d,oldIconMark:o==null?void 0:o.icon}),l&&(l.icon=i),this.table.internalProps.multipleSort||s.forEach(c=>{this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:"normal",oldSortCol:c.col,oldSortRow:c.row,oldIconMark:null})}),this.table.fireListeners(jm.AFTER_SORT,{order:l==null?void 0:l.order,field:this.table.getHeaderField(t,e),event:r})}updateSortState(t){var e,i,r,s,o,a,l,h;t=Array.isArray(t)?t:[t];for(let u=0;u<t.length;u++){if(t[u].field===((e=this.sort[u])===null||e===void 0?void 0:e.field)&&t[t.length-1].order===((i=this.sort[u])===null||i===void 0?void 0:i.order))return;const c=this.table.internalProps.multipleSort?null:((r=this.sort[u])===null||r===void 0?void 0:r.col)||null,g=this.table.internalProps.multipleSort?null:((s=this.sort[u])===null||s===void 0?void 0:s.row)||null;((o=this.sort[u])===null||o===void 0?void 0:o.order)==="asc"||(a=this.sort[u])===null||a===void 0||a.order,this.setSortState(t.slice(0,u+1));const p=this.table.internalProps.layoutMap.getHeaderCellAddressByField(t[u].field);this.sort[u].col=p.col,this.sort[u].row=p.row;const f=this.table.scenegraph.getCell(this.sort[u].col,this.sort[u].row);let m;eD(f,"children",v=>v.attribute.funcType==="sort"&&(m=v,!0)),this.table.scenegraph.updateSortIcon({col:this.sort[u].col,row:this.sort[u].row,iconMark:m,order:this.sort[u].order,oldSortCol:c,oldSortRow:g,oldIconMark:(l=this.sort[u])===null||l===void 0?void 0:l.icon})}const d=[];this.table.internalProps.layoutMap.columnTree.tree.children.forEach(u=>{t.some(c=>c.field===u.field)||d.push(u)});for(let u=0;u<d.length;u++){const c=d[u];this.table.scenegraph.updateSortIcon({col:null,row:null,iconMark:null,order:null,oldSortCol:(h=c.startInTotal+this.table.internalProps.layoutMap.leftRowSeriesNumberColumnCount)!==null&&h!==void 0?h:0,oldSortRow:c.level,oldIconMark:null})}}triggerFreeze(t,e,i){if(!this.table.isPivotTable()&&!this.table.transpose){if($St(t,e,this.table),this.table.hasListeners(jm.FREEZE_CLICK)){const r=this.table.internalProps.layoutMap.columnObjects.slice(0,t+1);this.table.fireListeners(jm.FREEZE_CLICK,{col:t,row:e,fields:r.reduce((s,o)=>s.concat(o.field),[]),colCount:this.table.frozenColCount})}this.frozen.icon=i}}updateCursor(t="default"){this.table.getElement().style.cursor=t}updateDrillState(t,e,i,r,s,o){this.drill.dimensionKey=t,this.drill.title=e,this.drill.drillDown=i,this.drill.drillUp=r,this.drill.col=s,this.drill.row=o,XSt(s,o,i,r,this.table)}updateSparklineHoverPose(t,e,i,r){this.sparkLine.col!==-1&&this.sparkLine.row!==-1&&KSt(this.sparkLine.col,this.sparkLine.row,this.table);let s=!1;t!==-1&&e!==-1&&(s=qSt(t,e,i,r,this.table)),s?(this.sparkLine.col=t,this.sparkLine.row=e):(this.sparkLine.col=-1,this.sparkLine.row=-1)}setCheckedState(t,e,i,r){return dxt(t,e,i,r,this)}setHeaderCheckedState(t,e){return uxt(t,e,this)}syncCheckedState(t,e,i,r){return cxt(t,e,i,r,this)}initCheckedState(t){return gxt(t,this)}updateHeaderCheckedState(t,e,i){return pxt(t,this,e,i)}initLeftRecordsCheckState(t){return fxt(t,this)}setRadioState(t,e,i,r,s){sxt(t,e,i,r,s,this)}syncRadioState(t,e,i,r,s,o){return axt(t,e,i,r,s,o,this)}changeCheckboxAndRadioOrder(t,e){this.checkedState.size&&vxt(t,e,this),this.radioState.length&&hxt(t,e,this)}setCustomSelectRanges(t){wxt(this),Axt(t,this)}};function Txt(n){We.mode==="browser"&&n.on(mt.CLICK_CELL,t=>{const{col:e,row:i}=t;if(t.target.type==="image"&&t.target.role&&t.target.role.startsWith("icon"))return;let r;r=n.internalProps.layoutMap.isHeader(e,i)?n.isPivotTable()?n._getHeaderLayoutMap(e,i).headerType:n.getHeaderDefine(e,i).headerType:n.getBodyColumnType(e,i);const s=n.isHeader(e,i)?n.getHeaderDefine(e,i):n.getBodyColumnDefine(e,i),o=n.getCellValue(e,i),a=n.getCellOriginValue(e,i);if(r==="link"){let l=ni(s.linkJump,{col:e,row:i,table:n,value:o,dataValue:a,cellHeaderPaths:void 0});if(l=l!==!1,!l)return;const h=s.templateLink;let d,u=ni(s.linkDetect,{col:e,row:i,table:n,value:o,dataValue:a,cellHeaderPaths:void 0});if(u=u!==!1,h){const p=n.getCellOriginRecord(e,i);if(p&&p.vtableMerge)return;const f=Object.assign({__value:o,__dataValue:a},p);if(it(h))d=h(f,e,i,n);else{const m=/\{\s*(\S+?)\s*\}/g;d=h.replace(m,(v,_)=>f[_])}}else if(u){if(!iD.test(o))return;d=o}else d=o;if(!d)return;const c=s.linkTarget,g=s.linkWindowFeatures;window.open(d,c,g)}else if(r==="image"){const{clickToPreview:l}=s;if(l===!1)return;const h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.backgroundColor="rgba(30, 30, 30, 0.4)",h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.zIndex="9999",h.addEventListener("click",u=>{u.target===h&&document.body.removeChild(h)});const d=new Image;d.src=o,d.style.maxWidth="80%",d.style.maxHeight="80%",h.appendChild(d),document.body.appendChild(h)}else if(r==="video"){const{clickToPreview:l}=s;if(l===!1)return;const h=document.createElement("div");h.style.width="100%",h.style.height="100%",h.style.position="absolute",h.style.top="0",h.style.left="0",h.style.backgroundColor="rgba(30, 30, 30, 0.4)",h.style.display="flex",h.style.justifyContent="center",h.style.alignItems="center",h.style.overflow="hidden",h.style.zIndex="9999",h.addEventListener("click",u=>{u.target===h&&document.body.removeChild(h)});const d=document.createElement("video");d.src=o,d.style.maxWidth="80%",d.style.maxHeight="80%",d.setAttribute("preload","auto"),d.setAttribute("controls","true"),h.appendChild(d),document.body.appendChild(h)}})}function kxt(n){n.on(mt.MOUSEENTER_CELL,t=>{const{col:e,row:i}=t;if(e===-1||i===-1)return;const r=n.internalProps.layoutMap.getHeaderDimension(e,i);r!=null&&r.drillDown||r!=null&&r.drillUp?n.stateManager.updateDrillState(r.dimensionKey,r.title,r.drillDown,r.drillUp,e,i):n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)}),n.on(mt.MOUSELEAVE_TABLE,t=>{n.stateManager.updateDrillState(void 0,void 0,!1,!1,-1,-1)})}function Rxt(n){n.fireListeners(jm.DRILLMENU_CLICK,n.stateManager.drill)}function Bxt(n){const t=n.internalProps.layoutMap.rowsDefine,e=n.internalProps.layoutMap.columnsDefine;for(let i=0;i<t.length;i++){const r=t[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}for(let i=0;i<e.length;i++){const r=e[i];if(typeof r!="string"&&(r.drillDown||r.drillUp))return!0}return!1}function i$(n){if(n.eventManager.bindSparklineHoverEvent)return;let t=!1;n.isPivotTable()?t=n.internalProps.layoutMap.indicatorsDefine.some(e=>typeof e!="string"&&e.cellType==="sparkline"):t=n.internalProps.layoutMap.columnObjects.some(e=>e.cellType==="sparkline"||typeof e.cellType=="function"),t&&(n.eventManager.bindSparklineHoverEvent=!0,n.on(mt.MOUSEMOVE_CELL,e=>{const{col:i,row:r,x:s,y:o}=e;n.getBodyColumnType(i,r)!=="sparkline"&&n.stateManager.updateSparklineHoverPose(-1,-1,0,0),n.stateManager.updateSparklineHoverPose(i,r,s,o)}),n.on(mt.MOUSELEAVE_TABLE,e=>{n.stateManager.updateSparklineHoverPose(-1,-1,0,0)}))}function Gx(n,t,e=!0){var i;let{deltaX:r,deltaY:s}=n;n.shiftKey&&n.deltaY&&(r=s,s=0);const[o,a]=Pxt(r,s,{horizontal:1,vertical:1});(o||a)&&t.interactionState!==oe.scrolling&&t.updateInteractionState(oe.scrolling),o&&(t.setScrollLeft(t.scroll.horizontalBarPos+o,n),t.showHorizontalScrollBar(!0)),a&&(t.setScrollTop(t.scroll.verticalBarPos+a,n),t.showVerticalScrollBar(!0)),e&&t.resetInteractionState(t.interactionStateBeforeScroll),!((i=n.nativeEvent)===null||i===void 0)&&i.cancelable&&(t.table.internalProps.overscrollBehavior==="none"||Math.abs(s)>=Math.abs(r)&&s!==0&&nZ(s,t)||Math.abs(s)<=Math.abs(r)&&r!==0&&rZ(r,t))&&n.nativeEvent.preventDefault()}function Pxt(n,t,e){var i,r;const s=Math.abs(n/t),o=s<=.5?0:n,a=s>2?0:t;return[Math.ceil(o*((i=e.horizontal)!==null&&i!==void 0?i:0)),Math.ceil(a*((r=e.vertical)!==null&&r!==void 0?r:0))]}function nZ(n,t){return t.table.getAllRowsHeight()-t.table.scenegraph.height!=0&&!Ext(n,t)&&!Lxt(n,t)}function rZ(n,t){return t.table.getAllColsWidth()-t.table.scenegraph.width!=0&&!Ixt(n,t)&&!Oxt(n,t)}function Ext(n,t){return t.table.getAllRowsHeight()-t.table.scenegraph.height!==0&&n<=0&&t.scroll.verticalBarPos<1}function Lxt(n,t){var e;const i=!((e=t.table.options.customConfig)===null||e===void 0)&&e._disableColumnAndRowSizeRound?1:0,r=t.table.getAllRowsHeight()-t.table.scenegraph.height;return r!==0&&n>=0&&Math.abs(t.scroll.verticalBarPos-r)<1+i}function Ixt(n,t){return t.table.getAllColsWidth()-t.table.scenegraph.width!==0&&n<=0&&t.scroll.horizontalBarPos<1}function Oxt(n,t){var e;const i=!((e=t.table.options.customConfig)===null||e===void 0)&&e._disableColumnAndRowSizeRound?1:0,r=t.table.getAllColsWidth()-t.table.scenegraph.width;return r!==0&&n>=0&&Math.abs(t.scroll.horizontalBarPos-r)<1+i}class Dxt{constructor(t){this.stateManager=t}setScrollHandle(t){this.scrollHandle=t}startInertia(t,e,i){this.lastTime=Date.now(),this.speedX=t,this.speedY=e,this.friction=i,this.runingId||(this.runingId=requestAnimationFrame(this.inertia.bind(this)))}inertia(){var t;const e=Date.now(),i=e-this.lastTime;let r=!0;const s=Math.pow(this.friction,i/16),o=s*this.speedX,a=s*this.speedY;let l=0,h=0;Math.abs(o)>.05&&(r=!1,l=(this.speedX+o)/2*i),Math.abs(a)>.05&&(r=!1,h=(this.speedY+a)/2*i),(t=this.scrollHandle)===null||t===void 0||t.call(this,l,h),r?this.runingId=null:(this.lastTime=e,this.speedX=o,this.speedY=a,this.runingId=requestAnimationFrame(this.inertia.bind(this)))}endInertia(){cancelAnimationFrame(this.runingId),this.runingId=null}isInertiaScrolling(){return!!this.runingId}}function fL(n,t,e){var i,r,s,o;t&&((i=n.stateManager.columnMove)===null||i===void 0?void 0:i.colSource)!==-1&&((r=n.stateManager.columnMove)===null||r===void 0?void 0:r.rowSource)!==-1&&((s=n.stateManager.columnMove)===null||s===void 0?void 0:s.colTarget)!==-1&&((o=n.stateManager.columnMove)===null||o===void 0?void 0:o.rowTarget)!==-1?n.hasListeners(mt.CHANGE_HEADER_POSITION)&&n.fireListeners(mt.CHANGE_HEADER_POSITION,{target:{col:n.stateManager.columnMove.colTarget,row:n.stateManager.columnMove.rowTarget},source:{col:n.stateManager.columnMove.colSource,row:n.stateManager.columnMove.rowSource},event:e}):t||n.hasListeners(mt.CHANGE_HEADER_POSITION_FAIL)&&n.fireListeners(mt.CHANGE_HEADER_POSITION_FAIL,{target:{col:n.stateManager.columnMove.colTarget,row:n.stateManager.columnMove.rowTarget},source:{col:n.stateManager.columnMove.colSource,row:n.stateManager.columnMove.rowSource},event:e})}function Fxt(n){const t=n.table,e=t.stateManager;t.scenegraph.tableGroup.addEventListener("pointermove",i=>{var r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S;const w=(s=(r=t.eventManager.LastPointerXY)===null||r===void 0?void 0:r.x)!==null&&s!==void 0?s:i.x,x=(a=(o=t.eventManager.LastPointerXY)===null||o===void 0?void 0:o.y)!==null&&a!==void 0?a:i.y;t.eventManager.LastPointerXY={x:i.x,y:i.y},n.touchSetTimeout&&(clearTimeout(n.touchSetTimeout),n.touchSetTimeout=void 0);const A=In(i);if(A.eventArgs&&t.hasListeners(mt.MOUSEMOVE_TABLE)&&t.fireListeners(mt.MOUSEMOVE_TABLE,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:i.nativeEvent,target:(l=A==null?void 0:A.eventArgs)===null||l===void 0?void 0:l.target,mergeCellInfo:(h=A.eventArgs)===null||h===void 0?void 0:h.mergeInfo}),e.interactionState===oe.grabing&&!(!((d=t.editorManager)===null||d===void 0)&&d.editingEditor))return void(Math.abs(w-i.x)+Math.abs(x-i.y)>=1&&(e.isResizeCol()||e.isResizeRow()||(e.isMoveCol()?n.dealColumnMover(A):e.isFillHandle()?n.dealFillSelect(A,!0):((u=t.options.select)===null||u===void 0?void 0:u.disableDragSelect)||n.dealTableSelect(A,!0))));!(!((c=t.options.select)===null||c===void 0)&&c.disableDragSelect)&&t.eventManager.isDraging&&e.isSelecting()&&!(!((g=t.editorManager)===null||g===void 0)&&g.editingEditor)&&n.dealTableSelect(A,!0);const M=i.path.find(T=>T.role==="cell");if(t.hasListeners(mt.MOUSELEAVE_CELL)&&(t.stateManager.hover.cellPos.col===-1||t.stateManager.hover.cellPos.row===-1||(M==null?void 0:M.col)===t.stateManager.hover.cellPos.col&&(M==null?void 0:M.row)===t.stateManager.hover.cellPos.row||t.fireListeners(mt.MOUSELEAVE_CELL,{col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row,cellRange:t.getCellRangeRelativeRect({col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(p=A==null?void 0:A.eventArgs)===null||p===void 0?void 0:p.target})),t.hasListeners(mt.MOUSEENTER_CELL)&&((M==null?void 0:M.role)!=="cell"||!L(M.col)||!L(M.row)||M.col===t.stateManager.hover.cellPos.col&&M.row===t.stateManager.hover.cellPos.row||M.col===((f=t.stateManager.hover.cellPosContainHeader)===null||f===void 0?void 0:f.col)&&M.row===((m=t.stateManager.hover.cellPosContainHeader)===null||m===void 0?void 0:m.row)||t.fireListeners(mt.MOUSEENTER_CELL,{col:M.col,row:M.row,cellRange:t.getCellRangeRelativeRect({col:M.col,row:M.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(v=A==null?void 0:A.eventArgs)===null||v===void 0?void 0:v.target,mergeCellInfo:(_=A.eventArgs)===null||_===void 0?void 0:_.mergeInfo})),n.dealIconHover(A),n.dealTableHover(A),t.theme.columnResize.visibleOnHover&&n.checkColumnResize(A,!0),A.eventArgs&&t.hasListeners(mt.MOUSEMOVE_CELL)){let T,R;if(!((b=A.eventArgs)===null||b===void 0)&&b.target){const B=wv((y=A.eventArgs)===null||y===void 0?void 0:y.target);B&&(T=B.icon,R=B.position)}t.fireListeners(mt.MOUSEMOVE_CELL,{col:A.eventArgs.col,row:A.eventArgs.row,x:A.abstractPos.x,y:A.abstractPos.y,event:i.nativeEvent,targetIcon:T?{name:T.name,position:R,funcType:T.attribute.funcType}:void 0,target:(C=A==null?void 0:A.eventArgs)===null||C===void 0?void 0:C.target,mergeCellInfo:(S=A.eventArgs)===null||S===void 0?void 0:S.mergeInfo})}}),t.scenegraph.tableGroup.addEventListener("pointerout",i=>{var r;const s=In(i),o=(r=s==null?void 0:s.eventArgs)===null||r===void 0?void 0:r.target;(o==null?void 0:o.role)==="table"&&n.dealTableHover()}),t.scenegraph.tableGroup.addEventListener("pointerover",i=>{var r,s;const o=In(i),a=(r=o==null?void 0:o.eventArgs)===null||r===void 0?void 0:r.target;if(a&&t.hasListeners(mt.MOUSEOVER_CHART_SYMBOL)&&a.type==="symbol"){const l=i.composedPath().find(h=>h.roll==="cell");if(l){const{col:h,row:d}=l,u={col:h,row:d,field:t.getHeaderField(h,d),value:t.getCellValue(h,d),dataValue:t.getCellOriginValue(h,d),cellHeaderPaths:t.internalProps.layoutMap.getCellHeaderPaths(h,d),title:t.getBodyColumnDefine(h,d).title,cellRange:t.getCellRelativeRect(h,d),event:i.nativeEvent,sparkline:{pointData:void 0},scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:(s=o==null?void 0:o.eventArgs)===null||s===void 0?void 0:s.target};t.fireListeners(mt.MOUSEOVER_CHART_SYMBOL,u)}}}),t.scenegraph.tableGroup.addEventListener("pointerenter",i=>{(t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.horizontalVisible==="focus"||!t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.visible==="focus")&&e.showHorizontalScrollBar(),(t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.verticalVisible==="focus"||!t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.visible==="focus")&&e.showVerticalScrollBar(),t.hasListeners(mt.MOUSEENTER_TABLE)&&t.fireListeners(mt.MOUSEENTER_TABLE,{event:i.nativeEvent})}),t.scenegraph.tableGroup.addEventListener("pointerleave",i=>{e.isResizeCol()||e.isResizeRow()||e.isMoveCol()||e.isSelecting()||(e.updateInteractionState(oe.default),e.updateCursor()),(t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.horizontalVisible==="focus"||!t.theme.scrollStyle.horizontalVisible&&t.theme.scrollStyle.visible==="focus")&&e.hideHorizontalScrollBar(),(t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.verticalVisible==="focus"||!t.theme.scrollStyle.verticalVisible&&t.theme.scrollStyle.visible==="focus")&&e.hideVerticalScrollBar(),t.hasListeners(mt.MOUSELEAVE_CELL)&&t.stateManager.hover.cellPos.col!==-1&&t.stateManager.hover.cellPos.row!==-1&&t.fireListeners(mt.MOUSELEAVE_CELL,{col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row,cellRange:t.getCellRangeRelativeRect({col:t.stateManager.hover.cellPos.col,row:t.stateManager.hover.cellPos.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:void 0}),n.dealTableHover();const r=i.target;r&&!r.isDescendantsOf(t.scenegraph.tableGroup)&&t.fireListeners(mt.MOUSELEAVE_TABLE,{event:i.nativeEvent})}),t.scenegraph.tableGroup.addEventListener("pointerdown",i=>{var r,s,o,a,l;if(t.hasListeners(mt.MOUSEDOWN_TABLE)&&t.fireListeners(mt.MOUSEDOWN_TABLE,{event:i.nativeEvent}),t.eventManager.isDown=!0,t.eventManager.LastBodyPointerXY={x:i.x,y:i.y},t.eventManager.LastPointerXY={x:i.x,y:i.y},i.button!==0)return;const h=In(i);if(n.downIcon=void 0,e.interactionState!==oe.default||(t.isPivotChart()&&((r=h==null?void 0:h.eventArgs)===null||r===void 0?void 0:r.target.type)!=="chart"&&t.scenegraph.updateChartState(null),((s=h.eventArgs)===null||s===void 0?void 0:s.target)!==((o=e.residentHoverIcon)===null||o===void 0?void 0:o.icon)&&e.hideMenu(),((a=h==null?void 0:h.eventArgs)===null||a===void 0?void 0:a.target.type)==="chart"))return;const d=(l=t.editorManager)===null||l===void 0?void 0:l.completeEdit(i.nativeEvent);px(d,u=>{var c,g,p,f,m,v,_,b,y,C,S;if(u===!1)return;const w=!((p=(g=(c=h==null?void 0:h.eventArgs)===null||c===void 0?void 0:c.target)===null||g===void 0?void 0:g.role)===null||p===void 0)&&p.startsWith("icon")?h.eventArgs.target:!((f=i.target.role)===null||f===void 0)&&f.startsWith("icon")?i.target:void 0;if(n.downIcon=w,w&&w.attribute.interactive!==!1)w.attribute.funcType===si.dragReorder&&(e.startMoveCol(h.eventArgs.col,h.eventArgs.row,h.abstractPos.x,h.abstractPos.y,(C=(y=h.eventArgs)===null||y===void 0?void 0:y.event)===null||C===void 0?void 0:C.nativeEvent),e.updateInteractionState(oe.grabing));else{if(n.cellIsHeaderCheck(h))return;if(i.pointerType==="touch"){if(n.touchEnd=!1,n.touchSetTimeout=setTimeout(()=>{n.isTouchdown=!1,n.isLongTouch=!0,(n.touchEnd||!n.checkColumnResize(h,!0)&&!n.checkRowResize(h,!0))&&(n.touchEnd||!n.checkColumnMover(h))?n.dealTableSelect(h)&&!n.touchEnd&&e.updateInteractionState(oe.grabing):e.updateInteractionState(oe.grabing)},500),t.hasListeners(mt.MOUSEENTER_CELL)){const x=i.path.find(A=>A.role==="cell");(x==null?void 0:x.role)!=="cell"||!L(x.col)||!L(x.row)||x.col===t.stateManager.hover.cellPos.col&&x.row===t.stateManager.hover.cellPos.row||x.col===((m=t.stateManager.hover.cellPosContainHeader)===null||m===void 0?void 0:m.col)&&x.row===((v=t.stateManager.hover.cellPosContainHeader)===null||v===void 0?void 0:v.row)||t.fireListeners(mt.MOUSEENTER_CELL,{col:x.col,row:x.row,cellRange:t.getCellRangeRelativeRect({col:x.col,row:x.row}),scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,event:i.nativeEvent,target:(_=h==null?void 0:h.eventArgs)===null||_===void 0?void 0:_.target,mergeCellInfo:(b=h.eventArgs)===null||b===void 0?void 0:b.mergeInfo})}n.dealTableHover(h)}else{if(!n.checkCellFillhandle(h)&&(n.checkColumnResize(h,!0)||n.checkRowResize(h,!0)))return t.scenegraph.updateChartState(null),void e.updateInteractionState(oe.grabing);if(n.checkColumnMover(h)||n.checkCellFillhandle(h,!0)&&n.dealFillSelect(h))return void e.updateInteractionState(oe.grabing);n.dealTableSelect(h)&&e.updateInteractionState(oe.grabing)}}if(t.hasListeners(mt.MOUSEDOWN_CELL)){const x=In(i);x.eventArgs&&t.fireListeners(mt.MOUSEDOWN_CELL,{col:x.eventArgs.col,row:x.eventArgs.row,event:i.nativeEvent,target:(S=x==null?void 0:x.eventArgs)===null||S===void 0?void 0:S.target,mergeCellInfo:x.eventArgs.mergeInfo})}})}),t.scenegraph.tableGroup.addEventListener("pointerup",i=>{var r,s,o,a;if(i.button===0){if(e.interactionState==="grabing"){if(e.updateInteractionState(oe.default),e.isResizeCol())Ux(t);else if(e.isResizeRow())Yx(t);else if(e.isMoveCol()){const l=t.stateManager.endMoveCol();fL(t,l,i.nativeEvent)}else if(e.isSelecting()){t.stateManager.endSelectCells(),t.stateManager.isFillHandle()&&t.stateManager.endFillSelect();const l=In(i);if(t.eventManager.isDraging&&l.eventArgs&&t.hasListeners(mt.DRAG_SELECT_END)){const h={event:i.nativeEvent,cells:[],col:l.eventArgs.target.col,row:l.eventArgs.target.row,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:(r=l==null?void 0:l.eventArgs)===null||r===void 0?void 0:r.target,mergeCellInfo:(s=l.eventArgs)===null||s===void 0?void 0:s.mergeInfo};h.cells=t.getSelectedCellInfos(),t.fireListeners(mt.DRAG_SELECT_END,h)}}}else e.interactionState===oe.scrolling&&e.updateInteractionState(oe.default);if(t.hasListeners(mt.MOUSEUP_CELL)){const l=In(i);l.eventArgs&&t.fireListeners(mt.MOUSEUP_CELL,{col:l.eventArgs.col,row:l.eventArgs.row,event:i.nativeEvent,target:(o=l==null?void 0:l.eventArgs)===null||o===void 0?void 0:o.target,mergeCellInfo:(a=l.eventArgs)===null||a===void 0?void 0:a.mergeInfo})}setTimeout(()=>{n.isTouchdown=!1,n.isTouchMove=!1,n.isDraging=!1,n.touchMovePoints=[]},0)}}),t.scenegraph.tableGroup.addEventListener("rightdown",i=>{var r,s,o,a;const l=In(i);if(l.eventArgs){e.triggerContextMenu(l.eventArgs.col,l.eventArgs.row,l.abstractPos.x,l.abstractPos.y);const{col:h,row:d}=l.eventArgs;if(t.hasListeners(mt.CONTEXTMENU_CELL)){const u=t.getCellInfo(h,d);let c,g;if(!((r=l.eventArgs)===null||r===void 0)&&r.target){const f=wv((s=l.eventArgs)===null||s===void 0?void 0:s.target);f&&(c=f.icon,g=f.position)}const p=Object.assign(Object.assign({},u),{event:i.nativeEvent,cells:[],targetIcon:c?{name:c.name,position:g,funcType:c.attribute.funcType}:void 0,target:(o=l==null?void 0:l.eventArgs)===null||o===void 0?void 0:o.target,mergeCellInfo:(a=l.eventArgs)===null||a===void 0?void 0:a.mergeInfo});s0t(t.stateManager.select.ranges,h,d)?p.cells=t.getSelectedCellInfos():p.cells=[[u]],t.fireListeners(mt.CONTEXTMENU_CELL,p)}}}),t.scenegraph.tableGroup.addEventListener("pointertap",i=>{var r,s,o,a,l;if(t.stateManager.columnResize.resizing)return;const h=In(i);if(!n.isTouchMove&&i.button===0&&h.eventArgs&&t.hasListeners(mt.CLICK_CELL)){const{col:d,row:u}=h.eventArgs,c=t.getCellInfo(d,u);let g,p;if(!((r=h.eventArgs)===null||r===void 0)&&r.target){const m=wv((s=h.eventArgs)===null||s===void 0?void 0:s.target);m&&(g=m.icon,p=m.position)}const f=Object.assign(Object.assign({},c),{event:i.nativeEvent,federatedEvent:i,cells:[],targetIcon:g?{name:g.name,position:p,funcType:g.attribute.funcType}:void 0,target:(o=h==null?void 0:h.eventArgs)===null||o===void 0?void 0:o.target,mergeCellInfo:(a=h.eventArgs)===null||a===void 0?void 0:a.mergeInfo});t.fireListeners(mt.CLICK_CELL,f)}if(!t.stateManager.columnResize.resizing&&!t.stateManager.columnMove.moving&&(n.dealIconClick(i,h),(h==null?void 0:h.eventArgs)&&n.touchSetTimeout&&i.pointerType==="touch")){const d=In(i);if(n.touchSetTimeout){clearTimeout(n.touchSetTimeout);const u=!!(!((l=e.select.ranges)===null||l===void 0)&&l.length);n.dealTableSelect(d),e.endSelectCells(!0,u),n.touchSetTimeout=void 0}}}),t.scenegraph.stage.addEventListener("pointerdown",i=>{var r,s,o,a;const l=In(i);!((r=l.eventArgs)===null||r===void 0)&&r.target&&((s=l.eventArgs)===null||s===void 0?void 0:s.target)===((o=e.residentHoverIcon)===null||o===void 0?void 0:o.icon)||e.hideMenu();const h=(a=t.editorManager)===null||a===void 0?void 0:a.completeEdit(i.nativeEvent);px(h,d=>{var u;if(d===!1)return;const c=!((u=i.target.role)===null||u===void 0)&&u.startsWith("icon")?i.target:void 0;if(n.downIcon=c,!(i.pointerType==="touch"||c||n.checkCellFillhandle(l)||e.columnResize.resizing||!n.checkColumnResize(l,!0))){t.scenegraph.updateChartState(null),e.updateInteractionState(oe.grabing);const{eventArgs:g}=l;g!=null&&g.targetCell||t.getCellAt(l.abstractPos.x-t.theme.columnResize.resizeHotSpotSize/2,l.abstractPos.y)&&t.hasListeners(mt.MOUSEDOWN_TABLE)&&t.fireListeners(mt.MOUSEDOWN_TABLE,{event:i.nativeEvent})}})}),t.scenegraph.stage.addEventListener("pointerup",i=>{e.interactionState==="grabing"&&(e.updateInteractionState(oe.default),e.isResizeCol()?Ux(t):e.isResizeRow()&&Yx(t))}),t.scenegraph.stage.addEventListener("pointertap",i=>{var r,s,o;const a=i.target;if(t.eventManager.isDraging||!a||!a.isDescendantsOf(t.scenegraph.stage)&&a.stage!==a||a.isDescendantsOf(t.scenegraph.tableGroup))t.eventManager.isDraging&&e.isSelecting()&&e.endSelectCells();else{e.updateInteractionState(oe.default),n.dealTableHover();const l=!!(!((r=e.select.ranges)===null||r===void 0)&&r.length);((o=(s=t.options.select)===null||s===void 0?void 0:s.blankAreaClickDeselect)===null||o===void 0||o)&&n.dealTableSelect(),e.endSelectCells(!0,l),e.updateCursor(),t.scenegraph.updateChartState(null)}}),t.scenegraph.stage.addEventListener("pointermove",i=>{const r=In(i);e.isResizeCol()||n.checkColumnResize(r)?t.stateManager.select&&n.checkCellFillhandle(r)?e.updateCursor("crosshair"):e.updateCursor("col-resize"):e.isResizeRow()||n.checkRowResize(r)?t.stateManager.select&&n.checkCellFillhandle(r)?e.updateCursor("crosshair"):e.updateCursor("row-resize"):e.isMoveCol()||e.updateCursor()}),t.scenegraph.tableGroup.addEventListener("checkbox_state_change",i=>{var r,s;const o=In(i),{col:a,row:l}=o.eventArgs,h=t.getCellInfo(a,l),d=un(t,a,l);if(d)for(let c=d.start.col;c<=d.end.col;c++)for(let g=d.start.row;g<=d.end.row;g++)t.scenegraph.getCell(c,g).forEachChildren(p=>{p.name==="checkbox"&&p.setAttributes({checked:i.target.attribute.checked,indeterminate:i.target.attribute.indeterminate})});const u=Object.assign(Object.assign({},h),{event:i.nativeEvent,target:(r=o==null?void 0:o.eventArgs)===null||r===void 0?void 0:r.target,mergeCellInfo:(s=o==null?void 0:o.eventArgs)===null||s===void 0?void 0:s.mergeInfo,checked:i.detail.checked});if(t.isHeader(a,l))t.stateManager.setHeaderCheckedState(h.field,i.detail.checked),t.getCellType(a,l)==="checkbox"&&t.scenegraph.updateCheckboxCellState(a,l,i.detail.checked);else if(t.stateManager.setCheckedState(a,l,h.field,i.detail.checked),t.getCellType(a,l)==="checkbox"){const c=t.stateManager.headerCheckedState[h.field],g=t.stateManager.updateHeaderCheckedState(h.field,a,l);c!==g&&t.scenegraph.updateHeaderCheckboxCellState(a,l,g)}t.fireListeners(mt.CHECKBOX_STATE_CHANGE,u),t.scenegraph.updateNextFrame()}),t.scenegraph.tableGroup.addEventListener("radio_checked",i=>{var r,s,o;const a=In(i),{col:l,row:h,target:d}=a.eventArgs,u=t.getCellInfo(l,h),c=(r=fyt.exec(d.id))===null||r===void 0?void 0:r[1],g=un(t,l,h);if(g)for(let v=g.start.col;v<=g.end.col;v++)for(let _=g.start.row;_<=g.end.row;_++)t.scenegraph.getCell(v,_).forEachChildren(b=>{b.name==="radio"&&b.id===d.id&&b.setAttributes({checked:!0})});const p=t.getBodyColumnDefine(l,h).radioCheckType||"column";if(p==="cell")if(g)for(let v=g.start.col;v<=g.end.col;v++)for(let _=g.start.row;_<=g.end.row;_++)t.scenegraph.getCell(v,_).forEachChildren(b=>{b.name==="radio"&&b.id!==d.id&&b.setAttributes({checked:!1})});else t.scenegraph.getCell(l,h).forEachChildren(v=>{v.name==="radio"&&v.id!==d.id&&v.setAttributes({checked:!1})});else p==="column"&&t.scenegraph.getColGroup(l).forEachChildren(v=>{v.forEachChildren(_=>{_.name==="radio"&&_.id!==d.id&&_.setAttributes({checked:!1})})});const f=c?Number(c):void 0;t.stateManager.setRadioState(l,h,u.field,p,f);const m=Object.assign(Object.assign({},u),{event:i.nativeEvent,target:(s=a==null?void 0:a.eventArgs)===null||s===void 0?void 0:s.target,mergeCellInfo:(o=a==null?void 0:a.eventArgs)===null||o===void 0?void 0:o.mergeInfo,radioIndexInCell:f});t.fireListeners(mt.RADIO_STATE_CHANGE,m),t.scenegraph.updateNextFrame()}),t.scenegraph.tableGroup.addEventListener("switch_state_change",i=>{var r,s;const o=In(i),{col:a,row:l,target:h}=o.eventArgs,d=t.getCellInfo(a,l),u=un(t,a,l);if(u)for(let g=u.start.col;g<=u.end.col;g++)for(let p=u.start.row;p<=u.end.row;p++)t.scenegraph.getCell(g,p).forEachChildren(f=>{f.name==="switch"&&f.setAttributes({checked:i.target.attribute.checked})});const c=Object.assign(Object.assign({},d),{event:i.nativeEvent,target:(r=o==null?void 0:o.eventArgs)===null||r===void 0?void 0:r.target,mergeCellInfo:(s=o==null?void 0:o.eventArgs)===null||s===void 0?void 0:s.mergeInfo,checked:i.detail.checked});t.stateManager.setCheckedState(a,l,d.field,i.detail.checked),t.fireListeners(mt.SWITCH_STATE_CHANGE,c),t.scenegraph.updateNextFrame()}),t.scenegraph.stage.addEventListener("wheel",i=>{var r;i.path.find(s=>s.name==="legend")||((r=t.editorManager)===null||r===void 0||r.completeEdit(),t.eventManager._enableTableScroll&&Gx(i,e))})}function Hxt(n){const t=n.table;n.gesture=new Upt(t.scenegraph.tableGroup,{tap:{interval:300}}),n.gesture.on("doubletap",e=>{zxt(e,t)})}function Ux(n){n.stateManager.endResizeCol();const t=[];for(let e=0;e<n.colCount;e++)t.push(n.getColWidth(e));n.fireListeners(mt.RESIZE_COLUMN_END,{col:n.stateManager.columnResize.col,colWidths:t})}function Yx(n){n.stateManager.endResizeRow(),n.fireListeners(mt.RESIZE_ROW_END,{row:n.stateManager.rowResize.row,rowHeight:n.getRowHeight(n.stateManager.rowResize.row)})}function zxt(n,t){var e,i,r,s,o,a;const l=In(n);let h=-1,d=-1;l.eventArgs&&(h=l.eventArgs.col,d=l.eventArgs.row);const u=t.getCellValue(h,d),c=(i=(e=l.eventArgs)===null||e===void 0?void 0:e.targetCell)===null||i===void 0?void 0:i.globalAABBBounds;if(c&&t.internalProps.focusControl.setFocusRect(new Tu(c.x1+t.scrollLeft,c.y1+t.scrollTop,c.x2-c.x1,c.y2-c.y1),u),t.hasListeners(mt.DBLCLICK_CELL)){const g=t.getCellInfo(h,d);let p,f;if(!((r=l.eventArgs)===null||r===void 0)&&r.target){const v=wv((s=l.eventArgs)===null||s===void 0?void 0:s.target);v&&(p=v.icon,f=v.position)}const m=Object.assign(Object.assign({},g),{event:n.nativeEvent,federatedEvent:n,cells:[],targetIcon:p?{name:p.name,position:f,funcType:p.attribute.funcType}:void 0,target:(o=l==null?void 0:l.eventArgs)===null||o===void 0?void 0:o.target,mergeCellInfo:(a=l==null?void 0:l.eventArgs)===null||a===void 0?void 0:a.mergeInfo});t.fireListeners(mt.DBLCLICK_CELL,m)}}function Wxt(n){const t=n.table,e=t.stateManager,i=t.scenegraph;i.component.vScrollBar.addEventListener("pointerover",o=>{e.showVerticalScrollBar()}),i.component.hScrollBar.addEventListener("pointerover",o=>{e.showHorizontalScrollBar()}),i.component.vScrollBar.addEventListener("pointerout",o=>{e.interactionState!==oe.scrolling&&e.hideVerticalScrollBar()}),i.component.hScrollBar.addEventListener("pointerout",o=>{e.interactionState!==oe.scrolling&&e.hideHorizontalScrollBar()}),i.component.vScrollBar.addEventListener("pointermove",o=>{i.table.stateManager.updateCursor("default"),o.stopPropagation()}),i.component.vScrollBar.addEventListener("pointerdown",o=>{o.stopPropagation(),i.table.hasListeners(mt.MOUSEDOWN_TABLE)&&i.table.fireListeners(mt.MOUSEDOWN_TABLE,{event:o.nativeEvent})}),i.component.vScrollBar.addEventListener("scrollDown",o=>{var a;i.table.eventManager.LastBodyPointerXY={x:o.x,y:o.y},i.table.eventManager.isDown=!0,e.interactionState!==oe.scrolling&&e.updateInteractionState(oe.scrolling),i.table.stateManager.hideMenu(),(a=i.table.editorManager)===null||a===void 0||a.completeEdit(),i.table.hasListeners(mt.MOUSEDOWN_TABLE)&&i.table.fireListeners(mt.MOUSEDOWN_TABLE,{event:o.nativeEvent})}),i.component.vScrollBar.addEventListener("pointerup",()=>{e.fastScrolling=!1,i.table.eventManager.isDraging=!1,e.interactionState===oe.scrolling&&e.updateInteractionState(oe.default)}),i.component.vScrollBar.addEventListener("pointerupoutside",()=>{e.fastScrolling=!1,e.interactionState===oe.scrolling&&e.updateInteractionState(oe.default)}),i.component.vScrollBar.addEventListener("scrollUp",o=>{i.table.eventManager.isDraging=!1}),i.component.hScrollBar.addEventListener("pointermove",o=>{i.table.stateManager.updateCursor("default"),o.stopPropagation()}),i.component.hScrollBar.addEventListener("pointerdown",o=>{o.stopPropagation(),i.table.hasListeners(mt.MOUSEDOWN_TABLE)&&i.table.fireListeners(mt.MOUSEDOWN_TABLE,{event:o.nativeEvent})}),i.component.hScrollBar.addEventListener("scrollDown",o=>{var a;i.table.eventManager.LastBodyPointerXY={x:o.x,y:o.y},i.table.eventManager.isDown=!0,e.interactionState!==oe.scrolling&&e.updateInteractionState(oe.scrolling),i.table.stateManager.hideMenu(),(a=i.table.editorManager)===null||a===void 0||a.completeEdit(),i.table.hasListeners(mt.MOUSEDOWN_TABLE)&&i.table.fireListeners(mt.MOUSEDOWN_TABLE,{event:o.nativeEvent})}),i.component.hScrollBar.addEventListener("pointerup",()=>{e.fastScrolling=!1,i.table.eventManager.isDraging=!1,e.interactionState===oe.scrolling&&e.updateInteractionState(oe.default)}),i.component.hScrollBar.addEventListener("pointerupoutside",()=>{e.fastScrolling=!1,e.interactionState===oe.scrolling&&e.updateInteractionState(oe.default)}),i.component.hScrollBar.addEventListener("scrollUp",o=>{i.table.eventManager.isDraging=!1});const r=Zj(e.updateVerticalScrollBar,20),s=Zj(e.updateHorizontalScrollBar,20);i.component.vScrollBar.addEventListener("scrollDrag",o=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),e.fastScrolling=!0,e.interactionState!==oe.scrolling&&e.updateInteractionState(oe.scrolling);const a=o.detail.value[0]/(1-o.detail.value[1]+o.detail.value[0]);r(a,o)}),i.component.hScrollBar.addEventListener("scrollDrag",o=>{i.table.eventManager.isDown&&(i.table.eventManager.isDraging=!0),e.fastScrolling=!0,e.interactionState!==oe.scrolling&&e.updateInteractionState(oe.scrolling);const a=o.detail.value[0]/(1-o.detail.value[1]+o.detail.value[0]);s(a)})}let Cu=1;function sZ(){return qK?Cu=1:(Cu=Math.ceil(window.devicePixelRatio||1),Cu>1&&Cu%2!=0&&(Cu+=1)),Cu}sZ();var jxt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function Nxt(n){const t=n.table,e=t.stateManager,i=t.internalProps.handler;function r(p){var f;if(t.hasListeners(mt.KEYDOWN)){const m={keyCode:(f=p.keyCode)!==null&&f!==void 0?f:p.which,code:p.code,event:p,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth};t.fireListeners(mt.KEYDOWN,m)}}i.on(t.getElement(),"blur",p=>{n.dealTableHover()}),i.on(t.getElement(),"keydown",p=>{var f,m,v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H;const z={keyCode:(f=p.keyCode)!==null&&f!==void 0?f:p.which,code:p.code,event:p};if(t.fireListeners(mt.BEFORE_KEYDOWN,z),p.key==="a"&&(p.ctrlKey||p.metaKey))!((m=t.keyboardOptions)===null||m===void 0)&&m.selectAllOnCtrlA&&(p.preventDefault(),n.deelTableSelectAll());else if(e.select.cellPos.col>=0&&e.select.cellPos.row>=0&&(p.key==="ArrowUp"||p.key==="ArrowDown"||p.key==="ArrowLeft"||p.key==="ArrowRight")){if(((_=(v=t.options.keyboardOptions)===null||v===void 0?void 0:v.moveEditCellOnArrowKeys)===null||_===void 0||!_)&&(!((b=t.editorManager)===null||b===void 0)&&b.editingEditor)||((y=t.options.keyboardOptions)===null||y===void 0?void 0:y.moveSelectedCellOnArrowKeys)===!1)return;let F,j;if(p.preventDefault(),p.stopPropagation(),p.key==="ArrowUp"?p.ctrlKey||p.metaKey?(F=e.select.cellPos.col,j=0):(p.shiftKey,F=e.select.cellPos.col,j=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row-1))):p.key==="ArrowDown"?p.ctrlKey||p.metaKey?(F=e.select.cellPos.col,j=t.rowCount-1):(p.shiftKey,F=e.select.cellPos.col,j=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row+1))):p.key==="ArrowLeft"?p.ctrlKey||p.metaKey?(F=0,j=e.select.cellPos.row):(p.shiftKey,j=e.select.cellPos.row,F=Math.min(t.colCount-1,Math.max(0,e.select.cellPos.col-1))):p.key==="ArrowRight"&&(p.ctrlKey||p.metaKey?(F=t.colCount-1,j=e.select.cellPos.row):(p.shiftKey,j=e.select.cellPos.row,F=Math.min(t.colCount-1,Math.max(0,e.select.cellPos.col+1)))),qh(t,F,j))return;t.selectCell(F,j,p.shiftKey),(S=(C=t.options.keyboardOptions)===null||C===void 0?void 0:C.moveEditCellOnArrowKeys)!==null&&S!==void 0&&S&&(!((w=t.editorManager)===null||w===void 0)&&w.editingEditor)&&(t.editorManager.completeEdit(),t.getElement().focus(),t.getEditor(F,j)&&t.editorManager.startEditCell(F,j))}else if(p.key==="Escape")(x=t.editorManager)===null||x===void 0||x.cancelEdit(),t.getElement().focus();else if(p.key==="Enter"){if(!((A=t.editorManager)===null||A===void 0)&&A.editingEditor){if(r(p),t.editorManager.completeEdit(),t.getElement().focus(),((M=t.options.keyboardOptions)===null||M===void 0?void 0:M.moveFocusCellOnEnter)===!0){const F=e.select.cellPos.col,j=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row+1));if(qh(t,F,j))return;t.selectCell(F,j,p.shiftKey)}return}if(((T=t.options.keyboardOptions)===null||T===void 0?void 0:T.moveFocusCellOnEnter)===!0){const F=e.select.cellPos.col,j=Math.min(t.rowCount-1,Math.max(0,e.select.cellPos.row+1));if(qh(t,F,j))return;t.selectCell(F,j,p.shiftKey)}else if(((B=(R=t.options.keyboardOptions)===null||R===void 0?void 0:R.editCellOnEnter)===null||B===void 0||B)&&((k=(E=t.stateManager.select.ranges)===null||E===void 0?void 0:E.length)!==null&&k!==void 0?k:0)===1){const F=t.stateManager.select.ranges[0].start.col,j=t.stateManager.select.ranges[0].start.row,$=t.stateManager.select.ranges[0].end.col,Y=t.stateManager.select.ranges[0].end.row;F===$&&j===Y&&t.getEditor(F,j)&&t.editorManager.startEditCell(F,j)}}else if(p.key==="Tab"){if(((I=(P=t.options.keyboardOptions)===null||P===void 0?void 0:P.moveFocusCellOnTab)===null||I===void 0||I)&&e.select.cellPos.col>=0&&e.select.cellPos.row>=0){if(e.select.cellPos.col===t.colCount-1&&e.select.cellPos.row===t.rowCount-1)return;let F,j;if(p.preventDefault(),e.select.cellPos.col===t.colCount-1?(j=Math.min(t.rowCount-1,e.select.cellPos.row+1),F=t.rowHeaderLevelCount):(j=e.select.cellPos.row,F=e.select.cellPos.col+1),qh(t,F,j))return;t.selectCell(F,j),!((O=t.editorManager)===null||O===void 0)&&O.editingEditor&&(t.editorManager.completeEdit(),t.getElement().focus(),t.getEditor(F,j)&&t.editorManager.startEditCell(F,j))}}else if(!p.ctrlKey&&!p.metaKey){const F=t.options.editCellTrigger;if((F==="keydown"||Array.isArray(F)&&F.includes("keydown"))&&!(!((H=t.editorManager)===null||H===void 0)&&H.editingEditor)){const j=/^[a-zA-Z0-9+\-*\/%=.,\s]$/;p.key.match(j)&&(t.editorManager.beginTriggerEditCellMode="keydown",t.editorManager.startEditCell(e.select.cellPos.col,e.select.cellPos.row,""))}}r(p)}),i.on(t.getElement(),"copy",p=>jxt(this,void 0,void 0,function*(){var f,m;if(!((f=t.keyboardOptions)===null||f===void 0)&&f.copySelected){const v=t.getCopyValue();if(L(v)){p.preventDefault();const _=yield navigator.permissions.query({name:"clipboard-write"});if(!((m=navigator.clipboard)===null||m===void 0)&&m.write&&_.state==="granted"){const b=C=>{const S=["<table>"],w=['<meta name="author" content="Visactor"/>','<style type="text/css">td{white-space:normal}br{mso-data-placement:same-cell}</style>'].join(""),x=C.split(`\r
`);return x.forEach(function(A,M){const T=A.split("	"),R=[];M===0&&S.push("<tbody>"),T.forEach(function(B,E){const k=B?B.toString().replace(/&/g,"&amp;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>").replace(/(<br(\s*|\/)>(\r\n|\n)?|\r\n|\n)/g,`<br>\r
`).replace(/\x20{2,}/gi,P=>`<span style="mso-spacerun: yes">${"&nbsp;".repeat(P.length-1)} </span>`).replace(/\t/gi,"&#9;"):" ";R.push(`<td>${k}</td>`)}),S.push("<tr>",...R,"</tr>"),M===x.length-1&&S.push("</tbody>")}),S.push("</table>"),[w,S.join("")].join("")},y=b(v);navigator.clipboard.write([new ClipboardItem({"text/html":new Blob([y],{type:"text/html"}),"text/plain":new Blob([v],{type:"text/plain"})})])}else a0t.IE?window.clipboardData.setData("Text",v):p.clipboardData.setData("text/plain",v);t.fireListeners(mt.COPY_DATA,{cellRange:t.stateManager.select.ranges,copyData:v})}}})),i.on(t.getElement(),"paste",p=>{var f,m,v,_;if(!((f=t.keyboardOptions)===null||f===void 0)&&f.pasteValueToCell&&t.changeCellValues){if(!((m=t.editorManager)===null||m===void 0)&&m.editingEditor)return;if(((v=t.stateManager.select.ranges)===null||v===void 0?void 0:v.length)>0)if(!((_=navigator.clipboard)===null||_===void 0)&&_.read)navigator.clipboard.read().then(b=>{for(const y of b)y.types.includes("text/html")?a(y):y.types.length===1&&y.types[0]==="text/plain"&&h(y)});else{const b=t.stateManager.select.ranges,y=Math.min(b[0].start.col,b[0].end.col),C=Math.min(b[0].start.row,b[0].end.row),S=(p.clipboardData||window.Clipboard).getData("text").split(`
`),w=[];S.forEach(function(x,A){const M=x.split("	"),T=[];w.push(T),M.forEach(function(R,B){B===M.length-1&&(R=R.trim()),T.push(R)})}),t.changeCellValues(y,C,w)}}}),i.on(t.getElement(),"contextmenu",p=>{var f;((f=t.eventOptions)===null||f===void 0?void 0:f.preventDefaultContextMenu)!==!1?p.preventDefault():c(p)}),t.options.canvas||i.on(t.getContainer(),"resize",p=>{var f;t.isReleased||p.width===0&&p.height===0||((t.autoFillWidth||t.autoFillHeight)&&((f=t.editorManager)===null||f===void 0||f.completeEdit()),L(t.options.pixelRatio)||t.setPixelRatio(sZ()),p.windowSizeNotChange||t.resize())});const s=/<tr[^>]*>([\s\S]*?)<\/tr>/g,o=/<td[^>]*>([\s\S]*?)<\/td>/g;function a(p){const f=t.stateManager.select.ranges,m=f.length,v=Math.min(f[m-1].start.col,f[m-1].end.col),_=Math.min(f[m-1].start.row,f[m-1].end.row),b=Math.max(f[m-1].start.col,f[m-1].end.col),y=Math.max(f[m-1].start.row,f[m-1].end.row);let C=0,S=0,w=[];p.getType("text/html").then(x=>{x.text().then(A=>{var M,T;if(A&&/(<table)|(<TABLE)/g.test(A)){const R=Array.from(A.matchAll(s));for(const B of R){const E=B[1],k=Array.from(E.matchAll(o)).map(P=>P[1].replace(/(<(?!br)([^>]+)>)/gi,"").replace(/<br(\s*|\/)>[\r\n]?/gim,`
`).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&#9;/gi,"	").replace(/&nbsp;/g," "));w.push(k),C=Math.max(C,(M=k==null?void 0:k.length)!==null&&M!==void 0?M:0)}S=(T=w.length)!==null&&T!==void 0?T:0,w=d(w,S,C,y-_+1,b-v+1),t.changeCellValues(v,_,w,!0)}else navigator.clipboard.read().then(R=>{for(const B of R)B.types.includes("text/plain")&&B.getType("text/plain").then(E=>{E.text().then(l)})})})})}function l(p){var f;const m=t.stateManager.select.ranges,v=m.length,_=Math.min(m[v-1].start.col,m[v-1].end.col),b=Math.min(m[v-1].start.row,m[v-1].end.row),y=Math.max(m[v-1].start.col,m[v-1].end.col),C=Math.max(m[v-1].start.row,m[v-1].end.row);let S=0,w=0,x=[];p.split(`
`).forEach(function(A,M){var T;const R=A.split("	"),B=[];x.push(B),R.forEach(function(E,k){k===R.length-1&&(E=E.trim()),B.push(E)}),S=Math.max(S,(T=B==null?void 0:B.length)!==null&&T!==void 0?T:0)}),w=(f=x.length)!==null&&f!==void 0?f:0,x=d(x,w,S,C-b+1,y-_+1),t.changeCellValues(_,b,x,!0)}function h(p){const f=t.stateManager.select.ranges,m=f.length,v=Math.min(f[m-1].start.col,f[m-1].end.col),_=Math.min(f[m-1].start.row,f[m-1].end.row),b=Math.max(f[m-1].start.col,f[m-1].end.col),y=Math.max(f[m-1].start.row,f[m-1].end.row);let C=0,S=0;p.getType("text/plain").then(w=>{w.text().then(x=>{var A;const M=x.replace(/\r(?!\n)/g,`\r
`).split(`\r
`);let T=[];M.length>1&&M[M.length-1]===""&&M.pop(),M.forEach(function(R,B){var E;const k=R.split("	"),P=[];T.push(P),k.forEach(function(I,O){I.includes(`
`)&&(I=I.replace(/^"(.*)"$/,"$1").replace(/["]*/g,H=>new Array(Math.floor(H.length/2)).fill('"').join(""))),P.push(I)}),C=Math.max(C,(E=P==null?void 0:P.length)!==null&&E!==void 0?E:0)}),S=(A=T.length)!==null&&A!==void 0?A:0,T=d(T,S,C,y-_+1,b-v+1),t.changeCellValues(v,_,T,!0)})})}function d(p,f,m,v,_){if(_>m||v>f){if(_%m==0&&v%f==0){const b=[];for(let y=0;y<v;y++){const C=[];b.push(C);for(let S=0;S<_;S++){const w=y%f,x=S%m;C.push(p[w][x])}}return b}return p}return p}const u=p=>{var f;if(t.isReleased)return;t.eventManager.LastBodyPointerXY={x:p.x,y:p.y},t.eventManager.isDown=!0;const m=p.target;if(!t.getElement().contains(m)&&!t.internalProps.menuHandler.containElement(m)){const v=(f=t.editorManager)===null||f===void 0?void 0:f.completeEdit(p);px(v,_=>{var b,y;if(_!==!1&&(!((b=t.options.select)===null||b===void 0)&&b.outsideClickDeselect)){const C=!!(!((y=e.select.ranges)===null||y===void 0)&&y.length);n.dealTableSelect(),e.endSelectCells(!0,C)}})}};n.globalEventListeners.push({name:"pointerdown",env:"vglobal",callback:u}),oi.addEventListener("pointerdown",u);const c=p=>{var f;if(t.isReleased)return;const m=p.target;if(m!==t.canvas&&(v=>{var _,b;if(e.menu.isShow&&setTimeout(()=>{t.internalProps.menuHandler.pointInMenuElement(v.clientX,v.clientY)||e.menu.isShow&&e.hideMenu()},0),e.isResizeCol())Ux(t);else if(e.isResizeRow())Yx(t);else if(e.isMoveCol()){const y=t.stateManager.endMoveCol();fL(t,y,v)}else if(e.isSelecting()&&(!((b=(_=t.stateManager.select)===null||_===void 0?void 0:_.ranges)===null||b===void 0)&&b.length)){const y=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end.col,C=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end.row;if(t.stateManager.endSelectCells(),t.hasListeners(mt.DRAG_SELECT_END)){const S={event:v,cells:[],col:y,row:C,scaleRatio:t.canvas.getBoundingClientRect().width/t.canvas.offsetWidth,target:void 0};S.cells=t.getSelectedCellInfos(),t.fireListeners(mt.DRAG_SELECT_END,S)}}})(p),t.eventManager.LastBodyPointerXY=null,t.eventManager.isDown=!1,t.eventManager.isDraging=!1,t.eventManager.inertiaScroll.endInertia(),e.interactionState==="grabing"&&e.isResizeCol())Ux(t);else if(e.interactionState==="grabing"&&e.isResizeRow())Yx(t);else if(e.isMoveCol()){const v=t.stateManager.endMoveCol();fL(t,v,p)}else if(t.editorManager.editingEditor&&!t.getElement().contains(m)){const v=(f=t.editorManager)===null||f===void 0?void 0:f.completeEdit(p);px(v,_=>{_!==!1&&(e.updateInteractionState(oe.default),n.dealTableHover())})}};n.globalEventListeners.push({name:"pointerup",env:"vglobal",callback:c}),oi.addEventListener("pointerup",c);const g=p=>{var f,m,v,_,b;if(t.eventManager.isDown&&t.eventManager.LastBodyPointerXY){const w=(m=(f=t.eventManager.LastBodyPointerXY)===null||f===void 0?void 0:f.x)!==null&&m!==void 0?m:p.x,x=(_=(v=t.eventManager.LastBodyPointerXY)===null||v===void 0?void 0:v.y)!==null&&_!==void 0?_:p.y;(Math.abs(w-p.x)>1||Math.abs(x-p.y)>1)&&(t.eventManager.isDraging=!0)}const{x:y,y:C}=t._getMouseAbstractPoint(p);e.interactionState===oe.grabing&&(e.isResizeCol()?(n.dealColumnResize(y,C),t.hasListeners(mt.RESIZE_COLUMN)&&t.fireListeners(mt.RESIZE_COLUMN,{col:t.stateManager.columnResize.col,colWidth:t.getColWidth(t.stateManager.columnResize.col)})):e.isResizeRow()&&(n.dealRowResize(y,C),t.hasListeners(mt.RESIZE_ROW)&&t.fireListeners(mt.RESIZE_ROW,{row:t.stateManager.rowResize.row,rowHeight:t.getRowHeight(t.stateManager.rowResize.row)})));const S=t.stateManager.isSelecting();if(n._enableTableScroll&&n.isDraging&&S&&((b=t.stateManager.select.ranges)===null||b===void 0?void 0:b.length)>0){const w=t.getDrawRange(),x=t.getFrozenRowsHeight(),A=t.getBottomFrozenRowsHeight(),M=t.getFrozenColsWidth(),T=t.getRightFrozenColsWidth(),R=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].start;if(t.isSeriesNumber(R.col,R.row))return;const B=t.stateManager.select.ranges[t.stateManager.select.ranges.length-1].end,E=(t.isFrozenRow(R.row)===!1||t.isFrozenRow(B.row)===!1)&&t.getAllRowsHeight()>t.tableNoFrameHeight,k=(t.isFrozenColumn(R.col)===!1||t.isFrozenColumn(B.col)===!1)&&t.getAllColsWidth()>t.tableNoFrameWidth;if((C>w.bottom-A||C<w.top+x)&&E||(y>w.right-T||y<w.left+M)&&k){t.eventManager.scrollXSpeed=0,t.eventManager.scrollYSpeed=0;let P=!1,I=!1,O=!1,H=!1;C>w.bottom-A&&E&&t.scrollTop+t.tableNoFrameHeight<t.getAllRowsHeight()?(P=!0,t.eventManager.scrollYSpeed=-(C-w.bottom+A)/50):C<w.top+x&&E&&t.scrollTop>0&&(I=!0,t.eventManager.scrollYSpeed=-(C-w.top-x)/50),y>w.right-T&&k&&t.scrollLeft+t.tableNoFrameWidth<t.getAllColsWidth()?(O=!0,t.eventManager.scrollXSpeed=-(y-w.right+T)/50):y<w.left+M&&k&&t.scrollLeft>0&&(H=!0,t.eventManager.scrollXSpeed=-(y-w.left-M)/50),t.eventManager.inertiaScroll.startInertia(t.eventManager.scrollXSpeed,t.eventManager.scrollYSpeed,1),t.eventManager.inertiaScroll.setScrollHandle((z,F)=>{var j;let $,Y;Gx({deltaX:-z,deltaY:-F},t.stateManager,!1),P?Y=t.scrollTop+w.height-A-20:I&&(Y=t.scrollTop+x+20),O?$=t.scrollLeft+w.width-T-20:H&&($=t.scrollLeft+M+20);let G=!1,tt=!1;O||H||(y>t.tableNoFrameWidth-t.getRightFrozenColsWidth()&&y<t.tableNoFrameWidth||y>0&&y<t.getFrozenColsWidth()?($=y,tt=!0):$=t.scrollLeft+y),P||I||(C>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight()&&C<t.tableNoFrameHeight||C>0&&C<t.getFrozenRowsHeight()?(Y=C,G=!0):Y=t.scrollTop+C),t.stateManager.updateInteractionState(oe.grabing);const st=t.getTargetColAtConsiderRightFrozen($,tt),ot=t.getTargetRowAtConsiderBottomFrozen(Y,G);!(!((j=t.options.select)===null||j===void 0)&&j.disableDragSelect)&&L(st)&&L(ot)&&t.stateManager.updateSelectPos(st.col,ot.row,!1,!1,!1,!1)})}else t.eventManager.inertiaScroll.isInertiaScrolling()?t.eventManager.inertiaScroll.endInertia():t.eventManager.scrollYSpeed=0}};n.globalEventListeners.push({name:"pointermove",env:"vglobal",callback:g}),oi.addEventListener("pointermove",g)}function $xt(n){const t=n.table,e=t.stateManager,i=t.scenegraph;if(oi.envContribution.supportsTouchEvents===!1)return;oi.addEventListener("contextmenu",a=>{a.stopPropagation(),a.preventDefault()},{capture:!0}),n.touchMovePoints=[],t.scenegraph.tableGroup.addEventListener("touchstart",a=>{var l,h,d,u,c,g,p,f;if(a.target.isChildOf(i.component.vScrollBar)||a.target.isChildOf(i.component.vScrollBar))return;n.isTouchdown=!0;const m=a.nativeEvent;n.touchMovePoints.push({x:t.rotateDegree?(d=(h=(l=m.changedTouches)===null||l===void 0?void 0:l[0])===null||h===void 0?void 0:h._canvasX)!==null&&d!==void 0?d:(u=a.canvas)===null||u===void 0?void 0:u.x:a.page.x,y:t.rotateDegree?(p=(g=(c=m.changedTouches)===null||c===void 0?void 0:c[0])===null||g===void 0?void 0:g._canvasY)!==null&&p!==void 0?p:(f=a.canvas)===null||f===void 0?void 0:f.y:a.page.y,timestamp:Date.now()})});const r=a=>{var l,h;if(n.isLongTouch&&a.preventDefault(),n.isTouchdown&&n$(a)){if(n.isTouchMove=!0,((h=(l=n.downIcon)===null||l===void 0?void 0:l.attribute)===null||h===void 0?void 0:h.funcType)===si.dragReorder)a.preventDefault();else if(n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:t.rotateDegree?a.changedTouches[0]._canvasX:a.changedTouches[0].pageX,y:t.rotateDegree?a.changedTouches[0]._canvasY:a.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll){const d=-n.touchMovePoints[n.touchMovePoints.length-1].x+n.touchMovePoints[n.touchMovePoints.length-2].x,u=-n.touchMovePoints[n.touchMovePoints.length-1].y+n.touchMovePoints[n.touchMovePoints.length-2].y;Gx({deltaX:d,deltaY:u},e),a.cancelable&&(t.internalProps.overscrollBehavior==="none"||Math.abs(u)>=Math.abs(d)&&u!==0&&nZ(u,e)||Math.abs(u)<=Math.abs(d)&&d!==0&&rZ(d,e))&&a.preventDefault()}}};oi.addEventListener("touchmove",r,{passive:!1}),n.globalEventListeners.push({name:"touchmove",env:"vglobal",callback:r});const s=a=>{var l,h,d,u;if(n.touchEnd=!0,n.isLongTouch=!1,n.isTouchdown&&n$(a)){if(((h=(l=n.downIcon)===null||l===void 0?void 0:l.attribute)===null||h===void 0?void 0:h.funcType)===si.dragReorder)a.preventDefault();else if(!((d=n.touchMovePoints)===null||d===void 0)&&d.length&&(n.touchMovePoints.length>4&&n.touchMovePoints.shift(),n.touchMovePoints.push({x:t.rotateDegree?a.changedTouches[0]._canvasX:a.changedTouches[0].pageX,y:t.rotateDegree?a.changedTouches[0]._canvasY:a.changedTouches[0].pageY,timestamp:Date.now()}),n._enableTableScroll)){const c=n.touchMovePoints[0],g=n.touchMovePoints[((u=n.touchMovePoints)===null||u===void 0?void 0:u.length)-1],p=(g.x-c.x)/(g.timestamp-c.timestamp),f=(g.y-c.y)/(g.timestamp-c.timestamp);n.inertiaScroll.startInertia(p,f,.95),t.eventManager.inertiaScroll.setScrollHandle((m,v)=>{Gx({deltaX:-m,deltaY:-v},t.stateManager)})}n.isTouchdown=!1,n.isTouchMove=!1,n.isDraging=!1,n.touchMovePoints=[]}};oi.addEventListener("touchend",s),n.globalEventListeners.push({name:"touchend",env:"vglobal",callback:s});const o=a=>{n.touchEnd=!0,n.isLongTouch=!1,n.isTouchdown&&(n.isTouchdown=!1,n.isTouchMove=!1,n.touchMovePoints=[],n.isDraging=!1)};oi.addEventListener("touchcancel",o),n.globalEventListeners.push({name:"touchcancel",env:"vglobal",callback:o})}function n$(n){return!!n.changedTouches}function Vxt(n){n.isPivotChart()&&n.scenegraph.tableGroup.addEventListener("click",t=>{var e;if(!n.stateManager.columnMove.moving&&!n.stateManager.columnResize.resizing)if(t.target.name==="axis-label"){const i=In(t),{col:r,row:s}=i.eventArgs,o=n.internalProps.layoutMap;let a,l;o.indicatorsAsCol?(a=o.getDimensionKeyInChartSpec(o.rowHeaderLevelCount,s),l=o.getCellHeaderPaths(o.rowHeaderLevelCount-2,s).rowHeaderPaths):(a=o.getDimensionKeyInChartSpec(r,o.columnHeaderLevelCount),l=o.getCellHeaderPaths(r,o.columnHeaderLevelCount-1).colHeaderPaths);const h=l.map(d=>({key:d.dimensionKey,value:d.value})).filter(d=>d.key);if(h.push({key:a,value:t.target.attribute.text}),n._selectedDimensionInChart.length&&Gxt(n._selectedDimensionInChart,h))return;n._selectedDimensionInChart=h,o.updateDataStateToChartInstance(),gL(n.scenegraph),n.scenegraph.updateNextFrame()}else!((e=n._selectedDimensionInChart)===null||e===void 0)&&e.length&&(n._selectedDimensionInChart.length=0,n.internalProps.layoutMap.updateDataStateToChartInstance(),gL(n.scenegraph),n.scenegraph.updateNextFrame())})}function Gxt(n,t){if(n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e].key!==t[e].key||n[e].value!==t[e].value)return!1;return!0}function Uxt(n){n.isPivotChart()&&(n.on(mt.MOUSEENTER_CELL,t=>{n.scenegraph.getCell(t.col,t.row).forEachChildren(e=>{if(e.name==="axis"){const i=r$(t.col,t.row,n.internalProps.layoutMap);t.axisPosition=i,n.fireListeners(mt.MOUSEENTER_AXIS,t)}})}),n.on(mt.MOUSELEAVE_CELL,t=>{n.scenegraph.getCell(t.col,t.row).forEachChildren(e=>{if(e.name==="axis"){const i=r$(t.col,t.row,n.internalProps.layoutMap);t.axisPosition=i,n.fireListeners(mt.MOUSELEAVE_AXIS,t)}})}))}function r$(n,t,e){if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"top";if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"bottom";if(n===e.rowHeaderLevelCount-1&&t>=e.rowHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"left"}else{if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"left";if(n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return"right";if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return"bottom"}return"bottom"}function Yxt(n){n.on("checkbox_state_change",t=>{var e,i;const{col:r,row:s,checked:o,field:a}=t;if(a!=="_vtable_rowSeries_number"||((e=n.internalProps.rowSeriesNumber)===null||e===void 0?void 0:e.enableTreeCheckbox)!==!0||n.isHeader(r,s))return;const l=n.getCellOriginRecord(r,s),h=n.dataSource.currentPagerIndexedData,d=n.getRecordShowIndexByCell(r,s);let u=h[d];if(J(u)&&(u=[u]),l.vtableMerge||((i=l.children)===null||i===void 0?void 0:i.length))if(o)a$(n,r,s)===se.collapse?o$(!0,u,n):s$(!0,d,u,h,n),ZR(d,u,h,n);else{a$(n,r,s)===se.collapse?o$(!1,u,n):s$(!1,d,u,h,n),ZR(d,u,h,n);const c=n.stateManager.headerCheckedState._vtable_rowSeries_number,g=n.stateManager.updateHeaderCheckedState("_vtable_rowSeries_number",r,s);c!==g&&n.scenegraph.updateHeaderCheckboxCellState(r,s,g)}else ZR(d,u,h,n)})}function s$(n,t,e,i,r){var s;let o=t+1;for(;V(i[o])&&((s=i[o])===null||s===void 0?void 0:s.length)>e.length;){const a=r.columnHeaderLevelCount+o;r.stateManager.setCheckedState(0,a,"_vtable_rowSeries_number",n),wC(0,a,n,r),o++}}function ZR(n,t,e,i){var r;let s=t.length-1;if(s>0){let o=n-1;for(;s>0&&o>=0;)(V(e[o])&&((r=e[o])===null||r===void 0?void 0:r.length)===s||s===1&&J(e[o]))&&(Xxt(0,i.columnHeaderLevelCount+o,e[o],i),s--),o--}}function Xxt(n,t,e,i){const{checkedState:r}=i.stateManager,s=e.toString(),o=V(e)?e.length:1;let a=!1;const l=[],h=Array.from(r.keys()).sort((g,p)=>{var f,m;const v=g.split(","),_=p.split(","),b=Math.max(v.length,_.length);for(let y=0;y<b;y++){const C=(f=Number(v[y]))!==null&&f!==void 0?f:0,S=(m=Number(_[y]))!==null&&m!==void 0?m:0;if(C!==S)return C-S}return 0});if(h.map(g=>r.get(g)).forEach((g,p)=>{const f=h[p],m=g;a&&(f.split(",").length===o?a=!1:l.push(m._vtable_rowSeries_number)),f===s&&(a=!0)}),l.length===0)return;const u=l.every(g=>!!g),c=l.every(g=>!g);u?(i.stateManager.setCheckedState(n,t,"_vtable_rowSeries_number",!0),wC(n,t,!0,i)):c?(i.stateManager.setCheckedState(n,t,"_vtable_rowSeries_number",!1),wC(n,t,!1,i)):(i.stateManager.setCheckedState(n,t,"_vtable_rowSeries_number","indeterminate"),wC(n,t,"indeterminate",i))}function o$(n,t,e){const{checkedState:i}=e.stateManager,r=t.toString(),s=V(t)?t.length:1;let o=!1;const a=Array.from(i.keys()).sort((h,d)=>{var u,c;const g=h.split(","),p=d.split(","),f=Math.max(g.length,p.length);for(let m=0;m<f;m++){const v=(u=Number(g[m]))!==null&&u!==void 0?u:0,_=(c=Number(p[m]))!==null&&c!==void 0?c:0;if(v!==_)return v-_}return 0});a.map(h=>i.get(h)).forEach((h,d)=>{const u=a[d],c=h;o&&(u.split(",").length===s?o=!1:c._vtable_rowSeries_number=n),u===r&&(o=!0)})}function Kxt(n){n.on("checkbox_state_change",t=>{const{col:e,row:i,checked:r,field:s}=t;if(n.isHeader(e,i))n.stateManager.setHeaderCheckedState(s,r),n.getCellType(e,i)==="checkbox"&&n.scenegraph.updateCheckboxCellState(e,i,r);else if(n.stateManager.setCheckedState(e,i,s,r),n.getCellType(e,i)==="checkbox"){const o=n.stateManager.headerCheckedState[s],a=n.stateManager.updateHeaderCheckedState(s,e,i);o!==a&&n.scenegraph.updateHeaderCheckboxCellState(e,i,a)}})}function a$(n,t,e){const i=n.getRecordShowIndexByCell(t,e);return n.dataSource.getHierarchyState(i)}function qxt(n){n.on(mt.CLICK_CELL,t=>{const{col:e,row:i,target:r}=t;r.name!=="button"||r.attribute.disable||n.hasListeners(mt.BUTTON_CLICK)&&n.fireListeners(mt.BUTTON_CLICK,{col:e,row:i,event:t.event})})}function Zxt(n){n.on(mt.ICON_CLICK,t=>{var e;const{col:i,row:r,x:s,y:o,funcType:a,icon:l,event:h}=t,{stateManager:d}=n;if(a===si.dropDown)d.triggerDropDownMenu(i,r,s,o,h);else if(a===si.sort)d.triggerSort(i,r,l,h);else if(a===si.frozen)d.triggerFreeze(i,r,l);else if(a===si.drillDown)Rxt(n);else if(a===si.collapse||a===si.expand){const u=!!(!((e=d.select.ranges)===null||e===void 0)&&e.length);d.updateSelectPos(-1,-1),d.endSelectCells(!0,u),n.toggleHierarchyState(i,r)}})}function Jxt(n){n.on(mt.DROPDOWN_MENU_CLICK,()=>{n.stateManager.hideMenu()})}function Qxt(n){n.on(mt.DBLCLICK_CELL,t=>{var e,i,r;if(t.federatedEvent){const s=In(t.federatedEvent),o=n.scenegraph.getResizeColAt(s.abstractPos.x,s.abstractPos.y,(e=s.eventArgs)===null||e===void 0?void 0:e.targetCell),a=(i=n.options.disableDblclickAutoResizeColWidth)!==null&&i!==void 0?i:(r=n.options.resize)===null||r===void 0?void 0:r.disableDblclickAutoResizeColWidth;if(n.eventManager.checkCellFillhandle(s))n.fireListeners(mt.DBLCLICK_FILL_HANDLE,{});else if(n._canResizeColumn(o.col,o.row)&&o.col>=0&&!a){n.scenegraph.updateAutoColWidth(o.col),n.internalProps._widthResizedColMap.add(o.col),n.scenegraph.updateChartSizeForResizeColWidth(o.col);const l=n.stateManager;l.columnResize.col<l.table.frozenColCount&&!l.table.isPivotTable()&&!l.table.transpose&&l.table.scenegraph.component.setFrozenColumnShadow(l.table.frozenColCount-1,l.columnResize.isRightFrozen);const h=[];for(let d=0;d<n.colCount;d++)h.push(n.getColWidth(d));n.fireListeners(mt.RESIZE_COLUMN_END,{col:o.col,colWidths:h})}}})}function t1t(n){n.on(mt.CONTEXTMENU_CELL,t=>{const{col:e,row:i}=t,r=n.getSelectedCellRanges();let s=!1;if(r.length>0)for(let o=0;o<r.length;o++){const a=r[o];if(e>=a.start.col&&e<=a.end.col&&i>=a.start.row&&i<=a.end.row){s=!0;break}}s||n.selectCell(e,i)})}let e1t=class{constructor(t){this.isDown=!1,this.isDraging=!1,this.globalEventListeners=[],this._enableTableScroll=!0,this.table=t,this.handleTextStickBindId=[],this.inertiaScroll=new Dxt(t.stateManager),We.mode==="node"||t.options.disableInteraction||(this.bindOuterEvent(),setTimeout(()=>{this.bindSelfEvent()},0))}bindOuterEvent(){Fxt(this),Nxt(this),Wxt(this),$xt(this),Hxt(this)}updateEventBinder(){setTimeout(()=>{var t;this.table.isReleased||($x(this.table)&&((t=this.handleTextStickBindId)===null||t===void 0?void 0:t.length)===0?(this.handleTextStickBindId.push(this.table.on(mt.SCROLL,e=>{xv(this.table)})),this.handleTextStickBindId.push(this.table.on(mt.RESIZE_COLUMN_END,e=>{xv(this.table)})),this.handleTextStickBindId.push(this.table.on(mt.RESIZE_ROW_END,e=>{xv(this.table)}))):!$x(this.table)&&this.handleTextStickBindId&&(this.handleTextStickBindId.forEach(e=>{this.table.off(e)}),this.handleTextStickBindId=[]),i$(this.table))},0)}bindSelfEvent(){this.table.isReleased||(Zxt(this.table),Jxt(this.table),this.updateEventBinder(),Txt(this.table),Qxt(this.table),this.table.isPivotTable()&&Bxt(this.table)&&kxt(this.table),i$(this.table),Vxt(this.table),Uxt(this.table),Yxt(this.table),Kxt(this.table),qxt(this.table),t1t(this.table))}dealTableHover(t){if(!t)return void this.table.stateManager.updateHoverPos(-1,-1);const{eventArgs:e}=t;e?this.table.stateManager.updateHoverPos(e.col,e.row):this.table.stateManager.updateHoverPos(-1,-1)}dealIconHover(t){const{eventArgs:e}=t;e?this.table.stateManager.updateHoverIcon(e.col,e.row,e.target,e.targetCell):this.table.stateManager.updateHoverIcon(-1,-1,void 0,void 0)}dealMenuHover(t){}dealTableSelect(t,e){var i,r,s,o,a;if(!t)return this.table.stateManager.updateSelectPos(-1,-1),!1;const{eventArgs:l}=t;if(l){if(l.target.name==="checkbox"||l.target.name==="radio"||l.target.name==="switch"||l.target.name==="button")return!1;if(this.table.isHeader(l.col,l.row)&&qh(this.table,l.col,l.row))return e||this.table.stateManager.updateSelectPos(-1,-1),!1;if(!this.table.isHeader(l.col,l.row)&&qh(this.table,l.col,l.row)){if(!e){const h=!!(!((i=this.table.stateManager.select.ranges)===null||i===void 0)&&i.length);this.table.stateManager.updateSelectPos(-1,-1),h&&this.table.stateManager.endSelectCells(!0,h)}return!1}return!this.table.isPivotChart()||((r=t==null?void 0:t.eventArgs)===null||r===void 0?void 0:r.target.name)!=="axis-label"&&((s=t==null?void 0:t.eventArgs)===null||s===void 0?void 0:s.target.type)!=="chart"?(this.table.stateManager.updateSelectPos(l.col,l.row,l.event.shiftKey,l.event.ctrlKey||l.event.metaKey,!1,!e&&((a=(o=this.table.options.select)===null||o===void 0?void 0:o.makeSelectCellVisible)===null||a===void 0||a)),!0):(this.table.stateManager.updateSelectPos(-1,-1),!1)}return!1}dealFillSelect(t,e){var i,r;const{eventArgs:s}=t;if(s){if(!((r=(i=this.table.stateManager.select)===null||i===void 0?void 0:i.ranges)===null||r===void 0)&&r.length&&this.table.stateManager.isFillHandle()){let o,a;const l=this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1];e&&(L(this.table.stateManager.fillHandle.directionRow)||(Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.directionRow=!0:this.table.stateManager.fillHandle.directionRow=!1),Math.abs(this.table.stateManager.fillHandle.startY-t.abstractPos.y)>=Math.abs(this.table.stateManager.fillHandle.startX-t.abstractPos.x)?this.table.stateManager.fillHandle.startY-t.abstractPos.y>0?this.table.stateManager.fillHandle.direction="top":this.table.stateManager.fillHandle.direction="bottom":this.table.stateManager.fillHandle.startX-t.abstractPos.x>0?this.table.stateManager.fillHandle.direction="left":this.table.stateManager.fillHandle.direction="right",this.table.stateManager.fillHandle.directionRow?(o=s.row,a=l.end.col):(o=l.end.row,a=s.col)),this.table.stateManager.updateSelectPos(e?a:l.end.col,e?o:l.end.row,!0,s.event.ctrlKey||s.event.metaKey,!1,!e)}else this.table.stateManager.updateSelectPos(s.col,s.row,s.event.shiftKey,s.event.ctrlKey||s.event.metaKey,!1,!e);return!0}return!1}deelTableSelectAll(){this.table.stateManager.updateSelectPos(-1,-1,!1,!1,!0),this.table.fireListeners(mt.SELECTED_CELL,{ranges:this.table.stateManager.select.ranges,col:0,row:0})}dealMenuSelect(t){}checkColumnResize(t,e){const{eventArgs:i}=t;if(this.table.options.enableTreeStickCell&&!i)return!1;const r=this.table.scenegraph.getResizeColAt(t.abstractPos.x,t.abstractPos.y,i==null?void 0:i.targetCell);return this.table._canResizeColumn(r.col,r.row)&&r.col>=0?(e&&this.table.stateManager.startResizeCol(r.col,t.abstractPos.x,t.abstractPos.y,r.rightFrozen),!0):(this.table.stateManager.isResizeCol()&&this.table.stateManager.endResizeCol(),!1)}checkRowResize(t,e){const{eventArgs:i}=t;if(i){const r=this.table.scenegraph.getResizeRowAt(t.abstractPos.x,t.abstractPos.y,i.targetCell);if(this.table._canResizeRow(r.col,r.row)&&r.row>=0)return e&&this.table.stateManager.startResizeRow(r.row,t.abstractPos.x,t.abstractPos.y,r.bottomFrozen),!0}return!1}cellIsHeaderCheck(t,e){const{eventArgs:i}=t,{col:r,row:s,target:o}=i;return this.table.isHeader(r,s)?this.table.getCellType(i.col,i.row)==="checkbox"&&o.name==="checkbox":!1}checkCellFillhandle(t,e){var i,r,s,o,a;let l=!1;if(l=typeof((i=this.table.options.excelOptions)===null||i===void 0?void 0:i.fillHandle)=="function"?this.table.options.excelOptions.fillHandle({selectRanges:this.table.stateManager.select.ranges,table:this.table}):(r=this.table.options.excelOptions)===null||r===void 0?void 0:r.fillHandle,l){const{eventArgs:h}=t;if(h&&(!((o=(s=this.table.stateManager.select)===null||s===void 0?void 0:s.ranges)===null||o===void 0)&&o.length)){const d=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),u=Math.max(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row),c=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.col,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.col),g=Math.min(this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].start.row,this.table.stateManager.select.ranges[this.table.stateManager.select.ranges.length-1].end.row);let p;p=d<this.table.colCount-1?this.table.scenegraph.highPerformanceGetCell(d,u).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(c-1,u).globalAABBBounds;const f=Math.abs(t.abstractPos.x-p.x2);p=u<this.table.rowCount-1?this.table.scenegraph.highPerformanceGetCell(d,u).globalAABBBounds:this.table.scenegraph.highPerformanceGetCell(d,g-1).globalAABBBounds;const m=Math.abs(t.abstractPos.y-p.y2),v=18;if(!((a=this.table.stateManager.fillHandle)===null||a===void 0)&&a.isFilling||f<=v/2&&m<=v/2)return e&&this.table.stateManager.startFillSelect(t.abstractPos.x,t.abstractPos.y),!0}}return!1}dealColumnResize(t,e){this.table.stateManager.updateResizeCol(t,e)}dealRowResize(t,e){this.table.stateManager.updateResizeRow(t,e)}checkColumnMover(t){var e;const{eventArgs:i}=t;return!(!i||!this.table._canDragHeaderPosition(i.col,i.row))&&(this.table.stateManager.startMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,(e=i==null?void 0:i.event)===null||e===void 0?void 0:e.nativeEvent),!0)}dealColumnMover(t){var e;const{eventArgs:i}=t;L(i.col)&&L(i.row)&&this.table.stateManager.updateMoveCol(i.col,i.row,t.abstractPos.x,t.abstractPos.y,(e=i==null?void 0:i.event)===null||e===void 0?void 0:e.nativeEvent)}startColumnResize(t){}dealIconClick(t,e){const{eventArgs:i}=e,{target:r,event:s,col:o,row:a}=i||{target:t.target,event:t,col:-1,row:-1},l=r;if(l.role&&l.role.startsWith("icon-"))return this.table.fireListeners(mt.ICON_CLICK,{name:l.name,x:(l.globalAABBBounds.x1+l.globalAABBBounds.x2)/2,y:l.globalAABBBounds.y2,col:o,row:a,funcType:l.attribute.funcType,icon:l,event:s}),!0;if(r instanceof Wd){const h=r.pickIcon(s.global);if(h)return this.table.fireListeners(mt.ICON_CLICK,{name:h.attribute.id,x:h.globalX+h.globalAABBBounds.width()/2,y:h.globalY+h.AABBBounds.height(),col:o,row:a,funcType:h.attribute.funcType,icon:h,event:s}),!0}return!1}release(){this.gesture.release(),this.globalEventListeners.forEach(t=>{t.env==="document"?document.removeEventListener(t.name,t.callback):t.env==="body"?document.body.removeEventListener(t.name,t.callback):t.env==="window"?window.removeEventListener(t.name,t.callback):t.env==="vglobal"&&oi.removeEventListener(t.name,t.callback)}),this.globalEventListeners=[]}enableScroll(){this._enableTableScroll=!0}disableScroll(){this._enableTableScroll=!1}},l$;const i1t=n=>{const t=n.value;return Number(t)>80?"#20a8d8":Number(t)>50?"#4dbd74":Number(t)>20?"#ffc107":"#f86c6b"};class Xx extends na{static get DEFAULT(){return l$||(l$=new Xx)}constructor(t={},e={}){var i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_;super(t,e),this._showBar=(i=t.showBar)===null||i===void 0||i,this._barColor=(r=t.barColor)!==null&&r!==void 0?r:i1t,this._barPositiveColor=(s=t.barPositiveColor)!==null&&s!==void 0?s:"#4dbd74",this._barNegativeColor=(o=t.barNegativeColor)!==null&&o!==void 0?o:"#f86c6b",this._barAxisColor=(a=t.barAxisColor)!==null&&a!==void 0?a:"black",this._barBgColor=t.barBgColor,this._barHeight=(l=t.barHeight)!==null&&l!==void 0?l:3,this._barHeight=(h=t.barHeight)!==null&&h!==void 0?h:3,this._barBottom=(d=t.barBottom)!==null&&d!==void 0?d:0,this._barPadding=(u=t.barPadding)!==null&&u!==void 0?u:[0,0,0,0],this._showBarMark=(c=t.showBarMark)!==null&&c!==void 0&&c,this._barMarkPositiveColor=(g=t.barMarkPositiveColor)!==null&&g!==void 0?g:"#4dbd74",this._barMarkNegativeColor=(p=t.barMarkNegativeColor)!==null&&p!==void 0?p:"#f86c6b",this._barMarkWidth=(f=t.barMarkWidth)!==null&&f!==void 0?f:2,this._barMarkPosition=(m=t.barMarkPosition)!==null&&m!==void 0?m:"right",this._barRightToLeft=(v=t.barRightToLeft)!==null&&v!==void 0&&v,this._barMarkInBar=(_=t.barMarkInBar)===null||_===void 0||_}get showBar(){return this._showBar}set showBar(t){this._showBar=t}get barColor(){return this._barColor}set barColor(t){this._barColor=t}get barBgColor(){return this._barBgColor}set barBgColor(t){this._barBgColor=t}get barHeight(){return this._barHeight}set barHeight(t){this._barHeight=t}get barBottom(){return this._barBottom}set barBottom(t){this._barBottom=t}get barPositiveColor(){return this._barPositiveColor}set barPositiveColor(t){this._barPositiveColor=t}get barNegativeColor(){return this._barNegativeColor}set barNegativeColor(t){this._barNegativeColor=t}get barAxisColor(){return this._barAxisColor}set barAxisColor(t){this._barAxisColor=t}get barPadding(){return this._barPadding}set barPadding(t){this._barPadding=t}get showBarMark(){return this._showBarMark}set showBarMark(t){this._showBarMark=t}get barMarkPositiveColor(){return this._barMarkPositiveColor}set barMarkPositiveColor(t){this._barMarkPositiveColor=t}get barMarkNegativeColor(){return this._barMarkNegativeColor}set barMarkNegativeColor(t){this._barMarkNegativeColor=t}get barMarkWidth(){return this._barMarkWidth}set barMarkWidth(t){this._barMarkWidth=t}get barMarkPosition(){return this._barMarkPosition}set barMarkPosition(t){this._barMarkPosition=t}get barRightToLeft(){return this._barRightToLeft}set barRightToLeft(t){this._barRightToLeft=t}get barMarkInBar(){return this._barMarkInBar}set barMarkInBar(t){this._barMarkInBar=t}clone(){return new Xx(this,null)}}const n1t=["type","content","style","color","width","height","marginRight","marginLeft","src","svg","name","path","positionType","tooltip","hover","cursor","shape","interactive","isGif"],r1t=n1t;class s1t{constructor(t){this._table=t;const e=ra();this.expandIcon=e[Er.expandIconName],this.collapseIcon=e[Er.collapseIconName]}getIcons(t,e,i,r,s){const o=[],a=this.getHierarchyIcon(t,e);a&&o.push(a);const{icon:l}=this._table.getBodyColumnDefine(t,e);if(l){let h;typeof l=="function"?h=l({col:t,row:e,value:i,dataValue:r,table:this._table}):h=l;const d=ra(),u=c=>{let g;g=typeof c=="string"?d[c]:c,g&&o.push(g)};Array.isArray(h)?h.forEach((c,g)=>{u(c)}):u(h)}return s&&o.forEach((h,d)=>{(h.content||h.src)&&(o[d]=this.getCellIconFromRecordValue(h,t,e))}),o}getStyleClass(t){switch(t){case"text":case"link":return N_;case"image":case"video":return H_t;case"chart":case"sparkline":return na;case"progressbar":return Xx;case"checkbox":return YE;case"radio":return Ku;case"switch":return qu;case"button":return Zu}return N_}getCellIconFromRecordValue(t,e,i){if(Array.isArray(t))return t.map(o=>this.getCellIconFromRecordValue(o,e,i));if(!tq.isObject(t)||typeof t=="function")return this._table.getFieldData(t,e,i);const r={},s=t;return r1t.forEach(o=>{var a,l;if(s[o]!==void 0){const h=this._table.getFieldData(s[o],e,i);L(h)?r[o]=h:!((l=(a=this._table)._hasField)===null||l===void 0)&&l.call(a,s[o],e,i)||(r[o]=s[o])}}),r}getHierarchyIcon(t,e){const i=this._table.getHierarchyState(t,e);return i===se.expand?this.expandIcon:i===se.collapse?this.collapseIcon:void 0}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+((t=this.expandIcon.marginLeft)!==null&&t!==void 0?t:0)+((e=this.expandIcon.marginRight)!==null&&e!==void 0?e:0)}}function Ea(n,t){const e=document.createElement(n);return t&&e.classList.add(...t),e}function o1t(){if(We.mode==="node")return;const n=document.createElement("style");n.id="vtable-menu-styleSheet",n.textContent=`
@keyframes vtable__menu-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__menu-element {
	position: absolute;
	box-sizing: border-box;
	border-radius: 4px;
	background-color: #fff;
	padding: 6px 0;
	/* pointer-events: none; */
	user-select: none;
	color: #000;
	max-width: 300px;
	z-index: 99999;
	border: #CCC 0.5px solid;
	cursor: default;
	width: max-content;
	box-shadow: 0px 8px 16px rgba(27, 31, 35, 0.12);
  max-height: 100%;
  overflow-y: auto;
}
.vtable__menu-element--hidden {
	opacity: 0;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
	z-index: -9999;
}
.vtable__menu-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__menu-element--shown-animation 150ms ease-out;
}
.vtable__menu-element__content {
	font-family: Roboto;
	font-size: 12px;
	overflow: hidden;
	display: inline-block;
	/* height: 100%; */
	line-height: 30px;
}
.vtable__menu-element__item {
	height: 32px;
	padding: 0px 12px;
	cursor: pointer;
	position: relative;
	display: flex;
	align-items: center;
	justify-content: flex-start;
}
.vtable__menu-element__item:hover {
	background-color: rgba(27, 31, 35, 0.06);
}
.vtable__menu-element__icon{
	/* vertical-align: top; */
	display: flex;
	/* line-height: 30px; */
	margin-right: 6px;
}
.vtable__menu-element__no-event {
	pointer-events: none;
}
.vtable__menu-element--select {
	color: #2E68CF;
}
.vtable__menu-element--normal {
	color: rgba(20, 20, 20, 0.9);;
}
.vtable__menu-element__item-disabled {
    color: rgba(0, 0, 0, 0.25);
    cursor: not-allowed;
	  background-color: #fff;
}
.vtable__menu-element__item-disabled:hover {
	  background-color: #fff;
}
.vtable__menu-element__split {
	height: 0px;
	border: 1px solid rgb(209, 213, 218);
	margin: 5px 0;
}
.vtable__menu-element__title {
	color: rgb(149, 149, 149);
}
.vtable__menu-element__arrow {
	position: absolute;
	right: 3px;
	font-weight: bold;
	margin-top: 1px;
}
.vtable__menu-element__item-text {
	margin-right: 15px;
}
`,document.head.appendChild(n)}o1t();const ps="vtable__menu-element",a1t=`${ps}__item`,JR=`${ps}__content`,Ur=`${ps}--hidden`,bl=`${ps}--shown`,l1t=`${ps}--normal`,h1t=`${ps}--select`,d1t=`${ps}__icon`,u1t=`${ps}__split`,c1t=`${ps}__title`,g1t=`${ps}__arrow`,gm=`${ps}__no-event`,h$=`${ps}__item-text`,AC=`${ps}__item-disabled`;function d$(){return Ea("div",[ps,Ur])}function Nm(n,t,e,i,r,s){const o=n.getCellRange(i,r);for(let a=0;a<t.length;a++){const l=t[a];let{col:h,row:d}=l;const{field:u,menuKey:c}=l;if(typeof h!="number"||typeof d!="number")if(n.isPivotTable()){const g=n.internalProps.layoutMap.getPivotCellAdress(u);if(!g)continue;h=g.col,d=g.row}else{const g=n.internalProps.layoutMap.getHeaderCellAddressByField(u);if(!g)continue;h=g.col,d=g.row}if(L(h)&&L(d)&&So(o,h,d)&&e===c)return!0}return!1}class p1t{constructor(t){var e,i,r,s,o,a,l,h,d,u,c;this._handler=new vM,this._rootElement=d$(),this._secondElement=d$(),this._secondElement.sub=!0,this._showChildrenIndex=-1,this._rootElement.addEventListener("wheel",g=>{g.stopPropagation()}),(e=this._rootElement)===null||e===void 0||e.addEventListener("mousedown",g=>{g.stopPropagation(),g.preventDefault()}),(i=this._rootElement)===null||i===void 0||i.addEventListener("contextmenu",g=>{g.stopPropagation(),g.preventDefault()}),(r=this._rootElement)===null||r===void 0||r.addEventListener("touchend",g=>{if(g.stopPropagation(),g.preventDefault(),g.target.classList.contains(AC)||this._rootElement.classList.contains(Ur))return;const{col:p,row:f,dropDownIndex:m,menuKey:v,text:_,hasChildren:b}=g.target;if(typeof m!="number"||b)return void g.stopPropagation();const y=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(p,f):t.getHeaderField(p,f),C=t._dropDownMenuIsHighlight(p,f,m);t.fireListeners(mt.DROPDOWN_MENU_CLICK,{col:p,row:f,field:y,menuKey:v,text:_,highlight:C,cellLocation:t.getCellLocation(p,f),event:g}),t.fireListeners(mt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(mt.HIDE_MENU,null),g.stopPropagation()}),(s=this._rootElement)===null||s===void 0||s.addEventListener("click",g=>{if(g.stopPropagation(),g.preventDefault(),g.target.classList.contains(AC)||this._rootElement.classList.contains(Ur))return;const{col:p,row:f,dropDownIndex:m,menuKey:v,text:_,hasChildren:b}=g.target;if(typeof m!="number"||b)return void g.stopPropagation();const y=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(p,f):t.getHeaderField(p,f),C=t._dropDownMenuIsHighlight(p,f,m);t.fireListeners(mt.DROPDOWN_MENU_CLICK,{col:p,row:f,field:y,menuKey:v,text:_,highlight:C,cellLocation:t.getCellLocation(p,f),event:g}),t.fireListeners(mt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(mt.HIDE_MENU,null),g.stopPropagation()}),(o=this._rootElement)===null||o===void 0||o.addEventListener("mousemove",g=>{var p,f;if(this._rootElement.classList.contains(Ur))return;g.stopPropagation();const{hasChildren:m,dropDownIndex:v,col:_,row:b,sub:y}=g.target;if(m){this._showChildrenIndex=v;const C=this._secondElement;C==null||C.classList.remove(Ur),C==null||C.classList.add(bl),C.innerHTML="";const S=(p=this._menuInstanceInfo.content[v])===null||p===void 0?void 0:p.children;for(let x=0;x<S.length;x++){const A=S[x],M=u$(A,!!t.stateManager.menu.dropDownMenuHighlight&&Nm(t,t.stateManager.menu.dropDownMenuHighlight,typeof A=="object"?(A==null?void 0:A.menuKey)||(A==null?void 0:A.text):A,_,b));M.col=_,M.row=b,M.dropDownIndex=x,typeof A=="string"?(M.text=A,M.menuKey=A):typeof A=="object"&&(M.text=A.text,M.menuKey=A.menuKey||A.text),M.sub=!0,M.sub=!0,C.appendChild(M)}const w=g.target.getBoundingClientRect();this._bindSecondElement(t,_,b,w.right,w.top)}else if(m&&this._showChildrenIndex===v){const C=this._secondElement;C==null||C.classList.remove(Ur),C==null||C.classList.add(bl)}else!y&&(!((f=this._secondElement)===null||f===void 0)&&f.classList.contains(bl))&&setTimeout(()=>{if(this._mouseEnterSecondElement!==!0){this._showChildrenIndex=-1;const C=this._secondElement;C==null||C.classList.remove(bl),C==null||C.classList.add(Ur)}},300)}),(a=this._secondElement)===null||a===void 0||a.addEventListener("wheel",g=>{g.stopPropagation()}),(l=this._secondElement)===null||l===void 0||l.addEventListener("mousemove",g=>{this._rootElement.classList.contains(Ur)||g.stopPropagation()}),(h=this._secondElement)===null||h===void 0||h.addEventListener("mouseenter",g=>{this._mouseEnterSecondElement=!0}),(d=this._secondElement)===null||d===void 0||d.addEventListener("mouseleave",g=>{this._mouseEnterSecondElement=!1}),(u=this._secondElement)===null||u===void 0||u.addEventListener("mousedown",g=>{g.stopPropagation(),g.preventDefault()}),(c=this._secondElement)===null||c===void 0||c.addEventListener("click",g=>{if(g.stopPropagation(),g.preventDefault(),g.target.classList.contains(AC)||this._secondElement.classList.contains(Ur))return;const{col:p,row:f,dropDownIndex:m,menuKey:v,text:_,hasChildren:b}=g.target;if(typeof m!="number"||b)return void g.stopPropagation();const y=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(p,f):t.getHeaderField(p,f);let C=!1;this._menuInstanceInfo.content.forEach((S,w)=>{if(typeof S=="object"&&S.children&&S.children.length)for(let x=0;x<S.children.length;x++){const A=S.children[x];if(Nm(t,t.stateManager.menu.dropDownMenuHighlight,typeof A=="object"?A==null?void 0:A.menuKey:A,p,f)&&v===(typeof A=="object"?A==null?void 0:A.menuKey:A))return void(C=!0)}}),t.fireListeners(mt.DROPDOWN_MENU_CLICK,{col:p,row:f,field:y,cellHeaderPaths:t.isPivotTable()?t.getCellHeaderPaths(p,f):void 0,menuKey:v,text:_,highlight:C,cellLocation:t.getCellLocation(p,f),event:g}),t.fireListeners(mt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(mt.HIDE_MENU,null),g.stopPropagation()})}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t!=null&&t.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){var s,o;const a=this._rootElement,l=this._secondElement;if(this._menuInstanceInfo=r,a==null||a.classList.remove(bl),a==null||a.classList.add(Ur),l==null||l.classList.remove(bl),l==null||l.classList.add(Ur),this._canBindToCell(t,e,i)){if(a.innerHTML="",Array.isArray(r.content)){const h=r.content;for(let d=0;(s=d<(h==null?void 0:h.length))!==null&&s!==void 0&&s;d++){const u=h[d];let c=!!t.stateManager.menu.dropDownMenuHighlight&&Nm(t,t.stateManager.menu.dropDownMenuHighlight,typeof u=="object"?(u==null?void 0:u.menuKey)||(u==null?void 0:u.text):u,e,i);if(t.stateManager.menu.dropDownMenuHighlight&&typeof u=="object"&&Array.isArray(u.children)&&u.children.length)for(let p=0;p<u.children.length;p++){const f=u.children[p];if(Nm(t,t.stateManager.menu.dropDownMenuHighlight,typeof f=="object"?(f==null?void 0:f.menuKey)||(f==null?void 0:f.text):f,e,i)){c=!0;break}}const g=u$(u,c);g.col=e,g.row=i,g.dropDownIndex=d,typeof u=="string"?(g.text=u,g.menuKey=u):typeof u=="object"&&(g.text=u.text,g.menuKey=u.menuKey||u.text,!((o=u.children)===null||o===void 0)&&o.length&&(g.hasChildren=!0)),a.appendChild(g)}}if(this._bindToCell(t,e,i,r.position,r.referencePosition))return a==null||a.classList.add(bl),a==null||a.classList.remove(Ur),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement,e=this._secondElement;this._menuInstanceInfo=void 0,t!=null&&t.parentElement&&(t.classList.remove(bl),t.classList.add(Ur)),e!=null&&e.parentElement&&(e.classList.remove(bl),e.classList.add(Ur))}_canBindToCell(t,e,i){var r;const s=t.getCellRangeRelativeRect({col:e,row:i}),o=(r=t.internalProps.menu.parentElement)!==null&&r!==void 0?r:t.getElement(),{top:a,bottom:l,left:h,right:d}=s;if(t.isFrozenCell(e,i))return!0;if(l<t.getFrozenRowsHeight()||d<t.getFrozenColsWidth()||h>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||a>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:u,offsetWidth:c}=o;return!(u<a)&&!(c<h)}_bindToCell(t,e,i,r,s){var o;const a=this._rootElement,l=(o=t.internalProps.menu.parentElement)!==null&&o!==void 0?o:t.getElement(),{width:h,height:d,left:u,top:c}=l.getBoundingClientRect();if(a){a.parentElement!==l&&l.appendChild(a),a.style.left="0px";const g=.8*h;a.style.maxWidth=`${g}px`;const p=a.offsetWidth,f=a.offsetHeight;let m,v;r?(m=r.x,v=r.y):s&&(m=s.rect.right-p,v=s.rect.bottom);const _=l.getBoundingClientRect(),b=_.width/l.offsetWidth,y=_.height/l.offsetHeight;v*y+f>d&&(v=(d-f)/y),v<0&&(v/=2);let C=0,S=0;if(t.getElement()!==l){const{left:w,top:x}=t.getElement().getBoundingClientRect();C=x-c,S=w-u}return a.style.top=`${v+C}px`,m<0?m=0:m*b+p>h&&(m=(h-p)/b),a.style.left=`${m+S}px`,!0}return!1}_bindSecondElement(t,e,i,r,s){var o;const a=this._secondElement,l=this._rootElement,h=(o=t.internalProps.menu.parentElement)!==null&&o!==void 0?o:t.getElement(),{width:d,left:u,top:c}=h.getBoundingClientRect(),{x:g,y:p,width:f}=l.getBoundingClientRect();if(a){a.parentElement!==h&&h.appendChild(a),a.style.left="0px";const m=.8*d;a.style.maxWidth=`${m}px`;const v=a.clientWidth,_=s-4-c,b=r-u;a.style.top=`${_}px`;let y=b;return y+v>d?y=y-v-f:y+=4,a.style.left=`${y}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:s,width:o,height:a}=i.getBoundingClientRect();if(t>r-5&&t<r+o+5&&e>s-5&&e<s+a+5)return!0;const l=this._secondElement;if(l){const{x:h,y:d,width:u,height:c}=l.getBoundingClientRect();if(t>h-5&&t<h+u+5&&e>d-5&&e<d+c+5)return!0}return!1}}function u$(n,t){var e,i,r;const s=Ea("div",[a1t,t?h1t:l1t]);if(typeof n=="object"&&n.disabled&&s.classList.add(AC),typeof n=="string"){const o=Ea("span",[JR,gm,h$]);o.innerHTML=n,s.appendChild(o)}else if(typeof n=="object"){const o=(e=n.type)!==null&&e!==void 0?e:"item";if(o==="split")return s==null||s.classList.add(u1t),s;if(!((i=n==null?void 0:n.icon)===null||i===void 0)&&i.svg)if(iD.test(n.icon.svg)){const l=new Image;n.icon.width?l.style.width=n.icon.width.toString()+"px":l.style.width="16px",n.icon.height?l.style.height=n.icon.height.toString()+"px":l.style.height="16px",l.src=n.icon.svg,s.appendChild(l)}else{const l=Ea("span",[d1t,gm]);l.innerHTML=t&&n.selectedIcon&&n.selectedIcon.svg?n.selectedIcon.svg:n.icon.svg,n.icon.width&&l.children[0].setAttribute("width",n.icon.width.toString()),n.icon.height&&l.children[0].setAttribute("height",n.icon.height.toString()),s.appendChild(l)}const a=Ea("span",[JR,gm,h$]);if(a.innerHTML=n.text,s.appendChild(a),o==="title")s==null||s.classList.add(gm,c1t);else if(!((r=n==null?void 0:n.children)===null||r===void 0)&&r.length){const l=Ea("span",[JR,gm,g1t]);l.innerHTML=t?'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#2E68CF" fill-opacity="0.65"></path></svg>':'<svg width="8" height="12" viewBox="0 0 10 17" fill="none" xmlns="http://www.w3.org/2000/svg" style="vertical-align: baseline"><path d="M1.78186 16.7729L0.300378 15.2915L6.8189 8.77295L0.300377 2.25443L1.78186 0.77295L9.78186 8.77295L1.78186 16.7729Z" fill="#141414" fill-opacity="0.65"></path></svg>',s.appendChild(l)}}return s}let c$;const f1t={CHANGE_STYLE:"change_style"};class bc extends pM{static get EVENT_TYPE(){return f1t}static get DEFAULT(){return c$||(c$=new bc)}constructor(t={},e={}){var i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O;super(),this._defaultPadding=[10,16,10,16],this._color=(i=t.color)!==null&&i!==void 0?i:e==null?void 0:e.color,this._strokeColor=(r=t==null?void 0:t.strokeColor)!==null&&r!==void 0?r:e==null?void 0:e.strokeColor,this._fontSize=(s=t.fontSize)!==null&&s!==void 0?s:e==null?void 0:e.fontSize,this._fontFamily=(o=t.fontFamily)!==null&&o!==void 0?o:e==null?void 0:e.fontFamily,this._fontWeight=(a=t.fontWeight)!==null&&a!==void 0?a:e==null?void 0:e.fontWeight,this._fontVariant=(l=t.fontVariant)!==null&&l!==void 0?l:e==null?void 0:e.fontVariant,this._fontStyle=(h=t.fontStyle)!==null&&h!==void 0?h:e==null?void 0:e.fontStyle,this._textOverflow=((d=t.textOverflow)!==null&&d!==void 0?d:e==null?void 0:e.textOverflow)||"ellipsis",this._textStick=(c=(u=t.textStick)!==null&&u!==void 0?u:e==null?void 0:e.textStick)!==null&&c!==void 0&&c,this._textStickBaseOnAlign=(p=(g=t.textStickBaseOnAlign)!==null&&g!==void 0?g:e==null?void 0:e.textStickBaseOnAlign)!==null&&p!==void 0&&p,this._marked=(m=(f=t.marked)!==null&&f!==void 0?f:e==null?void 0:e.marked)!==null&&m!==void 0&&m,this._textAlign=((v=t.textAlign)!==null&&v!==void 0?v:e==null?void 0:e.textAlign)||"left",this._textBaseline=((_=t.textBaseline)!==null&&_!==void 0?_:e==null?void 0:e.textBaseline)||"middle",this._bgColor=(b=t.bgColor)!==null&&b!==void 0?b:e==null?void 0:e.bgColor,this._padding=(C=(y=t.padding)!==null&&y!==void 0?y:e==null?void 0:e.padding)!==null&&C!==void 0?C:this._defaultPadding,this._borderColor=(S=t.borderColor)!==null&&S!==void 0?S:e==null?void 0:e.borderColor,this._lineHeight=(w=t.lineHeight)!==null&&w!==void 0?w:e==null?void 0:e.lineHeight,this._underline=(x=t.underline)!==null&&x!==void 0?x:e==null?void 0:e.underline,this._underlineColor=(A=t.underlineColor)!==null&&A!==void 0?A:e==null?void 0:e.underlineColor,this._underlineDash=(M=t.underlineDash)!==null&&M!==void 0?M:e==null?void 0:e.underlineDash,this._underlineOffset=(T=t.underlineOffset)!==null&&T!==void 0?T:e==null?void 0:e.underlineOffset,this._lineThrough=(R=t.lineThrough)!==null&&R!==void 0?R:e==null?void 0:e.lineThrough,this._lineThroughColor=(B=t.lineThroughColor)!==null&&B!==void 0?B:e==null?void 0:e.lineThroughColor,this._lineThroughDash=(E=t.lineThroughDash)!==null&&E!==void 0?E:e==null?void 0:e.lineThroughDash,this._linkColor=(k=t.linkColor)!==null&&k!==void 0?k:e==null?void 0:e.linkColor,this._cursor=(P=t.cursor)!==null&&P!==void 0?P:e==null?void 0:e.cursor,this._borderLineWidth=(I=t.borderLineWidth)!==null&&I!==void 0?I:e==null?void 0:e.borderLineWidth,this._borderLineDash=(O=t.borderLineDash)!==null&&O!==void 0?O:e==null?void 0:e.borderLineDash}get bgColor(){return this._bgColor}set bgColor(t){this._bgColor=t}get color(){return this._color}set color(t){this._color=t}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor=t}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize=t}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t}get textOverflow(){return this._textOverflow}set textOverflow(t){this._textOverflow=t}get padding(){var t;return(t=this._padding)!==null&&t!==void 0?t:this._defaultPadding}set padding(t){this._padding=t}get borderColor(){return this._borderColor}set borderColor(t){this._borderColor=t}get textStick(){return this._textStick}set textStick(t){this._textStick=t}get textStickBaseOnAlign(){return this._textStickBaseOnAlign}set textStickBaseOnAlign(t){this._textStickBaseOnAlign=t}get marked(){return this._marked}set marked(t){this._marked=t}get textAlign(){return this._textAlign}set textAlign(t){this._textAlign=t}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t}get underline(){return this._underline}set underline(t){this._underline=t}get underlineColor(){return this._underlineColor}set underlineColor(t){this._underlineColor=t}get underlineDash(){return this._underlineDash}set underlineDash(t){this._underlineDash=t}get underlineOffset(){return this._underlineOffset}set underlineOffset(t){this._underlineOffset=t}get lineThrough(){return this._lineThrough}set lineThrough(t){this._lineThrough=t}get lineThroughColor(){return this._lineThroughColor}set lineThroughColor(t){this._lineThroughColor=t}get lineThroughDash(){return this._lineThroughDash}set lineThroughDash(t){this._lineThroughDash=t}get linkColor(){return this._linkColor}set linkColor(t){this._linkColor=t}get cursor(){return this._cursor}set cursor(t){this._cursor=t}get borderLineWidth(){return this._borderLineWidth}set borderLineWidth(t){this._borderLineWidth=t}get borderLineDash(){return this._borderLineDash}set borderLineDash(t){this._borderLineDash=t}clone(){return new bc(this)}}let g$;class Kx extends bc{static get DEFAULT(){return g$||(g$=new Kx)}constructor(t={},e={}){var i;super(t,e),this.textAlign=((i=t.textAlign)!==null&&i!==void 0?i:e==null?void 0:e.textAlign)||"center"}clone(){return new Kx(this)}}let p$;class qx extends bc{static get DEFAULT(){return p$||(p$=new qx)}constructor(t={},e=null){var i,r;super(t,e),this._autoWrapText=(i=t==null?void 0:t.autoWrapText)!==null&&i!==void 0?i:e==null?void 0:e.autoWrapText,this._lineClamp=(r=t==null?void 0:t.lineClamp)!==null&&r!==void 0?r:e==null?void 0:e.lineClamp}clone(){return new qx(this,null)}get lineClamp(){return this._lineClamp}set lineClamp(t){this._lineClamp=t}get autoWrapText(){return this._autoWrapText}set autoWrapText(t){this._autoWrapText=t}}let f$;class Ju extends bc{static get DEFAULT(){return f$||(f$=new Ju)}constructor(t={},e={},i={}){var r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A;super(t,e),this._size=((s=(r=t==null?void 0:t.size)!==null&&r!==void 0?r:e==null?void 0:e.size)!==null&&s!==void 0?s:i==null?void 0:i.size)||14,this._spaceBetweenTextAndIcon=((a=(o=t==null?void 0:t.spaceBetweenTextAndIcon)!==null&&o!==void 0?o:e==null?void 0:e.spaceBetweenTextAndIcon)!==null&&a!==void 0?a:i==null?void 0:i.spaceBetweenTextAndIcon)||8,this._defaultFill=(h=(l=t==null?void 0:t.checkboxStyle)===null||l===void 0?void 0:l.defaultFill)!==null&&h!==void 0?h:i==null?void 0:i.defaultFill,this._defaultStroke=(u=(d=t==null?void 0:t.checkboxStyle)===null||d===void 0?void 0:d.defaultStroke)!==null&&u!==void 0?u:i==null?void 0:i.defaultStroke,this._disableFill=(g=(c=t==null?void 0:t.checkboxStyle)===null||c===void 0?void 0:c.disableFill)!==null&&g!==void 0?g:i==null?void 0:i.disableFill,this._checkedFill=(f=(p=t==null?void 0:t.checkboxStyle)===null||p===void 0?void 0:p.checkedFill)!==null&&f!==void 0?f:i==null?void 0:i.checkedFill,this._checkedStroke=(v=(m=t==null?void 0:t.checkboxStyle)===null||m===void 0?void 0:m.checkedStroke)!==null&&v!==void 0?v:i==null?void 0:i.checkedStroke,this._disableCheckedFill=(b=(_=t==null?void 0:t.checkboxStyle)===null||_===void 0?void 0:_.disableCheckedFill)!==null&&b!==void 0?b:i==null?void 0:i.disableCheckedFill,this._disableCheckedStroke=(C=(y=t==null?void 0:t.checkboxStyle)===null||y===void 0?void 0:y.disableCheckedStroke)!==null&&C!==void 0?C:i==null?void 0:i.disableCheckedStroke,this._checkIconImage=(w=(S=t==null?void 0:t.checkboxStyle)===null||S===void 0?void 0:S.checkIconImage)!==null&&w!==void 0?w:i==null?void 0:i.checkIconImage,this._indeterminateIconImage=(A=(x=t==null?void 0:t.checkboxStyle)===null||x===void 0?void 0:x.indeterminateIconImage)!==null&&A!==void 0?A:i==null?void 0:i.indeterminateIconImage}get size(){return this._size}set size(t){this._size=t}get spaceBetweenTextAndIcon(){return this._spaceBetweenTextAndIcon}set spaceBetweenTextAndIcon(t){this._spaceBetweenTextAndIcon=t}get defaultFill(){return this._defaultFill}set defaultFill(t){this._defaultFill=t}get defaultStroke(){return this._defaultStroke}set defaultStroke(t){this._defaultStroke=t}get disableFill(){return this._disableFill}set disableFill(t){this._disableFill=t}get checkedFill(){return this._checkedFill}set checkedFill(t){this._checkedFill=t}get checkedStroke(){return this._checkedStroke}set checkedStroke(t){this._checkedStroke=t}get disableCheckedFill(){return this._disableCheckedFill}set disableCheckedFill(t){this._disableCheckedFill=t}get disableCheckedStroke(){return this._disableCheckedStroke}set disableCheckedStroke(t){this._disableCheckedStroke=t}get checkIconImage(){return this._checkIconImage}set checkIconImage(t){this._checkIconImage=t}get indeterminateIconImage(){return this._indeterminateIconImage}set indeterminateIconImage(t){this._indeterminateIconImage=t}getStyle(t){return new Ju(t,this)}clone(){return new Ju(this)}}function MC(n,t,e,i,r,s){var o;return n||t?n instanceof bc?n:typeof n=="function"?MC(n(e),t,e,i,r,s):(n||(n={}),r&&!L(n.autoWrapText)&&(n.autoWrapText=!0),i===Ju?new Ju(n??{},t??{},(o=s.checkboxStyle)!==null&&o!==void 0?o:{}):new i(n??{},t??{})):i.DEFAULT}class m1t{constructor(t){this._table=t;const e=ra();this.freezeIcon=e[Er.freezeIconName],this.frozenIcon=e[Er.frozenIconName],this.frozenCurrentIcon=e[Er.frozenCurrentIconName],this.normalIcon=e[Er.normalIconName],this.upIcon=e[Er.upwardIconName],this.downIcon=e[Er.downwardIconName],this.dropDownAbsoluteIcon=e[Er.dropdownIconName],this.expandIcon=e[Er.expandIconName],this.collapseIcon=e[Er.collapseIconName]}getIcons(t,e){const i=[];if(this._table.isPivotTable()){const{showSort:a,sort:l}=this._table.internalProps.layoutMap.getHeader(t,e);let h;if(h=typeof a=="function"?a({col:t,row:e,table:this._table}):a,h){let d=this._table.getPivotSortState(t,e);d&&(d=d.toUpperCase());const u=d==="ASC"?this.upIcon:d==="DESC"?this.downIcon:this.normalIcon;u&&i.push(u)}else if(l){const d=this.getSortIconForPivotTable(this._table.getPivotSortState(t,e),this._table,t,e);d&&i.push(d)}}else{const a=this._table.sortState;let l;l=void 0;const h=this._table.getCellRange(t,e);if(a)if(Array.isArray(a))for(let u=0;u<a.length;u++){const c=a[u],g=this._table._getHeaderCellBySortState(c);if(g&&So(h,g.col,g.row)){({order:l}=c);break}}else{const u=this._table._getHeaderCellBySortState(a);u&&So(h,u.col,u.row)&&({order:l}=a)}const d=this.getSortIcon(l,this._table,t,e);d&&i.push(d)}if(this._table.showFrozenIcon&&t<this._table.allowFrozenColCount){const a=this.getFrozenIcon(t,e);a&&i.push(a)}if(this.checkDropDownIcon(this._table,t,e)){const a=this.dropDownAbsoluteIcon;i.push(a)}const r=this.getDropDownStateIcons(this._table,t,e);r.length&&i.push(...r);const{headerIcon:s}=this._table._getHeaderLayoutMap(t,e),o=this.getHierarchyIcon(t,e);if(o&&i.push(o),s){let a;typeof s=="function"?a=s({col:t,row:e,value:this._table.getCellValue(t,e),dataValue:this._table.getCellOriginValue(t,e),table:this._table}):a=s;const l=ra(),h=d=>{let u;u=typeof d=="string"?l[d]:d,u&&i.push(u)};Array.isArray(a)?a.forEach((d,u)=>{h(d)}):h(a)}return i}getFrozenIcon(t,e){if(this._table.isPivotTable()||this._table.transpose||this._table.rightFrozenColCount&&t>=this._table.colCount-this._table.rightFrozenColCount)return null;const i=this._table.getHeaderDefine(t,e);if(i.columns&&i.columns.length>0)return null;let r=this.freezeIcon;return this._table.options.frozenColCount-1>t?r=this.frozenIcon:this._table.options.frozenColCount-1===t&&(r=this.frozenCurrentIcon),r}getSortIcon(t,e,i,r){const s=t==="asc"?this.upIcon:t==="desc"?this.downIcon:this.normalIcon,o=e.getHeaderDefine(i,r);let a;return o&&(a=typeof o.showSort=="function"?o.showSort({col:i,row:r,table:this._table}):o.showSort),!o||a===!1||!L(a)&&!o.sort||o.columns&&o.columns.length>0?null:s}getSortIconForPivotTable(t,e,i,r){const s=e.getHeaderDefine(i,r);let o;return s&&(o=typeof s.showSort=="function"?s.showSort({col:i,row:r,table:this._table}):s.showSort),!s||o===!1||!L(o)&&!s.sort||s.columns&&s.columns.length>0?null:(t==null?void 0:t.toUpperCase())==="ASC"?this.upIcon:(t==null?void 0:t.toUpperCase())==="DESC"?this.downIcon:this.normalIcon}getDropDownStateIcons(t,e,i){var r,s,o;const a=t.getHeaderDefine(e,i),l=t._getHeaderLayoutMap(e,i);let{dropDownMenu:h}=l;typeof h=="function"&&(h=h({row:i,col:e,table:t}));let d=t.globalDropDownMenu;typeof d=="function"&&(d=d({row:i,col:e,table:t}));const u=[];if(Array.isArray(h)&&h.length||Array.isArray(d)&&d.length&&!(!((r=a==null?void 0:a.columns)===null||r===void 0)&&r.length)){const c=h||d;let g=-1,p=-1;for(let f=0;f<c.length;f++){const m=c[f];if(typeof m=="object"&&m.children&&m.children.length)for(let v=0;v<m.children.length;v++){const _=m.children[v];if(!((s=t.stateManager.menu)===null||s===void 0)&&s.dropDownMenuHighlight&&Nm(t,(o=t.stateManager.menu)===null||o===void 0?void 0:o.dropDownMenuHighlight,typeof _=="object"?_==null?void 0:_.menuKey:_,e,i)){g=f,p=v;break}}if(t._dropDownMenuIsHighlight(e,i,f)){g=f;break}}if(g!==-1){let f;f=p!==-1?c[g].children[p]:c[g],f.stateIcon&&(f.stateIcon.svg?u.push({type:"svg",name:f.stateIcon.src||f.stateIcon.svg,width:f.stateIcon.width||22,height:f.stateIcon.height||22,svg:f.stateIcon.svg,positionType:ri.right,marginRight:0,funcType:si.dropDownState,interactive:!1}):f.stateIcon.src&&u.push({type:"image",name:f.stateIcon.src||f.stateIcon.svg,width:f.stateIcon.width||22,height:f.stateIcon.height||22,src:f.stateIcon.src,positionType:ri.right,marginRight:0,funcType:si.dropDownState,interactive:!1}))}}return u}getDropDownIconRect(t,e,i){var r,s,o,a,l,h,d,u;const c=(a=(s=(r=this.downIcon.hover)===null||r===void 0?void 0:r.width)!==null&&s!==void 0?s:(o=this.downIcon)===null||o===void 0?void 0:o.width)!==null&&a!==void 0?a:0,g=(u=(h=(l=this.downIcon.hover)===null||l===void 0?void 0:l.height)!==null&&h!==void 0?h:(d=this.downIcon)===null||d===void 0?void 0:d.height)!==null&&u!==void 0?u:0,p=t.right-2-c,f=t.right-2;let m;return m=i==="middle"?t.top+t.height/2-c/2:i==="top"?t.top+e/2:i==="bottom"?t.bottom-2*e:t.top,{left:p,right:f,top:m,bottom:g+m,width:c,height:g}}getHierarchyIcon(t,e){const{hierarchyState:i}=this._table._getHeaderLayoutMap(t,e);if(i){if(i===se.expand)return this.expandIcon;if(i===se.collapse)return this.collapseIcon}}getHierarchyIconWidth(){var t,e;return this.expandIcon.width+((t=this.expandIcon.marginLeft)!==null&&t!==void 0?t:0)+((e=this.expandIcon.marginRight)!==null&&e!==void 0?e:0)}checkDropDownIcon(t,e,i){var r;if(t.isPivotTable()){let s=t._getHeaderLayoutMap(e,i).dropDownMenu;if(typeof s=="function"&&(s=s({row:i,col:e,table:t})),Array.isArray(s)&&s.length)return!0}else{const s=t.getHeaderDefine(e,i),o=s.dropDownMenu;let a=t.globalDropDownMenu;if(typeof a=="function"&&(a=a({row:i,col:e,table:t})),Array.isArray(o)&&o.length||(!Array.isArray(s.dropDownMenu)||s.dropDownMenu.length!==0)&&Array.isArray(a)&&a.length&&!(!((r=s==null?void 0:s.columns)===null||r===void 0)&&r.length))return!0}return!1}getStyleClass(t){switch(t){case"text":case"link":return qx;case"image":case"video":return Kx;case"checkbox":return Ju}}setTableColumnsEditor(){const t=(e,i)=>{e==null||e.forEach((r,s)=>{r.editor&&(i[s].editor=r.editor),r.columns&&t(r.columns,i[s].columns)})};t(this._table.options.columns,this._table.internalProps.columns)}}class m$ extends EventTarget{constructor(t,e){if(super(),this._table=t,We.mode==="node")return;const i=document.createElement("div");i.style.opacity="0",i.dataset.vtable="vtable",i.style.pointerEvents="none",i.classList.add("input-container");const r=this._input=document.createElement("input");i.appendChild(r),r.classList.add("table-focus-control"),r.dataset.vtable="vtable",r.readOnly=!0,e.appendChild(i),this._container=i}focus(){this._input.focus({preventScroll:!0})}setFocusRect(t,e){const i=this._input;i.value=e,i.select();const r=t.top-this._table.scrollTop,s=t.left-this._table.scrollLeft;i.style.top=`${r.toFixed()}px`,i.style.left=`${s.toFixed()}px`,i.style.width=`${t.width.toFixed()}px`,i.style.height=`${t.height.toFixed()}px`}get input(){return this._input}release(){var t;(t=this._container.parentElement)===null||t===void 0||t.removeChild(this._container)}}class v${constructor(t){this.isUpdate=!1,this._keys=[],this._sorted=!1,this.data=new Map,this._keys.length=0,this.cumulativeSum=new Map,this.difference=new Map,this.totalSum=0,this.table=t}get length(){return this.data.size}clear(){this._keys=[],this.data.clear(),this.cumulativeSum.clear(),this.difference.clear(),this.totalSum=0}clearRange(){this.cumulativeSum.clear(),this.difference.clear()}add(t,e){if(!L(e))return;const i=this.table.getRowHeight(t);this.data.has(t)||(this._keys.push(t),this._sorted=!1),this.data.set(t,e),this.totalSum+=e,this.updateDifference(t,e-i)}remove(t){if(this.data.has(t)){const e=this.data.get(t);this.data.delete(t);const i=this._keys.indexOf(t);i!==-1&&this._keys.splice(i,1),this.totalSum-=e;const r=this.table.getRowHeight(t);this.updateDifference(t,r-e)}}put(t,e){if(L(e))if(this.data.has(t)){const i=this.data.get(t);if(i===e)return;this.data.set(t,e);const r=e-i;this.totalSum+=r,this.updateDifference(t,r)}else this.add(t,e)}get(t){return this.data.get(t)}has(t){return this.data.has(t)}_sort(){const{_keys:t}=this;this._sorted||(t.sort((e,i)=>e<i?-1:e>i?1:0),this._sorted=!0)}updateDifference(t,e){var i;const r=(i=this.difference.get(t))!==null&&i!==void 0?i:0;this.difference.set(t,r+e),this.update()}getSumInRange(t,e){return this.calculatePrefixSum(e)-this.calculatePrefixSum(t-1)}updateCumulativeSum(t,e){for(const[i,r]of this.cumulativeSum)i>=t&&this.cumulativeSum.set(i,r+e)}calculatePrefixSum(t){if(t<0)return 0;if(this.cumulativeSum.has(t)){let e=this.cumulativeSum.get(t);for(const[i,r]of this.difference)i<=t&&(e+=r);return e}return this.dealDiffenence(),this.getCumulativeSum(t)}getCumulativeSum(t){var e;let i=0;for(let r=t;r>=0;r--){if(this.cumulativeSum.has(r)){i+=this.cumulativeSum.get(r);break}i+=(e=this.data.get(r))!==null&&e!==void 0?e:this.table.getRowHeight(r)}return this.cumulativeSum.set(t,i),i}update(){this.isUpdate||(this.isUpdate=!0,setTimeout(()=>{this.dealDiffenence(),this.isUpdate=!1},0))}dealDiffenence(){for(const[t]of this.cumulativeSum)for(const[e,i]of this.difference)if(t>=e){const r=this.cumulativeSum.get(t);this.cumulativeSum.set(t,r+i)}this.difference.clear()}insert(t,e){for(let r=t;r<=this.getLastIndex();r++)this.cumulativeSum.delete(r);const i=this.getLastIndex()+1;this.adjustOrder(t,t+1,i-t),L(e)&&this.put(t,e)}getLastIndex(){return this._sort(),this._keys[this._keys.length-1]}delLast(){const t=this.getLastIndex();this.remove(t)}delete(t){if(!this.has(t))return;for(let i=t;i<=this.getLastIndex();i++)this.cumulativeSum.delete(i);const e=this.getLastIndex();this.adjustOrder(t+1,t,e-t),this.delLast()}adjustOrder(t,e,i){this.clearRange(),this._sort();const{_keys:r}=this;if(t>e){const o=[];for(let a=cg(r,t+i-1);a>=0;a--){const l=r[a];if(l>=t)o.push(this.get(l));else if(e<=l&&l<t)this.put(l+i,this.get(l));else if(l<e)break}for(let a=0;a<i;a++)this.put(e+a,o[i-1-a])}const{length:s}=r;if(t<e){const o=[];for(let a=cg(r,t);a<s;a++){const l=r[a];if(l>=t&&l<t+i)o.push(this.get(l));else if(t+i<=l&&l<=e)this.put(l-i,this.get(l));else if(l>e)break}for(let a=0;a<i;a++)this.put(e+a,o[a])}}exchangeOrder(t,e,i,r,s){const{_keys:o}=this;if(this._sorted||(o.sort((a,l)=>a<l?-1:a>l?1:0),this._sorted=!0),t>i){const a=[],l=[];for(let h=cg(o,i);h<cg(o,t)+e;h++){const d=o[h];d>=t&&d<t+e?l.push(this.get(d)):a.push(this.get(d))}for(let h=0;h<e;h++)this.put(s+h,l[h]);for(let h=0;h<a.length;h++)this.put(s+e+h,a[h])}else{const a=[],l=[];for(let h=cg(o,t);h<cg(o,i)+r;h++){const d=o[h];d>=t&&d<t+e?l.push(this.get(d)):a.push(this.get(d))}for(let h=0;h<e;h++)this.put(s+h,l[h]);for(let h=0;h<a.length;h++)this.put(t+h,a[h])}}}function cg(n,t){let e=0,i=n.length-1;for(;e<=i;){const r=Math.floor((e+i)/2);if(n[r]===t)return r;n[r]>t?i=r-1:e=r+1}return i<0?0:i}class v1t{constructor(t){this._table=t;const e=ra();this.dragReorderIconName=e[Er.dragReorderIconName]}getIcons(t,e){return[this.dragReorderIconName]}}class _1t{constructor(t,e,i="grid",r=void 0){this.hasHideNode=!1,this.sizeIncludeParent=!1,this.tree={id:0,dimensionKey:"",value:"",children:[],level:-1,afterSpanLevel:-1,levelSpan:1,startIndex:0,size:0,startInTotal:0,hierarchyState:void 0},this.totalLevel=0,this.expandedMaxLevel=0,this.dimensionKeys=new Kh,this.dimensionKeysIncludeVirtual=new Kh,this.cache=new Map,this.sizeIncludeParent=r!=null,this.setExpandLevel=r,this.hierarchyType=i,this.sharedVar=e,this.reset(t)}reset(t){this.totalLevel=0,this.expandedMaxLevel=0,this.hasHideNode=!1,this.cache.clear(),this.dimensionKeys=new Kh,this.dimensionKeysIncludeVirtual=new Kh,this.tree.children=t,this.setTreeNode(this.tree,0,this.tree)}setTreeNode(t,e,i){var r,s,o,a;t.startIndex=e,t.startInTotal=((r=i.startInTotal)!==null&&r!==void 0?r:0)+t.startIndex,t.hide&&(this.hasHideNode=!0),((s=t.dimensionKey)!==null&&s!==void 0?s:t.indicatorKey)&&(t.virtual||this.dimensionKeys.contain(t.indicatorKey?vy:t.dimensionKey)||this.dimensionKeys.put(t.level,t.indicatorKey?vy:t.dimensionKey),this.dimensionKeysIncludeVirtual.contain(t.indicatorKey?vy:t.dimensionKey)||this.dimensionKeysIncludeVirtual.put(t.level,t.indicatorKey?vy:t.dimensionKey),t.id||(t.id=++this.sharedVar.seqId));let l=t.dimensionKey&&this.sizeIncludeParent?1:0;const h=t.children||t.columns;return this.hierarchyType==="grid"||this.hierarchyType===null?(h==null?void 0:h.length)>=1?h.forEach(d=>{var u,c,g;d.level=((u=t.level)!==null&&u!==void 0?u:0)+1,this.hierarchyType==="grid"&&(d.afterSpanLevel=((c=t.afterSpanLevel)!==null&&c!==void 0?c:0)+((g=t.levelSpan)!==null&&g!==void 0?g:1)),this.totalLevel=Math.max(this.totalLevel,d.level+1),l+=this.setTreeNode(d,l,t)}):l=t.level===-1?0:1:t.hierarchyState===se.expand&&(h==null?void 0:h.length)>=1?h.forEach(d=>{var u;d.level=((u=t.level)!==null&&u!==void 0?u:0)+1,this.totalLevel=Math.max(this.totalLevel,d.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,d.level+1),l+=this.setTreeNode(d,l,t)}):t.hierarchyState===se.collapse&&(h==null?void 0:h.length)>=1?h.forEach(d=>{var u;d.level=((u=t.level)!==null&&u!==void 0?u:0)+1,this.totalLevel=Math.max(this.totalLevel,d.level+1),this.setTreeNode(d,l,t)}):!t.hierarchyState&&t.level+1<this.setExpandLevel&&((h==null?void 0:h.length)>=1||h===!0)?(!((o=h[0])===null||o===void 0)&&o.indicatorKey&&this.hierarchyType==="grid-tree"||(t.hierarchyState=se.expand),(h==null?void 0:h.length)>=1&&h.forEach(d=>{var u;d.level=((u=t.level)!==null&&u!==void 0?u:0)+1,this.totalLevel=Math.max(this.totalLevel,d.level+1),this.expandedMaxLevel=Math.max(this.expandedMaxLevel,d.level+1),l+=this.setTreeNode(d,l,t)})):(h==null?void 0:h.length)>=1||h===!0?(!((a=h[0])===null||a===void 0)&&a.indicatorKey&&this.hierarchyType==="grid-tree"||(t.hierarchyState=se.collapse),(h==null?void 0:h.length)>=1&&h.forEach(d=>{var u;d.level=((u=t.level)!==null&&u!==void 0?u:0)+1,this.totalLevel=Math.max(this.totalLevel,d.level+1),this.setTreeNode(d,l,t)})):(t.hierarchyState=se.none,l=t.level===-1?0:1),t.size=l,l}getTreePath(t,e=30){const i=[];return this.searchPath(t,this.tree,i,e),i.shift(),i}findNodeById(t,e){return t.find(i=>i.id===e)}searchPath(t,e,i,r){if(!e||t<e.startIndex||t>=e.startIndex+e.size||(i.push(e),!e.children||e.children.length===0||e.level>=r))return;const s=t-e.startIndex;if(this.cache.has(e.level+1)){const l=this.cache.get(e.level+1);if(s>=l.startIndex&&s<l.startIndex+l.size)return void this.searchPath(s,l,i,r)}let o=0,a=e.children.length-1;for(;o<=a;){const l=Math.floor((o+a)/2),h=e.children[l];if(s>=h.startIndex&&s<h.startIndex+h.size){this.cache.set(h.level,h);const d=[];this.cache.forEach((u,c)=>{c>h.level&&d.push(c)}),d.forEach(u=>{this.cache.delete(u)}),this.searchPath(s,h,i,r);break}s<h.startIndex?a=l-1:o=l+1}}movePosition(t,e,i){let r,s,o;const a=(d,u)=>{if(s!==void 0&&o!==void 0)return;d.level===t&&(d.startInTotal===e&&(s=u),d.startInTotal<=i&&i<=d.startInTotal+d.size-1&&(o=u));const c=d.children||d.columns;if(c&&d.level<t){r=d;for(let g=0;g<c.length;g++)(e>=c[g].startInTotal&&e<=c[g].startInTotal+c[g].size||i>=c[g].startInTotal&&i<=c[g].startInTotal+c[g].size)&&a(c[g],g)}};a(this.tree,0);const l=r.children||r.columns,h=l.splice(s,1);h.unshift(o,0),Array.prototype.splice.apply(l,h)}getCopiedTree(){const t=Pn(this.tree.children);return oZ(t),t}}function oZ(n){for(let t=0;t<n.length;t++){const e=n[t];delete e.level,delete e.startIndex,delete e.id,delete e.levelSpan,delete e.size,delete e.startInTotal;const i=e.children||e.columns;i&&oZ(i)}}function b1t(n){const t=n.columnObjects;for(let e=0;e<t.length;e++){const i=t[e];if(i!=null&&i.aggregation)return!0}return!1}function y1t(n){const t=n.columnObjects;let e=0;for(let i=0;i<t.length;i++){const r=t[i];r!=null&&r.aggregation&&(Array.isArray(r==null?void 0:r.aggregation)?e=Math.max(e,r.aggregation.filter(s=>s.showOnTop).length):r.aggregation.showOnTop&&(e=Math.max(e,1)))}return e}function C1t(n){const t=n.columnObjects;let e=0;for(let i=0;i<t.length;i++){const r=t[i];r!=null&&r.aggregation&&(Array.isArray(r==null?void 0:r.aggregation)?e=Math.max(e,r.aggregation.filter(s=>!s.showOnTop).length):r.aggregation.showOnTop||(e=Math.max(e,1)))}return e}function S1t(n){if(n._table.options.groupBy)return!0;const{columns:t}=n._table.options;if(V(t)&&t.length>0)for(let e=0;e<t.length;e++){const i=t[e];if(!yt(i)&&i.tree)return!0}return!1}function x1t(n){const{columns:t,rows:e,indicators:i}=n.options;if(n.isPivotTable()){if(V(t)&&t.length>0)for(let r=0;r<t.length;r++){const s=t[r];if(!yt(s)&&(s.headerType==="image"||s.headerType==="video"||typeof s.headerType=="function")&&s.imageAutoSizing)return!0}if(V(e)&&e.length>0)for(let r=0;r<e.length;r++){const s=e[r];if(!yt(s)&&(s.headerType==="image"||s.headerType==="video"||typeof s.headerType=="function")&&s.imageAutoSizing)return!0}if(V(i)&&i.length>0)for(let r=0;r<i.length;r++){const s=i[r];if(!yt(s)&&((s.cellType==="image"||s.cellType==="video"||typeof s.cellType=="function")&&s.imageAutoSizing||(s.headerType==="image"||s.headerType==="video"||typeof s.headerType=="function")&&s.imageAutoSizing))return!0}}else if(V(t)&&t.length>0)for(let r=0;r<t.length;r++){const s=t[r];if((s.cellType==="image"||s.cellType==="video"||typeof s.cellType=="function")&&s.imageAutoSizing||(s.headerType==="image"||s.headerType==="video"||typeof s.headerType=="function")&&s.imageAutoSizing)return!0}return!1}function aZ(n,t){var e;return syt(t,n)||((e=fD(n,t))!==null&&e!==void 0?e:{top:-1,row:-1,bottom:-1,height:-1})}function lZ(n,t){var e;return oyt(t,n)||((e=pD(n,t))!==null&&e!==void 0?e:{left:-1,col:-1,right:-1,width:1})}function w1t(n,t,e){const i=aZ(t,e),{row:r,top:s,bottom:o,height:a}=i,l=lZ(n,e),{col:h,left:d,right:u,width:c}=l;return{row:r,col:h,rect:{left:d,right:u,top:s,bottom:o,width:c,height:a}}}function pD(n,t){if(n===0)return{left:0,col:0,right:0,width:0};const e=M1t(n,t),i=t.getColsWidth(0,e);return n>=i?((r,s)=>{let o=s-t.getColWidth(r);const{colCount:a}=t.internalProps;for(let l=r;l<a;l++){const h=t.getColWidth(l),d=o+h;if(Math.round(o)<=Math.round(n)&&Math.round(n)<Math.round(d))return{left:o,col:l,right:d,width:h};o=d}return null})(e,i):((r,s)=>{let o=s;for(let a=r;a>=0;a--){const l=t.getColWidth(a),h=o-l;if(Math.round(h)<=Math.round(n)&&Math.round(n)<Math.round(o))return{left:h,col:a,right:o,width:l};o=h}return null})(e,i)}function fD(n,t){var e;if(n===0)return{top:0,row:0,bottom:0,height:0};const i=((e=t.options.customConfig)===null||e===void 0?void 0:e._disableColumnAndRowSizeRound)===!0?Math.floor:Math.round,r=A1t(n,t),s=t.getRowsHeight(0,r);return n>=s?((o,a)=>{let l=a-t.getRowHeight(o);const{rowCount:h}=t.internalProps;for(let d=o;d<h;d++){const u=t.getRowHeight(d),c=l+u;if(i(l)<=i(n)&&i(n)<i(c))return{top:l,row:d,bottom:c,height:u};l=c}return null})(r,s):((o,a)=>{let l=a;for(let h=o;h>=0;h--){const d=t.getRowHeight(h),u=l-d;if(i(u)<=i(n)&&i(n)<i(l))return{top:u,row:h,bottom:l,height:d};l=u}return null})(r,s)}function hZ(n,t,e){if(n===0)return{left:0,col:0,right:0,width:0};if(n-=e.tableX,t&&n>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&n<e.tableNoFrameWidth&&n<=e.getAllColsWidth()){for(let i=0;i<e.rightFrozenColCount;i++)if(n>e.tableNoFrameWidth-e.getColsWidth(e.colCount-i-1,e.colCount-1))return{col:e.colCount-i-1,left:void 0,right:void 0,width:void 0}}return pD(n,e)}function dZ(n,t,e){if(n===0)return{top:0,row:0,bottom:0,height:0};if(n-=e.tableY,t&&n>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&n<e.tableNoFrameHeight){for(let i=0;i<e.rightFrozenColCount;i++)if(n>e.tableNoFrameHeight-e.getRowsHeight(e.rowCount-i-1,e.rowCount-1))return{row:e.rowCount-i-1,top:void 0,bottom:void 0,height:void 0}}return fD(n,e)}function A1t(n,t){let e=t.defaultRowHeight;return t._rowRangeHeightsMap.get("$0$"+(t.rowCount-1))&&(e=t._rowRangeHeightsMap.get("$0$"+(t.rowCount-1))/t.rowCount),Math.min(Math.ceil(n/e),t.rowCount-1)}function M1t(n,t){if(t._colRangeWidthsMap.get("$0$"+(t.colCount-1))){let e=0,i=t.colCount-1;for(;i-e>1;){const r=Math.floor((e+i)/2);if(n<t._colRangeWidthsMap.get(`$0$${r}`))i=r;else{if(!(n>t._colRangeWidthsMap.get(`$0$${r}`)))return r;e=r}}return i}return Math.min(Math.ceil(n/t.internalProps.defaultColWidth),t.colCount-1)}function T1t(n,t,e){n-=e.tableX;let i=!1;(t-=e.tableY)>0&&t<e.getFrozenRowsHeight()&&(i=!0);let r=!1;n>0&&n<e.getFrozenColsWidth()&&(r=!0);let s=!1;t>e.tableNoFrameHeight-e.getBottomFrozenRowsHeight()&&t<e.tableNoFrameHeight&&t<=e.getAllRowsHeight()&&(s=!0);let o=!1;n>e.tableNoFrameWidth-e.getRightFrozenColsWidth()&&n<e.tableNoFrameWidth&&n<=e.getAllColsWidth()&&(o=!0);const a=hZ((r||o?n:n+e.scrollLeft)+e.tableX,o,e),l=dZ((i||s?t:t+e.scrollTop)+e.tableY,s,e);if(a&&l){const{row:h,top:d,bottom:u,height:c}=l,{col:g,left:p,right:f,width:m}=a;return{row:h,col:g,rect:{left:p,right:f,top:d,bottom:u,width:m,height:c}}}return{col:-1,row:-1}}function _$(n){return n.length===2&&et(n[0])&&et(n[1])&&n[1]>=n[0]}function b$(n){const t=n[1]-n[0],e=n[1]*n[0]<0;let i=n[0]<=0?0-n[0]:0,r=n[1]>0?n[1]-0:0;return t===0?n[0]<0?(i=1,r=0):n[0]>0&&(i=0,r=1):(i/=t,r/=t),{total:t,negative:i,positive:r,includeZero:e,domain:n,extendable_min:!0,extendable_max:!0}}function y$(n,t){const{positive:e,negative:i,extendable_min:r,extendable_max:s,domain:o}=n,{positive:a,negative:l,extendable_min:h,extendable_max:d,domain:u}=t;if(a>0){if(!h)return!1;let c=i/e;s&&(c=i/Math.max(e,a),o[1]=-o[0]/c),u[0]=-u[1]*c}else if(l>0){if(!d)return!1;let c=e/i;r&&(c=e/Math.max(i,i),o[0]=-o[1]/c),u[1]=-u[0]*c}return!0}function C$(n,t){const{extendable_min:e,extendable_max:i,domain:r}=n,{positive:s,negative:o,domain:a}=t;return(s!==0||o!==0)&&!(s>0&&!i)&&!(o>0&&!e)&&(r[0]=a[0],r[1]=a[1],!0)}function S$(n,t){const{positive:e,negative:i,extendable_max:r,domain:s}=n,{positive:o,negative:a,extendable_min:l,domain:h}=t;if(r&&l){const d=Math.max(i,a)/Math.max(e,o);s[1]=-s[0]/d,h[0]=-h[1]*d}else if(l){const d=i/e;h[0]=-h[1]*d}else{if(!r)return!1;{const d=a/o;s[1]=-s[0]/d}}return!0}function x$(n,t){const{extendable_min:e,domain:i}=n,{extendable_max:r,domain:s}=t;return!(!e||!r)&&(i[0]=-i[1],s[1]=-s[0],!0)}function k1t(n,t){const e=[n.min,n.max],i=[t.min,t.max];if(!_$(e)||!_$(i))return;const r=b$(e),s=b$(i),{positive:o,negative:a,extendable_max:l,includeZero:h}=r,{positive:d,negative:u,extendable_max:c,includeZero:g}=s;if(o===0&&a===0){if(!C$(r,s))return}else if(d===0&&u===0){if(!C$(s,r))return}else if(h||g)if(h&&!g){if(!y$(r,s))return}else if(g&&!h){if(!y$(s,r))return}else{if(a===u)return;if(a>u){if(!S$(r,s))return}else if(!S$(s,r))return}else{if(a===0&&d===0){if(!x$(r,s))return}else if(u===0&&o===0&&!x$(s,r))return;if(a===0&&u===0)if(e[0]===0&&i[0]>0)i[0]=0;else{if(!(i[0]===0&&e[0]>0))return;e[0]=0}if(o===0&&d===0)if(e[1]===0&&i[1]>0){if(!c)return;i[1]=0}else{if(!(i[1]===0&&e[1]>0)||!l)return;e[1]=0}}return{range1:e,range2:i}}function R1t(n,t,e,i,r,s){const o=Jt.getFunction("getAxisDomainRangeAndLabels"),{axisOption:a,isZeroAlign:l}=Zx(t,e,i===0?"right":"left",s),{ticks:h}=o(n.min,n.max,a,l,r==="bottom"||r==="top"?s._table.getColWidth(t)||s._table.tableNoFrameWidth:s._table.getRowHeight(e)||s._table.tableNoFrameHeight);return h}function wy(n,t,e,i){return i!==0&&n?()=>n.map(r=>{const s=(r-t.min)/(t.max-t.min),o=(e.max-e.min)*s+e.min;return Math.round(100*o)/100}):void 0}function B1t(n,t,e){var i,r,s,o,a,l,h;if(e._table.isPivotChart())if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){const d=Ay("top",n,t+1,n,e.columnHeaderLevelCount-1,n,t,1,e);if(!d)return;const u=e._table._getCellStyle(n,t+1),c=Be(Mt("padding",u,n,t+1,e._table)),{range:g,ticks:p,axisOption:f,targetTicks:m,targetRange:v,index:_,theme:b}=d;return J(f==null?void 0:f.min)&&(g.min=f.min,g.min>0&&(f.zero=!1)),J(f==null?void 0:f.max)&&(g.max=f.max,g.max<0&&(f.zero=!1)),Z({range:g},f,{orient:"top",type:(f==null?void 0:f.type)||"linear",label:{flush:!0},tick:{tickMode:wy(m,v,g,_)},__ticksForVTable:p,__vtableChartTheme:b,__vtablePadding:c})}if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){const d=e.getIndicatorKeyInChartSpec(n,t);let u=null;d==null||d.forEach(S=>{const w=e.getIndicatorInfo(S);w&&(u=w)});const c=Ay("bottom",n,t-1,n,t,n,t,0,e);if(!c)return;const g=e._table._getCellStyle(n,t-1),p=Be(Mt("padding",g,n,t-1,e._table)),{range:f,ticks:m,axisOption:v,index:_,targetTicks:b,targetRange:y,theme:C}=c;return J(v==null?void 0:v.min)&&(f.min=v.min,f.min>0&&(v.zero=!1)),J(v==null?void 0:v.max)&&(f.max=v.max,f.max<0&&(v.zero=!1)),Z({title:{visible:!0,text:u==null?void 0:u.title},range:f},v,{orient:"bottom",type:(v==null?void 0:v.type)||"linear",label:{flush:!0},tick:{tickMode:wy(b,y,f,_)},__ticksForVTable:m,__vtableChartTheme:C,__vtablePadding:p})}if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){let d=e.getDimensionKeyInChartSpec(e.rowHeaderLevelCount,t);V(d)&&(d=d[0]);const u=(i=e.dataset.collectedValues[d])!==null&&i!==void 0?i:[],c=e.getRowKeysPath(n,t),g=(r=u[c??""])!==null&&r!==void 0?r:[],{axisOption:p,theme:f,chartType:m}=Zx(n+1,t,"left",e);if((p==null?void 0:p.visible)===!1)return;const v=e._table._getCellStyle(n+1,t),_=Be(Mt("padding",v,n+1,t,e._table)),b=e.getRawChartSpec(n+1,t);return Z({domain:(p==null?void 0:p.type)==="linear"?void 0:Array.from(g),range:(p==null?void 0:p.type)==="linear"?g:void 0,title:{autoRotate:!0}},p,{orient:"left",type:(s=p==null?void 0:p.type)!==null&&s!==void 0?s:"band",__vtableChartTheme:f,inverse:L1t(p,((o=b==null?void 0:b.direction)!==null&&o!==void 0?o:m==="scatter"?"vertical":"horizontal")==="horizontal"),__vtablePadding:_})}}else{if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){const d=e.getIndicatorKeyInChartSpec(n,t);let u=null;d==null||d.forEach(S=>{const w=e.getIndicatorInfo(S);w&&(u=w)});const c=Ay("left",n+1,t,n,t,n,t,0,e);if(!c)return;const g=e._table._getCellStyle(n+1,t),p=Be(Mt("padding",g,n+1,t,e._table)),{range:f,ticks:m,axisOption:v,index:_,targetTicks:b,targetRange:y,theme:C}=c;return J(v==null?void 0:v.min)&&(f.min=v.min,f.min>0&&(v.zero=!1)),J(v==null?void 0:v.max)&&(f.max=v.max,f.max<0&&(v.zero=!1)),Z({title:{visible:!0,text:u==null?void 0:u.title,autoRotate:!0},range:f},v,{orient:"left",type:(v==null?void 0:v.type)||"linear",label:{flush:!0},tick:{tickMode:wy(b,y,f,_)},__ticksForVTable:m,__vtableChartTheme:C,__vtablePadding:p})}if(n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount){const d=Ay("right",n-1,t,e.rowHeaderLevelCount-1,t,n,t,1,e);if(!d)return;const u=e._table._getCellStyle(n-1,t),c=Be(Mt("padding",u,n-1,t,e._table)),{range:g,ticks:p,axisOption:f,index:m,targetTicks:v,targetRange:_,theme:b}=d;return J(f==null?void 0:f.min)&&(g.min=f.min,g.min>0&&(f.zero=!1)),J(f==null?void 0:f.max)&&(g.max=f.max,g.max<0&&(f.zero=!1)),Z({range:g,title:{autoRotate:!0}},f,{orient:"right",type:(f==null?void 0:f.type)||"linear",label:{flush:!0},tick:{tickMode:wy(v,_,g,m)},__ticksForVTable:p,__vtableChartTheme:b,__vtablePadding:c})}if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount){let d=e.getDimensionKeyInChartSpec(n,e.columnHeaderLevelCount);V(d)&&(d=d[0]);const u=(a=e.dataset.collectedValues[d])!==null&&a!==void 0?a:[],c=e.getColKeysPath(n,t),g=(l=u==null?void 0:u[c??""])!==null&&l!==void 0?l:[],{axisOption:p,isPercent:f,theme:m,chartType:v}=Zx(n,t-1,"bottom",e);if((p==null?void 0:p.visible)===!1)return;const _=e._table._getCellStyle(n,t-1),b=Be(Mt("padding",_,n,t-1,e._table));return Z({domain:(p==null?void 0:p.type)==="linear"?void 0:Array.from(g),range:(p==null?void 0:p.type)==="linear"?g:void 0},p,{orient:"bottom",type:(h=p==null?void 0:p.type)!==null&&h!==void 0?h:"band",__vtableChartTheme:m,__vtablePadding:b})}}}function Zx(n,t,e,i){var r,s;const o=i.getRawChartSpec(n,t),a=(r=o.axes)!==null&&r!==void 0?r:[];if(i._table.pivotChartAxes.forEach(u=>{a.findIndex(c=>u.orient===c.orient)===-1&&a.push(u)}),o&&V(a)){const u=a.find(c=>c.orient===e);if(u){const{seriesIndex:c,seriesId:g}=u;let p,f;L(g)&&V(o.series)?p=(V(g)?g:[g]).map(_=>{const b=o.series.findIndex(y=>y.id===_);return b>=0&&(f=o.series[b]),b}):L(c)&&V(o.series)&&(p=c);const{isZeroAlign:m,isTickAlign:v}=w$(o,e,i);return{axisOption:u,isPercent:o.percent,isZeroAlign:m,isTickAlign:v,seriesIndice:p,theme:o.theme,chartType:(s=f==null?void 0:f.type)!==null&&s!==void 0?s:o.type}}}const l=i._table.pivotChartAxes.find(u=>u.orient===e),{isZeroAlign:h,isTickAlign:d}=w$(o,e,i);return{axisOption:l,isPercent:!1,isZeroAlign:h,isTickAlign:d,theme:o.theme,chartType:o.type}}function w$(n,t,e){const i=[];let r;t==="left"||t==="right"?i.push("left","right"):t!=="top"&&t!=="bottom"||i.push("top","bottom"),r=n&&V(n.axes)?n.axes:e._table.pivotChartAxes;let s=!1,o=!1;if(V(r)){const a=[];r.forEach(l=>{i.includes(l.orient)&&a.push(l)});for(let l=0;l<a.length;l++){const h=a[l];h.sync&&h.sync.axisId&&a.find(d=>d.id===h.sync.axisId)&&(s=s||h.sync.zeroAlign,o=o||h.sync.tickAlign)}}return{isZeroAlign:s,isTickAlign:o}}function uZ(n,t,e,i,r){var s;if(V(r)){const h={min:1/0,max:-1/0};for(let d=0;d<r.length;d++){const u=uZ(n,t,e,i,r[d]);u&&(h.min=Math.min(h.min,u.min),h.max=Math.max(h.max,u.max))}return isFinite(h.min)&&isFinite(h.max)?h:null}let o=t==null?void 0:t[r];if(V(o)&&(o=o[0]),!o)return null;const a=n[o],l=Z({},(s=a==null?void 0:a[i??""])!==null&&s!==void 0?s:{min:0,max:1});return l.positiveMax&&l.positiveMax>l.max&&(l.max=l.positiveMax),l.negativeMin&&l.negativeMin<l.min&&(l.min=l.negativeMin),l.min===l.max&&(l.min>0?l.min=0:l.max=0),l}function P1t(n,t,e){if(!e._table.isPivotChart())return!1;if(e.indicatorsAsCol){if(e.hasTwoIndicatorAxes&&t===e.columnHeaderLevelCount-1&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount||t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return!0}else if(t===e.rowCount-e.bottomFrozenRowCount&&n>=e.rowHeaderLevelCount&&n<e.colCount-e.rightFrozenColCount)return!0;return!1}function E1t(n,t,e){if(!e._table.isPivotChart())return!1;if(e.indicatorsAsCol){if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return!0}else if(n===e.rowHeaderLevelCount-1&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount||n===e.colCount-e.rightFrozenColCount&&t>=e.columnHeaderLevelCount&&t<e.rowCount-e.bottomFrozenRowCount)return!0;return!1}var A$;function L1t(n,t){let e=n==null?void 0:n.inverse;return t&&!I1t(n==null?void 0:n.orient)&&(e=!L(n==null?void 0:n.inverse)||!(n!=null&&n.inverse)),e}function I1t(n){return n==="bottom"||n==="top"}(function(n){n.vertical="vertical",n.horizontal="horizontal"})(A$||(A$={}));function Ay(n,t,e,i,r,s,o,a,l){const h=l.getIndicatorKeyInChartSpec(i,r);let d;d=n==="top"||n==="bottom"?l.getColKeysPath(s,o):l.getRowKeysPath(s,o);const u=cZ(t,e,a,n,h,d,l);if(!u)return;const c=n==="bottom"?"top":n==="top"?"bottom":n==="left"?"right":"left",{targetRange:g,targetTicks:p}=O1t(t,e,u.index,u.isZeroAlign,u.isTickAlign,u.range,h,c,d,l);if(u.index!==0&&p){const f=Jt.getFunction("getAxisDomainRangeAndLabels"),{range:m,ticks:v}=f(u.range.min,u.range.max,u.axisOption,u.isZeroAlign,n==="bottom"||n==="top"?l._table.getColWidth(s)||l._table.tableNoFrameWidth:l._table.getRowHeight(o)||l._table.tableNoFrameHeight,{targetTicks:p,targetRange:g});u.range.min=m[0],u.range.max=m[1],u.ticks=v}return u.targetRange=g,u.targetTicks=p,u}function cZ(n,t,e,i,r,s,o){const{axisOption:a,isPercent:l,isZeroAlign:h,isTickAlign:d,seriesIndice:u,theme:c,chartType:g}=Zx(n,t,i,o),p=uZ(o.dataset.collectedValues,r,h,s,u??e);if(!p)return;l&&(p.min=p.min<0?-1:0,p.max=p.max>0?1:0),(a!=null&&a.zero||p.min===p.max)&&(p.min=Math.min(p.min,0),p.max=Math.max(p.max,0));const f=Jt.getFunction("getAxisDomainRangeAndLabels"),{range:m,ticks:v}=f(p.min,p.max,a,h,i==="bottom"||i==="top"?o._table.getColWidth(n)||o._table.tableNoFrameWidth:o._table.getRowHeight(t)||o._table.tableNoFrameHeight);a!=null&&a.nice&&(p.min=m[0],p.max=m[1]);const _=v;return J(a==null?void 0:a.min)&&(p.min=a.min),J(a==null?void 0:a.max)&&(p.max=a.max),{index:u??e,range:p,ticks:_,isZeroAlign:h,isTickAlign:d,axisOption:a,theme:c,chartType:g}}function O1t(n,t,e,i,r,s,o,a,l,h){let d,u;if(!i&&!r)return{targetTicks:d,targetRange:u};const c=cZ(n,t,o.length-1-e,a,o,l,h);if(c){const{range:g,ticks:p}=c;if(u=g,i){const f=k1t(s,g);f&&(s.min=f.range1[0],s.max=f.range1[1],u.min=f.range2[0],u.max=f.range2[1])}r&&(d=i?R1t(u,n,t,e,a,h):p)}return{targetTicks:d,targetRange:u}}class D1t{constructor(t,e,i){this.table=t,this.customCellStyle=e,this.customCellStyleArrangement=i}getCustomCellStyle(t,e){const i=this.getCustomCellStyleIds(t,e);if(i.length){const r=[];return i.forEach(s=>{const o=this.getCustomCellStyleOption(s);if(it(o==null?void 0:o.style)){const a=o.style({col:t,row:e,table:this.table,value:this.table.getCellValue(t,e),dataValue:this.table.getCellOriginValue(t,e),cellHeaderPaths:this.table.getCellHeaderPaths(t,e)});r.push(a)}else o!=null&&o.style&&r.push(o.style)}),Z({},...r)}}getCustomCellStyleIds(t,e){const i=[],r=this.table.getCellRange(t,e);for(let s=r.start.col;s<=r.end.col;s++)for(let o=r.start.row;o<=r.end.row;o++)this.customCellStyleArrangement.forEach(a=>{a.cellPosition.range?a.cellPosition.range.start.col<=s&&a.cellPosition.range.end.col>=s&&a.cellPosition.range.start.row<=o&&a.cellPosition.range.end.row>=o&&i.push(a.customStyleId):a.cellPosition.col===s&&a.cellPosition.row===o&&i.push(a.customStyleId)});return i}getCustomCellStyleOption(t){return this.customCellStyle.find(e=>e.id===t)}registerCustomCellStyle(t,e){const i=this.customCellStyle.findIndex(r=>r.id===t);i===-1?this.customCellStyle.push({id:t,style:e}):this.customCellStyle[i]={id:t,style:e},this.customCellStyleArrangement.forEach(r=>{const s=r.cellPosition;if(r.customStyleId===t)if(s.range)for(let o=Math.max(0,s.range.start.col);o<=Math.min(this.table.colCount-1,s.range.end.col);o++)for(let a=Math.max(0,s.range.start.row);a<=Math.min(this.table.rowCount-1,s.range.end.row);a++)this.table.scenegraph.updateCellContent(o,a);else this.table.scenegraph.updateCellContent(s.col,s.row)}),this.table.scenegraph.updateNextFrame()}arrangeCustomCellStyle(t,e,i){var r;const s=this.customCellStyleArrangement.findIndex(a=>a.cellPosition.range&&t.range?a.cellPosition.range.start.col===t.range.start.col&&a.cellPosition.range.start.row===t.range.start.row&&a.cellPosition.range.end.col===t.range.end.col&&a.cellPosition.range.end.row===t.range.end.row:a.cellPosition.col===t.col&&a.cellPosition.row===t.row);if(s===-1&&!e)return;if(s===-1&&e)this.customCellStyleArrangement.push({cellPosition:{col:t.col,row:t.row,range:t.range},customStyleId:e});else{if(this.customCellStyleArrangement[s].customStyleId===e)return;e?this.customCellStyleArrangement[s].customStyleId=e:this.customCellStyleArrangement.splice(s,1)}const o=(r=this.getCustomCellStyleOption(e))===null||r===void 0?void 0:r.style;if(o){i=!0;for(const a in o)if(T_t.indexOf(a)===-1){i=!1;break}}if(t.range)for(let a=Math.max(0,t.range.start.col);a<=Math.min(this.table.colCount-1,t.range.end.col);a++)for(let l=Math.max(0,t.range.start.row);l<=Math.min(this.table.rowCount-1,t.range.end.row);l++){const h=this.table.getCellRange(a,l);for(let d=h.start.col;d<=h.end.col;d++)for(let u=h.start.row;u<=h.end.row;u++)this.table.scenegraph.updateCellContent(d,u,i)}else this.table.scenegraph.updateCellContent(t.col,t.row,i);this.table.scenegraph.updateNextFrame()}updateCustomCell(t,e){this.customCellStyle.length=0,this.customCellStyleArrangement.length=0,t.forEach(i=>{this.registerCustomCellStyle(i.id,i.style)}),e.forEach(i=>{this.arrangeCustomCellStyle(i.cellPosition,i.customStyleId)})}hasCustomCellStyle(t){return this.customCellStyle.some(e=>e.id===t)}}function pm(n,t){n=n.clone();for(const e in t){const i=t[e];L(i)&&(n[`_${e}`]=i)}return n}const F1t=()=>{Jt.registerComponent("customCellStylePlugin",D1t)},H1t={};function z1t(n,t,e){var i,r,s,o,a,l,h,d,u,c;const g=(i=e.customCellStylePlugin)===null||i===void 0?void 0:i.getCustomCellStyle(n,t),{layoutMap:p}=e.internalProps;if(p.isHeader(n,t)){let w;if(!e.isPivotTable()||e.isBottomFrozenRow(t)||e.isRightFrozenColumn(n))w=`${n}-${t}`;else{const R=e.getHeaderDefine(n,t),B=e.isCornerHeader(n,t);w=R!=null&&R.dimensionKey?B?`dim-cor-${R.dimensionKey}`:`dim-${R.dimensionKey}`:R!=null&&R.indicatorKey?`ind-${R.indicatorKey}`:`${n}-${t}`}let x=e.headerStyleCache.get(w);if(x)return g?pm(x,g):x;const A=p.getHeader(n,t);let M;if(e.isPivotChart()&&P1t(n,t,p)&&p.isAxisCell(n,t)?M=(s=(r=p.getBody(n,e.rowHeaderLevelCount).style)===null||r===void 0?void 0:r.padding)!==null&&s!==void 0?s:e.theme.bodyStyle.padding:e.isPivotChart()&&E1t(n,t,p)&&p.isAxisCell(n,t)&&(M=(a=(o=p.getBody(e.columnHeaderLevelCount,t).style)===null||o===void 0?void 0:o.padding)!==null&&a!==void 0?a:e.theme.bodyStyle.padding),(!A||A.isEmpty)&&(p.isLeftBottomCorner(n,t)||p.isRightBottomCorner(n,t)||p.isCornerHeader(n,t)||p.isRightTopCorner(n,t)))return H1t;const T=e.internalProps.headerHelper.getStyleClass((A==null?void 0:A.headerType)||"text");if(p.isBottomFrozenRow(n,t)&&e.theme.bottomFrozenStyle)x=MC(M?{padding:M}:{},e.theme.bottomFrozenStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},T,e.options.autoWrapText,e.theme);else if(p.isRightFrozenColumn(n,t)&&e.theme.rightFrozenStyle)x=MC(M?{padding:M}:{},e.theme.rightFrozenStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},T,e.options.autoWrapText,e.theme);else{const R=(A==null?void 0:A.style)||{};M&&(R.padding=M),x=MC(R,p.isColumnHeader(n,t)||p.isBottomFrozenRow(n,t)?e.theme.headerStyle:p.isRowHeader(n,t)||p.isRightFrozenColumn(n,t)?e.theme.rowHeaderStyle:e.theme.cornerHeaderStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},T,e.options.autoWrapText,e.theme)}return e.headerStyleCache.set(w,x),g?pm(x,g):x}let f,m;!((h=(l=e.internalProps)===null||l===void 0?void 0:l.dataConfig)===null||h===void 0)&&h.mappingRules&&!e.isHeader(n,t)&&((c=(u=(d=e.internalProps)===null||d===void 0?void 0:d.dataConfig)===null||u===void 0?void 0:u.mappingRules)===null||c===void 0||c.forEach((w,x)=>{w.bgColor&&e.internalProps.layoutMap.getIndicatorKey(n,t)===w.bgColor.indicatorKey&&(f=w.bgColor.mapping)}));const v=e.getCellType(n,t),_=e.getCellOriginRecord(n,t);let b;if(m=_!=null&&_.vtableMerge?"merge-title":e.isSeriesNumberInBody(n,t)?`${n}-series-`+v:e.isListTable()&&!e.transpose||e.isPivotTable()&&e.internalProps.layoutMap.indicatorsAsCol?n+v:t+v,b=_!=null&&_.vtableMerge?e.bodyMergeTitleCache.get(m):p.isBottomFrozenRow(t)?e.bodyBottomStyleCache.get(m):e.bodyStyleCache.get(m),b)return g?pm(b,g):b;const y=p.getBody(n,t),C=e.internalProps.bodyHelper.getStyleClass(e.getCellType(n,t)),S=y==null?void 0:y.style;return b=tD(S,_!=null&&_.vtableMerge&&e.theme.groupTitleStyle?e.theme.groupTitleStyle:p.isBottomFrozenRow(t)&&e.theme.bottomFrozenStyle?e.theme.bottomFrozenStyle:p.isRightFrozenColumn(n)&&e.theme.rightFrozenStyle?e.theme.rightFrozenStyle:e.theme.bodyStyle,{col:n,row:t,table:e,value:e.getCellValue(n,t),dataValue:e.getCellOriginValue(n,t),cellHeaderPaths:e.getCellHeaderPaths(n,t)},C,e.options.autoWrapText,e.theme),f&&(b=pm(b,{bgColor:f})),it(S)||(p.isBottomFrozenRow(t)?e.bodyBottomStyleCache.set(m,b):e.bodyStyleCache.set(m,b)),g?pm(b,g):b}function M$(n){return Math.floor(n)===n}class W1t extends EO{onUpdate(t,e,i){if(this.from.x!==this.to.x){const r=t?this.to.x:this.from.x+Math.floor((this.to.x-this.from.x)*e);this.params.table.scrollLeft=r}if(this.from.y!==this.to.y){const r=t?this.to.y:this.from.y+Math.floor((this.to.y-this.from.y)*e);this.params.table.scrollTop=r}}}class j1t{constructor(t){this.table=t,this.timeline=new PO,this.ticker=new gX,this.ticker.addTimeline(this.timeline),this.ticker.setFPS(60),this.tempGraphic=wi({})}scrollTo(t,e){var i,r;const s={x:this.table.scrollLeft,y:this.table.scrollTop},{col:o,row:a}=t;let l,h,d=o,u=a;J(o)&&!M$(o)&&(d=Math.floor(o),l=o-d),J(a)&&!M$(a)&&(u=Math.floor(a),h=a-u);const c=this.table.getCellRect(d??0,u??0);let{left:g,top:p}=c;l&&(g+=l*c.width),h&&(p+=h*c.height);const f={x:J(o)?g-this.table.getFrozenColsWidth():this.table.scrollLeft,y:J(a)?p-this.table.getFrozenRowsHeight():this.table.scrollTop},m=Re(e)?e?3e3:0:(i=e==null?void 0:e.duration)!==null&&i!==void 0?i:3e3,v=Re(e)?e?"linear":"":(r=e==null?void 0:e.easing)!==null&&r!==void 0?r:"linear";new cS(Nn.GenAutoIncrementId(),this.timeline).bind(this.tempGraphic).play(new W1t(s,f,m,v,{graphic:this.tempGraphic,table:this.table})),this.ticker.start()}clear(){this.timeline.clear(),this.ticker.stop()}}function T$(n){return it(n)?n:V(n)?(t,e)=>n.find(i=>i.range.start.col<=t&&i.range.end.col>=t&&i.range.start.row<=e&&i.range.end.row>=e):void 0}class N1t{constructor(t,e){var i;this.plugins=new Map,this.table=t,(i=e.plugins)===null||i===void 0||i.map(r=>{this.register(r),this._bindTableEventForPlugin(r)})}register(t){this.plugins.set(t.id,t)}registerAll(t){t.forEach(e=>this.register(e))}getPlugin(t){return this.plugins.get(t)}getPluginByName(t){return Array.from(this.plugins.values()).find(e=>e.name===t)}_bindTableEventForPlugin(t){var e;(e=t.runTime)===null||e===void 0||e.forEach(i=>{this.table.on(i,(...r)=>{var s;(s=t.run)===null||s===void 0||s.call(t,...r,i,this.table)})})}updatePlugins(t){Array.from(this.plugins.values()).filter(i=>!(t!=null&&t.some(r=>r.id===i.id))).forEach(i=>{this.release(),this.plugins.delete(i.id)}),this.plugins.forEach(i=>{i.update&&i.update()});const e=t==null?void 0:t.filter(i=>!this.plugins.has(i.id));e==null||e.forEach(i=>{this.register(i),this._bindTableEventForPlugin(i)})}release(){this.plugins.forEach(t=>{var e;(e=t.release)===null||e===void 0||e.call(t,this.table)})}}const{toBoxArray:xh}=h0t,{isTouchEvent:$1t}=l0t,V1t=/^\$(\d+)\$(\d+)$/;W_t();class G1t extends pM{static get EVENT_TYPE(){return mt}constructor(t,e={}){var i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_;if(super(),this.showFrozenIcon=!0,this.version="1.18.3",this.id=`VTable${Date.now()}`,this.isReleased=!1,this._chartEventMap={},this.throttleInvalidate=K_t(this.render.bind(this),200),We.mode==="node"?(e=t,t=null):t instanceof HTMLElement||(e=t,t=t.container?t.container:null),!t&&e.mode!=="node"&&!e.canvas)throw new Error("vtable's container is undefined");this.pluginManager=new N1t(this,e),this.fireListeners(mt.BEFORE_INIT,{options:e,container:t}),t=e.container&&e.container instanceof HTMLElement?e.container:t,((i=e.customConfig)===null||i===void 0?void 0:i.imageAnonymous)===!1&&(oi.isImageAnonymous=!1);const{frozenColCount:b=0,unfreezeAllOnExceedsMaxWidth:y,frozenRowCount:C,defaultRowHeight:S=40,defaultHeaderRowHeight:w,defaultColWidth:x=80,defaultHeaderColWidth:A,widthMode:M="standard",heightMode:T="standard",autoFillWidth:R=!1,autoFillHeight:B=!1,widthAdaptiveMode:E="only-body",heightAdaptiveMode:k="only-body",keyboardOptions:P,eventOptions:I,rowSeriesNumber:O,columnResizeMode:H,rowResizeMode:z="none",resize:F,dragHeaderMode:j,dragOrder:$,showFrozenIcon:Y,allowFrozenColCount:G,padding:tt,hover:st,menu:ot,select:rt,customRender:pt,pixelRatio:at=Cu,renderChartAsync:W,renderChartAsyncBatchCount:N,mode:K,modeParams:nt,canvasWidth:X,canvasHeight:ht,overscrollBehavior:_t,limitMinWidth:ct,limitMinHeight:U,clearDOM:ut=!0}=e;this.container=t,this.options=e,this._widthMode=M,this._heightMode=T,this._widthAdaptiveMode=E,this._heightAdaptiveMode=k,this._autoFillWidth=R,this._autoFillHeight=B,this.customRender=pt,this.padding={top:0,right:0,left:0,bottom:0},tt&&(typeof tt=="number"?(this.padding.top=tt,this.padding.left=tt,this.padding.bottom=tt,this.padding.right=tt):(tt.top&&(this.padding.top=tt.top),tt.bottom&&(this.padding.bottom=tt.bottom),tt.left&&(this.padding.left=tt.left),tt.right&&(this.padding.right=tt.right))),(L(ht)||L(X))&&(this.canvasSizeSeted=!0),this.tableNoFrameWidth=0,this.tableNoFrameHeight=0,this.canvasWidth=J(X)?X:void 0,this.canvasHeight=J(ht)?ht:void 0,this.columnWidthComputeMode=(r=e.columnWidthComputeMode)!==null&&r!==void 0?r:"normal";const lt=this.internalProps={};Y!==void 0&&(this.showFrozenIcon=Y),typeof G=="number"&&G<=0&&(this.showFrozenIcon=!1),this.options.canvas?(We.mode!=="node"&&(lt.element=this.options.canvas.parentElement,lt.element.style.position="relative"),lt.focusControl=new m$(this,lt.element),lt.canvas=this.options.canvas,lt.context=lt.canvas.getContext("2d")):We.mode!=="node"&&(lt.element=iyt(this.padding),lt.focusControl=new m$(this,lt.element),lt.canvas=document.createElement("canvas"),lt.element.appendChild(lt.canvas),lt.context=lt.canvas.getContext("2d"),!((s=e.customConfig)===null||s===void 0)&&s.createReactContainer&&QCt(this)),lt.handler=new vM,J(this.options.resizeTime)&&(lt.handler.resizeTime=this.options.resizeTime),lt.pixelRatio=at,lt.frozenColCount=b,lt.frozenRowCount=C,lt.unfreezeAllOnExceedsMaxWidth=y==null||y,lt.defaultRowHeight=S,lt.defaultHeaderRowHeight=w??S,lt.defaultColWidth=x,lt.defaultHeaderColWidth=A??x,lt.keyboardOptions=P,lt.eventOptions=I,lt.rowSeriesNumber=O,lt.columnResizeMode=(o=F==null?void 0:F.columnResizeMode)!==null&&o!==void 0?o:H,lt.rowResizeMode=(a=F==null?void 0:F.rowResizeMode)!==null&&a!==void 0?a:z,lt.dragHeaderMode=(h=(l=$==null?void 0:$.dragHeaderMode)!==null&&l!==void 0?l:j)!==null&&h!==void 0?h:"none",lt.renderChartAsync=W,wN(N),lt.overscrollBehavior=_t??"auto",lt._rowHeightsMap=new v$(this),lt._rowRangeHeightsMap=new Map,lt._colRangeWidthsMap=new Map,lt._widthResizedColMap=new Set,lt._heightResizedRowMap=new Set,this.colWidthsMap=new Kh,this.colContentWidthsMap=new Kh,this.colWidthsLimit={};const At=this;if(lt.calcWidthContext={_:lt,get full(){var Ct;return We.mode==="node"?At.canvasWidth/(at??1):this._.canvas.width/((Ct=this._.context.pixelRatio)!==null&&Ct!==void 0?Ct:window.devicePixelRatio)}},lt.cellTextOverflows={},lt.focusedTable=!1,lt.theme=Sh.of((d=e.theme)!==null&&d!==void 0?d:Sh.DEFAULT),lt.theme.isPivot=this.isPivotTable(),Cy(lt.theme.functionalIconsStyle),t?(ut&&(t.innerHTML=""),t.appendChild(lt.element),this._updateSize()):this._updateSize(),lt.bodyHelper=new s1t(this),lt.headerHelper=new m1t(this),lt.rowSeriesNumberHelper=new v1t(this),lt.autoWrapText=e.autoWrapText,lt.enableLineBreak=e.enableLineBreak,lt.allowFrozenColCount=(u=e.allowFrozenColCount)!==null&&u!==void 0?u:0,lt.limitMaxAutoWidth=(c=e.limitMaxAutoWidth)!==null&&c!==void 0?c:450,lt.limitMinWidth=ct!=null?typeof ct=="number"?ct:ct?10:0:10,lt.limitMinHeight=U!=null?typeof U=="number"?U:U?10:0:10,this.scenegraph=new DSt(this),this.stateManager=new Mxt(this),this.eventManager=new e1t(this),this.animationManager=new j1t(this),e.legends){lt.legends=[];const Ct=Jt.getFunction("createLegend");if(Array.isArray(e.legends)){for(let Ht=0;Ht<e.legends.length;Ht++)lt.legends.push(Ct(e.legends[Ht],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else lt.legends.push(Ct(e.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(lt.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Rs.bottom},e.tooltip),lt.tooltip.renderMode==="html"){const Ct=Jt.getComponent("tooltipHandler");Ct&&(lt.tooltipHandler=new Ct(this,lt.tooltip.confine))}if(lt.menu=Object.assign({renderMode:"html"},e.menu),Array.isArray((g=e.menu)===null||g===void 0?void 0:g.dropDownMenuHighlight)&&this.setDropDownMenuHighlight((p=e.menu)===null||p===void 0?void 0:p.dropDownMenuHighlight),(Array.isArray((f=e.menu)===null||f===void 0?void 0:f.defaultHeaderMenuItems)||typeof((m=e.menu)===null||m===void 0?void 0:m.defaultHeaderMenuItems)=="function")&&(this.globalDropDownMenu=e.menu.defaultHeaderMenuItems),lt.menu.renderMode==="html"){const Ct=Jt.getComponent("menuHandler");lt.menuHandler=new Ct(this)}this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyMergeTitleCache=new Map,this.bodyBottomStyleCache=new Map,lt.stick={changedCells:new Map},lt.customMergeCell=T$(e.customMergeCell);const ft=Jt.getComponent("customCellStylePlugin");ft&&(this.customCellStylePlugin=new ft(this,(v=e.customCellStyle)!==null&&v!==void 0?v:[],(_=e.customCellStyleArrangement)!==null&&_!==void 0?_:[])),this._adjustCanvasSizeByOption()}_adjustCanvasSizeByOption(){this.options.canvasHeight!=="auto"&&this.options.canvasWidth!=="auto"||setTimeout(()=>{var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x;let A,M;if(this.options.canvasHeight==="auto"){let T=0;if(!((t=this.theme.frameStyle)===null||t===void 0)&&t.innerBorder)T+=(r=xh((i=(e=this.internalProps.theme.frameStyle)===null||e===void 0?void 0:e.shadowBlur)!==null&&i!==void 0?i:[0])[1])!==null&&r!==void 0?r:0;else if(this.theme.frameStyle){const R=xh((o=(s=this.internalProps.theme.frameStyle)===null||s===void 0?void 0:s.borderLineWidth)!==null&&o!==void 0?o:[null]),B=xh((l=(a=this.internalProps.theme.frameStyle)===null||a===void 0?void 0:a.shadowBlur)!==null&&l!==void 0?l:[0]);T+=((h=R[0])!==null&&h!==void 0?h:0)+((d=B[0])!==null&&d!==void 0?d:0)+(((u=R[2])!==null&&u!==void 0?u:0)+((c=B[2])!==null&&c!==void 0?c:0))}M=Math.min(this.options.maxCanvasHeight?this.options.maxCanvasHeight-T:2e4,this.getAllRowsHeight())+T}else M=this.canvasHeight;if(this.options.canvasWidth==="auto"){let T=0;if(!((g=this.theme.frameStyle)===null||g===void 0)&&g.innerBorder)T+=(m=xh((f=(p=this.internalProps.theme.frameStyle)===null||p===void 0?void 0:p.shadowBlur)!==null&&f!==void 0?f:[0])[2])!==null&&m!==void 0?m:0;else if(this.theme.frameStyle){const R=xh((_=(v=this.internalProps.theme.frameStyle)===null||v===void 0?void 0:v.borderLineWidth)!==null&&_!==void 0?_:[null]),B=xh((y=(b=this.internalProps.theme.frameStyle)===null||b===void 0?void 0:b.shadowBlur)!==null&&y!==void 0?y:[0]);T+=((C=R[1])!==null&&C!==void 0?C:0)+((S=B[1])!==null&&S!==void 0?S:0)+(((w=R[3])!==null&&w!==void 0?w:0)+((x=B[3])!==null&&x!==void 0?x:0))}A=Math.min(this.options.maxCanvasWidth?this.options.maxCanvasWidth-T:2e4,this.getAllColsWidth())+T}else A=this.canvasWidth;this.setCanvasSize(A,M)},0)}getContainer(){return this.container}getElement(){return this.internalProps.element}get canvas(){return this.internalProps.canvas}setCanvasSize(t,e){this.canvasWidth=t,this.canvasHeight=e,this.options.canvasHeight=e,this.options.canvasWidth=t,this.resize()}resize(){var t;this._updateSize(),(t=this.internalProps.legends)===null||t===void 0||t.forEach(e=>{e==null||e.resize()}),this.internalProps.title&&this.internalProps.title.resize(),this.internalProps.emptyTip&&this.internalProps.emptyTip.resize(),this.scenegraph.resize()}get rowCount(){return this.internalProps.rowCount}set rowCount(t){this.internalProps.rowCount=t}get colCount(){var t;return(t=this.internalProps.colCount)!==null&&t!==void 0?t:0}set colCount(t){this.internalProps.colCount=t}get frozenColCount(){var t,e,i,r,s;return(s=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.frozenColCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.frozenColCount)!==null&&s!==void 0?s:0}set frozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const i=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=i}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t,this.options.frozenColCount=t;const e=this._getMaxFrozenWidth();if(this.getColsWidth(0,t-1)>e)if(this.internalProps.unfreezeAllOnExceedsMaxWidth)this.internalProps.frozenColCount=0;else{const i=this._getComputedFrozenColCount(t);this.internalProps.frozenColCount=i}this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}_setFrozenColCount(t){t>=this.colCount&&(t=0),this.internalProps.frozenColCount=t}_resetFrozenColCount(){this.options.frozenColCount&&(this.tableNoFrameWidth-this.getColsWidth(0,this.options.frozenColCount-1)<=120?this._setFrozenColCount(0):this.frozenColCount!==this.options.frozenColCount&&this._setFrozenColCount(this.options.frozenColCount))}get frozenRowCount(){var t,e,i,r,s;return(s=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.frozenRowCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.frozenRowCount)!==null&&s!==void 0?s:0}set frozenRowCount(t){this.internalProps.frozenRowCount=t,this.stateManager.setFrozenRow(this.internalProps.frozenRowCount)}get rightFrozenColCount(){var t,e,i,r,s;return(s=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.rightFrozenColCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.rightFrozenColCount)!==null&&s!==void 0?s:0}set rightFrozenColCount(t){this.scenegraph.dealWidthRightFrozen(t)}get bottomFrozenRowCount(){var t,e,i,r,s;return(s=(i=(e=(t=this.internalProps)===null||t===void 0?void 0:t.layoutMap)===null||e===void 0?void 0:e.bottomFrozenRowCount)!==null&&i!==void 0?i:(r=this.internalProps)===null||r===void 0?void 0:r.bottomFrozenRowCount)!==null&&s!==void 0?s:0}set bottomFrozenRowCount(t){this.scenegraph.dealWidthBottomFrozen(t)}get defaultRowHeight(){return J(this.internalProps.defaultRowHeight)?this.internalProps.defaultRowHeight:40}set defaultRowHeight(t){this.internalProps.defaultRowHeight=t,this.options.defaultRowHeight=t}get defaultHeaderRowHeight(){return this.internalProps.defaultHeaderRowHeight}set defaultHeaderRowHeight(t){this.internalProps.defaultHeaderRowHeight=t,this.options.defaultHeaderRowHeight=t}get defaultColWidth(){return this.internalProps.defaultColWidth}set defaultColWidth(t){this.internalProps.defaultColWidth=t,this.options.defaultColWidth=t}get defaultHeaderColWidth(){return this.internalProps.defaultHeaderColWidth}set defaultHeaderColWidth(t){this.internalProps.defaultHeaderColWidth=t,this.options.defaultHeaderColWidth=t}get colWidthsMap(){return this.internalProps._colWidthsMap}set colWidthsMap(t){this.internalProps._colWidthsMap=t}get colContentWidthsMap(){return this.internalProps._colContentWidthsMap}set colContentWidthsMap(t){this.internalProps._colContentWidthsMap=t}get _colRangeWidthsMap(){return this.internalProps._colRangeWidthsMap}set _colRangeWidthsMap(t){this.internalProps._colRangeWidthsMap=t}get _rowRangeHeightsMap(){return this.internalProps._rowRangeHeightsMap}set _rowRangeHeightsMap(t){this.internalProps._rowRangeHeightsMap=t}get rowHeightsMap(){return this.internalProps._rowHeightsMap}set rowHeightsMap(t){this.internalProps._rowHeightsMap=t}get colWidthsLimit(){return this.internalProps._colWidthsLimit}set colWidthsLimit(t){this.internalProps._colWidthsLimit=t}get keyboardOptions(){var t;return(t=this.internalProps.keyboardOptions)!==null&&t!==void 0?t:null}set keyboardOptions(t){this.internalProps.keyboardOptions=t??void 0}get eventOptions(){var t;return(t=this.internalProps.eventOptions)!==null&&t!==void 0?t:null}set eventOptions(t){this.internalProps.eventOptions=t??void 0}get widthMode(){return this._widthMode}set widthMode(t){t!==this._widthMode&&(this._widthMode=t,this.options.widthMode=t)}get heightMode(){return this._heightMode}set heightMode(t){t!==this._heightMode&&(this._heightMode=t,this.options.heightMode=t)}get autoFillWidth(){return this._autoFillWidth}set autoFillWidth(t){t!==this._autoFillWidth&&(this._autoFillWidth=t)}get autoFillHeight(){return this._autoFillHeight}set autoFillHeight(t){t!==this._autoFillHeight&&(this._autoFillHeight=t)}get widthAdaptiveMode(){return this._widthAdaptiveMode}set widthAdaptiveMode(t){t!==this._widthAdaptiveMode&&(this._widthAdaptiveMode=t)}get heightAdaptiveMode(){return this._heightAdaptiveMode}set heightAdaptiveMode(t){t!==this._heightAdaptiveMode&&(this._heightAdaptiveMode=t)}_colWidthDefineToPxWidth(t){return t==="auto"?0:hg(this,t)}_getMaxFrozenWidth(){var t;const e=(t=this.options.maxFrozenWidth)!==null&&t!==void 0?t:"80%";return hg(this,e)}_getComputedFrozenColCount(t){const e=this._getMaxFrozenWidth();let i=t;for(;this.getColsWidth(0,i-1)>e&&(i--,!(i<=0)););return i}_getColWidthLimits(t){const e=this.colWidthsLimit[t];if(!e)return null;const i={};return e.min&&(i.min=hg(this,e.min),i.minDef=e.min),e.max&&(i.max=hg(this,e.max),i.maxDef=e.max),i}_adjustColWidth(t,e){const i=this._getColWidthLimits(t);return Math.max(ayt(i,e),0)}get pixelRatio(){return this.internalProps.pixelRatio}setPixelRatio(t){var e;if(t!==((e=this.internalProps)===null||e===void 0?void 0:e.pixelRatio)){this.internalProps.pixelRatio=t;const i=this.canvasWidth;this.internalProps.calcWidthContext={_:this.internalProps,get full(){var r;return We.mode==="node"?i/(t??1):this._.canvas.width/((r=this._.context.pixelRatio)!==null&&r!==void 0?r:window.devicePixelRatio)}},this.scenegraph.setPixelRatio(t)}}_updateSize(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T,R,B,E;const{padding:k}=this;let P=0,I=0;if(this.tableX=0,this.tableY=0,this.options.canvas&&this.options.viewBox)P=this.options.viewBox.x2-this.options.viewBox.x1,I=this.options.viewBox.y2-this.options.viewBox.y1,!((t=this==null?void 0:this.scenegraph)===null||t===void 0)&&t.stage&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(P,I));else if(We.mode==="browser"){const z=this.getElement();let F=0,j=0;const $=L(this.canvasWidth),Y=L(this.canvasHeight);if(this.canvasSizeSeted&&($&&(F=this.canvasWidth),Y&&(j=this.canvasHeight)),(!$||!Y)&&z.parentElement){const tt=z.parentElement.style||window.getComputedStyle(z.parentElement);$||(F=z.parentElement.offsetWidth-(parseInt(tt.paddingLeft,10)||0)-(parseInt(tt.paddingRight,10)||0)),Y||(j=z.parentElement.offsetHeight-parseInt(tt.paddingTop||"0px",10)-parseInt(tt.paddingBottom||"0px",20)),F=(F??1)-(this.options.tableSizeAntiJitter?1:0),j=(j??1)-(this.options.tableSizeAntiJitter?1:0)}z.style.width=F&&F-k.left-k.right+"px"||"0px",z.style.height=j&&j-k.top-k.bottom+"px"||"0px";const{canvas:G}=this.internalProps;P=((i=(e=G.parentElement)===null||e===void 0?void 0:e.offsetWidth)!==null&&i!==void 0?i:1)-(this.options.tableSizeAntiJitter?1:0),I=((s=(r=G.parentElement)===null||r===void 0?void 0:r.offsetHeight)!==null&&s!==void 0?s:1)-(this.options.tableSizeAntiJitter?1:0),!((o=this==null?void 0:this.scenegraph)===null||o===void 0)&&o.stage?!((a=this.options)===null||a===void 0)&&a.viewBox&&!(!((l=this.options)===null||l===void 0)&&l.canvas)&&this.scenegraph.stage.resize(P,I):(G.style.width="",G.style.height="",G.width=P,G.height=I,G.style.width=`${P}px`,G.style.height=`${I}px`),!((h=this.options)===null||h===void 0)&&h.viewBox&&(P=this.options.viewBox.x2-this.options.viewBox.x1,I=this.options.viewBox.y2-this.options.viewBox.y1),!((d=this==null?void 0:this.scenegraph)===null||d===void 0)&&d.stage&&(this.options.viewBox?this.scenegraph.stage.setViewBox(this.options.viewBox,!1):this.scenegraph.stage.resize(P,I))}else We.mode==="node"&&(P=this.canvasWidth-1,I=this.canvasHeight-1);const O=Math.floor(P-N_t(this.getTheme().scrollStyle)),H=Math.floor(I-j_t(this.getTheme().scrollStyle));if(!((u=this.internalProps.theme)===null||u===void 0)&&u.frameStyle){const z=xh((g=(c=this.internalProps.theme.frameStyle)===null||c===void 0?void 0:c.borderLineWidth)!==null&&g!==void 0?g:[null]),F=xh((f=(p=this.internalProps.theme.frameStyle)===null||p===void 0?void 0:p.shadowBlur)!==null&&f!==void 0?f:[0]);!((m=this.theme.frameStyle)===null||m===void 0)&&m.innerBorder?(this.tableX=0,this.tableY=0,this.tableNoFrameWidth=O-((v=F[1])!==null&&v!==void 0?v:0),this.tableNoFrameHeight=H-((_=F[2])!==null&&_!==void 0?_:0)):(this.tableX=((b=z[3])!==null&&b!==void 0?b:0)+((y=F[3])!==null&&y!==void 0?y:0),this.tableY=((C=z[0])!==null&&C!==void 0?C:0)+((S=F[0])!==null&&S!==void 0?S:0),this.tableNoFrameWidth=O-(((w=z[1])!==null&&w!==void 0?w:0)+((x=F[1])!==null&&x!==void 0?x:0))-(((A=z[3])!==null&&A!==void 0?A:0)+((M=F[3])!==null&&M!==void 0?M:0)),this.tableNoFrameHeight=H-(((T=z[0])!==null&&T!==void 0?T:0)+((R=F[0])!==null&&R!==void 0?R:0))-(((B=z[2])!==null&&B!==void 0?B:0)+((E=F[2])!==null&&E!==void 0?E:0)))}this._clearColRangeWidthsMap(),this._clearRowRangeHeightsMap()}updateViewBox(t){var e,i,r,s,o,a,l,h,d,u,c,g;const p=((r=(i=(e=this.options)===null||e===void 0?void 0:e.viewBox)===null||i===void 0?void 0:i.x2)!==null&&r!==void 0?r:0)-((a=(o=(s=this.options)===null||s===void 0?void 0:s.viewBox)===null||o===void 0?void 0:o.x1)!==null&&a!==void 0?a:0),f=((d=(h=(l=this.options)===null||l===void 0?void 0:l.viewBox)===null||h===void 0?void 0:h.y2)!==null&&d!==void 0?d:0)-((g=(c=(u=this.options)===null||u===void 0?void 0:u.viewBox)===null||c===void 0?void 0:c.y1)!==null&&g!==void 0?g:0),m=t.x2-t.x1,v=t.y2-t.y1;this.options.viewBox=t,p!==m||f!==v?this.resize():this.scenegraph.stage.setViewBox(this.options.viewBox,!0)}setViewBoxTransform(t,e,i,r,s,o){this.internalProps.modifiedViewBoxTransform=!0,this.scenegraph.stage.window.setViewBoxTransform(t,e,i,r,s,o)}get rowHierarchyType(){return this.dataSource.rowHierarchyType}getColsWidth(t,e){var i;if(t>e)return 0;t=Math.max(t,0),e=Math.min(e,((i=this.colCount)!==null&&i!==void 0?i:1/0)-1);const r=this._colRangeWidthsMap.get(`$${t}$${e}`);if(r!=null)return r;const s=this._colRangeWidthsMap.get(`$${t}$${e-1}`);if(s!=null){const a=s+this.getColWidth(e);return t>=0&&e>=0&&!Number.isNaN(a)&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(a)),Math.round(a)}let o=0;for(let a=t;a<=e;a++)o+=this.getColWidth(a);return t>=0&&e>=0&&this._colRangeWidthsMap.set(`$${t}$${e}`,Math.round(o)),Math.round(o)}getRowHeight(t){var e;if(L(this.rowHeightsMap.get(t))){if(!((e=this.options.customConfig)===null||e===void 0)&&e._disableColumnAndRowSizeRound){const r=this.rowHeightsMap.get(t);let s;return s=t<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,t):t>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(t,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,t),s=Number(s.toFixed(2)),Number.isInteger(s)?Math.ceil(r):Math.floor(r)}return this.rowHeightsMap.get(t)}const i=this.getDefaultRowHeight(t);return J(i)?i:this.defaultRowHeight}getDefaultColumnWidth(t){var e,i;return this.isRowHeader(t,0)||this.isCornerHeader(t,0)?Array.isArray(this.defaultHeaderColWidth)?(e=this.defaultHeaderColWidth[t])!==null&&e!==void 0?e:this.defaultColWidth:this.defaultHeaderColWidth:this.isRightFrozenColumn(t,this.columnHeaderLevelCount)&&this.isPivotTable()?Array.isArray(this.defaultHeaderColWidth)?(i=this.defaultHeaderColWidth[this.rowHeaderLevelCount-this.rightFrozenColCount])!==null&&i!==void 0?i:this.defaultColWidth:this.defaultHeaderColWidth:this.defaultColWidth}getDefaultRowHeight(t){var e,i;return this.isColumnHeader(0,t)||this.isCornerHeader(0,t)||this.isSeriesNumberInHeader(0,t)?Array.isArray(this.defaultHeaderRowHeight)?(e=this.defaultHeaderRowHeight[t])!==null&&e!==void 0?e:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.isBottomFrozenRow(t)?Array.isArray(this.defaultHeaderRowHeight)?(i=this.defaultHeaderRowHeight[this.columnHeaderLevelCount>0?this.columnHeaderLevelCount-this.bottomFrozenRowCount:0])!==null&&i!==void 0?i:this.internalProps.defaultRowHeight:this.defaultHeaderRowHeight:this.internalProps.defaultRowHeight}_setRowHeight(t,e,i){var r;this.rowHeightsMap.put(t,!((r=this.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound?e:Math.round(e)),i&&this._clearRowRangeHeightsMap(t)}setRowHeight(t,e){this.scenegraph.setRowHeight(t,e),this.scenegraph.updateChartSizeForResizeRowHeight(t),this.internalProps._heightResizedRowMap.add(t)}getRowsHeight(t,e){var i,r;if(t>e||this.rowCount===0)return 0;t=Math.max(t,0),e=Math.min(e,((i=this.rowCount)!==null&&i!==void 0?i:1/0)-1);let s=0;const o=this.options.defaultRowHeight==="auto";if(this.heightMode!=="standard"||this.options.customComputeRowHeight||this.autoFillHeight||!this.internalProps.layoutMap||this.hasAutoImageColumn()||o||this.internalProps._heightResizedRowMap.size!==0){if(!((r=this.options.customConfig)===null||r===void 0)&&r._disableColumnAndRowSizeRound){const a=this.rowHeightsMap.getSumInRange(t,e);let l;return l=e<this.frozenRowCount?this.rowHeightsMap.getSumInRange(0,e):e>=this.rowCount-this.bottomFrozenRowCount?this.rowHeightsMap.getSumInRange(e,this.rowCount-1):this.rowHeightsMap.getSumInRange(this.frozenRowCount,e),l=Number(l.toFixed(2)),Number.isInteger(l)?Math.ceil(a):Math.floor(a)}s=this.rowHeightsMap.getSumInRange(t,e)}else{for(let a=t;a<Math.min(e+1,this.columnHeaderLevelCount);a++)s+=this.getRowHeight(a);e>=this.columnHeaderLevelCount&&(s+=this.defaultRowHeight*(Math.min(e,this.rowCount-this.bottomFrozenRowCount-1)-Math.max(this.columnHeaderLevelCount,t)+1));for(let a=this.rowCount-this.bottomFrozenRowCount;a<e+1;a++)s+=this.getRowHeight(a)}return Math.round(s)}getColWidthDefined(t){var e;const{layoutMap:i}=this.internalProps;if(this.widthMode==="autoWidth")return"auto";const{width:r}=(e=i==null?void 0:i.getColumnWidthDefined(t))!==null&&e!==void 0?e:{};return typeof r=="number"&&r<=0?0:r||this.getDefaultColumnWidth(t)}getColWidthDefinedNumber(t){const e=this.getColWidthDefined(t);return this._adjustColWidth(t,this._colWidthDefineToPxWidth(e))}isAutoRowHeight(t){return this.heightMode==="autoHeight"||!!this.options.customComputeRowHeight||(t>=0&&t<this.columnHeaderLevelCount?this.getDefaultRowHeight(t)==="auto":this.internalProps.defaultRowHeight==="auto")}getColWidth(t){var e;const i=(e=this.colWidthsMap.get(t))!==null&&e!==void 0?e:this.getDefaultColumnWidth(t);return this.widthMode==="adaptive"&&typeof i=="number"||this.transpose&&typeof i=="number"?this._colWidthDefineToPxWidth(i):this._adjustColWidth(t,this._colWidthDefineToPxWidth(i))}_setColWidth(t,e,i,r){this.colWidthsMap.put(t,typeof e=="number"?Math.round(e):e),i&&this._clearColRangeWidthsMap(t),r||this.stateManager.checkFrozen()}setColWidth(t,e){this.scenegraph.setColWidth(t,e),this.scenegraph.updateChartSizeForResizeColWidth(t),this.internalProps._widthResizedColMap.add(t)}_clearColRangeWidthsMap(t){if(typeof t!="number")this._colRangeWidthsMap.clear();else{const e=this._colRangeWidthsMap.keys();for(const i of e){const r=V1t.exec(i);if(r){const s=Number(r[1]),o=Number(r[2]);t>=s&&t<=o&&this._colRangeWidthsMap.delete(i)}}}}_clearRowRangeHeightsMap(t){this.rowHeightsMap.clearRange()}_getColContentWidth(t){return Number(this.colContentWidthsMap.get(t))}_setColContentWidth(t,e){this.colContentWidthsMap.put(t,e)}getAllRowsHeight(){return this.internalProps.rowCount<=0?0:this.getRowsHeight(0,this.internalProps.rowCount-1)}getAllColsWidth(){return this.internalProps.colCount<=0?0:this.getColsWidth(0,this.internalProps.colCount-1)}getColsWidths(){const t=this.colCount,e=[];for(let i=0;i<t;i++)e.push(this.getColWidth(i));return e}getMaxColWidth(t){var e;const i=this.colWidthsLimit[t];let r=(e=i&&i.max)!==null&&e!==void 0?e:1/0;return typeof r=="string"&&(r=hg(this,r)),r}setMaxColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).max=e}getMinColWidth(t){var e;const i=this.colWidthsLimit[t];let r=(e=i&&i.min)!==null&&e!==void 0?e:0;return typeof r=="string"&&(r=hg(this,r)),r}setMinColWidth(t,e){(this.colWidthsLimit[t]||(this.colWidthsLimit[t]={})).min=e}getCellRect(t,e){var i,r;const s=this.isFrozenCell(t,e);let o;const a=this.getColWidth(t);let l;o=s&&s.col&&this.isRightFrozenColumn(t,e)?this.getAllColsWidth()<=this.tableNoFrameWidth?this.getColsWidth(0,t-1)||0:this.tableNoFrameWidth-((i=this.getColsWidth(t,this.colCount-1))!==null&&i!==void 0?i:0):this.getColsWidth(0,t-1)||0;const h=this.getRowHeight(e);return l=s&&s.row&&this.isBottomFrozenRow(t,e)?this.getAllRowsHeight()<=this.tableNoFrameHeight?this.getRowsHeight(0,e-1):this.tableNoFrameHeight-((r=this.getRowsHeight(e,this.rowCount-1))!==null&&r!==void 0?r:0):this.getRowsHeight(0,e-1),new Tu(Math.round(o),Math.round(l),Math.round(a),Math.round(h))}getMergeCellRect(t,e){const i=this.getCellRange(t,e),r=this.getColsWidth(0,i.start.col-1)||0,s=this.getColsWidth(i.start.col,i.end.col),o=this.getRowsHeight(0,i.start.row-1)||0,a=this.getRowsHeight(i.start.row,i.end.row);return new Tu(Math.round(r),Math.round(o),Math.round(s),Math.round(a))}getCellRelativeRect(t,e){const i=this.isFrozenCell(t,e);let r=!0,s=!0;i!=null&&i.col&&(i!=null&&i.row)?(r=!1,s=!1):i!=null&&i.col?r=!1:i!=null&&i.row&&(s=!1);const o=this.getCellRect(t,e);return this._toRelativeRect(o,r,s)}getCellRangeRelativeRect(t){if(t.start){const o=this.isFrozenCell(t.start.col,t.start.row);let a=!0,l=!0;return o!=null&&o.col&&(o!=null&&o.row)?(a=!1,l=!1):o!=null&&o.col?a=!1:o!=null&&o.row&&(l=!1),this._toRelativeRect(this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row),a,l)}const e=this.getCellRange(t.col,t.row),i=this.isFrozenCell(t.col,t.row);let r=!0,s=!0;return i!=null&&i.col&&(i!=null&&i.row)?(r=!1,s=!1):i!=null&&i.col?r=!1:i!=null&&i.row&&(s=!1),this._toRelativeRect(this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row),r,s)}getVisibleCellRangeRelativeRect(t){let e;return e=t.start?t:this.getCellRange(t.col,t.row),this._getVisiableRect(this.getCellRangeRelativeRect(t),e)}_getVisiableRect(t,e){const i=e.start.col>=this.frozenColCount?Math.max(t.left,this.frozenColCount>=1?this.getColsWidth(0,this.frozenColCount-1):0):t.left,r=Math.min(t.right,this.tableNoFrameWidth),s=t.copy();s.left=i,s.right=r;const o=e.start.row>=this.frozenRowCount?Math.max(t.top,this.frozenRowCount>=1?this.getRowsHeight(0,this.frozenRowCount-1):0):t.top,a=Math.min(t.bottom,this.tableNoFrameHeight);return s.top=o,s.bottom=a,s}getCellsRect(t,e,i,r){var s,o,a,l,h,d;let u=this.getColsWidth(0,t-1)||0,c=this.getColsWidth(t,i);const g=this.scrollLeft,p=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),f=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());this.isLeftFrozenColumn(t)&&this.isRightFrozenColumn(i)?c=this.tableNoFrameWidth-((s=this.getColsWidth(t+1,this.colCount-1))!==null&&s!==void 0?s:0)-u:this.isLeftFrozenColumn(t)&&!this.isLeftFrozenColumn(i)?c=Math.max(c-g,this.getColsWidth(t,this.frozenColCount-1)):!this.isRightFrozenColumn(t)&&this.isRightFrozenColumn(i)?(u=Math.min(u-g,p-this.getRightFrozenColsWidth()),c=p-((o=this.getColsWidth(t+1,this.colCount-1))!==null&&o!==void 0?o:0)-u):this.isRightFrozenColumn(t)&&(u=p-((a=this.getColsWidth(t,this.colCount-1))!==null&&a!==void 0?a:0));let m=this.getRowsHeight(0,e-1),v=this.getRowsHeight(e,r);const _=this.scrollTop;return this.isTopFrozenRow(e)&&this.isBottomFrozenRow(r)?v=this.tableNoFrameHeight-((l=this.getRowsHeight(e+1,this.rowCount-1))!==null&&l!==void 0?l:0)-m:this.isTopFrozenRow(e)&&!this.isTopFrozenRow(r)?v=Math.max(v-_,this.getRowsHeight(e,this.frozenRowCount-1)):!this.isBottomFrozenRow(e)&&this.isBottomFrozenRow(r)?(m=Math.min(m-_,f-this.getBottomFrozenRowsHeight()),v=f-((h=this.getRowsHeight(e+1,this.rowCount-1))!==null&&h!==void 0?h:0)-m):this.isBottomFrozenRow(e)&&(m=f-((d=this.getRowsHeight(e,this.rowCount-1))!==null&&d!==void 0?d:0)),new Tu(Math.round(u),Math.round(m),Math.round(c),Math.round(v))}getCellsRectWidth(t,e,i,r){const s=this.isFrozenCell(t,e),o=this.isFrozenCell(i,r);let a=this.getColsWidth(t,i);if(s&&s.col){const l=this.scrollLeft;o&&o.col||(a-=l,a=Math.max(a,this.getColsWidth(t,this.frozenColCount-1)))}return a}getCellRangeRect(t){if(t.start)return this.getCellsRect(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRect(e.start.col,e.start.row,e.end.col,e.end.row)}getCellRangeRectWidth(t){if(t.start)return this.getCellsRectWidth(t.start.col,t.start.row,t.end.col,t.end.row);const e=this.getCellRange(t.col,t.row);return this.getCellsRectWidth(e.start.col,e.start.row,e.end.col,e.end.row)}isFrozenCell(t,e){const i=this.isFrozenRow(e),r=this.isFrozenColumn(t);return i||r?{row:i,col:r}:null}getRowAt(t){return aZ(t,this)}getColAt(t){return lZ(t,this)}getCellAt(t,e){return w1t(t,e,this)}getCellAtRelativePosition(t,e){return T1t(t,e,this)}_checkRowCol(t,e){return t>=0&&t<this.colCount&&e>=0&&e<this.rowCount}_makeVisibleCell(t,e){if(this._checkRowCol(t,e)){const i=this.isFrozenCell(t,e);if(i&&i.col&&i.row)return;const r=this.getCellRect(t,e),s=lyt(this);if(s.contains(r))return;i&&i.col||this.getColsWidth(0,this.frozenColCount-1)+r.width>this.canvas.width||(r.left<s.left?this.scrollLeft-=s.left-r.left:s.right<r.right&&(this.scrollLeft-=s.right-r.right)),i&&i.row||this.getRowsHeight(0,this.frozenRowCount-1)+r.height>this.canvas.height||(r.top<s.top?this.scrollTop-=s.top-r.top:s.bottom<r.bottom&&(this.scrollTop-=s.bottom-r.bottom))}}render(){this.scenegraph.renderSceneGraph()}renderAsync(){return this.scenegraph.updateNextFrame(),new Promise((t,e)=>{setTimeout(()=>{t()},0)})}_toRelativeRect(t,e=!0,i=!0){var r,s,o,a;const l=t.copy(),h=this.getVisibleRect();return l.offsetLeft(this.tableX-(e?h.left:0)),l.offsetTop(this.tableY-(i?h.top:0)),l.offsetLeft((s=(r=this.options.viewBox)===null||r===void 0?void 0:r.x1)!==null&&s!==void 0?s:0),l.offsetTop((a=(o=this.options.viewBox)===null||o===void 0?void 0:o.y1)!==null&&a!==void 0?a:0),l}getVisibleRect(){const{scrollTop:t,scrollLeft:e}=this,i=this.tableNoFrameWidth,r=this.tableNoFrameHeight;return new Tu(e,t,i,r)}get visibleRowCount(){const{frozenRowCount:t}=this,e=this.getVisibleRect(),i=t>0?e.top+this.getRowsHeight(0,t-1):e.top,r=this.getTargetRowAt(i);if(!r)return 0;const s=Math.max(r.top>=i?r.row:r.row+1,t);let o=this.getRowsHeight(0,s-1),a=0;const{rowCount:l}=this;for(let h=s;h<l;h++){const d=o+this.getRowHeight(h);if(e.bottom<d)break;a++,o=d}return a}getBodyVisibleCellRange(){const{scrollTop:t,scrollLeft:e}=this,i=this.getFrozenRowsHeight(),r=this.getFrozenColsWidth(),s=this.getBottomFrozenRowsHeight(),o=this.getRightFrozenColsWidth(),{row:a}=this.getRowAt(t+i+1),{col:l}=this.getColAt(e+r+1),h=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-s).row:this.rowCount-1,d=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(e+this.tableNoFrameWidth-1-o).col:this.colCount-1;return d<0||h<0?null:{rowStart:a,colStart:l,rowEnd:h,colEnd:d}}getBodyVisibleRowRange(){const{scrollTop:t}=this,e=this.getFrozenRowsHeight(),i=this.getBottomFrozenRowsHeight(),{row:r}=this.getRowAt(t+e+1),s=this.getAllRowsHeight()>this.tableNoFrameHeight?this.getRowAt(t+this.tableNoFrameHeight-1-i).row:this.rowCount-1;return s<0?null:{rowStart:r,rowEnd:s}}getBodyVisibleColRange(){const{scrollLeft:t}=this,e=this.getFrozenColsWidth(),i=this.getRightFrozenColsWidth(),{col:r}=this.getColAt(t+e+1),s=this.getAllColsWidth()>this.tableNoFrameWidth?this.getColAt(t+this.tableNoFrameWidth-1-i).col:this.colCount-1;return s<0?null:{colStart:r,colEnd:s}}get visibleColCount(){const{frozenColCount:t}=this,e=this.getVisibleRect(),i=t>0?e.left+this.getColsWidth(0,t-1):e.left,r=this.getTargetColAt(i);if(!r)return 0;const s=Math.max(r.left>=i?r.col:r.col+1,t);let o=this.getColsWidth(0,s-1),a=0;const{colCount:l}=this;for(let h=s;h<l;h++){const d=o+this.getColWidth(h);if(e.right<d)break;a++,o=d}return a}get scrollTop(){return this.stateManager.scroll.verticalBarPos}set scrollTop(t){this.stateManager.setScrollTop(t)}get scrollLeft(){return this.stateManager.scroll.horizontalBarPos}set scrollLeft(t){this.stateManager.setScrollLeft(t)}getScrollLeft(){return this.scrollLeft}getScrollTop(){return this.scrollTop}setScrollLeft(t){this.scrollLeft=Math.ceil(t)}setScrollTop(t){this.scrollTop=Math.ceil(t)}getCellOverflowText(t,e){return this.scenegraph.getCellOverflowText(t,e)}addReleaseObj(t){if(!t||!t.release||typeof t.release!="function")throw new Error("not releaseObj!");(this.internalProps.releaseList=this.internalProps.releaseList||[]).push(t)}dispose(){this.release()}release(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m;const v=this.internalProps;if(this.isReleased)return;(e=(t=v.tooltipHandler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),(r=(i=v.menuHandler)===null||i===void 0?void 0:i.release)===null||r===void 0||r.call(i),(s=super.release)===null||s===void 0||s.call(this),(a=(o=v.handler)===null||o===void 0?void 0:o.release)===null||a===void 0||a.call(o),this.eventManager.release(),(h=(l=v.focusControl)===null||l===void 0?void 0:l.release)===null||h===void 0||h.call(l),(d=v.legends)===null||d===void 0||d.forEach(b=>{b==null||b.release()}),(u=v.title)===null||u===void 0||u.release(),v.title=null,(c=v.emptyTip)===null||c===void 0||c.release(),v.emptyTip=null,v.layoutMap.release(),v.releaseList&&(v.releaseList.forEach(b=>{var y;return(y=b==null?void 0:b.release)===null||y===void 0?void 0:y.call(b)}),v.releaseList=null),this.scenegraph.stage.release(),this.scenegraph.proxy.release(),v.focusControl.release();const{parentElement:_}=v.element;_&&!this.options.canvas&&_.removeChild(v.element),(f=(p=(g=this.editorManager)===null||g===void 0?void 0:g.editingEditor)===null||p===void 0?void 0:p.onEnd)===null||f===void 0||f.call(p),this.isReleased=!0,this.scenegraph=null,this.internalProps=null,(m=this.reactCustomLayout)===null||m===void 0||m.clearCache(),this.pluginManager.release(),dL()}fireListeners(t,e){return super.fireListeners(t,e)}updateOption(t){var e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y;(e=this.editorManager)===null||e===void 0||e.cancelEdit(),this.options=t,this._hasAutoImageColumn=void 0;const{frozenColCount:C=0,unfreezeAllOnExceedsMaxWidth:S,defaultRowHeight:w=40,defaultHeaderRowHeight:x,defaultColWidth:A=80,defaultHeaderColWidth:M=80,keyboardOptions:T,eventOptions:R,rowSeriesNumber:B,columnResizeMode:E,rowResizeMode:k="none",resize:P,dragHeaderMode:I,dragOrder:O,showFrozenIcon:H,allowFrozenColCount:z,padding:F,hover:j,menu:$,select:Y,pixelRatio:G,widthMode:tt,heightMode:st,autoFillWidth:ot,autoFillHeight:rt,widthAdaptiveMode:pt,heightAdaptiveMode:at,customRender:W,renderChartAsync:N,renderChartAsyncBatchCount:K,canvasWidth:nt,canvasHeight:X,overscrollBehavior:ht,limitMinWidth:_t,limitMinHeight:ct}=t;G&&G!==this.internalProps.pixelRatio&&(this.internalProps.pixelRatio=G),F&&(typeof F=="number"?(this.padding.top=F,this.padding.left=F,this.padding.bottom=F,this.padding.right=F):(F.top&&(this.padding.top=F.top),F.bottom&&(this.padding.bottom=F.bottom),F.left&&(this.padding.left=F.left),F.right&&(this.padding.right=F.right))),this.showFrozenIcon=typeof H!="boolean"||H,typeof z=="number"&&z<=0&&(this.showFrozenIcon=!1),this.widthMode=tt??"standard",this.heightMode=st??"standard",this._widthAdaptiveMode=pt??"only-body",this._heightAdaptiveMode=at??"only-body",this.autoFillWidth=ot!=null&&ot,this.autoFillHeight=rt!=null&&rt,this.customRender=W,this.canvasWidth=J(nt)?nt:void 0,this.canvasHeight=J(X)?X:void 0;const U=this.internalProps;if(We.mode==="node"||t.canvas||nyt(U.element,this.padding),this.columnWidthComputeMode=(i=t.columnWidthComputeMode)!==null&&i!==void 0?i:"normal",U.frozenColCount=C,U.unfreezeAllOnExceedsMaxWidth=S==null||S,U.defaultRowHeight=w,U.defaultHeaderRowHeight=x??w,U.defaultColWidth=A,U.defaultHeaderColWidth=M??A,U.keyboardOptions=T,U.eventOptions=R,U.rowSeriesNumber=B,U.columnResizeMode=(r=P==null?void 0:P.columnResizeMode)!==null&&r!==void 0?r:E,U.rowResizeMode=(s=P==null?void 0:P.rowResizeMode)!==null&&s!==void 0?s:k,U.dragHeaderMode=(a=(o=O==null?void 0:O.dragHeaderMode)!==null&&o!==void 0?o:I)!==null&&a!==void 0?a:"none",U.renderChartAsync=N,wN(K),U.overscrollBehavior=ht??"auto",U.cellTextOverflows={},U._rowHeightsMap=new v$(this),U._rowRangeHeightsMap=new Map,U._colRangeWidthsMap=new Map,U._widthResizedColMap=new Set,U._heightResizedRowMap=new Set,this.colWidthsMap=new Kh,this.colContentWidthsMap=new Kh,this.colWidthsLimit={},U.stick.changedCells.clear(),U.theme=Sh.of((l=t.theme)!==null&&l!==void 0?l:Sh.DEFAULT),U.theme.isPivot=this.isPivotTable(),Cy(U.theme.functionalIconsStyle),this.scenegraph.updateStageBackground(),U.autoWrapText=t.autoWrapText,U.enableLineBreak=t.enableLineBreak,U.allowFrozenColCount=(h=t.allowFrozenColCount)!==null&&h!==void 0?h:0,U.limitMaxAutoWidth=(d=t.limitMaxAutoWidth)!==null&&d!==void 0?d:450,U.limitMinWidth=_t!=null?typeof _t=="number"?_t:_t?10:0:10,U.limitMinHeight=ct!=null?typeof ct=="number"?ct:ct?10:0:10,(u=U.legends)===null||u===void 0||u.forEach(ut=>{ut==null||ut.release()}),(c=U.title)===null||c===void 0||c.release(),U.title=null,(g=U.emptyTip)===null||g===void 0||g.release(),U.emptyTip=null,U.layoutMap.release(),dL(),this.scenegraph.clearCells(),this.scenegraph.updateComponent(),this.stateManager.updateOptionSetState(),this._updateSize(),this.eventManager.updateEventBinder(),t.legends){U.legends=[];const ut=Jt.getFunction("createLegend");if(Array.isArray(t.legends)){for(let lt=0;lt<t.legends.length;lt++)U.legends.push(ut(t.legends[lt],this));this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}else U.legends.push(ut(t.legends,this)),this.scenegraph.tableGroup.setAttributes({x:this.tableX,y:this.tableY})}if(U.tooltip=Object.assign({parentElement:this.getElement(),renderMode:"html",isShowOverflowTextTooltip:!1,confine:!0,position:Rs.bottom},t.tooltip),U.tooltip.renderMode==="html"&&!U.tooltipHandler){const ut=Jt.getComponent("tooltipHandler");U.tooltipHandler=new ut(this,U.tooltip.confine)}if(U.menu=Object.assign({renderMode:"html"},t.menu),Array.isArray((p=t.menu)===null||p===void 0?void 0:p.dropDownMenuHighlight)&&this.setDropDownMenuHighlight((f=t.menu)===null||f===void 0?void 0:f.dropDownMenuHighlight),(Array.isArray((m=t.menu)===null||m===void 0?void 0:m.defaultHeaderMenuItems)||typeof((v=t.menu)===null||v===void 0?void 0:v.defaultHeaderMenuItems)=="function")&&(this.globalDropDownMenu=t.menu.defaultHeaderMenuItems),U.menu.renderMode==="html"&&!U.menuHandler){const ut=Jt.getComponent("menuHandler");U.menuHandler=new ut(this)}this.clearCellStyleCache(),this.clearColWidthCache(),this.clearRowHeightCache(),U.customMergeCell=T$(t.customMergeCell),(_=this.customCellStylePlugin)===null||_===void 0||_.updateCustomCell((b=t.customCellStyle)!==null&&b!==void 0?b:[],(y=t.customCellStyleArrangement)!==null&&y!==void 0?y:[]),this._adjustCanvasSizeByOption()}renderWithRecreateCells(){this.internalProps.stick.changedCells.clear();const t={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(t.col,t.row),this.render()}getFrozenRowsHeight(){return this.getRowsHeight(0,this.frozenRowCount-1)}getFrozenColsWidth(){return this.getColsWidth(0,this.frozenColCount-1)}getBottomFrozenRowsHeight(){if(this.bottomFrozenRowCount>0){let t=0;for(let e=this.rowCount-this.bottomFrozenRowCount;e<=this.rowCount-1;e++)t+=this.getRowHeight(e);return t}return 0}getRightFrozenColsWidth(){if(this.rightFrozenColCount>0){let t=0;for(let e=this.colCount-this.rightFrozenColCount;e<=this.colCount-1;e++)t+=this.getColWidth(e);return t}return 0}getDrawRange(){const t=Math.min(this.tableNoFrameWidth,this.getAllColsWidth()),e=Math.min(this.tableNoFrameHeight,this.getAllRowsHeight());return new Tu(this.tableX,this.tableY,t,e)}_getMouseAbstractPoint(t){var e,i,r,s,o,a,l,h;let d;if(!t)return{inTable:!1,x:void 0,y:void 0};d=$1t(t)?t.changedTouches[0]:t;const u=d.clientX||d.pageX+window.scrollX,c=d.clientY||d.pageY+window.scrollY,g=this.internalProps.canvas.getBoundingClientRect();let p=!0;g.right<=u&&(p=!1),g.bottom<=c&&(p=!1);const f=g.width,m=f/((this.rotateDegree===90?this.canvas.offsetHeight:this.canvas.offsetWidth)||f),v=g.height,_=v/((this.rotateDegree===90?this.canvas.offsetWidth:this.canvas.offsetHeight)||v),b=this.pluginManager.getPluginByName("Rotate Table");if(b&&this.rotateDegree===90){const C={x:u/m-((i=(e=this.options.viewBox)===null||e===void 0?void 0:e.x1)!==null&&i!==void 0?i:0),y:c/_-((s=(r=this.options.viewBox)===null||r===void 0?void 0:r.y1)!==null&&s!==void 0?s:0),inTable:p};return b.matrix.transformPoint(C,C),C}const y={x:(u-g.left)/m-((a=(o=this.options.viewBox)===null||o===void 0?void 0:o.x1)!==null&&a!==void 0?a:0),y:(c-g.top)/_-((h=(l=this.options.viewBox)===null||l===void 0?void 0:l.y1)!==null&&h!==void 0?h:0),inTable:p};return this.internalProps.modifiedViewBoxTransform&&this.scenegraph.stage.window.getViewBoxTransform()&&this.scenegraph.stage.window.getViewBoxTransform().transformPoint(y,y),y}getTheme(){return this.internalProps.theme}getTargetColAt(t){return pD(t,this)}getTargetRowAt(t){const e=fD(t,this);return e&&(e.row=Math.min(e.row,this.rowCount-1)),e}getTargetColAtConsiderRightFrozen(t,e){return hZ(t,e,this)}getTargetRowAtConsiderBottomFrozen(t,e){return dZ(t,e,this)}clearSelected(){this.stateManager.updateSelectPos(-1,-1)}selectCell(t,e,i,r,s,o=!1){var a,l,h;const d=!!(!((a=this.stateManager.select.ranges)===null||a===void 0)&&a.length);this.stateManager.updateSelectPos(t,e,i,r,!1,(h=s??((l=this.options.select)===null||l===void 0?void 0:l.makeSelectCellVisible))===null||h===void 0||h,o),this.stateManager.endSelectCells(!0,d)}selectCells(t){const{scrollLeft:e,scrollTop:i}=this;t.forEach((r,s)=>{var o,a,l,h,d,u;r.start.col===r.end.col&&r.start.row===r.end.row?this.stateManager.updateSelectPos(r.start.col,r.start.row,!1,s>=1,!1,(a=(o=this.options.select)===null||o===void 0?void 0:o.makeSelectCellVisible)===null||a===void 0||a,!0):(this.stateManager.updateSelectPos(r.start.col,r.start.row,!1,s>=1,!1,(h=(l=this.options.select)===null||l===void 0?void 0:l.makeSelectCellVisible)===null||h===void 0||h,!0),this.stateManager.updateInteractionState(oe.grabing),this.stateManager.updateSelectPos(r.end.col,r.end.row,!1,s>=1,!1,(u=(d=this.options.select)===null||d===void 0?void 0:d.makeSelectCellVisible)===null||u===void 0||u,!0)),this.stateManager.endSelectCells(!1,!1),this.stateManager.updateInteractionState(oe.default)}),this.setScrollTop(i),this.setScrollLeft(e)}get recordsCount(){var t;return(t=this.records)===null||t===void 0?void 0:t.length}get allowFrozenColCount(){return this.internalProps.allowFrozenColCount}get rowHeaderLevelCount(){return this.internalProps.layoutMap.rowHeaderLevelCount}get columnHeaderLevelCount(){return this.internalProps.layoutMap.columnHeaderLevelCount}get records(){return this.internalProps.records}get dataSource(){return this.internalProps.dataSource}set dataSource(t){this.scenegraph.clearCells(),ryt(this,t),this.refreshRowColCount(),this.scenegraph.createSceneGraph(),this.render()}get autoWrapText(){return this.internalProps.autoWrapText}set autoWrapText(t){this.internalProps.autoWrapText=t,this.options.autoWrapText=t}get enableLineBreak(){return this.internalProps.enableLineBreak}set enableLineBreak(t){this.internalProps.enableLineBreak=t,this.options.enableLineBreak=t}updateAutoWrapText(t){this.internalProps.autoWrapText!==t&&(this.internalProps.autoWrapText=t,this.options.autoWrapText=t,this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.render())}get theme(){return this.internalProps.theme}set theme(t){this.internalProps.theme=Sh.of(t??Sh.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),this.options.theme=t,Cy(this.internalProps.theme.functionalIconsStyle)}updateTheme(t){const e={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.theme=Sh.of(t??Sh.DEFAULT),this.internalProps.theme.isPivot=this.isPivotTable(),Cy(this.internalProps.theme.functionalIconsStyle),this.options.theme=t,this.scenegraph.updateComponent(),this.scenegraph.updateStageBackground(),this.scenegraph.clearCells(),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(e.col,e.row),this.render()}getBodyField(t,e){return this.internalProps.layoutMap.getBody(t,e).field}getBodyColumnDefine(t,e){const i=this.internalProps.layoutMap.getBody(t,e);return i==null?void 0:i.define}getBodyColumnType(t,e){var i,r;const s=(r=(i=this.internalProps.layoutMap.getBody(t,e))===null||i===void 0?void 0:i.cellType)!==null&&r!==void 0?r:"text";return Mt("cellType",{cellType:s},t,e,this)}getCellType(t,e){let i;return this.isSeriesNumberInHeader(t,e)?this.internalProps.layoutMap.getSeriesNumberHeader(t,e).cellType:(i=this.isHeader(t,e)?this.internalProps.layoutMap.getHeader(t,e).headerType:this.internalProps.layoutMap.getBody(t,e).cellType,Mt("cellType",{cellType:i},t,e,this))}getHeaderField(t,e){return this.internalProps.layoutMap.getHeaderField(t,e)}getHeaderDefine(t,e){const i=this.internalProps.layoutMap.getHeader(t,e);return i==null?void 0:i.define}getCellLocation(t,e){return this.internalProps.layoutMap.getCellLocation(t,e)}getCellHeaderPaths(t,e){return this.internalProps.layoutMap.getCellHeaderPaths(t,e)}getHeadersDefine(t,e){const i=[];for(;;){const r=this.getHeaderDefine(t,e);if(!r||!r.field&&!r.columns)break;i.push(r),e++}return i}_getHeaderLayoutMap(t,e){return this.internalProps.layoutMap.getHeader(t,e)}_getBodyLayoutMap(t,e){return this.internalProps.layoutMap.getBody(t,e)}getContext(){return this.internalProps.context}getRecordByCell(t,e){if(!this.internalProps.layoutMap.isHeader(t,e))return this.getCellOriginRecord(t,e)}getRecordByRowCol(t,e){return this.getRecordByCell(t,e)}getRecordStartRowByRecordIndex(t){return this.internalProps.layoutMap.getRecordStartRowByRecordIndex(t)}_getHeaderCellBySortState(t){const{layoutMap:e}=this.internalProps,i=e.headerObjects.find(r=>r&&r.field===t.field);if(i)return e.getHeaderCellAdressById(i.id)}getCellRange(t,e){var i;if(this.internalProps.customMergeCell){const r=this.internalProps.customMergeCell(t,e,this);if(r&&r.range&&(L(r.text)||r.customLayout||r.customRender))return{start:{col:Math.max(r.range.start.col,0),row:Math.max(r.range.start.row,0)},end:{col:Math.min(r.range.end.col,this.colCount-1),row:Math.min(r.range.end.row,this.rowCount-1)},isCustom:!0}}return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.getCellRange(t,e)}hasCustomMerge(){return!!this.internalProps.customMergeCell}getCustomMerge(t,e){if(this.internalProps.customMergeCell){const i=this.internalProps.customMergeCell(t,e,this);if(i&&i.range&&(L(i.text)||i.customLayout||this.customRender)){if(i.style){const r=this.internalProps.bodyHelper.getStyleClass("text"),s=i.style,o=tD(s,this.theme.bodyStyle,{col:t,row:e,table:this,value:i.text,dataValue:this.getCellOriginValue(t,e),cellHeaderPaths:this.getCellHeaderPaths(t,e)},r,this.options.autoWrapText,this.theme);i.style=o}return i.range={start:{col:Math.max(i.range.start.col,0),row:Math.max(i.range.start.row,0)},end:{col:Math.min(i.range.end.col,this.colCount-1),row:Math.min(i.range.end.row,this.rowCount-1)},isCustom:!0},i}}}isCellRangeEqual(t,e,i,r){return this.internalProps.layoutMap.isCellRangeEqual(t,e,i,r)}_getLayoutCellId(t,e){return this.internalProps.layoutMap.getCellId(t,e)}getHeaderDescription(t,e){var i;const r=this._getHeaderLayoutMap(t,e),s=r==null?void 0:r.define,o=(i=s==null?void 0:s.description)!==null&&i!==void 0?i:r==null?void 0:r.description;return typeof o=="function"?o({col:t,row:e,value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e)}):o}setDropDownMenuHighlight(t){this.stateManager.setDropDownMenuHighlight(t)}_dropDownMenuIsHighlight(t,e,i){return this.stateManager.dropDownMenuIsHighlight(t,e,i)}isSeriesNumberInBody(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInBody(t,e)}isSeriesNumberInHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isSeriesNumberInHeader(t,e)}isHeader(t,e){return this.internalProps.layoutMap&&this.internalProps.layoutMap.isHeader(t,e)}isColumnHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isColumnHeader(t,e)}isRowHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRowHeader(t,e)}isCornerHeader(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isCornerHeader(t,e)}isFrozenColumn(t,e){return this.isLeftFrozenColumn(t,e)||this.isRightFrozenColumn(t,e)}isLeftFrozenColumn(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenColumn(t,e)}isRightFrozenColumn(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isRightFrozenColumn(t,e)}isFrozenRow(t,e){return this.isTopFrozenRow(t,e)||this.isBottomFrozenRow(t,e)}isTopFrozenRow(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isFrozenRow(t,e)}isBottomFrozenRow(t,e){var i;return(i=this.internalProps.layoutMap)===null||i===void 0?void 0:i.isBottomFrozenRow(t,e)}getCellInfo(t,e){if(t>=0&&e>=0){const i=this.isHeader(t,e)?this.getHeaderDefine(t,e):this.getBodyColumnDefine(t,e);return{col:t,row:e,field:this.getHeaderField(t,e),cellHeaderPaths:this.internalProps.layoutMap.getCellHeaderPaths(t,e),title:i==null?void 0:i.title,cellType:this.getCellType(t,e),originData:this.getCellOriginRecord(t,e),cellRange:this.getCellRangeRelativeRect({col:t,row:e}),value:this.getCellValue(t,e),dataValue:this.getCellOriginValue(t,e),cellLocation:this.getCellLocation(t,e),scaleRatio:this.canvas.getBoundingClientRect().width/this.canvas.offsetWidth}}}_hasField(t,e,i){var r;if(t===null||this.internalProps.layoutMap.isHeader(e,i))return!1;const s=this.getRecordShowIndexByCell(e,i);return(r=this.internalProps.dataSource)===null||r===void 0?void 0:r.hasField(s,t)}_getCellStyle(t,e){return z1t(t,e,this)}clearCellStyleCache(){this.headerStyleCache.clear(),this.bodyStyleCache.clear(),this.bodyMergeTitleCache.clear(),this.bodyBottomStyleCache.clear()}clearRowHeightCache(){this.internalProps._rowHeightsMap.clear(),this._clearRowRangeHeightsMap()}clearColWidthCache(){this.internalProps._colWidthsMap.clear(),this._clearColRangeWidthsMap()}_canResizeColumn(t,e){if(!(t>=0&&e>=0)||this.isCellRangeEqual(t,e,t+1,e)||this.internalProps.columnResizeMode==="none")return!1;if(this.internalProps.columnResizeMode==="header"){if(!this.isHeader(t,e))return!1}else if(this.internalProps.columnResizeMode==="body"&&this.isHeader(t,e))return!1;const i=this.colWidthsLimit[t];return!(i&&i.min&&i.max)||i.max!==i.min}_canResizeRow(t,e){if(!(t>=0&&e>=0)||this.isCellRangeEqual(t,e,t,e+1)||this.internalProps.rowResizeMode==="none")return!1;if(this.internalProps.rowResizeMode==="header"){if(!this.isHeader(t,e))return!1}else if(this.internalProps.rowResizeMode==="body"&&this.isHeader(t,e))return!1;return!0}_canDragHeaderPosition(t,e){var i;if(this.isHeader(t,e)&&(this.stateManager.isSelected(t,e)||((i=this.options.select)===null||i===void 0?void 0:i.headerSelectMode)==="body"&&FSt(t,e,[this.getCellRange(this.stateManager.select.cellPos.col,this.stateManager.select.cellPos.row)])||qh(this,t,e))){if(this.internalProps.frozenColDragHeaderMode==="disabled"&&this.isFrozenColumn(t))return!1;if(this.stateManager.isSelected(t,e)){const s=this.stateManager.select.ranges[0];if(this.isColumnHeader(t,e)){if(s.end.row!==this.rowCount-1)return!1}else if(!this.isRowHeader(t,e)||s.end.col!==this.colCount-1)return!1}const r=this.getHeaderDefine(t,e);if(!r)return!1;if(r.dragHeader===void 0){if(this.internalProps.dragHeaderMode==="all")return!0;if(this.internalProps.dragHeaderMode==="column"){if(this.isColumnHeader(t,e))return!0}else if(this.internalProps.dragHeaderMode==="row"&&this.isRowHeader(t,e))return!0;return!1}return r.dragHeader}return!1}getCellIcons(t,e){var i,r,s;let o;if(this.isHeader(t,e))o=this.internalProps.headerHelper.getIcons(t,e);else if(this.internalProps.layoutMap.isSeriesNumber(t,e)){(!this.options.groupBy||!(!((i=this.getCellRawRecord(t,e))===null||i===void 0)&&i.vtableMerge))&&!((s=(r=this.internalProps.layoutMap.getSeriesNumberBody(t,e))===null||r===void 0?void 0:r.define)===null||s===void 0)&&s.dragOrder&&(o=this.internalProps.rowSeriesNumberHelper.getIcons(t,e));const a=this.getCellValue(t,e),l=this.getCellOriginValue(t,e),h=this.internalProps.context,d=this.internalProps.bodyHelper.getIcons(t,e,a,l,h);(o==null?void 0:o.length)>0?o=o.concat(d):(d==null?void 0:d.length)>0&&(o=d)}else{const a=this.getCellValue(t,e),l=this.getCellOriginValue(t,e),h=this.internalProps.context;o=this.internalProps.bodyHelper.getIcons(t,e,a,l,h)}return o}showDropDownMenu(t,e,i){let r="dropdown-menu";i&&(r=Array.isArray(i.content)?"dropdown-menu":"container"),this.internalProps.menu.renderMode==="html"&&(this.stateManager.menu.isShow=!0,this.internalProps.menuHandler._bindToCell(t,e,r,i))}showTooltip(t,e,i){this.internalProps.tooltip.renderMode==="html"&&this.internalProps.tooltipHandler._bindToCell(t,e,i)}getCellStyle(t,e){const i=this._getCellStyle(t,e),r=Vd(i,this,t,e,Mt).theme,{autoWrapText:s,lineClamp:o,textOverflow:a}=i;return{textAlign:r.text.textAlign,textBaseline:r.text.textBaseline,bgColor:Re(r.group.fill)?Mt("bgColor",i,t,e,this):r.group.fill,color:Re(r.text.fill)?Mt("color",i,t,e,this):r.text.fill,strokeColor:Re(r.text.stroke)?Mt("strokeColor",i,t,e,this):r.text.stroke,fontFamily:r.text.fontFamily,fontSize:r.text.fontSize,fontWeight:r.text.fontWeight,fontVariant:r.text.fontVariant,fontStyle:r.text.fontStyle,lineHeight:r.text.lineHeight,autoWrapText:s!=null&&s,lineClamp:o??"auto",textOverflow:a,borderColor:Re(r.group.stroke)?Mt("borderColor",i,t,e,this):r.group.stroke,borderLineWidth:r.group.lineWidth,borderLineDash:r.group.lineDash,underline:!!r.text.underline,underlineDash:r.text.underlineDash,underlineOffset:r.text.underlineOffset,lineThrough:!!r.text.lineThrough,padding:r._vtable.padding,underlineWidth:r.text.underline,lineThroughLineWidth:r.text.lineThrough,_strokeArrayWidth:r.group.strokeArrayWidth,_strokeArrayColor:r.group.strokeArrayColor,_linkColor:Mt("linkColor",i,t,e,this)}}getAllBodyCells(t,e){const i=this.rowHeaderLevelCount,r=this.columnHeaderLevelCount,s=this.colCount-1,o=this.rowCount-1;return Array(Math.min(e??2e3,o-r+1,this.rowCount)).fill(0).map((a,l)=>Array(Math.min(t??2e3,s-i+1,this.colCount)).fill(0).map((h,d)=>this.getCellInfo(d+i,l+r)))}getAllCells(t,e){const s=this.colCount-1,o=this.rowCount-1;return Array(Math.min(e??2e3,o-0+1,this.rowCount)).fill(0).map((a,l)=>Array(Math.min(t??2e3,s-0+1,this.colCount)).fill(0).map((h,d)=>this.getCellInfo(d+0,l+0)))}getAllColumnHeaderCells(){const t=this.rowHeaderLevelCount,e=0,i=this.colCount-1,r=this.columnHeaderLevelCount-1;return Array(r-e+1).fill(0).map((s,o)=>Array(i-t+1).fill(0).map((a,l)=>this.getCellInfo(l+t,o+e)))}getAllRowHeaderCells(){const e=this.columnHeaderLevelCount,i=this.rowHeaderLevelCount-1,r=this.rowCount-1;return Array(r-e+1).fill(0).map((s,o)=>Array(i-0+1).fill(0).map((a,l)=>this.getCellInfo(l+0,o+e)))}getCopyValue(){var t,e,i;if(((e=(t=this.stateManager.select)===null||t===void 0?void 0:t.ranges)===null||e===void 0?void 0:e.length)>0){const r=this.stateManager.select.ranges;let s=Math.min(r[0].start.col,r[0].end.col),o=Math.max(r[0].start.col,r[0].end.col),a=Math.min(r[0].start.row,r[0].end.row),l=Math.max(r[0].start.row,r[0].end.row);r.forEach(p=>{s=Math.min(s,p.start.col,p.end.col),o=Math.max(o,p.start.col,p.end.col),a=Math.min(a,p.start.row,p.end.row),l=Math.max(l,p.start.row,p.end.row)});const h=p=>{let f=!1;return r.forEach(m=>{const v=Math.min(m.start.row,m.end.row),_=Math.max(m.start.row,m.end.row);v<=p&&_>=p&&(f=!0)}),f},d=p=>{let f=!1;return r.forEach(m=>{const v=Math.min(m.start.col,m.end.col),_=Math.max(m.start.col,m.end.col);v<=p&&_>=p&&(f=!0)}),f},u=(p,f)=>{let m;return r.forEach(v=>{const _=Math.min(v.start.row,v.end.row),b=Math.max(v.start.row,v.end.row),y=Math.min(v.start.col,v.end.col),C=Math.max(v.start.col,v.end.col);y<=p&&C>=p&&_<=f&&b>=f&&(m=v)}),m},c=(p,f,m)=>{const v=this.getCellRange(p,f);let _=v.start.col,b=v.start.row;if(m){const y=Math.min(m.start.col,m.end.col),C=Math.min(m.start.row,m.end.row);_=Math.max(y,v.start.col),b=Math.max(C,v.start.row)}return _!==p||b!==f?"":this.getCellValue(p,f)};let g="";for(let p=a;p<=l;p++)if(h(p)){for(let f=s;f<=o;f++)if(d(f)){const m=u(f,p);if(m){const v=c(f,p,m);if(!(typeof Promise<"u"&&v instanceof Promise)){const _=L(v)?`${v}`:"";/^\[object .*\]$/.exec(_)||(g+=_)}(f<m.end.col||f<o)&&(g+="	")}else g+="	"}p<l&&(g+=`\r
`)}return!((i=this.options)===null||i===void 0)&&i.formatCopyValue&&(g=this.options.formatCopyValue(g)),g}return""}getSelectedCellInfos(){var t;if(!(!((t=this.stateManager.select)===null||t===void 0)&&t.ranges))return null;const e=this.stateManager.select.ranges;if(!e.length)return[];let i=Math.min(e[0].start.col,e[0].end.col),r=Math.max(e[0].start.col,e[0].end.col),s=Math.min(e[0].start.row,e[0].end.row),o=Math.max(e[0].start.row,e[0].end.row);e.forEach(u=>{i=Math.min(i,u.start.col,u.end.col),r=Math.max(r,u.start.col,u.end.col),s=Math.min(s,u.start.row,u.end.row),o=Math.max(o,u.start.row,u.end.row)});const a=u=>{let c=!1;return e.forEach(g=>{const p=Math.min(g.start.row,g.end.row),f=Math.max(g.start.row,g.end.row);p<=u&&f>=u&&(c=!0)}),c},l=u=>{let c=!1;return e.forEach(g=>{const p=Math.min(g.start.col,g.end.col),f=Math.max(g.start.col,g.end.col);p<=u&&f>=u&&(c=!0)}),c},h=(u,c)=>{let g;return e.forEach(p=>{const f=Math.min(p.start.row,p.end.row),m=Math.max(p.start.row,p.end.row),v=Math.min(p.start.col,p.end.col),_=Math.max(p.start.col,p.end.col);v<=u&&_>=u&&f<=c&&m>=c&&(g=p)}),g},d=[];for(let u=s;u<=o;u++)if(a(u)){const c=[];for(let g=i;g<=r;g++)if(l(g)&&h(g,u)){const p=this.getCellInfo(g,u);c.push(p)}d.push(c)}return d}getSelectedCellRanges(){const t=this.stateManager.select.ranges;return t.length?Pn(t):[]}measureText(t,e){return Oq.measureText(t,e)}measureTextBounds(t){return Dq(t)}getCustomRender(t,e){let i;if(this.getCellLocation(t,e)!=="body"){const r=this.getHeaderDefine(t,e);i=r==null?void 0:r.headerCustomRender}else{const r=this.getBodyColumnDefine(t,e);i=(r==null?void 0:r.customRender)||this.customRender}return i}getCustomLayout(t,e){let i;if(this.getCellLocation(t,e)!=="body"){const r=this.getHeaderDefine(t,e);i=r==null?void 0:r.headerCustomLayout}else{const r=this.getBodyColumnDefine(t,e);i=r==null?void 0:r.customLayout}return i}hasAutoImageColumn(){return this._hasAutoImageColumn===void 0&&(this._hasAutoImageColumn=x1t(this)),this._hasAutoImageColumn}_getActiveChartInstance(){var t,e,i,r,s,o;const a=this.scenegraph.getCell((e=(t=this.stateManager.hover)===null||t===void 0?void 0:t.cellPos)===null||e===void 0?void 0:e.col,(r=(i=this.stateManager.hover)===null||i===void 0?void 0:i.cellPos)===null||r===void 0?void 0:r.row);return((o=(s=a==null?void 0:a.getChildren())===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.type)==="chart"?a.getChildren()[0].activeChartInstance:null}cellIsInVisualView(t,e){var i,r,s,o;const a=this.getDrawRange(),l=this.getCellRelativeRect(t,e);if(t<this.frozenColCount&&e<this.frozenRowCount)return!0;let h,d,u,c;return this.frozenRowCount>=1&&(h=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.colCount-1,row:this.frozenRowCount-1}})),this.frozenColCount>=1&&(d=this.getCellRangeRelativeRect({start:{col:0,row:0},end:{col:this.frozenColCount-1,row:this.rowCount-1}})),this.bottomFrozenRowCount>=1&&(u=this.getCellRangeRelativeRect({start:{col:0,row:this.rowCount-this.bottomFrozenRowCount},end:{col:this.colCount-1,row:this.rowCount-1}})),this.rightFrozenColCount>=1&&(c=this.getCellRangeRelativeRect({start:{col:this.colCount-this.rightFrozenColCount,row:0},end:{col:this.colCount-1,row:this.rowCount-1}})),!!(l.top>=a.top&&l.bottom<=a.bottom&&l.left>=a.left&&l.right<=a.right&&(this.isFrozenCell(t,e)||l.top>=((i=h==null?void 0:h.bottom)!==null&&i!==void 0?i:l.top)&&l.left>=((r=d==null?void 0:d.right)!==null&&r!==void 0?r:l.left)&&l.bottom<=((s=u==null?void 0:u.top)!==null&&s!==void 0?s:l.bottom)&&l.right<=((o=c==null?void 0:c.left)!==null&&o!==void 0?o:l.right)))}getCustomMergeValue(t,e){if(this.internalProps.customMergeCell){const i=this.getCustomMerge(t,e);if(i){const{text:r}=i;return r}}}exportImg(){return this.scenegraph.stage.toCanvas().toDataURL()}exportCellImg(t,e,i){var r,s,o,a;const l=this.cellIsInVisualView(t,e),{scrollTop:h,scrollLeft:d}=this;l||this.scrollToCell({col:t,row:e});const u=this.getCellRelativeRect(t,e);((s=(r=this.stateManager.select)===null||r===void 0?void 0:r.ranges)===null||s===void 0?void 0:s.length)>0&&zN(this.scenegraph);const{col:c,row:g}=this.stateManager.hover.cellPos;let p,f;if(this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.tableGroup.border.setAttribute("visible",!1),i==null?void 0:i.disableBackground){const _=this.scenegraph.getCell(t,e);p=_.attribute.fill,_.setAttribute("fill","transparent")}if(i!=null&&i.disableBorder){const _=this.scenegraph.getCell(t,e);f=_.attribute.stroke,_.setAttribute("stroke",!1)}this.scenegraph.renderSceneGraph();let m=0;this.theme.cellBorderClipDirection==="bottom-right"&&(m=1);const v=this.scenegraph.stage.toCanvas(!1,new ie().set(u.left+this.tableX+1,u.top+this.tableY+1,u.right+this.tableX-m,u.bottom+this.tableY-m));return l||(this.setScrollTop(h),this.setScrollLeft(d)),this.scenegraph.tableGroup.border.setAttribute("visible",!0),p&&this.scenegraph.getCell(t,e).setAttribute("fill",p),f&&this.scenegraph.getCell(t,e).setAttribute("stroke",f),((a=(o=this.stateManager.select)===null||o===void 0?void 0:o.ranges)===null||a===void 0?void 0:a.length)>0&&WN(this.scenegraph),this.stateManager.updateHoverPos(c,g),this.scenegraph.updateNextFrame(),v.toDataURL()}exportCellRangeImg(t){var e,i,r,s;const{scrollTop:o,scrollLeft:a}=this,l=Math.min(t.start.col,t.end.col),h=Math.min(t.start.row,t.end.row),d=Math.max(t.start.col,t.end.col),u=Math.max(t.start.row,t.end.row),c=this.cellIsInVisualView(l,h),g=this.cellIsInVisualView(d,u);c&&g||this.scrollToCell({col:l,row:h});const p=this.getCellRangeRelativeRect({start:{col:l,row:h},end:{col:d,row:u}});((i=(e=this.stateManager.select)===null||e===void 0?void 0:e.ranges)===null||i===void 0?void 0:i.length)>0&&zN(this.scenegraph);const{col:f,row:m}=this.stateManager.hover.cellPos;this.stateManager.updateHoverPos(-1,-1),this.scenegraph.component.hideVerticalScrollBar(),this.scenegraph.component.hideHorizontalScrollBar(),this.scenegraph.renderSceneGraph();const v=this.scenegraph.stage.toCanvas(!1,new ie().set(p.left+this.tableX+1,p.top+this.tableY+1,p.right+this.tableX,p.bottom+this.tableY)).toDataURL();return c&&g||(this.setScrollTop(o),this.setScrollLeft(a)),((s=(r=this.stateManager.select)===null||r===void 0?void 0:r.ranges)===null||s===void 0?void 0:s.length)>0&&WN(this.scenegraph),this.stateManager.updateHoverPos(f,m),v}exportCanvas(){return this.scenegraph.stage.toCanvas()}getImageBuffer(t="image/png"){if(this.options.mode!=="node")return;this.render();const e=this.scenegraph.stage;if(e){const i=this.tableX+this.getAllColsWidth(),r=this.tableY+this.getAllRowsHeight();return i>=this.canvasWidth&&r>=this.canvasHeight?(e.render(),e.window.getImageBuffer(t)):this.scenegraph.stage.toCanvas(!1,new ie().set(0,0,Math.min(this.canvasWidth,i),Math.min(this.canvasHeight,r))).toBuffer(t)}return null}getBodyIndexByTableIndex(t,e){return{col:t-this.rowHeaderLevelCount-this.leftRowSeriesNumberCount,row:e-this.columnHeaderLevelCount}}getTableIndexByBodyIndex(t,e){return{col:t+this.rowHeaderLevelCount+this.leftRowSeriesNumberCount,row:e+this.columnHeaderLevelCount}}onVChartEvent(t,e,i){this._chartEventMap[t]||(this._chartEventMap[t]=[]),typeof e=="function"?this._chartEventMap[t].push({callback:e}):this._chartEventMap[t].push({callback:i,query:e})}offVChartEvent(t,e){this._chartEventMap[t]&&(this._chartEventMap[t]=e?this._chartEventMap[t].filter(i=>i.callback!==e):[])}_bindChartEvent(t){if(t)for(const e in this._chartEventMap)(this._chartEventMap[e]||[]).forEach(i=>{i.query?t.on(e,i.query,i.callback):t.on(e,i.callback)})}changeRecordOrder(t,e){}hasCustomCellStyle(t){var e;return(e=this.customCellStylePlugin)===null||e===void 0?void 0:e.hasCustomCellStyle(t)}registerCustomCellStyle(t,e){var i;(i=this.customCellStylePlugin)===null||i===void 0||i.registerCustomCellStyle(t,e)}arrangeCustomCellStyle(t,e,i){var r;(r=this.customCellStylePlugin)===null||r===void 0||r.arrangeCustomCellStyle(t,e,i)}isSeriesNumber(t,e){return this.internalProps.layoutMap.isSeriesNumber(t,e)}isHasSeriesNumber(){var t;return((t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.leftRowSeriesNumberColumnCount)>0}get leftRowSeriesNumberCount(){var t,e;return(e=(t=this.internalProps.layoutMap)===null||t===void 0?void 0:t.leftRowSeriesNumberColumnCount)!==null&&e!==void 0?e:0}setMinMaxLimitWidth(t=!1){var e,i;const r=this.internalProps;for(let s=0;s<r.layoutMap.columnWidths.length;s++){if(this.internalProps._widthResizedColMap.has(s))continue;const{width:o,minWidth:a,maxWidth:l}=(i=(e=r.layoutMap.columnWidths)===null||e===void 0?void 0:e[s])!==null&&i!==void 0?i:{};t&&o&&(typeof o=="string"&&o!=="auto"||typeof o=="number"&&o>0)&&this._setColWidth(s,o),a&&(typeof a=="number"&&a>0||typeof a=="string")&&this.setMinColWidth(s,a),l&&(typeof l=="number"&&l>0||typeof l=="string")&&this.setMaxColWidth(s,l)}}setSortedIndexMap(t,e){var i;(i=this.dataSource)===null||i===void 0||i.setSortedIndexMap(t,e)}checkReactCustomLayout(){this.reactCustomLayout||(this.reactCustomLayout=new uyt(this))}get bodyDomContainer(){return this.internalProps.bodyDomContainer}get headerDomContainer(){return this.internalProps.headerDomContainer}get frozenBodyDomContainer(){return this.internalProps.frozenBodyDomContainer}get frozenHeaderDomContainer(){return this.internalProps.frozenHeaderDomContainer}get rightFrozenBodyDomContainer(){return this.internalProps.rightFrozenBodyDomContainer}get rightFrozenHeaderDomContainer(){return this.internalProps.rightFrozenHeaderDomContainer}get frozenBottomDomContainer(){return this.internalProps.frozenBottomDomContainer}get bottomDomContainer(){return this.internalProps.bottomDomContainer}get rightFrozenBottomDomContainer(){return this.internalProps.rightFrozenBottomDomContainer}showMoverLine(t,e){this.scenegraph.component.showMoveCol(t,e,0),this.scenegraph.renderSceneGraph()}hideMoverLine(t,e){this.scenegraph.component.hideMoveCol(),this.scenegraph.renderSceneGraph()}disableScroll(){this.eventManager.disableScroll()}enableScroll(){this.eventManager.enableScroll()}getGroupTitleLevel(t,e){}scrollToRow(t,e){e?this.animationManager.scrollTo({row:t},e):this.scrollToCell({row:t})}scrollToCol(t,e){e?this.animationManager.scrollTo({col:t},e):this.scrollToCell({col:t})}scrollToCell(t,e){if(e)return void this.animationManager.scrollTo(t,e);const i=this.getDrawRange();if(L(t.col)&&t.col>=this.frozenColCount){const r=this.getFrozenColsWidth(),s=this.getColsWidth(0,t.col-1);this.scrollLeft=Math.min(s-r,this.getAllColsWidth()-i.width)}if(L(t.row)&&t.row>=this.frozenRowCount){const r=this.getFrozenRowsHeight(),s=this.getRowsHeight(0,t.row-1);this.scrollTop=Math.min(s-r,this.getAllRowsHeight()-i.height)}this.render()}checkHasColumnAutoWidth(){return dyt(this)}}const U1t={},Y1t={};function X1t(){return rb(Y1t,U1t)}const k$={};function K1t(n){if(k$[n])return k$[n]}const ob=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,q1t=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||ob(n,"Boolean"),Z1t=n=>n!=null,J1t=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||ob(n,"String")},Q1t=n=>Array.isArray?Array.isArray(n):ob(n,"Array"),twt=n=>ob(n,"Date"),ewt=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||ob(n,"Number")};function iwt(n){try{return n instanceof Element}catch{const e=["children","innerHTML","classList","setAttribute","tagName","getBoundingClientRect"],i=Object.keys(n);return e.every(r=>i.includes(r))}}const Wf=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,nwt=(n,t=!1)=>t?typeof n=="boolean":n===!0||n===!1||Wf(n,"Boolean"),R$=n=>n==null,mL=n=>n!=null,rwt=n=>typeof n=="object"&&n!==null,swt=function(n){if(!rwt(n)||!Wf(n,"Object"))return!1;if(Object.getPrototypeOf(n)===null)return!0;let t=n;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(n)===t},owt=(n,t=!1)=>{const e=typeof n;return t?e==="string":e==="string"||Wf(n,"String")},Jx=n=>Array.isArray?Array.isArray(n):Wf(n,"Array"),awt=function(n){return n!==null&&typeof n!="function"&&Number.isFinite(n.length)},lwt=n=>Wf(n,"Date"),gZ=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||Wf(n,"Number")};function pZ(n,t,e){let i;if(!mL(n)||typeof n!="object"||t)return n;const r=Jx(n),s=n.length;i=r?new Array(s):typeof n=="object"?{}:nwt(n)||gZ(n)||owt(n)?n:lwt(n)?new Date(+n):void 0;const o=r?void 0:Object.keys(Object(n));let a=-1;if(i)for(;++a<(o||n).length;){const l=o?o[a]:a,h=n[l];i[l]=pZ(h,t)}return i}function fZ(n,t,e=!1,i=!1){if(t){if(n===t)return;if(mL(t)&&typeof t=="object"){const r=Object(t),s=[];for(const l in r)s.push(l);let{length:o}=s,a=-1;for(;o--;){const l=s[++a];!mL(r[l])||typeof r[l]!="object"||i&&Jx(n[l])?mZ(n,l,r[l]):hwt(n,t,l,e,i)}}}}function hwt(n,t,e,i=!1,r=!1){const s=n[e],o=t[e];let a=t[e],l=!0;if(Jx(o)){if(i)a=[];else if(Jx(s))a=s;else if(awt(s)){a=new Array(s.length);let h=-1;const d=s.length;for(;++h<d;)a[h]=s[h]}}else swt(o)?(a=s??{},typeof s!="function"&&typeof s=="object"||(a={})):l=!1;l&&fZ(a,o,i,r),mZ(n,e,a)}function mZ(n,t,e){(e!==void 0&&!dwt(n[t],e)||e===void 0&&!(t in n))&&(n[t]=e)}function dwt(n,t){return n===t||Number.isNaN(n)&&Number.isNaN(t)}function uwt(n,...t){let e=-1;const i=t.length;for(;++e<i;)fZ(n,t[e],!0);return n}const cwt=typeof console<"u";function My(n,t,e){const i=[t].concat([].slice.call(e));cwt&&console[n].apply(console,i)}var Ho;(function(n){n[n.None=0]="None",n[n.Error=1]="Error",n[n.Warn=2]="Warn",n[n.Info=3]="Info",n[n.Debug=4]="Debug"})(Ho||(Ho={}));class Pr{static getInstance(t,e){return Pr._instance&&gZ(t)?Pr._instance.level(t):Pr._instance||(Pr._instance=new Pr(t,e)),Pr._instance}static setInstance(t){return Pr._instance=t}static setInstanceLevel(t){Pr._instance?Pr._instance.level(t):Pr._instance=new Pr(t)}static clearInstance(){Pr._instance=null}constructor(t=Ho.None,e){this._onErrorHandler=[],this._level=t,this._method=e}addErrorHandler(t){this._onErrorHandler.find(e=>e===t)||this._onErrorHandler.push(t)}removeErrorHandler(t){const e=this._onErrorHandler.findIndex(i=>i===t);e<0||this._onErrorHandler.splice(e,1)}callErrorHandler(...t){this._onErrorHandler.forEach(e=>e(...t))}canLogInfo(){return this._level>=Ho.Info}canLogDebug(){return this._level>=Ho.Debug}canLogError(){return this._level>=Ho.Error}canLogWarn(){return this._level>=Ho.Warn}level(t){return arguments.length?(this._level=+t,this):this._level}error(...t){var e;return this._level>=Ho.Error&&(this._onErrorHandler.length?this.callErrorHandler(...t):My((e=this._method)!==null&&e!==void 0?e:"error","ERROR",t)),this}warn(...t){return this._level>=Ho.Warn&&My(this._method||"warn","WARN",t),this}info(...t){return this._level>=Ho.Info&&My(this._method||"log","INFO",t),this}debug(...t){return this._level>=Ho.Debug&&My(this._method||"log","DEBUG",t),this}}Pr._instance=null;function TM(){return new Qx}function Qx(){this.reset()}Qx.prototype={constructor:Qx,reset:function(){this.s=this.t=0},add:function(n){B$(Ty,n,this.t),B$(this,Ty.s,this.s),this.s?this.t+=Ty.t:this.s=Ty.t},valueOf:function(){return this.s}};var Ty=new Qx;function B$(n,t,e){var i=n.s=t+e,r=i-t,s=i-r;n.t=t-s+(e-r)}var Le=1e-6,gwt=1e-12,Ue=Math.PI,dn=Ue/2,P$=Ue/4,Ns=Ue*2,fr=180/Ue,Zi=Ue/180,Ai=Math.abs,jf=Math.atan,th=Math.atan2,$e=Math.cos,vZ=Math.exp,t1=Math.log,QR=Math.pow,ke=Math.sin,mo=Math.sign||function(n){return n>0?1:n<0?-1:0},ds=Math.sqrt,mD=Math.tan;function _Z(n){return n>1?0:n<-1?Ue:Math.acos(n)}function Ao(n){return n>1?dn:n<-1?-dn:Math.asin(n)}function vo(){}function e1(n,t){n&&L$.hasOwnProperty(n.type)&&L$[n.type](n,t)}var E$={Feature:function(n,t){e1(n.geometry,t)},FeatureCollection:function(n,t){for(var e=n.features,i=-1,r=e.length;++i<r;)e1(e[i].geometry,t)}},L$={Sphere:function(n,t){t.sphere()},Point:function(n,t){n=n.coordinates,t.point(n[0],n[1],n[2])},MultiPoint:function(n,t){for(var e=n.coordinates,i=-1,r=e.length;++i<r;)n=e[i],t.point(n[0],n[1],n[2])},LineString:function(n,t){vL(n.coordinates,t,0)},MultiLineString:function(n,t){for(var e=n.coordinates,i=-1,r=e.length;++i<r;)vL(e[i],t,0)},Polygon:function(n,t){I$(n.coordinates,t)},MultiPolygon:function(n,t){for(var e=n.coordinates,i=-1,r=e.length;++i<r;)I$(e[i],t)},GeometryCollection:function(n,t){for(var e=n.geometries,i=-1,r=e.length;++i<r;)e1(e[i],t)}};function vL(n,t,e){var i=-1,r=n.length-e,s;for(t.lineStart();++i<r;)s=n[i],t.point(s[0],s[1],s[2]);t.lineEnd()}function I$(n,t){var e=-1,i=n.length;for(t.polygonStart();++e<i;)vL(n[e],t,1);t.polygonEnd()}function Ag(n,t){n&&E$.hasOwnProperty(n.type)?E$[n.type](n,t):e1(n,t)}function _L(n){return[th(n[1],n[0]),Ao(n[2])]}function of(n){var t=n[0],e=n[1],i=$e(e);return[i*$e(t),i*ke(t),ke(e)]}function ky(n,t){return n[0]*t[0]+n[1]*t[1]+n[2]*t[2]}function i1(n,t){return[n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]]}function tB(n,t){n[0]+=t[0],n[1]+=t[1],n[2]+=t[2]}function Ry(n,t){return[n[0]*t,n[1]*t,n[2]*t]}function bL(n){var t=ds(n[0]*n[0]+n[1]*n[1]+n[2]*n[2]);n[0]/=t,n[1]/=t,n[2]/=t}function yL(n,t){function e(i,r){return i=n(i,r),t(i[0],i[1])}return n.invert&&t.invert&&(e.invert=function(i,r){return i=t.invert(i,r),i&&n.invert(i[0],i[1])}),e}function CL(n,t){return[Ai(n)>Ue?n+Math.round(-n/Ns)*Ns:n,t]}CL.invert=CL;function bZ(n,t,e){return(n%=Ns)?t||e?yL(D$(n),F$(t,e)):D$(n):t||e?F$(t,e):CL}function O$(n){return function(t,e){return t+=n,[t>Ue?t-Ns:t<-Ue?t+Ns:t,e]}}function D$(n){var t=O$(n);return t.invert=O$(-n),t}function F$(n,t){var e=$e(n),i=ke(n),r=$e(t),s=ke(t);function o(a,l){var h=$e(l),d=$e(a)*h,u=ke(a)*h,c=ke(l),g=c*e+d*i;return[th(u*r-g*s,d*e-c*i),Ao(g*r+u*s)]}return o.invert=function(a,l){var h=$e(l),d=$e(a)*h,u=ke(a)*h,c=ke(l),g=c*r-u*s;return[th(u*r+c*s,d*e+g*i),Ao(g*e-d*i)]},o}function pwt(n){n=bZ(n[0]*Zi,n[1]*Zi,n.length>2?n[2]*Zi:0);function t(e){return e=n(e[0]*Zi,e[1]*Zi),e[0]*=fr,e[1]*=fr,e}return t.invert=function(e){return e=n.invert(e[0]*Zi,e[1]*Zi),e[0]*=fr,e[1]*=fr,e},t}function fwt(n,t,e,i,r,s){if(e){var o=$e(t),a=ke(t),l=i*e;r==null?(r=t+i*Ns,s=t-l/2):(r=H$(o,r),s=H$(o,s),(i>0?r<s:r>s)&&(r+=i*Ns));for(var h,d=r;i>0?d>s:d<s;d-=l)h=_L([o,-a*$e(d),-a*ke(d)]),n.point(h[0],h[1])}}function H$(n,t){t=of(t),t[0]-=n,bL(t);var e=_Z(-t[1]);return((-t[2]<0?-e:e)+Ns-Le)%Ns}function yZ(){var n=[],t;return{point:function(e,i,r){t.push([e,i,r])},lineStart:function(){n.push(t=[])},lineEnd:vo,rejoin:function(){n.length>1&&n.push(n.pop().concat(n.shift()))},result:function(){var e=n;return n=[],t=null,e}}}function TC(n,t){return Ai(n[0]-t[0])<Le&&Ai(n[1]-t[1])<Le}function By(n,t,e,i){this.x=n,this.z=t,this.o=e,this.e=i,this.v=!1,this.n=this.p=null}function CZ(n,t,e,i,r){var s=[],o=[],a,l;if(n.forEach(function(p){if(!((f=p.length-1)<=0)){var f,m=p[0],v=p[f],_;if(TC(m,v)){if(!m[2]&&!v[2]){for(r.lineStart(),a=0;a<f;++a)r.point((m=p[a])[0],m[1]);r.lineEnd();return}v[0]+=2*Le}s.push(_=new By(m,p,null,!0)),o.push(_.o=new By(m,null,_,!1)),s.push(_=new By(v,p,null,!1)),o.push(_.o=new By(v,null,_,!0))}}),!!s.length){for(o.sort(t),z$(s),z$(o),a=0,l=o.length;a<l;++a)o[a].e=e=!e;for(var h=s[0],d,u;;){for(var c=h,g=!0;c.v;)if((c=c.n)===h)return;d=c.z,r.lineStart();do{if(c.v=c.o.v=!0,c.e){if(g)for(a=0,l=d.length;a<l;++a)r.point((u=d[a])[0],u[1]);else i(c.x,c.n.x,1,r);c=c.n}else{if(g)for(d=c.p.z,a=d.length-1;a>=0;--a)r.point((u=d[a])[0],u[1]);else i(c.x,c.p.x,-1,r);c=c.p}c=c.o,d=c.z,g=!g}while(!c.v);r.lineEnd()}}}function z$(n){if(t=n.length){for(var t,e=0,i=n[0],r;++e<t;)i.n=r=n[e],r.p=i,i=r;i.n=r=n[0],r.p=i}}var eB=TM();function iB(n){return Ai(n[0])<=Ue?n[0]:mo(n[0])*((Ai(n[0])+Ue)%Ns-Ue)}function mwt(n,t){var e=iB(t),i=t[1],r=ke(i),s=[ke(e),-$e(e),0],o=0,a=0;eB.reset(),r===1?i=dn+Le:r===-1&&(i=-dn-Le);for(var l=0,h=n.length;l<h;++l)if(u=(d=n[l]).length)for(var d,u,c=d[u-1],g=iB(c),p=c[1]/2+P$,f=ke(p),m=$e(p),v=0;v<u;++v,g=b,f=C,m=S,c=_){var _=d[v],b=iB(_),y=_[1]/2+P$,C=ke(y),S=$e(y),w=b-g,x=w>=0?1:-1,A=x*w,M=A>Ue,T=f*C;if(eB.add(th(T*x*ke(A),m*S+T*$e(A))),o+=M?w+x*Ns:w,M^g>=e^b>=e){var R=i1(of(c),of(_));bL(R);var B=i1(s,R);bL(B);var E=(M^w>=0?-1:1)*Ao(B[2]);(i>E||i===E&&(R[0]||R[1]))&&(a+=M^w>=0?1:-1)}}return(o<-1e-6||o<Le&&eB<-1e-6)^a&1}function SZ(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function vwt(n){return n.length===1&&(n=_wt(n)),{left:function(t,e,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var s=i+r>>>1;n(t[s],e)<0?i=s+1:r=s}return i},right:function(t,e,i,r){for(i==null&&(i=0),r==null&&(r=t.length);i<r;){var s=i+r>>>1;n(t[s],e)>0?r=s:i=s+1}return i}}}function _wt(n){return function(t,e){return SZ(n(t),e)}}vwt(SZ);function xZ(n){for(var t=n.length,e,i=-1,r=0,s,o;++i<t;)r+=n[i].length;for(s=new Array(r);--t>=0;)for(o=n[t],e=o.length;--e>=0;)s[--r]=o[e];return s}function wZ(n,t,e,i){return function(r){var s=t(r),o=yZ(),a=t(o),l=!1,h,d,u,c={point:g,lineStart:f,lineEnd:m,polygonStart:function(){c.point=v,c.lineStart=_,c.lineEnd=b,d=[],h=[]},polygonEnd:function(){c.point=g,c.lineStart=f,c.lineEnd=m,d=xZ(d);var y=mwt(h,i);d.length?(l||(r.polygonStart(),l=!0),CZ(d,ywt,y,e,r)):y&&(l||(r.polygonStart(),l=!0),r.lineStart(),e(null,null,1,r),r.lineEnd()),l&&(r.polygonEnd(),l=!1),d=h=null},sphere:function(){r.polygonStart(),r.lineStart(),e(null,null,1,r),r.lineEnd(),r.polygonEnd()}};function g(y,C){n(y,C)&&r.point(y,C)}function p(y,C){s.point(y,C)}function f(){c.point=p,s.lineStart()}function m(){c.point=g,s.lineEnd()}function v(y,C){u.push([y,C]),a.point(y,C)}function _(){a.lineStart(),u=[]}function b(){v(u[0][0],u[0][1]),a.lineEnd();var y=a.clean(),C=o.result(),S,w=C.length,x,A,M;if(u.pop(),h.push(u),u=null,!!w){if(y&1){if(A=C[0],(x=A.length-1)>0){for(l||(r.polygonStart(),l=!0),r.lineStart(),S=0;S<x;++S)r.point((M=A[S])[0],M[1]);r.lineEnd()}return}w>1&&y&2&&C.push(C.pop().concat(C.shift())),d.push(C.filter(bwt))}}return c}}function bwt(n){return n.length>1}function ywt(n,t){return((n=n.x)[0]<0?n[1]-dn-Le:dn-n[1])-((t=t.x)[0]<0?t[1]-dn-Le:dn-t[1])}const W$=wZ(function(){return!0},Cwt,xwt,[-Ue,-dn]);function Cwt(n){var t=NaN,e=NaN,i=NaN,r;return{lineStart:function(){n.lineStart(),r=1},point:function(s,o){var a=s>0?Ue:-Ue,l=Ai(s-t);Ai(l-Ue)<Le?(n.point(t,e=(e+o)/2>0?dn:-dn),n.point(i,e),n.lineEnd(),n.lineStart(),n.point(a,e),n.point(s,e),r=0):i!==a&&l>=Ue&&(Ai(t-i)<Le&&(t-=i*Le),Ai(s-a)<Le&&(s-=a*Le),e=Swt(t,e,s,o),n.point(i,e),n.lineEnd(),n.lineStart(),n.point(a,e),r=0),n.point(t=s,e=o),i=a},lineEnd:function(){n.lineEnd(),t=e=NaN},clean:function(){return 2-r}}}function Swt(n,t,e,i){var r,s,o=ke(n-e);return Ai(o)>Le?jf((ke(t)*(s=$e(i))*ke(e)-ke(i)*(r=$e(t))*ke(n))/(r*s*o)):(t+i)/2}function xwt(n,t,e,i){var r;if(n==null)r=e*dn,i.point(-Ue,r),i.point(0,r),i.point(Ue,r),i.point(Ue,0),i.point(Ue,-r),i.point(0,-r),i.point(-Ue,-r),i.point(-Ue,0),i.point(-Ue,r);else if(Ai(n[0]-t[0])>Le){var s=n[0]<t[0]?Ue:-Ue;r=e*s/2,i.point(-s,r),i.point(0,r),i.point(s,r)}else i.point(t[0],t[1])}function wwt(n){var t=$e(n),e=6*Zi,i=t>0,r=Ai(t)>Le;function s(d,u,c,g){fwt(g,n,e,c,d,u)}function o(d,u){return $e(d)*$e(u)>t}function a(d){var u,c,g,p,f;return{lineStart:function(){p=g=!1,f=1},point:function(m,v){var _=[m,v],b,y=o(m,v),C=i?y?0:h(m,v):y?h(m+(m<0?Ue:-Ue),v):0;if(!u&&(p=g=y)&&d.lineStart(),y!==g&&(b=l(u,_),(!b||TC(u,b)||TC(_,b))&&(_[2]=1)),y!==g)f=0,y?(d.lineStart(),b=l(_,u),d.point(b[0],b[1])):(b=l(u,_),d.point(b[0],b[1],2),d.lineEnd()),u=b;else if(r&&u&&i^y){var S;!(C&c)&&(S=l(_,u,!0))&&(f=0,i?(d.lineStart(),d.point(S[0][0],S[0][1]),d.point(S[1][0],S[1][1]),d.lineEnd()):(d.point(S[1][0],S[1][1]),d.lineEnd(),d.lineStart(),d.point(S[0][0],S[0][1],3)))}y&&(!u||!TC(u,_))&&d.point(_[0],_[1]),u=_,g=y,c=C},lineEnd:function(){g&&d.lineEnd(),u=null},clean:function(){return f|(p&&g)<<1}}}function l(d,u,c){var g=of(d),p=of(u),f=[1,0,0],m=i1(g,p),v=ky(m,m),_=m[0],b=v-_*_;if(!b)return!c&&d;var y=t*v/b,C=-t*_/b,S=i1(f,m),w=Ry(f,y),x=Ry(m,C);tB(w,x);var A=S,M=ky(w,A),T=ky(A,A),R=M*M-T*(ky(w,w)-1);if(!(R<0)){var B=ds(R),E=Ry(A,(-M-B)/T);if(tB(E,w),E=_L(E),!c)return E;var k=d[0],P=u[0],I=d[1],O=u[1],H;P<k&&(H=k,k=P,P=H);var z=P-k,F=Ai(z-Ue)<Le,j=F||z<Le;if(!F&&O<I&&(H=I,I=O,O=H),j?F?I+O>0^E[1]<(Ai(E[0]-k)<Le?I:O):I<=E[1]&&E[1]<=O:z>Ue^(k<=E[0]&&E[0]<=P)){var $=Ry(A,(-M+B)/T);return tB($,w),[E,_L($)]}}}function h(d,u){var c=i?n:Ue-n,g=0;return d<-c?g|=1:d>c&&(g|=2),u<-c?g|=4:u>c&&(g|=8),g}return wZ(o,a,s,i?[0,-n]:[-Ue,n-Ue])}function Awt(n,t,e,i,r,s){var o=n[0],a=n[1],l=t[0],h=t[1],d=0,u=1,c=l-o,g=h-a,p;if(p=e-o,!(!c&&p>0)){if(p/=c,c<0){if(p<d)return;p<u&&(u=p)}else if(c>0){if(p>u)return;p>d&&(d=p)}if(p=r-o,!(!c&&p<0)){if(p/=c,c<0){if(p>u)return;p>d&&(d=p)}else if(c>0){if(p<d)return;p<u&&(u=p)}if(p=i-a,!(!g&&p>0)){if(p/=g,g<0){if(p<d)return;p<u&&(u=p)}else if(g>0){if(p>u)return;p>d&&(d=p)}if(p=s-a,!(!g&&p<0)){if(p/=g,g<0){if(p>u)return;p>d&&(d=p)}else if(g>0){if(p<d)return;p<u&&(u=p)}return d>0&&(n[0]=o+d*c,n[1]=a+d*g),u<1&&(t[0]=o+u*c,t[1]=a+u*g),!0}}}}}var Py=1e9,Ey=-1e9;function AZ(n,t,e,i){function r(h,d){return n<=h&&h<=e&&t<=d&&d<=i}function s(h,d,u,c){var g=0,p=0;if(h==null||(g=o(h,u))!==(p=o(d,u))||l(h,d)<0^u>0)do c.point(g===0||g===3?n:e,g>1?i:t);while((g=(g+u+4)%4)!==p);else c.point(d[0],d[1])}function o(h,d){return Ai(h[0]-n)<Le?d>0?0:3:Ai(h[0]-e)<Le?d>0?2:1:Ai(h[1]-t)<Le?d>0?1:0:d>0?3:2}function a(h,d){return l(h.x,d.x)}function l(h,d){var u=o(h,1),c=o(d,1);return u!==c?u-c:u===0?d[1]-h[1]:u===1?h[0]-d[0]:u===2?h[1]-d[1]:d[0]-h[0]}return function(h){var d=h,u=yZ(),c,g,p,f,m,v,_,b,y,C,S,w={point:x,lineStart:R,lineEnd:B,polygonStart:M,polygonEnd:T};function x(k,P){r(k,P)&&d.point(k,P)}function A(){for(var k=0,P=0,I=g.length;P<I;++P)for(var O=g[P],H=1,z=O.length,F=O[0],j,$,Y=F[0],G=F[1];H<z;++H)j=Y,$=G,F=O[H],Y=F[0],G=F[1],$<=i?G>i&&(Y-j)*(i-$)>(G-$)*(n-j)&&++k:G<=i&&(Y-j)*(i-$)<(G-$)*(n-j)&&--k;return k}function M(){d=u,c=[],g=[],S=!0}function T(){var k=A(),P=S&&k,I=(c=xZ(c)).length;(P||I)&&(h.polygonStart(),P&&(h.lineStart(),s(null,null,1,h),h.lineEnd()),I&&CZ(c,a,k,s,h),h.polygonEnd()),d=h,c=g=p=null}function R(){w.point=E,g&&g.push(p=[]),C=!0,y=!1,_=b=NaN}function B(){c&&(E(f,m),v&&y&&u.rejoin(),c.push(u.result())),w.point=x,y&&d.lineEnd()}function E(k,P){var I=r(k,P);if(g&&p.push([k,P]),C)f=k,m=P,v=I,C=!1,I&&(d.lineStart(),d.point(k,P));else if(I&&y)d.point(k,P);else{var O=[_=Math.max(Ey,Math.min(Py,_)),b=Math.max(Ey,Math.min(Py,b))],H=[k=Math.max(Ey,Math.min(Py,k)),P=Math.max(Ey,Math.min(Py,P))];Awt(O,H,n,t,e,i)?(y||(d.lineStart(),d.point(O[0],O[1])),d.point(H[0],H[1]),I||d.lineEnd(),S=!1):I&&(d.lineStart(),d.point(k,P),S=!1)}_=k,b=P,y=I}return w}}function q_(n){return n}var nB=TM(),SL=TM(),MZ,TZ,xL,wL,Ol={point:vo,lineStart:vo,lineEnd:vo,polygonStart:function(){Ol.lineStart=Mwt,Ol.lineEnd=kwt},polygonEnd:function(){Ol.lineStart=Ol.lineEnd=Ol.point=vo,nB.add(Ai(SL)),SL.reset()},result:function(){var n=nB/2;return nB.reset(),n}};function Mwt(){Ol.point=Twt}function Twt(n,t){Ol.point=kZ,MZ=xL=n,TZ=wL=t}function kZ(n,t){SL.add(wL*n-xL*t),xL=n,wL=t}function kwt(){kZ(MZ,TZ)}var af=1/0,n1=af,Z_=-af,r1=Z_,s1={point:Rwt,lineStart:vo,lineEnd:vo,polygonStart:vo,polygonEnd:vo,result:function(){var n=[[af,n1],[Z_,r1]];return Z_=r1=-(n1=af=1/0),n}};function Rwt(n,t){n<af&&(af=n),n>Z_&&(Z_=n),t<n1&&(n1=t),t>r1&&(r1=t)}var AL=0,ML=0,$m=0,o1=0,a1=0,$g=0,TL=0,kL=0,Vm=0,RZ,BZ,La,Ia,ao={point:yc,lineStart:j$,lineEnd:N$,polygonStart:function(){ao.lineStart=Ewt,ao.lineEnd=Lwt},polygonEnd:function(){ao.point=yc,ao.lineStart=j$,ao.lineEnd=N$},result:function(){var n=Vm?[TL/Vm,kL/Vm]:$g?[o1/$g,a1/$g]:$m?[AL/$m,ML/$m]:[NaN,NaN];return AL=ML=$m=o1=a1=$g=TL=kL=Vm=0,n}};function yc(n,t){AL+=n,ML+=t,++$m}function j$(){ao.point=Bwt}function Bwt(n,t){ao.point=Pwt,yc(La=n,Ia=t)}function Pwt(n,t){var e=n-La,i=t-Ia,r=ds(e*e+i*i);o1+=r*(La+n)/2,a1+=r*(Ia+t)/2,$g+=r,yc(La=n,Ia=t)}function N$(){ao.point=yc}function Ewt(){ao.point=Iwt}function Lwt(){PZ(RZ,BZ)}function Iwt(n,t){ao.point=PZ,yc(RZ=La=n,BZ=Ia=t)}function PZ(n,t){var e=n-La,i=t-Ia,r=ds(e*e+i*i);o1+=r*(La+n)/2,a1+=r*(Ia+t)/2,$g+=r,r=Ia*n-La*t,TL+=r*(La+n),kL+=r*(Ia+t),Vm+=r*3,yc(La=n,Ia=t)}function EZ(n){this._context=n}EZ.prototype={_radius:4.5,pointRadius:function(n){return this._radius=n,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._context.closePath(),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._context.moveTo(n,t),this._point=1;break}case 1:{this._context.lineTo(n,t);break}default:{this._context.moveTo(n+this._radius,t),this._context.arc(n,t,this._radius,0,Ns);break}}},result:vo};var RL=TM(),rB,LZ,IZ,Gm,Um,J_={point:vo,lineStart:function(){J_.point=Owt},lineEnd:function(){rB&&OZ(LZ,IZ),J_.point=vo},polygonStart:function(){rB=!0},polygonEnd:function(){rB=null},result:function(){var n=+RL;return RL.reset(),n}};function Owt(n,t){J_.point=OZ,LZ=Gm=n,IZ=Um=t}function OZ(n,t){Gm-=n,Um-=t,RL.add(ds(Gm*Gm+Um*Um)),Gm=n,Um=t}function DZ(){this._string=[]}DZ.prototype={_radius:4.5,_circle:$$(4.5),pointRadius:function(n){return(n=+n)!==this._radius&&(this._radius=n,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){this._line===0&&this._string.push("Z"),this._point=NaN},point:function(n,t){switch(this._point){case 0:{this._string.push("M",n,",",t),this._point=1;break}case 1:{this._string.push("L",n,",",t);break}default:{this._circle==null&&(this._circle=$$(this._radius)),this._string.push("M",n,",",t,this._circle);break}}},result:function(){if(this._string.length){var n=this._string.join("");return this._string=[],n}else return null}};function $$(n){return"m0,"+n+"a"+n+","+n+" 0 1,1 0,"+-2*n+"a"+n+","+n+" 0 1,1 0,"+2*n+"z"}function vD(n,t){var e=4.5,i,r;function s(o){return o&&(typeof e=="function"&&r.pointRadius(+e.apply(this,arguments)),Ag(o,i(r))),r.result()}return s.area=function(o){return Ag(o,i(Ol)),Ol.result()},s.measure=function(o){return Ag(o,i(J_)),J_.result()},s.bounds=function(o){return Ag(o,i(s1)),s1.result()},s.centroid=function(o){return Ag(o,i(ao)),ao.result()},s.projection=function(o){return arguments.length?(i=o==null?(n=null,q_):(n=o).stream,s):n},s.context=function(o){return arguments.length?(r=o==null?(t=null,new DZ):new EZ(t=o),typeof e!="function"&&r.pointRadius(e),s):t},s.pointRadius=function(o){return arguments.length?(e=typeof o=="function"?o:(r.pointRadius(+o),+o),s):e},s.projection(n).context(t)}function kM(n){return function(t){var e=new BL;for(var i in n)e[i]=n[i];return e.stream=t,e}}function BL(){}BL.prototype={constructor:BL,point:function(n,t){this.stream.point(n,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function _D(n,t,e){var i=n.clipExtent&&n.clipExtent();return n.scale(150).translate([0,0]),i!=null&&n.clipExtent(null),Ag(e,n.stream(s1)),t(s1.result()),i!=null&&n.clipExtent(i),n}function RM(n,t,e){return _D(n,function(i){var r=t[1][0]-t[0][0],s=t[1][1]-t[0][1],o=Math.min(r/(i[1][0]-i[0][0]),s/(i[1][1]-i[0][1])),a=+t[0][0]+(r-o*(i[1][0]+i[0][0]))/2,l=+t[0][1]+(s-o*(i[1][1]+i[0][1]))/2;n.scale(150*o).translate([a,l])},e)}function bD(n,t,e){return RM(n,[[0,0],t],e)}function yD(n,t,e){return _D(n,function(i){var r=+t,s=r/(i[1][0]-i[0][0]),o=(r-s*(i[1][0]+i[0][0]))/2,a=-s*i[0][1];n.scale(150*s).translate([o,a])},e)}function CD(n,t,e){return _D(n,function(i){var r=+t,s=r/(i[1][1]-i[0][1]),o=-s*i[0][0],a=(r-s*(i[1][1]+i[0][1]))/2;n.scale(150*s).translate([o,a])},e)}var V$=16,Dwt=$e(30*Zi);function G$(n,t){return+t?Hwt(n,t):Fwt(n)}function Fwt(n){return kM({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}})}function Hwt(n,t){function e(i,r,s,o,a,l,h,d,u,c,g,p,f,m){var v=h-i,_=d-r,b=v*v+_*_;if(b>4*t&&f--){var y=o+c,C=a+g,S=l+p,w=ds(y*y+C*C+S*S),x=Ao(S/=w),A=Ai(Ai(S)-1)<Le||Ai(s-u)<Le?(s+u)/2:th(C,y),M=n(A,x),T=M[0],R=M[1],B=T-i,E=R-r,k=_*B-v*E;(k*k/b>t||Ai((v*B+_*E)/b-.5)>.3||o*c+a*g+l*p<Dwt)&&(e(i,r,s,o,a,l,T,R,A,y/=w,C/=w,S,f,m),m.point(T,R),e(T,R,A,y,C,S,h,d,u,c,g,p,f,m))}}return function(i){var r,s,o,a,l,h,d,u,c,g,p,f,m={point:v,lineStart:_,lineEnd:y,polygonStart:function(){i.polygonStart(),m.lineStart=C},polygonEnd:function(){i.polygonEnd(),m.lineStart=_}};function v(x,A){x=n(x,A),i.point(x[0],x[1])}function _(){u=NaN,m.point=b,i.lineStart()}function b(x,A){var M=of([x,A]),T=n(x,A);e(u,c,d,g,p,f,u=T[0],c=T[1],d=x,g=M[0],p=M[1],f=M[2],V$,i),i.point(u,c)}function y(){m.point=v,i.lineEnd()}function C(){_(),m.point=S,m.lineEnd=w}function S(x,A){b(r=x,A),s=u,o=c,a=g,l=p,h=f,m.point=b}function w(){e(u,c,d,g,p,f,s,o,r,a,l,h,V$,i),m.lineEnd=y,y()}return m}}var zwt=kM({point:function(n,t){this.stream.point(n*Zi,t*Zi)}});function Wwt(n){return kM({point:function(t,e){var i=n(t,e);return this.stream.point(i[0],i[1])}})}function jwt(n,t,e,i,r){function s(o,a){return o*=i,a*=r,[t+n*o,e-n*a]}return s.invert=function(o,a){return[(o-t)/n*i,(e-a)/n*r]},s}function U$(n,t,e,i,r,s){var o=$e(s),a=ke(s),l=o*n,h=a*n,d=o/n,u=a/n,c=(a*e-o*t)/n,g=(a*t+o*e)/n;function p(f,m){return f*=i,m*=r,[l*f-h*m+t,e-h*f-l*m]}return p.invert=function(f,m){return[i*(d*f-u*m+c),r*(g-u*f-d*m)]},p}function uh(n){return FZ(function(){return n})()}function FZ(n){var t,e=150,i=480,r=250,s=0,o=0,a=0,l=0,h=0,d,u=0,c=1,g=1,p=null,f=W$,m=null,v,_,b,y=q_,C=.5,S,w,x,A,M;function T(k){return x(k[0]*Zi,k[1]*Zi)}function R(k){return k=x.invert(k[0],k[1]),k&&[k[0]*fr,k[1]*fr]}T.stream=function(k){return A&&M===k?A:A=zwt(Wwt(d)(f(S(y(M=k)))))},T.preclip=function(k){return arguments.length?(f=k,p=void 0,E()):f},T.postclip=function(k){return arguments.length?(y=k,m=v=_=b=null,E()):y},T.clipAngle=function(k){return arguments.length?(f=+k?wwt(p=k*Zi):(p=null,W$),E()):p*fr},T.clipExtent=function(k){return arguments.length?(y=k==null?(m=v=_=b=null,q_):AZ(m=+k[0][0],v=+k[0][1],_=+k[1][0],b=+k[1][1]),E()):m==null?null:[[m,v],[_,b]]},T.scale=function(k){return arguments.length?(e=+k,B()):e},T.translate=function(k){return arguments.length?(i=+k[0],r=+k[1],B()):[i,r]},T.center=function(k){return arguments.length?(s=k[0]%360*Zi,o=k[1]%360*Zi,B()):[s*fr,o*fr]},T.rotate=function(k){return arguments.length?(a=k[0]%360*Zi,l=k[1]%360*Zi,h=k.length>2?k[2]%360*Zi:0,B()):[a*fr,l*fr,h*fr]},T.angle=function(k){return arguments.length?(u=k%360*Zi,B()):u*fr},T.reflectX=function(k){return arguments.length?(c=k?-1:1,B()):c<0},T.reflectY=function(k){return arguments.length?(g=k?-1:1,B()):g<0},T.precision=function(k){return arguments.length?(S=G$(w,C=k*k),E()):ds(C)},T.fitExtent=function(k,P){return RM(T,k,P)},T.fitSize=function(k,P){return bD(T,k,P)},T.fitWidth=function(k,P){return yD(T,k,P)},T.fitHeight=function(k,P){return CD(T,k,P)};function B(){var k=U$(e,0,0,c,g,u).apply(null,t(s,o)),P=(u?U$:jwt)(e,i-k[0],r-k[1],c,g,u);return d=bZ(a,l,h),w=yL(t,P),x=yL(d,w),S=G$(w,C),E()}function E(){return A=M=null,T}return function(){return t=n.apply(this,arguments),T.invert=t.invert&&R,B()}}function SD(n){var t=0,e=Ue/3,i=FZ(n),r=i(t,e);return r.parallels=function(s){return arguments.length?i(t=s[0]*Zi,e=s[1]*Zi):[t*fr,e*fr]},r}function Nwt(n){var t=$e(n);function e(i,r){return[i*t,ke(r)/t]}return e.invert=function(i,r){return[i/t,Ao(r*t)]},e}function $wt(n,t){var e=ke(n),i=(e+ke(t))/2;if(Ai(i)<Le)return Nwt(n);var r=1+e*(2*i-e),s=ds(r)/i;function o(a,l){var h=ds(r-2*i*ke(l))/i;return[h*ke(a*=i),s-h*$e(a)]}return o.invert=function(a,l){var h=s-l,d=th(a,Ai(h))*mo(h);return h*i<0&&(d-=Ue*mo(a)*mo(h)),[d/i,Ao((r-(a*a+h*h)*i*i)/(2*i))]},o}function l1(){return SD($wt).scale(155.424).center([0,33.6442])}function HZ(){return l1().parallels([29.5,45.5]).scale(1070).translate([480,250]).rotate([96,0]).center([-.6,38.7])}function Vwt(n){var t=n.length;return{point:function(e,i){for(var r=-1;++r<t;)n[r].point(e,i)},sphere:function(){for(var e=-1;++e<t;)n[e].sphere()},lineStart:function(){for(var e=-1;++e<t;)n[e].lineStart()},lineEnd:function(){for(var e=-1;++e<t;)n[e].lineEnd()},polygonStart:function(){for(var e=-1;++e<t;)n[e].polygonStart()},polygonEnd:function(){for(var e=-1;++e<t;)n[e].polygonEnd()}}}function Gwt(){var n,t,e=HZ(),i,r=l1().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s,o=l1().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a,l,h={point:function(c,g){l=[c,g]}};function d(c){var g=c[0],p=c[1];return l=null,i.point(g,p),l||(s.point(g,p),l)||(a.point(g,p),l)}d.invert=function(c){var g=e.scale(),p=e.translate(),f=(c[0]-p[0])/g,m=(c[1]-p[1])/g;return(m>=.12&&m<.234&&f>=-.425&&f<-.214?r:m>=.166&&m<.234&&f>=-.214&&f<-.115?o:e).invert(c)},d.stream=function(c){return n&&t===c?n:n=Vwt([e.stream(t=c),r.stream(c),o.stream(c)])},d.precision=function(c){return arguments.length?(e.precision(c),r.precision(c),o.precision(c),u()):e.precision()},d.scale=function(c){return arguments.length?(e.scale(c),r.scale(c*.35),o.scale(c),d.translate(e.translate())):e.scale()},d.translate=function(c){if(!arguments.length)return e.translate();var g=e.scale(),p=+c[0],f=+c[1];return i=e.translate(c).clipExtent([[p-.455*g,f-.238*g],[p+.455*g,f+.238*g]]).stream(h),s=r.translate([p-.307*g,f+.201*g]).clipExtent([[p-.425*g+Le,f+.12*g+Le],[p-.214*g-Le,f+.234*g-Le]]).stream(h),a=o.translate([p-.205*g,f+.212*g]).clipExtent([[p-.214*g+Le,f+.166*g+Le],[p-.115*g-Le,f+.234*g-Le]]).stream(h),u()},d.fitExtent=function(c,g){return RM(d,c,g)},d.fitSize=function(c,g){return bD(d,c,g)},d.fitWidth=function(c,g){return yD(d,c,g)},d.fitHeight=function(c,g){return CD(d,c,g)};function u(){return n=t=null,d}return d.scale(1070)}function zZ(n){return function(t,e){var i=$e(t),r=$e(e),s=n(i*r);return[s*r*ke(t),s*ke(e)]}}function ab(n){return function(t,e){var i=ds(t*t+e*e),r=n(i),s=ke(r),o=$e(r);return[th(t*s,i*o),Ao(i&&e*s/i)]}}var WZ=zZ(function(n){return ds(2/(1+n))});WZ.invert=ab(function(n){return 2*Ao(n/2)});function Uwt(){return uh(WZ).scale(124.75).clipAngle(180-.001)}var jZ=zZ(function(n){return(n=_Z(n))&&n/ke(n)});jZ.invert=ab(function(n){return n});function Ywt(){return uh(jZ).scale(79.4188).clipAngle(180-.001)}function BM(n,t){return[n,t1(mD((dn+t)/2))]}BM.invert=function(n,t){return[n,2*jf(vZ(t))-dn]};function Xwt(){return NZ(BM).scale(961/Ns)}function NZ(n){var t=uh(n),e=t.center,i=t.scale,r=t.translate,s=t.clipExtent,o=null,a,l,h;t.scale=function(u){return arguments.length?(i(u),d()):i()},t.translate=function(u){return arguments.length?(r(u),d()):r()},t.center=function(u){return arguments.length?(e(u),d()):e()},t.clipExtent=function(u){return arguments.length?(u==null?o=a=l=h=null:(o=+u[0][0],a=+u[0][1],l=+u[1][0],h=+u[1][1]),d()):o==null?null:[[o,a],[l,h]]};function d(){var u=Ue*i(),c=t(pwt(t.rotate()).invert([0,0]));return s(o==null?[[c[0]-u,c[1]-u],[c[0]+u,c[1]+u]]:n===BM?[[Math.max(c[0]-u,o),a],[Math.min(c[0]+u,l),h]]:[[o,Math.max(c[1]-u,a)],[l,Math.min(c[1]+u,h)]])}return d()}function Ly(n){return mD((dn+n)/2)}function Kwt(n,t){var e=$e(n),i=n===t?ke(n):t1(e/$e(t))/t1(Ly(t)/Ly(n)),r=e*QR(Ly(n),i)/i;if(!i)return BM;function s(o,a){r>0?a<-dn+Le&&(a=-dn+Le):a>dn-Le&&(a=dn-Le);var l=r/QR(Ly(a),i);return[l*ke(i*o),r-l*$e(i*o)]}return s.invert=function(o,a){var l=r-a,h=mo(i)*ds(o*o+l*l),d=th(o,Ai(l))*mo(l);return l*i<0&&(d-=Ue*mo(o)*mo(l)),[d/i,2*jf(QR(r/h,1/i))-dn]},s}function qwt(){return SD(Kwt).scale(109.5).parallels([30,30])}function h1(n,t){return[n,t]}h1.invert=h1;function Zwt(){return uh(h1).scale(152.63)}function Jwt(n,t){var e=$e(n),i=n===t?ke(n):(e-$e(t))/(t-n),r=e/i+n;if(Ai(i)<Le)return h1;function s(o,a){var l=r-a,h=i*o;return[l*ke(h),r-l*$e(h)]}return s.invert=function(o,a){var l=r-a,h=th(o,Ai(l))*mo(l);return l*i<0&&(h-=Ue*mo(o)*mo(l)),[h/i,r-mo(i)*ds(o*o+l*l)]},s}function Qwt(){return SD(Jwt).scale(131.154).center([0,13.9389])}var Av=1.340264,Mv=-.081106,Tv=893e-6,kv=.003796,d1=ds(3)/2,tAt=12;function $Z(n,t){var e=Ao(d1*ke(t)),i=e*e,r=i*i*i;return[n*$e(e)/(d1*(Av+3*Mv*i+r*(7*Tv+9*kv*i))),e*(Av+Mv*i+r*(Tv+kv*i))]}$Z.invert=function(n,t){for(var e=t,i=e*e,r=i*i*i,s=0,o,a,l;s<tAt&&(a=e*(Av+Mv*i+r*(Tv+kv*i))-t,l=Av+3*Mv*i+r*(7*Tv+9*kv*i),e-=o=a/l,i=e*e,r=i*i*i,!(Ai(o)<gwt));++s);return[d1*n*(Av+3*Mv*i+r*(7*Tv+9*kv*i))/$e(e),Ao(ke(e)/d1)]};function eAt(){return uh($Z).scale(177.158)}function VZ(n,t){var e=$e(t),i=$e(n)*e;return[e*ke(n)/i,ke(t)/i]}VZ.invert=ab(jf);function iAt(){return uh(VZ).scale(144.049).clipAngle(60)}function nAt(){var n=1,t=0,e=0,i=1,r=1,s=0,o,a,l=null,h,d,u,c=1,g=1,p=kM({point:function(y,C){var S=b([y,C]);this.stream.point(S[0],S[1])}}),f=q_,m,v;function _(){return c=n*i,g=n*r,m=v=null,b}function b(y){var C=y[0]*c,S=y[1]*g;if(s){var w=S*o-C*a;C=C*o+S*a,S=w}return[C+t,S+e]}return b.invert=function(y){var C=y[0]-t,S=y[1]-e;if(s){var w=S*o+C*a;C=C*o-S*a,S=w}return[C/c,S/g]},b.stream=function(y){return m&&v===y?m:m=p(f(v=y))},b.postclip=function(y){return arguments.length?(f=y,l=h=d=u=null,_()):f},b.clipExtent=function(y){return arguments.length?(f=y==null?(l=h=d=u=null,q_):AZ(l=+y[0][0],h=+y[0][1],d=+y[1][0],u=+y[1][1]),_()):l==null?null:[[l,h],[d,u]]},b.scale=function(y){return arguments.length?(n=+y,_()):n},b.translate=function(y){return arguments.length?(t=+y[0],e=+y[1],_()):[t,e]},b.angle=function(y){return arguments.length?(s=y%360*Zi,a=ke(s),o=$e(s),_()):s*fr},b.reflectX=function(y){return arguments.length?(i=y?-1:1,_()):i<0},b.reflectY=function(y){return arguments.length?(r=y?-1:1,_()):r<0},b.fitExtent=function(y,C){return RM(b,y,C)},b.fitSize=function(y,C){return bD(b,y,C)},b.fitWidth=function(y,C){return yD(b,y,C)},b.fitHeight=function(y,C){return CD(b,y,C)},b}function GZ(n,t){var e=t*t,i=e*e;return[n*(.8707-.131979*e+i*(-.013791+i*(.003971*e-.001529*i))),t*(1.007226+e*(.015085+i*(-.044475+.028874*e-.005916*i)))]}GZ.invert=function(n,t){var e=t,i=25,r;do{var s=e*e,o=s*s;e-=r=(e*(1.007226+s*(.015085+o*(-.044475+.028874*s-.005916*o)))-t)/(1.007226+s*(.015085*3+o*(-.044475*7+.028874*9*s-.005916*11*o)))}while(Ai(r)>Le&&--i>0);return[n/(.8707+(s=e*e)*(-.131979+s*(-.013791+s*s*s*(.003971-.001529*s)))),e]};function rAt(){return uh(GZ).scale(175.295)}function UZ(n,t){return[$e(t)*ke(n),ke(t)]}UZ.invert=ab(Ao);function sAt(){return uh(UZ).scale(249.5).clipAngle(90+Le)}function YZ(n,t){var e=$e(t),i=1+$e(n)*e;return[e*ke(n)/i,ke(t)/i]}YZ.invert=ab(function(n){return 2*jf(n)});function oAt(){return uh(YZ).scale(250).clipAngle(142)}function XZ(n,t){return[t1(mD((dn+t)/2)),-n]}XZ.invert=function(n,t){return[-t,2*jf(vZ(n))-dn]};function aAt(){var n=NZ(XZ),t=n.center,e=n.rotate;return n.center=function(i){return arguments.length?t([-i[1],i[0]]):(i=t(),[i[1],-i[0]])},n.rotate=function(i){return arguments.length?e([i[0],i[1],i.length>2?i[2]+90:90]):(i=e(),[i[0],i[1],i[2]-90])},e([0,0,90]).scale(159.155)}function lAt(n){return n}function hAt(n){if(n==null)return lAt;var t,e,i=n.scale[0],r=n.scale[1],s=n.translate[0],o=n.translate[1];return function(a,l){l||(t=e=0);var h=2,d=a.length,u=new Array(d);for(u[0]=(t+=a[0])*i+s,u[1]=(e+=a[1])*r+o;h<d;)u[h]=a[h],++h;return u}}function dAt(n,t){for(var e,i=n.length,r=i-t;r<--i;)e=n[r],n[r++]=n[i],n[i]=e}function uAt(n,t){return typeof t=="string"&&(t=n.objects[t]),t.type==="GeometryCollection"?{type:"FeatureCollection",features:t.geometries.map(function(e){return Y$(n,e)})}:Y$(n,t)}function Y$(n,t){var e=t.id,i=t.bbox,r=t.properties==null?{}:t.properties,s=cAt(n,t);return e==null&&i==null?{type:"Feature",properties:r,geometry:s}:i==null?{type:"Feature",id:e,properties:r,geometry:s}:{type:"Feature",id:e,bbox:i,properties:r,geometry:s}}function cAt(n,t){var e=hAt(n.transform),i=n.arcs;function r(d,u){u.length&&u.pop();for(var c=i[d<0?~d:d],g=0,p=c.length;g<p;++g)u.push(e(c[g],g));d<0&&dAt(u,p)}function s(d){return e(d)}function o(d){for(var u=[],c=0,g=d.length;c<g;++c)r(d[c],u);return u.length<2&&u.push(u[0]),u}function a(d){for(var u=o(d);u.length<4;)u.push(u[0]);return u}function l(d){return d.map(a)}function h(d){var u=d.type,c;switch(u){case"GeometryCollection":return{type:u,geometries:d.geometries.map(h)};case"Point":c=s(d.coordinates);break;case"MultiPoint":c=d.coordinates.map(s);break;case"LineString":c=o(d.arcs);break;case"MultiLineString":c=d.arcs.map(o);break;case"Polygon":c=l(d.arcs);break;case"MultiPolygon":c=d.arcs.map(l);break;default:return null}return{type:u,coordinates:c}}return h(t)}var sB={exports:{}},oB,X$;function gAt(){if(X$)return oB;X$=1;var n=function(t,e){this.p1=t,this.p2=e};return n.prototype.rise=function(){return this.p2[1]-this.p1[1]},n.prototype.run=function(){return this.p2[0]-this.p1[0]},n.prototype.slope=function(){return this.rise()/this.run()},n.prototype.yIntercept=function(){return this.p1[1]-this.p1[0]*this.slope(this.p1,this.p2)},n.prototype.isVertical=function(){return!isFinite(this.slope())},n.prototype.isHorizontal=function(){return this.p1[1]==this.p2[1]},n.prototype._perpendicularDistanceHorizontal=function(t){return Math.abs(this.p1[1]-t[1])},n.prototype._perpendicularDistanceVertical=function(t){return Math.abs(this.p1[0]-t[0])},n.prototype._perpendicularDistanceHasSlope=function(t){var e=this.slope(),i=this.yIntercept();return Math.abs(e*t[0]-t[1]+i)/Math.sqrt(Math.pow(e,2)+1)},n.prototype.perpendicularDistance=function(t){return this.isVertical()?this._perpendicularDistanceVertical(t):this.isHorizontal()?this._perpendicularDistanceHorizontal(t):this._perpendicularDistanceHasSlope(t)},oB=n,oB}var aB,K$;function pAt(){if(K$)return aB;K$=1;var n=gAt(),t=function(e,i){for(var r=0,s=0,o=1;o<=e.length-2;o++){var a=new n(e[0],e[e.length-1]).perpendicularDistance(e[o]);a>r&&(s=o,r=a)}if(r>i)var l=t(e.slice(0,s),i),h=t(e.slice(s,e.length),i),d=l.concat(h);else e.length>1?d=[e[0],e[e.length-1]]:d=[e[0]];return d};return aB=t,aB}var q$;function fAt(){return q$||(q$=1,function(n){var t=pAt();n.exports=function(r,s,o){return o||(r=JSON.parse(JSON.stringify(r))),r.features?i(r,s):r.type&&r.type==="Feature"?e(r,s):new Error("FeatureCollection or individual Feature required")},n.exports.simplify=function(r,s){return t(r,s)};function e(r,s){var o=r.geometry,a=o.type;if(a==="LineString")o.coordinates=n.exports.simplify(o.coordinates,s);else if(a==="Polygon"||a==="MultiLineString")for(var l=0;l<o.coordinates.length;l++)o.coordinates[l]=n.exports.simplify(o.coordinates[l],s);else if(a==="MultiPolygon")for(var h=0;h<o.coordinates.length;h++)for(var d=0;d<o.coordinates[h].length;d++)o.coordinates[h][d]=n.exports.simplify(o.coordinates[h][d],s);return r}function i(r,s){for(var o=0;o<r.features.length;o++)r.features[o]=e(r.features[o],s);return r}}(sB)),sB.exports}var mAt=fAt();const vAt=XA(mAt),_At=(n,t)=>{var e,i;if(!(t!=null&&t.fields)||n.length===0)return n;const r=t.fields,s=n[0],o={},a=[];for(const l in r)if(Object.prototype.hasOwnProperty.call(r,l)){const h=r[l];if(!h.type){let u=s;l in s||(u=(e=n.find(c=>l in c))!==null&&e!==void 0?e:s),h.type=typeof u[l]=="number"?"linear":"ordinal"}let d;if(typeof h.sortIndex=="number"&&(d={key:l,type:h.type,index:h.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:h.sortReverse===!0},a.push(d)),((i=h.domain)===null||i===void 0?void 0:i.length)>0)if(h.type==="ordinal"){h._domainCache={},o[l]=h;const u={};h.domain.forEach((c,g)=>{u[c]=g,h._domainCache[c]=g}),d&&(d.sortIndex=u,d.sortIndexCount=h.domain.length)}else h.domain.length>=2&&(o[l]=h)}return Object.keys(o).length>0&&(n=n.filter(l=>{for(const h in o){const d=o[h];if(d.type==="ordinal"){if(!(l[h]in d._domainCache))return!1}else if(d.domain[0]>l[h]||d.domain[1]<l[h])return!1}return!0})),a.sort((l,h)=>l.index-h.index),n.sort((l,h)=>bAt(l,h,a)),n};function bAt(n,t,e){for(let i=0;i<e.length;i++){const r=e[i];let s=0;if(r.type==="ordinal"?(r.sortIndex[t[r.key]]===void 0&&(r.sortIndex[t[r.key]]=r.sortIndexCount++),r.sortIndex[n[r.key]]===void 0&&(r.sortIndex[n[r.key]]=r.sortIndexCount++),s=r.sortIndex[n[r.key]]-r.sortIndex[t[r.key]]):r.type==="linear"&&(s=n[r.key]-t[r.key]),r.sortReverse&&(s=-s),s!==0)return s}return 0}var Z$={},lB={},hB=34,fm=10,dB=13;function KZ(n){return new Function("d","return {"+n.map(function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'}).join(",")+"}")}function yAt(n,t){var e=KZ(n);return function(i,r){return t(e(i),r,n)}}function J$(n){var t=Object.create(null),e=[];return n.forEach(function(i){for(var r in i)r in t||e.push(t[r]=r)}),e}function Xr(n,t){var e=n+"",i=e.length;return i<t?new Array(t-i+1).join(0)+e:e}function CAt(n){return n<0?"-"+Xr(-n,6):n>9999?"+"+Xr(n,6):Xr(n,4)}function SAt(n){var t=n.getUTCHours(),e=n.getUTCMinutes(),i=n.getUTCSeconds(),r=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":CAt(n.getUTCFullYear())+"-"+Xr(n.getUTCMonth()+1,2)+"-"+Xr(n.getUTCDate(),2)+(r?"T"+Xr(t,2)+":"+Xr(e,2)+":"+Xr(i,2)+"."+Xr(r,3)+"Z":i?"T"+Xr(t,2)+":"+Xr(e,2)+":"+Xr(i,2)+"Z":e||t?"T"+Xr(t,2)+":"+Xr(e,2)+"Z":"")}function xD(n){var t=new RegExp('["'+n+`
\r]`),e=n.charCodeAt(0);function i(u,c){var g,p,f=r(u,function(m,v){if(g)return g(m,v-1);p=m,g=c?yAt(m,c):KZ(m)});return f.columns=p||[],f}function r(u,c){var g=[],p=u.length,f=0,m=0,v,_=p<=0,b=!1;u.charCodeAt(p-1)===fm&&--p,u.charCodeAt(p-1)===dB&&--p;function y(){if(_)return lB;if(b)return b=!1,Z$;var S,w=f,x;if(u.charCodeAt(w)===hB){for(;f++<p&&u.charCodeAt(f)!==hB||u.charCodeAt(++f)===hB;);return(S=f)>=p?_=!0:(x=u.charCodeAt(f++))===fm?b=!0:x===dB&&(b=!0,u.charCodeAt(f)===fm&&++f),u.slice(w+1,S-1).replace(/""/g,'"')}for(;f<p;){if((x=u.charCodeAt(S=f++))===fm)b=!0;else if(x===dB)b=!0,u.charCodeAt(f)===fm&&++f;else if(x!==e)continue;return u.slice(w,S)}return _=!0,u.slice(w,p)}for(;(v=y())!==lB;){for(var C=[];v!==Z$&&v!==lB;)C.push(v),v=y();c&&(C=c(C,m++))==null||g.push(C)}return g}function s(u,c){return u.map(function(g){return c.map(function(p){return d(g[p])}).join(n)})}function o(u,c){return c==null&&(c=J$(u)),[c.map(d).join(n)].concat(s(u,c)).join(`
`)}function a(u,c){return c==null&&(c=J$(u)),s(u,c).join(`
`)}function l(u){return u.map(h).join(`
`)}function h(u){return u.map(d).join(n)}function d(u){return u==null?"":u instanceof Date?SAt(u):t.test(u+="")?'"'+u.replace(/"/g,'""')+'"':u}return{parse:i,parseRows:r,format:o,formatBody:a,formatRows:l,formatRow:h,formatValue:d}}var xAt=xD(","),wAt=xAt.parse,AAt=xD("	"),MAt=AAt.parse;function TAt(n){if(!n)throw new Error("geojson is required");switch(n.type){case"Feature":return qZ(n);case"FeatureCollection":return kAt(n);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return wD(n);default:throw new Error("unknown GeoJSON type")}}function qZ(n){var t={type:"Feature"};return Object.keys(n).forEach(function(e){switch(e){case"type":case"properties":case"geometry":return;default:t[e]=n[e]}}),t.properties=ZZ(n.properties),t.geometry=wD(n.geometry),t}function ZZ(n){var t={};return n&&Object.keys(n).forEach(function(e){var i=n[e];typeof i=="object"?i===null?t[e]=null:Array.isArray(i)?t[e]=i.map(function(r){return r}):t[e]=ZZ(i):t[e]=i}),t}function kAt(n){var t={type:"FeatureCollection"};return Object.keys(n).forEach(function(e){switch(e){case"type":case"features":return;default:t[e]=n[e]}}),t.features=n.features.map(function(e){return qZ(e)}),t}function wD(n){var t={type:n.type};return n.bbox&&(t.bbox=n.bbox),n.type==="GeometryCollection"?(t.geometries=n.geometries.map(function(e){return wD(e)}),t):(t.coordinates=JZ(n.coordinates),t)}function JZ(n){var t=n;return typeof t[0]!="object"?t.slice():t.map(function(e){return JZ(e)})}function Ym(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function PL(n){for(var t=Ym(n),e=0,i=1,r,s;i<t.length;)r=s||t[0],s=t[i],e+=(s[0]-r[0])*(s[1]+r[1]),i++;return e>0}function Q$(n,t){if(n.type==="Feature")t(n,0);else if(n.type==="FeatureCollection")for(var e=0;e<n.features.length&&t(n.features[e],e)!==!1;e++);}function AD(n,t){var e,i,r,s,o,a,l,h,d,u,c=0,g=n.type==="FeatureCollection",p=n.type==="Feature",f=g?n.features.length:1;for(e=0;e<f;e++){for(a=g?n.features[e].geometry:p?n.geometry:n,h=g?n.features[e].properties:p?n.properties:{},d=g?n.features[e].bbox:p?n.bbox:void 0,u=g?n.features[e].id:p?n.id:void 0,l=a?a.type==="GeometryCollection":!1,o=l?a.geometries.length:1,r=0;r<o;r++){if(s=l?a.geometries[r]:a,s===null){if(t(null,c,h,d,u)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(s,c,h,d,u)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<s.geometries.length;i++)if(t(s.geometries[i],c,h,d,u)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}c++}}function RAt(n,t){AD(n,function(e,i,r,s,o){var a=e===null?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return t(Bz(e,r,{bbox:s,id:o}),i,0)===!1?!1:void 0}var l;switch(a){case"MultiPoint":l="Point";break;case"MultiLineString":l="LineString";break;case"MultiPolygon":l="Polygon";break}for(var h=0;h<e.coordinates.length;h++){var d=e.coordinates[h],u={type:l,coordinates:d};if(t(Bz(u,r),i,h)===!1)return!1}})}function BAt(n,t){if(t=t||{},!Llt(t))throw new Error("options is invalid");var e=t.reverse||!1,i=t.mutate||!1;if(!n)throw new Error("<geojson> is required");if(typeof e!="boolean")throw new Error("<reverse> must be a boolean");if(typeof i!="boolean")throw new Error("<mutate> must be a boolean");i===!1&&(n=TAt(n));var r=[];switch(n.type){case"GeometryCollection":return AD(n,function(s){kC(s,e)}),n;case"FeatureCollection":return Q$(n,function(s){Q$(kC(s,e),function(o){r.push(o)})}),HY(r)}return kC(n,e)}function kC(n,t){var e=n.type==="Feature"?n.geometry.type:n.type;switch(e){case"GeometryCollection":return AD(n,function(i){kC(i,t)}),n;case"LineString":return tV(Ym(n),t),n;case"Polygon":return eV(Ym(n),t),n;case"MultiLineString":return Ym(n).forEach(function(i){tV(i,t)}),n;case"MultiPolygon":return Ym(n).forEach(function(i){eV(i,t)}),n;case"Point":case"MultiPoint":return n}}function tV(n,t){PL(n)===t&&n.reverse()}function eV(n,t){PL(n[0])!==t&&n[0].reverse();for(var e=1;e<n.length;e++)PL(n[e])===t&&n[e].reverse()}function PAt(n){if(!n)throw new Error("geojson is required");var t=[];return RAt(n,function(e){t.push(e)}),HY(t)}let uB=0;const EAt=1e8;function QZ(n="dataset"){return uB>EAt&&(uB=0),n+"_"+uB++}let LAt=class{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new us,i=t!=null&&t.name?t.name:QZ("dataset"),this.name=i,this._logger=(e=t==null?void 0:t.logger)!==null&&e!==void 0?e:Pr.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&((i=this._logger)===null||i===void 0||i.error(`Error: dataView ${t} `)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} `)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} `)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let r=this._callMap.get(i);r||(r=()=>{t.some(s=>s.isRunning)||i()}),t.forEach(s=>{s.target.addListener(e,r)}),this._callMap.set(i,r)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const r=this._callMap.get(i);r&&t.forEach(s=>{s.target.removeListener(e,r)}),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.parseNewData(e.data,e.options)})}multipleDataViewUpdateInRawData(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.updateRawData(e.data,e.options)})}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}};const cB="_data-view-diff-rank";let tJ=class eJ{constructor(t,e){let i;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new us,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(r={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach(s=>{this.executeTransform(s,{pushHistory:r.pushHistory,emitMessage:!1}),this.isLastTransform(s)&&this.diffLastData()}),this.isRunning=!1,r.emitMessage!==!1&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},i=e!=null&&e.name?e.name:QZ("dataview"),this.name=i,e!=null&&e.history&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(i,this),this.setFields(e==null?void 0:e.fields)}parse(t,e,i=!1){var r;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const s=this.cloneParseData(t,e);if(e!=null&&e.type){const o=((r=this.dataSet.getParser(e.type))!==null&&r!==void 0?r:this.dataSet.getParser("bytejson"))(s,e.options,this);this.rawData=s,this.parserData=o,this.history&&this.historyData.push(s,o),this.latestData=o}else this.parserData=s,this.rawData=s,this.history&&this.historyData.push(s),this.latestData=s;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t,e=!0){if(this.isRunning=!0,t&&t.type){let i=!0;if(t.type==="fields"){this._fields=t.options.fields;const r=this.transformsArr.findIndex(s=>s.type===t.type);r>=0&&(i=!1,this.transformsArr[r].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const r=this.isLastTransform(t);this.executeTransform(t),r&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort((t,e)=>{var i,r;return((i=t.level)!==null&&i!==void 0?i:0)-((r=e.level)!==null&&r!==void 0?r:0)})}executeTransform(t,e={pushHistory:!0,emitMessage:!0}){const{pushHistory:i,emitMessage:r}=e,s=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&i!==!1&&this.historyData.push(s),this.latestData=s,r!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData||!this.latestData.forEach||!(!((t=this._diffKeys)===null||t===void 0)&&t.length))return;const e=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach(i=>{i[cB]=e,this._diffMap.set(this._diffKeys.reduce((r,s)=>r+i[s],""),i)}),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let i;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach(r=>{r[cB]=e,i=this._diffKeys.reduce((s,o)=>s+r[o],""),this._diffMap.get(i)?this.latestDataAUD.update.push(r):this.latestDataAUD.add.push(r),this._diffMap.set(i,r)}),this._diffMap.forEach((r,s)=>{r[cB]<e&&(this.latestDataAUD.del.push(r),this._diffMap.delete(s))})}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof eJ||(e==null?void 0:e.clone)!==!0||(i=!0),i?pZ(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:((t=this.parseOption)===null||t===void 0?void 0:t.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t,e=!1){this._fields=t&&e?uwt({},this._fields,t):t;const i=this.transformsArr.find(r=>r.type==="fields");!R$(this._fields)&&R$(i)?(this.dataSet.registerTransform("fields",_At),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}};function IAt(n){return n instanceof tJ}function Mg(n,t=["data"]){const e=n;let i;if(!Z1t(e)||typeof e!="object"||IAt(e)||iwt(e))return e;const r=Q1t(e),s=e.length;i=r?new Array(s):typeof e=="object"?{}:q1t(e)||ewt(e)||J1t(e)?e:twt(e)?new Date(+e):void 0;const o=r?void 0:Object.keys(Object(e));let a=-1;if(i)for(;++a<(o||e).length;){const l=o?o[a]:a,h=e[l];t!=null&&t.includes(l.toString())?i[l]=h:i[l]=Mg(h,t)}return i}function iJ(n){var t,e;const i=Object.assign({},n);return xt(n.style)||(i.textStyle=ln(n.style)),xt(n.textStyle)||Z(i.textStyle,ln(n.textStyle)),!((t=n.shape)===null||t===void 0)&&t.style&&ln(i.shape.style),!((e=n.background)===null||e===void 0)&&e.style&&ln(i.background.style),i}function ln(n){return xt(n)||n.angle&&(n.angle=Te(n.angle)),n}function Go(n={}){return xt(n.style)||(n.style=ln(n.style)),xt(n.state)||Object.keys(n.state).forEach(t=>{xt(n.state[t])||(n.state[t]=ln(n.state[t]))}),n}function ru(n){return xt(n)?null:(Object.keys(n).forEach(t=>{xt(n[t])||(n[t]=ln(n[t]))}),n)}function OAt(n){return Go(n),Go(n.startSymbol),Go(n.endSymbol),n}const DAt={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}},kp="PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol",Rp=14,Xm={LABEL_FONT_SIZE:14,AXIS_TICK_SIZE:4},u1={domainLine:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#EBEDF2",strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,tickSize:Xm.AXIS_TICK_SIZE,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,tickSize:Xm.AXIS_TICK_SIZE/2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},label:{visible:!0,space:1,style:{fontSize:Xm.LABEL_FONT_SIZE,fill:"#89909D",fontWeight:"normal",fillOpacity:1},autoLimit:!0},title:{space:10,style:{fontSize:Xm.LABEL_FONT_SIZE,fill:"#333333",fontWeight:"normal",fillOpacity:1}}};function FAt(n){var t,e;return!((e=(t=n==null?void 0:n.colorScheme)===null||t===void 0?void 0:t.default)===null||e===void 0)&&e.palette?Z({},u1,{tick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},subTick:{style:{stroke:n.colorScheme.default.palette.axisDomainColor||"#D9DDE4"}},label:{style:{fill:n.colorScheme.default.palette.axisLabelFontColor||"#89909D"}},title:{style:{fill:n.colorScheme.default.palette.secondaryFontColor||"#333333"}}}):u1}function iV(n){var t,e,i,r,s,o,a,l,h,d,u,c,g;const p=Z({},n);let f,m=(e=(t=p.title)===null||t===void 0?void 0:t.angle)!==null&&e!==void 0?e:0;p.orient!=="left"&&p.orient!=="right"||!((i=p.title)===null||i===void 0)&&i.autoRotate&&D(p.title.angle)&&(m=p.orient==="left"?-90:90,f=DAt[p.orient]);const v=Jl(p.label,["style","formatMethod","state"]);return{orient:p.orient,select:p.select,hover:p.hover,line:OAt(p.domainLine),label:Object.assign({style:ln(p.label.style),formatMethod:p.label.formatMethod?(_,b,y)=>p.label.formatMethod(b.rawValue,b):null,state:ru(p.label.state)},v),tick:{visible:p.tick.visible,length:p.tick.tickSize,inside:p.tick.inside,alignWithLabel:p.tick.alignWithLabel,style:ln(p.tick.style),state:ru(p.tick.state),dataFilter:p.tick.dataFilter},subTick:{visible:p.subTick.visible,length:p.subTick.tickSize,inside:p.subTick.inside,count:p.subTick.tickCount,style:ln(p.subTick.style),state:ru(p.subTick.state)},grid:{type:"line",visible:p.grid.visible,alternateColor:p.grid.alternateColor,alignWithLabel:p.grid.alignWithLabel,style:ln(p.grid.style)},subGrid:{type:"line",visible:p.subGrid.visible,alternateColor:p.subGrid.alternateColor,style:ln(p.subGrid.style)},title:{visible:p.title.visible,position:p.title.position,space:p.title.space,autoRotate:!1,angle:m?Te(m):null,textStyle:Z({},f,ln(p.title.style)),padding:p.title.padding,shape:{visible:(r=p.title.shape)===null||r===void 0?void 0:r.visible,space:(s=p.title.shape)===null||s===void 0?void 0:s.space,style:ln((o=p.title.shape)===null||o===void 0?void 0:o.style)},background:{visible:(a=p.title.background)===null||a===void 0?void 0:a.visible,style:ln((l=p.title.background)===null||l===void 0?void 0:l.style)},state:{text:ru(p.title.state),shape:ru((h=p.title.shape)===null||h===void 0?void 0:h.state),background:ru((d=p.title.background)===null||d===void 0?void 0:d.state)}},panel:{visible:(u=p.background)===null||u===void 0?void 0:u.visible,style:ln((c=p.background)===null||c===void 0?void 0:c.style),state:ru((g=p.background)===null||g===void 0?void 0:g.state)}}}function HAt(n,t,e){var i;const r=e.getRawChartSpec(n,t);if(r!=null&&r.series){const s={};return!((i=r.data)===null||i===void 0)&&i.id&&(s[r.data.id]=void 0),r==null||r.series.forEach(o=>{var a,l,h,d,u,c,g,p,f,m,v;if(!(!((a=o.data)===null||a===void 0)&&a.fromDataId))if(!((l=o.data)===null||l===void 0)&&l.transforms)s[(v=(f=(p=o.data)===null||p===void 0?void 0:p.id)!==null&&f!==void 0?f:(m=r.data)===null||m===void 0?void 0:m.id)!==null&&v!==void 0?v:"data"]=void 0;else{const _=o.direction==="horizontal"?o.xField:o.yField;s[(c=(d=(h=o.data)===null||h===void 0?void 0:h.id)!==null&&d!==void 0?d:(u=r.data)===null||u===void 0?void 0:u.id)!==null&&c!==void 0?c:"data"]=!((g=o.data)===null||g===void 0)&&g.id?_:void 0}}),s}return r.data.id}function zAt(n){let t=!1;for(let e=0;e<n.columnObjects.length;e++)if(n.columnObjects[e].chartSpec){t=!0;break}return t}function WAt(n,t,e){var i,r,s;if(n===-1||t===-1)return{start:{col:n,row:t},end:{col:n,row:t}};if(e._cellRangeMap.has(`$${n}$${t}`))return e._cellRangeMap.get(`$${n}$${t}`);let o={start:{col:n,row:t},end:{col:n,row:t}};if(e.transpose)o=NAt(n,t,e);else if(e.headerLevelCount<=t){if(e.headerLevelCount<=t&&(!((r=(i=e.columnObjects[n-e.leftRowSeriesNumberColumnCount])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const a=e._table.getCellValue(n,t);for(let l=t-1;l>=e.headerLevelCount;l--){const h=e._table.getCellValue(n,l);if(typeof e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell=="boolean"){if(a!==h)break}else if(!e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell(a,h,{source:{col:n,row:t},target:{col:n,row:l},table:e._table}))break;o.start.row=l}for(let l=t+1;l<e.rowCount;l++){const h=e._table.getCellValue(n,l);if(typeof e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell=="boolean"){if(a!==h)break}else if(!e.columnObjects[n-e.leftRowSeriesNumberColumnCount].define.mergeCell(a,h,{source:{col:n,row:t},target:{col:n,row:l},table:e._table}))break;o.end.row=l}}jAt(n,t,o,e)}else{const a=e.getCellId(n,t);for(let l=n-1;l>=0&&a===e.getCellId(l,t);l--)o.start.col=l;for(let l=n+1;l<((s=e.colCount)!==null&&s!==void 0?s:0)&&a===e.getCellId(l,t);l++)o.end.col=l;for(let l=t-1;l>=0&&a===e.getCellId(n,l);l--)o.start.row=l;for(let l=t+1;l<e.headerLevelCount&&a===e.getCellId(n,l);l++)o.end.row=l}return e._cellRangeMap.set(`$${n}$${t}`,o),o}function jAt(n,t,e,i){var r;if(i.rowHierarchyType!=="tree")return;const s=i._table.getCellRawRecord(n,t);!((r=i._table.internalProps.rowSeriesNumber)===null||r===void 0)&&r.enableTreeCheckbox?s!=null&&s.vtableMerge&&n>=i.leftRowSeriesNumberColumnCount&&(e.start.col=i.rowHeaderLevelCount+i.leftRowSeriesNumberColumnCount,e.end.col=i.colCount-1,e.start.row=e.end.row=t):s!=null&&s.vtableMerge&&(e.start.col=i.rowHeaderLevelCount,e.end.col=i.colCount-1,e.start.row=e.end.row=t)}function NAt(n,t,e){var i,r,s,o;const a={start:{col:n,row:t},end:{col:n,row:t}};if(e.headerLevelCount+e.leftRowSeriesNumberColumnCount<=n||n===-1&&t===-1){if(e.headerLevelCount+e.leftRowSeriesNumberColumnCount<=n&&(!((r=(i=e.columnObjects[t])===null||i===void 0?void 0:i.define)===null||r===void 0)&&r.mergeCell)){const h=e._table.getCellValue(n,t);for(let d=n-1;d>=e.headerLevelCount+e.leftRowSeriesNumberColumnCount;d--){const u=e._table.getCellValue(d,t);if(typeof e.columnObjects[t].define.mergeCell=="boolean"){if(h!==u)break}else if(!e.columnObjects[t].define.mergeCell(h,u,{source:{col:n,row:t},target:{col:d,row:t},table:e._table}))break;a.start.col=d}for(let d=n+1;d<((s=e.colCount)!==null&&s!==void 0?s:0);d++){const u=e._table.getCellValue(d,t);if(typeof e.columnObjects[t].define.mergeCell=="boolean"){if(h!==u)break}else if(!e.columnObjects[t].define.mergeCell(h,u,{source:{col:n,row:t},target:{col:d,row:t},table:e._table}))break;a.end.col=d}}return a}const l=e.getCellId(n,t);for(let h=t-1;h>=0&&l===e.getCellId(n,h);h--)a.start.row=h;for(let h=t+1;h<((o=e.rowCount)!==null&&o!==void 0?o:0)&&l===e.getCellId(n,h);h++)a.end.row=h;for(let h=n-1;h>=0&&l===e.getCellId(h,t);h--)a.start.col=h;for(let h=n+1;h<e.headerLevelCount+e.leftRowSeriesNumberColumnCount&&l===e.getCellId(h,t);h++)a.end.col=h;return a}class $At{constructor(t,e,i,r){var s,o;this.seqId=0,this.leftRowSeriesNumberColumnCount=0,this.rightRowSeriesNumberColumnCount=0,this.bodyRowSpanCount=1,this._transpose=!1,this._showHeader=!0,this._recordsCount=0,this._hasAggregation=!1,this._hasAggregationOnTopCount=0,this._hasAggregationOnBottomCount=0,this._cellRangeMap=new Map,this._showHeader=i,this._table=t,this._columns=[],this._columnsIncludeHided=[],this._headerCellIds=[],this.hierarchyIndent=r??20,this.hierarchyTextStartAlignment=t.options.hierarchyTextStartAlignment,this.columnHierarchyType=t.options.headerHierarchyType,this.columnExpandLevel=(s=t.options.headerExpandLevel)!==null&&s!==void 0?s:1,this.columnTree=new _1t(e,{seqId:0},(o=this.columnHierarchyType)!==null&&o!==void 0?o:null,this.columnHierarchyType==="grid-tree"?this.columnExpandLevel:void 0),this._headerObjectsIncludeHided=this._addHeaders(0,e,[]),this._headerObjects=this._headerObjectsIncludeHided.filter(a=>a.define.hide!==!0),this._headerObjectMap=this._headerObjects.reduce((a,l)=>(a[l.id]=l,a),{}),this.rowHierarchyType=S1t(this)?"tree":"grid",this._hasAggregation=b1t(this),this._hasAggregationOnBottomCount=C1t(this),this._hasAggregationOnTopCount=y1t(this),this.handleRowSeriesNumber(t.internalProps.rowSeriesNumber)}handleRowSeriesNumber(t){var e;t&&(Array.isArray(t)?this.rowSeriesNumberColumn=t.map((i,r)=>{var s,o;return{id:this.seqId++,title:i.title,define:Z({field:"_vtable_rowSeries_number_"+r},i),cellType:(s=i.cellType)!==null&&s!==void 0?s:"text",headerType:i.cellType==="checkbox"?"checkbox":"text",style:i.style,width:i.width,format:i.format,field:(o=i.field)!==null&&o!==void 0?o:"_vtable_rowSeries_number_"+r,icon:i.icon,headerIcon:i.headerIcon,isChildNode:!1}}):this.rowSeriesNumberColumn=[{id:this.seqId++,title:t.title,define:Z({field:"_vtable_rowSeries_number"},t),cellType:(e=t.cellType)!==null&&e!==void 0?e:"text",headerType:t.cellType==="checkbox"?"checkbox":"text",style:t.style,width:t.width,format:t.format,field:"_vtable_rowSeries_number",icon:t.icon,headerIcon:t.headerIcon,isChildNode:!1}],this.leftRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(i=>!0),this.rightRowSeriesNumberColumn=this.rowSeriesNumberColumn.filter(i=>!1),this.leftRowSeriesNumberColumnCount=this.leftRowSeriesNumberColumn.length,this.rightRowSeriesNumberColumnCount=this.rightRowSeriesNumberColumn.length)}get transpose(){return this._transpose}set transpose(t){this._transpose=t}get showHeader(){return this._showHeader}set showHeader(t){this._showHeader=t}isSeriesNumberInHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}if(this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return!1;if(e<this.headerLevelCount)return!0}return!1}isSeriesNumberInBody(t,e){return!!(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount&&(this.transpose||e>=this.headerLevelCount)||this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&(this.transpose||e>=this.headerLevelCount))}isSeriesNumber(t,e){return!!(L(t)&&L(e)&&(this.leftRowSeriesNumberColumnCount>0&&t>=0&&e>=0&&t<this.leftRowSeriesNumberColumnCount||this.rightRowSeriesNumberColumnCount>0&&e>=0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount))}getSeriesNumberHeader(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return;if(e<this.headerLevelCount)return Object.assign({},this.leftRowSeriesNumberColumn[t],{style:Object.assign({},this._table.transpose?this._table.internalProps.theme.rowHeaderStyle:this._table.internalProps.theme.headerStyle,this._table.internalProps.rowSeriesNumber.headerStyle)})}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount&&e<this.headerLevelCount){if(this.transpose)return;if(e<this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}getSeriesNumberBody(t,e){if(this.leftRowSeriesNumberColumnCount>0&&t>=0&&t<this.leftRowSeriesNumberColumnCount){if(this.transpose)return this.leftRowSeriesNumberColumn[t];if(e>=this.headerLevelCount)return this.leftRowSeriesNumberColumn[t]}if(this.rightRowSeriesNumberColumnCount>0&&t>=this.colCount-this.rightRowSeriesNumberColumnCount){if(this.transpose)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)];if(e>=this.headerLevelCount)return this.rightRowSeriesNumberColumn[t-(this.colCount-this.rightRowSeriesNumberColumnCount)]}}isHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)||!this.transpose&&e>=0&&e<this.headerLevelCount}isAggregation(t,e){if(this.hasAggregation){if(this.hasAggregationOnBottomCount){if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0}if(this.hasAggregationOnTopCount){if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}}return!1}isTopAggregation(t,e){if(this.hasAggregationOnTopCount){if(this.transpose){if(t>=this.rowHeaderLevelCount&&t<this.rowHeaderLevelCount+this.hasAggregationOnTopCount)return!0}else if(e>=this.columnHeaderLevelCount&&e<this.columnHeaderLevelCount+this.hasAggregationOnTopCount)return!0}return!1}isBottomAggregation(t,e){if(this.hasAggregationOnBottomCount){if(this.transpose){if(t>=this.colCount-this.hasAggregationOnBottomCount)return!0}else if(e>=this.rowCount-this.hasAggregationOnBottomCount)return!0}return!1}get hasAggregation(){return this._hasAggregation}get hasAggregationOnTopCount(){return this._hasAggregationOnTopCount}get hasAggregationOnBottomCount(){return this._hasAggregationOnBottomCount}getAggregatorsByCell(t,e){return this.getColumnDefine(t,e).vtable_aggregator}getAggregatorsByCellRange(t,e,i,r){let s=[];if(!this.transpose){for(let o=t;o<=i;o++){const a=this.getColumnDefine(o,e);a.vtable_aggregator&&(s=s.concat(Array.isArray(a.vtable_aggregator)?a.vtable_aggregator:[a.vtable_aggregator]))}return s}for(let o=e;o<=r;o++){const a=this.getColumnDefine(t,o);a.vtable_aggregator&&(s=s.concat(Array.isArray(a.vtable_aggregator)?a.vtable_aggregator:[a.vtable_aggregator]))}return[]}getAggregatorOnTop(t,e){const i=this.getColumnDefine(t,e),r=i.vtable_aggregator,s=i.aggregation;if(Array.isArray(s)){const o=s.reduce((a,l,h)=>(l.showOnTop&&a.push(h),a),[]).map(a=>r[a]);return this.transpose?o[t-this.rowHeaderLevelCount]:o[e-this.columnHeaderLevelCount]}return this.transpose&&t-this.rowHeaderLevelCount==0?s!=null&&s.showOnTop?r:null:this.transpose||e-this.columnHeaderLevelCount!=0?null:s!=null&&s.showOnTop?r:null}getAggregatorOnBottom(t,e){const i=this.getColumnDefine(t,e),r=i.vtable_aggregator,s=i.aggregation;if(Array.isArray(s)){const o=s.reduce((a,l,h)=>(l.showOnTop||a.push(h),a),[]).map(a=>r[a]);return this.transpose?o[t-(this.colCount-this.hasAggregationOnBottomCount)]:o[e-(this.rowCount-this.hasAggregationOnBottomCount)]}return this.transpose&&t-(this.colCount-this.hasAggregationOnBottomCount)==0?s!=null&&s.showOnTop?null:r:this.transpose||e-(this.rowCount-this.hasAggregationOnBottomCount)!=0||s!=null&&s.showOnTop?null:r}getAggregatorCellAddress(t,e,i,r){const s=[],o=this.hasAggregationOnTopCount,a=this.hasAggregationOnBottomCount;if(this.transpose){for(let l=e;l<=r;l++)if(this.getColumnDefine(t,l).vtable_aggregator){for(let h=0;h<o;h++)s.push({col:this.headerLevelCount+h,row:l});for(let h=0;h<a;h++)s.push({col:this.rowCount-a+h,row:l})}}else for(let l=t;l<=i;l++)if(this.getColumnDefine(l,e).vtable_aggregator){for(let h=0;h<o;h++)s.push({col:l,row:this.headerLevelCount+h});for(let h=0;h<a;h++)s.push({col:l,row:this.rowCount-a+h})}return s}getCellLocation(t,e){return this.isHeader(t,e)?this.transpose?"rowHeader":"columnHeader":"body"}isRowHeader(t,e){return!!(this.transpose&&t>=this.leftRowSeriesNumberColumnCount&&t<this.headerLevelCount+this.leftRowSeriesNumberColumnCount)}isColumnHeader(t,e){return!this.transpose&&e>=0&&e<=this.headerLevelCount-1&&t>=this.leftRowSeriesNumberColumnCount&&t<this.colCount-this.rightRowSeriesNumberColumnCount}isFrozenColumn(t,e){if(L(e)){if(t>=0&&t<this.frozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.frozenColCount>0&&t>=0&&t<this.frozenColCount)return!0;return!1}isRightFrozenColumn(t,e){if(L(e)){if(t>=this.colCount-this.rightFrozenColCount&&e>=this.frozenRowCount&&e<this.rowCount-this.bottomFrozenRowCount)return!0}else if(this.rightFrozenColCount>0&&t>=this.colCount-this.rightFrozenColCount)return!0;return!1}isFrozenRow(t,e){if(L(e)){if(e>=0&&e<this.frozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.frozenRowCount>0&&e>=0&&e<this.frozenRowCount)return!0;return!1}isBottomFrozenRow(t,e){if(L(e)){if(e>=this.rowCount-this.bottomFrozenRowCount&&t>=this.frozenColCount&&t<this.colCount-this.rightFrozenColCount)return!0}else if(e=t,this.bottomFrozenRowCount>0&&e>=this.rowCount-this.bottomFrozenRowCount)return!0;return!1}isLeftTopCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=0&&e<this.frozenRowCount}isLeftBottomCorner(t,e){return t>=0&&t<this.frozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isRightTopCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=0&&e<this.frozenRowCount}isRightBottomCorner(t,e){return t>=this.colCount-this.rightFrozenColCount&&e>=this.rowCount-this.bottomFrozenRowCount}isCornerHeader(t,e){return!1}getColumnHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((t=this.rowCount)!==null&&t!==void 0?t:0)-1}}:{start:{col:0,row:0},end:{col:((e=this.colCount)!==null&&e!==void 0?e:0)-1,row:this._headerCellIds.length-1}}}getRowHeaderRange(){var t,e;return this.transpose?{start:{col:0,row:0},end:{col:this._headerCellIds.length-1,row:((t=this.rowCount)!==null&&t!==void 0?t:0)-1}}:{start:{col:0,row:0},end:{col:((e=this.colCount)!==null&&e!==void 0?e:0)-1,row:this._headerCellIds.length-1}}}getCornerHeaderRange(){}getBodyRange(){var t,e,i,r;return this.transpose?{start:{col:this.headerLevelCount,row:0},end:{col:((t=this.colCount)!==null&&t!==void 0?t:0)-1,row:((e=this.rowCount)!==null&&e!==void 0?e:0)-1}}:{start:{col:0,row:this.headerLevelCount},end:{col:((i=this.colCount)!==null&&i!==void 0?i:0)-1,row:((r=this.rowCount)!==null&&r!==void 0?r:0)-1}}}get headerLevelCount(){return this.showHeader?this._headerCellIds.length:0}get columnHeaderLevelCount(){return this.transpose?0:this.headerLevelCount}get rowHeaderLevelCount(){return this.transpose?this.headerLevelCount:0}get frozenColCount(){return this._table.internalProps.frozenColCount?this.colCount>this._table.internalProps.frozenColCount?this._table.internalProps.frozenColCount:this.colCount:0}get frozenRowCount(){return this._table.internalProps.frozenRowCount?this.rowCount>=this._table.internalProps.frozenRowCount?this._table.internalProps.frozenRowCount:this.rowCount:0}get bottomFrozenRowCount(){return this._table.internalProps.bottomFrozenRowCount?this.rowCount-this.headerLevelCount>=this._table.internalProps.bottomFrozenRowCount?this._table.internalProps.bottomFrozenRowCount:this.rowCount-this.headerLevelCount:0}get rightFrozenColCount(){return this._table.internalProps.rightFrozenColCount?this.colCount-this.frozenColCount>=this._table.internalProps.rightFrozenColCount?this._table.internalProps.rightFrozenColCount:Math.max(0,this.colCount-this.frozenColCount):0}get colCount(){return this.transpose?this.headerLevelCount+this.recordsCount+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount:this._columns.length+this.leftRowSeriesNumberColumnCount+this.rightRowSeriesNumberColumnCount}get rowCount(){return this.transpose?this._columns.length:this.headerLevelCount+this.recordsCount}get bodyRowCount(){return this.transpose?this._columns.length:this.rowCount-this.bottomFrozenRowCount-this.headerLevelCount}get bodyColCount(){return this.transpose?this.colCount-this.rightFrozenColCount-this.rowHeaderLevelCount:this._columns.length}get recordsCount(){return this._recordsCount}set recordsCount(t){this._recordsCount=t}get headerObjects(){return this._headerObjects}get columnObjects(){return this._columns}get headerObjectsIncludeHided(){return this._headerObjectsIncludeHided}get columnWidths(){if(this.leftRowSeriesNumberColumnCount){const t=this.leftRowSeriesNumberColumn.map(e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth}));return t.push(...this._columns.map(e=>({width:e.width,minWidth:e.minWidth,maxWidth:e.maxWidth}))),t}return this._columns.map(t=>({width:t.width,minWidth:t.minWidth,maxWidth:t.maxWidth}))}getColumnWidthDefined(t){var e;if(t>=0){if(t<this.leftRowSeriesNumberColumnCount)return this.leftRowSeriesNumberColumn[t];if(this.transpose){let i,r,s=0;if(t>=this.rowHeaderLevelCount+this.leftRowSeriesNumberColumnCount){let o;return this.columnObjects.forEach((a,l)=>{typeof a.width=="number"?s=Math.max(a.width,s):a.width==="auto"&&(o=!0),typeof a.minWidth=="number"&&(r=Math.max(a.minWidth,r)),typeof a.maxWidth=="number"&&(i=Math.max(a.maxWidth,i))}),s=s>0?s:o?"auto":void 0,{width:s,minWidth:r,maxWidth:i}}if(this.isRowHeader(t,0)){const o=Array.isArray(this._table.defaultHeaderColWidth)?(e=this._table.defaultHeaderColWidth[t])!==null&&e!==void 0?e:this._table.defaultColWidth:this._table.defaultHeaderColWidth;return o==="auto"?{width:"auto"}:{width:o}}}return this._columns[t-this.leftRowSeriesNumberColumnCount]}}getCellId(t,e){var i,r,s,o;return this.transpose?t>=this.headerLevelCount+this.leftRowSeriesNumberColumnCount?(i=this._columns[e])===null||i===void 0?void 0:i.id:this.isSeriesNumber(t,e)?e+"_series_number":(r=this._headerCellIds[t-this.leftRowSeriesNumberColumnCount])===null||r===void 0?void 0:r[e]:this.isSeriesNumber(t,e)?this.rowSeriesNumberColumn[t].id:this.headerLevelCount<=e?(s=this._columns[t-this.leftRowSeriesNumberColumnCount])===null||s===void 0?void 0:s.id:(o=this._headerCellIds[e])===null||o===void 0?void 0:o[t-this.leftRowSeriesNumberColumnCount]}getHeader(t,e){if(this.isSeriesNumberInHeader(t,e))return this.getSeriesNumberHeader(t,e);const i=this.getCellId(t,e);return this._headerObjectMap[i]}getHeaderField(t,e){var i,r,s;if(this.isSeriesNumberInHeader(t,e))return(i=this.getSeriesNumberHeader(t,e))===null||i===void 0?void 0:i.field;if(this.isSeriesNumberInBody(t,e))return(r=this.getSeriesNumberBody(t,e))===null||r===void 0?void 0:r.field;const o=this.getCellId(t,e);return((s=this._headerObjectMap[o])===null||s===void 0?void 0:s.field)||(this.transpose?this._columns[e]&&this._columns[e].field:this._columns[t-this.leftRowSeriesNumberColumnCount]&&this._columns[t-this.leftRowSeriesNumberColumnCount].field)}getHeaderCellAdressById(t){for(let e=0;e<this._headerCellIds.length;e++){const i=this._headerCellIds[e];for(let r=0;r<i.length;r++)if(i[r]===t)return this.transpose?{col:e,row:r}:{col:r+this.leftRowSeriesNumberColumnCount,row:e}}}getHeaderCellAddressByField(t){const e=this.headerObjects.find(i=>i&&i.field===t);return e&&this.getHeaderCellAdressById(e.id)}getBody(t,e){return this.isSeriesNumber(t,e)?this.getSeriesNumberBody(t,e):this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]}getBodyLayoutRangeById(t){var e,i;if(this.transpose){for(let r=0;r<((e=this.rowCount)!==null&&e!==void 0?e:0);r++)if(t===this._columns[r].id)return{start:{col:0,row:r},end:{col:0,row:r}}}else for(let r=this.leftRowSeriesNumberColumnCount;r<((i=this.colCount)!==null&&i!==void 0?i:0);r++)if(t===this._columns[r-this.leftRowSeriesNumberColumnCount].id)return{start:{col:r,row:0},end:{col:r,row:0}};return{start:{col:-1,row:-1},end:{col:-1,row:-1}}}getCellRange(t,e){return WAt(t,e,this)}isCellRangeEqual(t,e,i,r){const s=this.getCellRange(t,e),o=this.getCellRange(i,r);return s.start.col===o.start.col&&s.end.col===o.end.col&&s.start.row===o.start.row&&s.end.row===o.end.row}getRecordShowIndexByCell(t,e){const i=this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount;return this.transpose?t<i?-1:t-i:e<i?-1:e-i}getRecordStartRowByRecordIndex(t){return(this.hasAggregationOnTopCount?this.headerLevelCount+1:this.headerLevelCount)+t}_addHeaders(t,e,i,r){const s=[],o=this._newRow(t,r);return e.forEach(a=>{var l,h,d,u;const c=this._columns.length,g=this.seqId++,p={id:g,title:(l=a.title)!==null&&l!==void 0?l:a.caption,headerIcon:a.headerIcon,field:a.field,style:a.headerStyle,headerType:(h=a.headerType)!==null&&h!==void 0?h:"text",dropDownMenu:a.dropDownMenu,define:a,hierarchyState:a.hierarchyState,columnWidthComputeMode:a.columnWidthComputeMode};s[g]=p;for(let m=t-1;m>=0;m--)this._headerCellIds[m]&&(this._headerCellIds[m][c]=i[m]);r?this._headerCellIds[t-1]&&(o[c]=this._headerCellIds[t-1][c]):o[c]=g;const f=!a.hierarchyState||a.hierarchyState===se.expand;if(a.columns&&f)!a.columns.every(m=>m.hide)&&this._addHeaders(t+1,a.columns,[...i,g],a.hideColumnsSubHeader||r).forEach(m=>s.push(m));else{const m={id:this.seqId++,field:a.field,fieldFormat:a.fieldFormat,width:a.width,minWidth:a.minWidth,maxWidth:a.maxWidth,icon:a.icon,cellType:(u=(d=a.cellType)!==null&&d!==void 0?d:a.columnType)!==null&&u!==void 0?u:"text",chartModule:"chartModule"in a?a.chartModule:null,chartSpec:"chartSpec"in a?a.chartSpec:null,sparklineSpec:"sparklineSpec"in a?a.sparklineSpec:B0t,style:a.style,define:a,columnWidthComputeMode:a.columnWidthComputeMode,disableColumnResize:a==null?void 0:a.disableColumnResize,aggregation:a.aggregation,isChildNode:t>=1};if(this._columnsIncludeHided.push(m),a.hide!==!0){this._columns.push(m);for(let v=t+1;v<this._headerCellIds.length;v++)this._headerCellIds[v][c]=g}}}),s}_newRow(t,e=!1){if(this._headerCellIds[t]){const s=this._headerCellIds[t-1];if(s.length>this._headerCellIds[t].length)for(let o=this._headerCellIds[t].length;o<s.length;o++)this._headerCellIds[t][o]=s[o];return this._headerCellIds[t]}if(e)return[];const i=this._headerCellIds[t]=[];if(!this._columns.length)return i;const r=this._headerCellIds[t-1];for(let s=0;s<r.length;s++)i[s]=r[s];return i}getCellHeaderPaths(t,e){if(this.isSeriesNumber(t,e))return;let i=[],r=[];return this.transpose?r=[{field:this._columns[e].field}]:i=[{field:this._columns[t-this.leftRowSeriesNumberColumnCount].field}],{colHeaderPaths:i,rowHeaderPaths:r,cellLocation:this.getCellLocation(t,e)}}getParentCellId(t,e){if(e!==0){if(this.isColumnHeader(t,e))return this.getCellId(t,e-1);if(this.isRowHeader(t,e))return this.isSeriesNumberInBody(t-1,e)?void 0:this.getCellId(t-1,e)}}canMoveHeaderPosition(t,e){if(this.isSeriesNumberInHeader(e.col,e.row)||this.isSeriesNumberInHeader(t.col,t.row))return!1;if(!this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)){const r=this.getRecordShowIndexByCell(0,t.row),s=this.getRecordShowIndexByCell(0,e.row);return this._table.dataSource.canChangeOrder(r,s)}if(this.transpose&&this.isSeriesNumberInBody(e.col,e.row)&&this.isSeriesNumberInBody(t.col,t.row)&&(this.getBody(t.col+this.leftRowSeriesNumberColumnCount,t.row).isChildNode&&this.getBody(e.col+this.leftRowSeriesNumberColumnCount,e.row).isChildNode?(t.col=t.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1,e.col=e.col+this.leftRowSeriesNumberColumnCount+this.rowHeaderLevelCount-1):(t.col=t.col+this.leftRowSeriesNumberColumnCount,e.col=e.col+this.leftRowSeriesNumberColumnCount)),t.col<0||t.row<0||e.col<0||e.row<0||this._table.internalProps.frozenColDragHeaderMode==="disabled"&&this._table.isFrozenColumn(e.col))return!1;const i=this.getCellRange(t.col,t.row);return this.isColumnHeader(t.col,t.row)?this.getParentCellId(t.col,i.start.row)===this.getParentCellId(e.col,i.start.row):this.isRowHeader(t.col,t.row)?this.getParentCellId(i.start.col,t.row)===this.getParentCellId(i.start.col,e.row):!1}moveHeaderPosition(t,e){var i,r;if((!(!((i=this._table.options.dragOrder)===null||i===void 0)&&i.validateDragOrderOnEnd)||!((r=this._table.options.dragOrder)===null||r===void 0)&&r.validateDragOrderOnEnd(t,e))&&this.canMoveHeaderPosition(t,e)){let s=this.getCellRange(t.col,t.row);if(this.isColumnHeader(t.col,t.row)){const o=s.end.col-s.start.col+1;let a;const l=this.getCellRange(e.col,s.start.row);if(a=e.col>=t.col?l.end.col-o+1:l.start.col,a===s.start.col)return null;for(let d=0;d<this._headerCellIds.length;d++){const u=this._headerCellIds[d].splice(s.start.col-this.leftRowSeriesNumberColumnCount,o);u.unshift(a-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._headerCellIds[d],u)}const h=this._columns.splice(s.start.col-this.leftRowSeriesNumberColumnCount,o);return h.unshift(a-this.leftRowSeriesNumberColumnCount,0),Array.prototype.splice.apply(this._columns,h),this.columnTree.movePosition(s.start.row,s.start.col-this.leftRowSeriesNumberColumnCount,a-this.leftRowSeriesNumberColumnCount),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:s.start.col,targetIndex:a,sourceSize:o,targetSize:l.end.col-l.start.col+1,moveType:"column"}}if(this.isRowHeader(t.col,t.row)||this.isSeriesNumberInBody(t.col,t.row)&&this.transpose){this.isSeriesNumberInBody(t.col,t.row)&&(s=this.getCellRange(t.col+this.leftRowSeriesNumberColumnCount,t.row));const o=s.end.row-s.start.row+1;let a;const l=this.getCellRange(s.start.col,e.row);if(a=e.row>=t.row?l.end.row-o+1:l.start.row,a===s.start.row)return null;for(let d=0;d<this._headerCellIds.length;d++){const u=this._headerCellIds[d].splice(s.start.row,o);u.unshift(a,0),Array.prototype.splice.apply(this._headerCellIds[d],u)}const h=this._columns.splice(s.start.row,o);return h.unshift(a,0),Array.prototype.splice.apply(this._columns,h),this.columnTree.movePosition(s.start.col-this.leftRowSeriesNumberColumnCount,s.start.row,a+(e.row>t.row?s.end.row-s.start.row:0)),this.columnTree.reset(this.columnTree.tree.children),this._cellRangeMap=new Map,{sourceIndex:s.start.row,targetIndex:a,sourceSize:o,targetSize:l.end.row-l.start.row+1,moveType:"row"}}if(this.isSeriesNumberInBody(t.col,t.row))return{sourceIndex:t.row,targetIndex:e.row,sourceSize:1,targetSize:1,moveType:"row"}}return null}toggleHierarchyState(t){return{addCellPositions:t.add.map(e=>({col:0,row:this._table.columnHeaderLevelCount+e})),removeCellPositions:t.remove.map(e=>({col:0,row:this._table.columnHeaderLevelCount+e}))}}setChartInstance(t,e,i){const r=this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount];typeof r.chartSpec!="function"&&(r.chartInstance=i)}getChartInstance(t,e){return(this.transpose?this._columns[e]:this._columns[t-this.leftRowSeriesNumberColumnCount]).chartInstance}checkHasChart(){return zAt(this)}getAxisConfigInPivotChart(t,e){}isEmpty(t,e){return!1}isAxisCell(t,e){return!1}getChartAxes(t,e){return[]}isShareChartSpec(t,e){const i=this.getBody(t,e);return typeof(i==null?void 0:i.chartSpec)!="function"}isNoChartDataRenderNothing(t,e){const i=this.getBody(t,e);return(i==null?void 0:i.define).noDataRenderNothing}getChartSpec(t,e){return this.getRawChartSpec(t,e)}getRawChartSpec(t,e){const i=this.getBody(t,e),r=i==null?void 0:i.chartSpec;return typeof r=="function"?r({col:t,row:e,dataValue:this._table.getCellOriginValue(t,e)||"",value:this._table.getCellValue(t,e)||"",rect:this._table.getCellRangeRelativeRect(this._table.getCellRange(t,e)),table:this._table}):r}getChartDataId(t,e){return HAt(t,e,this)}release(){const t=this._table._getActiveChartInstance();t==null||t.release(),this.columnObjects.forEach(e=>{var i;(i=e.chartInstance)===null||i===void 0||i.release()})}clearCellRangeMap(){this._cellRangeMap.clear()}updateColumnTitle(t,e,i){const r=this._table.internalProps.layoutMap.getHeader(t,e);r.title=i,r.define.title=i}getColumnByField(t){var e;return(e=this.columnObjects)===null||e===void 0?void 0:e.reduce((i,r,s)=>(r.field===t&&i.push({col:s,columnDefine:r}),i),[])}getColumnByKey(t){var e;let i;return{columnDefine:(e=this.columnObjects)===null||e===void 0?void 0:e.find((r,s)=>{var o;return((o=r.define)===null||o===void 0?void 0:o.key)===t&&(i=s+this.leftRowSeriesNumberColumnCount,!0)}),col:i}}getColumnDefine(t,e){if(t>=0)return t<this.leftRowSeriesNumberColumnCount?this.leftRowSeriesNumberColumn[t].define:this.transpose?this._columns[e].define:this._columns[t-this.leftRowSeriesNumberColumnCount].define}}class VAt{constructor(t){this.isValidatingValue=!1,this.listenersId=[],this.table=t,this.bindEvent()}bindEvent(){const t=this.table,e=t.on(mt.DBLCLICK_CELL,r=>{var s,o,a;const{editCellTrigger:l="doubleclick"}=t.options;if(!l.includes("doubleclick"))return;const{col:h,row:d}=r,u=In(r.federatedEvent),c=t.scenegraph.getResizeColAt(u.abstractPos.x,u.abstractPos.y,(s=u.eventArgs)===null||s===void 0?void 0:s.targetCell);t._canResizeColumn(c.col,c.row)&&c.col>=0||!((a=(o=r.target)===null||o===void 0?void 0:o.attribute)===null||a===void 0)&&a.funcType||(this.beginTriggerEditCellMode="doubleclick",this.startEditCell(h,d))}),i=t.on(mt.CLICK_CELL,r=>{var s,o;const{editCellTrigger:a="doubleclick"}=t.options;if(a==="click"||Array.isArray(a)&&a.includes("click")){if(!((o=(s=r.target)===null||s===void 0?void 0:s.attribute)===null||o===void 0)&&o.funcType)return;this.beginTriggerEditCellMode="click";const{col:l,row:h}=r;this.startEditCell(l,h)}});this.listenersId.push(e,i)}startEditCell(t,e,i){var r,s,o,a,l;if(this.editingEditor)return;const h=this.table.getEditor(t,e);if(h){if(!((s=(r=this.table.internalProps.layoutMap)===null||r===void 0?void 0:r.isAggregation)===null||s===void 0)&&s.call(r,t,e))return;const d=this.table.getCellRawRecord(t,e);if(d!=null&&d.vtableMerge)return;this.editingEditor||(this.editCell={col:t,row:e}),this.table._makeVisibleCell(t,e),this.editingEditor=h;const u=L(i)?i:this.table.getCellOriginValue(t,e),c=this.table.getCellRangeRelativeRect(this.table.getCellRange(t,e)),g={rect:{left:c.left,top:c.top,width:c.width,height:c.height}};t===this.table.colCount-1?g.rect.width=c.width-1:g.rect.width=c.width+1,e===this.table.rowCount-1?g.rect.height=c.height-1:g.rect.height=c.height+1,h.beginEditing,(o=h.beginEditing)===null||o===void 0||o.call(h,this.table.getElement(),g,u),h.bindSuccessCallback,(a=h.bindSuccessCallback)===null||a===void 0||a.call(h,()=>{this.completeEdit()}),(l=h.onStart)===null||l===void 0||l.call(h,{value:u,endEdit:()=>{this.completeEdit()},referencePosition:g,container:this.table.getElement(),col:t,row:e,table:this.table})}}completeEdit(t){var e,i;if(!this.editingEditor)return!0;if(this.isValidatingValue)return!1;const r=t==null?void 0:t.target,{editingEditor:s}=this;if(r){if(s.targetIsOnEditor){if(s.targetIsOnEditor(r))return!1}else if(!s.isEditorElement||s.isEditorElement(r))return!1}if(this.editingEditor.getValue,this.editingEditor.validateValue){this.isValidatingValue=!0;const o=this.editingEditor.getValue(),a=this.table.getCellOriginValue(this.editCell.col,this.editCell.row),l=(i=(e=this.editingEditor).validateValue)===null||i===void 0?void 0:i.call(e,o,a,this.editCell,this.table);return ua(l)?(this.isValidatingValue=!0,new Promise((h,d)=>{l.then(u=>{nV(u,this,a,h)}).catch(u=>{this.isValidatingValue=!1,d(u)})})):nV(l,this,a)}return this.doExit(),!0}doExit(){var t,e,i,r,s,o;const a=(e=(t=this.editingEditor).getValue)===null||e===void 0?void 0:e.call(t),l=this.table.getCellRange(this.editCell.col,this.editCell.row),h=[];for(let d=l.start.row;d<=l.end.row;d++){const u=[];for(let c=l.start.col;c<=l.end.col;c++)u.push(a);h.push(u)}this.table.changeCellValues(l.start.col,l.start.row,h),this.editingEditor.exit,(r=(i=this.editingEditor).exit)===null||r===void 0||r.call(i),(o=(s=this.editingEditor).onEnd)===null||o===void 0||o.call(s),this.editingEditor=null,this.isValidatingValue=!1,this.beginTriggerEditCellMode=null}cancelEdit(){var t,e,i,r;this.editingEditor&&((e=(t=this.editingEditor).exit)===null||e===void 0||e.call(t),(r=(i=this.editingEditor).onEnd)===null||r===void 0||r.call(i),this.editingEditor=null)}release(){this.listenersId.forEach(t=>{this.table.off(t)})}}function nV(n,t,e,i){return t.isValidatingValue=!1,n==="validate-exit"?(t.doExit(),i==null||i(!0),!0):n==="invalidate-exit"?(t.editingEditor.setValue(e),t.doExit(),i==null||i(!0),!0):n==="validate-not-exit"||n==="invalidate-not-exit"?(i==null||i(!1),!1):n===!0?(t.doExit(),i==null||i(!0),!0):(i==null||i(!1),!1)}function rV(n){return yt(n)?{groupByRules:[n]}:V(n)?{groupByRules:n.map(t=>yt(t)?t:t.key)}:{}}function GAt(n,t,e,i,r,s){if(i&&s.isHasEditorDefine(n,t)||i===!1){const o=s.getRecordShowIndexByCell(n,t),{field:a}=s.internalProps.layoutMap.getBody(n,t),l=s.getCellRawValue(n,t),h=s.getCellOriginValue(n,t);s.isHeader(n,t)?s.internalProps.layoutMap.updateColumnTitle(n,t,e):s.dataSource.changeFieldValue(e,o,a,n,t,s);const d=s.getCellRange(n,t),u=s.internalProps.layoutMap.getAggregatorsByCell(n,t);if(u){if(Array.isArray(u))for(let p=0;p<(u==null?void 0:u.length);p++)u[p].recalculate();else u.recalculate();const g=s.internalProps.layoutMap.getAggregatorCellAddress(d.start.col,d.start.row,d.end.col,d.end.row);for(let p=0;p<g.length;p++){const f=s.getCellRange(g[p].col,g[p].row);for(let m=f.start.col;m<=f.end.col;m++)for(let v=f.start.row;v<=f.end.row;v++)s.scenegraph.updateCellContent(m,v)}}for(let g=d.start.col;g<=d.end.col;g++)for(let p=d.start.row;p<=d.end.row;p++)s.scenegraph.updateCellContent(g,p);if(s.widthMode==="adaptive"||s.autoFillWidth&&s.getAllColsWidth()<=s.tableNoFrameWidth)s.internalProps._widthResizedColMap.size===0&&s.scenegraph.recalculateColWidths();else if(!s.internalProps._widthResizedColMap.has(n)){const g=s.getColWidth(n),p=Tp(n,0,s.rowCount-1,s,!1);p!==g&&s.scenegraph.updateColWidth(n,p-g)}if(s.heightMode==="adaptive"||s.autoFillHeight&&s.getAllRowsHeight()<=s.tableNoFrameHeight)s.internalProps._heightResizedRowMap.size===0&&s.scenegraph.recalculateRowHeights();else if(s.isAutoRowHeight(t)&&!s.internalProps._heightResizedRowMap.has(t)){const g=s.getRowHeight(t),p=no(t,0,s.colCount-1,s);s.scenegraph.updateRowHeight(t,p-g)}const c=s.getCellOriginValue(n,t);h!==c&&r&&s.fireListeners(mt.CHANGE_CELL_VALUE,{col:n,row:t,rawValue:l,currentValue:h,changedValue:c}),s.scenegraph.updateNextFrame()}}function UAt(n,t,e,i,r,s){var o,a;let l=n,h=t;const d=[],u=[];let c;for(let m=0;m<e.length&&!(t+m>s.rowCount-1);m++){const v=e[m],_=[],b=[];d.push(_),u.push(b);for(let y=0;y<v.length&&!(n+y>s.colCount-1);y++){c=YAt(n+y,t+m,s,c);const C=s.getCellRawValue(n+y,t+m);_.push(C);const S=s.getCellOriginValue(n+y,t+m);b.push(S)}}for(let m=0;m<e.length&&!(t+m>s.rowCount-1);m++){h=t+m;const v=e[m];let _=n;for(let b=0;b<v.length&&!(n+b>s.colCount-1);b++){_=n+b;let y=!1;if(i===!1)y=!0;else if(s.isHasEditorDefine(n+b,t+m)){const C=s.getEditor(n+b,t+m),S=u[m][b],w=v[b],x=(a=(o=C==null?void 0:C.validateValue)===null||o===void 0?void 0:o.call(C,w,S))===null||a===void 0||a;y=!!ua(x)||x===!0||x==="validate-exit"||x==="invalidate-exit"}if(y){const C=v[b],S=s.getRecordShowIndexByCell(n+b,t+m),{field:w}=s.internalProps.layoutMap.getBody(n+b,t+m),x=d[m][b],A=u[m][b];s.isHeader(n+b,t+m)?s.internalProps.layoutMap.updateColumnTitle(n+b,t+m,C):s.dataSource.changeFieldValue(C,S,w,n+b,t+m,s);const M=s.getCellOriginValue(n+b,t+m);A!==M&&r&&s.fireListeners(mt.CHANGE_CELL_VALUE,{col:n+b,row:t+m,rawValue:x,currentValue:A,changedValue:M})}}l=Math.max(l,_)}const g=s.getCellRange(n,t),p=s.getCellRange(l,h),f=s.internalProps.layoutMap.getAggregatorsByCellRange(g.start.col,g.start.row,p.end.col,p.end.row);if(f){for(let m=0;m<(f==null?void 0:f.length);m++)f[m].recalculate();if(c==="normal"){const m=s.internalProps.layoutMap.getAggregatorCellAddress(g.start.col,g.start.row,p.end.col,p.end.row);for(let v=0;v<m.length;v++){const _=s.getCellRange(m[v].col,m[v].row);for(let b=_.start.col;b<=_.end.col;b++)for(let y=_.start.row;y<=_.end.row;y++)s.scenegraph.updateCellContent(b,y)}}}if(c==="group"&&s.dataSource.updateRecordsForGroup([],[]),c==="sort"||c==="group")return s.dataSource.sortedIndexMap.clear(),as(s),s.refreshRowColCount(),s.internalProps.layoutMap.clearCellRangeMap(),s.scenegraph.clearCells(),void s.scenegraph.createSceneGraph();for(let m=g.start.col;m<=p.end.col;m++)for(let v=g.start.row;v<=p.end.row;v++)s.scenegraph.updateCellContent(m,v);if(s.widthMode==="adaptive"||s.autoFillWidth&&s.getAllColsWidth()<=s.tableNoFrameWidth)s.internalProps._widthResizedColMap.size===0&&s.scenegraph.recalculateColWidths();else for(let m=n;m<=p.end.col;m++)if(!s.internalProps._widthResizedColMap.has(m)){const v=s.getColWidth(m),_=Tp(m,0,s.rowCount-1,s,!1);_!==v&&s.scenegraph.updateColWidth(m,_-v)}if(s.heightMode==="adaptive"||s.autoFillHeight&&s.getAllRowsHeight()<=s.tableNoFrameHeight)s.scenegraph.recalculateRowHeights();else if(s.isAutoRowHeight(t)){const m=[],v=[];for(let _=t;_<=p.end.row;_++)if(s.rowHeightsMap.get(_)){const b=s.getRowHeight(_),y=no(_,0,s.colCount-1,s);m.push(_),v.push(y-b)}s.scenegraph.updateRowsHeight(m,v)}s.scenegraph.updateNextFrame()}function YAt(n,t,e,i){if(i==="group"||i==="sort"&&!e.options.groupBy)return i;let r="normal";return e.options.groupBy?r="group":!e.isHeader(n,t)&&e.dataSource.lastOrderField&&e.getBodyField(n,t)===e.dataSource.lastOrderField&&(r="sort"),r}function as(n){let t=n.sortState;t=!t||Array.isArray(t)?t:[t],t&&(t=t.map(e=>{var i;return e.orderFn=(i=n._getSortFuncFromHeaderOption(void 0,e.field))!==null&&i!==void 0?i:gx,e}),n.dataSource.sort(t))}function XAt(n,t,e){var i,r,s,o;if(e.options.groupBy)(r=(i=e.dataSource).addRecordsForGroup)===null||r===void 0||r.call(i,[n],t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&as(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.dataSource.rowHierarchyType==="tree")(o=(s=e.dataSource).addRecordsForTree)===null||o===void 0||o.call(s,[n],t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&as(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.addRecordForSorted(n),as(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{(t===void 0||t>e.dataSource.sourceLength)&&(t=e.dataSource.sourceLength);const a=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount;e.dataSource.addRecord(n,t);const l=e.rowCount;if(e.refreshRowColCount(),e.scenegraph.proxy.totalActualBodyRowCount===0)return e.scenegraph.clearCells(),void e.scenegraph.createSceneGraph();const h=e.transpose?e.colCount:e.rowCount;if(e.pagination){const{perPageCount:d,currentPage:u}=e.pagination,c=d*(u||0)+d;if(t<c)if(t<c-d)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const g=t-(c-d)+a;if(l-a===e.pagination.perPageCount){const p=[];for(let f=g;f<h;f++)e.transpose?p.push({col:f,row:0}):p.push({col:0,row:f});e.transpose?e.scenegraph.updateCol([],[],p):e.scenegraph.updateRow([],[],p)}else{const p=[];for(let f=g;f<Math.min(h,g+1);f++)e.transpose?p.push({col:f,row:0}):p.push({col:0,row:f});e.transpose?e.scenegraph.updateCol([],p,[]):e.scenegraph.updateRow([],p,[])}}}else{const d=[];for(let p=t+a;p<t+a+1;p++)e.transpose?d.push({col:p,row:0}):d.push({col:0,row:p});const u=[],c=e.internalProps.layoutMap.hasAggregationOnTopCount,g=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let p=a;p<a+c;p++)e.transpose?u.push({col:p,row:0}):u.push({col:0,row:p});for(let p=(e.transpose?e.colCount:e.rowCount)-g;p<(e.transpose?e.colCount:e.rowCount);p++)e.transpose?u.push({col:p,row:0}):u.push({col:0,row:p});e.transpose?e.scenegraph.updateCol([],d,[]):e.scenegraph.updateRow([],d,[])}}}function KAt(n,t,e){var i,r,s,o;if(e.options.groupBy)(r=(i=e.dataSource).addRecordsForGroup)===null||r===void 0||r.call(i,n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&as(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.dataSource.rowHierarchyType==="tree")(o=(s=e.dataSource).addRecordsForTree)===null||o===void 0||o.call(s,n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&as(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.addRecordsForSorted(n),as(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{t===void 0||t>e.dataSource.sourceLength?t=e.dataSource.sourceLength:t<0&&(t=0);const a=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount;e.dataSource.addRecords(n,t);const l=e.transpose?e.colCount:e.rowCount;if(e.refreshRowColCount(),e.scenegraph.proxy.totalActualBodyRowCount===0)return e.scenegraph.clearCells(),void e.scenegraph.createSceneGraph();const h=e.transpose?e.colCount:e.rowCount;if(e.pagination){const{perPageCount:d,currentPage:u}=e.pagination,c=d*(u||0)+d;if(t<c)if(t<c-d)e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const g=t-(c-d)+a;if(l-a===e.pagination.perPageCount){const p=[];for(let f=g;f<h;f++)e.transpose?p.push({col:f,row:0}):p.push({col:0,row:f});e.transpose?e.scenegraph.updateCol([],[],p):e.scenegraph.updateRow([],[],p)}else{const p=[];for(let f=g;f<Math.min(h,g+(Array.isArray(n)?n.length:1));f++)e.transpose?p.push({col:f,row:0}):p.push({col:0,row:f});e.transpose?e.scenegraph.updateCol([],p,[]):e.scenegraph.updateRow([],p,[])}}}else{const d=[];for(let p=t+a;p<t+a+(Array.isArray(n)?n.length:1);p++)e.transpose?d.push({col:p,row:0}):d.push({col:0,row:p});const u=e.internalProps.layoutMap.hasAggregationOnTopCount,c=e.internalProps.layoutMap.hasAggregationOnBottomCount,g=[];for(let p=a;p<a+u;p++)e.transpose?g.push({col:p,row:0}):g.push({col:0,row:p});for(let p=(e.transpose?e.colCount:e.rowCount)-c;p<(e.transpose?e.colCount:e.rowCount);p++)e.transpose?g.push({col:p,row:0}):g.push({col:0,row:p});e.transpose?e.scenegraph.updateCol([],d,g):e.scenegraph.updateRow([],d,g)}}}function qAt(n,t){var e,i,r,s,o,a,l,h;if((n==null?void 0:n.length)>0)if(t.options.groupBy)(i=(e=t.dataSource).deleteRecordsForGroup)===null||i===void 0||i.call(e,n),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&as(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.dataSource.rowHierarchyType==="tree")(s=(r=t.dataSource).deleteRecordsForTree)===null||s===void 0||s.call(r,n),t.refreshRowColCount(),t.internalProps.layoutMap.clearCellRangeMap(),t.sortState&&as(t),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else if(t.sortState)t.dataSource.deleteRecordsForSorted(n),as(t),t.refreshRowColCount(),t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{const d=t.dataSource.deleteRecords(n);if(d.length===0)return;const u=t.transpose?t.colCount:t.rowCount;t.refreshRowColCount();const c=t.transpose?t.colCount:t.rowCount,g=d.sort((f,m)=>f-m),p=g[0];if(t.pagination){const{perPageCount:f,currentPage:m}=t.pagination,v=f*(m||0)+f;if(p<v)if(p<v-f)t.scenegraph.clearCells(),t.scenegraph.createSceneGraph();else{const _=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,b=t.internalProps.layoutMap.hasAggregationOnTopCount,y=[],C=[];for(let S=p-(v-f)+(t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount)+b;S<c;S++)t.transpose?y.push({col:S,row:0}):y.push({col:0,row:S});for(let S=_;S<_+b;S++)t.transpose?y.push({col:S,row:0}):y.push({col:0,row:S});if(c<u)for(let S=c;S<u;S++)t.transpose?C.push({col:S,row:0}):C.push({col:0,row:S});(o=t.reactCustomLayout)===null||o===void 0||o.clearCache(),t.transpose?t.scenegraph.updateCol(C,[],y):t.scenegraph.updateRow(C,[],y),(a=t.reactCustomLayout)===null||a===void 0||a.updateAllCustomCell()}}else{const f=[],m=t.transpose?t.rowHeaderLevelCount:t.columnHeaderLevelCount,v=t.internalProps.layoutMap.hasAggregationOnTopCount,_=t.internalProps.layoutMap.hasAggregationOnBottomCount;for(let y=0;y<g.length;y++){const C=g[y]+m+v;t.transpose?f.push({col:C,row:0}):f.push({col:0,row:C})}const b=[];for(let y=m;y<m+v;y++)t.transpose?b.push({col:y,row:0}):b.push({col:0,row:y});for(let y=(t.transpose?t.colCount:t.rowCount)-_;y<(t.transpose?t.colCount:t.rowCount);y++)t.transpose?b.push({col:y,row:0}):b.push({col:0,row:y});(l=t.reactCustomLayout)===null||l===void 0||l.clearCache(),t.transpose?t.scenegraph.updateCol(f,[],b):t.scenegraph.updateRow(f,[],b),(h=t.reactCustomLayout)===null||h===void 0||h.updateAllCustomCell()}}}function ZAt(n,t,e){var i,r,s,o;if((t==null?void 0:t.length)>0)if(e.options.groupBy)(r=(i=e.dataSource).updateRecordsForGroup)===null||r===void 0||r.call(i,n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&as(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.dataSource.rowHierarchyType==="tree")(o=(s=e.dataSource).updateRecordsForTree)===null||o===void 0||o.call(s,n,t),e.refreshRowColCount(),e.internalProps.layoutMap.clearCellRangeMap(),e.sortState&&as(e),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else if(e.sortState)e.dataSource.updateRecordsForSorted(n,t),as(e),e.refreshRowColCount(),e.scenegraph.clearCells(),e.scenegraph.createSceneGraph();else{const a=e.dataSource.updateRecords(n,t);if(a.length===0)return;const l=a.map(h=>e.getBodyRowIndexByRecordIndex(h)).sort((h,d)=>h-d);if(e.pagination){const{perPageCount:h,currentPage:d}=e.pagination,u=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,c=e.internalProps.layoutMap.hasAggregationOnTopCount,g=h*(d||0)+h,p=[];for(let f=0;f<l.length;f++){const m=l[f];if(m<g&&m>=g-h){const v=m-(g-h)+(e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount)+c;p.push(v)}}if(p.length>=1){const f=[];for(let m=0;m<p.length;m++){const v=p[m];e.transpose?f.push({col:v,row:0}):f.push({col:0,row:v})}for(let m=u;m<u+c;m++)e.transpose?f.push({col:m,row:0}):f.push({col:0,row:m});e.transpose?e.scenegraph.updateCol([],[],f):e.scenegraph.updateRow([],[],f)}}else{const h=[],d=e.transpose?e.rowHeaderLevelCount:e.columnHeaderLevelCount,u=e.internalProps.layoutMap.hasAggregationOnTopCount,c=e.internalProps.layoutMap.hasAggregationOnBottomCount;for(let g=0;g<l.length;g++){const p=l[g]+d+u;e.transpose?h.push({col:p,row:0}):h.push({col:0,row:p})}for(let g=d;g<d+u;g++)e.transpose?h.push({col:g,row:0}):h.push({col:0,row:g});for(let g=(e.transpose?e.colCount:e.rowCount)-c;g<(e.transpose?e.colCount:e.rowCount);g++)e.transpose?h.push({col:g,row:0}):h.push({col:0,row:g});e.transpose?e.scenegraph.updateCol([],[],h):e.scenegraph.updateRow([],[],h)}}}function JAt(n,t,e,i){const r=[{col:t,row:e}],s=[],o=[],{addCellPositions:a,removeCellPositions:l}=n,h=i.scenegraph.proxy,{rowStart:d,rowLimit:u}=h;let{rowEnd:c}=h,g=1/0;for(let m=0;m<a.length;m++){const{row:v}=a[m];c-d+1===u?v>=d&&v<=c&&(g=Math.min(g,v)):(s.push({col:t,row:v}),c++)}const p=Math.min(d+u,i.rowCount-1-i.bottomFrozenRowCount),f=p<d+u;for(let m=0;m<l.length;m++){const{row:v}=l[l.length-m-1];v<d||v>c||(v>p||f?(o.push({col:t,row:v}),g--):g=Math.min(g,v))}if(g!==1/0)for(let m=g;m<=c;m++)r.push({col:t,row:m});return i.scenegraph.proxy.refreshRowCount(),{updateCells:r,addCells:s,removeCells:o}}class QAt extends G1t{constructor(t,e){var i,r,s,o,a,l,h,d;super(t,e),this.showHeader=!0,e=this.options;const u=this.internalProps;if(u.frozenColDragHeaderMode=(r=(i=e.dragOrder)===null||i===void 0?void 0:i.frozenColDragHeaderMode)!==null&&r!==void 0?r:e.frozenColDragHeaderMode,this.pagination=e.pagination,u.sortState=e.sortState,u.multipleSort=!!e.multipleSort,u.dataConfig=e.groupBy?rV(e.groupBy):{},u.columns=e.columns?Mg(e.columns,["children"]):e.header?Mg(e.header,["children"]):[],yy(this),u.enableTreeNodeMerge=(o=(s=e.enableTreeNodeMerge)!==null&&s!==void 0?s:L(e.groupBy))!==null&&o!==void 0&&o,this.internalProps.headerHelper.setTableColumnsEditor(),this.showHeader=(a=e.showHeader)===null||a===void 0||a,this.internalProps.columnWidthConfig=e.columnWidthConfig,this.transpose=(l=e.transpose)!==null&&l!==void 0&&l,We.mode!=="node"&&(this.editorManager=new VAt(this)),this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,e.dataSource?this.dataSource=e.dataSource:e.records?this.setRecords(e.records,{sortState:u.sortState}):this.setRecords([]),e.title){const c=Jt.getComponent("title");u.title=new c(e.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(h=this.internalProps.emptyTip)===null||h===void 0||h.resetVisible();else{const c=Jt.getComponent("emptyTip");this.internalProps.emptyTip=new c(this.options.emptyTip,this),(d=this.internalProps.emptyTip)===null||d===void 0||d.resetVisible()}if(e.enableTreeStickCell){const c=Jt.getComponent("listTreeStickCellPlugin");this.listTreeStickCellPlugin=new c(this)}setTimeout(()=>{this.fireListeners(mt.INITIALIZED,null)},0)}isListTable(){return!0}isPivotTable(){return!1}isPivotChart(){return!1}get sortState(){return this.internalProps.sortState}get records(){var t;return(t=this.dataSource)===null||t===void 0?void 0:t.records}get recordsCount(){return this.dataSource.records.length}updateColumns(t){var e,i,r,s;this.scenegraph.clearCells();const o={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};this.internalProps.columns=Mg(t,["children"]),yy(this),this.options.columns=t,this.internalProps.headerHelper.setTableColumnsEditor(),this._hasAutoImageColumn=void 0,this.refreshHeader(),(i=(e=this.dataSource).updateColumns)===null||i===void 0||i.call(e,this.internalProps.columns),this.records&&hyt(t)&&this.dataSource.processRecords((s=(r=this.dataSource.dataSourceObj)===null||r===void 0?void 0:r.records)!==null&&s!==void 0?s:this.dataSource.dataSourceObj),this.internalProps.useOneRowHeightFillAll=!1,this.headerStyleCache=new Map,this.bodyStyleCache=new Map,this.bodyBottomStyleCache=new Map,this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(o.col,o.row),this.renderAsync(),this.eventManager.updateEventBinder()}addColumn(t){const e=this.options.columns;e.push(t),this.updateColumns(e)}get columns(){return this.internalProps.layoutMap.columnTree.getCopiedTree()}get header(){return this.internalProps.columns}set header(t){this.internalProps.columns=t,yy(this),this.options.header=t,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.renderAsync()}get transpose(){var t;return(t=this.internalProps.transpose)!==null&&t!==void 0&&t}set transpose(t){this.internalProps.transpose!==t&&(this.internalProps.transpose=t,this.internalProps.layoutMap&&(this.internalProps.layoutMap.transpose=t,this.refreshRowColCount(),this._resetFrozenColCount(),this.renderAsync()))}getCellValue(t,e,i){if(t===-1||e===-1)return null;if(!i){const a=this.getCustomMergeValue(t,e);if(a)return a}const r=this;if(r.internalProps.layoutMap.isSeriesNumber(t,e)){if(r.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:h}=r.internalProps.layoutMap.getSeriesNumberHeader(t,e);return h}let a;if(this.options.groupBy){const h=r.getCellRawRecord(t,e);if(h!=null&&h.vtableMerge)return"";r.internalProps.layoutMap.isAggregation(t,e)||(a=this.dataSource.getGroupSeriesNumber(e-this.columnHeaderLevelCount))}else a=e-this.columnHeaderLevelCount+1;const{format:l}=r.internalProps.layoutMap.getSeriesNumberBody(t,e);return typeof l=="function"?l(t,e,this,a):a}if(r.internalProps.layoutMap.isHeader(t,e)){const{title:a}=r.internalProps.layoutMap.getHeader(t,e);return typeof a=="function"?a():a}if(r.internalProps.layoutMap.isAggregation(t,e)){if(r.internalProps.layoutMap.isTopAggregation(t,e)){const a=r.internalProps.layoutMap.getAggregatorOnTop(t,e);return a!=null&&a.formatValue?a.formatValue(t,e,this):""}if(r.internalProps.layoutMap.isBottomAggregation(t,e)){const a=r.internalProps.layoutMap.getAggregatorOnBottom(t,e);return a!=null&&a.formatValue?a.formatValue(t,e,this):""}}const{field:s,fieldFormat:o}=r.internalProps.layoutMap.getBody(t,e);return r.getFieldData(o||s,t,e)}getCellOriginValue(t,e){if(t===-1||e===-1)return null;const i=this;if(i.internalProps.layoutMap.isSeriesNumber(t,e)){if(i.internalProps.layoutMap.isSeriesNumberInHeader(t,e)){const{title:o}=i.internalProps.layoutMap.getSeriesNumberHeader(t,e);return o}const{format:s}=i.internalProps.layoutMap.getSeriesNumberBody(t,e);return typeof s=="function"?s(t,e,this):e-this.columnHeaderLevelCount}if(i.internalProps.layoutMap.isHeader(t,e)){const{title:s}=i.internalProps.layoutMap.getHeader(t,e);return typeof s=="function"?s():s}if(i.internalProps.layoutMap.isAggregation(t,e)){if(i.internalProps.layoutMap.isTopAggregation(t,e)){const s=i.internalProps.layoutMap.getAggregatorOnTop(t,e);return s==null?void 0:s.value()}if(i.internalProps.layoutMap.isBottomAggregation(t,e)){const s=i.internalProps.layoutMap.getAggregatorOnBottom(t,e);return s==null?void 0:s.value()}}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getFieldData(r,t,e)}getCellRawValue(t,e){if(t===-1||e===-1)return null;const i=this;if(i.internalProps.layoutMap.isHeader(t,e)){const{title:s}=i.internalProps.layoutMap.getHeader(t,e);return typeof s=="function"?s():s}const{field:r}=i.internalProps.layoutMap.getBody(t,e);return i.getRawFieldData(r,t,e)}getRecordShowIndexByCell(t,e){const{layoutMap:i}=this.internalProps;return i.getRecordShowIndexByCell(t,e)}getRecordIndexByCell(t,e){const{layoutMap:i}=this.internalProps,r=i.getRecordShowIndexByCell(t,e);return this.dataSource.getRecordIndexPaths(r)}getTableIndexByRecordIndex(t){return this.transpose?this.dataSource.getTableIndex(t)+this.rowHeaderLevelCount:this.dataSource.getTableIndex(t)+this.columnHeaderLevelCount}getTableIndexByField(t){const e=this.internalProps.layoutMap.columnObjects.find(r=>r.field===t);if(!e)return-1;const i=this.internalProps.layoutMap.getBodyLayoutRangeById(e.id);return this.transpose?i.start.row:i.start.col}getCellAddrByFieldRecord(t,e){return this.transpose?{col:this.getTableIndexByRecordIndex(e),row:this.getTableIndexByField(t)}:{col:this.getTableIndexByField(t),row:this.getTableIndexByRecordIndex(e)}}getCellOriginRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.get(r)}getCellRawRecord(t,e){const i=this,r=i.getRecordShowIndexByCell(t,e);if(r>-1)return i.dataSource.getRaw(r)}_canResizeColumn(t,e){const i=super._canResizeColumn(t,e);if(i&&!this.transpose){const r=this.internalProps.layoutMap.getBody(t,this.columnHeaderLevelCount),s=this.internalProps.layoutMap.isSeriesNumber(t,e);if(r!=null&&r.disableColumnResize||s&&this.internalProps.rowSeriesNumber.disableColumnResize===!0)return!1}return i}updateOption(t){var e,i,r,s,o,a,l,h,d;const u=this.internalProps;if(super.updateOption(t),u.frozenColDragHeaderMode=(i=(e=t.dragOrder)===null||e===void 0?void 0:e.frozenColDragHeaderMode)!==null&&i!==void 0?i:t.frozenColDragHeaderMode,this.pagination=t.pagination,u.sortState=t.sortState,u.dataConfig=t.groupBy?rV(t.groupBy):{},this.showHeader=(r=t.showHeader)===null||r===void 0||r,u.columns=t.columns?Mg(t.columns,["children"]):t.header?Mg(t.header,["children"]):[],yy(this),u.enableTreeNodeMerge=(o=(s=t.enableTreeNodeMerge)!==null&&s!==void 0?s:L(t.groupBy))!==null&&o!==void 0&&o,this.internalProps.headerHelper.setTableColumnsEditor(),this.transpose=(a=t.transpose)!==null&&a!==void 0&&a,this.refreshHeader(),this.internalProps.useOneRowHeightFillAll=!1,this.internalProps.columnWidthConfig=t.columnWidthConfig,u.releaseList)for(let c=u.releaseList.length-1;c>=0;c--){const g=u.releaseList[c];g instanceof Ul?g.updateColumns(this.internalProps.columns):((l=g==null?void 0:g.release)===null||l===void 0||l.call(g),u.releaseList.splice(c,1))}if(t.dataSource&&this.dataSource!==t.dataSource?this.dataSource=t.dataSource:t.records?this.setRecords(t.records,{sortState:t.sortState}):(this.refreshRowColCount(),this._resetFrozenColCount(),this.scenegraph.createSceneGraph(),this.render()),t.title){const c=Jt.getComponent("title");u.title=new c(t.title,this),this.scenegraph.resize()}if(this.options.emptyTip)if(this.internalProps.emptyTip)(h=this.internalProps.emptyTip)===null||h===void 0||h.resetVisible();else{const c=Jt.getComponent("emptyTip");this.internalProps.emptyTip=new c(this.options.emptyTip,this),(d=this.internalProps.emptyTip)===null||d===void 0||d.resetVisible()}return this.pluginManager.updatePlugins(t.plugins),new Promise(c=>{setTimeout(c,0)})}updatePagination(t){this.pagination&&(typeof t.currentPage=="number"&&t.currentPage>=0&&(this.pagination.currentPage=t.currentPage),t.perPageCount&&(this.pagination.perPageCount=t.perPageCount||this.pagination.perPageCount),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.clearCells(),this.dataSource.updatePagination(this.pagination),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph(),this.renderAsync())}refreshHeader(){var t;const e=this.internalProps,i=this.transpose,r=this.showHeader;(e.layoutMap=new $At(this,(t=e.columns)!==null&&t!==void 0?t:[],r,this.options.hierarchyIndent)).transpose=i,i||this.setMinMaxLimitWidth(!0),this.refreshRowColCount()}refreshRowColCount(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_;const b=this,{layoutMap:y}=b.internalProps;if(!y)return;const C=(e=(t=b.internalProps.dataSource)===null||t===void 0?void 0:t.length)!==null&&e!==void 0?e:0;y.recordsCount=C+(C>0||this.options.showAggregationWhenEmpty?y.hasAggregationOnTopCount+y.hasAggregationOnBottomCount:0),b.transpose?(b.rowCount=(i=y.rowCount)!==null&&i!==void 0?i:0,b.colCount=(r=y.colCount)!==null&&r!==void 0?r:0,this.internalProps.frozenColCount=Math.max(((s=y.headerLevelCount)!==null&&s!==void 0?s:0)+y.leftRowSeriesNumberColumnCount,(o=this.options.frozenColCount)!==null&&o!==void 0?o:0),this.internalProps.frozenRowCount=(a=this.options.frozenRowCount)!==null&&a!==void 0?a:0,b.bottomFrozenRowCount!==((l=this.options.bottomFrozenRowCount)!==null&&l!==void 0?l:0)&&(b.bottomFrozenRowCount=(h=this.options.bottomFrozenRowCount)!==null&&h!==void 0?h:0),b.rightFrozenColCount!==((d=this.options.rightFrozenColCount)!==null&&d!==void 0?d:0)&&(b.rightFrozenColCount=(u=this.options.rightFrozenColCount)!==null&&u!==void 0?u:0)):(b.colCount=(c=y.colCount)!==null&&c!==void 0?c:0,b.rowCount=y.recordsCount*y.bodyRowSpanCount+y.headerLevelCount,this.internalProps.frozenColCount=(g=this.options.frozenColCount)!==null&&g!==void 0?g:0,b.frozenRowCount=Math.max(y.headerLevelCount,(p=this.options.frozenRowCount)!==null&&p!==void 0?p:0),b.bottomFrozenRowCount!==((f=this.options.bottomFrozenRowCount)!==null&&f!==void 0?f:0)&&(b.bottomFrozenRowCount=(m=this.options.bottomFrozenRowCount)!==null&&m!==void 0?m:0),b.rightFrozenColCount!==((v=this.options.rightFrozenColCount)!==null&&v!==void 0?v:0)&&(b.rightFrozenColCount=(_=this.options.rightFrozenColCount)!==null&&_!==void 0?_:0)),this.stateManager.setFrozenCol(this.internalProps.frozenColCount)}getFieldData(t,e,i){if(t===null||this.internalProps.layoutMap.isHeader(e,i))return null;const r=this.getRecordShowIndexByCell(this.transpose?e-this.internalProps.layoutMap.leftRowSeriesNumberColumnCount:e,i);return this.internalProps.dataSource.getField(r,t,e,i,this)}getRawFieldData(t,e,i){if(t===null||this.internalProps.layoutMap.isHeader(e,i))return null;const r=this.getRecordShowIndexByCell(e,i);return this.internalProps.dataSource.getRawField(r,t,e,i,this)}_moveHeaderPosition(t,e){const i=this.getCellRange(t.col,t.row),r=this.getCellRange(e.col,e.row),s=this.internalProps.layoutMap.moveHeaderPosition(t,e);return s?(s.moveType==="column"?(this.colWidthsMap.exchangeOrder(i.start.col,i.end.col-i.start.col+1,r.start.col,r.end.col-r.start.col+1,s.targetIndex),this.transpose||(this.colWidthsLimit={},this.setMinMaxLimitWidth())):s.targetIndex>s.sourceIndex?this.rowHeightsMap.exchangeOrder(s.sourceIndex,s.sourceSize,s.targetIndex+s.sourceSize-s.targetSize,s.targetSize,s.targetIndex):this.rowHeightsMap.exchangeOrder(s.sourceIndex,s.sourceSize,s.targetIndex,s.targetSize,s.targetIndex),s):null}changeRecordOrder(t,e){this.transpose?(t=this.getRecordShowIndexByCell(t,0),e=this.getRecordShowIndexByCell(e,0)):(t=this.getRecordShowIndexByCell(0,t),e=this.getRecordShowIndexByCell(0,e)),this.dataSource.changeOrder(t,e)}getCellAddress(t,e){let i;for(let s=0;s<this.internalProps.records.length;s++){const o=this.internalProps.records[s];if(typeof t=="function")t(o)&&(i=s);else{let a=!0;for(const l in t)if(o[l]!==t[l]){a=!1;break}a&&(i=s)}if(L(i))break}const r=this.getCellRangeByField(e,i);if(r)return{row:r.start.row,col:r.start.col}}getCellRangeByField(t,e){const{layoutMap:i}=this.internalProps,r=i.columnObjects.find(s=>s.field===t);if(r){const s=i.getBodyLayoutRangeById(r.id);let o;return L(e)&&(o=i.getRecordStartRowByRecordIndex(e)),this.transpose?{start:{row:s.start.row,col:L(o)?o+s.start.col:void 0},end:{row:s.end.row,col:L(o)?o+s.end.col:void 0}}:{start:{col:s.start.col,row:L(o)?o+s.start.row:void 0},end:{col:s.end.col,row:L(o)?o+s.end.row:void 0}}}return null}getHierarchyState(t,e){var i;if(this.isHeader(t,e))return(i=this._getHeaderLayoutMap(t,e))===null||i===void 0?void 0:i.hierarchyState;if((!this.options.groupBy||V(this.options.groupBy)&&this.options.groupBy.length===0)&&!this.getBodyColumnDefine(t,e).tree)return se.none;const r=this.getRecordShowIndexByCell(t,e);return this.dataSource.getHierarchyState(r)}toggleHierarchyState(t,e,i=!0){this.stateManager.updateHoverIcon(t,e,void 0,void 0);const r=this.getHierarchyState(t,e);if(this.isHeader(t,e)){const s=this.internalProps.layoutMap.getHeader(t,e),{hierarchyState:o,define:a}=s;if(![se.collapse,se.expand].includes(o)||!a)return;const l=a.columns;if(Array.isArray(l)&&l.length>0){const h=o===se.expand?se.collapse:se.expand;s.hierarchyState=h,s.define.hierarchyState=h,this.updateColumns(this.internalProps.columns)}this.fireListeners(mt.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:r,originData:s,cellLocation:this.getCellLocation(t,e)})}else if(r===se.expand)this._refreshHierarchyState(t,e,i),this.fireListeners(mt.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:se.collapse});else if(r===se.collapse){const s=this.getCellOriginRecord(t,e);Array.isArray(s.children)&&this._refreshHierarchyState(t,e,i),this.fireListeners(mt.TREE_HIERARCHY_STATE_CHANGE,{col:t,row:e,hierarchyState:se.expand,originData:s})}}setLoadingHierarchyState(t,e){this.scenegraph.setLoadingHierarchyState(t,e)}_refreshHierarchyState(t,e,i=!0){var r,s;let o=!1,a=!1;const l=this.internalProps.layoutMap.checkHasChart();l&&(this.autoFillWidth&&(o=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&(a=this.getAllRowsHeight()<=this.tableNoFrameHeight));const h=this.getRecordShowIndexByCell(t,e),d=this.dataSource.toggleHierarchyState(h,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount,Math.max(this.scenegraph.proxy.rowEnd-this.columnHeaderLevelCount,this.scenegraph.proxy.rowStart-this.columnHeaderLevelCount+this.scenegraph.proxy.rowLimit-1)),u=this.internalProps.layoutMap.toggleHierarchyState(d);this.refreshRowColCount();for(let f=this.rowCount-this.bottomFrozenRowCount;f<this.rowCount;f++){const m=no(f,0,this.colCount-1,this);this._setRowHeight(f,m)}this.clearCellStyleCache(),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1;const{updateCells:c,addCells:g,removeCells:p}=JAt(u,t,e,this);(r=this.reactCustomLayout)===null||r===void 0||r.clearCache(),this.scenegraph.updateRow(p,g,c,i,!0),(s=this.reactCustomLayout)===null||s===void 0||s.updateAllCustomCell(),l&&(this.autoFillWidth&&!o&&(o=this.getAllColsWidth()<=this.tableNoFrameWidth),this.autoFillHeight&&!a&&(a=this.getAllRowsHeight()<=this.tableNoFrameHeight),(this.widthMode==="adaptive"||o||this.heightMode==="adaptive"||a)&&this.scenegraph.updateChartSizeForResizeColWidth(-1))}_hasHierarchyTreeHeader(){var t,e;return(e=(t=this.options.columns)!==null&&t!==void 0?t:this.options.header)===null||e===void 0?void 0:e.some((i,r)=>i.tree)}getMenuInfo(t,e,i){return{field:this.getHeaderField(t,e),value:this.getCellValue(t,e),cellLocation:this.getCellLocation(t,e),event:void 0}}_getSortFuncFromHeaderOption(t,e,i){if(t||(t=this.internalProps.columns),e&&t&&t.length>0)for(let r=0;r<t.length;r++){const s=t[r];if((i&&i===s.fieldKey||!i&&s.field===e)&&s.sort&&typeof s.sort=="function")return s.sort;if(s.columns){const o=this._getSortFuncFromHeaderOption(s.columns,e,i);if(o)return o}}}updateSortState(t,e=!0){var i;if(t)this.internalProps.sortState=t;else if(this.internalProps.sortState)if(Array.isArray(this.internalProps.sortState))for(let r=0;r<this.internalProps.sortState.length;r++)(t=(i=this.internalProps.sortState)===null||i===void 0?void 0:i[r])&&(t.order="normal");else this.internalProps.sortState.order="normal",t=this.internalProps.sortState;(t=Array.isArray(t)?t:[t]).some(r=>r.field)&&e&&this.internalProps.layoutMap.headerObjects.some(r=>r.define.sort!==!1)&&(this.dataSource.sort(t.map(r=>{const s=this._getSortFuncFromHeaderOption(this.internalProps.columns,r.field);return this.internalProps.layoutMap.headerObjects.find(o=>o&&o.field===r.field),{field:r.field,order:r.order,orderFn:s??gx}})),this.internalProps.layoutMap.clearCellRangeMap(),this.internalProps.useOneRowHeightFillAll=!1,this.scenegraph.sortCell()),t.length&&this.stateManager.updateSortState(t)}updateFilterRules(t){this.scenegraph.clearCells(),this.sortState?(this.dataSource.updateFilterRulesForSorted(t),as(this)):this.dataSource.updateFilterRules(t),this.refreshRowColCount(),this.stateManager.initCheckedState(this.records),this.scenegraph.createSceneGraph()}getCheckboxState(t){if(this.stateManager.checkedState.size<this.rowCount-this.columnHeaderLevelCount&&this.stateManager.initLeftRecordsCheckState(this.records),L(t)){let e=Array.from(this.stateManager.checkedState.keys()).sort((i,r)=>{var s,o;const a=i.split(","),l=r.split(","),h=Math.max(a.length,l.length);for(let d=0;d<h;d++){const u=(s=Number(a[d]))!==null&&s!==void 0?s:0,c=(o=Number(l[d]))!==null&&o!==void 0?o:0;if(u!==c)return u-c}return 0}).map(i=>this.stateManager.checkedState.get(i));return this.options.groupBy&&(e=_xt(this)),Array.from(e,i=>i&&i[t])}return new Array(...this.stateManager.checkedState.values())}getCellCheckboxState(t,e){var i;const r=this.getBodyColumnDefine(t,e),s=r==null?void 0:r.field,o=this.getCellType(t,e);if(L(s)&&(o==="checkbox"||o==="switch")){const a=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)).toString();return(i=this.stateManager.checkedState.get(a))===null||i===void 0?void 0:i[s]}}getRadioState(t){return L(t)?this.stateManager.radioState[t]:this.stateManager.radioState}getCellRadioState(t,e){return oxt(t,e,this)}setCellCheckboxState(t,e,i){mxt(t,e,i,this)}setCellRadioState(t,e,i){lxt(t,e,i,this)}getSwitchState(t){return this.getCheckboxState(t)}getCellSwitchState(t,e){return this.getCellCheckboxState(t,e)}setCellSwitchState(t,e,i){this.setCellCheckboxState(t,e,i)}setRecords(t,e){var i,r,s,o;let a;dL(),(i=this.internalProps.dataSource)===null||i===void 0||i.release(),this.internalProps.releaseList=(r=this.internalProps.releaseList)===null||r===void 0?void 0:r.filter(h=>!h.dataSourceObj),this.internalProps.dataSource=null,Array.isArray(e)||e!=null&&e.order?a=e:e?a=e.sortState:e===null&&(a=null),typeof window<"u"&&window.performance.now();const l={col:this.stateManager.hover.cellPos.col,row:this.stateManager.hover.cellPos.row};if(this.scenegraph.clearCells(),a!==void 0&&(a===null||!Array.isArray(a)&&L(a.field)||Array.isArray(a))&&(this.internalProps.sortState=this.internalProps.multipleSort?Array.isArray(a)?a:[a]:a,this.stateManager.setSortState(this.sortState)),t){if(dN(this,t),this.sortState){const h=Array.isArray(this.sortState)?this.sortState:[this.sortState];h.some(d=>d.order&&d.field&&d.order!=="normal")&&this.internalProps.layoutMap.headerObjectsIncludeHided.some(d=>d.define.sort!==!1)&&this.dataSource.sort(h.map(d=>{const u=this._getSortFuncFromHeaderOption(void 0,d.field);return this.internalProps.layoutMap.headerObjectsIncludeHided.find(c=>c&&c.field===d.field),{field:d.field,order:d.order||"asc",orderFn:u??gx}}))}this.refreshRowColCount()}else dN(this,t);if(this.stateManager.initCheckedState(t),this.clearCellStyleCache(),this.scenegraph.createSceneGraph(),this.stateManager.updateHoverPos(l.col,l.row),this.internalProps.title&&!this.internalProps.title.isReleased&&(this._updateSize(),this.internalProps.title.resize(),this.scenegraph.resize()),this.options.emptyTip)if(this.internalProps.emptyTip)(s=this.internalProps.emptyTip)===null||s===void 0||s.resetVisible();else{const h=Jt.getComponent("emptyTip");this.internalProps.emptyTip=new h(this.options.emptyTip,this),(o=this.internalProps.emptyTip)===null||o===void 0||o.resetVisible()}this.render(),L(l.col)&&L(l.row)&&l.col>=0&&l.row>=0&&setTimeout(()=>{var h;(h=this.internalProps)===null||h===void 0||h.tooltipHandler.showTooltip(l.col,l.row)},0)}setRecordChildren(t,e,i,r=!0){const s=this.getCellOriginRecord(e,i);s.children=t;const o=this.getRecordShowIndexByCell(e,i);this.dataSource.setRecord(s,o),this._refreshHierarchyState(e,i,r)}startEditCell(t,e,i){var r;if(L(t)&&L(e))this.eventManager.isDraging=!1,this.selectCell(t,e),this.editorManager.startEditCell(t,e,i);else if(!((r=this.stateManager.select)===null||r===void 0)&&r.cellPos){const{col:s,row:o}=this.stateManager.select.cellPos;L(s)&&L(o)&&this.editorManager.startEditCell(s,o,i)}}completeEditCell(){this.editorManager.completeEdit()}getEditor(t,e){var i,r;const s=this.getBodyColumnDefine(t,e);let o=this.isHeader(t,e)?(i=s==null?void 0:s.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=s==null?void 0:s.editor)!==null&&r!==void 0?r:this.options.editor;return typeof o=="function"&&(o=o({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),typeof o=="string"?K1t(o):o}isHasEditorDefine(t,e){var i,r;const s=this.getBodyColumnDefine(t,e);let o=this.isHeader(t,e)?(i=s==null?void 0:s.headerEditor)!==null&&i!==void 0?i:this.options.headerEditor:(r=s==null?void 0:s.editor)!==null&&r!==void 0?r:this.options.editor;return typeof o=="function"&&(o=o({col:t,row:e,dataValue:this.getCellOriginValue(t,e),value:this.getCellValue(t,e)||"",table:this})),L(o)}changeCellValue(t,e,i,r=!1,s=!0){return GAt(t,e,i,r,s,this)}changeCellValues(t,e,i,r=!1,s=!0){return UAt(t,e,i,r,s,this)}addRecord(t,e){var i;XAt(t,e,this),(i=this.internalProps.emptyTip)===null||i===void 0||i.resetVisible()}addRecords(t,e){var i;KAt(t,e,this),(i=this.internalProps.emptyTip)===null||i===void 0||i.resetVisible()}deleteRecords(t){var e;qAt(t,this),(e=this.internalProps.emptyTip)===null||e===void 0||e.resetVisible()}updateRecords(t,e){ZAt(t,e,this)}_hasCustomRenderOrLayout(){var t,e,i,r;const{headerObjects:s}=this.internalProps.layoutMap;if(this.options.customRender)return!0;for(let o=0;o<s.length;o++){const a=s[o];if(!((t=a==null?void 0:a.define)===null||t===void 0)&&t.customLayout||!((e=a==null?void 0:a.define)===null||e===void 0)&&e.headerCustomLayout||!((i=a==null?void 0:a.define)===null||i===void 0)&&i.customRender||!((r=a==null?void 0:a.define)===null||r===void 0)&&r.headerCustomRender)return!0}return!1}getAggregateValuesByField(t){const e=this.internalProps.layoutMap.getColumnByField(t),i=[];for(let r=0;r<e.length;r++){const s=e[r].columnDefine.aggregator;if(delete e[r].columnDefine,s){const o={col:e[r].col,aggregateValue:null};if(o.aggregateValue=[],Array.isArray(s))for(let a=0;a<s.length;a++)o.aggregateValue.push({aggregationType:s[a].type,value:s[a].value()});else o.aggregateValue.push({aggregationType:s.type,value:s.value()});i.push(o)}}return i}isAggregation(t,e){return this.internalProps.layoutMap.isAggregation(t,e)}getGroupTitleLevel(t,e){var i;if(!this.options.groupBy)return;const r=this.dataSource.getIndexKey(this.getRecordShowIndexByCell(t,e)),s=(i=this.dataSource.getGroupLength())!==null&&i!==void 0?i:0;let o=V(r)?r.length-1:0;return s>0&&o===s&&(o=void 0),o}getBodyRowIndexByRecordIndex(t){return Array.isArray(t)&&t.length===1&&(t=t[0]),this.dataSource.getTableIndex(t)}_parseColumnWidthConfig(t){for(let e=0;e<(t==null?void 0:t.length);e++){const i=t[e],r=i.key,s=i.width,o=this.internalProps.layoutMap.getColumnByKey(r);if(o.columnDefine){const{col:a}=o;this.internalProps._widthResizedColMap.has(a)||(this._setColWidth(a,s),this.internalProps._widthResizedColMap.add(a))}}}release(){this.editorManager.release(),super.release()}}function EL(n){return n==="bottom"||n==="top"}function tMt(n){return n==="left"||n==="right"}const nJ=(n,t)=>Object.prototype.toString.call(n)===`[object ${t}]`,eMt=n=>typeof n=="function",ir=n=>n==null,bn=n=>n!=null,rJ=n=>Array.isArray?Array.isArray(n):nJ(n,"Array"),eo=(n,t=!1)=>{const e=typeof n;return t?e==="number":e==="number"||nJ(n,"Number")};function iMt(n){if(!n)return[];if(Object.keys)return Object.keys(n);const t=[];for(const e in n)n.hasOwnProperty(e)&&t.push(e);return t}function nMt(n,t,e){const i=iMt(t);for(let r=0;r<i.length;r++){const s=i[r];(e?t[s]!=null:n[s]==null)&&(n[s]=t[s])}return n}function sJ(n,t,e=!0){if(n="prototype"in n?n.prototype:n,t="prototype"in t?t.prototype:t,Object.getOwnPropertyNames){const i=Object.getOwnPropertyNames(t);for(let r=0;r<i.length;r++){const s=i[r];s!=="constructor"&&(e?t[s]!=null:n[s]==null)&&(n[s]=t[s])}}else nMt(n,t,e)}function rMt(n,t,e){bn(t)||(t=n,n=0),bn(e)||(e=1);let i=-1;const r=0|Math.max(0,Math.ceil((t-n)/e)),s=new Array(r);for(;++i<r;)s[i]=n+i*e;return s}function sMt(n,t){return n<t?-1:n>t?1:n>=t?0:NaN}function Km(n){return Number(n)}function oMt(n,t,e=0,i){for(ir(i)&&(i=n.length);e<i;){const r=e+i>>>1;sMt(n[r],t)>0?i=r:e=r+1}return e}const aMt=1e-10,lMt=1e-10;function oJ(n,t,e=lMt,i=aMt){const r=i,s=e*Math.max(n,t);return Math.abs(n-t)<=Math.max(r,s)}function sV(n,t,e,i){return n>t&&!oJ(n,t,e,i)}function oV(n,t,e,i){return n<t&&!oJ(n,t,e,i)}const lb=n=>{let t=null,e=null;return(...i)=>(t&&i.every((r,s)=>r===t[s])||(t=i,e=n(...i)),e)},aJ=function(n,t,e){return n<t?t:n>e?e:n};function MD(n,t){let e;return n>t&&(e=n,n=t,t=e),i=>Math.max(n,Math.min(t,i))}function RC(n,t){return e=>n*(1-e)+t*e}function hMt(n,t){return function(e){return Math.round(n*(1-e)+t*e)}}function dMt(n,t){const e=n.valueOf(),i=t.valueOf(),r=new Date;return s=>(r.setTime(e*(1-s)+i*s),r)}function LL(n,t,e){t/=100,e/=100;const i=(1-Math.abs(2*e-1))*t,r=i*(1-Math.abs(n/60%2-1)),s=e-i/2;let o=0,a=0,l=0;return 0<=n&&n<60?(o=i,a=r,l=0):60<=n&&n<120?(o=r,a=i,l=0):120<=n&&n<180?(o=0,a=i,l=r):180<=n&&n<240?(o=0,a=r,l=i):240<=n&&n<300?(o=r,a=0,l=i):300<=n&&n<360&&(o=i,a=0,l=r),o=Math.round(255*(o+s)),a=Math.round(255*(a+s)),l=Math.round(255*(l+s)),{r:o,g:a,b:l}}function TD(n,t,e){n/=255,t/=255,e/=255;const i=Math.min(n,t,e),r=Math.max(n,t,e),s=r-i;let o=0,a=0,l=0;return o=s===0?0:r===n?(t-e)/s%6:r===t?(e-n)/s+2:(n-t)/s+4,o=Math.round(60*o),o<0&&(o+=360),l=(r+i)/2,a=s===0?0:s/(1-Math.abs(2*l-1)),a=+(100*a).toFixed(1),l=+(100*l).toFixed(1),{h:o,s:a,l}}const uMt=/^#([0-9a-f]{3,8})$/,aV={transparent:4294967040},BC={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Iy(n){return((n=Math.max(0,Math.min(255,Math.round(n)||0)))<16?"0":"")+n.toString(16)}function lJ(n){return eo(n)?new Dr(n>>16,n>>8&255,255&n,1):rJ(n)?new Dr(n[0],n[1],n[2]):new Dr(255,255,255)}function cMt(n){return eo(n)?new Dr(n>>>24,n>>>16&255,n>>>8&255,255&n):rJ(n)?new Dr(n[0],n[1],n[2],n[3]):new Dr(255,255,255,1)}function gB(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function pB(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}const lV=(n,t)=>{const e=uMt.exec(n);if(t||e){const i=parseInt(e[1],16),r=e[1].length;return r===3?new Dr((i>>8&15)+((i>>8&15)<<4),(i>>4&15)+((i>>4&15)<<4),(15&i)+((15&i)<<4),1):r===6?lJ(i):r===8?new Dr(i>>24&255,i>>16&255,i>>8&255,(255&i)/255):null}};class No{static Brighter(t,e=1){return e===1?t:new No(t).brighter(e).toRGBA()}static SetOpacity(t,e=1){return e===1?t:new No(t).setOpacity(e).toRGBA()}static getColorBrightness(t,e="hsl"){const i=t instanceof No?t:new No(t);switch(e){case"hsv":default:return i.getHSVBrightness();case"hsl":return i.getHSLBrightness();case"lum":return i.getLuminance();case"lum2":return i.getLuminance2();case"lum3":return i.getLuminance3()}}static parseColorString(t){if(bn(aV[t]))return cMt(aV[t]);if(bn(BC[t]))return lJ(BC[t]);const e=`${t}`.trim().toLowerCase(),i=lV(e);if(i!==void 0)return i;if(/^(rgb|RGB|rgba|RGBA)/.test(e)){const r=e.replace(/(?:\(|\)|rgba|RGBA|rgb|RGB)*/g,"").split(",");return new Dr(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10),parseFloat(r[3]))}if(/^(hsl|HSL|hsla|HSLA)/.test(e)){const r=e.replace(/(?:\(|\)|hsla|HSLA|hsl|HSL)*/g,"").split(","),s=LL(parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10));return new Dr(s.r,s.g,s.b,parseFloat(r[3]))}}constructor(t){const e=No.parseColorString(t);e?this.color=e:(console.warn(`Warn: ${t}Color`),this.color=new Dr(255,255,255))}toRGBA(){return this.color.formatRgb()}toString(){return this.color.formatRgb()}toHex(){return this.color.formatHex()}toHsl(){return this.color.formatHsl()}brighter(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t))),this}add(t){const{r:e,g:i,b:r}=this.color;return this.color.r+=Math.min(255,e+t.color.r),this.color.g+=Math.min(255,i+t.color.g),this.color.b+=Math.min(255,r+t.color.b),this}sub(t){return this.color.r=Math.max(0,this.color.r-t.color.r),this.color.g=Math.max(0,this.color.g-t.color.g),this.color.b=Math.max(0,this.color.b-t.color.b),this}multiply(t){const{r:e,g:i,b:r}=this.color;return this.color.r=Math.max(0,Math.min(255,Math.floor(e*t.color.r))),this.color.g=Math.max(0,Math.min(255,Math.floor(i*t.color.g))),this.color.b=Math.max(0,Math.min(255,Math.floor(r*t.color.b))),this}getHSVBrightness(){return Math.max(this.color.r,this.color.g,this.color.b)/255}getHSLBrightness(){return .5*(Math.max(this.color.r,this.color.g,this.color.b)/255+Math.min(this.color.r,this.color.g,this.color.b)/255)}setHsl(t,e,i){const r=this.color.opacity,s=TD(this.color.r,this.color.g,this.color.b),o=LL(ir(t)?s.h:aJ(t,0,360),ir(e)?s.s:e>=0&&e<=1?100*e:e,ir(i)?s.l:i<=1&&i>=0?100*i:i);return this.color=new Dr(o.r,o.g,o.b,r),this}setRGB(t,e,i){return!ir(t)&&(this.color.r=t),!ir(e)&&(this.color.g=e),!ir(i)&&(this.color.b=i),this}setHex(t){const e=`${t}`.trim().toLowerCase(),i=lV(e,!0);return i??this}setColorName(t){const e=BC[t.toLowerCase()];return e!==void 0?this.setHex(e):console.warn("THREE.Color: Unknown color "+t),this}setScalar(t){return this.color.r=t,this.color.g=t,this.color.b=t,this}setOpacity(t=1){return this.color.opacity=t,this}getLuminance(){return(.2126*this.color.r+.7152*this.color.g+.0722*this.color.b)/255}getLuminance2(){return(.2627*this.color.r+.678*this.color.g+.0593*this.color.b)/255}getLuminance3(){return(.299*this.color.r+.587*this.color.g+.114*this.color.b)/255}clone(){return new No(this.color.toString())}copyGammaToLinear(t,e=2){return this.color.r=Math.pow(t.color.r,e),this.color.g=Math.pow(t.color.g,e),this.color.b=Math.pow(t.color.b,e),this}copyLinearToGamma(t,e=2){const i=e>0?1/e:1;return this.color.r=Math.pow(t.color.r,i),this.color.g=Math.pow(t.color.g,i),this.color.b=Math.pow(t.color.b,i),this}convertGammaToLinear(t){return this.copyGammaToLinear(this,t),this}convertLinearToGamma(t){return this.copyLinearToGamma(this,t),this}copySRGBToLinear(t){return this.color.r=gB(t.color.r),this.color.g=gB(t.color.g),this.color.b=gB(t.color.b),this}copyLinearToSRGB(t){return this.color.r=pB(t.color.r),this.color.g=pB(t.color.g),this.color.b=pB(t.color.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}}class Dr{constructor(t,e,i,r){this.r=isNaN(+t)?255:Math.max(0,Math.min(255,+t)),this.g=isNaN(+e)?255:Math.max(0,Math.min(255,+e)),this.b=isNaN(+i)?255:Math.max(0,Math.min(255,+i)),bn(r)?this.opacity=isNaN(+r)?1:Math.max(0,Math.min(1,+r)):this.opacity=1}formatHex(){return`#${Iy(this.r)+Iy(this.g)+Iy(this.b)+(this.opacity===1?"":Iy(255*this.opacity))}`}formatRgb(){const t=this.opacity;return`${t===1?"rgb(":"rgba("}${this.r},${this.g},${this.b}${t===1?")":`,${t})`}`}formatHsl(){const t=this.opacity,{h:e,s:i,l:r}=TD(this.r,this.g,this.b);return`${t===1?"hsl(":"hsla("}${e},${i}%,${r}%${t===1?")":`,${t})`}`}toString(){return this.formatHex()}}function gMt(n){let t="",e="",i="";const r=n[0]==="#"?1:0;for(let s=r;s<n.length;s++)n[s]!=="#"&&(s<r+2?t+=n[s]:s<r+4?e+=n[s]:s<r+6&&(i+=n[s]));return[parseInt(t,16),parseInt(e,16),parseInt(i,16)]}function pMt(n,t,e){return Number((1<<24)+(n<<16)+(t<<8)+e).toString(16).slice(1)}function fMt(n,t){const e=n.r,i=t.r,r=n.g,s=t.g,o=n.b,a=t.b,l=n.opacity,h=t.opacity;return d=>{const u=Math.round(e*(1-d)+i*d),c=Math.round(r*(1-d)+s*d),g=Math.round(o*(1-d)+a*d);return new Dr(u,c,g,l*(1-d)+h*d)}}const mMt=Object.freeze(Object.defineProperty({__proto__:null,Color:No,DEFAULT_COLORS:BC,RGB:Dr,hexToRgb:gMt,hslToRgb:LL,interpolateRgb:fMt,rgbToHex:pMt,rgbToHsl:TD},Symbol.toStringTag,{value:"Module"}));var eh;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(eh||(eh={}));Object.values(eh).forEach(n=>{});function Tg(n){return n}const vMt=n=>-Math.log(-n),_Mt=n=>-Math.exp(-n),bMt=n=>isFinite(n)?Math.pow(10,n):n<0?0:n,hV=n=>n===10?bMt:n===Math.E?Math.exp:t=>Math.pow(n,t),dV=n=>n===Math.E?Math.log:n===10?Math.log10:n===2?Math.log2:(n=Math.log(n),t=>Math.log(t)/n),uV=n=>t=>Math.sign(t)*Math.log1p(Math.abs(t/n)),cV=n=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*n;function IL(n,t){if(n=Number(n),t=Number(t),t-=n)return i=>(i-n)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function gV(n,t,e){const i=n[0],r=n[1],s=t[0],o=t[1];let a,l;return r<i?(a=IL(r,i),l=e(o,s)):(a=IL(i,r),l=e(s,o)),h=>l(a(h))}function kD(n,t,e){let i;return i=n===1?n+2*e:n-t+2*e,n?i>0?i:1:0}function yMt(n,t,e,i){return e===1&&(e=0),kD(n,e,i)*(t/(1-e))}function CMt(n,t,e,i,r){const s=kD(n,e,i);let o=t/Math.max(1,s||1);r&&(o=Math.floor(o));let a=o*(1-e);return r&&(a=Math.round(a)),a}function hJ(n,t){const e=(n[1]-n[0])/(t[1]-t[0]),i=n[0]-e*t[0];return[i,e+i]}function SMt(n,t,e){const i=Math.min(n.length,t.length)-1,r=new Array(i),s=new Array(i);let o=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=IL(n[o],n[o+1]),s[o]=e(t[o],t[o+1]);return function(a){const l=oMt(n,a,1,i)-1;return s[l](r[l](a))}}const xMt=(n,t)=>{const e=n.slice();let i=0,r=e.length-1,s=e[i],o=e[r];return o<s&&([i,r]=[r,i],[s,o]=[o,s]),e[i]=t.floor(s),e[r]=t.ceil(o),e},dJ=(n,t=!1)=>{const e=Math.floor(Math.log10(n)),i=n/Math.pow(10,e);let r;return r=t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,r*Math.pow(10,e)},wMt=(n,t)=>{let e,i;return t[0]<t[1]?(e=t[0],i=t[1]):(e=t[1],i=t[0]),Math.min(Math.max(n,e),i)};let uJ=class{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=hJ(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every(r=>r>=0&&r<=1)&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return ir(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!ir(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return ir(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!ir(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,s=this.range(),o=s[0],a=s[s.length-1],l=Math.min(o,a),h=Math.max(o,a),d=aJ((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),u=ir(r)?(h-l)*i:r;let c=Math.exp(e);c=c/(c-1)*u;const g=e/u;this._fishEyeTransform=p=>{const f=Math.abs(p-d);if(f>=u)return p;if(f<=1e-6)return d;const m=c*(1-Math.exp(-f*g))/f*.75+.25;return d+(p-d)*m}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return(i=this==null?void 0:this[t])!==null&&i!==void 0?i:e}};const OL=Symbol("implicit");let AMt=class cJ extends uJ{specified(t){var e;return t?(this._specified=Object.assign((e=this._specified)!==null&&e!==void 0?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=eh.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=OL}clone(){const t=new cJ().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==OL)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const s=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(s):s}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const i=`${e}`;this._index.has(i)||this._index.set(i,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&(e=this._index.get(`${t}`))!==null&&e!==void 0?e:-1}};function gJ(n,t,e,i){const r=[];let s=n;for(;s<=t;)r.push(s),s+=e;return i&&r.reverse(),r}function pV(n,t,e,i){let r,s;if(t=Math.floor(+t),n=Math.floor(+n),!(e=Math.floor(+e)))return[];if(n===t)return[n];if(r=t<n){const a=n;n=t,t=a}let o=MD(1,t-n+1)(e);if(s=Math.floor((t-n+1)/o),!i)for(;Math.ceil((t-n+1)/s)>e&&o>1;)o-=1,s=Math.floor((t-n)/o);return gJ(n,t,s,r)}function MMt(n,t,e){let i;if(t=Math.floor(+t),n=Math.floor(+n),e=MD(1,t-n+1)(Math.floor(+e)),i=t<n){const r=n;n=t,t=r}return gJ(n,t,e,i)}let pJ=class fJ extends AMt{constructor(t){super(),this.type=eh.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),r=super.domain().length,s=i[1]<i[0];let o=i[Number(s)-0];const a=i[1-Number(s)],l=kD(r,this._paddingInner,this._paddingOuter);return this._step=(a-o)/Math.max(1,l||1),this._round&&(this._step=Math.floor(this._step)),o+=(a-o-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(o=Math.round(o),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:s,start:s?o+this._step*(r-1):o,count:r},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==OL)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const{count:s,start:o,reverse:a}=this._bandRangeState,l=o+(a?-1:1)*((r-1)%s)*this._step;return this._fishEyeTransform?this._fishEyeTransform(l):l}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let i;if(bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)&&t.length===2){const s=hJ(t,[this._rangeFactorStart,this._rangeFactorEnd]);i=Math.abs(s[1]-s[0])}else i=Math.abs(t[1]-t[0]);const r=CMt(super.domain().length,i,this._paddingInner,this._paddingOuter,this._round);r<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):r>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=r,this._isFixed=!1)}if(this.isBandwidthFixed()){const i=yMt(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(t[1]-t[0]),r=Math.min((t[1]-t[0])/i,1);if(bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)){if(i>0){const a=t[0]-i*this._rangeFactorStart,l=a+i;this._wholeRange=[a,l]}else{const a=t[1]+i*(1-this._rangeFactorEnd),l=a-i;this._wholeRange=[l,a]}const s=this._rangeFactorStart+r<=1,o=this._rangeFactorEnd-r>=0;e==="rangeFactorStart"&&s?this._rangeFactorEnd=this._rangeFactorStart+r:e==="rangeFactorEnd"&&o?this._rangeFactorStart=this._rangeFactorEnd-r:t[0]<=t[1]?s?this._rangeFactorEnd=this._rangeFactorStart+r:o?this._rangeFactorStart=this._rangeFactorEnd-r:(this._rangeFactorStart=0,this._rangeFactorEnd=r):o?this._rangeFactorStart=this._rangeFactorEnd-r:s?this._rangeFactorEnd=this._rangeFactorStart+r:(this._rangeFactorStart=1-r,this._rangeFactorEnd=1)}else this._rangeFactorStart=0,this._rangeFactorEnd=r,this._wholeRange=[t[0],t[0]+i];return this._wholeRange}return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),r=this._getInvertIndex(t[1]);return e.slice(Math.min(i,r),Math.max(i,r)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[Km(t[0]),Km(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[Km(t[0]),Km(t[1])],this._round=!0,this.rescale(e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return t===-1?e:pV(0,e.length-1,t,!1).map(i=>e[i])}tickData(t=10){return this.ticks(t).map((e,i)=>({index:i,tick:e,value:(this.scale(e)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])}))}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return pV(0,e.length-1,t,!0).filter(i=>i<e.length).map(i=>e[i])}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return MMt(0,e.length-1,t).map(i=>e[i])}_getInvertIndex(t){let e=0;const i=this.step()/2,r=this.bandwidth()/2,s=this._domain.length,o=this.range(),a=o[0]>o[o.length-1];for(e=0;e<s;e++){const l=this.scale(this._domain[e])+r;if(e===0&&(!a&&!sV(t,l+i)||a&&!oV(t,l-i))||e===s-1||!oV(t,l-i)&&!sV(t,l+i))break}return e>=0&&e<=s-1?e:s-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return t!==void 0?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return t!==void 0?(this._round=t,this.rescale(e)):this._round}align(t,e){return t!==void 0?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return ir(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return ir(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?(t==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&eo(this._userBandwidth)}clone(){var t,e,i;return new fJ(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((t=this._userBandwidth)!==null&&t!==void 0?t:"auto",!0).maxBandwidth((e=this._maxBandwidth)!==null&&e!==void 0?e:"auto",!0).minBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto")}};const{interpolateRgb:fB}=mMt;function TMt(n,t){const e=typeof t;let i;if(ir(t)||e==="boolean")return()=>t;if(e==="number")return RC(n,t);if(e==="string"){if(i=No.parseColorString(t)){const r=fB(No.parseColorString(n),i);return s=>r(s).formatRgb()}return RC(Number(n),Number(t))}return t instanceof Dr?fB(n,t):t instanceof No?fB(n.color,t.color):t instanceof Date?dMt(n,t):RC(Number(n),Number(t))}let mJ=class extends uJ{constructor(t=Tg,e=Tg){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Tg,this._piecewise=gV,this._interpolate=TMt}calculateVisibleDomain(t){var e;return bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),RC)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,Km);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=hMt,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,r=i.length,s=this._range.length;let o=Math.min(r,s);if(r&&r<s&&this._forceAlign){const a=s-r+1,l=i[r-1],h=r>=2?(l-i[r-2])/a:0;for(let d=1;d<=a;d++)i[r-2+d]=l-h*(a-d);o=s}return this._autoClamp&&(this._clamp=MD(i[0],i[o-1])),this._piecewise=o>2?SMt:gV,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Tg),this.rescale(i)):this._clamp!==Tg}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(e??[]).map((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return ir(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return ir(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}};const kMt=Math.sqrt(50),RMt=Math.sqrt(10),BMt=Math.sqrt(2),Oy=[1,2,5,10],fV=(n,t,e)=>{let i=1,r=n;const s=Math.floor((t-1)/2),o=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(t-1):!e&&o<1?i=vJ(o).step:(e||o>1)&&(r=Math.floor(n)-s*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(t-1)*i)),rMt(0,t).map(a=>r+a*i)):n>0?c1(0,-(t-1)/i,i):c1((t-1)/i,0,i)},PMt=lb((n,t,e,i)=>{let r,s,o,a,l=-1;if(e=+e,(n=+n)==(t=+t))return[n];if(Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return[n];if((r=t<n)&&(s=n,n=t,t=s),a=RD(n,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(n/a),d=Math.round(t/a);for(h*a<n&&++h,d*a>t&&--d,o=new Array(s=d-h+1);++l<s;)o[l]=(h+l)*a}else if(a<0&&(i!=null&&i.noDecimals)){a=1;const h=Math.ceil(n),d=Math.floor(t);if(!(h<=d))return[];for(o=new Array(s=d-h+1);++l<s;)o[l]=h+l}else{a=-a;let h=Math.round(n*a),d=Math.round(t*a);for(h/a<n&&++h,d/a>t&&--d,o=new Array(s=d-h+1);++l<s;)o[l]=(h+l)/a}return r&&o.reverse(),o}),c1=(n,t,e)=>{let i,r,s=-1;if(e>0){let o=Math.floor(n/e),a=Math.ceil(t/e);for((o+1)*e<n&&++o,(a-1)*e>t&&--a,r=new Array(i=a-o+1);++s<i;)r[s]=(o+s)*e}else{e=-e;let o=Math.floor(n*e),a=Math.ceil(t*e);for((o+1)/e<n&&++o,(a-1)/e>t&&--a,r=new Array(i=a-o+1);++s<i;)r[s]=(o+s)/e}return r},EMt=(n,t,e)=>{let i;const r=n[0],s=n[n.length-1],o=t-n.length;if(s<=0){const h=[];for(i=o;i>=1;i--)h.push(r-i*e);return h.concat(n)}if(r>=0){for(i=1;i<=o;i++)n.push(s+i*e);return n}let a=[];const l=[];for(i=1;i<=o;i++)i%2==0?a=[r-Math.floor(i/2)*e].concat(a):l.push(s+Math.ceil(i/2)*e);return a.concat(n).concat(l)},g1=lb((n,t,e,i)=>{let r,s,o;if(e=+e,(n=+n)==(t=+t)||Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return fV(n,e,i==null?void 0:i.noDecimals);(r=t<n)&&(o=n,n=t,t=o);const a=RD(n,t,e);let l=a.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:d,gap:u}=a,c=u===10?2*10**d:1*10**d;for(;h<=5&&(s=c1(n,t,l),s.length>e+1)&&e>2;)l+=c,h+=1;e>2&&s.length<e-1&&(s=EMt(s,e,l))}else i!=null&&i.noDecimals&&l<0&&(l=1),s=c1(n,t,l);return r&&s.reverse(),s}),vJ=n=>{const t=Math.floor(Math.log(n)/Math.LN10),e=n/10**t;let i=Oy[0];return e>=kMt?i=Oy[3]:e>=RMt?i=Oy[2]:e>=BMt&&(i=Oy[1]),t>=0?{step:i*10**t,gap:i,power:t}:{step:-(10**-t)/i,gap:i,power:t}};function RD(n,t,e){const i=(t-n)/Math.max(0,e);return vJ(i)}function _J(n,t,e){let i;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if(e<=0||(i=LMt(n,t,e))===0||!isFinite(i))return[];const r=new Array(e);for(let s=0;s<e;s++)r[s]=n+s*i;return r}function LMt(n,t,e){return(t-n)/Math.max(1,e-1)}function IMt(n,t,e){let i,r,s=-1;if(e=+e,(r=(t=+t)<(n=+n))&&(i=n,n=t,t=i),!isFinite(e)||t-n<=e)return[n];const o=Math.floor((t-n)/e+1),a=new Array(o);for(;++s<o;)a[s]=n+s*e;return r&&a.reverse(),a}function mB(n,t=10){let e,i,r=0,s=n.length-1,o=n[r],a=n[s],l=10;for(a<o&&(i=o,o=a,a=i,i=r,r=s,s=i);l-- >0;){if(i=RD(o,a,t).step,i===e)return n[r]=o,n[s]=a,n;if(i>0)o=Math.floor(o/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;o=Math.ceil(o*i)/i,a=Math.floor(a*i)/i}e=i}}function bJ(n,t){const e=eo(t.forceMin),i=eo(t.forceMax);let r=null;const s=[];let o=null;const a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?s[0]=t.forceMin:eo(t.min)&&t.min<=Math.min(n[0],n[n.length-1])&&(s[0]=t.min),i?s[1]=t.forceMax:eo(t.max)&&t.max>=Math.max(n[0],n[n.length-1])&&(s[1]=t.max),eo(s[0])&&eo(s[1])?(o=n.slice(),o[0]=s[0],o[o.length-1]=s[1]):r=eo(s[0])||eo(s[1])?eo(s[0])?"max":"min":"all",{niceType:r,niceDomain:o,niceMinMax:s,domainValidator:a}}const vB=(n,t,e)=>Math.abs(t-n)<1?+e.toFixed(1):Math.round(+e),yJ=lb((n,t,e,i,r,s,o)=>{let a=n,l=t;const h=l<a;h&&([a,l]=[l,a]);let d,u,c=r(a),g=r(l),p=[];if(!(i%1)&&g-c<e){if(c=Math.floor(c),g=Math.ceil(g),a>0){for(;c<=g;++c)for(d=1;d<i;++d)if(u=c<0?d/s(-c):d*s(c),!(u<a)){if(u>l)break;p.push(u)}}else for(;c<=g;++c)for(d=i-1;d>=1;--d)if(u=c>0?d/s(-c):d*s(c),!(u<a)){if(u>l)break;p.push(u)}2*p.length<e&&(p=g1(a,l,e))}else p=g1(c,g,Math.min(g-c,e)).map(s);return p=p.filter(f=>f!==0),o!=null&&o.noDecimals&&(p=Array.from(new Set(p.map(f=>Math.floor(f))))),h?p.reverse():p}),CJ=lb((n,t,e,i,r,s)=>{const o=[],a={},l=r(n),h=r(t);let d=[];if(Number.isInteger(i))d=g1(l,h,e);else{const u=(h-l)/(e-1);for(let c=0;c<e;c++)d.push(l+c*u)}return d.forEach(u=>{const c=s(u),g=Number.isInteger(i)?vB(n,t,c):vB(n,t,dJ(c)),p=vB(n,t,wMt(g,[n,t]));!a[p]&&!isNaN(p)&&d.length>1&&(a[p]=1,o.push(p))}),o}),p1=lb((n,t,e,i,r)=>_J(i(n),i(t),e).map(s=>dJ(r(s))));let PM=class SJ extends mJ{constructor(){super(...arguments),this.type=eh.Linear}clone(){return new SJ().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return PMt(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(eMt(e==null?void 0:e.customTicks))return e.customTicks(this,t);if(bn(this._rangeFactorStart)&&bn(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,s=this._domain,o=r[0],a=r[r.length-1];let l=g1(s[0],s[s.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==o||l[l.length-1]!==a)&&this._niceType){const h=r.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==o?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const d=Math.min(h[0],h[h.length-1]),u=Math.max(h[0],h[h.length-1]);l=l.filter(c=>c>=d&&c<=u)}}return l}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return _J(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return IMt(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const s=this._domain;let o=[];if(e){const a=bJ(s,e);if(o=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const a=mB(s.slice(),t);this._niceType==="min"?a[a.length-1]=(i=o[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(r=o[0])!==null&&r!==void 0?r:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=mB(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=mB(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}},xJ=class{nice(t=10,e){var i,r,s,o;const a=this._domain;let l=[],h=null;if(e){const d=bJ(a,e);if(l=d.niceMinMax,this._domainValidator=d.domainValidator,h=d.niceType,d.niceDomain)return this._niceDomain=d.niceDomain,this.rescale(),this}else h="all";if(h){const d=xMt(a.slice(),(r=(i=this.getNiceConfig)===null||i===void 0?void 0:i.call(this))!==null&&r!==void 0?r:{floor:u=>Math.floor(u),ceil:u=>Math.ceil(u)});return h==="min"?d[d.length-1]=(s=l[1])!==null&&s!==void 0?s:d[d.length-1]:h==="max"&&(d[0]=(o=l[0])!==null&&o!==void 0?o:d[0]),this._niceDomain=d,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}};function mV(n){return t=>-n(-t)}function vV(n=Number.EPSILON){return t=>Math.max(t,n)}function OMt(n=Number.EPSILON){return t=>Math.min(t,-n)}let BD=class wJ extends mJ{constructor(){super(dV(10),hV(10)),this.type=eh.Log,this._limit=vV(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new wJ().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=dV(this._base),r=hV(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=mV(i),this._pows=mV(r),this._limit=OMt(),this.transformer=vMt,this.untransformer=_Mt):(this._logs=i,this._pows=r,this._limit=vV(),this.transformer=this._logs,this.untransformer=r),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return Tg}d3Ticks(t=10,e){const i=this.domain(),r=this._limit(i[0]),s=this._limit(i[i.length-1]);return yJ(r,s,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return CJ(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return p1(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return p1(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}};sJ(BD,xJ);let DMt=class extends pJ{constructor(t){super(!1),this.type=eh.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}},PD=class AJ extends PM{constructor(){super(uV(1),cV(1)),this.type=eh.Symlog,this._const=1}clone(){return new AJ().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=uV(t),this.untransformer=cV(t),this.rescale(e)):this._const}d3Ticks(t=10,e){const i=this.domain(),r=i[0],s=i[i.length-1];return yJ(r,s,t,this._const,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return CJ(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return p1(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return p1(e[0],e[e.length-1],t,this.transformer,this.untransformer)}};sJ(PD,xJ);class FMt{constructor(){this._scale=new pJ,this._scales=[this._scale]}valueToPosition(t){return this._scale.scale(t)}getPosition(t){let e=0,i=this._scale;if(this._scales.length===1||t.length===1)e=this.valueToPosition(t[0]);else{const r=Math.min(t.length,this._scales.length);for(let s=0;s<r;s++)e+=this._scales[s].scale(t[s]);i=this._scales[r-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,r;const{bandPadding:s,paddingInner:o,paddingOuter:a}=this,l=V(s),h=V(o),d=V(a);for(let u=0;u<this._scales.length;u++){const c=l?s[u]:s,g=h?o[u]:o,p=d?a[u]:a;this._scales[u].paddingInner((i=g??c)!==null&&i!==void 0?i:t,!0).paddingOuter((r=p??c)!==null&&r!==void 0?r:e)}}dataToPosition(t,e={}){var i;if(t.length===0||this._scales.length===0)return 0;const{position:r,bandScale:s}=this.getPosition(t);return r+s.bandwidth()*((i=e.bandPosition)!==null&&i!==void 0?i:.5)}updateScaleDomain(t){for(let e=0;e<this._scales.length;e++)this._scales[e].domain(t)}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function HMt(n,t,e){n.getTransform(t)||n.registerTransform(t,e)}function zMt(n,t,e){n.getParser(t)||n.registerParser(t,e)}const WMt=Math.sqrt(50),jMt=Math.sqrt(10),NMt=Math.sqrt(2);class $Mt{constructor(t){this._extend={},this.type=t??"linear",this._scale=t==="log"?new BD:t==="symlog"?new PD:new PM,this._scales=[this._scale]}setExtraAttrFromSpec(t,e,i,r,s,o){this.nice=!1,this.zero=e,this.zero&&(i.min=Math.min(i.min,0),i.max=Math.max(i.max,0)),this.domain=i,this.expand=r,this.type==="log"?this._scale.base(s??10):this.type==="symlog"&&this._scale.constant(o??10)}transformScaleDomain(){this.type==="symlog"||this.type==="log"||this.setScaleNice()}setScaleNice(){this.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}setLogScaleNice(){var t,e,i,r,s,o;D((t=this.domain)===null||t===void 0?void 0:t.min)&&D((e=this.domain)===null||e===void 0?void 0:e.max)?this.nice&&this._scale.nice():L((i=this.domain)===null||i===void 0?void 0:i.min)&&D((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.niceMax():D((s=this.domain)===null||s===void 0?void 0:s.min)&&L((o=this.domain)===null||o===void 0?void 0:o.max)&&this.nice&&this._scale.niceMin()}setLinearScaleNice(){var t,e,i,r,s,o,a,l;let h=(e=(t=this.forceTickCount)!==null&&t!==void 0?t:this.tickCount)!==null&&e!==void 0?e:10;this.niceType==="accurateFirst"&&(h=Math.max(10,h)),D((i=this.domain)===null||i===void 0?void 0:i.min)&&D((r=this.domain)===null||r===void 0?void 0:r.max)?this.nice&&this._scale.nice(h):L((s=this.domain)===null||s===void 0?void 0:s.min)&&D((o=this.domain)===null||o===void 0?void 0:o.max)?this.nice&&this._scale.niceMax(h):D((a=this.domain)===null||a===void 0?void 0:a.min)&&L((l=this.domain)===null||l===void 0?void 0:l.max)?this.nice&&this._scale.niceMin(h):this.nice&&this._scale.nice(h)}dataToPosition(t){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){const e=[];return t.forEach(i=>{const{min:r,max:s}=i;e[0]=e[0]===void 0?r:Math.min(e[0],r),e[1]=e[1]===void 0?s:Math.max(e[1],s)}),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this.expand)return;const e=t[0],i=t[t.length-1];L(this.expand.min)&&(t[0]=e-(i-e)*this.expand.min),L(this.expand.max)&&(t[t.length-1]=i+(i-e)*this.expand.max)}niceDomain(t){if(L(t[0])||L(t[1])||this.type!=="linear")return t;if(Math.abs(Ri(t)-Mi(t))<=1e-12){let e=t[0];const i=e>=0?1:-1;if(e=Math.abs(e),e<1)t[0]=0,t[1]=1;else{let r=e/5;const s=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,s);r=(o>=WMt?10:o>=jMt?5:o>=NMt?2:1)*Math.pow(10,s),t[0]=0,t[1]=10*r}i<0&&(t.reverse(),t[0]*=-1,t[1]*=-1)}return t}niceMinMax(){var t,e,i,r,s,o,a,l;if(this.nice){let h=(e=(t=this.forceTickCount)!==null&&t!==void 0?t:this.tickCount)!==null&&e!==void 0?e:10;this.niceType==="accurateFirst"&&(h=Math.max(10,h)),D((i=this.domain)===null||i===void 0?void 0:i.min)&&D((r=this.domain)===null||r===void 0?void 0:r.max)?this._scale.nice(h):L((s=this.domain)===null||s===void 0?void 0:s.min)&&D((o=this.domain)===null||o===void 0?void 0:o.max)?this._scale.niceMax(h):D((a=this.domain)===null||a===void 0?void 0:a.min)&&L((l=this.domain)===null||l===void 0?void 0:l.max)?this._scale.niceMin(h):this._scale.nice(h)}}includeZero(t){this.zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(t[t.length-1],0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this.nice),this.niceMinMax()}extendDomain(t){let e;const i=t.length-1,r=t[0]-t[i]>0,s=r?i:0,o=r?0:i;for(const a in this._extend)e=this._extend[a],e>t[o]&&(t[o]=e),e<t[s]&&(t[s]=e)}setDomainMinMax(t){if(!this.domain)return;const{min:e,max:i}=this.domain;L(e)&&(t[0]=e),L(i)&&(t[1]=i)}setZero(t){this.zero!==t&&(this.zero=t,this.updateScaleDomain())}updateScaleDomain(){const t=this.computeDomain([this.domain]);this.updateScaleDomainByModel(t)}computeDomain(t){return this.computeLinearDomain(t)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this.nice),this.niceMinMax()}updateRange(t){const[e,i]=this._scale.range();t[0]===e&&t[1]===i||this._scale.range(t)}}function VMt(n,t){const e=n.find(r=>r.name==="axis-label-container-layer-0",!0),i=n.find(r=>r.name==="axis-label-container-layer-1",!0);_V(e?e.getChildren():[],t),_V(i?i.getChildren():[],t)}function GMt(n,t){const{width:e,height:i}=t.getLayoutRect(),r=EL(t.orient),s=t.option.inverse===!0,o=n[0],a=de(n);if(r)if(s){const l=e,h=0,d=o.AABBBounds.x2,u=a.AABBBounds.x1;d>l&&o.setAttributes({x:l,textAlign:"right"}),u<h&&a.setAttributes({x:h,textAlign:"left"})}else{const h=e,d=o.AABBBounds.x1,u=a.AABBBounds.x2;d<0&&o.setAttributes({x:0,textAlign:"left"}),u>h&&a.setAttributes({x:h,textAlign:"right"})}else if(s){const l=o.AABBBounds.y1,h=a.AABBBounds.y2,d=0,u=i;l<d&&o.setAttributes({y:d,textBaseline:"top"}),h>u&&a.setAttributes({y:u,textBaseline:"bottom"})}else{const l=i,h=0,d=o.AABBBounds.y2,u=a.AABBBounds.y1;d>l&&o.setAttributes({y:l,textBaseline:"bottom"}),u<h&&a.setAttributes({y:h,textBaseline:"top"})}}function _V(n,t){var e;const i=t.option;xt(n)||!((e=i==null?void 0:i.label)===null||e===void 0)&&e.flush&&GMt(n,t)}const UMt=n=>n;let YMt=class{constructor(t,e,i,r,s){var o,a,l;this.x=0,this.y=0,this.padding=r,this.table=s,this.orient=(o=t.orient)!==null&&o!==void 0?o:"left",this.type=(a=t.type)!==null&&a!==void 0?a:"band",this.option=Z({},FAt(t.__vtableChartTheme),XMt(this.orient,s.theme),KMt(this.orient,this.type,t.__vtableChartTheme),t),this.orient==="left"||this.orient==="right"?(this.width=e,this.height=i-r[0]-r[2]-0,this.y=r[0]+0):(this.orient==="top"||this.orient==="bottom")&&(this.width=e-r[1]-r[3]-0,this.height=i,this.x=r[3]+0),this.visible=(l=t.visible)===null||l===void 0||l,this.inverse="inverse"in t&&!!t.inverse,t.type==="band"&&(this.data=t.domain),this.initScale(),this.initData(),this.createComponent(),this.initEvent()}initScale(){const t=this.option;this.type==="band"||this.type==="point"?(this.scale=new FMt,this.scale.bandPadding=t.bandPadding,this.scale.paddingInner=t.paddingInner,this.scale.paddingOuter=t.paddingOuter,this.scale.calcScales(.1,.3),this.scale.updateScaleDomain(this.data),this.updateScaleRange()):this.type!=="linear"&&this.type!=="time"&&this.type!=="log"&&this.type!=="symlog"||(this.scale=new $Mt(this.type),this.scale.setExtraAttrFromSpec(t.nice,t.zero,t.range,t.expand,t.base,t.constant),this.scale.transformScaleDomain(),this.scale.updateScaleDomain(),this.updateScaleRange())}initData(){this.table._vDataSet||(this.table._vDataSet=new LAt),zMt(this.table._vDataSet,"scale",UMt),HMt(this.table._vDataSet,"ticks",u_t);const t=this.option.label||{},e=this.option.tick||{},i=new tJ(this.table._vDataSet).parse(this.scale._scale,{type:"scale"}).transform({type:"ticks",options:{sampling:this.option.sampling!==!1,tickCount:e.tickCount,forceTickCount:e.forceTickCount,tickStep:e.tickStep,tickMode:e.tickMode,noDecimals:e.noDecimals,axisOrientType:this.orient,coordinateType:"cartesian",labelStyle:t.style,labelFormatter:t.formatMethod,labelGap:t.minGap,labelLastVisible:t.lastVisible,labelFlush:t.flush}},!1);this.tickData=i,this.computeData()}computeData(){this.tickData.reRunAllTransform()}initEvent(){}createComponent(){const t=iV(this.option),e=this.getUpdateAttribute();e.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component=new WE(Z({disableTriggerEvent:this.table.options.disableInteraction},t,e)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.component.originAxis=this}resize(t,e){this.width=t-(this.orient==="top"||this.orient==="bottom"?this.padding[1]+this.padding[3]:0),this.height=e-(this.orient==="left"||this.orient==="right"?this.padding[2]+this.padding[0]:0),this.updateScaleRange(),this.computeData();const i=iV(this.option),r=this.getUpdateAttribute();r.verticalFactor=this.orient==="top"||this.orient==="right"?-1:1,this.component.setAttributes(Z({},i,r)),this.component.setAttributes(this.setLayoutStartPosition({x:this.x,y:this.y})),this.overlap()}overlap(){VMt(this.component,this)}getLayoutRect(){return{width:this.width,height:this.height}}getUpdateAttribute(){this.table.tableNoFrameHeight,this.table.tableNoFrameWidth;const{width:t,height:e}=this.getLayoutRect(),i=EL(this.orient),r=tMt(this.orient);let s={x:0,y:0},o=0;i?(s={x:t,y:0},o=t):r&&(s={x:0,y:e},o=e);const a=this.orient==="top"||this.orient==="bottom"?e:t;return{start:{x:0,y:0},end:s,title:{text:this.option.title.text,maxWidth:this._getTitleLimit(i)},items:this.getLabelItems(o),verticalLimitSize:a,verticalMinSize:a}}getLabelItems(t){return[this.tickData.latestData.map(e=>({id:e.value,label:e.value,value:t===0?0:this.scale.dataToPosition([e.value])/t,rawValue:e.value})).filter(e=>e.value>=0&&e.value<=1)]}updateScaleRange(){var t,e,i,r,s,o,a,l;const h=(e=(t=this.option.innerOffset)===null||t===void 0?void 0:t.right)!==null&&e!==void 0?e:0,d=(r=(i=this.option.innerOffset)===null||i===void 0?void 0:i.left)!==null&&r!==void 0?r:0,u=(o=(s=this.option.innerOffset)===null||s===void 0?void 0:s.top)!==null&&o!==void 0?o:0,c=(l=(a=this.option.innerOffset)===null||a===void 0?void 0:a.bottom)!==null&&l!==void 0?l:0,{width:g,height:p}=this.getLayoutRect(),f=this.option.inverse||!1;let m=[0,0];EL(this.orient)?et(g)&&(m=f?[g-h,d]:[d,g-h]):et(p)&&(m=f?[u,p-c]:[p-c,u]),this.scale.updateRange(m)}setLayoutStartPosition(t){let{x:e,y:i}=t;return et(e)&&(e+=+(this.orient==="left")*this.getLayoutRect().width),et(i)&&(i+=+(this.orient==="top")*this.getLayoutRect().height),{x:e,y:i}}_getTitleLimit(t){var e,i,r;if(this.option.title.visible&&D((e=this.option.title.style)===null||e===void 0?void 0:e.maxLineWidth)){let s=((i=this.option.title.style)===null||i===void 0?void 0:i.angle)||0;if(!((r=this.option.title)===null||r===void 0)&&r.autoRotate&&D(this.option.title.angle)&&(s=this.option.orient==="left"?-90:90),t){const l=this.getLayoutRect().width,h=Math.abs(Math.cos(Te(s)));return h<1e-6?1/0:l/h}const o=this.getLayoutRect().height,a=Math.abs(Math.sin(Te(s)));return a<1e-6?1/0:o/a}return null}getScale(){return this.scale._scale}getDomainSpec(){return this.scale.domain}};function XMt(n,t){let e;return n==="left"?e=t.axisStyle.leftAxisStyle:n==="right"?e=t.axisStyle.rightAxisStyle:n==="top"?e=t.axisStyle.topAxisStyle:n==="bottom"&&(e=t.axisStyle.bottomAxisStyle),Z({},t.axisStyle.defaultAxisStyle,e)}function KMt(n,t,e){if(!e)return{};const i=e.axis;let r,s;return t==="linear"||t==="log"||t==="symlog"?r=e.axisLinear:t==="band"&&(r=e.axisBand),n==="top"||n==="bottom"?s=e.axisX:n!=="left"&&n!=="right"||(s=e.axisY),Z({},i,r,s)}function qMt(n,t){var e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b;const y=Z({},u1,n);let C=0;y.tick.visible!==!1&&(C=(e=y.tick.width)!==null&&e!==void 0?e:4);let S=0;if(y.label.visible){if(y.type==="band")y.domain.forEach(x=>{var A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y;y.label.formatMethod&&(x=y.label.formatMethod(x));const{width:G,height:tt}=t.measureText(x,{fontSize:(T=(M=(A=y.label)===null||A===void 0?void 0:A.style)===null||M===void 0?void 0:M.fontSize)!==null&&T!==void 0?T:Rp,fontWeight:(E=(B=(R=y.label)===null||R===void 0?void 0:R.style)===null||B===void 0?void 0:B.fontWeight)!==null&&E!==void 0?E:"normal",fontFamily:(I=(P=(k=y.label)===null||k===void 0?void 0:k.style)===null||P===void 0?void 0:P.fontFamily)!==null&&I!==void 0?I:kp}),st=((H=(O=y.label)===null||O===void 0?void 0:O.style)===null||H===void 0?void 0:H.maxLineWidth)||1/0,ot=((j=(F=(z=y.label)===null||z===void 0?void 0:z.style)===null||F===void 0?void 0:F.angle)!==null&&j!==void 0?j:0)+(((Y=($=y.label)===null||$===void 0?void 0:$.style)===null||Y===void 0?void 0:Y.direction)==="vertical"?90:0);S=Math.max(S,Bp(Math.min(G,st),tt,ot).width)});else{let x;if(!((i=n.sync)===null||i===void 0)&&i.tickAlign&&it((r=n.tick)===null||r===void 0?void 0:r.tickMode))x=n.tick.tickMode();else if(V(n.__ticksForVTable))x=n.__ticksForVTable;else{const A=y.range,M=Math.abs(A.min)>1?Math.round(A.min):A.min,T=Math.abs(A.max)>1?Math.round(A.max):A.max;x=[f1(M),f1(T)]}x.forEach(A=>{var M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G;y.label.formatMethod&&(A=y.label.formatMethod(A));const{width:tt,height:st}=t.measureText(A,{fontSize:(R=(T=(M=y.label)===null||M===void 0?void 0:M.style)===null||T===void 0?void 0:T.fontSize)!==null&&R!==void 0?R:Rp,fontWeight:(k=(E=(B=y.label)===null||B===void 0?void 0:B.style)===null||E===void 0?void 0:E.fontWeight)!==null&&k!==void 0?k:"normal",fontFamily:(O=(I=(P=y.label)===null||P===void 0?void 0:P.style)===null||I===void 0?void 0:I.fontFamily)!==null&&O!==void 0?O:kp}),ot=((z=(H=y.label)===null||H===void 0?void 0:H.style)===null||z===void 0?void 0:z.maxLineWidth)||1/0,rt=(($=(j=(F=y.label)===null||F===void 0?void 0:F.style)===null||j===void 0?void 0:j.angle)!==null&&$!==void 0?$:0)+(((G=(Y=y.label)===null||Y===void 0?void 0:Y.style)===null||G===void 0?void 0:G.direction)==="vertical"?90:0);S=Math.max(S,Bp(Math.min(tt,ot),st,rt).width)})}S+=(s=y.label.space)!==null&&s!==void 0?s:4}let w=0;if(y.title.visible&&yt(y.title.text)){const{width:x,height:A}=t.measureText(y.title.text,{fontSize:(l=(a=(o=y.title)===null||o===void 0?void 0:o.style)===null||a===void 0?void 0:a.fontSize)!==null&&l!==void 0?l:Rp,fontWeight:(u=(d=(h=y.title)===null||h===void 0?void 0:h.style)===null||d===void 0?void 0:d.fontWeight)!==null&&u!==void 0?u:"normal",fontFamily:(p=(g=(c=y.title)===null||c===void 0?void 0:c.style)===null||g===void 0?void 0:g.fontFamily)!==null&&p!==void 0?p:kp}),M=((m=(f=y.label)===null||f===void 0?void 0:f.style)===null||m===void 0?void 0:m.maxLineWidth)||1/0,T=Bp(Math.min(x,M),A,(_=(v=y.title)===null||v===void 0?void 0:v.style)===null||_===void 0?void 0:_.angle);w=n.orient!=="left"&&n.orient!=="right"||!y.title.autoRotate?T.width:T.height,w+=(b=y.title.space)!==null&&b!==void 0?b:4}return Math.ceil(C+S+w+1)}function ZMt(n,t){var e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b;const y=Z({},u1,n);let C=0;y.tick.visible!==!1&&(C=(e=y.tick.width)!==null&&e!==void 0?e:4);let S=0;if(y.label.visible){if(y.type==="band")y.domain.forEach(x=>{var A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y;y.label.formatMethod&&(x=y.label.formatMethod(x));const{width:G,height:tt}=t.measureText(x,{fontSize:(T=(M=(A=y.label)===null||A===void 0?void 0:A.style)===null||M===void 0?void 0:M.fontSize)!==null&&T!==void 0?T:Rp,fontWeight:(E=(B=(R=y.label)===null||R===void 0?void 0:R.style)===null||B===void 0?void 0:B.fontWeight)!==null&&E!==void 0?E:"normal",fontFamily:(I=(P=(k=y.label)===null||k===void 0?void 0:k.style)===null||P===void 0?void 0:P.fontFamily)!==null&&I!==void 0?I:kp}),st=((H=(O=y.label)===null||O===void 0?void 0:O.style)===null||H===void 0?void 0:H.maxLineWidth)||1/0,ot=((j=(F=(z=y.label)===null||z===void 0?void 0:z.style)===null||F===void 0?void 0:F.angle)!==null&&j!==void 0?j:0)+(((Y=($=y.label)===null||$===void 0?void 0:$.style)===null||Y===void 0?void 0:Y.direction)==="vertical"?90:0);S=Math.max(S,Bp(Math.min(G,st),tt,ot).height)});else{let x;if(!((i=n.sync)===null||i===void 0)&&i.tickAlign&&it((r=n.tick)===null||r===void 0?void 0:r.tickMode))x=n.tick.tickMode();else if(V(n.__ticksForVTable))x=n.__ticksForVTable;else{const A=y.range,M=Math.abs(A.min)>1?Math.round(A.min):A.min,T=Math.abs(A.max)>1?Math.round(A.max):A.max;x=[f1(M),f1(T)]}x.forEach(A=>{var M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G;y.label.formatMethod&&(A=y.label.formatMethod(A));const{width:tt,height:st}=t.measureText(A,{fontSize:(R=(T=(M=y.label)===null||M===void 0?void 0:M.style)===null||T===void 0?void 0:T.fontSize)!==null&&R!==void 0?R:Rp,fontWeight:(k=(E=(B=y.label)===null||B===void 0?void 0:B.style)===null||E===void 0?void 0:E.fontWeight)!==null&&k!==void 0?k:"normal",fontFamily:(O=(I=(P=y.label)===null||P===void 0?void 0:P.style)===null||I===void 0?void 0:I.fontFamily)!==null&&O!==void 0?O:kp}),ot=((z=(H=y.label)===null||H===void 0?void 0:H.style)===null||z===void 0?void 0:z.maxLineWidth)||1/0,rt=(($=(j=(F=y.label)===null||F===void 0?void 0:F.style)===null||j===void 0?void 0:j.angle)!==null&&$!==void 0?$:0)+(((G=(Y=y.label)===null||Y===void 0?void 0:Y.style)===null||G===void 0?void 0:G.direction)==="vertical"?90:0);S=Math.max(S,Bp(Math.min(tt,ot),st,rt).height)})}S+=(s=y.label.space)!==null&&s!==void 0?s:4}let w=0;if(y.title.visible&&y.title.text){const{width:x,height:A}=t.measureText(y.title.text,{fontSize:(l=(a=(o=y.title)===null||o===void 0?void 0:o.style)===null||a===void 0?void 0:a.fontSize)!==null&&l!==void 0?l:Rp,fontWeight:(u=(d=(h=y.title)===null||h===void 0?void 0:h.style)===null||d===void 0?void 0:d.fontWeight)!==null&&u!==void 0?u:"normal",fontFamily:(p=(g=(c=y.title)===null||c===void 0?void 0:c.style)===null||g===void 0?void 0:g.fontFamily)!==null&&p!==void 0?p:kp}),M=((m=(f=y.label)===null||f===void 0?void 0:f.style)===null||m===void 0?void 0:m.maxLineWidth)||1/0,T=Bp(Math.min(x,M),A,(_=(v=y.title)===null||v===void 0?void 0:v.style)===null||_===void 0?void 0:_.angle);w=n.orient!=="bottom"&&n.orient!=="top"||!y.title.autoRotate?T.height:T.width,w+=(b=y.title.space)!==null&&b!==void 0?b:4}return C+S+w+1}function f1(n){return typeof n!="number"&&(n=Number(n)),Number(n.toPrecision(1)).toString()}function Bp(n,t,e=0){const i=e*Math.PI/180,r=-n/2,s=-t/2,o=n/2,a=-t/2,l=n/2,h=t/2,d=-n/2,u=t/2,c={x:r*Math.cos(i)-s*Math.sin(i),y:r*Math.sin(i)+s*Math.cos(i)},g={x:o*Math.cos(i)-a*Math.sin(i),y:o*Math.sin(i)+a*Math.cos(i)},p={x:l*Math.cos(i)-h*Math.sin(i),y:l*Math.sin(i)+h*Math.cos(i)},f={x:d*Math.cos(i)-u*Math.sin(i),y:d*Math.sin(i)+u*Math.cos(i)},m=Math.min(c.x,g.x,p.x,f.x),v=Math.max(c.x,g.x,p.x,f.x),_=Math.min(c.y,g.y,p.y,f.y);return{width:v-m,height:Math.max(c.y,g.y,p.y,f.y)-_}}const JMt='<svg t="1716726614852" class="icon" viewBox="0 0 1194 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="2621" width="200" height="200"><path d="M1038.694079 367.237067c13.265507 23.342857-16.633865-40.004445-63.05621-40.004446H219.018794c-26.558738 0-46.46393 13.334815-63.05621 40.004446S0.006238 607.277601 0.006238 650.608819V940.647979a82.351494 82.351494 0 0 0 82.961402 83.349526H1111.702885a82.337632 82.337632 0 0 0 82.975264-83.349526V650.608819c0-43.331218-155.970208-283.371753-155.970208-283.371752zM730.066575 667.284269a136.328386 136.328386 0 0 1-132.738243 133.33429 133.417459 133.417459 0 0 1-132.738243-133.33429v-6.681269a40.6698 40.6698 0 0 0-36.497473-26.66963H73.015044l119.458874-220.02445s23.231965-40.004445 53.103614-40.004446h713.481918c26.544876 0 29.871649 10.008042 46.436207 40.004446L1128.33675 633.947231H769.904682c-26.184476 0-39.838107 7.623855-39.838107 33.337038zM338.505391 210.559919l-89.601086-86.69016a22.178487 22.178487 0 0 1 0-33.26773 21.984425 21.984425 0 0 1 33.170699 0l89.601087 86.676299a22.317102 22.317102 0 0 1 0 33.26773 24.950798 24.950798 0 0 1-33.1707 0z m252.197118-40.059891a25.532983 25.532983 0 0 1-6.639685-16.633865l-3.326773-126.694606A28.263709 28.263709 0 0 1 603.995739 0.515788c13.251646-3.326773 23.204242 10.021904 26.544877 23.342858V153.866163a28.249847 28.249847 0 0 1-23.259688 26.66963c-6.611961-3.312911-13.279369-3.312911-16.578419-10.035765z m235.646421 33.337038a22.372548 22.372548 0 0 1 0-33.337038l86.288175-90.030795a22.039871 22.039871 0 0 1 33.170699 0 22.289379 22.289379 0 0 1 0 33.364761l-82.961401 90.003072a25.962691 25.962691 0 0 1-36.483611 0z" fill="#8a8a8a" p-id="2622"></path></svg>';class QMt{constructor(t,e){this._emptyTipOption={spaceBetweenTextAndIcon:20,text:"no data",textStyle:{fontSize:14,color:"#000"},icon:{image:JMt,width:100,height:100}},this.isReleased=!1,this.table=e,this._emptyTipOption=Object.assign(this._emptyTipOption,t===!0?{}:t),L(this._emptyTipOption.displayMode)||(this.table.isListTable()?this._emptyTipOption.displayMode="basedOnTable":this._emptyTipOption.displayMode="basedOnContainer"),this._emptyTipComponent=this._createOrUpdateEmptyTipComponent(this._getEmptyTipAttrs())}_createOrUpdateEmptyTipComponent(t){if(this._emptyTipComponent)Oe(t,this._cacheAttrs)||this._emptyTipComponent.setAttributes(t);else{const e=new XK(t);e.name="emptyTip",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._emptyTipComponent=e,this.bindEvents()}return this._emptyTipComponent}bindEvents(){this._emptyTipComponent.on("click",t=>{const e=new ie;this._emptyTipComponent.forEachChildren(i=>{e.union(i.globalAABBBounds)}),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_click",t)}),this._emptyTipComponent.on("dblclick",t=>{const e=new ie;this._emptyTipComponent.forEachChildren(i=>{e.union(i.globalAABBBounds)}),e.contains(t.x,t.y)&&this.table.fireListeners("empty_tip_dblclick",t)})}resize(){var t;if(!this._emptyTipComponent)return;const{leftHeaderWidth:e,topHeaderHeight:i,width:r,height:s}=this.getWidthAndHeight();this._emptyTipComponent.setAttributes({spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:r,height:s,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:(t=this._emptyTipOption.textStyle)===null||t===void 0?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)})}release(){this._emptyTipComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent),this._emptyTipComponent=null,this.isReleased=!0}resetVisible(){(this.table.recordsCount&&this.table.recordsCount!==0||this.table.internalProps.layoutMap.rowCount!==this.table.internalProps.layoutMap.columnHeaderLevelCount)&&this.table.internalProps.layoutMap.colCount!==this.table.internalProps.layoutMap.rowHeaderLevelCount?this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)&&this.table.scenegraph.stage.defaultLayer.removeChild(this._emptyTipComponent):this.table.scenegraph.stage.defaultLayer.children.includes(this._emptyTipComponent)||this.table.scenegraph.stage.defaultLayer.appendChild(this._emptyTipComponent)}getWidthAndHeight(){const t=this.table.transpose||this.table.options.indicatorsAsCol===!1?this.table.getFrozenColsWidth():0,e=!this.table.transpose||this.table.options.indicatorsAsCol?this.table.getFrozenRowsHeight():0;return{leftHeaderWidth:t,topHeaderHeight:e,width:(this._emptyTipOption.displayMode!=="basedOnContainer"&&this.table.columnHeaderLevelCount>0&&this.table.colCount>this.table.rowHeaderLevelCount?this.table.getDrawRange().width:this.table.tableNoFrameWidth)-t-this.table.getTheme().scrollStyle.width,height:(this._emptyTipOption.displayMode!=="basedOnContainer"&&this.table.rowHeaderLevelCount>0&&this.table.rowCount>this.table.columnHeaderLevelCount?this.table.getDrawRange().height:this.table.tableNoFrameHeight)-e-this.table.getTheme().scrollStyle.width}}_getEmptyTipAttrs(){var t;const{leftHeaderWidth:e,topHeaderHeight:i,width:r,height:s}=this.getWidthAndHeight();return{spaceBetweenTextAndIcon:this._emptyTipOption.spaceBetweenTextAndIcon,x:this.table.tableX+e,y:this.table.tableY+i,width:r,height:s,text:Object.assign(Object.assign({text:this._emptyTipOption.text},this._emptyTipOption.textStyle),{fill:(t=this._emptyTipOption.textStyle)===null||t===void 0?void 0:t.color}),icon:Object.assign({},this._emptyTipOption.icon)}}}var tTt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const eTt={orient:"bottom",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fill:"#000000",fontWeight:"normal"},space:12},item:{visible:!0,spaceCol:10,spaceRow:10,padding:2,background:{state:{selectedHover:{fill:"gray",fillOpacity:.7},unSelectedHover:{fill:"gray",fillOpacity:.2}}},shape:{space:4,state:{unSelected:{fillOpacity:.5}}},label:{space:4,style:{fill:"#89909D",fontSize:14},state:{unSelected:{fillOpacity:.5}}}},allowAllCanceled:!0,visible:!0};function iTt(n,t){const e=Z({},eTt,n),{title:i={},item:r={},pager:s={},background:o={},type:a,id:l,visible:h,orient:d,position:u,data:c,filter:g,regionId:p,regionIndex:f,seriesIndex:m,seriesId:v,padding:_}=e,b=tTt(e,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(b.title=iJ(i)),xt(r.focusIconStyle)||ln(r.focusIconStyle),Go(r.shape),Go(r.label),Go(r.value),Go(r.background),FR(r.maxWidth)&&(r.maxWidth=Number(r.maxWidth.substring(0,r.maxWidth.length-1))*t.width/100),FR(r.width)&&(r.width=Number(r.width.substring(0,r.width.length-1))*t.width/100),FR(r.height)&&(r.height=Number(r.height.substring(0,r.height.length-1))*t.width/100),b.item=r,xt(s.textStyle)||ln(s.textStyle),Go(s.handler),b.pager=s,o.visible&&!xt(o.style)&&(Z(b,o.style),L(o.padding)&&(b.padding=o.padding)),b}class nTt{constructor(t,e){var i,r,s,o;this.table=e,this.option=Pn(t),this.orient=(i=t.orient)!==null&&i!==void 0?i:"left",this.visible=(r=t.visible)===null||r===void 0||r,this.position=(s=t.position)!==null&&s!==void 0?s:"middle",this.selectedData=(o=t.defaultSelected)!==null&&o!==void 0?o:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),e=new zK(Z({},t,{defaultSelected:this.selectedData,disableTriggerEvent:this.table.options.disableInteraction}));e.name="legend",this.legendComponent=e,this.visible===!1&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&this.visible!==!1&&(this.legendComponent.setAttributes({maxWidth:this.table.tableNoFrameWidth,maxHeight:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;if(!this.legendComponent||this.visible===!1)return;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,s=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||s<=0)return;const o=this.table.tableNoFrameWidth,a=this.table.tableNoFrameHeight,l=Be((i=(e=t.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);let h=0,d=0;this.orient==="left"?(h=l[3],d=0,r+=l[1]+l[3]):this.orient==="top"?(h=0,d=l[0],s+=l[0]+l[2]):this.orient==="right"?(h=o-r-l[1],d=0,r+=l[1]+l[3]):this.orient==="bottom"&&(h=0,d=a-s-l[2],s+=l[0]+l[2]);const u=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,p=0;u==="horizontal"?g=c==="middle"?(o-r)/2:c==="end"?o-r-l[1]:l[3]:p=c==="middle"?(a-s)/2:c==="end"?a-s-l[2]:l[0],this.legendComponent.setAttributes({dx:g,dy:p,x:h,y:d}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s),this.table.tableY+=Math.ceil(s)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s))}getLegendAttributes(t){var e,i;const r=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",s=iTt(this.option,t),o=Be((i=(e=s.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);return Object.assign({layout:r,items:this.getLegendItems(),maxWidth:t.width-o[1]-o[3],maxHeight:t.height-o[0]-o[2]},s)}getLegendItems(){return this.option.data}initEvent(){this.legendComponent&&(this.legendComponent.addEventListener(io.legendItemClick,t=>{const e=Dt(t,"detail.currentSelected");this.table.fireListeners(mt.LEGEND_ITEM_CLICK,{model:this,value:e,event:t})}),this.legendComponent.addEventListener(io.legendItemHover,t=>{const e=Dt(t,"detail");this.table.fireListeners(mt.LEGEND_ITEM_HOVER,{model:this,value:e,event:t})}),this.legendComponent.addEventListener(io.legendItemUnHover,t=>{const e=Dt(t,"detail");this.table.fireListeners(mt.LEGEND_ITEM_UNHOVER,{model:this,value:e,event:t})}),this.legendComponent.addEventListener("legendItemAttributeUpdate",t=>{this.table.scenegraph.updateNextFrame()}))}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}var rTt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const m1={orient:"right",position:"middle",padding:30,title:{visible:!1,padding:0,textStyle:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"titleFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},endText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}},handlerText:{style:{fontSize:14,fontWeight:"normal",fill:{type:"palette",key:"labelFontColor"}}}},sTt={horizontal:Object.assign(Object.assign({},m1),{rail:{width:200,height:8,style:{fill:"rgba(0,0,0,0.04)"}}}),vertical:Object.assign(Object.assign({},m1),{rail:{width:8,height:200,style:{fill:"rgba(0,0,0,0.04)"}}})},oTt={horizontal:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:200,height:4,style:{fill:"rgba(0,0,0,0.04)"}}},m1),vertical:Object.assign({sizeBackground:{fill:"#cdcdcd"},track:{style:{fill:"rgba(20,20,20,0.1)"}},rail:{width:4,height:200,style:{fill:"rgba(0,0,0,0.04)"}}},m1)};function aTt(n,t){const e=Z({},(n.type==="color"?sTt:oTt)[n.orient==="bottom"||n.orient==="top"?"horizontal":"vertical"],n),{title:i={},handler:r={},rail:s={},track:o={},startText:a,endText:l,handlerText:h,sizeBackground:d,background:u={},type:c,id:g,visible:p,orient:f,position:m,data:v,defaultSelected:_,field:b,filter:y,regionId:C,regionIndex:S,seriesIndex:w,seriesId:x,padding:A}=e,M=rTt(e,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return i.visible&&(M.title=iJ(i)),M.showHandler=r.visible!==!1,xt(r.style)||(M.handlerStyle=ln(r.style)),L(s.width)&&(M.railWidth=s.width),L(s.height)&&(M.railHeight=s.height),xt(s.style)||(M.railStyle=ln(s.style)),xt(o.style)||(M.trackStyle=ln(o.style)),M.startText=Go(a),M.endText=Go(l),M.handlerText=Go(h),xt(d)||(M.sizeBackground=ln(d)),u.visible&&!xt(u.style)&&(Z(M,u.style),L(u.padding)&&(M.padding=u.padding)),M}class lTt{constructor(t,e){var i,r,s,o;this.table=e,this.option=Pn(t),this.orient=(i=t.orient)!==null&&i!==void 0?i:"left",this.visible=(r=t.visible)===null||r===void 0||r,this.position=(s=t.position)!==null&&s!==void 0?s:"middle",this.selectedData=(o=t.defaultSelected)!==null&&o!==void 0?o:null,this.createComponent(),this.initEvent()}createComponent(){const t=this.getLegendAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight});let e;e=this.option.type==="color"?new NK(Z({},t,{slidable:!0})):new VK(Z({},t,{slidable:!0})),e.name="legend",this.legendComponent=e,this.visible===!1&&(e.setAttributes({visible:!1,visibleAll:!1}),e.hideAll()),this.table.scenegraph.stage.defaultLayer.appendChild(e),this.adjustTableSize(t)}resize(){this.legendComponent&&this.visible!==!1&&(this.legendComponent.setAttributes({width:this.table.tableNoFrameWidth,height:this.table.tableNoFrameHeight}),this.adjustTableSize(this.legendComponent.attribute))}adjustTableSize(t){var e,i;if(!this.legendComponent||this.visible===!1)return;let r=isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,s=isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0;if(r<=0||s<=0)return;const o=this.table.tableNoFrameWidth,a=this.table.tableNoFrameHeight,l=Be((i=(e=t.padding)!==null&&e!==void 0?e:this.option.padding)!==null&&i!==void 0?i:10);let h=0,d=0;this.orient==="left"?(h=l[3],d=0,r+=l[1]+l[3]):this.orient==="top"?(h=0,d=l[0],s+=l[0]+l[2]):this.orient==="right"?(h=o-r-l[1],d=0,r+=l[1]+l[3]):this.orient==="bottom"&&(h=0,d=a-s-l[2],s+=l[0]+l[2]);const u=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",c=this.position;let g=0,p=0;u==="horizontal"?g=c==="middle"?(o-r)/2:c==="end"?o-r-l[1]:l[3]:p=c==="middle"?(a-s)/2:c==="end"?a-s-l[2]:l[0],this.legendComponent.setAttributes({dx:g,dy:p,x:h,y:d}),this.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r),this.table.tableX+=Math.ceil(r)):this.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s),this.table.tableY+=Math.ceil(s)):this.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(r):this.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(s))}getLegendAttributes(t){const e=this.orient==="bottom"||this.orient==="top"?"horizontal":"vertical",i=e==="horizontal"?"bottom":this.orient;return Object.assign(Object.assign({},aTt(this.option)),{layout:e,align:i,min:this.option.min,max:this.option.max,value:this.option.value,[this.option.type==="color"?"colors":"sizeRange"]:this.option.type==="color"?this.option.colors:this.option.sizeRange})}initEvent(){this.legendComponent&&this.legendComponent.addEventListener("change",t=>{const e=Dt(t,"detail.value");this.table.fireListeners(mt.LEGEND_CHANGE,{model:this,value:e,event:t}),this.table.scenegraph.updateNextFrame()})}getLegendBounds(){return{width:isFinite(this.legendComponent.AABBBounds.width())?this.legendComponent.AABBBounds.width():0,height:isFinite(this.legendComponent.AABBBounds.height())?this.legendComponent.AABBBounds.height():0}}release(){this.legendComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent),this.legendComponent=null}}function hTt(n,t){return n.type==="color"||n.type==="size"?new lTt(n,t):new nTt(n,t)}class MJ{constructor(t){this._table=t}release(){this.unbindMenuElement(),this._menuElement&&this._menuElement.release(),this._menuElement=void 0}_getMenuElement(){return this._menuElement||(this._menuElement=this.createMenuElementInternal()),this._menuElement}bindMenuElement(t,e,i){return this._getMenuElement().bindToCell(this._table,t,e,i)}unbindMenuElement(){this._getMenuElement().unbindFromCell()}pointInMenuElement(t,e){return this._getMenuElement().pointInMenuElement(t,e)}getRootElement(){return this._getMenuElement().rootElement}}const ED="vtable__menu-element",kg=`${ED}--hidden`,_B=`${ED}--shown`;function dTt(){return Ea("div",[ED,kg])}class uTt{constructor(t){var e,i,r;this._handler=new vM,this._rootElement=dTt(),this._rootElement.addEventListener("wheel",s=>{s.stopPropagation()}),(e=this._rootElement)===null||e===void 0||e.addEventListener("mousedown",s=>{s.stopPropagation(),s.preventDefault()}),(i=this._rootElement)===null||i===void 0||i.addEventListener("click",s=>{if(s.stopPropagation(),s.preventDefault(),this._rootElement.classList.contains(kg))return;const{col:o,row:a,dropDownIndex:l,menuKey:h,text:d,hasChildren:u}=s.target;if(typeof l!="number"||u)return void s.stopPropagation();const c=t.isPivotTable()?t.internalProps.layoutMap.getPivotDimensionInfo(o,a):t.getHeaderField(o,a),g=t._dropDownMenuIsHighlight(o,a,l);t.fireListeners(mt.DROPDOWN_MENU_CLICK,{col:o,row:a,field:c,menuKey:h,text:d,highlight:g,cellLocation:t.getCellLocation(o,a),event:s}),t.fireListeners(mt.DROPDOWN_MENU_CLEAR,null),t.fireListeners(mt.HIDE_MENU,null),s.stopPropagation()}),(r=this._rootElement)===null||r===void 0||r.addEventListener("mousemove",s=>{this._rootElement.classList.contains(kg)||s.stopPropagation()})}get rootElement(){return this._rootElement}release(){this.unbindFromCell();const t=this._rootElement;t!=null&&t.parentElement&&t.parentElement.removeChild(t),this._handler.release(),delete this._rootElement}bindToCell(t,e,i,r){const s=this._rootElement;if(this._menuInstanceInfo=r,s==null||s.classList.remove(_B),s==null||s.classList.add(kg),this._canBindToCell(t,e,i)){if(s.innerHTML="",s.appendChild(r.content),this._bindCell(t,e,i,r.position,r.referencePosition))return s==null||s.classList.add(_B),s==null||s.classList.remove(kg),!0}else this.unbindFromCell();return!1}unbindFromCell(){const t=this._rootElement;this._menuInstanceInfo=void 0,t!=null&&t.parentElement&&(t.classList.remove(_B),t.classList.add(kg))}_canBindToCell(t,e,i){var r;const s=t.getCellRangeRelativeRect({col:e,row:i}),o=(r=t.internalProps.menu.parentElement)!==null&&r!==void 0?r:t.getElement(),{top:a,bottom:l,left:h,right:d}=s;if(t.isFrozenCell(e,i))return!0;if(l<t.getFrozenRowsHeight()||d<t.getFrozenColsWidth()||h>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||a>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:u,offsetWidth:c}=o;return!(u<a)&&!(c<h)}_bindCell(t,e,i,r,s){var o;const a=this._rootElement,l=(o=t.internalProps.menu.parentElement)!==null&&o!==void 0?o:t.getElement(),{width:h,height:d,left:u,top:c}=l.getBoundingClientRect();if(a){a.parentElement!==l&&l.appendChild(a),a.style.left="0px";const g=.8*h;a.style.maxWidth=`${g}px`;const p=a.clientWidth,f=a.clientHeight;let m,v;r&&(m=r.x,v=r.y),s&&(m=s.rect.right-p,v=s.rect.bottom),v+f>d&&(v=d-f,m+=p-2),v<0&&(v/=2);let _=0,b=0;if(t.getElement()!==l){const{left:y,top:C}=t.getElement().getBoundingClientRect();_=C-c,b=y-u}return a.style.top=`${v+_}px`,m<0?m=0:m+p>h&&(m=h-p),a.style.left=`${m+b}px`,!0}return!1}pointInMenuElement(t,e){const i=this._rootElement,{x:r,y:s,width:o,height:a}=i.getBoundingClientRect();return t>r-5&&t<r+o+5&&e>s-5&&e<s+a+5}}class bV extends MJ{createMenuElementInternal(){return new p1t(this._table)}}let cTt=class extends MJ{createMenuElementInternal(){return new uTt(this._table)}};const gTt={"dropdown-menu":function(n){return new bV(n)},"context-menu":function(n){return new bV(n)},container:n=>new cTt(n)};function pTt(n,t,e,i,r){var s,o;const{lineHeight:a,textBaseline:l,textStick:h}=n._getCellStyle(t,e);let d=n.getCellRangeRelativeRect(n.getCellRange(t,e));h&&(d=n.getVisibleCellRangeRelativeRect({col:t,row:e}));let{left:u,right:c,bottom:g,top:p,width:f,height:m}=d;if(n.isHeader(t,e)&&({left:u,right:c,bottom:g,top:p,width:f,height:m}=n.internalProps.headerHelper.getDropDownIconRect(d,a,l||"middle")),r==null?void 0:r.content)return{type:i,position:r.position,referencePosition:(s=r.referencePosition)!==null&&s!==void 0?s:{rect:{left:u,right:c,top:p,bottom:g,width:f,height:m}},content:r.content};if(i==="dropdown-menu"){let v=n.globalDropDownMenu;const _=n._getHeaderLayoutMap(t,e);v=(o=_.dropDownMenu)!==null&&o!==void 0?o:v;const b=_.pivotInfo;return typeof v=="function"&&(v=v({row:e,col:t,table:n})),{type:i,referencePosition:{rect:{left:u,right:c,top:p,bottom:g,width:f,height:m}},content:v,pivotInfo:b}}return null}class fTt{constructor(t){this._table=t,this._menuInstances={},this._bindTableEvent(t)}release(){const t=this._menuInstances;for(const e in t)t[e].release();delete this._menuInstances,this._attachInfo=null}_bindToCell(t,e,i,r){var s;const o=this._attachInfo,a=this._getMenuInstanceInfo(t,e,i,r);if(!o||a&&o.instance===a.instance||((s=o.instance)===null||s===void 0||s.unbindMenuElement(),this._attachInfo=null),!a)return;const{instance:l,info:h}=a;if(l&&l.bindMenuElement(t,e,h)){const d=this._table.getCellRange(t,e);this._attachInfo={range:d,instance:l}}}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e==null||e.unbindMenuElement(),this._attachInfo=null}_isBindToCell(t,e){const i=this._attachInfo;return!!i&&So(i.range,t,e)}pointInMenuElement(t,e){if(!this._attachInfo)return!1;const i=this._attachInfo,{instance:r}=i;return r.pointInMenuElement(t,e)}_bindTableEvent(t){t.on(mt.DROPDOWN_ICON_CLICK,e=>{this._attachInfo&&this._isBindToCell(e.col,e.row)?this._unbindFromCell():this._bindToCell(e.col,e.row,"dropdown-menu")}),t.on(mt.DROPDOWN_MENU_CLEAR,e=>{this._unbindFromCell()}),t.on(mt.CONTEXTMENU_CELL,e=>{var i,r,s,o;if(((i=t.internalProps.menu)===null||i===void 0?void 0:i.renderMode)==="html"){const a=t._getMouseAbstractPoint(e.event);let l=null;a.inTable&&typeof((r=t.internalProps.menu)===null||r===void 0?void 0:r.contextMenuItems)=="function"?l=t.internalProps.menu.contextMenuItems(t.getHeaderField(e.col,e.row),e.row,e.col,t):a.inTable&&Array.isArray((s=t.internalProps.menu)===null||s===void 0?void 0:s.contextMenuItems)&&(l=(o=t.internalProps.menu)===null||o===void 0?void 0:o.contextMenuItems),this._bindToCell(e.col,e.row,"context-menu",{content:l,position:{x:a.x,y:a.y}})}})}_getMenuInstanceInfo(t,e,i,r){const s=this._table,o=this._menuInstances,a=pTt(s,t,e,i,r);return a?{instance:o&&o[i]||o&&(o[i]=gTt[i](s)),type:i,info:a}:null}containElement(t){var e;for(const i in this._menuInstances)if(!((e=this._menuInstances[i].getRootElement())===null||e===void 0)&&e.contains(t))return!0;return!1}}let mTt=class{constructor(t,e){this.isReleased=!1,this.table=e,this._titleOption=Z({orient:"top"},t),t.visible!==!1&&(this._titleComponent=this._createOrUpdateTitleComponent(this._getTitleAttrs()))}_createOrUpdateTitleComponent(t){if(this._titleComponent)Oe(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=new UK(t);e.name="title",this.table.scenegraph.stage.defaultLayer.appendChild(e),this._titleComponent=e}return this._adjustTableSize(this._titleComponent.attribute),this._titleComponent}resize(){var t,e,i,r,s;if(!this._titleComponent)return;const o=Be((t=this._titleOption.padding)!==null&&t!==void 0?t:10),a=(e=this._titleOption.width)!==null&&e!==void 0?e:(this.table.widthMode==="adaptive"?this.table.tableNoFrameWidth:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width))-o[1]-o[3],l=(i=this._titleOption.height)!==null&&i!==void 0?i:(this.table.heightMode==="adaptive"?this.table.tableNoFrameHeight:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height))-o[0]-o[2];this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((s=this._titleOption.y)!==null&&s!==void 0?s:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?a:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?l:this._titleOption.height,textStyle:Object.assign({width:a},this._titleOption.textStyle),subtextStyle:Object.assign({width:a},this._titleOption.subtextStyle)}),this._adjustTableSize(this._titleComponent.attribute)}_adjustTableSize(t){var e,i,r,s;const o=isFinite((e=this._titleComponent)===null||e===void 0?void 0:e.AABBBounds.width())?this._titleComponent.AABBBounds.width():0,a=isFinite((i=this._titleComponent)===null||i===void 0?void 0:i.AABBBounds.height())?this._titleComponent.AABBBounds.height():0;this._titleOption.orient==="left"?(this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(o),this.table.tableX+=Math.ceil(o)):this._titleOption.orient==="top"?(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(a),this.table.tableY+=Math.ceil(a)):this._titleOption.orient==="right"?this.table.tableNoFrameWidth=this.table.tableNoFrameWidth-Math.ceil(o):this._titleOption.orient==="bottom"&&(this.table.tableNoFrameHeight=this.table.tableNoFrameHeight-Math.ceil(a)),this._cacheAttrs=t,this._titleOption.orient!=="right"&&this._titleOption.orient!=="bottom"||this._titleComponent.setAttributes({x:((r=this._titleOption.x)!==null&&r!==void 0?r:this._titleOption.orient==="right")?this.table.tableX+this.table.tableNoFrameWidth:this.table.tableX,y:((s=this._titleOption.y)!==null&&s!==void 0?s:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY})}release(){this._titleComponent&&this.table.scenegraph.stage.defaultLayer.removeChild(this._titleComponent),this._titleComponent=null,this.isReleased=!0}_getTitleAttrs(){var t,e,i,r,s,o,a,l,h,d,u;const c=this._titleOption.text||this._titleOption.subtext?10:0,g=Be((t=this._titleOption.padding)!==null&&t!==void 0?t:c),p=(e=this._titleOption.width)!==null&&e!==void 0?e:Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width)-g[1]-g[3],f=(i=this._titleOption.height)!==null&&i!==void 0?i:Math.min(this.table.tableNoFrameHeight,this.table.getDrawRange().height)-g[0]-g[2];return{text:(r=this._titleOption.text)!==null&&r!==void 0?r:"",subtext:(s=this._titleOption.subtext)!==null&&s!==void 0?s:"",x:((o=this._titleOption.x)!==null&&o!==void 0?o:this._titleOption.orient==="right")?this.table.tableX+Math.min(this.table.tableNoFrameWidth,this.table.getDrawRange().width):this.table.tableX,y:((a=this._titleOption.y)!==null&&a!==void 0?a:this._titleOption.orient==="bottom")?this.table.tableY+this.table.tableNoFrameHeight:this.table.tableY,width:this._titleOption.orient==="top"||this._titleOption.orient==="bottom"?p:this._titleOption.width,height:this._titleOption.orient==="left"||this._titleOption.orient==="right"?f:this._titleOption.height,minWidth:this._titleOption.minWidth,maxWidth:this._titleOption.maxWidth,minHeight:this._titleOption.minHeight,maxHeight:this._titleOption.maxHeight,padding:this._titleOption.padding,align:(l=this._titleOption.align)!==null&&l!==void 0?l:"left",verticalAlign:(h=this._titleOption.verticalAlign)!==null&&h!==void 0?h:"top",textStyle:Object.assign({width:p},this._titleOption.textStyle),subtextStyle:Object.assign({width:p},this._titleOption.subtextStyle),dx:(d=this._titleOption.dx)!==null&&d!==void 0?d:0,dy:(u=this._titleOption.dy)!==null&&u!==void 0?u:0}}getComponentGraphic(){return this._titleComponent}};class vTt{constructor(t){this._table=t}release(){var t,e;this.unbindTooltipElement(),this._tooltipElement&&((e=(t=this._tooltipElement).release)===null||e===void 0||e.call(t)),this._tooltipElement=void 0}_getTooltipElement(){return this._tooltipElement||(this._tooltipElement=this.createTooltipElementInternal()),this._tooltipElement}bindTooltipElement(t,e,i,r){return this._getTooltipElement().bindToCell(this._table,t,e,i,r)}moveTooltipElement(t,e,i,r){this._getTooltipElement().move(this._table,t,e,i,r)}unbindTooltipElement(){this._getTooltipElement().unbindFromCell()}locateTooltipElement(t,e,i,r,s){this._getTooltipElement()._locate(this._table,t,e,i,r,s)}}function _Tt(){if(We.mode==="node")return;const n=document.createElement("style");n.id="vtable-tooltip-styleSheet",n.textContent=`
@keyframes vtable__bubble-tooltip-element--shown-animation {
	0% {
		opacity: 0;
	}
	100% {
		opacity: 1;
	}
}
.vtable__bubble-tooltip-element {
	position: absolute;
	
	// pointer-events: none;
	//user-select: none;
	max-width: 300px;
	z-index: 99999;

	background: #FFFFFF;
    border: 1px solid #E6E8ED;
    box-sizing: border-box;
    border-radius: 4px;
    box-shadow: 0px 2px 4px rgb(27 31 35 / 8%);
    color: #141414;
    font-size: 13px;
}
.vtable__bubble-tooltip-element--hidden {
	opacity: 0;
  pointer-events: none;
	user-select: none;
	/* transform: translate(-50%, -50%); */
	transition: opacity 75ms linear;
}
.vtable__bubble-tooltip-element--shown {
	opacity: 1;
	/* transform: translate(-50%, -50%); */
	animation: vtable__bubble-tooltip-element--shown-animation 150ms ease-out;
}
.vtable__bubble-tooltip-element__content {
	/* font-size: .75rem; */
	padding: 6px 8px;
	min-height: 1em;
	line-height: 1.5;
	width: 100%;
	display: block;
	white-space: pre-wrap;
	margin: 0;
	box-sizing: border-box;
	overflow: auto;
	word-wrap: break-word;
	position: relative;
	background-color: #FFF;
	z-index: 2;
	border-radius: 4px;
}
/*  WebKit Microsoft Edge */
.vtable__bubble-tooltip-element__content::-webkit-scrollbar {
  width: 0;
  height: 0;
  background-color: transparent;
}
/*  Opera Firefox  */
.vtable__bubble-tooltip-element__content > scrollbar-track {
  width: 0;
  height: 0;
  background-color: transparent;
}
/* Internet Explorer 11  Microsoft Edge */
.vtable__bubble-tooltip-element__content > scrollbar {
  width: 0;
  height: 0;
  background-color: transparent;
}
.vtable__bubble-tooltip-element__triangle {
	/* font-size: .75rem; */
	position: absolute;
	width: 10px;
	height: 10px;
	display: block;
	transform: rotate(45deg);
    transform-origin: 50% 50% 0;
	z-index: 1;
	background-color: #FFF;
	border: 1px solid #E6E8ED;
}
`,document.head.appendChild(n)}_Tt();const hb="vtable__bubble-tooltip-element",yV=`${hb}__content`,CV=`${hb}__triangle`,gg=`${hb}--hidden`,mm=`${hb}--shown`;class bTt{constructor(){this._handler=new vM;const t=this._rootElement=Ea("div",[hb,gg]),e=Ea("div",[yV]),i=Ea("span",[CV]);t.appendChild(i),t.appendChild(e),this._messageElement=t.querySelector(`.${yV}`)||void 0,this._triangleElement=t.querySelector(`.${CV}`)||void 0,t.addEventListener("mousemove",()=>{this._disappearDelayId&&clearTimeout(this._disappearDelayId)}),t.addEventListener("mouseleave",()=>{this._disappearDelay=void 0,this.unbindFromCell()}),e.addEventListener("wheel",r=>{r.stopPropagation()}),e.addEventListener("copy",r=>{J_t(e)&&r.stopPropagation()})}bindToCell(t,e,i,r,s){var o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x;this._disappearDelay=r==null?void 0:r.disappearDelay,this._disappearDelayId&&clearTimeout(this._disappearDelayId);const A=this._rootElement,M=this._messageElement,T=this._triangleElement;if(A==null||A.classList.remove(mm),A==null||A.classList.add(gg),this._canBindToCell(t,e,i)){if(M.setAttribute("style",""),T.setAttribute("style",""),r!=null&&r.className&&A.classList.add(r.className),!((o=r==null?void 0:r.style)===null||o===void 0)&&o.bgColor&&(M.style.backgroundColor=(a=r==null?void 0:r.style)===null||a===void 0?void 0:a.bgColor),!((l=r==null?void 0:r.style)===null||l===void 0)&&l.bgColor&&(T.style.backgroundColor=(h=r==null?void 0:r.style)===null||h===void 0?void 0:h.bgColor),T.style.display=((d=r==null?void 0:r.style)===null||d===void 0?void 0:d.arrowMark)===!0?"block":"none",!((u=r==null?void 0:r.style)===null||u===void 0)&&u.fontSize&&(M.style.fontSize=((g=(c=r==null?void 0:r.style)===null||c===void 0?void 0:c.fontSize)!==null&&g!==void 0?g:12)+"px"),!((p=r==null?void 0:r.style)===null||p===void 0)&&p.fontFamily&&(M.style.fontFamily=(f=r==null?void 0:r.style)===null||f===void 0?void 0:f.fontFamily),!((m=r==null?void 0:r.style)===null||m===void 0)&&m.color&&(M.style.color=(v=r==null?void 0:r.style)===null||v===void 0?void 0:v.color),!((_=r==null?void 0:r.style)===null||_===void 0)&&_.padding&&(M.style.padding=`${(b=r==null?void 0:r.style)===null||b===void 0?void 0:b.padding.join("px ")}px`),!((y=r==null?void 0:r.style)===null||y===void 0)&&y.maxHeight&&(M.style.maxHeight=`${(C=r==null?void 0:r.style)===null||C===void 0?void 0:C.maxHeight}px`),!((S=r==null?void 0:r.style)===null||S===void 0)&&S.maxWidth&&(M.style.maxWidth=`${(w=r==null?void 0:r.style)===null||w===void 0?void 0:w.maxWidth}px`),M&&(M.textContent=r==null?void 0:r.content),this._bindToCell(t,e,i,r==null?void 0:r.position,r==null?void 0:r.referencePosition,s,(x=r==null?void 0:r.style)===null||x===void 0?void 0:x.arrowMark))return A==null||A.classList.add(mm),A==null||A.classList.remove(gg),!0}else this.unbindFromCell();return!1}release(){var t,e;this.unbindFromCell();const i=this._rootElement;i!=null&&i.parentElement&&i.parentElement.removeChild(i),(e=(t=this._handler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),delete this._rootElement,delete this._messageElement}move(t,e,i,r,s){const o=this._rootElement;this._canBindToCell(t,e,i)?(this._bindToCell(t,e,i,r==null?void 0:r.position,r==null?void 0:r.referencePosition,s),o==null||o.classList.add(mm),o==null||o.classList.remove(gg)):this.unbindFromCell()}unbindFromCell(){var t;if(this._disappearDelay)this._disappearDelayId=setTimeout(()=>{const e=this._rootElement;e!=null&&e.parentElement&&(e.classList.remove(mm),e.classList.add(gg))},(t=this._disappearDelay)!==null&&t!==void 0?t:0);else{const e=this._rootElement;e!=null&&e.parentElement&&(e.classList.remove(mm),e.classList.add(gg))}}_canBindToCell(t,e,i){const r=t.getCellRangeRelativeRect({col:e,row:i}),s=t.getElement(),{bottom:o,left:a,right:l,top:h}=r;if(t.isFrozenCell(e,i))return!0;if(o<t.getFrozenRowsHeight()||l<t.getFrozenColsWidth()||a>t.tableNoFrameWidth-t.getRightFrozenColsWidth()||h>t.tableNoFrameHeight-t.getBottomFrozenRowsHeight())return!1;const{offsetHeight:d,offsetWidth:u}=s;return!(h>d)&&!(a>u)}_bindToCell(t,e,i,r,s,o,a){const l=this._rootElement,h=t.getCellRangeRelativeRect({col:e,row:i}),d=t.internalProps.tooltip.parentElement,u=t.internalProps.element.offsetWidth,{width:c}=h;if(l){let g,p;l.parentElement!==d&&d.appendChild(l),l.style.left="0px";const f=Math.min(.8*u,4*c);l.style.maxWidth=`${f}px`;const m=l.clientWidth,v=l.clientHeight;if(!r&&!s)return!1;{const M=this.getComputedPosition(t,e,i,r,s,o,a);p=M.x,g=M.y}l.style.left=`${p}px`,l.style.top=`${g}px`,XE()&&(l.style.fontSize="11px");const{x1:_,x2:b,y1:y,y2:C}=t.stateManager.menu.bounds,S=p,w=S+m,x=g,A=S+v;return!(t.stateManager.menu.isShow&&_<w&&b>S&&C>x&&y<A)}return!1}getComputedPosition(t,e,i,r,s,o,a){var l;const h=this._rootElement,d=t.getCellRangeRelativeRect({col:e,row:i}),{x:u,y:c}=t.internalProps.tooltip.parentElement.getBoundingClientRect(),{width:g,height:p,x:f,y:m}=t.internalProps.element.getBoundingClientRect(),{width:v}=d;let _,b;const y=Math.min(.8*g,4*v);h.style.maxWidth=`${y}px`;const C=h.clientWidth,S=h.clientHeight,w=a?6:0;if(r)b=r.x,_=r.y+w,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px";else if(s){let x=(l=s.placement)!==null&&l!==void 0?l:Rs.bottom;const A=s.rect.left+s.rect.width/2,M=s.rect.top+s.rect.height/2,T=s.rect.top,R=s.rect.bottom,B=s.rect.left,E=s.rect.right;let k=0;const P=()=>{k++,k>=4||(this.removeStyleFromTriangle(),x===Rs.top?(b=A-C/2,_=T-S-w,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.bottom="-5px",o&&_<0&&(x=Rs.right,P())):x===Rs.bottom?(b=A-C/2,_=R+w,this._triangleElement.style.left="50%",this._triangleElement.style.marginLeft="-5px",this._triangleElement.style.top="-5px",o&&_+S>p&&(x=Rs.left,P())):x===Rs.left?(_=M-S/2,b=B-C-w,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.right="-5px",o&&b<0&&(x=Rs.top,P())):x===Rs.right&&(_=M-S/2,b=E+w,this._triangleElement.style.top="50%",this._triangleElement.style.marginTop="-5px",this._triangleElement.style.left="-5px",o&&b+C>g&&(x=Rs.bottom,P())))};P()}return o&&(b<0?b=0:b+h.offsetWidth>g&&(b=g-h.offsetWidth)),{x:b+f-u,y:_+m-c}}removeStyleFromTriangle(){this._triangleElement.style.left="",this._triangleElement.style.right="",this._triangleElement.style.top="",this._triangleElement.style.bottom="",this._triangleElement.style.marginLeft="",this._triangleElement.style.marginTop=""}_locate(t,e,i,r,s,o){const a=this.getComputedPosition(t,e,i,r,s,o),l=a.x,h=a.y;this._rootElement.style.left=`${l}px`,this._rootElement.style.top=`${h}px`}}class yTt extends vTt{createTooltipElementInternal(){return new bTt}}const CTt={"bubble-tooltip":function(n){return new yTt(n)}};class STt{constructor(t,e){this._table=t,this._tooltipInstances={},this._bindTableEvent(t),this.confine=e}release(){var t,e;const i=this._tooltipInstances;for(const r in i)(e=(t=i[r])===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t);delete this._tooltipInstances,this._attachInfo=null}_bindToCell(t,e,i){var r;const s=this._attachInfo,o=this._getTooltipInstanceInfo(t,e);if(!s||o&&s.instance===o||((r=s.instance)===null||r===void 0||r.unbindTooltipElement(),this._attachInfo=null),!!o&&o&&o.bindTooltipElement(t,e,i,this.confine)){const a=this._table.getCellRange(t,e);this._attachInfo={range:a,instance:o,tooltipOptions:i}}}_move(t,e,i){const r=this._attachInfo;if(!r||!So(r.range,t,e))return;const{instance:s}=r;s==null||s.moveTooltipElement(t,e,i,this.confine)}moveToPosition(t,e,i,r){const s=this._attachInfo;if(!s||!So(s.range,t,e))return;const{instance:o}=s;this._attachInfo.tooltipOptions.position=i,this._attachInfo.tooltipOptions.referencePosition=r,o==null||o.locateTooltipElement(t,e,i,r,this.confine)}_unbindFromCell(){const t=this._attachInfo;if(!t)return;const{instance:e}=t;e==null||e.unbindTooltipElement(),this._attachInfo=null}_isBindCell(t,e){const i=this._attachInfo;return!!i&&So(i.range,t,e)}_bindTableEvent(t){t.on(mt.MOUSEENTER_CELL,e=>{if(XE())return;const{x1:i,x2:r,y1:s,y2:o}=t.stateManager.menu.bounds;if(t.stateManager.menu.isShow&&typeof e.x=="number"&&typeof e.y=="number"&&e.x>i&&e.x<r&&e.y>s&&e.y<o)return;const{col:a,row:l}=e;this.showTooltip(a,l)}),t.on(mt.MOUSEMOVE_CELL,e=>{var i,r;if(!XE()){if(!((r=(i=this._attachInfo)===null||i===void 0?void 0:i.tooltipOptions)===null||r===void 0)&&r.referencePosition){const s=this._attachInfo.tooltipOptions.referencePosition,{event:o}=e,{left:a,right:l,top:h,bottom:d}=s.rect,u=t._getMouseAbstractPoint(o);u.inTable&&u.x>=a-5&&u.x<=l+5&&u.y>=h-5&&u.y<=d+5||this._unbindFromCell()}this._attachInfo&&t.stateManager.menu.isShow&&this._bindToCell(e.col,e.row)}}),t.on(mt.MOUSELEAVE_CELL,e=>{this._unbindFromCell()}),t.on(mt.SELECTED_CELL,e=>{this._isBindCell(e.col,e.row)&&this._unbindFromCell()}),t.on(mt.MOUSELEAVE_TABLE,e=>{this._unbindFromCell()}),t.on(mt.SCROLL,e=>{this._unbindFromCell()})}showTooltip(t,e){var i,r,s;let o;const a=this._table,l=a.getHeaderDescription(t,e);if(l){const h=a.getCellRangeRelativeRect({col:t,row:e});o={content:l,referencePosition:{placement:a.internalProps.tooltip.position,rect:h},disappearDelay:(i=a.internalProps.tooltip.overflowTextTooltipDisappearDelay)!==null&&i!==void 0?i:0,style:a.theme.tooltipStyle}}else if(it((r=a.internalProps.tooltip)===null||r===void 0?void 0:r.isShowOverflowTextTooltip)?a.internalProps.tooltip.isShowOverflowTextTooltip(t,e,a):a.internalProps.tooltip.isShowOverflowTextTooltip){const h=a.getCellOverflowText(t,e),d=a.getCellRangeRelativeRect({col:t,row:e});h&&(o={content:l?`${l}
  ${h}`:h,referencePosition:{placement:a.internalProps.tooltip.position,rect:d},disappearDelay:(s=a.internalProps.tooltip.overflowTextTooltipDisappearDelay)!==null&&s!==void 0?s:0,style:a.theme.tooltipStyle})}o?this._bindToCell(t,e,o):this._unbindFromCell()}_getTooltipInstanceInfo(t,e){const i=this._table,r=this._tooltipInstances;return r&&r["bubble-tooltip"]||r&&(r["bubble-tooltip"]=CTt["bubble-tooltip"](i))}isBinded(t){var e;return JSON.stringify(t)===JSON.stringify((e=this._attachInfo)===null||e===void 0?void 0:e.tooltipOptions)}}const xTt=()=>{Jt.registerComponent("axis",YMt),Jt.registerFunction("computeAxisComponentWidth",qMt),Jt.registerFunction("computeAxisComponentHeight",ZMt),Jt.registerFunction("getAxisConfigInPivotChart",B1t)},wTt=()=>{Jt.registerComponent("emptyTip",QMt)},ATt=()=>{Jt.registerFunction("createLegend",hTt)},MTt=()=>{Jt.registerComponent("menuHandler",fTt)},TTt=()=>{Jt.registerComponent("title",mTt)},kTt=()=>{Jt.registerComponent("tooltipHandler",STt)};class RTt{constructor(t){this.titleRows=[],this.showedTitleRows=[],this.rowNow=-1,this.skipStartRow=-1,this.skipEndRow=-1,this.table=t,this.table.on("scroll",e=>{e.scrollDirection==="vertical"&&this.updateGroupTitle()}),this.table.on("tree_hierarchy_state_change",e=>{this.updateGroupTitle()}),this.table.on("resize_column",e=>{this.updateGroupTitle()})}updateGroupTitle(){this.table.scrollTop===0?(this.titleRows=[],this.showedTitleRows=[]):this.skipStartRow!==-1&&this.skipEndRow!==-1&&this.skipStartRow!==this.table.scenegraph.proxy.bodyTopRow-1?(this.table.scenegraph.proxy.screenTopRow<=this.skipStartRow||this.table.scenegraph.proxy.screenTopRow>=this.skipEndRow)&&(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()):(this.skipStartRow=-1,this.skipEndRow=-1,this.updateGroupTitleInfo()),this.updateScenegraph()}updateGroupTitleInfo(){this.rowNow=this.table.scenegraph.proxy.screenTopRow+this.titleRows.length;const t=this.table.getRecordIndexByCell(0,this.rowNow),e=this.table.getRecordIndexByCell(0,this.rowNow+1);this.getTitleRowsByRecordIndex(t,e)}getTitleRowsByRecordIndex(t,e){V(t)||(t=[t]),V(e)||(e=[e]);for(let a=0;a<t.length;a++){const l=t.slice(0,a+1);this.table.dataSource.getRaw(l)}const i=[],r=e.length===t.length+1;let s=t.slice(0,r?t.length:t.length-1);const o=this.table.dataSource.currentIndexedData;for(let a=this.rowNow-this.table.columnHeaderLevelCount;a>=0;a--){const l=o[a];if(V(l)&&s.length===l.length){let h=!0;for(let d=0;d<l.length;d++)if(l[d]!==s[d]){h=!1;break}h&&(i.push(a+this.table.columnHeaderLevelCount),s=s.slice(0,s.length-1))}else if(l===t[0]){i.push(a+this.table.columnHeaderLevelCount);break}}this.titleRows=i.reverse()}updateScenegraph(){const{table:t}=this,{shadowGroup:e,shadowGroupFrozen:i}=PTt(t);this.showedTitleRows.length=0;let r=0;for(let s=0;s<t.colCount;s++){let o;s<t.frozenColCount?(o=new De({x:t.getColsWidth(0,s-1),y:t.getFrozenRowsHeight()}),i.add(o)):(o=new De({x:t.getColsWidth(t.frozenColCount,s-1),y:t.getFrozenRowsHeight()}),e.add(o)),o.col=s;for(let a=0;a<this.titleRows.length;a++){const l=this.titleRows[a];if(BTt(l,this.rowNow,t.scenegraph.proxy.screenTopRow,this.titleRows)){s===0&&r++;continue}s===0&&this.showedTitleRows.push(l);const h=t.scenegraph.getCell(s,l);if(h.role==="cell"){const d=TJ(h);d.setAttributes({y:40*a}),o.add(d)}else{const d=go(s,l,t,!0,!0);d.setAttributes({y:40*a}),o.add(d)}}}r>0&&this.skipStartRow===-1&&this.skipEndRow===-1&&(this.skipStartRow=t.scenegraph.proxy.screenTopRow-1,this.skipEndRow=t.scenegraph.proxy.screenTopRow+1)}}function BTt(n,t,e,i){return n===t&&n!==e+i.length-1?!0:n===e+i.indexOf(n)+1&&n<t}function TJ(n){const t=n.clone();if(t.role=n.role,t.col=n.col,t.row=n.row,t.mergeStartCol=n.mergeStartCol,t.mergeStartRow=n.mergeStartRow,t.mergeEndCol=n.mergeEndCol,t.mergeEndRow=n.mergeEndRow,t.contentWidth=n.contentWidth,t.contentHeight=n.contentHeight,t.role==="cell"){const e=wi({x:0,y:0,width:t.attribute.width,height:t.attribute.height});t.add(e)}if(n.type==="group"){const e=t;n.forEachChildren(i=>{const r=TJ(i);e.add(r)})}return t}function PTt(n){const t=n.scenegraph.colHeaderGroup,e=n.scenegraph.cornerHeaderGroup;if(!t.border){const s=wi({x:0,y:0,width:0,height:0,cursor:"pointer"});t.add(s),t.border=s,s.attachShadow(s.shadowRoot),s.name="border-rect",s.addEventListener("click",o=>{const a=n.listTreeStickCellPlugin.titleRows,{shadowTarget:l}=o.pickParams,h=_c(l),{col:d,row:u}=h;SV(u-a.indexOf(u),n)})}if(!e.border){const s=wi({x:0,y:0,width:0,height:0,cursor:"pointer"});e.add(s),e.border=s,s.attachShadow(s.shadowRoot),s.name="border-rect",s.addEventListener("click",o=>{const a=n.listTreeStickCellPlugin.titleRows,{shadowTarget:l}=o.pickParams,h=_c(l),{col:d,row:u}=h;SV(u-a.indexOf(u),n)})}const i=t.border.shadowRoot,r=e.border.shadowRoot;return i.removeAllChild(),r.removeAllChild(),{shadowGroup:i,shadowGroupFrozen:r}}function SV(n,t){const e=t.getDrawRange();if(L(n)&&n>=t.frozenRowCount){const i=t.getFrozenRowsHeight(),r=t.getRowsHeight(0,n-1);t.scrollTop=Math.min(r-i,t.getAllRowsHeight()-e.height)-1}t.scenegraph.updateNextFrame()}const ETt=()=>{Jt.registerComponent("listTreeStickCellPlugin",RTt)};function LTt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_){var b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G,tt,st;const ot=X1t()[d],rt=p._getCellStyle(r,s),pt=AM("padding",rt,r,s,p);if(L(pt)&&(l=pt),!n){const at=ol(r,s,f,p);v&&(n=p.scenegraph.highPerformanceGetCell(r,s,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:o,height:a,lineWidth:(y=(b=f==null?void 0:f.group)===null||b===void 0?void 0:b.lineWidth)!==null&&y!==void 0?y:void 0,fill:(S=(C=f==null?void 0:f.group)===null||C===void 0?void 0:C.fill)!==null&&S!==void 0?S:void 0,stroke:(x=(w=f==null?void 0:f.group)===null||w===void 0?void 0:w.stroke)!==null&&x!==void 0?x:void 0,strokeArrayWidth:at,strokeArrayColor:(M=(A=f==null?void 0:f.group)===null||A===void 0?void 0:A.strokeArrayColor)!==null&&M!==void 0?M:void 0,cursor:(R=(T=f==null?void 0:f.group)===null||T===void 0?void 0:T.cursor)!==null&&R!==void 0?R:void 0,lineDash:(E=(B=f==null?void 0:f.group)===null||B===void 0?void 0:B.lineDash)!==null&&E!==void 0?E:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius}),n&&n.role==="cell"||((n=new De({x:e,y:i,width:o,height:a,lineWidth:(P=(k=f==null?void 0:f.group)===null||k===void 0?void 0:k.lineWidth)!==null&&P!==void 0?P:void 0,fill:(O=(I=f==null?void 0:f.group)===null||I===void 0?void 0:I.fill)!==null&&O!==void 0?O:void 0,stroke:(z=(H=f==null?void 0:f.group)===null||H===void 0?void 0:H.stroke)!==null&&z!==void 0?z:void 0,strokeArrayWidth:at,strokeArrayColor:(j=(F=f==null?void 0:f.group)===null||F===void 0?void 0:F.strokeArrayColor)!==null&&j!==void 0?j:void 0,cursor:(Y=($=f==null?void 0:f.group)===null||$===void 0?void 0:$.cursor)!==null&&Y!==void 0?Y:void 0,lineDash:(tt=(G=f==null?void 0:f.group)===null||G===void 0?void 0:G.lineDash)!==null&&tt!==void 0?tt:void 0,lineCap:"butt",clip:!0,cornerRadius:f.group.cornerRadius})).role="cell",n.col=r,n.row=s,t==null||t.addCellGroup(n))}if(n.AABBBounds.width(),_&&Array.isArray(p.getCellValue(r,s))||!_){const at=new Mp(m,{stroke:!1,x:l[3],y:l[0],canvas:(st=p.canvas)!==null&&st!==void 0?st:p.scenegraph.stage.window.getContext().canvas,mode:p.options.mode,modeParams:p.options.modeParams,spec:p.options.specTransformInCell?p.options.specTransformInCell(u,r,s):u,ClassType:ot,width:o-l[3]-l[1],height:a-l[2]-l[0],chartInstance:c,dataId:g,data:p.getCellValue(r,s)||[],cellPadding:l,dpr:p.internalProps.pixelRatio,axes:p.isPivotChart()?p.internalProps.layoutMap.getChartAxes(r,s):[],tableChartOption:p.options.chartOption,col:r,row:s});n.appendChild(at),p.internalProps.layoutMap.setChartInstance(r,s,at.chartInstance)}return n}function ITt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v){var _,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G;if(!n){const pt=ol(r,s,p,g);v&&(n=g.scenegraph.highPerformanceGetCell(r,s,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:a,height:l,lineWidth:(b=(_=p==null?void 0:p.group)===null||_===void 0?void 0:_.lineWidth)!==null&&b!==void 0?b:void 0,fill:(C=(y=p==null?void 0:p.group)===null||y===void 0?void 0:y.fill)!==null&&C!==void 0?C:void 0,stroke:(w=(S=p==null?void 0:p.group)===null||S===void 0?void 0:S.stroke)!==null&&w!==void 0?w:void 0,strokeArrayWidth:pt,strokeArrayColor:(A=(x=p==null?void 0:p.group)===null||x===void 0?void 0:x.strokeArrayColor)!==null&&A!==void 0?A:void 0,cursor:(T=(M=p==null?void 0:p.group)===null||M===void 0?void 0:M.cursor)!==null&&T!==void 0?T:void 0,lineDash:(B=(R=p==null?void 0:p.group)===null||R===void 0?void 0:R.lineDash)!==null&&B!==void 0?B:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),n&&n.role==="cell"||((n=new De({x:e,y:i,width:a,height:l,lineWidth:(k=(E=p==null?void 0:p.group)===null||E===void 0?void 0:E.lineWidth)!==null&&k!==void 0?k:void 0,fill:(I=(P=p==null?void 0:p.group)===null||P===void 0?void 0:P.fill)!==null&&I!==void 0?I:void 0,stroke:(H=(O=p==null?void 0:p.group)===null||O===void 0?void 0:O.stroke)!==null&&H!==void 0?H:void 0,strokeArrayWidth:pt,strokeArrayColor:(F=(z=p==null?void 0:p.group)===null||z===void 0?void 0:z.strokeArrayColor)!==null&&F!==void 0?F:void 0,cursor:($=(j=p==null?void 0:p.group)===null||j===void 0?void 0:j.cursor)!==null&&$!==void 0?$:void 0,lineDash:(G=(Y=p==null?void 0:p.group)===null||Y===void 0?void 0:Y.lineDash)!==null&&G!==void 0?G:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",n.col=r,n.row=s,t==null||t.addCellGroup(n))}let tt;if(c){let pt=r,at=s;m&&(pt=m.start.col,at=m.start.row),tt=g.getCellIcons(pt,at)}let st=0,ot=0;if(Array.isArray(tt)&&tt.length!==0){const{leftIconWidth:pt,rightIconWidth:at,absoluteRightIconWidth:W}=Ff(tt,n,m,g);st=pt+at,ot=pt,n.forEachChildren(N=>{N.role==="icon-left"?N.setAttribute("x",N.attribute.x+h[3]):N.role==="icon-right"?N.setAttribute("x",N.attribute.x+a-at-h[1]):N.role==="icon-absolute-right"&&N.setAttribute("x",N.attribute.x+a-W-h[1])}),n.forEachChildren(N=>{u==="middle"?N.setAttribute("y",(l-N.AABBBounds.height())/2):u==="bottom"?N.setAttribute("y",l-N.AABBBounds.height()-h[2]):N.setAttribute("y",h[0])})}const rt=OTt(r,s,o-st,a,l,h,p,f,g);return rt&&n.appendChild(rt),rt.render(),a-=h[1]+h[3]+st,l-=h[0]+h[2],d==="center"?rt.setAttribute("x",h[3]+ot+(a-rt.AABBBounds.width())/2):d==="right"?rt.setAttribute("x",h[3]+ot+a-rt.AABBBounds.width()):rt.setAttribute("x",h[3]+ot),u==="middle"?rt.setAttribute("y",h[0]+(l-rt.AABBBounds.height())/2):u==="bottom"?rt.setAttribute("y",h[0]+l-rt.AABBBounds.height()):rt.setAttribute("y",h[0]),n}function OTt(n,t,e,i,r,s,o,a,l){var h,d,u,c;const g=l._getCellStyle(n,t),p=Mt("size",g,n,t,l),f=Mt("spaceBetweenTextAndIcon",g,n,t,l),m=Mt("defaultFill",g,n,t,l),v=Mt("defaultStroke",g,n,t,l),_=Mt("disableFill",g,n,t,l),b=Mt("checkedFill",g,n,t,l),y=Mt("checkedStroke",g,n,t,l),C=Mt("disableCheckedFill",g,n,t,l),S=Mt("disableCheckedStroke",g,n,t,l),w=Mt("checkIconImage",g,n,t,l),x=Mt("indeterminateIconImage",g,n,t,l),A=l.getCellValue(n,t),M=l.getCellOriginValue(n,t);let T,R,B=(h=A)!==null&&h!==void 0?h:"";kt(A)?(T=A.checked,R=A.disable,B=(d=A.text)!==null&&d!==void 0?d:""):typeof A=="boolean"&&(T=A,B=""),T=l.stateManager.syncCheckedState(n,t,a.field,T);const E=Hs(n,t,l),k=l._getCellStyle(n,t),P=(u=k.autoWrapText)!==null&&u!==void 0?u:l.internalProps.autoWrapText,{lineClamp:I}=k,{checked:O,disable:H}=a;if(T==null||typeof T=="function"){const tt=ni(O,{col:n,row:t,table:l,context:null,value:A,dataValue:M});T=l.stateManager.syncCheckedState(n,t,a.field,tt)}const z=ni(H,{col:n,row:t,table:l,context:null,value:A,dataValue:M}),F=e==="auto",j=l.isAutoRowHeight(t),$={text:B.length===1?B[0]:B,maxLineWidth:F?1/0:i-(s[1]+s[3]+E)-p-f,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:I,wordBreak:"break-word",heightLimit:j?-1:r-Math.floor(s[0]+s[2]),pickable:!1,dx:E,whiteSpace:B.length!==1||P?"normal":"no-wrap"},Y={x:0,y:0,text:o.text?Object.assign({},o.text,$):$,icon:{width:Math.floor(p/1.4),height:Math.floor(p/1.4)},box:{width:p,height:p},spaceBetweenTextAndIcon:f,disabled:(c=R??z)!==null&&c!==void 0&&c};T==="indeterminate"?(Y.checked=void 0,Y.indeterminate=!0):(Y.checked=T,Y.indeterminate=void 0),m&&(Y.box.fill=m),v&&(Y.box.stroke=v),_&&(Y.box.disableFill=_),b&&(Y.box.checkedFill=b),y&&(Y.box.checkedStroke=y),C&&(Y.box.disableCheckedFill=C),S&&(Y.box.disableCheckedStroke=S),w&&(Y.icon.checkIconImage=w),x&&(Y.icon.indeterminateIconImage=x);const G=new nf(Y);return G.name="checkbox",G}function DTt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f){var m,v,_,b,y,C,S,w,x,A,M,T;if(!n){const E=ol(r,s,g,c);(n=new De({x:e,y:i,width:a,height:l,lineWidth:(v=(m=g==null?void 0:g.group)===null||m===void 0?void 0:m.lineWidth)!==null&&v!==void 0?v:void 0,fill:(b=(_=g==null?void 0:g.group)===null||_===void 0?void 0:_.fill)!==null&&b!==void 0?b:void 0,stroke:(C=(y=g==null?void 0:g.group)===null||y===void 0?void 0:y.stroke)!==null&&C!==void 0?C:void 0,strokeArrayWidth:E,strokeArrayColor:(w=(S=g==null?void 0:g.group)===null||S===void 0?void 0:S.strokeArrayColor)!==null&&w!==void 0?w:void 0,cursor:(A=(x=g==null?void 0:g.group)===null||x===void 0?void 0:x.cursor)!==null&&A!==void 0?A:void 0,lineDash:(T=(M=g==null?void 0:g.group)===null||M===void 0?void 0:M.lineDash)!==null&&T!==void 0?T:void 0,lineCap:"butt",clip:!0,cornerRadius:g.group.cornerRadius})).role="cell",n.col=r,n.row=s,t==null||t.addCellGroup(n)}const{width:R,height:B}=FTt(r,s,o,a,l,h,g,p,n,f,c);return a-=h[1]+h[3],l-=h[0]+h[2],n.forEachChildren(E=>{d==="center"?E.setAttribute("x",h[3]+E.attribute.x+(a-R)/2):d==="right"?E.setAttribute("x",h[3]+E.attribute.x+a-R):E.setAttribute("x",h[3]+E.attribute.x),u==="middle"?E.setAttribute("y",h[0]+E.attribute.y+(l-B)/2):u==="bottom"?E.setAttribute("y",h[0]+E.attribute.y+l-B):E.setAttribute("y",h[0]+E.attribute.y)}),n}function FTt(n,t,e,i,r,s,o,a,l,h,d){var u,c,g,p;const f=d._getCellStyle(n,t);let m=Mt("size",f,n,t,d),v=Mt("innerRadius",f,n,t,d),_=Mt("outerRadius",f,n,t,d);const b=Mt("spaceBetweenTextAndIcon",f,n,t,d),y=Mt("spaceBetweenRadio",f,n,t,d),C=Mt("defaultFill",f,n,t,d),S=Mt("defaultStroke",f,n,t,d),w=Mt("disableFill",f,n,t,d),x=Mt("checkedFill",f,n,t,d),A=Mt("checkedStroke",f,n,t,d),M=Mt("disableCheckedFill",f,n,t,d),T=Mt("disableCheckedStroke",f,n,t,d);J(_)?m=2*_:_=Math.round(m/2),(!J(v)||v<0)&&(v=Math.round(_/7*3));const R=d.getCellValue(n,t),B=d.getCellOriginValue(n,t),E=Hs(n,t,d),k=d._getCellStyle(n,t),P=(u=k.autoWrapText)!==null&&u!==void 0?u:d.internalProps.autoWrapText,{lineClamp:I}=k,O=e==="auto",H=d.isAutoRowHeight(t),z={maxLineWidth:O?1/0:i-(s[1]+s[3]+E)-m-b,textAlign:"left",textBaseline:"top",autoWrapText:P,lineClamp:I,wordBreak:"break-word",heightLimit:H?-1:r-Math.floor(s[0]+s[2]),pickable:!1,dx:E},F={x:0,y:0,text:o.text?Object.assign({},o.text,z):z,circle:{innerRadius:v,outerRadius:_},spaceBetweenTextAndIcon:b};C&&(F.circle.fill=C),S&&(F.circle.stroke=S),w&&(F.circle.disableFill=w),x&&(F.circle.checkedFill=x),A&&(F.circle.checkedStroke=A),M&&(F.circle.disableCheckedFill=M),T&&(F.circle.disableCheckedStroke=T);let j=0,$=0;const Y=(c=a.radioDirectionInCell)!==null&&c!==void 0?c:"vertical";if(V(R))R.forEach((G,tt)=>{var st,ot;const rt=xV(G,B,tt,n,t,a,P,F,d);rt&&l.appendChild(rt),rt.id=`radio-${(st=h==null?void 0:h.start.col)!==null&&st!==void 0?st:n}-${(ot=h==null?void 0:h.start.row)!==null&&ot!==void 0?ot:t}-${tt}`,rt.render();const pt=rt.AABBBounds;Y==="vertical"?(rt.setAttribute("y",$),$+=pt.height()+(tt!==R.length-1?y:0),j=Math.max(j,pt.width())):Y==="horizontal"&&(rt.setAttribute("x",j),j+=pt.width()+(tt!==R.length-1?y:0),$=Math.max($,pt.height()))});else{const G=xV(R,B,void 0,n,t,a,P,F,d);G&&l.appendChild(G),G.id=`radio-${(g=h==null?void 0:h.start.col)!==null&&g!==void 0?g:n}-${(p=h==null?void 0:h.start.row)!==null&&p!==void 0?p:t}`,G.render();const tt=G.AABBBounds;j=tt.width(),$=tt.height()}return{width:j,height:$}}function xV(n,t,e,i,r,s,o,a,l){const h=HTt(n,t,e,i,r,s,l),d=zTt(n,t,i,r,s,l),u=kt(n)?n.text:Re(n)?"":n??"",c=Z({},a,{checked:h,disabled:d,text:{text:u.length===1?u[0]:u,whiteSpace:u.length!==1||o?"normal":"no-wrap"},boundsPadding:0}),g=new rf(c);return g.name="radio",g}function HTt(n,t,e,i,r,s,o){var a,l;const h=(a=s.radioCheckType)!==null&&a!==void 0?a:"column";let d,u;return kt(n)?d=n.checked:typeof n=="boolean"&&(d=n),d=o.stateManager.syncRadioState(i,r,s.field,h,e,d),d!=null&&typeof d!="function"||(u=ni(s.checked,{col:i,row:r,table:o,context:null,value:n,dataValue:t}),d=o.stateManager.syncRadioState(i,r,s.field,h,e,u)),(l=d??u)!==null&&l!==void 0&&l}function zTt(n,t,e,i,r,s){var o;let a;kt(n)&&(a=n.disable);const l=ni(r.disable,{col:e,row:i,table:s,context:null,value:n,dataValue:t});return(o=a??l)!==null&&o!==void 0&&o}function WTt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v){var _,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G;if(!n){const pt=ol(r,s,p,g);v&&(n=g.scenegraph.highPerformanceGetCell(r,s,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:a,height:l,lineWidth:(b=(_=p==null?void 0:p.group)===null||_===void 0?void 0:_.lineWidth)!==null&&b!==void 0?b:void 0,fill:(C=(y=p==null?void 0:p.group)===null||y===void 0?void 0:y.fill)!==null&&C!==void 0?C:void 0,stroke:(w=(S=p==null?void 0:p.group)===null||S===void 0?void 0:S.stroke)!==null&&w!==void 0?w:void 0,strokeArrayWidth:pt,strokeArrayColor:(A=(x=p==null?void 0:p.group)===null||x===void 0?void 0:x.strokeArrayColor)!==null&&A!==void 0?A:void 0,cursor:(T=(M=p==null?void 0:p.group)===null||M===void 0?void 0:M.cursor)!==null&&T!==void 0?T:void 0,lineDash:(B=(R=p==null?void 0:p.group)===null||R===void 0?void 0:R.lineDash)!==null&&B!==void 0?B:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),n&&n.role==="cell"||((n=new De({x:e,y:i,width:a,height:l,lineWidth:(k=(E=p==null?void 0:p.group)===null||E===void 0?void 0:E.lineWidth)!==null&&k!==void 0?k:void 0,fill:(I=(P=p==null?void 0:p.group)===null||P===void 0?void 0:P.fill)!==null&&I!==void 0?I:void 0,stroke:(H=(O=p==null?void 0:p.group)===null||O===void 0?void 0:O.stroke)!==null&&H!==void 0?H:void 0,strokeArrayWidth:pt,strokeArrayColor:(F=(z=p==null?void 0:p.group)===null||z===void 0?void 0:z.strokeArrayColor)!==null&&F!==void 0?F:void 0,cursor:($=(j=p==null?void 0:p.group)===null||j===void 0?void 0:j.cursor)!==null&&$!==void 0?$:void 0,lineDash:(G=(Y=p==null?void 0:p.group)===null||Y===void 0?void 0:Y.lineDash)!==null&&G!==void 0?G:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",n.col=r,n.row=s,t==null||t.addCellGroup(n))}let tt;if(c){let pt=r,at=s;m&&(pt=m.start.col,at=m.start.row),tt=g.getCellIcons(pt,at)}let st=0,ot=0;if(Array.isArray(tt)&&tt.length!==0){const{leftIconWidth:pt,rightIconWidth:at,absoluteRightIconWidth:W}=Ff(tt,n,m,g);st=pt+at,ot=pt,n.forEachChildren(N=>{N.role==="icon-left"?N.setAttribute("x",N.attribute.x+h[3]):N.role==="icon-right"?N.setAttribute("x",N.attribute.x+a-at-h[1]):N.role==="icon-absolute-right"&&N.setAttribute("x",N.attribute.x+a-W-h[1])}),n.forEachChildren(N=>{u==="middle"?N.setAttribute("y",(l-N.AABBBounds.height())/2):u==="bottom"?N.setAttribute("y",l-N.AABBBounds.height()-h[2]):N.setAttribute("y",h[0])})}const rt=jTt(r,s,o-st,a,l,h,p,f,g);return rt&&n.appendChild(rt),rt.render(),a-=h[1]+h[3]+st,l-=h[0]+h[2],d==="center"?rt.setAttribute("x",h[3]+ot+(a-rt.AABBBounds.width())/2):d==="right"?rt.setAttribute("x",h[3]+ot+a-rt.AABBBounds.width()):rt.setAttribute("x",h[3]+ot),u==="middle"?rt.setAttribute("y",h[0]+(l-rt.AABBBounds.height())/2):u==="bottom"?rt.setAttribute("y",h[0]+l-rt.AABBBounds.height()):rt.setAttribute("y",h[0]),n}function jTt(n,t,e,i,r,s,o,a,l){var h,d,u,c;const g=l._getCellStyle(n,t),p=Mt("spaceBetweenTextAndCircle",g,n,t,l),f=Mt("circleRadius",g,n,t,l),m=Mt("boxWidth",g,n,t,l),v=Mt("boxHeight",g,n,t,l),_=Mt("checkedFill",g,n,t,l),b=Mt("uncheckedFill",g,n,t,l),y=Mt("disableCheckedFill",g,n,t,l),C=Mt("disableUncheckedFill",g,n,t,l),S=Mt("circleFill",g,n,t,l),w=l.getCellValue(n,t),x=l.getCellOriginValue(n,t);let A,M,T=(h=w)!==null&&h!==void 0?h:"";kt(w)?(A=w.checked,M=w.disable,T=(d=w.text)!==null&&d!==void 0?d:""):typeof w=="boolean"&&(A=w,T=""),A=l.stateManager.syncCheckedState(n,t,a.field,A);const R=Hs(n,t,l),B=l._getCellStyle(n,t),E=(u=B.autoWrapText)!==null&&u!==void 0?u:l.internalProps.autoWrapText,{lineClamp:k}=B,{checked:P,disable:I,uncheckedText:O,checkedText:H}=a;if(A==null||typeof A=="function"){const ot=ni(P,{col:n,row:t,table:l,context:null,value:w,dataValue:x});A=l.stateManager.syncCheckedState(n,t,a.field,ot)}const z=ni(I,{col:n,row:t,table:l,context:null,value:w,dataValue:x}),F=ni(H,{col:n,row:t,table:l,context:null,value:w,dataValue:x}),j=ni(O,{col:n,row:t,table:l,context:null,value:w,dataValue:x}),$=e==="auto",Y=l.isAutoRowHeight(t),G={text:T.length===1?T[0]:T,maxLineWidth:$?1/0:i-(s[1]+s[3]+R)-2*f-p,textAlign:"left",textBaseline:"top",autoWrapText:E,lineClamp:k,wordBreak:"break-word",heightLimit:Y?-1:r-Math.floor(s[0]+s[2]),pickable:!1,dx:R,whiteSpace:T.length!==1||E?"normal":"no-wrap",checkedText:F,uncheckedText:j},tt={x:0,y:0,text:o.text?Object.assign({},o.text,G):G,circle:{radius:f},box:{width:m,height:v},spaceBetweenTextAndCircle:p,disabled:(c=M??z)!==null&&c!==void 0&&c};tt.checked=A,b&&(tt.box.uncheckedFill=b),C&&(tt.box.disableUncheckedFill=C),_&&(tt.box.checkedFill=_),y&&(tt.box.disableCheckedFill=y),S&&(tt.circle.fill=S);const st=new j_(tt);return st.name="switch",st}const wh=new DMt,Ah=new PM;function NTt(n,t,e,i,r,s,o,a,l,h,d,u){var c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H;if(!n){const F=ol(r,s,d,h);u&&(n=h.scenegraph.highPerformanceGetCell(r,s,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:o,height:a,lineWidth:(g=(c=d==null?void 0:d.group)===null||c===void 0?void 0:c.lineWidth)!==null&&g!==void 0?g:void 0,fill:(f=(p=d==null?void 0:d.group)===null||p===void 0?void 0:p.fill)!==null&&f!==void 0?f:void 0,stroke:(v=(m=d==null?void 0:d.group)===null||m===void 0?void 0:m.stroke)!==null&&v!==void 0?v:void 0,strokeArrayWidth:F,strokeArrayColor:(b=(_=d==null?void 0:d.group)===null||_===void 0?void 0:_.strokeArrayColor)!==null&&b!==void 0?b:void 0,cursor:(C=(y=d==null?void 0:d.group)===null||y===void 0?void 0:y.cursor)!==null&&C!==void 0?C:void 0,lineDash:(w=(S=d==null?void 0:d.group)===null||S===void 0?void 0:S.lineDash)!==null&&w!==void 0?w:void 0,lineCap:"butt",clip:!0,cornerRadius:d.group.cornerRadius}),n&&n.role==="cell"||((n=new De({x:e,y:i,width:o,height:a,lineWidth:(A=(x=d==null?void 0:d.group)===null||x===void 0?void 0:x.lineWidth)!==null&&A!==void 0?A:void 0,fill:(T=(M=d==null?void 0:d.group)===null||M===void 0?void 0:M.fill)!==null&&T!==void 0?T:void 0,stroke:(B=(R=d==null?void 0:d.group)===null||R===void 0?void 0:R.stroke)!==null&&B!==void 0?B:void 0,strokeArrayWidth:F,strokeArrayColor:(k=(E=d==null?void 0:d.group)===null||E===void 0?void 0:E.strokeArrayColor)!==null&&k!==void 0?k:void 0,cursor:(I=(P=d==null?void 0:d.group)===null||P===void 0?void 0:P.cursor)!==null&&I!==void 0?I:void 0,lineDash:(H=(O=d==null?void 0:d.group)===null||O===void 0?void 0:O.lineDash)!==null&&H!==void 0?H:void 0,lineCap:"butt",clip:!0,cornerRadius:d.group.cornerRadius})).role="cell",n.col=r,n.row=s,t==null||t.addCellGroup(n))}const z=$Tt(r,s,o,a,l,h);return z&&n.appendChild(z),n}function $Tt(n,t,e,i,r,s){let o,a;const l=s.internalProps.layoutMap.getBody(n,t).sparklineSpec,h=s.getCellValue(n,t);if(!Array.isArray(h))return;const d=r[3],u=r[0];e-=r[1]+r[3];const c=i-=r[0]+r[2];if(typeof l=="function"){const b={col:n,row:t,dataValue:s.getCellOriginValue(n,t)||"",value:s.getCellValue(n,t)||"",rect:s.getCellRangeRelativeRect(s.getCellRange(n,t)),table:s};o=l(b),a=wV(o,d,u,e,i)}else o=l,a=wV(l,d,u,e,i);const g=[],p=[];let f,m;if(typeof o.xField=="object")wh.domain(o.xField.domain),f=o.xField.field;else if(typeof o.xField=="string"){const b=h.map(y=>y[o.xField]);wh.domain(b),f=o.xField}else Array.isArray(h)&&(wh.domain(Array.from({length:h.length},(b,y)=>y)),f=o.xField);if(wh.range([0,e]),typeof o.yField=="object")Ah.domain(o.yField.domain),m=o.yField.field;else if(typeof o.yField=="string"){const b=AV(h,o.yField);Ah.domain([Math.min(...b),Math.max(...b)]),m=o.yField}else if(Array.isArray(h)){const b=AV(h);Ah.domain([Math.min(...b),Math.max(...b)]),m=o.yField}if(Ah.range([0,i]),typeof o.xField=="object"&&Array.isArray(o.xField.domain)){const b=h.map(C=>C[o.xField.field]),y=o.xField.domain;for(let C=0;C<y.length;C++){let S=!1;for(let w=0;w<b.length;w++)if(y[C]===b[w]){const x=h[w];if(!L(x[f])||!L(x[m]))break;g.push({x:0+wh.scale(x[f]),y:c-Ah.scale(x[m]),defined:L(x[m])}),p.push(x),S=!0;break}S||(g.push({x:0+wh.scale(y[C]),y:0,defined:!1}),p.push({[f]:y[C],[m]:null}))}}else for(let b=0;b<h.length;b++){const y=h[b];g.push({x:0+wh.scale(f?y[f]:b),y:c-Ah.scale(m?y[m]:y),defined:L(m?y[m]:y),rawData:y}),p.push(y)}const v=a.getChildByName("sparkline-line");v&&v.setAttribute("points",g),v.bandwidth=wh.step(),v.min=Ah.range()[0],v.max=Ah.range()[1];const _=a.getChildByName("sparkline-symbol-group");if(_){const b=o.pointShowRule==="isolatedPoint";if(o.pointShowRule==="all")for(let y=0;y<g.length;y++){const{x:C,y:S,defined:w}=g[y];if(w){const x=Zp({x:C,y:S});_.appendChild(x)}}else if(b)for(let y=0;y<g.length;y++){const{x:C,y:S,defined:w}=g[y];if(w&&(!g[y-1]||!g[y-1].defined)&&(!g[y+1]||!g[y+1].defined)){const x=Zp({x:C,y:S});_.appendChild(x)}}}return a}function wV(n,t,e,i,r){var s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M;let T;T=typeof n=="function"?n(null):n;const R=new De({x:t,y:e,width:i,height:r,stroke:!1,fill:!1});if(R.name="sparkline",T.type==="line"){const B=Os({x:0,y:0,curveType:T.smooth?"monotoneX":"linear",stroke:(a=(o=(s=T.line)===null||s===void 0?void 0:s.style)===null||o===void 0?void 0:o.stroke)!==null&&a!==void 0?a:"blue",lineWidth:(d=(h=(l=T.line)===null||l===void 0?void 0:l.style)===null||h===void 0?void 0:h.strokeWidth)!==null&&d!==void 0?d:2});B.name="sparkline-line",R.addChild(B),T.crosshair&&(B.hover=(c=(u=T.crosshair)===null||u===void 0?void 0:u.style)!==null&&c!==void 0?c:{stroke:"#000",interpolate:"linear"});const E=new De({x:0,y:0,width:i,height:r,stroke:!1,fill:!1});E.name="sparkline-symbol-group",E.setTheme({symbol:{stroke:(f=(p=(g=T.point)===null||g===void 0?void 0:g.style)===null||p===void 0?void 0:p.stroke)!==null&&f!==void 0?f:"#000",lineWidth:(_=(v=(m=T.point)===null||m===void 0?void 0:m.style)===null||v===void 0?void 0:v.strokeWidth)!==null&&_!==void 0?_:1,fill:(C=(y=(b=T.point)===null||b===void 0?void 0:b.style)===null||y===void 0?void 0:y.fill)!==null&&C!==void 0?C:"#000",size:2*((x=(w=(S=T.point)===null||S===void 0?void 0:S.style)===null||w===void 0?void 0:w.size)!==null&&x!==void 0?x:3),symbolType:"circle"}}),R.addChild(E),E.hover=(M=(A=T.point)===null||A===void 0?void 0:A.hover)!==null&&M!==void 0&&M}return R}function AV(n,t){const e=[];for(let i=0;i<n.length;i++){const r=n[i];L(t)&&L(r[t])?e.push(r[t]):!L(t)&&L(r)&&e.push(r)}return e}const bB=ra();function VTt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m){var v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G,tt,st,ot,rt,pt;const at=g._getCellStyle(i,r),W=AM("padding",at,i,r,g);!((v=g.options.customConfig)===null||v===void 0)&&v.imageMargin?h=Be((_=g.options.customConfig)===null||_===void 0?void 0:_.imageMargin):L(W)&&(h=W),!((b=p==null?void 0:p.text)===null||b===void 0)&&b.textAlign&&(d=(y=p==null?void 0:p.text)===null||y===void 0?void 0:y.textAlign),!((C=p==null?void 0:p.text)===null||C===void 0)&&C.textBaseline&&(u=(S=p==null?void 0:p.text)===null||S===void 0?void 0:S.textBaseline);const N=ol(i,r,p,g);let K,nt;if(m&&(K=g.scenegraph.highPerformanceGetCell(i,r,!0),K&&K.role==="cell"&&K.setAttributes({x:t,y:e,width:s,height:o,lineWidth:(x=(w=p==null?void 0:p.group)===null||w===void 0?void 0:w.lineWidth)!==null&&x!==void 0?x:void 0,fill:(M=(A=p==null?void 0:p.group)===null||A===void 0?void 0:A.fill)!==null&&M!==void 0?M:void 0,stroke:(R=(T=p==null?void 0:p.group)===null||T===void 0?void 0:T.stroke)!==null&&R!==void 0?R:void 0,strokeArrayWidth:N,strokeArrayColor:(E=(B=p==null?void 0:p.group)===null||B===void 0?void 0:B.strokeArrayColor)!==null&&E!==void 0?E:void 0,cursor:(P=(k=p==null?void 0:p.group)===null||k===void 0?void 0:k.cursor)!==null&&P!==void 0?P:void 0,lineDash:(O=(I=p==null?void 0:p.group)===null||I===void 0?void 0:I.lineDash)!==null&&O!==void 0?O:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})),K&&K.role==="cell"||(K=new De({x:t,y:e,width:s,height:o,lineWidth:(z=(H=p==null?void 0:p.group)===null||H===void 0?void 0:H.lineWidth)!==null&&z!==void 0?z:void 0,fill:(j=(F=p==null?void 0:p.group)===null||F===void 0?void 0:F.fill)!==null&&j!==void 0?j:void 0,stroke:(Y=($=p==null?void 0:p.group)===null||$===void 0?void 0:$.stroke)!==null&&Y!==void 0?Y:void 0,strokeArrayWidth:N,strokeArrayColor:(tt=(G=p==null?void 0:p.group)===null||G===void 0?void 0:G.strokeArrayColor)!==null&&tt!==void 0?tt:void 0,cursor:(ot=(st=p==null?void 0:p.group)===null||st===void 0?void 0:st.cursor)!==null&&ot!==void 0?ot:void 0,lineDash:(pt=(rt=p==null?void 0:p.group)===null||rt===void 0?void 0:rt.lineDash)!==null&&pt!==void 0?pt:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),K.role="cell",K.col=i,K.row=r,n==null||n.addCellGroup(K)),c){let ut=i,lt=r;f&&(ut=f.start.col,lt=f.start.row),nt=g.getCellIcons(ut,lt)}let X=0,ht=0;if(Array.isArray(nt)&&nt.length!==0){const{leftIconWidth:ut,rightIconWidth:lt,absoluteRightIconWidth:At}=Ff(nt,K,f,g);X=ut,ht=lt,K.forEachChildren(ft=>{ft.role==="icon-left"?ft.setAttribute("x",ft.attribute.x+h[3]):ft.role==="icon-right"?ft.setAttribute("x",ft.attribute.x+s-lt-h[1]):ft.role==="icon-absolute-right"&&ft.setAttribute("x",ft.attribute.x+s-At-h[1])}),K.forEachChildren(ft=>{u==="middle"?ft.setAttribute("y",(o-ft.AABBBounds.height())/2):u==="bottom"?ft.setAttribute("y",o-ft.AABBBounds.height()-h[2]):ft.setAttribute("y",h[0])}),K._cellLeftIconWidth=X,K._cellRightIconWidth=ht}const _t=g.getCellValue(i,r),ct=document.createElement("video");ct.addEventListener("loadeddata",()=>{l&&Pq(i,r,ct.videoWidth,ct.videoHeight,g.scenegraph,h,K);const{width:ut,height:lt,isMerge:At}=sf(K,g);if(a){const{width:Gt,height:Ge}=wM(ct.videoWidth,ct.videoHeight,ut-h[1]-h[3],lt-h[0]-h[2]),He=aD(0,0,ut,lt,Gt,Ge,d,u,h);U.setAttributes({width:Gt,height:Ge,x:He.x,y:He.y,dx:0})}else U.setAttributes({x:h[3],y:h[0],width:ut-h[1]-h[3],height:lt-h[2]-h[0],dy:0});At&&lD(K.mergeStartCol,K.mergeEndCol,K.mergeStartRow,K.mergeEndRow,g);const{width:ft,height:Ct}=sf(K,g),Ht=Math.floor(Math.min(ft-h[1]-h[3],Ct-h[2]-h[0])/2),Xt=0+(ft>U.attribute.width?U.attribute.x-0+U.attribute.width/2:ft/2),ae=0+(Ct>U.attribute.height?U.attribute.y-0+U.attribute.height/2:Ct/2),re=K.getChildByName("image",!0),{dx:be,dy:Xe}=re.attribute,_i=new vc({x:Xt-Ht/2,y:ae-Ht/2,width:Ht,height:Ht,image:bB.play.svg,cursor:bB.play.cursor,dx:be,dy:Xe});_i.name="play-icon",K.appendChild(_i),g.scenegraph.updateNextFrame()}),ct.onerror=()=>{U.image=bB.damage_pic.svg},ct.src=_t,ct.setAttribute("preload","auto");const U=oM({x:h[3],y:h[0],width:s-h[1]-h[3],height:o-h[2]-h[0],image:ct,cursor:"pointer"});return U.name="image",U.keepAspectRatio=a,U.textAlign=d,U.textBaseline=u,K.appendChild(U),K}function GTt(n,t,e){if(typeof n=="boolean"){const i=_S({x:t.attribute.width,y:0,startAngle:Math.PI/2,endAngle:Math.PI,outerRadius:6,fill:"#3073F2",pickable:!1});i.name="mark",t.appendChild(i)}else{const{bgColor:i="#3073F2",shape:r="sector",position:s="right-top",size:o=10,offset:a=0}=n;let l,h,d,u,c,g;if(r==="sector")s==="right-top"?(l=t.attribute.width-a,h=a,d=Math.PI/2,u=Math.PI):s==="left-top"?(l=a,h=a,d=0,u=Math.PI/2):s==="right-bottom"?(l=t.attribute.width-a,h=t.attribute.height-a,d=Math.PI,u=Math.PI/2*3):s==="left-bottom"&&(l=a,h=t.attribute.height-a,d=Math.PI/2*3,u=2*Math.PI),c=i,g=_S({x:l,y:h,startAngle:d,endAngle:u,outerRadius:o,fill:c,pickable:!1});else if(r==="triangle"){let p,f,m,v;s==="right-top"?(l=t.attribute.width-a,h=a,p=l-o,f=h,m=l,v=h+o):s==="left-top"?(l=a,h=a,p=l+o,f=h,m=l,v=h+o):s==="right-bottom"?(l=t.attribute.width-a,h=t.attribute.height-a,p=l-o,f=h,m=l,v=h-o):s==="left-bottom"&&(l=a,h=t.attribute.height-a,p=l+o,f=h,m=l,v=h-o),c=i,g=$X({points:[{x:l,y:h},{x:p,y:f},{x:m,y:v}],fill:c,pickable:!1})}else r==="rect"&&(s==="right-top"?(l=t.attribute.width-o-a,h=a):s==="left-top"?(l=a,h=a):s==="right-bottom"?(l=t.attribute.width-o-a,h=t.attribute.height-o-a):s==="left-bottom"&&(l=a,h=t.attribute.height-o-a),c=i,g=wi({x:l,y:h,width:o,height:o,fill:c,pickable:!1}));g.name="mark",t.appendChild(g)}}function UTt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_){var b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G,tt,st,ot,rt,pt,at,W,N,K,nt;const X=n._getCellStyle(s,o),ht=AM("padding",X,s,o,n);L(ht)&&(d=ht),!((b=m==null?void 0:m.text)===null||b===void 0)&&b.textAlign&&(u=(y=m==null?void 0:m.text)===null||y===void 0?void 0:y.textAlign),!((C=m==null?void 0:m.text)===null||C===void 0)&&C.textBaseline&&(c=(S=m==null?void 0:m.text)===null||S===void 0?void 0:S.textBaseline);const _t=n.isAutoRowHeight(o),ct=a==="auto",U=(w=X.autoWrapText)!==null&&w!==void 0?w:n.internalProps.autoWrapText,ut=X.lineClamp,lt=ol(s,o,m,n);let At;if(_&&(At=n.scenegraph.getCell(s,o,!0),At&&At.role==="cell"&&At.setAttributes({x:i,y:r,width:l,height:h,lineWidth:(A=(x=m==null?void 0:m.group)===null||x===void 0?void 0:x.lineWidth)!==null&&A!==void 0?A:void 0,fill:(T=(M=m==null?void 0:m.group)===null||M===void 0?void 0:M.fill)!==null&&T!==void 0?T:void 0,stroke:(B=(R=m==null?void 0:m.group)===null||R===void 0?void 0:R.stroke)!==null&&B!==void 0?B:void 0,strokeArrayWidth:lt??void 0,strokeArrayColor:(k=(E=m==null?void 0:m.group)===null||E===void 0?void 0:E.strokeArrayColor)!==null&&k!==void 0?k:void 0,cursor:(I=(P=m==null?void 0:m.group)===null||P===void 0?void 0:P.cursor)!==null&&I!==void 0?I:void 0,lineDash:(H=(O=m==null?void 0:m.group)===null||O===void 0?void 0:O.lineDash)!==null&&H!==void 0?H:void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius})),At&&At.role==="cell"||(At=new De({x:i,y:r,width:l,height:h,lineWidth:(F=(z=m==null?void 0:m.group)===null||z===void 0?void 0:z.lineWidth)!==null&&F!==void 0?F:void 0,fill:($=(j=m==null?void 0:m.group)===null||j===void 0?void 0:j.fill)!==null&&$!==void 0?$:void 0,stroke:(G=(Y=m==null?void 0:m.group)===null||Y===void 0?void 0:Y.stroke)!==null&&G!==void 0?G:void 0,strokeArrayWidth:lt??void 0,strokeArrayColor:(st=(tt=m==null?void 0:m.group)===null||tt===void 0?void 0:tt.strokeArrayColor)!==null&&st!==void 0?st:void 0,cursor:(rt=(ot=m==null?void 0:m.group)===null||ot===void 0?void 0:ot.cursor)!==null&&rt!==void 0?rt:void 0,lineDash:(at=(pt=m==null?void 0:m.group)===null||pt===void 0?void 0:pt.lineDash)!==null&&at!==void 0?at:void 0,lineCap:"butt",clip:!0,cornerRadius:m.group.cornerRadius}),At.role="cell",At.col=s,At.row=o,e==null||e.addCellGroup(At)),p&&At.appendChild(p),f){const ft=t;let Ct;if(g){let Ht=s,Xt=o;v&&(Ht=v.start.col,Xt=v.start.row),Ct=n.getCellIcons(Ht,Xt)}wyt(At,Ct,ft,d,ct,_t,U,typeof ut=="number"?ut:void 0,At.attribute.width,At.attribute.height,u,c,n,m,v),!((W=m==null?void 0:m._vtable)===null||W===void 0)&&W.marked&&GTt((N=m==null?void 0:m._vtable)===null||N===void 0?void 0:N.marked,At)}return p&&At.setAttributes({width:Math.max(At.attribute.width,(K=p.attribute.width)!==null&&K!==void 0?K:0),height:Math.max(At.attribute.height,(nt=p.attribute.height)!==null&&nt!==void 0?nt:0)}),At}function YTt(n,t,e,i,r,s,o,a,l,h){var d,u,c,g,p;if(n.dependField){const at=ni(n.dependField,{col:s,row:o,table:l,value:i,dataValue:r,cellHeaderPaths:void 0});r=(u=(d=l.getCellOriginRecord(s,o))===null||d===void 0?void 0:d[at])!==null&&u!==void 0?u:r}const f=(c=ni(n.barType,{col:s,row:o,table:l,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&c!==void 0?c:"default",m=(g=ni(n.min,{col:s,row:o,table:l,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&g!==void 0?g:0,v=(p=ni(n.max,{col:s,row:o,table:l,value:i,dataValue:r,cellHeaderPaths:void 0}))!==null&&p!==void 0?p:m+100;let _=0;_=h?l.getRowsHeight(h.start.row,h.end.row):l.getRowHeight(o);let b=e,y=_,C=0;J(l.theme._contentOffset)&&(C=l.theme._contentOffset);const S=new De({x:-C,y:-C,width:b,height:y});S.name="progress-bar";const{showBar:w,barColor:x,barBgColor:A,barPositiveColor:M,barNegativeColor:T,barAxisColor:R,barRightToLeft:B,showBarMark:E,barMarkPositiveColor:k,barMarkNegativeColor:P,barMarkWidth:I,barMarkPosition:O,barMarkInBar:H}=t;let{barHeight:z,barBottom:F,barPadding:j}=t;j.length===1?j=[j[0],j[0],j[0],j[0]]:j.length===2?j=[j[0],j[1],j[0],j[1]]:j.length===3&&(j=[j[0],j[1],j[2],j[1]]),j=j.map((at,W)=>{if(typeof at=="string"&&my.endsWith(at,"%")){const N=Number(at.substr(0,at.length-1));return W===0||W===2?_*N/100:e*N/100}return Number(at)});const $=Be(Mt("borderLineWidth",t,s,o,l)),Y=Math.max(j[0],Math.ceil($[0]/2));let G=Math.max(j[1],Math.floor($[1]/2));const tt=Math.max(j[2],Math.floor($[2]/2));let st=Math.max(j[3],Math.ceil($[3]/2));E&&I>0&&O==="right"&&H===!1&&(G+=I,st+=I),b-=G+st,y-=tt+Y,o===l.rowCount-1&&[0,"0"].includes(F)&&(y-=1);const ot=Y,rt=st,pt=b;if(typeof z=="string"&&my.endsWith(z,"%")?(z=Number(z.substr(0,z.length-1)),z=y*z/100):z=Number(z),typeof F=="string"&&my.endsWith(F,"%")?(F=Number(F.substr(0,F.length-1)),F=y*F/100):F=Number(F),ni(w,{col:s,row:o,table:l,context:null,value:i,dataValue:r})){let at=`${r}`;my.endsWith(at,"%")&&(at=at.substr(0,at.length-1));const W=Number(at);if(isNaN(W))return S;if((f??"default")==="default"){const N=W<m?0:W>v?1:(W-m)/(v-m),K=b,nt=ot+y-z-F;let X=Math.min(K*N,K);const ht=B?rt+pt-X:rt;s!==l.colCount-1||N!==1||B||(X-=1);const _t=ni(A,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:N});if(_t){const ut=wi({x:ht,y:nt,width:K,height:z,fill:_t});S.addChild(ut)}const ct=ni(x,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:N})||"#20a8d8",U=wi({x:ht,y:nt,width:X,height:z,fill:ct});S.addChild(U)}else if(f==="negative"){const N=m<0?-m:0,K=v>0?v:0,nt=N/(N+K),X=1-nt,ht=W>0?W/K:0,_t=W<0?-W/N:0,ct=b,U=ot+y-z-F,ut=rt,lt=ni(A,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:ht});if(lt){const He=wi({x:ut,y:U,width:ct,height:z,fill:lt});S.addChild(He)}const At=B?X*ct:nt*ct,ft=Math.min(ct*nt*_t,ct),Ct=B?{left:ut+At,top:U,width:ft,height:z}:{left:ut+At-ft,top:U,width:ft,height:z},Ht=ni(T,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:_t})||"#20a8d8",Xt=wi({x:Ct.left,y:Ct.top,width:Ct.width,height:Ct.height,fill:Ht});S.addChild(Xt);let ae=Math.min(ct*X*ht,ct);s!==l.colCount-1||ht!==1||B||(ae-=1);const re=B?{left:ut+At-ae,top:U,width:ae,height:z}:{left:ut+At,top:U,width:ae,height:z},be=ni(M,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:ht})||"#20a8d8",Xe=wi({x:re.left,y:re.top,width:re.width,height:re.height,fill:be});S.addChild(Xe);const _i=B?Ct.left:re.left,Gt=ni(R,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:ht}),Ge=Os({x:0,y:0,stroke:Gt,lineWidth:1,lineDash:[2,2],points:[{x:_i,y:0},{x:_i,y:_}]});if(S.addChild(Ge),E&&(ht||_t)){const He=I,ci=[];let Vr;if(ht>0)if(Vr=ni(k,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:ht})||"#20a8d8",O==="right"){const Mr=B?re.left+I/2:re.left+re.width+(H?-I/2:I/2);ci.push({x:Mr,y:re.top}),ci.push({x:Mr,y:re.top+re.height})}else O==="bottom"&&(ci.push({x:re.left,y:re.top+re.height-I/2}),ci.push({x:re.left+re.width,y:re.top+re.height-I/2}));else if(_t>0)if(Vr=ni(P,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:_t})||"#20a8d8",O==="right"){const Mr=B?Ct.left+Ct.width-I/2:Ct.left+I/2;ci.push({x:Mr,y:Ct.top}),ci.push({x:Mr,y:Ct.top+Ct.height})}else O==="bottom"&&(ci.push({x:Ct.left,y:Ct.top+Ct.height-I/2}),ci.push({x:Ct.left+Ct.width,y:Ct.top+Ct.height-I/2}));const Ln=Os({x:0,y:0,stroke:Vr,lineWidth:He,points:ci});S.addChild(Ln)}}else if(f==="negative_no_axis"){const N=m<0?-m:0,K=v>0?v:0,nt=Math.max(N,K),X=nt===0?0:Math.abs(W)/nt,ht=b;let _t=Math.min(ht*X,ht);s!==l.colCount-1||X!==1||B||(_t-=1);const ct=ot+y-z-F,U=B?rt+pt-_t:rt,ut=ni(A,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:X});if(ut){const Ct=wi({x:U,y:ct,width:ht,height:z,fill:ut});S.addChild(Ct)}const lt={left:U,top:ct,width:_t,height:z};let At;At=W>=0?ni(M,{col:s,row:o,table:l,context:null,value:i,percentile:X,dataValue:r})||"#20a8d8":ni(T,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:X})||"#20a8d8";const ft=wi({x:lt.left,y:lt.top,width:lt.width,height:lt.height,fill:At});if(S.addChild(ft),E&&W){const Ct=I,Ht=[];let Xt;if(Xt=W>=0?ni(k,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:X})||"#20a8d8":ni(P,{col:s,row:o,table:l,context:null,value:i,dataValue:r,percentile:X})||"#20a8d8",O==="right"){const re=B?lt.left+I/2:lt.left+lt.width-I/2;Ht.push({x:re,y:lt.top}),Ht.push({x:re,y:lt.top+lt.height})}else O==="bottom"&&(Ht.push({x:lt.left,y:lt.top+lt.height-I/2}),Ht.push({x:lt.left+lt.width,y:lt.top+lt.height-I/2}));const ae=Os({x:0,y:0,stroke:Xt,lineWidth:Ct,points:Ht});S.addChild(ae)}}}return S}function XTt(n,t,e,i,r,s){var o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C;if(e!=null&&e.zero&&(n=Math.min(n,0),t=Math.max(t,0)),e==null?void 0:e.expand){const x=n,A=t;L(e.expand.min)&&(n=x-(A-x)*e.expand.min),L(e.expand.max)&&(t=A+(A-x)*e.expand.max)}let S,w;if(J(e==null?void 0:e.min)&&(n=e.min),J(e==null?void 0:e.max)&&(t=e.max),(e==null?void 0:e.type)==="log"?(S=new BD,S.base((o=e==null?void 0:e.base)!==null&&o!==void 0?o:10)):(e==null?void 0:e.type)==="symlog"?(S=new PD,S.constant((a=e==null?void 0:e.constant)!==null&&a!==void 0?a:10)):S=new PM,S.domain([n,t],!!(e!=null&&e.nice)),s)KTt(S,s);else if(e!=null&&e.nice){let x=(u=(h=(l=e.tick)===null||l===void 0?void 0:l.forceTickCount)!==null&&h!==void 0?h:(d=e.tick)===null||d===void 0?void 0:d.tickCount)!==null&&u!==void 0?u:10;it(x)&&(x=x({axisLength:r,labelStyle:(g=(c=e==null?void 0:e.label)===null||c===void 0?void 0:c.style)!==null&&g!==void 0?g:{fontSize:Xm.LABEL_FONT_SIZE}})),e.niceType==="accurateFirst"&&(x=Math.max(10,x)),D(e.min)&&D(e.max)?S.nice(x):L(e.min)&&D(e.max)?S.niceMax(x):D(e.min)&&L(e.max)&&S.niceMin(x)}return delete S._niceType,w=((f=(p=s==null?void 0:s.targetTicks)===null||p===void 0?void 0:p.length)!==null&&f!==void 0?f:!((m=e==null?void 0:e.tick)===null||m===void 0)&&m.forceTickCount)?S.forceTicks((_=(v=s==null?void 0:s.targetTicks)===null||v===void 0?void 0:v.length)!==null&&_!==void 0?_:(b=e==null?void 0:e.tick)===null||b===void 0?void 0:b.forceTickCount):S.ticks(J((y=e==null?void 0:e.tick)===null||y===void 0?void 0:y.tickCount)?e.tick.tickCount:5,{noDecimals:(C=e==null?void 0:e.tick)===null||C===void 0?void 0:C.noDecimals}),{range:S.domain(),ticks:w}}function KTt(n,t){n.niceMax(t.targetTicks.length)}function qTt(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v){var _,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O,H,z,F,j,$,Y,G;if(!n){const pt=ol(r,s,p,g);v&&(n=g.scenegraph.highPerformanceGetCell(r,s,!0))&&n.role==="cell"&&n.setAttributes({x:e,y:i,width:a,height:l,lineWidth:(b=(_=p==null?void 0:p.group)===null||_===void 0?void 0:_.lineWidth)!==null&&b!==void 0?b:void 0,fill:(C=(y=p==null?void 0:p.group)===null||y===void 0?void 0:y.fill)!==null&&C!==void 0?C:void 0,stroke:(w=(S=p==null?void 0:p.group)===null||S===void 0?void 0:S.stroke)!==null&&w!==void 0?w:void 0,strokeArrayWidth:pt,strokeArrayColor:(A=(x=p==null?void 0:p.group)===null||x===void 0?void 0:x.strokeArrayColor)!==null&&A!==void 0?A:void 0,cursor:(T=(M=p==null?void 0:p.group)===null||M===void 0?void 0:M.cursor)!==null&&T!==void 0?T:void 0,lineDash:(B=(R=p==null?void 0:p.group)===null||R===void 0?void 0:R.lineDash)!==null&&B!==void 0?B:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius}),n&&n.role==="cell"||((n=new De({x:e,y:i,width:a,height:l,lineWidth:(k=(E=p==null?void 0:p.group)===null||E===void 0?void 0:E.lineWidth)!==null&&k!==void 0?k:void 0,fill:(I=(P=p==null?void 0:p.group)===null||P===void 0?void 0:P.fill)!==null&&I!==void 0?I:void 0,stroke:(H=(O=p==null?void 0:p.group)===null||O===void 0?void 0:O.stroke)!==null&&H!==void 0?H:void 0,strokeArrayWidth:pt,strokeArrayColor:(F=(z=p==null?void 0:p.group)===null||z===void 0?void 0:z.strokeArrayColor)!==null&&F!==void 0?F:void 0,cursor:($=(j=p==null?void 0:p.group)===null||j===void 0?void 0:j.cursor)!==null&&$!==void 0?$:void 0,lineDash:(G=(Y=p==null?void 0:p.group)===null||Y===void 0?void 0:Y.lineDash)!==null&&G!==void 0?G:void 0,lineCap:"butt",clip:!0,cornerRadius:p.group.cornerRadius})).role="cell",n.col=r,n.row=s,t==null||t.addCellGroup(n))}let tt;if(c){let pt=r,at=s;m&&(pt=m.start.col,at=m.start.row),tt=g.getCellIcons(pt,at)}let st=0,ot=0;if(Array.isArray(tt)&&tt.length!==0){const{leftIconWidth:pt,rightIconWidth:at,absoluteRightIconWidth:W}=Ff(tt,n,m,g);st=pt+at,ot=pt,n.forEachChildren(N=>{N.role==="icon-left"?N.setAttribute("x",N.attribute.x+h[3]):N.role==="icon-right"?N.setAttribute("x",N.attribute.x+a-at-h[1]):N.role==="icon-absolute-right"&&N.setAttribute("x",N.attribute.x+a-W-h[1])}),n.forEachChildren(N=>{u==="middle"?N.setAttribute("y",(l-N.AABBBounds.height())/2):u==="bottom"?N.setAttribute("y",l-N.AABBBounds.height()-h[2]):N.setAttribute("y",h[0])})}const rt=ZTt(r,s,o-st,a,l,h,p,f,g);return rt&&n.appendChild(rt),a-=h[1]+h[3]+st,l-=h[0]+h[2],d==="center"?rt.setAttribute("x",h[3]+ot+(a-rt.AABBBounds.width())/2):d==="right"?rt.setAttribute("x",h[3]+ot+a-rt.AABBBounds.width()):rt.setAttribute("x",h[3]+ot),u==="middle"?rt.setAttribute("y",h[0]+(l-rt.AABBBounds.height())/2):u==="bottom"?rt.setAttribute("y",h[0]+l-rt.AABBBounds.height()):rt.setAttribute("y",h[0]),n}function ZTt(n,t,e,i,r,s,o,a,l){var h,d;const u=l._getCellStyle(n,t),c=Mt("buttonColor",u,n,t,l),g=Mt("buttonBorderColor",u,n,t,l),p=Mt("buttonLineWidth",u,n,t,l),f=Mt("buttonBorderRadius",u,n,t,l),m=Mt("buttonHoverColor",u,n,t,l),v=Mt("buttonHoverBorderColor",u,n,t,l),_=Mt("buttonPadding",u,n,t,l),b=Mt("buttonTextHoverColor",u,n,t,l),y=Mt("buttonDisableColor",u,n,t,l),C=Mt("buttonDisableBorderColor",u,n,t,l),S=Mt("buttonTextDisableColor",u,n,t,l),w=l.getCellValue(n,t),x=l.getCellOriginValue(n,t),A=Hs(n,t,l),M=l._getCellStyle(n,t),T=(h=M.autoWrapText)!==null&&h!==void 0?h:l.internalProps.autoWrapText,{lineClamp:R}=M,B=e==="auto",E=l.isAutoRowHeight(t),{disable:k,text:P}=a,I=ni(k,{col:n,row:t,table:l,context:null,value:w,dataValue:x}),O=ni(P,{col:n,row:t,table:l,context:null,value:w,dataValue:x}),H=(d=O??w)!==null&&d!==void 0?d:"",z={maxLineWidth:B?1/0:i-(s[1]+s[3]+A),textAlign:"left",textBaseline:"top",autoWrapText:T,lineClamp:R,wordBreak:"break-word",heightLimit:E?-1:r-Math.floor(s[0]+s[2]),pickable:!1,dx:A,whiteSpace:H.length!==1||T?"normal":"no-wrap"},F=o.text?Object.assign({},o.text,z):z,j={x:0,y:0,cursor:I?"not-allowed":"pointer",disable:I,childrenPickable:!1,text:H.length===1?H[0]:H,textStyle:F,padding:_,panel:{visible:!0,fill:I?y:c,stroke:I?C:g,lineWidth:p,cornerRadius:f},state:{text:{hover:{}},panel:{hover:{fill:m,stroke:v}}}};S&&(j.state.text.fill=S),b&&(j.state.text.hover.fill=b);const $=new ib(j);return $.name="button",I||($.addEventListener("mouseenter",()=>{$.addState("hover",!0,!1),$.stage.renderNextFrame()}),$.addEventListener("mouseleave",()=>{$.removeState("hover",!1),$.stage.renderNextFrame()})),$}const JTt=()=>{Jt.registerFunction("createChartCellGroup",LTt),Jt.registerFunction("getAxisDomainRangeAndLabels",XTt)},QTt=()=>{Jt.registerFunction("createCheckboxCellGroup",ITt)},tkt=()=>{Jt.registerFunction("createImageCellGroup",Tyt)},ekt=()=>{Jt.registerFunction("createProgressBarCell",YTt)},ikt=()=>{Jt.registerFunction("createRadioCellGroup",DTt)},nkt=()=>{Jt.registerFunction("createSwitchCellGroup",WTt)},rkt=()=>{Jt.registerFunction("createButtonCellGroup",qTt)},skt=()=>{Jt.registerFunction("createSparkLineCellGroup",NTt)},okt=()=>{Jt.registerFunction("createTextCellGroup",UTt)},akt=()=>{Jt.registerFunction("createVideoCellGroup",VTt)};xTt(),wTt(),ATt(),MTt(),TTt(),kTt(),ETt(),F1t(),JTt(),QTt(),tkt(),ekt(),ikt(),nkt(),rkt(),skt(),okt(),akt();class lkt extends QAt{}const kJ=n=>n;var an;(function(n){n["desktop-browser"]="desktop-browser",n["mobile-browser"]="mobile-browser",n.node="node",n.worker="worker",n.miniApp="miniApp",n.wx="wx",n.tt="tt",n.harmony="harmony",n["desktop-miniApp"]="desktop-miniApp",n.lynx="lynx"})(an||(an={}));var vt;(function(n){n.cartesianAxis="cartesianAxis",n.cartesianBandAxis="cartesianAxis-band",n.cartesianLinearAxis="cartesianAxis-linear",n.cartesianTimeAxis="cartesianAxis-time",n.cartesianLogAxis="cartesianAxis-log",n.cartesianSymlogAxis="cartesianAxis-symlog",n.polarAxis="polarAxis",n.polarBandAxis="polarAxis-band",n.polarLinearAxis="polarAxis-linear",n.crosshair="crosshair",n.cartesianCrosshair="cartesianCrosshair",n.polarCrosshair="polarCrosshair",n.dataZoom="dataZoom",n.geoCoordinate="geoCoordinate",n.indicator="indicator",n.discreteLegend="discreteLegend",n.continuousLegend="continuousLegend",n.colorLegend="colorLegend",n.sizeLegend="sizeLegend",n.mapLabel="mapLabel",n.markLine="markLine",n.markArea="markArea",n.markPoint="markPoint",n.polarMarkLine="polarMarkLine",n.polarMarkArea="polarMarkArea",n.polarMarkPoint="polarMarkPoint",n.geoMarkPoint="geoMarkPoint",n.tooltip="tooltip",n.title="title",n.player="player",n.scrollBar="scrollBar",n.label="label",n.totalLabel="totalLabel",n.brush="brush",n.poptip="poptip",n.customMark="customMark"})(vt||(vt={}));const hkt=(n,t)=>{const{callback:e}=t;return e&&(n=n.filter(e)),n},EM=function(n,...t){return ukt(Pn(n),...t)};function RJ(n,t,e){const i=t[e];if(i===void 0)n[e]=null;else if(kt(i)){kt(n[e])||(n[e]={});for(const r in i)RJ(n[e],i,r)}else n[e]=i}function dkt(n,t){if(kt(t)&&n!==t)for(const e in t)RJ(n,t,e)}function ukt(n,...t){n||(n={});let e=-1;const i=t.length;for(;++e<i;)dkt(n,t[e]);return n}const ckt={tolerance:.01},gkt=(n,t)=>{const e=EM(ckt,t),{tolerance:i}=e;return vAt(n,i)};var Cc;(function(n){n.DSV="dsv",n.TREE="tree",n.GEO="geo",n.BYTE="bytejson",n.HEX="hex",n.GRAPH="graph",n.TABLE="table",n.GEO_GRATICULE="geo-graticule"})(Cc||(Cc={}));const pkt=(n,t)=>{const{fields:e,key:i,value:r,retains:s}=t,o=[];for(let a=0;a<n.length;a++)e.forEach(l=>{const h={};if(h[i]=l,h[r]=n[a][l],s)s.forEach(d=>{h[d]=n[a][d]});else for(const d in n[a])e.indexOf(d)===-1&&(h[d]=n[a][d]);o.push(h)});return o},BJ=(n,t)=>{var e,i;if(!(t!=null&&t.fields)||n.length===0)return n;const r=t.fields,s=n[0],o={},a=[];for(const l in r)if(Object.prototype.hasOwnProperty.call(r,l)){const h=r[l];if(!h.type){let u=s;l in s||(u=(e=n.find(c=>l in c))!==null&&e!==void 0?e:s),h.type=typeof u[l]=="number"?"linear":"ordinal"}let d;if(typeof h.sortIndex=="number"&&(d={key:l,type:h.type,index:h.sortIndex,sortIndex:{},sortIndexCount:0,sortReverse:h.sortReverse===!0},a.push(d)),((i=h.domain)===null||i===void 0?void 0:i.length)>0)if(h.type==="ordinal"){h._domainCache={},o[l]=h;const u={};h.domain.forEach((c,g)=>{u[c]=g,h._domainCache[c]=g}),d&&(d.sortIndex=u,d.sortIndexCount=h.domain.length)}else h.domain.length>=2&&(o[l]=h)}return Object.keys(o).length>0&&(n=n.filter(l=>{for(const h in o){const d=o[h];if(d.type==="ordinal"){if(!(l[h]in d._domainCache))return!1}else if(d.domain[0]>l[h]||d.domain[1]<l[h])return!1}return!0})),a.sort((l,h)=>l.index-h.index),n.sort((l,h)=>fkt(l,h,a)),n};function fkt(n,t,e){for(let i=0;i<e.length;i++){const r=e[i];let s=0;if(r.type==="ordinal"?(r.sortIndex[t[r.key]]===void 0&&(r.sortIndex[t[r.key]]=r.sortIndexCount++),r.sortIndex[n[r.key]]===void 0&&(r.sortIndex[n[r.key]]=r.sortIndexCount++),s=r.sortIndex[n[r.key]]-r.sortIndex[t[r.key]]):r.type==="linear"&&(s=n[r.key]-t[r.key]),r.sortReverse&&(s=-s),s!==0)return s}return 0}const mkt={delimiter:","},PJ=(n,t={},e)=>{e.type=Cc.DSV;const i=EM(mkt,t),{delimiter:r}=i;if(!yt(r))throw new TypeError("Invalid delimiter: must be a string!");return xD(r).parse(n)},EJ=(n,t={},e)=>(e.type=Cc.DSV,wAt(n)),LJ=(n,t={},e)=>(e.type=Cc.DSV,MAt(n)),MV=vD(),IJ={centroid:!1,name:!1,bbox:!1,rewind:!1},TV=n=>{if(n.geometry.type.startsWith("Multi")){const t=PAt(n).features[0];return Object.assign(Object.assign({},t),t.properties)}return Object.assign(Object.assign({},n),n.properties)},vkt=n=>{const t=[];return n.forEach(e=>{e.type==="FeatureCollection"?e.features.forEach(i=>{t.push(TV(i))}):t.push(TV(e))}),t},OJ=(n,t={},e)=>{e.type=Cc.GEO;const i=EM(IJ,t),{centroid:r,name:s,bbox:o,rewind:a}=i;if(Array.isArray(n))return vkt(n);let l=n.features;return a&&(l=BAt(n,{reverse:!kt(a)||a.reverse}).features),l.forEach(h=>{if(r){const d=MV.centroid(h);h.centroidX=d[0],h.centroidY=d[1]}if(s&&(h.name=h.properties.name),o){const d=MV.bounds(h);h.bbox=d}}),n.features=l,n},_kt={},bkt=(n,t,e)=>{e.type=Cc.GEO;const i=EM(IJ,_kt,t),{object:r}=i;if(!yt(r))throw new TypeError("Invalid object: must be a string!");const s=uAt(n,n.objects[r]);return OJ(s,i,e)},LM=(n,t,e)=>{const i=!Re(t==null?void 0:t.dependencyUpdate)||(t==null?void 0:t.dependencyUpdate);if(!n||!V(n))throw new TypeError("Invalid data: must be DataView array!");return V(e.rawData)&&e.rawData.forEach(r=>{r.target&&(r.target.removeListener("change",e.reRunAllTransform),r.target.removeListener("markRunning",e.markRunning))}),i&&n.forEach(r=>{r.target.addListener("change",e.reRunAllTransform),r.target.addListener("markRunning",e.markRunning)}),n};let yB=0;const ykt=1e8;function DJ(n="dataset"){return yB>ykt&&(yB=0),n+"_"+yB++}class Bd{constructor(t){var e;let i;this.options=t,this.isDataSet=!0,this.transformMap={},this.parserMap={},this.dataViewMap={},this.target=new us,i=t!=null&&t.name?t.name:DJ("dataset"),this.name=i,this._logger=(e=t==null?void 0:t.logger)!==null&&e!==void 0?e:ge.getInstance()}setLogger(t){this._logger=t}getDataView(t){return this.dataViewMap[t]}setDataView(t,e){var i;this.dataViewMap[t]&&((i=this._logger)===null||i===void 0||i.error(`Error: dataView ${t} `)),this.dataViewMap[t]=e}removeDataView(t){this.dataViewMap[t]=null,delete this.dataViewMap[t]}registerParser(t,e){var i;this.parserMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} `)),this.parserMap[t]=e}removeParser(t){this.parserMap[t]=null,delete this.parserMap[t]}getParser(t){return this.parserMap[t]||this.parserMap.default}registerTransform(t,e){var i;this.transformMap[t]&&((i=this._logger)===null||i===void 0||i.warn(`Warn: transform ${t} `)),this.transformMap[t]=e}removeTransform(t){this.transformMap[t]=null,delete this.transformMap[t]}getTransform(t){return this.transformMap[t]}multipleDataViewAddListener(t,e,i){this._callMap||(this._callMap=new Map);let r=this._callMap.get(i);r||(r=()=>{t.some(s=>s.isRunning)||i()}),t.forEach(s=>{s.target.addListener(e,r)}),this._callMap.set(i,r)}allDataViewAddListener(t,e){this.multipleDataViewAddListener(Object.values(this.dataViewMap),t,e)}multipleDataViewRemoveListener(t,e,i){if(this._callMap){const r=this._callMap.get(i);r&&t.forEach(s=>{s.target.removeListener(e,r)}),this._callMap.delete(i)}}multipleDataViewUpdateInParse(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.parseNewData(e.data,e.options)})}multipleDataViewUpdateInRawData(t){t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.markRunning()}),t.forEach(e=>{var i;return(i=this.getDataView(e.name))===null||i===void 0?void 0:i.updateRawData(e.data,e.options)})}destroy(){this.transformMap=null,this.parserMap=null,this.dataViewMap=null,this._callMap=null,this.target.removeAllListeners()}}const CB="_data-view-diff-rank";class Ve{constructor(t,e){let i;this.dataSet=t,this.options=e,this.isDataView=!0,this.target=new us,this.parseOption=null,this.transformsArr=[],this.isRunning=!1,this.rawData={},this.history=!1,this.parserData={},this.latestData={},this._fields=null,this.reRunAllTransform=(r={pushHistory:!0,emitMessage:!0})=>(this.isRunning=!0,this.resetTransformData(),this.transformsArr.forEach(s=>{this.executeTransform(s,{pushHistory:r.pushHistory,emitMessage:!1}),this.isLastTransform(s)&&this.diffLastData()}),this.isRunning=!1,r.emitMessage!==!1&&this.target.emit("change",[]),this),this.markRunning=()=>{this.isRunning=!0,this.target.emit("markRunning",[])},i=e!=null&&e.name?e.name:DJ("dataview"),this.name=i,e!=null&&e.history&&(this.history=e.history,this.historyData=[]),this.dataSet.setDataView(i,this),this.setFields(e==null?void 0:e.fields)}parse(t,e,i=!1){var r;this.isRunning=!0,i&&this.target.emit("beforeParse",[]),e&&(this.parseOption=e);const s=this.cloneParseData(t,e);if(e!=null&&e.type){const o=((r=this.dataSet.getParser(e.type))!==null&&r!==void 0?r:this.dataSet.getParser("bytejson"))(s,e.options,this);this.rawData=s,this.parserData=o,this.history&&this.historyData.push(s,o),this.latestData=o}else this.parserData=s,this.rawData=s,this.history&&this.historyData.push(s),this.latestData=s;return this.isRunning=!1,i&&this.target.emit("afterParse",[]),this}transform(t,e=!0){if(this.isRunning=!0,t&&t.type){let i=!0;if(t.type==="fields"){this._fields=t.options.fields;const r=this.transformsArr.findIndex(s=>s.type===t.type);r>=0&&(i=!1,this.transformsArr[r].options.fields=this._fields)}if(i&&this.transformsArr.push(t),e){const r=this.isLastTransform(t);this.executeTransform(t),r&&this.diffLastData()}}return this.sortTransform(),this.isRunning=!1,this}isLastTransform(t){return this.transformsArr[this.transformsArr.length-1]===t}sortTransform(){this.transformsArr.length>=2&&this.transformsArr.sort((t,e)=>{var i,r;return((i=t.level)!==null&&i!==void 0?i:0)-((r=e.level)!==null&&r!==void 0?r:0)})}executeTransform(t,e={pushHistory:!0,emitMessage:!0}){const{pushHistory:i,emitMessage:r}=e,s=this.dataSet.getTransform(t.type)(this.latestData,t.options);this.history&&i!==!1&&this.historyData.push(s),this.latestData=s,r!==!1&&this.target.emit("change",[])}resetTransformData(){this.latestData=this.parserData,this.history&&(this.historyData.length=0,this.historyData.push(this.rawData,this.parserData))}enableDiff(t){this._diffData=!0,this._diffKeys=t,this._diffMap=new Map,this._diffRank=0}disableDiff(){this._diffData=!1,this._diffMap=null,this._diffRank=null}resetDiff(){this._diffMap=new Map,this._diffRank=0}diffLastData(){var t;if(!this._diffData||!this.latestData.forEach||!(!((t=this._diffKeys)===null||t===void 0)&&t.length))return;const e=this._diffRank+1;if(this._diffRank===0)this.latestData.forEach(i=>{i[CB]=e,this._diffMap.set(this._diffKeys.reduce((r,s)=>r+i[s],""),i)}),this.latestDataAUD={add:Array.from(this.latestData),del:[],update:[]};else{let i;this.latestDataAUD={add:[],del:[],update:[]},this.latestData.forEach(r=>{r[CB]=e,i=this._diffKeys.reduce((s,o)=>s+r[o],""),this._diffMap.get(i)?this.latestDataAUD.update.push(r):this.latestDataAUD.add.push(r),this._diffMap.set(i,r)}),this._diffMap.forEach((r,s)=>{r[CB]<e&&(this.latestDataAUD.del.push(r),this._diffMap.delete(s))})}this._diffRank=e}cloneParseData(t,e){let i=!1;return t instanceof Ve||(e==null?void 0:e.clone)!==!0||(i=!0),i?Pn(t):t}parseNewData(t,e){this.parse(t,e||this.parseOption),this.reRunAllTransform()}updateRawData(t,e){const i=this.cloneParseData(t,e);this.rawData=i,this.parserData=i,this.latestData=i,this.reRunAllTransform()}getFields(){var t;return this._fields?this._fields:((t=this.parseOption)===null||t===void 0?void 0:t.type)==="dataview"&&this.rawData.length===1&&this.rawData[0].getFields?this.rawData[0].getFields():null}setFields(t,e=!1){this._fields=t&&e?Z({},this._fields,t):t;const i=this.transformsArr.find(r=>r.type==="fields");!D(this._fields)&&D(i)?(this.dataSet.registerTransform("fields",BJ),this.transform({type:"fields",options:{fields:this._fields}},!1)):i&&(i.options.fields=this._fields)}destroy(){this.dataSet.removeDataView(this.name),this._diffMap=null,this._diffRank=null,this.latestData=null,this.rawData=null,this.parserData=null,this.transformsArr=null,this.target=null}}class nn{static GenAutoIncrementId(){return nn.auto_increment_id++}}nn.auto_increment_id=0;class te{constructor(t){this.id=nn.GenAutoIncrementId(),this.registry=t}}const IM="named",FJ="inject",HJ="multi_inject",zJ="inversify:tagged",WJ="inversify:paramtypes";class LD{constructor(t,e){this.key=t,this.value=e}toString(){return this.key===IM?`named: ${String(this.value).toString()} `:`tagged: { key:${this.key.toString()}, value: ${String(this.value)} }`}}const Pp=function(n){var t;return function(e){const i=typeof Symbol=="function",r=i&&Symbol.toPrimitive!==void 0?Symbol.toPrimitive:"@@toPrimitive",s=Object.getPrototypeOf(Function),o=Map,a=new WeakMap;function l(k,P,I,O){if(!S(I))throw new TypeError;return v(k,P,I,O)}function h(k,P,I){if(!S(P))throw new TypeError;return b(I)||(I=T(I)),g(k,P,I)}function d(k,P,I){if(!S(P))throw new TypeError;return b(I)||(I=T(I)),p(k,P,I)}function u(k,P,I){if(!S(P))throw new TypeError;return b(I)||(I=T(I)),f(k,P,I)}function c(k,P,I){let O=a.get(k);if(b(O)){if(!I)return;O=new o,a.set(k,O)}let H=O.get(P);if(b(H)){if(!I)return;H=new o,O.set(P,H)}return H}function g(k,P,I){if(p(k,P,I))return!0;const O=E(P);return!y(O)&&g(k,O,I)}function p(k,P,I){const O=c(P,I,!1);return!b(O)&&A(O.has(k))}function f(k,P,I){if(p(k,P,I))return m(k,P,I);const O=E(P);return y(O)?void 0:f(k,O,I)}function m(k,P,I){const O=c(P,I,!1);if(!b(O))return O.get(k)}function v(k,P,I,O){c(I,O,!0).set(k,P)}function _(k){if(k===null)return 1;switch(typeof k){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return k===null?1:6;default:return 6}}function b(k){return k===void 0}function y(k){return k===null}function C(k){return typeof k=="symbol"}function S(k){return typeof k=="object"?k!==null:typeof k=="function"}function w(k,P){switch(_(k)){case 0:case 1:case 2:case 3:case 4:case 5:return k}const I="string",O=B(k,r);if(O!==void 0){const H=O.call(k,I);if(S(H))throw new TypeError;return H}return x(k)}function x(k,P){{const I=k.toString;if(R(I)){const H=I.call(k);if(!S(H))return H}const O=k.valueOf;if(R(O)){const H=O.call(k);if(!S(H))return H}}throw new TypeError}function A(k){return!!k}function M(k){return""+k}function T(k){const P=w(k);return C(P)?P:M(P)}function R(k){return typeof k=="function"}function B(k,P){const I=k[P];if(I!=null){if(!R(I))throw new TypeError;return I}}function E(k){const P=Object.getPrototypeOf(k);if(typeof k!="function"||k===s||P!==s)return P;const I=k.prototype,O=I&&Object.getPrototypeOf(I);if(O==null||O===Object.prototype)return P;const H=O.constructor;return typeof H!="function"||H===k?P:H}e("defineMetadata",l),e("hasMetadata",h),e("hasOwnMetadata",d),e("getMetadata",u)}((t=n,function(e,i){typeof t[e]!="function"&&Object.defineProperty(t,e,{configurable:!0,writable:!0,value:i})})),n}({});function Ckt(n,t,e,i){const r=[i];let s={};Pp.hasOwnMetadata(n,t)&&(s=Pp.getMetadata(n,t));let o=s[e];o===void 0&&(o=[]),o.push(...r),s[e]=o,Pp.defineMetadata(n,s,t)}function Skt(n,t,e,i){Ckt(zJ,n,e.toString(),i)}function jJ(n){return(t,e,i)=>{Skt(t,e,i,n)}}function NJ(n){return t=>(e,i,r)=>jJ(new LD(n,t))(e,i,r)}const ue=NJ(FJ),$J=NJ(HJ);function It(){return function(n){return Pp.defineMetadata(WJ,null,n),n}}function xn(n){return jJ(new LD(IM,n))}const Sc={Singleton:"Singleton",Transient:"Transient"},Zh={ConstantValue:"ConstantValue",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid"};class ID{constructor(t,e){this.id=nn.GenAutoIncrementId(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=Zh.Invalid,this.constraint=i=>!0,this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.dynamicValue=null}clone(){const t=new ID(this.serviceIdentifier,this.scope);return t.activated=t.scope===Sc.Singleton&&this.activated,t.implementationType=this.implementationType,t.dynamicValue=this.dynamicValue,t.scope=this.scope,t.type=this.type,t.provider=this.provider,t.constraint=this.constraint,t.cache=this.cache,t}}class xkt{getConstructorMetadata(t){return{compilerGeneratedMetadata:Pp.getMetadata(WJ,t),userGeneratedMetadata:Pp.getMetadata(zJ,t)||{}}}getPropertiesMetadata(t){throw new Error("")}}const wkt=n=>t=>{const e=i=>{if(i==null)return!1;if(i.key===n&&i.value===t)return!0;if(i.constructorArgsMetadata==null)return!1;const r=i.constructorArgsMetadata;for(let s=0;s<r.length;s++)if(r[s].key===n&&r[s].value===t)return!0;return!1};return e.metaData=new LD(n,t),e},Akt=wkt(IM);class Dy{constructor(t){this._binding=t}inRequestScope(){throw new Error("")}inSingletonScope(){return this._binding.scope=Sc.Singleton,this}inTransientScope(){return this._binding.scope=Sc.Transient,this}whenTargetNamed(t){return this._binding.constraint=Akt(t),this}}class Mkt{constructor(t){this._binding=t}to(t){return this._binding.type=Zh.Instance,this._binding.implementationType=t,new Dy(this._binding)}toSelf(){const t=this._binding.serviceIdentifier;return this.to(t)}toDynamicValue(t){return this._binding.type=Zh.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new Dy(this._binding)}toConstantValue(t){return this._binding.type=Zh.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=Sc.Singleton,new Dy(this._binding)}toFactory(t){return this._binding.type=Zh.Factory,this._binding.factory=t,this._binding.scope=Sc.Singleton,new Dy(this._binding)}toService(t){this.toDynamicValue(e=>e.container.get(t))}}class Tkt{constructor(t){const e=t||{};e.defaultScope=e.defaultScope||Sc.Transient,this.options=e,this.id=nn.GenAutoIncrementId(),this._bindingDictionary=new Map,this._metadataReader=new xkt}load(t){const e=this._getContainerModuleHelpersFactory()(t.id);t.registry(e.bindFunction,e.unbindFunction,e.isboundFunction,e.rebindFunction)}get(t){const e=this._getNotAllArgs(t,!1);return this._get(e)}getAll(t){const e=this._getAllArgs(t);return this._get(e)}getTagged(t,e,i){const r=this._getNotAllArgs(t,!1,e,i);return this._get(r)}getNamed(t,e){return this.getTagged(t,IM,e)}isBound(t){return this._bindingDictionary.has(t)}bind(t){const e=this.options.defaultScope,i=new ID(t,e),r=this._bindingDictionary.get(t)||[];return r.push(i),this._bindingDictionary.set(t,r),new Mkt(i)}unbind(t){this._bindingDictionary.delete(t)}rebind(t){return this.unbind(t),this.bind(t)}_getContainerModuleHelpersFactory(){const t=(o,a)=>{o._binding.moduleId=a},e=o=>a=>{const l=this.bind(a);return t(l,o),l},i=()=>o=>this.unbind(o),r=()=>o=>this.isBound(o),s=o=>a=>{const l=this.rebind(a);return t(l,o),l};return o=>({bindFunction:e(o),isboundFunction:r(),rebindFunction:s(o),unbindFunction:i(),unbindAsyncFunction:a=>null})}_getNotAllArgs(t,e,i,r){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:i,value:r}}_getAllArgs(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}}_get(t){const e=[];return this._bindingDictionary.get(t.serviceIdentifier).filter(i=>i.constraint(t)).forEach(i=>{e.push(this._resolveFromBinding(i))}),t.isMultiInject||e.length!==1?e:e[0]}_getChildRequest(t){const e=t.implementationType,{userGeneratedMetadata:i}=this._metadataReader.getConstructorMetadata(e),r=Object.keys(i),s=[];for(let o=0;o<r.length;o++){const a=i[o],l={};a.forEach(g=>{l[g.key]=g.value});const h={inject:l[FJ],multiInject:l[HJ]},d=h.inject||h.multiInject,u={serviceIdentifier:d,constructorArgsMetadata:a},c=(this._bindingDictionary.get(d)||[]).filter(g=>g.constraint(u));if(c.length){const g={injectIdentifier:d,metadata:a,bindings:c};s.push(g)}}return s}_resolveFromBinding(t){const e=this._getResolvedFromBinding(t);return this._saveToScope(t,e),e}_getResolvedFromBinding(t){let e;switch(t.type){case Zh.ConstantValue:case Zh.Function:e=t.cache;break;case Zh.Instance:e=this._resolveInstance(t,t.implementationType);break;default:e=t.dynamicValue({container:this})}return e}_resolveInstance(t,e){if(t.activated)return t.cache;const i=this._getChildRequest(t);return this._createInstance(e,i)}_createInstance(t,e){return e.length?new t(...this._resolveRequests(e)):new t}_resolveRequests(t){return t.map(e=>e.bindings.length>1?e.bindings.map(i=>this._resolveFromBinding(i)):this._resolveFromBinding(e.bindings[0]))}_saveToScope(t,e){t.scope===Sc.Singleton&&(t.cache=e,t.activated=!0)}}const en=Symbol("ContributionProvider");class VJ{constructor(t,e){this.serviceIdentifier=t,this.container=e}getContributions(){return this.caches||(this.caches=[],this.container&&this.container.isBound(this.serviceIdentifier)&&this.caches.push(...this.container.getAll(this.serviceIdentifier))),this.caches}}function Un(n,t){n(en).toDynamicValue(({container:e})=>new VJ(t,e)).inSingletonScope().whenTargetNamed(t)}function kkt(n,t){n(en).toDynamicValue(({container:e})=>new VJ(t,e)).whenTargetNamed(t)}class Rkt{constructor(t,e){this._args=t,this.name=e,this.taps=[]}tap(t,e){this._tap("sync",t,e)}unTap(t,e){const i=typeof t=="string"?t.trim():t.name;i&&(this.taps=this.taps.filter(r=>!(r.name===i&&(!e||r.fn===e))))}_parseOptions(t,e,i){let r;if(typeof e=="string")r={name:e.trim()};else if(typeof e!="object"||e===null)throw new Error("Invalid tap options");if(typeof r.name!="string"||r.name==="")throw new Error("Missing name for tap");return r=Object.assign({type:t,fn:i},r),r}_tap(t,e,i){this._insert(this._parseOptions(t,e,i))}_insert(t){let e;typeof t.before=="string"?e=new Set([t.before]):Array.isArray(t.before)&&(e=new Set(t.before));let i=0;typeof t.stage=="number"&&(i=t.stage);let r=this.taps.length;for(;r>0;){r--;const s=this.taps[r];this.taps[r+1]=s;const o=s.stage||0;if(e){if(e.has(s.name)){e.delete(s.name);continue}if(e.size>0)continue}if(!(o>i)){r++;break}}this.taps[r]=t}}class Zr extends Rkt{call(...t){this.taps.map(e=>e.fn).forEach(e=>e(...t))}}const OM=Symbol.for("EnvContribution"),OD=Symbol.for("VGlobal");var Bkt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},Pkt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},kV=function(n,t){return function(e,i){t(e,i,n)}},Ekt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};let DL=class{get env(){return this._env}get isImageAnonymous(){return this._isImageAnonymous}set isImageAnonymous(n){this._isImageAnonymous=n}get devicePixelRatio(){return this._env||this.setEnv("browser"),this.envContribution.getDevicePixelRatio()}get supportEvent(){return this._env||this.setEnv("browser"),this.envContribution.supportEvent}set supportEvent(n){this._env||this.setEnv("browser"),this.envContribution.supportEvent=n}get supportsTouchEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents}set supportsTouchEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsTouchEvents=n}get supportsPointerEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents}set supportsPointerEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsPointerEvents=n}get supportsMouseEvents(){return this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents}set supportsMouseEvents(n){this._env||this.setEnv("browser"),this.envContribution.supportsMouseEvents=n}get applyStyles(){return this._env||this.setEnv("browser"),this.envContribution.applyStyles}set applyStyles(n){this._env||this.setEnv("browser"),this.envContribution.applyStyles=n}constructor(n){this.contributions=n,this._isImageAnonymous=!0,this.id=nn.GenAutoIncrementId(),this.hooks={onSetEnv:new Zr(["lastEnv","env","global"])},this.measureTextMethod="native",this.optimizeVisible=!1}bindContribution(n){const t=[];if(this.contributions.getContributions().forEach(e=>{const i=e.configure(this,n);i&&i.then&&t.push(i)}),t.length)return Promise.all(t)}getDynamicCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getDynamicCanvasCount()}getStaticCanvasCount(){return this._env||this.setEnv("browser"),this.envContribution.getStaticCanvasCount()}setEnv(n,t){if(t&&t.force===!0||this._env!==n)return this.deactiveCurrentEnv(),this.activeEnv(n,t)}deactiveCurrentEnv(){this.envContribution&&this.envContribution.release()}activeEnv(n,t){const e=this._env;this._env=n;const i=this.bindContribution(t);if(i&&i.then)return i.then(()=>{this.envParams=t,this.hooks.onSetEnv.call(e,n,this)});this.envParams=t,this.hooks.onSetEnv.call(e,n,this)}setActiveEnvContribution(n){this.envContribution=n}createCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createCanvas(n)}createOffscreenCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.createOffscreenCanvas(n)}releaseCanvas(n){return this._env||this.setEnv("browser"),this.envContribution.releaseCanvas(n)}addEventListener(n,t,e){return this._env||this.setEnv("browser"),this.envContribution.addEventListener(n,t,e)}removeEventListener(n,t,e){return this._env||this.setEnv("browser"),this.envContribution.removeEventListener(n,t,e)}dispatchEvent(n){return this._env||this.setEnv("browser"),this.envContribution.dispatchEvent(n)}getRequestAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getRequestAnimationFrame()}getCancelAnimationFrame(){return this._env||this.setEnv("browser"),this.envContribution.getCancelAnimationFrame()}getElementById(n){return this._env||this.setEnv("browser"),this.envContribution.getElementById?this.envContribution.getElementById(n):null}getRootElement(){return this._env||this.setEnv("browser"),this.envContribution.getRootElement?this.envContribution.getRootElement():null}getDocument(){return this._env||this.setEnv("browser"),this.envContribution.getDocument?this.envContribution.getDocument():null}mapToCanvasPoint(n,t){return this._env||this.setEnv("browser"),this.envContribution.mapToCanvasPoint?this.envContribution.mapToCanvasPoint(n,t):null}loadImage(n){return this._env||this.setEnv("browser"),this.envContribution.loadImage(n)}loadSvg(n){return this._env||this.setEnv("browser"),this.envContribution.loadSvg(n)}loadJson(n){return this._env||this.setEnv("browser"),this.envContribution.loadJson(n)}loadArrayBuffer(n){return this._env||this.setEnv("browser"),this.envContribution.loadArrayBuffer(n)}loadBlob(n){return this._env||this.setEnv("browser"),this.envContribution.loadBlob(n)}loadFont(n,t,e){return Ekt(this,void 0,void 0,function*(){return this._env||this.setEnv("browser"),this.envContribution.loadFont(n,t,e)})}isChrome(){return this._isChrome!=null||(this._env||this.setEnv("browser"),this._isChrome=this._env==="browser"&&navigator.userAgent.indexOf("Chrome")>-1),this._isChrome}isSafari(){return this._isSafari!=null||(this._env||this.setEnv("browser"),this._isSafari=this._env==="browser"&&/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)),this._isSafari}getNativeAABBBounds(n){return this._env||this.setEnv("browser"),this.envContribution.getNativeAABBBounds(n)}removeDom(n){return this._env||this.setEnv("browser"),this.envContribution.removeDom(n)}createDom(n){return this._env||this.setEnv("browser"),this.envContribution.createDom(n)}updateDom(n,t){return this._env||this.setEnv("browser"),this.envContribution.updateDom(n,t)}getElementTop(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTop(n,t)}getElementLeft(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementLeft(n,t)}getElementTopLeft(n,t=!1){return this._env||this.setEnv("browser"),this.envContribution.getElementTopLeft(n,t)}isMacOS(){return this._env||this.setEnv("browser"),this.envContribution.isMacOS()}copyToClipBoard(n){return this._env||this.setEnv("browser"),this.envContribution.copyToClipBoard(n)}};DL=Bkt([It(),kV(0,ue(en)),kV(0,xn(OM)),Pkt("design:paramtypes",[Object])],DL);var Qu;(function(n){n[n.estimate=0]="estimate",n[n.actualBounding=1]="actualBounding",n[n.fontBounding=2]="fontBounding"})(Qu||(Qu={}));const Lkt=Ci-1e-8;class DD{constructor(t){this.init(t)}init(t){this.bounds=t}arc(t,e,i,r,s,o){if(Math.abs(s-r)>Lkt)return this.bounds.add(t-i,e-i),void this.bounds.add(t+i,e+i);let a,l,h,d,u=1/0,c=-1/0,g=1/0,p=-1/0;function f(m){h=i*Math.cos(m),d=i*Math.sin(m),h<u&&(u=h),h>c&&(c=h),d<g&&(g=d),d>p&&(p=d)}if(f(r),f(s),s!==r)if((r%=Ci)<0&&(r+=Ci),(s%=Ci)<0&&(s+=Ci),s<r&&(o=!o,a=r,r=s,s=a),o)for(s-=Ci,a=r-r%An,l=0;l<4&&a>s;++l,a-=An)f(a);else for(a=r-r%An+An,l=0;l<4&&a<s;++l,a+=An)f(a);this.bounds.add(t+u,e+g),this.bounds.add(t+c,e+p)}arcTo(t,e,i,r,s){this.bounds.add(t,e)}bezierCurveTo(t,e,i,r,s,o){this.bounds.add(t,e),this.bounds.add(i,r),this.bounds.add(s,o)}closePath(){}ellipse(){throw new Error("ellipse")}lineTo(t,e){this.bounds.add(t,e)}moveTo(t,e){this.bounds.add(t,e)}quadraticCurveTo(t,e,i,r){this.bounds.add(t,e),this.bounds.add(i,r)}rect(t,e,i,r){this.bounds.add(t,e),this.bounds.add(t+i,e+r)}clear(){this.bounds.clear()}release(...t){}}class Ikt{constructor(){this._curves=[],this.bounds=new ie}get curves(){return this._curves}getCurveLengths(){return this._curves.map(t=>t.getLength())}getPointAt(t){return{x:0,y:0}}getLength(){return 0}getBounds(){return this.bounds}}const Okt=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:[eE][-+]?\d+)?)/gi,Dkt={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,M:2,L:2,H:1,V:1,C:6,S:4,Q:4,T:2,A:7},ii={A:0,AT:1,C:2,Z:3,E:4,L:5,M:6,Q:7,R:8};let SB,RV,Fy,BV,xB,Hy;function Fkt(n){if(!n)return[];const t=n.match(/[mzlhvcsqta][^mzlhvcsqta]*/gi);if(t===null)return[];let e,i;const r=[];for(let s=0,o=t.length;s<o;s++)if(SB=t[s],RV=SB.slice(1),Fy=SB[0],e=[Fy],i=RV.match(Okt),i!==null){for(let a=0,l=i.length;a<l;a++)BV=i[a],xB=parseFloat(BV),Number.isNaN(xB)||e.push(xB);if(Hy=Dkt[Fy],e.length-1>Hy){let a,l=Fy;for(let h=1,d=e.length;h<d;h+=Hy){a=[l];for(let u=h,c=h+Hy;u<c;u++)a.push(e[u]);r.push(a),l==="m"?l="l":l==="M"&&(l="L")}}else r.push(e)}else r.push(e);return r}var fi;(function(n){n[n.NONE=0]="NONE",n[n.UPDATE_BOUNDS=1]="UPDATE_BOUNDS",n[n.UPDATE_SHAPE=2]="UPDATE_SHAPE",n[n.CLEAR_SHAPE=253]="CLEAR_SHAPE",n[n.UPDATE_SHAPE_AND_BOUNDS=3]="UPDATE_SHAPE_AND_BOUNDS",n[n.INIT=179]="INIT",n[n.CLEAR_BOUNDS=254]="CLEAR_BOUNDS",n[n.UPDATE_GLOBAL_MATRIX=32]="UPDATE_GLOBAL_MATRIX",n[n.CLEAR_GLOBAL_MATRIX=223]="CLEAR_GLOBAL_MATRIX",n[n.UPDATE_LOCAL_MATRIX=16]="UPDATE_LOCAL_MATRIX",n[n.CLEAR_LOCAL_MATRIX=239]="CLEAR_LOCAL_MATRIX",n[n.UPDATE_GLOBAL_LOCAL_MATRIX=48]="UPDATE_GLOBAL_LOCAL_MATRIX",n[n.UPDATE_LAYOUT=128]="UPDATE_LAYOUT",n[n.CLEAR_LAYOUT=127]="CLEAR_LAYOUT"})(fi||(fi={}));var lf;(function(n){n[n.GLOBAL=1]="GLOBAL",n[n.LOCAL=16]="LOCAL",n[n.GLOBAL_ACCURATE=3]="GLOBAL_ACCURATE",n[n.LOCAL_ACCURATE=48]="LOCAL_ACCURATE"})(lf||(lf={}));var qi;(function(n){n[n.INIT=0]="INIT",n[n.DEFAULT=1]="DEFAULT",n[n.STATE=2]="STATE",n[n.ANIMATE_BIND=10]="ANIMATE_BIND",n[n.ANIMATE_PLAY=11]="ANIMATE_PLAY",n[n.ANIMATE_START=12]="ANIMATE_START",n[n.ANIMATE_UPDATE=13]="ANIMATE_UPDATE",n[n.ANIMATE_END=14]="ANIMATE_END",n[n.TRANSLATE=20]="TRANSLATE",n[n.TRANSLATE_TO=21]="TRANSLATE_TO",n[n.SCALE=22]="SCALE",n[n.SCALE_TO=23]="SCALE_TO",n[n.ROTATE=24]="ROTATE",n[n.ROTATE_TO=25]="ROTATE_TO"})(qi||(qi={}));var pr;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSED=2]="PAUSED",n[n.END=3]="END"})(pr||(pr={}));var hf;(function(n){n[n.NORMAL=0]="NORMAL",n[n.SET_ATTR_IMMEDIATELY=1]="SET_ATTR_IMMEDIATELY"})(hf||(hf={}));var Vg;(function(n){n.wait="wait",n.from="from",n.to="to",n.customAnimate="customAnimate"})(Vg||(Vg={}));var li;(function(n){n[n.ROW=1]="ROW",n[n.COLUMN=2]="COLUMN"})(li||(li={}));var Q_;(function(n){n[n.CubicBezierCurve=0]="CubicBezierCurve",n[n.QuadraticBezierCurve=1]="QuadraticBezierCurve",n[n.ArcCurve=2]="ArcCurve",n[n.LineCurve=3]="LineCurve",n[n.EllipseCurve=4]="EllipseCurve",n[n.MoveCurve=5]="MoveCurve"})(Q_||(Q_={}));var cn;(function(n){n[n.beforeFillStroke=0]="beforeFillStroke",n[n.afterFillStroke=1]="afterFillStroke"})(cn||(cn={}));function Hkt(n,t,e,i,r,s,o,a,l){const h=Te(o),d=Math.sin(h),u=Math.cos(h),c=u*(a-n)*.5+d*(l-t)*.5,g=u*(l-t)*.5-d*(a-n)*.5;let p=c*c/((e=Math.abs(e))*e)+g*g/((i=Math.abs(i))*i);p>1&&(p=Math.sqrt(p),e*=p,i*=p);const f=u/e,m=d/e,v=-d/i,_=u/i,b=f*a+m*l,y=v*a+_*l,C=f*n+m*t,S=v*n+_*t;let w=1/((C-b)*(C-b)+(S-y)*(S-y))-.25;w<0&&(w=0);let x=Math.sqrt(w);s===r&&(x=-x);const A=.5*(b+C)-x*(S-y),M=.5*(y+S)+x*(C-b),T=Math.atan2(y-M,b-A);let R=Math.atan2(S-M,C-A)-T;R<0&&s===1?R+=Ci:R>0&&s===0&&(R-=Ci);const B=Math.ceil(Math.abs(R/(An+.001))),E=[];for(let k=0;k<B;++k){const P=T+k*R/B,I=T+(k+1)*R/B;E[k]=[A,M,P,I,e,i,d,u]}return E}function zkt(n){const t=n[0],e=n[1],i=n[2],r=n[3],s=n[4],o=n[5],a=n[6],l=n[7],h=l*s,d=-a*o,u=a*s,c=l*o,g=Math.cos(i),p=Math.sin(i),f=Math.cos(r),m=Math.sin(r),v=.5*(r-i),_=Math.sin(.5*v),b=8/3*_*_/Math.sin(v),y=t+g-b*p,C=e+p+b*g,S=t+f,w=e+m,x=S+b*m,A=w-b*f;return[h*y+d*C,u*y+c*C,h*x+d*A,u*x+c*A,h*S+d*w,u*S+c*w]}function PV(n,t,e,i){const r=Hkt(i[5],i[6],i[0],i[1],i[3],i[4],i[2],t,e);for(let s=0;s<r.length;++s){const o=zkt(r[s]);n.bezierCurveTo(o[0],o[1],o[2],o[3],o[4],o[5])}}const Wkt=(n,t,e,i,r,s,o)=>{const a=Math.abs(e-t),l=a>.5*Math.PI?Math.ceil(2*a/Math.PI):1,h=(e-t)/l;for(let d=0;d<l;d++){const u=t+h*d,c=t+h*(d+1),g=4*Math.tan(Math.abs(h)/4)/3,p=c<u?-1:1,f=Math.cos(u),m=Math.sin(u),v=Math.cos(c),_=Math.sin(c),b=f*s+i,y=m*o+r,C=v*s+i,S=_*o+r,w=s*g*p,x=o*g*p;n.push(b-w*m,y+x*f,C+w*_,S-x*v,C,S)}},jkt=[(n,t,e,i,r,s,o)=>t.arc(n[1]*r+e,n[2]*s+i,n[3]*(r+s)/2,n[4],n[5],n[6],o),(n,t,e,i,r,s,o)=>t.arcTo(n[1]*r+e,n[2]*s+i,n[3]*r+e,n[4]*s+i,n[5]*(r+s)/2,o),(n,t,e,i,r,s,o)=>t.bezierCurveTo(n[1]*r+e,n[2]*s+i,n[3]*r+e,n[4]*s+i,n[5]*r+e,n[6]*s+i,o),(n,t,e,i)=>t.closePath(),(n,t,e,i,r,s)=>t.ellipse(n[1]*r+e,n[2]*s+i,n[3]*r,n[4]*s,n[5],n[6],n[7],n[8]),(n,t,e,i,r,s,o)=>t.lineTo(n[1]*r+e,n[2]*s+i,o),(n,t,e,i,r,s,o)=>t.moveTo(n[1]*r+e,n[2]*s+i,o),(n,t,e,i,r,s,o)=>t.quadraticCurveTo(n[1]*r+e,n[2]*s+i,n[3]*r+e,n[4]*s+i,o),(n,t,e,i,r,s,o)=>t.rect(n[1]*r+e,n[2]*s+i,n[3]*r,n[4]*s,o)];function ih(n,t,e=0,i=0,r=1,s=1,o){for(let a=0;a<n.length;a++){const l=n[a];jkt[l[0]](l,t,e,i,r,s,o)}}class FD{getLength(t){return t!=null?this.calcProjLength(t):(Number.isFinite(this.length)||(this.length=this.calcLength()),this.length)}}function GJ(n,t){let e=0;const i=n.length;for(let r=0;r<i;r++){const s=n[r],o=t[r],a=n[(r+1)%i],l=t[(r+1)%i];e+=hi.distanceNN(s,o,a,l)}return e/2}function Nkt(n,t,e,i,r){return GJ([n.x,t.x,e.x,i.x],[n.y,t.y,e.y,i.y])}function EV(n,t,e,i,r){const s=1-r;return s*s*s*n+3*t*r*s*s+3*e*r*r*s+i*r*r*r}function UJ(n,t,e,i,r){const s=EV(n.x,t.x,e.x,i.x,r),o=EV(n.y,t.y,e.y,i.y,r);return new Yt(s,o)}function LV(n,t,e,i){const r=1-i;return r*r*n+2*r*i*t+i*i*e}function YJ(n,t,e,i){const r=LV(n.x,t.x,e.x,i),s=LV(n.y,t.y,e.y,i);return new Yt(r,s)}function $kt(n,t,e,i){return GJ([n.x,t.x,e.x],[n.y,t.y,e.y])}class FL extends FD{constructor(t,e,i){super(),this.type=Q_.QuadraticBezierCurve,this.p0=t,this.p1=e,this.p2=i}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y)}getPointAt(t){if(this.defined!==!1)return YJ(this.p0,this.p1,this.p2,t);throw new Error("definedfalsegetPointAt")}calcLength(){return this._validPoint()?$kt(this.p0,this.p1,this.p2):60}calcProjLength(t){return t===li.ROW?Et(this.p0.x-this.p2.x):t===li.COLUMN?Et(this.p0.y-this.p2.y):0}getAngleAt(t){const e=ti(t-.01,0),i=we(t+.01,1),r=this.getPointAt(e),s=this.getPointAt(i);return zt(s.y-r.y,s.x-r.x)}draw(t,e,i,r,s,o){if(t.moveTo(this.p0.x*r+e,this.p0.y*s+i),o>=1)t.quadraticCurveTo(this.p1.x*r+e,this.p1.y*s+i,this.p2.x*r+e,this.p2.y*s+i);else if(o>0){const[a]=Vkt(this,o);t.quadraticCurveTo(a.p1.x*r+e,a.p1.y*s+i,a.p2.x*r+e,a.p2.y*s+i)}}getYAt(t){throw new Error("QuadraticBezierCurvegetYAt")}includeX(t){throw new Error("QuadraticBezierCurveincludeX")}}function v1(n,t){const{p0:e,p1:i,p2:r,p3:s}=n,o=UJ(e,i,r,s,t),a=hi.pointAtPP(e,i,t),l=hi.pointAtPP(i,r,t),h=hi.pointAtPP(r,s,t),d=hi.pointAtPP(a,l,t),u=hi.pointAtPP(l,h,t);return[new _1(e,a,d,o),new _1(o,u,h,s)]}function Vkt(n,t){const{p0:e,p1:i,p2:r}=n,s=YJ(e,i,r,t),o=hi.pointAtPP(e,i,t),a=hi.pointAtPP(i,r,t);return[new FL(e,o,s),new FL(s,a,r)]}class _1 extends FD{constructor(t,e,i,r){super(),this.type=Q_.CubicBezierCurve,this.p0=t,this.p1=e,this.p2=i,this.p3=r}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y+this.p2.x+this.p2.y+this.p3.x+this.p3.y)}getPointAt(t){if(this.defined!==!1)return UJ(this.p0,this.p1,this.p2,this.p3,t);throw new Error("definedfalsegetPointAt")}calcLength(){return this._validPoint()?Nkt(this.p0,this.p1,this.p2,this.p3):60}calcProjLength(t){return t===li.ROW?Et(this.p0.x-this.p3.x):t===li.COLUMN?Et(this.p0.y-this.p3.y):0}getAngleAt(t){const e=ti(t-.01,0),i=we(t+.01,1),r=this.getPointAt(e),s=this.getPointAt(i);return zt(s.y-r.y,s.x-r.x)}draw(t,e,i,r,s,o){if(t.moveTo(this.p0.x*r+e,this.p0.y*s+i),o>=1)t.bezierCurveTo(this.p1.x*r+e,this.p1.y*s+i,this.p2.x*r+e,this.p2.y*s+i,this.p3.x*r+e,this.p3.y*s+i);else if(o>0){const[a]=v1(this,o);t.bezierCurveTo(a.p1.x*r+e,a.p1.y*s+i,a.p2.x*r+e,a.p2.y*s+i,a.p3.x*r+e,a.p3.y*s+i)}}includeX(t){const e=we(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=ti(this.p0.x,this.p1.x,this.p2.x,this.p3.x);return t>=e&&t<=i}getYAt(t){const e=we(this.p0.x,this.p1.x,this.p2.x,this.p3.x),i=(t-e)/(ti(this.p0.x,this.p1.x,this.p2.x,this.p3.x)-e);return this.getPointAt(i).y}}function IV(n,t){const{p0:e,p1:i}=n,r=hi.pointAtPP(e,i,t);return[new b1(e,r),new b1(r,i)]}class b1 extends FD{constructor(t,e){super(),this.type=Q_.LineCurve,this.p0=t,this.p1=e}getPointAt(t){if(this.defined!==!1)return hi.pointAtPP(this.p0,this.p1,t);throw new Error("definedfalsegetPointAt")}getAngleAt(t){return this.angle==null&&(this.angle=zt(this.p1.y-this.p0.y,this.p1.x-this.p0.x)),this.angle}_validPoint(){return Number.isFinite(this.p0.x+this.p0.y+this.p1.x+this.p1.y)}calcLength(){return this._validPoint()?hi.distancePP(this.p0,this.p1):60}calcProjLength(t){return t===li.ROW?Et(this.p0.x-this.p1.x):t===li.COLUMN?Et(this.p0.y-this.p1.y):0}draw(t,e,i,r,s,o){if(t.moveTo(this.p0.x*r+e,this.p0.y*s+i),o>=1)t.lineTo(this.p1.x*r+e,this.p1.y*s+i);else if(o>0){const a=this.getPointAt(o);t.lineTo(a.x*r+e,a.y*s+i)}}includeX(t){return t>=this.p0.x&&t<=this.p1.x||t>=this.p1.x&&t<=this.p0.x}getYAt(t){if(this.includeX(t)){let e=this.p0,i=this.p1;this.p0.x>this.p1.x&&(e=this.p1,i=this.p0);const r=(t-e.x)/(i.x-e.x);return e.y+r*(i.y-e.y)}return 1/0}}class DM{get endX(){return this._lastX}get endY(){return this._lastY}constructor(t,e){this.init(t,e)}init(t,e){this._lastX=this._lastY=this._startX=this._startY=0,this.curveType=t,this.direction=e,this.curves=[]}bezierCurveTo(t,e,i,r,s,o,a,l){const h=new _1(new Yt(this._lastX,this._lastY),new Yt(t,e),new Yt(i,r),new Yt(s,o));h.originP1=this._lastOriginP,h.originP2=l,h.defined=a,this.curves.push(h),this._lastX=s,this._lastY=o,this._lastOriginP=l}closePath(){if(this.curves.length<2)return;const t=this.curves[this.curves.length-1];this.lineTo(this._startX,this._startY,t.defined,this._startOriginP)}ellipse(){throw new Error("SegContextellipse")}lineTo(t,e,i,r){const s=this.addLinearCurve(t,e,i,this._lastOriginP,r);this.curves.push(s),this._lastX=t,this._lastY=e,this._lastOriginP=r}moveTo(t,e,i){return this._lastX=this._startX=t,this._lastY=this._startY=e,this._lastOriginP=i,this._startOriginP=i,this}quadraticCurveTo(t,e,i,r){throw new Error("SegContextquadraticCurveTo")}clear(){this.curves=[],this.length=NaN}tryUpdateLength(t){return this.getLength(t)}addLinearCurve(t,e,i,r,s){const o=new b1(new Yt(this._lastX,this._lastY),new Yt(t,e));return o.originP1=r,o.originP2=s,o.defined=i,o}getPointAt(t){throw new Error("")}getCurveLengths(){return[]}getLength(t){var e,i;if(t===li.COLUMN){if(!this.curves.length)return 0;const r=this.curves[0],s=this.curves[this.curves.length-1],o=(e=s.p3)!==null&&e!==void 0?e:s.p1;return Et(r.p0.y-o.y)}if(t===li.ROW){if(!this.curves.length)return 0;const r=this.curves[0],s=this.curves[this.curves.length-1],o=(i=s.p3)!==null&&i!==void 0?i:s.p1;return Et(r.p0.x-o.x)}return Number.isFinite(this.length)||(this.length=this.curves.reduce((r,s)=>r+s.getLength(),0)),this.length}}class Gkt extends DM{bezierCurveTo(t,e,i,r,s,o,a,l){return super.bezierCurveTo(e,t,r,i,o,s,a,l)}lineTo(t,e,i,r){return super.lineTo(e,t,i,r)}moveTo(t,e,i){return super.moveTo(e,t,i)}clear(){return super.clear()}}function Yc(n,t,e=1){let i=!1;for(let r=0,s=t.length;r<=s;r++)r>=s===i&&((i=!i)?n.lineStart():n.lineEnd()),i&&n.point(t[r])}function Nf(n,t,e){const i=t??(Et(e[e.length-1].x-e[0].x)>Et(e[e.length-1].y-e[0].y)?li.ROW:li.COLUMN);return n==="monotoneY"?new Gkt(n,i):new DM(n,i)}class XJ{constructor(t,e){this.context=t,e&&(this.startPoint=e)}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t)}this._lastDefined=t.defined}tryUpdateLength(){return this.context.tryUpdateLength()}}function db(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=Nf("linear",e,n);return Ukt(new XJ(r,i),n),r}function Ukt(n,t){return Yc(n,t,1)}function OV(n,t,e,i,r){n.context.bezierCurveTo((2*n._x0+n._x1)/3,(2*n._y0+n._y1)/3,(n._x0+2*n._x1)/3,(n._y0+2*n._y1)/3,(n._x0+4*n._x1+t)/6,(n._y0+4*n._y1+e)/6,i,n.lastPoint1)}class Ykt{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){this._point===2&&OV(this,6*this._x1-(this._x0+4*this._x1),6*this._y1-(this._y0+4*this._y1),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;break;default:OV(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function Xkt(n,t){return Yc(n,t,2)}function Kkt(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return db(n,t);const r=Nf("basis",e,n);return Xkt(new Ykt(r,i),n),r}function DV(n){return n<0?-1:1}function FV(n,t,e){const i=n._x1-n._x0,r=t-n._x1,s=(n._y1-n._y0)/(i||Number(r<0&&-0)),o=(e-n._y1)/(r||Number(i<0&&-0)),a=(s*r+o*i)/(i+r);return(DV(s)+DV(o))*Math.min(Math.abs(s),Math.abs(o),.5*Math.abs(a))||0}function HV(n,t){const e=n._x1-n._x0;return e?(3*(n._y1-n._y0)/e-t)/2:t}function wB(n,t,e,i,r){const s=n._x0,o=n._y0,a=n._x1,l=n._y1,h=(a-s)/3;n.context.bezierCurveTo(s+h,o+h*t,a-h,l-h*e,a,l,i,n.lastPoint1)}class KJ{constructor(t,e){this.context=t,this.startPoint=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x1,this._y1,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:wB(this,this._t0,HV(this,this._t0),this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1)}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){let e=NaN;const i=t.x,r=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(i,r,this._lastDefined1!==!1&&this._lastDefined2!==!1,t):this.context.moveTo(i,r,t);break;case 1:this._point=2;break;case 2:this._point=3,wB(this,HV(this,e=FV(this,i,r)),e,this._lastDefined1!==!1&&this._lastDefined2!==!1);break;default:wB(this,this._t0,e=FV(this,i,r),this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._x0=this._x1,this._x1=i,this._y0=this._y1,this._y1=r,this._t0=e,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined!==!1,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}class qkt extends KJ{constructor(t,e){super(t,e)}point(t){return super.point({y:t.x,x:t.y,defined:t.defined})}}function Zkt(n,t){return Yc(n,t,2)}function Jkt(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return db(n,t);const r=Nf("monotoneX",e,n);return Zkt(new KJ(r,i),n),r}function Qkt(n,t){return Yc(n,t,2)}function tRt(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;if(n.length<3-+!!i)return db(n,t);const r=Nf("monotoneY",e,n);return Qkt(new qkt(r,i),n),r}let qJ=class{constructor(t,e=.5,i){this.context=t,this._t=e,this.startPoint=i}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x=this._y=NaN,this._point=0,this.startPoint&&this.point(this.startPoint)}lineEnd(){0<this._t&&this._t<1&&this._point===2&&this.context.lineTo(this._x,this._y,this._lastDefined!==!1,this.lastPoint),(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)}point(t){const e=t.x,i=t.y;switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t):this.context.moveTo(e,i,t);break;case 1:this._point=2;default:if(this._t<=0)this.context.lineTo(this._x,i,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(e,i,this._lastDefined!==!1&&t.defined!==!1,t);else{const r=this._x*(1-this._t)+e*this._t;this._t===.5?this.context.lineTo(r,this._y,this._lastDefined!==!1,this.lastPoint):this.context.lineTo(r,this._y,this._lastDefined!==!1&&t.defined!==!1,this.lastPoint),this.context.lineTo(r,i,this._lastDefined!==!1&&t.defined!==!1,t)}}this._lastDefined=t.defined,this._x=e,this._y=i,this.lastPoint=t}tryUpdateLength(){return this.context.tryUpdateLength()}};class eRt extends qJ{lineEnd(){this.context.closePath()}}function AB(n,t,e={}){const{direction:i,startPoint:r}=e;if(n.length<2-+!!r)return null;const s=new DM("step",i??(Et(n[n.length-1].x-n[0].x)>Et(n[n.length-1].y-n[0].y)?li.ROW:li.COLUMN));return ZJ(new qJ(s,t,r),n),s}function ZJ(n,t){return Yc(n,t,1)}function iRt(n,t,e={}){const{direction:i,startPoint:r}=e;if(n.length<2-+!!r)return null;const s=new DM("step",i??(Et(n[n.length-1].x-n[0].x)>Et(n[n.length-1].y-n[0].y)?li.ROW:li.COLUMN));return ZJ(new eRt(s,t,r),n),s}class nRt extends XJ{lineEnd(){this.context.closePath()}}function rRt(n,t={}){const{direction:e,startPoint:i}=t;if(n.length<2-+!!i)return null;const r=Nf("linear",e,n);return sRt(new nRt(r,i),n),r}function sRt(n,t){return Yc(n,t,1)}function JJ(n,t,e,i,r){let s=n._x1,o=n._y1,a=n._x2,l=n._y2;if(n._l01_a>$t){const h=2*n._l01_2a+3*n._l01_a*n._l12_a+n._l12_2a,d=3*n._l01_a*(n._l01_a+n._l12_a);s=(s*h-n._x0*n._l12_2a+n._x2*n._l01_2a)/d,o=(o*h-n._y0*n._l12_2a+n._y2*n._l01_2a)/d}if(n._l23_a>$t){const h=2*n._l23_2a+3*n._l23_a*n._l12_a+n._l12_2a,d=3*n._l23_a*(n._l23_a+n._l12_a);a=(a*h+n._x1*n._l23_2a-t*n._l12_2a)/d,l=(l*h+n._y1*n._l23_2a-e*n._l12_2a)/d}n.context.bezierCurveTo(s,o,a,l,n._x2,n._y2,i,n.lastPoint1)}class oRt{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 2:this.context.lineTo(this._x2,this._y2,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1);break;case 3:this.point({x:this._x2,y:this._y2})}(this._line||this._line!==0&&this._point===1)&&this.context.closePath(),this._line=1-this._line}point(t){const{x:e,y:i}=t;if(this._point){const r=this._x2-e,s=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this.context.lineTo(e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1):this.context.moveTo(e,i);break;case 1:this._point=2;break;case 2:this._point=3;default:JJ(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}function QJ(n,t){return function(e,i,r={}){const{direction:s,startPoint:o}=r;if(e.length<2-+!!o)return null;if(e.length<3-+!!o)return db(e,r);const a=Nf(n,s,e),l=new t(a,i,o);return Yc(l,e,2),a}}const aRt=QJ("catmullRom",oRt);class lRt{constructor(t,e=.5,i){this.context=t,this.startPoint=i,this._alpha=e}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0}lineEnd(){switch(this._point){case 1:this.context.moveTo(this._x3,this._y3,this.lastPoint1),this.context.closePath();break;case 2:this.context.lineTo(this._x3,this._y3,this._lastDefined1!==!1&&this._lastDefined2!==!1,this.lastPoint1),this.context.closePath();break;case 3:this.point({x:this._x3,y:this._y3}),this.point({x:this._x4,y:this._y4}),this.point({x:this._x5,y:this._y5})}}point(t){const{x:e,y:i}=t;if(this._point){const r=this._x2-e,s=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(r*r+s*s,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=e,this._y3=i;break;case 1:this._point=2,this.context.moveTo(this._x4=e,this._y4=i,t);break;case 2:this._point=3,this._x5=e,this._y5=i;break;default:JJ(this,e,i,this._lastDefined1!==!1&&this._lastDefined2!==!1)}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=e,this._y0=this._y1,this._y1=this._y2,this._y2=i,this._lastDefined1=this._lastDefined2,this._lastDefined2=t.defined,this.lastPoint0=this.lastPoint1,this.lastPoint1=t}tryUpdateLength(){return this.context.tryUpdateLength()}}const hRt=QJ("catmullRomClosed",lRt);class dRt{constructor(t){this.path=t,this._lastX=this._lastY=this._startX=this._startY=0}moveTo(t,e){return this._lastX=this._startX=t,this._lastY=this._startY=e,this}lineTo(t,e){const i=this.addLinearCurve(t,e);this.path.addCurve(i),this._lastX=t,this._lastY=e}addLinearCurve(t,e){return new b1(new Yt(this._lastX,this._lastY),new Yt(t,e))}quadraticCurveTo(t,e,i,r){const s=new FL(new Yt(this._lastX,this._lastY),new Yt(t,e),new Yt(i,r));this.path.addCurve(s),this._lastX=i,this._lastY=r}bezierCurveTo(t,e,i,r,s,o){const a=new _1(new Yt(this._lastX,this._lastY),new Yt(t,e),new Yt(i,r),new Yt(s,o));this.path.addCurve(a),this._lastX=s,this._lastY=o}arcTo(t,e,i,r,s){throw new Error("CurveContextarcTo")}ellipse(t,e,i,r,s,o,a,l){throw new Error("CurveContextellipse")}rect(t,e,i,r){throw new Error("CurveContextrect")}arc(t,e,i,r,s,o){throw new Error("CurveContextarc")}closePath(){this.path.curves.length<2||this.lineTo(this._startX,this._startY)}}function Fu(n,t,e){var i,r;switch(t){case"linear":default:return db(n,e);case"basis":return Kkt(n,e);case"monotoneX":return Jkt(n,e);case"monotoneY":return tRt(n,e);case"step":return AB(n,.5,e);case"stepClosed":return iRt(n,.5,e);case"stepBefore":return AB(n,0,e);case"stepAfter":return AB(n,1,e);case"catmullRom":return aRt(n,(i=e==null?void 0:e.curveTension)!==null&&i!==void 0?i:.5,e);case"catmullRomClosed":return hRt(n,(r=e==null?void 0:e.curveTension)!==null&&r!==void 0?r:.5,e);case"linearClosed":return rRt(n,e)}}class Cn extends Ikt{constructor(t){super(),this.commandList=[],t&&(this._ctx=t),this._boundsContext=new DD(this.bounds)}get curves(){return this.tryBuildCurves()}setCtx(t){this._ctx=t}moveTo(t,e){return this.commandList.push([ii.M,t,e]),this._ctx&&this._ctx.moveTo(t,e),this}lineTo(t,e){return this.commandList.push([ii.L,t,e]),this._ctx&&this._ctx.lineTo(t,e),this}quadraticCurveTo(t,e,i,r){return this.commandList.push([ii.Q,t,e,i,r]),this._ctx&&this._ctx.quadraticCurveTo(t,e,i,r),this}bezierCurveTo(t,e,i,r,s,o){return this.commandList.push([ii.C,t,e,i,r,s,o]),this._ctx&&this._ctx.bezierCurveTo(t,e,i,r,s,o),this}arcTo(t,e,i,r,s){return this.commandList.push([ii.AT,t,e,i,r,s]),this._ctx&&this._ctx.arcTo(t,e,i,r,s),this}ellipse(t,e,i,r,s,o,a,l){return this.commandList.push([ii.E,t,e,i,r,s,o,a,l]),this._ctx&&this._ctx.ellipse(t,e,i,r,s,o,a,l),this}rect(t,e,i,r){return this.commandList.push([ii.R,t,e,i,r]),this._ctx&&this._ctx.rect(t,e,i,r),this}arc(t,e,i,r,s,o){return this.commandList.push([ii.A,t,e,i,r,s,o]),this._ctx&&this._ctx.arc(t,e,i,r,s,o),this}closePath(){return this.commandList.push([ii.Z]),this._ctx&&this._ctx.closePath(),this}addCurve(t){this._curves.push(t)}clear(){this.transformCbList=null,this.commandList.length=0,this._curves.length=0}beginPath(){this.clear()}tryBuildCurves(){if(!this._curves||!this._curves.length){const t=new dRt(this);ih(this.commandList,t,0,0,1,1)}return this._curves}toString(){if(!this.toStringCbList){const i=[];i[ii.M]=r=>`M${r[1]} ${r[2]}`,i[ii.L]=r=>`L${r[1]} ${r[2]}`,i[ii.Q]=r=>`Q${r[1]} ${r[2]} ${r[3]} ${r[4]}`,i[ii.C]=r=>`C${r[1]} ${r[2]} ${r[3]} ${r[4]} ${r[5]} ${r[6]}`,i[ii.A]=r=>{const s=[];Wkt(s,r[4],r[5],r[1],r[2],r[3],r[3]);let o="";for(let a=0;a<s.length;a+=6)o+=`C${s[a]} ${s[a+1]} ${s[a+2]} ${s[a+3]} ${s[a+4]} ${s[a+5]}`;return o},i[ii.R]=r=>`M${r[1]} ${r[2]} h${r[3]} v${r[4]} H${r[1]}Z`,i[ii.Z]=r=>"Z",this.toStringCbList=i}const t=this.toStringCbList;let e="";return this.commandList.forEach(i=>{e+=t[i[0]](i)}),e}fromString(t,e,i,r,s){this.clear();const o=Fkt(t);return this._runCommandStrList(o,e,i,r,s),this._updateBounds(),this}fromLine(t){const{points:e,curveType:i,clipRangeByDimension:r}=t.attribute;if(!e)return;const s=Fu(e,i);r==="x"?this.direction=li.ROW:r==="y"?this.direction=li.COLUMN:r==="auto"&&(this.direction=s.direction),this._curves=s.curves}fromCustomPath2D(t,e,i,r,s){return this.clear(),this._runCommandList(t.commandList,e,i,r,s),this._updateBounds(),this}transform(t,e,i,r){const s=this.commandList;if(!this.transformCbList){const o=[];o[ii.M]=this.moveToTransform,o[ii.L]=this.lineToTransform,o[ii.Q]=this.quadraticCurveToTransform,o[ii.C]=this.bezierCurveToTransform,o[ii.AT]=this.arcToTransform,o[ii.E]=this.ellipseTransform,o[ii.R]=this.rectTransform,o[ii.A]=this.arcTransform,o[ii.Z]=this.closePathTransform,this.transformCbList=o}s.forEach(o=>{this.transformCbList[o[0]](o,t,e,i,r)}),this._updateBounds()}moveToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i}lineToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i}quadraticCurveToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r+e,t[4]=t[4]*s+i}bezierCurveToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r+e,t[4]=t[4]*s+i,t[5]=t[5]*r+e,t[6]=t[6]*s+i}arcToTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r+e,t[4]=t[4]*s+i,t[5]=t[5]*(r+s)/2}ellipseTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r,t[4]=t[4]*s}rectTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*r,t[4]=t[4]*s}arcTransform(t,e,i,r,s){t[1]=t[1]*r+e,t[2]=t[2]*s+i,t[3]=t[3]*(r+s)/2}closePathTransform(){}_runCommandStrList(t,e=0,i=0,r=1,s=1){let o,a,l,h,d,u=null,c=0,g=0,p=0,f=0;for(let m=0,v=t.length;m<v;++m){switch(o=t[m],r===1&&s===1||(o=uRt(o,r,s)),o[0]){case"l":c+=o[1],g+=o[2],this.lineTo(c+e,g+i);break;case"L":c=o[1],g=o[2],this.lineTo(c+e,g+i);break;case"h":c+=o[1],this.lineTo(c+e,g+i);break;case"H":c=o[1],this.lineTo(c+e,g+i);break;case"v":g+=o[1],this.lineTo(c+e,g+i);break;case"V":g=o[1],this.lineTo(c+e,g+i);break;case"m":c+=o[1],g+=o[2],this.moveTo(c+e,g+i);break;case"M":c=o[1],g=o[2],this.moveTo(c+e,g+i);break;case"c":a=c+o[5],l=g+o[6],p=c+o[3],f=g+o[4],this.bezierCurveTo(c+o[1]+e,g+o[2]+i,p+e,f+i,a+e,l+i),c=a,g=l;break;case"C":c=o[5],g=o[6],p=o[3],f=o[4],this.bezierCurveTo(o[1]+e,o[2]+i,p+e,f+i,c+e,g+i);break;case"s":a=c+o[3],l=g+o[4],u[0].match(/[CcSs]/)===null?(p=c,f=g):(p=2*c-p,f=2*g-f),h=c+o[1],d=g+o[2],this.bezierCurveTo(p+e,f+i,h+e,d+i,a+e,l+i),p=h,f=d,c=a,g=l;break;case"S":a=o[3],l=o[4],u[0].match(/[CcSs]/)===null?(p=c,f=g):(p=2*c-p,f=2*g-f),h=o[1],d=o[2],this.bezierCurveTo(p+e,f+i,h+e,d+i,a+e,l+i),p=h,f=d,c=a,g=l;break;case"q":a=c+o[3],l=g+o[4],p=c+o[1],f=g+o[2],this.quadraticCurveTo(p+e,f+i,a+e,l+i),c=a,g=l;break;case"Q":a=o[3],l=o[4],this.quadraticCurveTo(o[1]+e,o[2]+i,a+e,l+i),c=a,g=l,p=o[1],f=o[2];break;case"t":a=c+o[1],l=g+o[2],u[0].match(/[QqTt]/)===null?(p=c,f=g):u[0]==="t"?(p=2*c-h,f=2*g-d):u[0]==="q"&&(p=2*c-p,f=2*g-f),h=p,d=f,this.quadraticCurveTo(p+e,f+i,a+e,l+i),c=a,g=l,p=c+o[1],f=g+o[2];break;case"T":a=o[1],l=o[2],p=2*c-p,f=2*g-f,this.quadraticCurveTo(p+e,f+i,a+e,l+i),c=a,g=l;break;case"a":PV(this,c+e,g+i,[o[1],o[2],o[3],o[4],o[5],o[6]+c+e,o[7]+g+i]),c+=o[6],g+=o[7];break;case"A":PV(this,c+e,g+i,[o[1],o[2],o[3],o[4],o[5],o[6]+e,o[7]+i]),c=o[6],g=o[7];break;case"z":case"Z":this.closePath()}u=o}}_runCommandList(t,e=0,i=0,r=1,s=1){if(e!==0||i!==0||r!==1||s!==1)for(let o=0,a=t.length;o<a;++o){const l=t[o].slice();switch(l[0]){case ii.L:this.lineToTransform(l,e,i,r,s);break;case ii.M:this.moveToTransform(l,e,i,r,s);break;case ii.C:this.bezierCurveToTransform(l,e,i,r,s);break;case ii.Q:this.quadraticCurveToTransform(l,e,i,r,s);break;case ii.A:this.arcToTransform(l,e,i,r,s);break;case ii.E:this.ellipseTransform(l,e,i,r,s);break;case ii.R:this.rectTransform(l,e,i,r,s);break;case ii.AT:this.arcToTransform(l,e,i,r,s);break;case ii.Z:this.closePath()}}else this.commandList=t.map(o=>o.slice())}_updateBounds(){this.bounds.clear(),ih(this.commandList,this._boundsContext)}release(){this.commandList=[],this._boundsContext=null,this._ctx=null}getLength(){if(this.direction===li.COLUMN){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return Et(t.p0.y-e.p1.y)}if(this.direction===li.ROW){if(!this._curves.length)return 0;const t=this._curves[0],e=this._curves[this._curves.length-1];return Et(t.p0.x-e.p1.x)}return this._curves.reduce((t,e)=>t+e.getLength(),0)}getYAt(t){if(!this.curves)return 1/0;for(let e=0;e<this.curves.length;e++){const i=this.curves[e];if(i.includeX(t))return i.getYAt(t)}return 1/0}getAttrAt(t){if(!this._curves)return{pos:{x:0,y:0},angle:0};let e,i=0;for(let s=0;s<this._curves.length;s++){e=this._curves[s];const o=e.getLength(this.direction);if(i+o>=t)break;i+=o}const r=(t-i)/e.getLength(this.direction);return{pos:e.getPointAt(r),angle:e.getAngleAt(r)}}drawWithClipRange(t,e,i,r,s){this.tryBuildCurves();const o=this.getLength()*s;let a=0;for(let l=0;l<this._curves.length;l++){const h=this._curves[l],d=h.getLength(this.direction);if(!(a+d<=o)){const u=1-(a+d-o)/d;h.draw(t,i,r,e,e,u);break}h.draw(t,i,r,e,e,1),a+=d}}}const Zs=["l",0,0,0,0,0,0,0];function uRt(n,t,e){const i=Zs[0]=n[0];if(i==="a"||i==="A")Zs[1]=t*n[1],Zs[2]=e*n[2],Zs[3]=n[3],Zs[4]=n[4],Zs[5]=n[5],Zs[6]=t*n[6],Zs[7]=e*n[7];else if(i==="h"||i==="H")Zs[1]=t*n[1];else if(i==="v"||i==="V")Zs[1]=e*n[1];else for(let r=1,s=n.length;r<s;++r)Zs[r]=(r%2==1?t:e)*n[r];return Zs}const cRt={alignSelf:"auto"},Hn={x:0,y:0,z:0,dx:0,dy:0,dz:0,scrollX:0,scrollY:0,scaleX:1,scaleY:1,scaleZ:1,angle:0,alpha:0,beta:0,scaleCenter:[0,0],anchor:[0,0],anchor3d:[0,0],postMatrix:new Pe},tQ={fillOpacity:1,fill:!1,shadowBlur:0,shadowColor:"black",shadowOffsetX:0,shadowOffsetY:0},MB={strokeOpacity:1,lineDash:[],lineDashOffset:0,lineWidth:1,lineCap:"butt",lineJoin:"miter",miterLimit:10,strokeBoundsBuffer:2,stroke:!1},eQ=Object.assign({outerBorder:Object.assign(Object.assign({},MB),{distance:0}),innerBorder:Object.assign(Object.assign({},MB),{distance:0})},MB),_o={text:"",maxLineWidth:1/0,maxWidth:1/0,textAlign:"left",textBaseline:"alphabetic",fontSize:16,fontFamily:`PingFang SC,Microsoft Yahei,system-ui,-apple-system,segoe ui,
    Roboto,Helvetica,Arial,sans-serif, apple color emoji,segoe ui emoji,segoe ui symbol`,fontWeight:"",ellipsis:"",fontVariant:"",fontStyle:"",lineHeight:void 0,underline:0,lineThrough:0,scaleIn3d:!1,direction:"horizontal",wordBreak:"break-all",ignoreBuf:!1,verticalMode:0,wrap:!1,whiteSpace:"no-wrap",heightLimit:1/0,lineClamp:1/0,suffixPosition:"end",underlineDash:[],underlineOffset:0,disableAutoClipedPoptip:void 0,measureMode:Qu.fontBounding,keepCenterInLine:!1},gRt={pickStrokeBuffer:0},pRt=Object.assign(Object.assign(Object.assign(Object.assign({forceBoundsWidth:void 0,forceBoundsHeight:void 0,opacity:1,background:null,autoAnimateTexture:!1,textureRatio:1,textureOptions:null,backgroundOpacity:1,backgroundCornerRadius:0,texture:null,textureColor:"black",textureSize:10,texturePadding:2,backgroundMode:"no-repeat",backgroundFit:!0,backgroundKeepAspectRatio:!1,backgroundClip:!0,backgroundScale:1,backgroundOffsetX:0,backgroundOffsetY:0,blur:0,filter:"",cursor:null,html:null,react:null,vue:null},tQ),eQ),cRt),gRt),iQ={connectedType:"none",connectedStyle:{},connectedX:NaN,connectedY:NaN},fRt={_debug_bounds:!1},Di=Object.assign(Object.assign(Object.assign({strokeSeg:null,renderable:!0,pickable:!0,shadowGraphic:void 0,childrenPickable:!0,fillPickable:!0,strokePickable:!0,visible:!0,zIndex:0,layout:null,boundsPadding:0,fillStrokeOrder:0,renderStyle:"default",pickMode:"accurate",customPickShape:null,boundsMode:"accurate",keepDirIn3d:!0,shadowRootIdx:1,globalZIndex:1,globalCompositeOperation:"",overflow:"hidden",shadowPickMode:"graphic",keepStrokeScale:!1,clipConfig:null},fRt),pRt),Hn),mRt=Object.assign(Object.assign({},Di),{startAngle:0,endAngle:Ft,innerRadius:0,outerRadius:1,innerPadding:0,outerPadding:0,cornerRadius:0,padRadius:0,padAngle:0,cap:!1,forceShowCap:!1}),vRt=Object.assign(Object.assign(Object.assign({},Di),iQ),{points:[],segments:[],curveType:"linear",clipRange:1,closePath:!1,curveTension:1}),_Rt=Object.assign(Object.assign({},Di),{radius:1,startAngle:0,endAngle:Ft}),bRt=Object.assign(Object.assign({},Di),{width:0,height:0,cornerRadius:0,path:[],clip:!1,visibleAll:!0,display:"relative",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",alignItems:"flex-start",alignContent:"flex-start",baseOpacity:1,cornerType:"round"}),yRt=Object.assign(Object.assign({},Di),{path:"",width:0,height:0,cornerRadius:0,clip:!1}),CRt=Object.assign(Object.assign(Object.assign({},Di),iQ),{points:[],segments:[],curveType:"linear",clipRange:1,clipRangeByDimension:"default",closePath:!1,curveTension:1}),SRt=Object.assign(Object.assign({},Di),{path:new Cn,fillStrokeOrder:1,clipRange:1,customPath:()=>{ge.getInstance().warn("")}}),xRt=Object.assign(Object.assign({},Di),{points:[],cornerRadius:0,closePath:!0}),wRt=Object.assign(Object.assign({},Di),{width:100,height:100,spikes:5,thickness:.5}),ARt=Object.assign(Object.assign({},Di),{width:0,height:0,x1:0,y1:0,strokeBoundsBuffer:0,cornerRadius:0,cornerType:"round"});Object.assign(Object.assign({},Di),{width:0,height:0,x1:0,y1:0,cornerRadius:0,length:0,cornerType:"round"});const MRt=Object.assign(Object.assign({},Di),{symbolType:"circle",size:10,keepDirIn3d:!0,clipRange:1}),nQ=Object.assign(Object.assign(Object.assign({},Di),_o),{strokeBoundsBuffer:0,keepDirIn3d:!0}),wl=Object.assign(Object.assign(Object.assign({},Di),_o),{upgradeAttrs:null,editable:!1,editOptions:null,ascentDescentMode:"actual",width:300,height:300,ellipsis:!0,wordBreak:"break-word",verticalDirection:"top",textAlign:"left",textBaseline:"top",layoutDirection:"horizontal",textConfig:[],disableAutoWrapLine:!1,maxHeight:void 0,maxWidth:void 0,singleLine:!1}),t0=Object.assign(Object.assign({repeatX:"no-repeat",repeatY:"no-repeat",image:"",width:0,height:0,maxWidth:500,maxHeight:500},Di),{fill:!0,cornerRadius:0,cornerType:"round"}),TRt=Object.assign(Object.assign({},t0),{backgroundShowMode:"never",backgroundWidth:0,backgroundHeight:0,textAlign:"left",textBaseline:"middle",direction:"horizontal",margin:0,id:"",width:20,height:20,backgroundFill:"rgba(101, 117, 168, 0.1)",backgroundFillOpacity:1,backgroundStroke:!1,backgroundStrokeOpacity:1,backgroundRadius:4,opacity:1});class kRt{}const bt=new kRt,RRt=function(){const n={linearGradient:/^(linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,fromAngleValue:/^from\s*(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/(^\#[0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^(rgb\(\d{1,3},\s*\d{1,3},\s*\d{1,3}\))/i,rgbaColor:/^(rgba\(\d{1,3},\s*\d{1,3},\s*\d{1,3},\s*((\d\.\d+)|\d{1,3})\))/i};let t="";function e(y){const C=new Error(t+": "+y);throw C.source=t,C}function i(){const y=g(r);return t.length>0&&e("Invalid input not EOF"),y}function r(){return s("linear",n.linearGradient,o)||s("radial",n.radialGradient,l)||s("conic",n.conicGradient,a)}function s(y,C,S){return function(w,x){const A=_(w);if(A){_(n.startCall)||e("Missing (");const M=x(A);return _(n.endCall)||e("Missing )"),M}}(C,function(w){const x=S();return x&&(_(n.comma)||e("Missing comma before color stops")),{type:y,orientation:x,colorStops:g(p)}})}function o(){return v("directional",n.sideOrCorner,1)||v("angular",n.angleValue,1)}function a(){return v("angular",n.fromAngleValue,1)}function l(){let y,C,S=h();return S&&(y=[],y.push(S),C=t,_(n.comma)&&(S=h(),S?y.push(S):t=C)),y}function h(){let y=function(){const C=v("shape",/^(circle)/i,0);return C&&(C.style=m()||d()),C}()||function(){const C=v("shape",/^(ellipse)/i,0);return C&&(C.style=f()||d()),C}();if(y)y.at=u();else{const C=d();if(C){y=C;const S=u();S&&(y.at=S)}else{const S=c();S&&(y={type:"default-radial",at:S})}}return y}function d(){return v("extent-keyword",n.extentKeywords,1)}function u(){if(v("position",/^at/,0)){const y=c();return y||e("Missing positioning value"),y}}function c(){const y={x:f(),y:f()};if(y.x||y.y)return{type:"position",value:y}}function g(y){let C=y();const S=[];if(C)for(S.push(C);_(n.comma);)C=y(),C?S.push(C):e("One extra comma");return S}function p(){const y=v("hex",n.hexColor,1)||v("rgba",n.rgbaColor,1)||v("rgb",n.rgbColor,1)||v("literal",n.literalColor,0);return y||e("Expected color definition"),y.length=f(),y}function f(){return v("%",n.percentageValue,1)||v("position-keyword",n.positionKeywords,1)||m()}function m(){return v("px",n.pixelValue,1)||v("em",n.emValue,1)}function v(y,C,S){const w=_(C);if(w)return{type:y,value:w[S]}}function _(y){const C=/^[\n\r\t\s]+/.exec(t);C&&b(C[0].length);const S=y.exec(t);return S&&b(S[0].length),S}function b(y){t=t.substr(y)}return function(y){return t=y.toString(),i()}}();class Gg{static IsGradient(t){return!(typeof t=="string"&&!t.includes("gradient"))}static IsGradientStr(t){return typeof t=="string"&&t.includes("gradient")}static Parse(t){if(Gg.IsGradientStr(t))try{const e=RRt(t)[0];if(e){if(e.type==="linear")return Gg.ParseLinear(e);if(e.type==="radial")return Gg.ParseRadial(e);if(e.type==="conic")return Gg.ParseConic(e)}}catch{return t}return t}static ParseConic(t){const{orientation:e,colorStops:i=[]}=t,r=Kt/2,s=parseFloat(e.value)/180*Kt-r;return{gradient:"conical",x:.5,y:.5,startAngle:s,endAngle:s+Ft,stops:i.map(o=>({color:o.value,offset:parseFloat(o.length.value)/100}))}}static ParseRadial(t){const{colorStops:e=[]}=t;return{gradient:"radial",x0:.5,y0:.5,x1:.5,y1:.5,r0:0,r1:1,stops:e.map(i=>({color:i.value,offset:parseFloat(i.length.value)/100}))}}static ParseLinear(t){const{orientation:e,colorStops:i=[]}=t,r=Kt/2;let s=e.type==="angular"?parseFloat(e.value)/180*Kt:0;for(;s<0;)s+=Ft;for(;s>=Ft;)s-=Ft;let o=0,a=0,l=0,h=0;return s<r?(o=0,a=1,l=Math.sin(s),h=a-Math.cos(s)):s<Kt?(o=0,a=0,l=Math.cos(s-r),h=Math.sin(s-r)):s<Kt+r?(o=1,a=0,l=o-Math.sin(s-Kt),h=Math.cos(s-Kt)):(o=1,l=o-Math.cos(s-r-Kt),h-=Math.sin(s-r-Kt)),{gradient:"linear",x0:o,y0:a,x1:l,y1:h,stops:i.map(d=>({color:d.value,offset:parseFloat(d.length.value)/100}))}}}function ch(n,t,e){let i=t;const{a:r,b:s,c:o,d:a}=n.currentMatrix,l=Math.sign(r)*Math.sqrt(r*r+s*s),h=Math.sign(a)*Math.sqrt(o*o+a*a);return l+h===0?0:(i=i/Math.abs(l+h)*2*e,i)}function y1(n,t,e,i=0,r=0){var s,o,a,l;if(!t||t===!0)return"black";let h,d;if(V(t))for(let u=0;u<t.length&&(d=t[u],!d);u++);else d=t;if(d=Gg.Parse(d),typeof d=="string")return d;if(e.AABBBounds&&(!e.attribute||e.attribute.scaleX!==0||e.attribute.scaleY!==0)){const u=e.AABBBounds;let c=u.x2-u.x1,g=u.y2-u.y1,p=u.x1-i,f=u.y1-r;if(e.attribute){const{scaleX:m=1,scaleY:v=1,angle:_=0}=e.attribute;c/=m,g/=v,p/=m,f/=v,(_||m!==1||v!==1)&&(p=(s=e.x1WithoutTransform)!==null&&s!==void 0?s:0,f=(o=e.y1WithoutTransform)!==null&&o!==void 0?o:0,c=(a=e.widthWithoutTransform)!==null&&a!==void 0?a:c,g=(l=e.heightWithoutTransform)!==null&&l!==void 0?l:g)}d.gradient==="linear"?h=BRt(n,d,p,f,c,g):d.gradient==="conical"?h=ERt(n,d,p,f,c,g):d.gradient==="radial"&&(h=PRt(n,d,p,f,c,g))}return h||"orange"}function BRt(n,t,e,i,r,s){var o,a,l,h;const d=n.createLinearGradient(e+((o=t.x0)!==null&&o!==void 0?o:0)*r,i+((a=t.y0)!==null&&a!==void 0?a:0)*s,e+((l=t.x1)!==null&&l!==void 0?l:1)*r,i+((h=t.y1)!==null&&h!==void 0?h:0)*s);return t.stops.forEach(u=>{d.addColorStop(u.offset,u.color)}),d}function PRt(n,t,e,i,r,s){var o,a,l,h,d,u;const c=n.createRadialGradient(e+((o=t.x0)!==null&&o!==void 0?o:.5)*r,i+((a=t.y0)!==null&&a!==void 0?a:.5)*s,Math.max(r,s)*((l=t.r0)!==null&&l!==void 0?l:0),e+((h=t.x1)!==null&&h!==void 0?h:.5)*r,i+((d=t.y1)!==null&&d!==void 0?d:.5)*s,Math.max(r,s)*((u=t.r1)!==null&&u!==void 0?u:.5));return t.stops.forEach(g=>{c.addColorStop(g.offset,g.color)}),c}function ERt(n,t,e,i,r,s){var o,a;const l=n.createConicGradient(e+((o=t.x)!==null&&o!==void 0?o:0)*r,i+((a=t.y)!==null&&a!==void 0?a:0)*s,t.startAngle,t.endAngle);return t.stops.forEach(h=>{l.addColorStop(h.offset,h.color)}),l.GetPattern?l.GetPattern(r+e,s+i,void 0):l}const HD={horizontal:{width:"width",height:"height",left:"left",top:"top",x:"x",y:"y",bottom:"bottom"},vertical:{width:"height",height:"width",left:"top",top:"left",x:"y",y:"x",bottom:"right"}},rQ={fill:!0,stroke:!1},C1=/\w|\(|\)|-/,sQ=/[.?!,;:/]/,LRt=/\S/,oQ=(n,t)=>{let e=t.fontSize||16;switch(t.script){case"super":case"sub":e*=.8}n.setTextStyle({textAlign:"left",textBaseline:t.textBaseline||"alphabetic",fontStyle:t.fontStyle||"",fontWeight:t.fontWeight||"",fontSize:e,fontFamily:t.fontFamily})};function IRt(n,t,e){const i=t&&t.fill||rQ.fill,{fillOpacity:r=1,opacity:s=1}=t;n.globalAlpha=r*s,n.fillStyle=e?y1(n,i,{AABBBounds:e}):i,oQ(n,t)}function ORt(n,t){const e=t&&t.stroke||rQ.stroke;if(!e)return void(n.globalAlpha=0);const{strokeOpacity:i=1,opacity:r=1}=t;n.globalAlpha=i*r,n.lineWidth=t&&typeof t.lineWidth=="number"?t.lineWidth:1,n.strokeStyle=e,oQ(n,t)}function PC(n,t,e,i,r){if(n.length<=1||!t||t<=0)return 0;const s=bt.graphicUtil.textMeasure;let o=i,a=n.slice(0,o),l=Math.floor(s.measureText(a,e).width),h=n.slice(0,o+1),d=Math.floor(s.measureText(h,e).width);for(;l>t||d<=t;){if(l>t?o--:o++,o>n.length){o=n.length;break}if(o<0){o=0;break}a=n.slice(0,o),l=Math.floor(s.measureText(a,e).width),h=n.slice(0,o+1),d=Math.floor(s.measureText(h,e).width)}return r&&(o=EC(n,o)),o}function EC(n,t,e=!1){let i=t;for(;C1.test(n[i-1])&&C1.test(n[i])||sQ.test(n[i]);)if(i--,i<=0)return e?DRt(n,t):t;return i}function DRt(n,t){let e=t;for(;C1.test(n[e+1])&&C1.test(n[e])||sQ.test(n[e]);)if(e++,e>=n.length)return e;return e+1}function ku(n,t,e="actual"){var i;if(n==="")return{ascent:0,height:0,descent:0,width:0};const r=bt.graphicUtil.textMeasure.measureText(n,t),s={ascent:0,height:0,descent:0,width:0},o=e==="actual"?r.actualBoundingBoxAscent:r.fontBoundingBoxAscent,a=e==="actual"?r.actualBoundingBoxDescent:r.fontBoundingBoxDescent;typeof o!="number"||typeof a!="number"?(s.width=Math.floor(r.width),s.height=t.fontSize||0,s.ascent=s.height,s.descent=0):(s.width=Math.floor(r.width),s.height=Math.floor(o+a),s.ascent=Math.floor(o),s.descent=s.height-s.ascent);const l=(i=t.space)!==null&&i!==void 0?i:0;return s.width+=l,s}var FRt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let HL=class{configure(n,t){this.canvas=n.canvas,this.context=n.context,n.bindTextMeasure(this)}_measureTextWithoutAlignBaseline(n,t,e){this.context.setTextStyleWithoutAlignBaseline(t);const i=this.context.measureText(n);return e?this.compatibleMetrics(i,t):i}_measureTextWithAlignBaseline(n,t,e){this.context.setTextStyle(t);const i=this.context.measureText(n);return e?this.compatibleMetrics(i,t):i}compatibleMetrics(n,t){if(n.actualBoundingBoxAscent==null||n.actualBoundingBoxDescent==null||n.fontBoundingBoxAscent==null||n.fontBoundingBoxDescent==null){n={width:n.width};const{ascent:e,descent:i}=this.measureTextBoundADscentEstimate(t);n.actualBoundingBoxAscent=e,n.actualBoundingBoxDescent=i,n.fontBoundingBoxAscent=e,n.fontBoundingBoxDescent=i}if(n.actualBoundingBoxLeft==null||n.actualBoundingBoxRight==null){n={width:n.width,actualBoundingBoxAscent:n.actualBoundingBoxAscent,actualBoundingBoxDescent:n.actualBoundingBoxDescent,fontBoundingBoxAscent:n.fontBoundingBoxAscent,fontBoundingBoxDescent:n.fontBoundingBoxDescent};const{left:e,right:i}=this.measureTextBoundLeftRightEstimate(t);n.actualBoundingBoxLeft=e,n.actualBoundingBoxRight=i}return n}estimate(n,{fontSize:t=nQ.fontSize}){let e=0,i=0;for(let r=0;r<n.length;r++)n.charCodeAt(r)<128?e++:i++;return{width:~~(.8*e*t+i*t),height:t}}measureTextWidth(n,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t)).width:this.estimate(n,t).width}measureTextBoundsWidth(n,t,e){return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t)).width:this.estimate(n,t).width}measureTextBoundsLeftRight(n,t,e){return this.context?{left:(e=e??this._measureTextWithAlignBaseline(n,t,!0)).actualBoundingBoxLeft,right:e.actualBoundingBoxRight}:this.measureTextBoundLeftRightEstimate(t)}measureTextPixelHeight(n,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t,!0),Math.abs(e.actualBoundingBoxAscent-e.actualBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:_o.fontSize}measureTextPixelADscent(n,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(n,t,!0)).actualBoundingBoxAscent,descent:e.actualBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundHieght(n,t,e){var i;return this.context?(e=e??this._measureTextWithoutAlignBaseline(n,t,!0),Math.abs(e.fontBoundingBoxAscent-e.fontBoundingBoxDescent)):(i=t.fontSize)!==null&&i!==void 0?i:_o.fontSize}measureTextBoundADscent(n,t,e){return this.context?{ascent:(e=e??this._measureTextWithAlignBaseline(n,t,!0)).fontBoundingBoxAscent,descent:e.fontBoundingBoxDescent}:this.measureTextBoundADscentEstimate(t)}measureTextBoundADscentEstimate(n){var t;const e=(t=n.fontSize)!==null&&t!==void 0?t:_o.fontSize;return{ascent:.79*e,descent:.21*e}}measureTextBoundLeftRightEstimate(n){var t;const e=(t=n.fontSize)!==null&&t!==void 0?t:_o.fontSize,{textAlign:i}=n;return i==="center"?{left:e/2,right:e/2}:i==="right"||i==="end"?{left:e,right:0}:{left:0,right:e}}measureTextPixelADscentAndWidth(n,t,e){if(!this.context)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:this.estimate(n,t).width});const i=this._measureTextWithoutAlignBaseline(n,t,!0);if(e===Qu.actualBounding)return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width};if(e===Qu.estimate)return Object.assign(Object.assign({},this.measureTextBoundADscentEstimate(t)),{width:i.width});if(e===Qu.fontBounding){let r=i.fontBoundingBoxAscent,s=i.fontBoundingBoxDescent;if(i.actualBoundingBoxDescent&&s<i.actualBoundingBoxDescent){const o=i.actualBoundingBoxDescent-s;s+=o,r-=o}else if(i.actualBoundingBoxAscent&&r<i.actualBoundingBoxAscent){const o=i.actualBoundingBoxAscent-r;r+=o,s-=o}return{ascent:r,descent:s,width:i.width}}return{ascent:i.actualBoundingBoxAscent,descent:i.actualBoundingBoxDescent,width:i.width}}measureText(n,t){return this.context?(this.context.setTextStyleWithoutAlignBaseline(t),this.context.measureText(n)):this.estimate(n,t)}clipTextVertical(n,t,e,i){if(n.length===0)return{verticalList:n,width:0};const{fontSize:r=12}=t;n.forEach(l=>{l.width=l.direction===0?r:this.measureTextWidth(l.text,t)});const s=[];let o=0,a=0;for(;a<n.length&&o+n[a].width<e;a++)o+=n[a].width,s.push(n[a]);if(n[a]&&n[a].text.length>1){const l=this._clipText(n[a].text,t,e-o,0,n[a].text.length-1,"end",!1);if(i&&l.str!==n[a].text){let h="",d=0;for(let g=0;g<a;g++){const p=n[g];h+=p.text,d+=p.text.length}h+=n[a].text;const u=d+l.str.length;let c=EC(h,u);c-=d,c!==l.str.length-1&&(l.str=l.str.substring(0,c),l.width=this.measureTextWidth(l.str,t))}s.push(Object.assign(Object.assign({},n[a]),{text:l.str,width:l.width})),o+=l.width}return{verticalList:s,width:o}}clipText(n,t,e,i,r){if(n.length===0)return{str:"",width:0};let s=this.measureTextWidth(n,t);if(s<=e)return{str:n,width:s};if(s=this.measureTextWidth(n[0],t),s>e)return{str:"",width:0};const o=this._clipText(n,t,e,0,n.length-1,"end",!1);if(i&&o.str!==n){let a=EC(n,o.str.length,r);a!==o.str.length&&(a>o.str.length&&(o.wordBreaked=a,a=o.str.length),o.str=n.substring(0,a),o.width=this.measureTextWidth(o.str,t))}return o}_clipText(n,t,e,i,r,s,o){let a;if(s==="start")a=this._clipTextStart(n,t,e,i,r),o&&(a.result=o+a.str);else if(s==="middle"){const l=this._clipTextMiddle(n,t,e,"","",0,0,1);a={str:"none",width:l.width,result:l.left+o+l.right}}else a=this._clipTextEnd(n,t,e,i,r),o&&(a.result=a.str+o);return a}_clipTextEnd(n,t,e,i,r){if(i===r){ge.getInstance().warn(`_clipTextEnd${n}, ${i}, ${r}`);const h=n.substring(0,r+1);return{str:h,width:this.measureTextWidth(h,t)}}const s=Math.floor((i+r)/2),o=n.substring(0,s+1),a=this.measureTextWidth(o,t);let l;if(a>e){if(o.length<=1)return{str:"",width:0};const h=n.substring(0,s);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextEnd(n,t,e,i,s)}if(a<e){if(s>=n.length-1)return{str:n,width:this.measureTextWidth(n,t)};const h=n.substring(0,s+2);return l=this.measureTextWidth(h,t),l>=e?{str:o,width:a}:this._clipTextEnd(n,t,e,s,r)}return{str:o,width:a}}_clipTextStart(n,t,e,i,r){const s=Math.ceil((i+r)/2),o=n.substring(s-1,n.length),a=this.measureTextWidth(o,t);let l;if(a>e){if(o.length<=1)return{str:"",width:0};const h=n.substring(s,n.length);return l=this.measureTextWidth(h,t),l<=e?{str:h,width:l}:this._clipTextStart(n,t,e,s,n.length)}if(a<e){if(s<=0)return{str:n,width:this.measureTextWidth(n,t)};const h=n.substring(s-2,n.length);return l=this.measureTextWidth(h,t),l>=e?{str:o,width:a}:this._clipTextStart(n,t,e,i,s)}return{str:o,width:a}}_clipTextMiddle(n,t,e,i,r,s,o,a){const l=n.substring(0,a),h=this.measureTextWidth(l,t);if(h+o>e)return{left:i,right:r,width:s+o};const d=n.substring(n.length-a,n.length),u=this.measureTextWidth(d,t);return h+u>e?{left:l,right:r,width:h+o}:this._clipTextMiddle(n,t,e,l,d,h,u,a+1)}clipTextWithSuffixVertical(n,t,e,i,r,s){if(i==="")return this.clipTextVertical(n,t,e,r);if(n.length===0)return{verticalList:n,width:0};const o=this.clipTextVertical(n,t,e,r);if(o.verticalList.length===n.length&&o.verticalList[o.verticalList.length-1].width===n[n.length-1].width)return o;const a=this.measureTextWidth(i,t);if(a>e)return o;let l;if(e-=a,s==="start"){const h=this.revertVerticalList(n);l=this.clipTextVertical(h,t,e,r);const d=this.revertVerticalList(l.verticalList);d.unshift({text:i,direction:1,width:a}),l.verticalList=d}else if(s==="middle"){const h=this.clipTextVertical(n,t,e/2,r),d=this.revertVerticalList(n),u=this.clipTextVertical(d,t,e/2,r);h.verticalList.push({text:i,direction:1,width:a}),this.revertVerticalList(u.verticalList).forEach(c=>h.verticalList.push(c)),l={verticalList:h.verticalList,width:h.width+u.width}}else l=this.clipTextVertical(n,t,e,r),l.verticalList.push({text:i,direction:1,width:a});return l.width+=a,l}revertVerticalList(n){return n.reverse().map(t=>{const e=t.text.split("").reverse().join("");return Object.assign(Object.assign({},t),{text:e})})}clipTextWithSuffix(n,t,e,i,r,s,o=!1){if(i==="")return this.clipText(n,t,e,r);if(n.length===0)return{str:"",width:0};const a=this.measureTextWidth(n,t);if(!o&&a<=e)return{str:n,width:a};const l=this.measureTextWidth(i,t);if(l>e)return{str:"",width:0};if(o&&a+l<=e)return{str:n+i,width:a+l};e-=l;const h=this._clipText(n,t,e,0,n.length-1,s,i);if(r&&h.str!==n){const d=EC(n,h.str.length);d!==h.str.length&&(h.result=n.substring(0,d),h.width=this.measureTextWidth(h.str,t))}else o&&h.str===n&&(h.result=n+i);return h.str=h.result,h.width+=l,h}};HL=FRt([It()],HL);var HRt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};const zL=Symbol.for("TextMeasureContribution");let WL=class extends HL{};WL=HRt([It()],WL);const Qt=new Tkt,aQ=Symbol.for("CanvasFactory"),zRt=Symbol.for("Context2dFactory");function jL(n){return Qt.getNamed(aQ,bt.global.env)(n)}class WRt{constructor(){this.pools=[],this.allocatedCanvas=[]}shareCanvas(){return this.allocatedCanvas.length?this.allocatedCanvas[0]:this.getCommonCanvas()}getCommonCanvas(){return this._commonCanvas||(this._commonCanvas=this.allocate({width:100,height:100,dpr:2})),this._commonCanvas}allocate(t){if(!this.pools.length){const i=jL(Object.assign({nativeCanvas:bt.global.createCanvas(t)},t));return this.allocatedCanvas.push(i),i}const e=this.pools.pop();return e.resize(t.width,t.height),e.dpr=t.dpr,e}allocateByObj(t){if(!this.pools.length){const i={width:t.width/t.dpr,height:t.height/t.dpr,dpr:t.dpr},r=jL(Object.assign({nativeCanvas:bt.global.createCanvas(i)},i));return this.allocatedCanvas.push(r),r}const e=this.pools.pop();return e.width=t.width,e.height=t.height,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const tc=new WRt;var jRt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},NRt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const S1=Symbol.for("VWindow"),zD=Symbol.for("WindowHandlerContribution");let NL=class{get width(){if(this._handler){const n=this._handler.getWH();return this._width=n.width}return this._width}get height(){if(this._handler){const n=this._handler.getWH();return this._height=n.height}return this._height}get dpr(){return this._handler.getDpr()}constructor(){this.hooks={onChange:new Zr(["x","y","width","height"])},this.active=()=>{const n=this.global;!n.env||this.actived||(Qt.getNamed(zD,n.env).configure(this,n),this.actived=!0)},this._uid=nn.GenAutoIncrementId(),this.global=bt.global,this.postInit()}postInit(){this.global.hooks.onSetEnv.tap("window",this.active),this.active()}get style(){var n;return(n=this._handler.getStyle())!==null&&n!==void 0?n:{}}set style(n){this._handler.setStyle(n)}create(n){var t,e;this._handler.createWindow(n);const i=this._handler.getWH();this._width=i.width,this._height=i.height,n.viewBox?this.setViewBox(n.viewBox):n.canvasControled!==!1?this.setViewBox({x1:0,y1:0,x2:this._width,y2:this._height}):this.setViewBox({x1:0,y1:0,x2:(t=n.width)!==null&&t!==void 0?t:this._width,y2:(e=n.height)!==null&&e!==void 0?e:this._height}),this.title=this._handler.getTitle(),this.resizable=!0}setWindowHandler(n){this._handler=n}setDpr(n){return this._handler.setDpr(n)}resize(n,t){return this._handler.resizeWindow(n,t)}configure(){throw new Error("")}release(){return this.global.hooks.onSetEnv.unTap("window",this.active),this._handler.releaseWindow()}getContext(){return this._handler.getContext()}getNativeHandler(){return this._handler.getNativeHandler()}getImageBuffer(n){return this._handler.getImageBuffer?this._handler.getImageBuffer(n):null}addEventListener(n,t,e){return this._handler.addEventListener(n,t,e)}removeEventListener(n,t,e){return this._handler.removeEventListener(n,t,e)}dispatchEvent(n){return this._handler.dispatchEvent(n)}getBoundingClientRect(){return this._handler.getBoundingClientRect()}getContainer(){return this._handler.container}clearViewBox(n){this._handler.clearViewBox(n)}setViewBox(n){this._handler.setViewBox(n)}setViewBoxTransform(n,t,e,i,r,s){this._handler.setViewBoxTransform(n,t,e,i,r,s)}getViewBox(){return this._handler.getViewBox()}getViewBoxTransform(){return this._handler.getViewBoxTransform()}pointTransform(n,t){const e=this._handler.getViewBox(),i={x:n,y:t};return this._handler.getViewBoxTransform().transformPoint({x:n,y:t},i),i.x-=e.x1,i.y-=e.y1,i}hasSubView(){const n=this._handler.getViewBox();return!(n.x1===0&&n.y1===0&&di(this.width,n.width())&&di(this.height,n.height()))}isVisible(n){return this._handler.isVisible(n)}onVisibleChange(n){return this._handler.onVisibleChange(n)}getTopLeft(n){return this._handler.getTopLeft(n)}};NL=jRt([It(),NRt("design:paramtypes",[])],NL);var lQ=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},hQ=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},zV=function(n,t){return function(e,i){t(e,i,n)}};let $L=class{get canvas(){return this.tryInitCanvas(),this._canvas}get context(){return this.tryInitCanvas(),this._context}constructor(n){this.contributions=n,this.configured=!1,this.global=bt.global,this.global.hooks.onSetEnv.tap("graphic-util",(t,e,i)=>{this.configured=!1,this.configure(i,e)})}get textMeasure(){return this._textMeasure||this.configure(this.global,this.global.env),this._textMeasure}configure(n,t){this.configured||(this.contributions.getContributions().forEach(e=>{e.configure(this,t)}),this.configured=!0)}tryInitCanvas(){if(!this._canvas){const n=tc.shareCanvas();this._canvas=n,this._context=n.getContext("2d")}}bindTextMeasure(n){this._textMeasure=n}measureText(n,t,e="native"){var i;this.configure(this.global,this.global.env);const r=this.global.measureTextMethod;this.global.measureTextMethod=e;const s={width:this._textMeasure.measureTextWidth(n,t),height:(i=t.fontSize)!==null&&i!==void 0?i:_o.fontSize};return this.global.measureTextMethod=r,s}createTextMeasureInstance(n,t,e){return this.configure(this.global,this.global.env),new Wi(Object.assign({defaultFontParams:{fontFamily:_o.fontFamily,fontSize:_o.fontSize},getCanvasForMeasure:e||(()=>this.canvas),getTextBounds:void 0,specialCharSet:`-/: .,@%'"~`+Wi.ALPHABET_CHAR_SET+Wi.ALPHABET_CHAR_SET.toUpperCase()},t??{}),n)}drawGraphicToCanvas(n,t,e){if(!t.defaultLayer)return null;const i=Qt.get(S1),r=n.AABBBounds,s=r.width(),o=r.height(),a=-r.x1,l=-r.y1;i.create({viewBox:{x1:a,y1:l,x2:r.x2,y2:r.y2},width:s,height:o,canvas:e,dpr:t.window.dpr,canvasControled:!0,offscreen:!0,title:""});const h=t.params.optimize.disableCheckGraphicWidthOutRange;t.params.optimize.disableCheckGraphicWidthOutRange=!0,t.defaultLayer.getNativeHandler().drawTo(i,[n],{transMatrix:i.getViewBoxTransform(),viewBox:i.getViewBox(),stage:t,layer:t.defaultLayer,renderService:t.renderService,background:"transparent",clear:!0,updateBounds:!1}),t.params.optimize.disableCheckGraphicWidthOutRange=h;const d=i.getNativeHandler();return d.nativeCanvas?d.nativeCanvas:null}};$L=lQ([It(),zV(0,ue(en)),zV(0,xn(zL)),hQ("design:paramtypes",[Object])],$L);var Hh;(function(n){n[n.transform=0]="transform",n[n.matrix=1]="matrix"})(Hh||(Hh={}));const vn=new Pe;let VL=class{constructor(){this.matrix=new Pe}init(n){return this.mode=Hh.transform,this.originTransform=n,this.matrix.reset(),this}fromMatrix(n,t){return this.mode=Hh.matrix,this.outSourceMatrix=n,this.outTargetMatrix=t,this}scaleMatrix(n,t,e){const i=this.outSourceMatrix;if(vn.setValue(i.a,i.b,i.c,i.d,i.e,i.f),this.outTargetMatrix.reset(),e){const{x:r,y:s}=e;this.outTargetMatrix.translate(r,s),this.outTargetMatrix.scale(n,t),this.outTargetMatrix.translate(-r,-s)}else this.outTargetMatrix.scale(n,t);return this.outTargetMatrix.multiply(vn.a,vn.b,vn.c,vn.d,vn.e,vn.f),this}rotateMatrix(n,t){const e=this.outSourceMatrix;if(vn.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),t){const{x:i,y:r}=t;this.outTargetMatrix.translate(i,r),this.outTargetMatrix.rotate(n),this.outTargetMatrix.translate(-i,-r)}else this.outTargetMatrix.rotate(n);return this.outTargetMatrix.multiply(vn.a,vn.b,vn.c,vn.d,vn.e,vn.f),this}scale(n,t,e){return this.mode===Hh.matrix?this.scaleMatrix(n,t,e):this}rotate(n,t){return this.mode===Hh.matrix?this.rotateMatrix(n,t):this}translateMatrix(n,t){const e=this.outSourceMatrix;return vn.setValue(e.a,e.b,e.c,e.d,e.e,e.f),this.outTargetMatrix.reset(),this.outTargetMatrix.translate(n,t),this.outTargetMatrix.multiply(vn.a,vn.b,vn.c,vn.d,vn.e,vn.f),this}translate(n,t){return this.mode===Hh.matrix?this.translateMatrix(n,t):this}simplify(n){return this.mode===Hh.matrix?this.simplifyMatrix(n):this}simplifyMatrix(n){return this}};VL=lQ([It(),hQ("design:paramtypes",[])],VL);const cr={arc:mRt,area:vRt,circle:_Rt,line:CRt,path:SRt,symbol:MRt,text:nQ,rect:ARt,polygon:xRt,star:wRt,richtext:wl,richtextIcon:TRt,image:t0,group:bRt,glyph:yRt},TB=Object.keys(cr);function $Rt(){return{arc:Object.assign({},cr.arc),area:Object.assign({},cr.area),circle:Object.assign({},cr.circle),line:Object.assign({},cr.line),path:Object.assign({},cr.path),symbol:Object.assign({},cr.symbol),text:Object.assign({},cr.text),rect:Object.assign({},cr.rect),polygon:Object.assign({},cr.polygon),star:Object.assign({},cr.star),richtext:Object.assign({},cr.richtext),richtextIcon:Object.assign({},cr.richtextIcon),image:Object.assign({},cr.image),group:Object.assign({},cr.group),glyph:Object.assign({},cr.glyph)}}function zy(n,t){Object.keys(t).forEach(e=>{n[e]=t[e]})}const WV=$Rt();class e0{constructor(){this.initTheme(),this.dirty=!1}initTheme(){this._defaultTheme={},TB.forEach(t=>{this._defaultTheme[t]=Object.create(WV[t])}),this.combinedTheme=this._defaultTheme}getTheme(t){if(!t)return this.combinedTheme;if(!this.dirty)return this.combinedTheme;let e={};const i=this.getParentWithTheme(t);return i&&(e=i.theme),this.applyTheme(t,e),this.combinedTheme}getParentWithTheme(t){for(;t.parent;)if((t=t.parent).theme)return t;return null}applyTheme(t,e,i=!1){if(this.dirty){const r=this.getParentWithTheme(t);if(r){const s=r.theme;(s.dirty||i)&&s.applyTheme(r,e,!0)}this.userTheme?this.doCombine(r&&r.theme.combinedTheme):(r?this.combinedTheme=r.theme.combinedTheme:(this.combinedTheme=this._defaultTheme,ge.getInstance().warn("")),this.dirty=!1)}return this.combinedTheme}doCombine(t){const e=this.userTheme,i=this.combinedTheme;TB.forEach(r=>{const s=Object.create(WV[r]);t&&t[r]&&zy(s,t[r]),i[r]&&zy(s,i[r]),e[r]&&zy(s,e[r]),this.combinedTheme[r]=s}),e.common&&TB.forEach(r=>{zy(this.combinedTheme[r],e.common)}),this.dirty=!1}setTheme(t,e){let i=this.userTheme;i?Object.keys(t).forEach(r=>{i[r]?Object.assign(i[r],t[r]):i[r]=Object.assign({},t[r])}):i=t,this.userTheme=i,this.dirty=!0,this.dirtyChildren(e)}resetTheme(t,e){this.userTheme=t,this.dirty=!0,this.dirtyChildren(e)}dirtyChildren(t){t.forEachChildren(e=>{e.isContainer&&(e.theme&&(e.theme.dirty=!0),this.dirtyChildren(e))})}}const dQ=new e0;function ne(n,t){return n.glyphHost?ne(n.glyphHost):t?(n.isContainer,t):VRt(n)||n.attachedThemeGraphic&&ne(n.attachedThemeGraphic)||dQ.getTheme()}function VRt(n){let t;if(t=n.isContainer?n:n.parent,t){for(;t&&!t.theme;)t=t.parent;return t?(t.theme||t.createTheme(),t.theme.getTheme(t)):dQ.getTheme()}return null}var GRt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};class URt extends us{get previousSibling(){return this._prev}get nextSibling(){return this._next}get children(){return this.getChildren()}get firstChild(){return this._firstChild}get lastChild(){return this._lastChild}get count(){return this._count}get childrenCount(){return this._idMap?this._idMap.size:0}constructor(){super(),this._uid=nn.GenAutoIncrementId(),this._firstChild=null,this._lastChild=null,this.parent=null,this._count=1}forEachChildren(t,e=!1){if(e){let i=this._lastChild,r=0;for(;i;){if(t(i,r++))return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){if(t(i,r++))return;i=i._next}}}forEachChildrenAsync(t,e=!1){return GRt(this,void 0,void 0,function*(){if(e){let i=this._lastChild,r=0;for(;i;){let s=t(i,r++);if(s.then&&(s=yield s),s)return;i=i._prev}}else{let i=this._firstChild,r=0;for(;i;){let s=t(i,r++);if(s.then&&(s=yield s),s)return;i=i._next}}})}forEach(t){return this.forEachChildren(t)}appendChild(t,e=!0){if(this._uid===t._uid)return null;if(!e&&t.isAncestorsOf(this))throw new Error("Node::appendChildappend");return t.parent&&t.parent.removeChild(t),t.parent=this,this._lastChild?(this._lastChild._next=t,t._prev=this._lastChild,this._lastChild=t):(this._firstChild=this._lastChild=t,t._prev=t._next=null),this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this.setCount(t.count),this._structEdit=!0,t}appendChildArrHighPerformance(t,e=!1){return console.error(""),t}insertBefore(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("Node::insertBeforeinsert");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,t._prev=e._prev,e._prev?e._prev._next=t:this._firstChild=t,e._prev=t,t._next=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertAfter(t,e){if(!e)return this.appendChild(t);if(this===t||t===e)return null;if(t.isAncestorsOf(this))throw new Error("Node::insertAfterinsert");return e.parent!==this?null:(t.parent&&t.parent.removeChild(t),t.parent=this,e._next?(e._next._prev=t,t._next=e._next):this._lastChild=t,e._next=t,t._prev=e,this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t)}insertInto(t,e){if(!this._ignoreWarn&&this._nodeList&&ge.getInstance().warn("insertIntoKeepIdxinsertInto"),e>=this.childrenCount)return this.appendChild(t);if(this===t)return null;if(t.isAncestorsOf(this))throw new Error("Node::insertBeforeinsert");if(t.parent&&t.parent.removeChild(t),t.parent=this,e===0)t._next=this._firstChild,this._firstChild&&(this._firstChild._prev=t),t._prev=null,this._firstChild=t;else{let i=this._firstChild;for(let r=0;r<e;r++){if(!i)return null;r>0&&(i=i._next)}if(!i)return null;t._next=i._next,t._prev=i,i._next=t,t._next&&(t._next._prev=t)}return this._idMap||(this._idMap=new Map),this._idMap.set(t._uid,t),this._structEdit=!0,this.setCount(t.count),t}insertIntoKeepIdx(t,e){if(this._nodeList||(this._nodeList=this.children),this._nodeList[e]){const s=this._nodeList[e];return this._nodeList.splice(e,0,t),this.insertBefore(t,s)}let i;this._nodeList[e]=t;for(let s=e-1;s>=0&&(i=this._nodeList[s],!i);s--);if(i)return i._next?this.insertBefore(t,i._next):this.appendChild(t);this._ignoreWarn=!0;const r=this.insertInto(t,0);return this._ignoreWarn=!1,r}removeChild(t){if(!this._idMap||!this._idMap.has(t._uid))return null;if(this._idMap.delete(t._uid),this._nodeList){const e=this._nodeList.findIndex(i=>i===t);e>=0&&this._nodeList.splice(e,1)}return t._prev?t._prev._next=t._next:this._firstChild=t._next,t._next?t._next._prev=t._prev:this._lastChild=t._prev,t.parent=null,t._prev=null,t._next=null,this._structEdit=!0,this.setCount(-t.count),t}delete(){this.parent&&this.parent.removeChild(this)}removeAllChild(t){if(!this._idMap)return;this._nodeList&&(this._nodeList.length=0);let e=this._firstChild;for(;e;){const i=e._next;e.parent=null,e._prev=null,e._next=null,e=e._next,e=i}this._firstChild=null,this._lastChild=null,this._idMap.clear(),this._structEdit=!0,this.setCount(1-this._count)}replaceChild(t,e){throw new Error("")}find(t,e=!1){let i=null;return this.forEachChildren((r,s)=>!(r===this||!t(r,s))&&(i=r,!0)),e&&this.forEachChildren(r=>{if(r.isContainer){const s=r.find(t,!0);if(s)return i=s,!0}return!1}),i}findAll(t,e=!1){let i=[];return this.forEachChildren((r,s)=>{r!==this&&t(r,s)&&i.push(r)}),e&&this.forEachChildren(r=>{if(r.isContainer){const s=r.findAll(t,!0);s.length&&(i=i.concat(s))}}),i}getElementById(t){return this.find(e=>e.id===t,!0)}findChildById(t){return this.getElementById(t)}findChildByUid(t){return this._idMap&&this._idMap.get(t)||null}getElementsByName(t){return this.findAll(e=>e.name===t,!0)}findChildrenByName(t){return this.getElementsByName(t)}getElementsByType(t){return this.findAll(e=>e.type===t,!0)}getChildByName(t,e=!1){return this.find(i=>i.name===t,e)}getChildAt(t){let e=this._firstChild;if(!e)return null;for(let i=0;i<t;i++){if(!e._next)return null;e=e._next}return e}at(t){return this.getChildAt(t)}containNode(t){if(!this._idMap)return!1;if(this._idMap.has(t._uid))return!0;let e=this._firstChild;for(;e;){if(e.containNode(t))return!0;e=e._next}return!1}getRootNode(){let t=this.parent;for(;t!=null&&t.parent;)t=t.parent;return t||this}hasChildNodes(){return this._firstChild!==null}addChild(t){return this.appendChild(t)}add(t){return this.appendChild(t)}getChildren(){const t=[];let e=this._firstChild;for(;e;)t.push(e),e=e._next;return t}isChildOf(t){return!!this.parent&&this.parent._uid===t._uid}isParentOf(t){return t.isChildOf(this)}isDescendantsOf(t){let e=this.parent;if(!e)return!1;do{if(e._uid===t._uid)return!0;e=e.parent}while(e!==null);return!1}isAncestorsOf(t){return t.isDescendantsOf(this)}getAncestor(t){throw new Error("")}setAllDescendantsProps(t,e){let i=this._firstChild;for(;i;)i[t]=e,i.setAllDescendantsProps(t,e),i=i._next}setCount(t){this._count+=t;let e=this.parent;if(e)do e._count+=t,e=e.parent;while(e!==null)}clone(){throw new Error("")}cloneTo(t){throw new Error("")}getParent(){return this.parent}del(t){return this.removeChild(t)}addEventListener(t,e,i){const r=Re(i,!0)&&i||kt(i)&&i.capture,s=kt(i)&&i.once,o=it(e)?void 0:e;return t=r?`${t}capture`:t,e=it(e)?e:e.handleEvent,s?super.once(t,e,o):super.on(t,e,o),this}on(t,e,i){return this.addEventListener(t,e,i)}removeEventListener(t,e,i){const r=Re(i,!0)&&i||kt(i)&&i.capture,s=it(e)?void 0:e;t=r?`${t}capture`:t,e=it(e)?e:e.handleEvent;const o=kt(i)&&i.once;return super.off(t,e,s,o),this}off(t,e,i){return this.removeEventListener(t,e,i)}once(t,e,i){return kt(i)?(i.once=!0,this.addEventListener(t,e,i)):this.addEventListener(t,e,{once:!0})}removeAllEventListeners(){return super.removeAllListeners(),this}removeAllListeners(){return this.removeAllEventListeners()}dispatchEvent(t,...e){return super.emit(t.type,t,...e),!t.defaultPrevented}emit(t,e){return this.dispatchEvent(t,e)}release(){this.removeAllListeners()}}class ub{get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get x(){return this.canvas.x}get y(){return this.canvas.y}get canvasX(){return this.canvas.x}get canvasY(){return this.canvas.y}get viewX(){return this.viewport.x}get viewY(){return this.viewport.y}constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=ub.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer={x:0,y:0},this.page={x:0,y:0},this.canvas={x:0,y:0},this.viewport={x:0,y:0},this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.composedDetailPath(),this.path}composedDetailPath(){return this.pickParams&&this.pickParams.graphic?(this.detailPath=this.path.slice(),this._composedDetailPath(this.pickParams)):this.detailPath=this.path.slice(),this.detailPath}_composedDetailPath(t){if(t&&t.graphic){const e=t.graphic;if(e.stage){const i=e.stage.eventSystem.manager.propagationPath(e);this.detailPath.push(i),this._composedDetailPath(t.params)}}}preventDefault(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault()}catch{this.nativeEvent.preventDefault&&it(this.nativeEvent.preventDefault)&&this.nativeEvent.preventDefault()}this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){try{this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.stopPropagation()}catch{this.nativeEvent.stopPropagation&&it(this.nativeEvent.stopPropagation)&&this.nativeEvent.stopPropagation()}this.propagationStopped=!0}initEvent(){}initUIEvent(){}clone(){throw new Error("Method not implemented.")}}class x1 extends ub{constructor(){super(...arguments),this.client={x:0,y:0},this.movement={x:0,y:0},this.offset={x:0,y:0},this.global={x:0,y:0},this.screen={x:0,y:0}}get clientX(){return this.client.x}get clientY(){return this.client.y}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,i,r,s,o,a,l,h,d,u,c,g,p,f){throw new Error("Method not implemented.")}}class Ms extends x1{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}clone(){var t,e,i;const r=new Ms(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyPointerData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const s=this.composedDetailPath();return r.detailPath=s&&s.slice(),r.type=this.type,r}}class hd extends x1{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}clone(){var t,e,i;const r=new hd(this.manager);r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.detailPath=[],r.target=null,r.nativeEvent=this.nativeEvent,r.originalEvent=this.originalEvent,(t=this.manager)===null||t===void 0||t.copyWheelData(this,r),(e=this.manager)===null||e===void 0||e.copyMouseData(this,r),(i=this.manager)===null||i===void 0||i.copyData(this,r),r.target=this.target,r.path=this.composedPath().slice();const s=this.composedDetailPath();return r.detailPath=s&&s.slice(),r.type=this.type,r}}hd.DOM_DELTA_PIXEL=0,hd.DOM_DELTA_LINE=1,hd.DOM_DELTA_PAGE=2;class FM extends ub{constructor(t,e){super(),this.type=t,this.detail=e}}const uQ="*",Hu=typeof performance=="object"&&performance.now?performance:Date;function Mh(n){return n==="mouse"||n==="pen"}class YRt{constructor(t,e){this.dispatch=new us,this.cursorTarget=null,this.pauseNotify=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.onPointerDown=(i,r)=>{if(!(i instanceof Ms))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(s,"pointerdown"),s.pointerType==="touch")this.dispatchEvent(s,"touchstart");else if(Mh(s.pointerType)){const o=s.button===2;this.dispatchEvent(s,o?"rightdown":"mousedown")}this.trackingData(i.pointerId).pressTargetsByButton[i.button]=s.composedPath(),this.freeEvent(s)},this.onPointerMove=(i,r)=>{var s,o;if(!(i instanceof Ms))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.createPointerEvent(i,i.type,r),l=Mh(a.pointerType),h=this.trackingData(i.pointerId),d=this.findMountedTarget(h.overTargets);if(h.overTargets&&d&&d!==this.rootTarget&&d!==a.target){const u=i.type==="mousemove"?"mouseout":"pointerout",c=this.createPointerEvent(i,u,d||void 0);if(this.dispatchEvent(c,"pointerout"),l&&this.dispatchEvent(c,"mouseout"),!a.composedPath().includes(d)){const g=this.createPointerEvent(i,"pointerleave",d||void 0);for(g.eventPhase=g.AT_TARGET;g.target&&!a.composedPath().includes(g.target);)g.currentTarget=g.target,this.notifyTarget(g),l&&this.notifyTarget(g,"mouseleave"),g.target=g.target.parent;this.freeEvent(g)}this.freeEvent(c)}if(d!==a.target){const u=i.type==="mousemove"?"mouseover":"pointerover",c=this.clonePointerEvent(a,u);this.dispatchEvent(c,"pointerover"),l&&this.dispatchEvent(c,"mouseover");let g=d==null?void 0:d.parent;for(;g&&g!==this.rootTarget.parent&&g!==a.target;)g=g.parent;if(!g||g===this.rootTarget.parent){const p=this.clonePointerEvent(a,"pointerenter");p.eventPhase=p.AT_TARGET;let f=p.target;const m=new Set;let v=d;for(;v&&v!==this.rootTarget;)m.add(v),v=v.parent;for(;f&&f!==d&&f!==this.rootTarget.parent;)m.has(f)||(p.currentTarget=f,this.notifyTarget(p),l&&this.notifyTarget(p,"mouseenter")),f=f.parent;this.freeEvent(p)}this.freeEvent(c)}this.dispatchEvent(a,"pointermove"),a.pointerType==="touch"&&this.dispatchEvent(a,"touchmove"),l&&(this.dispatchEvent(a,"mousemove"),this.cursorTarget=a.target,this.cursor=((o=(s=a.target)===null||s===void 0?void 0:s.attribute)===null||o===void 0?void 0:o.cursor)||this.rootTarget.getCursor()),h.overTargets=a.composedPath(),this.freeEvent(a)},this.onPointerOver=(i,r)=>{var s,o;if(!(i instanceof Ms))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const a=this.trackingData(i.pointerId),l=this.createPointerEvent(i,i.type,r),h=Mh(l.pointerType);this.dispatchEvent(l,"pointerover"),h&&this.dispatchEvent(l,"mouseover"),l.pointerType==="mouse"&&(this.cursorTarget=l.target,this.cursor=((o=(s=l.target)===null||s===void 0?void 0:s.attribute)===null||o===void 0?void 0:o.cursor)||this.rootTarget.getCursor());const d=this.clonePointerEvent(l,"pointerenter");for(d.eventPhase=d.AT_TARGET;d.target&&d.target!==this.rootTarget.parent;)d.currentTarget=d.target,this.notifyTarget(d),h&&this.notifyTarget(d,"mouseenter"),d.target=d.target.parent;a.overTargets=l.composedPath(),this.freeEvent(l),this.freeEvent(d)},this.onPointerOut=(i,r)=>{if(!(i instanceof Ms))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=this.trackingData(i.pointerId);if(s.overTargets){const o=Mh(i.pointerType),a=this.findMountedTarget(s.overTargets),l=this.createPointerEvent(i,"pointerout",a||void 0);this.dispatchEvent(l),o&&this.dispatchEvent(l,"mouseout");const h=this.createPointerEvent(i,"pointerleave",a||void 0);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),o&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;s.overTargets=[],this.freeEvent(l),this.freeEvent(h)}this.cursorTarget=null,this.cursor=""},this.onPointerUp=(i,r)=>{var s;if(!(i instanceof Ms))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const o=Hu.now(),a=this.createPointerEvent(i,i.type,r);if(this.dispatchEvent(a,"pointerup"),a.pointerType==="touch")this.dispatchEvent(a,"touchend");else if(Mh(a.pointerType)){const u=a.button===2;this.dispatchEvent(a,u?"rightup":"mouseup")}const l=this.trackingData(i.pointerId),h=this.findMountedTarget(l.pressTargetsByButton[i.button]);let d=h;if(h&&!a.composedPath().includes(h)){let u=h;for(;u&&!a.composedPath().includes(u);){if(a.currentTarget=u,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch")this.notifyTarget(a,"touchendoutside");else if(Mh(a.pointerType)){const c=a.button===2;this.notifyTarget(a,c?"rightupoutside":"mouseupoutside")}u=u.parent}delete l.pressTargetsByButton[i.button],d=u}if(d){const u=this.clonePointerEvent(a,"click");u.target=d,u.path=[],u.detailPath=[],l.clicksByButton[i.button]||(l.clicksByButton[i.button]={clickCount:0,target:u.target,timeStamp:o});const c=l.clicksByButton[i.button];c.target===u.target&&o-c.timeStamp<((s=this._config.clickInterval)!==null&&s!==void 0?s:200)?++c.clickCount:c.clickCount=1,c.target=u.target,c.timeStamp=o,u.detail=c.clickCount,Mh(u.pointerType)?(this.dispatchEvent(u,"click"),c.clickCount===2&&this.dispatchEvent(u,"dblclick")):u.pointerType==="touch"&&this._config.supportsTouchEvents&&(this.dispatchEvent(u,"tap"),c.clickCount===2&&this.dispatchEvent(u,"dbltap")),this.dispatchEvent(u,"pointertap"),this.freeEvent(u)}this.freeEvent(a)},this.onPointerUpOutside=(i,r)=>{if(!(i instanceof Ms))return void ge.getInstance().warn("EventManager cannot map a non-pointer event as a pointer event");const s=this.trackingData(i.pointerId),o=this.findMountedTarget(s.pressTargetsByButton[i.button]),a=this.createPointerEvent(i,i.type,r);if(o){let l=o;for(;l;)a.currentTarget=l,this.notifyTarget(a,"pointerupoutside"),a.pointerType==="touch"?this.notifyTarget(a,"touchendoutside"):Mh(a.pointerType)&&this.notifyTarget(a,a.button===2?"rightupoutside":"mouseupoutside"),l=l.parent;delete s.pressTargetsByButton[i.button]}this.freeEvent(a)},this.onWheel=(i,r)=>{if(!(i instanceof hd))return void ge.getInstance().warn("EventManager cannot map a non-wheel event as a wheel event");const s=this.createWheelEvent(i,r);this.dispatchEvent(s),this.freeEvent(s)},this.rootTarget=t,this.mappingTable={},this._config=Object.assign({clickInterval:200},e),this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort((i,r)=>i.priority-r.priority)}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){var e,i,r,s,o,a,l;if(!this.rootTarget)return;const h=this.mappingTable[t.type];let d;const u=`${t.canvasX}-${t.canvasY}`;if(!((e=this._prePointTargetCache)===null||e===void 0)&&e[u]&&(!((r=(i=this._prePointTargetCache)===null||i===void 0?void 0:i[u])===null||r===void 0)&&r.stage)&&((o=(s=this._prePointTargetCache)===null||s===void 0?void 0:s[u])===null||o===void 0?void 0:o.stage.renderCount)===((a=this._prePointTargetCache)===null||a===void 0?void 0:a.stageRenderCount)?d=this._prePointTargetCache[u]:(d=this.pickTarget(t.viewX,t.viewY,t),t.pickParams||(this._prePointTargetCache={[u]:d,stageRenderCount:(l=d==null?void 0:d.stage.renderCount)!==null&&l!==void 0?l:-1})),h)for(let c=0,g=h.length;c<g;c++)h[c].fn(t,d);else ge.getInstance().warn(`[EventManager]: Event mapping not defined for ${t.type}`)}propagate(t,e){if(!t.target)return;const i=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,s=i.length-1;r<s;r++)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=i.length-2;r>=0;r--)if(t.currentTarget=i[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}propagationPath(t){const e=[t];for(let i=0;i<2048&&t!==this.rootTarget&&t.parent;i++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}notifyTarget(t,e){if(this.pauseNotify)return;e=e??t.type;const i=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,i),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let i=1;i<t.length&&t[i].parent===e;i++)e=t[i];return e}createPointerEvent(t,e,i){var r,s;const o=this.allocateEvent(Ms);return this.copyPointerData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=i||this.pickTarget((r=o.viewX)!==null&&r!==void 0?r:o.global.x,(s=o.viewY)!==null&&s!==void 0?s:o.global.y,o),typeof e=="string"&&(o.type=e),o}createWheelEvent(t,e){var i,r;const s=this.allocateEvent(hd);return this.copyWheelData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=e||this.pickTarget((i=s.viewX)!==null&&i!==void 0?i:s.global.x,(r=s.viewY)!==null&&r!==void 0?r:s.global.y,s),s}clonePointerEvent(t,e){const i=this.allocateEvent(Ms);i.nativeEvent=t.nativeEvent,i.originalEvent=t.originalEvent,this.copyPointerData(t,i),this.copyMouseData(t,i),this.copyData(t,i),i.target=t.target,i.path=t.composedPath().slice();const r=t.composedDetailPath();return i.detailPath=r&&r.slice(),i.type=e??i.type,i}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof Ms&&e instanceof Ms&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof x1&&e instanceof x1&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.ctrlKey=t.ctrlKey,e.shiftKey=t.shiftKey,e.metaKey=t.metaKey,["client","movement","canvas","screen","global","offset","viewport"].forEach(i=>{e[i].x=t[i].x,e[i].y=t[i].y}))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=Hu.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.x=t.layer.x,e.layer.y=t.layer.y,e.page.x=t.page.x,e.page.y=t.page.y,e.pickParams=t.pickParams}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){var e;this.eventPool.has(t)||this.eventPool.set(t,[]);const i=((e=this.eventPool.get(t))===null||e===void 0?void 0:e.pop())||new t(this);return i.eventPhase=i.NONE,i.currentTarget=null,i.path=[],i.detailPath=[],i.target=null,i}freeEvent(t){var e;if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventManager!");const i=t.constructor;this.eventPool.has(i)||this.eventPool.set(i,[]),(e=this.eventPool.get(i))===null||e===void 0||e.push(t)}notifyListeners(t,e){const i=t.currentTarget._events[e];if(i)if("fn"in i)i.once&&t.currentTarget.removeEventListener(e,i.fn,{once:!0}),i.fn.call(i.context,t);else for(let r=0,s=i.length;r<s&&!t.propagationImmediatelyStopped;r++)i[r].once&&t.currentTarget.removeEventListener(e,i[r].fn,{once:!0}),i[r].fn.call(i[r].context,t);this.emitDelegation(t,e)}emitDelegation(t,e){const i=t.currentTarget._events[uQ];if(i)if("fn"in i)i.fn.call(i.context,t,e);else for(let r=0,s=i.length;r<s&&!t.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,t,e)}pickTarget(t,e,i){let r;const s=this.rootTarget.pick(t,e);return r=s&&s.graphic?s.graphic:s&&s.group?s.group:this.rootTarget.AABBBounds.contains(t,e)?this.rootTarget:null,i&&(i.pickParams=s.params),r}release(){this.dispatch.removeAllListeners(),this.eventPool.clear(),this.rootTarget=null,this.mappingTable=null,this.mappingState=null,this.cursorTarget=null}}const XRt={dispatchEvent(n){var t;if(!(n instanceof ub))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return n.defaultPrevented=!1,n.path=[],n.detailPath&&(n.detailPath=[]),n.target=this,(t=n==null?void 0:n.manager)===null||t===void 0||t.dispatchEvent(n),!n.defaultPrevented},emit(n,t){return this.dispatchEvent(new FM(n,t))}},KRt={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class qRt{constructor(t){this.resolution=1,this.onPointerDown=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const u=this.normalizeToPointerData(d);this.autoPreventDefault&&u[0].isNormalized&&(d.cancelable||!("cancelable"in d))&&d.preventDefault();for(let c=0,g=u.length;c<g;c++){const p=u[c],f=this.bootstrapEvent(this.rootPointerEvent,p);this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerMove=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch"||this.isEventOutsideOfTargetElement(d))return;const u=this.normalizeToPointerData(d);for(let c=0,g=u.length;c<g;c++){const p=this.bootstrapEvent(this.rootPointerEvent,u[c]);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerUp=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const u=this.isEventOutsideOfTargetViewPort(d)?"outside":"",c=this.normalizeToPointerData(d);for(let g=0,p=c.length;g<p;g++){const f=this.bootstrapEvent(this.rootPointerEvent,c[g]);f.type+=u,this.manager.mapEvent(f)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onPointerOverOut=d=>{if(this.supportsTouchEvents&&d.pointerType==="touch")return;const u=this.normalizeToPointerData(d);for(let c=0,g=u.length;c<g;c++){const p=this.bootstrapEvent(this.rootPointerEvent,u[c]);this.manager.mapEvent(p)}this.setCursor(this.manager.cursor,this.manager.cursorTarget),this.rootPointerEvent.nativeEvent=null},this.onWheel=d=>{const u=this.normalizeWheelEvent(d);this.manager.mapEvent(u)};const{targetElement:e,resolution:i,rootNode:r,global:s,autoPreventDefault:o=!1,clickInterval:a,supportsTouchEvents:l=s.supportsTouchEvents,supportsPointerEvents:h=s.supportsPointerEvents}=t;this.manager=new YRt(r,{clickInterval:a,supportsTouchEvents:l}),this.globalObj=s,this.supportsPointerEvents=h,this.supportsTouchEvents=l,this.supportsMouseEvents=s.supportsMouseEvents,this.applyStyles=s.applyStyles,this.autoPreventDefault=o,this.eventsAdded=!1,this.rootPointerEvent=new Ms,this.rootWheelEvent=new hd,this.cursorStyles={default:"inherit",pointer:"pointer"},this.resolution=i,this.setTargetElement(e)}release(){this.removeEvents(),this.manager&&this.manager.release(),this.domElement=null,this.manager=null,this.globalObj=null}setCursor(t,e){if(!e&&!this.manager.rootTarget.window._handler.canvas.controled)return;t||(t="default");const{applyStyles:i,domElement:r}=this;if(this.currentCursor===t)return;this.currentCursor=t;const s=this.cursorStyles[t];s?typeof s=="string"&&i?r.style.cursor=s:typeof s=="function"?s(t):typeof s=="object"&&i&&Object.assign(r.style,s):i&&yt(t)&&!Qr(this.cursorStyles,t)&&(r.style.cursor=t)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const{globalObj:t,domElement:e}=this;this.supportsPointerEvents?(t.getDocument()?(t.getDocument().addEventListener("pointermove",this.onPointerMove,!0),t.getDocument().addEventListener("pointerup",this.onPointerUp,!0)):(e.addEventListener("pointermove",this.onPointerMove,!0),e.addEventListener("pointerup",this.onPointerUp,!0)),e.addEventListener("pointerdown",this.onPointerDown,!0),e.addEventListener("pointerleave",this.onPointerOverOut,!0),e.addEventListener("pointerover",this.onPointerOverOut,!0)):(t.getDocument()?(t.getDocument().addEventListener("mousemove",this.onPointerMove,!0),t.getDocument().addEventListener("mouseup",this.onPointerUp,!0)):(e.addEventListener("mousemove",this.onPointerMove,!0),e.addEventListener("mouseup",this.onPointerUp,!0)),e.addEventListener("mousedown",this.onPointerDown,!0),e.addEventListener("mouseout",this.onPointerOverOut,!0),e.addEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(e.addEventListener("touchstart",this.onPointerDown,!0),e.addEventListener("touchend",this.onPointerUp,!0),e.addEventListener("touchmove",this.onPointerMove,!0)),e.addEventListener("wheel",this.onWheel,{capture:!0}),this.eventsAdded=!0}removeEvents(){var t;if(!this.eventsAdded||!this.domElement)return;const{globalObj:e,domElement:i}=this,r=(t=e.getDocument())!==null&&t!==void 0?t:i;this.supportsPointerEvents?(r.removeEventListener("pointermove",this.onPointerMove,!0),r.removeEventListener("pointerup",this.onPointerUp,!0),i.removeEventListener("pointerdown",this.onPointerDown,!0),i.removeEventListener("pointerleave",this.onPointerOverOut,!0),i.removeEventListener("pointerover",this.onPointerOverOut,!0)):(r.removeEventListener("mousemove",this.onPointerMove,!0),r.removeEventListener("mouseup",this.onPointerUp,!0),i.removeEventListener("mousedown",this.onPointerDown,!0),i.removeEventListener("mouseout",this.onPointerOverOut,!0),i.removeEventListener("mouseover",this.onPointerOverOut,!0)),this.supportsTouchEvents&&(i.removeEventListener("touchstart",this.onPointerDown,!0),i.removeEventListener("touchend",this.onPointerUp,!0),i.removeEventListener("touchmove",this.onPointerMove,!0)),i.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapToViewportPoint(t){return this.domElement.pointTransform?this.domElement.pointTransform(t.x,t.y):t}mapToCanvasPoint(t){var e,i;const r=(e=this.globalObj)===null||e===void 0?void 0:e.mapToCanvasPoint(t,this.domElement);if(r)return r;let s=0,o=0;if(t.changedTouches){const l=(i=t.changedTouches[0])!==null&&i!==void 0?i:{};s=l.clientX||0,o=l.clientY||0}else s=t.clientX||0,o=t.clientY||0;const a=this.domElement.getBoundingClientRect();return{x:s-a.left,y:o-a.top}}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t.changedTouches&&t.changedTouches.length)for(let i=0,r=t.changedTouches.length;i<r;i++){const s=t.changedTouches[i];ce(s.button)&&(s.button=0),ce(s.buttons)&&(s.buttons=1),ce(s.isPrimary)&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),ce(s.width)&&(s.width=s.radiusX||1),ce(s.height)&&(s.height=s.radiusY||1),ce(s.tiltX)&&(s.tiltX=0),ce(s.tiltY)&&(s.tiltY=0),ce(s.pointerType)&&(s.pointerType="touch"),ce(s.pointerId)&&(s.pointerId=s.identifier||0),ce(s.pressure)&&(s.pressure=s.force||.5),ce(s.twist)&&(s.twist=0),ce(s.tangentialPressure)&&(s.tangentialPressure=0),ce(s.layerX)&&(s.layerX=s.offsetX=s.clientX),ce(s.layerY)&&(s.layerY=s.offsetY=s.clientY),s.isNormalized=!0,s.type=t.type,e.push(s)}else if(this.globalObj.supportsMouseEvents&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof PointerEvent))e.push(t);else{const i=t;ce(i.isPrimary)&&(i.isPrimary=!0),ce(i.width)&&(i.width=1),ce(i.height)&&(i.height=1),ce(i.tiltX)&&(i.tiltX=0),ce(i.tiltY)&&(i.tiltY=0),ce(i.pointerType)&&(i.pointerType="mouse"),ce(i.pointerId)&&(i.pointerId=1),ce(i.pressure)&&(i.pressure=.5),ce(i.twist)&&(i.twist=0),ce(i.tangentialPressure)&&(i.tangentialPressure=0),i.isNormalized=!0,e.push(i)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;this.transferMouseData(e,t),e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ;const{x:i,y:r}=this.mapToCanvasPoint(t);e.canvas.x=i,e.canvas.y=r,e.global.x=i,e.global.y=r,e.offset.x=i,e.offset.y=r;const{x:s,y:o}=this.mapToViewportPoint(e);return e.viewport.x=s,e.viewport.y=o,e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e);const{x:i,y:r}=this.mapToCanvasPoint(e);t.canvas.x=i,t.canvas.y=r,t.global.x=i,t.global.y=r,t.offset.x=i,t.offset.y=r;const{x:s,y:o}=this.mapToViewportPoint(t);return t.viewport.x=s,t.viewport.y=o,t.isTrusted=e.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=KRt[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=Hu.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.shiftKey=e.shiftKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null}isEventOutsideOfTargetViewPort(t){if(this.isEventOutsideOfTargetElement(t))return!0;if(this.domElement.getViewBox){const e=this.mapToViewportPoint(this.mapToCanvasPoint(t)),i=this.domElement.getViewBox(),r=i.width(),s=i.height();return!(e.x<r&&e.y<s&&e.x>0&&e.y>0)}return!1}isEventOutsideOfTargetElement(t){let e=t.target;return t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]),e!==(this.domElement.getNativeHandler?this.domElement.getNativeHandler().nativeCanvas:this.domElement)}pauseTriggerEvent(){this.manager.pauseNotify=!0}resumeTriggerEvent(){this.manager.pauseNotify=!1}}var ws;(function(n){n[n.INITIAL=0]="INITIAL",n[n.RUNNING=1]="RUNNING",n[n.PAUSE=2]="PAUSE"})(ws||(ws={}));class Rv{static Avaliable(){return!!bt.global.getRequestAnimationFrame()}avaliable(){return Rv.Avaliable()}tick(t,e){bt.global.getRequestAnimationFrame()(()=>{this.released||e(this)})}release(){this.released=!0}getTime(){return Date.now()}}class w1{static Avaliable(){return!0}avaliable(){return w1.Avaliable()}tick(t,e){this.timerId=setTimeout(()=>{e(this)},t)}release(){this.timerId>0&&(clearTimeout(this.timerId),this.timerId=-1)}getTime(){return Date.now()}}class ZRt extends us{set mode(t){this._mode!==t&&(this._mode=t,this.setupTickHandler())}get mode(){return this._mode}constructor(t=[]){super(),this.handleTick=(e,i)=>{const{once:r=!1}=i??{};this.ifCanStop()?this.stop():(this._handlerTick(),r||e.tick(this.interval,this.handleTick))},this._handlerTick=()=>{const e=this.tickerHandler.getTime();let i=0;this.lastFrameTime>=0&&(i=e-this.lastFrameTime),this.lastFrameTime=e,this.status===ws.RUNNING&&(this.tickCounts++,this.timelines.forEach(r=>{r.tick(i)}),this.emit("tick"))},this.init(),this.lastFrameTime=-1,this.tickCounts=0,this.timelines=t,this.autoStop=!0}init(){this.interval=NaN,this.status=ws.INITIAL,bt.global.hooks.onSetEnv.tap("default-ticker",()=>{this.initHandler()}),bt.global.env&&this.initHandler()}addTimeline(t){this.timelines.push(t)}remTimeline(t){this.timelines=this.timelines.filter(e=>e!==t)}getTimelines(){return this.timelines}initHandler(){if(this._mode)return null;const t=[{mode:"raf",cons:Rv},{mode:"timeout",cons:w1}];for(let e=0;e<t.length;e++)if(t[e].cons.Avaliable()){this.mode=t[e].mode;break}return null}setupTickHandler(){let t;switch(this._mode){case"raf":t=new Rv;break;case"timeout":t=new w1;break;default:ge.getInstance().warn(""),t=new Rv}return!!t.avaliable()&&(this.tickerHandler&&this.tickerHandler.release(),this.tickerHandler=t,!0)}setInterval(t){this.interval=t}getInterval(){return this.interval}setFPS(t){this.setInterval(1e3/t)}getFPS(){return 1e3/this.interval}tick(t){this.tickerHandler.tick(t,e=>{this.handleTick(e,{once:!0})})}tickTo(t){this.tickerHandler.tickTo&&this.tickerHandler.tickTo(t,e=>{this.handleTick(e,{once:!0})})}pause(){return this.status!==ws.INITIAL&&(this.status=ws.PAUSE,!0)}resume(){return this.status!==ws.INITIAL&&(this.status=ws.RUNNING,!0)}ifCanStop(){return!!(this.autoStop&&(!this.timelines.length||this.timelines.reduce((t,e)=>t+e.animateCount,0)===0))}start(t=!1){return this.status===ws.RUNNING||!this.tickerHandler||!t&&(this.status===ws.PAUSE||!this.timelines.length||this.timelines.reduce((e,i)=>e+i.animateCount,0)===0)?!1:(this.status=ws.RUNNING,this.tickerHandler.tick(0,this.handleTick),!0)}stop(){this.status=ws.INITIAL,this.setupTickHandler(),this.lastFrameTime=-1}release(){this.stop(),this.timelines=[],this.tickerHandler.release(),this.emit("afterTick")}trySyncTickStatus(){this.status===ws.RUNNING&&this._handlerTick()}}class fe{constructor(){}static linear(t){return t}static none(){return this.linear}static get(t){return t<-1?t=-1:t>1&&(t=1),function(e){return t===0?e:t<0?e*(e*-t+1+t):e*((2-e)*t+(1-t))}}static getPowIn(t){return function(e){return Math.pow(e,t)}}static getPowOut(t){return function(e){return 1-Math.pow(1-e,t)}}static getPowInOut(t){return function(e){return(e*=2)<1?.5*Math.pow(e,t):1-.5*Math.abs(Math.pow(2-e,t))}}static getBackIn(t){return function(e){return e*e*((t+1)*e-t)}}static getBackOut(t){return function(e){return--e*e*((t+1)*e+t)+1}}static getBackInOut(t){return t*=1.525,function(e){return(e*=2)<1?e*e*((t+1)*e-t)*.5:.5*((e-=2)*e*((t+1)*e+t)+2)}}static sineIn(t){return 1-Math.cos(t*Math.PI/2)}static sineOut(t){return Math.sin(t*Math.PI/2)}static sineInOut(t){return-(Math.cos(Math.PI*t)-1)/2}static expoIn(t){return t===0?0:Math.pow(2,10*t-10)}static expoOut(t){return t===1?1:1-Math.pow(2,-10*t)}static expoInOut(t){return t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2}static circIn(t){return-(Math.sqrt(1-t*t)-1)}static circOut(t){return Math.sqrt(1- --t*t)}static circInOut(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}static bounceOut(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}static bounceIn(t){return 1-fe.bounceOut(1-t)}static bounceInOut(t){return t<.5?.5*fe.bounceIn(2*t):.5*fe.bounceOut(2*t-1)+.5}static getElasticIn(t,e){return function(i){if(i===0||i===1)return i;const r=e/Ft*Math.asin(1/t);return-t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Ft/e)}}static getElasticOut(t,e){return function(i){if(i===0||i===1)return i;const r=e/Ft*Math.asin(1/t);return t*Math.pow(2,-10*i)*Math.sin((i-r)*Ft/e)+1}}static getElasticInOut(t,e){return function(i){const r=e/Ft*Math.asin(1/t);return(i*=2)<1?t*Math.pow(2,10*(i-=1))*Math.sin((i-r)*Ft/e)*-.5:t*Math.pow(2,-10*(i-=1))*Math.sin((i-r)*Ft/e)*.5+1}}static registerFunc(t,e){fe[t]=e}}function JRt(n,t){const e=1/t;let i=1;for(;n>e;)n-=e,i*=-1;const r=i*n/e;return r>0?r:1+r}fe.quadIn=fe.getPowIn(2),fe.quadOut=fe.getPowOut(2),fe.quadInOut=fe.getPowInOut(2),fe.cubicIn=fe.getPowIn(3),fe.cubicOut=fe.getPowOut(3),fe.cubicInOut=fe.getPowInOut(3),fe.quartIn=fe.getPowIn(4),fe.quartOut=fe.getPowOut(4),fe.quartInOut=fe.getPowInOut(4),fe.quintIn=fe.getPowIn(5),fe.quintOut=fe.getPowOut(5),fe.quintInOut=fe.getPowInOut(5),fe.backIn=fe.getBackIn(1.7),fe.backOut=fe.getBackOut(1.7),fe.backInOut=fe.getBackInOut(1.7),fe.elasticIn=fe.getElasticIn(1,.3),fe.elasticOut=fe.getElasticOut(1,.3),fe.elasticInOut=fe.getElasticInOut(1,.3*1.5),fe.easeInOutQuad=n=>(n/=.5)<1?.5*Math.pow(n,2):-.5*((n-=2)*n-2),fe.easeOutElastic=n=>{const t=2*Math.PI/3;return n===0?0:n===1?1:Math.pow(2,-10*n)*Math.sin((10*n-.75)*t)+1},fe.easeInOutElastic=n=>{const t=2*Math.PI/4.5;return n===0?0:n===1?1:n<.5?-Math.pow(2,20*n-10)*Math.sin((20*n-11.125)*t)/2:Math.pow(2,-20*n+10)*Math.sin((20*n-11.125)*t)/2+1};for(let n=0;n<10;n++)fe[`flicker${n}`]=t=>JRt(t,n);for(let n=2;n<10;n++)fe[`aIn${n}`]=t=>n*t*t+(1-n)*t;class cQ{constructor(){this.id=nn.GenAutoIncrementId(),this.animateHead=null,this.animateTail=null,this.animateCount=0,this.paused=!1}addAnimate(t){this.animateTail?(this.animateTail.nextAnimate=t,t.prevAnimate=this.animateTail,this.animateTail=t,t.nextAnimate=null):(this.animateHead=t,this.animateTail=t),this.animateCount++}pause(){this.paused=!0}resume(){this.paused=!1}tick(t){if(this.paused)return;let e=this.animateHead;for(this.animateCount=0;e;)e.status===pr.END?this.removeAnimate(e):e.status===pr.RUNNING||e.status===pr.INITIAL?(this.animateCount++,e.advance(t)):e.status===pr.PAUSED&&this.animateCount++,e=e.nextAnimate}clear(){let t=this.animateHead;for(;t;)t.release(),t=t.nextAnimate;this.animateHead=null,this.animateTail=null,this.animateCount=0}removeAnimate(t,e=!0){t._onRemove&&t._onRemove.forEach(i=>i()),t===this.animateHead?(this.animateHead=t.nextAnimate,t===this.animateTail?this.animateTail=null:this.animateHead.prevAnimate=null):t===this.animateTail?(this.animateTail=t.prevAnimate,this.animateTail.nextAnimate=null):(t.prevAnimate.nextAnimate=t.nextAnimate,t.nextAnimate.prevAnimate=t.prevAnimate),e&&t.release()}}const A1=new cQ;class fs{constructor(t,e,i,r,s){this.from=t,this.to=e,this.duration=i,this.easing=r,this.params=s,this.updateCount=0}bind(t,e){this.target=t,this.subAnimate=e,this.onBind()}onBind(){}onFirstRun(){}onStart(){}onEnd(){}getEndProps(){return this.to}getFromProps(){return this.from}getMergedEndProps(){var t;const e=this.getEndProps();return e?this._endProps===e?this._mergedEndProps:(this._endProps=e,void(this._mergedEndProps=Object.assign({},(t=this.step.prev.getLastProps())!==null&&t!==void 0?t:{},e))):this.step.prev?this.step.prev.getLastProps():e}update(t,e,i){if(this.updateCount===0){this.onFirstRun();const r=this.step.getLastProps();Object.keys(r).forEach(s=>{this.subAnimate.animate.validAttr(s)&&(i[s]=r[s])})}this.updateCount+=1,this.onUpdate(t,e,i),t&&this.onEnd()}}class QRt extends fs{constructor(t){super(null,null,0,"linear"),this.cb=t}onUpdate(t,e,i){}onStart(){this.cb()}}let M1=class qm{constructor(t=nn.GenAutoIncrementId(),e=A1,i){this.id=t,this.timeline=e||A1,this.status=pr.INITIAL,this.tailAnimate=new jV(this),this.subAnimates=[this.tailAnimate],this.timeScale=1,this.rawPosition=-1,this._startTime=0,this._duringTime=0,this.timeline.addAnimate(this),this.slience=i}setTimeline(t){t!==this.timeline&&(this.timeline.removeAnimate(this,!1),t.addAnimate(this))}getStartTime(){return this._startTime}getDuration(){return this.subAnimates.reduce((t,e)=>t+e.totalDuration,0)}after(t){const e=t.getDuration();return this._startTime=e,this}afterAll(t){let e=-1/0;return t.forEach(i=>{e=ti(i.getDuration(),e)}),this._startTime=e,this}parallel(t){return this._startTime=t.getStartTime(),this}static AddInterpolate(t,e){qm.interpolateMap.set(t,e)}play(t){if(this.tailAnimate.play(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this.subAnimates.length===1&&this.tailAnimate.totalDuration===t.duration&&this.trySetAttribute(t.getFromProps(),t.mode),this}trySetAttribute(t,e=qm.mode){t&&e&hf.SET_ATTR_IMMEDIATELY&&this.target.setAttributes&&this.target.setAttributes(t,!1,{type:qi.ANIMATE_PLAY})}runCb(t){const e=new QRt(()=>{t(this,e.step.prev)});return this.tailAnimate.play(e),this}customInterpolate(t,e,i,r,s,o){const a=qm.interpolateMap.get(t)||qm.interpolateMap.get("");return!!a&&a(t,e,i,r,s,o)}pause(){this.status===pr.RUNNING&&(this.status=pr.PAUSED)}resume(){this.status===pr.PAUSED&&(this.status=pr.RUNNING)}to(t,e,i,r){if(this.tailAnimate.to(t,e,i,r),this.target){const s=this.target.stage;s&&s.renderNextFrame()}return this}from(t,e,i,r){if(this.tailAnimate.from(t,e,i,r),this.target){const s=this.target.stage;s&&s.renderNextFrame()}return this}wait(t){if(this.tailAnimate.wait(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}startAt(t){if(this.tailAnimate.startAt(t),this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}loop(t){if(this.tailAnimate.loop=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}reversed(t){if(this.tailAnimate.reversed=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}bounce(t){if(this.tailAnimate.bounce=t,this.target){const e=this.target.stage;e&&e.renderNextFrame()}return this}subAnimate(){const t=new jV(this,this.tailAnimate);return this.tailAnimate=t,this.subAnimates.push(t),t.bind(this.target),this}getStartProps(){return this.subAnimates[0].getStartProps()}getEndProps(){return this.tailAnimate.getEndProps()}depreventAttr(t){this._preventAttrs&&this._preventAttrs.delete(t)}preventAttr(t){this._preventAttrs||(this._preventAttrs=new Set),this._preventAttrs.add(t)}preventAttrs(t){t.forEach(e=>this.preventAttr(e))}validAttr(t){return!this._preventAttrs||!this._preventAttrs.has(t)}bind(t){return this.target=t,this.target.onAnimateBind&&!this.slience&&this.target.onAnimateBind(this),this.subAnimates.forEach(e=>{e.bind(t)}),this}advance(t){if(this._duringTime<this._startTime){if(this._duringTime+t*this.timeScale<this._startTime)return void(this._duringTime+=t*this.timeScale);t=this._duringTime+t*this.timeScale-this._startTime,this._duringTime=this._startTime}this.status===pr.INITIAL&&(this.status=pr.RUNNING,this._onStart&&this._onStart.forEach(e=>e())),this.setPosition(Math.max(this.rawPosition,0)+t*this.timeScale)&&this.status===pr.RUNNING&&(this.status=pr.END,this._onEnd&&this._onEnd.forEach(e=>e()))}setPosition(t){let e,i=0;const r=this.rawPosition,s=this.subAnimates.reduce((a,l)=>a+l.totalDuration,0);t<0&&(t=0);const o=t>=s;if(o&&(t=s),t===r)return o;for(let a=0;a<this.subAnimates.length&&(e=this.subAnimates[a],!(i+e.totalDuration>=t));a++)i+=e.totalDuration,e=void 0;return this.rawPosition=t,e.setPosition(t-i),o}onStart(t){this._onStart||(this._onStart=[]),this._onStart.push(t)}onEnd(t){this._onEnd||(this._onEnd=[]),this._onEnd.push(t)}onRemove(t){this._onRemove||(this._onRemove=[]),this._onRemove.push(t)}onFrame(t){this._onFrame||(this._onFrame=[]),this._onFrame.push(t)}release(){this.status=pr.END}stop(t){t||this.target.onStop(),t==="start"?this.target.onStop(this.getStartProps()):t==="end"?this.target.onStop(this.getEndProps()):this.target.onStop(t),this.release()}};M1.mode=hf.NORMAL,M1.interpolateMap=new Map;class jV{get totalDuration(){return this.calcAttr(),this._totalDuration+this._startAt}constructor(t,e){this.rawPosition=-1,this.position=0,this.loop=0,this.duration=0,this.animate=t,this.stepHead=new NV(0,0,e?Object.assign({},e.stepTail.props):{}),this.stepTail=this.stepHead,this.dirty=!0,this._startAt=0}calcAttr(){this.dirty&&(this._totalDuration=this.duration*(this.loop+1))}bind(t){return this.target=t,this}play(t){let e=t.duration;(e==null||e<0)&&(e=0);const i=t.easing,r=typeof i=="string"?fe[i]:i,s=this._addStep(e,null,r);return s.type=Vg.customAnimate,this._appendProps(t.getEndProps(),s,!1),this._appendCustomAnimate(t,s),this}to(t,e,i,r){(e==null||e<0)&&(e=0);const s=typeof i=="string"?fe[i]:i,o=this._addStep(e,null,s);return o.type=Vg.to,this._appendProps(t,o,!!r&&r.tempProps),o.propKeys||(o.propKeys=Object.keys(o.props)),r&&r.noPreventAttrs||this.target.animates&&this.target.animates.forEach(a=>{a.id!==this.animate.id&&a.preventAttrs(o.propKeys)}),this}from(t,e,i,r){this.to(t,0,i,r);const s={};this.stepTail.propKeys||(this.stepTail.propKeys=Object.keys(this.stepTail.props)),this.stepTail.propKeys.forEach(o=>{s[o]=this.getLastPropByName(o,this.stepTail)}),this.to(s,e,i,r),this.stepTail.type=Vg.from}startAt(t){return t<0&&(t=0),this._startAt=t,this}getStartProps(){var t;return(t=this.stepHead)===null||t===void 0?void 0:t.props}getEndProps(){return this.stepTail.props}getLastStep(){return this._lastStep}wait(t){if(t>0){const e=this._addStep(+t,null);e.type=Vg.wait,e.prev.customAnimate?e.props=e.prev.customAnimate.getEndProps():e.props=e.prev.props,this.target.onAddStep&&this.target.onAddStep(e)}return this}_addStep(t,e,i){const r=new NV(this.duration,t,e,i);return this.duration+=t,this.stepTail.append(r),this.stepTail=r,r}_appendProps(t,e,i){e.props=i?t:Object.assign({},t);let r=e.prev;const s=e.props;for(e.propKeys||(e.propKeys=Object.keys(e.props)),e.propKeys.forEach(a=>{e.props[a]===void 0&&(e.props[a]=this.target.getDefaultAttribute(a))});r.prev;)r.props&&(r.propKeys||(r.propKeys=Object.keys(r.props)),r.propKeys.forEach(a=>{s[a]===void 0&&(s[a]=r.props[a])})),e.propKeys=Object.keys(e.props),r=r.prev;const o=this.stepHead.props;e.propKeys||(e.propKeys=Object.keys(s)),e.propKeys.forEach(a=>{if(o[a]===void 0){const l=this.animate.getStartProps();o[a]=l[a]=this.target.getComputedAttribute(a)}}),this.target.onAddStep&&this.target.onAddStep(e)}_appendCustomAnimate(t,e){e.customAnimate=t,t.step=e,t.bind(this.target,this)}setPosition(t){var e;const i=this.duration,r=this.loop,s=this.rawPosition;let o,a,l=!1;const h=(e=this._startAt)!==null&&e!==void 0?e:0;if(t<0&&(t=0),t<h)return this.rawPosition=t,!1;if(t-=h,i<=0&&(l=!0,i<0)||(o=Math.floor(t/i),a=t-o*i,l=t>=r*i+i,l&&(a=i,o=r,t=a*o+i),t===s))return l;const d=!this.reversed!=!(this.bounce&&o%2);return d&&(a=i-a),this._deltaPosition=a-this.position,this.position=a,this.rawPosition=t+h,this.updatePosition(l,d),l}updatePosition(t,e){if(!this.stepHead)return;let i=this.stepHead.next;const r=this.position,s=this.duration;if(this.target&&i){let o=i.next;for(;o&&o.position<=r;)i=o,o=i.next;let a=t?s===0?1:r/s:(r-i.position)/i.duration;i.easing&&(a=i.easing(a)),this.tryCallCustomAnimateLifeCycle(i,this._lastStep||(e?this.stepTail:this.stepHead),e),this.updateTarget(i,a,t),this._lastStep=i,this.animate._onFrame&&this.animate._onFrame.forEach(l=>l(i,a))}}tryCallCustomAnimateLifeCycle(t,e,i){if(t!==e)if(i){let r=e.prev;for(;r&&r!==t;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=t.prev;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}else{let r=e.next;for(;r&&r!==t;)r.customAnimate&&(r.customAnimate.onStart&&r.customAnimate.onStart(),r.customAnimate.onEnd&&r.customAnimate.onEnd()),r=r.next;e&&e.customAnimate&&e.customAnimate.onEnd&&e.customAnimate.onEnd(),t&&t.customAnimate&&t.customAnimate.onStart&&t.customAnimate.onStart()}}getLastPropByName(t,e){let i=e.prev;for(;i;){if(i.props&&i.props[t]!==void 0)return i.props[t];if(i.customAnimate){const r=i.customAnimate.getEndProps()[t];if(r!==void 0)return r}i=i.prev}return ge.getInstance().warn("step"),e.props[t]}updateTarget(t,e,i){t.props==null&&t.customAnimate==null||this.target.onStep(this,this.animate,t,e,i)}}class NV{constructor(t,e,i,r){this.duration=e,this.position=t,this.props=i,this.easing=r}append(t){t.prev=this,t.next=this.next,this.next=t}getLastProps(){let t=this.prev;for(;t;){if(t.props)return t.props;if(t.customAnimate)return t.customAnimate.getMergedEndProps();t=t.prev}return null}}const $V={duration:200,easing:"cubicOut"};var VV;(function(n){n[n.Top=1]="Top",n[n.Right=2]="Right",n[n.Bottom=4]="Bottom",n[n.Left=8]="Left",n[n.ALL=15]="ALL"})(VV||(VV={}));const yl=[!1,!1,!1,!1],tBt=n=>{var t;let e=!0;if(Re(n,!0)){for(let i=0;i<4;i++)yl[i]=n,e&&(e=!((t=yl[i])!==null&&t!==void 0&&!t));e=n}else if(Array.isArray(n))for(let i=0;i<4;i++)yl[i]=!!n[i],e&&(e=!!yl[i]);else yl[0]=!1,yl[1]=!1,yl[2]=!1,yl[3]=!1;return{isFullStroke:e,stroke:yl}},vm=[0,0,0,0],GL=n=>n?V(n)?n.length===0?0:n.length===1?n[0]:n.length===2?(vm[0]=n[0],vm[2]=n[0],vm[1]=n[1],vm[3]=n[1],vm):n:n:0,pg=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],Wy=[1,2,3,0,1,2,3,0];function UL(n,t,e,i){for(;n>=Ft;)n-=Ft;for(;n<0;)n+=Ft;for(;n>t;)t+=Ft;pg[0].x=e,pg[1].y=e,pg[2].x=-e,pg[3].y=-e;const r=Math.ceil(n/An)%4,s=Math.ceil(t/An)%4;if(i.add(me(n)*e,ee(n)*e),i.add(me(t)*e,ee(t)*e),r!==s||t-n>Kt){let o=!1;for(let a=0;a<Wy.length;a++)if(o||r!==Wy[a]){if(o&&s===Wy[a])break;if(o){const l=pg[Wy[a]];i.add(l.x,l.y)}}else{o=!0;const l=pg[r];i.add(l.x,l.y)}}}function YL(n,t,e){const{x:i,y:r}=JC(n.x,n.y,t.x,t.y,e),{x:s,y:o}=JC(n.x1,n.y1,t.x1,t.y1,e),a=new Yt(i,r,s,o);return a.defined=t.defined,a}function WD(n,t,e){if(!n||!t)return[];Array.isArray(n)||(n=[n]),Array.isArray(t)||(t=[t]);let i=[];if(n.length>t.length){i=t.map(r=>{const s=new Yt(r.x,r.y,r.x1,r.y1);return s.defined=r.defined,s});for(let r=0;r<t.length;r++)i[r]=YL(n[r],t[r],e)}else{i=t.map(r=>{const s=new Yt(r.x,r.y,r.x1,r.y1);return s.defined=r.defined,s});for(let r=0;r<n.length;r++)i[r]=YL(n[r],t[r],e)}return i}function jy(n,t){if(V(n)){let e;for(let i=0;i<n.length&&e===void 0;i++)e=n[i][t];return e}return n[t]}class HM{constructor(t=HM.TimeOut){this.durations=[],this.timeout=t,this.lastDate=0,this.durationsListThreshold=30}call(t){return this.lastDate=Date.now(),setTimeout(()=>{this.appendDuration(Date.now()-this.lastDate),t(0)},this.timeout,!0)}clear(t){clearTimeout(t)}appendDuration(t){this.durations.push(t),this.durations.length>this.durationsListThreshold&&this.durations.shift(),this.timeout=Math.min(Math.max(this.durations.reduce((e,i)=>e+i,0)/this.durations.length,1e3/60),1e3/30)}}HM.TimeOut=1e3/60;const GV=new HM,eBt=(n,t)=>yt(n)&&n[n.length-1]==="%"?t*(Number.parseFloat(n.substring(0,n.length-1))/100):n,zM=(n,t)=>{const e=eBt(n,t);return isNaN(e)?e:Math.max(t,e)};class iBt extends fs{constructor(t,e,i,r,s){super(t,e,i,r,s)}getEndProps(){return this.valid===!1?{}:{text:this.to}}onBind(){var t,e,i,r,s,o,a,l;this.fromNumber=J((t=this.from)===null||t===void 0?void 0:t.text)?(e=this.from)===null||e===void 0?void 0:e.text:Number.parseFloat((i=this.from)===null||i===void 0?void 0:i.text),this.toNumber=J((r=this.to)===null||r===void 0?void 0:r.text)?(s=this.to)===null||s===void 0?void 0:s.text:Number.parseFloat((o=this.to)===null||o===void 0?void 0:o.text),Number.isFinite(this.toNumber)||(this.fromNumber=0),Number.isFinite(this.toNumber)||(this.valid=!1),this.valid!==!1&&(this.decimalLength=(l=(a=this.params)===null||a===void 0?void 0:a.fixed)!==null&&l!==void 0?l:Math.max(Td(this.fromNumber),Td(this.toNumber)))}onEnd(){}onUpdate(t,e,i){var r;this.valid!==!1&&(i.text=t?(r=this.to)===null||r===void 0?void 0:r.text:(this.fromNumber+(this.toNumber-this.fromNumber)*e).toFixed(this.decimalLength))}}var UV;(function(n){n[n.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",n[n.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT",n[n.TOP_TO_BOTTOM=2]="TOP_TO_BOTTOM",n[n.BOTTOM_TO_TOP=3]="BOTTOM_TO_TOP",n[n.STROKE=4]="STROKE"})(UV||(UV={}));class YV extends fs{constructor(){super(...arguments),this.fromText="",this.toText=""}getEndProps(){return this.valid===!1?{}:{text:this.to}}onBind(){var t,e,i;this.fromText=(e=(t=this.from)===null||t===void 0?void 0:t.text)!==null&&e!==void 0?e:"",this.toText=((i=this.to)===null||i===void 0?void 0:i.text)||"",(!this.toText||V(this.toText)&&this.toText.length===0)&&(this.valid=!1),V(this.toText)&&(this.toText=this.toText.map(r=>(r||"").toString()))}onEnd(){this.target.detachShadow()}onUpdate(t,e,i){if(this.valid===!1)return;const r=this.fromText.length,s=V(this.toText),o=s?this.toText.reduce((l,h)=>l+(h||"").length,0):this.toText.length,a=Math.ceil(r+(o-r)*e);if(s){i.text=[];let l=0;this.toText.forEach(h=>{l+h.length>a?(i.text.push(h.substr(0,a-l)),l=a):(i.text.push(h),l+=h.length)})}else i.text=this.toText.substr(0,a)}}class gQ extends fs{constructor(t,e,i,r,s){var o,a;super(t,e,i,r,s),this.newPointAnimateType=(o=s==null?void 0:s.newPointAnimateType)!==null&&o!==void 0?o:"grow",this.clipRangeByDimension=(a=s==null?void 0:s.clipRangeByDimension)!==null&&a!==void 0?a:"x"}getPoints(t,e=!1){if(t.points)return t.points;if(t.segments){const i=[];return this.segmentsCache||(this.segmentsCache=[]),t.segments.map(r=>{var s,o;r.points&&i.push(...r.points),e&&this.segmentsCache.push((o=(s=r.points)===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:0)}),i}return[]}onBind(){const t=this.getPoints(this.from),e=this.getPoints(this.to,!0);this.fromPoints=t?Array.isArray(t)?t:[t]:[],this.toPoints=e?Array.isArray(e)?e:[e]:[];const i=new Map;this.fromPoints.forEach(h=>{h.context&&i.set(h.context,h)});let r,s,o=1/0,a=-1/0;for(let h=0;h<this.toPoints.length;h+=1)if(i.has(this.toPoints[h].context)){o=h,r=i.get(this.toPoints[h].context);break}for(let h=this.toPoints.length-1;h>=0;h-=1)if(i.has(this.toPoints[h].context)){a=h,s=i.get(this.toPoints[h].context);break}this.newPointAnimateType==="clip"&&this.toPoints.length!==0&&(Number.isFinite(a)?(this.clipRange=this.toPoints[a][this.clipRangeByDimension]/this.toPoints[this.toPoints.length-1][this.clipRangeByDimension],this.clipRange===1&&(this.shrinkClipRange=this.toPoints[a][this.clipRangeByDimension]/this.fromPoints[this.fromPoints.length-1][this.clipRangeByDimension]),et(this.clipRange)?this.clipRange=Ne(this.clipRange,0,1):this.clipRange=0):this.clipRange=0);let l=this.toPoints[0];this.interpolatePoints=this.toPoints.map((h,d)=>{const u=i.get(h.context);return u?(l=u,[u,h]):this.newPointAnimateType==="appear"||this.newPointAnimateType==="clip"?[h,h]:d<o&&r?[r,h]:d>a&&s?[s,h]:[l,h]}),this.points=this.interpolatePoints.map(h=>{const d=h[0],u=h[1],c=new Yt(d.x,d.y,d.x1,d.y1);return c.defined=u.defined,c.context=u.context,c})}onFirstRun(){const t=this.target.attribute.clipRange;et(t*this.clipRange)&&(this.clipRange*=t)}onUpdate(t,e,i){if(this.points=this.points.map((r,s)=>{const o=YL(this.interpolatePoints[s][0],this.interpolatePoints[s][1],e);return o.context=r.context,o}),this.clipRange){if(this.shrinkClipRange)return void(t?(i.points=this.toPoints,i.clipRange=1):(i.points=this.fromPoints,i.clipRange=this.clipRange-(this.clipRange-this.shrinkClipRange)*e));i.clipRange=this.clipRange+(1-this.clipRange)*e}if(this.segmentsCache&&this.to.segments){let r=0;i.segments=this.to.segments.map((s,o)=>{const a=r+this.segmentsCache[o],l=this.points.slice(r,a);return r=a,Object.assign(Object.assign({},s),{points:l})})}else i.points=this.points}}class pQ extends fs{constructor(t,e,i,r,s){super(null,null,i,r,s),this.clipFromAttribute=t,this.clipToAttribute=e,this._group=s==null?void 0:s.group,this._clipGraphic=s==null?void 0:s.clipGraphic}onBind(){this._group&&this._clipGraphic&&(this._lastClip=this._group.attribute.clip,this._lastPath=this._group.attribute.path,this._group.setAttributes({clip:!0,path:[this._clipGraphic]},!1,{type:qi.ANIMATE_BIND}))}onEnd(){this._group&&this._group.setAttributes({clip:this._lastClip,path:this._lastPath},!1,{type:qi.ANIMATE_END})}onUpdate(t,e,i){if(!this._clipGraphic)return;const r={};Object.keys(this.clipFromAttribute).forEach(s=>{r[s]=this.clipFromAttribute[s]+(this.clipToAttribute[s]-this.clipFromAttribute[s])*e}),this._clipGraphic.setAttributes(r,!1,{type:qi.ANIMATE_UPDATE,animationState:{ratio:e,end:t}})}}class nBt extends pQ{constructor(t,e,i,r,s){var o,a,l,h,d,u,c,g,p,f,m,v;const _=(a=(o=s==null?void 0:s.group)===null||o===void 0?void 0:o.attribute)!==null&&a!==void 0?a:{},b=(l=_.width)!==null&&l!==void 0?l:0,y=(h=_.height)!==null&&h!==void 0?h:0,C=(d=s==null?void 0:s.animationType)!==null&&d!==void 0?d:"in",S=(u=s==null?void 0:s.startAngle)!==null&&u!==void 0?u:0,w=(c=s==null?void 0:s.orient)!==null&&c!==void 0?c:"clockwise";let x=0,A=0;w==="anticlockwise"?(A=C==="in"?S+2*Math.PI:S,A=S+2*Math.PI):(x=S,A=C==="out"?S+2*Math.PI:S);const M=bt.graphicService.creator.arc({x:(p=(g=s==null?void 0:s.center)===null||g===void 0?void 0:g.x)!==null&&p!==void 0?p:b/2,y:(m=(f=s==null?void 0:s.center)===null||f===void 0?void 0:f.y)!==null&&m!==void 0?m:y/2,outerRadius:(v=s==null?void 0:s.radius)!==null&&v!==void 0?v:(b+y)/2,innerRadius:0,startAngle:x,endAngle:A,fill:!0});let T,R;w==="anticlockwise"?(T={startAngle:S+2*Math.PI},R={startAngle:S}):(T={endAngle:S},R={endAngle:S+2*Math.PI}),super(C==="in"?T:R,C==="in"?R:T,i,r,{group:s==null?void 0:s.group,clipGraphic:M})}}class XV extends pQ{constructor(t,e,i,r,s){var o,a,l,h,d,u,c,g,p;const f=(a=(o=s==null?void 0:s.group)===null||o===void 0?void 0:o.attribute)!==null&&a!==void 0?a:{},m=(h=(l=s==null?void 0:s.width)!==null&&l!==void 0?l:f.width)!==null&&h!==void 0?h:0,v=(u=(d=s==null?void 0:s.height)!==null&&d!==void 0?d:f.height)!==null&&u!==void 0?u:0,_=(c=s==null?void 0:s.animationType)!==null&&c!==void 0?c:"in",b=(g=s==null?void 0:s.direction)!==null&&g!==void 0?g:"x",y=(p=s==null?void 0:s.orient)!==null&&p!==void 0?p:"positive",C=bt.graphicService.creator.rect({x:0,y:0,width:_==="in"&&b==="x"?0:m,height:_==="in"&&b==="y"?0:v,fill:!0});let S={},w={};b==="y"?y==="negative"?(S={y:v,height:0},w={y:0,height:v}):(S={height:0},w={height:v}):y==="negative"?(S={x:m,width:0},w={x:0,width:m}):(S={width:0},w={width:m}),super(_==="in"?S:w,_==="in"?w:S,i,r,{group:s==null?void 0:s.group,clipGraphic:C})}}class rBt extends fs{onStart(){const{center:t,r:e}=typeof this.params=="function"?this.params():this.params,i=this.target.getComputedAttribute("x"),r=this.target.getComputedAttribute("y"),s=this.target.getComputedAttribute("z"),o=Math.acos((r-t.y)/e);let a=Math.acos((i-t.x)/e/Math.sin(o));s-t.z<0&&(a=Ft-a),this.theta=a,this.phi=o}onBind(){}onEnd(){}onUpdate(t,e,i){if(this.phi==null||this.theta==null)return;const{center:r,r:s,cb:o}=typeof this.params=="function"?this.params():this.params,a=2*Math.PI*e,l=this.theta+a,h=this.phi,d=s*Math.sin(h)*Math.cos(l)+r.x,u=s*Math.cos(h)+r.y,c=s*Math.sin(h)*Math.sin(l)+r.z;for(i.x=d,i.y=u,i.z=c,i.alpha=l+Kt/2;i.alpha>Ft;)i.alpha-=Ft;i.alpha=Ft-i.alpha,i.zIndex=-1e4*i.z,o&&o(i)}}class sBt extends fs{constructor(t,e){super(null,null,t,"linear"),this.customAnimates=e}initAnimates(){this.customAnimates.forEach(t=>{t.step=this.step,t.subAnimate=this.subAnimate,t.target=this.target})}getEndProps(){const t={};return this.customAnimates.forEach(e=>{Object.assign(t,e.getEndProps())}),t}onBind(){this.initAnimates(),this.customAnimates.forEach(t=>{t.onBind()})}onEnd(){this.customAnimates.forEach(t=>{t.onEnd()})}onStart(){this.customAnimates.forEach(t=>{t.onStart()})}onUpdate(t,e,i){this.updating||(this.updating=!0,this.customAnimates.forEach(r=>{const s=r.easing;e=(typeof s=="string"?fe[s]:s)(e),r.onUpdate(t,e,i)}),this.updating=!1)}}const oBt=n=>{if(!n)return{x:0,y:0,width:0,height:0};let t=D(n.width)?n.x1-n.x:n.width,e=D(n.height)?n.y1-n.y:n.height,i=0,r=0;return t<0?(i=t,t=-t):Number.isNaN(t)&&(t=0),e<0?(r=e,e=-e):Number.isNaN(e)&&(e=0),{x:i,y:r,width:t,height:e}};var zs;(function(n){n[n.Color255=0]="Color255",n[n.Color1=1]="Color1"})(zs||(zs={}));class Ki{static Get(t,e=zs.Color1,i=[0,0,0,1]){if(e===zs.Color1){const o=Ki.store1[t];if(o)return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i;const a=Tn.parseColorString(t);if(a){const l=[a.r/255,a.g/255,a.b/255,a.opacity];Ki.store1[t]=l,Ki.store255[t]=[a.r,a.g,a.b,a.opacity],i[0]=l[0],i[1]=l[1],i[2]=l[2],i[3]=l[3]}return i}const r=Ki.store255[t];if(r)return i[0]=r[0],i[1]=r[1],i[2]=r[2],i[3]=r[3],i;const s=Tn.parseColorString(t);return s&&(Ki.store1[t]=[s.r/255,s.g/255,s.b/255,s.opacity],Ki.store255[t]=[s.r,s.g,s.b,s.opacity],i[0]=s.r,i[1]=s.g,i[2]=s.b,i[3]=s.opacity),i}static Set(t,e,i){if(e===zs.Color1){if(Ki.store1[t])return;Ki.store1[t]=i,Ki.store255[t]=[Math.floor(255*i[0]),Math.floor(255*i[1]),Math.floor(255*i[2]),Math.floor(255*i[3])]}else{if(Ki.store255[t])return;Ki.store255[t]=i,Ki.store1[t]=[i[0]/255,i[1]/255,i[2]/255,i[3]]}}}Ki.store255={},Ki.store1={};function Ny(n,t=!1){return Array.isArray(n)&&J(n[0])?t?`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])},${n[3].toFixed(2)})`:`rgb(${Math.round(n[0])},${Math.round(n[1])},${Math.round(n[2])})`:n}function Ep(n,t,e,i,r){return Array.isArray(n)&&!J(n[0])||Array.isArray(t)&&!J(t[0])?new Array(4).fill(0).map((s,o)=>KV(V(n)?n[o]:n,V(t)?t[o]:t,e,i)):KV(n,t,e,i,r)}function KV(n,t,e,i,r){if(!n||!t)return n&&Ny(n)||t&&Ny(t)||!1;let s,o,a=!1,l=!1;if(Array.isArray(n)?s=n:typeof n=="string"?s=Ki.Get(n,zs.Color255):a=!0,Array.isArray(t)?o=t:typeof t=="string"?o=Ki.Get(t,zs.Color255):l=!0,a!==l){const h=a?n:t,d=a?t:n,u=Object.assign(Object.assign({},h),{stops:h.stops.map(c=>Object.assign(Object.assign({},c),{color:Ny(d)}))});return a?Ep(h,u,e,i,r):Ep(u,h,e,i,r)}if(a){if(n.gradient===t.gradient){const h=n,d=t,u=h.stops,c=d.stops;if(u.length!==c.length)return!1;if(h.gradient==="linear")return aBt(h,d,e);if(h.gradient==="radial")return lBt(h,d,e);if(h.gradient==="conical")return hBt(h,d,e)}return!1}return r&&r(s,o),Ny(dBt(s,o,e),i)}function aBt(n,t,e){const i=n.stops,r=t.stops;return{gradient:"linear",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,stops:new Array(i.length).fill(0).map((s,o)=>({color:jD(i[o].color,r[o].color,e),offset:i[o].offset+(r[o].offset-i[o].offset)*e}))}}function lBt(n,t,e){const i=n.stops,r=t.stops;return{gradient:"radial",x0:n.x0+(t.x0-n.x0)*e,x1:n.x1+(t.x1-n.x1)*e,y0:n.y0+(t.y0-n.y0)*e,y1:n.y1+(t.y1-n.y1)*e,r0:n.r0+(t.r0-n.r0)*e,r1:n.r1+(t.r1-n.r1)*e,stops:new Array(i.length).fill(0).map((s,o)=>({color:jD(i[o].color,r[o].color,e),offset:i[o].offset+(r[o].offset-i[o].offset)*e}))}}function hBt(n,t,e){const i=n.stops,r=t.stops;return{gradient:"conical",startAngle:n.startAngle+(t.startAngle-n.startAngle)*e,endAngle:n.endAngle+(t.endAngle-n.endAngle)*e,x:n.x+(t.x-n.x)*e,y:n.y+(t.y-n.y)*e,stops:new Array(i.length).fill(0).map((s,o)=>({color:jD(i[o].color,r[o].color,e),offset:i[o].offset+(r[o].offset-i[o].offset)*e}))}}function dBt(n,t,e){return[n[0]+(t[0]-n[0])*e,n[1]+(t[1]-n[1])*e,n[2]+(t[2]-n[2])*e,n[3]+(t[3]-n[3])*e]}const Cl=[0,0,0,0],_m=[0,0,0,0];function jD(n,t,e){return Ki.Get(n,zs.Color255,Cl),Ki.Get(t,zs.Color255,_m),`rgba(${Math.round(Cl[0]+(_m[0]-Cl[0])*e)},${Math.round(Cl[1]+(_m[1]-Cl[1])*e)},${Math.round(Cl[2]+(_m[2]-Cl[2])*e)},${Cl[3]+(_m[3]-Cl[3])*e})`}class uBt extends fs{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:0}})}onEnd(){this.target.setTheme({common:{opacity:1}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:e}})}}class cBt extends fs{getEndProps(){return{}}onBind(){this.target.setTheme({common:{opacity:1}})}onEnd(){this.target.setTheme({common:{opacity:0}})}onUpdate(t,e,i){this.target.setTheme({common:{opacity:1-e}})}}class vi{static GetImage(t,e){var i;const r=vi.cache.get(t);r?r.loadState==="fail"?bt.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):vi.loadImage(t,e)}static GetSvg(t,e){var i;let r=vi.cache.get(t);r?r.loadState==="fail"?bt.global.getRequestAnimationFrame()(()=>{e.imageLoadFail(t)}):r.loadState==="init"||r.loadState==="loading"?(i=r.waitingMark)===null||i===void 0||i.push(e):e&&e.imageLoadSuccess(t,r.data):(r={type:"image",loadState:"init"},vi.cache.set(t,r),r.dataPromise=bt.global.loadSvg(t),r.dataPromise?(r.waitingMark=[e],r.dataPromise.then(s=>{var o;r.loadState=s!=null&&s.data?"success":"fail",r.data=s==null?void 0:s.data,(o=r.waitingMark)===null||o===void 0||o.map((a,l)=>{s!=null&&s.data?(r.loadState="success",r.data=s.data,a.imageLoadSuccess(t,s.data)):(r.loadState="fail",a.imageLoadFail(t))}),r.waitingMark&&(r.waitingMark=[])})):(r.loadState="fail",e.imageLoadFail(t)))}static GetFile(t,e){let i=vi.cache.get(t);return i?i.loadState==="fail"?Promise.reject():i.loadState==="init"||i.loadState==="loading"?i.dataPromise.then(r=>r.data):Promise.resolve(i.data):(i={type:e,loadState:"init"},vi.cache.set(t,i),e==="arrayBuffer"?i.dataPromise=bt.global.loadArrayBuffer(t):e==="blob"?i.dataPromise=bt.global.loadBlob(t):e==="json"&&(i.dataPromise=bt.global.loadJson(t)),i.dataPromise.then(r=>r.data))}static loading(){setTimeout(()=>{if(!vi.isLoading&&vi.toLoadAueue.length){vi.isLoading=!0;const t=vi.toLoadAueue.splice(0,10),e=[];t.forEach(i=>{const{url:r,marks:s}=i,o={type:"image",loadState:"init"};if(vi.cache.set(r,o),o.dataPromise=bt.global.loadImage(r),o.dataPromise){o.waitingMark=s;const a=o.dataPromise.then(l=>{var h;o.loadState=l!=null&&l.data?"success":"fail",o.data=l==null?void 0:l.data,(h=o.waitingMark)===null||h===void 0||h.map((d,u)=>{l!=null&&l.data?(o.loadState="success",o.data=l.data,d.imageLoadSuccess(r,l.data)):(o.loadState="fail",d.imageLoadFail(r))}),o.waitingMark&&(o.waitingMark=[])});e.push(a)}else o.loadState="fail",s.forEach(a=>a.imageLoadFail(r))}),Promise.all(e).then(()=>{vi.isLoading=!1,this.onLoadSuccessCb.forEach(i=>i()),vi.loading()}).catch(i=>{console.error(i),vi.isLoading=!1,this.onLoadSuccessCb.forEach(r=>r()),vi.loading()})}},0)}static loadImage(t,e){const i=qV(t,vi.toLoadAueue);if(i!==-1)return vi.toLoadAueue[i].marks.push(e),void vi.loading();vi.toLoadAueue.push({url:t,marks:[e]}),vi.loading()}static improveImageLoading(t){const e=qV(t,vi.toLoadAueue);if(e!==-1){const i=vi.toLoadAueue.splice(e,1);vi.toLoadAueue.unshift(i[0])}}static onLoadSuccess(t){this.onLoadSuccessCb.push(t)}}function qV(n,t){for(let e=0;e<t.length;e++)if(t[e].url===n)return e;return-1}vi.cache=new Map,vi.isLoading=!1,vi.toLoadAueue=[],vi.onLoadSuccessCb=[];class pn{bounds(t,e){if(J(t)){const i=t/2;e.x1=-i,e.x2=i,e.y1=-i,e.y2=i}else e.x1=-t[0]/2,e.x2=t[0]/2,e.y1=-t[1]/2,e.y2=t[1]/2}parseSize(t){return J(t)?t:Math.min(t[0],t[1])}}function ZV(n,t,e,i,r){return r?n.arc(e,i,t,0,Ci,!1,r):n.arc(e,i,t,0,Ci),!1}class gBt extends pn{constructor(){super(...arguments),this.type="circle",this.pathStr="M0.5,0A0.5,0.5,0,1,1,-0.5,0A0.5,0.5,0,1,1,0.5,0"}draw(t,e,i,r,s){return ZV(t,this.parseSize(e)/2,i,r,s)}drawOffset(t,e,i,r,s,o){return ZV(t,this.parseSize(e)/2+s,i,r,o)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e-s}, ${i} a ${s},${s} 0 1,0 ${2*s},0 a ${s},${s} 0 1,0 -${2*s},0`}}const pBt=new gBt;function fBt(n,t,e,i,r){return n.moveTo(-3*t+e,-t+i,r),n.lineTo(-t+e,-t+i,r),n.lineTo(-t+e,-3*t+i,r),n.lineTo(t+e,-3*t+i,r),n.lineTo(t+e,-t+i,r),n.lineTo(3*t+e,-t+i,r),n.lineTo(3*t+e,t+i,r),n.lineTo(t+e,t+i,r),n.lineTo(t+e,3*t+i,r),n.lineTo(-t+e,3*t+i,r),n.lineTo(-t+e,t+i,r),n.lineTo(-3*t+e,t+i,r),n.closePath(),!0}function mBt(n,t,e,i,r,s){return n.moveTo(-3*t+e-r,-t+i-r,s),n.lineTo(-t+e-r,-t+i-r,s),n.lineTo(-t+e-r,-3*t+i-r,s),n.lineTo(t+e+r,-3*t+i-r,s),n.lineTo(t+e+r,-t+i-r,s),n.lineTo(3*t+e+r,-t+i-r,s),n.lineTo(3*t+e+r,t+i+r,s),n.lineTo(t+e+r,t+i+r,s),n.lineTo(t+e+r,3*t+i+r,s),n.lineTo(-t+e-r,3*t+i+r,s),n.lineTo(-t+e-r,t+i+r,s),n.lineTo(-3*t+e-r,t+i+r,s),n.closePath(),!0}class vBt extends pn{constructor(){super(...arguments),this.type="cross",this.pathStr="M-0.5,-0.2L-0.5,0.2L-0.2,0.2L-0.2,0.5L0.2,0.5L0.2,0.2L0.5,0.2L0.5,-0.2L0.2,-0.2L0.2,-0.5L-0.2,-0.5L-0.2,-0.2Z"}draw(t,e,i,r,s){return fBt(t,this.parseSize(e)/6,i,r,s)}drawOffset(t,e,i,r,s,o){return mBt(t,this.parseSize(e)/6,i,r,s,o)}}const _Bt=new vBt;function kB(n,t,e,i,r){return n.moveTo(e,i-t,r),n.lineTo(t+e,i,r),n.lineTo(e,i+t,r),n.lineTo(e-t,i,r),n.closePath(),!0}class bBt extends pn{constructor(){super(...arguments),this.type="diamond",this.pathStr="M-0.5,0L0,-0.5L0.5,0L0,0.5Z"}draw(t,e,i,r,s){return kB(t,this.parseSize(e)/2,i,r,s)}drawFitDir(t,e,i,r,s){return kB(t,this.parseSize(e)/2,i,r,s)}drawOffset(t,e,i,r,s,o){return kB(t,this.parseSize(e)/2+s,i,r,o)}}const yBt=new bBt;function JV(n,t,e,i){const r=2*t;return n.rect(e-t,i-t,r,r),!1}class CBt extends pn{constructor(){super(...arguments),this.type="square",this.pathStr="M-0.5,-0.5h1v1h-1Z"}draw(t,e,i,r){return JV(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return JV(t,this.parseSize(e)/2+s,i,r)}}const SBt=new CBt;function QV(n,t,e,i,r=0){return n.moveTo(e+t+2*r,t+i+r),n.lineTo(e-t-2*r,t+i+r),n.lineTo(e,i-t-2*r),n.closePath(),!0}class fQ extends pn{constructor(){super(...arguments),this.type="triangleUp",this.pathStr="M0.5,0.5 L-0.5,0.5 L0,-0.5 Z"}draw(t,e,i,r){return QV(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return QV(t,this.parseSize(e)/2,i,r,s)}}const xBt=new fQ;class wBt extends fQ{constructor(){super(...arguments),this.type="triangle"}}const ABt=new wBt,mQ=Math.sin(Math.PI/10)/Math.sin(7*Math.PI/10),MBt=Math.sin(Ci/10)*mQ,TBt=-Math.cos(Ci/10)*mQ;function tG(n,t,e,i){const r=MBt*t,s=TBt*t;n.moveTo(e,-t+i),n.lineTo(r+e,s+i);for(let o=1;o<5;++o){const a=Ci*o/5,l=Math.cos(a),h=Math.sin(a);n.lineTo(h*t+e,-l*t+i),n.lineTo(l*r-h*s+e,h*r+l*s+i)}return n.closePath(),!0}class kBt extends pn{constructor(){super(...arguments),this.type="star",this.pathStr="M0 -1L0.22451398828979266 -0.3090169943749474L0.9510565162951535 -0.30901699437494745L0.3632712640026804 0.1180339887498948L0.5877852522924732 0.8090169943749473L8.326672684688674e-17 0.3819660112501051L-0.587785252292473 0.8090169943749476L-0.3632712640026804 0.11803398874989487L-0.9510565162951536 -0.30901699437494723L-0.22451398828979274 -0.30901699437494734Z"}draw(t,e,i,r){return tG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return tG(t,this.parseSize(e)/2+s,i,r)}}const RBt=new kBt,BBt=Rn(3);function eG(n,t,e,i){const r=t,s=r/BBt,o=s/5,a=t;return n.moveTo(0+e,-r+i),n.lineTo(s/2+e,i),n.lineTo(o/2+e,i),n.lineTo(o/2+e,a+i),n.lineTo(-o/2+e,a+i),n.lineTo(-o/2+e,i),n.lineTo(-s/2+e,i),n.closePath(),!0}class PBt extends pn{constructor(){super(...arguments),this.type="arrow",this.pathStr="M-0.07142857142857142,0.5L0.07142857142857142,0.5L0.07142857142857142,-0.0625L0.2,-0.0625L0,-0.5L-0.2,-0.0625L-0.07142857142857142,-0.0625Z"}draw(t,e,i,r){return eG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return eG(t,this.parseSize(e)/2+s,i,r)}}const EBt=new PBt;function iG(n,t,e,i){const r=2*t;return n.moveTo(e,-t+i),n.lineTo(r/3/2+e,t+i),n.lineTo(-r/3/2+e,t+i),n.closePath(),!0}class LBt extends pn{constructor(){super(...arguments),this.type="wedge",this.pathStr="M0,-0.5773502691896257L-0.125,0.28867513459481287L0.125,0.28867513459481287Z"}draw(t,e,i,r){return iG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return iG(t,this.parseSize(e)/2+s,i,r)}}const IBt=new LBt;function nG(n,t,e,i){return n.moveTo(-t+e,i),n.lineTo(e,t+i),!1}class OBt extends pn{constructor(){super(...arguments),this.type="stroke",this.pathStr=""}draw(t,e,i,r){return nG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return nG(t,this.parseSize(e)/2+s,i,r)}}const DBt=new OBt,Js=-.5,Qs=Rn(3)/2,rG=1/Rn(12);function sG(n,t,e,i){const r=t/2,s=t*rG,o=r,a=t*rG+t,l=-o,h=a;return n.moveTo(r+e,s+i),n.lineTo(o+e,a+i),n.lineTo(l+e,h+i),n.lineTo(Js*r-Qs*s+e,Qs*r+Js*s+i),n.lineTo(Js*o-Qs*a+e,Qs*o+Js*a+i),n.lineTo(Js*l-Qs*h+e,Qs*l+Js*h+i),n.lineTo(Js*r+Qs*s+e,Js*s-Qs*r+i),n.lineTo(Js*o+Qs*a+e,Js*a-Qs*o+i),n.lineTo(Js*l+Qs*h+e,Js*h-Qs*l+i),n.closePath(),!1}class FBt extends pn{constructor(){super(...arguments),this.type="wye",this.pathStr="M0.25 0.14433756729740646L0.25 0.6443375672974064L-0.25 0.6443375672974064L-0.25 0.14433756729740643L-0.6830127018922193 -0.10566243270259357L-0.4330127018922193 -0.5386751345948129L0 -0.28867513459481287L0.4330127018922193 -0.5386751345948129L0.6830127018922193 -0.10566243270259357Z"}draw(t,e,i,r){return sG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return sG(t,this.parseSize(e)/2+s,i,r)}}const HBt=new FBt;function oG(n,t,e,i,r){return n.moveTo(-t+e-2*r,i),n.lineTo(t+e+r,t+i+2*r),n.lineTo(t+e+r,i-t-2*r),n.closePath(),!0}class zBt extends pn{constructor(){super(...arguments),this.type="triangleLeft",this.pathStr="M-0.5,0 L0.5,0.5 L0.5,-0.5 Z"}draw(t,e,i,r){return oG(t,this.parseSize(e)/2,i,r,0)}drawOffset(t,e,i,r,s){return oG(t,this.parseSize(e)/2,i,r,s)}}const WBt=new zBt;function aG(n,t,e,i,r=0){return n.moveTo(e-t-r,t+i+2*r),n.lineTo(t+e+2*r,i),n.lineTo(e-t-r,i-t-2*r),n.closePath(),!0}class jBt extends pn{constructor(){super(...arguments),this.type="triangleRight",this.pathStr="M-0.5,0.5 L0.5,0 L-0.5,-0.5 Z"}draw(t,e,i,r){return aG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return aG(t,this.parseSize(e)/2,i,r,s)}}const NBt=new jBt;function lG(n,t,e,i,r=0){return n.moveTo(e-t-2*r,i-t-r),n.lineTo(e+t+2*r,i-t-r),n.lineTo(e,i+t+2*r),n.closePath(),!0}class $Bt extends pn{constructor(){super(...arguments),this.type="triangleDown",this.pathStr="M-0.5,-0.5 L0.5,-0.5 L0,0.5 Z"}draw(t,e,i,r){return lG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s){return lG(t,this.parseSize(e)/2,i,r,s)}}const VBt=new $Bt,XL=Rn(3);function hG(n,t,e,i){const r=t*XL;return n.moveTo(e,i+-r/3*2),n.lineTo(t+e,i+r),n.lineTo(e-t,i+r),n.closePath(),!0}class GBt extends pn{constructor(){super(...arguments),this.type="thinTriangle",this.pathStr="M0,-0.5773502691896257L-0.5,0.28867513459481287L0.5,0.28867513459481287Z"}draw(t,e,i,r){return hG(t,this.parseSize(e)/2/XL,i,r)}drawOffset(t,e,i,r,s){return hG(t,this.parseSize(e)/2/XL+s,i,r)}}const UBt=new GBt;function dG(n,t,e,i){const r=2*t;return n.moveTo(t+e,i-r),n.lineTo(e-t,i),n.lineTo(t+e,r+i),!0}class YBt extends pn{constructor(){super(...arguments),this.type="arrow2Left",this.pathStr="M 0.25 -0.5 L -0.25 0 l 0.25 0.5"}draw(t,e,i,r){return dG(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return dG(t,this.parseSize(e)/4+s,i,r)}}const XBt=new YBt;function uG(n,t,e,i){const r=2*t;return n.moveTo(e-t,i-r),n.lineTo(e+t,i),n.lineTo(e-t,r+i),!0}class KBt extends pn{constructor(){super(...arguments),this.type="arrow2Right",this.pathStr="M -0.25 -0.5 l 0.25 0 l -0.25 0.5"}draw(t,e,i,r){return uG(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return uG(t,this.parseSize(e)/4+s,i,r)}}const qBt=new KBt;function cG(n,t,e,i){const r=2*t;return n.moveTo(e-r,i+t),n.lineTo(e,i-t),n.lineTo(e+r,i+t),!0}class ZBt extends pn{constructor(){super(...arguments),this.type="arrow2Up",this.pathStr="M -0.5 0.25 L 0 -0.25 l 0.5 0.25"}draw(t,e,i,r){return cG(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return cG(t,this.parseSize(e)/4+s,i,r)}}const JBt=new ZBt;function gG(n,t,e,i){const r=2*t;return n.moveTo(e-r,i-t),n.lineTo(e,i+t),n.lineTo(e+r,i-t),!0}class QBt extends pn{constructor(){super(...arguments),this.type="arrow2Down",this.pathStr="M -0.5 -0.25 L 0 0.25 l 0.5 -0.25"}draw(t,e,i,r){return gG(t,this.parseSize(e)/4,i,r)}drawOffset(t,e,i,r,s){return gG(t,this.parseSize(e)/4+s,i,r)}}const tPt=new QBt;function pG(n,t,e,i,r){return n.moveTo(e,i-t),n.lineTo(e,i+t),!0}class ePt extends pn{constructor(){super(...arguments),this.type="lineV",this.pathStr="M0,-0.5L0,0.5"}draw(t,e,i,r,s){return pG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s,o){return pG(t,this.parseSize(e)/2+s,i,r)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e}, ${i-s} L ${e},${i+s}`}}const iPt=new ePt;function fG(n,t,e,i,r){return n.moveTo(e-t,i),n.lineTo(e+t,i),!0}class nPt extends pn{constructor(){super(...arguments),this.type="lineH",this.pathStr="M-0.5,0L0.5,0"}draw(t,e,i,r,s){return fG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s,o){return fG(t,this.parseSize(e)/2+s,i,r)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e-s}, ${i} L ${e+s},${i}`}}const rPt=new nPt;function mG(n,t,e,i,r){return n.moveTo(e-t,i-t),n.lineTo(e+t,i+t),n.moveTo(e+t,i-t),n.lineTo(e-t,i+t),!0}class sPt extends pn{constructor(){super(...arguments),this.type="close",this.pathStr="M-0.5,-0.5L0.5,0.5,M0.5,-0.5L-0.5,0.5"}draw(t,e,i,r,s){return mG(t,this.parseSize(e)/2,i,r)}drawOffset(t,e,i,r,s,o){return mG(t,this.parseSize(e)/2+s,i,r)}drawToSvgPath(t,e,i,r){const s=this.parseSize(t)/2;return`M ${e-s}, ${i-s} L ${e+s},${i+s} M ${e+s}, ${i-s} L ${e-s},${i+s}`}}const oPt=new sPt;function vG(n,t,e,i){return n.rect(e-t[0]/2,i-t[1]/2,t[0],t[1]),!1}function _G(n,t,e,i){const r=t,s=t/2;return n.rect(e-r/2,i-s/2,r,s),!1}class aPt extends pn{constructor(){super(...arguments),this.type="rect",this.pathStr="M -0.5,0.25 L 0.5,0.25 L 0.5,-0.25,L -0.5,-0.25 Z"}draw(t,e,i,r){return J(e)?_G(t,e,i,r):vG(t,e,i,r)}drawWithClipRange(t,e,i,r,s,o,a){J(e)&&(e=[e,e/2]);const l=2*(e[0]+e[1])*s,h=[{x:i+e[0]/2,y:r-e[1]/2},{x:i+e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r+e[1]/2},{x:i-e[0]/2,y:r-e[1]/2}];let d=0,u=h[3];t.moveTo(u.x,u.y);for(let c=0;c<h.length;c++){const g=h[c],p=Math.sqrt((g.x-u.x)*(g.x-u.x)+(g.y-u.y)*(g.y-u.y));if(d+p>l){const f=(g.x-u.x)*(l-d)/p,m=(g.y-u.y)*(l-d)/p;t.lineTo(u.x+f,u.y+m);break}t.lineTo(g.x,g.y),u=g,d+=p}return!1}drawOffset(t,e,i,r,s){return J(e)?_G(t,e+2*s,i,r):vG(t,[e[0]+2*s,e[1]+2*s],i,r)}}const lPt=new aPt,bm=new ie;class bG{constructor(t,e,i=!1){this.pathStr="",this.type=t,V(e)?this.svgCache=e:this.path=e,this.isSvg=i}drawOffset(t,e,i,r,s,o,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{t.beginPath(),ih(l.path.commandList,t,i,r,e,e),a&&a(l.path,l.attribute)}),!1):(ih(this.path.commandList,t,i,r,e+s,e+s),!1)}draw(t,e,i,r,s,o){return e=this.parseSize(e),this.drawOffset(t,e,i,r,0,s,o)}parseSize(t){return J(t)?t:Math.min(t[0],t[1])}drawWithClipRange(t,e,i,r,s,o,a){return e=this.parseSize(e),this.isSvg?!!this.svgCache&&(this.svgCache.forEach(l=>{l.path.drawWithClipRange(t,e,i,r,s),a&&a(l.path,l.attribute)}),!1):(this.path.drawWithClipRange(t,e,i,r,s),!1)}bounds(t,e){if(t=this.parseSize(t),this.isSvg)return this.svgCache?(e.clear(),void this.svgCache.forEach(({path:i})=>{bm.x1=i.bounds.x1*t,bm.y1=i.bounds.y1*t,bm.x2=i.bounds.x2*t,bm.y2=i.bounds.y2*t,e.union(bm)})):void 0;this.path.bounds&&(e.x1=this.path.bounds.x1*t,e.y1=this.path.bounds.y1*t,e.x2=this.path.bounds.x2*t,e.y2=this.path.bounds.y2*t)}}const hPt=[pBt,_Bt,yBt,SBt,UBt,ABt,RBt,EBt,IBt,DBt,HBt,WBt,NBt,xBt,VBt,XBt,qBt,JBt,tPt,lPt,iPt,rPt,oPt],T1={};hPt.forEach(n=>{T1[n.type]=n});const dPt={arrowLeft:"M 0.25 -0.5 L -0.25 0 l 0.5 0.5",arrowRight:"M -0.25 -0.5 l 0.5 0.5 l -0.5 0.5",rectRound:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",roundLine:"M 1.2392 -0.258 L -1.3432 -0.258 C -1.4784 -0.258 -1.588 -0.1436 -1.588 -0.002 c 0 0.1416 0.1096 0.256 0.2448 0.256 l 2.5824 0 c 0.1352 0 0.2448 -0.1144 0.2448 -0.256 C 1.484 -0.1436 1.3744 -0.258 1.2392 -0.258 z"};function uPt(n,t){const e=[];let i=t.exec(n);for(;i;){const r=[];r.startIndex=t.lastIndex-i[0].length;const s=i.length;for(let o=0;o<s;o++)r.push(i[o]);e.push(r),i=t.exec(n)}return e}class RB{constructor(t){this.tagname=t,this.child=[],this[":@"]={}}add(t,e){t==="__proto__"&&(t="#__proto__"),this.child.push({[t]:e})}addChild(t){t.tagname==="__proto__"&&(t.tagname="#__proto__"),t[":@"]&&Object.keys(t[":@"]).length>0?this.child.push({[t.tagname]:t.child,":@":t[":@"]}):this.child.push({[t.tagname]:t.child})}}function yG(n,t,e,i){const r=n.indexOf(t,e);if(r===-1)throw new Error(i);return r+t.length-1}function cPt(n,t,e=">"){let i,r="";for(let s=t;s<n.length;s++){let o=n[s];if(i)o===i&&(i="");else if(o==='"'||o==="'")i=o;else if(o===e[0]){if(!e[1])return{data:r,index:s};if(n[s+1]===e[1])return{data:r,index:s}}else o==="	"&&(o=" ");r+=o}}function CG(n,t,e,i=">"){const r=cPt(n,t+1,i);if(!r)return;let s=r.data;const o=r.index,a=s.search(/\s/);let l=s,h=!0;return a!==-1&&(l=s.substr(0,a).replace(/\s\s*$/,""),s=s.substr(a+1)),{tagName:l,tagExp:s,closeIndex:o,attrExpPresent:h,rawTagName:l}}const gPt=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");class pPt{constructor(t){this.currentNode=null,this.options=t,this.tagsNodeStack=[],this.docTypeEntities={}}addChild(t,e,i){const r=e.tagname;typeof r=="string"&&(e.tagname=r),t.addChild(e)}buildAttributesMap(t,e,i){const r={};if(!t)return;const s=uPt(t,gPt),o=s.length;for(let a=0;a<o;a++){const l=s[a][1],h=s[a][4],d=l;l&&(r[d]=h===void 0||(isNaN(h)?h:Number(h)))}return r}parseXml(t){t=t.replace(/\r\n?/g,`
`);const e=new RB("!xml");let i=e,r="",s="";for(let o=0;o<t.length;o++)if(t[o]==="<")if(t[o+1]==="/"){const a=yG(t,">",o,"Closing Tag is not closed."),l=s.lastIndexOf(".");s=s.substring(0,l),i=this.tagsNodeStack.pop(),i&&i.child&&r&&i.child[i.child.length-1][":@"]&&(i.child[i.child.length-1][":@"].text=r),r="",o=a}else if(t[o+1]==="?")o=CG(t,o,!1,"?>").closeIndex+1;else if(t.substr(o+1,3)==="!--")o=yG(t,"-->",o+4,"Comment is not closed.");else{const a=CG(t,o);let l=a.tagName,h=a.tagExp;const d=a.attrExpPresent,u=a.closeIndex;if(l!==e.tagname&&(s+=s?"."+l:l),h.length>0&&h.lastIndexOf("/")===h.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),s=s.substr(0,s.length-1),h=l):h=h.substr(0,h.length-1);const c=new RB(l);l!==h&&d&&(c[":@"]=this.buildAttributesMap(h,s,l)),this.addChild(i,c,s),s=s.substr(0,s.lastIndexOf("."))}else{const c=new RB(l);this.tagsNodeStack.push(i),l!==h&&d&&(c[":@"]=this.buildAttributesMap(h,s,l)),this.addChild(i,c,s),i=c}r="",o=u}else r+=t[o];return e.child}}function fPt(n,t){return vQ(n)}function vQ(n,t){const e={};for(let i=0;i<n.length;i++){const r=n[i],s=mPt(r);if(s!==void 0&&r[s]){const o=vQ(r[s]);_Pt(o),r[":@"]&&vPt(o,r[":@"]),e[s]!==void 0&&e.hasOwnProperty(s)?(Array.isArray(e[s])||(e[s]=[e[s]]),e[s].push(o)):e[s]=o}}return e}function mPt(n){const t=Object.keys(n);for(let e=0;e<t.length;e++){const i=t[e];if(i!==":@")return i}}function vPt(n,t,e){if(t){const i=Object.keys(t),r=i.length;for(let s=0;s<r;s++){const o=i[s];n[o]=t[o]}}}function _Pt(n){return Object.keys(n).length===0}class WM{constructor(t){this.options=Object.assign({},WM.defaultOptions,t)}valid(t){return t.startsWith("<")}parse(t){if(!this.valid)return!1;const e=new pPt(this.options).parseXml(t);return fPt(e,this.options)}}WM.defaultOptions={};function bPt(n){return n.startsWith("<svg")||n.startsWith("<?xml")}var yPt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function CPt(n){return yPt(this,void 0,void 0,function*(){const t=[],e=n.getChildren();yield new Promise(i=>{bt.global.getRequestAnimationFrame()(()=>{i(null)})}),e.forEach(i=>{i.subLayers.size&&i.subLayers.forEach(r=>{r.drawContribution&&r.drawContribution.hooks&&r.drawContribution.rendering&&t.push(new Promise(s=>{r.drawContribution.hooks.completeDraw.tap("outWait",()=>{r.drawContribution.hooks.completeDraw.taps=r.drawContribution.hooks.completeDraw.taps.filter(o=>o.name!=="outWait"),s(null)})}))})}),yield Promise.all(t)})}function k1(n,t,e,i=0){return n.expand(t+(i/2+(e?SPt(e,t):0))),n}function SPt(n,t){return n?t:0}let xPt=0;function or(){return xPt++}var Lp;(function(n){n[n.HORIZONTAL=0]="HORIZONTAL",n[n.VERTICAL=1]="VERTICAL"})(Lp||(Lp={}));function wPt(n){const t=[];let e=0,i="";for(let r=0;r<n.length;r++)TPt(n[r])?e?i+=n[r]:(e=1,i=n[r]):(e&&(t.push({text:i,direction:Lp.VERTICAL}),i="",e=0),t.push({text:n[r],direction:Lp.HORIZONTAL}));return i&&t.push({text:i,direction:Lp.VERTICAL}),t}const APt=["","","","","","","","","",""],_Q=new Map;APt.forEach(n=>_Q.set(n,!0));const MPt=[""],bQ=new Map;function TPt(n){if(_Q.has(n))return!0;if(bQ.has(n))return!1;let t=!1;return n.codePointAt(0)<256&&(t=!0),t}MPt.forEach(n=>bQ.set(n,!0));const jM=or(),NM=or(),cb=or(),$M=or(),ND=or(),$D=or(),VM=or(),gb=or(),GM=or(),UM=or(),VD=or(),GD=or(),UD=or(),YD=or();or();const YM=or(),XM=or(),yQ=Symbol.for("GraphicService"),CQ=Symbol.for("GraphicCreator"),SQ={"stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-width":"lineWidth","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity",stroke:"stroke",fill:"fill"},kPt=Object.keys(SQ),$y=new ie,RPt=new Pe;new ie;const $s=["lineWidth","scaleX","scaleY","angle","anchor","visible"],SG=["x","y"],xG=["scaleX","scaleY"],wG=["angle"],ym=new Yt,ar={strokeSeg:1,boundsPadding:2,pickMode:1,boundsMode:1,customPickShape:1,pickable:1,childrenPickable:1,visible:1,zIndex:1,layout:1,keepDirIn3d:1,globalZIndex:1,outerBorder:1,innerBorder:1,lineDash:1,lineCap:1,lineJoin:1,miterLimit:2,strokeBoundsBuffer:2,scaleCenter:1,anchor:1,anchor3d:1,postMatrix:1,backgroundMode:2,background:1,texture:1,cursor:1,html:1};class kn extends URt{static mixin(t){const e=Object.keys(t);for(let i=0;i<e.length;++i){const r=e[i];Object.defineProperty(kn.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get AABBBounds(){return this.tryUpdateAABBBounds()}get OBBBounds(){return this.tryUpdateOBBBounds()}get globalAABBBounds(){return this.tryUpdateGlobalAABBBounds()}get transMatrix(){return this.tryUpdateLocalTransMatrix(!0)}get globalTransMatrix(){return this.tryUpdateGlobalTransMatrix(!0)}constructor(t={}){var e;super(),this._AABBBounds=new ie,this._updateTag=fi.INIT,this.attribute=t,this.valid=this.isValid(),this.updateAABBBoundsStamp=0,t.background?this.loadImage((e=t.background.background)!==null&&e!==void 0?e:t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic)}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}getOffsetXY(t,e=!1){var i,r;const{dx:s=t.dx,dy:o=t.dy}=this.attribute;if(e&&this.parent){const a=this.parent.attribute;ym.x=s+((i=a.scrollX)!==null&&i!==void 0?i:0),ym.y=o+((r=a.scrollY)!==null&&r!==void 0?r:0)}else ym.x=s,ym.y=o;return ym}onAnimateBind(t){this._emitCustomEvent("animate-bind",t)}tryUpdateAABBBounds(){const t=this.attribute.boundsMode==="imprecise";if(!this.shouldUpdateAABBBounds())return this._AABBBounds;if(!this.valid)return this._AABBBounds.clear(),this._AABBBounds;bt.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const e=this.doUpdateAABBBounds(t);return bt.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,!0),this.attribute.boundsMode==="empty"&&e.clear(),e}tryUpdateOBBBounds(){return this._OBBBounds||(this._OBBBounds=new qA),this.tryUpdateAABBBounds(),this.updateOBBBoundsStamp===this.updateAABBBoundsStamp?this._OBBBounds:(this.updateOBBBoundsStamp=this.updateAABBBoundsStamp,this.valid?this.doUpdateOBBBounds():(this._OBBBounds.clear(),this._OBBBounds))}combindShadowAABBBounds(t){if(this.shadowRoot){const e=this.shadowRoot.AABBBounds.clone();t.union(e)}}doUpdateOBBBounds(){return this._OBBBounds}getClipPath(){const{clipConfig:t}=this.attribute;if(!t)return null;this.clipPathMap||(this.clipPathMap=new Map);const{shape:e}=t;let i=this.clipPathMap.get(e)||null;return i||(this.clipPathMap.size>10&&this.clipPathMap.clear(),i=this.parsePath(e),i&&this.clipPathMap.set(e,i)),i}parsePath(t){if(!t)return null;let e=T1[t];if(e||(e=kn.userSymbolMap[t],e))return e;const i=dPt[t];if(bPt(t=i||t)===!0){const h=new WM,{svg:d}=h.parse(t);if(!d)return null;const u=V(d.path)?d.path:[d.path];$y.clear();const c=[];u.forEach(v=>{const _=new Cn().fromString(v.d),b={};kPt.forEach(y=>{v[y]&&(b[SQ[y]]=v[y])}),c.push({path:_,attribute:b}),$y.union(_.bounds)});const g=$y.width(),p=$y.height(),f=1/ti(g,p);c.forEach(v=>v.path.transform(0,0,f,f));const m=new bG(t,c,!0);return kn.userSymbolMap[t]=m,m}const r=new Cn().fromString(t),s=r.bounds.width(),o=r.bounds.height(),a=1/ti(s,o);r.transform(0,0,a,a);const l=new bG(t,r);return kn.userSymbolMap[t]=l,l}doUpdateAABBBounds(t){this.updateAABBBoundsStamp++;const e=this.getGraphicTheme();this._AABBBounds.clear();const i=this.attribute,r=this.updateAABBBounds(i,e,this._AABBBounds,t),{boundsPadding:s=e.boundsPadding}=i,o=GL(s);return o&&r.expand(o),this.clearUpdateBoundTag(),r}updatePathProxyAABBBounds(t){const e=typeof this.pathProxy=="function"?this.pathProxy(this.attribute):this.pathProxy;if(!e)return!1;const i=new DD(t);return ih(e.commandList,i,0,0),!0}tryUpdateGlobalAABBBounds(){const t=this.AABBBounds;return this._globalAABBBounds?this._globalAABBBounds.setValue(t.x1,t.y1,t.x2,t.y2):this._globalAABBBounds=t.clone(),this._globalAABBBounds.empty()||this.parent&&this._globalAABBBounds.transformWithMatrix(this.parent.globalTransMatrix),this._globalAABBBounds}tryUpdateGlobalTransMatrix(t=!0){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();return this.shouldUpdateGlobalMatrix()&&this.doUpdateGlobalMatrix(),this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!0}tryUpdateLocalTransMatrix(t=!0){return this._transMatrix||(this._transMatrix=new Pe),this.shouldUpdateLocalMatrix()&&(this.doUpdateLocalMatrix(),t&&this.clearUpdateLocalPositionTag()),this._transMatrix}shouldUpdateAABBBounds(){return this.shadowRoot?(!!(this._updateTag&fi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds())&&bt.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this):!!(this._updateTag&fi.UPDATE_BOUNDS)&&bt.graphicService.validCheck(this.attribute,this.getGraphicTheme(),this._AABBBounds,this)}shouldSelfChangeUpdateAABBBounds(){return this.shadowRoot?!!(this._updateTag&fi.UPDATE_BOUNDS)||this.shadowRoot.shouldUpdateAABBBounds():!!(this._updateTag&fi.UPDATE_BOUNDS)}shouldUpdateLocalMatrix(){return!!(this._updateTag&fi.UPDATE_LOCAL_MATRIX)}isValid(){var t,e;const i=this.attribute;return Number.isFinite(((t=i.x)!==null&&t!==void 0?t:0)+((e=i.y)!==null&&e!==void 0?e:0))}_validNumber(t){return t==null||Number.isFinite(t)}shouldUpdateShape(){return!!(this._updateTag&fi.UPDATE_SHAPE)}clearUpdateShapeTag(){this._updateTag&=fi.CLEAR_SHAPE}containsPoint(t,e,i,r){if(!r)return!1;if(i===lf.GLOBAL){const s=new Yt(t,e);this.parent&&this.parent.globalTransMatrix.transformPoint(s,s),t=s.x,e=s.y}return r.containsPoint(this,{x:t,y:e})}setWidthHeightWithoutTransform(t){this.widthWithoutTransform=t.x2-t.x1,this.heightWithoutTransform=t.y2-t.y1}setAttributes(t,e=!1,i){(t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t).background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._setAttributes(t,e,i)}_setAttributes(t,e=!1,i){const r=Object.keys(t);for(let s=0;s<r.length;s++){const o=r[s];this.attribute[o]=t[o]}this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(r)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i)}setAttribute(t,e,i,r){var s;const o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);o?this._setAttributes(o,i,r):D((s=this.normalAttrs)===null||s===void 0?void 0:s[t])?(this.attribute[t]=e,this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r)):this.normalAttrs[t]=e,t==="background"?this.loadImage(e,!0):t==="shadowGraphic"&&this.setShadowGraphic(e)}needUpdateTags(t,e=$s){for(let i=0;i<e.length;i++){const r=e[i];if(t.indexOf(r)!==-1)return!0}return!1}needUpdateTag(t,e=$s){for(let i=0;i<e.length;i++)if(t===e[i])return!0;return!1}initAttributes(t){const e={type:qi.INIT};t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,e)||t,this.attribute=t,t.background?this.loadImage(t.background,!0):t.shadowGraphic&&this.setShadowGraphic(t.shadowGraphic),this._updateTag=fi.INIT,this.valid=this.isValid(),this.onAttributeUpdate(e)}translate(t,e){var i,r;if(t===0&&e===0)return this;const s={type:qi.TRANSLATE},o=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,SG,s);o&&(t=o.x,e=o.y,delete o.x,delete o.y,this._setAttributes(o));const a=this.attribute,l=a.postMatrix;return l?bt.transformUtil.fromMatrix(l,l).translate(t,e):(a.x=((i=a.x)!==null&&i!==void 0?i:Hn.x)+t,a.y=((r=a.y)!==null&&r!==void 0?r:Hn.y)+e),this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(s),this}translateTo(t,e){const i=this.attribute;if(i.x===t&&i.y===e)return this;const r={type:qi.TRANSLATE_TO},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({x:t,y:e},this.attribute,SG,r);return s?(this._setAttributes(s,!1,r),this):(i.x=t,i.y=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}scale(t,e,i){var r,s;if(t===1&&e===1)return this;const o={type:qi.SCALE},a=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e,scaleCenter:i},this.attribute,xG,o);a&&(t=a.scaleX,e=a.scaleY,delete a.scaleX,delete a.scaleY,this._setAttributes(a));const l=this.attribute;if(i){let{postMatrix:h}=this.attribute;h||(h=new Pe,l.postMatrix=h),bt.transformUtil.fromMatrix(h,h).scale(t,e,i)}else l.scaleX=((r=l.scaleX)!==null&&r!==void 0?r:Hn.scaleX)*t,l.scaleY=((s=l.scaleY)!==null&&s!==void 0?s:Hn.scaleY)*e;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(o),this}scaleTo(t,e){const i=this.attribute;if(i.scaleX===t&&i.scaleY===e)return this;const r={type:qi.SCALE_TO},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({scaleX:t,scaleY:e},this.attribute,xG,r);return s?(this._setAttributes(s,!1,r),this):(i.scaleX=t,i.scaleY=e,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this)}rotate(t,e){var i;if(t===0)return this;const r={type:qi.ROTATE},s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({angle:t,rotateCenter:e},this.attribute,wG,r);s&&(delete s.angle,this._setAttributes(s,!1,r));const o=this.attribute;if(e){let{postMatrix:a}=this.attribute;a||(a=new Pe,o.postMatrix=a),bt.transformUtil.fromMatrix(a,a).rotate(t,e)}else o.angle=((i=o.angle)!==null&&i!==void 0?i:Hn.angle)+t;return this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(r),this}rotateTo(t){const e=this.attribute;if(e.angle===t)return this;const i={type:qi.ROTATE_TO},r=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,wG,i);return r?(this._setAttributes(r,!1,i),this):(e.angle=t,this.addUpdatePositionTag(),this.addUpdateBoundTag(),this.addUpdateLayoutTag(),this.onAttributeUpdate(i),this)}skewTo(t,e){return this}animate(t){var e;this.animates||(this.animates=new Map);const i=new M1(t==null?void 0:t.id,(e=t==null?void 0:t.timeline)!==null&&e!==void 0?e:this.stage&&this.stage.getTimeline(),t==null?void 0:t.slience);if(i.bind(this),t){const{onStart:r,onFrame:s,onEnd:o,onRemove:a}=t;r!=null&&i.onStart(r),s!=null&&i.onFrame(s),o!=null&&i.onEnd(o),a!=null&&i.onRemove(a),i.interpolateFunc=t.interpolate}return this.animates.set(i.id,i),i.onRemove(()=>{i.stop(),this.animates.delete(i.id)}),i}onAttributeUpdate(t){t&&t.skipUpdateCallback||(bt.graphicService.onAttributeUpdate(this),this._emitCustomEvent("afterAttributeUpdate",t))}update(t){t?(t.bounds&&this.tryUpdateAABBBounds(),t.trans&&this.tryUpdateLocalTransMatrix()):(this.tryUpdateAABBBounds(),this.tryUpdateLocalTransMatrix())}hasState(t){return!(!this.currentStates||!this.currentStates.length)&&(!!D(t)||this.currentStates.includes(t))}getState(t){var e;return(e=this.states)===null||e===void 0?void 0:e[t]}applyStateAttrs(t,e,i,r){var s,o,a,l;if(i){const h=Object.keys(t),d=this.getNoWorkAnimateAttr(),u={};let c;h.forEach(p=>{d[p]?(c||(c={}),c[p]=t[p]):u[p]=r&&t[p]===void 0?this.getDefaultAttribute(p):t[p]});const g=this.animate({slience:!0});g.stateNames=e,g.to(u,(o=(s=this.stateAnimateConfig)===null||s===void 0?void 0:s.duration)!==null&&o!==void 0?o:$V.duration,(l=(a=this.stateAnimateConfig)===null||a===void 0?void 0:a.easing)!==null&&l!==void 0?l:$V.easing),c&&this.setAttributes(c,!1,{type:qi.STATE})}else this.stopStateAnimates(),this.setAttributes(t,!1,{type:qi.STATE})}updateNormalAttrs(t){const e={};this.normalAttrs?(Object.keys(t).forEach(i=>{i in this.normalAttrs?(e[i]=this.normalAttrs[i],delete this.normalAttrs[i]):e[i]=this.getNormalAttribute(i)}),Object.keys(this.normalAttrs).forEach(i=>{t[i]=this.normalAttrs[i]})):Object.keys(t).forEach(i=>{e[i]=this.getNormalAttribute(i)}),this.normalAttrs=e}stopStateAnimates(t="end"){this.animates&&this.animates.forEach(e=>{e.stateNames&&(e.stop(t),this.animates.delete(e.id))})}getNormalAttribute(t){let e=this.attribute[t];return this.animates&&this.animates.forEach(i=>{if(i.stateNames){const r=i.getEndProps();Qr(r,t)&&(e=r[t])}}),e}clearStates(t){this.hasState()&&this.normalAttrs?(this.currentStates=[],this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}removeState(t,e){if(this.currentStates){const i=V(t)?s=>!t.includes(s):s=>s!==t,r=this.currentStates.filter(i);r.length!==this.currentStates.length&&this.useStates(r,e)}}toggleState(t,e){if(this.hasState(t))this.removeState(t,e);else if((this.currentStates?this.currentStates.indexOf(t):-1)<0){const i=this.currentStates?this.currentStates.slice():[];i.push(t),this.useStates(i,e)}}addState(t,e,i){var r;if(this.currentStates&&this.currentStates.includes(t)&&(e||this.currentStates.length===1))return;const s=e&&(!((r=this.currentStates)===null||r===void 0)&&r.length)?this.currentStates.concat([t]):[t];this.useStates(s,i)}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some((s,o)=>this.currentStates[o]!==s)))return;const r={};t.forEach(s=>{var o;const a=this.stateProxy?this.stateProxy(s,t):(o=this.states)===null||o===void 0?void 0:o[s];a&&Object.assign(r,a)}),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}addUpdateBoundTag(){this._updateTag|=fi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}addUpdateShapeTag(){this._updateTag|=fi.UPDATE_SHAPE}addUpdateShapeAndBoundsTag(){this._updateTag|=fi.UPDATE_SHAPE_AND_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag(),this.glyphHost&&this.glyphHost.addUpdateBoundTag()}updateShapeAndBoundsTagSetted(){return(this._updateTag&fi.UPDATE_SHAPE_AND_BOUNDS)===fi.UPDATE_SHAPE_AND_BOUNDS}clearUpdateBoundTag(){this._updateTag&=fi.CLEAR_BOUNDS}addUpdatePositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=fi.UPDATE_GLOBAL_LOCAL_MATRIX}addUpdateGlobalPositionTag(){this.shadowRoot&&this.shadowRoot.addUpdateGlobalPositionTag(),this._updateTag|=fi.UPDATE_GLOBAL_MATRIX}clearUpdateLocalPositionTag(){this._updateTag&=fi.CLEAR_LOCAL_MATRIX}clearUpdateGlobalPositionTag(){this._updateTag&=fi.CLEAR_GLOBAL_MATRIX}addUpdateLayoutTag(){this._updateTag|=fi.UPDATE_LAYOUT}clearUpdateLayoutTag(){this._updateTag&=fi.CLEAR_LAYOUT}needUpdateLayout(){return!!(this._updateTag&fi.UPDATE_LAYOUT)}getAnchor(t,e,i){const r=[0,0],s=()=>{if(e.b)return e.b;const o=this.clone();return o.attribute.angle=0,o.attribute.scaleCenter=null,i&&(o.attribute.scaleX=1,o.attribute.scaleY=1),e.b=o.AABBBounds,e.b};if(typeof t[0]=="string"){const o=parseFloat(t[0])/100,a=s();r[0]=a.x1+(a.x2-a.x1)*o}else r[0]=t[0];if(typeof t[1]=="string"){const o=parseFloat(t[1])/100,a=s();r[1]=a.y1+(a.y2-a.y1)*o}else r[1]=t[1];return r}doUpdateLocalMatrix(){const{x:t=Hn.x,y:e=Hn.y,scaleX:i=Hn.scaleX,scaleY:r=Hn.scaleY,angle:s=Hn.angle,scaleCenter:o,anchor:a,postMatrix:l}=this.attribute;let h=[0,0];const d={};if(a&&s&&(h=this.getAnchor(a,d)),!o||i===1&&r===1)LY(this._transMatrix,this._transMatrix.reset(),t,e,i,r,s,a&&h);else{const c=this._transMatrix;c.reset(),c.translate(h[0],h[1]),c.rotate(s),c.translate(-h[0],-h[1]),c.translate(t,e),h=this.getAnchor(o,d,!0),bt.transformUtil.fromMatrix(c,c).scale(i,r,{x:h[0],y:h[1]})}const u=this.getOffsetXY(Hn);if(this._transMatrix.e+=u.x,this._transMatrix.f+=u.y,l){const c=RPt.setValue(l.a,l.b,l.c,l.d,l.e,l.f),g=this._transMatrix;c.multiply(g.a,g.b,g.c,g.d,g.e,g.f),g.setValue(c.a,c.b,c.c,c.d,c.e,c.f)}}doUpdateGlobalMatrix(){if(this.parent){this._globalTransMatrix.multiply(this.transMatrix.a,this.transMatrix.b,this.transMatrix.c,this.transMatrix.d,this.transMatrix.e,this.transMatrix.f);const{scrollX:t=0,scrollY:e=0}=this.parent.attribute;this._globalTransMatrix.translate(t,e)}}setStage(t,e){if(this.stage!==t){if(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this.animates&&this.animates.size){const i=t.getTimeline();this.animates.forEach(r=>{r.timeline===A1&&r.setTimeline(i)})}this._onSetStage&&this._onSetStage(this,t,e),bt.graphicService.onSetStage(this,t)}}setStageToShadowRoot(t,e){this.shadowRoot&&this.shadowRoot.setStage(t,e)}onAddStep(t){}onStop(t){t&&this.setAttributes(t,!1,{type:qi.ANIMATE_END})}onStep(t,e,i,r,s){const o={};if(i.customAnimate)i.customAnimate.update(s,r,o);else{const a=i.props,l=i.parsedProps,h=i.propKeys;this.stepInterpolate(t,e,o,i,r,s,a,void 0,l,h)}this.setAttributes(o,!1,{type:qi.ANIMATE_UPDATE,animationState:{ratio:r,end:s,step:i,isFirstFrameOfStep:t.getLastStep()!==i}}),this.stage&&this.stage.renderNextFrame()}stepInterpolate(t,e,i,r,s,o,a,l,h,d){d||(d=Object.keys(a),r.propKeys=d),o?r.propKeys.forEach(u=>{e.validAttr(u)&&(i[u]=a[u])}):d.forEach(u=>{var c;if(!e.validAttr(u))return;const g=a[u],p=(c=l&&l[u])!==null&&c!==void 0?c:t.getLastPropByName(u,r);if(g==null||p==null||g===p)return void(i[u]=g);let f;f=e.interpolateFunc&&e.interpolateFunc(u,s,p,g,i),f||(f=e.customInterpolate(u,s,p,g,this,i),f||this.defaultInterpolate(g,p,u,i,h,s)||this._interpolate(u,s,p,g,i))}),r.parsedProps=h}defaultInterpolate(t,e,i,r,s,o){if(Number.isFinite(t)&&Number.isFinite(e))return r[i]=e+(t-e)*o,!0;if(i==="fill"){s||(s={});const a=s.fillColorArray,l=Ep(e,a??t,o,!1,(h,d)=>{s.fillColorArray=d});return l&&(r[i]=l),!0}if(i==="stroke"){s||(s={});const a=s.strokeColorArray,l=Ep(e,a??t,o,!1,(h,d)=>{s.strokeColorArray=d});return l&&(r[i]=l),!0}if(i==="shadowColor"){s||(s={});const a=s.shadowColorArray,l=Ep(e,a??t,o,!0,(h,d)=>{s.shadowColorArray=d});return l&&(r[i]=l),!0}if(Array.isArray(t)&&t.length===e.length){const a=[];let l=!0;for(let h=0;h<t.length;h++){const d=e[h],u=d+(t[h]-d)*o;if(!Number.isFinite(u)){l=!1;break}a.push(u)}l&&(r[i]=a)}return!1}_interpolate(t,e,i,r,s){}getDefaultAttribute(t){return this.getGraphicTheme()[t]}getComputedAttribute(t){var e;return(e=this.attribute[t])!==null&&e!==void 0?e:this.getDefaultAttribute(t)}onSetStage(t,e=!1){this._onSetStage=t,e&&this.stage&&t(this,this.stage)}attachShadow(t){return t&&(t.shadowHost=this),this.shadowRoot=t??bt.graphicService.creator.shadowRoot(this),this.addUpdateBoundTag(),this.shadowRoot.setStage(this.stage,this.layer),this.shadowRoot}detachShadow(){this.shadowRoot&&(this.addUpdateBoundTag(),this.shadowRoot.release(!0),this.shadowRoot=null)}toJson(){return{attribute:this.attribute,_uid:this._uid,type:this.type,name:this.name,children:this.children.map(t=>t.toJson())}}createPathProxy(t){return yt(t,!0)?this.pathProxy=new Cn().fromString(t):this.pathProxy=new Cn,this.pathProxy}loadImage(t,e=!1){if(!t||e&&BPt(t))return;const i=t;this.resources||(this.resources=new Map);const r={data:"init",state:null};this.resources.set(i,r),typeof t=="string"?(r.state="loading",t.startsWith("<svg")?(vi.GetSvg(t,this),this.backgroundImg=this.backgroundImg||e):(mO(t)||t.includes("/")||vO(t))&&(vi.GetImage(t,this),this.backgroundImg=this.backgroundImg||e)):kt(t)?(r.state="success",r.data=t,this.backgroundImg=this.backgroundImg||e):r.state="fail"}setShadowGraphic(t){t?this.attachShadow().add(t):this.detachShadow()}imageLoadSuccess(t,e,i){if(!this.resources)return;const r=this.resources.get(t);r&&(r.state="success",r.data=e,i&&i(),this.addUpdateBoundTag(),this.stage&&this.stage.renderNextFrame())}imageLoadFail(t,e){if(!this.resources)return;const i=this.resources.get(t);i&&(i.state="fail",e&&e())}_stopAnimates(t){t&&t.forEach(e=>{e.stop()})}stopAnimates(t=!1){this._stopAnimates(this.animates),this.shadowRoot&&this.shadowRoot.stopAnimates(!0),this.isContainer&&t&&this.forEachChildren(e=>{e.stopAnimates(t)})}release(){this.releaseStatus="released",this.stopAnimates(),bt.graphicService.onRelease(this)}_emitCustomEvent(t,e){var i,r;if(this._events&&t in this._events){const s=new FM(t,e);s.bubbles=!1,s.manager=(r=(i=this.stage)===null||i===void 0?void 0:i.eventSystem)===null||r===void 0?void 0:r.manager,this.dispatchEvent(s)}}}function BPt(n){return!(!n.fill&&!n.stroke)}kn.userSymbolMap={},kn.mixin(XRt);var AG;(function(n){n[n.LESS_GROUP=0]="LESS_GROUP",n[n.MORE_GROUP=1]="MORE_GROUP"})(AG||(AG={}));let $f=class KL extends kn{constructor(t){super(t),this.type="group",this.parent=null,this.isContainer=!0,this.numberType=$D,this._childUpdateTag=fi.UPDATE_BOUNDS}setMode(t){t==="3d"?this.set3dMode():this.set2dMode()}set3dMode(){this.in3dMode=!0}set2dMode(){this.in3dMode=!1}setTheme(t){return this.theme||(this.theme=new e0),this.theme.setTheme(t,this)}createTheme(){this.theme||(this.theme=new e0)}visibleAll(t){this.setAttribute("visible",t),this.forEachChildren(e=>{e.isContainer&&e.visibleAll?e.visibleAll(t):e.setAttribute("visible",t)})}hideAll(){this.visibleAll(!1)}showAll(){this.visibleAll(!0)}containsPoint(t,e,i){if(i===lf.GLOBAL){const r=new Yt(t,e);return this.parent&&this.parent.globalTransMatrix.transformPoint(r,r),this.AABBBounds.contains(r.x,r.y)}return this.AABBBounds.contains(t,e)}shouldUpdateAABBBounds(){return!!super.shouldUpdateAABBBounds()||!!(this._childUpdateTag&fi.UPDATE_BOUNDS)}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;bt.graphicService.beforeUpdateAABBBounds(this,this.stage,!0,this._AABBBounds);const t=this.shouldSelfChangeUpdateAABBBounds(),e=this.doUpdateAABBBounds();return this.addUpdateLayoutTag(),bt.graphicService.afterUpdateAABBBounds(this,this.stage,this._AABBBounds,this,t),this.attribute.boundsMode==="empty"&&e.clear(),e}doUpdateLocalMatrix(){const{x:t=Hn.x,y:e=Hn.y,dx:i=Hn.dx,dy:r=Hn.dy,scaleX:s=Hn.scaleX,scaleY:o=Hn.scaleY,angle:a=Hn.angle,postMatrix:l}=this.attribute;if(t!==0||e!==0||i!==0||r!==0||s!==1||o!==1||a!==0||l)return super.doUpdateLocalMatrix();this._transMatrix.reset()}getGraphicTheme(){return ne(this).group}updateAABBBounds(t,e,i){const r=i;i=i.clone();const{width:s,height:o,path:a,clip:l=e.clip}=t;if(a&&a.length?a.forEach(h=>{i.union(h.AABBBounds)}):s!=null&&o!=null&&i.set(0,0,Math.max(0,s),Math.max(0,o)),!l){this.forEachChildren(u=>{i.union(u.AABBBounds)});const{scrollX:h=0,scrollY:d=0}=t;i.translate(h,d)}return bt.graphicService.updateTempAABBBounds(i),bt.graphicService.transformAABBBounds(t,i,e,!1,this),r.copy(i),r}doUpdateAABBBounds(){this.updateAABBBoundsStamp++;const t=super.doUpdateAABBBounds();return this.parent&&this.parent.addChildUpdateBoundTag(),this._emitCustomEvent("AAABBBoundsChange"),t}clearUpdateBoundTag(){this._updateTag&=fi.CLEAR_BOUNDS,this._childUpdateTag&=fi.CLEAR_BOUNDS}addUpdateBoundTag(){this._updateTag|=fi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag()}addChildUpdateBoundTag(){this._childUpdateTag&fi.UPDATE_BOUNDS||(this._childUpdateTag|=fi.UPDATE_BOUNDS,this.parent&&this.parent.addChildUpdateBoundTag())}getTheme(){return this.theme.getTheme(this)}incrementalAppendChild(t){const e=super.appendChild(t);return this.stage&&e&&(e.stage=this.stage,e.layer=this.layer),this.addUpdateBoundTag(),bt.graphicService.onAddIncremental(t,this,this.stage),e}incrementalClearChild(){super.removeAllChild(),this.addUpdateBoundTag(),bt.graphicService.onClearIncremental(this,this.stage)}_updateChildToStage(t){return this.stage&&t&&t.setStage(this.stage,this.layer),this.addUpdateBoundTag(),t}appendChild(t,e=!0){const i=super.appendChild(t);return e&&this.stage&&i&&i.setStage(this.stage,this.layer),this.addUpdateBoundTag(),i}insertBefore(t,e){return this._updateChildToStage(super.insertBefore(t,e))}insertAfter(t,e){return this._updateChildToStage(super.insertAfter(t,e))}insertInto(t,e){return this._updateChildToStage(super.insertInto(t,e))}removeChild(t){const e=super.removeChild(t);return t.stage=null,bt.graphicService.onRemove(t),this.addUpdateBoundTag(),e}removeAllChild(t=!1){this.forEachChildren(e=>{bt.graphicService.onRemove(e),t&&e.isContainer&&e.removeAllChild(t)}),super.removeAllChild(),this.addUpdateBoundTag()}setStage(t,e){this.stage!==t&&(this.stage=t,this.layer=e,this.setStageToShadowRoot(t,e),this._onSetStage&&this._onSetStage(this,t,e),bt.graphicService.onSetStage(this,t),this.forEachChildren(i=>{i.setStage(t,this.layer)}))}addUpdatePositionTag(){super.addUpdatePositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}addUpdateGlobalPositionTag(){super.addUpdateGlobalPositionTag(),this.forEachChildren(t=>{t.isContainer&&t.addUpdateGlobalPositionTag()})}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){if(this._globalTransMatrix){if(this.parent){const e=this.parent.globalTransMatrix;this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f)}}else this._globalTransMatrix=this.parent?this.parent.globalTransMatrix.clone():this.transMatrix.clone();this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}shouldUpdateGlobalMatrix(){return!!(this._updateTag&fi.UPDATE_GLOBAL_MATRIX)}_getChildByName(t,e){return this.find(i=>i.name===t,e)}createOrUpdateChild(t,e,i){let r=this._getChildByName(t);return r?r.setAttributes(e):(r=bt.graphicService.creator[i](e),r.name=t,this.add(r)),r}clone(){return new KL(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return KL.NOWORK_ANIMATE_ATTR}release(t){t&&this.forEachChildren(e=>{e.release(t)}),super.release()}};$f.NOWORK_ANIMATE_ATTR=ar;function XD(n){return new $f(n)}class PPt extends $f{get offscreen(){return this.layerHandler.offscreen}get layerMode(){return this.layerHandler.type}get width(){return this.stage?this.stage.width:0}get height(){return this.stage?this.stage.height:0}get viewWidth(){return this.stage?this.stage.viewWidth:0}get viewHeight(){return this.stage?this.stage.viewHeight:0}get dirtyBound(){throw new Error("")}get dpr(){return this._dpr}constructor(t,e,i,r){var s;super({}),this.stage=t,this.global=e,this.window=i,this.main=r.main,this.layerHandler=r.layerHandler,this.layerHandler.init(this,i,{main:r.main,canvasId:r.canvasId,width:this.viewWidth,height:this.viewHeight,zIndex:(s=r.zIndex)!==null&&s!==void 0?s:0}),this.layer=this,this.subLayers=new Map,this.theme=new e0,this.background="rgba(0, 0, 0, 0)",this.afterDrawCbs=[]}combineSubLayer(t=!0){const e=Array.from(this.subLayers.values()).sort((i,r)=>i.zIndex-r.zIndex);this.layerHandler.merge(e.map(i=>(i.layer.subLayers.size&&i.layer.combineSubLayer(t),i.layer.getNativeHandler()))),t&&e.forEach(i=>{i.group&&(i.group.incremental=0)}),e.forEach(i=>{bt.layerService.releaseLayer(this.stage,i.layer)}),this.subLayers.clear()}getNativeHandler(){return this.layerHandler}setStage(t,e){super.setStage(t,this)}pick(t,e){throw new Error("")}tryRenderSecondaryLayer(t,e){this.layerHandler.secondaryHandlers&&this.layerHandler.secondaryHandlers.length&&this.layerHandler.secondaryHandlers.forEach(i=>{i.layer.renderCount=this.renderCount,i.layer.render(t,e)})}render(t,e){var i;this.layerHandler.render([this],{renderService:t.renderService,stage:this.stage,layer:this,viewBox:t.viewBox,transMatrix:t.transMatrix,background:(i=t.background)!==null&&i!==void 0?i:this.background,updateBounds:t.updateBounds},e),this.afterDrawCbs.forEach(r=>r(this)),this.tryRenderSecondaryLayer(t,e)}resize(t,e){this.layerHandler.resize(t,e)}resizeView(t,e){this.layerHandler.resizeView(t,e)}setDpr(t){this.layerHandler.setDpr(t)}afterDraw(t){this.afterDrawCbs.push(t)}startAnimate(t){throw new Error("")}setToFrame(t){throw new Error("")}prepare(t,e){}release(){super.release(),this.layerHandler.release(),this.subLayers&&this.subLayers.forEach(t=>{bt.layerService.releaseLayer(this.stage,t.layer)})}drawTo(t,e){var i;this.layerHandler.drawTo(t,[this],Object.assign({background:(i=e.background)!==null&&i!==void 0?i:this.background,renderService:e.renderService,viewBox:e.viewBox,transMatrix:e.transMatrix,stage:this.stage,layer:this},e)),this.afterDrawCbs.forEach(r=>r(this))}}const xQ=Symbol.for("TransformUtil"),wQ=Symbol.for("GraphicUtil"),KD=Symbol.for("LayerService"),AQ=Symbol.for("StaticLayerHandlerContribution"),EPt=Symbol.for("DynamicLayerHandlerContribution"),LPt=Symbol.for("VirtualLayerHandlerContribution");var Zm,IPt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},OPt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Jm=Zm=class{static GenerateLayerId(){return`${Zm.idprefix}_${Zm.prefix_count++}`}constructor(){this.layerMap=new Map,this.global=bt.global}tryInit(){this.inited||(this.staticLayerCountInEnv=this.global.getStaticCanvasCount(),this.dynamicLayerCountInEnv=this.global.getDynamicCanvasCount(),this.inited=!0)}getStageLayer(n){return this.layerMap.get(n)}getRecommendedLayerType(n){return n||(this.staticLayerCountInEnv!==0?"static":this.dynamicLayerCountInEnv!==0?"dynamic":"virtual")}getLayerHandler(n){let t;return t=n==="static"?Qt.get(AQ):n==="dynamic"?Qt.get(EPt):Qt.get(LPt),t}createLayer(n,t={main:!1}){var e;this.tryInit();let i=this.getRecommendedLayerType(t.layerMode);i=t.main||t.canvasId?"static":i;const r=this.getLayerHandler(i),s=new PPt(n,this.global,n.window,Object.assign(Object.assign({main:!1},t),{layerMode:i,canvasId:(e=t.canvasId)!==null&&e!==void 0?e:Zm.GenerateLayerId(),layerHandler:r})),o=this.layerMap.get(n)||[];return o.push(s),this.layerMap.set(n,o),this.staticLayerCountInEnv--,s}prepareStageLayer(n){let t;n.forEachChildren(e=>{const i=e.getNativeHandler();i.type==="virtual"?(i.mainHandler=t,t.secondaryHandlers.push(i)):(t=i,t.secondaryHandlers=[])})}releaseLayer(n,t){t.release();const e=this.layerMap.get(n)||[];this.layerMap.set(n,e.filter(i=>i!==t))}layerCount(n){return(this.layerMap.get(n)||[]).length}restLayerCount(n){return this.global.env==="browser"?10:0}releaseStage(n){this.layerMap.delete(n)}};Jm.idprefix="visactor_layer",Jm.prefix_count=0,Jm=Zm=IPt([It(),OPt("design:paramtypes",[])],Jm);const DPt=new te(n=>{n(OD).to(DL).inSingletonScope(),n(S1).to(NL),n(wQ).to($L).inSingletonScope(),n(xQ).to(VL).inSingletonScope(),n(KD).to(Jm).inSingletonScope()});function xc(n,t){return!(!n&&!t)}function df(n,t){let e;return e=V(n)?n.some(i=>i||i===void 0):!!n,e&&t>0}function wc(n,t,e){return e&&n*t>0}function qD(n,t,e,i,r){return r&&n*t>0&&e!==0&&i!==0}function qL(n,t){return n*t>0}function ZD(n,t,e,i){return n*t>0&&e!==0&&i!==0}function FPt(n,t,e,i,r,s,o,a){const l=e-n,h=i-t,d=o-r,u=a-s;let c=u*l-d*h;return c*c<$t?[]:(c=(d*(t-s)-u*(n-r))/c,[n+c*l,t+c*h])}function Jh(n,t,e,i,r,s,o){const a=n-e,l=t-i,h=(o?s:-s)/Math.sqrt(a*a+l*l),d=h*l,u=-h*a,c=n+d,g=t+u,p=e+d,f=i+u,m=(c+p)/2,v=(g+f)/2,_=p-c,b=f-g,y=_*_+b*b,C=r-s,S=c*f-p*g,w=(b<0?-1:1)*Math.sqrt(Math.max(0,C*C*y-S*S));let x=(S*b-_*w)/y,A=(-S*_-b*w)/y;const M=(S*b+_*w)/y,T=(-S*_+b*w)/y,R=x-m,B=A-v,E=M-m,k=T-v;return R*R+B*B>E*E+k*k&&(x=M,A=T),{cx:x,cy:A,x01:-d,y01:-u,x11:x*(r/C-1),y11:A*(r/C-1)}}function MQ(n,t,e,i,r){const s=Et(e-t),o=n.getParsedCornerRadius(),a=V(o),{outerDeltaAngle:l,innerDeltaAngle:h,outerStartAngle:d,outerEndAngle:u,innerEndAngle:c,innerStartAngle:g}=n.getParsePadAngle(t,e),p=a?o[0]:o,f=a?o[1]:o,m=a?o[2]:o,v=a?o[3]:o,_=Math.max(f,p),b=Math.max(m,v);let y=_,C=b;const S=r*me(d),w=r*ee(d),x=i*me(c),A=i*ee(c);let M,T,R,B;if((b>$t||_>$t)&&(M=r*me(u),T=r*ee(u),R=i*me(g),B=i*ee(g),s<Kt)){const E=FPt(S,w,R,B,M,T,x,A);if(E){const k=S-E[0],P=w-E[1],I=M-E[0],O=T-E[1],H=1/ee(wY((k*I+P*O)/(Rn(k*k+P*P)*Rn(I*I+O*O)))/2),z=Rn(E[0]*E[0]+E[1]*E[1]);C=we(b,(i-z)/(H-1)),y=we(_,(r-z)/(H+1))}}return{outerDeltaAngle:l,xors:S,yors:w,xirs:R,yirs:B,xore:M,yore:T,xire:x,yire:A,limitedOcr:y,limitedIcr:C,outerCornerRadiusStart:p,outerCornerRadiusEnd:f,maxOuterCornerRadius:_,maxInnerCornerRadius:b,outerStartAngle:d,outerEndAngle:u,innerDeltaAngle:h,innerEndAngle:c,innerStartAngle:g,innerCornerRadiusStart:v,innerCornerRadiusEnd:m}}function ZL(n,t,e,i,r,s,o){const{startAngle:a,endAngle:l}=n.getParsedAngle(),h=Et(l-a),d=l>a;let u=!1;if(r<s){const c=r;r=s,s=c}if(r<=$t)t.moveTo(e,i);else if(h>=Ft-$t)t.moveTo(e+r*me(a),i+r*ee(a)),t.arc(e,i,r,a,l,!d),s>$t&&(t.moveTo(e+s*me(l),i+s*ee(l)),t.arc(e,i,s,l,a,d));else{const{outerDeltaAngle:c,xors:g,yors:p,xirs:f,yirs:m,limitedOcr:v,outerCornerRadiusStart:_,outerCornerRadiusEnd:b,maxOuterCornerRadius:y,xore:C,yore:S,xire:w,yire:x,outerStartAngle:A,outerEndAngle:M,limitedIcr:T,innerDeltaAngle:R,innerEndAngle:B,innerStartAngle:E,innerCornerRadiusStart:k,innerCornerRadiusEnd:P,maxInnerCornerRadius:I}=MQ(n,a,l,s,r);if(c<.001)o&&(o[3]||o[1])&&t.moveTo(e+g,i+p),u=!0;else if(v>$t){const O=we(_,v),H=we(b,v),z=Jh(f,m,g,p,r,O,Number(d)),F=Jh(C,S,w,x,r,H,Number(d));v<y&&O===H?!o||o[0]?(t.moveTo(e+z.cx+z.x01,i+z.cy+z.y01),t.arc(e+z.cx,i+z.cy,v,zt(z.y01,z.x01),zt(F.y01,F.x01),!d)):t.moveTo(e+z.cx+v*me(zt(F.y01,F.x01)),i+z.cy+v*ee(zt(F.y01,F.x01))):!o||o[0]?(t.moveTo(e+z.cx+z.x01,i+z.cy+z.y01),O>0&&t.arc(e+z.cx,i+z.cy,O,zt(z.y01,z.x01),zt(z.y11,z.x11),!d),t.arc(e,i,r,zt(z.cy+z.y11,z.cx+z.x11),zt(F.cy+F.y11,F.cx+F.x11),!d),H>0&&t.arc(e+F.cx,i+F.cy,H,zt(F.y11,F.x11),zt(F.y01,F.x01),!d)):H>0?t.moveTo(e+F.cx+H*me(zt(F.y01,F.x01)),i+F.cy+H*ee(zt(F.y01,F.x01))):t.moveTo(e+C,i+r*ee(M))}else!o||o[0]?(t.moveTo(e+g,i+p),t.arc(e,i,r,A,M,!d)):t.moveTo(e+r*me(M),i+r*ee(M));if(!(s>$t)||R<.001)!o||o[1]?t.lineTo(e+w,i+x):t.moveTo(e+w,i+x),u=!0;else if(T>$t){const O=we(k,T),H=we(P,T),z=Jh(w,x,C,S,s,-H,Number(d)),F=Jh(g,p,f,m,s,-O,Number(d));if(!o||o[1]?t.lineTo(e+z.cx+z.x01,i+z.cy+z.y01):t.moveTo(e+z.cx+z.x01,i+z.cy+z.y01),T<I&&O===H){const j=zt(F.y01,F.x01);!o||o[2]?t.arc(e+z.cx,i+z.cy,T,zt(z.y01,z.x01),j,!d):t.moveTo(e+z.cx+me(j),i+z.cy+ee(j))}else!o||o[2]?(H>0&&t.arc(e+z.cx,i+z.cy,H,zt(z.y01,z.x01),zt(z.y11,z.x11),!d),t.arc(e,i,s,zt(z.cy+z.y11,z.cx+z.x11),zt(F.cy+F.y11,F.cx+F.x11),d),O>0&&t.arc(e+F.cx,i+F.cy,O,zt(F.y11,F.x11),zt(F.y01,F.x01),!d)):O>0?t.moveTo(e+F.cx+O*me(zt(F.y01,F.x01)),i+F.cy+O*ee(zt(F.y01,F.x01))):t.moveTo(e+f,i+m)}else!o||o[1]?t.lineTo(e+w,i+x):t.moveTo(e+w,i+x),!o||o[2]?t.arc(e,i,s,B,E,d):t.moveTo(e+s*me(E),i+s*ee(E))}return o?o[3]&&t.lineTo(e+r*me(a),i+r*ee(a)):t.closePath(),u}class ro{static GetCanvas(){try{return ro.canvas||(ro.canvas=bt.global.createCanvas({})),ro.canvas}catch{return null}}static GetCtx(){if(!ro.ctx){const t=ro.GetCanvas();ro.ctx=t.getContext("2d")}return ro.ctx}}class Ru extends IY{static getInstance(){return Ru._instance||(Ru._instance=new Ru),Ru._instance}constructor(t=[],e=100){super(),this.cacheParams={CLEAN_THRESHOLD:100,L_TIME:1e3},this.dataMap=new Map;const i=ro.GetCanvas(),r=ro.GetCtx();if(i.width=e,i.height=1,!r)return;if(r.translate(0,0),!r)throw new Error("ctx");const s=r.createLinearGradient(0,0,e,0);t.forEach(o=>{s.addColorStop(o[0],o[1])}),r.fillStyle=s,r.fillRect(0,0,e,1),this.rgbaSet=r.getImageData(0,0,e,1).data}getColor(t){const e=this.rgbaSet.slice(4*t,4*t+4);return`rgba(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]/255})`}GetOrCreate(t,e,i,r,s=[],o=100){let a=`${t}${e}${i}${r}`;s.forEach(h=>a+=h.join()),a+=o;let l=this.dataMap.get(a);return l||(l={data:new Ru(s,o),timestamp:[]},this.addLimitedTimestamp(l,Date.now(),{}),this.dataMap.set(a,l)),this.clearCache(this.dataMap,this.cacheParams),l.data}}class mr{static GetSize(t){for(let e=0;e<mr.ImageSize.length;e++)if(mr.ImageSize[e]>=t)return mr.ImageSize[e];return t}static Get(t,e,i,r,s,o,a){const l=mr.GenKey(t,e,i,r,s),h=mr.cache[l];if(!h||h.length===0)return null;for(let d=0;d<h.length;d++)if(h[d].width>=o&&h[d].height>=a)return h[d].pattern;return null}static Set(t,e,i,r,s,o,a,l){const h=mr.GenKey(t,e,i,r,s);mr.cache[h]?mr.cache[h].push({width:a,height:l,pattern:o}):mr.cache[h]=[{width:a,height:l,pattern:o}]}static GenKey(t,e,i,r,s){return`${e},${i},${r},${s},${t.join()}`}}mr.cache={},mr.ImageSize=[20,40,80,160,320,640,1280,2560];function HPt(n,t,e,i){const{stops:r,startAngle:s,endAngle:o}=i;for(;e<0;)e+=Ft;for(;e>Ft;)e-=Ft;if(e<s||e>o)return r[0].color;let a,l,h=(e-s)/(o-s);for(let d=0;d<r.length;d++)if(r[d].offset>=h){a=r[d-1],l=r[d];break}return h=(h-a.offset)/(l.offset-a.offset),Ep(a.color,l.color,h,!1)}function zPt(n,t,e,i,r,s,o,a,l){const h=Math.floor(180*r/Math.PI),d=ro.GetCanvas(),u=ro.GetCtx();if(!u)return null;const c=mr.GetSize(a),g=mr.GetSize(l);let p=mr.Get(t,e,i,s,o,c,g);if(p)return p;const f=Math.sqrt(Math.max(Math.max(Math.pow(e,2)+Math.pow(i,2),Math.pow(c-e,2)+Math.pow(i,2)),Math.max(Math.pow(c-e,2)+Math.pow(g-i,2),Math.pow(e,2)+Math.pow(g-i,2)))),m=h+1,v=r/Math.max(1,m-1),_=Ru.getInstance().GetOrCreate(e,i,c,g,t,m),b=2*Math.PI*f/360;d.width=c,d.height=g,u.setTransform(1,0,0,1,0,0),u.clearRect(0,0,c,g),u.translate(e,i),u.rotate(s);for(let C=0,S=m-1;C<S&&!(s+C*v>o);C++){const w=_.getColor(C);u.beginPath(),u.rotate(v),u.moveTo(0,0),u.lineTo(f,-2*b),u.lineTo(f,0),u.fillStyle=w,u.closePath(),u.fill()}const y=u.getImageData(0,0,c,g);return d.width=y.width,d.height=y.height,u.putImageData(y,0,0),p=n.createPattern(d,"no-repeat"),p&&mr.Set(t,e,i,s,o,p,c,g),p}const JL=Symbol.for("ArcRenderContribution"),QL=Symbol.for("AreaRenderContribution"),t2=Symbol.for("CircleRenderContribution"),TQ=Symbol.for("GroupRenderContribution"),e2=Symbol.for("ImageRenderContribution"),i2=Symbol.for("PathRenderContribution"),n2=Symbol.for("PolygonRenderContribution"),Qm=Symbol.for("RectRenderContribution"),r2=Symbol.for("SymbolRenderContribution"),s2=Symbol.for("TextRenderContribution"),JD=Symbol.for("InteractiveSubRenderContribution");function i0(n,t){return n==="end"||n==="right"?-t:n==="center"?-t/2:0}function R1(n,t,e,i=0){return n==="middle"?-t/2:n==="top"?0:n==="bottom"?i-t:n&&n!=="alphabetic"?0:(e||(e=t),-(t-e)/2-.79*e)}function WPt(n){const t={},e=i=>/^\d+(\.\d+)?$/.test(`${i}`)?`${i}px`:`${i}`;return["textAlign","fontFamily","fontVariant","fontStyle","fontWeight"].forEach(i=>{n[i]&&(t[Rz(i)]=n[i])}),["fontSize","lineHeight"].forEach(i=>{const r=Rz(i);D(n[i])||(t[r]=e(n[i]))}),L(n.maxLineWidth)&&(t["max-width"]=e(n.maxLineWidth)),n.underline?t["text-decoration"]="underline":n.lineThrough&&(t["text-decoration"]="line-through"),n.fill&&yt(n.fill)&&(t.color=n.fill),t}function QD(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function jPt(n,t,e){const i=Math.sin(e),r=Math.cos(e),s=t[4],o=t[5],a=t[6],l=t[7],h=t[8],d=t[9],u=t[10],c=t[11];return t!==n&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[4]=s*r+h*i,n[5]=o*r+d*i,n[6]=a*r+u*i,n[7]=l*r+c*i,n[8]=h*r-s*i,n[9]=d*r-o*i,n[10]=u*r-a*i,n[11]=c*r-l*i,n}function NPt(n,t,e){const i=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],l=t[3],h=t[8],d=t[9],u=t[10],c=t[11];return t!==n&&(n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=s*r-h*i,n[1]=o*r-d*i,n[2]=a*r-u*i,n[3]=l*r-c*i,n[8]=s*i+h*r,n[9]=o*i+d*r,n[10]=a*i+u*r,n[11]=l*i+c*r,n}function $Pt(n,t,e){const i=Math.sin(e),r=Math.cos(e),s=t[0],o=t[1],a=t[2],l=t[3],h=t[4],d=t[5],u=t[6],c=t[7];return t!==n&&(n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]),n[0]=s*r+h*i,n[1]=o*r+d*i,n[2]=a*r+u*i,n[3]=l*r+c*i,n[4]=h*r-s*i,n[5]=d*r-o*i,n[6]=u*r-a*i,n[7]=c*r-l*i,n}function Cm(n,t,e){const i=e[0],r=e[1],s=e[2];let o,a,l,h,d,u,c,g,p,f,m,v;return t===n?(n[12]=t[0]*i+t[4]*r+t[8]*s+t[12],n[13]=t[1]*i+t[5]*r+t[9]*s+t[13],n[14]=t[2]*i+t[6]*r+t[10]*s+t[14],n[15]=t[3]*i+t[7]*r+t[11]*s+t[15]):(o=t[0],a=t[1],l=t[2],h=t[3],d=t[4],u=t[5],c=t[6],g=t[7],p=t[8],f=t[9],m=t[10],v=t[11],n[0]=o,n[1]=a,n[2]=l,n[3]=h,n[4]=d,n[5]=u,n[6]=c,n[7]=g,n[8]=p,n[9]=f,n[10]=m,n[11]=v,n[12]=o*i+d*r+p*s+t[12],n[13]=a*i+u*r+f*s+t[13],n[14]=l*i+c*r+m*s+t[14],n[15]=h*i+g*r+v*s+t[15]),n}function o2(n,t){n[0]=t.a,n[1]=t.b,n[2]=0,n[3]=0,n[4]=t.c,n[5]=t.d,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=t.e,n[13]=t.f,n[14]=0,n[15]=1}function VPt(n,t,e){const i=e[0],r=e[1],s=e[2];return n[0]=t[0]*i,n[1]=t[1]*i,n[2]=t[2]*i,n[3]=t[3]*i,n[4]=t[4]*r,n[5]=t[5]*r,n[6]=t[6]*r,n[7]=t[7]*r,n[8]=t[8]*s,n[9]=t[9]*s,n[10]=t[10]*s,n[11]=t[11]*s,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}function Ac(n,t,e){const i=t[0],r=t[1],s=t[2],o=t[3],a=t[4],l=t[5],h=t[6],d=t[7],u=t[8],c=t[9],g=t[10],p=t[11],f=t[12],m=t[13],v=t[14],_=t[15];let b=e[0],y=e[1],C=e[2],S=e[3];return n[0]=b*i+y*a+C*u+S*f,n[1]=b*r+y*l+C*c+S*m,n[2]=b*s+y*h+C*g+S*v,n[3]=b*o+y*d+C*p+S*_,b=e[4],y=e[5],C=e[6],S=e[7],n[4]=b*i+y*a+C*u+S*f,n[5]=b*r+y*l+C*c+S*m,n[6]=b*s+y*h+C*g+S*v,n[7]=b*o+y*d+C*p+S*_,b=e[8],y=e[9],C=e[10],S=e[11],n[8]=b*i+y*a+C*u+S*f,n[9]=b*r+y*l+C*c+S*m,n[10]=b*s+y*h+C*g+S*v,n[11]=b*o+y*d+C*p+S*_,b=e[12],y=e[13],C=e[14],S=e[15],n[12]=b*i+y*a+C*u+S*f,n[13]=b*r+y*l+C*c+S*m,n[14]=b*s+y*h+C*g+S*v,n[15]=b*o+y*d+C*p+S*_,n}function GPt(n,t,e,i){let r,s,o,a,l,h,d,u,c,g;const p=t[0],f=t[1],m=t[2],v=i[0],_=i[1],b=i[2],y=e[0],C=e[1],S=e[2];return Math.abs(p-y)<$t&&Math.abs(f-C)<$t&&Math.abs(m-S)<$t?QD(n):(d=p-y,u=f-C,c=m-S,g=1/Math.hypot(d,u,c),d*=g,u*=g,c*=g,r=_*c-b*u,s=b*d-v*c,o=v*u-_*d,g=Math.hypot(r,s,o),g?(g=1/g,r*=g,s*=g,o*=g):(r=0,s=0,o=0),a=u*o-c*s,l=c*r-d*o,h=d*s-u*r,g=Math.hypot(a,l,h),g?(g=1/g,a*=g,l*=g,h*=g):(a=0,l=0,h=0),n[0]=r,n[1]=a,n[2]=d,n[3]=0,n[4]=s,n[5]=l,n[6]=u,n[7]=0,n[8]=o,n[9]=h,n[10]=c,n[11]=0,n[12]=-(r*p+s*f+o*m),n[13]=-(a*p+l*f+h*m),n[14]=-(d*p+u*f+c*m),n[15]=1,n)}function UPt(n,t,e,i,r,s,o){const a=1/(t-e),l=1/(i-r),h=1/(s-o);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*l,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(t+e)*a,n[13]=(r+i)*l,n[14]=(o+s)*h,n[15]=1,n}function As(n,t,e){const i=t[0],r=t[1],s=t[2];let o=e[3]*i+e[7]*r+e[11]*s+e[15];return o=o||1,n[0]=(e[0]*i+e[4]*r+e[8]*s+e[12])/o,n[1]=(e[1]*i+e[5]*r+e[9]*s+e[13])/o,n[2]=(e[2]*i+e[6]*r+e[10]*s+e[14])/o,n}function MG(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}class YPt{constructor(){this.pools=[]}allocate(t,e,i,r,s,o){if(!this.pools.length)return new Pe(t,e,i,r,s,o);const a=this.pools.pop();return a.a=t,a.b=e,a.c=i,a.d=r,a.e=s,a.f=o,a}allocateByObj(t){if(!this.pools.length)return new Pe(t.a,t.b,t.c,t.d,t.e,t.f);const e=this.pools.pop();return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e.e=t.e,e.f=t.f,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}class tF{constructor(){this.pools=[]}static identity(t){return QD(t)}allocate(){if(!this.pools.length)return MG();const t=this.pools.pop();return tF.identity(t),t}allocateByObj(t){let e;e=this.pools.length?this.pools.pop():MG();for(let i=0;i<e.length;i++)e[i]=t[i];return e}free(t){t&&this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const rs=new YPt,ki=new tF;var XPt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},KPt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},qPt=function(n,t){return function(e,i){t(e,i,n)}};function kQ(n,t,e){var i;const{x:r=e.x,y:s=e.y,z:o=e.z,dx:a=e.dx,dy:l=e.dy,dz:h=e.dz,scaleX:d=e.scaleX,scaleY:u=e.scaleY,scaleZ:c=e.scaleZ,alpha:g=e.alpha,beta:p=e.beta,angle:f=e.angle,anchor3d:m=t.attribute.anchor,anchor:v}=t.attribute,_=[0,0,0];if(m){if(typeof m[0]=="string"){const b=parseFloat(m[0])/100,y=t.AABBBounds;_[0]=y.x1+(y.x2-y.x1)*b}else _[0]=m[0];if(typeof m[1]=="string"){const b=parseFloat(m[1])/100,y=t.AABBBounds;_[1]=y.x1+(y.x2-y.x1)*b}else _[1]=m[1];_[2]=(i=m[2])!==null&&i!==void 0?i:0}if(QD(n),Cm(n,n,[r+a,s+l,o+h]),Cm(n,n,[_[0],_[1],_[2]]),jPt(n,n,p),NPt(n,n,g),Cm(n,n,[-_[0],-_[1],_[2]]),VPt(n,n,[d,u,c]),f){const b=ki.allocate(),y=[0,0];if(v){if(typeof m[0]=="string"){const C=parseFloat(m[0])/100,S=t.AABBBounds;y[0]=S.x1+(S.x2-S.x1)*C}else y[0]=m[0];if(typeof m[1]=="string"){const C=parseFloat(m[1])/100,S=t.AABBBounds;y[1]=S.x1+(S.x2-S.x1)*C}else y[1]=m[1]}Cm(b,b,[y[0],y[1],0]),$Pt(b,b,f),Cm(b,b,[-y[0],-y[1],0]),Ac(n,n,b)}}function ZPt(n){const{alpha:t,beta:e}=n.attribute;return t||e}let a2=class{constructor(n){this.creator=n,this.hooks={onAttributeUpdate:new Zr(["graphic"]),onSetStage:new Zr(["graphic","stage"]),onRemove:new Zr(["graphic"]),onRelease:new Zr(["graphic"]),onAddIncremental:new Zr(["graphic","group","stage"]),onClearIncremental:new Zr(["graphic","group","stage"]),beforeUpdateAABBBounds:new Zr(["graphic","stage","willUpdate","aabbBounds"]),afterUpdateAABBBounds:new Zr(["graphic","stage","aabbBounds","globalAABBBounds","selfChange"]),clearAABBBounds:new Zr(["graphic","stage","aabbBounds"])},this.tempAABBBounds1=new ie,this.tempAABBBounds2=new ie}onAttributeUpdate(n){this.hooks.onAttributeUpdate.taps.length&&this.hooks.onAttributeUpdate.call(n)}onSetStage(n,t){this.hooks.onSetStage.taps.length&&this.hooks.onSetStage.call(n,t)}onRemove(n){this.hooks.onRemove.taps.length&&this.hooks.onRemove.call(n)}onRelease(n){this.hooks.onRelease.taps.length&&this.hooks.onRelease.call(n)}onAddIncremental(n,t,e){this.hooks.onAddIncremental.taps.length&&this.hooks.onAddIncremental.call(n,t,e)}onClearIncremental(n,t){this.hooks.onClearIncremental.taps.length&&this.hooks.onClearIncremental.call(n,t)}beforeUpdateAABBBounds(n,t,e,i){this.hooks.beforeUpdateAABBBounds.taps.length&&this.hooks.beforeUpdateAABBBounds.call(n,t,e,i)}afterUpdateAABBBounds(n,t,e,i,r){this.hooks.afterUpdateAABBBounds.taps.length&&this.hooks.afterUpdateAABBBounds.call(n,t,e,i,r)}clearAABBBounds(n,t,e){this.hooks.clearAABBBounds.taps.length&&this.hooks.clearAABBBounds.call(n,t,e)}updatePathProxyAABBBounds(n,t){const e=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;if(!e)return!1;const i=new DD(n);return ih(e.commandList,i,0,0),!0}updateHTMLTextAABBBounds(n,t,e,i){const{textAlign:r,textBaseline:s}=n;if(n.forceBoundsHeight!=null){const o=J(n.forceBoundsHeight)?n.forceBoundsHeight:n.forceBoundsHeight(),a=R1(s,o,o);e.set(e.x1,a,e.x2,a+o)}if(n.forceBoundsWidth!=null){const o=J(n.forceBoundsWidth)?n.forceBoundsWidth:n.forceBoundsWidth(),a=i0(r,o);e.set(a,e.y1,a+o,e.y2)}}combindShadowAABBBounds(n,t){if(t&&t.shadowRoot){const e=t.shadowRoot.AABBBounds;n.union(e)}}transformAABBBounds(n,t,e,i,r){if(!t.empty()){const{scaleX:a=e.scaleX,scaleY:l=e.scaleY,stroke:h=e.stroke,shadowBlur:d=e.shadowBlur,lineWidth:u=e.lineWidth,pickStrokeBuffer:c=e.pickStrokeBuffer,strokeBoundsBuffer:g=e.strokeBoundsBuffer}=n,p=this.tempAABBBounds1,f=this.tempAABBBounds2;if(h&&u){const m=(u+c)/Math.abs(a+l);k1(p,m,i,g),t.union(p),p.setValue(f.x1,f.y1,f.x2,f.y2)}if(d){const{shadowOffsetX:m=e.shadowOffsetX,shadowOffsetY:v=e.shadowOffsetY}=n,_=d/Math.abs(a+l)*2;k1(p,_,!1,g+1),p.translate(m,v),t.union(p)}}if(this.combindShadowAABBBounds(t,r),t.empty())return;let s=!0;const o=r.transMatrix;r&&r.isContainer&&(s=!(o.a===1&&o.b===0&&o.c===0&&o.d===1&&o.e===0&&o.f===0)),s&&K0(t,t,o)}validCheck(n,t,e,i){if(!i||n.forceBoundsHeight!=null||n.forceBoundsWidth!=null||i.shadowRoot||i.isContainer)return!0;const{visible:r=t.visible}=n;return!(!i.valid||!r)||(e.empty()||(i.parent&&e.transformWithMatrix(i.parent.globalTransMatrix),bt.graphicService.clearAABBBounds(i,i.stage,e),e.clear()),!1)}updateTempAABBBounds(n){const t=this.tempAABBBounds1,e=this.tempAABBBounds2;return t.setValue(n.x1,n.y1,n.x2,n.y2),e.setValue(n.x1,n.y1,n.x2,n.y2),{tb1:t,tb2:e}}};a2=XPt([It(),qPt(0,ue(CQ)),KPt("design:paramtypes",[Object])],a2);const pb=(n,t,e)=>{const{outerBorder:i,shadowBlur:r=t.shadowBlur}=n;if(i){const s=t.outerBorder,{distance:o=s.distance,lineWidth:a=s.lineWidth}=i;e.expand(o+(r+a)/2)}return e},TG=["radius","startAngle","endAngle",...$s];class n0 extends kn{constructor(t={radius:1}){super(t),this.type="circle",this.numberType=$M}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,radius:i}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)}getGraphicTheme(){return ne(this).circle}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateCircleAABBBoundsImprecise(t,e,i):this.updateCircleAABBBoundsAccurate(t,e,i));const{tb1:s,tb2:o}=bt.graphicService.updateTempAABBBounds(i);return pb(t,e,s),i.union(s),s.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,bt.graphicService.transformAABBBounds(t,i,e,!1,this),i}updateCircleAABBBoundsImprecise(t,e,i){const{radius:r=e.radius}=t;return i.set(-r,-r,r,r),i}updateCircleAABBBoundsAccurate(t,e,i){const{startAngle:r=e.startAngle,endAngle:s=e.endAngle,radius:o=e.radius}=t;return s-r>Ft-$t?i.set(-o,-o,o,o):UL(r,s,o,i),i}needUpdateTags(t){return super.needUpdateTags(t,TG)}needUpdateTag(t){return super.needUpdateTag(t,TG)}toCustomPath(){var t,e,i;const r=this.attribute,s=(t=r.radius)!==null&&t!==void 0?t:this.getDefaultAttribute("radius"),o=(e=r.startAngle)!==null&&e!==void 0?e:this.getDefaultAttribute("startAngle"),a=(i=r.endAngle)!==null&&i!==void 0?i:this.getDefaultAttribute("endAngle"),l=new Cn;return l.arc(0,0,s,o,a),l}clone(){return new n0(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return n0.NOWORK_ANIMATE_ATTR}}n0.NOWORK_ANIMATE_ATTR=ar;function JPt(n){return new n0(n)}class kG{constructor(t,e,i){this.fontFamily=t,this.textOptions=e,this.textMeasure=i}LayoutBBox(t,e,i,r){if(t.xOffset=e==="left"||e==="start"?0:e==="center"?t.width/-2:e==="right"||e==="end"?-t.width:0,i==="top")t.yOffset=0;else if(i==="middle")t.yOffset=t.height/-2;else if(i==="alphabetic"){let s=.79;if(r.length===1){const o=r[0];s=o.ascent/(o.ascent+o.descent)}t.yOffset=t.height*-s}else t.yOffset=-t.height;return t}GetLayoutByLines(t,e,i,r,s="",o,a){const{lineWidth:l,suffixPosition:h="end",measureMode:d=Qu.actualBounding,keepCenterInLine:u=!1}=a??{};t=t.map(f=>f.toString());const c=[],g=[0,0];if(typeof l=="number"&&l!==1/0){let f;for(let m=0,v=t.length;m<v;m++){const _=this.textMeasure.measureTextPixelADscentAndWidth(t[m],this.textOptions,d);let b=t[m].toString();if(_.width>l){const y=this.textMeasure.clipTextWithSuffix(t[m],this.textOptions,l,s,o,h);b=y.str,f=y.width}else f=_.width;c.push({str:b,width:f,ascent:_.ascent,descent:_.descent,keepCenterInLine:u})}g[0]=l}else{let f,m,v=0;for(let _=0,b=t.length;_<b;_++){m=t[_];const y=this.textMeasure.measureTextPixelADscentAndWidth(t[_],this.textOptions,d);f=y.width,v=Math.max(v,f),c.push({str:m,width:f,ascent:y.ascent,descent:y.descent,keepCenterInLine:u})}g[0]=v}g[1]=c.length*r,g[0]=c.reduce((f,m)=>Math.max(f,m.width),0);const p={xOffset:0,yOffset:0,width:g[0],height:g[1]};return this.LayoutBBox(p,e,i,c),this.layoutWithBBox(p,c,e,i,r)}layoutWithBBox(t,e,i,r,s){const o=[0,0],a=e.length*s;r==="top"||(r==="middle"?o[1]=(t.height-a)/2:r==="bottom"&&(o[1]=t.height-a));for(let l=0;l<e.length;l++)this.lineOffset(t,e[l],i,r,s,o);return{bbox:t,lines:e,fontFamily:this.fontFamily,fontSize:this.textOptions.fontSize,fontWeight:this.textOptions.fontWeight,lineHeight:s,textAlign:i,textBaseline:r}}lineOffset(t,e,i,r,s,o){if(i==="left"||i==="start"?e.leftOffset=0:i==="center"?e.leftOffset=(t.width-e.width)/2:i!=="right"&&i!=="end"||(e.leftOffset=t.width-e.width),e.topOffset=s/2+(e.ascent-e.descent)/2+o[1],!e.keepCenterInLine){const l=e.ascent+e.descent+0;if(l<s-0&&(r==="bottom"?e.topOffset+=(s-l)/2:r==="top"&&(e.topOffset-=(s-l)/2)),r==="alphabetic"){const h=s/(e.ascent+e.descent);e.topOffset=s/2+(e.ascent-e.descent)/2*h+o[1]}}return o[1]+=s,e}}const RG=["text","maxLineWidth","maxWidth","textAlign","textBaseline","heightLimit","lineClamp","fontSize","fontFamily","fontWeight","ellipsis","lineHeight","direction","wordBreak","heightLimit","lineClamp",...$s];let LC=class Lh extends kn{get font(){const t=this.getGraphicTheme();return this._font||(this._font=pc(this.attribute,t)),this._font}get clipedText(){var t;const e=this.attribute,i=this.getGraphicTheme(),r=this.getMaxWidth(i);return Number.isFinite(r)?(this.tryUpdateAABBBounds(),this.cache.clipedText):((t=e.text)!==null&&t!==void 0?t:i.text).toString()}get clipedWidth(){return this.tryUpdateAABBBounds(),this.cache.clipedWidth}get cliped(){var t,e;const i=this.getGraphicTheme(),r=this.attribute,s=this.getMaxWidth(i);if(!Number.isFinite(s))return!1;const{text:o}=this.attribute;if(this.tryUpdateAABBBounds(),(e=(t=this.cache)===null||t===void 0?void 0:t.layoutData)===null||e===void 0?void 0:e.lines){let a="";return this.cache.layoutData.lines.forEach(l=>{a+=l.str}),(Array.isArray(o)?o.join(""):o)!==a}return r.direction==="vertical"&&this.cache.verticalList&&this.cache.verticalList[0]?this.cache.verticalList[0].map(a=>a.text).join("")!==r.text.toString():this.clipedText!=null&&this.clipedText!==r.text.toString()}get multilineLayout(){return this.tryUpdateAABBBounds(),this.cache.layoutData}get isMultiLine(){return Array.isArray(this.attribute.text)||this.attribute.whiteSpace==="normal"}constructor(t={text:"",fontSize:16}){super(t),this.type="text",this.numberType=XM,this.cache={}}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{text:t}=this.attribute;return V(t)?!t.every(e=>e==null||e===""):t!=null&&t!==""}getGraphicTheme(){return ne(this).text}doUpdateOBBBounds(){const t=this.getGraphicTheme();this._OBBBounds.clear();const e=this.attribute,{angle:i=t.angle}=e;if(!i){const h=this.AABBBounds;return this._OBBBounds.setValue(h.x1,h.y1,h.x2,h.y2),this._OBBBounds}this.obbText||(this.obbText=new Lh({})),this.obbText.setAttributes(Object.assign(Object.assign({},e),{angle:0}));const r=this.obbText.AABBBounds,{x:s,y:o}=e,a={x:(r.x1+r.x2)/2,y:(r.y1+r.y2)/2},l=uo(a,i,{x:s,y:o});return this._OBBBounds.copy(r),this._OBBBounds.translate(l.x-a.x,l.y-a.y),this._OBBBounds.angle=i,this._OBBBounds}updateAABBBounds(t,e,i){const{text:r=e.text}=this.attribute;Array.isArray(r)?this.updateMultilineAABBBounds(r):this.updateSingallineAABBBounds(r);const{tb1:s}=bt.graphicService.updateTempAABBBounds(i),{scaleX:o=e.scaleX,scaleY:a=e.scaleY,shadowBlur:l=e.shadowBlur,strokeBoundsBuffer:h=e.strokeBoundsBuffer}=t;if(l){const d=l/Math.abs(o+a);k1(s,d,!0,h),i.union(s)}return bt.graphicService.combindShadowAABBBounds(i,this),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||bt.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,K0(i,i,this.transMatrix),i}updateSingallineAABBBounds(t){this.updateMultilineAABBBounds([t]);const e=this.cache.layoutData;if(e&&e.lines&&e.lines.length){const i=e.lines[0];this.cache.clipedText=i.str,this.cache.clipedWidth=i.width}return this._AABBBounds}updateMultilineAABBBounds(t){const e=this.getGraphicTheme(),{direction:i=e.direction,underlineOffset:r=e.underlineOffset}=this.attribute,s=i==="horizontal"?this.updateHorizontalMultilineAABBBounds(t):this.updateVerticalMultilineAABBBounds(t);return i==="horizontal"&&r&&this._AABBBounds.add(this._AABBBounds.x1,this._AABBBounds.y2+r),s}guessLineHeightBuf(t){return t?.1*t:0}updateHorizontalMultilineAABBBounds(t){var e;const i=this.getGraphicTheme(),r=this.attribute,{fontFamily:s=i.fontFamily,textAlign:o=i.textAlign,textBaseline:a=i.textBaseline,fontSize:l=i.fontSize,fontWeight:h=i.fontWeight,ellipsis:d=i.ellipsis,maxLineWidth:u,stroke:c=i.stroke,wrap:g=i.wrap,measureMode:p=i.measureMode,lineWidth:f=i.lineWidth,whiteSpace:m=i.whiteSpace,suffixPosition:v=i.suffixPosition,ignoreBuf:_=i.ignoreBuf,keepCenterInLine:b=i.keepCenterInLine}=r,y=_?0:this.guessLineHeightBuf(l),C=this.getLineHeight(r,i,y);if(m==="normal"||g)return this.updateWrapAABBBounds(t);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const A=this.cache.layoutData.bbox;return this._AABBBounds.set(A.xOffset,A.yOffset,A.xOffset+A.width,A.yOffset+A.height),c&&this._AABBBounds.expand(f/2),this._AABBBounds}const S=bt.graphicUtil.textMeasure,w=new kG(s,{fontSize:l,fontWeight:h,fontFamily:s,lineHeight:C},S).GetLayoutByLines(t,o,a,C,d===!0?i.ellipsis:d||void 0,!1,{lineWidth:u,suffixPosition:v,measureMode:p,keepCenterInLine:b}),{bbox:x}=w;return this.cache.layoutData=w,this.clearUpdateShapeTag(),this._AABBBounds.set(x.xOffset,x.yOffset,x.xOffset+x.width,x.yOffset+x.height),c&&this._AABBBounds.expand(f/2),this._AABBBounds}updateWrapAABBBounds(t){var e,i,r;const s=this.getGraphicTheme(),{fontFamily:o=s.fontFamily,textAlign:a=s.textAlign,textBaseline:l=s.textBaseline,fontSize:h=s.fontSize,ellipsis:d=s.ellipsis,maxLineWidth:u,stroke:c=s.stroke,lineWidth:g=s.lineWidth,wordBreak:p=s.wordBreak,fontWeight:f=s.fontWeight,ignoreBuf:m=s.ignoreBuf,measureMode:v=s.measureMode,suffixPosition:_=s.suffixPosition,heightLimit:b=0,lineClamp:y,keepCenterInLine:C=s.keepCenterInLine}=this.attribute,S=m?0:this.guessLineHeightBuf(h),w=this.getLineHeight(this.attribute,s,S);if(!this.shouldUpdateShape()&&(!((e=this.cache)===null||e===void 0)&&e.layoutData)){const I=this.cache.layoutData.bbox;return this._AABBBounds.set(I.xOffset,I.yOffset,I.xOffset+I.width,I.yOffset+I.height),c&&this._AABBBounds.expand(g/2),this._AABBBounds}const x=bt.graphicUtil.textMeasure,A={fontSize:h,fontWeight:f,fontFamily:o,lineHeight:w},M=new kG(o,A,x),T=V(t)?t.map(I=>I.toString()):[t.toString()],R=[],B=[0,0];let E=1/0;if(b>0&&(E=Math.max(Math.floor(b/w),1)),y&&(E=Math.min(E,y)),typeof u=="number"&&u!==1/0){if(u>0)for(let O=0;O<T.length;O++){const H=T[O];let z=!0;if(O===E-1){const Y=x.clipTextWithSuffix(H,A,u,d,!1,_,O!==T.length-1),G=x.measureTextPixelADscentAndWidth(Y.str,A,v);R.push({str:Y.str,width:Y.width,ascent:G.ascent,descent:G.descent,keepCenterInLine:C});break}const F=x.clipText(H,A,u,p!=="break-all",p==="keep-all");if(H!==""&&F.str===""||F.wordBreaked){if(d){const Y=x.clipTextWithSuffix(H,A,u,d,!1,_);F.str=(i=Y.str)!==null&&i!==void 0?i:"",F.width=(r=Y.width)!==null&&r!==void 0?r:0}else F.str="",F.width=0;z=!1}const j=x.measureTextPixelADscentAndWidth(F.str,A,v);R.push({str:F.str,width:F.width,ascent:j.ascent,descent:j.descent,keepCenterInLine:C});let $=F.str.length;if(!F.wordBreaked||H!==""&&F.str===""||(z=!0,$=F.wordBreaked),F.str.length!==H.length){if(z){let Y=H.substring($);p==="keep-all"&&(Y=Y.replace(/^\s+/g,"")),T.splice(O+1,0,Y)}}}let I=0;R.forEach(O=>{I=Math.max(I,O.width)}),B[0]=I}else{let I,O,H=0;for(let z=0,F=T.length;z<F;z++){if(z===E-1){const $=x.clipTextWithSuffix(T[z],A,u,d,!1,_),Y=x.measureTextPixelADscentAndWidth($.str,A,v);R.push({str:$.str,width:$.width,ascent:Y.ascent,descent:Y.descent,keepCenterInLine:C}),H=Math.max(H,$.width);break}O=T[z],I=x.measureTextWidth(O,A),H=Math.max(H,I);const j=x.measureTextPixelADscentAndWidth(O,A,v);R.push({str:O,width:I,ascent:j.ascent,descent:j.descent,keepCenterInLine:C})}B[0]=H}B[1]=R.length*w;const k={xOffset:0,yOffset:0,width:B[0],height:B[1]};M.LayoutBBox(k,a,l,R);const P=M.layoutWithBBox(k,R,a,l,w);return this.cache.layoutData=P,this.clearUpdateShapeTag(),this._AABBBounds.set(k.xOffset,k.yOffset,k.xOffset+k.width,k.yOffset+k.height),c&&this._AABBBounds.expand(g/2),this._AABBBounds}updateVerticalMultilineAABBBounds(t){var e,i;const r=this.getGraphicTheme(),s=bt.graphicUtil.textMeasure;let o;const a=this.attribute,{maxLineWidth:l=r.maxLineWidth,ellipsis:h=r.ellipsis,fontFamily:d=r.fontFamily,fontSize:u=r.fontSize,fontWeight:c=r.fontWeight,stroke:g=r.stroke,lineWidth:p=r.lineWidth,verticalMode:f=r.verticalMode,suffixPosition:m=r.suffixPosition}=a,v=this.getLineHeight(a,r,0);let{textAlign:_=r.textAlign,textBaseline:b=r.textBaseline}=a;if(!f){const x=_;_=(e=Lh.baselineMapAlign[b])!==null&&e!==void 0?e:"left",b=(i=Lh.alignMapBaseline[x])!==null&&i!==void 0?i:"top"}if(o=0,!this.shouldUpdateShape()&&this.cache){this.cache.verticalList.forEach(T=>{const R=T.reduce((B,E)=>B+E.width,0);o=ti(R,o)});const x=i0(_,o),A=this.cache.verticalList.length*v,M=R1(b,A,u);return this._AABBBounds.set(M,x,M+A,x+o),g&&this._AABBBounds.expand(p/2),this._AABBBounds}const y=t.map(x=>wPt(x.toString()));y.forEach((x,A)=>{if(Number.isFinite(l))if(h){const M=h===!0?r.ellipsis:h,T=s.clipTextWithSuffixVertical(x,{fontSize:u,fontWeight:c,fontFamily:d},l,M,!1,m);y[A]=T.verticalList,o=T.width}else{const M=s.clipTextVertical(x,{fontSize:u,fontWeight:c,fontFamily:d},l,!1);y[A]=M.verticalList,o=M.width}else o=0,x.forEach(M=>{const T=M.direction===Lp.HORIZONTAL?u:s.measureTextWidth(M.text,{fontSize:u,fontWeight:c,fontFamily:d});o+=T,M.width=T})}),this.cache.verticalList=y,this.clearUpdateShapeTag(),this.cache.verticalList.forEach(x=>{const A=x.reduce((M,T)=>M+T.width,0);o=ti(A,o)});const C=i0(_,o),S=this.cache.verticalList.length*v,w=R1(b,S,u);return this._AABBBounds.set(w,C,w+S,C+o),g&&this._AABBBounds.expand(p/2),this._AABBBounds}getMaxWidth(t){var e,i;const r=this.attribute;return(i=(e=r.maxLineWidth)!==null&&e!==void 0?e:r.maxWidth)!==null&&i!==void 0?i:t.maxWidth}getLineHeight(t,e,i){var r;return(r=zM(t.lineHeight,t.fontSize||e.fontSize))!==null&&r!==void 0?r:(t.fontSize||e.fontSize)+i}needUpdateTags(t,e=RG){return super.needUpdateTags(t,e)}needUpdateTag(t,e=RG){return super.needUpdateTag(t,e)}_interpolate(t,e,i,r,s){t==="text"&&(s.text=r)}clone(){return new Lh(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return Lh.NOWORK_ANIMATE_ATTR}getBaselineMapAlign(){return Lh.baselineMapAlign}getAlignMapBaseline(){return Lh.alignMapBaseline}};LC.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,direction:1,textAlign:1,textBaseline:1,fontFamily:1,fontWeight:1},ar),LC.baselineMapAlign={top:"left",bottom:"right",middle:"center"},LC.alignMapBaseline={left:"top",right:"bottom",center:"middle"};function uf(n){return new LC(n)}const QPt=(n,t,e)=>{const{outerBorder:i,shadowBlur:r=t.shadowBlur,strokeBoundsBuffer:s=t.strokeBoundsBuffer}=n;if(i){const o=t.outerBorder,{distance:a=o.distance,lineWidth:l=o.lineWidth}=i;k1(e,a+(r+l)/2,!0,s)}return e},BG=["symbolType","size",...$s];let KM=class l2 extends kn{constructor(t={symbolType:"circle"}){super(t),this.type="symbol",this.numberType=YM}getParsedPath(){return this.shouldUpdateShape()&&(this._parsedPath=this.doUpdateParsedPath(),this.clearUpdateShapeTag()),this._parsedPath}getParsedPath2D(t=0,e=0,i=1){let r=null;try{r=new Path2D}catch{return null}const s=this.getParsedPath();if(!s)return null;s.draw(r,i,t,e)}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{size:t}=this.attribute;return V(t)?t.length===2&&t.every(this._validNumber):this._validNumber(t)}doUpdateParsedPath(){const{symbolType:t="circle"}=this.attribute;return super.parsePath(t)}getGraphicTheme(){return ne(this).symbol}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateSymbolAABBBoundsImprecise(t,e,i):this.updateSymbolAABBBoundsAccurate(t,e,i));const{tb1:s,tb2:o}=bt.graphicService.updateTempAABBBounds(i);QPt(t,e,s),i.union(s),s.setValue(o.x1,o.y1,o.x2,o.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,this.x1WithoutTransform=i.x1,this.y1WithoutTransform=i.y1;const{lineJoin:a=e.lineJoin}=t;return bt.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateSymbolAABBBoundsImprecise(t,e,i){const{size:r=e.size}=t;if(V(r))i.set(-r[0]/2,-r[1]/2,r[0]/2,r[1]/2);else{const s=r/2;i.set(-s,-s,s,s)}return i}updateSymbolAABBBoundsAccurate(t,e,i){const{size:r=e.size}=t;return this.getParsedPath().bounds(r,i),i}needUpdateTags(t){return super.needUpdateTags(t,BG)}needUpdateTag(t){return super.needUpdateTag(t,BG)}toCustomPath(){const t=this.getParsedPath(),e=this.attribute.size,i=V(e)?e:[e,e];return t.path?new Cn().fromCustomPath2D(t.path,0,0,i[0],i[1]):new Cn().fromString(t.pathStr,0,0,i[0],i[1])}clone(){return new l2(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return l2.NOWORK_ANIMATE_ATTR}};KM.NOWORK_ANIMATE_ATTR=Object.assign({symbolType:1},ar);function fb(n){return new KM(n)}const PG=["segments","points","curveType","curveTension",...$s];let RQ=class h2 extends kn{constructor(t={}){super(t),this.type="line",this.numberType=gb}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&!(t.length<=1)}_interpolate(t,e,i,r,s){t==="points"&&(s.points=WD(i,r,e))}getGraphicTheme(){return ne(this).line}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateLineAABBBoundsBySegments(t,e,i):this.updateLineAABBBoundsByPoints(t,e,i)),bt.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return bt.graphicService.transformAABBBounds(t,i,e,r==="miter",this),i}updateLineAABBBoundsByPoints(t,e,i,r){const{points:s=e.points,connectedType:o}=t,a=i;return s.forEach(l=>{l.defined===!1&&o!=="connect"||a.add(l.x,l.y)}),a}updateLineAABBBoundsBySegments(t,e,i,r){const{segments:s=e.segments,connectedType:o}=t,a=i;return s.forEach(l=>{l.points.forEach(h=>{h.defined===!1&&o!=="connect"||a.add(h.x,h.y)})}),a}needUpdateTags(t){return super.needUpdateTags(t,PG)}needUpdateTag(t){return super.needUpdateTag(t,PG)}toCustomPath(){const t=this.attribute,e=new Cn,i=t.segments,r=s=>{if(s&&s.length){let o=!0;s.forEach(a=>{a.defined!==!1&&(o?e.moveTo(a.x,a.y):e.lineTo(a.x,a.y),o=!1)})}};return i&&i.length?i.forEach(s=>{r(s.points)}):t.points&&r(t.points),e}clone(){return new h2(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return h2.NOWORK_ANIMATE_ATTR}};RQ.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},ar);function eF(n){return new RQ(n)}const EG=["width","x1","y1","height","cornerRadius",...$s];class cf extends kn{constructor(t){super(t),this.type="rect",this.numberType=GD}isValid(){return super.isValid()&&this._isValid()}_isValid(){return!0}getGraphicTheme(){return ne(this).rect}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){let{width:o,height:a}=t;const{x1:l,y1:h,x:d,y:u}=t;o=o??l-d,a=a??h-u,(isFinite(o)||isFinite(a)||isFinite(d)||isFinite(u))&&i.set(0,0,o||0,a||0)}const{tb1:r,tb2:s}=bt.graphicService.updateTempAABBBounds(i);return pb(t,e,r),i.union(r),r.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,bt.graphicService.transformAABBBounds(t,i,e,!1,this),i}needUpdateTags(t){return super.needUpdateTags(t,EG)}needUpdateTag(t){return super.needUpdateTag(t,EG)}toCustomPath(){const t=this.attribute,{x:e,y:i,width:r,height:s}=oBt(t),o=new Cn;return o.moveTo(e,i),o.rect(e,i,r,s),o}clone(){return new cf(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return cf.NOWORK_ANIMATE_ATTR}}cf.NOWORK_ANIMATE_ATTR=ar;function mb(n){return new cf(n)}const LG=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]];class qM extends cf{constructor(t){super(t),this.type="rect3d",this.numberType=UD}findFace(){const t={polygons:[],vertices:[],edges:[]},e=this.getGraphicTheme(),{x1:i,y1:r,x:s,y:o,length:a=we(e.width,e.height)}=this.attribute;let{width:l,height:h}=this.attribute;l=l??i-s,h=h??r-o;for(let d=0;d<LG.length;d++){const u=LG[d];t.vertices.push([u[0]*l,u[1]*h,u[2]*a])}return t.polygons.push({polygon:[0,1,5,4],normal:[0,-1,0]}),t.polygons.push({polygon:[2,3,7,6],normal:[0,1,0]}),t.polygons.push({polygon:[4,7,3,0],normal:[-1,0,0]}),t.polygons.push({polygon:[1,2,6,5],normal:[1,0,0]}),t.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),t.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),t.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],t}getNoWorkAnimateAttr(){return qM.NOWORK_ANIMATE_ATTR}}qM.NOWORK_ANIMATE_ATTR=ar;function BQ(n){return new qM(n)}class r0 extends kn{constructor(t){super(t),this.type="glyph",this.numberType=ND,this.subGraphic=[],this._onInit&&this._onInit(this),this.valid=this.isValid()}setSubGraphic(t){this.detachSubGraphic(),this.subGraphic=t,t.forEach(e=>{e.glyphHost=this,Object.setPrototypeOf(e.attribute,this.attribute)}),this.valid=this.isValid(),this.addUpdateBoundTag()}detachSubGraphic(){this.subGraphic.forEach(t=>{t.glyphHost=null,Object.setPrototypeOf(t.attribute,{})})}getSubGraphic(){return this.subGraphic}onInit(t){this._onInit=t}onUpdate(t){this._onUpdate=t}isValid(){return!0}setAttribute(t,e,i,r){super.setAttribute(t,e,i,r),this.subGraphic.forEach(s=>{s.addUpdateShapeAndBoundsTag(),s.addUpdatePositionTag()})}setAttributes(t,e=!1,i){super.setAttributes(t,e,i),this.subGraphic.forEach(r=>{r.addUpdateShapeAndBoundsTag(),r.addUpdatePositionTag()})}translate(t,e){return super.translate(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}translateTo(t,e){return super.translateTo(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}scale(t,e,i){return super.scale(t,e,i),this.subGraphic.forEach(r=>{r.addUpdatePositionTag(),r.addUpdateBoundTag()}),this}scaleTo(t,e){return super.scaleTo(t,e),this.subGraphic.forEach(i=>{i.addUpdatePositionTag(),i.addUpdateBoundTag()}),this}rotate(t){return super.rotate(t),this.subGraphic.forEach(e=>{e.addUpdatePositionTag(),e.addUpdateBoundTag()}),this}rotateTo(t){return super.rotate(t),this.subGraphic.forEach(e=>{e.addUpdatePositionTag(),e.addUpdateBoundTag()}),this}getGraphicTheme(){return ne(this).glyph}updateAABBBounds(t,e,i){return this.getSubGraphic().forEach(r=>{i.union(r.AABBBounds)}),i}doUpdateAABBBounds(){this.updateAABBBoundsStamp++,this._AABBBounds.clear();const t=this.updateAABBBounds(this.attribute,this.getGraphicTheme(),this._AABBBounds);return this.clearUpdateBoundTag(),t}needUpdateTags(t){return!1}needUpdateTag(t){return!1}useStates(t,e){var i;if(!t.length)return void this.clearStates(e);if(!(((i=this.currentStates)===null||i===void 0?void 0:i.length)!==t.length||t.some((o,a)=>this.currentStates[a]!==o)))return;this.stopStateAnimates();const r={},s=this.subGraphic.map(()=>({}));t.forEach(o=>{var a;const l=this.glyphStateProxy?this.glyphStateProxy(o,t):this.glyphStates[o];l&&(Object.assign(r,l.attributes),!((a=l.subAttributes)===null||a===void 0)&&a.length&&s.forEach((h,d)=>{Object.assign(h,l.subAttributes[d])}))}),this.subGraphic.forEach((o,a)=>{o.updateNormalAttrs(s[a]),o.applyStateAttrs(s[a],t,e)}),this.updateNormalAttrs(r),this.currentStates=t,this.applyStateAttrs(r,t,e)}clearStates(t){this.stopStateAnimates(),this.hasState()&&this.normalAttrs?(this.currentStates=[],this.subGraphic.forEach(e=>{e.applyStateAttrs(e.normalAttrs,this.currentStates,t,!0),e.normalAttrs=null}),this.applyStateAttrs(this.normalAttrs,this.currentStates,t,!0)):this.currentStates=[],this.normalAttrs=null}clone(){const t=new r0(Object.assign({},this.attribute));return t.setSubGraphic(this.subGraphic.map(e=>e.clone())),t}getNoWorkAnimateAttr(){return r0.NOWORK_ANIMATE_ATTR}}r0.NOWORK_ANIMATE_ATTR=ar;function PQ(n){return new r0(n)}class tEt{constructor(t,e,i,r,s,o,a,l,h,d,u,c,g,p){this.left=t,this.top=e,this.width=i,this.height=r,this.actualHeight=0,this.bottom=e+r,this.right=t+i,this.ellipsis=s,this.wordBreak=o,this.verticalDirection=a,this.lines=[],this.globalAlign=l,this.globalBaseline=h,this.layoutDirection=d,this.directionKey=HD[this.layoutDirection],this.isWidthMax=u,this.isHeightMax=c,this.singleLine=g,p?(p.clear(),this.icons=p):this.icons=new Map}draw(t,e){const{width:i,height:r}=this.getActualSize(),s=this.isWidthMax?Math.min(this.width,i):this.width||i||0;let o=this.isHeightMax?Math.min(this.height,r):this.height||r||0;o=Math.min(o,r);let a=0;switch(this.globalBaseline){case"top":a=0;break;case"middle":a=-o/2;break;case"bottom":a=-o}let l=0;this.globalAlign==="right"||this.globalAlign==="end"?l=-s:this.globalAlign==="center"&&(l=-s/2);let h=this[this.directionKey.height];this.singleLine&&(h=this.lines[0].height+1);let d=!1;if(this.verticalDirection==="middle")if(this.actualHeight>=h&&h!==0)for(let u=0;u<this.lines.length;u++){const{top:c,height:g}=this.lines[u];if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return d;let p=!1;this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+h&&(p=!0,d=!0),this.lines[u].draw(t,p,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+a,this.ellipsis,e)}else{const u=Math.floor((h-this.actualHeight)/2);this.layoutDirection==="vertical"?l+=u:a+=u;for(let c=0;c<this.lines.length;c++)this.lines[c].draw(t,!1,this.lines[c][this.directionKey.left]+l,this.lines[c][this.directionKey.top]+a,this.ellipsis,e)}else if(this.verticalDirection==="bottom"&&this.layoutDirection!=="vertical")for(let u=0;u<this.lines.length;u++){const{top:c,height:g}=this.lines[u],p=h-this.lines[u].top-this.lines[u].height;if(h===0)this.lines[u].draw(t,!1,l,p+a,this.ellipsis,e);else{if(p+g>this[this.directionKey.top]+h||p<this[this.directionKey.top])return d;{let f=!1;this.ellipsis&&this.lines[u+1]&&p-this.lines[u+1].height<this[this.directionKey.top]&&(f=!0,d=!0),this.lines[u].draw(t,f,l,p+a,this.ellipsis,e)}}}else{this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&this.singleLine&&this.isWidthMax&&(l+=this.lines[0].height+1);for(let u=0;u<this.lines.length;u++){this.verticalDirection==="bottom"&&this.layoutDirection==="vertical"&&(l-=this.lines[u].height+this.lines[u].top);const{top:c,height:g}=this.lines[u];if(h===0)this.lines[u].draw(t,!1,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+a,this.ellipsis,e);else{if(c+g<this[this.directionKey.top]||c+g>this[this.directionKey.top]+h)return d;{let p=!1;this.ellipsis&&this.lines[u+1]&&this.lines[u+1].top+this.lines[u+1].height>this[this.directionKey.top]+h&&(p=!0,d=!0),this.lines[u].draw(t,p,this.lines[u][this.directionKey.left]+l,this.lines[u][this.directionKey.top]+a,this.ellipsis,e)}}}}return d}getActualSize(){return this.ellipsis?this.getActualSizeWidthEllipsis():this.getRawActualSize()}getRawActualSize(){let t=0,e=0;for(let i=0;i<this.lines.length;i++){const r=this.lines[i];r.actualWidth>t&&(t=r.actualWidth),e+=r.height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}getActualSizeWidthEllipsis(){let t=0,e=0;const{width:i,height:r}=this.getRawActualSize();this.width,this.height;let s=this[this.directionKey.height];if(this.singleLine&&(s=this.lines[0].height+1),this.verticalDirection==="middle")if(this.actualHeight>=s&&s!==0)for(let o=0;o<this.lines.length;o++){const{top:a,height:l}=this.lines[o];if(!(a+l<this[this.directionKey.top]||a+l>this[this.directionKey.top]+s))if(this.ellipsis&&this.lines[o+1]&&this.lines[o+1].top+this.lines[o+1].height>this[this.directionKey.top]+s){const h=this.ellipsis===!0?"...":this.ellipsis||"",d=this.lines[o].getWidthWithEllips(h);d>t&&(t=d),e+=this.lines[o].height}else this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}else{Math.floor((s-this.actualHeight)/2);for(let o=0;o<this.lines.length;o++)this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}else if(this.verticalDirection==="bottom")for(let o=0;o<this.lines.length;o++){const{top:a,height:l}=this.lines[o],h=s-this.lines[o].top-this.lines[o].height;if(s===0)this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height;else if(!(h+l>this[this.directionKey.top]+s||h<this[this.directionKey.top]))if(this.ellipsis&&this.lines[o+1]&&h-this.lines[o+1].height<this[this.directionKey.top]){const d=this.ellipsis===!0?"...":this.ellipsis||"",u=this.lines[o].getWidthWithEllips(d);u>t&&(t=u),e+=this.lines[o].height}else this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}else for(let o=0;o<this.lines.length;o++){const{top:a,height:l}=this.lines[o];if(s===0)this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height;else if(!(a+l<this[this.directionKey.top]||a+l>this[this.directionKey.top]+s))if(this.ellipsis&&this.lines[o+1]&&this.lines[o+1].top+this.lines[o+1].height>this[this.directionKey.top]+s){const h=this.ellipsis===!0?"...":this.ellipsis||"",d=this.lines[o].getWidthWithEllips(h);d>t&&(t=d),e+=this.lines[o].height}else this.lines[o].actualWidth>t&&(t=this.lines[o].actualWidth),e+=this.lines[o].height}return{width:this.layoutDirection==="vertical"?e:t,height:this.layoutDirection==="vertical"?t:e}}}function Sm(n,t,e,i){const r=Math.round(n),s=Math.round(e),o=Math.round(t),a=Math.round(i);return{left:n>r?r:r-.5,top:e>s?s:s-.5,right:o>t?o:o+.5,bottom:a>i?a:a+.5}}class zu{constructor(t,e,i,r){var s,o;this.fontSize=i.fontSize||16,this.textBaseline=i.textBaseline||"alphabetic",this.ascentDescentMode=r;const a=zM(i.lineHeight,this.fontSize);this.lineHeight=typeof a=="number"?a>this.fontSize?a:this.fontSize:Math.floor(1.2*this.fontSize),this.height=this.lineHeight;const{ascent:l,height:h,descent:d,width:u}=ku(t,i,this.ascentDescentMode);let c=0,g=0,p=0;this.height>h&&(c=(this.height-h)/2,g=Math.ceil(c),p=Math.floor(c)),this.textBaseline==="top"?(this.ascent=c,this.descent=h-c):this.textBaseline==="bottom"?(this.ascent=h-c,this.descent=c):this.textBaseline==="middle"?(this.ascent=this.height/2,this.descent=this.height/2):(this.ascent=l+g,this.descent=d+p),this.length=t.length,this.width=u||0,this.text=t||"",this.newLine=e||!1,this.character=i,this.left=0,this.top=0,this.ellipsis="normal",this.ellipsisWidth=0,this.ellipsisOtherParagraphWidth=0,this.space=i.space,this.dx=(s=i.dx)!==null&&s!==void 0?s:0,this.dy=(o=i.dy)!==null&&o!==void 0?o:0,i.direction==="vertical"&&(this.direction=i.direction,this.widthOrigin=this.width,this.heightOrigin=this.height,this.width=this.heightOrigin,this.height=this.widthOrigin,this.lineHeight=this.height),this.ellipsisStr="..."}updateWidth(){const{width:t}=ku(this.text,this.character,this.ascentDescentMode);this.width=t,this.direction==="vertical"&&(this.widthOrigin=this.width,this.width=this.heightOrigin,this.height=this.widthOrigin)}drawBackground(t,e,i,r,s,o,a){if(this.text===""||this.text===`
`||!this.character.background||this.character.backgroundOpacity&&!(this.character.backgroundOpacity>0))return;let l=e+i,h=this.text,d=this.left+r;l+=this.top;let u=this.direction;if(this.verticalEllipsis)h=this.ellipsisStr,u="vertical",l-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")h+=this.ellipsisStr,o!=="right"&&o!=="end"||(d-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const g=PC(h,(u==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,h.length-1);if(h=h.slice(0,g),h+=this.ellipsisStr,(o==="right"||o==="end")&&u!=="vertical"){const{width:p}=ku(this.text.slice(g),this.character,this.ascentDescentMode);d-=this.ellipsisWidth-p}}}const c=Sm(d,d+(this.widthOrigin||this.width),e,e+a);return Object.assign(Object.assign({},c),{fillStyle:this.character.background,globalAlpha:this.character.backgroundOpacity})}draw(t,e,i,r,s,o,a){var l;let h=e+i,d=this.text,u=this.left+r+((l=this.space)!==null&&l!==void 0?l:0)/2;h+=this.top;let c=this.direction;if(this.verticalEllipsis)d=this.ellipsisStr,c="vertical",h-=this.ellipsisWidth/2;else{if(this.ellipsis==="hide")return;if(this.ellipsis==="add")d+=this.ellipsisStr,o!=="right"&&o!=="end"||(u-=this.ellipsisWidth);else if(this.ellipsis==="replace"){const p=PC(d,(c==="vertical"?this.height:this.width)-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,d.length-1);if(d=d.slice(0,p),d+=this.ellipsisStr,(o==="right"||o==="end")&&c!=="vertical"){const{width:f}=ku(this.text.slice(p),this.character,this.ascentDescentMode);u-=this.ellipsisWidth-f}}}switch(this.character.script){case"super":h-=this.ascent*(1/3);break;case"sub":h+=this.descent/2}c==="vertical"&&(t.save(),t.rotateAbout(Math.PI/2,u,h),t.translate(-this.heightOrigin||-this.lineHeight/2,-this.descent/2),t.translate(u,h),u=0,h=0);const{lineWidth:g=1}=this.character;if(this.character.stroke&&g&&t.strokeText(d,u,h+this.dy),this.character.fill&&t.fillText(d,u,h+this.dy),this.character.fill){if(this.character.lineThrough||this.character.underline){if(this.character.underline){const p=1+h,f=Sm(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}if(this.character.lineThrough){const p=1+h-this.ascent/2,f=Sm(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h-this.ascent/2,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}else if(this.character.textDecoration==="underline"){const p=1+h,f=Sm(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}else if(this.character.textDecoration==="line-through"){const p=1+h-this.ascent/2,f=Sm(u,u+(this.widthOrigin||this.width),p,p+(this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1));t.fillRect(f.left,1+h-this.ascent/2,f.right-f.left,this.character.fontSize?Math.max(1,Math.floor(this.character.fontSize/10)):1)}}c==="vertical"&&t.restore()}getWidthWithEllips(t){let e=this.text;const i=t==="vertical"?this.height:this.width;if(this.ellipsis==="hide")return i;if(this.ellipsis==="add")return i+this.ellipsisWidth;if(this.ellipsis==="replace"){const r=PC(e,i-this.ellipsisWidth+this.ellipsisOtherParagraphWidth,this.character,e.length-1);e=e.slice(0,r),e+=this.ellipsisStr;const{width:s}=ku(this.text.slice(r),this.character,this.ascentDescentMode);return i+this.ellipsisWidth-s}return i}}function eEt(n,t){const e=n.text.slice(0,t),i=n.text.slice(t);return[new zu(e,n.newLine,n.character,n.ascentDescentMode),new zu(i,!0,n.character,n.ascentDescentMode)]}const IG=["width","height","image",...$s];let iF=class d2 extends kn{constructor(t){super(t),this.type="image",this.numberType=VM,this.loadImage(this.attribute.image)}getImageElement(){const{image:t}=this.attribute;if(!t||!this.resources)return null;const e=this.resources.get(t);return e.state!=="success"?null:e.data}get width(){return this.tryUpdateAABBBounds(),this._actualWidth}get height(){return this.tryUpdateAABBBounds(),this._actualHeight}get repeatX(){var t;return(t=this.attribute.repeatX)!==null&&t!==void 0?t:"no-repeat"}set repeatX(t){this.attribute.repeatX===t&&(this.attribute.repeatX=t)}get repeatY(){var t;return(t=this.attribute.repeatY)!==null&&t!==void 0?t:"no-repeat"}set repeatY(t){this.attribute.repeatY===t&&(this.attribute.repeatY=t)}get image(){return this.attribute.image}set image(t){t!==this.attribute.image&&(this.attribute.image=t,this.loadImage(this.attribute.image))}imageLoadSuccess(t,e,i){super.imageLoadSuccess(t,e,()=>{this.successCallback&&this.successCallback()}),this.addUpdateBoundTag()}imageLoadFail(t,e){super.imageLoadFail(t,()=>{this.failCallback&&this.failCallback()})}setAttributes(t,e,i){return t.image&&this.loadImage(t.image),super.setAttributes(t,e,i)}setAttribute(t,e,i,r){return t==="image"&&this.loadImage(e),super.setAttribute(t,e,i,r)}getGraphicTheme(){return ne(this).image}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const{maxWidth:o=e.maxWidth,maxHeight:a=e.maxHeight}=t;let{width:l,height:h}=t;if(l==null||h==null){const d=this.getImageElement();if(d){const u=d.width,c=d.height;if(l!=null)h=l*(c/u);else if(h!=null)l=h*(u/c);else{const g=u/c;g>o/a?(l=o,h=o/g):(h=a,l=a*g)}}else l=o,h=a}this._actualWidth=l,this._actualHeight=h,i.set(0,0,l,h)}const{tb1:r,tb2:s}=bt.graphicService.updateTempAABBBounds(i);return pb(t,e,r),i.union(r),r.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,bt.graphicService.transformAABBBounds(t,i,e,!1,this),i}getDefaultAttribute(t){return t0[t]}needUpdateTags(t){return super.needUpdateTags(t,IG)}needUpdateTag(t){return super.needUpdateTag(t,IG)}clone(){return new d2(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return d2.NOWORK_ANIMATE_ATTR}};iF.NOWORK_ANIMATE_ATTR=Object.assign({image:1,repeatX:1,repeatY:1},ar);function nF(n){return new iF(n)}class ka extends iF{constructor(t){if(super(t),this._x=0,this._y=0,this._hovered=!1,this._marginArray=[0,0,0,0],t.backgroundShowMode==="always"&&(this._hovered=!0),t.margin){const e=GL(t.margin);this._marginArray=typeof e=="number"?[e,e,e,e]:e}this.onBeforeAttributeUpdate=(e,i,r)=>{if(V(r)&&r.indexOf("margin")!==-1||r==="margin")if(i.margin){const s=GL(i.margin);this._marginArray=typeof s=="number"?[s,s,s,s]:s}else this._marginArray=[0,0,0,0]}}get width(){var t;return((t=this.attribute.width)!==null&&t!==void 0?t:0)+this._marginArray[1]+this._marginArray[3]}get height(){var t;return((t=this.attribute.height)!==null&&t!==void 0?t:0)+this._marginArray[0]+this._marginArray[2]}tryUpdateAABBBounds(){if(!this.shouldUpdateAABBBounds())return this._AABBBounds;this.doUpdateAABBBounds();const{width:t=t0.width,height:e=t0.height}=this.attribute,{backgroundWidth:i=t,backgroundHeight:r=e}=this.attribute,s=(i-t)/2,o=(r-e)/2;return this._AABBBounds.expand([0,2*s,2*o,0]),this._AABBBounds}setHoverState(t){this.attribute.backgroundShowMode==="hover"&&this._hovered!==t&&(this._hovered=t)}}class iEt{constructor(t,e,i,r,s,o,a,l){this.left=t,this.width=e,this.baseline=i,this.ascent=r,this.descent=s,this.top=i-r,this.paragraphs=o.map(d=>d),this.textAlign=(this.paragraphs[0]instanceof ka?this.paragraphs[0].attribute.textAlign:this.paragraphs[0].character.textAlign)||"left",this.direction=a,this.directionKey=HD[this.direction],this.actualWidth=0;let h=0;this.paragraphs.forEach((d,u)=>{if(u===0&&d instanceof zu){const c=LRt.exec(d.text);(c==null?void 0:c.index)!==0&&(d.text=d.text.slice(c==null?void 0:c.index),d.updateWidth())}this.actualWidth+=d[this.directionKey.width],h=Math.max(d[this.directionKey.height],h)}),this.height=h,this.blankWidth=l?0:this.width-this.actualWidth,this.calcOffset(e,l)}calcOffset(t,e){const i=this.directionKey,r=this.height;let s=this.left,o=0;this.actualWidth<t&&!e&&(this.textAlign==="right"||this.textAlign==="end"?s=t-this.actualWidth:this.textAlign==="center"?s=(t-this.actualWidth)/2:this.textAlign==="justify"&&(this.paragraphs.length<2?s=(t-this.actualWidth)/2:o=(t-this.actualWidth)/(this.paragraphs.length-1))),this.paragraphs.map(function(a){a instanceof ka?(a["_"+i.x]=s,s+=a[i.width]+o,a["_"+i.y]=a.attribute.textBaseline==="top"?0:a.attribute.textBaseline==="bottom"?r-a.height:(r-a.height)/2):(a[i.left]=s,s+=a[i.width]+o)})}draw(t,e,i,r,s,o){if(s&&(e||this.paragraphs.some(u=>u.overflow))){let u=!0,c=!1;for(let p=this.paragraphs.length-1;p>=0;p--){const f=this.paragraphs[p];if(f.overflow)u=u&&f.text==="";else if(u){c=!0;break}}let g=0;if(!c)for(let p=this.paragraphs.length-1;p>=0;p--){const f=this.paragraphs[p];if(f.overflow){if(f.text==="")break;continue}if(f instanceof ka)break;if(this.direction==="vertical"&&f.direction!=="vertical"){f.verticalEllipsis=!0;break}const m=s===!0?"...":s||"";f.ellipsisStr=m;const{width:v}=ku(m,f.character,f.ascentDescentMode),_=v||0;if(_<=this.blankWidth+g){e&&(f.ellipsis="add");break}if(_<=this.blankWidth+g+f.width){f.ellipsis="replace",f.ellipsisWidth=_,f.ellipsisOtherParagraphWidth=this.blankWidth+g;break}f.ellipsis="hide",g+=f.width}}let a="",l=-1,h=[];const d=[h];this.paragraphs.forEach((u,c)=>{if(u instanceof ka)return;const g=u.drawBackground(t,r,this.ascent,i,c===0,this.textAlign,this.height);g&&(a===g.fillStyle&&l===g.globalAlpha||(h=[],d.push(h),a=g.fillStyle,l=g.globalAlpha),h.push(g))}),d.forEach(u=>{if(u.length===0)return;const c=u[0],g=u[u.length-1];t.fillStyle=c.fillStyle,t.globalAlpha=c.globalAlpha,t.fillRect(c.left,c.top,g.right-c.left,g.bottom-c.top)}),this.paragraphs.forEach((u,c)=>{if(u instanceof ka)return u.setAttributes({x:i+u._x,y:r+u._y}),void o(u,t,i+u._x,r+u._y,this.ascent);const g={x1:this.left,y1:this.top,x2:this.left+this.actualWidth,y2:this.top+this.height};ORt(t,u.character),IRt(t,u.character,g),u.draw(t,r,this.ascent,i,c===0,this.textAlign,this.height)})}getWidthWithEllips(t){let e=0;for(let r=this.paragraphs.length-1;r>=0;r--){const s=this.paragraphs[r];if(s instanceof ka)break;const{width:o}=ku(t,s.character,s.ascentDescentMode),a=o||0;if(a<=this.blankWidth+e){s.ellipsis="add",s.ellipsisWidth=a;break}if(a<=this.blankWidth+e+s.width){s.ellipsis="replace",s.ellipsisWidth=a,s.ellipsisOtherParagraphWidth=this.blankWidth+e;break}s.ellipsis="hide",e+=s.width}let i=0;return this.paragraphs.forEach((r,s)=>{i+=r instanceof ka?r.width:r.getWidthWithEllips(this.direction)}),i}}class nEt{constructor(t){this.frame=t,this.width=this.frame.width,this.height=this.frame.height,this.lineWidth=0,this.y=this.frame.top,this.maxAscent=0,this.maxDescent=0,this.maxAscentForBlank=0,this.maxDescentForBlank=0,this.lineBuffer=[],this.direction=t.layoutDirection,this.directionKey=HD[this.direction]}store(t){if(t instanceof ka){this.frame.icons.set(t.richtextId,t),this.lineBuffer.push(t),this.lineWidth+=t[this.directionKey.width];let e=0,i=0;t.attribute.textBaseline==="top"?(e=0,i=t.height):t.attribute.textBaseline==="bottom"?(e=t.height,i=0):(e=t.height/2,i=t.height/2),this.maxAscent=Math.max(this.maxAscent,e),this.maxDescent=Math.max(this.maxDescent,i)}else this.lineBuffer.push(t),t.text.length!==0?(this.lineWidth+=t[this.directionKey.width],this.maxAscent=Math.max(this.maxAscent,t.ascent),this.maxDescent=Math.max(this.maxDescent,t.descent)):(this.maxAscentForBlank=Math.max(this.maxAscentForBlank,t.ascent),this.maxDescentForBlank=Math.max(this.maxDescentForBlank,t.descent))}send(){if(this.lineBuffer.length===0)return;const t=this.maxAscent===0?this.maxAscentForBlank:this.maxAscent,e=this.maxDescent===0?this.maxDescentForBlank:this.maxDescent,i=new iEt(this.frame.left,this[this.directionKey.width],this.y+t,t,e,this.lineBuffer,this.direction,this.direction==="horizontal"?this.frame.isWidthMax:this.frame.isHeightMax);this.frame.lines.push(i),this.frame.actualHeight+=i.height,this.y+=i.height,this.lineBuffer.length=0,this.lineWidth=this.maxAscent=this.maxDescent=this.maxAscentForBlank=this.maxDescentForBlank=0}deal(t,e=!1){t instanceof ka?this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineBuffer.length===0?(this.store(t),this.send()):(this.send(),this.deal(t)):typeof this.width!="number"||this.width<0||(t.newLine&&this.send(),(t.text.length!==0||this.newLine)&&(this.direction==="horizontal"&&this.width===0||this.direction==="vertical"&&this.height===0||this.lineWidth+t[this.directionKey.width]<=this[this.directionKey.width]?this.store(t):this.lineWidth===this[this.directionKey.width]?(this.send(),this.deal(t)):this.cut(t,e)))}cut(t,e){const i=this[this.directionKey.width]-this.lineWidth||0,r=Math.ceil(i/t[this.directionKey.width]*t.length)||0,s=PC(t.text,i,t.character,r,this.frame.wordBreak==="break-word");if(s!==0){const[o,a]=eEt(t,s);this.store(o),e?this.send():this.deal(a)}else this.lineBuffer.length!==0&&(this.send(),this.deal(t))}}let u2=!1;try{u2=Intl&&typeof Intl.Segmenter=="function"}catch{u2=!1}const OG=["width","height","ellipsis","wordBreak","verticalDirection","maxHeight","maxWidth","textAlign","textBaseline","textConfig","layoutDirection","fill","stroke","fontSize","fontFamily","fontStyle","fontWeight","lineWidth","opacity","fillOpacity","strokeOpacity",...$s];class Ra extends kn{constructor(t){super(t),this.type="richtext",this._currentHoverIcon=null,this.numberType=YD,this.onBeforeAttributeUpdate=(e,i,r)=>{for(const s in e)if(s==="hoverIconId"){if(e[s]===i[s])continue;const o=this._frameCache.icons.get(e[s]);this.updateHoverIconState(o)}}}get width(){var t;return(t=this.attribute.width)!==null&&t!==void 0?t:wl.width}set width(t){this.attribute.width!==t&&(this.attribute.width=t,this.addUpdateShapeAndBoundsTag())}get height(){var t;return(t=this.attribute.height)!==null&&t!==void 0?t:wl.height}set height(t){this.attribute.height!==t&&(this.attribute.height=t,this.addUpdateShapeAndBoundsTag())}get maxWidth(){return this.attribute.maxWidth}set maxWidth(t){this.attribute.maxWidth!==t&&(this.attribute.maxWidth=t,this.addUpdateShapeAndBoundsTag())}get maxHeight(){return this.attribute.maxHeight}set maxHeight(t){this.attribute.maxHeight!==t&&(this.attribute.maxHeight=t,this.addUpdateShapeAndBoundsTag())}get ellipsis(){var t;return(t=this.attribute.ellipsis)!==null&&t!==void 0?t:wl.ellipsis}set ellipsis(t){this.attribute.ellipsis!==t&&(this.attribute.ellipsis=t,this.addUpdateShapeAndBoundsTag())}get wordBreak(){var t;return(t=this.attribute.wordBreak)!==null&&t!==void 0?t:wl.wordBreak}set wordBreak(t){this.attribute.wordBreak!==t&&(this.attribute.wordBreak=t,this.addUpdateShapeAndBoundsTag())}get verticalDirection(){var t;return(t=this.attribute.verticalDirection)!==null&&t!==void 0?t:wl.verticalDirection}set verticalDirection(t){this.attribute.verticalDirection!==t&&(this.attribute.verticalDirection=t,this.addUpdateShapeAndBoundsTag())}get textAlign(){var t;return(t=this.attribute.textAlign)!==null&&t!==void 0?t:wl.textAlign}set textAlign(t){this.attribute.textAlign!==t&&(this.attribute.textAlign=t,this.addUpdateShapeAndBoundsTag())}get textBaseline(){var t;return(t=this.attribute.textBaseline)!==null&&t!==void 0?t:wl.textBaseline}set textBaseline(t){this.attribute.textBaseline!==t&&(this.attribute.textBaseline=t,this.addUpdateShapeAndBoundsTag())}get textConfig(){var t;return(t=this.attribute.textConfig)!==null&&t!==void 0?t:wl.textConfig}set textConfig(t){this.attribute.textConfig=t,this.addUpdateShapeAndBoundsTag()}getGraphicTheme(){return ne(this).richtext}static AllSingleCharacter(t){return t.lines?t.lines.every(e=>e.paragraphs.every(i=>!(i.text&&yt(i.text)&&Ra.splitText(i.text).length>1))):t.every(e=>e.isComposing||!(e.text&&yt(e.text)&&Ra.splitText(e.text).length>1))}static splitText(t){if(u2){const e=new Intl.Segmenter(void 0,{granularity:"grapheme"}),i=[];for(const{segment:r}of e.segment(t))i.push(r);return i}return Array.from(t)}static TransformTextConfig2SingleCharacter(t){const e=[];return t.forEach(i=>{const r=Ra.splitText(i.text.toString());if(yt(i.text)&&r.length>1)for(let s=0;s<r.length;s++){const o=r[s];e.push(Object.assign(Object.assign({},i),{text:o}))}else e.push(i)}),e}updateAABBBounds(t,e,i){var r,s,o,a;const{width:l=e.width,height:h=e.height,maxWidth:d=e.maxWidth,maxHeight:u=e.maxHeight,textAlign:c=e.textAlign,textBaseline:g=(s=(r=t.textBaseline)!==null&&r!==void 0?r:e.textBaseline)!==null&&s!==void 0?s:"top",editOptions:p}=t;if(l>0&&h>0)i.set(0,0,l,h);else{const v=this.getFrameCache(),{width:_,height:b}=v.getActualSize();let y=l||_||0,C=h||b||0;C=typeof u=="number"&&C>u?u:C||0,y=typeof d=="number"&&y>d?d:y||0,i.set(0,0,y,C)}p&&p.keepHeightWhileEmpty&&!i.height()&&!(!((o=t.textConfig)===null||o===void 0)&&o.length)&&(i.y2=i.y1+((a=t.fontSize)!==null&&a!==void 0?a:12),i.x2=i.x1+2);let f=0;switch(g){case"top":f=0;break;case"middle":f=-i.height()/2;break;case"bottom":f=-i.height()}let m=0;switch(c){case"left":m=0;break;case"center":m=-i.width()/2;break;case"right":m=-i.width()}return i.translate(m,f),bt.graphicService.updateTempAABBBounds(i),t.forceBoundsHeight==null&&t.forceBoundsWidth==null||bt.graphicService.updateHTMLTextAABBBounds(t,e,i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1,bt.graphicService.transformAABBBounds(t,i,e,!1,this),i.width()===0&&i.height()===0&&i.clear(),i}needUpdateTags(t){return super.needUpdateTags(t,OG)}needUpdateTag(t){return super.needUpdateTag(t,OG)}getFrameCache(){return this.shouldUpdateShape()&&(this.doUpdateFrameCache(),this.clearUpdateShapeTag()),this._frameCache}get cliped(){const t=this.getFrameCache();if(t.actualHeight>t.height)return!0;const{disableAutoWrapLine:e}=this.attribute;if(e)for(let i=0;i<t.lines.length;i++){const r=t.lines[i];for(let s=0;s<r.paragraphs.length;s++){const o=r.paragraphs[s];if(o.overflow&&o.text!=="")return!0}}return!1}combinedStyleToCharacter(t){const{fill:e,stroke:i,fontSize:r,fontFamily:s,fontStyle:o,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:d,lineHeight:u,strokeOpacity:c,upgradeAttrs:g}=this.attribute,p=Object.assign({fill:e,stroke:i,fontSize:r,fontFamily:s,fontStyle:o,fontWeight:a,lineWidth:l,opacity:h,fillOpacity:d,strokeOpacity:c},t);return g!=null&&g.lineHeight&&(p.lineHeight=u),p}doUpdateFrameCache(t){var e;const{maxWidth:i,maxHeight:r,width:s,height:o,ellipsis:a,wordBreak:l,verticalDirection:h,textAlign:d,textBaseline:u,layoutDirection:c,singleLine:g,disableAutoWrapLine:p,editable:f,ascentDescentMode:m,upgradeAttrs:v}=this.attribute,_=v&&v.multiBreakLine;let{textConfig:b=[]}=this.attribute;f&&b.length>0&&!Ra.AllSingleCharacter(b)&&(b=Ra.TransformTextConfig2SingleCharacter(b),this.attribute.textConfig=b);const y=[],C=t??b;for(let R=0;R<C.length;R++)if("image"in C[R]){const B=this.combinedStyleToCharacter(C[R]);B.lineWidth=void 0;const E=B.id&&this._frameCache&&this._frameCache.icons&&this._frameCache.icons.get(B.id);if(E)y.push(E);else{const k=new ka(B);k.successCallback=()=>{var P;this.addUpdateBoundTag(),(P=this.stage)===null||P===void 0||P.renderNextFrame()},k.richtextId=B.id,y.push(k)}}else{const B=this.combinedStyleToCharacter(C[R]);if(J(B.text)&&(B.text=`${B.text}`),B.text&&B.text.includes(`
`)){const E=B.text.split(`
`);for(let k=0;k<E.length;k++)if(k===0)y.push(new zu(E[k],!1,B,m));else if(E[k]||R===C.length-1)y.push(new zu(E[k],!0,B,m));else{const P=this.combinedStyleToCharacter(C[R+1]);y.push(new zu(E[k],!0,P,m))}}else B.text&&y.push(new zu(B.text,!1,B,m))}const S=typeof i=="number"&&Number.isFinite(i)&&i>0,w=typeof r=="number"&&Number.isFinite(r)&&r>0,x=typeof s=="number"&&Number.isFinite(s)&&s>0&&(!S||s<=i),A=typeof o=="number"&&Number.isFinite(o)&&o>0&&(!w||o<=r),M=new tEt(0,0,(x?s:S?i:0)||0,(A?o:w?r:0)||0,a,l,h,d,u,c||"horizontal",!x&&S,!A&&w,g||!1,(e=this._frameCache)===null||e===void 0?void 0:e.icons),T=new nEt(M);if(T.newLine=_,p){let R=0,B=!1;for(let E=0;E<y.length;E++){const k=y[E];B?(k.overflow=!0,k.left=1/0,k.top=1/0,!k.newLine&&M.lines[M.lines.length-1].paragraphs.push(k)):T.deal(k,!0),M.lines.length!==R&&(R=M.lines.length,T.lineBuffer.length=0,k.overflow=!0,k.left=1e3,k.top=1e3,M.lines[M.lines.length-1].paragraphs.push(k),B=!0),k.newLine&&(B=!1,T.lineWidth=0),T.send()}}else for(let R=0;R<y.length;R++)T.deal(y[R]);if(T.send(),!(M.layoutDirection==="horizontal"?x:A)){const R=M.getActualSizeWidthEllipsis();let B=M.layoutDirection==="horizontal"?R.width:R.height;(M.layoutDirection==="horizontal"?S:w)&&(B=Math.min(B,M.layoutDirection==="horizontal"?i:r)),M.lines.forEach(function(E){E.calcOffset(B,!1)})}_&&M.lines.forEach(R=>{const B=R.paragraphs;R.paragraphs=R.paragraphs.filter(E=>E.text!==""),R.paragraphs.length===0&&B.length&&(B[0].text=`
`,R.paragraphs.push(B[0]))}),this._frameCache=M}clone(){return new Ra(Object.assign({},this.attribute))}setStage(t,e){super.setStage(t,e),this.getFrameCache().icons.forEach(i=>{i.setStage(t,e)})}bindIconEvent(){this.addEventListener("pointermove",t=>{const e=this.pickIcon(t.global);e&&e===this._currentHoverIcon||(e?this.setAttribute("hoverIconId",e.richtextId):!e&&this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0))}),this.addEventListener("pointerleave",t=>{this._currentHoverIcon&&this.setAttribute("hoverIconId",void 0)})}updateHoverIconState(t){var e,i,r,s,o;t?((e=this._currentHoverIcon)===null||e===void 0||e.setHoverState(!1),this._currentHoverIcon=t,this._currentHoverIcon.setHoverState(!0),(i=this.stage)===null||i===void 0||i.setCursor(t.attribute.cursor),(r=this.stage)===null||r===void 0||r.renderNextFrame()):(this._currentHoverIcon.setHoverState(!1),this._currentHoverIcon=null,(s=this.stage)===null||s===void 0||s.setCursor(),(o=this.stage)===null||o===void 0||o.renderNextFrame())}pickIcon(t){const e=this.getFrameCache(),{e:i,f:r}=this.globalTransMatrix;let s;return e.icons.forEach((o,a)=>{var l,h;const d=o.AABBBounds.clone();d.translate(o._marginArray[3],o._marginArray[0]),d.containsPoint({x:t.x-i,y:t.y-r})&&(s=o,s.globalX=((l=s.attribute.x)!==null&&l!==void 0?l:0)+i+o._marginArray[3],s.globalY=((h=s.attribute.y)!==null&&h!==void 0?h:0)+r+o._marginArray[0])}),s}getNoWorkAnimateAttr(){return Ra.NOWORK_ANIMATE_ATTR}}Ra.NOWORK_ANIMATE_ATTR=Object.assign({ellipsis:1,wordBreak:1,verticalDirection:1,textAlign:1,textBaseline:1,textConfig:1,layoutDirection:1},ar);function EQ(n){return new Ra(n)}const DG=["path","customPath",...$s];class s0 extends kn{constructor(t){super(t),this.type="path",this.numberType=GM}get pathShape(){return this.tryUpdateAABBBounds(),this.getParsedPathShape()}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{path:t}=this.attribute;return t!=null&&t!==""}getParsedPathShape(){const t=this.getGraphicTheme();if(!this.valid)return t.path;const e=this.attribute;return e.path instanceof Cn?e.path:(D(this.cache)&&this.doUpdatePathShape(),this.cache instanceof Cn?this.cache:t.path)}getGraphicTheme(){return ne(this).path}updateAABBBounds(t,e,i){if(!this.updatePathProxyAABBBounds(i)){const a=this.getParsedPathShape();i.union(a.getBounds())}const{tb1:r,tb2:s}=bt.graphicService.updateTempAABBBounds(i);pb(t,e,r),i.union(r),r.setValue(s.x1,s.y1,s.x2,s.y2),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:o=e.lineJoin}=t;return bt.graphicService.transformAABBBounds(t,i,e,o==="miter",this),i}doUpdateAABBBounds(t){return this.doUpdatePathShape(),super.doUpdateAABBBounds(t)}doUpdatePathShape(){const t=this.attribute;yt(t.path,!0)?this.cache=new Cn().fromString(t.path):t.customPath&&(this.cache=new Cn,t.customPath(this.cache,this))}needUpdateTags(t){return super.needUpdateTags(t,DG)}needUpdateTag(t){return super.needUpdateTag(t,DG)}toCustomPath(){return new Cn().fromCustomPath2D(this.getParsedPathShape(),0,0)}clone(){return new s0(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return s0.NOWORK_ANIMATE_ATTR}}s0.NOWORK_ANIMATE_ATTR=Object.assign({path:1,customPath:1},ar);function LQ(n){return new s0(n)}const FG=["segments","points","curveType","curveTension",...$s];class o0 extends kn{constructor(t){super(t),this.type="area",this.numberType=cb}isValid(){return super.isValid()&&this._isValid()}_isValid(){if(this.pathProxy)return!0;const{points:t,segments:e}=this.attribute;return e?e.length!==0:!!t&&t.length!==0}getGraphicTheme(){return ne(this).area}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||(t.segments?this.updateAreaAABBBoundsBySegments(t,e,i):this.updateAreaAABBBoundsByPoints(t,e,i)),bt.graphicService.updateTempAABBBounds(i),this.setWidthHeightWithoutTransform(i);const{lineJoin:r=e.lineJoin}=t;return bt.graphicService.transformAABBBounds(t,i,e,r==="miter",this),i}updateAreaAABBBoundsByPoints(t,e,i,r){const{points:s=e.points}=t,o=i;return s.forEach(a=>{var l,h;o.add(a.x,a.y),o.add((l=a.x1)!==null&&l!==void 0?l:a.x,(h=a.y1)!==null&&h!==void 0?h:a.y)}),o}updateAreaAABBBoundsBySegments(t,e,i,r){const{segments:s=e.segments}=t,o=i;return s.forEach(a=>{a.points.forEach(l=>{var h,d;o.add(l.x,l.y),o.add((h=l.x1)!==null&&h!==void 0?h:l.x,(d=l.y1)!==null&&d!==void 0?d:l.y)})}),o}_interpolate(t,e,i,r,s){t==="points"&&(s.points=WD(i,r,e))}needUpdateTags(t){return super.needUpdateTags(t,FG)}needUpdateTag(t){return super.needUpdateTag(t,FG)}toCustomPath(){const t=new Cn,e=this.attribute,i=e.segments,r=s=>{if(s&&s.length){let o=!0;const a=[];if(s.forEach(l=>{var h,d;l.defined!==!1&&(o?t.moveTo(l.x,l.y):t.lineTo(l.x,l.y),a.push({x:(h=l.x1)!==null&&h!==void 0?h:l.x,y:(d=l.y1)!==null&&d!==void 0?d:l.y}),o=!1)}),a.length){for(let l=a.length-1;l>=0;l--)t.lineTo(a[l].x,a[l].y);t.closePath()}}};return e.points?r(e.points):i&&i.length&&i.forEach(s=>{r(s.points)}),t}clone(){return new o0(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return o0.NOWORK_ANIMATE_ATTR}}o0.NOWORK_ANIMATE_ATTR=Object.assign({segments:1,curveType:1},ar);function IQ(n){return new o0(n)}const HG=["innerRadius","outerRadius","startAngle","endAngle","cornerRadius","padAngle","padRadius","cap",...$s];class gf extends kn{constructor(t){super(t),this.type="arc",this.numberType=jM}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{startAngle:t,endAngle:e,outerRadius:i,innerRadius:r}=this.attribute;return this._validNumber(t)&&this._validNumber(e)&&this._validNumber(i)&&this._validNumber(r)}getParsedCornerRadius(){const t=this.getGraphicTheme(),{cornerRadius:e=t.cornerRadius,innerPadding:i=t.innerPadding,outerPadding:r=t.outerPadding}=this.attribute;let{outerRadius:s=t.outerRadius,innerRadius:o=t.innerRadius}=this.attribute;if(s+=r,o-=i,e===0||e==="0%")return 0;const a=Math.abs(s-o),l=h=>Math.min(J(h,!0)?h:a*parseFloat(h)/100,a/2);if(V(e)){const h=e.map(d=>l(d)||0);return h.length===0?[h[0],h[0],h[0],h[0]]:h.length===2?[h[0],h[1],h[0],h[1]]:(h.length===3&&h.push(0),h)}return l(e)}getParsedAngle(){const t=this.getGraphicTheme();let{startAngle:e=t.startAngle,endAngle:i=t.endAngle}=this.attribute;const{cap:r=t.cap}=this.attribute,s=i-e>=0?1:-1,o=i-e;if(e=MY(e),i=e+o,r&&Et(o)<Ft-$t){let a=1,l=1;r.length&&(a=Number(r[0]),l=Number(r[1]));let{outerRadius:h=t.outerRadius,innerRadius:d=t.innerRadius}=this.attribute;const{outerPadding:u=t.outerPadding,innerPadding:c=t.innerPadding}=this.attribute;h+=u,d-=c;const g=Math.abs(h-d)/2,p=g/h;if(g>$t&&h>$t)return{startAngle:e-s*p*a,endAngle:i+s*p*l,sc:s*p*a,ec:s*p*l}}return{startAngle:e,endAngle:i}}getParsePadAngle(t,e){const i=this.getGraphicTheme(),{innerPadding:r=i.innerPadding,outerPadding:s=i.outerPadding,padAngle:o=i.padAngle}=this.attribute;let{outerRadius:a=i.outerRadius,innerRadius:l=i.innerRadius}=this.attribute;a+=s,l-=r;const{padRadius:h=Rn(a*a+l*l)}=this.attribute,d=Et(e-t);let u=t,c=e,g=t,p=e;const f=o/2;let m=d,v=d;if(f>$t&&h>$t){const _=e>t?1:-1;let b=ZC(Number(h)/l*ee(f)),y=ZC(Number(h)/a*ee(f));return(m-=2*b)>$t?(b*=_,g+=b,p-=b):(m=0,g=p=(t+e)/2),(v-=2*y)>$t?(y*=_,u+=y,c-=y):(v=0,u=c=(t+e)/2),{outerStartAngle:u,outerEndAngle:c,innerStartAngle:g,innerEndAngle:p,innerDeltaAngle:m,outerDeltaAngle:v}}return{outerStartAngle:u,outerEndAngle:c,innerStartAngle:g,innerEndAngle:p,innerDeltaAngle:m,outerDeltaAngle:v}}getGraphicTheme(){return ne(this).arc}updateAABBBounds(t,e,i,r){this.updatePathProxyAABBBounds(i)||(r?this.updateArcAABBBoundsImprecise(t,e,i):this.updateArcAABBBoundsAccurate(t,e,i));const{tb1:s,tb2:o}=bt.graphicService.updateTempAABBBounds(i);pb(t,e,s),i.union(s),s.setValue(o.x1,o.y1,o.x2,o.y2),this.setWidthHeightWithoutTransform(i);const{lineJoin:a=e.lineJoin}=t;return bt.graphicService.transformAABBBounds(t,i,e,a==="miter",this),i}updateArcAABBBoundsImprecise(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:s=e.innerRadius}=t;const{outerPadding:o=e.outerPadding,innerPadding:a=e.innerPadding}=t;return r+=o,s-=a,r<s&&(r=s),i.set(-r,-r,r,r),i}updateArcAABBBoundsAccurate(t,e,i){let{outerRadius:r=e.outerRadius,innerRadius:s=e.innerRadius}=t;const{outerPadding:o=e.outerPadding,innerPadding:a=e.innerPadding}=t;if(r+=o,s-=a,r<s){const d=r;r=s,s=d}let{endAngle:l=e.endAngle,startAngle:h=e.startAngle}=t;if(h>l){const d=h;h=l,l=d}return r<=$t?i.set(0,0,0,0):Math.abs(l-h)>Ft-$t?i.set(-r,-r,r,r):(UL(h,l,r,i),UL(h,l,s,i)),i}needUpdateTags(t){return super.needUpdateTags(t,HG)}needUpdateTag(t){return super.needUpdateTag(t,HG)}toCustomPath(){var t,e,i,r;const s=this.attribute,{startAngle:o,endAngle:a}=this.getParsedAngle();let l=((t=s.innerRadius)!==null&&t!==void 0?t:0)-((e=s.innerPadding)!==null&&e!==void 0?e:0),h=((i=s.outerRadius)!==null&&i!==void 0?i:0)-((r=s.outerPadding)!==null&&r!==void 0?r:0);const d=Et(a-o),u=a>o;if(h<l){const g=h;h=l,l=g}const c=new Cn;if(h<=$t)c.moveTo(0,0);else if(d>=Ft-$t)c.moveTo(0+h*me(o),0+h*ee(o)),c.arc(0,0,h,o,a,!u),l>$t&&(c.moveTo(0+l*me(a),0+l*ee(a)),c.arc(0,0,l,a,o,u));else{const g=h*me(o),p=h*ee(o),f=l*me(a),m=l*ee(a);c.moveTo(0+g,0+p),c.arc(0,0,h,o,a,!u),c.lineTo(0+f,0+m),c.arc(0,0,l,a,o,u),c.closePath()}return c}clone(){return new gf(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return gf.NOWORK_ANIMATE_ATTR}}gf.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},ar);function rF(n){return new gf(n)}class ZM extends gf{constructor(t){super(t),this.type="arc3d",this.numberType=NM}updateAABBBounds(t,e,i){const r=this.stage;if(!r||!r.camera)return i;const{outerRadius:s=e.outerRadius,height:o=0}=t,a=s+o;return i.setValue(-a,-a,a,a),bt.graphicService.updateTempAABBBounds(i),bt.graphicService.transformAABBBounds(t,i,e,!1,this),i}getNoWorkAnimateAttr(){return ZM.NOWORK_ANIMATE_ATTR}}ZM.NOWORK_ANIMATE_ATTR=Object.assign({cap:1},ar);function OQ(n){return new ZM(n)}const zG=["points","cornerRadius",...$s];class pf extends kn{constructor(t){super(t),this.type="polygon",this.numberType=UM}isValid(){return super.isValid()&&this._isValid()}_isValid(){const{points:t}=this.attribute;return t&&t.length>=2}getGraphicTheme(){return ne(this).polygon}updateAABBBounds(t,e,i){this.updatePathProxyAABBBounds(i)||this.updatePolygonAABBBoundsImprecise(t,e,i),bt.graphicService.updateTempAABBBounds(i),this.widthWithoutTransform=i.x2-i.x1,this.heightWithoutTransform=i.y2-i.y1;const{lineJoin:r=e.lineJoin}=t;return bt.graphicService.transformAABBBounds(t,i,e,r==="miter",this),i}updatePolygonAABBBoundsImprecise(t,e,i){const{points:r=e.points}=t;return r.forEach(s=>{i.add(s.x,s.y)}),i}_interpolate(t,e,i,r,s){t==="points"&&(s.points=WD(i,r,e))}needUpdateTags(t){return super.needUpdateTags(t,zG)}needUpdateTag(t){return super.needUpdateTag(t,zG)}toCustomPath(){const t=this.attribute.points,e=new Cn;return t.forEach((i,r)=>{r===0?e.moveTo(i.x,i.y):e.lineTo(i.x,i.y)}),e.closePath(),e}clone(){return new pf(Object.assign({},this.attribute))}getNoWorkAnimateAttr(){return pf.NOWORK_ANIMATE_ATTR}}pf.NOWORK_ANIMATE_ATTR=ar;function DQ(n){return new pf(n)}class JM extends pf{constructor(t){super(t),this.type="pyramid3d",this.numberType=VD}updateAABBBounds(t,e,i){const r=this.stage;return!r||!r.camera||(this.findFace().vertices.forEach(s=>{const o=s[0],a=s[1];i.add(o,a)}),bt.graphicService.updateTempAABBBounds(i),bt.graphicService.transformAABBBounds(t,i,e,!1,this)),i}findFace(){const{points:t}=this.attribute,e=t.map((a,l)=>{const h=l===3?t[0]:t[l+1],d=a.x-h.x;return d===0?0:(a.y-h.y)/d}),i=t.map(a=>({p:a,d:0}));let r=!1,s=0;for(let a=0;a<e.length-1;a++){for(let l=a+1;l<e.length;l++){if(e[a]===e[l]){r=!0;const h=hi.distancePP(i[a].p,i[a+1].p);i[a].d=h,i[a+1].d=h,s=ti(s,h);const d=hi.distancePP(i[l].p,i[l+1].p);i[l].d=d,i[l+1].d=d,s=ti(s,d)}if(r)break}if(r)break}for(let a=t.length-1;a>=0;a--){const l=t[a];i.unshift({p:l,d:0})}for(let a=0;a<t.length;a++){const l=(s-i[a+t.length].d)/2;i[a].d+=l,i[a+t.length].d+=l}const o={polygons:[],vertices:[],edges:[]};return i.forEach(a=>{o.vertices.push([a.p.x,a.p.y,a.d])}),o.polygons.push({polygon:[0,4,5,1],normal:[0,-1,0]}),o.polygons.push({polygon:[7,6,2,3],normal:[0,1,0]}),o.polygons.push({polygon:[0,4,7,3],normal:[-1,0,0]}),o.polygons.push({polygon:[1,5,6,2],normal:[1,0,0]}),o.polygons.push({polygon:[0,1,2,3],normal:[0,0,-1]}),o.polygons.push({polygon:[4,5,6,7],normal:[0,0,1]}),o.edges=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[3,7],[1,5],[2,6]],o}_isValid(){return super._isValid()&&this.attribute.points.length===4}getNoWorkAnimateAttr(){return JM.NOWORK_ANIMATE_ATTR}}JM.NOWORK_ANIMATE_ATTR=ar;function FQ(n){return new JM(n)}class rEt extends $f{constructor(t){super({x:0,y:0}),this.type="shadowroot",this.shadowHost=t}clearUpdateBoundTag(){super.clearUpdateBoundTag(),this.shadowHost&&this.shadowHost.clearUpdateBoundTag()}addUpdateBoundTag(){super.addUpdateBoundTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}addUpdateShapeAndBoundsTag(){super.addUpdateShapeAndBoundsTag(),this.shadowHost&&this.shadowHost.addUpdateBoundTag()}tryUpdateGlobalTransMatrix(t=!0){if(this.shouldUpdateGlobalMatrix()){const e=this.transMatrix;this._globalTransMatrix?this._globalTransMatrix.setValue(e.a,e.b,e.c,e.d,e.e,e.f):this._globalTransMatrix=e.clone(),this.doUpdateGlobalMatrix(),t&&this.clearUpdateGlobalPositionTag()}return this._globalTransMatrix}doUpdateGlobalMatrix(){if(this.shadowHost){const t=this.shadowHost.globalTransMatrix;this._globalTransMatrix.multiply(t.a,t.b,t.c,t.d,t.e,t.f)}}tryUpdateGlobalAABBBounds(){return this._globalAABBBounds?this._globalAABBBounds.setValue(this._AABBBounds.x1,this._AABBBounds.y1,this._AABBBounds.x2,this._AABBBounds.y2):this._globalAABBBounds=this._AABBBounds.clone(),this.shadowHost&&this._globalAABBBounds.transformWithMatrix(this.shadowHost.globalTransMatrix),this._globalAABBBounds}}function sEt(n){return new rEt(n)}class oEt{constructor(){this.store=new Map}RegisterGraphicCreator(t,e){this.store.set(t,e),this[t]=e}CreateGraphic(t,e){const i=this.store.get(t);return i?i(e):null}}const Pt=new oEt;let Vy,Gy;function QM(n){return Vy||(Vy=Pt.CreateGraphic("text",{})),Vy.initAttributes(n),Vy.AABBBounds}function aEt(n){return Gy||(Gy=Pt.CreateGraphic("richtext",{})),Gy.setAttributes(n),Gy.AABBBounds}var lEt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},hEt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},WG=function(n,t){return function(e,i){t(e,i,n)}};class tT{constructor(){this.time=cn.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){var p;const{background:f,backgroundOpacity:m=(p=t.attribute.fillOpacity)!==null&&p!==void 0?p:h.backgroundOpacity,opacity:v=h.opacity,backgroundMode:_=h.backgroundMode,backgroundFit:b=h.backgroundFit,backgroundKeepAspectRatio:y=h.backgroundKeepAspectRatio,backgroundScale:C=h.backgroundScale,backgroundOffsetX:S=h.backgroundOffsetX,backgroundOffsetY:w=h.backgroundOffsetY,backgroundClip:x=h.backgroundClip}=t.attribute;if(f)if(t.backgroundImg&&t.resources){const A=t.resources.get(f);if(A.state!=="success"||!A.data)return;if(e.save(),t.parent&&!t.transMatrix.onlyTranslate()){const T=ne(t.parent).group,{scrollX:R=T.scrollX,scrollY:B=T.scrollY}=t.parent.attribute;e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.translate(R,B)}x&&e.clip();const M=t.AABBBounds;e.setCommonStyle(t,t.attribute,i,r,h),e.globalAlpha=m*v,this.doDrawImage(e,A.data,M,{backgroundMode:_,backgroundFit:b,backgroundKeepAspectRatio:y,backgroundScale:C,backgroundOffsetX:S,backgroundOffsetY:w}),e.restore(),t.transMatrix.onlyTranslate()||e.setTransformForCurrent()}else e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.globalAlpha=m*v,e.fillStyle=f,e.fill(),e.highPerformanceRestore()}doDrawImage(t,e,i,r){const{backgroundMode:s,backgroundFit:o,backgroundKeepAspectRatio:a,backgroundScale:l=1,backgroundOffsetX:h=0,backgroundOffsetY:d=0}=r,u=i.width(),c=i.height();let g=u,p=c;if(s==="no-repeat")if(o)if(a){const f=Math.max(u/e.width,c/e.height);t.drawImage(e,i.x1+h,i.y1+d,e.width*f*l,e.height*f*l)}else t.drawImage(e,i.x1,i.y1,i.width(),i.height());else{const f=e.width*l,m=e.height*l;t.drawImage(e,i.x1+h,i.y1+d,f,m)}else{if(o&&s!=="repeat"&&(e.width||e.height)){const v=e.width,_=e.height;s==="repeat-x"?(g=v*(c/_),p=c):s==="repeat-y"&&(p=_*(u/v),g=u);const b=t.dpr,y=tc.allocate({width:g,height:p,dpr:b}),C=y.getContext("2d");C&&(C.inuse=!0,C.clearMatrix(),C.setTransformForCurrent(!0),C.clearRect(0,0,g,p),C.drawImage(e,0,0,g,p),e=y.nativeCanvas),tc.free(y)}const f=t.dpr,m=t.createPattern(e,s);m.setTransform&&m.setTransform(new DOMMatrix([1/f,0,0,1/f,0,0])),t.fillStyle=m,t.translate(i.x1,i.y1),t.fillRect(0,0,u,c),t.translate(-i.x1,-i.y1)}}}const Ud=new tT;let Mo=class{constructor(n){this.subRenderContribitions=n,this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){this._subRenderContribitions||(this._subRenderContribitions=this.subRenderContribitions.getContributions()),this._subRenderContribitions.forEach(g=>{g.render(n,t,e,i,r,s,o,a,l,h,d,u,c)})}};Mo=lEt([It(),WG(0,ue(en)),WG(0,xn(JD)),hEt("design:paramtypes",[Object])],Mo);class dEt{constructor(){this.time=cn.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){var p,f;const{clipConfig:m}=t.attribute;if(!m)return;const v=t.getClipPath();if(!v)return;const _=!(u||c),b=t.AABBBounds,y=(p=t.attribute.width)!==null&&p!==void 0?p:b.width(),C=(f=t.attribute.height)!==null&&f!==void 0?f:b.height();_&&e.save(),e.beginPath(),v.draw(e,[y,C],i+y/2,r+C/2,0)===!1&&e.closePath(),u&&u(e,t.attribute,h,!0),_&&e.clip()}}const uEt=new dEt;class cEt{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){const{clipConfig:p}=t.attribute;p&&t.getClipPath()&&(u||c||e.restore())}}const gEt=new cEt;function pEt(n){return n<=.5?4*n-1:-4*n+3}function fEt(n,t,e,i,r,s,o){const{fill:a="orange",percent:l=.6,frequency:h=4,opacity:d,phi:u=0}=r;let{amplitude:c=10}=r;c*=pEt(t);const g=i*(1-l),p=e,f=Math.max(Math.round(p/70),2);n.beginPath(),n.moveTo(0+s,i+o),n.lineTo(0+s,g+o);const m=p/h*t,v=p/Math.PI/(2*h);for(let _=0;_<p;_+=f){const b=c*Math.sin((_+m+u)/v+u);n.lineTo(_+s,g+b+o)}n.lineTo(p+s,i+o),n.closePath(),n.fillStyle=a,isFinite(d)&&(n.globalAlpha=d),n.fill()}class sF{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=10,this._tempSymbolGraphic=null}createCommonPattern(t,e,i,r,s){const o=(t-2*e)/2,a=r.dpr,l=tc.allocate({width:t,height:t,dpr:a}),h=l.getContext("2d");if(!h)return null;h.inuse=!0,h.clearMatrix(),h.setTransformForCurrent(!0),h.clearRect(0,0,t,t),s(o,h);const d=r.createPattern(l.nativeCanvas,"repeat");return d.setTransform&&d.setTransform(new DOMMatrix([1/a,0,0,1/a,0,0])),tc.free(l),d}createCirclePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{o.fillStyle=i,o.arc(s,s,s,0,Ft),o.fill()})}createDiamondPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=t/2,l=a;o.fillStyle=i,o.moveTo(a,l-s),o.lineTo(s+a,l),o.lineTo(a,l+s),o.lineTo(a-s,l),o.closePath(),o.fill()})}createRectPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e,l=a;o.fillStyle=i,o.fillRect(a,l,2*s,2*s)})}createVerticalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e;o.fillStyle=i,o.fillRect(a,0,2*s,t)})}createHorizontalLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e;o.fillStyle=i,o.fillRect(0,a,t,2*s)})}createBiasLRLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{o.strokeStyle=i,o.lineWidth=s,o.moveTo(0,0),o.lineTo(t,t);const a=t/2,l=-a;o.moveTo(a,l),o.lineTo(a+t,l+t),o.moveTo(-a,-l),o.lineTo(-a+t,-l+t),o.stroke()})}createBiasRLLinePattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{o.strokeStyle=i,o.lineWidth=s,o.moveTo(t,0),o.lineTo(0,t);const a=t/2,l=a;o.moveTo(t+a,l),o.lineTo(a,l+t),o.moveTo(t-a,-l),o.lineTo(-a,-l+t),o.stroke()})}createGridPattern(t,e,i,r){return this.createCommonPattern(t,e,i,r,(s,o)=>{const a=e,l=a;o.fillStyle=i,o.fillRect(a,l,s,s),o.fillRect(a+s,l+s,s,s)})}initTextureMap(t,e){this.textureMap=new Map}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){this.textureMap||this.initTextureMap(e,t.stage);const{texture:p=h.texture,textureColor:f=h.textureColor,textureSize:m=h.textureSize,texturePadding:v=h.texturePadding}=t.attribute;p&&this.drawTexture(p,t,e,i,r,h,f,m,v)}drawTexture(t,e,i,r,s,o,a,l,h){var d;const{textureRatio:u=o.textureRatio,textureOptions:c=null}=e.attribute;let g=this.textureMap.get(t);if(!g)switch(t){case"circle":g=this.createCirclePattern(l,h,a,i);break;case"diamond":g=this.createDiamondPattern(l,h,a,i);break;case"rect":g=this.createRectPattern(l,h,a,i);break;case"vertical-line":g=this.createVerticalLinePattern(l,h,a,i);break;case"horizontal-line":g=this.createHorizontalLinePattern(l,h,a,i);break;case"bias-lr":g=this.createBiasLRLinePattern(l,h,a,i);break;case"bias-rl":g=this.createBiasRLLinePattern(l,h,a,i);break;case"grid":g=this.createGridPattern(l,h,a,i)}if(c&&c.dynamicTexture){const{gridConfig:p={},useNewCanvas:f}=c,m=e.AABBBounds;r=m.x1,s=m.y1;const v=i;let _;if(f){_=tc.allocate({width:m.width(),height:m.height(),dpr:i.dpr});const E=_.getContext("2d");E.clearRect(0,0,m.width(),m.height()),r=0,s=0,i=E}if(v.save(),e.parent&&!e.transMatrix.onlyTranslate()){const{scrollX:E=0,scrollY:k=0}=e.parent.attribute;v.setTransformFromMatrix(e.parent.globalTransMatrix),v.translate(E,k,!0)}v.setCommonStyle(e,e.attribute,r,s,o),v.clip();const b=m.width(),y=m.height(),C=h,S=l,w=p.columns?p.columns:Math.ceil(b/S),x=p.rows?p.rows:Math.ceil(y/S),A=p.gutterColumn?p.gutterColumn:2*C,M=p.gutterRow?p.gutterRow:2*C;this._tempSymbolGraphic||(this._tempSymbolGraphic=fb({}));const T=p.columns?b/p.columns:S,R=p.rows?y/p.rows:S;this._tempSymbolGraphic.setAttributes({size:[T-A,R-M],symbolType:t});const B=this._tempSymbolGraphic.getParsedPath();for(let E=0;E<x;E++)for(let k=0;k<w;k++){const P=r+S/2+k*S,I=s+S/2+E*S;(d=c.beforeDynamicTexture)===null||d===void 0||d.call(c,i,E,k,x,w,u,e,m.width(),m.height()),i.beginPath(),B.draw(i,Math.min(T-A,R-M),P,I,0)===!1&&i.closePath(),i.fillStyle=a,c.dynamicTexture(i,E,k,x,w,u,e,m.width(),m.height())}f&&(v.globalAlpha=1,v.drawImage(_.nativeCanvas,0,0,_.nativeCanvas.width,_.nativeCanvas.height,m.x1,m.y1,m.width()*v.dpr,m.height()*v.dpr)),v.restore()}else if(g)i.highPerformanceSave(),i.setCommonStyle(e,e.attribute,r,s,o),i.fillStyle=g,i.fill(),i.highPerformanceRestore();else if(t==="wave"){i.save(),i.setCommonStyle(e,e.attribute,r,s,o),i.clip();const p=e.AABBBounds;fEt(i,u,p.width(),p.height(),Object.assign(Object.assign({},c||{}),{fill:a}),r+p.x1-r,s+p.y1-s),i.restore()}}}const Vf=new sF;class mEt{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&g.visible!==!1,m=p&&p.visible!==!1;if(!f&&!m)return;const{innerPadding:v=h.innerPadding,outerPadding:_=h.outerPadding,startAngle:b=h.startAngle,endAngle:y=h.endAngle,opacity:C=h.opacity,x:S=h.x,y:w=h.y,scaleX:x=h.scaleX,scaleY:A=h.scaleY,keepStrokeScale:M=h.keepStrokeScale}=t.attribute;let{innerRadius:T=h.innerRadius,outerRadius:R=h.outerRadius}=t.attribute;R+=_,T-=v;const B=(E,k)=>{const P=!(!E||!E.stroke),{distance:I=h[k].distance}=E,O=M?I:ch(e,I,e.dpr),H=I/R,z=k==="outerBorder"?1:-1;if(t.setAttributes({outerRadius:R+z*O,innerRadius:T-z*O,startAngle:b-z*H,endAngle:y+z*H}),e.beginPath(),ZL(t,e,i,r,R+z*O,T-z*O),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,E,h[k]);else if(P){const F=h[k].opacity;h[k].opacity=C,e.setStrokeStyle(t,E,(S-i)/x,(w-r)/A,h[k]),h[k].opacity=F,e.stroke()}};f&&B(g,"outerBorder"),m&&B(p,"innerBorder"),t.setAttributes({outerRadius:R,innerRadius:T,startAngle:b,endAngle:y})}}const vEt=new mEt,_Et=Vf,bEt=Ud;class yEt{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&g.visible!==!1,m=p&&p.visible!==!1;if(!f&&!m)return;const{radius:v=h.radius,startAngle:_=h.startAngle,endAngle:b=h.endAngle,opacity:y=h.opacity,x:C=h.x,y:S=h.y,scaleX:w=h.scaleX,scaleY:x=h.scaleY,keepStrokeScale:A=h.keepStrokeScale}=t.attribute,M=(T,R)=>{const B=!(!T||!T.stroke),{distance:E=h[R].distance}=T,k=A?E:ch(e,E,e.dpr),P=R==="outerBorder"?1:-1;if(e.beginPath(),e.arc(i,r,v+P*k,_,b),e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,T,h[R]);else if(B){const I=h[R].opacity;h[R].opacity=y,e.setStrokeStyle(t,T,(C-i)/w,(S-r)/x,h[R]),h[R].opacity=I,e.stroke()}};f&&M(g,"outerBorder"),m&&M(p,"innerBorder")}}const CEt=new yEt,SEt=Vf,xEt=Ud;class wEt extends tT{constructor(){super(...arguments),this.time=cn.beforeFillStroke}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{background:g,backgroundMode:p=h.backgroundMode,backgroundFit:f=h.backgroundFit,backgroundKeepAspectRatio:m=h.backgroundKeepAspectRatio,backgroundScale:v=h.backgroundScale,backgroundOffsetX:_=h.backgroundOffsetX,backgroundOffsetY:b=h.backgroundOffsetY}=t.attribute;if(g)if(t.backgroundImg&&t.resources){const y=t.resources.get(g);if(y.state!=="success"||!y.data)return;e.highPerformanceSave(),e.setTransformFromMatrix(t.parent.globalTransMatrix,!0);const C=t.AABBBounds;this.doDrawImage(e,y.data,C,{backgroundMode:p,backgroundFit:f,backgroundKeepAspectRatio:m,backgroundScale:v,backgroundOffsetX:_,backgroundOffsetY:b}),e.highPerformanceRestore(),e.setTransformForCurrent()}else e.highPerformanceSave(),e.fillStyle=g,e.fill(),e.highPerformanceRestore()}}const AEt=new wEt,Uy=Kt/2;function Xc(n,t,e,i,r,s,o=!0,a){let l;if(Array.isArray(o)&&(a=o,o=!0),i<0&&(t+=i,i=-i),r<0&&(e+=r,r=-r),J(s,!0))l=[s=Et(s),s,s,s];else if(Array.isArray(s)){const w=s;let x,A;switch(w.length){case 0:l=[0,0,0,0];break;case 1:x=Et(w[0]),l=[x,x,x,x];break;case 2:case 3:x=Et(w[0]),A=Et(w[1]),l=[x,A,x,A];break;default:l=w,l[0]=Et(l[0]),l[1]=Et(l[1]),l[2]=Et(l[2]),l[3]=Et(l[3])}}else l=[0,0,0,0];if(i<0||l[0]+l[1]+l[2]+l[3]<1e-12)return n.rect(t,e,i,r);const[h,d,u,c]=[[t,e],[t+i,e],[t+i,e+r],[t,e+r]],g=Math.min(i/2,r/2),p=[Math.min(g,l[0]),Math.min(g,l[1]),Math.min(g,l[2]),Math.min(g,l[3])],f=[h[0]+p[0],h[1]],m=[h[0],h[1]+p[0]],v=[d[0]-p[1],d[1]],_=[d[0],d[1]+p[1]],b=[u[0]-p[2],u[1]],y=[u[0],u[1]-p[2]],C=[c[0]+p[3],c[1]],S=[c[0],c[1]-p[3]];if(n.moveTo(f[0],f[1]),o){if(a&&a[0]?a[0](f[0],f[1],v[0],v[1]):n.lineTo(v[0],v[1]),!Hl(v,_)){a&&a[0]&&n.moveTo(v[0],v[1]);const w=v[0],x=v[1]+p[1];n.arc(w,x,p[1],-Uy,0,!1)}if(a&&a[1]?a[1](_[0],_[1],y[0],y[1]):n.lineTo(y[0],y[1]),!Hl(b,y)){const w=y[0]-p[2],x=y[1];a&&a[1]&&n.moveTo(y[0],y[1]),n.arc(w,x,p[2],0,Uy,!1)}if(a&&a[2]?a[2](b[0],b[1],C[0],C[1]):n.lineTo(C[0],C[1]),!Hl(C,S)){const w=C[0],x=C[1]-p[3];a&&a[2]&&n.moveTo(C[0],C[1]),n.arc(w,x,p[3],Uy,Kt,!1)}if(a&&a[3]?a[3](S[0],S[1],m[0],m[1]):n.lineTo(m[0],m[1]),!Hl(f,m)){const w=f[0],x=f[1]+p[0];a&&a[3]&&n.moveTo(m[0],m[1]),n.arc(w,x,p[0],Kt,Kt+Uy,!1)}}else a&&a[0]?a[0](f[0],f[1],v[0],v[1]):n.lineTo(v[0],v[1]),a&&a[1]?a[1](v[0],v[1],b[0],b[1]):n.lineTo(b[0],b[1]),a&&a[2]?a[2](b[0],b[1],C[0],C[1]):n.lineTo(C[0],C[1]),a&&a[2]?a[2](C[0],C[1],f[0],f[1]):n.lineTo(f[0],f[1]);return!a&&n.closePath(),n}var HQ=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};class zQ{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const{outerBorder:g,innerBorder:p}=t.attribute,f=g&&g.visible!==!1,m=p&&p.visible!==!1;if(!f&&!m)return;const{cornerRadius:v=h.cornerRadius,cornerType:_=h.cornerType,opacity:b=h.opacity,x:y=h.x,y:C=h.y,scaleX:S=h.scaleX,scaleY:w=h.scaleY,x1:x,y1:A,keepStrokeScale:M=h.keepStrokeScale}=t.attribute;let{width:T,height:R}=t.attribute;T=(T??x-i)||0,R=(R??A-r)||0;const B=(E,k)=>{const P=!(!E||!E.stroke),I=k==="outerBorder"?-1:1,{distance:O=h[k].distance}=E,H=M?O:ch(e,O,e.dpr),z=i+I*H,F=r+I*H,j=2*H;if(v===0||V(v)&&v.every($=>$===0)?(e.beginPath(),e.rect(z,F,T-I*j,R-I*j)):(e.beginPath(),Xc(e,z,F,T-I*j,R-I*j,v,_!=="bevel")),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,E,h[k]);else if(P){const $=h[k].opacity;h[k].opacity=b,e.setStrokeStyle(t,E,(y-i)/S,(C-r)/w,h[k]),h[k].opacity=$,e.stroke()}};f&&B(g,"outerBorder"),m&&B(p,"innerBorder")}}let B1=class{constructor(){this.time=cn.beforeFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u,c){const{stroke:g=l.stroke}=n.attribute;Array.isArray(g)&&g.some(p=>p===!1)&&(c.doStroke=!1)}};B1=HQ([It()],B1);let P1=class{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(n,t,e,i,r,s,o,a,l,h,d,u){const{x1:c,y1:g,x:p=l.x,y:f=l.y,stroke:m=l.stroke,cornerRadius:v=l.cornerRadius,cornerType:_=l.cornerType}=n.attribute;let{width:b,height:y}=n.attribute;if(b=(b??c-p)||0,y=(y??g-f)||0,Array.isArray(m)&&m.some(C=>C===!1)){if(t.setStrokeStyle(n,n.attribute,e,i,l),!(v===0||V(v)&&v.every(C=>C===0))){let C,S=0;return Xc(t,e,i,b,y,v,_!=="bevel",new Array(4).fill(0).map((w,x)=>(A,M,T,R)=>{m[x]&&(S===x-1&&m[x]===C||(t.setStrokeStyle(n,Object.assign(Object.assign({},n.attribute),{stroke:m[x]}),e,i,l),t.beginPath(),t.moveTo(A,M),C=m[x]),S=x,t.lineTo(T,R),t.stroke(),x===3&&t.beginPath())})),void t.stroke()}if(t.beginPath(),t.moveTo(e,i),m[0]?t.lineTo(e+b,i):t.moveTo(e+b,i),m[1]?t.lineTo(e+b,i+y):t.moveTo(e+b,i+y),m[2]?t.lineTo(e,i+y):t.moveTo(e,i+y),m[3]){const C=m[0]?i-t.lineWidth/2:i;t.lineTo(e,C)}else t.moveTo(e,i);t.stroke()}}};P1=HQ([It()],P1);const MEt=new zQ,TEt=Vf,kEt=Ud;class REt extends zQ{constructor(){super(...arguments),this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){return super.drawShape(t,e,i,r,s,o,a,l,h,d,u,c)}}const BEt=new REt,PEt=Ud;class EEt{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){const g=t.getParsedPath();if(!g)return;const{outerBorder:p,innerBorder:f}=t.attribute,m=p&&p.visible!==!1,v=f&&f.visible!==!1;if(!m&&!v)return;const{size:_=h.size,opacity:b=h.opacity,x:y=h.x,y:C=h.y,scaleX:S=h.scaleX,scaleY:w=h.scaleY,keepStrokeScale:x=h.keepStrokeScale}=t.attribute,A=(M,T)=>{const R=!(!M||!M.stroke),{distance:B=h[T].distance}=M,E=x?B:ch(e,B,e.dpr),k=T==="outerBorder"?1:-1;if(e.beginPath(),g.drawOffset(e,_,i,r,k*E)===!1&&e.closePath(),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),c)c(e,M,h[T]);else if(R){const P=h[T].opacity;h[T].opacity=b,e.setStrokeStyle(t,M,(y-i)/S,(C-r)/w,h[T]),h[T].opacity=P,e.stroke()}};m&&A(p,"outerBorder"),v&&A(f,"innerBorder")}}class LEt{constructor(){this.time=cn.afterFillStroke,this.useStyle=!0,this.order=0}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){const{clipRange:p=h.clipRange,x:f=h.x,y:m=h.y,z:v=h.z,size:_=h.size,scaleX:b=h.scaleX,scaleY:y=h.scaleY}=t.attribute,C=t.getParsedPath();C&&p<1&&p>0&&(e.beginPath(),C.drawWithClipRange&&C.drawWithClipRange(e,_,i,r,p,v,(S,w)=>{var x,A,M,T;if(t._parsedPath.svgCache){const R=Object.assign({},w);R.fill=(x=w.fill)!==null&&x!==void 0?x:t.attribute.fill,R.opacity=(A=w.opacity)!==null&&A!==void 0?A:t.attribute.opacity,R.fillOpacity=t.attribute.fillOpacity,R.stroke=(M=w.stroke)!==null&&M!==void 0?M:t.attribute.stroke,R.lineWidth=(T=w.lineWidth)!==null&&T!==void 0?T:t.attribute.lineWidth,w=R}w.stroke&&(c?c(e,t.attribute,h):l&&(e.setStrokeStyle(t,w,(f-i)/b,(m-r)/y,h),e.stroke()))}),o&&!C.isSvg&&(c?c(e,t.attribute,h):l&&(e.setStrokeStyle(t,t.attribute,(f-i)/b,(m-r)/y,h),e.stroke())))}}const IEt=new EEt,OEt=new LEt,DEt=Vf,FEt=Ud;class HEt extends sF{constructor(){super(...arguments),this.time=cn.afterFillStroke}drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g){var p,f,m,v;this.textureMap||this.initTextureMap(e,t.stage);const{attribute:_=t.attribute}=g||{},{texture:b=(p=t.attribute.texture)!==null&&p!==void 0?p:jy(h,"texture"),textureColor:y=(f=t.attribute.textureColor)!==null&&f!==void 0?f:jy(h,"textureColor"),textureSize:C=(m=t.attribute.textureSize)!==null&&m!==void 0?m:jy(h,"textureSize"),texturePadding:S=(v=t.attribute.texturePadding)!==null&&v!==void 0?v:jy(h,"texturePadding")}=_;b&&this.drawTexture(b,t,e,i,r,h,y,C,S)}}const sn={x:0,y:0,z:0,lastModelMatrix:null};class Nr{init(t){t&&(this._renderContribitions=t.getContributions()),this._renderContribitions||(this._renderContribitions=[]),this.builtinContributions||(this.builtinContributions=[]),this.builtinContributions.push(uEt),this.builtinContributions.push(gEt),this.builtinContributions.forEach(e=>this._renderContribitions.push(e)),this._renderContribitions.length&&(this._renderContribitions.sort((e,i)=>i.order-e.order),this._beforeRenderContribitions=this._renderContribitions.filter(e=>e.time===cn.beforeFillStroke),this._afterRenderContribitions=this._renderContribitions.filter(e=>e.time===cn.afterFillStroke))}beforeRenderStep(t,e,i,r,s,o,a,l,h,d,u,c,g){this._beforeRenderContribitions&&this._beforeRenderContribitions.forEach(p=>{p.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(p.supportedAppName)?p.supportedAppName:[p.supportedAppName]).includes(t.stage.params.context.appName)||p.drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g)})}afterRenderStep(t,e,i,r,s,o,a,l,h,d,u,c,g){this._afterRenderContribitions&&this._afterRenderContribitions.forEach(p=>{p.supportedAppName&&t.stage&&t.stage.params&&t.stage.params.context&&t.stage.params.context.appName&&!(Array.isArray(p.supportedAppName)?p.supportedAppName:[p.supportedAppName]).includes(t.stage.params.context.appName)||p.drawShape(t,e,i,r,s,o,a,l,h,d,u,c,g)})}drawPathProxy(t,e,i,r,s,o,a,l){if(!t.pathProxy)return!1;const h=ne(t,o==null?void 0:o.theme)[t.type.replace("3d","")],{fill:d=h.fill,stroke:u=h.stroke,opacity:c=h.opacity,fillOpacity:g=h.fillOpacity,lineWidth:p=h.lineWidth,strokeOpacity:f=h.strokeOpacity,visible:m=h.visible,x:v=h.x,y:_=h.y}=t.attribute,b=wc(c,g,d),y=qL(c,f),C=xc(d),S=df(u,p);if(!m||!C&&!S||!(b||y||a||l))return!0;e.beginPath();const w=typeof t.pathProxy=="function"?t.pathProxy(t.attribute):t.pathProxy;return ih(w.commandList,e,i,r),e.setShadowBlendStyle&&e.setShadowBlendStyle(t,t.attribute,h),this.beforeRenderStep(t,e,i,r,C,S,b,y,h,s,a,l),S&&(l?l(e,t.attribute,h):y&&(e.setStrokeStyle(t,t.attribute,i-v,r-_,h),e.stroke())),C&&(a?a(e,t.attribute,h):b&&(e.setCommonStyle(t,t.attribute,i-v,r-_,h),e.fill())),this.afterRenderStep(t,e,i,r,C,S,b,y,h,s,a,l),!0}valid(t,e,i,r){const{fill:s=e.fill,background:o,stroke:a=e.stroke,opacity:l=e.opacity,fillOpacity:h=e.fillOpacity,lineWidth:d=e.lineWidth,strokeOpacity:u=e.strokeOpacity,visible:c=e.visible}=t.attribute,g=wc(l,h,s),p=qL(l,u),f=xc(s,o),m=df(a,d);return!(!t.valid||!c)&&!(!f&&!m)&&!!(g||p||i||r||o)&&{fVisible:g,sVisible:p,doFill:f,doStroke:m}}transform(t,e,i,r=!1){const{x:s=e.x,y:o=e.y,z:a=e.z,scaleX:l=e.scaleX,scaleY:h=e.scaleY,angle:d=e.angle,postMatrix:u}=t.attribute,c=i.modelMatrix,g=i.camera;sn.x=s,sn.y=o,sn.z=a,sn.lastModelMatrix=c;const p=g&&(r||ZPt(t)),f=p?t.transMatrix.onlyTranslate()&&!u:l===1&&h===1&&d===0&&!u;if(p){const m=ki.allocate(),v=ki.allocate();kQ(v,t,e),Ac(m,c||m,v),sn.x=0,sn.y=0,sn.z=0,i.modelMatrix=m,i.setTransform(1,0,0,1,0,0,!0),ki.free(v)}if(f&&!c){const m=t.getOffsetXY(e);sn.x+=m.x,sn.y+=m.y,sn.z=a,i.setTransformForCurrent()}else if(p)sn.x=0,sn.y=0,sn.z=0,i.setTransform(1,0,0,1,0,0,!0);else if(g&&i.project){const m=t.getOffsetXY(e);sn.x+=m.x,sn.y+=m.y,this.transformWithoutTranslate(i,sn.x,sn.y,sn.z,l,h,d)}else i.transformFromMatrix(t.transMatrix,!0),sn.x=0,sn.y=0,sn.z=0;return sn}transformUseContext2d(t,e,i,r){const s=r.camera;if(this.camera=s,s){const o=t.AABBBounds,a=o.x2-o.x1,l=o.y2-o.y1,h=r.project(0,0,i),d=r.project(a,0,i),u=r.project(a,l,i),c={x:0,y:0},g={x:a,y:0},p={x:a,y:l};r.camera=null;const f=1/(c.x*(p.y-g.y)-g.x*p.y+p.x*g.y+(g.x-p.x)*c.y),m=-(c.y*(u.x-d.x)-g.y*u.x+p.y*d.x+(g.y-p.y)*h.x)*f,v=(g.y*u.y+c.y*(d.y-u.y)-p.y*d.y+(p.y-g.y)*h.y)*f,_=(c.x*(u.x-d.x)-g.x*u.x+p.x*d.x+(g.x-p.x)*h.x)*f,b=-(g.x*u.y+c.x*(d.y-u.y)-p.x*d.y+(p.x-g.x)*h.y)*f,y=(c.x*(p.y*d.x-g.y*u.x)+c.y*(g.x*u.x-p.x*d.x)+(p.x*g.y-g.x*p.y)*h.x)*f,C=(c.x*(p.y*d.y-g.y*u.y)+c.y*(g.x*u.y-p.x*d.y)+(p.x*g.y-g.x*p.y)*h.y)*f;r.setTransform(m,v,_,b,y,C,!0)}}restoreTransformUseContext2d(t,e,i,r){this.camera&&(r.camera=this.camera)}transformWithoutTranslate(t,e,i,r,s,o,a){const l=t.project(e,i,r);t.translate(l.x,l.y,!1),t.scale(s,o,!1),t.rotate(a,!1),t.translate(-l.x,-l.y,!1),t.setTransformForCurrent()}_draw(t,e,i,r,s){const{context:o}=r;if(!o)return;const{renderable:a}=t.attribute;if(a===!1)return;o.highPerformanceSave();const l=this.transform(t,e,o,i),{x:h,y:d,z:u,lastModelMatrix:c}=l;this.z=u,this.drawPathProxy(t,o,h,d,r,s)||(this.drawShape(t,o,h,d,r,s),this.z=0,o.modelMatrix!==c&&ki.free(o.modelMatrix),o.modelMatrix=c),o.highPerformanceRestore()}}var zEt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},WEt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},jG=function(n,t){return function(e,i){t(e,i,n)}};let E1=class extends Nr{constructor(n){super(),this.arcRenderContribitions=n,this.numberType=jM,this.builtinContributions=[vEt,bEt,_Et],this.init(n)}drawArcTailCapPath(n,t,e,i,r,s,o,a){const l=a-o,h=n.getParsedAngle(),d=h.startAngle;let u=h.endAngle;u=a;const c=u>d;let g=!1;if(r<s){const P=r;r=s,s=P}const{xors:p,yors:f,xirs:m,yirs:v,limitedOcr:_,outerCornerRadiusStart:b,outerCornerRadiusEnd:y,maxOuterCornerRadius:C,xore:S,yore:w,xire:x,yire:A,limitedIcr:M,innerDeltaAngle:T,innerStartAngle:R,innerCornerRadiusStart:B,innerCornerRadiusEnd:E,maxInnerCornerRadius:k}=MQ(n,d,u,s,r);if(_>$t){const P=we(b,_),I=we(y,_),O=Jh(m,v,p,f,r,P,Number(c)),H=Jh(S,w,x,A,r,I,Number(c));if(_<C&&P===I)t.moveTo(e+O.cx+O.x01,i+O.cy+O.y01),t.arc(e+O.cx,i+O.cy,_,zt(O.y01,O.x01),zt(H.y01,H.x01),!c);else{const z=u-l-.03,F=zt(H.y11,H.x11);t.arc(e,i,r,z,F,!c),I>0&&t.arc(e+H.cx,i+H.cy,I,zt(H.y11,H.x11),zt(H.y01,H.x01),!c)}}else t.moveTo(e+p,i+f);if(!(s>$t)||T<.001)t.lineTo(e+x,i+A),g=!0;else if(M>$t){const P=we(B,M),I=we(E,M),O=Jh(x,A,S,w,s,-I,Number(c)),H=Jh(p,f,m,v,s,-P,Number(c));if(t.lineTo(e+O.cx+O.x01,i+O.cy+O.y01),M<k&&P===I){const z=zt(H.y01,H.x01);t.arc(e+O.cx,i+O.cy,M,zt(O.y01,O.x01),z,!c)}else{I>0&&t.arc(e+O.cx,i+O.cy,I,zt(O.y01,O.x01),zt(O.y11,O.x11),!c);const z=zt(O.cy+O.y11,O.cx+O.x11),F=u-l-.03;t.arc(e,i,s,z,F,c)}}else t.lineTo(e+s*me(R),i+s*ee(R));return g}drawShape(n,t,e,i,r,s,o,a){const l=ne(n,s==null?void 0:s.theme).arc,{fill:h=l.fill,stroke:d=l.stroke,x:u=l.x,y:c=l.y,fillStrokeOrder:g=l.fillStrokeOrder}=n.attribute,p=this.valid(n,l,o,a);if(!p)return;const{fVisible:f,sVisible:m,doFill:v,doStroke:_}=p,{outerPadding:b=l.outerPadding,innerPadding:y=l.innerPadding,cap:C=l.cap,forceShowCap:S=l.forceShowCap}=n.attribute;let{outerRadius:w=l.outerRadius,innerRadius:x=l.innerRadius}=n.attribute;w+=b,x-=y;let A=0;const M=(Re(C)&&C||C[0])&&h.gradient==="conical";if(M){const{sc:E,startAngle:k,endAngle:P}=n.getParsedAngle();Et(P-k)<Ft-$t&&(A=E||0,h.startAngle-=A,h.endAngle-=A)}let T=!1;const{isFullStroke:R,stroke:B}=tBt(d);if(v||R){t.beginPath(),ZL(n,t,e,i,w,x),T=!0,t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,v,_,f,m,l,r,o,a);const E=()=>{v&&(o?o(t,n.attribute,l):f&&(t.setCommonStyle(n,n.attribute,u-e,c-i,l),t.fill()))},k=()=>{_&&R&&(a?a(t,n.attribute,l):m&&(t.setStrokeStyle(n,n.attribute,u-e,c-i,l),t.stroke()))};g?(k(),E()):(E(),k())}if(!R&&_&&(t.beginPath(),ZL(n,t,e,i,w,x,B),T||this.beforeRenderStep(n,t,e,i,v,_,f,m,l,r,o,a),a?a(t,n.attribute,l):m&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke())),(Re(C)&&C||C[1])&&S){const{startAngle:E,endAngle:k}=n.getParsedAngle();if(Et(k-E)>=Ft-$t){t.beginPath();const P=Math.abs(w-x)/2/w,{endAngle:I=l.endAngle,fill:O=l.fill}=n.attribute,H=I;this.drawArcTailCapPath(n,t,e,i,w,x,H,H+P),T||this.beforeRenderStep(n,t,e,i,v,_,f,m,l,r,o,a);const z=()=>{if(v){const j=O;if(j.gradient==="conical"){const $=HPt(0,0,I,j);o||wc&&(t.setCommonStyle(n,n.attribute,e,i,l),t.fillStyle=$,t.fill())}}},F=()=>{_&&(a||m&&(t.setStrokeStyle(n,n.attribute,e,i,l),t.stroke()))};z(),F()}}this.afterRenderStep(n,t,e,i,v,_,f,m,l,r,o,a),M&&(h.startAngle+=A,h.endAngle+=A)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).arc;this._draw(n,r,!1,e,i)}};E1=zEt([It(),jG(0,ue(en)),jG(0,xn(JL)),WEt("design:paramtypes",[Object])],E1);var jEt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},NEt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},NG=function(n,t){return function(e,i){t(e,i,n)}};let L1=class extends Nr{constructor(n){super(),this.circleRenderContribitions=n,this.numberType=$M,this.builtinContributions=[CEt,xEt,SEt],this.init(n)}drawShape(n,t,e,i,r,s,o,a){const l=ne(n,s==null?void 0:s.theme).circle,{radius:h=l.radius,startAngle:d=l.startAngle,endAngle:u=l.endAngle,x:c=l.x,y:g=l.y,fillStrokeOrder:p=l.fillStrokeOrder}=n.attribute,f=this.valid(n,l,o,a);if(!f)return;const{fVisible:m,sVisible:v,doFill:_,doStroke:b}=f;t.beginPath(),t.arc(e,i,h,d,u),t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,_,b,m,v,l,r,o,a);const y=()=>{_&&(o?o(t,n.attribute,l):m&&(t.setCommonStyle(n,n.attribute,c-e,g-i,l),t.fill()))},C=()=>{b&&(a?a(t,n.attribute,l):v&&(t.setStrokeStyle(n,n.attribute,c-e,g-i,l),t.stroke()))};p?(C(),y()):(y(),C()),this.afterRenderStep(n,t,e,i,_,b,m,v,l,r,o,a)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).circle;this._draw(n,r,!1,e,i)}};L1=jEt([It(),NG(0,ue(en)),NG(0,xn(t2)),NEt("design:paramtypes",[Object])],L1);function I1(n,t,e,i){if(!t.p1)return;const{offsetX:r=0,offsetY:s=0,offsetZ:o=0}=i||{};if(e===1)t.p2&&t.p3?n.bezierCurveTo(r+t.p1.x,s+t.p1.y,r+t.p2.x,s+t.p2.y,r+t.p3.x,s+t.p3.y,o):n.lineTo(r+t.p1.x,s+t.p1.y,o);else if(t.p2&&t.p3){const[a]=v1(t,e);n.bezierCurveTo(r+a.p1.x,s+a.p1.y,r+a.p2.x,s+a.p2.y,r+a.p3.x,s+a.p3.y,o)}else{const a=t.getPointAt(e);n.lineTo(r+a.x,s+a.y,o)}}function $G(n,t,e,i,r,s,o){var a;let l=t.p0,h=i;if(e&&e.originP1===e.originP2&&(l=e.p0),t.defined)i||(n.lineTo(l.x+r,l.y+s,o),h=!i);else{const{originP1:d,originP2:u}=t;let c;if(d&&d.defined!==!1&&!e?c=l:d&&u.defined!==!1&&(c=(a=t.p3)!==null&&a!==void 0?a:t.p1),i){h=!i;const g=c?c.x:t.p0.x,p=c?c.y:t.p0.y;n.moveTo(g+r,p+s,o)}else c&&(h=!i,n.lineTo(c.x+r,c.y+s,o))}return h}function WQ(n,t,e,i,r){const{offsetX:s=0,offsetY:o=0,offsetZ:a=0,mode:l="none",drawConnect:h=!1}=r||{};if(h&&l==="none"||!t)return;let d=!0;const{curves:u}=t;if(e>=1){if(h){let v,_=!0;u.forEach((b,y)=>{b.originP1!==b.originP2&&(_=$G(n,b,v,_,s,o,a)),v=b})}else u.forEach(v=>{v.defined?(d&&n.moveTo(v.p0.x+s,v.p0.y+o,a),I1(n,v,1,r),d=!1):d=!0});return}if(e<=0)return;let c;i==="x"?c=li.ROW:i==="y"?c=li.COLUMN:i==="auto"&&(c=t.direction);const g=e*t.tryUpdateLength(c);let p=0,f=!0,m=null;for(let v=0,_=u.length;v<_;v++){const b=u[v],y=b.getLength(c),C=(g-p)/y;if(p+=y,C<0)break;if(h){if(b.originP1===b.originP2){m=b;continue}f=$G(n,b,m,f,s,o,a),m=b}else{if(!b.defined){d=!0;continue}d&&n.moveTo(b.p0.x+s,b.p0.y+o,a),I1(n,b,we(C,1),r),d=!1}}}function $Et(n,t,e,i){const{offsetX:r=0,offsetY:s=0}=i||{},o=t?t.points[t.points.length-1]:e.points[0];n.moveTo(o.x+r,o.y+s),e.points.forEach(a=>{a.defined!==!1?n.lineTo(a.x+r,a.y+s):n.moveTo(a.x+r,a.y+s)})}function VEt(n,t,e,i){const{offsetX:r=0,offsetY:s=0}=i||{},{points:o}=e,a=[];for(let l=0;l<o.length;l++)o[l].defined;a.push(o),a.forEach((l,h)=>{var d,u,c,g;const p=t&&h===0?t.points[t.points.length-1]:l[0];n.moveTo(p.x+r,p.y+s),l.forEach(f=>{f.defined!==!1?n.lineTo(f.x+r,f.y+s):n.moveTo(f.x+r,f.y+s)});for(let f=l.length-1;f>=0;f--){const m=l[f];n.lineTo((d=m.x1)!==null&&d!==void 0?d:m.x,(u=m.y1)!==null&&u!==void 0?u:m.y)}n.lineTo((c=p.x1)!==null&&c!==void 0?c:p.x,(g=p.y1)!==null&&g!==void 0?g:p.y),n.closePath()})}var GEt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let a0=class extends Nr{constructor(){super(...arguments),this.numberType=gb}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).line;this._draw(n,r,!1,e,i)}drawSegmentItem(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p){var f;if(!t)return;n.beginPath();const m=(f=this.z)!==null&&f!==void 0?f:0;WQ(n.camera?n:n.nativeContext,t,l,h,{offsetX:d,offsetY:u,offsetZ:m}),c.cache&&!V(c.cache)&&c.cache.curves.every(b=>b.defined)&&c.attribute.curveType&&c.attribute.curveType.includes("Closed")&&n.closePath(),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,o,a);const{x:v=0,x:_=0}=o;return e!==!1&&(g?g(n,o,a):r&&(n.setCommonStyle(c,o,v-d,_-u,a),n.fill())),i!==!1&&(p?p(n,o,a):s&&(n.setStrokeStyle(c,o,v-d,_-u,a),n.stroke())),!1}drawLinearLineHighPerformance(n,t,e,i,r,s,o,a,l,h,d,u,c){var g;t.beginPath();const p=(g=this.z)!==null&&g!==void 0?g:0,{points:f}=n.attribute,m=f[0];t.moveTo(m.x+o,m.y+a,p);for(let b=1;b<f.length;b++){const y=f[b];t.lineTo(y.x+o,y.y+a,p)}t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l);const{x:v=0,x:_=0}=n.attribute;e!==!1&&(u?u(t,n.attribute,l):r&&(t.setCommonStyle(n,n.attribute,v-o,_-a,l),t.fill())),i!==!1&&(c?c(t,n.attribute,l):s&&(t.setStrokeStyle(n,n.attribute,v-o,_-a,l),t.stroke()))}drawShape(n,t,e,i,r,s,o,a){const l=ne(n,s==null?void 0:s.theme).line,{fill:h=l.fill,stroke:d=l.stroke,fillOpacity:u=l.fillOpacity,strokeOpacity:c=l.strokeOpacity,segments:g,points:p,closePath:f,curveTension:m=l.curveTension,connectedType:v=l.connectedType}=n.attribute;if(!this.valid(n,l,o,a))return;let{curveType:_=l.curveType}=n.attribute;f&&_==="linear"&&(_="linearClosed");const{clipRange:b=l.clipRange,clipRangeByDimension:y=l.clipRangeByDimension}=n.attribute;if(b===1&&!g&&!p.some(S=>S.defined===!1)&&_==="linear")return this.drawLinearLineHighPerformance(n,t,!!h,!!d,u,c,e,i,l,r,s,o,a);function C(S,w){return w==="none"?S:S.filter(x=>x.defined!==!1)}if(n.shouldUpdateShape()){const{points:S,segments:w}=n.attribute,x=S;if(w&&w.length){let A,M;if(n.cache=w.map((T,R)=>{if(T.points.length<=1&&R===0)return T.points[0]&&(M={endX:T.points[0].x,endY:T.points[0].y,curves:[{defined:T.points[0].defined!==!1}]}),null;R===1?A={x:M.endX,y:M.endY,defined:M.curves[M.curves.length-1].defined}:R>1&&(A.x=M.endX,A.y=M.endY,A.defined=M.curves[M.curves.length-1].defined);const B=Fu(C(T.points,v),_,{startPoint:A,curveTension:m});return M=B,B}).filter(T=>!!T),_==="linearClosed"){let T;for(let R=0;R<n.cache.length;R++){const B=n.cache[R];for(let E=0;E<B.curves.length;E++)if(B.curves[E].defined){T=B.curves[E].p0;break}if(T)break}n.cache[n.cache.length-1]&&n.cache[n.cache.length-1].lineTo(T.x,T.y,!0)}}else{if(!S||!S.length)return n.cache=null,void n.clearUpdateShapeTag();n.cache=Fu(C(x,v),_,{curveTension:m})}n.clearUpdateShapeTag()}if(Array.isArray(n.cache)){const S=n.attribute.segments.filter(w=>w.points.length);if(S[0].points.length===1&&S.shift(),b===1){let w=!1;n.cache.forEach((x,A)=>{w||(w=this.drawSegmentItem(t,x,!!h,!!d,u,c,S[A],[l,n.attribute],b,y,e,i,n,o,a))})}else{const w=n.cache.reduce((T,R)=>T+R.getLength(),0),x=b*w;let A=0,M=!1;n.cache.forEach((T,R)=>{if(M)return;const B=T.getLength(),E=(x-A)/B;A+=B,E>0&&(M=this.drawSegmentItem(t,T,!!h,!!d,u,c,S[R],[l,n.attribute],we(E,1),y,e,i,n,o,a))})}}else this.drawSegmentItem(t,n.cache,!!h,!!d,u,c,n.attribute,l,b,y,e,i,n,o,a)}};a0=GEt([It()],a0);function UEt(n,t,e,i){var r;const{top:s,bottom:o}=t;if(s.curves.length!==o.curves.length)return;if(e>=1){const v=[],_=[];let b=!0;for(let y=0,C=s.curves.length;y<C;y++){const S=s.curves[y];b!==S.defined?(b?(Yy(n,v,_,i),v.length=0,_.length=0):(v.push(S),_.push(o.curves[C-y-1])),b=!b):b&&(v.push(S),_.push(o.curves[C-y-1]))}return void Yy(n,v,_,i)}if(e<=0)return;let{direction:a}=i||{};const{curves:l}=s,h=(r=l[l.length-1].p3)!==null&&r!==void 0?r:l[l.length-1].p1,d=Et(h.x-l[0].p0.x),u=Et(h.y-l[0].p0.y);a=a??(d>u?li.ROW:li.COLUMN),Number.isFinite(d)||(a=li.COLUMN),Number.isFinite(u)||(a=li.ROW);const c=e*(a===li.ROW?d:u);let g=0,p=!0;const f=[],m=[];for(let v=0,_=s.curves.length;v<_;v++){const b=s.curves[v],y=b.getLength(a),C=(c-g)/y;if(C<0)break;g+=y;let S=null,w=null;p!==b.defined?(p?(Yy(n,f,m,i),f.length=0,m.length=0):(S=b,w=o.curves[_-v-1]),p=!p):p&&(S=b,w=o.curves[_-v-1]),S&&w&&(C<1&&(S=S.p2&&S.p3?v1(S,C)[0]:IV(S,C)[0],w=w.p2&&w.p3?v1(w,1-C)[1]:IV(w,1-C)[1]),S.defined=p,w.defined=p,f.push(S),m.push(w)),S=null,w=null}Yy(n,f,m,i)}function Yy(n,t,e,i){const{offsetX:r=0,offsetY:s=0,offsetZ:o=0}=i||{};let a=!0;t.forEach(l=>{l.defined?(a&&n.moveTo(l.p0.x+r,l.p0.y+s,o),I1(n,l,1,i),a=!1):a=!0}),a=!0;for(let l=e.length-1;l>=0;l--){const h=e[l];h.defined?(a&&n.lineTo(h.p0.x+r,h.p0.y+s,o),I1(n,h,1,i),a=!1):a=!0}n.closePath()}const YEt=new HEt,XEt=Ud;var KEt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},qEt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},VG=function(n,t){return function(e,i){t(e,i,n)}};let l0=class extends Nr{constructor(n){super(),this.areaRenderContribitions=n,this.numberType=cb,this.builtinContributions=[YEt,XEt],this.init(n)}drawLinearAreaHighPerformance(n,t,e,i,r,s,o,a,l,h,d,u,c){var g,p,f;const{points:m}=n.attribute;if(m.length<2)return;t.beginPath();const v=(g=this.z)!==null&&g!==void 0?g:0,_=m[0];t.moveTo(_.x+o,_.y+a,v);for(let C=1;C<m.length;C++){const S=m[C];t.lineTo(S.x+o,S.y+a,v)}for(let C=m.length-1;C>=0;C--){const S=m[C];t.lineTo(((p=S.x1)!==null&&p!==void 0?p:S.x)+o,((f=S.y1)!==null&&f!==void 0?f:S.y)+a,v)}t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,o,a,!!r,!1,e,!1,l,h,u,null,{attribute:n.attribute});const{x:b=0,x:y=0}=n.attribute;e!==!1&&(u?u(t,n.attribute,l):r&&(t.setCommonStyle(n,n.attribute,b-o,y-a,l),t.fill())),this.afterRenderStep(n,t,o,a,!!r,!1,e,!1,l,h,u,null,{attribute:n.attribute}),(()=>{var C,S;if(i){const{stroke:w=l&&l.stroke}=n.attribute;if(V(w)&&(w[0]||w[2])&&w[1]===!1){if(t.beginPath(),w[0]){t.moveTo(_.x+o,_.y+a,v);for(let x=1;x<m.length;x++){const A=m[x];t.lineTo(A.x+o,A.y+a,v)}}else if(w[2]){const x=m[m.length-1];t.moveTo(x.x+o,x.y+a,v);for(let A=m.length-2;A>=0;A--){const M=m[A];t.lineTo(((C=M.x1)!==null&&C!==void 0?C:M.x)+o,((S=M.y1)!==null&&S!==void 0?S:M.y)+a,v)}}}c?c(t,n.attribute,l):(t.setStrokeStyle(n,n.attribute,b-o,y-a,l),t.stroke())}})()}drawShape(n,t,e,i,r,s,o,a){var l,h,d,u,c,g;const p=ne(n,s==null?void 0:s.theme).area,{fill:f=p.fill,stroke:m=p.stroke,fillOpacity:v=p.fillOpacity,z:_=p.z,strokeOpacity:b=p.strokeOpacity,curveTension:y=p.curveTension,connectedType:C=p.connectedType}=n.attribute,S=this.valid(n,p,o,a);if(!S)return;const{doFill:w}=S,x=S.doStroke&&S.sVisible,{clipRange:A=p.clipRange,closePath:M,points:T,segments:R}=n.attribute;let{curveType:B=p.curveType}=n.attribute;function E(k,P){return P!=="connect"?k:k.filter(I=>I.defined!==!1)}if(M&&B==="linear"&&(B="linearClosed"),A===1&&!R&&!T.some(k=>k.defined===!1)&&B==="linear")return this.drawLinearAreaHighPerformance(n,t,!!f,x,v,b,e,i,p,r,s,o,a);if(n.shouldUpdateShape()){if(R&&R.length){let k,P;const I=R.map((z,F)=>{if(z.points.length<=1&&F===0)return z.points[0]&&(P={endX:z.points[0].x,endY:z.points[0].y}),null;F===1?k={x:P.endX,y:P.endY}:F>1&&(k.x=P.endX,k.y=P.endY);const j=Fu(E(z.points,C),B,{startPoint:k,curveTension:y});return P=j,j}).filter(z=>!!z);let O;const H=[];for(let z=R.length-1;z>=0;z--){const F=R[z].points,j=[];for(let $=F.length-1;$>=0;$--)j.push({x:(l=F[$].x1)!==null&&l!==void 0?l:F[$].x,y:(h=F[$].y1)!==null&&h!==void 0?h:F[$].y});if(z!==0){const $=R[z-1].points,Y=$[$.length-1];Y&&j.push({x:(d=Y.x1)!==null&&d!==void 0?d:Y.x,y:(u=Y.y1)!==null&&u!==void 0?u:Y.y})}j.length>1&&(O=Fu(E(j,C),B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B,{curveTension:y}),H.unshift(O))}n.cacheArea=H.map((z,F)=>({top:I[F],bottom:z}))}else{if(!T||!T.length)return n.cacheArea=null,void n.clearUpdateShapeTag();{const k=E(T,C),P=[];for(let H=k.length-1;H>=0;H--)P.push({x:(c=k[H].x1)!==null&&c!==void 0?c:k[H].x,y:(g=k[H].y1)!==null&&g!==void 0?g:k[H].y});const I=Fu(k,B,{curveTension:y}),O=Fu(P,B==="stepBefore"?"stepAfter":B==="stepAfter"?"stepBefore":B,{curveTension:y});n.cacheArea={top:I,bottom:O}}}n.clearUpdateShapeTag()}if(Array.isArray(n.cacheArea)){const k=n.attribute.segments.filter(P=>P.points.length);if(k[0].points.length===1&&k.shift(),A===1){let P=!1;n.cacheArea.forEach((I,O)=>{P||(P=this.drawSegmentItem(t,I,w,v,x,b,k[O],[p,n.attribute],A,e,i,_,n,r,o,a))})}else{const P=n.cacheArea.reduce((z,F)=>z+F.top.getLength(),0),I=A*P;let O=0,H=!1;n.cacheArea.forEach((z,F)=>{if(H)return;const j=z.top.getLength(),$=(I-O)/j;O+=j,$>0&&(H=this.drawSegmentItem(t,z,w,v,x,b,k[F],[p,n.attribute],we($,1),e,i,_,n,r,o,a))})}}else this.drawSegmentItem(t,n.cacheArea,w,v,x,b,n.attribute,p,A,e,i,_,n,r,o,a)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).area;this._draw(n,r,!1,e,i)}drawSegmentItem(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f){return this._drawSegmentItem(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f)}_drawSegmentItem(n,t,e,i,r,s,o,a,l,h,d,u,c,g,p,f){if(!(t&&t.top&&t.bottom&&t.top.curves&&t.top.curves.length&&t.bottom.curves&&t.bottom.curves.length))return;n.beginPath();const{points:m,segments:v}=c.attribute;let _,b,y=li.ROW;if(v){const A=v[v.length-1];b=v[0].points[0],_=A.points[A.points.length-1]}else b=m[0],_=m[m.length-1];const C=Et(_.x-b.x),S=Et(_.y-b.y);y=_.x1==null?li.ROW:_.y1==null?li.COLUMN:Number.isFinite(C+S)?C>S?li.ROW:li.COLUMN:li.ROW,UEt(n.camera?n:n.nativeContext,t,l,{offsetX:h,offsetY:d,offsetZ:u,direction:y}),this.beforeRenderStep(c,n,h,d,!!i,!1,e,!1,a,g,p,null,{attribute:o}),n.setShadowBlendStyle&&n.setShadowBlendStyle(c,o,a);const{x:w=0,x=0}=o;return e!==!1&&(p?p(n,o,a):i&&(n.setCommonStyle(c,o,w-h,x-d,a),n.fill())),this.afterRenderStep(c,n,h,d,!!i,!1,e,!1,a,g,p,null,{attribute:o}),(()=>{if(r!==!1)if(f)f(n,o,a);else{const{stroke:A=a&&a[1]&&a[1].stroke}=o;V(A)&&(A[0]||A[2])&&A[1]===!1&&(n.beginPath(),WQ(n.camera?n:n.nativeContext,A[0]?t.top:t.bottom,l,y===li.ROW?"x":"y",{offsetX:h,offsetY:d,offsetZ:u})),n.setStrokeStyle(c,o,w-h,x-d,a),n.stroke()}})(),!1}};l0=KEt([It(),VG(0,ue(en)),VG(0,xn(QL)),qEt("design:paramtypes",[Object])],l0);const ZEt=Vf,JEt=Ud;var QEt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},tLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},GG=function(n,t){return function(e,i){t(e,i,n)}};let O1=class extends Nr{constructor(n){super(),this.pathRenderContribitions=n,this.numberType=GM,this.builtinContributions=[JEt,ZEt],this.init(n)}drawShape(n,t,e,i,r,s,o,a){var l,h,d;const u=(l=this.tempTheme)!==null&&l!==void 0?l:ne(n,s==null?void 0:s.theme).path,{x:c=u.x,y:g=u.y,fillStrokeOrder:p=u.fillStrokeOrder}=n.attribute,f=(h=this.z)!==null&&h!==void 0?h:0,m=this.valid(n,u,o,a);if(!m)return;const{fVisible:v,sVisible:_,doFill:b,doStroke:y}=m;if(t.beginPath(),n.pathShape)ih(n.pathShape.commandList,t,e,i,1,1,f);else{const w=(d=n.attribute.path)!==null&&d!==void 0?d:u.path;ih(w.commandList,t,e,i,1,1,f)}t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,u),this.beforeRenderStep(n,t,e,i,b,y,v,_,u,r,o,a);const C=()=>{y&&(a?a(t,n.attribute,u):_&&(t.setStrokeStyle(n,n.attribute,c-e,g-i,u),t.stroke()))},S=()=>{b&&(o?o(t,n.attribute,u):v&&(t.setCommonStyle(n,n.attribute,c-e,g-i,u),t.fill()))};p?(C(),S()):(S(),C()),this.afterRenderStep(n,t,e,i,b,y,v,_,u,r,o,a)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).path;this.tempTheme=r,this._draw(n,r,!1,e,i),this.tempTheme=null}};O1=QEt([It(),GG(0,ue(en)),GG(0,xn(i2)),tLt("design:paramtypes",[Object])],O1);var eLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},iLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},UG=function(n,t){return function(e,i){t(e,i,n)}};let D1=class extends Nr{constructor(n){super(),this.rectRenderContribitions=n,this.type="rect",this.numberType=GD,this.builtinContributions=[MEt,kEt,TEt],this.init(n)}drawShape(n,t,e,i,r,s,o,a){var l;const h=(l=this.tempTheme)!==null&&l!==void 0?l:ne(n,s==null?void 0:s.theme).rect,{fill:d=h.fill,background:u,stroke:c=h.stroke,cornerRadius:g=h.cornerRadius,cornerType:p=h.cornerType,opacity:f=h.opacity,fillOpacity:m=h.fillOpacity,lineWidth:v=h.lineWidth,strokeOpacity:_=h.strokeOpacity,visible:b=h.visible,x1:y,y1:C,x:S=h.x,y:w=h.y,fillStrokeOrder:x=h.fillStrokeOrder}=n.attribute;let{width:A,height:M}=n.attribute;A=(A??y-S)||0,M=(M??C-w)||0;const T=qD(f,m,A,M,d),R=ZD(f,_,A,M),B=xc(d,u),E=df(c,v);if(!n.valid||!b||!B&&!E||!(T||R||o||a||u))return;g===0||V(g)&&g.every(O=>O===0)?(t.beginPath(),t.rect(e,i,A,M)):(t.beginPath(),Xc(t,e,i,A,M,g,p!=="bevel"));const k={doFill:B,doStroke:E};t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),this.beforeRenderStep(n,t,e,i,B,E,T,R,h,r,o,a,k);const P=()=>{k.doFill&&(o?o(t,n.attribute,h):T&&(t.setCommonStyle(n,n.attribute,S-e,w-i,h),t.fill()))},I=()=>{k.doStroke&&(a?a(t,n.attribute,h):R&&(t.setStrokeStyle(n,n.attribute,S-e,w-i,h),t.stroke()))};x?(I(),P()):(P(),I()),this.afterRenderStep(n,t,e,i,B,E,T,R,h,r,o,a)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).rect;this.tempTheme=r,this._draw(n,r,!1,e,i),this.tempTheme=null}};D1=eLt([It(),UG(0,ue(en)),UG(0,xn(Qm)),iLt("design:paramtypes",[Object])],D1);var nLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},rLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},YG=function(n,t){return function(e,i){t(e,i,n)}};let F1=class extends Nr{constructor(n){super(),this.symbolRenderContribitions=n,this.numberType=YM,this.builtinContributions=[IEt,FEt,DEt,OEt],this.init(n)}drawShape(n,t,e,i,r,s,o,a){var l;const h=ne(n,s==null?void 0:s.theme).symbol,{size:d=h.size,x:u=h.x,y:c=h.y,scaleX:g=h.scaleX,scaleY:p=h.scaleY,fillStrokeOrder:f=h.fillStrokeOrder,clipRange:m=h.clipRange}=n.attribute,v=this.valid(n,h,o,a);if(!v)return;const{fVisible:_,sVisible:b,doFill:y,doStroke:C}=v,S=n.getParsedPath();if(!S)return;const{keepDirIn3d:w=h.keepDirIn3d}=n.attribute,x=(l=this.z)!==null&&l!==void 0?l:0;t.beginPath();let A=e,M=i,T=x;const R=t.camera;if(w&&R&&t.project){const k=t.project(e,i,x);t.camera=null,V(d)?(d[0]*g,d[1]*p):d*g,A=k.x,M=k.y,T=void 0}S.draw(t,d,A,M,T,(k,P)=>{var I,O,H,z;if(n._parsedPath.svgCache){const $=Object.assign({},P);$.fill=(I=P.fill)!==null&&I!==void 0?I:n.attribute.fill,$.opacity=(O=P.opacity)!==null&&O!==void 0?O:n.attribute.opacity,$.fillOpacity=n.attribute.fillOpacity,$.stroke=(H=P.stroke)!==null&&H!==void 0?H:n.attribute.stroke,$.lineWidth=(z=P.lineWidth)!==null&&z!==void 0?z:n.attribute.lineWidth,P=$}const F=()=>{P.fill&&(o?o(t,n.attribute,h):(t.setCommonStyle(n,P,u-e,c-i,h),t.fill()))},j=()=>{P.stroke&&(a?a(t,n.attribute,h):b&&m>=1&&(t.setStrokeStyle(n,P,(u-e)/g,(c-i)/p,h),t.stroke()))};f?(j(),F()):(F(),j())})===!1&&t.closePath(),t.camera=R,t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),this.beforeRenderStep(n,t,e,i,y,C,_,b,h,r,o,a);const B=()=>{y&&!S.isSvg&&(o?o(t,n.attribute,h):_&&(t.setCommonStyle(n,n.attribute,u-e,c-i,h),t.fill()))},E=()=>{C&&!S.isSvg&&(a?a(t,n.attribute,h):b&&m>=1&&(t.setStrokeStyle(n,n.attribute,(u-e)/g,(c-i)/p,h),t.stroke()))};f?(E(),B()):(B(),E()),this.afterRenderStep(n,t,e,i,y,C,_,b,h,r,o,a)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).symbol;this._draw(n,r,!1,e,i)}};F1=nLt([It(),YG(0,ue(en)),YG(0,xn(r2)),rLt("design:paramtypes",[Object])],F1);class sLt{constructor(){this.pools=[];for(let t=0;t<10;t++)this.pools.push(new ie)}allocate(t,e,i,r){if(!this.pools.length)return new ie().setValue(t,e,i,r);const s=this.pools.pop();return s.x1=t,s.y1=e,s.x2=i,s.y2=r,s}allocateByObj(t){if(!this.pools.length)return new ie(t);const e=this.pools.pop();return e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e}free(t){this.pools.push(t)}get length(){return this.pools.length}release(...t){this.pools=[]}}const H1=new sLt;class oLt extends tT{constructor(){super(...arguments),this.time=cn.beforeFillStroke}drawShape(t,e,i,r,s,o,a,l,h,d,u,c){var g,p,f,m,v,_,b,y,C,S;const{backgroundMode:w=h.backgroundMode,backgroundFit:x=h.backgroundFit,backgroundKeepAspectRatio:A=h.backgroundKeepAspectRatio}=t.attribute;let M,{background:T}=t.attribute;if(!T)return;const R=()=>{t.type==="richtext"&&(e.restore(),e.save(),M&&e.setTransformFromMatrix(M,!0,1))};let B;t.type==="richtext"&&(M=e.currentMatrix.clone(),e.restore(),e.save(),e.setTransformForCurrent());const E=kt(T)&&T.background,k=t.transMatrix.onlyTranslate();if(E){const P=t.AABBBounds,I=((g=T.x)!==null&&g!==void 0?g:P.x1)+((p=T.dx)!==null&&p!==void 0?p:0),O=((f=T.y)!==null&&f!==void 0?f:P.y1)+((m=T.dy)!==null&&m!==void 0?m:0),H=(v=T.width)!==null&&v!==void 0?v:P.width(),z=(_=T.height)!==null&&_!==void 0?_:P.height();if(B=H1.allocate(I,O,I+H,O+z),T=T.background,!k){const F=B.width(),j=B.height();B.set(((b=T.x)!==null&&b!==void 0?b:0)+((y=T.dx)!==null&&y!==void 0?y:0),((C=T.y)!==null&&C!==void 0?C:0)+((S=T.dy)!==null&&S!==void 0?S:0),F,j)}}else B=t.AABBBounds,k||(B=QM(Object.assign(Object.assign({},t.attribute),{angle:0,scaleX:1,scaleY:1,x:0,y:0,dx:0,dy:0})).clone());if(t.backgroundImg&&t.resources){const P=t.resources.get(T);if(P.state!=="success"||!P.data)return void R();e.highPerformanceSave(),k&&e.setTransformFromMatrix(t.parent.globalTransMatrix,!0),e.setCommonStyle(t,t.attribute,i,r,h),this.doDrawImage(e,P.data,B,{backgroundMode:w,backgroundFit:x,backgroundKeepAspectRatio:A}),e.highPerformanceRestore(),e.setTransformForCurrent()}else{const{backgroundCornerRadius:P}=t.attribute;e.highPerformanceSave(),e.setCommonStyle(t,t.attribute,i,r,h),e.fillStyle=T,P?(Xc(e,B.x1,B.y1,B.width(),B.height(),P,!0),e.fill()):e.fillRect(B.x1,B.y1,B.width(),B.height()),e.highPerformanceRestore()}E&&H1.free(B),R()}}const jQ=new oLt;var aLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},lLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},XG=function(n,t){return function(e,i){t(e,i,n)}};let c2=class extends Nr{constructor(n){super(),this.textRenderContribitions=n,this.numberType=XM,this.builtinContributions=[jQ],this.init(n)}drawShape(n,t,e,i,r,s,o,a){var l,h,d;const u=ne(n,s==null?void 0:s.theme).text,{text:c,underline:g=u.underline,lineThrough:p=u.lineThrough,keepDirIn3d:f=u.keepDirIn3d,direction:m=u.direction,fontSize:v=u.fontSize,verticalMode:_=u.verticalMode,x:b=u.x,y=u.y}=n.attribute,C=(l=zM(n.attribute.lineHeight,v))!==null&&l!==void 0?l:v,S=this.valid(n,u,o,a);if(!S)return;const{fVisible:w,sVisible:x,doFill:A,doStroke:M}=S,T=!f,R=this.z||0;t.beginPath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,u),this.beforeRenderStep(n,t,e,i,A,M,w,x,u,r,o,a),T&&this.transformUseContext2d(n,u,R,t);const B=(E,k,P,I)=>{let O=e+k;const H=i+P;if(I){t.highPerformanceSave(),O+=v;const z=rs.allocate(1,0,0,1,0,0);z.rotateByCenter(Math.PI/2,O,H),t.transformFromMatrix(z,!0),rs.free(z)}M&&(a?a(t,n.attribute,u):x&&(t.setStrokeStyle(n,n.attribute,b-e,y-i,u),t.strokeText(E,O,H,R))),A&&(o?o(t,n.attribute,u):w&&(t.setCommonStyle(n,n.attribute,b-e,y-i,u),t.fillText(E,O,H,R))),I&&(t.highPerformanceRestore(),t.setTransformForCurrent())};if(t.setTextStyleWithoutAlignBaseline(n.attribute,u,R),m==="horizontal"){const{multilineLayout:E}=n;if(!E)return void t.highPerformanceRestore();const{xOffset:k,yOffset:P}=E.bbox;M&&(a?a(t,n.attribute,u):x&&(t.setStrokeStyle(n,n.attribute,b-e,y-i,u),E.lines.forEach(I=>{t.strokeText(I.str,(I.leftOffset||0)+k+e,(I.topOffset||0)+P+i,R)}))),A&&(o?o(t,n.attribute,u):w&&(t.setCommonStyle(n,n.attribute,b-e,y-i,u),E.lines.forEach(I=>{t.fillText(I.str,(I.leftOffset||0)+k+e,(I.topOffset||0)+P+i,R),this.drawUnderLine(g,p,n,(I.leftOffset||0)+k+e,(I.topOffset||0)+P+i,I.descent,(I.descent-I.ascent)/2,R,u,t,{width:I.width})})))}else{let{textAlign:E=u.textAlign,textBaseline:k=u.textBaseline}=n.attribute;if(!_){const j=E;E=(h=n.getBaselineMapAlign()[k])!==null&&h!==void 0?h:"left",k=(d=n.getAlignMapBaseline()[j])!==null&&d!==void 0?d:"top"}n.tryUpdateAABBBounds();const P=n.cache,{verticalList:I}=P;t.textAlign="left",t.textBaseline="top";const O=C*I.length;let H=0;I.forEach(j=>{const $=j.reduce((Y,G)=>Y+(G.width||0),0);H=ti($,H)});let z=0,F=0;k==="bottom"?F=-O:k==="middle"&&(F=-O/2),E==="center"?z-=H/2:E==="right"&&(z-=H),I.forEach((j,$)=>{const Y=j.reduce((st,ot)=>st+(ot.width||0),0),G=H-Y;let tt=z;E==="center"?tt+=G/2:E==="right"&&(tt+=G),j.forEach(st=>{const{text:ot,width:rt,direction:pt}=st;B(ot,O-($+1)*C+F,tt,pt),tt+=rt})})}T&&this.restoreTransformUseContext2d(n,u,R,t),this.afterRenderStep(n,t,e,i,A,M,w,x,u,r,o,a)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).text,{keepDirIn3d:s=r.keepDirIn3d}=n.attribute,o=!s;this._draw(n,r,o,e,i)}drawUnderLine(n,t,e,i,r,s,o,a,l,h,d){if(t+n<=0)return;const{textAlign:u=l.textAlign,fill:c=l.fill,opacity:g=l.opacity,underlineOffset:p=l.underlineOffset,underlineDash:f=l.underlineDash,fillOpacity:m=l.fillOpacity}=e.attribute,v=!D(d),_=v?d.width:e.clipedWidth,b=v?0:i0(u,_),y={lineWidth:0,stroke:c,opacity:g,strokeOpacity:m};if(n){y.lineWidth=n,h.setStrokeStyle(e,y,i,r,l),f&&h.setLineDash(f),h.beginPath();const C=r+s+p;h.moveTo(i+b,C,a),h.lineTo(i+b+_,C,a),h.stroke()}if(t){y.lineWidth=t,h.setStrokeStyle(e,y,i,r,l),h.beginPath();const C=r+o;h.moveTo(i+b,C,a),h.lineTo(i+b+_,C,a),h.stroke()}}};c2=aLt([It(),XG(0,ue(en)),XG(0,xn(s2)),lLt("design:paramtypes",[Object])],c2);function NQ(n,t,e,i){n.moveTo(t[0].x+e,t[0].y+i);for(let r=1;r<t.length;r++)n.lineTo(t[r].x+e,t[r].y+i)}function hLt(n,t,e,i,r,s=!0){var o;if(t.length<3)return void NQ(n,t,e,i);let a=0,l=t.length-1;s||(a+=1,l-=1,n.moveTo(t[0].x+e,t[0].y+i));for(let h=a;h<=l;h++){const d=t[h===0?l:(h-1)%t.length],u=t[h%t.length],c=t[(h+1)%t.length],g=u.x-d.x,p=u.y-d.y,f=u.x-c.x,m=u.y-c.y,v=(Math.atan2(p,g)-Math.atan2(m,f))/2,_=Math.abs(Math.tan(v));let b=Array.isArray(r)?(o=r[h%t.length])!==null&&o!==void 0?o:0:r,y=b/_;const C=Xy(g,p),S=Xy(f,m),w=Math.min(C,S);y>w&&(y=w,b=w*_);const x=BB(u,y,C,g,p),A=BB(u,y,S,f,m),M=2*u.x-x.x-A.x,T=2*u.y-x.y-A.y,R=Xy(M,T),B=BB(u,Xy(y,b),R,M,T);let E=Math.atan2(x.y-B.y,x.x-B.x);const k=Math.atan2(A.y-B.y,A.x-B.x);let P=k-E;P<0&&(E=k,P=-P),P>Math.PI&&(P-=Math.PI),h===0?n.moveTo(x.x+e,x.y+i):n.lineTo(x.x+e,x.y+i),P&&n.arcTo(u.x+e,u.y+i,A.x+e,A.y+i,b),n.lineTo(A.x+e,A.y+i)}s||n.lineTo(t[l+1].x+e,t[l+1].y+i)}function Xy(n,t){return Math.sqrt(n*n+t*t)}function BB(n,t,e,i,r){const s=t/e;return{x:n.x-i*s,y:n.y-r*s}}const dLt=Vf,uLt=Ud;var cLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},gLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},KG=function(n,t){return function(e,i){t(e,i,n)}};let g2=class extends Nr{constructor(n){super(),this.polygonRenderContribitions=n,this.numberType=UM,this.builtinContributions=[uLt,dLt],this.init(n)}drawShape(n,t,e,i,r,s,o,a){const l=ne(n,s==null?void 0:s.theme).polygon,{points:h=l.points,cornerRadius:d=l.cornerRadius,x:u=l.x,y:c=l.y,closePath:g=l.closePath,fillStrokeOrder:p=l.fillStrokeOrder}=n.attribute,f=this.valid(n,l,o,a);if(!f)return;const{fVisible:m,sVisible:v,doFill:_,doStroke:b}=f;t.beginPath(),d<=0||V(d)&&d.every(S=>S===0)?NQ(t.camera?t:t.nativeContext,h,e,i):hLt(t.camera?t:t.nativeContext,h,e,i,d,g),g&&t.closePath(),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this.beforeRenderStep(n,t,e,i,_,b,m,v,l,r,o,a);const y=()=>{_&&(o?o(t,n.attribute,l):m&&(t.setCommonStyle(n,n.attribute,u-e,c-i,l),t.fill()))},C=()=>{b&&(a?a(t,n.attribute,l):v&&(t.setStrokeStyle(n,n.attribute,u-e,c-i,l),t.stroke()))};p?(C(),y()):(y(),C()),this.afterRenderStep(n,t,e,i,_,b,m,v,l,r,o,a)}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).polygon;this._draw(n,r,!1,e,i)}};g2=cLt([It(),KG(0,ue(en)),KG(0,xn(n2)),gLt("design:paramtypes",[Object])],g2);var pLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},fLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},qG=function(n,t){return function(e,i){t(e,i,n)}};let p2=class{constructor(n){this.groupRenderContribitions=n,this.numberType=$D}drawShape(n,t,e,i,r,s,o,a){const l=ne(n,s==null?void 0:s.theme).group,{fill:h=l.fill,background:d,stroke:u=l.stroke,opacity:c=l.opacity,width:g=l.width,height:p=l.height,clip:f=l.clip,fillOpacity:m=l.fillOpacity,strokeOpacity:v=l.strokeOpacity,cornerRadius:_=l.cornerRadius,path:b=l.path,lineWidth:y=l.lineWidth,visible:C=l.visible,fillStrokeOrder:S=l.fillStrokeOrder,cornerType:w=l.cornerType,x=l.x,y:A=l.y}=n.attribute,M=qD(c,m,g,p,h),T=ZD(c,v,g,p),R=xc(h,d),B=df(u,y);if(!n.valid||!C||!f&&(!R&&!B||!(M||T||o||a||d)))return;if(b&&b.length&&r.drawContribution){const I=t.disableFill,O=t.disableStroke,H=t.disableBeginPath;t.disableFill=!0,t.disableStroke=!0,t.disableBeginPath=!0,b.forEach(z=>{r.drawContribution.getRenderContribution(z).draw(z,r.renderService,r,s)}),t.disableFill=I,t.disableStroke=O,t.disableBeginPath=H}else _===0||V(_)&&_.every(I=>I===0)?(t.beginPath(),t.rect(e,i,g,p)):(t.beginPath(),Xc(t,e,i,g,p,_,w!=="bevel"));this._groupRenderContribitions||(this._groupRenderContribitions=this.groupRenderContribitions.getContributions()||[],this._groupRenderContribitions.push(AEt));const E={doFill:R,doStroke:B};t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l),this._groupRenderContribitions.forEach(I=>{I.time===cn.beforeFillStroke&&I.drawShape(n,t,e,i,R,B,M,T,l,r,o,a,E)}),f&&t.clip();const k=()=>{E.doFill&&(o?o(t,n.attribute,l):M&&(t.setCommonStyle(n,n.attribute,x-e,A-i,l),t.fill()))},P=()=>{E.doStroke&&(a?a(t,n.attribute,l):T&&(t.setStrokeStyle(n,n.attribute,x-e,A-i,l),t.stroke()))};S?(P(),k()):(k(),P()),this._groupRenderContribitions.forEach(I=>{I.time===cn.afterFillStroke&&I.drawShape(n,t,e,i,R,B,M,T,l,r,o,a)})}draw(n,t,e,i){const{context:r}=e;if(!r)return;const{clip:s,baseOpacity:o=1,drawMode:a,x:l,y:h,width:d,height:u}=n.attribute,c=r.nativeContext,g=r.canvas.nativeCanvas;if(a>0){const y=r.canvas,C=le.createCanvas({width:y.width,height:y.height,dpr:1}),S=C.getContext("2d"),w=r.nativeContext.getTransform();S.setTransform(w.a,w.b,w.c,w.d,w.e,w.f),a===1&&(S.save(),S.clearRect(0,0,y.width,y.height),S.beginPath(),S.rect(l,h,d,u),S.clip(),S.drawImage(y.nativeCanvas,0,0,y.width,y.height,0,0,y.displayWidth,y.displayHeight),S.restore()),r.nativeContext=S,y.nativeCanvas=C}s?r.save():r.highPerformanceSave();const p=r.baseGlobalAlpha;r.baseGlobalAlpha*=o;const f=ne(n,i==null?void 0:i.theme).group,m=r.modelMatrix;if(r.camera){const y=ki.allocate(),C=ki.allocate();kQ(C,n,f),Ac(y,m||y,C),r.modelMatrix=y,ki.free(C),r.setTransform(1,0,0,1,0,0,!0)}else r.transformFromMatrix(n.transMatrix,!0);r.beginPath(),i.skipDraw?this.drawShape(n,r,0,0,e,i,()=>!1,()=>!1):this.drawShape(n,r,0,0,e);const{scrollX:v=f.scrollX,scrollY:_=f.scrollY}=n.attribute;let b;if((v||_)&&r.translate(v,_),i&&i.drawingCb&&(b=i.drawingCb()),r.modelMatrix!==m&&ki.free(r.modelMatrix),r.modelMatrix=m,r.baseGlobalAlpha=p,a>0){const y=r.nativeContext,C=r.canvas.nativeCanvas;c.save(),c.setTransform(r.dpr,0,0,r.dpr,0,0,!0),a===1&&y.rect(l,h,d,u),c.drawImage(C,0,0,C.width,C.height,0,0,r.canvas.displayWidth,r.canvas.displayHeight);const S=y.getTransform();c.setTransform(S.a,S.b,S.c,S.d,S.e,S.f),r.nativeContext=c,r.canvas.nativeCanvas=g,c.restore()}b&&b.then?b.then(()=>{s?r.restore():r.highPerformanceRestore()}):s?r.restore():r.highPerformanceRestore()}};p2=pLt([It(),qG(0,ue(en)),qG(0,xn(TQ)),fLt("design:paramtypes",[Object])],p2);var mLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},vLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},ZG=function(n,t){return function(e,i){t(e,i,n)}};const _Lt=["","repeat-x","repeat-y","repeat"];let f2=class extends Nr{constructor(n){super(),this.imageRenderContribitions=n,this.numberType=VM,this.builtinContributions=[BEt,PEt],this.init(n)}drawShape(n,t,e,i,r,s,o,a){const l=ne(n).image,{repeatX:h=l.repeatX,repeatY:d=l.repeatY,x:u=l.x,y:c=l.y,cornerRadius:g=l.cornerRadius,fillStrokeOrder:p=l.fillStrokeOrder,cornerType:f=l.cornerType,image:m}=n.attribute,v=this.valid(n,l,o);if(!v)return;const{fVisible:_,sVisible:b,doFill:y,doStroke:C}=v;if(!m||!n.resources)return;const S=n.resources.get(m);if(S.state!=="success")return;const w=n.width,x=n.height;t.beginPath();let A=!1;g===0||V(g)&&g.every(R=>R===0)?t.rect(e,i,w,x):(Xc(t,e,i,w,x,g,f!=="bevel"),A=!0),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,l);const M=()=>{if(y){if(o)o(t,n.attribute,l);else if(_){t.setCommonStyle(n,n.attribute,e,i,l);let R=0;if(h==="repeat"&&(R|=1),d==="repeat"&&(R|=2),R){const B=t.createPattern(S.data,_Lt[R]);t.fillStyle=B,t.translate(e,i,!0),t.fillRect(0,0,w,x),t.translate(-e,-i,!0)}else t.drawImage(S.data,e,i,w,x)}}},T=()=>{C&&(a?a(t,n.attribute,l):b&&(t.setStrokeStyle(n,n.attribute,u-e,c-i,l),t.stroke()))};p?(T(),A&&(t.save(),t.clip()),this.beforeRenderStep(n,t,e,i,y,!1,_,!1,l,r,o),M(),A&&t.restore()):(A&&(t.save(),t.clip()),this.beforeRenderStep(n,t,e,i,y,!1,_,!1,l,r,o),M(),A&&t.restore(),T()),this.afterRenderStep(n,t,e,i,y,!1,_,!1,l,r,o)}draw(n,t,e){const{image:i}=n.attribute;if(!i||!n.resources)return;const r=n.resources.get(i);if(r.state==="loading"&&yt(i))return void vi.improveImageLoading(i);if(r.state!=="success")return;const{context:s}=t.drawParams;if(!s)return;const o=ne(n).image;this._draw(n,o,!1,e)}};f2=mLt([It(),ZG(0,ue(en)),ZG(0,xn(e2)),vLt("design:paramtypes",[Object])],f2);const $Q=Symbol.for("IncrementalDrawContribution"),z1=Symbol.for("ArcRender"),m2=Symbol.for("Arc3dRender"),W1=Symbol.for("AreaRender"),j1=Symbol.for("CircleRender"),jn=Symbol.for("GraphicRender"),JG=Symbol.for("GroupRender"),N1=Symbol.for("LineRender"),$1=Symbol.for("PathRender"),V1=Symbol.for("PolygonRender"),G1=Symbol.for("RectRender"),v2=Symbol.for("Rect3DRender"),U1=Symbol.for("SymbolRender"),_2=Symbol.for("TextRender"),b2=Symbol.for("RichTextRender"),y2=Symbol.for("Pyramid3dRender"),Y1=Symbol.for("GlyphRender"),C2=Symbol.for("ImageRender"),oF=Symbol.for("DrawContribution"),VQ=(n,t,e,i)=>{let r,s=!1,o=!1;if(t.forEachChildren(a=>(s=a.numberType===NM,!s)),t.forEachChildren(a=>(o=!!a.findFace,!o)),s){const a=t.getChildren(),l=[...a];l.sort((h,d)=>{var u,c,g,p;let f=((c=(u=h.attribute.startAngle)!==null&&u!==void 0?u:0+h.attribute.endAngle)!==null&&c!==void 0?c:0)/2,m=((p=(g=d.attribute.startAngle)!==null&&g!==void 0?g:0+d.attribute.endAngle)!==null&&p!==void 0?p:0)/2;for(;f<0;)f+=Ft;for(;m<0;)m+=Ft;return m-f}),l.forEach(h=>{h._next=null,h._prev=null}),t.removeAllChild(),t.update(),l.forEach(h=>{t.appendChild(h)}),i.hack_pieFace="outside",r=e(s,o),r&&r.graphic||(i.hack_pieFace="inside",r=e(s,o)),r&&r.graphic||(i.hack_pieFace="top",r=e(s,o)),t.removeAllChild(),a.forEach(h=>{h._next=null,h._prev=null}),a.forEach(h=>{t.appendChild(h)})}else if(o){const a=t.getChildren(),l=a.map(h=>({ave_z:h.findFace().vertices.map(d=>{var u;return n.view(d[0],d[1],(u=d[2]+h.attribute.z)!==null&&u!==void 0?u:0)[2]}).reduce((d,u)=>d+u,0),g:h}));l.sort((h,d)=>d.ave_z-h.ave_z),t.removeAllChild(),l.forEach(h=>{h.g._next=null,h.g._prev=null}),t.update(),l.forEach(h=>{t.add(h.g)}),r=e(s,o),t.removeAllChild(),a.forEach(h=>{h._next=null,h._prev=null}),t.update(),a.forEach(h=>{t.add(h)})}else r=e(s,o);return r};var bLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},yLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const X1=Symbol.for("DrawItemInterceptor"),QG=new ie,t4=new ie;class CLt{constructor(){this.order=1}afterDrawItem(t,e,i,r,s){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0||(t.attribute.shadowRootIdx>0||!t.attribute.shadowRootIdx||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0)&&this.drawItem(t,e,i,r,s),!1}beforeDrawItem(t,e,i,r,s){return t.attribute.shadowRootIdx==null&&t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx>0||(t.attribute.shadowRootIdx<0||t.shadowRoot&&t.shadowRoot.attribute.shadowRootIdx<0)&&this.drawItem(t,e,i,r,s),!1}drawItem(t,e,i,r,s){if(!t.shadowRoot)return!1;const{context:o}=i;if(o.highPerformanceSave(),o.transformFromMatrix(t.transMatrix,!0),r.dirtyBounds&&r.backupDirtyBounds){QG.copy(r.dirtyBounds),t4.copy(r.backupDirtyBounds);const a=t.globalTransMatrix.getInverse();r.dirtyBounds.copy(r.backupDirtyBounds).transformWithMatrix(a),r.backupDirtyBounds.copy(r.dirtyBounds)}return r.renderGroup(t.shadowRoot,i,rs.allocate(1,0,0,1,0,0)),o.highPerformanceRestore(),r.dirtyBounds&&r.backupDirtyBounds&&(r.dirtyBounds.copy(QG),r.backupDirtyBounds.copy(t4)),!0}}class SLt{constructor(){this.order=1}afterDrawItem(t,e,i,r,s){return t.attribute._debug_bounds&&this.drawItem(t,e,i,r,s),!1}drawItem(t,e,i,r,s){if(!t.attribute._debug_bounds)return!1;const{context:o}=i;o.highPerformanceSave(),t.parent&&o.setTransformFromMatrix(t.parent.globalTransMatrix,!0),t.glyphHost&&t.glyphHost.parent&&o.setTransformFromMatrix(t.glyphHost.parent.globalTransMatrix,!0);const a=t.AABBBounds;return t.attribute._debug_bounds!==!0&&t.attribute._debug_bounds(o,t),o.strokeRect(a.x1,a.y1,a.width(),a.height()),o.highPerformanceRestore(),!0}}let K1=class{constructor(){this.order=1,this.interceptors=[new CLt,new wLt,new xLt,new SLt]}afterDrawItem(n,t,e,i,r){for(let s=0;s<this.interceptors.length;s++)if(this.interceptors[s].afterDrawItem&&this.interceptors[s].afterDrawItem(n,t,e,i,r))return!0;return!1}beforeDrawItem(n,t,e,i,r){if((!n.in3dMode||e.in3dInterceptor)&&!n.shadowRoot&&!(n.baseGraphic||n.attribute.globalZIndex||n.interactiveGraphic))return!1;for(let s=0;s<this.interceptors.length;s++)if(this.interceptors[s].beforeDrawItem&&this.interceptors[s].beforeDrawItem(n,t,e,i,r))return!0;return!1}};K1=bLt([It(),yLt("design:paramtypes",[])],K1);class xLt{constructor(){this.order=1}beforeDrawItem(t,e,i,r,s){return!this.processing&&(t.baseGraphic?this.beforeDrawInteractive(t,e,i,r,s):this.beforeSetInteractive(t,e,i,r,s))}beforeSetInteractive(t,e,i,r,s){let o=t.interactiveGraphic;if(t.attribute.globalZIndex){o||(o=t.clone(),t.interactiveGraphic=o,o.baseGraphic=t),o.setAttributes({globalZIndex:0,zIndex:t.attribute.globalZIndex},!1,{skipUpdateCallback:!0}),i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");return a&&this.getShadowRoot(a).add(o),!0}if(o){i.stage.tryInitInteractiveLayer();const a=i.stage.getLayer("_builtin_interactive");a&&this.getShadowRoot(a).removeChild(o),t.interactiveGraphic=null,o.baseGraphic=null}return!1}beforeDrawInteractive(t,e,i,r,s){const o=t.baseGraphic;let a=!!o.stage,l=o.parent;for(;a&&l&&l.stage!==l;)a=!!l.stage,l=l.parent;if(!a){const h=i.stage.getLayer("_builtin_interactive");return h&&this.getShadowRoot(h).removeChild(t),!0}if(o){this.processing=!0;const{context:h}=i;return h.highPerformanceSave(),h.setTransformFromMatrix(o.parent.globalTransMatrix,!0),o.isContainer?r.renderGroup(o,i,o.parent.globalTransMatrix):r.renderItem(o,i),h.highPerformanceRestore(),this.processing=!1,!0}return!1}getShadowRoot(t){var e;let i=t.getElementById("_interactive_group");return i||(i=Pt.CreateGraphic("group",{}),i.id="_interactive_group",t.add(i)),(e=i.shadowRoot)!==null&&e!==void 0?e:i.attachShadow()}}class wLt{constructor(){this.order=1}beforeDrawItem(t,e,i,r,s){if(!t.in3dMode||i.in3dInterceptor)return!1;i.in3dInterceptor=!0;const{context:o,stage:a}=e.drawParams;o.canvas,o.save(),this.initCanvasCtx(o),o.camera=a.camera;const l=o.currentMatrix;l.a/=o.dpr,l.b/=o.dpr,l.c/=o.dpr,l.d/=o.dpr,l.e/=o.dpr,l.f/=o.dpr;const h=ki.allocate();o2(h,l);const d=o.modelMatrix;if(d){if(h){const u=ki.allocate();o.modelMatrix=Ac(u,d,h)}}else o.modelMatrix=h;return o.setTransform(1,0,0,1,0,0,!0),t.isContainer?VQ(o,t,(u,c)=>r.renderGroup(t,i,t.parent.globalTransMatrix,!u&&c),i):r.renderItem(t,i),o.camera=null,o.restore(),o.modelMatrix!==d&&ki.free(o.modelMatrix),o.modelMatrix=d,i.in3dInterceptor=!1,!0}initCanvasCtx(t){t.setTransformForCurrent()}}var ALt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},MLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},TLt=function(n,t){return function(e,i){t(e,i,n)}};const GQ=Symbol.for("RenderService");let S2=class{constructor(n){this.drawContribution=n}prepare(n){n&&this.renderTreeRoots.forEach(t=>{this._prepare(t,n)})}_prepare(n,t){n.forEachChildren(e=>{this._prepare(e,t)}),n.update({bounds:t,trans:!0})}prepareRenderList(){}beforeDraw(n){}draw(n){this.drawContribution.draw(this,Object.assign({},this.drawParams))}afterDraw(n){this.drawContribution.afterDraw&&this.drawContribution.afterDraw(this,Object.assign({},this.drawParams))}render(n,t){this.renderTreeRoots=n,this.drawParams=t;const e=t.updateBounds;this.prepare(e),this.prepareRenderList(),this.beforeDraw(t),this.draw(t),this.afterDraw(t),this.drawParams=null}};S2=ALt([It(),TLt(0,ue(oF)),MLt("design:paramtypes",[Object])],S2);const kLt=new te(n=>{n(GQ).to(S2)}),Ip=Symbol.for("PickerService"),e4=Symbol.for("GlobalPickerService"),Ug=Symbol.for("PickItemInterceptor"),q1=Symbol.for("PickServiceInterceptor");var eT=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let Z1=class{constructor(){this.order=1}afterPickItem(n,t,e,i,r){if(n.graphic){let s=n.graphic;for(;s.parent;)s=s.parent;s.shadowHost&&(n.params={shadowTarget:n.graphic},n.graphic=s.shadowHost)}return n}};Z1=eT([It()],Z1);let J1=class{constructor(){this.order=1}afterPickItem(n,t,e,i,r){return n.attribute.shadowRootIdx>0||!n.attribute.shadowRootIdx?this._pickItem(n,t,e,i,r):null}beforePickItem(n,t,e,i,r){return n.attribute.shadowRootIdx<0?this._pickItem(n,t,e,i,r):null}_pickItem(n,t,e,i,r){var s;if(!n.shadowRoot)return null;const{parentMatrix:o}=r||{};if(!o)return null;const a=t.pickContext;a.highPerformanceSave();const l=(s=ne(n))===null||s===void 0?void 0:s[n.type],{shadowPickMode:h=l==null?void 0:l.shadowPickMode}=n.attribute,d=n.shadowRoot,u=rs.allocateByObj(o),c=new Yt(u.a*e.x+u.c*e.y+u.e,u.b*e.x+u.d*e.y+u.f),g=t.pickGroup(d,c,u,i);return a.highPerformanceRestore(),!g.graphic&&g.group&&h==="full"&&(g.graphic=g.group),g}};J1=eT([It()],J1);let Q1=class{constructor(){this.order=1}beforePickItem(n,t,e,i,r){const s=n.baseGraphic;if(s&&s.parent){const o=new Yt(e.x,e.y),a=t.pickContext;a.highPerformanceSave();const l=s.parent.globalTransMatrix;l.transformPoint(o,o);const h=s.isContainer?t.pickGroup(s,o.clone(),l,i):t.pickItem(s,o.clone(),l,i);return a.highPerformanceRestore(),h}return null}};Q1=eT([It()],Q1);let tw=class{constructor(){this.order=1}beforePickItem(n,t,e,i,r){if(!n.in3dMode||i.in3dInterceptor)return null;const s=t.pickContext,o=n.stage;if(!s||!o)return null;if(i.in3dInterceptor=!0,s.save(),this.initCanvasCtx(s),s.camera=o.camera,n.isContainer){const a=VQ(s,n,()=>t.pickGroup(n,e,r.parentMatrix,i),i);return s.camera=null,i.in3dInterceptor=!1,s.restore(),a}return s.restore(),null}initCanvasCtx(n){n.setTransformForCurrent()}};tw=eT([It()],tw);const RLt=new te((n,t,e)=>{e(Ip)||(n(e4).toSelf(),n(Ip).toService(e4)),n(tw).toSelf().inSingletonScope(),n(Ug).toService(tw),n(J1).toSelf().inSingletonScope(),n(Ug).toService(J1),n(Q1).toSelf().inSingletonScope(),n(Ug).toService(Q1),Un(n,Ug),n(Z1).toSelf().inSingletonScope(),n(q1).toService(Z1),Un(n,q1)}),BLt=new te(n=>{n(yQ).to(a2).inSingletonScope(),n(CQ).toConstantValue(Pt)}),ff=Symbol.for("AutoEnablePlugins"),UQ=Symbol.for("PluginService");var PLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},ELt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},i4=function(n,t){return function(e,i){t(e,i,n)}};let x2=class{constructor(n){this.autoEnablePlugins=n,this.onStartupFinishedPlugin=[],this.onRegisterPlugin=[],this.actived=!1}active(n,t){this.stage=n,this.actived=!0;const{pluginList:e}=t;e&&Qt.isBound(ff)&&this.autoEnablePlugins.getContributions().forEach(i=>{e.includes(i.name)&&this.register(i)})}findPluginsByName(n){const t=[];return this.onStartupFinishedPlugin.forEach(e=>{e.name===n&&t.push(e)}),this.onRegisterPlugin.forEach(e=>{e.name===n&&t.push(e)}),t}register(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.push(n):n.activeEvent==="onRegister"&&(this.onRegisterPlugin.push(n),n.activate(this))}unRegister(n){n.activeEvent==="onStartupFinished"?this.onStartupFinishedPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1):n.activeEvent==="onRegister"&&this.onRegisterPlugin.splice(this.onStartupFinishedPlugin.indexOf(n),1),n.deactivate(this)}release(...n){this.onStartupFinishedPlugin.forEach(t=>{t.deactivate(this)}),this.onStartupFinishedPlugin=[],this.onRegisterPlugin.forEach(t=>{t.deactivate(this)}),this.onRegisterPlugin=[]}};x2=PLt([It(),i4(0,ue(en)),i4(0,xn(ff)),ELt("design:paramtypes",[Object])],x2);const LLt=new te(n=>{n(UQ).to(x2),kkt(n,ff)}),ILt=new te(n=>{Un(n,OM)}),OLt=new te(n=>{n(zL).to(WL).inSingletonScope(),Un(n,zL)});var DLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},FLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let ew=class{constructor(){this.type="static",this.offscreen=!1,this.global=bt.global}setDpr(n){this.canvas.dpr=n}init(n,t,e){if(this.layer=n,this.window=t,e.main)this.main=!0,this.context=t.getContext(),this.canvas=this.context.getCanvas();else{let i;this.main=!1,e.canvasId&&(i=this.global.getElementById(e.canvasId)),i||(i=this.global.createCanvas({width:t.width,height:t.height})),i.style&&(i.style["pointer-events"]="none");const r=t.getContext().getCanvas().nativeCanvas,s=jL({nativeCanvas:i,width:t.width,height:t.height,dpr:t.dpr,id:e.canvasId,canvasControled:!0,container:t.getContainer(),x:r.offsetLeft,y:r.offsetTop});s.applyPosition(),this.canvas=s,this.context=s.getContext()}}resize(n,t){this.canvas.resize(n,t)}resizeView(n,t){}render(n,t,e){var i;if(!this.main){const r=this.window.getContext().getCanvas().nativeCanvas;!r||this.canvas.x===r.offsetLeft&&this.canvas.y===r.offsetTop||(this.canvas.x=r.offsetLeft,this.canvas.y=r.offsetTop,this.canvas.applyPosition())}t.renderService.render(n,Object.assign(Object.assign({context:this.context,clear:(i=t.background)!==null&&i!==void 0?i:"#ffffff"},t),e))}merge(n){n.forEach(t=>{const e=t.getContext().canvas.nativeCanvas;this.context.drawImage(e,0,0)})}prepare(n,t){}drawTo(n,t,e){var i;const r=n.getContext();e.renderService.render(t,Object.assign(Object.assign({context:r},e),{clear:e.clear?(i=e.background)!==null&&i!==void 0?i:"#fff":void 0}))}getContext(){return this.context}release(){this.canvas.release()}};ew=DLt([It(),FLt("design:paramtypes",[])],ew);const HLt=new te(n=>{n(ew).toSelf(),n(AQ).toService(ew)});function zLt(n){n.load(ILt),n.load(OLt),n.load(HLt)}var WLt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function YQ(n,t,e){const i={},r=[];return n.forEachChildren(s=>{const{zIndex:o=t}=s.attribute;i[o]?i[o].push(s):(i[o]=[s],r.push(o))},e),r.sort((s,o)=>e?o-s:s-o),{childMap:i,zIdxArray:r}}function XQ(n,t,e,i=!1,r=!1){let s=!1;if(r)s=!0;else{let o;n.forEachChildren((a,l)=>{const{zIndex:h=t}=a.attribute;if(l===0)o=h;else if(o!==h)return s=!0,!0;return!1},i)}if(s){const{childMap:o,zIdxArray:a}=YQ(n,t,i);let l=!1;for(let h=0;h<a.length&&!l;h++){const d=o[a[h]];r&&d.sort((u,c)=>{var g,p;return(i?-1:1)*(((g=c.attribute.z)!==null&&g!==void 0?g:0)-((p=u.attribute.z)!==null&&p!==void 0?p:0))});for(let u=0;u<d.length;u++)if(e(d[u],u)){l=!0;break}}}else n.forEachChildren(e,i)}function n4(n,t,e,i=!1){return WLt(this,void 0,void 0,function*(){yield n.forEachChildrenAsync(e,i)})}function jLt(n,t,e,i=!1){let r=!1;n.forEachChildren((a,l)=>{const{zIndex:h=e}=a.attribute;if(l!==0){if(h!==void 0)return r=!0,!0}return!1},i);let s=null,o=!1;if(r){const{childMap:a,zIdxArray:l}=YQ(n,e,i);let h=!1;for(let d=0;d<l.length&&!h;d++){const u=a[l[d]];for(let c=0;c<u.length;c++){if(o){h=!0,s=u[c];break}u[c]._uid!==t||(o=!0)}}}else n.forEachChildren(a=>o?(s=a,!0):(a._uid===t&&(o=!0),!1),i);return s}var NLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},$Lt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},PB=function(n,t){return function(e,i){t(e,i,n)}};let iw=class{constructor(n,t){this.contributions=n,this.drawItemInterceptorContributions=t,this.currentRenderMap=new Map,this.defaultRenderMap=new Map,this.styleRenderMap=new Map,this.dirtyBounds=new Bi,this.backupDirtyBounds=new Bi,this.global=bt.global,this.layerService=bt.layerService,V(this.contributions)||(this.contributions=[this.contributions]),this.init()}init(){this.contributions.forEach(n=>{if(n.style){const t=this.styleRenderMap.get(n.style)||new Map;t.set(n.numberType,n),this.styleRenderMap.set(n.style,t)}else this.defaultRenderMap.set(n.numberType,n)}),this.InterceptorContributions=this.drawItemInterceptorContributions.getContributions().sort((n,t)=>n.order-t.order)}prepareForDraw(n,t){t.updateBounds?this.useDirtyBounds=!0:this.useDirtyBounds=!t.stage.params.optimize.disableCheckGraphicWidthOutRange}draw(n,t){this.prepareForDraw(n,t),t.drawContribution=this,this.currentRenderMap=this.styleRenderMap.get(t.renderStyle)||this.defaultRenderMap,this.currentRenderService=n;const{context:e,stage:i,viewBox:r,transMatrix:s}=t;if(!e)return;const o=this.dirtyBounds.setValue(0,0,r.width(),r.height());if(i.dirtyBounds&&!i.dirtyBounds.empty()){const l=KA(o,i.dirtyBounds,!1);o.x1=Math.floor(l.x1),o.y1=Math.floor(l.y1),o.x2=Math.ceil(l.x2),o.y2=Math.ceil(l.y2)}const a=e.dpr%1;(a||a!==.5)&&(o.x1=Math.floor(o.x1*e.dpr)/e.dpr,o.y1=Math.floor(o.y1*e.dpr)/e.dpr,o.x2=Math.ceil(o.x2*e.dpr)/e.dpr,o.y2=Math.ceil(o.y2*e.dpr)/e.dpr),this.backupDirtyBounds.copy(o),e.inuse=!0,e.setClearMatrix(s.a,s.b,s.c,s.d,s.e,s.f),e.clearMatrix(),e.setTransformForCurrent(!0),e.translate(r.x1,r.y1,!0),e.beginPath(),e.rect(o.x1,o.y1,o.width(),o.height()),e.clip(),i.camera&&(this.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),this.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0)),this.clearScreen(n,e,t),e.save(),n.renderTreeRoots.sort((l,h)=>{var d,u;return((d=l.attribute.zIndex)!==null&&d!==void 0?d:Di.zIndex)-((u=h.attribute.zIndex)!==null&&u!==void 0?u:Di.zIndex)}).forEach(l=>{l.isContainer?this.renderGroup(l,t,rs.allocate(1,0,0,1,0,0)):this.renderItem(l,t)}),e.restore(),e.setClearMatrix(1,0,0,1,0,0),e.inuse=!1,e.draw()}doRegister(){throw new Error("")}_findNextGraphic(n){let t=n.parent,e=n._uid;for(;t;){const i=jLt(t,e,Di.zIndex);if(i)return i;e=t._uid,t=t.parent}return null}renderGroup(n,t,e,i){if(t.break||n.attribute.visibleAll===!1)return;if(n.incremental&&(t.startAtId==null||t.startAtId===n._uid))return t.break=!0,void this._increaseRender(n,t);if(this.useDirtyBounds&&!kd(n.AABBBounds,this.dirtyBounds,!1)&&n.attribute.boundsMode!=="empty")return;let r,s=e;if(this.useDirtyBounds){r=H1.allocateByObj(this.dirtyBounds);const o=n.transMatrix;s=rs.allocateByObj(e).multiply(o.a,o.b,o.c,o.d,o.e,o.f),this.dirtyBounds.copy(this.backupDirtyBounds).transformWithMatrix(s.getInverse())}this.renderItem(n,t,{drawingCb:()=>{var o;i?n.forEachChildren(a=>{t.break||(a.isContainer?this.renderGroup(a,t,s):this.renderItem(a,t))}):XQ(n,Di.zIndex,a=>{t.break||(a.isContainer?this.renderGroup(a,t,s):this.renderItem(a,t))},!1,!!(!((o=t.context)===null||o===void 0)&&o.camera))}}),this.useDirtyBounds&&(this.dirtyBounds.copy(r),H1.free(r),rs.free(s))}_increaseRender(n,t){const{layer:e,stage:i}=t,{subLayers:r}=e;let s=r.get(n._uid);s||(s={layer:this.layerService.createLayer(i),zIndex:r.size,group:n},r.set(n._uid,s));const o=s.layer.getNativeHandler().getContext(),a=s.drawContribution||Qt.get($Q);a.dirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.backupDirtyBounds.setValue(-1/0,-1/0,1/0,1/0),a.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:s.layer,context:o,startAtId:n._uid,break:!1})),s.drawContribution=a;const l=this._findNextGraphic(n);if(l)if(l.isContainer&&l.incremental)this._increaseRender(l,t);else{let h=r.get(l._uid);h||(h={layer:this.layerService.createLayer(i),zIndex:r.size},r.set(l._uid,h));const d=h.layer.getNativeHandler().getContext();this.draw(this.currentRenderService,Object.assign(Object.assign({},t),{drawContribution:a,clear:"transparent",layer:h.layer,context:d,startAtId:l._uid,break:!1}))}}getRenderContribution(n){let t;return t||(t=this.selectRenderByNumberType(n.numberType,n)),t||(t=this.selectRenderByType(n.type)),t}renderItem(n,t,e){if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.beforeDrawItem&&l.beforeDrawItem(n,this.currentRenderService,t,this,e))return}const i=this.getRenderContribution(n);if(!i)return;let r,s=this.scrollMatrix&&(this.scrollMatrix.e!==0||this.scrollMatrix.f!==0);if(n.parent){const{scrollX:a=0,scrollY:l=0}=n.parent.attribute;(a||l)&&(s=!0,this.scrollMatrix||(this.scrollMatrix=rs.allocate(1,0,0,1,0,0)),this.scrollMatrix.translate(-a,-l))}if(s&&(r=this.dirtyBounds.clone().transformWithMatrix(this.scrollMatrix)),this.useDirtyBounds&&!n.isContainer&&n.attribute.boundsMode!=="empty"&&!kd(n.AABBBounds,r??this.dirtyBounds,!1)){if(s&&n.parent){const{scrollX:a=0,scrollY:l=0}=n.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(a,l)}return}const o=t.startAtId!=null&&n._uid!==t.startAtId;if(n._uid===t.startAtId&&(t.startAtId=null),e&&(e.skipDraw=o),o?n.isContainer&&i.draw(n,this.currentRenderService,t,e):i.draw(n,this.currentRenderService,t,e),s&&n.parent){const{scrollX:a=0,scrollY:l=0}=n.parent.attribute;this.scrollMatrix&&this.scrollMatrix.translate(a,l)}if(this.InterceptorContributions.length)for(let a=0;a<this.InterceptorContributions.length;a++){const l=this.InterceptorContributions[a];if(l.afterDrawItem&&l.afterDrawItem(n,this.currentRenderService,t,this))return}}selectRenderByType(n){return ge.getInstance().warn(""),null}selectRenderByNumberType(n,t){let e;if(t.attribute.renderStyle){const i=this.styleRenderMap.get(t.attribute.renderStyle);e=i&&i.get(n)}return e||this.currentRenderMap.get(n)||this.defaultRenderMap.get(n)}clearScreen(n,t,e){var i,r;const{clear:s,viewBox:o}=e,a=o.width(),l=o.height();if(s){t.clearRect(0,0,a,l);const h=(i=n.drawParams)===null||i===void 0?void 0:i.stage;if(h&&(t.globalAlpha=(r=h.attribute.opacity)!==null&&r!==void 0?r:1),h&&h.backgroundImg&&h.resources){const d=h.resources.get(s);d&&d.state==="success"&&d.data&&t.drawImage(d.data,0,0,a,l)}else t.fillStyle=y1(t,s,{AABBBounds:{x1:0,y1:0,x2:0+a,y2:0+l}},0,0),t.fillRect(0,0,a,l)}}afterDraw(n,t){}};iw=NLt([It(),PB(0,$J(jn)),PB(1,ue(en)),PB(1,xn(X1)),$Lt("design:paramtypes",[Array,Object])],iw);var VLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let nw=class extends a0{constructor(){super(...arguments),this.numberType=gb}drawShape(n,t,e,i,r,s,o,a){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:l,length:h}=r.multiGraphicOptions,{segments:d=[]}=n.attribute;if(l>d.length)return;const u=ne(n).line,{fill:c=u.fill,stroke:g=u.stroke,opacity:p=u.opacity,fillOpacity:f=u.fillOpacity,strokeOpacity:m=u.strokeOpacity,lineWidth:v=u.lineWidth,visible:_=u.visible}=n.attribute,b=wc(p,f,c),y=qL(p,m),C=xc(c),S=df(g,v);if(!n.valid||!_||!C&&!S||!(b||y||o||a))return;const{context:w}=r;for(let x=l;x<l+h;x++)this.drawIncreaseSegment(n,w,d[x-1],d[x],n.attribute.segments[x],[u,n.attribute],e,i)}else super.drawShape(n,t,e,i,r,s,o,a)}drawIncreaseSegment(n,t,e,i,r,s,o,a){i&&(t.beginPath(),$Et(t.nativeContext,e,i,{offsetX:o,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,r,s),t.setStrokeStyle(n,r,o,a,s),t.stroke())}};nw=VLt([It()],nw);var GLt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let rw=class extends l0{constructor(){super(...arguments),this.numberType=cb}drawShape(n,t,e,i,r,s,o){if(n.incremental&&r.multiGraphicOptions){const{startAtIdx:a,length:l}=r.multiGraphicOptions,{segments:h=[]}=n.attribute;if(a>h.length)return;const d=ne(n).area,{fill:u=d.fill,fillOpacity:c=d.fillOpacity,opacity:g=d.opacity,visible:p=d.visible}=n.attribute,f=wc(g,c,u),m=xc(u);if(!n.valid||!p||!m||!f&&!o)return;for(let v=a;v<a+l;v++)this.drawIncreaseSegment(n,t,h[v-1],h[v],n.attribute.segments[v],[d,n.attribute],e,i)}else super.drawShape(n,t,e,i,r,s,o)}drawIncreaseSegment(n,t,e,i,r,s,o,a){i&&(t.beginPath(),VEt(t.camera?t:t.nativeContext,e,i,{offsetX:o,offsetY:a}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,r,s),t.setCommonStyle(n,r,o,a,s),t.fill())}};rw=GLt([It()],rw);var Yg,ULt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},YLt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},xm=function(n,t){return function(e,i){t(e,i,n)}},ba=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};(function(n){n[n.NORMAL=0]="NORMAL",n[n.STOP=1]="STOP"})(Yg||(Yg={}));let w2=class extends iw{constructor(n,t,e,i){super(n,i),this.contributions=n,this.lineRender=t,this.areaRender=e,this.drawItemInterceptorContributions=i,this.rendering=!1,this.currFrameStartAt=0,this.currentIdx=0,this.status=Yg.NORMAL,this.checkingForDrawPromise=null,this.hooks={completeDraw:new Zr([])},this.defaultRenderMap.set(this.lineRender.numberType,this.lineRender),this.defaultRenderMap.set(this.areaRender.numberType,this.areaRender)}draw(n,t){return ba(this,void 0,void 0,function*(){if(this.checkingForDrawPromise)return;this.lastRenderService=n,this.lastDrawContext=t,this.checkingForDrawPromise=this.checkForDraw(t);const e=yield this.checkingForDrawPromise;if(this.checkingForDrawPromise=null,e)return;this.currentRenderService=n;const{context:i,viewBox:r}=t;i&&(i.inuse=!0,i.clearMatrix(),i.setTransformForCurrent(!0),i.save(),t.restartIncremental&&this.clearScreen(this.currentRenderService,i,t),i.translate(r.x1,r.y1,!0),i.save(),n.renderTreeRoots.sort((s,o)=>{var a,l;return((a=s.attribute.zIndex)!==null&&a!==void 0?a:Di.zIndex)-((l=o.attribute.zIndex)!==null&&l!==void 0?l:Di.zIndex)}).forEach(s=>{this.renderGroup(s,t)}),this.hooks.completeDraw.tap("top-draw",()=>{i.restore(),i.restore(),i.draw(),i.inuse=!1,this.rendering=!1}))})}_increaseRender(n,t){return ba(this,void 0,void 0,function*(){this.rendering=!0,yield this._renderIncrementalGroup(n,t)})}_renderIncrementalGroup(n,t){return ba(this,void 0,void 0,function*(){this.count=n.count,yield new Promise(e=>{this.renderItem(n,t,{drawingCb:()=>ba(this,void 0,void 0,function*(){if(n.count!==2)yield n4(n,Di.zIndex,(i,r)=>{if(this.status===Yg.STOP)return!0;if(i.isContainer||r<this.currentIdx)return!1;const s=this.currFrameStartAt+n.incremental;return r<s&&(this.currentIdx=r+1,this.renderItem(i,t)),r===s-1&&(this.currFrameStartAt=this.currentIdx,this.waitToNextFrame())}),e(!1);else{const i=n.getChildAt(0);if(i.incremental&&i.attribute.segments)for(i.incrementalAt||(i.incrementalAt=0);i.incrementalAt<i.attribute.segments.length;)t.multiGraphicOptions={startAtIdx:i.incrementalAt,length:i.incremental},this.renderItem(i,t),i.incrementalAt+=i.incremental,yield this.waitToNextFrame();else this.renderItem(i,t);e(!1)}})})}),this.hooks.completeDraw.call()})}waitToNextFrame(){return ba(this,void 0,void 0,function*(){return new Promise(n=>{this.global.getRequestAnimationFrame()(()=>{n(!1)})})})}checkForDraw(n){return ba(this,void 0,void 0,function*(){let t=this.rendering;return n.restartIncremental&&(t=!1,yield this.forceStop(),this.resetToInit()),t})}forceStop(){return ba(this,void 0,void 0,function*(){this.rendering&&(this.status=Yg.STOP,yield new Promise(n=>{this.hooks.completeDraw.tap("stopCb",()=>{this.status=Yg.NORMAL,this.hooks.completeDraw.taps=this.hooks.completeDraw.taps.filter(t=>t.name!=="stopCb"),n(!1)})}))})}resetToInit(){this.currFrameStartAt=0,this.currentIdx=0}renderGroup(n,t){return ba(this,void 0,void 0,function*(){if(!t.break&&n.attribute.visibleAll!==!1)return n.incremental&&t.startAtId===n._uid?(yield this._increaseRender(n,t),void(t.break=!0)):void(yield new Promise(e=>{this.renderItem(n,t,{drawingCb:()=>ba(this,void 0,void 0,function*(){yield n4(n,Di.zIndex,i=>ba(this,void 0,void 0,function*(){t.break||i.isContainer&&(yield this.renderGroup(i,t))})),e(!1)})})}))})}};w2=ULt([It(),xm(0,$J(jn)),xm(1,ue(nw)),xm(2,ue(rw)),xm(3,ue(en)),xm(3,xn(X1)),YLt("design:paramtypes",[Array,Object,Object,Object])],w2);const XLt=new te(n=>{n(tT).toSelf().inSingletonScope(),n(sF).toSelf().inSingletonScope(),n(oF).to(iw),n($Q).to(w2),n(JG).to(p2).inSingletonScope(),n(jn).toService(JG),Un(n,TQ),n(Mo).toSelf().inSingletonScope(),Un(n,JD),Un(n,jn),n(K1).toSelf().inSingletonScope(),n(X1).toService(K1),Un(n,X1)});function KLt(n){n.load(XLt)}function sw(){sw.__loaded||(sw.__loaded=!0,Qt.load(DPt),Qt.load(BLt),Qt.load(kLt),Qt.load(RLt),Qt.load(LLt),zLt(Qt),KLt(Qt))}sw.__loaded=!1,sw();const le=Qt.get(OD);bt.global=le;const qLt=Qt.get(wQ);bt.graphicUtil=qLt;const ZLt=Qt.get(xQ);bt.transformUtil=ZLt;const JLt=Qt.get(yQ);bt.graphicService=JLt;const QLt=Qt.get(KD);bt.layerService=QLt;class t2t{constructor(){this.name="AutoRenderPlugin",this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,bt.graphicService.hooks.onAttributeUpdate.tap(this.key,this.handleChange),bt.graphicService.hooks.onSetStage.tap(this.key,this.handleChange),bt.graphicService.hooks.onRemove.tap(this.key,this.handleChange)}deactivate(t){const e=i=>i.filter(r=>r.name!==this.key);bt.graphicService.hooks.onAttributeUpdate.taps=e(bt.graphicService.hooks.onAttributeUpdate.taps),bt.graphicService.hooks.onSetStage.taps=e(bt.graphicService.hooks.onSetStage.taps),bt.graphicService.hooks.onRemove.taps=e(bt.graphicService.hooks.onRemove.taps)}}class e2t{constructor(){this.name="AutoRefreshPlugin",this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.handleChange=t=>{t.glyphHost&&(t=t.glyphHost),t.stage===this.pluginService.stage&&t.stage!=null&&t.stage.renderNextFrame()}}activate(t){this.pluginService=t,this.dpr=bt.global.devicePixelRatio,this.refresh()}refresh(){this._refreshByMediaQuery()||this._refreshByRaf()}_refreshByRaf(){const t=bt.global.getRequestAnimationFrame();this.rafId=t(()=>{bt.global.devicePixelRatio!==this.dpr&&(this.dpr=bt.global.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0)),this.refresh()})}_refreshByMediaQuery(){try{const t=`(resolution: ${window.devicePixelRatio}dppx)`,e=()=>{window.devicePixelRatio!==this.dpr&&(this.dpr=window.devicePixelRatio,this.pluginService.stage.setDpr(this.dpr,!0))},i=matchMedia(t);i&&i.addEventListener("change",e),this.autoRefreshCbs||(this.autoRefreshCbs=[]),this.autoRefreshCbs.push(()=>{i&&i.removeEventListener("change",e)})}catch{return!1}return!0}deactivate(t){var e;const i=bt.global.getCancelAnimationFrame();i&&this.rafId&&i(this.rafId),(e=this.autoRefreshCbs)===null||e===void 0||e.forEach(r=>{r()}),this.autoRefreshCbs=void 0}}class i2t{constructor(){this.name="IncrementalAutoRenderPlugin",this.activeEvent="onRegister",this.nextFrameRenderGroupSet=new Set,this.willNextFrameRender=!1,this.nextUserParams={},this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,bt.graphicService.hooks.onAddIncremental.tap(this.key,(e,i,r)=>{e.glyphHost&&(e=e.glyphHost),e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=i._uid,this.renderNextFrame(i))}),bt.graphicService.hooks.onClearIncremental.tap(this.key,(e,i)=>{e.stage===t.stage&&e.stage!=null&&(this.nextUserParams.startAtId=e._uid,this.nextUserParams.restartIncremental=!0,this.renderNextFrame(e))})}deactivate(t){bt.graphicService.hooks.onAddIncremental.taps=bt.graphicService.hooks.onAddIncremental.taps.filter(e=>e.name!==this.key),bt.graphicService.hooks.onClearIncremental.taps=bt.graphicService.hooks.onClearIncremental.taps.filter(e=>e.name!==this.key)}renderNextFrame(t){this.nextFrameRenderGroupSet.add(t),this.willNextFrameRender||(this.willNextFrameRender=!0,bt.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){const t=this.pluginService.stage;this.nextFrameRenderGroupSet.size&&(this.nextFrameRenderGroupSet.forEach(e=>{const i=e.layer;if(!i||!e.layer.subLayers)return;const r=e.layer.subLayers.get(e._uid);r&&r.drawContribution&&r.drawContribution.draw(t.renderService,Object.assign({stage:t,layer:i,viewBox:t.window.getViewBox(),transMatrix:t.window.getViewBoxTransform(),clear:"transparent",renderService:t.renderService,updateBounds:!1,startAtId:e._uid,context:r.layer.getNativeHandler().getContext()},this.nextUserParams))}),this.nextUserParams={},this.nextFrameRenderGroupSet.clear())}}const r4=new ie;class n2t{constructor(){this.name="DirtyBoundsPlugin",this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,e=>{e&&e===this.pluginService.stage&&e.dirtyBounds.clear()}),bt.graphicService.hooks.beforeUpdateAABBBounds.tap(this.key,(e,i,r,s)=>{e.glyphHost&&(e=e.glyphHost),i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!e.shouldSelfChangeUpdateAABBBounds()||r&&(r4.setValue(s.x1,s.y1,s.x2,s.y2),i.dirty(r4,e.parent&&e.parent.globalTransMatrix)))}),bt.graphicService.hooks.afterUpdateAABBBounds.tap(this.key,(e,i,r,s,o)=>{i&&i===this.pluginService.stage&&i.renderCount&&(e.isContainer&&!o||i.dirty(s.globalAABBBounds))}),bt.graphicService.hooks.clearAABBBounds.tap(this.key,(e,i,r)=>{i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(r)}),bt.graphicService.hooks.onRemove.tap(this.key,e=>{const i=e.stage;i&&i===this.pluginService.stage&&i.renderCount&&i&&i.dirty(e.globalAABBBounds)})}deactivate(t){bt.graphicService.hooks.beforeUpdateAABBBounds.taps=bt.graphicService.hooks.beforeUpdateAABBBounds.taps.filter(e=>e.name!==this.key),bt.graphicService.hooks.afterUpdateAABBBounds.taps=bt.graphicService.hooks.afterUpdateAABBBounds.taps.filter(e=>e.name!==this.key),bt.graphicService.hooks.clearAABBBounds.taps=bt.graphicService.hooks.clearAABBBounds.taps.filter(e=>e.name!==this.key),t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter(e=>e.name!==this.key),bt.graphicService.hooks.onRemove.taps=bt.graphicService.hooks.onRemove.taps.filter(e=>e.name!==this.key)}}const aF=new ZRt;aF.addTimeline(A1);aF.setFPS(60);let Rg;function r2t(){if(Rg==null)try{const n=document.createElement("canvas"),t=n.getContext("2d");Rg=!!(window&&n.getBoundingClientRect&&requestAnimationFrame&&window.devicePixelRatio&&t&&t.isPointInPath&&t.isPointInStroke),Rg&&(Rg=!!document.createElement)}catch{Rg=!1}}function lF(){r2t();const n=bt.global&&bt.global.env;return n?n==="browser":Rg}let so=class A2{static registerPlugin(t,e){A2._pluginClasses[t]=e}static getPlugin(t){return A2._pluginClasses[t]}};so._pluginClasses={};const s4={BACKGROUND:"white"};class s2t extends $f{set viewBox(t){this.window.setViewBox(t)}get viewBox(){return this.window.getViewBox()}get x(){return this.window.getViewBox().x1}set x(t){const e=this.window.getViewBox();e.translate(t-e.x1,0),this.window.setViewBox(e)}get y(){return this.window.getViewBox().y1}set y(t){const e=this.window.getViewBox();e.translate(0,t-e.y1),this.window.setViewBox(e)}get width(){return this.window.width}set width(t){this.resize(t,this.height)}get viewWidth(){return this.window.getViewBox().width()}set viewWidth(t){this.resizeView(t,this.viewHeight)}get viewHeight(){return this.window.getViewBox().height()}set viewHeight(t){this.resizeView(this.viewWidth,t)}get height(){return this.window.height}set height(t){this.resize(this.width,t)}get dpr(){return this.window.dpr}set dpr(t){this.setDpr(t)}get background(){var t;return(t=this._background)!==null&&t!==void 0?t:s4.BACKGROUND}set background(t){this._background=t}get defaultLayer(){return this.at(0)}get eventSystem(){return this._eventSystem}constructor(t={}){var e;super({}),this.tickedBeforeRender=!0,this._onVisibleChange=i=>{if(!(this._skipRender<0))if(i){if(this.dirtyBounds){const r=this.window.getViewBox();this.dirtyBounds.setValue(r.x1,r.y1,r.width(),r.height())}this._skipRender>1&&this.renderNextFrame(),this._skipRender=0}else this._skipRender=1},this.beforeRender=i=>{this._beforeRender&&this._beforeRender(i)},this.afterRender=i=>{this.renderCount++,this._afterRender&&this._afterRender(i),this._afterNextRenderCbs&&this._afterNextRenderCbs.forEach(r=>r(i)),this._afterNextRenderCbs=null,this.tickedBeforeRender=!1},this.afterTickCb=()=>{var i;this.tickedBeforeRender=!0,((i=this.params.optimize)===null||i===void 0?void 0:i.tickRenderMode)==="performance"||this.state!=="rendering"&&this.render()},this.params=t,this.theme=new e0,this.hooks={beforeRender:new Zr(["stage"]),afterRender:new Zr(["stage"])},this.global=bt.global,!this.global.env&&lF()&&this.global.setEnv("browser"),this.window=Qt.get(S1),this.renderService=Qt.get(GQ),this.pluginService=Qt.get(UQ),this.layerService=Qt.get(KD),this.pluginService.active(this,t),this.window.create({width:t.width,height:t.height,viewBox:t.viewBox,container:t.container,dpr:t.dpr||this.global.devicePixelRatio,canvasControled:t.canvasControled!==!1,title:t.title||"",canvas:t.canvas}),this.state="normal",this.renderCount=0,this.tryInitEventSystem(),this._background=(e=t.background)!==null&&e!==void 0?e:s4.BACKGROUND,this.appendChild(this.layerService.createLayer(this,{main:!0})),this.nextFrameRenderLayerSet=new Set,this.willNextFrameRender=!1,this.stage=this,this.renderStyle=t.renderStyle,t.autoRender&&this.enableAutoRender(),t.autoRefresh&&this.enableAutoRefresh(),t.disableDirtyBounds===!1&&this.enableDirtyBounds(),t.enableHtmlAttribute&&this.enableHtmlAttribute(t.enableHtmlAttribute),t.ReactDOM&&this.enableReactAttribute(t.ReactDOM),t.enableLayout&&this.enableLayout(),this.hooks.beforeRender.tap("constructor",this.beforeRender),this.hooks.afterRender.tap("constructor",this.afterRender),this._beforeRender=t.beforeRender,this._afterRender=t.afterRender,this.ticker=t.ticker||aF,this.supportInteractiveLayer=t.interactiveLayer!==!1,this.timeline=new cQ,this.ticker.addTimeline(this.timeline),this.timeline.pause(),t.optimize||(t.optimize={}),this.optmize(t.optimize),t.background&&yt(this._background)&&this._background.includes("/")&&this.setAttributes({background:this._background}),this.ticker.on("afterTick",this.afterTickCb)}pauseRender(t=-1){this._skipRender=t}resumeRender(){this._skipRender=0}tryInitEventSystem(){this.global.supportEvent&&!this._eventSystem&&(this._eventSystem=new qRt(Object.assign({targetElement:this.window,resolution:this.window.dpr||this.global.devicePixelRatio,rootNode:this,global:this.global,supportsPointerEvents:this.params.supportsPointerEvents,supportsTouchEvents:this.params.supportsTouchEvents},this.params.event)))}preventRender(t){t?this._skipRender=-1/0:this.params.optimize.skipRenderWithOutRange!==!1?this._skipRender=this.window.isVisible()?0:1:this._skipRender=0}optmize(t){this.optmizeRender(t.skipRenderWithOutRange),this.params.optimize=t}optmizeRender(t=!1){t&&(this._skipRender=this._skipRender<0?this._skipRender:this.window.isVisible()?0:1,this.window.onVisibleChange(this._onVisibleChange))}getTimeline(){return this.timeline}get3dOptions(t){const{center:e={x:this.width/2,y:this.height/2,z:0,dx:0,dy:0,dz:0},light:i={},alpha:r=0,beta:s=0,camera:o,fieldRatio:a=1,fieldDepth:l}=t;return Object.assign(Object.assign({},t),{center:e,light:i,alpha:r,beta:s,camera:o,fieldRatio:a,fieldDepth:l})}set3dOptions(t){var e,i,r,s,o,a;this.option3d=t;const l=this.get3dOptions(t),{light:h,center:d,camera:u,alpha:c,beta:g,fieldRatio:p,fieldDepth:f}=l,{dir:m=[1,1,-1],color:v="white",ambient:_}=h,b=((e=d.x)!==null&&e!==void 0?e:this.width/2)+((i=d.dx)!==null&&i!==void 0?i:0),y=((r=d.y)!==null&&r!==void 0?r:this.height/2)+((s=d.dy)!==null&&s!==void 0?s:0),C=[b,y,((o=d.z)!==null&&o!==void 0?o:0)+((a=d.dz)!==null&&a!==void 0?a:0)];let S=0,w=0,x=0;u||(S=Math.sin(c)+b,w=Math.sin(g)+y,x=Math.cos(c)*Math.cos(g)*1);const A=so.getPlugin("DirectionalLight");A&&(this.light=new A(m,v,_));const M={left:0,right:this.width,top:0,bottom:this.height,fieldRatio:p,fieldDepth:f,viewParams:{pos:[S,w,x],center:C,up:[0,1,0]}};if(this.camera)this.camera.params=M;else{const T=so.getPlugin("OrthoCamera");T&&(this.camera=new T(M))}t.enableView3dTransform&&this.enableView3dTransform()}setBeforeRender(t){this._beforeRender=t}setAfterRender(t){this._afterRender=t}afterNextRender(t){this._afterNextRenderCbs||(this._afterNextRenderCbs=[]),this._afterNextRenderCbs.push(t)}enableView3dTransform(){if(this.view3dTranform)return;this.view3dTranform=!0;const t=so.getPlugin("ViewTransform3dPlugin");t&&this.pluginService.register(new t)}disableView3dTranform(){this.view3dTranform&&(this.view3dTranform=!1,this.pluginService.findPluginsByName("ViewTransform3dPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRender(){this.autoRender||(this.autoRender=!0,this.pluginService.register(new t2t))}disableAutoRender(){this.autoRender&&(this.autoRender=!1,this.pluginService.findPluginsByName("AutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableAutoRefresh(){this.autoRefresh||(this.autoRefresh=!0,this.pluginService.register(new e2t))}disableAutoRefresh(){this.autoRefresh&&(this.autoRefresh=!1,this.pluginService.findPluginsByName("AutoRefreshPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableIncrementalAutoRender(){this.increaseAutoRender||(this.increaseAutoRender=!0,this.pluginService.register(new i2t))}disableIncrementalAutoRender(){this.increaseAutoRender&&(this.increaseAutoRender=!1,this.pluginService.findPluginsByName("IncrementalAutoRenderPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableDirtyBounds(){if(this.dirtyBounds)return;this.dirtyBounds=new Bi;let t=this.pluginService.findPluginsByName("DirtyBoundsPlugin")[0];t?t.activate(this.pluginService):(t=new n2t,this.pluginService.register(t))}disableDirtyBounds(){this.dirtyBounds&&(this.dirtyBounds=null,this.pluginService.findPluginsByName("DirtyBoundsPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableLayout(){if(this._enableLayout)return;this._enableLayout=!0;const t=so.getPlugin("FlexLayoutPlugin");t&&this.pluginService.register(new t)}disableLayout(){this._enableLayout&&(this._enableLayout=!1,this.pluginService.findPluginsByName("FlexLayoutPlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableHtmlAttribute(t){if(this.htmlAttribute)return;const e=so.getPlugin("HtmlAttributePlugin");e&&(this.htmlAttribute=t,this.pluginService.register(new e))}disableHtmlAttribute(){this.htmlAttribute&&(this.htmlAttribute=!1,this.pluginService.findPluginsByName("HtmlAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}enableReactAttribute(t){if(this.reactAttribute)return;const e=so.getPlugin("ReactAttributePlugin");e&&(this.reactAttribute=t,this.pluginService.register(new e))}disableReactAttribute(){this.reactAttribute&&(this.reactAttribute=!1,this.pluginService.findPluginsByName("ReactAttributePlugin").forEach(t=>{this.pluginService.unRegister(t)}))}getPluginsByName(t){return this.pluginService.findPluginsByName(t)}tryUpdateAABBBounds(){const t=this.window.getViewBox();return this._AABBBounds.setValue(t.x1,t.y1,t.x2,t.y2),this._AABBBounds}combineLayer(t,e){throw new Error("")}createLayer(t,e){if(this.releaseStatus==="released")return;const i=this.layerService.createLayer(this,{main:!1,layerMode:e,canvasId:t});return this.appendChild(i),i}sortLayer(t){const e=this.children;e.sort(t),this.removeAllChild(),e.forEach(i=>{this.appendChild(i)})}removeLayer(t){return this.removeChild(this.findChildByUid(t))}tryInitInteractiveLayer(){this.releaseStatus!=="released"&&this.supportInteractiveLayer&&!this.interactiveLayer&&(this.interactiveLayer=this.createLayer(),this.interactiveLayer.name="_builtin_interactive",this.interactiveLayer.attribute.pickable=!1,this.nextFrameRenderLayerSet.add(this.interactiveLayer))}clearViewBox(t){this.window.clearViewBox(t)}render(t,e){if(this.releaseStatus==="released")return;this.ticker.start(),this.timeline.resume();const i=this.state;this.state="rendering",this.tickedBeforeRender||this.ticker.trySyncTickStatus(),this.layerService.prepareStageLayer(this),this._skipRender||(this.lastRenderparams=e,this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(this.children),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=i,this._skipRender&&this._skipRender++}combineLayersToWindow(){if(this.global.env==="harmony"){const t=this.window.getContext().nativeContext;this.forEachChildren((e,i)=>{if(i>0){const r=e.getNativeHandler().getContext().canvas.nativeCanvas.nativeCanvas._c.transferToImageBitmap();t.transferFromImageBitmap(r)}})}}renderNextFrame(t,e){this.nextFrameRenderLayerSet.size!==this.childrenCount&&(t||this).forEach(i=>{this.nextFrameRenderLayerSet.add(i)}),this.willNextFrameRender||(this.willNextFrameRender=!0,this.global.getRequestAnimationFrame()(()=>{this._doRenderInThisFrame(),this.willNextFrameRender=!1}))}_doRenderInThisFrame(){if(this.releaseStatus==="released")return;this.timeline.resume(),this.ticker.start();const t=this.state;this.state="rendering",this.layerService.prepareStageLayer(this),this.nextFrameRenderLayerSet.size&&!this._skipRender&&(this.hooks.beforeRender.call(this),this._skipRender||(this.renderLayerList(Array.from(this.nextFrameRenderLayerSet.values()),this.lastRenderparams||{}),this.combineLayersToWindow(),this.nextFrameRenderLayerSet.clear()),this.hooks.afterRender.call(this)),this.state=t,this._skipRender&&this._skipRender++}renderLayerList(t,e){const i=[];for(let r=0;r<t.length;r++){let s=t[r];s.layerMode==="virtual"&&(s=s.getNativeHandler().mainHandler.layer),i.includes(s)||i.push(s)}i.forEach(r=>{r.renderCount>this.renderCount||(r.renderCount=this.renderCount+1,r===this.interactiveLayer&&this.dirtyBounds&&this.dirtyBounds.clear(),r.render({renderService:this.renderService,background:r===this.defaultLayer?this.background:void 0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}),this.interactiveLayer&&!t.includes(this.interactiveLayer)&&(this.dirtyBounds&&this.dirtyBounds.clear(),this.interactiveLayer.render({renderService:this.renderService,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty()),viewBox:this.window.getViewBox(),transMatrix:this.window.getViewBoxTransform()},Object.assign({renderStyle:this.renderStyle},e)))}resizeWindow(t,e,i=!0){this.window.resize(t,e),i&&this.render()}resize(t,e,i=!0){this.releaseStatus!=="released"&&(this.window.hasSubView()||this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.window.resize(t,e),this.forEachChildren(r=>{r.resize(t,e)}),this.camera&&this.option3d&&this.set3dOptions(this.option3d),i&&this.render())}resizeView(t,e,i=!0){this.releaseStatus!=="released"&&(this.viewBox.setValue(this.viewBox.x1,this.viewBox.y1,this.viewBox.x1+t,this.viewBox.y1+e),this.forEachChildren(r=>{r.resizeView(t,e)}),this.camera&&(this.camera.params=Object.assign(Object.assign({},this.camera.params),{right:this.width,bottom:this.height})),i&&this.render())}setViewBox(t,e,i,r,s){let o=!0;typeof t=="object"?(this.viewBox.setValue(t.x1,t.y1,t.x2,t.y2),e===!1&&(o=!1)):(this.viewBox.setValue(t,e,t+i,e+r),s===!1&&(o=!1)),this.forEachChildren(a=>{a.resizeView(this.viewBox.width(),this.viewBox.height())}),o&&this.render()}setDpr(t,e=!0){this.forEachChildren(i=>{i.setDpr(t)}),e&&this.render()}setOrigin(t,e){throw new Error("")}export(t){throw new Error("")}pick(t,e){if(this.releaseStatus==="released")return;const i=this.getPickerService().pick(this.children,new Yt(t,e),{bounds:this.AABBBounds});return!(!(i!=null&&i.graphic)&&!(i!=null&&i.group))&&i}startAnimate(t){throw new Error("")}setToFrame(t){throw new Error("")}release(){super.release(),this.hooks.beforeRender.unTap("constructor",this.beforeRender),this.hooks.afterRender.unTap("constructor",this.afterRender),this.eventSystem&&this.eventSystem.release(),this.layerService.releaseStage(this),this.pluginService.release(),this.forEach(t=>{t.release()}),this.interactiveLayer&&(this.interactiveLayer.forEachChildren(t=>{t.setStage&&t.setStage(null,null),this.interactiveLayer.removeChild(t)}),this.interactiveLayer.release()),this.window.release(),this.ticker.remTimeline(this.timeline),this.ticker.removeListener("afterTick",this.afterTickCb),this.renderService.renderTreeRoots=[]}setStage(t){}dirty(t,e){this.releaseStatus!=="released"&&(e&&t.transformWithMatrix(e),this.dirtyBounds.empty()&&this.dirtyBounds.setValue(t.x1,t.y1,t.x2,t.y2),this.dirtyBounds.union(t))}getLayer(t){return this.children.filter(e=>e.name===t)[0]}renderTo(t){this.releaseStatus!=="released"&&this.forEachChildren((e,i)=>{e.drawTo(t,{renderService:this.renderService,viewBox:t.getViewBox(),transMatrix:t.getViewBoxTransform(),background:e===this.defaultLayer?this.background:void 0,clear:i===0,updateBounds:!(!this.dirtyBounds||this.dirtyBounds.empty())})})}renderToNewWindow(t=!0,e){if(this.releaseStatus==="released")return;const i=Qt.get(S1),r=e?-e.x1:0,s=e?-e.y1:0,o=e?e.x2:this.viewWidth,a=e?e.y2:this.viewHeight,l=e?e.width():this.viewWidth,h=e?e.height():this.viewHeight;return i.create({viewBox:{x1:r,y1:s,x2:o,y2:a},width:l,height:h,dpr:this.window.dpr,canvasControled:!0,offscreen:!0,title:""}),this.renderTo(i),i}toCanvas(t=!0,e){if(this.releaseStatus==="released")return;const i=this.renderToNewWindow(t,e).getNativeHandler();return i.nativeCanvas?i.nativeCanvas:null}setCursor(t){this._cursor=t,this.eventSystem.setCursor(t,"ignore")}getCursor(){return this._cursor}eventPointTransform(t){const e=this.global.mapToCanvasPoint(t,this.window.getContext().canvas.nativeCanvas);return this.stage.window.pointTransform(e.x,e.y)}pauseTriggerEvent(){this._eventSystem&&this._eventSystem.pauseTriggerEvent()}resumeTriggerEvent(){this._eventSystem&&this._eventSystem.resumeTriggerEvent()}getPickerService(){return this.pickerService||(this.pickerService=Qt.get(Ip)),this.pickerService}}function o2t(n){return new s2t(n)}const EB={WIDTH:500,HEIGHT:500,DPR:1};class hF{get displayWidth(){return this._pixelWidth/this._dpr}get displayHeight(){return this._pixelHeight/this._dpr}get id(){return this._id}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get nativeCanvas(){return this._nativeCanvas}set nativeCanvas(t){this._nativeCanvas=t}get width(){return this._pixelWidth}set width(t){this._pixelWidth=t,this._displayWidth=t/(this._dpr||1)}get height(){return this._pixelHeight}set height(t){this._pixelHeight=t,this._displayHeight=t/(this._dpr||1)}getContext(t){return this._context}get visiable(){return this._visiable}set visiable(t){this._visiable=t,t?this.show():this.hide()}get dpr(){return this._dpr}set dpr(t){this._dpr=t,this.resize(this._displayWidth,this._displayHeight)}constructor(t){var e;const{nativeCanvas:i,width:r=EB.WIDTH,height:s=EB.HEIGHT,dpr:o=EB.DPR,x:a,y:l,id:h,canvasControled:d=!0}=t;this._x=a??0,this._y=l??0,this._pixelWidth=r*o,this._pixelHeight=s*o,this._visiable=t.visiable!==!1,this.controled=d,this._displayWidth=r,this._displayHeight=s,this._dpr=o,this._nativeCanvas=i,this._id=(e=i.id)!==null&&e!==void 0?e:h,h&&(i.id=h),this.init(t)}getNativeCanvas(){return this._nativeCanvas}hide(){}show(){}applyPosition(){}resetStyle(t){}resize(t,e){}toDataURL(t,e){return""}readPixels(t,e,i,r){return this._context.getImageData(t,e,i,r)}convertToBlob(t){throw new Error("")}transferToImageBitmap(){throw new Error("")}release(...t){this.controled&&this._nativeCanvas.parentElement&&this._nativeCanvas.parentElement.removeChild(this._nativeCanvas)}}hF.env="browser";var a2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},l2t=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};let ow=class{configure(n,...t){n.env===this.type&&n.setActiveEnvContribution(this)}getNativeAABBBounds(n){return new ie}removeDom(n){return!1}createDom(n){return null}updateDom(n,t){return!1}getDynamicCanvasCount(){return 999}getStaticCanvasCount(){return 999}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}loadJson(n){const t=fetch(n).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(n){return fetch(n).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadBlob(n){return fetch(n).then(t=>t.blob()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}getElementTop(n,t){return 0}getElementLeft(n,t){return 0}getElementTopLeft(n,t){return{top:0,left:0}}loadFont(n,t,e){return l2t(this,void 0,void 0,function*(){return{loadState:"fail"}})}isMacOS(){return!1}copyToClipBoard(n){return Promise.resolve(null)}};ow=a2t([It()],ow);var h2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},d2t=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let aw=class{constructor(){this._uid=nn.GenAutoIncrementId(),this.viewBox=new ie,this.modelMatrix=new Pe(1,0,0,1,0,0)}onChange(n){this._onChangeCb=n}configure(n,t){t.env===this.type&&n.setWindowHandler(this)}release(...n){this.releaseWindow()}isVisible(n){return!0}onVisibleChange(n){}getTopLeft(n){return{top:0,left:0}}setViewBox(n){this.viewBox.setValue(n.x1,n.y1,n.x2,n.y2)}getViewBox(){return this.viewBox}setViewBoxTransform(n,t,e,i,r,s){this.modelMatrix.setValue(n,t,e,i,r,s)}getViewBoxTransform(){return this.modelMatrix}};aw=h2t([It(),d2t("design:paramtypes",[])],aw);class u2t{constructor(t,e,i=.8){this.dir=t,this.color=e,this.colorRgb=Ki.Get(e,zs.Color1),this.ambient=i;const r=Rn(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);this.formatedDir=[t[0]/r,t[1]/r,t[2]/r]}computeColor(t,e){const i=this.formatedDir,r=we(ti((t[0]*i[0]+t[1]*i[1]+t[2]*i[2])*(1-this.ambient/2),0)+this.ambient,1);let s;s=yt(e)?Ki.Get(e,zs.Color1):e;const o=this.colorRgb;return`rgb(${o[0]*s[0]*r}, ${o[1]*s[1]*r}, ${o[2]*s[2]*r})`}}const dF=()=>{so.registerPlugin("DirectionalLight",u2t)};class c2t{set params(t){this._params=Object.assign({},t),this._projectionMatrixCached=this.forceGetProjectionMatrix(),this._viewMatrixCached=this.forceGetViewMatrix()}get params(){return Object.assign({},this._params)}constructor(t){this.params=t}getViewMatrix(){return this._viewMatrixCached||(this._viewMatrixCached=ki.allocate()),this._viewMatrixCached}forceGetViewMatrix(){this._viewMatrixCached||(this._viewMatrixCached=ki.allocate());const{pos:t,center:e,up:i}=this.params.viewParams;return GPt(this._viewMatrixCached,t,e,i),this._vp||(this._vp=ki.allocate()),this._vp=Ac(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._viewMatrixCached}getProjectionMatrix(){return this._projectionMatrixCached||(this._projectionMatrixCached=ki.allocate()),this._projectionMatrixCached}forceGetProjectionMatrix(){this._projectionMatrixCached||(this._projectionMatrixCached=ki.allocate());const{left:t,top:e,right:i,bottom:r}=this._params;return UPt(this._projectionMatrixCached,t,i,r,e,0,-2e6),this._vp||(this._vp=ki.allocate()),this._vp=Ac(this._vp,this.getProjectionMatrix(),this.getViewMatrix()),this._projectionMatrixCached}getField(){const{fieldRatio:t=.8,fieldDepth:e,left:i,right:r}=this._params;return(e??r-i)*t}getProjectionScale(t){const e=this.getField();return e/(e+t)}view(t,e,i){const r=[0,0,0];return As(r,[t,e,i],this._viewMatrixCached),r}vp(t,e,i){const r=[0,0,0],{pos:s}=this._params.viewParams;As(r,[t,e,i],this._viewMatrixCached),t=r[0],e=r[1],i=r[2];const o=this.getProjectionScale(i);return{x:t*o+s[0],y:e*o+s[1]}}}const uF=()=>{so.registerPlugin("OrthoCamera",c2t)};var g2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},p2t=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},Ky=function(n,t){return function(e,i){t(e,i,n)}};let M2=class{constructor(n,t){this.pickItemInterceptorContributions=n,this.pickServiceInterceptorContributions=t,this.type="default",this.global=bt.global}_init(){this.InterceptorContributions=this.pickItemInterceptorContributions.getContributions().sort((n,t)=>n.order-t.order),this.pickerServiceInterceptorContributions=this.pickServiceInterceptorContributions.getContributions().sort((n,t)=>n.order-t.order)}pick(n,t,e){let i={graphic:null,group:null};e.pickerService=this;const r=e.bounds.width(),s=e.bounds.height();if(!new ie().setValue(0,0,r,s).containsPoint(t))return i;this.pickContext&&(this.pickContext.inuse=!0),e.pickContext=this.pickContext,this.pickContext&&this.pickContext.clearMatrix(!0,1);const o=new Pe(1,0,0,1,0,0);let a;for(let l=n.length-1;l>=0&&(i=n[l].isContainer?this.pickGroup(n[l],t,o,e):this.pickItem(n[l],t,o,e),!i.graphic);l--)a||(a=i.group);if(i.graphic||(i.group=a),this.pickContext&&(this.pickContext.inuse=!1),this.pickerServiceInterceptorContributions.length)for(let l=0;l<this.pickerServiceInterceptorContributions.length;l++){const h=this.pickerServiceInterceptorContributions[l];h.afterPickItem&&(i=h.afterPickItem(i,this,t,e,{parentMatrix:o}))}return i}containsPoint(n,t,e){var i;return!!(!((i=this.pickItem(n,t,null,e??{pickContext:this.pickContext,pickerService:this}))===null||i===void 0)&&i.graphic)}pickGroup(n,t,e,i){let r={group:null,graphic:null};if(n.attribute.visibleAll===!1)return r;const s=i.pickContext,o=s.modelMatrix;if(s.camera){const g=n.transMatrix,p=ki.allocate();if(o2(p,g),o){if(p){const f=ki.allocate();s.modelMatrix=Ac(f,o,p),ki.free(p)}}else o2(p,n.globalTransMatrix),s.modelMatrix=p}if(this.InterceptorContributions.length)for(let g=0;g<this.InterceptorContributions.length;g++){const p=this.InterceptorContributions[g];if(p.beforePickItem){const f=p.beforePickItem(n,this,t,i,{parentMatrix:e});if(f)return s.modelMatrix!==o&&ki.free(s.modelMatrix),s.modelMatrix=o,f}}const a=n.transMatrix,l=rs.allocateByObj(e),h=new Yt(t.x,t.y);l.transformPoint(h,h);const d=n.AABBBounds.containsPoint(h);if(!d&&!n.stage.camera)return r;const u=this.pickItem(n,h.clone(),e,i);u&&u.graphic&&(r.graphic=u.graphic,r.params=u.params);const c=n.attribute.pickable!==!1&&d;return l.multiply(a.a,a.b,a.c,a.d,a.e,a.f),n.attribute.childrenPickable===!1||u&&u.graphic||XQ(n,Di.zIndex,g=>{if(g.isContainer){const p=new Yt(t.x,t.y),f=ne(n).group,{scrollX:m=f.scrollX,scrollY:v=f.scrollY}=n.attribute;p.x-=m,p.y-=v,r=this.pickGroup(g,p,l,i)}else{const p=new Yt(t.x,t.y);l.transformPoint(p,p);const f=ne(n).group,{scrollX:m=f.scrollX,scrollY:v=f.scrollY}=n.attribute;p.x-=m,p.y-=v;const _=this.pickItem(g,p,e,i);_&&_.graphic&&(r.graphic=_.graphic,r.params=_.params)}return!!r.graphic||!!r.group},!0,!!s.camera),s.modelMatrix!==o&&ki.free(s.modelMatrix),s.modelMatrix=o,r.graphic||r.group||!c||n.stage.camera||(r.group=n),rs.free(l),r}selectPicker(n){return this.pickerMap.get(n.numberType)||null}};M2=g2t([It(),Ky(0,ue(en)),Ky(0,xn(Ug)),Ky(1,ue(en)),Ky(1,xn(q1)),p2t("design:paramtypes",[Object,Object])],M2);function f2t(n,t){let e,i,r=n[0].x,s=n[0].y;const o=[n[0]];for(let a=1,l=n.length;a<l;a++)e=n[a].x-r,i=n[a].y-s,e*e+i*i>t&&(r=n[a].x,s=n[a].y,o.push(n[a]));return n[n.length-1].x===r&&n[n.length-1].y===s||o.push(n[n.length-1]),o}function m2t(n,t,e){return n.length<=10?n:n=f2t(n,t!==void 0?t*t:1)}let o4=!1;const v2t=new te(n=>{o4||(o4=!0,n(E1).toSelf().inSingletonScope(),n(z1).to(E1).inSingletonScope(),n(jn).toService(z1),n(JL).toService(Mo),Un(n,JL))});let a4=!1;const _2t=new te(n=>{a4||(a4=!0,n(D1).toSelf().inSingletonScope(),n(G1).to(D1).inSingletonScope(),n(jn).toService(G1),n(P1).toSelf(),n(B1).toSelf(),n(Qm).toService(P1),n(Qm).toService(B1),n(Qm).toService(Mo),Un(n,Qm))});let l4=!1;const b2t=new te(n=>{l4||(l4=!0,n(a0).toSelf().inSingletonScope(),n(nw).toSelf().inSingletonScope(),n(N1).to(a0).inSingletonScope(),n(jn).toService(N1))});let h4=!1;const y2t=new te(n=>{h4||(h4=!0,n(l0).toSelf().inSingletonScope(),n(W1).to(l0).inSingletonScope(),n(jn).toService(W1),n(QL).toService(Mo),Un(n,QL),n(rw).toSelf().inSingletonScope())});let d4=!1;const C2t=new te(n=>{d4||(d4=!0,n(F1).toSelf().inSingletonScope(),n(U1).to(F1).inSingletonScope(),n(jn).toService(U1),n(r2).toService(Mo),Un(n,r2))});let u4=!1;const S2t=new te(n=>{u4||(u4=!0,n(L1).toSelf().inSingletonScope(),n(j1).to(L1).inSingletonScope(),n(jn).toService(j1),n(t2).toService(Mo),Un(n,t2))});let c4=!1;const x2t=new te(n=>{c4||(c4=!0,n(_2).to(c2).inSingletonScope(),n(jn).toService(_2),n(s2).toService(Mo),Un(n,s2))});let g4=!1;const w2t=new te(n=>{g4||(g4=!0,n(O1).toSelf().inSingletonScope(),n($1).to(O1).inSingletonScope(),n(jn).toService($1),n(i2).toService(Mo),Un(n,i2))});let p4=!1;const A2t=new te(n=>{p4||(p4=!0,n(V1).to(g2).inSingletonScope(),n(jn).toService(V1),n(n2).toService(Mo),Un(n,n2))});var M2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let T2=class{constructor(){this.numberType=ND}drawShape(n,t,e,i,r,s,o,a){r.drawContribution&&n.getSubGraphic().forEach(l=>{const h=r.drawContribution.getRenderContribution(l);h&&h.drawShape&&h.drawShape(l,t,e,i,r,s,o,a)})}draw(n,t,e,i){const{context:r}=e;if(!r||(r.highPerformanceSave(),!e.drawContribution))return;const s=ne(n),o=n.getSubGraphic();o.length&&o.forEach(a=>{e.drawContribution.renderItem(a,e,{theme:s})}),r.highPerformanceRestore()}};T2=M2t([It()],T2);let f4=!1;const T2t=new te(n=>{f4||(f4=!0,n(Y1).to(T2).inSingletonScope(),n(jn).toService(Y1))});var k2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},R2t=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let k2=class extends Nr{constructor(){super(),this.numberType=YD,this.builtinContributions=[jQ],this.init()}drawShape(n,t,e,i,r){const s=ne(n).richtext,{strokeOpacity:o=s.strokeOpacity,opacity:a=s.opacity,fillOpacity:l=s.fillOpacity,visible:h=s.visible}=n.attribute;if(!n.valid||!h)return;const d=wc(a,l,!0),u=wc(a,o,!0);d&&(t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,s),t.translate(e,i),this.beforeRenderStep(n,t,e,i,d,u,d,u,s,r),n.getFrameCache().draw(t,this.drawIcon),this.afterRenderStep(n,t,e,i,d,u,d,u,s,r))}drawIcon(n,t,e,i,r){var s;const o=ne(n).richtextIcon,{width:a=o.width,height:l=o.height,opacity:h=o.opacity,image:d,backgroundFill:u=o.backgroundFill,backgroundFillOpacity:c=o.backgroundFillOpacity,backgroundStroke:g=o.backgroundStroke,backgroundStrokeOpacity:p=o.backgroundStrokeOpacity,backgroundRadius:f=o.backgroundRadius,margin:m}=n.attribute,{backgroundWidth:v=a,backgroundHeight:_=l}=n.attribute;if(m&&(e+=n._marginArray[3],i+=n._marginArray[0]),n._hovered){const y=(v-a)/2,C=(_-l)/2;f===0?(t.beginPath(),t.rect(e-y,i-C,v,_)):(t.beginPath(),Xc(t,e-y,i-C,v,_,f,!0)),u&&(t.globalAlpha=c,t.fillStyle=u,t.fill()),g&&(t.globalAlpha=p,t.strokeStyle=g,t.stroke())}const b=d&&((s=n==null?void 0:n.resources)===null||s===void 0?void 0:s.get(d));b&&b.state==="success"&&(t.globalAlpha=h,t.drawImage(b.data,e,i,a,l))}draw(n,t,e){const i=ne(n).richtext;this._draw(n,i,!1,e)}};k2=k2t([It(),R2t("design:paramtypes",[])],k2);let m4=!1;const B2t=new te(n=>{m4||(m4=!0,n(b2).to(k2).inSingletonScope(),n(jn).toService(b2))});let v4=!1;const P2t=new te(n=>{v4||(v4=!0,n(C2).to(f2).inSingletonScope(),n(jn).toService(C2),n(e2).toService(Mo),Un(n,e2))});class KQ extends Nr{stroke(t,e,i,r,s){const o=r.vertices;r.edges.forEach(a=>{const l=o[a[0]],h={x:t+l[0],y:e+l[1],z:i+l[2]},d=o[a[1]],u={x:t+d[0],y:e+d[1],z:i+d[2]};s.beginPath(),s.moveTo(h.x,h.y,h.z),s.lineTo(u.x,u.y,u.z),s.stroke()})}fill(t,e,i,r,s,o,a,l,h,d,u){const c=Ki.Get(o,zs.Color255),g=r.vertices,p=g.map(m=>a.view(m[0],m[1],m[2])[2]),f=[];r.polygons.forEach((m,v)=>{if(s&&!s[v])return;f.push({faceIdx:v,polygon:m});const{polygon:_}=m,b=p[_[0]],y=p[_[1]],C=p[_[2]],S=p[_[3]];m.ave_z=b+y+C+S}),f.sort((m,v)=>v.polygon.ave_z-m.polygon.ave_z),f.forEach(m=>{const{polygon:v,normal:_}=m.polygon,b=g[v[0]],y=g[v[1]],C=g[v[2]],S=g[v[3]],w={x:t+b[0],y:e+b[1],z:i+b[2]},x={x:t+y[0],y:e+y[1],z:i+y[2]},A={x:t+C[0],y:e+C[1],z:i+C[2]},M={x:t+S[0],y:e+S[1],z:i+S[2]};a.beginPath(),a.moveTo(w.x,w.y,w.z),a.lineTo(x.x,x.y,x.z),a.lineTo(A.x,A.y,A.z),a.lineTo(M.x,M.y,M.z),a.closePath(),u?u(a,h&&h.attribute,d):(a.fillStyle=l?l.computeColor(_,c):o,a.fill())})}}var E2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let R2=class extends KQ{constructor(){super(...arguments),this.type="rect3d",this.numberType=UD}drawShape(n,t,e,i,r,s,o,a){var l;const h=ne(n,s==null?void 0:s.theme).rect,{fill:d=h.fill,stroke:u=h.stroke,x1:c,y1:g,x:p,y:f,opacity:m=h.opacity,fillOpacity:v=h.fillOpacity,lineWidth:_=h.lineWidth,strokeOpacity:b=h.strokeOpacity,visible:y=h.visible}=n.attribute;let{width:C,height:S}=n.attribute;C=(C??c-p)||0,S=(S??g-f)||0;const w=(l=this.z)!==null&&l!==void 0?l:0,x=qD(m,v,C,S,d),A=ZD(m,b,C,S),M=xc(d),T=df(u,_);if(!n.valid||!y||!M&&!T||!(x||A||o||a))return;const{light:R}=r.stage||{},B=n.findFace();if(d!==!1){t.setCommonStyle(n,n.attribute,e,i,h);let E=d;typeof E!="string"&&(E="black"),this.fill(e,i,w,B,null,E,t,R,null,null,o)}u!==!1&&(t.setStrokeStyle(n,n.attribute,e,i,h),this.stroke(e,i,w,B,t))}draw(n,t,e){const i=ne(n).rect;this._draw(n,i,!1,e)}};R2=E2t([It()],R2);let _4=!1;const L2t=new te(n=>{_4||(_4=!0,n(v2).to(R2).inSingletonScope(),n(jn).toService(v2))});var I2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};function O2t(n,t,e,i,r,s,o){const{startAngle:a,endAngle:l}=n.getParsedAngle(),h=Et(l-a),d=l>a;let u=!1;if(s<o){const c=s;s=o,o=c}if(s<=$t)t.moveTo(e,i,r);else if(h>=Ft-$t)t.moveTo(e+s*me(a),i+s*ee(a),r),t.arc(e,i,s,a,l,!d,r),o>$t&&(t.moveTo(e+o*me(l),i+o*ee(l),r),t.arc(e,i,o,l,a,d,r));else{const{outerDeltaAngle:c,innerDeltaAngle:g,outerStartAngle:p,outerEndAngle:f,innerEndAngle:m,innerStartAngle:v}=n.getParsePadAngle(a,l),_=s*me(p),b=s*ee(p),y=o*me(m),C=o*ee(m);c<.001?u=!0:(t.moveTo(e+_,i+b,r),t.arc(e,i,s,p,f,!d,r)),!(o>$t)||g<.001?(t.lineTo(e+y,i+C,r),u=!0):(t.lineTo(e+y,i+C,r),t.arc(e,i,o,m,v,d,r))}return t.closePath(),u}function D2t(n,t,e,i,r,s,o,a){const{startAngle:l,endAngle:h}=n.getParsedAngle(),d=Et(h-l),u=h>l;let c=!1;if(o<=$t)t.moveTo(e,i,r);else if(d>=Ft-$t)t.moveTo(e+o*me(l),i+o*ee(l),r),t.arc(e,i,o,l,h,!u,r),t.lineTo(e+o*me(h),i+o*ee(h),s),t.arc(e,i,o,h,l,u,s);else{const{innerouterDeltaAngle:g,innerouterStartAngle:p,innerouterEndAngle:f}=a(l,h),m=o*me(p),v=o*ee(p),_=o*me(f),b=o*ee(f);g<.001?c=!0:(t.moveTo(e+m,i+v,r),t.arc(e,i,o,p,f,!u,r),t.lineTo(e+_,i+b,s),t.arc(e,i,o,f,p,u,s))}return t.closePath(),c}let B2=class extends Nr{constructor(){super(...arguments),this.numberType=NM}drawShape(n,t,e,i,r,s,o,a){var l;const h=ne(n,s==null?void 0:s.theme).arc,{fill:d=h.fill}=n.attribute,u=this.valid(n,h,o,a);if(!u)return;const{fVisible:c,sVisible:g,doFill:p,doStroke:f}=u,m=(l=this.z)!==null&&l!==void 0?l:0,{outerPadding:v=h.outerPadding,innerPadding:_=h.innerPadding,height:b=10}=n.attribute;let{outerRadius:y=h.outerRadius,innerRadius:C=h.innerRadius}=n.attribute;y+=v,C-=_;const S=Ki.Get(d,zs.Color255),{light:w}=r.stage||{},x=r.hack_pieFace,A={top:m,bottom:m+b},M={top:[0,1,0],bottom:[0,-1,0],outside:[1,0,-1],inside:[1,0,-1]};x==="bottom"||x==="top"?(t.beginPath(),O2t(n,t,e,i,A[x],y,C),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),p&&(o?o(t,n.attribute,h):c&&(t.setCommonStyle(n,n.attribute,e,i,h),t.fillStyle=w?w.computeColor(M[x],S):d,t.fill())),f&&(a?a(t,n.attribute,h):g&&(t.setStrokeStyle(n,n.attribute,e,i,h),t.stroke()))):x!=="outside"&&x!=="inside"||(x==="inside"&&(t.save(),t.beginPath(),t.arc(e,i,C,0,Ft,!0,A.top),t.clip()),t.beginPath(),D2t(n,t,e,i,A.top,A.bottom,x==="outside"?y:C,(T,R)=>{const{outerDeltaAngle:B,innerDeltaAngle:E,outerStartAngle:k,outerEndAngle:P,innerEndAngle:I,innerStartAngle:O}=n.getParsePadAngle(T,R);return x==="outside"?{innerouterDeltaAngle:B,innerouterEndAngle:P,innerouterStartAngle:k}:{innerouterDeltaAngle:E,innerouterEndAngle:I,innerouterStartAngle:O}}),t.setShadowBlendStyle&&t.setShadowBlendStyle(n,n.attribute,h),p&&(o?o(t,n.attribute,h):c&&(t.setCommonStyle(n,n.attribute,e,i,h),t.fillStyle=w?w.computeColor(M[x],S):d,t.fill())),f&&(a?a(t,n.attribute,h):g&&(t.setStrokeStyle(n,n.attribute,e,i,h),t.stroke())),x==="inside"&&t.restore())}draw(n,t,e,i){const r=ne(n,i==null?void 0:i.theme).arc;this._draw(n,r,!1,e,i)}};B2=I2t([It()],B2);let b4=!1;const F2t=new te(n=>{b4||(b4=!0,n(m2).to(B2).inSingletonScope(),n(jn).toService(m2))});var H2t=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let P2=class extends KQ{constructor(){super(...arguments),this.type="pyramid3d",this.numberType=VD}drawShape(n,t,e,i,r,s,o,a){var l;const h=ne(n,s==null?void 0:s.theme).polygon,{fill:d=h.fill,stroke:u=h.stroke,face:c=[!0,!0,!0,!0,!0,!0]}=n.attribute,g=(l=this.z)!==null&&l!==void 0?l:0;if(!this.valid(n,h,o,a))return;const{light:p}=r.stage||{},f=n.findFace();if(d!==!1){t.setCommonStyle(n,n.attribute,e,i,h);let m=d;typeof m!="string"&&(m="black"),this.fill(e,i,g,f,c,m,t,p,n,h,o)}u!==!1&&(t.setStrokeStyle(n,n.attribute,e,i,h),this.stroke(e,i,g,f,t))}draw(n,t,e){const i=ne(n).polygon;this._draw(n,i,!1,e)}};P2=H2t([It()],P2);let y4=!1;const z2t=new te(n=>{y4||(y4=!0,n(y2).to(P2).inSingletonScope(),n(jn).toService(y2))});function W2t(){Pt.RegisterGraphicCreator("arc",rF)}function j2t(){Pt.RegisterGraphicCreator("arc3d",OQ)}function N2t(){Pt.RegisterGraphicCreator("area",IQ)}function $2t(){Pt.RegisterGraphicCreator("circle",JPt)}function V2t(){Pt.RegisterGraphicCreator("glyph",PQ)}function G2t(){Pt.RegisterGraphicCreator("group",XD)}function U2t(){Pt.RegisterGraphicCreator("image",nF)}function Y2t(){Pt.RegisterGraphicCreator("line",eF)}function X2t(){Pt.RegisterGraphicCreator("path",LQ)}function K2t(){Pt.RegisterGraphicCreator("polygon",DQ)}function q2t(){Pt.RegisterGraphicCreator("pyramid3d",FQ)}function Z2t(){Pt.RegisterGraphicCreator("rect",mb)}function J2t(){Pt.RegisterGraphicCreator("rect3d",BQ)}function Q2t(){Pt.RegisterGraphicCreator("richtext",EQ)}function tIt(){Pt.RegisterGraphicCreator("symbol",fb)}function eIt(){Pt.RegisterGraphicCreator("text",uf)}function iIt(){Pt.RegisterGraphicCreator("shadowRoot",sEt)}class qQ{constructor(){this.name="HtmlAttributePlugin",this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.htmlMap={},this.renderId=0,this.onWheel=t=>{try{const e=new t.constructor(t.type,t);this.pluginService.stage.window.getContext().getCanvas().nativeCanvas.dispatchEvent(e)}catch{return}}}activate(t){this.pluginService=t,t.stage.hooks.afterRender.tap(this.key,e=>{e&&e===this.pluginService.stage&&this.drawHTML([...t.stage.getChildren()])})}deactivate(t){t.stage.hooks.afterRender.taps=t.stage.hooks.afterRender.taps.filter(e=>e.name!==this.key),bt.graphicService.hooks.onRemove.unTap(this.key),bt.graphicService.hooks.onRelease.unTap(this.key),this.release()}getWrapContainer(t,e,i){let r;return r=e?typeof e=="string"?bt.global.getElementById(e):e:t.window.getContainer(),{wrapContainer:bt.global.createDom(Object.assign({tagName:"div",parent:r},i)),nativeContainer:r}}parseDefaultStyleFromGraphic(t){const e=t.type==="text"&&t.attribute?t.attribute:ne(t).text;return WPt(e)}getTransformOfText(t){const e=ne(t).text,{textAlign:i=e.textAlign,textBaseline:r=e.textBaseline}=t.attribute,s=t.globalTransMatrix.toTransformAttrs(),{rotateDeg:o,scaleX:a,scaleY:l}=s,h={left:"0",start:"0",end:"-100%",center:"-50%",right:"-100%",top:"0",middle:"-50%",bottom:"-100%",alphabetic:"-79%"},d={left:"0",start:"0",end:"100%",center:"50%",right:"100%",top:"0",middle:"50%",bottom:"100%",alphabetic:"79%"};return{textAlign:i,transform:`translate(${h[i]},${h[r]}) rotate(${o}deg) scaleX(${a}) scaleY(${l})`,transformOrigin:`${d[i]} ${d[r]}`}}updateStyleOfWrapContainer(t,e,i,r,s){const{pointerEvents:o,penetrateEventList:a=[]}=s;let l=this.parseDefaultStyleFromGraphic(t);l.display=t.attribute.visible!==!1?"block":"none",l.pointerEvents=o===!0?"all":o||"none",l.pointerEvents!=="none"&&(this.removeWrapContainerEventListener(i),a.forEach(_=>{_==="wheel"&&i.addEventListener("wheel",this.onWheel)})),i.style.position||(i.style.position="absolute",r.style.position="relative");let h=0,d=0;const u=t.globalAABBBounds;let c=s.anchorType;if(D(c)&&(c=t.type==="text"?"position":"boundsLeftTop"),c==="boundsLeftTop"&&(c="top-left"),c==="position"||u.empty()){const _=t.globalTransMatrix;h=_.e,d=_.f}else{const _=PY(u,c);h=_.x,d=_.y}const g=bt.global.getElementTopLeft(r,!1),p=e.window.getTopLeft(!1),f=e.viewBox,m=h+p.left-g.left+f.x1,v=d+p.top-g.top+f.y1;if(l.left=`${m}px`,l.top=`${v}px`,t.type==="text"&&c==="position"&&(l=Object.assign(Object.assign({},l),this.getTransformOfText(t))),it(s.style)){const _=s.style({top:v,left:m,width:u.width(),height:u.height()},t,i);_&&(l=Object.assign(Object.assign({},l),_))}else kt(s.style)?l=Object.assign(Object.assign({},l),s.style):yt(s.style)&&s.style&&(l=Object.assign(Object.assign({},l),Blt(s.style)));bt.global.updateDom(i,{width:s.width,height:s.height,style:l})}clearCacheContainer(){this.htmlMap&&Object.keys(this.htmlMap).forEach(t=>{this.htmlMap[t]&&this.htmlMap[t].renderId!==this.renderId&&this.removeElement(t)}),this.renderId+=1}drawHTML(t){bt.global.env==="browser"&&(t.sort((e,i)=>{var r,s;return((r=e.attribute.zIndex)!==null&&r!==void 0?r:Di.zIndex)-((s=i.attribute.zIndex)!==null&&s!==void 0?s:Di.zIndex)}).forEach(e=>{this.renderGroupHTML(e)}),this.clearCacheContainer())}renderGroupHTML(t){this.renderGraphicHTML(t),t.forEachChildren(e=>{e.isContainer?this.renderGroupHTML(e):this.renderGraphicHTML(e)})}removeElement(t){if(!this.htmlMap||!this.htmlMap[t])return;const{wrapContainer:e}=this.htmlMap[t];e&&bt.global.removeDom(e),this.htmlMap[t]=null}removeWrapContainerEventListener(t){t.removeEventListener("wheel",this.onWheel)}renderGraphicHTML(t){var e;const{html:i}=t.attribute;if(!i)return;const r=t.stage;if(!r)return;const{dom:s,container:o}=i;if(!s)return;const a=D(i.id)?`${(e=t.id)!==null&&e!==void 0?e:t._uid}_react`:i.id;if(this.htmlMap&&this.htmlMap[a]&&o&&o!==this.htmlMap[a].container&&this.removeElement(a),this.htmlMap&&this.htmlMap[a])typeof s=="string"?this.htmlMap[a].wrapContainer.innerHTML=s:s!==this.htmlMap[a].wrapContainer.firstChild&&(this.htmlMap[a].wrapContainer.removeChild(this.htmlMap[a].wrapContainer.firstChild),this.htmlMap[a].wrapContainer.appendChild(s));else{const{wrapContainer:d,nativeContainer:u}=this.getWrapContainer(r,o);d&&(typeof s=="string"?d.innerHTML=s:d.appendChild(s),this.htmlMap||(this.htmlMap={}),this.htmlMap[a]={wrapContainer:d,nativeContainer:u,container:o,renderId:this.renderId})}if(!this.htmlMap||!this.htmlMap[a])return;const{wrapContainer:l,nativeContainer:h}=this.htmlMap[a];this.updateStyleOfWrapContainer(t,r,l,h,i),this.htmlMap[a].renderId=this.renderId}release(){bt.global.env==="browser"&&this.removeAllDom(this.pluginService.stage.defaultLayer)}removeAllDom(t){this.htmlMap&&(Object.keys(this.htmlMap).forEach(e=>{this.removeElement(e)}),this.htmlMap=null)}}const nIt=()=>{so.registerPlugin("HtmlAttributePlugin",qQ)};class rIt extends qQ{constructor(){super(...arguments),this.name="ReactAttributePlugin",this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.htmlMap={}}removeElement(t){if(!this.htmlMap||!this.htmlMap[t])return;const{root:e,wrapContainer:i,unmount:r}=this.htmlMap[t];e?bt.global.getRequestAnimationFrame()(()=>{e.unmount()}):r&&r(),i&&bt.global.removeDom(i),this.htmlMap[t]=null}renderGraphicHTML(t){var e;const{react:i}=t.attribute;if(!i)return;const r=t.stage;if(!r)return;const s=r.params.ReactDOM,{element:o,container:a}=i;if(!o||!s||!s.createRoot&&!s.render)return;const l=D(i.id)?`${(e=t.id)!==null&&e!==void 0?e:t._uid}_react`:i.id;if(this.htmlMap&&this.htmlMap[l]&&a&&a!==this.htmlMap[l].container&&this.removeElement(l),this.htmlMap&&this.htmlMap[l])s.createRoot?this.htmlMap[l].root.render(o):s.render(o,this.htmlMap[l].wrapContainer);else{const{wrapContainer:u,nativeContainer:c}=this.getWrapContainer(r,a);if(u)if(this.htmlMap||(this.htmlMap={}),s.createRoot){const g=s.createRoot(u);g.render(o),this.htmlMap[l]={root:g,wrapContainer:u,nativeContainer:c,container:a,renderId:this.renderId}}else s.render(o,u),this.htmlMap[l]={wrapContainer:u,nativeContainer:c,container:a,renderId:this.renderId,unmount:()=>{s.unmountComponentAtNode(u)}}}if(!this.htmlMap||!this.htmlMap[l])return;const{wrapContainer:h,nativeContainer:d}=this.htmlMap[l];this.updateStyleOfWrapContainer(t,r,h,d,i),this.htmlMap[l].renderId=this.renderId}}const sIt=()=>{so.registerPlugin("ReactAttributePlugin",rIt)};class oIt{constructor(){this.name="ViewTransform3dPlugin",this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.onMouseDown=t=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!0,this.pageX=t.page.x,this.pageY=t.page.y)},this.onMouseUp=t=>{this.option3d||(this.option3d=this.pluginService.stage.option3d),this.option3d&&(this.mousedown=!1)},this.onMouseMove=t=>{var e,i;const r=this.pluginService.stage;if(this.option3d||(this.option3d=r.option3d),this.option3d&&this.mousedown)if(this.pageX&&this.pageY){const s=t.page.x-this.pageX,o=t.page.y-this.pageY;this.pageX=t.page.x,this.pageY=t.page.y;const a=s/100,l=o/100;this.option3d.alpha=((e=this.option3d.alpha)!==null&&e!==void 0?e:0)+a,this.option3d.beta=((i=this.option3d.beta)!==null&&i!==void 0?i:0)+l,r.set3dOptions(this.option3d),r.renderNextFrame()}else this.pageX=t.page.x,this.pageY=t.page.y}}activate(t){this.pluginService=t;const e=t.stage;this.option3d=e.option3d,e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),e.addEventListener("mousemove",this.onMouseMove)}deactivate(t){const e=t.stage;e.removeEventListener("mousedown",this.onMouseDown),e.removeEventListener("mouseup",this.onMouseUp),e.removeEventListener("mousemove",this.onMouseMove)}}const aIt=()=>{so.registerPlugin("ViewTransform3dPlugin",oIt)};function E2(n){const t=[];for(let e=0;e<n.length;e++){const i=n[e];e!==0&&i[0]===t[t.length-1]||t.push(i[0]),t.push(i[1])}return t}const ls=(n,t)=>(it(lw.warnHandler)&&lw.warnHandler.call(null,n,t),ge.getInstance().warn(`[VChart warn]: ${n}`)),h0=(n,t,e)=>{{if(!it(lw.errorHandler))throw new Error(n);lw.errorHandler.call(null,n,t)}},lw={warnHandler:!1,errorHandler:!1},ZQ=lF(),Xg=ZQ&&globalThis?globalThis.document:void 0;function Ua(n){return(n==="desktop-browser"||n==="mobile-browser")&&ZQ}function Pd(n){return Yd(n)||n==="mobile-browser"}function Yd(n){return n.includes("miniApp")||n==="lynx"||n==="wx"||n==="harmony"}let LB=0;function Kc(){return LB>=9999999&&(LB=0),LB++}function mf(n){return n!=null&&n!==""&&(!!J(n)||+n==+n)}function lIt(n){if(et(n))return n;const t=+n;return et(t)?t:0}function Kg(n){return!(!n||n.length===0)&&!D(n[0])&&!D(n[0].dataId)&&V(n[0].fields)}const hIt=(n,t,e)=>(n.fields=t||[],n.fname=e,n),dIt=n=>t=>Dt(t,n),uIt=n=>n,cIt=n=>0,ec=n=>{ge.getInstance().error(n)},gIt=n=>{const t=[],e=n.length;let i,r,s,o=null,a=0,l="";n+="";const h=()=>{t.push(l+n.substring(i,r)),l="",i=r+1};for(i=0,r=0;r<e;r+=1)if(s=n[r],s==="\\")l+=n.substring(i,r),l+=n.substring(++r,++r),i=r;else if(s===o)h(),o=null,a=-1;else{if(o)continue;i===a&&s==='"'||i===a&&s==="'"?(i=r+1,o=s):s!=="."||a?s==="["?(r>i&&h(),i=r+1,a=i):s==="]"&&(a||ec("Access path missing open bracket: "+n),a>0&&h(),a=0,i=r+1):r>i?h():i=r+1}return a&&ec("Access path missing closing bracket: "+n),o&&ec("Access path missing closing quote: "+n),r>i&&(r+=1,h()),t},C4=(n,t,e={})=>{if(it(n))return n;const i=gIt(n),r=i.length===1?i[0]:n;return hIt((e&&e.get||dIt)(i),[r],r)},Za=(n,t,e={})=>{if(V(n)){const i=n.map(r=>C4(r,t,e));return r=>i.map(s=>s(r))}return C4(n,t,e)},S4=(n,t)=>{const e=it(t)?t:s=>s;let i,r;if(n&&n.length){const s=n.length;for(let o=0;o<s;o+=1){let a=e(n[o]);D(a)||!J(a=+a)||Number.isNaN(a)||(D(i)?(i=a,r=a):(i=Math.min(i,a),r=Math.max(r,a)))}return[i,r]}return[i,r]},Wo=(n,t)=>D(n)?t:yt(n)?t*parseFloat(n)/100:n;function pIt(n,t,e,i){const r=i-n*n,s=Math.abs(r)<1e-24?0:(e-n*t)/r;return[t-s*n,s]}function JQ(n,t,e,i){let r,s,o=-1;n.forEach(a=>{r=t(a),s=e(a),!D(r)&&(r=+r)>=r&&!D(s)&&(s=+s)>=s&&i(r,s,++o)})}function fIt(n,t,e,i,r){let s=0,o=0;return JQ(n,t,e,(a,l)=>{const h=l-r(a),d=l-i;s+=h*h,o+=d*d}),1-s/o}function mIt(n,t=i=>i.x,e=i=>i.y){let i=0,r=0,s=0,o=0,a=0;JQ(n,t,e,(d,u)=>{++a,i+=(d-i)/a,r+=(u-r)/a,s+=(d*u-s)/a,o+=(d*d-o)/a});const l=pIt(i,r,s,o),h=d=>l[0]+l[1]*d;return{coef:l,predict:h,rSquared:fIt(n,t,e,r,h)}}function er(n){return n==="horizontal"}function x4(n){return n==="vertical"}const IB={triangleForward:yIt,triangleUpright:w4,triangle:w4,diamond:vIt,square:bIt,star:_It,cardioid:CIt,circle:SIt,pentagon:xIt};function vIt(){return function(n){const t=n%(2*Math.PI/4);return 1/(Math.cos(t)+Math.sin(t))}}function _It(){return function(n){const t=(n+.955)%(2*Math.PI/10);return(n+.955)%(2*Math.PI/5)-2*Math.PI/10>=0?1/(Math.cos(2*Math.PI/10-t)+3.07768*Math.sin(2*Math.PI/10-t)):1/(Math.cos(t)+3.07768*Math.sin(t))}}function bIt(){return function(n){return Math.min(1/Math.abs(Math.cos(n)),1/Math.abs(Math.sin(n)))}}function w4(){return function(n){const t=(n+3*Math.PI/2)%(2*Math.PI/3);return 1/(Math.cos(t)+Math.sqrt(3)*Math.sin(t))}}function yIt(){return function(n){const t=n%(2*Math.PI/3);return 1/(Math.cos(t)+Math.sqrt(3)*Math.sin(t))}}function CIt(){return function(n){return 1+Math.sin(n)}}function SIt(){return function(){return 1}}function xIt(){return function(n){const t=(n+.955)%(2*Math.PI/5);return 1/(Math.cos(t)+.726543*Math.sin(t))}}function cF(n,t){const e=t[0],i=t[1];let r=1;const s=[t[0]>>1,t[1]>>1];switch(n){case"cardioid":s[1]=~~(i/2.7*.4),r=Math.floor(Math.min(e/2.3,i/2.6));break;case"triangleForward":r=i/Math.sqrt(.75)>e?Math.floor(e/2):Math.floor(i/(2*Math.sqrt(.75)));break;case"triangle":case"triangleUpright":s[1]=~~(i/1.5),r=Math.floor(Math.min(i/1.5,e/2));break;case"circle":case"diamond":case"square":case"star":case"pentagon":r=Math.floor(Math.min(e/2,i/2));break;default:r=Math.floor(Math.max(e/2,i/2))}return{maxRadius:r,center:s}}const QQ=n=>IB[n]?IB[n]():IB.circle(),L2=n=>{if(!n||n==="#fff")return(i,r,s)=>{const o=i.width;return i.data[r*o*4+4*s+3]===0||i.data[r*o*4+4*s+0]===255&&i.data[r*o*4+4*s+1]===255&&i.data[r*o*4+4*s+2]===255};const t=le.createCanvas({width:1,height:1}).getContext("2d",{willReadFrequently:!0});t.fillStyle=n,t.fillRect(0,0,1,1);const e=t.getImageData(0,0,1,1).data;return(i,r,s)=>{const o=i.width;return[0,1,2,3].every(a=>i.data[4*(r*o+s)+a]===e[a])}},ttt=(n,t,e,i)=>{const{backgroundColor:r="#fff"}=n,s=le.createCanvas({width:t,height:e,dpr:1}),o=s.getContext("2d",{willReadFrequently:!0});return o.fillStyle=r,o.fillRect(0,0,s.width,s.height),n.type==="text"?wIt(n,s.width,s.height,o):n.type==="geometric"&&TIt(n,s.width,s.height,o),s},wIt=(n,t,e,i)=>{const{fontFamily:r="sans-serif",fontWeight:s="normal",fontStyle:o="normal",fontVariant:a="normal",fill:l,text:h,hollow:d}=n;let u=12;i.font=`${o} ${a} ${s} ${u}px ${r}`,i.textAlign="center",i.textBaseline="middle",i.fillStyle=l??"black";const c=i.measureText(h),g=o!=="normal"?1.1:1,p=L(c.actualBoundingBoxRight)&&L(c.actualBoundingBoxLeft)?Math.ceil(g*(Math.abs(c.actualBoundingBoxRight)+Math.abs(c.actualBoundingBoxLeft))):0,f=Math.max(Math.ceil(c.width),p,u);if(d&&(i.globalCompositeOperation="xor"),f>t){const m=Math.min(t/f,e/u);i.fillText(h,t/2,e/2),i.scale(m,m)}else u=Math.floor(u*t/f),u=Math.min(u,e),i.font=`${o} ${a} ${s} ${u}px ${r}`,i.fillText(h,Math.floor(t/2),Math.floor(e/2))},su=(n,t,e=0,i)=>{const r=2*Math.PI/i;return new Array(i).fill(0).map((s,o)=>ui(n,t,e+o*r))},AIt=(n,t,e=0,i)=>{const r=2*Math.PI/i,s=QQ("cardioid");return new Array(i).fill(0).map((o,a)=>{const l=e+a*r,h=t*s(l);return ui(n,h,l)})},fg=(n,t)=>{n.beginPath(),t.forEach((e,i)=>{i===0?n.moveTo(e.x,e.y):n.lineTo(e.x,e.y)}),n.closePath(),n.fill()},MIt=(n,t)=>{let e;n.beginPath(),t.forEach((i,r)=>{r===0?n.moveTo(i.x,i.y):n.bezierCurveTo(i.x,i.y,e.x,e.y,i.x,i.y),e=i}),n.closePath(),n.fill()},TIt=(n,t,e,i)=>{const{fill:r,hollow:s}=n,{center:o,maxRadius:a}=cF(n.shape,[t,e]);i.fillStyle=r??"black",s&&(i.globalCompositeOperation="xor");const l=o[0],h=o[1];if(n.shape==="cardioid")MIt(i,AIt({x:l,y:h},a,0,100));else if(n.shape==="circle")i.beginPath(),i.arc(l,h,a,0,2*Math.PI,!0),i.fill();else if(n.shape==="diamond")fg(i,su({x:l,y:h},a,-Math.PI/2,4));else if(n.shape==="square")fg(i,su({x:l,y:h},a,-Math.PI/4,4));else if(n.shape==="pentagon")fg(i,su({x:l,y:h},a,Math.PI/2,5));else if(n.shape==="triangle"||n.shape==="triangleUpright")fg(i,su({x:l,y:h},a,-Math.PI/2,3));else if(n.shape==="triangleForward")fg(i,su({x:l,y:h},a,0,3));else if(n.shape==="star"){const d=su({x:l,y:h},a,-Math.PI/2,5),u=su({x:l,y:h},a/(2*Math.cos(Math.PI/5)),-Math.PI/2+Math.PI/5,5),c=[];for(let g=0;g<5;g++)c.push(d[g]),c.push(u[g]);fg(i,c)}else i.fillRect(0,0,t,e)},kIt=["x","y","dx","dy","scaleX","scaleY","angle","anchor","postMatrix","visible","clip","pickable","childrenPickable","zIndex","cursor"];class En extends $f{constructor(t,e){super(t),this._skipRenderAttributes=kIt,e!=null&&e.mode&&(this.mode=e.mode,this.setMode(e.mode)),e!=null&&e.skipDefault&&(this.skipDefault=!0),this.setTheme({common:{strokeBoundsBuffer:0}}),this.attribute=t,this.onSetStage(()=>{this.render(),this.bindEvents()})}setAttribute(t,e,i,r){const s=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate({[t]:e},this.attribute,t,r);if(s)return this._setAttributes(s,i);os(this.attribute[t])&&os(e)&&!it(this.attribute[t])&&!it(e)?Z(this.attribute[t],e):this.attribute[t]=e,this._skipRenderAttributes.includes(t)||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!i&&!this.needUpdateTag(t)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}setAttributes(t,e,i){return t=this.onBeforeAttributeUpdate&&this.onBeforeAttributeUpdate(t,this.attribute,null,i)||t,this._setAttributes(t,e)}_setAttributes(t,e){const i=Object.keys(t);this._mergeAttributes(t,i),i.every(r=>this._skipRenderAttributes.includes(r))||this.render(),this.valid=this.isValid(),this.updateShapeAndBoundsTagSetted()||!e&&!this.needUpdateTags(i)?this.addUpdateBoundTag():this.addUpdateShapeAndBoundsTag(),this.addUpdatePositionTag(),this.onAttributeUpdate()}_mergeAttributes(t,e){D(e)&&(e=Object.keys(t));for(let i=0;i<e.length;i++){const r=e[i];!os(this.attribute[r])||it(this.attribute[r])||it(t[r])?this.attribute[r]=t[r]:Z(this.attribute[r],t[r])}}bindEvents(){}_getNodeId(t){var e;return`${(e=this.id)!==null&&e!==void 0?e:this._uid}-${this.name}-${t}`}_dispatchEvent(t,e){var i;const r=new FM(t,e);r.manager=(i=this.stage)===null||i===void 0?void 0:i.eventSystem.manager,this.dispatchEvent(r)}}const gh=Symbol.for("MathPickerContribution"),A4=Symbol.for("MathArcPicker"),M4=Symbol.for("MathAreaPicker"),T4=Symbol.for("MathCirclePicker"),hw=Symbol.for("MathImagePicker"),k4=Symbol.for("MathLinePicker"),R4=Symbol.for("MathPathPicker"),B4=Symbol.for("MathRectPicker"),P4=Symbol.for("MathSymbolPicker"),E4=Symbol.for("MathTextPicker"),L4=Symbol.for("MathPolygonPicker"),I4=Symbol.for("MathGlyphPicker"),O4=Symbol.for("CanvasArcPicker"),D4=Symbol.for("CanvasArc3dPicker"),F4=Symbol.for("CanvasAreaPicker"),H4=Symbol.for("CanvasCirclePicker"),z4=Symbol.for("CanvasImagePicker"),W4=Symbol.for("CanvasLinePicker"),j4=Symbol.for("CanvasPathPicker"),N4=Symbol.for("CanvasRectPicker"),$4=Symbol.for("CanvasRect3dPicker"),V4=Symbol.for("CanvasSymbolPicker"),G4=Symbol.for("CanvasTextPicker"),U4=Symbol.for("CanvasPolygonPicker"),Y4=Symbol.for("CanvasPyramid3dPicker"),X4=Symbol.for("CanvasRichTextPicker"),K4=Symbol.for("CanvasGlyphPicker"),q4=Symbol.for("CanvasGroupPicker"),Yn=Symbol.for("CanvasPickerContribution"),Z4=(n,t)=>{const e=t.x-n.x,i=t.y-n.y;return Math.abs(e)>Math.abs(i)?e>0?"right":"left":i>0?"down":"up"},qy=(n,t)=>{const e=Math.abs(t.x-n.x),i=Math.abs(t.y-n.y);return Math.sqrt(e*e+i*i)},RIt=n=>{const t=n.length;if(t===1)return{x:Math.round(n[0].x),y:Math.round(n[0].y)};let e=0,i=0,r=0;for(;r<t;)e+=n[r].x,i+=n[r].y,r++;return{x:Math.round(e/t),y:Math.round(i/t)}};class BIt extends us{constructor(t,e={}){var i,r,s,o,a,l,h,d,u,c;super(),this.cachedEvents=[],this.startPoints=[],this.processEvent={},this.throttleTimer=0,this.emitThrottles=[],this.lastTapTarget=null,this.onStart=g=>{this.startTime=Hu.now();const{cachedEvents:p,startPoints:f}=this;g&&p.push(g.clone()),f.length=p.length;for(let m=0;m<p.length;m++){const{x:v,y:_}=p[m],b={x:v,y:_};f[m]=b}if(f.length!==1)this.startDistance=qy(f[0],f[1]),this.center=RIt([f[0],f[1]]);else{const m=p[0];this.pressTimeout=setTimeout(()=>{m.direction="none",m.deltaX=0,m.deltaY=0,m.points=f,this.triggerStartEvent("press",m),this.triggerEvent("press",m),this.eventType="press",this.direction="none",this.pressTimeout=null},this.config.press.time)}},this.onMove=g=>{this.clearPressTimeout();const{startPoints:p,cachedEvents:f}=this;if(!p.length)return;const m=g.clone(),{x:v,y:_,pointerId:b}=m;for(let A=0,M=f.length;A<M;A++)if(b===f[A].pointerId){f[A]=m;break}const y={x:v,y:_},C=f.map(A=>({x:A.x,y:A.y})),S=Hu.now();if(this.prevMoveTime=this.lastMoveTime,this.prevMovePoint=this.lastMovePoint,this.lastMoveTime=S,this.lastMovePoint=y,p.length===1){const A=p[0],M=v-A.x,T=_-A.y,R=this.direction||Z4(A,y);this.direction=R;const B=this.getEventType(y);return m.direction=R,m.deltaX=M,m.deltaY=T,m.points=C,this.triggerStartEvent(B,m),void this.triggerEvent(B,m)}const{startDistance:w}=this,x=qy(C[0],C[1]);m.scale=x/w,m.center=this.center,m.points=C,this.triggerStartEvent("pinch",m),this.triggerEvent("pinch",m)},this.onEnd=g=>{const p=g.clone(),{cachedEvents:f,startPoints:m}=this,v=f.map(_=>({x:_.x,y:_.y}));if(p.points=v,this.triggerEndEvent(p),f.length===1){const _=Hu.now(),b=this.lastMoveTime;if(_-b<100){const y=b-(this.prevMoveTime||this.startTime);if(y>0){const C=this.prevMovePoint||m[0],S=this.lastMovePoint||m[0],w=qy(C,S),x=w/y;if(x>this.config.swipe.velocity&&w>this.config.swipe.threshold)return p.velocity=x,p.direction=Z4(C,S),this.triggerEvent("swipe",p),this.cachedEvents=[],this.startPoints=[],void this.reset()}}_-this.startTime<this.config.press.time&&(_-this.lastTapTime<this.config.tap.interval&&g.target===this.lastTapTarget?this.tapCount++:this.tapCount=1,this.lastTapTime=_,this.lastTapTarget=g.target,this.tapCount===1?this.triggerEvent("tap",p):this.tapCount===2&&(this.triggerEvent("doubletap",p),this.tapCount=0))}for(let _=0,b=f.length;_<b;_++)if(f[_].pointerId===p.pointerId){f.splice(_,1),m.splice(_,1);break}this.reset(),f.length>0&&this.onStart()},this.element=t,this.tapCount=0,this.lastTapTime=0,this.config={press:{time:(r=(i=e==null?void 0:e.press)===null||i===void 0?void 0:i.time)!==null&&r!==void 0?r:251,threshold:(o=(s=e==null?void 0:e.press)===null||s===void 0?void 0:s.threshold)!==null&&o!==void 0?o:9},swipe:{threshold:(l=(a=e==null?void 0:e.swipe)===null||a===void 0?void 0:a.threshold)!==null&&l!==void 0?l:10,velocity:(d=(h=e==null?void 0:e.swipe)===null||h===void 0?void 0:h.velocity)!==null&&d!==void 0?d:.3},tap:{interval:(c=(u=e==null?void 0:e.tap)===null||u===void 0?void 0:u.interval)!==null&&c!==void 0?c:300}},this.initEvents()}initEvents(){const{element:t}=this;t&&(t.addEventListener("pointerdown",this.onStart),t.addEventListener("pointermove",this.onMove),t.addEventListener("pointerup",this.onEnd),t.addEventListener("pointerleave",this.onEnd),t.addEventListener("pointerupoutside",this.onEnd))}removeEvents(){const{element:t}=this;t&&(t.removeEventListener("pointerdown",this.onStart),t.removeEventListener("pointermove",this.onMove),t.removeEventListener("pointerup",this.onEnd),t.removeEventListener("pointerleave",this.onEnd),t.removeEventListener("pointerupoutside",this.onEnd))}release(){this.removeEvents(),this.element=null}getEventType(t){const{eventType:e,startTime:i,startPoints:r}=this;if(e==="press")return e;let s;return s=Hu.now()-i>this.config.press.time&&qy(r[0],t)<this.config.press.threshold?"press":"pan",this.eventType=s,s}enable(t){this.processEvent[t]=!0}isProcess(t){return this.processEvent[t]}pushEvent(t,e){const{emitThrottles:i}=this,r={type:t,ev:e};for(let s=0,o=i.length;s<o;s++)if(i[s].type===t)return void i.splice(s,1,r);i.push(r)}clearPressTimeout(){this.pressTimeout&&(clearTimeout(this.pressTimeout),this.pressTimeout=null)}reset(){this.clearPressTimeout(),this.startTime=0,this.startDistance=0,this.direction=null,this.eventType=null,this.prevMoveTime=0,this.prevMovePoint=null,this.lastMoveTime=0,this.lastMovePoint=null}triggerEvent(t,e){this.pushEvent(t,e);const{throttleTimer:i,emitThrottles:r}=this;i||(this.throttleTimer=bt.global.getRequestAnimationFrame()(()=>{bt.global.getCancelAnimationFrame()(this.throttleTimer),this.throttleTimer=null;for(let s=0,o=r.length;s<o;s++){const{type:a,ev:l}=r[s];this.emitEvent(a,l)}this.emitThrottles.length=0}))}triggerStartEvent(t,e){this.isProcess(t)||(this.enable(t),this.triggerEvent(`${t}start`,e))}triggerEndEvent(t){const e=this.processEvent;Object.keys(e).forEach(i=>{this.triggerEvent(`${i}end`,t),i==="press"&&this.triggerEvent(`${i}up`,t),delete e[i]})}emitEvent(t,e){if(!this.element)return;const i=this.element._events[uQ];if(i)if("fn"in i)i.fn.call(i.context,e,t);else for(let r=0,s=i.length;r<s&&!e.propagationImmediatelyStopped;r++)i[r].fn.call(i[r].context,e,t);this.emit(t,e)}}var PIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},EIt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};const Ce=[0,0,0],LIt=(n,t,e,i,r,s,o,a)=>{if(a)for(;e>t;)e-=Ft;else for(;e<t;)e+=Ft;const l=Kt/3*(e>t?1:-1);let h=t,d=h;for(;d!==e;){d=l>0?Math.min(d+l,e):Math.max(d+l,e);const u=Math.abs(d-h),c=4*Math.tan(u/4)/3,g=d<h?-1:1,p=Math.cos(h),f=Math.sin(h),m=Math.cos(d),v=Math.sin(d),_=p*s+i,b=f*o+r,y=m*s+i,C=v*o+r,S=s*c*g,w=o*c*g;n.push([_-S*f,b+w*p,y+S*v,C-w*m,y,C]),h=d}};let Op=class{set fillStyle(n){this.nativeContext.fillStyle=n}get fillStyle(){return this.nativeContext.fillStyle}set font(n){this.nativeContext.font=n}get font(){return this.nativeContext.font}set globalAlpha(n){this.nativeContext.globalAlpha=n*this.baseGlobalAlpha}get globalAlpha(){return this.nativeContext.globalAlpha}set lineCap(n){this.nativeContext.lineCap=n}get lineCap(){return this.nativeContext.lineCap}set lineDashOffset(n){this.nativeContext.lineDashOffset=n}get lineDashOffset(){return this.nativeContext.lineDashOffset}set lineJoin(n){this.nativeContext.lineJoin=n}get lineJoin(){return this.nativeContext.lineJoin}set lineWidth(n){this.nativeContext.lineWidth=n}get lineWidth(){return this.nativeContext.lineWidth}set miterLimit(n){this.nativeContext.miterLimit=n}get miterLimit(){return this.nativeContext.miterLimit}set shadowBlur(n){this.nativeContext.shadowBlur=n}get shadowBlur(){return this.nativeContext.shadowBlur}set shadowColor(n){this.nativeContext.shadowColor=n}get shadowColor(){return this.nativeContext.shadowColor}set shadowOffsetX(n){this.nativeContext.shadowOffsetX=n}get shadowOffsetX(){return this.nativeContext.shadowOffsetX}set shadowOffsetY(n){this.nativeContext.shadowOffsetY=n}get shadowOffsetY(){return this.nativeContext.shadowOffsetY}set strokeStyle(n){this.nativeContext.strokeStyle=n}get strokeStyle(){return this.nativeContext.strokeStyle}set textAlign(n){this.nativeContext.textAlign=n}get textAlign(){return this.nativeContext.textAlign}set textBaseline(n){this.nativeContext.textBaseline=n}get textBaseline(){return this.nativeContext.textBaseline}get inuse(){return!!this._inuse}set inuse(n){n!==!!this._inuse&&(this._inuse=n,n?(this.nativeContext.save(),this.reset()):this.nativeContext.restore())}constructor(n,t){this.fillAttributes=Object.assign(Object.assign({},tQ),{opacity:1}),this.strokeAttributes=Object.assign(Object.assign({},eQ),{opacity:1}),this.textAttributes=Object.assign(Object.assign({},_o),{opacity:1}),this._clearShadowStyle=!1,this._clearFilterStyle=!1,this._clearGlobalCompositeOperationStyle=!1;const e=n.nativeCanvas.getContext("2d");if(!e)throw new Error("2d");this.nativeContext=e,this.canvas=n,this.matrix=new Pe(1,0,0,1,0,0),this.stack=[],this.dpr=t,this.applyedMatrix=new Pe(1,0,0,1,0,0),this._clearMatrix=new Pe(1,0,0,1,0,0),this.baseGlobalAlpha=1}reset(){this.stack.length&&ge.getInstance().warn("bugmatrix"),this.matrix.setValue(1,0,0,1,0,0),this.applyedMatrix=new Pe(1,0,0,1,0,0),this.stack.length=0,this.nativeContext.setTransform(1,0,0,1,0,0)}getCanvas(){return this.canvas}getContext(){return this.nativeContext}setTransformForCurrent(n=!1){!n&&this.applyedMatrix.equalToMatrix(this.matrix)||(this.applyedMatrix.setValue(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f),this.nativeContext.setTransform(this.matrix.a,this.matrix.b,this.matrix.c,this.matrix.d,this.matrix.e,this.matrix.f))}get currentMatrix(){return this.matrix}cloneMatrix(n){return rs.allocateByObj(n)}clear(){this.save(),this.resetTransform(),this.nativeContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.restore()}restore(){this.nativeContext.restore(),this.stack.length>0&&(rs.free(this.matrix),this.matrix=this.stack.pop(),this.setTransformForCurrent(!0))}highPerformanceRestore(){this.stack.length>0&&(rs.free(this.matrix),this.matrix=this.stack.pop())}rotate(n,t=!0){this.matrix.rotate(n),t&&this.setTransformForCurrent()}save(){const n=this.cloneMatrix(this.matrix);this.stack.push(n),this.nativeContext.save()}highPerformanceSave(){const n=this.cloneMatrix(this.matrix);this.stack.push(n)}scale(n,t,e=!0){this.matrix.scale(n,t),e&&this.setTransformForCurrent()}setScale(n,t,e=!0){this.matrix.setScale(n,t),e&&this.setTransformForCurrent()}scalePoint(n,t,e,i,r=!0){this.translate(e,i,!1),this.scale(n,t,!1),this.translate(-e,-i,!1),r&&this.setTransformForCurrent()}setTransform(n,t,e,i,r,s,o=!0,a=this.dpr){this.matrix.setValue(a*n,a*t,a*e,a*i,a*r,a*s),o&&this.setTransformForCurrent()}setTransformFromMatrix(n,t=!0,e=this.dpr){this.matrix.setValue(n.a*e,n.b*e,n.c*e,n.d*e,n.e*e,n.f*e),t&&this.setTransformForCurrent()}resetTransform(n=!0,t=this.dpr){this.setTransform(t,0,0,t,0,0),n&&this.setTransformForCurrent()}transform(n,t,e,i,r,s,o=!0){this.matrix.multiply(n,t,e,i,r,s),o&&this.setTransformForCurrent()}transformFromMatrix(n,t){this.matrix.multiply(n.a,n.b,n.c,n.d,n.e,n.f),t&&this.setTransformForCurrent()}translate(n,t,e=!0){this.matrix.translate(n,t),e&&this.setTransformForCurrent()}rotateDegrees(n,t=!0){const e=n*Math.PI/180;this.rotate(e,t)}rotateAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotate(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}rotateDegreesAbout(n,t,e,i=!0){this.translate(t,e,!1),this.rotateDegrees(n,!1),this.translate(-t,-e,!1),i&&this.setTransformForCurrent()}beginPath(){this.disableBeginPath||this.nativeContext.beginPath()}clip(n,t){n?typeof n=="string"?this.nativeContext.clip(n):this.nativeContext.clip(n,t):this.nativeContext.clip()}arc(n,t,e,i,r,s,o){if(o=o||0,this.camera){const a=[];LIt(a,i,r,n,t,e,e,s);for(let l=0;l<a.length;++l){const h=a[l];this.bezierCurveTo(h[0],h[1],h[2],h[3],h[4],h[5],o)}}else this.nativeContext.arc(n,t,Math.max(0,e),i,r,s)}arcTo(n,t,e,i,r){this.nativeContext.arcTo(n,t,e,i,r)}bezierCurveTo(n,t,e,i,r,s,o){if(o=o||0,this.camera){let a=o,l=o;this.modelMatrix&&(As(Ce,[n,t,o],this.modelMatrix),n=Ce[0],t=Ce[1],a=Ce[2],As(Ce,[e,i,o],this.modelMatrix),e=Ce[0],i=Ce[1],l=Ce[2],As(Ce,[r,s,o],this.modelMatrix),r=Ce[0],s=Ce[1],o=Ce[2]);let h=this.camera.vp(r,s,o);r=h.x,s=h.y,h=this.camera.vp(n,t,a),n=h.x,t=h.y,h=this.camera.vp(e,i,l),e=h.x,i=h.y}this.nativeContext.bezierCurveTo(n,t,e,i,r,s)}closePath(){this.nativeContext.closePath()}ellipse(n,t,e,i,r,s,o,a){a==null?this.nativeContext.ellipse(n,t,e,i,r,s,o):this.nativeContext.ellipse(n,t,e,i,r,s,o,a)}lineTo(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(As(Ce,[n,t,e],this.modelMatrix),n=Ce[0],t=Ce[1],e=Ce[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}this.nativeContext.lineTo(n,t)}moveTo(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(As(Ce,[n,t,e],this.modelMatrix),n=Ce[0],t=Ce[1],e=Ce[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}this.nativeContext.moveTo(n,t)}quadraticCurveTo(n,t,e,i,r){if(r=r||0,this.camera){let s=r;this.modelMatrix&&(As(Ce,[n,t,r],this.modelMatrix),n=Ce[0],t=Ce[1],s=Ce[2],As(Ce,[e,i,r],this.modelMatrix),e=Ce[0],i=Ce[1],r=Ce[2]);let o=this.camera.vp(e,i,r);e=o.x,i=o.y,o=this.camera.vp(n,t,s),n=o.x,t=o.y}this.nativeContext.quadraticCurveTo(n,t,e,i)}rect(n,t,e,i,r){r=r||0,this.camera?(this.moveTo(n,t,r),this.lineTo(n+e,t,r),this.lineTo(n+e,t+i,r),this.lineTo(n,t+i,r),this.closePath()):this.nativeContext.rect(n,t,e,i)}createImageData(){const n=arguments;return n.length===2?this.nativeContext.createImageData(n[0],n[1]):n.length===1?this.nativeContext.createImageData(n[0]):null}createLinearGradient(n,t,e,i){return isFinite(n+t+e+i)||(n=0,t=0,e=0,i=0),this.nativeContext.createLinearGradient(n,t,e,i)}createPattern(n,t){return n.width===0||n.height===0?null:this.nativeContext.createPattern(n,t)}createRadialGradient(n,t,e,i,r,s){return this.nativeContext.createRadialGradient(n,t,e,i,r,s)}createConicGradient(n,t,e,i){if(this.nativeContext.createConicGradient&&Math.abs(i-e-2*Math.PI)<.001)return this.nativeContext.createConicGradient(e,n,t);let r,s=!1;const o=this;return{stops:[],addColorStop(a,l){this.stops.push([a,l]),s=!0},GetPattern(a,l,h){return s&&(h||(h=i-e),r=zPt(o,this.stops,n,t,h,e,i,a,l),s=!1),r}}}fill(n,t){this.disableFill||(n?this.nativeContext.fill(n):this.nativeContext.fill())}fillRect(n,t,e,i){this.nativeContext.fillRect(n,t,e,i)}clearRect(n,t,e,i){this.nativeContext.clearRect(n,t,e,i)}project(n,t,e){if(e=e||0,this.camera){this.modelMatrix&&(As(Ce,[n,t,e],this.modelMatrix),n=Ce[0],t=Ce[1],e=Ce[2]);const i=this.camera.vp(n,t,e);n=i.x,t=i.y}return{x:n,y:t}}view(n,t,e){return e=e||0,this.camera?(this.modelMatrix&&(As(Ce,[n,t,e],this.modelMatrix),n=Ce[0],t=Ce[1],e=Ce[2]),this.camera.view(n,t,e)):[n,t,e]}fillText(n,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(As(Ce,[t,e,i],this.modelMatrix),t=Ce[0],e=Ce[1],i=Ce[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.fillText(n,t,e)}getImageData(n,t,e,i){return this.nativeContext.getImageData(n,t,e,i)}getLineDash(){return this.nativeContext.getLineDash()}isPointInPath(n,t){return this.nativeContext.isPointInPath(n,t)}isPointInStroke(n,t){return this.nativeContext.isPointInStroke(n,t)}measureText(n,t=bt.global.measureTextMethod){var e,i;if(!t||t==="native")return this.nativeContext.measureText(n);this.mathTextMeasure||(this.mathTextMeasure=bt.graphicUtil.createTextMeasureInstance({},{},()=>this.canvas.nativeCanvas));const r=(e=this.fontFamily)!==null&&e!==void 0?e:_o.fontFamily,s=(i=this.fontSize)!==null&&i!==void 0?i:_o.fontSize;return this.mathTextMeasure.textSpec.fontFamily===r&&this.mathTextMeasure.textSpec.fontSize===s||(this.mathTextMeasure.textSpec.fontFamily=r,this.mathTextMeasure.textSpec.fontSize=s,this.mathTextMeasure._numberCharSize=null,this.mathTextMeasure._fullCharSize=null,this.mathTextMeasure._letterCharSize=null,this.mathTextMeasure._specialCharSizeMap={}),this.mathTextMeasure.measure(n,t)}putImageData(n,t,e){this.nativeContext.putImageData(n,t,e)}setLineDash(n){const t=arguments,e=this.nativeContext;this.nativeContext.setLineDash?t[0]&&e.setLineDash(t[0]):"mozDash"in e?e.mozDash=t[0]:"webkitLineDash"in e&&(e.webkitLineDash=t[0])}stroke(n){this.disableStroke||(n?this.nativeContext.stroke(n):this.nativeContext.stroke())}strokeRect(n,t,e,i){this.nativeContext.strokeRect(n,t,e,i)}strokeText(n,t,e,i){if(i=i||0,this.camera){this.modelMatrix&&(As(Ce,[t,e,i],this.modelMatrix),t=Ce[0],e=Ce[1],i=Ce[2]);const r=this.camera.vp(t,e,i);t=r.x,e=r.y}this.nativeContext.strokeText(n,t,e)}drawImage(){const n=this.nativeContext,t=arguments;t.length===3?n.drawImage(t[0],t[1],t[2]):t.length===5?n.drawImage(t[0],t[1],t[2],t[3],t[4]):t.length===9&&n.drawImage(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}setCommonStyle(n,t,e,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setCommonStyle(n,t,e,i,r[0]);const s=Object.create(r[0]);return r.forEach((o,a)=>{a!==0&&Object.assign(s,o)}),this._setCommonStyle(n,t,e,i,s)}return this._setCommonStyle(n,t,e,i,r)}_setCommonStyle(n,t,e,i,r){const s=this.nativeContext;r||(r=this.fillAttributes);const{fillOpacity:o=r.fillOpacity,opacity:a=r.opacity,fill:l=r.fill}=t;s.globalAlpha=o*a*this.baseGlobalAlpha,o>1e-12&&a>1e-12&&(s.fillStyle=y1(this,l,n,e,i))}setShadowBlendStyle(n,t,e){if(Array.isArray(e)){if(e.length<=1)return this._setShadowBlendStyle(n,e[0]);const i=Object.create(e[0]);return e.forEach((r,s)=>{s!==0&&Object.assign(i,r)}),this._setShadowBlendStyle(n,t,i)}return this._setShadowBlendStyle(n,t,e)}_setShadowBlendStyle(n,t,e){const i=this.nativeContext;e||(e=this.fillAttributes);const{opacity:r=e.opacity,shadowBlur:s=e.shadowBlur,shadowColor:o=e.shadowColor,shadowOffsetX:a=e.shadowOffsetX,shadowOffsetY:l=e.shadowOffsetY,blur:h=e.blur,filter:d=e.filter,globalCompositeOperation:u=e.globalCompositeOperation}=t;r<=1e-12||(s||a||l?(i.shadowBlur=s*this.dpr,i.shadowColor=o,i.shadowOffsetX=a*this.dpr,i.shadowOffsetY=l*this.dpr,this._clearShadowStyle=!0):this._clearShadowStyle&&(i.shadowBlur=0,i.shadowOffsetX=0,i.shadowOffsetY=0),h?(i.filter=`blur(${h}px)`,this._clearFilterStyle=!0):d?(i.filter=d,this._clearFilterStyle=!0):this._clearFilterStyle&&(i.filter="blur(0px)",this._clearFilterStyle=!1),u?(i.globalCompositeOperation=u,this._clearGlobalCompositeOperationStyle=!0):this._clearGlobalCompositeOperationStyle&&(i.globalCompositeOperation="source-over",this._clearGlobalCompositeOperationStyle=!1))}setStrokeStyle(n,t,e,i,r){if(Array.isArray(r)){if(r.length<=1)return this._setStrokeStyle(n,t,e,i,r[0]);const s=Object.create(r[0]);return r.forEach((o,a)=>{a!==0&&Object.assign(s,o)}),this._setStrokeStyle(n,t,e,i,s)}return this._setStrokeStyle(n,t,e,i,r)}_setStrokeStyle(n,t,e,i,r){const s=this.nativeContext;r||(r=this.strokeAttributes);const{strokeOpacity:o=r.strokeOpacity,opacity:a=r.opacity}=t;if(s.globalAlpha=o*a*this.baseGlobalAlpha,o>1e-12&&a>1e-12){const{lineWidth:l=r.lineWidth,stroke:h=r.stroke,lineJoin:d=r.lineJoin,lineDash:u=r.lineDash,lineDashOffset:c=r.lineDashOffset,lineCap:g=r.lineCap,miterLimit:p=r.miterLimit,keepStrokeScale:f=r.keepStrokeScale}=t;s.lineWidth=f?l:ch(this,l,this.dpr),s.strokeStyle=y1(this,h,n,e,i),s.lineJoin=d,u&&(s.setLineDash(u),s.lineDashOffset=c),s.lineCap=g,s.miterLimit=p}}setTextStyleWithoutAlignBaseline(n,t,e){const i=this.nativeContext;t||(t=this.textAttributes);const{scaleIn3d:r=t.scaleIn3d}=n;n.font?i.font=n.font:i.font=pc(n,t,r&&this.camera&&this.camera.getProjectionScale(e));const{fontFamily:s=t.fontFamily,fontSize:o=t.fontSize}=n;this.fontFamily=s,this.fontSize=o,i.textAlign="left",i.textBaseline="alphabetic"}setTextStyle(n,t,e){var i,r;const s=this.nativeContext;t||(t=this.textAttributes),n.font?s.font=n.font:s.font=pc(n,t,this.camera&&this.camera.getProjectionScale(e));const{fontFamily:o=t.fontFamily,fontSize:a=t.fontSize}=n;this.fontFamily=o,this.fontSize=a,s.textAlign=(i=n.textAlign)!==null&&i!==void 0?i:t.textAlign,s.textBaseline=(r=n.textBaseline)!==null&&r!==void 0?r:t.textBaseline}draw(){}clearMatrix(n=!0,t=this.dpr){this.setTransformFromMatrix(this._clearMatrix,n,t)}setClearMatrix(n,t,e,i,r,s){this._clearMatrix.setValue(n,t,e,i,r,s)}onlyTranslate(n=this.dpr){return this.matrix.a===n&&this.matrix.b===0&&this.matrix.c===0&&this.matrix.d===n}release(...n){this.stack.forEach(t=>rs.free(t)),this.stack.length=0}};Op.env="browser",Op=PIt([It(),EIt("design:paramtypes",[Object,Number])],Op);var IIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},OIt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Dp=class extends hF{constructor(n){super(n)}init(n){const{container:t}=n;if(typeof t=="string"){const e=bt.global.getElementById(t);e&&(this._container=e)}else this._container=t;this._context=new Op(this,this._dpr),this.initStyle()}initStyle(){if(!this.controled)return;const{nativeCanvas:n}=this;n.width=this._pixelWidth,n.height=this._pixelHeight,!n.style||this.setCanvasStyle(n,this._x,this._y,this._displayWidth,this._displayHeight),this._container&&this._container.appendChild(n),this.visiable||this.hide()}hide(){this._nativeCanvas&&(this._nativeCanvas.style.display="none")}show(){this._nativeCanvas&&(this._nativeCanvas.style.display="block")}applyPosition(){const n=this._nativeCanvas;n.style.position="absolute",n.style.top=`${this._y}px`,n.style.left=`${this._x}px`}resetStyle(n){if(!this.controled)return;const{width:t=this._displayWidth,height:e=this._displayHeight,dpr:i=this._dpr,x:r=this._x,y:s=this._y}=n,{nativeCanvas:o}=this;o.width=t*i,o.height=e*i,!o.style||this.setCanvasStyle(o,r,s,t,e),n.id&&(o.id=n.id),this.visiable||this.hide()}setCanvasStyle(n,t,e,i,r){this.controled&&(n.style.width=`${i}px`,n.style.height=`${r}px`)}toDataURL(n,t){return n==="image/jpeg"?this._nativeCanvas.toDataURL(n,t):n==="image/png"?this._nativeCanvas.toDataURL(n):this._nativeCanvas.toDataURL(n,t)}resize(n,t){this.controled&&(this._pixelWidth=n*this._dpr,this._pixelHeight=t*this._dpr,this._displayWidth=n,this._displayHeight=t,this._nativeCanvas.style&&(this._nativeCanvas.style.width=`${n}px`,this._nativeCanvas.style.height=`${t}px`),this._nativeCanvas.width=this._pixelWidth,this._nativeCanvas.height=this._pixelHeight,this._context.dpr=this._dpr)}};Dp.env="browser",Dp=IIt([It(),OIt("design:paramtypes",[Object])],Dp);function ett(n,t){return new te(e=>{e(aQ).toDynamicValue(()=>i=>new n(i)).whenTargetNamed(n.env),e(zRt).toDynamicValue(()=>(i,r)=>new t(i,r)).whenTargetNamed(t.env)})}const DIt=ett(Dp,Op);var FIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},HIt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},ou=function(n,t){return function(e,i){t(e,i,n)}};let qg=class extends M2{constructor(n,t,e,i){super(e,i),this.contributions=n,this.drawContribution=t,this.pickItemInterceptorContributions=e,this.pickServiceInterceptorContributions=i,this.global.hooks.onSetEnv.tap("canvas-picker-service",(r,s,o)=>{this.configure(o,s)}),this.configure(this.global,this.global.env),this.pickerMap=new Map,this.init()}init(){this.contributions.getContributions().forEach(n=>{this.pickerMap.set(n.numberType,n)}),super._init()}configure(n,t){this.pickCanvas=tc.shareCanvas(),this.pickContext=this.pickCanvas.getContext("2d")}pickItem(n,t,e,i){if(n.attribute.pickable===!1)return null;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.beforePickItem){const d=h.beforePickItem(n,this,t,i,{parentMatrix:e});if(d)return d}}const r=this.pickerMap.get(n.numberType);if(!r)return null;const s=r.contains(n,t,i),o=s?n:null,a={graphic:o,params:s};if(o)return a;if(this.InterceptorContributions.length)for(let l=0;l<this.InterceptorContributions.length;l++){const h=this.InterceptorContributions[l];if(h.afterPickItem){const d=h.afterPickItem(n,this,t,i,{parentMatrix:e});if(d)return d}}return a}};qg=FIt([It(),ou(0,ue(en)),ou(0,xn(Yn)),ou(1,ue(oF)),ou(2,ue(en)),ou(2,xn(Ug)),ou(3,ue(en)),ou(3,xn(q1)),HIt("design:paramtypes",[Object,Object,Object,Object])],qg);var zIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let I2=class{constructor(){this.type="group",this.numberType=$D}contains(n,t,e){return!1}};I2=zIt([It()],I2);const dw=new te((n,t,e,i)=>{dw.__vloaded||(dw.__vloaded=!0,n(q4).to(I2).inSingletonScope(),n(Yn).toService(q4),Un(n,Yn))});dw.__vloaded=!1;const WIt=new te((n,t,e,i)=>{e(qg)||n(qg).toSelf().inSingletonScope(),e(Ip)?i(Ip).toService(qg):n(Ip).toService(qg)});function jIt(n){n.load(dw),n.load(WIt)}var tv,NIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},$It=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let $h=tv=class extends aw{get container(){return this.canvas.nativeCanvas.parentElement}static GenerateCanvasId(){return`${tv.idprefix}_${tv.prefix_count++}`}constructor(){super(),this.type="browser",this._canvasIsIntersecting=!0,this.global=bt.global,this.viewBox=new ie,this.modelMatrix=new Pe(1,0,0,1,0,0)}getTitle(){return this.canvas.id&&this.canvas.id.toString()}getWH(){return{width:this.canvas.width/(this.canvas.dpr||1),height:this.canvas.height/(this.canvas.dpr||1)}}getXY(){return this.canvas.nativeCanvas.getBoundingClientRect()}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n),this.postInit()}postInit(){if(this.global.optimizeVisible)try{this.observerCanvas()}catch{console.error("IntersectionObserver")}}isElementVisible(n){const t=n.getBoundingClientRect(),e=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return!(t.right<0||t.bottom<0||t.left>e||t.top>i)}observerCanvas(){this._canvasIsIntersecting=this.isElementVisible(this.canvas.nativeCanvas);const n=new IntersectionObserver((t,e)=>{t.forEach(i=>{this._canvasIsIntersecting!==i.isIntersecting?(this._canvasIsIntersecting=i.isIntersecting,this._onVisibleChangeCb&&this._onVisibleChangeCb(i.isIntersecting)):this._canvasIsIntersecting=i.isIntersecting})});n&&n.observe(this.canvas.nativeCanvas)}createWindowByConfig(n){const t=this.global.createCanvas({width:n.width,height:n.height});let e;if(e=typeof n.container=="string"?this.global.getElementById(n.container):n.container?n.container:this.global.getRootElement(),!e)throw new Error("containerId");n.offscreen?e=null:e.appendChild(t);const i={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:t,container:e,id:tv.GenerateCanvasId(),canvasControled:!0};this.canvas=new Dp(i)}createWindowByCanvas(n){var t;let e;if(typeof n.canvas=="string"){if(e=this.global.getElementById(n.canvas),!e)throw new Error("canvasId canvasdom")}else e=n.canvas;if(!e)throw new Error("canvas");let i=n.width,r=n.height;if(i==null||r==null||!n.canvasControled){const o=e.getBoundingClientRect();i=o.width,r=o.height}let s=n.dpr;s==null&&(s=(t=e.getContext("2d").pixelRatio)!==null&&t!==void 0?t:e.width/i),this.canvas=new Dp({width:i,height:r,dpr:s,nativeCanvas:e,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,t){this.canvas.resize(n,t)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}addEventListener(n,t,e){return this.canvas.nativeCanvas.addEventListener(n,t,e)}removeEventListener(n,t,e){return this.canvas.nativeCanvas.removeEventListener(n,t,e)}dispatchEvent(n){return this.canvas.nativeCanvas.dispatchEvent(n)}getStyle(){var n;return(n=this.canvas.nativeCanvas.style)!==null&&n!==void 0?n:{}}setStyle(n){this.canvas.nativeCanvas.style=n}getBoundingClientRect(){const n=this.canvas.nativeCanvas,t=this.getWH();return n.parentElement?this.canvas.nativeCanvas.getBoundingClientRect():{x:0,y:0,width:t.width,height:t.height,left:0,top:0,right:0,bottom:0}}clearViewBox(n){const t=this.viewBox,e=this.getContext(),i=this.getDpr();e.nativeContext.save(),e.nativeContext.setTransform(i,0,0,i,0,0),e.clearRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),n&&(e.fillStyle=n,e.fillRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1)),e.nativeContext.restore()}isVisible(n){return this._canvasIsIntersecting}onVisibleChange(n){this._onVisibleChangeCb=n}getTopLeft(n){return this.global.getElementTopLeft(this.canvas.nativeCanvas,n)}};$h.env="browser",$h.idprefix="visactor_window",$h.prefix_count=0,$h=tv=NIt([It(),$It("design:paramtypes",[])],$h);const VIt=new te(n=>{n($h).toSelf(),n(zD).toDynamicValue(t=>t.container.get($h)).whenTargetNamed($h.env)});var GIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},UIt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},YIt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};class XIt{get x1(){return this.dom.getBoundingClientRect().left}get x2(){return this.dom.getBoundingClientRect().right}get y1(){return this.dom.getBoundingClientRect().top}get y2(){return this.dom.getBoundingClientRect().bottom}get width(){return this.dom.getBoundingClientRect().width}get height(){return this.dom.getBoundingClientRect().height}constructor(t){this.dom=t}}function J4(n,t=!1){const e=document.createElement("img");if(bt.global.isImageAnonymous&&(e.crossOrigin="anonymous"),t){const i=new Blob([n],{type:"image/svg+xml"});n=window.URL.createObjectURL(i)}return e.src=n,e.complete?Promise.resolve(e):new Promise((i,r)=>{e.onload=()=>{i(e)},e.onerror=()=>{r(new Error(""))}})}let uw=class extends ow{constructor(){super(),this.type="browser",this.supportEvent=!0;try{this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.supportsMouseEvents=!!globalThis.MouseEvent}catch{this.supportsTouchEvents=!1,this.supportsPointerEvents=!1,this.supportsPointerEvents=!1}this.applyStyles=!0}mapToCanvasPoint(n,t){var e,i;let r=0,s=0,o=0,a=0;if(n.changedTouches){const l=(e=n.changedTouches[0])!==null&&e!==void 0?e:{};r=l.clientX||0,s=l.clientY||0,o=r,a=s}else r=n.clientX||0,s=n.clientY||0,o=n.offsetX||0,a=n.offsetY||0;if(t){const l=r,h=s,d=t.getBoundingClientRect(),u=(i=t.getNativeHandler)===null||i===void 0?void 0:i.call(t).nativeCanvas;let c,g;return u&&(c=d.width/u.offsetWidth,g=d.height/u.offsetHeight),{x:(l-d.left)/(et(c)?c:1),y:(h-d.top)/(et(g)?g:1)}}return{x:o,y:a}}getNativeAABBBounds(n){let t=n;if(typeof n=="string"&&(t=new DOMParser().parseFromString(n,"text/html").firstChild,t.lastChild&&(t=t.lastChild.firstChild)),t.getBoundingClientRect){const e=t.getBoundingClientRect();return new XIt(e)}return new ie}removeDom(n){return n.parentElement.removeChild(n),!0}updateDom(n,t){const{width:e,height:i,style:r}=t;return r&&(yt(r)?n.setAttribute("style",r):Object.keys(r).forEach(s=>{n.style[s]=r[s]})),e!=null&&(n.style.width=`${e}px`),i!=null&&(n.style.height=`${i}px`),!0}createDom(n){const{tagName:t="div",parent:e}=n,i=document.createElement(t);if(this.updateDom(i,n),e){const r=yt(e)?this.getElementById(e):e;r&&r.appendChild&&r.appendChild(i)}return i}loadImage(n){return J4(n,!1).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadSvg(n){return J4(n,!0).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}createCanvas(n){var t,e;const i=document.createElement("canvas");n.id&&(i.id=(t=n.id)!==null&&t!==void 0?t:nn.GenAutoIncrementId().toString());const r=(e=n.dpr)!==null&&e!==void 0?e:window.devicePixelRatio;return n.width&&n.height&&(i.style.width=`${n.width}px`,i.style.height=`${n.height}px`,i.width=n.width*r,i.height=n.height*r),i}createOffscreenCanvas(n){var t;const e=(t=n.dpr)!==null&&t!==void 0?t:window.devicePixelRatio;return new OffscreenCanvas(n.width*e,n.height*e)}releaseCanvas(n){let t;t=typeof n=="string"?document.getElementById(n):n,t&&t.parentElement&&t.parentElement.removeChild(t)}getDevicePixelRatio(){return window.devicePixelRatio}getRequestAnimationFrame(){return window.requestAnimationFrame}getCancelAnimationFrame(){return window.cancelAnimationFrame}addEventListener(n,t,e){return document.addEventListener(n,t,e)}removeEventListener(n,t,e){return document.removeEventListener(n,t,e)}dispatchEvent(n){return document.dispatchEvent(n)}getElementById(n){return document.getElementById(n)}getRootElement(){return document.body}getDocument(){return document}release(...n){}getElementTop(n,t){let e=n.offsetTop,i=n.offsetParent;for(;i!==null;)e+=i.offsetTop,i=i.offsetParent;return e}getElementLeft(n,t){let e=n.offsetLeft,i=n.offsetParent;for(;i!==null;)e+=i.offsetLeft,i=i.offsetParent;return e}getElementTopLeft(n,t){let e=n.offsetTop,i=n.offsetLeft,r=n.offsetParent;for(;r!==null;)e+=r.offsetTop,i+=r.offsetLeft,r=r.offsetParent;return{top:e,left:i}}loadFont(n,t,e){return YIt(this,void 0,void 0,function*(){return new FontFace(n,yt(t)?`url(${t})`:t,e).load().then(function(i){return document.fonts.add(i),{loadState:"success"}}).catch(function(i){return console.error("Failed to load font:",i),{loadState:"fail"}})})}isMacOS(){if(this._isMacOS===void 0)try{this._isMacOS=navigator.platform.toUpperCase().indexOf("MAC")>=0}catch{this._isMacOS=!1}return this._isMacOS}copyToClipBoard(n){return navigator.clipboard.writeText(n).then(()=>{}).catch(t=>{})}};uw=GIt([It(),UIt("design:paramtypes",[])],uw);const cw=new te(n=>{cw.isBrowserBound||(cw.isBrowserBound=!0,n(uw).toSelf().inSingletonScope(),n(OM).toService(uw))});cw.isBrowserBound=!1;function gw(n,t=!0){gw.__loaded||(gw.__loaded=!0,n.load(cw),n.load(DIt),n.load(VIt),t&&jIt(n))}gw.__loaded=!1;class ko{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise"||!this.canvasRenderer)return!0;const{pickContext:r}=i??{};if(!r)return!1;const s=t.getGraphicTheme();r.highPerformanceSave();let{x:o=s.x,y:a=s.y}=t.attribute;if(t.transMatrix.onlyTranslate()){const d=t.getOffsetXY(s);o+=d.x,a+=d.y,r.setTransformForCurrent()}else o=0,a=0,r.transformFromMatrix(t.transMatrix,!0);let l=!1,h=!1;return this.canvasRenderer.drawShape(t,r,o,a,{},null,(d,u,c,g)=>!(!l&&!h)||(l=d.isPointInPath(e.x,e.y),h=g||h,l),(d,u,c,g)=>{if(l||h)return!0;const p=u.lineWidth||c.lineWidth,f=u.pickStrokeBuffer||c.pickStrokeBuffer,m=u.keepStrokeScale||c.keepStrokeScale;return r.lineWidth=m?p+f:ch(r,p+f,r.dpr),l=d.isPointInStroke(e.x,e.y),h=g||h,l}),r.highPerformanceRestore(),l}}var KIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},qIt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},ZIt=function(n,t){return function(e,i){t(e,i,n)}};let O2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="arc",this.numberType=jM}};O2=KIt([It(),ZIt(0,ue(z1)),qIt("design:paramtypes",[Object])],O2);let Q4=!1;const JIt=new te((n,t,e,i)=>{Q4||(Q4=!0,n(A4).to(O2).inSingletonScope(),n(gh).toService(A4))});var QIt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},tOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},eOt=function(n,t){return function(e,i){t(e,i,n)}};let D2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="area",this.numberType=cb}};D2=QIt([It(),eOt(0,ue(W1)),tOt("design:paramtypes",[Object])],D2);let t6=!1;const iOt=new te((n,t,e,i)=>{t6||(t6=!0,n(M4).to(D2).inSingletonScope(),n(gh).toService(M4))});var nOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},rOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},sOt=function(n,t){return function(e,i){t(e,i,n)}};let F2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="circle",this.numberType=$M}};F2=nOt([It(),sOt(0,ue(j1)),rOt("design:paramtypes",[Object])],F2);let e6=!1;const oOt=new te((n,t,e,i)=>{e6||(e6=!0,n(T4).to(F2).inSingletonScope(),n(gh).toService(T4))});class itt{constructor(){this.type="glyph",this.numberType=ND}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;const s=i==null?void 0:i.pickerService;if(s){let o=!1;return t.getSubGraphic().forEach(a=>{if(o)return;const l=s.pickItem(a,e,null,i);o=!(!l||!l.graphic)}),o}return!1}}var aOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},lOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},hOt=function(n,t){return function(e,i){t(e,i,n)}};let pw=class extends itt{constructor(n){super(),this.canvasRenderer=n}};pw=aOt([It(),hOt(0,ue(Y1)),lOt("design:paramtypes",[Object])],pw);let i6=!1;const dOt=new te((n,t,e,i)=>{i6||(i6=!0,n(I4).to(pw).inSingletonScope(),n(pw).toService(I4))});var uOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let vf=class{constructor(){this.type="image",this.numberType=VM}contains(n,t,e){const{pickContext:i}=e??{};return!!i&&!!n.AABBBounds.containsPoint(t)}};vf=uOt([It()],vf);let n6=!1;const cOt=new te((n,t,e,i)=>{n6||(n6=!0,n(hw).to(vf).inSingletonScope(),n(vf).toService(hw))});var gOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},pOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},fOt=function(n,t){return function(e,i){t(e,i,n)}};let H2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="line",this.numberType=gb}};H2=gOt([It(),fOt(0,ue(N1)),pOt("design:paramtypes",[Object])],H2);let r6=!1;const mOt=new te((n,t,e,i)=>{r6||(r6=!0,n(k4).to(H2).inSingletonScope(),n(gh).toService(k4))});var vOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},_Ot=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},bOt=function(n,t){return function(e,i){t(e,i,n)}};let z2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="polygon",this.numberType=UM}};z2=vOt([It(),bOt(0,ue(V1)),_Ot("design:paramtypes",[Object])],z2);let s6=!1;const yOt=new te((n,t,e,i)=>{s6||(s6=!0,n(L4).to(z2).inSingletonScope(),n(gh).toService(L4))});var COt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},SOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},xOt=function(n,t){return function(e,i){t(e,i,n)}};let W2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="path",this.numberType=GM}};W2=COt([It(),xOt(0,ue($1)),SOt("design:paramtypes",[Object])],W2);let o6=!1;const wOt=new te((n,t,e,i)=>{o6||(o6=!0,n(R4).to(W2).inSingletonScope(),n(gh).toService(R4))}),OB=new ie;class ntt{constructor(){this.type="rect",this.numberType=GD}contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;const s=t.getGraphicTheme(),{cornerRadius:o=s.cornerRadius}=t.attribute;let{x:a=s.x,y:l=s.y}=t.attribute;r.highPerformanceSave();let h=!0;if(t.transMatrix.onlyTranslate()){const u=t.getOffsetXY(s);a+=u.x,l+=u.y,r.setTransformForCurrent()}else a=0,l=0,h=!1,r.transformFromMatrix(t.transMatrix,!0);let d=!0;if(!h||t.shadowRoot||J(o,!0)&&o!==0||V(o)&&o.some(u=>u!==0))d=!1,this.canvasRenderer.drawShape(t,r,a,l,{},null,(u,c,g)=>!!d||(d=u.isPointInPath(e.x,e.y),d),(u,c,g)=>{if(d)return!0;const p=c.lineWidth||g.lineWidth,f=c.pickStrokeBuffer||g.pickStrokeBuffer,m=c.keepStrokeScale||g.keepStrokeScale;return r.lineWidth=m?p+f:ch(r,p+f,r.dpr),d=u.isPointInStroke(e.x,e.y),d});else{const{fill:u=s.fill,stroke:c=s.stroke,lineWidth:g=s.lineWidth}=t.attribute;if(u)d=!0;else if(c){const p=t.AABBBounds;OB.setValue(p.x1,p.y1,p.x2,p.y2),OB.expand(-g/2),d=!OB.containsPoint(e)}}return r.highPerformanceRestore(),d}}var AOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},MOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},TOt=function(n,t){return function(e,i){t(e,i,n)}};let j2=class extends ntt{constructor(n){super(),this.canvasRenderer=n}};j2=AOt([It(),TOt(0,ue(G1)),MOt("design:paramtypes",[Object])],j2);let a6=!1;const kOt=new te((n,t,e,i)=>{a6||(a6=!0,n(B4).to(j2).inSingletonScope(),n(gh).toService(B4))});let l6=!1;const ROt=new te((n,t,e,i)=>{l6||(l6=!0,n(hw).to(vf).inSingletonScope(),n(vf).toService(hw))});var BOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},POt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},EOt=function(n,t){return function(e,i){t(e,i,n)}};let N2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="symbol",this.numberType=YM}};N2=BOt([It(),EOt(0,ue(U1)),POt("design:paramtypes",[Object])],N2);let h6=!1;const LOt=new te((n,t,e,i)=>{h6||(h6=!0,n(P4).to(N2).inSingletonScope(),n(gh).toService(P4))});var IOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let $2=class{constructor(){this.type="text",this.numberType=XM}contains(n,t,e){return!!n.AABBBounds.containsPoint(t)}};$2=IOt([It()],$2);let d6=!1;const OOt=new te((n,t,e,i)=>{d6||(d6=!0,n(E4).to($2).inSingletonScope(),n(gh).toService(E4))});var DOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},FOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Bv=class extends Op{constructor(n,t){super(n,t);const e=n.nativeCanvas.getContext("2d");if(!e)throw new Error("2d");this.nativeContext=e,this.canvas=n,this.matrix=new Pe(1,0,0,1,0,0),this.stack=[],this.dpr=t??1}release(...n){}};Bv.env="node",Bv=DOt([It(),FOt("design:paramtypes",[Object,Number])],Bv);var HOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},zOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)};let Fp=class extends hF{constructor(n){super(n)}init(){this._context=new Bv(this,this._dpr),this.nativeCanvas.width=this._pixelWidth,this.nativeCanvas.height=this._pixelHeight}release(...n){this._nativeCanvas.release&&it(this._nativeCanvas.release)&&this._nativeCanvas.release()}};Fp.env="node",Fp=HOt([It(),zOt("design:paramtypes",[Object])],Fp);const WOt=ett(Fp,Bv);var jOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},NOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},$Ot=function(n,t){return function(e,i){t(e,i,n)}};let Hp=class extends aw{get container(){return null}constructor(n){super(),this.global=n,this.type="node"}getTitle(){return""}getWH(){return{width:this.canvas.displayWidth,height:this.canvas.displayHeight}}getXY(){return{x:0,y:0}}createWindow(n){n.canvas?this.createWindowByCanvas(n):this.createWindowByConfig(n)}createWindowByConfig(n){const t=this.global.createCanvas({width:n.width,height:n.height}),e={width:n.width,height:n.height,dpr:n.dpr,nativeCanvas:t,id:nn.GenAutoIncrementId().toString(),canvasControled:!0};this.canvas=new Fp(e)}createWindowByCanvas(n){var t;const e=n.canvas,i=(t=n.dpr)!==null&&t!==void 0?t:1;let r=n.width,s=n.height;r!=null&&s!=null&&n.canvasControled||(r=e.width/i,s=e.height/i),this.canvas=new Fp({width:r,height:s,dpr:i,nativeCanvas:e,canvasControled:n.canvasControled})}releaseWindow(){this.canvas.release()}resizeWindow(n,t){this.canvas.resize(n,t)}setDpr(n){this.canvas.dpr=n}getContext(){return this.canvas.getContext()}getNativeHandler(){return this.canvas}getDpr(){return this.canvas.dpr}getImageBuffer(n="image/png"){return this.canvas.nativeCanvas.toBuffer(n)}addEventListener(n,t,e){}dispatchEvent(n){return!0}removeEventListener(n,t,e){}getStyle(){}setStyle(n){}getBoundingClientRect(){return null}clearViewBox(n){}};Hp.env="node",Hp=jOt([It(),$Ot(0,ue(OD)),NOt("design:paramtypes",[Object])],Hp);const VOt=new te(n=>{n(Hp).toSelf(),n(zD).toDynamicValue(t=>t.container.get(Hp)).whenTargetNamed(Hp.env)});var GOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let fw=class extends ow{constructor(){super(...arguments),this.type="node",this._lastTime=0,this.supportEvent=!1}configure(n,t){n.env===this.type&&(n.setActiveEnvContribution(this),this.pkg=t)}getDynamicCanvasCount(){return 0}getStaticCanvasCount(){return 999}loadJson(n){const t=fetch(n).then(e=>e.json());return t.then(e=>({data:e,state:"success"})).catch(()=>({data:null,state:"fail"})),t}loadArrayBuffer(n){return fetch(n).then(t=>t.arrayBuffer()).then(t=>({data:t,loadState:"success"})).catch(()=>({data:null,loadState:"fail"}))}loadImage(n){const{loadImage:t}=this.pkg;return t?t(n).then(e=>({loadState:e?"success":"fail",data:e})).catch(()=>({loadState:"fail",data:null})):Promise.reject(new Error("node-canvas loadImage could not be found!"))}loadSvg(n){const t=this.pkg.Resvg;if(!t)return Promise.reject(new Error("@resvg/resvg-js svgParser could not be found!"));const e=new t(n).render().asPng();return this.loadImage(e)}createCanvas(n){return this.pkg.createCanvas(n.width,n.height)}releaseCanvas(n){}getDevicePixelRatio(){return 1}getRequestAnimationFrame(){return function(n){return GV.call(n)}}getCancelAnimationFrame(){return n=>{GV.clear(n)}}addEventListener(n,t,e){}removeEventListener(n,t,e){}getElementById(n){return null}getRootElement(){return null}dispatchEvent(n){}release(...n){}createOffscreenCanvas(n){}};fw=GOt([It()],fw);const mw=new te(n=>{mw.isNodeBound||(mw.isNodeBound=!0,n(fw).toSelf().inSingletonScope(),n(OM).toService(fw))});mw.isNodeBound=!1;function vw(n,t=!0){vw.__loaded||(vw.__loaded=!0,n.load(mw),n.load(WOt),n.load(VOt))}vw.__loaded=!1;var UOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},YOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},XOt=function(n,t){return function(e,i){t(e,i,n)}};let V2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="arc",this.numberType=jM}};V2=UOt([It(),XOt(0,ue(z1)),YOt("design:paramtypes",[Object])],V2);let u6=!1;const KOt=new te((n,t,e,i)=>{u6||(u6=!0,n(O4).to(V2).inSingletonScope(),n(Yn).toService(O4))});var qOt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},ZOt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},JOt=function(n,t){return function(e,i){t(e,i,n)}};let G2=class extends ntt{constructor(n){super(),this.canvasRenderer=n}};G2=qOt([It(),JOt(0,ue(G1)),ZOt("design:paramtypes",[Object])],G2);let c6=!1;const QOt=new te((n,t,e,i)=>{c6||(c6=!0,n(N4).to(G2).inSingletonScope(),n(Yn).toService(N4))});class rtt extends Nr{contains(t,e,i){if(!t.AABBBounds.containsPoint(e))return!1;if(t.attribute.pickMode==="imprecise")return!0;const{pickContext:r}=i??{};if(!r)return!1;r.highPerformanceSave();const s=t.getGraphicTheme(),o=this.transform(t,s,r),{x:a,y:l,z:h,lastModelMatrix:d}=o;let u=e;if(r.camera){u=e.clone();const g=t.parent.globalTransMatrix;u.x=g.a*e.x+g.c*e.y+g.e,u.y=g.b*e.x+g.d*e.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(t,r,a,l,{},null,g=>!!c||(c=g.isPointInPath(u.x,u.y),c),(g,p,f)=>{if(c)return!0;const m=p.lineWidth||f.lineWidth,v=p.pickStrokeBuffer||f.pickStrokeBuffer,_=p.keepStrokeScale||f.keepStrokeScale;return r.lineWidth=_?m+v:ch(r,m+v,r.dpr),c=g.isPointInStroke(u.x,u.y),c}),this.canvasRenderer.z=0,r.modelMatrix!==d&&ki.free(r.modelMatrix),r.modelMatrix=d,r.highPerformanceRestore(),c}}var tDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},eDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},iDt=function(n,t){return function(e,i){t(e,i,n)}};let U2=class extends rtt{constructor(n){super(),this.canvasRenderer=n,this.type="line",this.numberType=gb}};U2=tDt([It(),iDt(0,ue(N1)),eDt("design:paramtypes",[Object])],U2);let g6=!1;const nDt=new te((n,t,e,i)=>{g6||(g6=!0,n(W4).to(U2).inSingletonScope(),n(Yn).toService(W4))});var rDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},sDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},oDt=function(n,t){return function(e,i){t(e,i,n)}};let Y2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="area",this.numberType=cb}};Y2=rDt([It(),oDt(0,ue(W1)),sDt("design:paramtypes",[Object])],Y2);let p6=!1;const aDt=new te((n,t,e,i)=>{p6||(p6=!0,n(F4).to(Y2).inSingletonScope(),n(Yn).toService(F4))});class vb extends Nr{contains(t,e,i){const{pickContext:r}=i??{};if(!r)return!1;const s=t.getGraphicTheme();r.highPerformanceSave();const o=this.transform(t,s,r),{x:a,y:l,z:h,lastModelMatrix:d}=o;let u=e;if(r.camera){u=e.clone();const g=t.parent.globalTransMatrix;u.x=g.a*e.x+g.c*e.y+g.e,u.y=g.b*e.x+g.d*e.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(t,r,a,l,i,null,(g,p,f)=>!!c||(c=g.isPointInPath(u.x,u.y),c)),this.canvasRenderer.z=0,r.modelMatrix!==d&&ki.free(r.modelMatrix),r.modelMatrix=d,r.highPerformanceRestore(),c}}var lDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},hDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},dDt=function(n,t){return function(e,i){t(e,i,n)}};let X2=class extends vb{constructor(n){super(),this.canvasRenderer=n,this.type="symbol",this.numberType=YM}contains(n,t,e){const{pickContext:i}=e??{};if(!i)return!1;const r=n.getParsedPath();if(!i.camera){if(!n.AABBBounds.containsPoint(t))return!1;if(r.isSvg||n.attribute.pickMode==="imprecise")return!0}i.highPerformanceSave();const s=n.getGraphicTheme(),o=this.transform(n,s,i),{x:a,y:l,z:h,lastModelMatrix:d}=o;let u=t;if(i.camera){u=t.clone();const g=n.parent.globalTransMatrix;u.x=g.a*t.x+g.c*t.y+g.e,u.y=g.b*t.x+g.d*t.y+g.f}this.canvasRenderer.z=h;let c=!1;return this.canvasRenderer.drawShape(n,i,a,l,{},null,(g,p,f)=>!!c||(c=g.isPointInPath(u.x,u.y),c),(g,p,f)=>{if(c)return!0;const m=p.lineWidth||f.lineWidth,v=p.pickStrokeBuffer||f.pickStrokeBuffer,_=p.keepStrokeScale||f.keepStrokeScale;return i.lineWidth=_?m+v:ch(i,m+v,i.dpr),c=g.isPointInStroke(u.x,u.y),c}),this.canvasRenderer.z=0,i.modelMatrix!==d&&ki.free(i.modelMatrix),i.modelMatrix=d,i.highPerformanceRestore(),c}};X2=lDt([It(),dDt(0,ue(U1)),hDt("design:paramtypes",[Object])],X2);let f6=!1;const uDt=new te((n,t,e,i)=>{f6||(f6=!0,n(V4).to(X2).inSingletonScope(),n(Yn).toService(V4))});var cDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},gDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},pDt=function(n,t){return function(e,i){t(e,i,n)}};let K2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="circle",this.numberType=$M}};K2=cDt([It(),pDt(0,ue(j1)),gDt("design:paramtypes",[Object])],K2);let m6=!1;const fDt=new te((n,t,e,i)=>{m6||(m6=!0,n(H4).to(K2).inSingletonScope(),n(Yn).toService(H4))});var mDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},vDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},_Dt=function(n,t){return function(e,i){t(e,i,n)}};let q2=class extends vb{constructor(n){super(),this.canvasRenderer=n,this.type="text",this.numberType=XM}contains(n,t,e){const{pickContext:i}=e??{};if(!i)return!1;const r=n.AABBBounds;if(!i.camera)return!!r.containsPoint(t);i.highPerformanceSave();const s=n.getGraphicTheme(),{keepDirIn3d:o=s.keepDirIn3d}=n.attribute,a=!o,l=this.transform(n,s,i,a),{x:h,y:d,z:u,lastModelMatrix:c}=l;this.canvasRenderer.z=u;let g=t;if(i.camera){g=t.clone();const f=n.parent.globalTransMatrix;g.x=f.a*t.x+f.c*t.y+f.e,g.y=f.b*t.x+f.d*t.y+f.f}let p=!1;return this.canvasRenderer.drawShape(n,i,h,d,{},null,(f,m,v)=>{if(p)return!0;const{fontSize:_=s.fontSize,textBaseline:b=s.textBaseline,textAlign:y=s.textAlign}=n.attribute,C=n.AABBBounds,S=C.height(),w=C.width(),x=R1(b,S,_),A=i0(y,w);return f.rect(A+h,x+d,w,S,u),p=f.isPointInPath(g.x,g.y),p},(f,m,v)=>p),this.canvasRenderer.z=0,i.modelMatrix!==c&&ki.free(i.modelMatrix),i.modelMatrix=c,i.highPerformanceRestore(),p}};q2=mDt([It(),_Dt(0,ue(_2)),vDt("design:paramtypes",[Object])],q2);let v6=!1;const bDt=new te((n,t,e,i)=>{v6||(v6=!0,n(G4).to(q2).inSingletonScope(),n(Yn).toService(G4))});var yDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},CDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},SDt=function(n,t){return function(e,i){t(e,i,n)}};let Z2=class extends rtt{constructor(n){super(),this.canvasRenderer=n,this.type="path",this.numberType=GM}};Z2=yDt([It(),SDt(0,ue($1)),CDt("design:paramtypes",[Object])],Z2);let _6=!1;const xDt=new te((n,t,e,i)=>{_6||(_6=!0,n(j4).to(Z2).inSingletonScope(),n(Yn).toService(j4))});var wDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},ADt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},MDt=function(n,t){return function(e,i){t(e,i,n)}};let J2=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="polygon",this.numberType=UM}};J2=wDt([It(),MDt(0,ue(V1)),ADt("design:paramtypes",[Object])],J2);let b6=!1;const TDt=new te((n,t,e,i)=>{b6||(b6=!0,n(U4).to(J2).inSingletonScope(),n(Yn).toService(U4))});var kDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},RDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},BDt=function(n,t){return function(e,i){t(e,i,n)}};let Q2=class extends itt{constructor(n){super(),this.canvasRenderer=n}};Q2=kDt([It(),BDt(0,ue(Y1)),RDt("design:paramtypes",[Object])],Q2);let y6=!1;const PDt=new te((n,t,e,i)=>{y6||(y6=!0,n(K4).to(Q2).inSingletonScope(),n(Yn).toService(K4))});var EDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},LDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},IDt=function(n,t){return function(e,i){t(e,i,n)}};let tI=class{constructor(n){this.canvasRenderer=n,this.type="richtext",this.numberType=YD}contains(n,t,e){return!!n.AABBBounds.containsPoint(t)}};tI=EDt([It(),IDt(0,ue(b2)),LDt("design:paramtypes",[Object])],tI);let C6=!1;const ODt=new te((n,t,e,i)=>{C6||(C6=!0,n(X4).to(tI).inSingletonScope(),n(Yn).toService(X4))});var DDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},FDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},HDt=function(n,t){return function(e,i){t(e,i,n)}};let eI=class extends ko{constructor(n){super(),this.canvasRenderer=n,this.type="image",this.numberType=VM}};eI=DDt([It(),HDt(0,ue(C2)),FDt("design:paramtypes",[Object])],eI);let S6=!1;const zDt=new te((n,t,e,i)=>{S6||(S6=!0,n(z4).to(eI).inSingletonScope(),n(Yn).toService(z4))});var WDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},jDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},NDt=function(n,t){return function(e,i){t(e,i,n)}};let iI=class extends vb{constructor(n){super(),this.canvasRenderer=n,this.type="rect3d",this.numberType=UD,this.themeType="rect"}};iI=WDt([It(),NDt(0,ue(v2)),jDt("design:paramtypes",[Object])],iI);let x6=!1;const $Dt=new te((n,t,e,i)=>{x6||(x6=!0,n($4).to(iI).inSingletonScope(),n(Yn).toService($4))});var VDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},GDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},UDt=function(n,t){return function(e,i){t(e,i,n)}};let nI=class extends vb{constructor(n){super(),this.canvasRenderer=n,this.type="arc3d",this.numberType=NM,this.themeType="arc"}};nI=VDt([It(),UDt(0,ue(m2)),GDt("design:paramtypes",[Object])],nI);let w6=!1;const YDt=new te((n,t,e,i)=>{w6||(w6=!0,n(D4).to(nI).inSingletonScope(),n(Yn).toService(D4))});var XDt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o},KDt=function(n,t){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(n,t)},qDt=function(n,t){return function(e,i){t(e,i,n)}};let rI=class extends vb{constructor(n){super(),this.canvasRenderer=n,this.type="pyramid3d",this.numberType=VD,this.themeType="polygon"}};rI=XDt([It(),qDt(0,ue(y2)),KDt("design:paramtypes",[Object])],rI);let A6=!1;const ZDt=new te((n,t,e,i)=>{A6||(A6=!0,n(Y4).to(rI).inSingletonScope(),n(Yn).toService(Y4))}),Ro=lF();function _w(){_w.__loaded||(_w.__loaded=!0,W2t(),Qt.load(v2t),Qt.load(Ro?KOt:JIt))}_w.__loaded=!1;const Gf=_w;function bw(){bw.__loaded||(bw.__loaded=!0,j2t(),dF(),uF(),Qt.load(F2t),Qt.load(YDt))}bw.__loaded=!1;const JDt=bw;function yw(){yw.__loaded||(yw.__loaded=!0,N2t(),Qt.load(y2t),Qt.load(Ro?aDt:iOt))}yw.__loaded=!1;const stt=yw;function Cw(){Cw.__loaded||(Cw.__loaded=!0,$2t(),Qt.load(S2t),Qt.load(Ro?fDt:oOt))}Cw.__loaded=!1;const QDt=Cw;function Sw(){Sw.__loaded||(Sw.__loaded=!0,V2t(),Qt.load(T2t),Qt.load(Ro?PDt:dOt))}Sw.__loaded=!1;const tFt=Sw;function xw(){xw.__loaded||(xw.__loaded=!0,G2t())}xw.__loaded=!1;const Xi=xw;function ww(){ww.__loaded||(ww.__loaded=!0,U2t(),Qt.load(P2t),Qt.load(Ro?zDt:cOt))}ww.__loaded=!1;const ott=ww;function Aw(){Aw.__loaded||(Aw.__loaded=!0,Y2t(),Qt.load(b2t),Qt.load(Ro?nDt:mOt))}Aw.__loaded=!1;const ph=Aw;function Mw(){Mw.__loaded||(Mw.__loaded=!0,X2t(),Qt.load(w2t),Qt.load(Ro?xDt:wOt))}Mw.__loaded=!1;const _b=Mw;function Tw(){Tw.__loaded||(Tw.__loaded=!0,K2t(),Qt.load(A2t),Qt.load(Ro?TDt:yOt))}Tw.__loaded=!1;const iT=Tw;function kw(){kw.__loaded||(kw.__loaded=!0,q2t(),dF(),uF(),Qt.load(z2t),Qt.load(ZDt))}kw.__loaded=!1;const eFt=kw;function Rw(){Rw.__loaded||(Rw.__loaded=!0,Z2t(),Qt.load(_2t),Qt.load(Ro?QOt:kOt))}Rw.__loaded=!1;const fh=Rw;function Bw(){Bw.__loaded||(Bw.__loaded=!0,J2t(),Qt.load(L2t),Qt.load($Dt))}Bw.__loaded=!1;const iFt=Bw;function Pw(){Pw.__loaded||(Pw.__loaded=!0,Q2t(),Qt.load(B2t),Qt.load(Ro?ODt:ROt))}Pw.__loaded=!1;const Xd=Pw;function Ew(){Ew.__loaded||(Ew.__loaded=!0,iIt())}Ew.__loaded=!1;const lr=Ew;function Lw(){Lw.__loaded||(Lw.__loaded=!0,tIt(),Qt.load(C2t),Qt.load(Ro?uDt:LOt))}Lw.__loaded=!1;const Bo=Lw;function Iw(){Iw.__loaded||(Iw.__loaded=!0,eIt(),Qt.load(x2t),Qt.load(Ro?bDt:OOt))}Iw.__loaded=!1;const al=Iw;function att(){Xi(),fh()}const _f=-.5*Math.PI,bf=1.5*Math.PI,Pv="PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",nFt=14;var Qi;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(Qi||(Qi={}));const Se={[Qi.selectedReverse]:{},[Qi.selected]:{},[Qi.hover]:{},[Qi.hoverReverse]:{}},Ow={container:"",width:30,height:30,style:{}},rFt="scrollDown",ltt="scrollDrag",sFt="scrollUp";function ic(){return le.env==="browser"?["pointerup","pointerleave","pointercancel"]:["pointerup","pointerleave","pointerupoutside"]}const M6={debounce:ah,throttle:ha};att();let d0=class htt extends En{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},htt.defaultAttributes,t)),this.name="scrollbar",this._handleTouchMove=i=>{L(this._prePos)&&i.preventDefault()},this._onRailPointerDown=i=>{const{viewX:r,viewY:s}=i,{direction:o,width:a,height:l,range:h}=this.attribute,d=this._sliderSize,[u,c]=this._getScrollRange();let g;if(o==="vertical"){const p=s-this._viewPosition.y,f=Ne(p-d/2,u,c);g=p/l,this._slider.setAttribute("y",f,!0)}else{const p=r-this._viewPosition.x,f=Ne(p-d/2,u,c);g=p/a,this._slider.setAttribute("x",f,!0)}this.setScrollRange([g-(h[1]-h[0])/2,g+(h[1]-h[0])/2],!1),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()},this._onSliderPointerDown=i=>{this._clearDragEvents();const{stopSliderDownPropagation:r=!0}=this.attribute;r&&i.stopPropagation();const{direction:s}=this.attribute,{x:o,y:a}=this.stage.eventPointTransform(i);this._prePos=s==="horizontal"?o:a,this._dispatchEvent(rFt,{pos:this._prePos,event:i});const l=ic(),h=le.env==="browser"?le:this.stage;h.addEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),l.forEach(d=>{h.addEventListener(d,this._onSliderPointerUp)})},this._computeScrollValue=i=>{const{direction:r}=this.attribute,{x:s,y:o}=this.stage.eventPointTransform(i);let a,l,h=0;const{width:d,height:u}=this.getSliderRenderBounds();return r==="vertical"?(l=o,h=l-this._prePos,a=h/u):(l=s,h=l-this._prePos,a=h/d),[l,a]},this._onSliderPointerMove=i=>{const{stopSliderMovePropagation:r=!0}=this.attribute;r&&i.stopPropagation();const s=this.getScrollRange(),[o,a]=this._computeScrollValue(i);this.setScrollRange([s[0]+a,s[1]+a],!0),this._prePos=o},this._onSliderPointerMoveWithDelay=this.attribute.delayTime===0?this._onSliderPointerMove:M6[this.attribute.delayType](this._onSliderPointerMove,this.attribute.delayTime),this._onSliderPointerUp=i=>{const{range:r,limitRange:s=[0,1]}=this.attribute,o=this.getScrollRange(),[a,l]=this._computeScrollValue(i),h=[o[0]+l,o[1]+l];this._prePos=null,this._dispatchEvent(sFt,{pre:r,value:ts(h,s[0],s[1])}),this._clearDragEvents()}}setScrollRange(t,e=!0){const{direction:i="horizontal",limitRange:r=[0,1],range:s,realTime:o=!0}=this.attribute,a=ts(t,r[0],r[1]);if(e){const l=this._getSliderPos(a);if(this._slider){const h=l[1]-l[0];this._sliderSize=h,i==="horizontal"?this._slider.setAttributes({x:l[0],width:h},!0):this._slider.setAttributes({y:l[0],height:h},!0),this.stage&&!this.stage.autoRender&&this.stage.renderNextFrame()}}this.attribute.range=a,o&&this._dispatchEvent(ltt,{pre:s,value:a})}getScrollRange(){return this.attribute.range}bindEvents(){if(this.attribute.disableTriggerEvent)return;const{delayType:t="throttle",delayTime:e=0}=this.attribute;this._rail&&this._rail.addEventListener("pointerdown",M6[t](this._onRailPointerDown,e)),this._slider&&this._slider.addEventListener("pointerdown",this._onSliderPointerDown),(le.env==="browser"?le:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1})}render(){this._reset();const{direction:t="horizontal",width:e,height:i,range:r,limitRange:s=[0,1],railStyle:o,sliderStyle:a,padding:l=2}=this.attribute,h=this.createOrUpdateChild("scrollbar-container",{},"group"),d=h.createOrUpdateChild("scrollbar-rail",Object.assign({x:0,y:0,width:e,height:i},o),"rect");this._rail=d;const u=this.getSliderRenderBounds(),c=this._getSliderPos(ts(r,s[0],s[1])),g=c[1]-c[0];let p;this._sliderSize=g,p=t==="horizontal"?{x:c[0],y:u.y1,width:g,height:u.height}:{x:u.x1,y:c[0],width:u.width,height:g};const f=h.createOrUpdateChild("slider",Object.assign(Object.assign(Object.assign(Object.assign({},p),{cornerRadius:this._getDefaultSliderCornerRadius()}),a),{boundsPadding:Fi(l),pickMode:"imprecise"}),"rect");this._slider=f,this._container=h;const m=this._container.AABBBounds;this._viewPosition={x:m.x1,y:m.y1}}getSliderRenderBounds(){if(this._sliderRenderBounds)return this._sliderRenderBounds;const{width:t,height:e,padding:i=2}=this.attribute,[r,s,o,a]=Fi(i),l={x1:a,y1:r,x2:t-s,y2:e-o,width:Math.max(0,t-(a+s)),height:Math.max(0,e-(r+o))};return this._sliderRenderBounds=l,l}_getDefaultSliderCornerRadius(){const{direction:t,round:e}=this.attribute;if(e){const{width:i,height:r}=this.getSliderRenderBounds();return t==="horizontal"?r:i}return 0}_getSliderPos(t){const{direction:e}=this.attribute,{width:i,height:r,x1:s,y1:o}=this.getSliderRenderBounds();return e==="horizontal"?[i*t[0]+s,i*t[1]+s]:[r*t[0]+o,r*t[1]+o]}_getScrollRange(){if(this._sliderLimitRange)return this._sliderLimitRange;const{limitRange:t=[0,1],direction:e}=this.attribute,[i,r]=ts(t,0,1),{width:s,height:o,x1:a,y1:l}=this.getSliderRenderBounds(),h=this._sliderSize;return e==="horizontal"?ts([a+i*s,a+r*s],a,s-h):ts([l+i*o,l+r*o],l,o-h)}_clearDragEvents(){const t=ic(),e=le.env==="browser"?le:this.stage;e.removeEventListener("pointermove",this._onSliderPointerMoveWithDelay,{capture:!0}),t.forEach(i=>{e.removeEventListener(i,this._onSliderPointerUp)})}_reset(){this._sliderRenderBounds=null,this._sliderLimitRange=null}release(t){super.release(t),(le.env==="browser"?le:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearDragEvents()}};d0.defaultAttributes={direction:"horizontal",round:!0,sliderSize:20,sliderStyle:{fill:"rgba(0, 0, 0, .5)"},railStyle:{fill:"rgba(0, 0, 0, .0)"},padding:2,scrollRange:[0,1],delayType:"throttle",delayTime:0,realTime:!0};var sI,oFt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};let zp=sI=class{constructor(){this.name="scrollbar",this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.key=this.name+this._uid,this.scroll=n=>{var t,e;const i=n.target,r=this.getScrollContainer(i);if(!r&&!this.scrollContainer)return;if(!r&&this.scrollContainer){if(!this.scrollContainer.g.stage||this.scrollContainer.g.stage!==i.stage)return;const m=this.formatScrollContainer(this.scrollContainer.g);if(!m)return void this.clearScrollbar(this.scrollContainer.g,"all");this.scrollContainer.showH&&!m.showH&&this.clearScrollbar(this.scrollContainer.g,"horizontal"),this.scrollContainer.showV&&!m.showV&&this.clearScrollbar(this.scrollContainer.g,"vertical"),this.scrollContainer=m}else r&&this.scrollContainer&&r.g!==this.scrollContainer.g&&this.clearScrollbar(this.scrollContainer.g,"all");if(this.scrollContainer=r??this.scrollContainer,!r)return;const s=r.g;if(!s)return;const{width:o,height:a,scrollX:l=0,scrollY:h=0}=s.attribute;let d=l,u=h,{showH:c,showV:g}=r;this.scrollContainerBounds=new Bi().set(0,0,s.attribute.width,s.attribute.height),c&&c&&(Et(n.deltaX)>Et(n.deltaY)?(c=c&&!0,g=g&&!1):(c=c&&!1,g=g&&!0));const p=this.childrenBounds.width(),f=this.childrenBounds.height();c&&(d=l-((t=n.deltaX)!==null&&t!==void 0?t:0),d>0?d=0:d<o-p&&(d=o-p)),g&&(u=h-((e=n.deltaY)!==null&&e!==void 0?e:0),u>0?u=0:u<a-f&&(u=a-f)),s.setAttributes({scrollX:d,scrollY:u}),this.addOrUpdateScroll(c,g,s.parent,s)},this.handleScrollBarChange=n=>{if(!(this.scrollContainer&&this.scrollContainerBounds&&this.childrenBounds&&n&&n.target&&n.detail&&n.detail.value))return;const t=n.target,e=n.detail.value;if(t.attribute.direction==="horizontal"){const i=this.childrenBounds.width();this.scrollContainer.g.setAttributes({scrollX:-e[0]*i})}else{const i=this.childrenBounds.height();this.scrollContainer.g.setAttributes({scrollY:-e[0]*i})}}}activate(n){this.pluginService=n;const{stage:t}=this.pluginService;this.childrenBounds=new ie,t.addEventListener("wheel",this.scroll),this.params=sI.defaultParams}initEventOfScrollbar(n,t,e){n.addEventListener("pointerover",()=>{t.setAttribute("visibleAll",!0)}),n.addEventListener("pointermove",()=>{t.setAttribute("visibleAll",!0)}),n.addEventListener("pointerout",()=>{t.setAttribute("visibleAll",!1)}),t.addEventListener("pointerover",()=>{t.setAttribute("visibleAll",!0)}),t.addEventListener("pointerout",()=>{t.setAttribute("visibleAll",!0)}),t.addEventListener("scrollUp",this.handleScrollBarChange),t.addEventListener(ltt,this.handleScrollBarChange)}addOrUpdateScroll(n,t,e,i){if(n){const{scrollBar:r,isUpdate:s}=this.addOrUpdateHScroll(i,e,!0);s||this.initEventOfScrollbar(i,r,!0)}else this.clearScrollbar(i,"horizontal");if(t){const{scrollBar:r,isUpdate:s}=this.addOrUpdateHScroll(i,e,!1);s||this.initEventOfScrollbar(i,r,!1)}else this.clearScrollbar(i,"vertical")}getDirection(n){return n?"horizontal":"vertical"}addOrUpdateHScroll(n,t,e){var i,r;const s=this.getDirection(e),o=`${(i=n.name)!==null&&i!==void 0?i:n._uid}_${this.getDirection(e)}_${this.name}`,a=t.children.filter(C=>C.name===o);let l=!0,h=a[0];const{y:d=0,dy:u=0,x:c=0,dx:g=0,height:p,width:f,zIndex:m=0}=this.scrollContainer.g.attribute,v={x:0,y:0,direction:s,zIndex:m+1,visibleAll:!0,padding:[2,0],railStyle:{fill:"rgba(0, 0, 0, .1)"},range:[0,.05]};e?(v.width=this.scrollContainerBounds.width(),v.height=12):(v.height=this.scrollContainerBounds.height(),v.width=12),h?a.length>1&&a.forEach((C,S)=>{var w;S&&((w=C.parent)===null||w===void 0||w.removeChild(C))}):(l=!1,h=new d0(v),h.name=o,t.add(h),h.isScrollBar=!0);const _=this.childrenBounds,{scrollX:b,scrollY:y}=n.attribute;if(e){const C=Math.min(this.scrollContainerBounds.width()/_.width(),1),S=Math.max(Math.min(b/this.childrenBounds.width(),0),C-1);v.x=c+g,v.y=d+u+p-((r=v.height)!==null&&r!==void 0?r:0),v.range=[-S,-S+C]}else{const C=Math.min(this.scrollContainerBounds.height()/_.height(),1),S=Math.max(Math.min(y/this.childrenBounds.height(),0),C-1);v.x=c+g+f-this.scrollContainerBounds.width(),v.y=d+u,v.range=[-S,-S+C]}return h.setAttributes(v),{scrollBar:h,isUpdate:l}}clearScrollbar(n,t){n.parent&&n.parent.children.filter(e=>e.isScrollBar&&(t==="all"||e.attribute.direction===t)).forEach(e=>{e.parent.removeChild(e)})}formatScrollContainer(n){if(!n||n.type!=="group"||!n.attribute)return null;const{overflow:t,width:e,height:i}=n.attribute;if(!t||t==="hidden")return null;let r=!1,s=!1;t==="scroll"?(r=!0,s=!0):(r=t==="scroll-x",s=!r);const o=this.childrenBounds;return o.clear(),n.forEachChildren(a=>{o.union(a.AABBBounds)}),n.AABBBounds.empty()||(r&&(r=e<o.width()),s&&(s=i<o.height())),r||s?{g:n,showH:r,showV:s}:null}getScrollContainer(n){let t=n;for(;t;){const e=this.formatScrollContainer(t);if(e)return e;t=t.parent}return null}deactivate(n){const{stage:t}=this.pluginService;t.removeEventListener("wheel",this.scroll)}};zp.defaultParams={timeout:500},zp=sI=oFt([It()],zp);const aFt=new te((n,t,e,i)=>{e(zp)||(n(zp).toSelf(),n(ff).toService(zp))});function lFt(){Qt.load(aFt)}function qo(n,t){n.forEachChildren(e=>{const i=t(e);e.isContainer&&!i&&qo(e,t)})}const Ni=n=>!D(n)&&n.visible!==!1;function hFt(n,t){if(!t)return[];const e=n.find(i=>i.name===t,!0);return e?e.getChildren():[]}function dFt(n,t){if(!t)return[];const e=n.find(i=>i.name===t,!0);return e?e.findAll(i=>i.type!=="group",!0):[]}function uFt(n){const t=[n[0]];for(let e=1;e<n.length;e++)n[e].x===n[e-1].x&&n[e].y===n[e-1].y||t.push(n[e]);return t}function Dw(n){return n>=0&&n<Math.PI/2||n>3*Math.PI/2&&n<=2*Math.PI}function wa(n,t,e){return Math.abs(n-t)<e}function dtt(n,t,e){return n?{textAlign:"right",textBaseline:"middle"}:{textAlign:t<Math.PI&&e.toLocaleLowerCase().includes("top")||t>Math.PI&&e.toLocaleLowerCase().includes("bottom")?"left":t<Math.PI&&e.toLocaleLowerCase().includes("bottom")||t>Math.PI&&e.toLocaleLowerCase().includes("top")?"right":"center",textBaseline:t<Math.PI&&e.includes("inside")||t>Math.PI&&!e.includes("inside")?"bottom":"top"}}const cFt=["#ffffff","#000000"];function T6(n,t,e,i,r,s){if(typeof n!="string"||typeof t!="string")return n;const o=new Tn(n).toHex(),a=new Tn(t).toHex();return gF(o,a,e,i,s)?o:gFt(o,a,e,i,r,s)}function gFt(n,t,e,i,r,s){const o=[];r&&(r instanceof Array?o.push(...r):o.push(r)),o.push(...cFt);for(const a of o)if(n!==a&&gF(a,t,e,i,s))return a}function gF(n,t,e,i,r){if(r==="lightness"){const s=Tn.getColorBrightness(new Tn(t));return Tn.getColorBrightness(new Tn(n))<.5?s>=.5:s<.5}return i?DB(n,t)>i:e==="largeText"?DB(n,t)>3:DB(n,t)>4.5}function DB(n,t){const e=k6(n),i=k6(t);return((e>i?e:i)+.05)/((e>i?i:e)+.05)}function k6(n){const t=DY(n),e=t[0]/255,i=t[1]/255,r=t[2]/255;let s,o,a;return s=e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4),o=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4),a=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),.2126*s+.7152*o+.0722*a}function Zy(n,t,e,i){let r;switch(n){case"base":r=t;break;case"invertBase":r=e;break;case"similarBase":r=i}return r}function utt(n,t){return[n[0]*t,n[1]*t]}function ctt(n){const[t,e]=n;return Math.sqrt(t*t+e*e)}function pFt(n){let t=ctt(n);return t>0&&(t=1/t),[n[0]*t,n[1]*t]}function fFt(n,t){const[e,i]=n,[r,s]=t,o=Math.sqrt((e*e+i*i)*(r*r+s*s)),a=o&&(e*r+i*s)/o;return Math.acos(Math.min(Math.max(a,-1),1))}function mFt(n,t,e){const i=fFt(n,t),r=QC(n,t)>=0;return e?r?2*Math.PI-i:i:r?i:2*Math.PI-i}const Wp=(n,t,e,i)=>new Wi(Object.assign({defaultFontParams:Object.assign({fontFamily:Pv,fontSize:nFt},i),getTextBounds:e?void 0:QM,specialCharSet:`-/: .,@%'"~`+Wi.ALPHABET_CHAR_SET+Wi.ALPHABET_CHAR_SET.toUpperCase()},t??{}),n);function nT(n,t,e={}){if(!n)return{width:0,height:0};const i=QM({text:n,fontFamily:t.fontFamily||e.fontFamily||Pv,fontSize:t.fontSize||e.fontSize||12,fontWeight:t.fontWeight||e.fontWeight,textAlign:t.textAlign||"center",textBaseline:t.textBaseline,ellipsis:!!t.ellipsis,maxLineWidth:t.maxLineWidth||1/0,lineHeight:t.fontSize||e.fontSize||12});return{width:i.width(),height:i.height()}}function vFt(n,t="type"){return gtt(n,t)==="rich"}function gtt(n,t="type"){var e,i;return kt(n.text)&&"type"in n.text?(e=n.text.type)!==null&&e!==void 0?e:"text":t in n&&(i=n[t])!==null&&i!==void 0?i:"text"}function ptt(n){var t,e;return L(n.maxLineWidth)&&(n.maxWidth=n.maxLineWidth,delete n.maxLineWidth),n.width=(t=n.width)!==null&&t!==void 0?t:0,n.height=(e=n.height)!==null&&e!==void 0?e:0,n.textConfig=n.text.text||n.text,n}function _Ft(n){const{text:t,_originText:e}=n,{text:i}=t;return n.html=i,n.text=e,n.renderable=!1,n}function bFt(n){const{text:t,_originText:e}=n,{text:i}=t;return n.react=i,n.text=e,n.renderable=!1,n}function u0(n,t="type"){const e=gtt(n,t);return e==="rich"?Pt.richtext(ptt(n)):(e==="html"?n=_Ft(n):e==="react"&&(n=bFt(n)),Pt.text(n))}function R6(n,t,e,i,r){n==="right"?e==="center"?t.setAttribute("x",i-r/2):e==="right"||e==="end"?t.setAttribute("x",i):t.setAttribute("x",i-r):e==="center"?t.setAttribute("x",i+r/2):e==="right"||e==="end"?t.setAttribute("x",i+r):t.setAttribute("x",i)}const mg=(n,t)=>{const e=Math.atan2(n,t);return e<0?e+2*Math.PI:e};function ftt(n,t){const{x1:e,y1:i,x2:r,y2:s}=t,{x1:o,y1:a,x2:l,y2:h}=n.AABBBounds;let d=0,u=0;return o<e&&(d=e-o),a<i&&(u=i-a),l>r&&(d=r-l),h>s&&(u=s-h),{dx:d,dy:u}}function pF(n,t){const{dx:e,dy:i}=ftt(n,t),{dx:r=0,dy:s=0}=n.attribute;e&&n.setAttribute("dx",e+r),i&&n.setAttribute("dy",i+s)}function rT(){Xi(),fh(),Bo(),Xd(),al()}var B6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};rT();class Ja extends En{getBgRect(){return this._bgRect}getTextShape(){return this._textShape}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Ja.defaultAttributes,t)),this.name="tag",this._tagStates=[],this._rectStates=[],this._symbolStates=[],this._textStates=[]}render(){var t,e,i;this.cacheStates();const{text:r="",textStyle:s={},shape:o={},panel:a={},space:l=4,minWidth:h,maxWidth:d,padding:u=4,visible:c,state:g,type:p,textAlwaysCenter:f,containerTextAlign:m}=this.attribute,v=Fi(u),_=this.createOrUpdateChild("tag-content",{x:0,y:0,zIndex:1},"group");let b,y=-v[3],C=-v[0],S=v[1]+v[3],w=v[0]+v[2],x=0,A=0;const{visible:M}=o,T=B6(o,["visible"]);if(Re(M)){const G=(T==null?void 0:T.size)||10,tt=J(G)?G:Math.max(G[0],G[1]);b=_.createOrUpdateChild("tag-shape",Object.assign(Object.assign({symbolType:"circle",size:G,strokeBoundsBuffer:0},T),{visible:M,x:tt/2,y:tt/2}),"symbol"),xt(g==null?void 0:g.shape)||(b.states=g.shape),M&&(A=tt+l)}let R,B,E;if(S+=A,x+=A,vFt({text:r})||p==="rich"){const G=Object.assign(Object.assign(Object.assign({},ptt(Object.assign({type:p,text:r},s))),s),{visible:L(r)&&c!==!1,x,y:0});D(G.lineHeight)&&(G.lineHeight=s.fontSize),R=_.createOrUpdateChild("tag-text",G,"richtext"),B=R.AABBBounds.width(),E=R.AABBBounds.height()}else{const G=Object.assign(Object.assign({text:kt(r)&&"type"in r&&r.type==="text"?r.text:r,visible:L(r)&&c!==!1,lineHeight:s==null?void 0:s.fontSize},s),{x,y:0});D(G.lineHeight)&&(G.lineHeight=s.fontSize),R=_.createOrUpdateChild("tag-text",G,"text");const tt=nT(G.text,s,(e=(t=this.stage)===null||t===void 0?void 0:t.getTheme())===null||e===void 0?void 0:e.text);B=tt.width,E=tt.height}S+=B;const k=(i=o.size)!==null&&i!==void 0?i:10,P=J(k)?k:Math.max(k[0],k[1]);w+=Math.max(E,o.visible?P:0);const{textAlign:I,textBaseline:O}=s;(L(h)||L(d))&&(L(h)&&S<h&&(S=h),L(d)&&S>d&&(S=d,R.setAttribute("maxLineWidth",d-v[1]-v[2]))),y=0,C=0;let H=0;I==="left"||I==="start"?H=1:I==="right"||I==="end"?H=-1:I==="center"&&(H=0),H?H<0?(y-=S,b&&b.setAttribute("x",(b.attribute.x||0)-B),_.setAttribute("x",-v[1]-A)):H>0&&_.setAttribute("x",v[3]):(y-=S/2,b&&b.setAttribute("x",(b.attribute.x||0)-B/2),_.setAttribute("x",-A/2));const z=m==="right"||m==="end",F=m==="left"||m==="start",j=(G,tt)=>{R.type==="richtext"?R.setAttributes({x:G,textAlign:tt,textConfig:Q(R.attribute.textConfig).map(st=>Object.assign(Object.assign({},st),{textAlign:tt}))}):R.setAttributes({x:G,textAlign:tt})};if((m?m==="center":f)&&H){const G=S-v[1]-v[3],tt=B+A,st=H===1?(G-tt)/2+A+B/2:v[0]+A-(S/2+tt/2-A)+B/2;if(j(st,"center"),b){const ot=st-B/2-A+P/2;b.setAttributes({x:ot})}}if(F&&H!==1){const G=S-v[1]-v[3],tt=H===0?-G/2+A/2:-S+v[3]+v[1]+A;if(j(tt+A,"left"),b){const st=tt+P/2;b.setAttributes({x:st})}}if(z&&H!==-1){const G=S-v[1]-v[3],tt=H===0?G/2+A/2:G;if(j(tt,"right"),b){const st=tt-B-A+P/2;b.setAttributes({x:st})}}O==="middle"?(C-=w/2,b&&b.setAttribute("y",0)):O==="bottom"?(C-=w,b&&b.setAttribute("y",-E/2),_.setAttribute("y",-v[2])):O==="top"&&(_.setAttribute("y",v[0]),b&&b.setAttribute("y",E/2)),xt(g==null?void 0:g.text)||(R.states=g.text);const{visible:$}=a,Y=B6(a,["visible"]);if(c&&Re($)){const G=this.createOrUpdateChild("tag-panel",Object.assign(Object.assign({},Y),{visible:$&&!!r,width:S,height:w,x:y,y:C}),"rect");if(xt(g==null?void 0:g.panel)||(G.states=g.panel),Y.customShape){const tt=Y.customShape;G.pathProxy=st=>tt(this,st,new Cn)}this._bgRect=G}this._textShape=R,this._symbol=b,this.resetStates()}initAttributes(t,e){t=e!=null&&e.skipDefault?t:Z({},Ja.defaultAttributes,t),super.initAttributes(t),this.render()}addState(t,e,i){super.addState(t,e,i),this._textShape&&this._textShape.addState(t,e,i),this._bgRect&&this._bgRect.addState(t,e,i),this._symbol&&this._symbol.addState(t,e,i)}removeState(t,e){super.removeState(t,e),this._textShape&&this._textShape.removeState(t,e),this._bgRect&&this._bgRect.removeState(t,e),this._symbol&&this._symbol.removeState(t,e)}cacheStates(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p;this._tagStates=(e=(t=this.currentStates)===null||t===void 0?void 0:t.slice())!==null&&e!==void 0?e:[],this._rectStates=(s=(r=(i=this._bgRect)===null||i===void 0?void 0:i.currentStates)===null||r===void 0?void 0:r.slice())!==null&&s!==void 0?s:[],this._symbolStates=(l=(a=(o=this._symbol)===null||o===void 0?void 0:o.currentStates)===null||a===void 0?void 0:a.slice())!==null&&l!==void 0?l:[],this._textStates=(u=(d=(h=this._textShape)===null||h===void 0?void 0:h.currentStates)===null||d===void 0?void 0:d.slice())!==null&&u!==void 0?u:[],this.clearStates(),(c=this._bgRect)===null||c===void 0||c.clearStates(),(g=this._symbol)===null||g===void 0||g.clearStates(),(p=this._textShape)===null||p===void 0||p.clearStates()}resetStates(){var t,e,i;this._tagStates.length&&this.useStates(this._tagStates),this._rectStates.length&&((t=this._bgRect)===null||t===void 0||t.useStates(this._rectStates)),this._symbolStates.length&&((e=this._symbol)===null||e===void 0||e.useStates(this._symbolStates)),this._textStates.length&&((i=this._textShape)===null||i===void 0||i.useStates(this._textStates))}}Ja.defaultAttributes={visible:!0,textStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},space:4,padding:4,shape:{fill:"#000"}};const mtt={visible:!0,position:"auto",titleStyle:{fontSize:16,fill:"#08979c"},contentStyle:{fontSize:12,fill:"green"},panel:{visible:!0,fill:"#e6fffb",size:12,space:0,stroke:"#87e8de",lineWidth:1,cornerRadius:4}},vtt={poptip:Z({},mtt)};function yFt(){Xi(),al(),Bo(),fh()}function CFt(n){Z(vtt.poptip,mtt,n)}var SFt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const P6=new ie;yFt();const E6="M -0.5 -0.5, L -0.5 0.5, L 0.5 -0.5, Z",L6="M -0.5 -0.5, L -0.5 0.5, L 0.5 0.5, Z",I6="M -0.5 -0.5, L 0.5 -0.5, L 0.5 0.5, Z",O6="M 0.5 -0.5, L 0.5 0.5, L -0.5 0.5, Z",xFt={tl:E6,tr:I6,bl:L6,br:O6,lt:E6,lb:L6,rt:I6,rb:O6};class c0 extends En{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},c0.defaultAttributes,t)),this.name="poptip",this.positionList=["top","tl","tr","bottom","bl","br","left","lt","lb","right","rt","rb"]}render(){var t,e,i,r,s,o,a,l,h;const{titleStyle:d={},position:u,contentStyle:c={},panel:g,logoSymbol:p,poptipAnchor:f="position",logoText:m,logoTextStyle:v={},triangleMode:_="default",space:b=4,minWidth:y=0,maxWidth:C=1/0,padding:S=4,maxWidthPercent:w,visible:x,state:A,dx:M=0,dy:T=0,positionBounds:R}=this.attribute;let{title:B="",content:E=""}=this.attribute;B=this.attribute.titleFormatMethod?this.attribute.titleFormatMethod(B):B,E=this.attribute.contentFormatMethod?this.attribute.contentFormatMethod(E):E;const k=Fi(S),P=this.createOrUpdateChild("poptip-content",{x:0,y:0,zIndex:1},"group");this.group=P;const I=C-k[1]-k[3],O=L(B)&&x!==!1,H=Object.assign(Object.assign({text:V(B)?B:[B],visible:O,wrap:!0},d),{x:k[3],y:k[0],maxLineWidth:I,textAlign:"left",textBaseline:"top"}),z=P.createOrUpdateChild("poptip-title",H,"text");xt(A==null?void 0:A.title)||(z.states=A.title);const F=z.AABBBounds,j=F.height(),$=F.width();let Y=j+b;O||(Y=0);const G=L(E)&&x!==!1,tt=Object.assign(Object.assign({text:V(E)?E:[E],visible:G,wrap:!0},c),{x:k[3],y:k[0]+Y,maxLineWidth:I,textAlign:"left",textBaseline:"top"}),st=P.createOrUpdateChild("poptip-content",tt,"text");xt(A==null?void 0:A.content)||(st.states=A.content);const ot=st.AABBBounds,rt=ot.height(),pt=ot.width();G&&(Y+=rt),this.titleShape=z,this.contentShape=st;let at=ti($+k[1]+k[3],pt+k[1]+k[3]);at>C?at=C:at<y&&(at=y);let W=k[0]+k[2]+Y;const{visible:N,square:K}=g,nt=SFt(g,["visible","square"]);if(K){const ft=ti(at,W);at=ft;const Ct=ft-W;W=ft,z.setAttributes({dy:Ct/2}),st.setAttributes({dy:Ct/2})}const X=(t=nt.size)!==null&&t!==void 0?t:12,ht=V(X)?[X[0]+((e=nt.space)!==null&&e!==void 0?e:0),X[1]+((i=nt.space)!==null&&i!==void 0?i:0)]:X+((r=nt.space)!==null&&r!==void 0?r:0),_t=(s=nt.lineWidth)!==null&&s!==void 0?s:1,ct=this.stage?[(o=this.stage.viewWidth)!==null&&o!==void 0?o:this.stage.width,(a=this.stage.viewHeight)!==null&&a!==void 0?a:this.stage.height]:void 0;if(ct){const ft=this.AABBBounds,Ct=(l=this.attribute.x)!==null&&l!==void 0?l:ft.x1,Ht=ct[0]-ft.x1;let Xt=Math.max(Ct,Ht);const ae=(V(X)?X[0]:12)+3;if(Xt=Math.min(Xt-ae,Xt*w),Xt<at){at=Xt;const re=k[1]+k[3];z.setAttribute("maxLineWidth",Xt-re),st.setAttribute("maxLineWidth",Xt-re),W=k[0]+k[2],O&&(W+=z.AABBBounds.height()+b),W+=st.AABBBounds.height()}}const U=u==="auto"||V(u),ut=V(u)?u:this.positionList;let lt,At=-1/0;for(let ft=0;ft<ut.length+1;ft++){const Ct=U?ut[ft===ut.length?lt:ft]:u;let Ht="arrow2Left",Xt=(V(X)?X[0]:X)/4,ae=0;Ct==="top"||Ct==="bottom"||Ct==="left"||Ct==="right"?Ht="arrow2Left":_==="concise"&&(Ht=xFt[Ct],Xt=["tl","bl","rt","rb"].includes(Ct)?(V(X)?X[0]:X)/2:-(V(X)?X[0]:X)/2,ae=["tl","tr","lb","rb"].includes(Ct)?-(V(X)?X[1]:X)/2:(V(X)?X[1]:X)/2);const{angle:re,offset:be}=this.getAngleAndOffset(Ct,at,W,V(ht)?ht:[ht,ht-_t],Ht);let Xe,_i={x:0,y:0};if(f==="bounds"&&R&&(_i=this.calculateAnchorPoint(Ct,R)),Re(N)){let Gt;Xe=P.createOrUpdateChild("poptip-symbol-panel",Object.assign(Object.assign({},nt),{visible:N&&(G||O),x:Xt,y:ae,strokeBoundsBuffer:-1,boundsPadding:-2,anchor:[0,0],symbolType:Ht,angle:re,dx:be[0],dy:be[1]-((h=nt.space)!==null&&h!==void 0?h:0),size:X,zIndex:9}),"symbol"),xt(A==null?void 0:A.panel)||(Xe.states=A.panel),Gt=g.panelSymbolType?P.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},nt),{visible:N&&(G||O),x:0,y:0,symbolType:"rect",size:[at,W],zIndex:-8}),"symbol"):P.createOrUpdateChild("poptip-rect-panel",Object.assign(Object.assign({},nt),{visible:N&&(G||O),x:0,y:0,width:at,height:W,zIndex:-8}),"rect"),xt(A==null?void 0:A.panel)||(Gt.states=A.panel)}if(P.setAttributes({x:-be[0]+M+_i.x,y:-be[1]+T+_i.y,anchor:[Xt,ae]}),p){const{size:Gt=12}=p,Ge=V(Gt)?Gt:[Gt,Gt];Ge[1]==="auto"&&(Ge[1]=W),Ge[0]==="auto"&&(Ge[0]=W);const He=Ge[0];P.createOrUpdateChild("poptip-logo",Object.assign(Object.assign({},p),{x:0,y:W/2,visible:N&&(G||O),zIndex:10,size:Ge}),"symbol"),P.setAttributes({x:-be[0]+M+He/2,y:-be[1]+T}),m&&P.createOrUpdateChild("poptip-logo-text",Object.assign(Object.assign({},v),{x:0,y:W/2,visible:N&&(G||O),text:m,textAlign:"center",textBaseline:"middle",zIndex:10}),"text")}if(!ct)break;{P6.setValue(0,0,at,W).transformWithMatrix(P.globalTransMatrix);const Gt=P6,Ge=new Bi().setValue(0,0,ct[0],ct[1]);if(U){if(BY(Gt,Ge,!1))break;{const He=KA(Gt,Ge,!1),ci=(He.x2-He.x1)*(He.y2-He.y1);ci>At&&(At=ci,lt=ft)}}if(["top","bottom","left","right"].includes(Ct)){const He=Ct==="top"||Ct==="bottom",ci=Ct==="left"||Ct==="right";let Vr=!1;if(He?Vr=Ct==="top"&&Gt.y1<0||Ct==="bottom"&&Gt.y2>Ge.y2:ci&&(Vr=Ct==="left"&&Gt.x1<0||Ct==="right"&&Gt.x2>Ge.x2),!Vr){let Ln=0;const Mr=(V(X)?X[1]:X)/2;He?(Gt.x1<0?Ln=-Gt.x1:Gt.x2>Ge.x2&&(Ln=Ge.x2-Gt.x2),P.setAttribute("x",P.attribute.x+Ln),Xe.setAttribute("dx",we(ti(Xe.attribute.dx-Ln,Mr),Gt.width()-Mr))):ci&&(Gt.y1<0?Ln=-Gt.y1:Gt.y2>Ge.y2&&(Ln=Ge.y2-Gt.y2),P.setAttribute("y",P.attribute.y+Ln),Xe.setAttribute("dy",we(ti(Xe.attribute.dy-Ln,Mr),Gt.height()-Mr)));break}}if(!U)break}}}calculateAnchorPoint(t,e){if(!e)return{x:0,y:0};const{x:i,y:r}=this.attribute,{x1:s,y1:o,x2:a,y2:l}=e,h=a-s,d=l-o;switch(t){case"top":case"tl":case"tr":return{x:s+h/2-i,y:o-r};case"bottom":case"bl":case"br":return{x:s+h/2-i,y:l-r};case"left":case"lt":case"lb":return{x:s-i,y:o+d/2-r};case"right":case"rt":case"rb":return{x:a-i,y:o+d/2-r};default:return{x:0,y:0}}}getAngleAndOffset(t,e,i,r,s){const o=s==="arrow2Left"?r[1]/2:r[1];switch(t){case"tl":return{angle:s==="arrow2Left"?Kt/2*3:0,offset:s==="arrow2Left"?[e/4,i+o]:[0,i+o]};case"top":return{angle:Kt/2*3,offset:[e/2,i+o]};case"tr":return{angle:s==="arrow2Left"?Kt/2*3:0,offset:s==="arrow2Left"?[e/4*3,i+o]:[e,i+o]};case"rt":return{angle:0,offset:s==="arrow2Left"?[-o,i/5]:[-o,0]};case"right":return{angle:0,offset:[-o,i/2]};case"rb":return{angle:0,offset:s==="arrow2Left"?[-o,i/5*4]:[-o,i]};case"bl":return{angle:s==="arrow2Left"?Kt/2:0,offset:s==="arrow2Left"?[e/4,-o]:[0,-o]};case"bottom":return{angle:Kt/2,offset:[e/2,-o]};case"br":return{angle:s==="arrow2Left"?Kt/2:0,offset:s==="arrow2Left"?[e/4*3,-o]:[e,-o]};case"lt":return{angle:s==="arrow2Left"?Kt:0,offset:s==="arrow2Left"?[e+o,i/5]:[e+o,0]};case"left":return{angle:Kt,offset:[e+o,i/2]};case"lb":return{angle:s==="arrow2Left"?Kt:0,offset:s==="arrow2Left"?[e+o,i/5*4]:[e+o,i]}}}appearAnimate(t){const{duration:e=1e3,easing:i="quadOut"}=t;if(this.setAttributes({scaleX:0,scaleY:0}),this.animate().to({scaleX:1,scaleY:1},e/3*2,i),this.titleShape&&this.titleShape.animate().play(new YV({text:""},{text:this.titleShape.attribute.text},e,i)),this.contentShape&&this.contentShape.animate().play(new YV({text:""},{text:this.contentShape.attribute.text},e,i)),t.wave){const r=e/6;this.group.animate().to({angle:t.wave},r,i).to({angle:-t.wave},2*r,i).to({angle:t.wave},2*r,i).to({angle:0},r,i)}}disappearAnimate(t){const{duration:e=1e3,easing:i="quadOut"}=t;this.animate().to({scaleX:0,scaleY:0},e,i)}}c0.defaultAttributes={position:"rt",visible:!0,title:null,content:null,titleStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},contentStyle:{fontSize:12,fill:"#000",textAlign:"left",textBaseline:"top"},panel:{},maxWidthPercent:.8,space:8,padding:10};var wFt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};function AFt(n,t){return Z(n,vtt.poptip,t),n}let Ev=class{render(n,t,e,i,r,s,o,a,l,h,d,u,c){var g,p;if(n._showPoptip===1){const{visible:f,visibleCb:m}=n.attribute.poptip||{};if(f===!1||m&&m(n)===!1)return;const v={};Z(v,c0.defaultAttributes,n.attribute.poptip?n.attribute.poptip:{}),this.poptipComponent?this.poptipComponent.initAttributes(v):this.poptipComponent=new c0(v);let _=n.attribute.poptip||{};if(n.type==="text"&&_.title==null&&_.content==null){const C={};AFt(C,_),_=C,_.content=(g=_.content)!==null&&g!==void 0?g:n.attribute.text}const b=n.globalTransMatrix;this.poptipComponent.setAttributes(Object.assign(Object.assign({visibleAll:!0,pickable:!1,childrenPickable:!1,poptipAnchor:"bounds"},_),{x:b.e,y:b.f,positionBounds:n.globalAABBBounds})),h.stage.tryInitInteractiveLayer();const y=h.stage.getLayer("_builtin_interactive");y&&y.add(this.poptipComponent)}else n._showPoptip===2&&(n._showPoptip=0,this.poptipComponent&&(this.poptipComponent.setAttributes({visibleAll:!1}),(p=this.poptipComponent.parent)===null||p===void 0||p.removeChild(this.poptipComponent),this.poptipComponent=null))}};Ev=wFt([It()],Ev);var _tt=function(n,t,e,i){var r,s=arguments.length,o=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(n,t,e,i);else for(var a=n.length-1;a>=0;a--)(r=n[a])&&(o=(s<3?r(o):s>3?r(t,e,o):r(t,e))||o);return s>3&&o&&Object.defineProperty(t,e,o),o};class btt{constructor(){this.activeEvent="onRegister",this._uid=nn.GenAutoIncrementId(),this.poptip=t=>{const e=t.target;this.needHide(e)?this.unpoptip(t):e!==this.activeGraphic&&(this.needShow(e)&&(e.setAttributes({}),e._showPoptip=1),this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2),this.setActiveGraphic(e,!0))},this.unpoptip=t=>{this.activeGraphic&&(this.activeGraphic.setAttributes({}),this.activeGraphic._showPoptip=2,this.setActiveGraphic(null,!0))}}activate(t){this.pluginService=t;const{stage:e}=this.pluginService;e.addEventListener("pointerover",this.poptip)}needHide(t){return t.isContainer||!t.attribute}needShow(t){return!!t.attribute.poptip}setActiveGraphic(t,e){this.activeGraphic=t,this.pluginService.stage.renderNextFrame()}deactivate(t){const{stage:e}=this.pluginService;e.removeEventListener("pointerover",this.poptip)}}let Lv=class extends btt{constructor(){super(...arguments),this.name="poptip",this.key=this.name+this._uid}};Lv=_tt([It()],Lv);let Iv=class extends btt{constructor(){super(...arguments),this.name="poptipForText",this.key=this.name+this._uid,this.pointerlave=n=>{const{stage:t}=this.pluginService;n.target===t&&this.unpoptip(n)}}activate(n){super.activate(n);const{stage:t}=this.pluginService;t.addEventListener("pointerleave",this.pointerlave)}needHide(n){return n.type!=="text"||!n.cliped||n.isContainer||!n.attribute||n.attribute.disableAutoClipedPoptip}needShow(n){return!0}deactivate(n){const{stage:t}=this.pluginService;super.deactivate(n),t.removeEventListener("pointerleave",this.pointerlave)}};Iv=_tt([It()],Iv);const MFt=new te((n,t,e,i)=>{e(Ev)||(n(Ev).toSelf().inSingletonScope(),n(JD).toService(Ev)),e(Lv)||(n(Lv).toSelf(),n(ff).toService(Lv)),e(Iv)||(n(Iv).toSelf(),n(ff).toService(Iv))});function TFt(){Qt.load(MFt)}class bb extends En{constructor(){super(...arguments),this.name="crosshair"}render(){this.renderCrosshair(this)}}function kFt(){Xi(),ph()}function RFt(){Xi(),Gf()}function BFt(){Xi(),_b()}function PFt(){Xi(),fh()}function EFt(){Xi(),Gf()}kFt();class yb extends bb{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},yb.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,lineStyle:r}=this.attribute;return t.createOrUpdateChild("crosshair-line",Object.assign({points:[e,i]},r),"line")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}yb.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};PFt();class sT extends bb{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},sT.defaultAttributes,t))}renderCrosshair(t){const{start:e,end:i,rectStyle:r}=this.attribute;return t.createOrUpdateChild("crosshair-rect",Object.assign({x:e.x,y:e.y,width:i.x-e.x,height:i.y-e.y},r),"rect")}setLocation(t){const{start:e,end:i}=t;this.setAttributes({start:e,end:i})}}sT.defaultAttributes={rectStyle:{fill:"#b2bacf",opacity:.2}};RFt();class oT extends bb{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},oT.defaultAttributes,t))}renderCrosshair(t){const{center:e,radius:i,lineStyle:r}=this.attribute;return t.createOrUpdateChild("crosshair-circle",Object.assign(Object.assign(Object.assign(Object.assign({},e),{outerRadius:i}),this.attribute),r),"arc")}setLocation(t){const{center:e}=this.attribute,i=hi.distancePP(t,e);this.setAttribute("radius",i)}}oT.defaultAttributes={lineStyle:{stroke:["#b2bacf",!1,!1,!1],lineWidth:1,lineDash:[2]}};EFt();class aT extends bb{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},aT.defaultAttributes,t))}renderCrosshair(t){const{center:e,radius:i,innerRadius:r=0,sectorStyle:s}=this.attribute,{startAngle:o,endAngle:a}=this.attribute;return t.createOrUpdateChild("crosshair-sector",Object.assign(Object.assign(Object.assign({},e),{outerRadius:i,innerRadius:r,startAngle:o,endAngle:a}),s),"arc")}setLocation(t){const{center:e,startAngle:i=_f,endAngle:r=bf}=this.attribute,s=r-i,o=T_(TY(e,t));this.setAttributes({startAngle:o-s/2,endAngle:o+s/2})}}aT.defaultAttributes={sectorStyle:{fill:"#b2bacf",opacity:.2}};BFt();class lT extends bb{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},lT.defaultAttributes,t))}renderCrosshair(t){const{center:e,radius:i,sides:r=6,lineStyle:s}=this.attribute,{startAngle:o,endAngle:a}=this.attribute,l=(a-o)%(2*Math.PI)==0,h=(a-o)/r;let d;for(let u=0;u<=r;u++){const c=ui(e,i,o+h*u);u===0?d=`M${c.x},${c.y}`:d+=`L${c.x},${c.y}`,u===r&&l&&(d+="Z")}return t.createOrUpdateChild("crosshair-polygon",Object.assign({path:d},s),"path")}setLocation(t){const{center:e}=this.attribute,i=hi.distancePP(t,e);this.setAttribute("radius",i)}}lT.defaultAttributes={lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}};function fF(){Xi(),ph(),iT(),Bo()}function mF(){Xi(),ph(),Gf(),Bo()}fF();class nh extends En{getStartAngle(){return Ka(this._startAngle)}getEndAngle(){return Ka(this._endAngle)}getMainSegmentPoints(){return this._mainSegmentPoints}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},nh.defaultAttributes,t)),this.name="segment",this.key="segment",this.lines=[]}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:r,visible:s=!0,multiSegment:o,mainSegmentIndex:a}=this.attribute;if(!s)return;this._computeLineAngle();const l=this._getMainSegmentPoints(),h=this._renderSymbol(t,l,"start"),d=this._renderSymbol(e,l,"end");if(this.startSymbol=h,this.endSymbol=d,o){const u=[...this.attribute.points];if(et(a))u[a]=this._clipPoints(u[a]);else{const c=this._clipPoints(M_(u));u[0][0]=c[0],u[u.length-1][u[u.length-1].length-1]=c[c.length-1]}u.forEach((c,g)=>{var p,f;const m=Pt.line(Object.assign(Object.assign({points:c},V(i)?(p=i[g])!==null&&p!==void 0?p:i[i.length-1]:i),{fill:!1}));m.name=`${this.name}-line`,m.id=this._getNodeId("line"+g),xt(r==null?void 0:r.line)||(m.states=V(r.line)?(f=r.line[g])!==null&&f!==void 0?f:r.line[r.line.length-1]:r.line),this.add(m),this.lines.push(m)})}else{let u=Pt.line;Q(i)[0].cornerRadius&&(u=Pt.polygon);const c=u(Object.assign(Object.assign({points:this._clipPoints(this.attribute.points)},Q(i)[0]),{fill:!1,closePath:!1}));c.name=`${this.name}-line`,c.id=this._getNodeId("line"),xt(r==null?void 0:r.line)||(c.states=[].concat(r.line)[0]),this.add(c),this.lines.push(c)}}_computeStartRotate(t){return t+Math.PI/2}_computeEndRotate(t){return t+Math.PI/2}_renderSymbol(t,e,i){if(!e.length)return;const{autoRotate:r=!0}=t;let s;if(t&&t.visible){const o=this.getStartAngle(),a=this.getEndAngle(),{state:l}=this.attribute,h=e[0],d=e[e.length-1],{refX:u=0,refY:c=0,refAngle:g=0,style:p,symbolType:f,size:m=12}=t;let v,_;i==="start"?(v={x:h.x+(et(o)?u*Math.cos(o)+c*Math.cos(o-Math.PI/2):0),y:h.y+(et(o)?u*Math.sin(o)+c*Math.sin(o-Math.PI/2):0)},_=this._computeStartRotate(this._startAngle)):(v={x:d.x+(et(a)?u*Math.cos(a)+c*Math.cos(a-Math.PI/2):0),y:d.y+(et(a)?u*Math.sin(a)+c*Math.sin(a-Math.PI/2):0)},_=this._computeEndRotate(this._endAngle)),s=Pt.symbol(Object.assign(Object.assign(Object.assign({},v),{symbolType:f,size:m,angle:r?_+g:0,strokeBoundsBuffer:0}),p)),s.name=`${this.name}-${i}-symbol`,s.id=this._getNodeId(`${i}-symbol`),xt(l==null?void 0:l.symbol)||(s.states=l.symbol),i==="start"?xt(l==null?void 0:l.startSymbol)||(s.states=l.startSymbol):xt(l==null?void 0:l.endSymbol)||(s.states=l.endSymbol),this.add(s)}return s}_getMainSegmentPoints(){if(this._mainSegmentPoints)return this._mainSegmentPoints;const{points:t,multiSegment:e,mainSegmentIndex:i}=this.attribute;let r;return r=e?et(i)?t[i]:M_(t):t,this._mainSegmentPoints=r,r}_clipPoints(t){const{startSymbol:e={},endSymbol:i={}}=this.attribute;let r=t;if(e.visible){const s=e.clip?e.size||10:0;r=[{x:t[0].x-s/2*(Math.cos(this._startAngle)||0),y:t[0].y-s/2*(Math.sin(this._startAngle)||0)},...r.slice(1)]}if(i.visible){const s=i.clip?i.size||10:0,o={x:t[t.length-1].x-s/2*(Math.cos(this._endAngle)||0),y:t[t.length-1].y-s/2*(Math.sin(this._endAngle)||0)};r=[...r.slice(0,r.length-1),o]}return r}_computeLineAngle(){const t=this._getMainSegmentPoints();if(t.length<=1)return;const e=t[0],i=t[1],r=t[t.length-2],s=t[t.length-1],o=[e.x-i.x,e.y-i.y],a=Math.atan2(o[1],o[0]),l=[s.x-r.x,s.y-r.y],h=Math.atan2(l[1],l[0]);this._startAngle=a,this._endAngle=h}_reset(){this.startSymbol=null,this.endSymbol=null,this._startAngle=null,this._endAngle=null,this._mainSegmentPoints=null}}nh.defaultAttributes={visible:!0,lineStyle:{lineWidth:1,stroke:"#000"},startSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}},endSymbol:{visible:!1,autoRotate:!0,symbolType:"triangle",size:12,refX:0,refY:0,refAngle:0,style:{fill:"#000",zIndex:1}}};mF();class oI extends nh{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},nh.defaultAttributes,t)),this.name="arc-segment",this.key="arc-segment",this.isReverseArc=!1}getStartAngle(){const t=this.isReverseArc?this._startAngle+Math.PI/2:this._startAngle-Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getEndAngle(){const t=this.isReverseArc?this._endAngle-Math.PI/2:this._endAngle+Math.PI/2;return t<0?t+2*Math.PI:t>2*Math.PI?t-2*Math.PI:t}getMainSegmentPoints(){return this._mainSegmentPoints}_computeStartRotate(t){return this.isReverseArc?t+Math.PI:t}_computeEndRotate(t){return this.isReverseArc?t:t+Math.PI}render(){this.removeAllChild(!0),this._reset();const{startSymbol:t,endSymbol:e,lineStyle:i,state:r,visible:s=!0,radius:o,startAngle:a,endAngle:l,center:h}=this.attribute;if(!s)return;this._startAngle=a,this._endAngle=l,this.isReverseArc=a>l;const d={x:h.x+o*Math.cos(this._startAngle),y:h.y+o*Math.sin(this._startAngle)},u={x:h.x+o*Math.cos(this._endAngle),y:h.y+o*Math.sin(this._endAngle)};this._mainSegmentPoints=[d,u];const c=this._renderSymbol(t,this._mainSegmentPoints,"start"),g=this._renderSymbol(e,this._mainSegmentPoints,"end");this.startSymbol=c,this.endSymbol=g;const p=Pt.arc(Object.assign({x:h.x,y:h.y,startAngle:a,endAngle:l,innerRadius:o,outerRadius:o},i));p.name=`${this.name}-line`,p.id=this._getNodeId("arc"),xt(r==null?void 0:r.line)||(p.states=[].concat(r.line)[0]),this.add(p),this.line=p}}var _n;(function(n){n.innerView="inner-view",n.axisContainer="axis-container",n.labelContainer="axis-label-container",n.tickContainer="axis-tick-container",n.tick="axis-tick",n.subTick="axis-sub-tick",n.label="axis-label",n.title="axis-title",n.gridContainer="axis-grid-container",n.grid="axis-grid",n.gridRegion="axis-grid-region",n.line="axis-line",n.background="axis-background",n.axisLabelBackground="axis-label-background",n.axisBreak="axis-break",n.axisBreakSymbol="axis-break-symbol"})(_n||(_n={}));var Zg;(function(n){n.selected="selected",n.selectedReverse="selected_reverse",n.hover="hover",n.hoverReverse="hover_reverse"})(Zg||(Zg={}));const Pa={[Zg.selectedReverse]:{},[Zg.selected]:{},[Zg.hover]:{},[Zg.hoverReverse]:{}},LFt=999,Fw={title:{space:4,padding:0,textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1}},label:{visible:!0,inside:!1,space:4,padding:0,style:{fontSize:12,fill:"#333",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#999",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#000",strokeOpacity:1}}},D6={size:8,stroke:"#000",lineWidth:1,zIndex:1};function IFt(n){const t=n.AABBBounds;return{x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,centerX:n.attribute.x,centerY:n.attribute.y,angle:n.attribute.angle}}function OFt(n){n.forEach(t=>{if(t.rotatedBounds||!t.attribute.angle)return;const e=IFt(t),i=uo({x:t.attribute.x,y:t.attribute.y},e.angle,{x:e.centerX,y:e.centerY}),r=i.x-e.centerX,s=i.y-e.centerY;e.x1+=r,e.x2+=r,e.y1+=s,e.y2+=s,e.centerX+=r,e.centerY+=s,t.rotatedBounds=e})}function DFt(n,t){var e,i;return!((e=n.OBBBounds)===null||e===void 0)&&e.empty()||!((i=t.OBBBounds)===null||i===void 0)&&i.empty()?kd(n.AABBBounds,t.AABBBounds,!1)&&(!n.rotatedBounds||!t.rotatedBounds||xO(n.rotatedBounds,t.rotatedBounds,!0)):n.OBBBounds.intersects(t.OBBBounds)}const ytt=Math.sin(Math.PI/10);function Ctt(n,t=ytt){const e=!D(n)&&n!==0,i=e?Math.cos(n):1;return e&&Math.abs(i)<=t}function vF(n,t=ytt){const e=!D(n)&&n!==0,i=e?Math.sin(n):0;return!e||Math.abs(i)<=t}function FFt(n,t){return{x:n.x+t[0],y:n.y+t[1]}}function HFt(n={}){var t,e;const{style:i={},angle:r=.5*Math.PI}=n,s=Z({},D6,i),o=(t=s.size)!==null&&t!==void 0?t:D6.size;return Object.assign(Object.assign({},s),{symbolType:(e=s.symbolType)!==null&&e!==void 0?e:`M ${-o/2} ${o*Math.sin(r)} L ${o/2} ${-o*Math.sin(r)}`,symbolSize:o})}function Stt(n){const t={};return qo(n,e=>{e.type!=="group"&&e.id&&(t[e.id]=e)}),t}function _F(n,t){return{x:n.x+t[0],y:n.y+t[1]}}function aI(n,t,e,i=!1,r=!1){const s=[t.x-e.x,t.y-e.y];return utt(s,(i?-1:1)*(r?-1:1)*n/ctt(s))}function zFt(n){let t="center",e="middle";return t=(n=Ka(n))>=Math.PI*(5/3)||n<=Math.PI*(1/3)?"left":n>=Math.PI*(2/3)&&n<=Math.PI*(4/3)?"right":"center",e=n>=Math.PI*(7/6)&&n<=Math.PI*(11/6)?"bottom":n>=Math.PI*(1/6)&&n<=Math.PI*(5/6)?"top":"middle",{align:t,baseline:e}}function WFt(n,t,e,i,r){const s=ui({x:0,y:0},e,n),o=_F(s,aI(i,s,t,r));return FFt(o,aI(i||1,o,t,r))}function xtt(n,t,e,i,r){const s=[],o=r-i;for(let a=0;a<t;a++){const l=i+a*o/t;s.push(ui(n,e,l))}return s}function Wu(n,t){let e="";return n.length===0||(n.forEach((i,r)=>{r===0?e=`M${i.x},${i.y}`:e+=`L${i.x},${i.y}`}),t&&(e+="Z")),e}function Zo(n,t,e){var i;const r=(i=n.attribute)===null||i===void 0?void 0:i.angle;if(vF(r,Number.EPSILON))return e>eS(n.AABBBounds,t.AABBBounds);const s=n.OBBBounds,o=t.OBBBounds;return!s||!o||s.empty()||o.empty()?e>eS(n.AABBBounds,t.AABBBounds):s.intersects(o)||e>EY(s,o)}function lI(n,t){for(let e,i=1,r=n.length,s=n[0];i<r;s=e,++i)if(e=n[i],Zo(s,e,t))return!0;return!1}const wtt=(n,t,e)=>{const i=n.target;return i!==e&&i.name&&!xt(i.states)?(i.addState(Qi.hover,!0),qo(t,r=>{r!==i&&r.name&&!xt(r.states)&&r.addState(Qi.hoverReverse,!0)}),i):e},Att=(n,t,e)=>e&&(qo(t,i=>{i.name&&!xt(i.states)&&(i.removeState(Qi.hoverReverse),i.removeState(Qi.hover))}),null),Mtt=(n,t,e)=>{const i=n.target;return e===i&&i.hasState(Qi.selected)?(qo(t,r=>{r.name&&!xt(r.states)&&(r.removeState(Qi.selectedReverse),r.removeState(Qi.selected))}),null):i.name&&!xt(i.states)?(i.addState(Qi.selected,!0),qo(t,r=>{r!==i&&r.name&&!xt(r.states)&&r.addState(Qi.selectedReverse,!0)}),i):e};class Ttt extends En{constructor(){super(...arguments),this.name="axis",this.data=[],this.tickLineItems=[],this.subTickLineItems=[],this.axisLabelLayerSize={},this.axisLabelsContainer=null,this._onHover=t=>{this._lastHover=wtt(t,this.axisContainer,this._lastHover)},this._onUnHover=t=>{this._lastHover=Att(t,this.axisContainer,this._lastHover)},this._onClick=t=>{this._lastSelect=Mtt(t,this.axisContainer,this._lastSelect)}}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}getBoundsWithoutRender(t){const e=Pn(this.attribute);Z(this.attribute,t);const i=Pt.group({x:this.attribute.x,y:this.attribute.y});return this.add(i),this._renderInner(i),this.removeChild(i),this.attribute=e,i.AABBBounds}render(){this._prevInnerView=this._innerView&&Stt(this._innerView),this.removeAllChild(!0),this._innerView=Pt.group({x:0,y:0,pickable:!1}),this.add(this._innerView),this._renderInner(this._innerView),this._bindEvent()}_bindEvent(){if(this.attribute.disableTriggerEvent)return;const{hover:t,select:e}=this.attribute;t&&(this._innerView.addEventListener("pointermove",this._onHover),this._innerView.addEventListener("pointerout",this._onUnHover)),e&&this._innerView.addEventListener("pointerdown",this._onClick)}_renderInner(t){const{title:e,label:i,tick:r,line:s,items:o}=this.attribute,a=Pt.group({x:0,y:0,zIndex:1,pickable:!1});if(a.name=_n.axisContainer,a.id=this._getNodeId("container"),a.setMode(this.mode),this.axisContainer=a,t.add(a),s&&s.visible&&this.renderLine(a),o&&o.length&&(this.data=this._transformItems(o[0]),r&&r.visible&&this.renderTicks(a),i&&i.visible)){const l=Pt.group({x:0,y:0,pickable:!1});l.name=_n.labelContainer,l.id=this._getNodeId("label-container"),this.axisLabelsContainer=l,a.add(l),o.forEach((h,d)=>{const u=this.renderLabels(l,h,d),c=u.getChildren();this.beforeLabelsOverlap(c,h,u,d,o.length),this.handleLabelsOverlap(c,h,u,d,o.length),this.afterLabelsOverlap(c,h,u,d,o.length);let g=0,p=0,f="center",m="middle",v=0;c.forEach((_,b)=>{var y;const C=_.attribute,S=(y=C.angle)!==null&&y!==void 0?y:0,w=_.AABBBounds;let x=w.width(),A=w.height();S&&(x=Math.abs(x*Math.cos(S)),A=Math.abs(A*Math.sin(S))),g=Math.max(g,x),p=Math.max(p,A),f=C.textAlign,m=C.textBaseline,b===0&&(v=C.x)}),this.axisLabelLayerSize[d]={width:g,height:p,labelPos:v,textAlign:f,textBaseline:m}})}e&&e.visible&&this.renderTitle(a)}renderTicks(t){const e=this.getTickLineItems(),i=Pt.group({x:0,y:0,pickable:!1});i.name=_n.tickContainer,i.id=this._getNodeId("tick-container"),t.add(i),e.forEach((s,o)=>{var a;const l=Pt.line(Object.assign({},this._getTickLineAttribute("tick",s,o,e)));if(l.name=_n.tick,l.id=this._getNodeId(s.id),xt((a=this.attribute.tick)===null||a===void 0?void 0:a.state))l.states=Se;else{const h=this.data[o],d=Z({},Se,this.attribute.tick.state);Object.keys(d).forEach(u=>{it(d[u])&&(d[u]=d[u](h.rawValue,o,h,this.data))}),l.states=d}i.add(l)}),this.tickLineItems=e;const{subTick:r}=this.attribute;if(r&&r.visible){const s=this.getSubTickLineItems();s.length&&s.forEach((o,a)=>{const l=Pt.line(Object.assign({},this._getTickLineAttribute("subTick",o,a,e)));if(l.name=_n.subTick,l.id=this._getNodeId(`${a}`),xt(r.state))l.states=Se;else{const h=Z({},Se,r.state);Object.keys(h).forEach(d=>{it(h[d])&&(h[d]=h[d](o.value,a,o,e))}),l.states=h}i.add(l)}),this.subTickLineItems=s}}renderLabels(t,e,i){const{dataFilter:r}=this.attribute.label;r&&it(r)&&(e=r(e,i));const s=this._transformItems(e),o=Pt.group({x:0,y:0,pickable:!1});return o.name=`${_n.labelContainer}-layer-${i}`,o.id=this._getNodeId(`label-container-layer-${i}`),t.add(o),s.forEach((a,l)=>{var h;const d=this._getLabelAttribute(a,l,s,i),u=u0(d);if(u.name=_n.label,u.id=this._getNodeId(`layer${i}-label-${a.id}`),xt((h=this.attribute.label)===null||h===void 0?void 0:h.state))u.states=Se;else{const c=Z({},Se,this.attribute.label.state);Object.keys(c).forEach(g=>{it(c[g])&&(c[g]=c[g](a,l,s,i))}),u.states=c}u.data=Object.assign(Object.assign({},a),{index:l,layer:i}),o.add(u)}),o}renderTitle(t){const e=this.getTitleAttribute(),i=new Ja(Object.assign({},e));i.name=_n.title,i.id=this._getNodeId("title"),t.add(i)}getVerticalCoord(t,e,i){return _F(t,this.getVerticalVector(e,i,t))}getTickLineItems(){const{tick:t}=this.attribute,e=this.data,i=[],{alignWithLabel:r,inside:s=!1,length:o,dataFilter:a}=t;let l=1;return e.length>=2&&(l=e[1].value-e[0].value),(a&&it(a)?a(e):e).forEach(h=>{let d=h.point,u=h.value;if(!r){const g=h.value-l/2;if(this.isInValidValue(g))return;d=this.getTickCoord(g),u=g}const c=this.getVerticalCoord(d,o,s);if(this.mode==="3d"){const g=this.getVerticalVector(o,s,d);let p=0,f=0;Et(g[0])>Et(g[1])?p=Kt/2*(c.x>d.x?1:-1):f=Kt/2*(c.y>d.y?-1:1),i.push({start:d,end:c,value:u,id:`tick-${h.id}`,anchor:[d.x,d.y],alpha:p,beta:f})}else i.push({start:d,end:c,value:u,id:`tick-${h.id}`})}),i}getSubTickLineItems(){const{subTick:t}=this.attribute,e=[],{count:i=4,inside:r=!1,length:s=2}=t,o=this.tickLineItems,a=o.length;if(a>=2)for(let l=0;l<a-1;l++){const h=o[l],d=o[l+1];for(let u=0;u<i;u++){const c=(u+1)/(i+1),g=(1-c)*h.value+c*d.value,p=this.getTickCoord(g),f=this.getVerticalCoord(p,s,r);e.push({start:p,end:f,value:g,id:`sub-tick-${g}`})}}return e}_getTickLineAttribute(t,e,i,r){let s=Dt(this.attribute,`${t}.style`);const o=this.data[i];s=it(s)?Z({},Dt(Fw,`${t}.style`),t==="tick"?s(o.rawValue,i,o,this.data):s(e.value,i,e,r)):s;const{start:a,end:l,anchor:h,alpha:d,beta:u}=e;return Object.assign({points:[a,l],anchor:h,alpha:d,beta:u},s)}_getLabelAttribute(t,e,i,r){var s,o;const{space:a=4,inside:l=!1,formatMethod:h,type:d="text",text:u}=this.attribute.label;let c=a,g=0;!((s=this.attribute.tick)===null||s===void 0)&&s.visible&&this.attribute.tick.inside===l&&(g=this.attribute.tick.length||4),!((o=this.attribute.subTick)===null||o===void 0)&&o.visible&&this.attribute.subTick.inside===l&&(g=Math.max(g,this.attribute.subTick.length||2)),c+=g;const p=this.getRelativeVector(t.point);r>0&&(p[1]===0?c+=(this.axisLabelLayerSize[r-1].height+Dt(this.attribute,"label.space",4))*r:c+=(this.axisLabelLayerSize[r-1].width+Dt(this.attribute,"label.space",4))*r);const f=this.getVerticalCoord(t.point,c,l),m=this.getVerticalVector(c||1,l,f),v=h?h(`${t.label}`,t,e,i,r):t.label;let{style:_}=this.attribute.label;_=it(_)?Z({},Fw.label.style,_(t,e,i,r)):_;const b=this.getLabelAlign(m,l,_.angle);return _=Z(b,_),it(_.text)&&(_.text=_.text({label:t.label,value:t.rawValue,index:t.index,layer:r})),Object.assign(Object.assign(Object.assign({},this.getLabelPosition(f,m,v,_)),{text:u??v,_originText:t.label,lineHeight:_==null?void 0:_.fontSize,type:d}),_)}getLabelPosition(t,e,i,r){return t}_transformItems(t){const e=[];return t.forEach(i=>{var r;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(r=i.id)!==null&&r!==void 0?r:i.label}))}),e}release(){super.release(),this._prevInnerView=null,this._innerView=null}}const F6={parity:function(n){return n.filter((t,e)=>e%2?t.setAttribute("opacity",0):1)},greedy:function(n,t){let e;return n.filter((i,r)=>r&&Zo(e,i,t)?i.setAttribute("opacity",0):(e=i,1))}};function jFt(n){let t;return t=n.OBBBounds.empty()?n.AABBBounds:n.OBBBounds,t.width()>1&&t.height()>1}function NFt(n){return n.forEach(t=>t.setAttribute("opacity",1)),n}function H6(n,t,e,i,r=!1){if(e&&!n.attribute.opacity){const s=t.length;if(s>1){n.setAttribute("opacity",1);for(let o=0;o<s;o++){const a=r?t[s-1-o]:t[o];if(!i(a))break;a.setAttribute("opacity",0)}}}}function ktt(n,t){if(xt(n))return;const e=n.filter(jFt);if(xt(e))return;let i;i=NFt(e);const{method:r="parity",separation:s=0}=t,o=it(r)?r:F6[r]||F6.parity;if(i.length>=3&&lI(i,s)){do i=o(i,s);while(i.length>=3&&lI(i,s));const a=(c,g,p=!0)=>p&&c<3||g,l=a(i.length,t.firstVisible,!1);let h=a(i.length,t.lastVisible);const d=e[0],u=de(e);Zo(d,u,s)&&l&&h&&(u.setAttribute("opacity",0),h=!1),H6(d,i,l,c=>Zo(c,d,s)),H6(u,i,h,c=>Zo(c,u,s)||!(!l||c===d)&&Zo(c,d,s),!0)}e.forEach(a=>{a.setAttribute("visible",!!a.attribute.opacity)})}function $Ft(n,t){if(xt(n))return;const{orient:e,labelRotateAngle:i=[0,45,90]}=t;if(i.length===0||n.some(o=>!!o.attribute.angle))return;let r=0,s=0;for(i&&i.length>0&&(s=i.length);r<s;){const o=i[r++];if(n.forEach(a=>{a.attribute.angle=Te(o)}),GFt(e,n),!VFt(n))break}}function VFt(n){for(let t=1;t<n.length;t++)if(DFt(n[t-1],n[t]))return!0;return!1}function GFt(n,t){n!=="bottom"&&n!=="top"||YFt(n,t),n!=="left"&&n!=="right"||UFt(n,t),OFt(t)}function hT(n=0){if(n<0)for(;n<0;)n+=2*Math.PI;if(n>0)for(;n>=2*Math.PI;)n-=2*Math.PI;return n}function UFt(n,t){t.forEach((e,i)=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Btt(n,e.attribute.angle)),{angle:hT(e.attribute.angle)}))})}function YFt(n,t){t.forEach(e=>{e.attribute.angle&&e.setAttributes(Object.assign(Object.assign({},Rtt(n,e.attribute.angle)),{angle:hT(e.attribute.angle)}))})}function Rtt(n,t=0){let e=["center","left","left","left","center","right","right","right","left"],i=["top","top","middle","bottom","bottom","bottom","middle","top","top"];n==="top"&&(e=["center","right","right","right","center","left","left","left","right"],i=["bottom","bottom","middle","top","top","top","middle","bottom","bottom"]);const r=(t=hT(t))/(.5*Math.PI);let s;return s=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[s],textBaseline:i[s]}}function Btt(n,t=0){let e=["right","right","center","left","left","left","center","right","right"],i=["middle","middle","top","top","middle","middle","bottom","bottom","middle"];n==="right"&&(e=["left","left","center","right","right","right","center","left","left"],i=["middle","middle","bottom","bottom","middle","middle","top","middle","middle"]);const r=(t=hT(t))/(.5*Math.PI);let s;return s=r===Math.floor(r)?2*Math.floor(r):2*Math.floor(r)+1,{textAlign:e[s],textBaseline:i[s]}}function XFt(n){return et(n)?{left:n,right:n}:kt(n)?{left:n.left||0,right:n.right||0}:{left:0,right:0}}function KFt(n,t){const{limitLength:e,verticalLimitLength:i,ellipsis:r="...",orient:s,axisLength:o}=t;if(xt(n)||!et(e))return;const a=XFt(t.overflowLimitLength),l=n[0],h=l.attribute.angle,d=!D(h),u=d?Math.cos(h):1,c=d?Math.sin(h):0,g=vF(h),p=Ctt(h),f=s==="top"||s==="bottom",m=l.attribute.direction,v=!g&&!p&&f&&(n.length<2||n.some(_=>Math.abs(_.AABBBounds.width()-l.AABBBounds.width())>=2))&&l.AABBBounds.width()>Math.abs(e/c);n.forEach(_=>{var b;if(f&&(p&&Math.floor(_.AABBBounds.height())<=e||g&&Math.floor(_.AABBBounds.width())<=i)||!f&&(m==="vertical"&&Math.floor(_.AABBBounds.height())<=i||m!=="vertical"&&(g&&Math.floor(_.AABBBounds.width())<=e||p&&Math.floor(_.AABBBounds.height())<=i)))return;let y=null;if(g||p)y=f?g?i:e:m==="vertical"||p?i:e;else if(f){const{x1:C,x2:S}=_.AABBBounds,w=c/u,x=Math.abs(e/c);if(v&&w>0&&C<=o+a.right&&e/w+C>o+a.right){const A=(o-C+a.right)/Math.abs(u);y=Math.min(A,x)}else if(v&&w<0&&S>=-a.left&&e/w+S<-a.left){const A=(S+a.left)/Math.abs(u);y=Math.min(A,x)}else y=x}else y=Math.abs(e/u);et(_.attribute.maxLineWidth)&&(y=et(y)?Math.min(_.attribute.maxLineWidth,y):_.attribute.maxLineWidth),_.setAttributes({maxLineWidth:y,ellipsis:(b=_.attribute.ellipsis)!==null&&b!==void 0?b:r})})}function qFt(n,t){const{limitLength:e,axisLength:i,ellipsis:r="...",orient:s}=t;if(xt(n)||!et(e))return;const o=n[0].attribute.angle,a=vF(o),l=Ctt(o),h=s==="top"||s==="bottom";let d=i/n.length;n.forEach((u,c)=>{var g,p,f,m,v;if(h){if(l&&Math.floor(u.AABBBounds.height())<=e)return;if(a){const y=z6(u.attribute.x,(g=n[c+1])===null||g===void 0?void 0:g.attribute.x,(p=n[c-1])===null||p===void 0?void 0:p.attribute.x);et(y)&&(d=we(d,y))}}else{if(l){const y=z6(u.attribute.y,(f=n[c+1])===null||f===void 0?void 0:f.attribute.y,(m=n[c-1])===null||m===void 0?void 0:m.attribute.y);et(y)&&(d=we(d,y))}if(a&&Math.floor(u.AABBBounds.width())<=e)return}let _=null,b=null;h?l?(_=e,b=d):(_=d,b=e):l?(_=d,b=e):(_=e,b=d),u.setAttributes({maxLineWidth:_,ellipsis:(v=u.attribute.ellipsis)!==null&&v!==void 0?v:r,whiteSpace:"normal",heightLimit:b})})}function z6(n,t,e){let i;return et(t)&&(i=Math.abs(t-n)),et(e)&&(i=et(i)?Math.min(Math.abs(n-e),i):Math.abs(n-e)),i}function ZFt(n,t,e,i,r){i==="left"||i==="right"?r==="left"?n.forEach(s=>{var o;s.setAttributes({dx:((o=s.attribute.dx)!==null&&o!==void 0?o:0)+t-s.AABBBounds.x1})}):r==="right"?n.forEach(s=>{var o;s.setAttributes({dx:((o=s.attribute.dx)!==null&&o!==void 0?o:0)+t+e-s.AABBBounds.x2})}):r==="center"&&n.forEach(s=>{var o;s.setAttributes({dx:((o=s.attribute.dx)!==null&&o!==void 0?o:0)+t+e/2-(s.AABBBounds.x1+s.AABBBounds.x2)/2})}):i!=="bottom"&&i!=="top"||(r==="top"?n.forEach(s=>{var o;s.setAttributes({dy:((o=s.attribute.dy)!==null&&o!==void 0?o:0)+t-s.AABBBounds.y1})}):r==="bottom"?n.forEach(s=>{var o;s.setAttributes({dy:((o=s.attribute.dy)!==null&&o!==void 0?o:0)+t+e-s.AABBBounds.y2})}):r==="middle"&&n.forEach(s=>{var o;s.setAttributes({dy:((o=s.attribute.dy)!==null&&o!==void 0?o:0)+t+e/2-(s.AABBBounds.y1+s.AABBBounds.y2)/2})}))}class Ptt{isInValidValue(t){return t<0||t>1}getTickCoord(t){const{start:e}=this.attribute,i=this.getRelativeVector();return{x:e.x+i[0]*t,y:e.y+i[1]*t}}getRelativeVector(t){const{start:e,end:i}=this.attribute;return[i.x-e.x,i.y-e.y]}getVerticalVector(t,e=!1,i){const{verticalFactor:r=1}=this.attribute,s=this.getRelativeVector(),o=pFt(s),a=[o[1],-1*o[0]];return utt(a,t*(e?1:-1)*r)}}function Ett(){Xi(),ph(),Xd(),al()}function JFt(){Ett(),fh()}function QFt(){Ett(),QDt()}function tHt(){Xi(),_b()}function eHt(){Xi(),_b()}var W6=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};JFt();class g0 extends Ttt{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},g0.defaultAttributes,t),e)}_renderInner(t){var e;if(this._breaks=null,this.attribute.breaks&&this.attribute.breaks.length){const r=[];for(let s=0;s<this.attribute.breaks.length;s++){const o=this.attribute.breaks[s],{range:a,breakSymbol:l,rawRange:h}=o;r.push({startPoint:this.getTickCoord(a[0]),endPoint:this.getTickCoord(a[1]),range:a,breakSymbol:l,rawRange:h})}this._breaks=r}super._renderInner(t),this._breaks&&this._breaks.length&&this._breaks.forEach((r,s)=>{const{startPoint:o,endPoint:a,breakSymbol:l,rawRange:h}=r;if((l==null?void 0:l.visible)!==!1){const d=Pt.group({zIndex:LFt});d.name=_n.axisBreak,d.id=this._getNodeId(`${_n.axisBreak}-${s}`),d.data=h;const u=HFt(l),c=Pt.symbol(Object.assign({x:o.x,y:o.y},u));c.name=_n.axisBreakSymbol;const g=Pt.symbol(Object.assign({x:a.x,y:a.y},u));g.name=_n.axisBreakSymbol,d.add(c),d.add(g),t.add(d)}});const{panel:i}=this.attribute;if(i&&i.visible){const r=this.axisContainer,s=r.AABBBounds,o=Pt.rect(Object.assign({x:s.x1,y:s.y1,width:s.width(),height:s.height()},i.style));o.name=_n.background,o.id=this._getNodeId("background"),o.states=Z({},Pa,(e=i.state)!==null&&e!==void 0?e:{}),r.insertBefore(o,r.firstChild)}}renderLine(t){const{start:e,end:i,line:r}=this.attribute,s=r,{startSymbol:o,endSymbol:a,style:l,state:h}=s,d=W6(s,["startSymbol","endSymbol","style","state"]),u=Object.assign({startSymbol:o,endSymbol:a,lineStyle:l},d);if(this._breaks&&this._breaks.length){const g=[];let p=e;this._breaks.forEach(f=>{const{startPoint:m,endPoint:v}=f;g.push([p,m]),p=v}),g.push([p,i]),u.points=g,u.multiSegment=!0}else u.points=[e,i];xt(h)||(u.state={line:Z({},Pa,h),symbol:Z({},Pa,h)});const c=new nh(u);c.name=_n.line,c.id=this._getNodeId("line"),t.add(c)}getTextAlign(t){let e="center";return di(t[0],0)?di(t[1],0)?Object.is(t[1],-0)?e="start":Object.is(t[0],-0)&&(e="end"):e="center":t[0]>0?e="start":t[0]<0&&(e="end"),e}getTitleAttribute(){var t,e,i;const r=this.attribute.title,{position:s="middle",space:o=4,textStyle:a={},autoRotate:l=!0,shape:h,background:d,state:u={},maxWidth:c}=r,g=W6(r,["position","space","textStyle","autoRotate","shape","background","state","maxWidth"]);let p=.5;s==="start"?p=0:s==="end"&&(p=1);const{verticalFactor:f=1}=this.attribute,m=-1*f,v=this.getTickCoord(p),_=this.getRelativeVector();let b=0;if(!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1){const B=+Dt(this.attribute,"label.space",4);b+=B;const E=Object.keys(this.axisLabelLayerSize).length;if(_[1]===0){const k=this.axisLabelsContainer?this.axisLabelsContainer.AABBBounds.height():0;isFinite(k)?b+=k+(E-1)*B:b=0}else if(_[0]===0)if(this.axisLabelsContainer&&this.axisLabelsContainer.AABBBounds&&!this.axisLabelsContainer.AABBBounds.empty()){const k=this.axisLabelLayerSize[0].labelPos,P=this.axisLabelsContainer.AABBBounds;b+=(m===1?P.x2>k?Math.min(P.x2-k,P.width()):0:P.x1<k?Math.min(k-P.x1,P.width()):0)+(E-1)*B}else b=0;else Object.keys(this.axisLabelLayerSize).forEach((k,P)=>{b+=this.axisLabelLayerSize[k].width+(P>0?B:0)})}let y=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(y=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(y=Math.max(y,this.attribute.subTick.length||2));const C=y+b+o,S=this.getVerticalCoord(v,C,!1),w=this.getVerticalVector(C,!1,{x:0,y:0});let x,A,{angle:M}=g;if(x=s==="start"?"start":s==="end"?"end":"center",D(M)&&l){M=mFt(_,[1,0],!0);const{verticalFactor:B=1}=this.attribute;A=-1*B===1?"bottom":"top"}else x=this.getTextAlign(w),A=this.getTextBaseline(w,!1);let T=c;if(D(T)){const{verticalLimitSize:B,verticalMinSize:E,orient:k}=this.attribute,P=Math.min(B||1/0,E||1/0);if(et(P))if(k==="bottom"||k==="top")if(M!==Math.PI/2){const I=Math.abs(Math.cos(M??0));T=I<1e-6?1/0:this.attribute.end.x/I}else T=P-C;else if(M&&M!==0){const I=Math.abs(Math.sin(M));T=I<1e-6?1/0:this.attribute.end.y/I}else T=P-C}const R=Object.assign(Object.assign(Object.assign({},S),g),{maxWidth:T,textStyle:Object.assign({textAlign:x,textBaseline:A},a),state:{text:Z({},Pa,u.text),shape:Z({},Pa,u.shape),panel:Z({},Pa,u.background)}});return R.angle=M,h&&h.visible&&(R.shape=Object.assign({visible:!0},h.style),h.space&&(R.space=h.space)),d&&d.visible&&(R.panel=Object.assign({visible:!0},d.style)),R}getTextBaseline(t,e){let i="middle";const{verticalFactor:r=1}=this.attribute,s=(e?1:-1)*r;return di(t[1],0)?i=!di(t[0],0)||Object.is(t[0],-0)||Object.is(t[1],-0)?"middle":s===1?"bottom":"top":t[1]>0?i="top":t[1]<0&&(i="bottom"),i}getLabelAlign(t,e,i){const r=this.attribute.orient;if(["top","bottom","right","left"].includes(r)||t[0]===0&&t[1]===0){if(r==="top"||r==="bottom")return Rtt(e?r==="bottom"?"top":"bottom":r,i);if(r==="left"||r==="right")return Btt(e?r==="left"?"right":"left":r,i)}return{textAlign:this.getTextAlign(t),textBaseline:this.getTextBaseline(t,e)}}beforeLabelsOverlap(t,e,i,r,s){var o,a,l,h;const{flush:d=!1}=this.attribute.label||{};if(d&&t.length){const{orient:u,start:c,end:g}=this.attribute,p=u==="bottom"||u==="top",f=t[0],m=de(t),v=p?f.attribute.x>m.attribute.x:f.attribute.y<m.attribute.y;if(p){const _=v?m:f,b=v?f:m,y=c.x,C=g.x,S=_.AABBBounds.x1,w=b.AABBBounds.x2;S<y&&(_.attribute.angle?_.setAttributes({dx:((o=_.attribute.dx)!==null&&o!==void 0?o:0)+y-S}):_.setAttributes({x:y,textAlign:"left"})),w>C&&(b.attribute.angle?b.setAttributes({dx:((a=b.attribute.dx)!==null&&a!==void 0?a:0)+C-w}):b.setAttributes({x:C,textAlign:"right"}))}else{const _=v?m:f,b=v?f:m,y=_.AABBBounds.y2,C=b.AABBBounds.y1,S=c.y,w=g.y;C<S&&(b.attribute.angle?b.setAttributes({dy:((l=b.attribute.dy)!==null&&l!==void 0?l:0)+S-C}):b.setAttributes({y:S,textBaseline:"top"})),y>w&&(_.attribute.angle?_.setAttributes({dy:((h=_.attribute.dy)!==null&&h!==void 0?h:0)+w-y}):_.setAttributes({y:w,textBaseline:"bottom"}))}}}handleLabelsOverlap(t,e,i,r,s){if(xt(t))return;const{verticalLimitSize:o,label:a,orient:l}=this.attribute,h=this._getAxisLabelLimitLength(o,s),{layoutFunc:d,autoRotate:u,autoRotateAngle:c,autoLimit:g,limitEllipsis:p,autoHide:f,autoHideMethod:m,autoHideSeparation:v,lastVisible:_,firstVisible:b,autoWrap:y,overflowLimitLength:C}=a;if(it(d))d(t,e,r,this);else{if(u)$Ft(t,{labelRotateAngle:c,orient:l});else if(y){const S=Math.abs(l==="left"||l==="right"?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x);qFt(t,{orient:l,limitLength:h,axisLength:S,ellipsis:p})}if(!y&&g&&et(h)&&h>0){const S=l==="left"||l==="right",w=Math.abs(S?this.attribute.start.y-this.attribute.end.y:this.attribute.start.x-this.attribute.end.x),x=S?w/t.length:f||u?1/0:w/t.length;KFt(t,{limitLength:h,verticalLimitLength:x,ellipsis:p,orient:l,axisLength:w,overflowLimitLength:C})}f&&ktt(t,{method:m,separation:v,lastVisible:_,firstVisible:b})}}afterLabelsOverlap(t,e,i,r,s){const{verticalLimitSize:o,orient:a}=this.attribute,l=a==="bottom"||a==="top",h=i.AABBBounds;let d=l?h.height():h.width();const{verticalMinSize:u}=this.attribute;if(et(u)&&(!et(o)||u<=o)){const c=this._getAxisLabelLimitLength(u,s);let g,p;d=Math.max(d,c),a==="left"?(g=h.x2-d,p=h.y1):a==="right"?(g=h.x1,p=h.y1):a==="top"?(g=h.x1,p=h.y2-d):a==="bottom"&&(g=h.x1,p=h.y1);const f=Pt.rect({x:g,y:p,width:l?h.width():d,height:l?d:h.height(),pickable:!1});f.name=_n.axisLabelBackground,f.id=this._getNodeId("axis-label-background"),i.insertBefore(f,i.firstChild)}if(L(this.attribute.label.containerAlign)){let c;a==="left"?c=h.x2-d:a==="right"?c=h.x1:a==="top"?c=h.y2-d:a==="bottom"&&(c=h.y1),ZFt(t,c,d,a,this.attribute.label.containerAlign)}}_getAxisLabelLimitLength(t,e){var i,r,s,o,a;const{label:l,title:h,line:d,tick:u}=this.attribute,c=(i=l.space)!==null&&i!==void 0?i:4;let g=t,p=0,f=0;const m=d&&d.visible?(r=d.style.lineWidth)!==null&&r!==void 0?r:1:0,v=u&&u.visible?(s=u.length)!==null&&s!==void 0?s:4:0;if(h&&h.visible&&typeof h.text=="string"){p=nT(h.text,h.textStyle,(a=(o=this.stage)===null||o===void 0?void 0:o.getTheme())===null||a===void 0?void 0:a.text).height;const _=Fi(h.padding);f=h.space+_[0]+_[2]}return g&&(g=(g-c-f-p-m-v)/e),g}release(){super.release(),this._breaks=null}}g0.defaultAttributes=Fw,Ye(g0,Ptt);class Ltt{isInValidValue(t){const{startAngle:e=_f,endAngle:i=bf}=this.attribute;return Math.abs(i-e)%(2*Math.PI)==0?t>1:t<0||t>1}getTickCoord(t){const{startAngle:e=_f,endAngle:i=bf,center:r,radius:s,inside:o=!1,innerRadius:a=0}=this.attribute;return ui(r,o&&a>0?a:s,e+(i-e)*t)}getVerticalVector(t,e=!1,i){return aI(t,i,this.attribute.center,e,this.attribute.inside)}getRelativeVector(t){const{center:e}=this.attribute;return[t.y-e.y,-1*(t.x-e.x)]}}function Itt(n,t){const e=n.length;return{prevLabel:t>=1?n[t-1]:n[e-1],nextLabel:t<e-1?n[t+1]:n[0]}}function wm(n,t,e){var i;n.setAttributes({maxLineWidth:t,ellipsis:(i=n.attribute.ellipsis)!==null&&i!==void 0?i:e})}function j6(n,t,e){const i=[];if(n.length>=3){const{prevLabel:o,nextLabel:a}=Itt(n,t);i.push(o,a)}else n.length===2&&i.push(n[t===0?1:0]);const r=n[t];let s=Math.min(Math.abs(r.attribute.y-e.y1),Math.abs(r.attribute.y-e.y2));i.forEach(o=>{s=Math.min(s,Math.abs(o.attribute.y-r.attribute.y))}),s>0&&r.setAttributes({whiteSpace:"normal",heightLimit:s})}function iHt(n,t){const{ellipsis:e,inside:i,bounds:r,autoWrap:s,center:o}=t;i||n.forEach((a,l)=>{const{x:h,y:d}=a.attribute,u=a.AABBBounds;if(di(h,o.x)){if(d>r.y2||d<r.y1)return void wm(a,0,e);const c=r.x2-r.x1;if(n.length>=3){const{prevLabel:g,nextLabel:p}=Itt(n,l);let f=g.attribute.x,m=p.attribute.x;f>m&&(f=p.attribute.x,m=g.attribute.x);const v=f===m?c:h>=f&&h<=m?m-f:Math.min(Math.abs(f-h),Math.abs(m-h));a.AABBBounds.width()>v&&wm(a,v,e)}else a.AABBBounds.width()>c&&wm(a,c,e)}else h>o.x&&u.x2>r.x2?(wm(a,r.x2-h,e),s&&j6(n,l,r)):h<o.x&&u.x1<r.x1&&(wm(a,h-r.x1,e),s&&j6(n,l,r))})}var nHt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};QFt();class p0 extends Ttt{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},p0.defaultAttributes,t))}renderLine(t){const{startAngle:e=_f,endAngle:i=bf,radius:r,center:s,innerRadius:o=0,line:a={},inside:l=!1,sides:h}=this.attribute;let d,u=r,c=o;if(l&&o>0&&(u=o,c=0),et(h)&&h>=3){const g=xtt(s,h,u,e,i);d=Pt.path(Object.assign(Object.assign({},a.style),{path:Wu(g,!0)}))}else{const g=Object.assign(Object.assign(Object.assign({},s),{startAngle:e,endAngle:i,radius:u,innerRadius:c}),a.style);d=Pt.circle(g)}d.name=_n.line,d.id=this._getNodeId("line"),xt(a.state)||(d.states=Z({},Pa,a.state)),t.add(d)}getTitleAttribute(){var t,e,i;const{center:r,radius:s,innerRadius:o=0}=this.attribute,a=this.attribute.title,{space:l=4,textStyle:h={},shape:d,background:u,state:c={}}=a,g=nHt(a,["space","textStyle","shape","background","state"]);let p=r,f=0;!((t=this.attribute.label)===null||t===void 0)&&t.visible&&this.attribute.label.inside===!1&&(f=Dt(this.attribute.label,"style.fontSize",12)+Dt(this.attribute.label,"space",4));let m=0;!((e=this.attribute.tick)===null||e===void 0)&&e.visible&&this.attribute.tick.inside===!1&&(m=this.attribute.tick.length||4),!((i=this.attribute.subTick)===null||i===void 0)&&i.visible&&this.attribute.subTick.inside===!1&&(m=Math.max(m,this.attribute.subTick.length||2));const v=s+m+f+l;let _="middle",{position:b}=this.attribute.title;D(b)&&(b=o===0?"end":"middle"),b==="start"?(_="bottom",p={x:r.x,y:r.y-v}):b==="end"&&(_="top",p={x:r.x,y:r.y+v});const y=Object.assign(Object.assign(Object.assign({},p),g),{textStyle:Object.assign({textBaseline:_,textAlign:"center"},h),state:{text:Z({},Pa,c.text),shape:Z({},Pa,c.shape),panel:Z({},Pa,c.background)}}),{angle:C}=g;return y.angle=C,d&&d.visible&&(y.shape=Object.assign({visible:!0},d.style),d.space&&(y.space=d.space)),u&&u.visible&&(y.panel=Object.assign({visible:!0},u.style)),y}getSubTickLineItems(){var t,e;const{subTick:i}=this.attribute,r=[],{count:s=4,inside:o=!1,length:a=2}=i,l=this.tickLineItems,h=l.length;if(h>=2){const d=this.data[1].value-this.data[0].value,u=(e=(t=this.attribute)===null||t===void 0?void 0:t.tick)===null||e===void 0?void 0:e.alignWithLabel;for(let c=0;c<h;c++){const g=l[c],p=l[c+1];for(let f=0;f<s;f++){const m=(f+1)/(s+1),v=(1-m)*g.value+m*(p?p.value:u?1:g.value+d),_=this.getTickCoord(v),b=this.getVerticalCoord(_,a,o);r.push({start:_,end:b,value:v})}}}return r}beforeLabelsOverlap(t,e,i,r,s){}handleLabelsOverlap(t,e,i,r,s){if(xt(t))return;const{inside:o,radius:a,center:l,size:h,label:d,orient:u}=this.attribute,c=h?{x1:0,y1:0,x2:h.width,y2:h.height}:{x1:l.x-a,y1:l.y-a,x2:l.x+a,y2:l.y+a},{layoutFunc:g,autoLimit:p,limitEllipsis:f,autoHide:m,autoHideMethod:v,autoHideSeparation:_,autoWrap:b}=d;it(g)?g(t,e,r,this):((p||b)&&iHt(t,{inside:o,autoWrap:b,bounds:c,ellipsis:f,center:l}),m&&ktt(t,{method:v,separation:_}))}afterLabelsOverlap(t,e,i,r,s){}getTextBaseline(t){return Math.abs(t[1]/t[0])<.3?"middle":t[1]<0?"bottom":t[1]>0?"top":"middle"}getLabelAlign(t,e,i){return di(t[0],0)?{textAlign:"center",textBaseline:t[1]>0?"top":"bottom"}:t[0]<0?{textAlign:"right",textBaseline:this.getTextBaseline(t)}:t[0]>0?{textAlign:"left",textBaseline:this.getTextBaseline(t)}:{textAlign:"center",textBaseline:"middle"}}getLabelPosition(t,e,i,r){return t}}p0.defaultAttributes=Fw,Ye(p0,Ltt);class rHt extends fs{constructor(){super(...arguments),this.mode=hf.NORMAL}onBind(){const t=this.target.getInnerView(),e=this.target.getPrevInnerView();e&&(this._newElementAttrMap={},qo(t,i=>{var r,s,o,a,l,h;if(i.type!=="group"&&i.id){const d=e[i.id];if(d){if(!Oe(i.attribute,d.attribute)){const u=Pn(i.attribute);this._newElementAttrMap[i.id]={state:"update",node:i,attrs:Object.assign(Object.assign({},u),{opacity:(r=u.opacity)!==null&&r!==void 0?r:1,fillOpacity:(s=u.fillOpacity)!==null&&s!==void 0?s:1,strokeOpacity:(o=u.strokeOpacity)!==null&&o!==void 0?o:1})},i.setAttributes(d.attribute)}}else{const u={opacity:(a=i.attribute.opacity)!==null&&a!==void 0?a:1,fillOpacity:(l=i.attribute.fillOpacity)!==null&&l!==void 0?l:1,strokeOpacity:(h=i.attribute.strokeOpacity)!==null&&h!==void 0?h:1};this._newElementAttrMap[i.id]={state:"enter",node:i,attrs:u},i.setAttributes({opacity:0,fillOpacity:0,strokeOpacity:0})}}}))}onStart(){let t=this.duration,e=this.easing;this._newElementAttrMap&&Object.keys(this._newElementAttrMap).forEach(i=>{var r;const{node:s,attrs:o,state:a}=this._newElementAttrMap[i];if(a==="enter"){const{enter:l={}}=(r=this.params)!==null&&r!==void 0?r:{};t=et(l.duration)?l.duration:t,e=l.easing?l.easing:e}s.type==="path"?s.animate({interpolate:(l,h,d,u,c)=>l==="path"&&(c.path=plt(d,u)(h),!0)}).to(o,t,e):s.animate().to(o,t,e)})}onUpdate(t,e,i){}}const Yl=n=>n.map((t,e)=>({index:e,value:t})),N6=(n,t,e=0)=>{const i=new ie(n).expand(e/2),r=new ie(t).expand(e/2);return i.intersects(r)},$6=12,Jy=(n,t,e,i)=>e<n?Math.max(n-t/2,e):e>n?Math.min(n-t/2,e-t):e<i?e:e-t,hI=(n,t,e)=>{var i;const{labelStyle:r,axisOrientType:s,labelFlush:o,labelFormatter:a,startAngle:l=0}=e;let h=(i=r.angle)!==null&&i!==void 0?i:0;r.direction==="vertical"&&(h+=Te(90));const d=["bottom","top"].includes(s),u=["left","right"].includes(s);let c=1,g=0;d||(u?(c=0,g=1):l&&(c=Math.cos(l),g=-Math.sin(l)));const p=Wp(r),f=n.range();return t.map((v,_)=>{var b,y;const C=a?a(v):`${v}`,{width:S,height:w}=p.quickMeasure(C),x=Math.max(S,12),A=Math.max(w,12),M=n.scale(v),T=c*M,R=g*M;let B,E,k=T,P=R;o&&d&&_===0?k=Jy(T,x,f[0],f[f.length-1]):o&&d&&_===t.length-1?k=Jy(T,x,f[f.length-1],f[0]):B=(b=r.textAlign)!==null&&b!==void 0?b:"center",B==="right"?k-=x:B==="center"&&(k-=x/2),o&&u&&_===0?P=Jy(R,A,f[0],f[f.length-1]):o&&u&&_===t.length-1?P=Jy(R,A,f[f.length-1],f[0]):E=(y=r.textBaseline)!==null&&y!==void 0?y:"middle",E==="bottom"?P-=A:E==="middle"&&(P-=A/2);const I=new ie().set(k,P,k+x,P+A);return h&&I.rotate(h,T,R),I})},sHt=n=>["bottom","top","z"].includes(n);var Ui;(function(n){n.Identity="identity",n.Linear="linear",n.Log="log",n.Pow="pow",n.Sqrt="sqrt",n.Symlog="symlog",n.Time="time",n.Quantile="quantile",n.Quantize="quantize",n.Threshold="threshold",n.Ordinal="ordinal",n.Point="point",n.Band="band"})(Ui||(Ui={}));const Ott={};Object.values(Ui).forEach(n=>{Ott[n]=!0});function Je(n){switch(n){case Ui.Linear:case Ui.Log:case Ui.Pow:case Ui.Sqrt:case Ui.Symlog:case Ui.Time:return!0;default:return!1}}function dI(n){return!!Ott[n]}function xr(n){switch(n){case Ui.Ordinal:case Ui.Point:case Ui.Band:return!0;default:return!1}}function Bg(n){return n}const oHt=n=>n<0?-Math.sqrt(-n):Math.sqrt(n),aHt=n=>n<0?-n*n:n*n,lHt=n=>-Math.log(-n),hHt=n=>-Math.exp(-n),dHt=n=>isFinite(n)?Math.pow(10,n):n<0?0:n,V6=n=>n===10?dHt:n===Math.E?Math.exp:t=>Math.pow(n,t),G6=n=>n===Math.E?Math.log:n===10?Math.log10:n===2?Math.log2:(n=Math.log(n),t=>Math.log(t)/n),U6=n=>t=>Math.sign(t)*Math.log1p(Math.abs(t/n)),Y6=n=>t=>Math.sign(t)*Math.expm1(Math.abs(t))*n;function uI(n,t){if(n=Number(n),t=Number(t),t-=n)return i=>(i-n)/t;const e=Number.isNaN(t)?NaN:.5;return()=>e}function X6(n,t,e){const i=n[0],r=n[1],s=t[0],o=t[1];let a,l;return r<i?(a=uI(r,i),l=e(o,s)):(a=uI(i,r),l=e(s,o)),h=>l(a(h))}function bF(n,t,e){let i;return i=n===1?n+2*e:n-t+2*e,n?i>0?i:1:0}function cI(n,t,e,i){return e===1&&(e=0),bF(n,e,i)*(t/(1-e))}function uHt(n,t,e,i,r){const s=bF(n,e,i);let o=t/Math.max(1,s||1);r&&(o=Math.floor(o));let a=o*(1-e);return r&&(a=Math.round(a)),a}function Dtt(n,t){const e=(n[1]-n[0])/(t[1]-t[0]),i=n[0]-e*t[0];return[i,e+i]}function cHt(n,t,e){const i=Math.min(n.length,t.length)-1,r=new Array(i),s=new Array(i);let o=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=uI(n[o],n[o+1]),s[o]=e(t[o],t[o+1]);return function(a){const l=yO(n,a,1,i)-1;return s[l](r[l](a))}}const gHt=(n,t)=>{const e=n.slice();let i=0,r=e.length-1,s=e[i],o=e[r];return o<s&&([i,r]=[r,i],[s,o]=[o,s]),e[i]=t.floor(s),e[r]=t.ceil(o),e},Ftt=(n,t=!1)=>{const e=Math.floor(Math.log10(n)),i=n/Math.pow(10,e);let r;return r=t?i<1.5?1:i<3?2:i<7?5:10:i<=1?1:i<=2?2:i<=5?5:10,r*Math.pow(10,e)},pHt=(n,t)=>{let e,i;return t[0]<t[1]?(e=t[0],i=t[1]):(e=t[1],i=t[0]),Math.min(Math.max(n,e),i)};class Htt{constructor(){this._rangeFactorStart=null,this._rangeFactorEnd=null}_calculateWholeRange(t){return this._wholeRange?this._wholeRange:L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&t.length===2?(this._wholeRange=Dtt(t,[this._rangeFactorStart,this._rangeFactorEnd]),this._wholeRange):t}rangeFactor(t,e,i){return t?(t.length===2&&t.every(r=>r>=0&&r<=1)&&(this._wholeRange=null,t[0]===0&&t[1]===1?(this._rangeFactorStart=null,this._rangeFactorEnd=null):(this._rangeFactorStart=t[0],this._rangeFactorEnd=t[1])),this):i?(this._wholeRange=null,this._rangeFactorStart=null,this._rangeFactorEnd=null,this):L(this._rangeFactorStart)&&L(this._rangeFactorEnd)?[this._rangeFactorStart,this._rangeFactorEnd]:null}rangeFactorStart(t,e){var i;return D(t)?this._rangeFactorStart:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!D(this._rangeFactorEnd)&&this._rangeFactorEnd!==1?(this._rangeFactorStart=t,this._rangeFactorEnd=(i=this._rangeFactorEnd)!==null&&i!==void 0?i:1):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}rangeFactorEnd(t,e){var i;return D(t)?this._rangeFactorEnd:(t>=0&&t<=1&&(this._wholeRange=null,t!==0||!D(this._rangeFactorStart)&&this._rangeFactorStart!==0?(this._rangeFactorEnd=t,this._rangeFactorStart=(i=this._rangeFactorStart)!==null&&i!==void 0?i:0):(this._rangeFactorStart=null,this._rangeFactorEnd=null)),this)}generateFishEyeTransform(){var t;if(!this._fishEyeOptions)return void(this._fishEyeTransform=null);const{distortion:e=2,radiusRatio:i=.1,radius:r}=this._fishEyeOptions,s=this.range(),o=s[0],a=s[s.length-1],l=Math.min(o,a),h=Math.max(o,a),d=Ne((t=this._fishEyeOptions.focus)!==null&&t!==void 0?t:0,l,h),u=D(r)?(h-l)*i:r;let c=Math.exp(e);c=c/(c-1)*u;const g=e/u;this._fishEyeTransform=p=>{const f=Math.abs(p-d);if(f>=u)return p;if(f<=1e-6)return d;const m=c*(1-Math.exp(-f*g))/f*.75+.25;return d+(p-d)*m}}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}get(t,e){var i;return(i=this==null?void 0:this[t])!==null&&i!==void 0?i:e}}const gI=Symbol("implicit");class Mc extends Htt{specified(t){var e;return t?(this._specified=Object.assign((e=this._specified)!==null&&e!==void 0?e:{},t),this):Object.assign({},this._specified)}_getSpecifiedValue(t){if(this._specified)return this._specified[t]}constructor(){super(),this.type=Ui.Ordinal,this._index=new Map,this._domain=[],this._ordinalRange=[],this._unknown=gI}clone(){const t=new Mc().domain(this._domain).range(this._ordinalRange).unknown(this._unknown);return this._specified&&t.specified(this._specified),t}calculateVisibleDomain(t){return L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:this._domain}scale(t){const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==gI)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const s=this._ordinalRange[(r-1)%this._ordinalRange.length];return this._fishEyeTransform?this._fishEyeTransform(s):s}invert(t){let e=0;for(;e<this._ordinalRange.length&&this._ordinalRange[e]!==t;)e++;return this._domain[(e-1)%this._domain.length]}domain(t){if(!t)return this._domain.slice();this._domain=[],this._index=new Map;for(const e of t){const i=`${e}`;this._index.has(i)||this._index.set(i,this._domain.push(e))}return this}range(t){if(!t)return this._ordinalRange.slice();const e=Array.from(t);return this._ordinalRange=e,this}index(t){var e;return this._index&&(e=this._index.get(`${t}`))!==null&&e!==void 0?e:-1}}function ztt(n,t,e,i){const r=[];let s=n;for(;s<=t;)r.push(s),s+=e;return i&&r.reverse(),r}function K6(n,t,e,i){let r,s;if(t=Math.floor(+t),n=Math.floor(+n),!(e=Math.floor(+e)))return[];if(n===t)return[n];if(r=t<n){const a=n;n=t,t=a}let o=gc(1,t-n+1)(e);if(s=Math.floor((t-n+1)/o),!i)for(;Math.ceil((t-n+1)/s)>e&&o>1;)o-=1,s=Math.floor((t-n)/o);return ztt(n,t,s,r)}function fHt(n,t,e){let i;if(t=Math.floor(+t),n=Math.floor(+n),e=gc(1,t-n+1)(Math.floor(+e)),i=t<n){const r=n;n=t,t=r}return ztt(n,t,e,i)}class qc extends Mc{constructor(t){super(),this.type=Ui.Band,this._range=[0,1],this._step=void 0,this._bandwidth=void 0,this._isFixed=!1,this._round=!1,this._paddingInner=0,this._paddingOuter=0,this._align=.5,this._unknown=void 0,delete this.unknown,this.rescale(t)}rescale(t,e){if(t)return this;this._wholeRange=null;const i=this._calculateWholeRange(this._range,e),r=super.domain().length,s=i[1]<i[0];let o=i[Number(s)-0];const a=i[1-Number(s)],l=bF(r,this._paddingInner,this._paddingOuter);return this._step=(a-o)/Math.max(1,l||1),this._round&&(this._step=Math.floor(this._step)),o+=(a-o-this._step*(r-this._paddingInner))*this._align,this.isBandwidthFixed()||(this._bandwidth=this._step*(1-this._paddingInner)),this._round&&(o=Math.round(o),this.isBandwidthFixed()||(this._bandwidth=Math.round(this._bandwidth))),this._bandRangeState={reverse:s,start:s?o+this._step*(r-1):o,count:r},this.generateFishEyeTransform(),this}scale(t){if(!this._bandRangeState)return;const e=`${t}`,i=this._getSpecifiedValue(e);if(i!==void 0)return i;let r=this._index.get(e);if(!r){if(this._unknown!==gI)return this._unknown;r=this._domain.push(t),this._index.set(e,r)}const{count:s,start:o,reverse:a}=this._bandRangeState,l=o+(a?-1:1)*((r-1)%s)*this._step;return this._fishEyeTransform?this._fishEyeTransform(l):l}_calculateWholeRange(t,e){if(this._wholeRange)return this._wholeRange;if((this._minBandwidth||this._maxBandwidth)&&!this._isBandwidthFixedByUser()){let i;if(L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&t.length===2){const s=Dtt(t,[this._rangeFactorStart,this._rangeFactorEnd]);i=Math.abs(s[1]-s[0])}else i=Math.abs(t[1]-t[0]);const r=uHt(super.domain().length,i,this._paddingInner,this._paddingOuter,this._round);r<this._minBandwidth?(this._bandwidth=this._minBandwidth,this._isFixed=!0):r>this._maxBandwidth?(this._bandwidth=this._maxBandwidth,this._isFixed=!0):(this._bandwidth=r,this._isFixed=!1)}if(this.isBandwidthFixed()){const i=cI(super.domain().length,this._bandwidth,this._paddingInner,this._paddingOuter)*Math.sign(t[1]-t[0]),r=Math.min((t[1]-t[0])/i,1);if(L(this._rangeFactorStart)&&L(this._rangeFactorEnd)){const s=this._rangeFactorStart+r<=1,o=this._rangeFactorEnd-r>=0;if(e==="rangeFactorStart"&&s?this._rangeFactorEnd=this._rangeFactorStart+r:e==="rangeFactorEnd"&&o?this._rangeFactorStart=this._rangeFactorEnd-r:t[0]<=t[1]?s?this._rangeFactorEnd=this._rangeFactorStart+r:o?this._rangeFactorStart=this._rangeFactorEnd-r:(this._rangeFactorStart=0,this._rangeFactorEnd=r):o?this._rangeFactorStart=this._rangeFactorEnd-r:s?this._rangeFactorEnd=this._rangeFactorStart+r:(this._rangeFactorStart=1-r,this._rangeFactorEnd=1),i>0){const a=t[0]-i*this._rangeFactorStart,l=a+i;this._wholeRange=[a,l]}else{const a=t[1]+i*(1-this._rangeFactorEnd),l=a-i;this._wholeRange=[l,a]}}else this._rangeFactorStart=0,this._rangeFactorEnd=r,this._wholeRange=[t[0],t[0]+i];return this._wholeRange}return super._calculateWholeRange(t)}calculateWholeRangeSize(){const t=this._calculateWholeRange(this._range);return Math.abs(t[1]-t[0])}calculateVisibleDomain(t){const e=this._domain;if(L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&e.length){const i=this._getInvertIndex(t[0]),r=this._getInvertIndex(t[1]);return e.slice(Math.min(i,r),Math.max(i,r)+1)}return e}domain(t,e){return t?(super.domain(t),this.rescale(e)):super.domain()}range(t,e){return t?(this._range=[zl(t[0]),zl(t[1])],this.rescale(e)):this._range}rangeRound(t,e){return this._range=[zl(t[0]),zl(t[1])],this._round=!0,this.rescale(e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return t===-1?e:K6(0,e.length-1,t,!1).map(i=>e[i])}tickData(t=10){return this.ticks(t).map((e,i)=>({index:i,tick:e,value:(this.scale(e)-this._range[0]+this._bandwidth/2)/(this._range[1]-this._range[0])}))}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return K6(0,e.length-1,t,!0).filter(i=>i<e.length).map(i=>e[i])}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return fHt(0,e.length-1,t).map(i=>e[i])}_getInvertIndex(t){let e=0;const i=this.step()/2,r=this.bandwidth()/2,s=this._domain.length,o=this.range(),a=o[0]>o[o.length-1];for(e=0;e<s;e++){const l=this.scale(this._domain[e])+r;if(e===0&&(!a&&!Rl(t,l+i)||a&&!xa(t,l-i))||e===s-1||!xa(t,l-i)&&!Rl(t,l+i))break}return e>=0&&e<=s-1?e:s-1}invert(t){return this._domain[this._getInvertIndex(t)]}padding(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(Array.isArray(t)?Math.min.apply(null,t):t)),this._paddingInner=this._paddingOuter,this.rescale(e)):this._paddingInner}paddingInner(t,e){return t!==void 0?(this._paddingInner=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingInner}paddingOuter(t,e){return t!==void 0?(this._paddingOuter=Math.max(0,Math.min(1,t)),this.rescale(e)):this._paddingOuter}step(){return this._step}round(t,e){return t!==void 0?(this._round=t,this.rescale(e)):this._round}align(t,e){return t!==void 0?(this._align=Math.max(0,Math.min(1,t)),this.rescale(e)):this._align}rangeFactor(t,e){return t?(super.rangeFactor(t),this.rescale(e)):super.rangeFactor()}rangeFactorStart(t,e){return D(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this.rescale(e,"rangeFactorStart"))}rangeFactorEnd(t,e){return D(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this.rescale(e,"rangeFactorEnd"))}bandwidth(t,e){return t?(t==="auto"?(this._bandwidth=void 0,this._isFixed=!1):(this._bandwidth=t,this._isFixed=!0),this._userBandwidth=t,this.rescale(e)):this._bandwidth}maxBandwidth(t,e){return t?(this._maxBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._maxBandwidth}minBandwidth(t,e){return t?(this._minBandwidth=t==="auto"?void 0:t,this.rescale(e)):this._minBandwidth}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}isBandwidthFixed(){return this._isFixed&&!!this._bandwidth}_isBandwidthFixedByUser(){return this._isFixed&&this._userBandwidth&&J(this._userBandwidth)}clone(){var t,e,i;return new qc(!0).domain(this._domain,!0).range(this._range,!0).round(this._round,!0).paddingInner(this._paddingInner,!0).paddingOuter(this._paddingOuter,!0).align(this._align,!0).bandwidth((t=this._userBandwidth)!==null&&t!==void 0?t:"auto",!0).maxBandwidth((e=this._maxBandwidth)!==null&&e!==void 0?e:"auto",!0).minBandwidth((i=this._maxBandwidth)!==null&&i!==void 0?i:"auto")}}const{interpolateRgb:FB}=FY;function mHt(n,t){const e=typeof t;let i;if(D(t)||e==="boolean")return()=>t;if(e==="number")return Nl(n,t);if(e==="string"){if(i=Tn.parseColorString(t)){const r=FB(Tn.parseColorString(n),i);return s=>r(s).formatRgb()}return Nl(Number(n),Number(t))}return t instanceof Cr?FB(n,t):t instanceof Tn?FB(n.color,t.color):t instanceof Date?xY(n,t):Nl(Number(n),Number(t))}class Wtt extends Htt{constructor(t=Bg,e=Bg){super(),this._unknown=void 0,this.transformer=t,this.untransformer=e,this._forceAlign=!0,this._domain=[0,1],this._range=[0,1],this._clamp=Bg,this._piecewise=X6,this._interpolate=mHt}calculateVisibleDomain(t){var e;return L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&t.length===2?[this.invert(t[0]),this.invert(t[1])]:(e=this._niceDomain)!==null&&e!==void 0?e:this._domain}fishEye(t,e,i){return t||i?(this._fishEyeOptions=t,this._fishEyeTransform=null,this.rescale(e)):this._fishEyeOptions}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._clamp(t)));return this._fishEyeTransform?this._fishEyeTransform(i):i}invert(t){var e;return this._input||(this._input=this._piecewise(this._calculateWholeRange(this._range),((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this.transformer),Nl)),this._clamp(this.untransformer(this._input(t)))}domain(t,e){var i;if(!t)return((i=this._niceDomain)!==null&&i!==void 0?i:this._domain).slice();this._domainValidator=null,this._niceType=null,this._niceDomain=null;const r=Array.from(t,zl);return this._domain=r,this.rescale(e)}range(t,e){if(!t)return this._range.slice();const i=Array.from(t);return this._range=i,this.rescale(e)}rangeRound(t,e){const i=Array.from(t);return this._range=i,this._interpolate=SY,this.rescale(e)}rescale(t){var e;if(t)return this;const i=(e=this._niceDomain)!==null&&e!==void 0?e:this._domain,r=i.length,s=this._range.length;let o=Math.min(r,s);if(r&&r<s&&this._forceAlign){const a=s-r+1,l=i[r-1],h=r>=2?(l-i[r-2])/a:0;for(let d=1;d<=a;d++)i[r-2+d]=l-h*(a-d);o=s}return this._autoClamp&&(this._clamp=gc(i[0],i[o-1])),this._piecewise=o>2?cHt:X6,this._output=this._input=null,this._wholeRange=null,this.generateFishEyeTransform(),this}clamp(t,e,i){return arguments.length?(e?(this._autoClamp=!1,this._clamp=e):(this._autoClamp=!!t,this._clamp=t?void 0:Bg),this.rescale(i)):this._clamp!==Bg}interpolate(t,e){return arguments.length?(this._interpolate=t,this.rescale(e)):this._interpolate}ticks(t=10){return[]}tickData(t=10){const e=this.ticks(t);return(e??[]).map((i,r)=>({index:r,tick:i,value:(this.scale(i)-this._range[0])/(this._range[1]-this._range[0])}))}rangeFactor(t,e){return t?(super.rangeFactor(t),this._output=this._input=null,this):super.rangeFactor()}rangeFactorStart(t,e){return D(t)?super.rangeFactorStart():(super.rangeFactorStart(t),this._output=this._input=null,this)}rangeFactorEnd(t,e){return D(t)?super.rangeFactorEnd():(super.rangeFactorEnd(t),this._output=this._input=null,this)}forceAlignDomainRange(t){return arguments.length?(this._forceAlign=t,this):this._forceAlign}}const vHt=Math.sqrt(50),_Ht=Math.sqrt(10),bHt=Math.sqrt(2),Qy=[1,2,5,10],q6=(n,t,e)=>{let i=1,r=n;const s=Math.floor((t-1)/2),o=Math.abs(n);return n>=0&&n<=Number.MIN_VALUE?r=0:n<0&&n>=-Number.MIN_VALUE?r=-(t-1):!e&&o<1?i=jtt(o).step:(e||o>1)&&(r=Math.floor(n)-s*i),i>0?(n>0?r=Math.max(r,0):n<0&&(r=Math.min(r,-(t-1)*i)),bO(0,t).map(a=>r+a*i)):n>0?Hw(0,-(t-1)/i,i):Hw((t-1)/i,0,i)},yHt=Gc((n,t,e,i)=>{let r,s,o,a,l=-1;if(e=+e,(n=+n)==(t=+t))return[n];if(Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return[n];if((r=t<n)&&(s=n,n=t,t=s),a=yF(n,t,e).step,!isFinite(a))return[];if(a>0){let h=Math.round(n/a),d=Math.round(t/a);for(h*a<n&&++h,d*a>t&&--d,o=new Array(s=d-h+1);++l<s;)o[l]=(h+l)*a}else if(a<0&&(i!=null&&i.noDecimals)){a=1;const h=Math.ceil(n),d=Math.floor(t);if(!(h<=d))return[];for(o=new Array(s=d-h+1);++l<s;)o[l]=h+l}else{a=-a;let h=Math.round(n*a),d=Math.round(t*a);for(h/a<n&&++h,d/a>t&&--d,o=new Array(s=d-h+1);++l<s;)o[l]=(h+l)/a}return r&&o.reverse(),o}),Hw=(n,t,e)=>{let i,r,s=-1;if(e>0){let o=Math.floor(n/e),a=Math.ceil(t/e);for((o+1)*e<n&&++o,(a-1)*e>t&&--a,r=new Array(i=a-o+1);++s<i;)r[s]=(o+s)*e}else{e=-e;let o=Math.floor(n*e),a=Math.ceil(t*e);for((o+1)/e<n&&++o,(a-1)/e>t&&--a,r=new Array(i=a-o+1);++s<i;)r[s]=(o+s)/e}return r},CHt=(n,t,e)=>{let i;const r=n[0],s=n[n.length-1],o=t-n.length;if(s<=0){const h=[];for(i=o;i>=1;i--)h.push(r-i*e);return h.concat(n)}if(r>=0){for(i=1;i<=o;i++)n.push(s+i*e);return n}let a=[];const l=[];for(i=1;i<=o;i++)i%2==0?a=[r-Math.floor(i/2)*e].concat(a):l.push(s+Math.ceil(i/2)*e);return a.concat(n).concat(l)},zw=Gc((n,t,e,i)=>{let r,s,o;if(e=+e,(n=+n)==(t=+t)||Math.abs(n-t)<=Number.MIN_VALUE&&e>0)return q6(n,e,i==null?void 0:i.noDecimals);(r=t<n)&&(o=n,n=t,t=o);const a=yF(n,t,e);let l=a.step;if(!isFinite(l))return[];if(l>0){let h=1;const{power:d,gap:u}=a,c=u===10?2*10**d:1*10**d;for(;h<=5&&(s=Hw(n,t,l),s.length>e+1)&&e>2;)l+=c,h+=1;e>2&&s.length<e-1&&(s=CHt(s,e,l))}else i!=null&&i.noDecimals&&l<0&&(l=1),s=Hw(n,t,l);return r&&s.reverse(),s}),jtt=n=>{const t=Math.floor(Math.log(n)/Math.LN10),e=n/10**t;let i=Qy[0];return e>=vHt?i=Qy[3]:e>=_Ht?i=Qy[2]:e>=bHt&&(i=Qy[1]),t>=0?{step:i*10**t,gap:i,power:t}:{step:-(10**-t)/i,gap:i,power:t}};function yF(n,t,e){const i=(t-n)/Math.max(0,e);return jtt(i)}function Ntt(n,t,e){let i;if(e=+e,(n=+n)==(t=+t)&&e>0)return[n];if(e<=0||(i=SHt(n,t,e))===0||!isFinite(i))return[];const r=new Array(e);for(let s=0;s<e;s++)r[s]=n+s*i;return r}function SHt(n,t,e){return(t-n)/Math.max(1,e-1)}function xHt(n,t,e){let i,r,s=-1;if(e=+e,(r=(t=+t)<(n=+n))&&(i=n,n=t,t=i),!isFinite(e)||t-n<=e)return[n];const o=Math.floor((t-n)/e+1),a=new Array(o);for(;++s<o;)a[s]=n+s*e;return r&&a.reverse(),a}function HB(n,t=10){let e,i,r=0,s=n.length-1,o=n[r],a=n[s],l=10;for(a<o&&(i=o,o=a,a=i,i=r,r=s,s=i);l-- >0;){if(i=yF(o,a,t).step,i===e)return n[r]=o,n[s]=a,n;if(i>0)o=Math.floor(o/i)*i,a=Math.ceil(a/i)*i;else{if(!(i<0))break;o=Math.ceil(o*i)/i,a=Math.floor(a*i)/i}e=i}}function $tt(n,t){const e=J(t.forceMin),i=J(t.forceMax);let r=null;const s=[];let o=null;const a=e&&i?l=>l>=t.forceMin&&l<=t.forceMax:e?l=>l>=t.forceMin:i?l=>l<=t.forceMax:null;return e?s[0]=t.forceMin:J(t.min)&&t.min<=Math.min(n[0],n[n.length-1])&&(s[0]=t.min),i?s[1]=t.forceMax:J(t.max)&&t.max>=Math.max(n[0],n[n.length-1])&&(s[1]=t.max),J(s[0])&&J(s[1])?(o=n.slice(),o[0]=s[0],o[o.length-1]=s[1]):r=J(s[0])||J(s[1])?J(s[0])?"max":"min":"all",{niceType:r,niceDomain:o,niceMinMax:s,domainValidator:a}}const zB=(n,t,e)=>Math.abs(t-n)<1?+e.toFixed(1):Math.round(+e),Vtt=Gc((n,t,e,i,r,s,o)=>{let a=n,l=t;const h=l<a;h&&([a,l]=[l,a]);let d,u,c=r(a),g=r(l),p=[];if(!(i%1)&&g-c<e){if(c=Math.floor(c),g=Math.ceil(g),a>0){for(;c<=g;++c)for(d=1;d<i;++d)if(u=c<0?d/s(-c):d*s(c),!(u<a)){if(u>l)break;p.push(u)}}else for(;c<=g;++c)for(d=i-1;d>=1;--d)if(u=c>0?d/s(-c):d*s(c),!(u<a)){if(u>l)break;p.push(u)}2*p.length<e&&(p=zw(a,l,e))}else p=zw(c,g,Math.min(g-c,e)).map(s);return p=p.filter(f=>f!==0),o!=null&&o.noDecimals&&(p=Array.from(new Set(p.map(f=>Math.floor(f))))),h?p.reverse():p}),Gtt=Gc((n,t,e,i,r,s)=>{const o=[],a={},l=r(n),h=r(t);let d=[];if(Number.isInteger(i))d=zw(l,h,e);else{const u=(h-l)/(e-1);for(let c=0;c<e;c++)d.push(l+c*u)}return d.forEach(u=>{const c=s(u),g=Number.isInteger(i)?zB(n,t,c):zB(n,t,Ftt(c)),p=zB(n,t,pHt(g,[n,t]));!a[p]&&!isNaN(p)&&d.length>1&&(a[p]=1,o.push(p))}),o}),Ww=Gc((n,t,e,i,r)=>Ntt(i(n),i(t),e).map(s=>Ftt(r(s))));class Vs extends Wtt{constructor(){super(...arguments),this.type=Ui.Linear}clone(){var t;const e=new Vs;return e.domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate),this._niceType&&(e._niceType=this._niceType,e._domainValidator=this._domainValidator,e._niceDomain=(t=this._niceDomain)===null||t===void 0?void 0:t.slice()),e}tickFormat(){return()=>{}}d3Ticks(t=10,e){const i=this.calculateVisibleDomain(this._range);return yHt(i[0],i[i.length-1],t,e)}ticks(t=10,e){var i;if(it(e==null?void 0:e.customTicks))return e.customTicks(this,t);if(L(this._rangeFactorStart)&&L(this._rangeFactorEnd)&&(this._rangeFactorStart>0||this._rangeFactorEnd<1)&&this._range.length===2||!this._niceType)return this.d3Ticks(t,e);const r=(i=this._niceDomain)!==null&&i!==void 0?i:this._domain,s=this._domain,o=r[0],a=r[r.length-1];let l=zw(s[0],s[s.length-1],t,e);if(!l.length)return l;if(this._domainValidator)l=l.filter(this._domainValidator);else if((l[0]!==o||l[l.length-1]!==a)&&this._niceType){const h=r.slice();if(this._niceType==="all"?(h[0]=l[0],h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()):this._niceType==="min"&&l[0]!==o?(h[0]=l[0],this._niceDomain=h,this.rescale()):this._niceType==="max"&&l[l.length-1]!==a&&(h[h.length-1]=l[l.length-1],this._niceDomain=h,this.rescale()),this._niceType!=="all"){const d=Math.min(h[0],h[h.length-1]),u=Math.max(h[0],h[h.length-1]);l=l.filter(c=>c>=d&&c<=u)}}return l}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Ntt(e[0],e[e.length-1],t)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return xHt(e[0],e[e.length-1],t)}nice(t=10,e){var i,r;const s=this._domain;let o=[];if(e){const a=$tt(s,e);if(o=a.niceMinMax,this._domainValidator=a.domainValidator,this._niceType=a.niceType,a.niceDomain)return this._niceDomain=a.niceDomain,this.rescale(),this}else this._niceType="all";if(this._niceType){const a=HB(s.slice(),t);this._niceType==="min"?a[a.length-1]=(i=o[1])!==null&&i!==void 0?i:a[a.length-1]:this._niceType==="max"&&(a[0]=(r=o[0])!==null&&r!==void 0?r:a[0]),this._niceDomain=a,this.rescale()}return this}niceMin(t=10){this._niceType="min";const e=this._domain[this._domain.length-1],i=HB(this.domain(),t);return i&&(i[i.length-1]=e,this._niceDomain=i,this.rescale()),this}niceMax(t=10){this._niceType="max";const e=this._domain[0],i=HB(this._domain.slice(),t);return i&&(i[0]=e,this._niceDomain=i,this.rescale()),this}}class Utt{nice(t=10,e){var i,r,s,o;const a=this._domain;let l=[],h=null;if(e){const d=$tt(a,e);if(l=d.niceMinMax,this._domainValidator=d.domainValidator,h=d.niceType,d.niceDomain)return this._niceDomain=d.niceDomain,this.rescale(),this}else h="all";if(h){const d=gHt(a.slice(),(r=(i=this.getNiceConfig)===null||i===void 0?void 0:i.call(this))!==null&&r!==void 0?r:{floor:u=>Math.floor(u),ceil:u=>Math.ceil(u)});return h==="min"?d[d.length-1]=(s=l[1])!==null&&s!==void 0?s:d[d.length-1]:h==="max"&&(d[0]=(o=l[0])!==null&&o!==void 0?o:d[0]),this._niceDomain=d,this.rescale(),this}return this}niceMin(){const t=this._domain[this._domain.length-1];this.nice();const e=this._domain.slice();return this._domain&&(e[e.length-1]=t,this._niceDomain=e,this.rescale()),this}niceMax(){const t=this._domain[0];this.nice();const e=this._domain.slice();return this._domain&&(e[0]=t,this._niceDomain=e,this.rescale()),this}}function Z6(n){return t=>-n(-t)}function J6(n=Number.EPSILON){return t=>Math.max(t,n)}function wHt(n=Number.EPSILON){return t=>Math.min(t,-n)}class dT extends Wtt{constructor(){super(G6(10),V6(10)),this.type=Ui.Log,this._limit=J6(),this._logs=this.transformer,this._pows=this.untransformer,this._domain=[1,10],this._base=10}clone(){return new dT().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).base(this._base)}rescale(t){var e;if(t)return this;super.rescale();const i=G6(this._base),r=V6(this._base);return((e=this._niceDomain)!==null&&e!==void 0?e:this._domain)[0]<0?(this._logs=Z6(i),this._pows=Z6(r),this._limit=wHt(),this.transformer=lHt,this.untransformer=hHt):(this._logs=i,this._pows=r,this._limit=J6(),this.transformer=this._logs,this.untransformer=r),this}scale(t){var e;if(t=Number(t),Number.isNaN(t)||this._domainValidator&&!this._domainValidator(t))return this._unknown;this._output||(this._output=this._piecewise(((e=this._niceDomain)!==null&&e!==void 0?e:this._domain).map(this._limit).map(this.transformer),this._calculateWholeRange(this._range),this._interpolate));const i=this._output(this.transformer(this._limit(this._clamp(t))));return this._fishEyeTransform?this._fishEyeTransform(i):i}base(t,e){return arguments.length?(this._base=t,this.rescale(e)):this._base}tickFormat(){return Bg}d3Ticks(t=10,e){const i=this.domain(),r=this._limit(i[0]),s=this._limit(i[i.length-1]);return Vtt(r,s,t,this._base,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return Gtt(this._limit(e[0]),this._limit(e[e.length-1]),t,this._base,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Ww(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Ww(this._limit(e[0]),this._limit(e[e.length-1]),t,this.transformer,this.untransformer)}getNiceConfig(){return{floor:t=>this._pows(Math.floor(this._logs(this._limit(t)))),ceil:t=>Math.abs(t)>=1?Math.ceil(t):this._pows(Math.ceil(this._logs(this._limit(t))))}}}Ye(dT,Utt);class AHt extends qc{constructor(t){super(!1),this.type=Ui.Point,this._padding=0,this.paddingInner(1,t),this.padding=this.paddingOuter,this.paddingInner=void 0,this.paddingOuter=void 0}}class jw extends Vs{constructor(){super(oHt,aHt),this.type=Ui.Sqrt}clone(){return new jw().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate)}}class uT extends Vs{constructor(){super(U6(1),Y6(1)),this.type=Ui.Symlog,this._const=1}clone(){return new uT().domain(this._domain,!0).range(this._range,!0).unknown(this._unknown).clamp(this.clamp(),null,!0).interpolate(this._interpolate,!0).constant(this._const)}constant(t,e){return arguments.length?(this._const=t,this.transformer=U6(t),this.untransformer=Y6(t),this.rescale(e)):this._const}d3Ticks(t=10,e){const i=this.domain(),r=i[0],s=i[i.length-1];return Vtt(r,s,t,this._const,this.transformer,this.untransformer,e)}ticks(t=10){const e=this.calculateVisibleDomain(this._range);return Gtt(e[0],e[e.length-1],t,this._const,this.transformer,this.untransformer)}forceTicks(t=10){const e=this.calculateVisibleDomain(this._range);return Ww(e[0],e[e.length-1],t,this.transformer,this.untransformer)}stepTicks(t){const e=this.calculateVisibleDomain(this._range);return Ww(e[0],e[e.length-1],t,this.transformer,this.untransformer)}}Ye(uT,Utt);class CF{constructor(){this.type=Ui.Threshold,this._range=[0,1],this._domain=[.5],this.n=1}unknown(t){return arguments.length?(this._unknown=t,this):this._unknown}scale(t){return!D(t)&&et(+t)?this._range[yO(this._domain,t,0,this.n)]:this._unknown}invertExtent(t){const e=this._range.indexOf(t);return[this._domain[e-1],this._domain[e]]}domain(t){return t?(this._domain=Array.from(t),this.n=Math.min(this._domain.length,this._range.length-1),this):this._domain.slice()}range(t){return t?(this._range=Array.from(t),this.n=Math.min(this._domain.length,this._range.length-1),this):this._range.slice()}clone(){return new CF().domain(this._domain).range(this._range).unknown(this._unknown)}}function WB(n,t,e,i){let r;const{breakData:s}=n;if(s&&s()){const{breakDomains:o}=s(),a=t.domain();r=[];for(let l=0;l<a.length-1;l++)i(e,[a[l],a[l+1]]).forEach(h=>{o.some(d=>h>=d[0]&&h<=d[1])||r.push(h)});t.domain(a)}else r=i(e);return r}function Q6(n,t,e,i,r=!1){if(e&&!t.includes(n)){let s=t.length;if(s>1){r?t.push(n):t.unshift(n);for(let o=0;o<s;o++){const a=r?s-1-o:o;if(!i(t[a]))break;t.splice(a,1),o--,s--}}}}const Cb=(n,t)=>{var e,i;if(!Je(n.type))return Yl(n.domain());const r=n.range(),s=Math.abs(r[r.length-1]-r[0]);if(s<2)return Yl([n.domain()[0]]);const{tickCount:o,forceTickCount:a,tickStep:l,noDecimals:h=!1,labelStyle:d,breakData:u}=t;let c;if(L(l))g=n.stepTicks(l),p=u&&u()?u().breakDomains:null,c=p&&p.length?g.filter(m=>p.every(v=>m<v[0]||m>v[1])):g;else if(L(a))c=WB(t,n,a,(m,v)=>v&&v.length?n.domain(v,!0).forceTicks(m):n.forceTicks(m));else if(t.tickMode==="d3"){const m=(e=it(o)?o({axisLength:s,labelStyle:d}):o)!==null&&e!==void 0?e:5;c=WB(t,n,m,(v,_)=>_&&_.length?n.domain(_,!0).d3Ticks(v,{noDecimals:h}):n.d3Ticks(v,{noDecimals:h}))}else{const m=(i=it(o)?o({axisLength:s,labelStyle:d}):o)!==null&&i!==void 0?i:5,v=it(t.tickMode)?t.tickMode:void 0;c=WB(t,n,m,(_,b)=>b&&b.length?n.domain(b,!0).ticks(_,{noDecimals:h,customTicks:v}):n.ticks(_,{noDecimals:h,customTicks:v}))}var g,p;const f=n.domain();if(t.labelFirstVisible&&f[0]!==c[0]&&!c.includes(f[0])&&c.unshift(f[0]),t.labelLastVisible&&f[f.length-1]!==c[c.length-1]&&!c.includes(f[f.length-1])&&c.push(f[f.length-1]),t.sampling&&c.length>1&&(t.coordinateType==="cartesian"||t.coordinateType==="polar"&&t.axisOrientType==="radius")){const{labelGap:m=4,labelFlush:v}=t,_=6;let b;if(c.length*_>s){const M=[],T=Math.floor(c.length*_/s);c.forEach((R,B)=>{B%T!=0&&B!==c.length-1||M.push(R)}),b=hI(n,M,t).map((R,B)=>({AABBBounds:R,value:M[B]}))}else b=hI(n,c,t).map((M,T)=>({AABBBounds:M,value:c[T]}));const y=b[0],C=de(b),S=u&&u()?tU.greedy:tU.parity;for(;b.length>=3&&lI(b,m);)b=S(b,m);const w=t.labelFirstVisible;let x=t.labelLastVisible;Zo(y,C,m)&&b.includes(C)&&b.length>1&&w&&x&&(b.splice(b.indexOf(C),1),x=!1),Q6(y,b,w,M=>Zo(M,y,m)),Q6(C,b,x,M=>Zo(M,C,m)||!(!w||M===y)&&Zo(M,y,m),!0);const A=b.map(M=>M.value);A.length<3&&v&&(A.length>1&&A.pop(),de(A)!==de(c)&&A.push(de(c))),c=A}return Yl(c)},tU={parity:function(n){return n.filter((t,e)=>e%2==0)},greedy:function(n,t){let e;return n.filter((i,r)=>(!r||!Zo(e,i,t))&&(e=i,!0))}},eU=(n,t,e,i)=>hI(n,t,e).map(r=>i?[r.x1,r.x2,r.width()]:[r.y1,r.y2,r.height()]),iU=(n,t,e=0)=>Math.max(n[0],t[0])-e/2<=Math.min(n[1],t[1])+e/2,nU=(n,t)=>n[1]<t[0]?t[0]-n[1]:t[1]<n[0]?n[0]-t[1]:0,MHt=(n,t)=>{var e;const i=n.domain();if(!i.length)return[];const{tickCount:r,forceTickCount:s,tickStep:o,labelGap:a=4,axisOrientType:l,labelStyle:h}=t,d=sHt(l),u=n.range(),c=n.calculateWholeRangeSize();if(c<2)return t.labelLastVisible?Yl([i[i.length-1]]):Yl([i[0]]);let g;if(L(o))g=n.stepTicks(o);else if(L(s))g=n.forceTicks(s);else if(L(r)){const p=it(r)?r({axisLength:c,labelStyle:h}):r;g=n.ticks(p)}else if(t.sampling){const p=((e=t.labelStyle.fontSize)!==null&&e!==void 0?e:12)+2,f=Ri(u),m=Mi(u);if(i.length<=c/p){const v=(m-f)/i.length,_=eU(n,i,t,d),b=Math.min(..._.map(C=>C[2])),y=THt(i,_,a,t.labelLastVisible,Math.floor(b/v));g=n.stepTicks(y.step),t.labelLastVisible&&(y.delCount&&(g=g.slice(0,g.length-y.delCount)),g.push(i[i.length-1]))}else{const v=[i[0],i[Math.floor(i.length/2)],i[i.length-1]],_=eU(n,v,t,d);let b=null;_.forEach(C=>{b?b[2]<C[2]&&(b=C):b=C});const y=m-f-a>0?Math.ceil(i.length*(a+b[2])/(m-f-a)):i.length-1;g=n.stepTicks(y),!t.labelLastVisible||g.length&&g[g.length-1]===i[i.length-1]||(g.length&&Math.abs(n.scale(g[g.length-1])-n.scale(i[i.length-1]))<b[2]&&(g=g.slice(0,-1)),g.push(i[i.length-1]))}}else g=n.domain();return Yl(g)},THt=(n,t,e,i,r,s)=>{let o=0,a=0,l=-1,h=Number.MAX_VALUE;const d=g=>{let p=!0,f=0;do f+g<n.length&&iU(t[f],t[f+g],e)&&(p=!1),f+=g;while(p&&f<n.length);return p},u=CO(r,n.length,g=>d(g)?1:-1);let c=u;do if(c>u&&!d(c))c++;else{if(!i){a=c;break}{const g=n.length-1;let p,f=0;p=n.length%c>0?n.length-n.length%c+c:n.length;do{if(p-=c,p!==g&&!iU(t[p],t[g],e))break;f++}while(p>0);if(p===g){a=c,o=f;break}{const m=Math.floor(n.length/c)-f+1;if(m<l)break;{l=m;const v=nU(t[p],t[g]),_=p-c>=0?nU(t[p-c],t[p]):v,b=Math.abs(v-_);if(b<h&&(h=b,a=c,o=f),v<=_)break}}}c++}while(c<=n.length);return{step:a,delCount:o}},kHt=(n,t,e)=>{var i;const{labelStyle:r,getRadius:s,labelOffset:o,labelFormatter:a,inside:l}=e,h=s==null?void 0:s(),d=(i=r.angle)!==null&&i!==void 0?i:0,u=Wp(r);return t.map(c=>{const g=a?a(c):`${c}`,{width:p,height:f}=u.quickMeasure(g),m=Math.max(p,$6),v=Math.max(f,$6),_=n.scale(c),b={x:0,y:0};let y=0,C=0;const S={align:r.textAlign,baseline:r.textBaseline},{x:w,y:x}=WFt(_,b,h,o,l);return S.align||(di(w,b.x)?S.baseline||(S.baseline=x>b.y?"top":"bottom"):w>b.x?S.align="left":w<b.x&&(S.align="right")),y=w+(S.align==="right"?-m:S.align==="left"?0:-m/2),C=x+(S.baseline==="bottom"?-v:S.baseline==="top"?0:-v/2),new ie().set(y,C,y+m,C+v).rotate(d,y+m/2,C+v/2)})},RHt=(n,t)=>{const{tickCount:e,forceTickCount:i,tickStep:r,getRadius:s,labelOffset:o,labelGap:a=0,labelStyle:l}=t,h=s==null?void 0:s();if(!h)return Yl(n.domain());let d;if(L(r))d=n.stepTicks(r);else if(L(i))d=n.forceTicks(i);else if(L(e)){const u=n.range(),c=Math.abs(u[u.length-1]-u[0]),g=it(e)?e({axisLength:c,labelStyle:l}):e;d=n.ticks(g)}else if(t.sampling){const u=n.domain(),c=n.range(),g=kHt(n,u,t),p=Ri(c),f=Mi(c),m=Math.abs(f-p)*(h+o)/u.length,{step:v,delCount:_}=BHt(u,g,a,Math.floor(g.reduce((b,y)=>Math.min(b,y.width(),y.height()),Number.MAX_VALUE)/m));d=n.stepTicks(v),d=d.slice(0,d.length-_)}else d=n.domain();return Yl(d)},BHt=(n,t,e,i)=>{let r=i;do{let o=!0;r++;let a=0;do a+r<n.length&&N6(t[a],t[a+r],e)&&(o=!1),a+=r;while(o&&a<n.length);if(o)break}while(r<=n.length);let s=0;if(n.length>2){let o=n.length-n.length%r;for(o>=n.length&&(o-=r);o>0&&N6(t[0],t[o]);)s++,o-=r}return{step:r,delCount:s}},zh=new Uint32Array(33),$o=new Uint32Array(33);$o[0]=0,zh[0]=~$o[0];for(let n=1;n<=32;++n)$o[n]=$o[n-1]<<1|1,zh[n]=~$o[n];function PHt(n,t){const e=new Uint32Array(~~((n*t+32)/32));function i(s,o){e[s]|=o}function r(s,o){e[s]&=o}return{array:e,get:(s,o)=>{const a=o*n+s;return e[a>>>5]&1<<(31&a)},set:(s,o)=>{const a=o*n+s;i(a>>>5,1<<(31&a))},clear:(s,o)=>{const a=o*n+s;r(a>>>5,~(1<<(31&a)))},getRange:({x1:s,y1:o,x2:a,y2:l})=>{if(a<0||l<0||s>n||o>t)return!0;let h,d,u,c,g=l;for(;g>=o;--g)if(h=g*n+s,d=g*n+a,u=h>>>5,c=d>>>5,u===c){if(e[u]&zh[31&h]&$o[1+(31&d)])return!0}else{if(e[u]&zh[31&h]||e[c]&$o[1+(31&d)])return!0;for(let p=u+1;p<c;++p)if(e[p])return!0}return!1},setRange:({x1:s,y1:o,x2:a,y2:l})=>{if(a<0||l<0||s>n||o>t)return;let h,d,u,c,g;for(;o<=l;++o)if(h=o*n+s,d=o*n+a,u=h>>>5,c=d>>>5,u===c)i(u,zh[31&h]&$o[1+(31&d)]);else for(i(u,zh[31&h]),i(c,$o[1+(31&d)]),g=u+1;g<c;++g)i(g,4294967295)},clearRange:({x1:s,y1:o,x2:a,y2:l})=>{let h,d,u,c,g;for(;o<=l;++o)if(h=o*n+s,d=o*n+a,u=h>>>5,c=d>>>5,u===c)r(u,$o[31&h]|zh[1+(31&d)]);else for(r(u,$o[31&h]),r(c,zh[1+(31&d)]),g=u+1;g<c;++g)r(g,0)},outOfBounds:({x1:s,y1:o,x2:a,y2:l})=>s<0||o<0||l>=t||a>=n,toImageData:s=>{const o=s.createImageData(n,t),a=o.data;for(let l=0;l<t;++l)for(let h=0;h<n;++h){const d=l*n+h,u=4*d,c=e[d>>>5]&1<<(31&d);a[u+0]=255*c,a[u+1]=255*c,a[u+2]=255*c,a[u+3]=31}return o}}}function Ytt(n,t,e={top:0,left:0,right:0,bottom:0}){const{top:i=0,left:r=0,right:s=0,bottom:o=0}=e,a=Math.max(1,Math.sqrt(n*t/1e6)),l=~~((n+r+s+a)/a),h=~~((t+i+o+a)/a),d=u=>~~(u/a);return d.bitmap=()=>PHt(l,h),d.x=u=>~~((u+r)/a),d.y=u=>~~((u+i)/a),d.ratio=a,d.padding=e,d.width=n,d.height=t,d}function Xtt(n,t){const{x1:e,x2:i,y1:r,y2:s}=t,{top:o=0,left:a=0,right:l=0,bottom:h=0}=n.padding,d=Ne(e,-a,n.width+l),u=Ne(i,-a,n.width+l),c=Ne(r,-o,n.height+h),g=Ne(s,-o,n.height+h);return{x1:n.x(d),x2:n.x(u),y1:n.y(c),y2:n.y(g)}}function Aa(n,t,e=!1){return e?Xtt(n,t):{x1:n.x(t.x1),x2:n.x(t.x2),y1:n.y(t.y1),y2:n.y(t.y2)}}function ev(n,t,e,i=!0,r=0){let s=e;r>0&&(s={x1:e.x1-r,x2:e.x2+r,y1:e.y1-r,y2:e.y2+r}),s=Aa(n,s);const o=t.outOfBounds(s);return(!i||!o)&&(o&&(s=Xtt(n,s)),!t.getRange(s))}function jB(n,t,e,i=[],r=!0,s=0,o=!1){const a=i.filter(l=>L(l));for(let l=0;l<a.length;l++){let h;if(h=o?e:e.clone(),h.setAttributes(a[l]),ev(n,t,h.AABBBounds,r,s))return t.setRange(Aa(n,h.AABBBounds,!0)),a[l]}return!1}function EHt(n,t,e,i,r,s,o){var a,l;const h=(a=i.overlap)===null||a===void 0?void 0:a.clampForce,d=(l=i.overlap)===null||l===void 0?void 0:l.overlapPadding;if(e.type==="bound"||e.type==="position"){if(it(o)){const u=((it(e.position)?e.position(r.attribute):e.position)||OHt(i.type)).map(g=>o(r.AABBBounds,s,g,i.offset)),c=e.restorePosition===!1;return jB(n,t,r,u,h,d,c)}return!1}if(e.type==="moveY"){const u=(e.offset?it(e.offset)?e.offset(r.attribute):e.offset:[]).map(c=>({x:r.attribute.x,y:r.attribute.y+c}));return jB(n,t,r,u,h,d)}if(e.type==="moveX"){const u=(e.offset?it(e.offset)?e.offset(r.attribute):e.offset:[]).map(c=>({x:r.attribute.x+c,y:r.attribute.y}));return jB(n,t,r,u,h,d)}return!1}const LHt=["top","bottom","right","left","top-right","bottom-right","top-left","bottom-left"],IHt=["top","inside-top","inside"];function OHt(n){return n==="rect"?IHt:LHt}function rU(n,t,e,i={}){const{x1:r,x2:s,y1:o,y2:a}=n.AABBBounds,{top:l=0,left:h=0,right:d=0,bottom:u=0}=i,c=Math.min(r,s),g=Math.max(r,s),p=Math.min(o,a),f=Math.max(o,a),m=t+d,v=e+u;let _=0,b=0;return c<0-h?_=-c:g>m&&(_=m-g),p<0-l?b=-p:f>v&&(b=v-f),{dx:_,dy:b}}const DHt=(n={})=>{var t,e,i;return{from:{opacity:0,fillOpacity:0,strokeOpacity:0},to:{opacity:(t=n.opacity)!==null&&t!==void 0?t:1,fillOpacity:(e=n.fillOpacity)!==null&&e!==void 0?e:1,strokeOpacity:(i=n.strokeOpacity)!==null&&i!==void 0?i:1}}},FHt=(n={})=>{var t,e,i;return{from:{opacity:(t=n.opacity)!==null&&t!==void 0?t:1,fillOpacity:(e=n.fillOpacity)!==null&&e!==void 0?e:1,strokeOpacity:(i=n.strokeOpacity)!==null&&i!==void 0?i:1},to:{opacity:0,fillOpacity:0,strokeOpacity:0}}},sU={fadeIn:DHt,fadeOut:FHt};function oU(n,t){var e,i;return(i=(e=sU[t])===null||e===void 0?void 0:e.call(sU,n))!==null&&i!==void 0?i:{from:{},to:{}}}function HHt(n,t,e){const i=(r,s)=>{const o={};for(const a in s.attribute)r.attribute[a]!==s.attribute[a]&&(o[a]=s.attribute[a]);return o};if(!V(e)){const{duration:r,easing:s,increaseEffect:o=!0}=e;return n.animate().to(i(n,t),r,s),void(o&&n.type==="text"&&t.type==="text"&&aU(n,t,r,s))}e.forEach(r=>{const{duration:s,easing:o,increaseEffect:a=!0,channel:l}=r,{to:h}=zHt(n,t,l,r.options);xt(h)||n.animate().to(i(n,t),s,o),a&&n.type==="text"&&t.type==="text"&&aU(n,t,s,o)})}const zHt=(n,t,e,i)=>{const r=Object.assign({},n.attribute),s=Object.assign({},t.attribute);return Q(i==null?void 0:i.excludeChannels).forEach(o=>{delete s[o]}),Object.keys(s).forEach(o=>{e&&!e.includes(o)&&delete s[o]}),{from:r,to:s}};function aU(n,t,e,i){n.attribute.text!==t.attribute.text&&et(Number(n.attribute.text)*Number(t.attribute.text))&&n.animate().play(new iBt({text:n.attribute.text},{text:t.attribute.text},e,i))}const NB={mode:"same-time",duration:300,easing:"linear"};function au(n){return n===3||n===4}function WHt(n){return n===1||n===2}function jHt(n,t,e,i,r,s){if(n===0&&t===0||s<=0)return[];if(n===0){const c=-e/t,g=s**2-(c-r)**2;return g<0?[]:g===0?[{x:i,y:c}]:[{x:Math.sqrt(g)+i,y:c},{x:-Math.sqrt(g)+i,y:c}]}if(t===0){const c=-e/n,g=s**2-(c-i)**2;return g<0?[]:g===0?[{x:c,y:r}]:[{x:c,y:Math.sqrt(g)+r},{x:c,y:-Math.sqrt(g)+r}]}const o=(t/n)**2+1,a=2*((e/n+i)*(t/n)-r),l=a**2-4*o*((e/n+i)**2+r**2-s**2);if(l<0)return[];const h=(-a+Math.sqrt(l))/(2*o),d=(-a-Math.sqrt(l))/(2*o),u=-(t*h+e)/n;return l===0?[{x:u,y:h}]:[{x:u,y:h},{x:-(t*d+e)/n,y:d}]}function NHt(n,t){return t>2*n?NaN:2*Math.asin(t/2/n)}function $Ht(n,t){const{x1:e,y1:i,x2:r,y2:s}=n,{x1:o,y1:a,x2:l,y2:h}=t;return!(e<=o&&r<=o||e>=l&&r>=l||i<=a&&s<=a||i>=h&&s>=h)}const VHt=(n,t,e="top",i=0)=>{if(!n)return;const{x1:r,y1:s,x2:o,y2:a}=n,l=Math.abs(o-r),h=Math.abs(a-s),d=(t.x1+t.x2)/2,u=(t.y1+t.y2)/2;let c=0,g=0,p=0,f=0;t&&(p=Math.abs(t.x1-t.x2)/2,f=Math.abs(t.y1-t.y2)/2);const m={"top-right":-235,"top-left":235,"bottom-right":45,"bottom-left":-45};switch(e){case"top":g=-1;break;case"bottom":g=1;break;case"left":c=-1;break;case"right":c=1;break;case"bottom-left":case"bottom-right":case"top-left":case"top-right":c=Math.sin(m[e]*(Math.PI/180)),g=Math.cos(m[e]*(Math.PI/180));break;case"center":c=0,g=0}return{x:d+c*(i+p)+Math.sign(c)*(l/2),y:u+g*(i+f)+Math.sign(g)*(h/2)}},GHt=n=>{if(!n||!n.attribute)return[];const{points:t,segments:e}=n.attribute;if(e&&e.length){const i=[];return e.forEach(r=>{r.points.forEach(s=>{i.push(s)})}),i}return t};function UHt(n,t,e="end",i=0){if(!n||!t)return{x:1/0,y:1/0};const{x1:r,x2:s}=n,o=Math.abs(s-r),a=t.x1;let l=a;return e==="end"?l=a+o/2+i:e==="start"&&(l=a-o/2-i),{x:l,y:t.y1}}function YHt(n,t){if(!n||!t||kd(n,t,!0))return;const e=Math.min(n.x1,n.x2),i=Math.min(n.y1,n.y2),r=Math.min(t.x1,t.x2),s=Math.min(t.y1,t.y2),o=Math.abs(n.x2-e)/2,a=Math.abs(n.y2-i)/2,l=Math.abs(t.x2-r)/2,h=Math.abs(t.y2-s)/2,d=e+o,u=i+a,c=r+l,g=s+h,p=c-d,f=g-u;return[lU(p,f,d,u,o,a),lU(-p,-f,c,g,l,h)]}function lU(n,t,e,i,r,s){return Math.abs(t/n)<s/r?{x:e+(n>0?r:-r),y:i+t*r/Math.abs(n)}:{x:e+n*s/Math.abs(t),y:i+(t>0?s:-s)}}function XHt(n){return n==="left"?0:n==="right"?1:.5}function KHt(){Xi(),al(),Xd(),ph()}const hU=(n,t)=>Math.ceil(n)>Math.floor(t),qHt=([n,t],[e,i])=>i>n&&t>e;function ZHt(n,t){const[e,i]=n,[r,s]=t,o=Math.max(e,r),a=Math.min(i,s);return Math.max(0,a-o)}function JHt(n,t){const{maxY:e=Number.MAX_VALUE,labelling:i,globalShiftY:r={enable:!0,maxIterations:10,maxError:.1,padding:1}}=t,s=n.length;if(s<=1)return n;const o=new Map,a=new Map,l=C=>a.get(C).y1Initial,h=C=>a.get(C).height,d=C=>a.get(C).y1,u=C=>a.get(C).x,c=C=>a.get(C).x1,g=C=>a.get(C).x2,p=C=>a.get(C).attempts,f=(C,S)=>{a.get(C).y1=S},m=(C,S)=>{a.get(C).attempts=S};function v(C){for(let w=C.length-1;w>=0;w--){const x=C[w],A=C[w-1],M=C[w+1];if(A&&hU(d(A)+h(A),d(x))||d(x)===0&&x._isClamped){const{y:T}=i(x);M&&hU(T+h(x)/2,d(M))||T+h(x)/2<=e&&f(x,d(x)+T-(S=x,a.get(S).y))}}var S}n.sort((C,S)=>C.attribute.x-S.attribute.x);for(const C of n){const{y1:S,y2:w,x1:x,x2:A}=C.AABBBounds,{x:M,y:T}=C.attribute;a.set(C,{y1Initial:S,y1:S,y2:w,y:T,height:w-S,x1:x,x2:A,x:M,attempts:0});let R=!1;for(const[B,E]of o){const{start:k,end:P}=B;if(x>=k&&A<=P)E.push(C),R=!0;else if(di(M,u(E[0]),void 0,5)){const I={start:Math.min(k,x),end:Math.max(P,A)};E.push(C),o.set(I,E),o.delete(B),R=!0}else if(ZHt([k,P],[x,A])/(P-k)>.5){const I={start:Math.min(k,x),end:Math.max(P,A)};E.push(C),o.set(I,E),o.delete(B),R=!0}if(R)break}R||o.set({start:x,end:A},[C])}for(const C of o.values())C.sort((S,w)=>l(S)-l(w)),v(C);if(r.enable!==!1){const{maxIterations:C=10,maxError:S=.1,padding:w=1,maxAttempts:x=1e3,deltaYTolerance:A=Number.MAX_VALUE}=r;for(let M=0;M<C;M++){n.sort((R,B)=>l(R)-l(B));let T=0;for(let R=0;R<s-1;R++){const B=n[R];if(p(B)>=x)continue;let E,k=R+1;for(;(E=n[k])&&!qHt([c(B),g(B)],[c(E),g(E)]);)k+=1;if(E){const P=d(B),I=h(B),O=d(E),H=O-(P+I);if(H<w){const z=(w-H)/2;if(T=Math.max(T,z),P+z+h(E)>e){const F=P-(w-H),j=l(B)-F;Math.abs(j)<=A&&(f(B,F),m(B,p(B)+1))}else if(P-z<0){const F=O+(w-H),j=l(E)-F;Math.abs(j)<=A&&(f(E,F),m(E,p(E)+1))}else{const F=P-z,j=l(B)-F,$=O+z,Y=l(E)-$;Math.abs(j)<=A&&Math.abs(Y)<=A&&(f(B,F),f(E,$),m(B,p(B)+1),m(E,p(E)+1))}}}}if(T<S)break}}for(const C of n){const S=C.attribute.y+d(C)-l(C);C.setAttribute("y",S)}const _=[];n.sort((C,S)=>C.attribute.x-S.attribute.x);let b=0,y=n.length-1;for(;b<=y;)b===y?_.push(n[b]):(_.push(n[b]),_.push(n[y])),b++,y--;return _}var QHt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};KHt();class Kd extends En{setBitmap(t){this._bitmap=t}setBitmapTool(t){this._bmpTool=t}constructor(t,e){const{data:i}=t,r=QHt(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},Z({},Kd.defaultAttributes,r))),this.name="label",this._onHover=s=>{const o=s.target;o===this._lastHover||xt(o.states)||(o.addState(Qi.hover,!0),qo(this,a=>{a===o||xt(a.states)||a.addState(Qi.hoverReverse,!0)}),this._lastHover=o)},this._onUnHover=s=>{this._lastHover&&(qo(this,o=>{xt(o.states)||(o.removeState(Qi.hoverReverse),o.removeState(Qi.hover))}),this._lastHover=null)},this._onClick=s=>{const o=s.target;if(this._lastSelect===o&&o.hasState("selected"))return this._lastSelect=null,void qo(this,a=>{xt(a.states)||(a.removeState(Qi.selectedReverse),a.removeState(Qi.selected))});xt(o.states)||(o.addState(Qi.selected,!0),qo(this,a=>{a===o||xt(a.states)||a.addState(Qi.selectedReverse,!0)}),this._lastSelect=o)},this._handleRelatedGraphicSetState=s=>{var o,a,l,h,d;if(((o=s.detail)===null||o===void 0?void 0:o.type)===qi.STATE||((a=s.detail)===null||a===void 0?void 0:a.type)===qi.ANIMATE_UPDATE&&(!((l=s.detail.animationState)===null||l===void 0)&&l.isFirstFrameOfStep)){const u=(d=(h=s.target)===null||h===void 0?void 0:h.currentStates)!==null&&d!==void 0?d:[],c=this._isCollectionBase?[...this._graphicToText.values()]:[this._graphicToText.get(s.target)];this.updateStatesOfLabels(c,u)}}}labeling(t,e,i,r){}_getLabelLinePoints(t,e){return YHt(t.AABBBounds,e==null?void 0:e.AABBBounds)}_createLabelLine(t,e){const i=this._getLabelLinePoints(t,e);if(i){const r=Pt.line({points:i}),{line:s={}}=t.attribute;if(s.customShape){const o=s.customShape;r.pathProxy=a=>o({text:t,baseMark:e},a,new Cn)}return e&&e.attribute.fill&&r.setAttribute("stroke",e.attribute.fill),this.attribute.line&&!xt(this.attribute.line.style)&&r.setAttributes(this.attribute.line.style),this._setStatesOfLabelLine(r),r}}render(){if(this._prepare(),D(this._idToGraphic)||this._isCollectionBase&&D(this._idToPoint))return;const{overlap:t,smartInvert:e,dataFilter:i,customLayoutFunc:r,customOverlapFunc:s}=this.attribute;let o=this.attribute.data;if(it(i)&&(o=i(o)),o&&o.length){const l=new Set;o=o.filter(h=>!l.has(h.id)&&l.add(h.id))}let a=this._initText(o);a=it(r)?r(o,a,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this):this._layout(a),it(s)?a=s(a,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this):t!==!1&&(a=this._overlapping(a)),it(this.attribute.onAfterOverlapping)&&this.attribute.onAfterOverlapping(a,this.getRelatedGraphic.bind(this),this._isCollectionBase?l=>this._idToPoint.get(l.id):null,this),a&&a.length&&a.forEach(l=>{this._bindEvent(l),this._setStatesOfText(l)}),e!==!1&&this._smartInvert(a),this._renderLabels(a)}_bindEvent(t){if(this.attribute.disableTriggerEvent||!t)return;const{hover:e,select:i}=this.attribute;e&&(t.addEventListener("pointermove",this._onHover),t.addEventListener("pointerout",this._onUnHover)),i&&t.addEventListener("pointerdown",this._onClick)}_setStatesOfText(t){if(!t)return;const e=this.attribute.state;e&&!xt(e)&&(t.states=e)}_setStatesOfLabelLine(t){if(!t)return;const e=this.attribute.labelLineState;e&&!xt(e)&&(t.states=e)}_createLabelText(t){var e,i;const r=Object.assign(Object.assign({},(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),t);return u0(r,"textType")}_prepare(){var t,e;const i=[];let r;if(r=it(this.attribute.getBaseMarks)?this.attribute.getBaseMarks():hFt(this.getRootNode(),this.attribute.baseMarkGroupName),r.forEach(o=>{o.releaseStatus!=="willRelease"&&i.push(o)}),(t=this._idToGraphic)===null||t===void 0||t.clear(),(e=this._idToPoint)===null||e===void 0||e.clear(),this._baseMarks=i,this._isCollectionBase=this.attribute.type==="line-data",!i||i.length===0)return;const{data:s}=this.attribute;if(s&&s.length!==0){if(this._idToGraphic||(this._idToGraphic=new Map),this._isCollectionBase){this._idToPoint||(this._idToPoint=new Map);let o=0;for(let a=0;a<i.length;a++){const l=i[a],h=GHt(l);if(h&&h.length)for(let d=0;d<h.length;d++){const u=s[o];u&&h[d]&&(L(u.id)||(u.id=`vrender-component-${this.name}-${o}`),this._idToPoint.set(u.id,h[d]),this._idToGraphic.set(u.id,l)),o++}}}else for(let o=0;o<i.length;o++){const a=s[o],l=i[o];a&&l&&(L(a.id)||(a.id=`vrender-component-${this.name}-${o}`),this._idToGraphic.set(a.id,l))}if(this.attribute.animation!==!1){const{animation:o,animationEnter:a,animationExit:l,animationUpdate:h}=this.attribute,d=kt(o)?o:{};this._animationConfig={enter:a!==!1&&Z({},NB,d,a??{}),exit:l!==!1&&Z({},NB,d,l??{}),update:h!==!1&&(V(h)?h:Z({},NB,d,h??{}))}}else this._animationConfig={enter:!1,exit:!1,update:!1}}}getRelatedGraphic(t){return this._idToGraphic.get(t.id)}_initText(t=[]){const{textStyle:e={}}=this.attribute,i=[];for(let r=0;r<t.length;r++){const s=t[r],o=this.getRelatedGraphic(s);if(!o)continue;const a=Object.assign(Object.assign({fill:this._isCollectionBase?V(o.attribute.stroke)?o.attribute.stroke.find(h=>!!h&&h!==!0):o.attribute.stroke:o.attribute.fill},e),s),l=this._createLabelText(a);i.push(l)}return i}_layout(t){const{position:e,offset:i}=this.attribute;for(let r=0;r<t.length;r++){const s=t[r];if(!s)return;const o=s.attribute,a=this.getRelatedGraphic(o);if(!a)continue;s.attachedThemeGraphic=this;const l=this.getGraphicBounds(s);s.attachedThemeGraphic=null;const h=it(e)?e(o):e,d=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(o.id),h):this.getGraphicBounds(a,{x:o.x,y:o.y},h),u=this.labeling(l,d,h,i);u&&s.setAttributes(u)}return t}_overlapping(t){var e,i,r;if(t.length===0)return[];const s=kt(this.attribute.overlap)?this.attribute.overlap:{},o=this.getBaseMarkGroup(),a=(e=s.size)!==null&&e!==void 0?e:{width:(i=o==null?void 0:o.AABBBounds.width())!==null&&i!==void 0?i:0,height:(r=o==null?void 0:o.AABBBounds.height())!==null&&r!==void 0?r:0};if(a.width===0||a.height===0)return t;const{strategy:l,priority:h}=s,d=this._bmpTool||Ytt(a.width,a.height),u=this._bitmap||d.bitmap();return h&&(t=t.sort((c,g)=>h(g.attribute.data)-h(c.attribute.data))),(l==null?void 0:l.type)==="shiftY"?this._overlapGlobal(t,s,d,u):this._overlapByStrategy(t,s,d,u)}_overlapGlobal(t,e,i,r){let s=t.filter(d=>d.attribute.visible&&d.attribute.opacity!==0&&this.isMarkInsideRect(this.getRelatedGraphic(d.attribute),i));const{clampForce:o=!0,hideOnHit:a=!0,overlapPadding:l,strategy:h}=e;if(o)for(let d=0;d<s.length;d++){const u=t[d],{dx:c=0,dy:g=0}=rU(u,i.width,i.height,i.padding);c===0&&g===0||(u.setAttributes({x:u.attribute.x+c,y:u.attribute.y+g}),u._isClamped=!0)}s=JHt(s,Object.assign(Object.assign({maxY:i.height},h),{labelling:d=>{const u=this.getRelatedGraphic(d.attribute),c=this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(d.attribute.id)):this.getGraphicBounds(u,d);return this.labeling(d.AABBBounds,c,"bottom",this.attribute.offset)}}));for(let d=0;d<s.length;d++){const u=s[d],c=u.AABBBounds,g=Aa(i,c,!0);if(ev(i,r,c,o,l))r.setRange(g);else{if(o&&this._processClampForce(u,i,r,l))continue;a?u.setAttributes({visible:!1}):r.setRange(g)}}return s}_processClampForce(t,e,i,r=0){const{dy:s=0,dx:o=0}=rU(t,e.width,e.height,e.padding);if(o===0&&s===0){if(ev(e,i,t.AABBBounds,!1,r))return i.setRange(Aa(e,t.AABBBounds,!0)),!0}else if(ev(e,i,{x1:t.AABBBounds.x1+o,x2:t.AABBBounds.x2+o,y1:t.AABBBounds.y1+s,y2:t.AABBBounds.y2+s}))return t.setAttributes({x:t.attribute.x+o,y:t.attribute.y+s}),i.setRange(Aa(e,t.AABBBounds,!0)),!0;return!1}_overlapByStrategy(t,e,i,r){var s;const{avoidBaseMark:o,strategy:a=[],hideOnHit:l=!0,clampForce:h=!0,avoidMarks:d=[],overlapPadding:u}=e,c=[],g=a.some(p=>p.type==="bound");o&&((s=this._baseMarks)===null||s===void 0||s.forEach(p=>{p.AABBBounds&&r.setRange(Aa(i,p.AABBBounds,!0))})),d.length>0&&d.forEach(p=>{yt(p)?dFt(this.getRootNode(),p).forEach(f=>{f.AABBBounds&&r.setRange(Aa(i,f.AABBBounds,!0))}):p.AABBBounds&&r.setRange(Aa(i,p.AABBBounds,!0))});for(let p=0;p<t.length;p++){if(t[p].attribute.visible===!1)continue;const f=t[p],m=this.getRelatedGraphic(f.attribute);if(f.update(),!this.isMarkInsideRect(m,i))continue;if(ev(i,r,f.AABBBounds,h,u)){if(!g){r.setRange(Aa(i,f.AABBBounds,!0)),c.push(f);continue}if(g&&m&&m.AABBBounds&&this._canPlaceInside(f.AABBBounds,m.AABBBounds)){r.setRange(Aa(i,f.AABBBounds,!0)),c.push(f);continue}}let v=!1;for(let _=0;_<a.length;_++)if(v=EHt(i,r,a[_],this.attribute,f,this._isCollectionBase?this.getGraphicBounds(null,this._idToPoint.get(t[p].attribute.id)):this.getGraphicBounds(m,t[p].attribute),this.labeling),v!==!1){f.setAttributes({x:v.x,y:v.y}),c.push(f);break}if(!v&&h&&this._processClampForce(f,i,r,u)){c.push(f);continue}!v&&!l&&c.push(f)}return c}isMarkInsideRect(t,e){const{left:i,right:r,top:s,bottom:o}=e.padding,a={x1:-i,x2:e.width+r,y1:-s,y2:e.height+o},l=t.AABBBounds;if(l.width()!==0&&l.height()!==0)return kd(t.AABBBounds,a,!0);const{attribute:h}=t;if(t.type==="rect"){const{x:d,x1:u,y:c,y1:g}=h;return vp({x:d??u,y:c??g},a,!0)}return"x"in h&&"y"in h&&vp({x:h.x,y:h.y},a,!0)}getBaseMarkGroup(){const{baseMarkGroupName:t}=this.attribute;if(t)return this.getRootNode().find(e=>e.name===t,!0)}getGraphicBounds(t,e={},i){if(t){if(t.attribute.visible!==!1)return t.AABBBounds;const{x:o,y:a}=t.attribute;return{x1:o,x2:o,y1:a,y2:a}}if(e&&i&&i==="inside-middle"){const{x:o,y:a,x1:l=o,y1:h=a}=e;return{x1:(o+l)/2,x2:(o+l)/2,y1:(a+h)/2,y2:(a+h)/2}}const{x:r,y:s}=e;return{x1:r,x2:r,y1:s,y2:s}}_renderLabels(t){var e;const{syncState:i}=this.attribute,r=new Map,s=this._graphicToText||new Map,o=[],a=[],{visible:l}=(e=this.attribute.line)!==null&&e!==void 0?e:{};t&&t.forEach((h,d)=>{var u;const c=this.getRelatedGraphic(h.attribute),g=this._isCollectionBase?h.attribute.id:c,p=s!=null&&s.get(g)?"update":"enter";let f;if(l&&(f=this._createLabelLine(h,c)),i&&this.updateStatesOfLabels([f?{text:h,labelLine:f}:{text:h}],(u=c.currentStates)!==null&&u!==void 0?u:[]),p==="enter")o.push(h),r.set(g,f?{text:h,labelLine:f}:{text:h}),this._addLabel({text:h,labelLine:f},o,a,d);else if(p==="update"){const m=s.get(g);s.delete(g),r.set(g,m),this._updateLabel(m,{text:h,labelLine:f})}}),this._removeLabel(s),this._graphicToText=r}_addLabel(t,e,i,r){const{text:s,labelLine:o}=t,a=this.getRelatedGraphic(s.attribute);if(this._syncStateWithRelatedGraphic(a),this._enableAnimation!==!1&&this._animationConfig.enter!==!1){if(a){const{from:l,to:h}=oU(s.attribute,"fadeIn");s&&this.add(s),o&&(i.push(o),this.add(o)),this._animationConfig.enter.duration>0&&a.once("animate-bind",d=>{s.setAttributes(l),o&&o.setAttributes(l);const u=this._afterRelatedGraphicAttributeUpdate(s,e,o,i,r,a,h,this._animationConfig.enter);a.on("afterAttributeUpdate",u)})}}else s&&this.add(s),o&&this.add(o)}_updateLabel(t,e){const{text:i,labelLine:r}=t,{text:s,labelLine:o}=e;if(this._enableAnimation!==!1&&this._animationConfig.update!==!1){const{duration:a,easing:l}=this._animationConfig.update;HHt(i,s,this._animationConfig.update),r&&o&&t.labelLine.animate().to(o.attribute,a,l)}else t.text.setAttributes(s.attribute),r&&o&&t.labelLine.setAttributes(o.attribute)}_removeLabel(t){const e=i=>{this.removeChild(i.text),i.labelLine&&this.removeChild(i.labelLine)};if(this._enableAnimation!==!1&&this._animationConfig.exit!==!1){const{duration:i,easing:r}=this._animationConfig.exit;t.forEach(s=>{var o;(o=s.text)===null||o===void 0||o.animate().to(oU(s.text.attribute,"fadeOut").to,i,r).onEnd(()=>{e(s)})})}else t.forEach(i=>{e(i)})}updateStatesOfLabels(t,e){t.forEach(i=>{i&&(i.text&&i.text.useStates(e),i.labelLine&&i.labelLine.useStates(e))})}_syncStateWithRelatedGraphic(t){this.attribute.syncState&&t&&t.on("afterAttributeUpdate",this._handleRelatedGraphicSetState)}_afterRelatedGraphicAttributeUpdate(t,e,i,r,s,o,a,{mode:l,duration:h,easing:d,delay:u}){const c=g=>{var p,f,m;const{detail:v}=g;if(!v)return{};const _=(p=v.animationState)===null||p===void 0?void 0:p.step;if(!(v.type===qi.ANIMATE_UPDATE&&_&&!(_.type==="wait"&&((f=_.prev)===null||f===void 0?void 0:f.type)==null)))return{};if(v.type===qi.ANIMATE_END)return t.setAttributes(a),void(i&&i.setAttributes(a));const b=()=>{o&&(o.onAnimateBind=void 0,o.removeEventListener("afterAttributeUpdate",c))};switch(l){case"after":v.animationState.end&&(t.animate({onStart:b}).wait(u).to(a,h,d),i&&i.animate().wait(u).to(a,h,d));break;case"after-all":s===e.length-1&&v.animationState.end&&(e.forEach(y=>{y.animate({onStart:b}).wait(u).to(a,h,d)}),r.forEach(y=>{y.animate().wait(u).to(a,h,d)}));break;default:if(this._isCollectionBase){const y=this._idToPoint.get(t.attribute.id);!y||t.animates&&t.animates.has("label-animate")||!o.containsPoint(y.x,y.y,lf.LOCAL,(m=this.stage)===null||m===void 0?void 0:m.getPickerService())||(t.animate({onStart:b}).wait(u).to(a,h,d),i&&i.animate().wait(u).to(a,h,d))}else v.animationState.isFirstFrameOfStep&&(t.animate({onStart:b}).wait(u).to(a,h,d),i&&i.animate().wait(u).to(a,h,d))}};return c}_smartInvert(t){var e,i,r,s,o,a,l;const h=kt(this.attribute.smartInvert)?this.attribute.smartInvert:{},{textType:d,contrastRatiosThreshold:u,alternativeColors:c,mode:g,interactInvertType:p}=h,f=(e=h.fillStrategy)!==null&&e!==void 0?e:"invertBase",m=(i=h.strokeStrategy)!==null&&i!==void 0?i:"base",v=(r=h.brightColor)!==null&&r!==void 0?r:"#ffffff",_=(s=h.darkColor)!==null&&s!==void 0?s:"#000000",b=(o=h.outsideEnable)!==null&&o!==void 0&&o;if(f!=="null"||m!=="null")for(let y=0;y<t.length;y++){const C=t[y];if(!C)continue;const S=this.getRelatedGraphic(C.attribute);let w=S.attribute.fill,x=C.attribute.fill;if(kt(w)&&w.gradient){const B=(l=(a=w.stops)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.color;B&&(w=B,x=B)}const A=T6(x,w,d,u,c,g),M=gF(A,v)?v:_,T=this._canPlaceInside(C.AABBBounds,S.AABBBounds),R=!T&&C.AABBBounds&&S.AABBBounds&&S.AABBBounds.intersects(C.AABBBounds);if(T||b||R&&p==="inside"){const B=Zy(f,w,A,M);if(B&&C.setAttributes({fill:B}),C.attribute.lineWidth===0||C.attribute.strokeOpacity===0)continue;const E=Zy(m,w,A,M);E&&C.setAttributes({stroke:E})}else if(R&&p!=="none"){if(C.attribute.lineWidth===0||C.attribute.strokeOpacity===0)continue;if(C.attribute.stroke){C.setAttributes({fill:T6(C.attribute.fill,C.attribute.stroke,d,u,c,g)});continue}const B=Zy(f,w,A,M);B&&C.setAttributes({fill:B});const E=Zy(m,w,A,M);E&&C.setAttributes({stroke:E})}}}_canPlaceInside(t,e){return!(!t||!e)&&e.encloses(t)}setLocation(t){this.translateTo(t.x,t.y)}disableAnimation(){this._enableAnimation=!1}enableAnimation(){this._enableAnimation=!0}}Kd.defaultAttributes={textStyle:{fontSize:12,textAlign:"center",textBaseline:"middle",boundsPadding:[-2,-1,-2,-1]},offset:0,pickable:!1};const Ktt={},yf=(n,t)=>{Ktt[n]=t},tzt=n=>Ktt[n];var ezt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class f0 extends Kd{constructor(t,e){const{data:i}=t,r=ezt(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},Z({},f0.defaultAttributes,r))),this.name="symbol-label"}labeling(t,e,i="top",r=0){return VHt(t,e,i,r)}}f0.defaultAttributes={textStyle:{fill:"#000"},position:"top",offset:5};const cT=()=>{yf("symbol",f0),yf("line-data",f0)};var izt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class m0 extends Kd{constructor(t,e){const{data:i}=t,r=izt(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},Z({},m0.defaultAttributes,r)))}labeling(t,e,i="top",r=0){if(!t||!e)return;const{x1:s,y1:o,x2:a,y2:l}=t,h=Math.abs(a-s),d=Math.abs(l-o),{x:u,y:c}=PY(e,i);let g=0,p=0;const f=i.includes("inside");switch(i.includes("top")?p=f?1:-1:i.includes("bottom")?p=f?-1:1:i.includes("left")?g=f?1:-1:i.includes("right")&&(g=f?-1:1),i){case"top-right":case"bottom-right":g=-1;break;case"top-left":case"bottom-left":g=1}return{x:u+g*r+g*h/2,y:c+p*r+p*d/2}}}m0.tag="rect-label",m0.defaultAttributes={textStyle:{fill:"#000"},position:"top",offset:5};const nzt=()=>{yf("rect",m0)};var rzt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};let pI=class qtt extends Kd{constructor(t,e){const{data:i}=t,r=rzt(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},Z({},qtt.defaultAttributes,r))),this.name="line-label"}getGraphicBounds(t,e={},i="end"){if(!t||t.type!=="line"&&t.type!=="area")return super.getGraphicBounds(t,e);let r=t.attribute.points;const s=t.attribute.segments;!r&&s&&s.length&&(r=s.reduce((a,l)=>{var h;return a.concat((h=l.points)!==null&&h!==void 0?h:[])},[])),r&&r.length!==0||(r=[e]);const o=i==="start"?0:r.length-1;return r[o]?{x1:r[o].x,x2:r[o].x,y1:r[o].y,y2:r[o].y}:void 0}labeling(t,e,i="end",r=0){return UHt(t,e,i,r)}};pI.defaultAttributes={textStyle:{fill:"#000"},position:"end",offset:6};const Ztt=()=>{yf("line",pI),yf("area",pI)};var szt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class ozt{constructor(t,e,i,r,s,o,a,l,h){this.refDatum=t,this.center=e,this.outerCenter=i,this.quadrant=r,this.radian=s,this.middleAngle=o,this.innerRadius=a,this.outerRadius=l,this.circleCenter=h,this.labelVisible=!0}getLabelBounds(){return this.labelPosition&&this.labelSize?{x1:this.labelPosition.x-this.labelSize.width/2,y1:this.labelPosition.y-this.labelSize.height/2,x2:this.labelPosition.x+this.labelSize.width/2,y2:this.labelPosition.y+this.labelSize.height/2}:{x1:0,x2:0,y1:0,y2:0}}}class gT extends Kd{constructor(t,e){const{data:i}=t,r=szt(t,["data"]);super(e!=null&&e.skipDefault?t:Object.assign({data:i},Z({},gT.defaultAttributes,r))),this.name="arc-label",this._ellipsisWidth=0,this._arcLeft=new Map,this._arcRight=new Map,this._line2MinLength=0,this._alignOffset=0}_overlapping(t){return["inside","inside-center"].includes(this.attribute.position)?super._overlapping(t):t}labeling(t,e,i="outside",r=0){if(t&&e)return{x:0,y:0}}_layout(t){var e,i,r;if(!t||!t.length)return;const s=super._layout(t),o=s.map(c=>this.getGraphicBounds(c)),a=Object.assign(Object.assign({},this.attribute.textStyle),{text:""});let l=1/0;if(a.ellipsis!==!1){const c=this._createLabelText(a),g=this.getGraphicBounds(c);l=g.x2-g.x1}const h=s.map(c=>c.attribute),d=Array.from(this._idToGraphic.values());this._line2MinLength=it(this.attribute.line.line2MinLength)?this.attribute.line.line2MinLength(t,d,this.attribute):this.attribute.line.line2MinLength,this._alignOffset=(e=it(this.attribute.layout.alignOffset)?this.attribute.layout.alignOffset(t,d,this.attribute):this.attribute.layout.alignOffset)!==null&&e!==void 0?e:0;const u=this.layoutArcLabels(this.attribute.position,this.attribute,d,h,o,l);for(let c=0;c<h.length;c++){const g=h[c],p=u.find(f=>{var m;return((m=f.refDatum)===null||m===void 0?void 0:m.id)===g.id});if(p){const f={visible:p.labelVisible,x:p.labelPosition.x,y:p.labelPosition.y,angle:p.angle,points:p.pointA&&p.pointB&&p.pointC?[p.pointA,p.pointB,p.pointC]:void 0,line:p.labelLine};s[c].type==="richtext"?f.width=(i=p.labelLimit)!==null&&i!==void 0?i:s[c].attribute.width:f.maxLineWidth=(r=p.labelLimit)!==null&&r!==void 0?r:s[c].attribute.maxLineWidth,p.refArc&&p.refArc.type==="arc3d"&&(f.anchor3d=[p.circleCenter.x-f.x,p.circleCenter.y-f.y],f.beta=p.refArc.attribute.beta),s[c].setAttributes(f)}}return s}layoutArcLabels(t,e,i,r,s,o){this._arcLeft.clear(),this._arcRight.clear(),this._ellipsisWidth=o;let a=0;i.forEach(u=>{u.attribute.outerRadius>a&&(a=u.attribute.outerRadius)}),r.forEach((u,c)=>{var g,p;const f=this._idToGraphic.get(u.id),m=f.attribute,v={x:(g=m==null?void 0:m.x)!==null&&g!==void 0?g:0,y:(p=m==null?void 0:m.y)!==null&&p!==void 0?p:0};if(!D(r[c])&&!D(s[c])){const _=r[c]?r[c]:null,b=s[c]?s[c]:{x1:0,x2:0,y1:0,y2:0},y=(m.startAngle+m.endAngle)/2,C=m.endAngle-m.startAngle,S=kY(m.endAngle-C/2),w=ui(v,m.outerRadius,y),x=ui(v,a+e.line.line1MinLength,y),A=new ozt(_,w,x,S,C,y,m.innerRadius,m.outerRadius,v);A.refArc=f,A.pointA=ui(v,this.computeDatumRadius(2*v.x,2*v.y,m.outerRadius),A.middleAngle),A.labelSize={width:b.x2-b.x1,height:b.y2-b.y1},WHt(A.quadrant)?this._arcRight.set(A.refDatum,A):au(A.quadrant)&&this._arcLeft.set(A.refDatum,A)}});const l=Array.from(this._arcLeft.values()),h=Array.from(this._arcRight.values()),d=[];switch(t){case"inside":case"inside-inner":case"inside-outer":case"inside-center":d.push(...this._layoutInsideLabels(h,e,i)),d.push(...this._layoutInsideLabels(l,e,i));break;default:d.push(...this._layoutOutsideLabels(h,e,i)),d.push(...this._layoutOutsideLabels(l,e,i))}return d}_layoutInsideLabels(t,e,i){var r,s;const o=e,a=o.spaceWidth,l=(r=o.position)!==null&&r!==void 0?r:"inside",h=(s=o.offsetRadius)!==null&&s!==void 0?s:-a;return t.forEach(d=>{var u,c,g;const{labelSize:p,radian:f}=d,m=d.innerRadius,v=d.outerRadius;let _;if(f<NHt(v,p.height))_=0;else{let x;x=f>=Math.PI?m:Math.max(m,p.height/2/Math.tan(f/2)),_=v-x-a}o.rotate!==!0&&(_=v-a);const b=this._getFormatLabelText(d.refDatum,_);d.labelText=b;const y=Math.min(_,d.labelSize.width),C=this._computeAlign(d,e);let S,w=0;if(l==="inside"&&(w=C==="left"?y:C==="right"?0:y/2),S=l==="inside-inner"?m-h+w:l==="inside-center"?m+(v-m)/2:v+h-w,d.labelPosition=ui(d.circleCenter,S,d.middleAngle),d.labelLimit=y,Rl(y,0)||(d.labelVisible=!1),o.rotate!==!1){d.angle=(c=(u=e.textStyle)===null||u===void 0?void 0:u.angle)!==null&&c!==void 0?c:d.middleAngle;let x=(g=o.offsetAngle)!==null&&g!==void 0?g:0;["inside-inner","inside-outer"].includes(l)&&(x+=Math.PI/2),d.angle+=x}}),t}_layoutOutsideLabels(t,e,i){var r,s,o;const a=(r=i[0].attribute.x)!==null&&r!==void 0?r:0,l=2*((s=i[0].attribute.y)!==null&&s!==void 0?s:0),h=e.layout,d=e.spaceWidth;if(t.forEach(c=>{const g=au(c.quadrant)?-1:1;c.labelPosition={x:c.outerCenter.x+g*(c.labelSize.width/2+this._line2MinLength+d),y:c.outerCenter.y}}),t.sort((c,g)=>c.labelPosition.y-g.labelPosition.y),e.coverEnable!==!1||h.strategy==="none"){for(const c of t){const{labelPosition:g,labelSize:p}=c;c.labelLimit=p.width,c.pointB=au(c.quadrant)?{x:g.x+p.width/2+this._line2MinLength+d,y:g.y}:{x:g.x-p.width/2-this._line2MinLength-d,y:g.y},this._computeX(c,e,i)}e.coverEnable===!1&&h.strategy==="none"&&this._coverLabels(t)}else{const c=l/(((o=e.textStyle)===null||o===void 0?void 0:o.fontSize)||16);this._adjustY(t,c,e,i);const{minY:g,maxY:p}=t.reduce((v,_)=>{const{y1:b,y2:y}=_.getLabelBounds();return v.minY=Math.max(0,Math.min(b,v.minY)),v.maxY=Math.min(l,Math.max(y,v.maxY)),v},{minY:1/0,maxY:-1/0}),f=Math.max(Math.abs(l/2-g),Math.abs(p-l/2)),m=this._computeLayoutRadius(f,e,i);for(const v of t)this._computePointB(v,m,e,i),this._computeX(v,e,i)}const u=2*a;return t.forEach(c=>{var g,p;c.labelVisible&&(xa(c.pointB.x,this._line2MinLength+d)||Rl(c.pointB.x,u-this._line2MinLength-d))&&(c.labelVisible=!1),c.angle=(p=(g=e.textStyle)===null||g===void 0?void 0:g.angle)!==null&&p!==void 0?p:0,e.offsetAngle&&(c.angle+=e.offsetAngle),c.labelLine=Object.assign(Object.assign({},e.line),{visible:c.labelVisible})}),t}_computeX(t,e,i){var r;const s=t.circleCenter,o=0,a=this.attribute.width;this.attribute.height;let l=0;i.forEach(A=>{A.attribute.outerRadius>l&&(l=A.attribute.outerRadius)});const h=this.computeLayoutOuterRadius(l,e.width,e.height),d=e.line.line1MinLength,u=(r=e.layout)===null||r===void 0?void 0:r.align,c=e.spaceWidth,{labelPosition:g,quadrant:p,pointB:f}=t;et(f.x*f.y)||(t.pointC={x:NaN,y:NaN},g.x=NaN,t.labelLimit=0);const m=this.computeRadius(h,e.width,e.height),v=au(p)?-1:1;let _=0,b=(v>0?a-f.x:f.x-o)+this._alignOffset-this._line2MinLength-c;u==="labelLine"&&(_=(m+d+this._line2MinLength)*v+s.x,b=(v>0?a-_:_-o)-c);const y=this._getFormatLabelText(t.refDatum,b);t.labelText=y;let C=Math.min(b,t.labelSize.width);switch(u){case"labelLine":break;case"edge":_=v>0?a-C-c:o+C+c;break;default:_=f.x+v*this._line2MinLength}C=Math.max(this._ellipsisWidth,C);const S=C<t.labelSize.width-1;t.labelLimit=S?C:null,t.pointC={x:_,y:g.y};const w=this._computeAlign(t,e),x=XHt(w)*(S?C:t.labelSize.width);u==="edge"?(g.x=(v>0?a:o)-v*x+v*this._alignOffset,t.pointC.x+=v*this._alignOffset):g.x=_+v*(this._alignOffset+c+x)}_computeAlign(t,e){var i,r,s,o,a,l;const h=e,d=(r=(i=h.textStyle)===null||i===void 0?void 0:i.textAlign)!==null&&r!==void 0?r:(s=h.textStyle)===null||s===void 0?void 0:s.align,u=(a=(o=h.layout)===null||o===void 0?void 0:o.textAlign)!==null&&a!==void 0?a:(l=h.layout)===null||l===void 0?void 0:l.align;return h.position!=="inside"?D(d)||d==="auto"?u==="edge"?au(t.quadrant)?"left":"right":au(t.quadrant)?"right":"left":d:D(d)||d==="auto"?"center":d}_getFormatLabelText(t,e){var i;return(i=t==null?void 0:t.text)!==null&&i!==void 0?i:""}_adjustY(t,e,i,r){var s;r[0].attribute.x;const o=2*((s=r[0].attribute.y)!==null&&s!==void 0?s:0),a=i.layout;if(a.strategy==="vertical"){let l,h=0;const d=t.length;if(d<=0)return;for(let c=0;c<d;c++){const{y1:g}=t[c].getLabelBounds();if(l=g-h,xa(l,0)){const f=this._shiftY(t,c,d-1,-l);this._shiftY(t,f,0,l/2)}const{y2:p}=t[c].getLabelBounds();h=p}const{y1:u}=t[0].getLabelBounds();l=u-0,xa(l,0)&&this._shiftY(t,0,d-1,-l);for(let c=t.length-1;c>=0&&t[c].getLabelBounds().y2>o;c--)t[c].labelVisible=!1}else if(a.strategy!=="none"){const l=t.map((u,c)=>({arc:u,originIndex:c,priorityIndex:0}));l.sort((u,c)=>c.arc.radian-u.arc.radian),l.forEach((u,c)=>{u.priorityIndex=c,u.arc.labelVisible=!1});let h=1/0,d=-1/0;for(let u=0;u<e&&u<t.length;u++){this._storeY(t);const c=l[u].arc;this._computeYRange(c,i,r),c.labelVisible=!0;const g=c.labelPosition.y,{lastIndex:p,nextIndex:f}=this._findNeighborIndex(t,l[u]),m=t[p],v=t[f];if(p===-1&&f!==-1){const C=v.labelPosition.y;g>C?c.labelPosition.y=C-v.labelSize.height/2-c.labelSize.height/2:this._twoWayShift(t,c,v,f)}else if(p!==-1&&f===-1){const C=m.labelPosition.y;g<C?c.labelPosition.y=C+m.labelSize.height/2+c.labelSize.height/2:this._twoWayShift(t,m,c,l[u].originIndex)}else if(p!==-1&&f!==-1){const C=m.labelPosition.y,S=v.labelPosition.y;g>S?(c.labelPosition.y=S-v.labelSize.height/2-c.labelSize.height/2,this._twoWayShift(t,m,c,l[u].originIndex)):g<C?(c.labelPosition.y=C+m.labelSize.height/2+c.labelSize.height/2,this._twoWayShift(t,c,v,f)):(this._twoWayShift(t,m,c,l[u].originIndex),this._twoWayShift(t,c,v,f))}const _=Math.min(h,l[u].originIndex),b=Math.max(d,l[u].originIndex);let y;if(y=t[b].getLabelBounds().y2-o,Rl(y,0)&&this._shiftY(t,b,0,-y),y=t[_].getLabelBounds().y1-0,xa(y,0)&&this._shiftY(t,_,t.length-1,-y),y=t[b].getLabelBounds().y2-o,Rl(y,0)){c.labelVisible=!1,this._restoreY(t);break}a.tangentConstraint&&!this._checkYRange(t)?(c.labelVisible=!1,this._restoreY(t)):(h=_,d=b)}}}_shiftY(t,e,i,r){const s=e<i?1:-1;let o=e;for(;o!==-1;){t[o].labelPosition.y+=r;const a=this._findNextVisibleIndex(t,o,i,s);if(a>=0&&a<t.length){const{y1:l,y2:h}=t[o].getLabelBounds(),{y1:d,y2:u}=t[a].getLabelBounds();if(s>0&&h<d||s<0&&l>u)return o}o=a}return i}_findNextVisibleIndex(t,e,i,r){const s=(i-e)*r;for(let o=1;o<=s;o++){const a=e+o*r;if(t[a].labelVisible)return a}return-1}_computePointB(t,e,i,r){const s=i;let o=0;r.forEach(h=>{h.attribute.outerRadius>o&&(o=h.attribute.outerRadius)});const a=this.computeLayoutOuterRadius(o,i.width,i.height),l=s.line.line1MinLength;if(s.layout.strategy==="none")t.pointB={x:t.outerCenter.x,y:t.outerCenter.y};else{const h=t.circleCenter,d=this.computeRadius(a,i.width,i.height),{labelPosition:u,quadrant:c}=t,g=e-Math.max(d+l,t.outerRadius),p=Math.sqrt(e**2-Math.abs(h.y-u.y)**2)-g;et(p)?t.pointB={x:h.x+p*(au(c)?-1:1),y:u.y}:t.pointB={x:NaN,y:NaN}}}_storeY(t){for(const e of t)e.labelVisible&&(e.lastLabelY=e.labelPosition.y)}_computeYRange(t,e,i){const r=t.circleCenter,s={width:2*r.x,height:2*r.y};let o=0;i.forEach(C=>{C.attribute.outerRadius>o&&(o=C.attribute.outerRadius)});const a=this.computeLayoutOuterRadius(o,e.width,e.height),l=e.line.line1MinLength,{width:h,height:d}=s,u=this.computeRadius(a,e.width,e.height),c=this._computeLayoutRadius(d/2,e,i),g=Math.abs(t.center.x-h/2),p=t.center.y-d/2;let f,m,v;if(di(h/2,g))f=0,m=1,v=-p;else if(di(d/2,p))f=1,m=0,v=-g;else{const C=-1/(p/g);f=C,m=-1,v=p-C*g}const _=jHt(f,m,v,l+u-c,0,c);if(_.length<2)return;let b,y;_[0].x>_[1].x&&_.reverse(),_[0].x<0?di(_[0].y,_[1].y)?Rl(t.middleAngle,-Math.PI)&&xa(t.middleAngle,0)||Rl(t.middleAngle,Math.PI)&&xa(t.middleAngle,2*Math.PI)?(b=0,y=_[1].y+d/2):(b=_[1].y+d/2,y=d):_[0].y<_[1].y?(b=0,y=_[1].y+d/2):(b=_[1].y+d/2,y=s.height):(b=Math.min(_[0].y,_[1].y)+d/2,y=Math.max(_[0].y,_[1].y)+d/2),t.labelYRange=[b,y]}_computeLayoutRadius(t,e,i){const r=e,s=r.layoutArcGap,o=r.line.line1MinLength;let a=0;i.forEach(u=>{u.attribute.outerRadius>a&&(a=u.attribute.outerRadius)});const l=this.computeLayoutOuterRadius(a,e.width,e.height),h=this.computeRadius(l,e.width,e.height)+o,d=h-s;return Math.max((d**2+t**2)/(2*d),h)}_findNeighborIndex(t,e){const i=e.originIndex;let r=-1,s=-1;for(let o=i-1;o>=0;o--)if(t[o].labelVisible){r=o;break}for(let o=i+1;o<t.length;o++)if(t[o].labelVisible){s=o;break}return{lastIndex:r,nextIndex:s}}_twoWayShift(t,e,i,r){const s=i.getLabelBounds().y1-e.getLabelBounds().y2;if(xa(s,0)){const o=this._shiftY(t,r,t.length-1,-s);this._shiftY(t,o,0,s/2)}}_restoreY(t){for(const e of t)e.labelVisible&&(e.labelPosition.y=e.lastLabelY)}_checkYRange(t){for(const e of t){const{labelYRange:i,labelPosition:r}=e;if(e.labelVisible&&i&&(xa(r.y,i[0])||Rl(r.y,i[1])))return!1}return!0}_coverLabels(t){if(t.length<=1)return;let e=t[0].getLabelBounds();for(let i=1;i<t.length;i++){const r=t[i].getLabelBounds();$Ht(e,r)?t[i].labelVisible=!1:e=r}}_getLabelLinePoints(t,e){return t.attribute.points}_createLabelLine(t,e){var i,r,s,o,a;const{line:l={},visible:h}=t.attribute,d=super._createLabelLine(t,e);if(d&&(d.setAttributes({visible:(s=(i=l.visible&&h)!==null&&i!==void 0?i:(r=t.attribute)===null||r===void 0?void 0:r.visible)===null||s===void 0||s,lineWidth:(a=(o=l.style)===null||o===void 0?void 0:o.lineWidth)!==null&&a!==void 0?a:1}),l.smooth&&d.setAttributes({curveType:"basis"}),e.type==="arc3d"&&e)){const{beta:u,x:c,y:g}=e.attribute;d.setAttributes({beta:u,anchor3d:[c,g]})}return d}computeRadius(t,e,i,r){return this.computeLayoutRadius(e||0,i||0)*t*(D(r)?1:r)}computeLayoutRadius(t,e){return Math.min(t/2,e/2)}_canPlaceInside(t,e){return this.attribute.position==="inside"||this.attribute.position==="inside-center"}computeLayoutOuterRadius(t,e,i){return t/(Math.min(e,i)/2)}computeDatumRadius(t,e,i){const r=this.computeLayoutOuterRadius(i,t,e);return this.computeLayoutRadius(t||0,e||0)*r}}gT.defaultAttributes={coverEnable:!1,spaceWidth:5,layoutArcGap:6,textStyle:{visible:!0,fontSize:14,fontWeight:"normal",fillOpacity:1,boundsPadding:[-1,0,-1,0],ellipsis:!0},position:"outside",line:{visible:!0,line1MinLength:20,line2MinLength:10},layout:{align:"arc",strategy:"priority",tangentConstraint:!0}};const azt=()=>{yf("arc",gT)};var lzt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class pT extends En{constructor(t,e){const{dataLabels:i}=t,r=lzt(t,["dataLabels"]);super(e!=null&&e.skipDefault?t:Object.assign({dataLabels:i},Z({},pT.defaultAttributes,r))),this.name="data-label"}render(){var t;const{dataLabels:e,size:i}=this.attribute;if(!e||e.length===0)return;const{width:r=0,height:s=0,padding:o}=i||{};if(!r||!s||!et(s*r))return;this._componentMap||(this._componentMap=new Map);const a=Ytt(r,s,o),l=a.bitmap(),h=new Map,d=this._componentMap;for(let u=0;u<e.length;u++){const c=e[u],g=tzt(c.type)||Kd;if(g){const{baseMarkGroupName:p,type:f}=c,m=(t=c.id)!==null&&t!==void 0?t:`${p}-${f}-${u}`;c.type==="arc"&&(c.width=i.width,c.height=i.height);let v=this._componentMap.get(m);v?(v.setBitmapTool(a),v.setBitmap(l),v.setAttributes(c),h.set(m,v)):(v=new g(c),v.setBitmap(l),v.setBitmapTool(a),this.add(v),h.set(m,v))}}d.forEach((u,c)=>{h.get(c)||this.removeChild(u)}),this._componentMap=h}setLocation(t){this.translateTo(t.x,t.y)}disableAnimation(){this._componentMap.forEach(t=>{t.disableAnimation()})}enableAnimation(){this._componentMap.forEach(t=>{t.enableAnimation()})}}pT.defaultAttributes={pickable:!1};function fI(n,t,e,i){let r="";if(!n||t.length===0)return r;const s=t[0],o=hi.distancePP(n,s),a=e?0:1;return i?r+=`M${n.x},${n.y-o}A${o},${o},0,0,${a},${n.x},${n.y+o}A${o},${o},0,0,${a},${n.x},${n.y-o}Z`:t.forEach((l,h)=>{h===0?r=`M${l.x},${l.y}`:r+=`A${o},${o},0,0,${a},${l.x},${l.y}`}),r}function hzt(n,t,e){const{type:i,closed:r}=e,s=t.slice(0).reverse();let o="",a="";if(i==="line"&&e.smoothLink&&e.center){const l=n[0],h=s[0],d=e.center;o=Wu(n,!!r),a=Wu(s,!!r);const u=hi.distancePP(h,d),c=hi.distancePP(l,d);o+=`A${u},${u},0,0,1,${h.x},${h.y}L${h.x},${h.y}`,a+=`A${c},${c},0,0,0,${l.x},${l.y}`}else if(i==="circle"){const{center:l}=e;o=fI(l,n,!1,!!r),a=fI(l,s,!0,!!r)}else i!=="line"&&i!=="polygon"||(o=Wu(n,!!r),a=Wu(s,!!r));return r?o+=a:(a="L"+a.substring(1),o+=a,o+="Z"),o}class Ed extends En{constructor(){super(...arguments),this.name="axis-grid",this.data=[]}getInnerView(){return this._innerView}getPrevInnerView(){return this._prevInnerView}render(){this._prevInnerView=this._innerView&&Stt(this._innerView),this.removeAllChild(!0),this._innerView=Pt.group({x:0,y:0,pickable:!1}),this.add(this._innerView);const{items:t,visible:e}=this.attribute;t&&t.length&&e!==!1&&(this.data=this._transformItems(t),this._renderGrid(this._innerView))}getVerticalCoord(t,e,i){return _F(t,this.getVerticalVector(e,i,t))}_transformItems(t){const e=[];return t.forEach(i=>{var r;e.push(Object.assign(Object.assign({},i),{point:this.getTickCoord(i.value),id:(r=i.id)!==null&&r!==void 0?r:i.label}))}),e}_renderGrid(t){const{visible:e}=this.attribute.subGrid||{};e&&this._renderGridByType(!0,t),this._renderGridByType(!1,t)}_renderGridByType(t,e){const i=Z({},this.attribute,this.getGridAttribute(t)),{type:r,items:s,style:o,closed:a,alternateColor:l,depth:h=0}=i,d=t?`${_n.grid}-sub`:`${_n.grid}`;if(s.forEach((u,c)=>{const{id:g,points:p}=u;let f="";if(r==="line"||r==="polygon")f=Wu(p,!!a);else if(r==="circle"){const{center:v}=this.attribute;f=fI(v,p,!1,!!a)}const m=Pt.path(Object.assign({path:f,z:h},it(o)?Z({},this.skipDefault?null:Ed.defaultAttributes.style,o(u,c)):o));m.name=`${d}-line`,m.id=this._getNodeId(`${d}-path-${g}`),e.add(m)}),h&&r==="line"&&s.forEach((u,c)=>{const{id:g,points:p}=u,f=[];f.push(p[0]);const m=p[1].x-p[0].x,v=p[1].y-p[0].y,_=Math.sqrt(m*m+v*v),b=h/_;f.push({x:p[0].x+m*b,y:p[0].y+v*b});const y=Wu(f,!!a),C=Et(f[0].x-f[1].x),S=Et(f[0].y-f[1].y),w=Pt.path(Object.assign({path:y,z:0,alpha:C>S?(p[1].x-p[0].x>0?-1:1)*Kt/2:0,beta:C<S?-Kt/2:0,anchor3d:C>S?[f[0].x,0]:[0,f[0].y]},it(o)?Z({},this.skipDefault?null:Ed.defaultAttributes.style,o(u,c)):o));w.name=`${d}-line`,w.id=this._getNodeId(`${d}-path-${g}`),e.add(w)}),s.length>1&&l){const u=V(l)?l:[l,"transparent"],c=y=>u[y%u.length],g=this.attribute.items,p=g[0],f=g[g.length-1],m=!di(p.value,0)&&!di(f.value,0),v=!di(p.value,1)&&!di(f.value,1),_=[],b=p.value>f.value;(b&&v||!b&&m)&&_.push(this.getGridPointsByValue(b?1:0)),s.forEach(y=>{_.push(y.points)}),(b&&m||!b&&v)&&_.push(this.getGridPointsByValue(b?0:1));for(let y=0;y<_.length-1;y++){const C=hzt(_[y],_[y+1],i),S=Pt.path({path:C,fill:c(y)});S.name=`${d}-region`,S.id=this._getNodeId(`${d}-region-${y}`),e.add(S)}}}_getNodeId(t){return`${this.id}-${t}`}_parseTickSegment(){let t=1;return this.data.length>=2&&(t=this.data[1].value-this.data[0].value),t}_getPointsOfSubGrid(t,e){const i=this.data.length,r=[];return i>=2&&this.data.forEach(s=>{let o=s.value;if(!e){const a=s.value-t/2;if(this.isInValidValue(a))return;o=a}r.push({value:o})}),r}release(){super.release(),this._prevInnerView=null,this._innerView=null}}Ed.defaultAttributes={style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]},subGrid:{visible:!1,style:{lineWidth:1,stroke:"#999",strokeOpacity:1,lineDash:[4,4]}}};tHt();class Jtt extends Ed{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Ed.defaultAttributes,t),e)}_getGridPoint(t,e){let i;if(t==="line"){const{length:r}=this.attribute;i=[e,this.getVerticalCoord(e,r,!0)]}else if(t==="circle"||t==="polygon"){const{center:r,sides:s=6,startAngle:o=_f,endAngle:a=bf}=this.attribute,l=hi.distancePP(r,e);i=xtt(r,s,l,o,a)}return i}getGridPointsByValue(t){const e=this.getTickCoord(t);return this._getGridPoint(this.attribute.type,e)}getGridAttribute(t){const{type:e,alignWithLabel:i=!0}=this.attribute,r=this._parseTickSegment();let s,o=[];if(t){s=Z({},this.attribute,this.attribute.subGrid);const a=[],{count:l=4}=s;if(this.data.length>=2){const h=this._getPointsOfSubGrid(r,i);for(let d=0;d<h.length-1;d++){const u=h[d],c=h[d+1];a.push({id:`sub-${d}-0`,points:this.getGridPointsByValue(u.value),datum:{}});for(let g=0;g<l;g++){const p=(g+1)/(l+1),f=(1-p)*u.value+p*c.value;a.push({id:`sub-${d}-${g+1}`,points:this.getGridPointsByValue(f),datum:{}})}d===h.length-2&&a.push({id:`sub-${d}-${l+1}`,points:this.getGridPointsByValue(c.value),datum:{}})}o=a}}else{s=this.attribute;const a=[];this.data.forEach(l=>{let{point:h}=l;if(!i){const d=l.value-r/2;if(this.isInValidValue(d))return;h=this.getTickCoord(d)}a.push({id:l.label,datum:l,points:this._getGridPoint(e,h)})}),o=a}return Object.assign(Object.assign({},s),{items:o})}}Ye(Jtt,Ptt);var dzt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};eHt();class Qtt extends Ed{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Ed.defaultAttributes,t),e)}getGridPointsByValue(t){const e=this.getTickCoord(t),{radius:i,innerRadius:r=0}=this.attribute;return[e,this.getVerticalCoord(e,i-r,!0)]}getGridAttribute(t){let e,i=[];const r=this.attribute,{radius:s,innerRadius:o=0,startAngle:a=_f,endAngle:l=bf,center:h,subGrid:d}=r,u=dzt(r,["radius","innerRadius","startAngle","endAngle","center","subGrid"]),{alignWithLabel:c=!0}=u||{},g=s-o,p=this._parseTickSegment();if(t){e=Z({},u,d);const f=[],{count:m=4}=d||{},v=this.data.length;if(v>=2){const _=this._getPointsOfSubGrid(p,c);for(let b=0;b<v;b++){const y=_[b],C=_[b+1];f.push({id:`sub-${b}-0`,points:[this.getTickCoord(y.value),this.getVerticalCoord(this.getTickCoord(y.value),g,!0)],datum:{}});for(let S=0;S<m;S++){const w=(S+1)/(m+1),x=(1-w)*y.value+w*(C?C.value:c?1:y.value+p),A=this.getTickCoord(x),M=this.getVerticalCoord(A,g,!0);f.push({id:`sub-${b}-${S+1}`,points:[A,M],datum:{}})}}Math.abs(l-a)%(2*Math.PI)==0&&f.push(f[0]),i=f}}else{e=u;const f=[];let m;m=Math.abs(l-a)%(2*Math.PI)==0?[...this.data].concat(this.data[0]):this.data,m.forEach(v=>{let{point:_}=v;if(!c){const y=v.value-p/2;if(this.isInValidValue(y))return;_=this.getTickCoord(y)}const b=this.getVerticalCoord(_,g,!0);f.push({id:v.id,points:[_,b],datum:v})}),i=f}return Object.assign(Object.assign({},e),{items:i,center:h,type:"line"})}}Ye(Qtt,Ltt);const dU="M -0.0544 0.25 C -0.0742 0.25 -0.0901 0.234 -0.0901 0.2143 L -0.0901 -0.1786 C -0.0901 -0.1983 -0.0742 -0.2143 -0.0544 -0.2143 L -0.0187 -0.2143 L -0.0187 -0.5 L 0.017 -0.5 L 0.017 -0.2143 L 0.0527 -0.2143 C 0.0724 -0.2143 0.0884 -0.1983 0.0884 -0.1786 L 0.0884 0.2143 C 0.0884 0.234 0.0724 0.25 0.0527 0.25 L 0.017 0.25 L 0.017 0.5 L -0.0187 0.5 L -0.0187 0.25 L -0.0544 0.25 Z M -0.0187 -0.1429 L -0.0544 -0.1429 L -0.0544 0.1786 L -0.0187 0.1786 L -0.0187 -0.1429 Z M 0.0527 -0.1429 L 0.017 -0.1429 L 0.017 0.1786 L 0.0527 0.1786 L 0.0527 -0.1429 Z",uzt={orient:"bottom",showDetail:"auto",brushSelect:!0,zoomLock:!1,minSpan:0,maxSpan:1,delayType:"throttle",delayTime:0,realTime:!0,backgroundStyle:{fill:"white",stroke:"#D1DBEE",lineWidth:1,cornerRadius:2},dragMaskStyle:{fill:"#B0C8F9",fillOpacity:.2},backgroundChartStyle:{area:{visible:!0,stroke:"#D1DBEE",lineWidth:1,fill:"#F6F8FC"},line:{visible:!0,stroke:"#D1DBEE",lineWidth:1}},selectedBackgroundStyle:{fill:"#B0C8F9",fillOpacity:.5},selectedBackgroundChartStyle:{area:{visible:!0,stroke:"#B0C8F9",lineWidth:1,fill:"#fbb934"},line:{visible:!0,stroke:"#fbb934",lineWidth:1}},middleHandlerStyle:{visible:!0,background:{size:8,style:{fill:"white",stroke:"#B0C8F9",cornerRadius:2}},icon:{size:6,fill:"white",stroke:"#B0C8F9",symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}},startHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:dU,fill:"white",stroke:"#B0C8F9",lineWidth:.5},endHandlerStyle:{visible:!0,triggerMinSize:0,symbolType:dU,fill:"white",stroke:"#B0C8F9",lineWidth:.5},startTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}},endTextStyle:{padding:4,textStyle:{fontSize:10,fill:"#6F6F6F"}}},Th={horizontal:{angle:0,strokeBoundsBuffer:0,boundsPadding:2,pickMode:"imprecise",cursor:"ew-resize"},vertical:{angle:Math.PI/180*90,cursor:"ns-resize",boundsPadding:2,pickMode:"imprecise",strokeBoundsBuffer:0}};var Br;(function(n){n.startHandler="startHandler",n.endHandler="endHandler",n.middleHandler="middleHandler",n.background="background"})(Br||(Br={}));function czt(){rT(),fh(),Bo(),stt(),ph()}var uU=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const gzt={debounce:ah,throttle:ha};czt();let tet=class eet extends En{setPropsFromAttrs(){const{start:t,end:e,orient:i,previewData:r,previewPointsX:s,previewPointsY:o,previewPointsX1:a,previewPointsY1:l}=this.attribute;t&&(this.state.start=t),e&&(this.state.end=e);const{width:h,height:d}=this.getLayoutAttrFromConfig();this._spanCache=this.state.end-this.state.start,this._isHorizontal=i==="top"||i==="bottom",this._layoutCache.max=this._isHorizontal?h:d,this._layoutCache.attPos=this._isHorizontal?"x":"y",this._layoutCache.attSize=this._isHorizontal?"width":"height",r&&(this._previewData=r),it(s)&&(this._previewPointsX=s),it(o)&&(this._previewPointsY=o),it(a)&&(this._previewPointsX1=a),it(l)&&(this._previewPointsY1=l)}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},eet.defaultAttributes,t)),this.name="dataZoom",this._previewData=[],this._activeState=!1,this._activeCache={startPos:{x:0,y:0},lastPos:{x:0,y:0}},this._layoutCache={attPos:"x",attSize:"width",max:0},this.state={start:0,end:1},this._statePointToData=s=>s,this._handleTouchMove=s=>{this._activeState&&s.preventDefault()},this._onHandlerPointerDown=(s,o)=>{this._clearDragEvents(),o==="start"?(this._activeTag=Br.startHandler,this._activeItem=this._startHandlerMask):o==="end"?(this._activeTag=Br.endHandler,this._activeItem=this._endHandlerMask):o==="middleRect"?(this._activeTag=Br.middleHandler,this._activeItem=this._middleHandlerRect):o==="middleSymbol"?(this._activeTag=Br.middleHandler,this._activeItem=this._middleHandlerSymbol):o==="background"&&(this._activeTag=Br.background,this._activeItem=this._background),this._activeState=!0,this._activeCache.startPos=this.eventPosToStagePos(s),this._activeCache.lastPos=this.eventPosToStagePos(s);const a=le.env==="browser"?le:this.stage,l=ic();a.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),this.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),l.forEach(h=>{a.addEventListener(h,this._onHandlerPointerUp)})},this._pointerMove=s=>{const{start:o,end:a,brushSelect:l,realTime:h=!0}=this.attribute,d=this.eventPosToStagePos(s),{attPos:u,max:c}=this._layoutCache,g=(d[u]-this._activeCache.lastPos[u])/c;let{start:p,end:f}=this.state;this._activeState&&(this._activeTag===Br.middleHandler?this.moveZoomWithMiddle((this.state.start+this.state.end)/2+g):this._activeTag===Br.startHandler?p+g>f?(p=f,f=p+g,this._activeTag=Br.endHandler):p+=g:this._activeTag===Br.endHandler&&(f+g<p?(f=p,p=f+g,this._activeTag=Br.startHandler):f+=g),this._activeCache.lastPos=d,l&&this.renderDragMask()),p=Math.min(Math.max(p,0),1),f=Math.min(Math.max(f,0),1),o===p&&a===f||(this.setStateAttr(p,f,!0),h&&this._dispatchEvent("change",{start:p,end:f,tag:this._activeTag}))},this._onHandlerPointerMove=this.attribute.delayTime===0?this._pointerMove:gzt[this.attribute.delayType](this._pointerMove,this.attribute.delayTime),this._onHandlerPointerUp=s=>{const{start:o,end:a,brushSelect:l,realTime:h=!0}=this.attribute;if(this._activeState&&this._activeTag===Br.background){const d=this.eventPosToStagePos(s);this.backgroundDragZoom(this._activeCache.startPos,d)}this._activeState=!1,l&&this.renderDragMask(),this._dispatchEvent("change",{start:this.state.start,end:this.state.end,tag:this._activeTag}),this._clearDragEvents()};const{position:i,showDetail:r}=t;this._activeCache.startPos=i,this._activeCache.lastPos=i,this._showText=r!=="auto"&&r,this.setPropsFromAttrs()}setAttributes(t,e){super.setAttributes(t,e),this.setPropsFromAttrs()}bindEvents(){if(this.attribute.disableTriggerEvent)return void this.setAttribute("childrenPickable",!1);const{showDetail:t,brushSelect:e}=this.attribute;this._startHandlerMask&&this._startHandlerMask.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,"start")),this._endHandlerMask&&this._endHandlerMask.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,"end")),this._middleHandlerSymbol&&this._middleHandlerSymbol.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,"middleSymbol")),this._middleHandlerRect&&this._middleHandlerRect.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,"middleRect"));const i=e?"background":"middleRect";this._selectedBackground&&this._selectedBackground.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,i)),e&&this._background&&this._background.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,"background")),e&&this._previewGroup&&this._previewGroup.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,"background")),this._selectedPreviewGroup&&this._selectedPreviewGroup.addEventListener("pointerdown",r=>this._onHandlerPointerDown(r,i)),t==="auto"&&(this.addEventListener("pointerenter",this._onHandlerPointerEnter),this.addEventListener("pointerleave",this._onHandlerPointerLeave)),(le.env==="browser"?le:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1})}dragMaskSize(){const{position:t}=this.attribute,{attPos:e,max:i}=this._layoutCache;return this._activeCache.lastPos[e]-t[e]>i?i+t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-t[e]<0?t[e]-this._activeCache.startPos[e]:this._activeCache.lastPos[e]-this._activeCache.startPos[e]}setStateAttr(t,e,i){const{zoomLock:r=!1,minSpan:s=0,maxSpan:o=1}=this.attribute,a=e-t;a!==this._spanCache&&(r||a<s||a>o)||(this._spanCache=a,this.state.start=t,this.state.end=e,i&&this.setAttributes({start:t,end:e}))}eventPosToStagePos(t){var e,i;return(i=(e=this.stage)===null||e===void 0?void 0:e.eventPointTransform(t))!==null&&i!==void 0?i:{x:0,y:0}}_clearDragEvents(){const t=le.env==="browser"?le:this.stage,e=ic();t.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),e.forEach(i=>{t.removeEventListener(i,this._onHandlerPointerUp)}),this.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0})}_onHandlerPointerEnter(t){this._showText=!0,this.renderText()}_onHandlerPointerLeave(t){this._showText=!1,this.renderText()}backgroundDragZoom(t,e){const{attPos:i,max:r}=this._layoutCache,{position:s}=this.attribute,o=t[i]-s[i],a=e[i]-s[i],l=Math.min(Math.max(Math.min(o,a)/r,0),1),h=Math.min(Math.max(Math.max(o,a)/r,0),1);Math.abs(l-h)<.01?this.moveZoomWithMiddle(l):this.setStateAttr(l,h,!1)}moveZoomWithMiddle(t){let e=t-(this.state.start+this.state.end)/2;e!==0&&(e>0?this.state.end+e>1&&(e=1-this.state.end):e<0&&this.state.start+e<0&&(e=-this.state.start),this.setStateAttr(this.state.start+e,this.state.end+e,!1))}renderDragMask(){const{dragMaskStyle:t}=this.attribute,{position:e,width:i,height:r}=this.getLayoutAttrFromConfig();this._isHorizontal?this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:Ne(this.dragMaskSize()<0?this._activeCache.lastPos.x:this._activeCache.startPos.x,e.x,e.x+i),y:e.y,width:this._activeState&&this._activeTag===Br.background&&Math.abs(this.dragMaskSize())||0,height:r},t),"rect"):this._dragMask=this._container.createOrUpdateChild("dragMask",Object.assign({x:e.x,y:Ne(this.dragMaskSize()<0?this._activeCache.lastPos.y:this._activeCache.startPos.y,e.y,e.y+r),width:i,height:this._activeState&&this._activeTag===Br.background&&Math.abs(this.dragMaskSize())||0},t),"rect")}isTextOverflow(t,e,i){if(!e)return!1;if(this._isHorizontal){if(i==="start"){if(e.x1<t.x1)return!0}else if(e.x2>t.x2)return!0}else if(i==="start"){if(e.y1<t.y1)return!0}else if(e.y2>t.y2)return!0;return!1}setTextAttr(t,e){var i,r,s,o,a,l,h,d;const{startTextStyle:u,endTextStyle:c}=this.attribute,{formatMethod:g}=u,p=uU(u,["formatMethod"]),{formatMethod:f}=c,m=uU(c,["formatMethod"]),{start:v,end:_}=this.state;this._startValue=this._statePointToData(v),this._endValue=this._statePointToData(_);const{position:b,width:y,height:C}=this.getLayoutAttrFromConfig(),S=g?g(this._startValue):this._startValue,w=f?f(this._endValue):this._endValue,x={x1:b.x,y1:b.y,x2:b.x+y,y2:b.y+C};let A,M,T,R;this._isHorizontal?(A={x:b.x+v*y,y:b.y+C/2},M={x:b.x+_*y,y:b.y+C/2},T={textAlign:this.isTextOverflow(x,t,"start")?"left":"right",textBaseline:(r=(i=p==null?void 0:p.textStyle)===null||i===void 0?void 0:i.textBaseline)!==null&&r!==void 0?r:"middle"},R={textAlign:this.isTextOverflow(x,e,"end")?"right":"left",textBaseline:(o=(s=m==null?void 0:m.textStyle)===null||s===void 0?void 0:s.textBaseline)!==null&&o!==void 0?o:"middle"}):(A={x:b.x+y/2,y:b.y+v*C},M={x:b.x+y/2,y:b.y+_*C},T={textAlign:(l=(a=p==null?void 0:p.textStyle)===null||a===void 0?void 0:a.textAlign)!==null&&l!==void 0?l:"center",textBaseline:this.isTextOverflow(x,t,"start")?"top":"bottom"},R={textAlign:(d=(h=m==null?void 0:m.textStyle)===null||h===void 0?void 0:h.textAlign)!==null&&d!==void 0?d:"center",textBaseline:this.isTextOverflow(x,e,"end")?"bottom":"top"}),this._startText=this.maybeAddLabel(this._container,Z({},p,{text:S,x:A.x,y:A.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:T}),`data-zoom-start-text-${b}`),this._endText=this.maybeAddLabel(this._container,Z({},m,{text:w,x:M.x,y:M.y,visible:this._showText,pickable:!1,childrenPickable:!1,textStyle:R}),`data-zoom-end-text-${b}`)}renderText(){let t=null,e=null;this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds,this.setTextAttr(t,e),t=this._startText.AABBBounds,e=this._endText.AABBBounds;const{x1:i,x2:r,y1:s,y2:o}=t,{dx:a=0,dy:l=0}=this.attribute.startTextStyle;if(new Bi().set(i,s,r,o).intersects(e)){const h=this.attribute.orient==="bottom"||this.attribute.orient==="right"?-1:1;this._isHorizontal?this._startText.setAttribute("dy",l+h*Math.abs(e.y1-e.y2)):this._startText.setAttribute("dx",a+h*Math.abs(e.x1-e.x2))}else this._isHorizontal?this._startText.setAttribute("dy",l):this._startText.setAttribute("dx",a)}getLayoutAttrFromConfig(){var t,e,i,r,s,o;if(this._layoutAttrFromConfig)return this._layoutAttrFromConfig;const{position:a,size:l,orient:h,middleHandlerStyle:d={},startHandlerStyle:u={},endHandlerStyle:c={},backgroundStyle:g={}}=this.attribute,{width:p,height:f}=l,m=(e=(t=d.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10;let v,_,b;d.visible?this._isHorizontal?(v=p,_=f-m,b={x:a.x,y:a.y+m}):(v=p-m,_=f,b={x:a.x+(h==="left"?m:0),y:a.y}):(v=p,_=f,b=a);const y=(i=u.size)!==null&&i!==void 0?i:this._isHorizontal?_:v,C=(r=c.size)!==null&&r!==void 0?r:this._isHorizontal?_:v;return u.visible&&(this._isHorizontal?(v-=(y+C)/2,b={x:b.x+y/2,y:b.y}):(_-=(y+C)/2,b={x:b.x,y:b.y+y/2})),_+=(s=g.lineWidth/2)!==null&&s!==void 0?s:1,v+=(o=g.lineWidth/2)!==null&&o!==void 0?o:1,this._layoutAttrFromConfig={position:b,width:v,height:_},this._layoutAttrFromConfig}render(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T,R,B,E,k,P,I,O;this._layoutAttrFromConfig=null;const{orient:H,backgroundStyle:z,backgroundChartStyle:F={},selectedBackgroundStyle:j={},selectedBackgroundChartStyle:$={},middleHandlerStyle:Y={},startHandlerStyle:G={},endHandlerStyle:tt={},brushSelect:st,zoomLock:ot}=this.attribute,{start:rt,end:pt}=this.state,{position:at,width:W,height:N}=this.getLayoutAttrFromConfig(),K=(t=G.triggerMinSize)!==null&&t!==void 0?t:40,nt=(e=tt.triggerMinSize)!==null&&e!==void 0?e:40,X=this.createOrUpdateChild("dataZoom-container",{},"group");if(this._container=X,this._background=X.createOrUpdateChild("background",Object.assign(Object.assign({x:at.x,y:at.y,width:W,height:N,cursor:st?"crosshair":"auto"},z),{pickable:!ot&&((i=z.pickable)===null||i===void 0||i)}),"rect"),!((r=F.line)===null||r===void 0)&&r.visible&&this.setPreviewAttributes("line",X),!((s=F.area)===null||s===void 0)&&s.visible&&this.setPreviewAttributes("area",X),st&&this.renderDragMask(),this._isHorizontal?this._selectedBackground=X.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:at.x+rt*W,y:at.y,width:(pt-rt)*W,height:N,cursor:st?"crosshair":"move"},j),{pickable:!ot&&((o=$.pickable)===null||o===void 0||o)}),"rect"):this._selectedBackground=X.createOrUpdateChild("selectedBackground",Object.assign(Object.assign({x:at.x,y:at.y+rt*N,width:W,height:(pt-rt)*N,cursor:st?"crosshair":"move"},j),{pickable:!ot&&((a=j.pickable)===null||a===void 0||a)}),"rect"),!((l=$.line)===null||l===void 0)&&l.visible&&this.setSelectedPreviewAttributes("line",X),!((h=$.area)===null||h===void 0)&&h.visible&&this.setSelectedPreviewAttributes("area",X),this._isHorizontal){if(Y.visible){const ut=((d=Y.background)===null||d===void 0?void 0:d.size)||10;this._middleHandlerRect=X.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:at.x+rt*W,y:at.y-ut,width:(pt-rt)*W,height:ut},(u=Y.background)===null||u===void 0?void 0:u.style),{pickable:!ot&&((p=(g=(c=Y.background)===null||c===void 0?void 0:c.style)===null||g===void 0?void 0:g.pickable)===null||p===void 0||p)}),"rect"),this._middleHandlerSymbol=X.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:at.x+(rt+pt)/2*W,y:at.y-ut/2,strokeBoundsBuffer:0,angle:0,symbolType:(m=(f=Y.icon)===null||f===void 0?void 0:f.symbolType)!==null&&m!==void 0?m:"square"},Y.icon),{pickable:!ot&&((v=Y.icon.pickable)===null||v===void 0||v)}),"symbol")}this._startHandler=X.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:at.x+rt*W,y:at.y+N/2,size:N,symbolType:(_=G.symbolType)!==null&&_!==void 0?_:"square"},Th.horizontal),G),{pickable:!ot&&((b=G.pickable)===null||b===void 0||b)}),"symbol"),this._endHandler=X.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:at.x+pt*W,y:at.y+N/2,size:N,symbolType:(y=tt.symbolType)!==null&&y!==void 0?y:"square"},Th.horizontal),tt),{pickable:!ot&&((C=tt.pickable)===null||C===void 0||C)}),"symbol");const ht=Math.max(this._startHandler.AABBBounds.width(),K),_t=Math.max(this._startHandler.AABBBounds.height(),K),ct=Math.max(this._endHandler.AABBBounds.width(),nt),U=Math.max(this._endHandler.AABBBounds.height(),nt);this._startHandlerMask=X.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:at.x+rt*W-ht/2,y:at.y+N/2-_t/2,width:ht,height:_t,fill:"white",fillOpacity:0,zIndex:999},Th.horizontal),{pickable:!ot}),"rect"),this._endHandlerMask=X.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:at.x+pt*W-ct/2,y:at.y+N/2-U/2,width:ct,height:U,fill:"white",fillOpacity:0,zIndex:999},Th.horizontal),{pickable:!ot}),"rect")}else{if(Y.visible){const ut=((S=Y.background)===null||S===void 0?void 0:S.size)||10;this._middleHandlerRect=X.createOrUpdateChild("middleHandlerRect",Object.assign(Object.assign({x:H==="left"?at.x-ut:at.x+W,y:at.y+rt*N,width:ut,height:(pt-rt)*N},(w=Y.background)===null||w===void 0?void 0:w.style),{pickable:!ot&&((M=(A=(x=Y.background)===null||x===void 0?void 0:x.style)===null||A===void 0?void 0:A.pickable)===null||M===void 0||M)}),"rect"),this._middleHandlerSymbol=X.createOrUpdateChild("middleHandlerSymbol",Object.assign(Object.assign({x:H==="left"?at.x-ut/2:at.x+W+ut/2,y:at.y+(rt+pt)/2*N,angle:Math.PI/180*90,symbolType:(R=(T=Y.icon)===null||T===void 0?void 0:T.symbolType)!==null&&R!==void 0?R:"square",strokeBoundsBuffer:0},Y.icon),{pickable:!ot&&((E=(B=Y.icon)===null||B===void 0?void 0:B.pickable)===null||E===void 0||E)}),"symbol")}this._startHandler=X.createOrUpdateChild("startHandler",Object.assign(Object.assign(Object.assign({x:at.x+W/2,y:at.y+rt*N,size:W,symbolType:(k=G.symbolType)!==null&&k!==void 0?k:"square"},Th.vertical),G),{pickable:!ot&&((P=G.pickable)===null||P===void 0||P)}),"symbol"),this._endHandler=X.createOrUpdateChild("endHandler",Object.assign(Object.assign(Object.assign({x:at.x+W/2,y:at.y+pt*N,size:W,symbolType:(I=tt.symbolType)!==null&&I!==void 0?I:"square"},Th.vertical),tt),{pickable:!ot&&((O=tt.pickable)===null||O===void 0||O)}),"symbol");const ht=Math.max(this._startHandler.AABBBounds.width(),K),_t=Math.max(this._startHandler.AABBBounds.height(),K),ct=Math.max(this._endHandler.AABBBounds.width(),nt),U=Math.max(this._endHandler.AABBBounds.height(),nt);this._startHandlerMask=X.createOrUpdateChild("startHandlerMask",Object.assign(Object.assign({x:at.x+W/2+ht/2,y:at.y+rt*N-_t/2,width:U,height:ct,fill:"white",fillOpacity:0,zIndex:999},Th.vertical),{pickable:!ot}),"rect"),this._endHandlerMask=X.createOrUpdateChild("endHandlerMask",Object.assign(Object.assign({x:at.x+W/2+ct/2,y:at.y+pt*N-U/2,width:U,height:ct,fill:"white",fillOpacity:0,zIndex:999},Th.vertical),{pickable:!ot}),"rect")}this._showText&&this.renderText()}computeBasePoints(){const{orient:t}=this.attribute,{position:e,width:i,height:r}=this.getLayoutAttrFromConfig();let s,o;return this._isHorizontal?(s=[{x:e.x,y:e.y+r}],o=[{x:e.x+i,y:e.y+r}]):t==="left"?(s=[{x:e.x+i,y:e.y}],o=[{x:e.x+i,y:e.y+r}]):(s=[{x:e.x,y:e.y+r}],o=[{x:e.x,y:e.y}]),{basePointStart:s,basePointEnd:o}}simplifyPoints(t){var e;if(t.length>1e4){const i=(e=this.attribute.tolerance)!==null&&e!==void 0?e:this._previewData.length/1e4;return m2t(t,i)}return t}getPreviewLinePoints(){let t=this._previewData.map(r=>({x:this._previewPointsX&&this._previewPointsX(r),y:this._previewPointsY&&this._previewPointsY(r)}));if(t.length===0)return t;t=this.simplifyPoints(t);const{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}getPreviewAreaPoints(){let t=this._previewData.map(r=>({x:this._previewPointsX&&this._previewPointsX(r),y:this._previewPointsY&&this._previewPointsY(r),x1:this._previewPointsX1&&this._previewPointsX1(r),y1:this._previewPointsY1&&this._previewPointsY1(r)}));if(t.length===0)return t;t=this.simplifyPoints(t);const{basePointStart:e,basePointEnd:i}=this.computeBasePoints();return e.concat(t).concat(i)}setPreviewAttributes(t,e){this._previewGroup||(this._previewGroup=e.createOrUpdateChild("previewGroup",{pickable:!1},"group")),t==="line"?this._previewLine=this._previewGroup.createOrUpdateChild("previewLine",{},"line"):this._previewArea=this._previewGroup.createOrUpdateChild("previewArea",{curveType:"basis"},"area");const{backgroundChartStyle:i={}}=this.attribute;t==="line"&&this._previewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._previewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}setSelectedPreviewAttributes(t,e){this._selectedPreviewGroupClip||(this._selectedPreviewGroupClip=e.createOrUpdateChild("selectedPreviewGroupClip",{pickable:!1},"group"),this._selectedPreviewGroup=this._selectedPreviewGroupClip.createOrUpdateChild("selectedPreviewGroup",{},"group")),t==="line"?this._selectedPreviewLine=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewLine",{},"line"):this._selectedPreviewArea=this._selectedPreviewGroup.createOrUpdateChild("selectedPreviewArea",{curveType:"basis"},"area");const{selectedBackgroundChartStyle:i={}}=this.attribute,{start:r,end:s}=this.state,{position:o,width:a,height:l}=this.getLayoutAttrFromConfig();this._selectedPreviewGroupClip.setAttributes({x:this._isHorizontal?o.x+r*a:o.x,y:this._isHorizontal?o.y:o.y+r*l,width:this._isHorizontal?(s-r)*a:a,height:this._isHorizontal?l:(s-r)*l,clip:!0,pickable:!1}),this._selectedPreviewGroup.setAttributes({x:-(this._isHorizontal?o.x+r*a:o.x),y:-(this._isHorizontal?o.y:o.y+r*l),width:this._isHorizontal?(s-r)*a:a,height:this._isHorizontal?l:(s-r)*l,pickable:!1}),t==="line"&&this._selectedPreviewLine.setAttributes(Object.assign({points:this.getPreviewLinePoints(),curveType:"basis",pickable:!1},i.line)),t==="area"&&this._selectedPreviewArea.setAttributes(Object.assign({points:this.getPreviewAreaPoints(),curveType:"basis",pickable:!1},i.area))}maybeAddLabel(t,e,i){let r=this.find(s=>s.name===i,!0);return r?r.setAttributes(e):(r=new Ja(e),r.name=i),t.add(r),r}setStartAndEnd(t,e){const{start:i,end:r}=this.attribute;L(t)&&L(e)&&(t!==this.state.start||e!==this.state.end)&&(this.state.start=t,this.state.end=e,i===this.state.start&&r===this.state.end||(this.setStateAttr(t,e,!0),this._dispatchEvent("change",{start:t,end:e,tag:this._activeTag})))}setPreviewData(t){this._previewData=t}setText(t,e){e==="start"?this._startText.setAttribute("text",t):this._endText.setAttribute("text",t)}getStartValue(){return this._startValue}getEndTextValue(){return this._endValue}getMiddleHandlerSize(){var t,e,i,r;const{middleHandlerStyle:s={}}=this.attribute,o=(e=(t=s.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:10,a=(r=(i=s.icon)===null||i===void 0?void 0:i.size)!==null&&r!==void 0?r:10;return Math.max(o,...Q(a))}setPreviewPointsX(t){it(t)&&(this._previewPointsX=t)}setPreviewPointsY(t){it(t)&&(this._previewPointsY=t)}setPreviewPointsX1(t){it(t)&&(this._previewPointsX1=t)}setPreviewPointsY1(t){it(t)&&(this._previewPointsY1=t)}setStatePointToData(t){it(t)&&(this._statePointToData=t)}release(t){super.release(t),(le.env==="browser"?le:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearDragEvents()}};tet.defaultAttributes=uzt;var mI;(function(n){n.start="start",n.startTop="startTop",n.startBottom="startBottom",n.insideStart="insideStart",n.insideStartTop="insideStartTop",n.insideStartBottom="insideStartBottom",n.middle="middle",n.insideMiddleTop="insideMiddleTop",n.insideMiddleBottom="insideMiddleBottom",n.end="end",n.endTop="endTop",n.endBottom="endBottom",n.insideEnd="insideEnd",n.insideEndTop="insideEndTop",n.insideEndBottom="insideEndBottom"})(mI||(mI={}));var vI;(function(n){n.left="left",n.right="right",n.top="top",n.bottom="bottom",n.topLeft="topLeft",n.topRight="topRight",n.bottomLeft="bottomLeft",n.bottomRight="bottomRight",n.middle="middle",n.insideLeft="insideLeft",n.insideRight="insideRight",n.insideTop="insideTop",n.insideBottom="insideBottom",n.insideTopLeft="insideTopLeft",n.insideTopRight="insideTopRight",n.insideBottomLeft="insideBottomLeft",n.insideBottomRight="insideBottomRight"})(vI||(vI={}));var Vn;(function(n){n.arcInnerStart="arcInnerStart",n.arcInnerEnd="arcInnerEnd",n.arcInnerMiddle="arcInnerMiddle",n.arcOuterStart="arcOuterStart",n.arcOuterEnd="arcOuterEnd",n.arcOuterMiddle="arcOuterMiddle",n.center="center"})(Vn||(Vn={}));var _I;(function(n){n.top="top",n.bottom="bottom",n.middle="middle",n.insideTop="insideTop",n.insideBottom="insideBottom",n.insideMiddle="insideMiddle"})(_I||(_I={}));function Sb(){Xi(),rT()}function pzt(){Sb(),fF()}function fzt(){Sb(),mF()}function mzt(){Sb(),iT()}function vzt(){Sb(),Gf()}function _zt(){Sb(),fF(),mF(),Bo(),ott(),ph()}class fT extends En{constructor(){super(...arguments),this.name="marker",this._onHover=t=>{this._lastHover=wtt(t,this._container,this._lastHover)},this._onUnHover=t=>{this._lastHover=Att(t,this._container,this._lastHover)},this._onClick=t=>{this._lastSelect=Mtt(t,this._container,this._lastSelect)}}transAnimationConfig(){var t,e,i;if(this.attribute.animation!==!1){const r=kt(this.attribute.animation)?this.attribute.animation:{};this._animationConfig={enter:Z({},this.defaultUpdateAnimation,r,(t=this.attribute.animationEnter)!==null&&t!==void 0?t:{}),exit:Z({},this.defaultExitAnimation,r,(e=this.attribute.animationExit)!==null&&e!==void 0?e:{}),update:Z({},this.defaultUpdateAnimation,r,(i=this.attribute.animationUpdate)!==null&&i!==void 0?i:{})}}}setAttribute(t,e,i){super.setAttribute(t,e,i),t==="visible"&&this.render()}_bindEvent(){var t,e,i;if(!this.attribute.interactive)return;const{hover:r,select:s}=this.attribute;r&&((t=this._container)===null||t===void 0||t.addEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.addEventListener("pointerout",this._onUnHover)),s&&((i=this._container)===null||i===void 0||i.addEventListener("pointerdown",this._onClick))}_releaseEvent(){var t,e,i;(t=this._container)===null||t===void 0||t.removeEventListener("pointermove",this._onHover),(e=this._container)===null||e===void 0||e.removeEventListener("pointerout",this._onUnHover),(i=this._container)===null||i===void 0||i.removeEventListener("pointerdown",this._onClick)}_initContainer(){var t,e;const{limitRect:i={},clipInRange:r}=this.attribute;let s;if(r){const o=Pt.group(Object.assign(Object.assign({},i),{clip:!0,pickable:!1}));s=Pt.group({x:-((t=i.x)!==null&&t!==void 0?t:0),y:-((e=i.y)!==null&&e!==void 0?e:0),pickable:!1}),o.add(s),this._containerClip=o,this.add(o)}else s=Pt.group({x:0,y:0,pickable:!1}),this.add(s);s.name="marker-container",this._container=s}_updateContainer(){var t,e;const{limitRect:i={},clipInRange:r}=this.attribute;this._containerClip&&this._containerClip.setAttributes(Object.assign({},i)),this._container.setAttributes({x:r?-((t=i.x)!==null&&t!==void 0?t:0):0,y:r?-((e=i.y)!==null&&e!==void 0?e:0):0})}render(){var t;this.transAnimationConfig(),this.setAttribute("pickable",!1);const e=(t=this.attribute.visible)===null||t===void 0||t;this.attribute.interactive===!1&&this.setAttribute("childrenPickable",!1),e&&this.isValidPoints()?this._container?(this._updateContainer(),this.updateMarker(),this.markerAnimate("update")):(this._initContainer(),this.initMarker(this._container),this.markerAnimate("enter")):(this.markerAnimate("exit"),this._container=null,this.removeAllChild(!0)),this._releaseEvent(),this._bindEvent()}release(){this.markerAnimate("exit"),super.release(),this._releaseEvent(),this._container=null}}function wn(n,t,e,i){var r,s,o,a,l;if(!n)return;(r=n==null?void 0:n.animates)===null||r===void 0||r.forEach(u=>u.stop("end"));const h=(o=(s=n.attribute)===null||s===void 0?void 0:s.fillOpacity)!==null&&o!==void 0?o:1,d=(l=(a=n.attribute)===null||a===void 0?void 0:a.strokeOpacity)!==null&&l!==void 0?l:1;n.setAttributes({fillOpacity:0,strokeOpacity:0}),n.animate().wait(t).to({fillOpacity:h,strokeOpacity:d},e,i)}function iet(n,t,e,i){n&&(wn(n.startSymbol,t,e,i),n.lines.forEach(r=>wn(r,t,e,i)),wn(n.line,t,e,i),wn(n.endSymbol,t,e,i))}function mT(n,t,e,i){n&&(wn(n.getTextShape(),t,e,i),wn(n.getBgRect(),t,e,i))}function za(n,t,e,i){var r,s,o,a;n&&(n.setAttributes({fillOpacity:(s=(r=n.attribute)===null||r===void 0?void 0:r.fillOpacity)!==null&&s!==void 0?s:1,strokeOpacity:(a=(o=n.attribute)===null||o===void 0?void 0:o.strokeOpacity)!==null&&a!==void 0?a:1}),n.animate().wait(t).to({fillOpacity:0,strokeOpacity:0},e,i))}function net(n,t,e,i){n&&(za(n.startSymbol,t,e,i),n.lines.forEach(r=>za(r,t,e,i)),za(n.line,t,e,i),za(n.endSymbol,t,e,i))}function vT(n,t,e,i){n&&(za(n.getTextShape(),t,e,i),za(n.getBgRect(),t,e,i))}function cU(n,t,e,i,r){const s=.1*e,o=.7*e,a=.1*e,l=.1*e;wn(n.startSymbol,i,s,r),n.lines.forEach(h=>h.setAttribute("clipRange",0)),n.lines.forEach((h,d)=>{const u=o/n.lines.length;h.animate().wait(i+s+d*u).to({clipRange:1},u,r)}),wn(n.endSymbol,i+s+o,a,r),Q(t).forEach(h=>{const d=i+s+o+a;wn(h.getTextShape(),d,l,r),wn(h.getBgRect(),d,l,r)})}function gU(n,t,e,i,r){iet(n,i,e,r),Q(t).forEach(s=>{mT(s,i,e,r)})}function pU(n,t,e,i,r){wn(n,i,e,r),Q(t).forEach(s=>{mT(s,i,e,r)})}function fU(n,t,e,i,r){wn(n,i,e,r),Q(t).forEach(s=>{mT(s,i,e,r)})}function mU(n,t,e,i,r,s){var o;iet(n,r,i,s),wn(t,r,i,s),!((o=e.getTextShape)===null||o===void 0)&&o.call(e)?mT(e,r,i,s):wn(e,r,i,s)}function bzt(n,t,e,i,r){net(n,i,e,r),Q(t).forEach(s=>{vT(s,i,e,r)})}function yzt(n,t,e,i,r){za(n,i,e,r),Q(t).forEach(s=>{vT(s,i,e,r)})}function Czt(n,t,e,i,r){za(n,i,e,r),Q(t).forEach(s=>{vT(s,i,e,r)})}function Szt(n,t,e,i,r,s){var o;net(n,r,i,s),za(t,r,i,s),!((o=e.getTextShape)===null||o===void 0)&&o.call(e)?vT(e,r,i,s):za(e,r,i,s)}function vU(n,t,e,i,r,s){var o;const a=.1*i,l=.65*i,h=.05*i,d=.1*i,u=.1*i;wn(n.startSymbol,r,a,s),n.lines.forEach(c=>c.setAttribute("clipRange",0)),n.lines.forEach((c,g)=>{const p=l/n.lines.length;c.animate().wait(r+a+g*p).to({clipRange:1},p,s)}),wn(t,r+a+l,h,s),wn(n.endSymbol,r+a+l+h,d,s),!((o=e.getTextShape)===null||o===void 0)&&o.call(e)?(wn(e.getTextShape(),r+a+l+h+d,u,s),wn(e.getBgRect(),r+a+l+d,u,s)):wn(e,r+a+l+d,u,s)}function ret(n,t,e,i){const{enter:r,update:s,exit:o}=e;if(i==="enter"){const{type:a,duration:l,delay:h,easing:d}=r;a==="clipIn"?cU(n,t,l,h,d):a==="fadeIn"&&gU(n,t,l,h,d)}else if(i==="update"){const{type:a,duration:l,delay:h,easing:d}=s;a==="clipIn"?cU(n,t,l,h,d):a==="fadeIn"&&gU(n,t,l,h,d)}else if(i==="exit"){const{duration:a,delay:l,easing:h}=o;bzt(n,t,a,l,h)}}function xzt(n,t,e,i){const{enter:r,update:s,exit:o}=e;if(i==="enter"){const{type:a,duration:l,delay:h,easing:d}=r;a==="fadeIn"&&pU(n,t,l,h,d)}else if(i==="update"){const{type:a,duration:l,delay:h,easing:d}=s;a==="fadeIn"&&pU(n,t,l,h,d)}else if(i==="exit"){const{duration:a,delay:l,easing:h}=o;yzt(n,t,a,l,h)}}function wzt(n,t,e,i){const{enter:r,update:s,exit:o}=e;if(i==="enter"){const{type:a,duration:l,delay:h,easing:d}=r;a==="fadeIn"&&fU(n,t,l,h,d)}else if(i==="update"){const{type:a,duration:l,delay:h,easing:d}=s;a==="fadeIn"&&fU(n,t,l,h,d)}else if(i==="exit"){const{duration:a,delay:l,easing:h}=o;Czt(n,t,a,l,h)}}function Azt(n,t,e,i){const[r,s]=n,{enter:o,update:a,exit:l}=e;if(i==="enter"){const{type:h,duration:d,delay:u,easing:c}=o;h==="fadeIn"?mU(r,s,t,d,u,c):h==="callIn"&&vU(r,s,t,d,u,c)}else if(i==="update"){const{type:h,duration:d,delay:u,easing:c}=a;h==="fadeIn"?mU(r,s,t,d,u,c):h==="callIn"&&vU(r,s,t,d,u,c)}else if(i==="exit"){const{duration:h,delay:d,easing:u}=l;Szt(r,s,t,h,d,u)}}const Mzt={type:"clipIn",duration:500,easing:"linear",delay:0},set={type:"fadeIn",duration:500,easing:"linear",delay:0},Tzt={type:"callIn",duration:500,easing:"linear",delay:0},_T={type:"fadeOut",duration:500,easing:"linear",delay:0};class SF{getLabel(){return this._label}_addMarkLabels(t,e,i){const{label:r,state:s}=this.attribute,o=Q(s==null?void 0:s.label),a=Q(s==null?void 0:s.labelBackground),l=Q(r).map((h,d)=>{var u,c;const g=Z({},i,h),p=new Ja(Object.assign(Object.assign({},g),{state:{panel:Z({},Se,(u=a[d])!==null&&u!==void 0?u:de(a)),text:Z({},Se,(c=o[d])!==null&&c!==void 0?c:de(o))}}));return p.name=e,t.add(p),this.setLabelPos(p,g),p});this._label=Q(l).length===1?l[0]:l}_updateMarkLabels(t){const{label:e,state:i}=this.attribute,r=Q(this._label),s=Q(i==null?void 0:i.label),o=Q(i==null?void 0:i.labelBackground);if(r.length){const a=Q(e);r.forEach((l,h)=>{var d,u;const c=Z({},t,a[h]);l.setAttributes(Object.assign(Object.assign({dx:0,dy:0},c),{state:{panel:Z({},Se,(d=o[h])!==null&&d!==void 0?d:de(o)),text:Z({},Se,(u=s[h])!==null&&u!==void 0?u:de(s))}})),this.setLabelPos(l,c)})}}}class xF extends fT{constructor(){super(...arguments),this.name="markCommonLine",this.defaultUpdateAnimation=Mzt,this.defaultExitAnimation=_T}getLine(){return this._line}setLabelPos(t,e){const{limitRect:i}=this.attribute,{position:r,confine:s,autoRotate:o}=e,a=this.getPointAttrByPosition(r,e),l=r.toString().toLocaleLowerCase().includes("start")?this._line.getStartAngle()||0:this._line.getEndAngle()||0;if(t.setAttributes(Object.assign(Object.assign({},a.position),{angle:o?this.getRotateByAngle(a.angle,e):0,textStyle:Object.assign(Object.assign({},this.getTextStyle(r,l,o)),e.textStyle)})),i&&s){const{x:h,y:d,width:u,height:c}=i;pF(t,{x1:h,y1:d,x2:h+u,y2:d+c})}}initMarker(t){const e=this.createSegment();e.name="mark-common-line-line",this._line=e,t.add(e),this.addMarkLineLabels(t)}updateMarker(){this.setLineAttributes(),this.updateMarkLineLabels()}}Ye(xF,SF);const Ma=.001,kzt={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{position:mI.end,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},_U={postiveXAxis:{start:{textAlign:"left",textBaseline:"middle"},startTop:{textAlign:"left",textBaseline:"bottom"},startBottom:{textAlign:"left",textBaseline:"top"},insideStart:{textAlign:"right",textBaseline:"middle"},insideStartTop:{textAlign:"right",textBaseline:"bottom"},insideStartBottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"left",textBaseline:"middle"},endTop:{textAlign:"left",textBaseline:"bottom"},endBottom:{textAlign:"left",textBaseline:"top"},insideEnd:{textAlign:"right",textBaseline:"middle"},insideEndTop:{textAlign:"right",textBaseline:"bottom"},insideEndBottom:{textAlign:"right",textBaseline:"top"}},negativeXAxis:{start:{textAlign:"right",textBaseline:"middle"},startTop:{textAlign:"right",textBaseline:"bottom"},startBottom:{textAlign:"right",textBaseline:"top"},insideStart:{textAlign:"left",textBaseline:"middle"},insideStartTop:{textAlign:"left",textBaseline:"bottom"},insideStartBottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"center",textBaseline:"middle"},insideMiddleTop:{textAlign:"center",textBaseline:"bottom"},insideMiddleBottom:{textAlign:"center",textBaseline:"top"},end:{textAlign:"right",textBaseline:"middle"},endTop:{textAlign:"right",textBaseline:"bottom"},endBottom:{textAlign:"right",textBaseline:"top"},insideEnd:{textAlign:"left",textBaseline:"middle"},insideEndTop:{textAlign:"left",textBaseline:"bottom"},insideEndBottom:{textAlign:"left",textBaseline:"top"}}},Rzt={interactive:!0,startSymbol:{visible:!1,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},endSymbol:{visible:!0,symbolType:"triangle",size:12,fill:"rgba(46, 47, 50)",lineWidth:0},label:{autoRotate:!0,position:Vn.arcOuterMiddle,refX:0,refY:0,refAngle:0,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},lineStyle:{stroke:"#b2bacf",lineWidth:1,lineDash:[2]}},Bzt={interactive:!0,label:{position:vI.right,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}},Pzt={interactive:!0,label:{autoRotate:!0,position:Vn.arcOuterMiddle,textStyle:{fill:"#fff",stroke:"#fff",lineWidth:0,fontSize:10,fontWeight:"normal",fontStyle:"normal"},padding:[2,2,4,4],panel:{visible:!0,cornerRadius:0,fill:"rgb(48, 115, 242)",fillOpacity:.8}},areaStyle:{fill:"#b2bacf",visible:!0}},oet={arcInnerStart:{textAlign:"center",textBaseline:"bottom"},arcInnerEnd:{textAlign:"center",textBaseline:"bottom"},arcInnerMiddle:{textAlign:"center",textBaseline:"bottom"},arcOuterStart:{textAlign:"center",textBaseline:"top"},arcOuterEnd:{textAlign:"center",textBaseline:"top"},arcOuterMiddle:{textAlign:"center",textBaseline:"top"},center:{textAlign:"center",textBaseline:"middle"}},Ezt={left:{textAlign:"right",textBaseline:"middle"},insideLeft:{textAlign:"left",textBaseline:"middle"},right:{textAlign:"left",textBaseline:"middle"},insideRight:{textAlign:"right",textBaseline:"middle"},top:{textAlign:"center",textBaseline:"bottom"},insideTop:{textAlign:"center",textBaseline:"top"},bottom:{textAlign:"center",textBaseline:"top"},insideBottom:{textAlign:"center",textBaseline:"bottom"},middle:{textAlign:"center",textBaseline:"middle"},topLeft:{textAlign:"right",textBaseline:"top"},insideTopLeft:{textAlign:"left",textBaseline:"top"},topRight:{textAlign:"left",textBaseline:"top"},insideTopRight:{textAlign:"right",textBaseline:"top"},bottomLeft:{textAlign:"right",textBaseline:"bottom"},insideBottomLeft:{textAlign:"left",textBaseline:"bottom"},bottomRight:{textAlign:"left",textBaseline:"bottom"},insideBottomRight:{textAlign:"right",textBaseline:"bottom"}},Lzt={interactive:!0,targetSymbol:{visible:!1,offset:0,style:{symbolType:"circle",size:20,fill:!1,stroke:"rgba(46, 47, 50)"}},itemLine:{visible:!0,decorativeLine:{visible:!1,length:30},startSymbol:{visible:!0,clip:!0,symbolType:"circle",size:20,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},endSymbol:{visible:!1,clip:!0,symbolType:"triangle",size:12,style:{fill:!1,stroke:"rgba(46, 47, 50)"}},lineStyle:{stroke:"#000",lineWidth:1}},itemContent:{type:"text",position:"middle",refX:10,symbolStyle:{symbolType:"star",fill:"rgb(48, 115, 242)",fillOpacity:.8,size:20},textStyle:{dx:0,dy:0},imageStyle:{width:80,height:80},richTextStyle:{width:100,height:100}}},bU={postiveXAxis:{top:{textAlign:"left",textBaseline:"bottom"},bottom:{textAlign:"left",textBaseline:"top"},middle:{textAlign:"left",textBaseline:"middle"},insideTop:{textAlign:"right",textBaseline:"bottom"},insideBottom:{textAlign:"right",textBaseline:"top"},insideMiddle:{textAlign:"right",textBaseline:"middle"}},negativeXAxis:{top:{textAlign:"right",textBaseline:"bottom"},bottom:{textAlign:"right",textBaseline:"top"},middle:{textAlign:"right",textBaseline:"middle"},insideTop:{textAlign:"left",textBaseline:"bottom"},insideBottom:{textAlign:"left",textBaseline:"top"},insideMiddle:{textAlign:"left",textBaseline:"middle"}}};pzt();function aet(){Oa._animate=ret}class Oa extends xF{markerAnimate(t){Oa._animate&&this._animationConfig&&Oa._animate(this._line,this._label,this._animationConfig,t)}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Oa.defaultAttributes,t)),this.name="markLine"}getPointAttrByPosition(t,e){var i;const{refX:r=0,refY:s=0}=e,o=this._line.getMainSegmentPoints(),a=(i=this._line.getEndAngle())!==null&&i!==void 0?i:0,l=a,h=r*Math.cos(l)+s*Math.cos(l-Math.PI/2),d=r*Math.sin(l)+s*Math.sin(l-Math.PI/2);return t.includes("start")||t.includes("Start")?{position:{x:o[0].x+h,y:o[0].y+d},angle:l}:t.includes("middle")||t.includes("Middle")?{position:{x:(o[0].x+o[o.length-1].x)/2+h,y:(o[0].y+o[o.length-1].y)/2+d},angle:l}:{position:{x:o[o.length-1].x+h,y:o[o.length-1].y+d},angle:l}}getRotateByAngle(t,e){var i;return(Dw(t)?t:t-Math.PI)+((i=e.refAngle)!==null&&i!==void 0?i:0)}getTextStyle(t,e,i){return wa(Math.abs(e),Math.PI/2,Ma)||wa(Math.abs(e),3*Math.PI/2,Ma)?dtt(i,e,t):Dw(e)?_U.postiveXAxis[t]:_U.negativeXAxis[t]}createSegment(){const{points:t,startSymbol:e,endSymbol:i,lineStyle:r,mainSegmentIndex:s,multiSegment:o,state:a}=this.attribute;return new nh({points:t,startSymbol:e,endSymbol:i,lineStyle:r,mainSegmentIndex:s,multiSegment:o,pickable:!1,state:{line:Z({},Se,a==null?void 0:a.line),startSymbol:Z({},Se,a==null?void 0:a.lineStartSymbol),endSymbol:Z({},Se,a==null?void 0:a.lineEndSymbol)}})}setLineAttributes(){const{points:t,startSymbol:e,endSymbol:i,lineStyle:r,mainSegmentIndex:s,multiSegment:o,state:a}=this.attribute;this._line&&this._line.setAttributes({points:t,startSymbol:e,endSymbol:i,lineStyle:r,mainSegmentIndex:s,multiSegment:o,state:{line:Z({},Se,a==null?void 0:a.line),startSymbol:Z({},Se,a==null?void 0:a.lineStartSymbol),endSymbol:Z({},Se,a==null?void 0:a.lineEndSymbol)}})}isValidPoints(){const{points:t}=this.attribute;if(!t||t.length<2)return!1;let e=!0;return t.forEach(i=>{if(i.length)i.forEach(r=>{et(r.x)&&et(r.y)||(e=!1)});else if(!et(i.x)||!et(i.y))return void(e=!1)}),e}addMarkLineLabels(t){this._addMarkLabels(t,"mark-common-line-label",Oa.defaultAttributes.label)}updateMarkLineLabels(){this._updateMarkLabels(Oa.defaultAttributes.label)}}Oa.defaultAttributes=kzt;mzt();function het(){Uo._animate=xzt}class Uo extends fT{markerAnimate(t){Uo._animate&&this._animationConfig&&Uo._animate(this._area,this._label,this._animationConfig,t)}getArea(){return this._area}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Uo.defaultAttributes,t)),this.name="markArea",this.defaultUpdateAnimation=set,this.defaultExitAnimation=_T}getPointAttrByPosition(t){const{x1:e,x2:i,y1:r,y2:s}=this._area.AABBBounds,o={x:(e+i)/2,y:(r+s)/2};return(t.includes("left")||t.includes("Left"))&&(o.x=e),(t.includes("right")||t.includes("Right"))&&(o.x=i),(t.includes("top")||t.includes("Top"))&&(o.y=r),(t.includes("bottom")||t.includes("Bottom"))&&(o.y=s),o}setLabelPos(t,e){var i;if(this._area){const r=(i=e.position)!==null&&i!==void 0?i:"middle",s=this.getPointAttrByPosition(r);if(t.setAttributes(Object.assign(Object.assign({},s),{textStyle:Object.assign(Object.assign({},Ezt[r]),e.textStyle)})),this.attribute.limitRect&&e.confine){const{x:o,y:a,width:l,height:h}=this.attribute.limitRect;pF(t,{x1:o,y1:a,x2:o+l,y2:a+h})}}}initMarker(t){const{points:e,areaStyle:i,state:r}=this.attribute,s=Pt.polygon(Object.assign({points:e},i));s.states=Z({},Se,r==null?void 0:r.area),s.name="mark-area-polygon",this._area=s,t.add(s),this._addMarkLabels(t,"mark-area-label",Uo.defaultAttributes.label)}updateMarker(){const{points:t,areaStyle:e,state:i}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({points:t},e)),this._area.states=Z({},Se,i==null?void 0:i.area)),this._updateMarkLabels(Uo.defaultAttributes.label)}isValidPoints(){const{points:t}=this.attribute;if(!t||t.length<3)return!1;let e=!0;return t.forEach(i=>{et(i.x)&&et(i.y)||(e=!1)}),e}}Uo.defaultAttributes=Bzt,Ye(Uo,SF);fzt();function Izt(){Dl._animate=ret}class Dl extends xF{markerAnimate(t){Dl._animate&&this._animationConfig&&Dl._animate(this._line,this._label,this._animationConfig,t)}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Dl.defaultAttributes,t)),this.name="markArcLine"}getPointAttrByPosition(t,e){const{center:i,radius:r,startAngle:s,endAngle:o}=this.attribute,{refX:a=0,refY:l=0}=e;let h;switch(t){case Vn.arcInnerStart:h=s;case Vn.arcOuterStart:h=s;break;case Vn.arcInnerEnd:h=o;case Vn.arcOuterEnd:h=o;break;case Vn.center:case Vn.arcInnerMiddle:case Vn.arcOuterMiddle:default:h=(s+o)/2}return{position:{x:i.x+(r+l)*Math.cos(h)+a*Math.cos(h-Math.PI/2),y:i.y+(r+l)*Math.sin(h)+a*Math.sin(h-Math.PI/2)},angle:h}}getTextStyle(t){return oet[t]}getRotateByAngle(t,e){var i;return t-Math.PI/2+((i=e.refAngle)!==null&&i!==void 0?i:0)}createSegment(){const{center:t,radius:e,startAngle:i,endAngle:r,startSymbol:s,endSymbol:o,lineStyle:a,state:l}=this.attribute;return new oI({center:t,radius:e,startAngle:i,endAngle:r,startSymbol:s,endSymbol:o,lineStyle:a,state:{line:Z({},Se,l==null?void 0:l.line),startSymbol:Z({},Se,l==null?void 0:l.lineStartSymbol),endSymbol:Z({},Se,l==null?void 0:l.lineEndSymbol)}})}setLineAttributes(){const{center:t,radius:e,startAngle:i,endAngle:r,startSymbol:s,endSymbol:o,lineStyle:a,state:l}=this.attribute;this._line&&this._line.setAttributes({center:t,radius:e,startAngle:i,endAngle:r,startSymbol:s,endSymbol:o,lineStyle:a,state:{line:Z({},Se,l==null?void 0:l.line),startSymbol:Z({},Se,l==null?void 0:l.lineStartSymbol),endSymbol:Z({},Se,l==null?void 0:l.lineEndSymbol)}})}isValidPoints(){return!0}addMarkLineLabels(t){this._addMarkLabels(t,"mark-common-line-label",Dl.defaultAttributes.label)}updateMarkLineLabels(){this._updateMarkLabels(Dl.defaultAttributes.label)}}Dl.defaultAttributes=Rzt;vzt();function Ozt(){Da._animate=wzt}class Da extends fT{markerAnimate(t){Da._animate&&this._animationConfig&&Da._animate(this._area,this._label,this._animationConfig,t)}getArea(){return this._area}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Da.defaultAttributes,t)),this.name="markArcArea",this.defaultUpdateAnimation=set,this.defaultExitAnimation=_T}getPointAttrByPosition(t,e){const{center:i,innerRadius:r,outerRadius:s,startAngle:o,endAngle:a}=this.attribute,{refX:l=0,refY:h=0}=e;let d,u;switch(t){case Vn.center:d=(r+s)/2,u=(o+a)/2;break;case Vn.arcInnerStart:d=r,u=o;break;case Vn.arcOuterStart:d=s,u=o;break;case Vn.arcInnerEnd:d=r,u=a;break;case Vn.arcOuterEnd:d=s,u=a;break;case Vn.arcInnerMiddle:d=r,u=(o+a)/2;break;case Vn.arcOuterMiddle:d=s,u=(o+a)/2;break;default:d=r,u=(o+a)/2}return{position:{x:i.x+(d+h)*Math.cos(u)+l*Math.cos(u-Math.PI/2),y:i.y+(d+h)*Math.sin(u)+l*Math.sin(u-Math.PI/2)},angle:u}}setLabelPos(t,e){var i;if(this._area){const{position:r="arcInnerMiddle",autoRotate:s}=e,o=this.getPointAttrByPosition(r,e);if(t.setAttributes(Object.assign(Object.assign({},o.position),{angle:s?o.angle-Math.PI/2+((i=e.refAngle)!==null&&i!==void 0?i:0):0,textStyle:Object.assign(Object.assign({},oet[r]),e.textStyle)})),this.attribute.limitRect&&e.confine){const{x:a,y:l,width:h,height:d}=this.attribute.limitRect;pF(t,{x1:a,y1:l,x2:a+h,y2:l+d})}}}initMarker(t){const{center:e,innerRadius:i,outerRadius:r,startAngle:s,endAngle:o,areaStyle:a,state:l}=this.attribute,h=Pt.arc(Object.assign({x:e.x,y:e.y,innerRadius:i,outerRadius:r,startAngle:s,endAngle:o},a));h.states=Z({},Se,l==null?void 0:l.area),h.name="polar-mark-area-area",this._area=h,t.add(h),this._addMarkLabels(t,"mark-area-label",Da.defaultAttributes.label)}updateMarker(){const{center:t,innerRadius:e,outerRadius:i,startAngle:r,endAngle:s,areaStyle:o,label:a,state:l}=this.attribute;this._area&&(this._area.setAttributes(Object.assign({x:t.x,y:t.y,innerRadius:e,outerRadius:i,startAngle:r,endAngle:s},o)),this._area.states=Z({},Se,l==null?void 0:l.area)),this._updateMarkLabels(Da.defaultAttributes.label)}isValidPoints(){return!0}}Da.defaultAttributes=Pzt,Ye(Da,SF);_zt();function wF(){dd._animate=Azt}class dd extends fT{markerAnimate(t){dd._animate&&this._animationConfig&&dd._animate([this._line,this._decorativeLine],this._item,this._animationConfig,t)}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},dd.defaultAttributes,t)),this.name="markPoint",this.defaultUpdateAnimation=Tzt,this.defaultExitAnimation=_T,this._isArcLine=!1,this._isStraightLine=!1}setLabelPos(){}getTextAlignAttr(t,e,i,r,s){return wa(Math.abs(r),Math.PI/2,Ma)||wa(Math.abs(r),3*Math.PI/2,Ma)?dtt(t,r,s):Dw(r)?bU.postiveXAxis[s]:bU.negativeXAxis[s]}setItemAttributes(t,e,i,r,s){var o,a;if(!t)return;const{autoRotate:l=!0,refX:h=0,refY:d=0,refAngle:u=0,textStyle:c={},richTextStyle:g={},imageStyle:p={},position:f=_I.middle}=e,{state:m}=this.attribute,v=((o=this._line)===null||o===void 0?void 0:o.getEndAngle())||0,_=h*Math.cos(v)+d*Math.cos(v-Math.PI/2),b=h*Math.sin(v)+d*Math.sin(v-Math.PI/2);if(s==="text"){const C=r.x-i.x,S=r.y-i.y;t.setAttributes(Object.assign(Object.assign({},c),{textStyle:Object.assign(Object.assign({},this.getTextAlignAttr(l,C,S,v,(a=e.position)!==null&&a!==void 0?a:"end")),c.textStyle),state:{panel:Z({},Se,m==null?void 0:m.textBackground),text:Z({},Se,m==null?void 0:m.text)}}))}else s==="richText"?(t.setAttributes({dx:this.getItemDx(t,f,g)+(g.dx||0),dy:this.getItemDy(t,f,g)+(g.dy||0)}),t.states=Z({},Se,m==null?void 0:m.richText)):s==="image"&&(t.setAttributes({dx:this.getItemDx(t,f,p)+(p.dx||0),dy:this.getItemDy(t,f,p)+(p.dy||0)}),t.states=Z({},Se,m==null?void 0:m.image));const y=Dw(v)?v:v-Math.PI;t.setAttributes({x:r.x+(_||0),y:r.y+(b||0),angle:l&&y+u})}getItemDx(t,e,i){var r,s;const o=(s=(r=t==null?void 0:t.AABBBounds)===null||r===void 0?void 0:r.width())!==null&&s!==void 0?s:(i==null?void 0:i.width)||0;return e.includes("inside")?-o:0}getItemDy(t,e,i){var r,s;const o=(s=(r=t==null?void 0:t.AABBBounds)===null||r===void 0?void 0:r.height())!==null&&s!==void 0?s:(i==null?void 0:i.height)||0;return e.includes("top")||e.includes("Top")?-o:e.includes("middle")||e.includes("Middle")?-o/2:0}initItem(t,e,i){const{state:r}=this.attribute,{type:s="text",symbolStyle:o,richTextStyle:a,imageStyle:l,renderCustomCallback:h}=t;let d;return s==="symbol"?(d=Pt.symbol(Object.assign(Object.assign({},i),o)),d.states=Z({},Se,r==null?void 0:r.symbol)):s==="text"?d=new Ja(Object.assign(Object.assign({},i),{state:{panel:Z({},Se,r==null?void 0:r.textBackground),text:Z({},Se,r==null?void 0:r.text)}})):s==="richText"?(d=Pt.richtext(Object.assign(Object.assign({},i),a)),d.states=Z({},Se,r==null?void 0:r.richText)):s==="image"?(d=Pt.image(Object.assign(Object.assign({},i),l)),d.states=Z({},Se,r==null?void 0:r.image)):s==="custom"&&h&&(d=h(),d.states=Z({},Se,r==null?void 0:r.customMark)),d.name=`mark-point-${s}`,this.setItemAttributes(d,t,e,i,s),d}getItemLineAttr(t,e,i){let r=[],s={x:0,y:0},o=0,a=0,l=0;const{type:h="type-s",arcRatio:d=.8}=t,u=i.x-e.x,c=i.y-e.y;if(this._isStraightLine=wa(u,0,Ma)||wa(c,0,Ma),this._isArcLine){const{x:g,y:p}=this.attribute.position,{x:f,y:m}=i,v=(g+f)/2,_=(p+m)/2,b=p===m?0:-(g-f)/(p-m),y=v+d*(m>p?-1:1)*v,C=(x=>b*(x-v)+_)(y);a=mg(p-C,g-y),l=mg(m-C,f-y),s={x:y,y:C};const S=Math.sqrt((y-g)*(y-g)+(C-p)*(C-p)),w=this.attribute.targetSymbol.style.size/2;a+=2*Math.acos(Math.sqrt(1-w*w/(4*S*S))),d>0?l<a&&(l+=2*Math.PI):a<l&&(a+=2*Math.PI),o=Math.sqrt((y-g)*(y-g)+(C-p)*(C-p))}else r=h!=="type-do"||this._isStraightLine?h!=="type-po"||this._isStraightLine?h!=="type-op"||this._isStraightLine?[e,i]:[e,{x:e.x,y:i.y},i]:[e,{x:i.x,y:e.y},i]:[e,{x:(e.x+i.x)/2,y:i.y},i];return r=uFt(r),{points:r,center:s,radius:o,startAngle:a,endAngle:l}}reDrawLine(t,e){this._line.release();const{startSymbol:i,endSymbol:r,lineStyle:s,type:o="type-s"}=t,{state:a}=this.attribute,l=this._isArcLine?oI:nh;this._container.removeChild(this._line),this._line=new l(Object.assign(Object.assign({},e),{pickable:!1,startSymbol:i,endSymbol:r,lineStyle:s,visible:t.visible,state:{line:Z({},Se,a==null?void 0:a.line),startSymbol:Z({},Se,a==null?void 0:a.lineStartSymbol),endSymbol:Z({},Se,a==null?void 0:a.lineEndSymbol)}})),this._container.add(this._line)}setItemLineAttr(t,e,i){if(this._line){const{startSymbol:r,endSymbol:s,lineStyle:o,type:a="type-s"}=t,{state:l}=this.attribute,h=this.getItemLineAttr(t,e,i);this._isArcLine&&this._line.key==="arc-segment"||!this._isArcLine&&this._line.key==="segment"?this._line.setAttributes(Object.assign(Object.assign({},h),{startSymbol:r,endSymbol:s,lineStyle:o,visible:t.visible,state:{line:Z({},Se,l==null?void 0:l.line),startSymbol:Z({},Se,l==null?void 0:l.lineStartSymbol),endSymbol:Z({},Se,l==null?void 0:l.lineEndSymbol)}})):this.reDrawLine(t,h)}}getDecorativeLineAttr(t){var e;const i=((e=t==null?void 0:t.decorativeLine)===null||e===void 0?void 0:e.length)||10,r=this._line.getEndAngle()||0;return{startPointOffsetX:i/2*Math.cos(r-Math.PI/2),startPointOffsetY:i/2*Math.sin(r-Math.PI/2),endPointOffsetX:-i/2*Math.cos(r-Math.PI/2),endPointOffsetY:-i/2*Math.sin(r-Math.PI/2)}}setDecorativeLineAttr(t,e,i){var r;if(this._decorativeLine){const{lineStyle:s}=t,{startPointOffsetX:o,startPointOffsetY:a,endPointOffsetX:l,endPointOffsetY:h}=this.getDecorativeLineAttr(t);this._decorativeLine.setAttributes(Object.assign(Object.assign({points:[{x:e.x+o,y:e.y+a},{x:e.x+l,y:e.y+h}]},s),{visible:i})),this._decorativeLine.states=Z({},Se,(r=this.attribute.state)===null||r===void 0?void 0:r.line)}}setTargetItemAttributes(t,e){var i,r;this._targetItem&&(this._targetItem.setAttributes(Object.assign({x:e.x,y:e.y,visible:(i=t.visible)!==null&&i!==void 0&&i,size:t.size},t.style)),this._targetItem.states=Z({},Se,(r=this.attribute.state)===null||r===void 0?void 0:r.targetItem))}setAllOfItemsAttr(t,e){var i;const{position:r,itemLine:s={},itemContent:o={},limitRect:a,targetSymbol:l}=this.attribute,{type:h="text",confine:d}=o;if(a&&d){const{x:u,y:c,width:g,height:p}=a,{dx:f,dy:m}=ftt(this._item,{x1:u,y1:c,x2:u+g,y2:c+p});e.x=e.x+f,e.y=e.y+m}this.setTargetItemAttributes(l,r),this.setItemLineAttr(s,t,e),this.setItemAttributes(this._item,o,t,e,h),this.setDecorativeLineAttr(s,e,(i=s.decorativeLine)===null||i===void 0?void 0:i.visible)}computeNewPositionAfterTargetItem(t){var e,i;const{itemContent:r={},targetSymbol:s,itemLine:o}=this.attribute,{offsetX:a=0,offsetY:l=0}=r,{offset:h=0,style:d,visible:u=!1,size:c}=s,g=u?(i=(e=d.size)!==null&&e!==void 0?e:c)!==null&&i!==void 0?i:20:0;let p;return p=o.type==="type-do"?mg(l,a/2):o.type==="type-po"?mg(0,a):o.type==="type-op"?mg(l,0):mg(l,a),{newPosition:{x:t.x+(g/2+h)*Math.cos(p),y:t.y+(g/2+h)*Math.sin(p)},newItemPosition:{x:t.x+(g/2+h)*Math.cos(p)+a,y:t.y+(g/2+h)*Math.sin(p)+l}}}initMarker(t){const{position:e,itemContent:i={},itemLine:r}=this.attribute,{type:s="type-s",arcRatio:o=.8}=r,{offsetX:a=0,offsetY:l=0}=i;this._isStraightLine=wa(a,0,Ma)||wa(l,0,Ma),this._isArcLine=s==="type-arc"&&o!==0&&!this._isStraightLine;const{newPosition:h,newItemPosition:d}=this.computeNewPositionAfterTargetItem(e),u=new(this._isArcLine?oI:nh)({points:[],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0});u.name="mark-point-line",this._line=u,t.add(u);const c=Pt.line({points:[]});c.name="mark-point-decorativeLine",this._decorativeLine=c,t.add(c);const g=Pt.symbol({});g.name="mark-point-targetItem",this._targetItem=g,t.add(this._targetItem);const p=this.initItem(i,h,d);this._item=p,t.add(p),this.setAllOfItemsAttr(h,d)}updateMarker(){const{position:t,itemContent:e={},itemLine:i}=this.attribute,{type:r="text"}=e,{type:s="type-s",arcRatio:o=.8}=i,{offsetX:a=0,offsetY:l=0}=e;this._isStraightLine=wa(a,0,Ma)||wa(l,0,Ma);const h=s==="type-arc"&&o!==0&&!this._isStraightLine,{newPosition:d,newItemPosition:u}=this.computeNewPositionAfterTargetItem(t);h!==this._isArcLine?(this._isArcLine=h,this.reDrawLine(i,{points:[{x:0,y:0}],pickable:!1,center:{x:0,y:0},radius:0,startAngle:0,endAngle:0})):this._isArcLine=h,this.setItemAttributes(this._item,e,d,u,r),this.setAllOfItemsAttr(d,u)}isValidPoints(){const{position:t}=this.attribute;return!(!et(t.x)||!et(t.y))}}dd.defaultAttributes=Lzt;function det(){Xi(),Bo(),al()}const uet={space:8,style:{fill:"rgb(47, 69, 84)",cursor:"pointer",size:15},state:{disable:{fill:"rgb(170, 170, 170)",cursor:"not-allowed"},hover:{}}};det();class v0 extends En{getCurrent(){return this._current}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},v0.defaultAttributes,t)),this.name="pager",this._current=1,this._onHover=i=>{const r=i.target;r.hasState("disable")||r.addState("hover")},this._onUnHover=i=>{i.target.removeState("hover")},this._onClick=i=>{const r=i.target;if(r.name==="preHandler"){if(this._current===1)return;this._current-=1,this._current===1?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toPrev",{current:this._current,total:this._total,direction:"pre",event:i})}if(r.name==="nextHandler"){if(this._current===this._total)return;this._current+=1,this._current===this._total?r.addState("disable"):r.removeState("disable"),this._dispatchEvent("toNext",{current:this._current,total:this._total,direction:"next",event:i})}this._current>1&&this.preHandler.removeState("disable"),this._current<this._total&&this.nextHandler.removeState("disable"),this.text.setAttribute("text",this._getPageText(this._current))}}render(){var t,e,i;this._reset();const{layout:r="horizontal",handler:s=uet,total:o,defaultCurrent:a=1,textStyle:l,padding:h=0}=this.attribute;this._current=a;const d=Fi(h),u=r==="horizontal",c=Pt.group({x:0,y:0}),g=s.style||{},p=g.size||15,f=(t=s.space)!==null&&t!==void 0?t:8,m=s.state||{};let{preShape:v,nextShape:_}=s;v||(v=u?"triangleLeft":"triangleUp"),_||(_=u?"triangleRight":"triangleDown");const b=Pt.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:0,y:0,symbolType:v,size:p}));b.states=m,b.name="preHandler",this.preHandler=b,c.add(b);const{width:y,height:C}=nT(this._getPageText(o),Object.assign({textAlign:"center",textBaseline:"middle"},l),(i=(e=this.stage)===null||e===void 0?void 0:e.getTheme())===null||i===void 0?void 0:i.text),S=J(p)?p:p[0],w=J(p)?p:p[1],x=Pt.text(Object.assign({x:u?S/2+f+y/2:0,y:u?0:w/2+f+C/2,text:this._getPageText(a),textAlign:"center",textBaseline:"middle",lineHeight:l==null?void 0:l.fontSize},l));this.text=x,c.add(x);const A=Pt.symbol(Object.assign(Object.assign({strokeBoundsBuffer:0,pickMode:"imprecise"},g),{x:u?S+2*f+y:0,y:u?0:w+2*f+C,symbolType:_,size:p}));A.name="nextHandler",A.states=m,this.nextHandler=A,c.add(A),this._total===1?(b.addState("disable"),A.addState("disable")):this._current===1?b.addState("disable"):this._current===o&&A.addState("disable");const M=c.AABBBounds,T=M.width(),R=M.height();c.translateTo(0-M.x1+d[3],0-M.y1+d[0]),this.add(c),this.attribute.width=T+d[1]+d[3],this.attribute.height=R+d[0]+d[2],this._bindEvents()}_bindEvents(){this.attribute.disableTriggerEvent||(this.preHandler&&(this.preHandler.addEventListener("pointerenter",this._onHover),this.preHandler.addEventListener("pointerleave",this._onUnHover),this.preHandler.addEventListener("pointerdown",this._onClick)),this.nextHandler&&(this.nextHandler.addEventListener("pointerenter",this._onHover),this.nextHandler.addEventListener("pointerleave",this._onUnHover),this.nextHandler.addEventListener("pointerdown",this._onClick)))}_reset(){this.removeAllChild(!0),this._current=1,this._total=this.attribute.total,this.preHandler=this.nextHandler=this.text=null}_getPageText(t){const{pageFormatter:e}=this.attribute;return e?it(e)?e(t,this._total):`${e}`.replace("{current}",`${t}`).replace("{total}",`${this._total}`):`${t}/${this._total}`}setTotal(t){t!==this.attribute.total&&(this._total=t,this._current!==1&&this._current<=t?this.setAttributes({total:t,defaultCurrent:this._current}):this.setAttribute("total",t))}}v0.defaultAttributes={handler:uet,textStyle:{fill:"rgb(51, 51, 51)",fontSize:12}};const Nw=10,cet=8,get=8,Dzt=8,IC=16,OC=8,xb=12,bI=12;var Zt;(function(n){n.selected="selected",n.unSelected="unSelected",n.selectedHover="selectedHover",n.unSelectedHover="unSelectedHover",n.focus="focus"})(Zt||(Zt={}));var _r;(function(n){n.legendItemHover="legendItemHover",n.legendItemUnHover="legendItemUnHover",n.legendItemClick="legendItemClick",n.legendItemAttributeUpdate="legendItemAttributeUpdate"})(_r||(_r={}));var Qn;(function(n){n.innerView="innerView",n.title="legendTitle",n.item="legendItem",n.itemShape="legendItemShape",n.itemLabel="legendItemLabel",n.itemValue="legendItemValue",n.focus="legendItemFocus"})(Qn||(Qn={}));class AF extends En{constructor(){super(...arguments),this.name="legend",this._title=null}render(){this.removeAllChild(!0);const{interactive:t=!0,title:e,padding:i=0}=this.attribute;this._parsedPadding=Fi(i);const r=Pt.group({x:this._parsedPadding[3],y:this._parsedPadding[0],pickable:t,childrenPickable:t});r.name=Qn.innerView,this.add(r),this._innerView=r,e!=null&&e.visible&&this._renderTitle(e),this._renderContent(),this._adjustLayout(),t&&this._bindEvents();const s=this._innerView.AABBBounds;this.attribute.width=s.width()+this._parsedPadding[1]+this._parsedPadding[3],this.attribute.height=s.height()+this._parsedPadding[0]+this._parsedPadding[2]}_renderTitle(t){const{text:e="",textStyle:i,padding:r=0,background:s,minWidth:o,maxWidth:a,shape:l}=t,h={x:0,y:0,text:e,textStyle:i,padding:Fi(r),minWidth:o,maxWidth:a};l&&l.visible&&(h.shape=Object.assign({visible:!0},l.style),L(l.space)&&(h.space=l.space)),s&&s.visible&&(h.panel=Object.assign({visible:!0},s.style));const d=new Ja(h);d.name=Qn.title,this._title=d,this._innerView.add(d)}_adjustLayout(){var t;if(this._title){const e=this._innerView.AABBBounds.width(),i=this._title.AABBBounds.width(),r=(t=this.attribute.title)===null||t===void 0?void 0:t.align;r==="center"?this._title.setAttribute("x",(e-i)/2):r==="end"&&this._title.setAttribute("x",e-i)}}}function bT(){Xi(),al(),fh(),Bo()}function MF(){Xi(),rT()}function Fzt(){MF(),det(),att()}function Hzt(){MF(),bT()}function zzt(){MF(),bT(),_b()}var yU=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const Wzt={[Zt.focus]:{},[Zt.selected]:{},[Zt.selectedHover]:{},[Zt.unSelected]:{},[Zt.unSelectedHover]:{}};Fzt();let pet=class fet extends AF{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},fet.defaultAttributes,t)),this.name="discreteLegend",this._itemsContainer=null,this._itemHeightByUser=void 0,this._itemHeight=0,this._itemMaxWidth=0,this._contentMaxHeight=0,this._onHover=i=>{const r=i.target;if(r&&r.name&&r.name.startsWith(Qn.item)){const s=r.delegate;if(this._lastActiveItem){if(this._lastActiveItem.id===s.id)return;this._unHover(this._lastActiveItem,i)}this._hover(s,i)}else this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onUnHover=i=>{this._lastActiveItem&&(this._unHover(this._lastActiveItem,i),this._lastActiveItem=null)},this._onClick=i=>{var r,s,o,a;const l=i.target;if(l&&l.name&&l.name.startsWith(Qn.item)){const h=l.delegate,{selectMode:d="multiple"}=this.attribute;if(l.name===Qn.focus||d==="focus"){const u=h.hasState(Zt.focus);h.toggleState(Zt.focus),u?(r=this._itemsContainer)===null||r===void 0||r.getChildren().forEach(c=>{this._removeLegendItemState(c,[Zt.unSelected,Zt.unSelectedHover,Zt.focus],i),this._setLegendItemState(c,Zt.selected,i)}):(this._setLegendItemState(h,Zt.selected,i),this._removeLegendItemState(h,[Zt.unSelected,Zt.unSelectedHover],i),(s=this._itemsContainer)===null||s===void 0||s.getChildren().forEach(c=>{h!==c&&(this._removeLegendItemState(c,[Zt.selected,Zt.selectedHover,Zt.focus],i),this._setLegendItemState(c,Zt.unSelected,i))}))}else{(o=this._itemsContainer)===null||o===void 0||o.getChildren().forEach(p=>{p.removeState(Zt.focus)});const{allowAllCanceled:u=!0}=this.attribute,c=h.hasState(Zt.selected),g=this._getSelectedLegends();if(d==="multiple"){if(u===!1&&c&&g.length===1)return void this._dispatchLegendEvent(_r.legendItemClick,h,i);c?(this._removeLegendItemState(h,[Zt.selected,Zt.selectedHover],i),this._setLegendItemState(h,Zt.unSelected,i)):(this._setLegendItemState(h,Zt.selected,i),this._removeLegendItemState(h,[Zt.unSelected,Zt.unSelectedHover],i))}else this._setLegendItemState(h,Zt.selected,i),this._removeLegendItemState(h,[Zt.unSelected,Zt.unSelectedHover],i),(a=this._itemsContainer)===null||a===void 0||a.getChildren().forEach(p=>{h!==p&&(this._removeLegendItemState(p,[Zt.selected,Zt.selectedHover],i),this._setLegendItemState(p,Zt.unSelected,i))})}this._dispatchLegendEvent(_r.legendItemClick,h,i)}}}render(){super.render(),this._lastActiveItem=null}setSelected(t){var e;((e=this._itemsContainer)===null||e===void 0?void 0:e.getChildren()).forEach(i=>{const r=i.data;t.includes(r.label)?(this._setLegendItemState(i,Zt.selected),this._removeLegendItemState(i,[Zt.unSelected,Zt.unSelectedHover])):(this._removeLegendItemState(i,[Zt.selected,Zt.selectedHover]),this._setLegendItemState(i,Zt.unSelected))})}_renderItems(){const{item:t={},maxCol:e=1,maxRow:i=2,maxWidth:r,defaultSelected:s,lazyload:o,autoPage:a}=this.attribute,{spaceCol:l=IC,spaceRow:h=OC,verticalAlign:d="middle"}=t,u=this._itemsContainer,{items:c,isHorizontal:g,startIndex:p,isScrollbar:f}=this._itemContext,m=f?1:g?i:e,v=this._contentMaxHeight;let _,{doWrap:b,maxWidthInCol:y,startX:C,startY:S,pages:w}=this._itemContext,x=0,A=0;const M=[];for(let T=p,R=c.length;T<R&&!(o&&w>this._itemContext.currentPage*m);T++){o&&(this._itemContext.startIndex=T+1),_=c[T],_.id||(_.id=_.label),_.index=T;let B=!0;V(s)&&(B=s.includes(_.label));const E=this._renderEachItem(_,B,T,c),k=E.attribute.width,P=E.attribute.height;this._itemHeight=Math.max(this._itemHeight,P),y=Math.max(k,y),this._itemMaxWidth=Math.max(k,this._itemMaxWidth),g?(L(r)&&(f&&a?(w=Math.ceil((C+k)/r),b=w>1):C+k>r&&(b=!0,C>0&&(d!=="middle"&&d!=="bottom"||M.forEach(I=>{I.setAttributes({y:I.attribute.y+(A-I.attribute.height)/(d==="middle"?2:1)})}),w+=1,C=0,S+=A+h,A=0,M.length=0))),C===0&&S===0||E.setAttributes({x:C,y:S}),C+=l+k,A=Math.max(A,P),M.push(E)):(L(v)&&(f&&a?(w=Math.ceil((S+P)/v),b=w>1):v<=P?(w+=1,b=!0,S=0,T>0&&(C+=x+l)):v<S+P&&(w+=1,b=!0,S=0,C+=y+l,y=0)),C===0&&S===0||E.setAttributes({x:C,y:S}),S+=h+P),u.add(E),x=k}return!g||d!=="middle"&&d!=="bottom"||M.forEach(T=>{T.setAttributes({y:T.attribute.y+(A-T.attribute.height)/(d==="middle"?2:1)})}),this._itemContext.doWrap=b,this._itemContext.startX=C,this._itemContext.startY=S,this._itemContext.maxWidthInCol=y,this._itemContext.pages=w,this._itemContext.maxPages=m,f&&(this._itemContext.totalPage=w),o||(this._itemContext.startIndex=c.length),this._itemContext}_renderContent(){const{item:t={},items:e,reversed:i,maxWidth:r,maxHeight:s}=this.attribute;if(t.visible===!1||xt(e))return;let o=e;i&&(o=e==null?void 0:e.reverse()),this._contentMaxHeight=Math.max(0,s-this._parsedPadding[0]-this._parsedPadding[2]);const a=Pt.group({x:0,y:0});this._itemsContainer=a;const{layout:l,autoPage:h}=this.attribute,d=l==="horizontal",{maxWidth:u,width:c,height:g}=t,p=[];L(u)&&p.push(u),L(c)&&p.push(c),p.length&&(L(r)&&p.push(r),this._itemWidthByUser=Ri(p)),L(g)&&(this._itemHeightByUser=g);const f=this.attribute.pager;this._itemContext={currentPage:f&&f.defaultCurrent||1,doWrap:!1,maxWidthInCol:0,maxPages:1,pages:1,startX:0,startY:0,startIndex:0,items:o,isHorizontal:d,totalPage:1/0,isScrollbar:f&&f.type==="scrollbar",clipContainer:void 0},this._itemContext=this._renderItems();let m=!1;this._itemContext.doWrap&&h&&this._itemContext.pages>this._itemContext.maxPages&&(m=this._renderPagerComponent()),m||(a.setAttribute("y",this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",8):0),this._innerView.add(a))}_bindEvents(){if(this.attribute.disableTriggerEvent||!this._itemsContainer)return;const{hover:t=!0,select:e=!0}=this.attribute;if(t){let i="pointermove",r="pointerleave";kt(t)&&(t.trigger&&(i=t.trigger),t.triggerOff&&(r=t.triggerOff)),this._itemsContainer.addEventListener(i,this._onHover),this._itemsContainer.addEventListener(r,this._onUnHover)}if(e){let i="pointerdown";kt(e)&&e.trigger&&(i=e.trigger),this._itemsContainer.addEventListener(i,this._onClick)}}_autoEllipsis(t,e,i,r){var s,o;const{label:a,value:l}=this.attribute.item,h=r.AABBBounds,d=i.AABBBounds,u=h.width(),c=d.width();let g=!1;t==="labelFirst"?c>e?g=!0:r.setAttribute("maxLineWidth",e-c):t==="valueFirst"?u>e?g=!0:i.setAttribute("maxLineWidth",e-u):u+c>e&&(g=!0),g&&(r.setAttribute("maxLineWidth",Math.max(e*((s=a.widthRatio)!==null&&s!==void 0?s:.5),e-c)),i.setAttribute("maxLineWidth",Math.max(e*((o=l.widthRatio)!==null&&o!==void 0?o:.5),e-u)))}_renderEachItem(t,e,i,r){var s,o;const{id:a,label:l,value:h,shape:d}=t,{padding:u=0,focus:c,focusIconStyle:g,align:p,autoEllipsisStrategy:f}=this.attribute.item,{shape:m,label:v,value:_,background:b}=this.attribute.item,y=this._handleStyle(m,t,e,i,r),C=this._handleStyle(v,t,e,i,r),S=this._handleStyle(_,t,e,i,r),w=this._handleStyle(b,t,e,i,r),x=Fi(u);let A;b.visible===!1?(A=Pt.group({x:0,y:0,cursor:(s=w.style)===null||s===void 0?void 0:s.cursor}),this._appendDataToShape(A,Qn.item,t,A)):(A=Pt.group(Object.assign({x:0,y:0},w.style)),this._appendDataToShape(A,Qn.item,t,A,w.state)),A.id=`${a??l}-${i}`,A.addState(e?Zt.selected:Zt.unSelected);const M=Pt.group({x:0,y:0,pickable:!1});A.add(M);let T,R=0,B=0,E=0;if(m&&m.visible!==!1){const G=Dt(y,"style.size",Nw);B=V(G)?G[0]||0:G,E=Dt(m,"space",cet);const tt=Pt.symbol(Object.assign(Object.assign({x:0,y:0,symbolType:"circle",strokeBoundsBuffer:0},d),y.style));Object.keys(y.state||{}).forEach(st=>{const ot=y.state[st].fill||y.state[st].stroke;d.fill&&D(y.state[st].fill)&&ot&&(y.state[st].fill=ot),d.stroke&&D(y.state[st].stroke)&&ot&&(y.state[st].stroke=ot)}),this._appendDataToShape(tt,Qn.itemShape,t,A,y.state),tt.addState(e?Zt.selected:Zt.unSelected),M.add(tt)}let k=0;if(c){const G=Dt(g,"size",Nw);T=Pt.symbol(Object.assign(Object.assign({x:0,y:-G/2-1,strokeBoundsBuffer:0,boundsPadding:x},g),{visible:!0,pickMode:"imprecise"})),this._appendDataToShape(T,Qn.focus,t,A),k=G}const P=v.formatMethod?v.formatMethod(l,t,i):l,I=Object.assign(Object.assign({x:B/2+E,y:0,textAlign:"start",textBaseline:"middle",lineHeight:(o=C.style)===null||o===void 0?void 0:o.fontSize},C.style),{text:P,_originText:v.formatMethod?l:void 0}),O=u0(I);this._appendDataToShape(O,Qn.itemLabel,t,A,C.state),O.addState(e?Zt.selected:Zt.unSelected),M.add(O);const H=Dt(v,"space",get);if(L(h)){const G=Dt(_,"space",c?Dzt:0),tt=_.formatMethod?_.formatMethod(h,t,i):h,st=Object.assign(Object.assign({x:0,y:0,textAlign:"start",textBaseline:"middle",lineHeight:S.style.fontSize},S.style),{text:tt,_originText:_.formatMethod?h:void 0}),ot=u0(st);if(this._appendDataToShape(ot,Qn.itemValue,t,A,S.state),ot.addState(e?Zt.selected:Zt.unSelected),this._itemWidthByUser){const rt=this._itemWidthByUser-x[1]-x[3]-B-E-H-k-G;this._autoEllipsis(f,rt,O,ot),_.alignRight?ot.setAttributes({textAlign:"right",x:this._itemWidthByUser-B/2-x[1]-x[3]-k-G}):ot.setAttribute("x",H+(O.AABBBounds.empty()?0:O.AABBBounds.x2))}else ot.setAttribute("x",H+(O.AABBBounds.empty()?0:O.AABBBounds.x2));R=G+(ot.AABBBounds.empty()?0:ot.AABBBounds.x2),M.add(ot)}else this._itemWidthByUser&&O.setAttribute("maxLineWidth",this._itemWidthByUser-x[1]-x[3]-B-E-k),R=H+(O.AABBBounds.empty()?0:O.AABBBounds.x2);T&&(T.setAttribute("x",R),M.add(T));const z=M.AABBBounds,F=z.width();if(p==="right"){const G=z.x2,tt=z.x1;M.forEachChildren((st,ot)=>{st.type!=="symbol"&&st.attribute.textAlign!=="right"||st===T?st.setAttribute("x",tt+G-st.attribute.x-st.AABBBounds.width()):st.type!=="symbol"?st.setAttributes({x:tt+G-st.attribute.x,textAlign:"left"}):st.setAttribute("x",tt+G-st.attribute.x)})}const j=z.height(),$=L(this.attribute.item.width)?this.attribute.item.width:F+x[1]+x[3],Y=this._itemHeightByUser||j+x[0]+x[2];return A.attribute.width=$,A.attribute.height=Y,T&&T.setAttribute("visible",!1),M.translateTo(-z.x1+x[3],-z.y1+x[0]),A}_createPager(t){var e,i;const{disableTriggerEvent:r,maxRow:s}=this.attribute,o=a=>a<=99?99:a<=999?999:9999;return this._itemContext.isHorizontal?new v0(Object.assign(Object.assign({layout:s===1?"horizontal":"vertical",total:o(this._itemContext.pages)},Z({handler:{preShape:"triangleUp",nextShape:"triangleDown"}},t)),{defaultCurrent:(e=this.attribute.pager)===null||e===void 0?void 0:e.defaultCurrent,disableTriggerEvent:r})):new v0(Object.assign({layout:"horizontal",total:o(this._itemContext.pages),disableTriggerEvent:r,defaultCurrent:(i=this.attribute.pager)===null||i===void 0?void 0:i.defaultCurrent},t))}_createScrollbar(t,e){const{disableTriggerEvent:i}=this.attribute;return this._itemContext.isHorizontal?new d0(Object.assign(Object.assign({direction:"horizontal",disableTriggerEvent:i,range:[0,.5],height:t.visible===!1?0:12},t),{width:e})):new d0(Object.assign(Object.assign({direction:"vertical",width:t.visible===!1?0:12,range:[0,.5]},t),{height:e,disableTriggerEvent:i}))}_updatePositionOfPager(t,e,i){const{pager:r}=this.attribute,{totalPage:s,isHorizontal:o}=this._itemContext,a=r&&r.position||"middle";if(this._pagerComponent.setTotal(s),o){let l;l=a==="start"?t:a==="end"?t+i-this._pagerComponent.AABBBounds.height()/2:t+i/2-this._pagerComponent.AABBBounds.height()/2,this._pagerComponent.setAttributes({x:e-this._pagerComponent.AABBBounds.width(),y:l})}else{let l;l=a==="start"?0:a==="end"?e-this._pagerComponent.AABBBounds.width():(e-this._pagerComponent.AABBBounds.width())/2,this._pagerComponent.setAttributes({x:l,y:i-this._pagerComponent.AABBBounds.height()})}}_computeScrollbarDelta(){const{isHorizontal:t,clipContainer:e}=this._itemContext,i=this._itemsContainer.AABBBounds,r=e.AABBBounds;let s,o;return t?(o=r.width(),s=o/i.width()):(o=r.height(),s=o/i.height()),s}_updatePositionOfScrollbar(t,e,i){const{isHorizontal:r,currentPage:s,totalPage:o}=this._itemContext,a=(s-1)/o;this._pagerComponent.setScrollRange([a,a+this._computeScrollbarDelta()]),r?this._pagerComponent.setAttributes({x:0,y:i+e}):this._pagerComponent.setAttributes({x:t,y:i})}_bindEventsOfPager(t,e){const i=this.attribute.pager||{},{animation:r=!0,animationDuration:s=450,animationEasing:o="quadIn"}=i,a=this._itemContext.isScrollbar?d=>{const{value:u}=d.detail;let c;return c=u[0]===0?1:u[1]===1?this._itemContext.totalPage:u[0]*this._itemContext.totalPage+1,c}:d=>d.detail.current,l=d=>{const u=this._pagerComponent,c=u.getScrollRange(),{direction:g}=u.attribute,{width:p,height:f}=u.getSliderRenderBounds(),m=g==="vertical"?d.deltaY/f:d.deltaX/p;u.setScrollRange([c[0]+m,c[1]+m],!0),this.updateScrollMask()},h=d=>{const u=a(d);if(u!==this._itemContext.currentPage){if(this._itemContext.currentPage=u,this._itemContext&&this._itemContext.startIndex<this._itemContext.items.length){this._renderItems();const c=Math.ceil(this._itemContext.pages/this._itemContext.maxPages);if(this._itemContext.totalPage=c,this._itemContext.isScrollbar&&this._pagerComponent){const g=this._computeScrollbarDelta(),[p]=this._pagerComponent.getScrollRange();this._pagerComponent.setScrollRange([p,p+g])}}if(this._itemContext.isScrollbar){const[c]=this._pagerComponent.getScrollRange();let g;g=this._itemContext.isHorizontal?this._itemsContainer.AABBBounds.width():this._itemsContainer.AABBBounds.height();const p=g*c;this.updateScrollMask(),r?this._itemsContainer.animate().to({[e]:-p},s,o):this._itemsContainer.setAttribute(e,-p)}else r?this._itemsContainer.animate().to({[e]:-(u-1)*t},s,o):this._itemsContainer.setAttribute(e,-(u-1)*t)}};this._itemContext.isScrollbar?(this._pagerComponent.addEventListener("scrollDrag",h),this._pagerComponent.addEventListener("scrollUp",h),this.attribute.pager.roamScroll&&(this.addEventListener("wheel",u=>u.nativeEvent.preventDefault()),this.addEventListener("wheel",ha(l,50)))):(this._pagerComponent.addEventListener("toPrev",h),this._pagerComponent.addEventListener("toNext",h))}_renderPager(){const t=this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",8):0,{maxWidth:e,maxCol:i=1,maxRow:r=2,item:s={},pager:o={}}=this.attribute,{spaceCol:a=IC,spaceRow:l=OC}=s,h=this._itemsContainer,{space:d=bI,defaultCurrent:u=1}=o,c=yU(o,["space","defaultCurrent"]),{isHorizontal:g}=this._itemContext,p=this._contentMaxHeight;let f,m=0,v=0,_=0,b=0,y=0,C=0,S=1;if(g){if(v=(r-1)*l+this._itemHeight*r,m=e,f=this._createPager(c),this._pagerComponent=f,this._innerView.add(f),_=e-f.AABBBounds.width()-d,_<=0)return this._innerView.removeChild(f),!1;h.getChildren().forEach((A,M)=>{const{width:T,height:R}=A.attribute;_<y+T&&(y=0,C+=R+l,S+=1),M>0&&A.setAttributes({x:y,y:C}),y+=a+T}),this._itemContext.startX=y,this._itemContext.startY=C,this._itemContext.pages=S;const x=Math.ceil(S/r);this._itemContext.totalPage=x,this._updatePositionOfPager(t,m,v)}else{if(m=this._itemMaxWidth*i+(i-1)*a,v=p,_=m,f=this._createPager(c),this._pagerComponent=f,this._innerView.add(f),b=p-f.AABBBounds.height()-d-t,b<=0)return this._innerView.removeChild(f),!1;h.getChildren().forEach((A,M)=>{const{height:T}=A.attribute;b<C+T&&(C=0,y+=this._itemMaxWidth+a,S+=1),M>0&&A.setAttributes({x:y,y:C}),C+=l+T});const x=Math.ceil(S/i);this._itemContext.totalPage=x,this._updatePositionOfPager(t,m,v)}u>1&&(g?h.setAttribute("y",-(u-1)*(v+l)):h.setAttribute("x",-(u-1)*(m+a)));const w=Pt.group({x:0,y:t,width:g?_:m,height:g?v:b,clip:!0,pickable:!1});return w.add(h),this._innerView.add(w),this._itemContext.clipContainer=w,this._bindEventsOfPager(g?v+l:m+a,g?"y":"x"),!0}_renderScrollbar(){var t;const e=this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",8):0,{maxWidth:i,item:r={},pager:s={}}=this.attribute,{spaceCol:o=IC,spaceRow:a=OC}=r,l=this._itemsContainer,{space:h=bI,defaultCurrent:d=1}=s,u=yU(s,["space","defaultCurrent"]),{isHorizontal:c}=this._itemContext,g=this._contentMaxHeight;let p,f=0,m=0,v=0,_=1;if(c)f=i,m=this._itemHeight,p=this._createScrollbar(u,f),this._pagerComponent=p,this._innerView.add(p);else{if(m=g-e,f=this._itemMaxWidth,p=this._createScrollbar(u,m),this._pagerComponent=p,this._innerView.add(p),m<=0)return this._innerView.removeChild(p),!1;const y=l.getChildren(),C=y.map(S=>S.attribute.height);if(C.length===1||C.every(S=>S===C[0])){const S=C[0],w=m,x=Math.floor(w/(a+S));m=x*(a+S),_=Math.ceil(y.length/x)}else y.forEach((S,w)=>{const{height:x}=S.attribute,A=_,M=v;_=Math.floor((v+x)/m)+1,v+=a+x,A!==_&&w===l.getChildren().length-1&&v-m>=1/3*x&&(m=M+x,_-=1)});this._itemContext.totalPage=_,this._itemContext.pages=_}if(d>1)if(c){const y=this._itemsContainer.AABBBounds.width()-f;l.setAttribute("x",-Math.min((d-1)*(f+o),y))}else{const y=this._itemsContainer.AABBBounds.height()-m;l.setAttribute("y",-Math.min((d-1)*(m+a),y))}const b=Pt.group({x:0,y:e,width:f,height:m,clip:!0,pickable:!1});return b.add(l),this._innerView.add(b),this._itemContext.clipContainer=b,this._updatePositionOfScrollbar(f,m,e),!((t=s.scrollMask)===null||t===void 0)&&t.visible&&this.renderScrollMask(b),this._bindEventsOfPager(c?f:m,c?"x":"y"),!0}renderScrollMask(t){const{scrollMask:e={}}=this.attribute.pager,{visible:i=!0,gradientLength:r=16,gradientStops:s}=e;if(!i||!s)return;const o=t.AABBBounds.width(),a=t.AABBBounds.height(),l=this._itemContext.isHorizontal?o:a,h=s.map(c=>({offset:r*c.offset/l,color:c.color})),d=s.map(c=>({offset:(l-r*c.offset)/l,color:c.color})),u=Pt.rect({x:0,y:0,width:o,height:a});this._scrollMask=u,this._scrollMaskContext={startStops:h,endStops:d},this.updateScrollMask(),t.add(u)}updateScrollMask(){if(!this._scrollMask||!this._pagerComponent||!this._itemContext.isScrollbar)return;const[t,e]=this._pagerComponent.getScrollRange(),i=[];di(Ne(e,0,1),1)||i.push(...this._scrollMaskContext.endStops),di(Ne(t,0,1),0)||i.push(...this._scrollMaskContext.startStops),i.length&&(this._itemContext.isHorizontal?this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:1,y1:0,stops:i}}):this._scrollMask.setAttributes({fill:{gradient:"linear",x0:0,y0:0,x1:0,y1:1,stops:i}}))}_renderPagerComponent(){return this._itemContext.isScrollbar?this._renderScrollbar():this._renderPager(),!0}_hover(t,e){this._lastActiveItem=t,t.hasState(Zt.selected)?this._setLegendItemState(t,Zt.selectedHover,e):this._setLegendItemState(t,Zt.unSelectedHover,e);const i=t.getChildren()[0].find(r=>r.name===Qn.focus,!1);i&&i.setAttribute("visible",!0),this._dispatchLegendEvent(_r.legendItemHover,t,e)}_unHover(t,e){let i=!1;(t.hasState(Zt.unSelectedHover)||t.hasState(Zt.selectedHover))&&(i=!0),t.removeState(Zt.unSelectedHover),t.removeState(Zt.selectedHover),t.getChildren()[0].getChildren().forEach(s=>{i||!s.hasState(Zt.unSelectedHover)&&!s.hasState(Zt.selectedHover)||(i=!0),s.removeState(Zt.unSelectedHover),s.removeState(Zt.selectedHover)});const r=t.getChildren()[0].find(s=>s.name===Qn.focus,!1);r&&r.setAttribute("visible",!1),i&&this._dispatchLegendEvent(_r.legendItemAttributeUpdate,t,e),this._dispatchLegendEvent(_r.legendItemUnHover,t,e)}_setLegendItemState(t,e,i){let r=!1;t.hasState(e)||(r=!0),t.addState(e,!0),t.getChildren()[0].getChildren().forEach(s=>{s.name!==Qn.focus&&(r||s.hasState(e)||(r=!0),s.addState(e,!0))}),r&&this._dispatchLegendEvent(_r.legendItemAttributeUpdate,t,i)}_removeLegendItemState(t,e,i){let r=!1;e.forEach(s=>{!r&&t.hasState(s)&&(r=!0),t.removeState(s)}),t.getChildren()[0].getChildren().forEach(s=>{s.name!==Qn.focus&&e.forEach(o=>{!r&&s.hasState(o)&&(r=!0),s.removeState(o)})}),r&&this._dispatchLegendEvent(_r.legendItemAttributeUpdate,t,i)}_getSelectedLegends(){var t;const e=[];return(t=this._itemsContainer)===null||t===void 0||t.getChildren().forEach(i=>{i.hasState(Zt.selected)&&e.push(i.data)}),e}_appendDataToShape(t,e,i,r,s={}){t.name=e,t.data=i,t.delegate=r,t.states=Z({},Wzt,s)}_dispatchLegendEvent(t,e,i){const r=this._getSelectedLegends();r.sort((o,a)=>o.index-a.index);const s=r.map(o=>o.label);this._dispatchEvent(t,{item:e,data:e.data,selected:e.hasState(Zt.selected),currentSelectedItems:r,currentSelected:s,event:i})}_handleStyle(t,e,i,r,s){const o={};return t.style&&(it(t.style)?o.style=t.style(e,i,r,s):o.style=t.style),t.state&&(o.state={},Object.keys(t.state).forEach(a=>{t.state[a]&&(it(t.state[a])?o.state[a]=t.state[a](e,i,r,s):o.state[a]=t.state[a])})),o}release(){super.release(),this.removeAllEventListeners()}};pet.defaultAttributes={layout:"horizontal",title:{align:"start",space:xb,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:IC,spaceRow:OC,shape:{space:cet,style:{size:Nw,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{opacity:.5}}},label:{space:get,style:{fontSize:12,fill:"#2C3542",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"}},focus:!1,focusIconStyle:{size:Nw,symbolType:"M8 1C11.866 1 15 4.13401 15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1ZM8.75044 2.55077L8.75 3.75H7.25L7.25006 2.5507C4.81247 2.88304 2.88304 4.81247 2.5507 7.25006L3.75 7.25V8.75L2.55077 8.75044C2.8833 11.1878 4.81264 13.117 7.25006 13.4493L7.25 12.25H8.75L8.75044 13.4492C11.1876 13.1167 13.1167 11.1876 13.4492 8.75044L12.25 8.75V7.25L13.4493 7.25006C13.117 4.81264 11.1878 2.8833 8.75044 2.55077ZM8 5.5C9.38071 5.5 10.5 6.61929 10.5 8C10.5 9.38071 9.38071 10.5 8 10.5C6.61929 10.5 5.5 9.38071 5.5 8C5.5 6.61929 6.61929 5.5 8 5.5ZM8 7C7.44772 7 7 7.44772 7 8C7 8.55228 7.44772 9 8 9C8.55228 9 9 8.55228 9 8C9 7.44772 8.55228 7 8 7Z",fill:"#333",cursor:"pointer"}},autoPage:!0,pager:{space:bI,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!0};var Zn;(function(n){n.innerView="innerView",n.railContainer="sliderRailContainer",n.rail="sliderRail",n.startText="sliderStartText",n.endText="sliderEndText",n.startHandler="sliderStartHandler",n.startHandlerText="startHandlerText",n.endHandler="sliderEndHandler",n.endHandlerText="sliderEndHandlerText",n.track="sliderTrack",n.trackContainer="sliderTrackContainer"})(Zn||(Zn={}));function $B(n){return V(n)?n:[n,n]}function tC(n){return n?"ew-resize":"ns-resize"}bT();class Uf extends En{get track(){return this._track}get currentValue(){return this._currentValue}get startHandler(){return this._startHandler}get endHandler(){return this._endHandler}get tooltipShape(){return this._tooltipShape}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Uf.defaultAttributes,t)),this.name="slider",this._isHorizontal=!0,this._startHandler=null,this._endHandler=null,this._startHandlerText=null,this._endHandlerText=null,this._currentHandler=null,this._currentValue={},this._onTooltipShow=i=>{this._isChanging||this._tooltipState&&this._tooltipState.isActive||(this._tooltipState?this._tooltipState.isActive=!0:this._tooltipState={isActive:!0},this._onTooltipUpdate(i),this._dispatchTooltipEvent("sliderTooltipShow"))},this._onTooltipUpdate=i=>{if(this._isChanging||!this._tooltipState||!this._tooltipState.isActive)return;const r=this._isHorizontal?this._rail.globalAABBBounds.width():this._rail.globalAABBBounds.height(),s=Ne(this._isHorizontal?(i.viewX-this._rail.globalAABBBounds.x1)/r:(i.viewY-this._rail.globalAABBBounds.y1)/r,0,1);s!==this._tooltipState.pos&&(this._tooltipState.pos=s,this._tooltipState.value=this.calculateValueByPos(s*r),this._updateTooltip(),this._dispatchTooltipEvent("sliderTooltipUpdate"))},this._onTooltipHide=()=>{const{tooltip:i}=this.attribute;i&&i.alwaysShow||(this._tooltipState=null,this._tooltipShape&&this._tooltipShape.setAttribute("visible",!1),this._tooltipText&&this._tooltipText.setAttribute("visible",!1),this._dispatchTooltipEvent("sliderTooltipHide"))},this._onHandlerPointerdown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:r,y:s}=this.stage.eventPointTransform(i);this._currentHandler=i.target,this._prePos=this._isHorizontal?r:s;const o=ic(),a=le.env==="browser"?le:this.stage;a.addEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),o.forEach(l=>{a.addEventListener(l,this._onHandlerPointerUp)})},this._onHandlerPointerMove=i=>{var r,s;this._isChanging=!0;const{railWidth:o,railHeight:a,min:l,max:h}=this.attribute;if(h===l)return;const{x:d,y:u}=this.stage.eventPointTransform(i);let c,g,p,f=0;this._isHorizontal?(c=d,f=c-this._prePos,g=(s=this._currentHandler)===null||s===void 0?void 0:s.attribute.x,p=o):(c=u,f=c-this._prePos,g=(r=this._currentHandler)===null||r===void 0?void 0:r.attribute.y,p=a);const m=Ne(g+f,0,p),v=this.calculateValueByPos(m);this._currentHandler.type==="text"?this._updateHandlerText(this._currentHandler,m,v):this._updateHandler(this._currentHandler,m,v),this._updateTrack(),this._prePos=c,this._dispatchChangeEvent()},this._onHandlerPointerUp=i=>{this._isChanging=!1,this._currentHandler=null,this._clearAllDragEvents()},this._handleTouchMove=i=>{this._isChanging&&i.preventDefault()},this._onTrackPointerdown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{x:r,y:s}=this.stage.eventPointTransform(i);this._prePos=this._isHorizontal?r:s;const o=ic(),a=le.env==="browser"?le:this.stage;a.addEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),o.forEach(l=>{a.addEventListener(l,this._onTrackPointerUp)})},this._onTrackPointerMove=i=>{this._isChanging=!0;const{railWidth:r,railHeight:s,min:o,max:a,inverse:l}=this.attribute;if(a===o)return;const{startHandler:h,endHandler:d}=this._getHandlers();let u,c,g;const{x:p,y:f}=this.stage.eventPointTransform(i);this._isHorizontal?(u=p,c=this._track.attribute.width,g=r):(u=f,c=this._track.attribute.height,g=s);const m=u-this._prePos;if(h){const v=this._isHorizontal?h.attribute.x:h.attribute.y,_=l?Ne(v+m,c,g):Ne(v+m,0,g-c),b=this.calculateValueByPos(_);this._updateHandler(h,_,b)}if(d){const v=this._isHorizontal?d.attribute.x:d.attribute.y,_=l?Ne(v+m,0,g-c):Ne(v+m,c,g),b=this.calculateValueByPos(_),y=h==null?void 0:h.attribute;this._updateHandler(d,_,b),this._track.setAttributes(this._isHorizontal?{x:Math.min(y.x,d.attribute.x),width:Math.abs(y.x-d.attribute.x)}:{y:Math.min(y.y,d.attribute.y),height:Math.abs(y.y-d.attribute.y)})}this._prePos=u,this._dispatchChangeEvent()},this._onTrackPointerUp=i=>{this._isChanging=!1,this._clearAllDragEvents()},this._onRailPointerDown=i=>{this._clearAllDragEvents(),this._isChanging=!0;const{railWidth:r,railHeight:s,min:o,max:a}=this.attribute;if(a===o)return;const l=this._startHandler,h=this._endHandler;let d,u,c;this._isHorizontal?(d=i.viewX-this._rail.globalAABBBounds.x1,u=l==null?void 0:l.attribute.x,c=h==null?void 0:h.attribute.x):(d=i.viewY-this._rail.globalAABBBounds.y1,u=l==null?void 0:l.attribute.y,c=h==null?void 0:h.attribute.y);const g=this.calculateValueByPos(d);if(L(c)){const p=Math.abs(d-u)>Math.abs(d-c)?h:l;this._updateHandler(p,d,g)}else this._updateHandler(l,d,g);this._updateTrack(),this._dispatchChangeEvent()}}calculatePosByValue(t,e){const{layout:i,railWidth:r,railHeight:s,min:o,max:a,inverse:l}=this.attribute;let h=0;return h=o===a?e==="start"?0:e==="end"?1:0:(t-o)/(a-o),(l?1-h:h)*(i==="vertical"?s:r)}calculateValueByPos(t){const{layout:e,railWidth:i,railHeight:r,min:s,max:o,inverse:a}=this.attribute,l=e==="vertical"?r:i;return s+(o-s)*(a?1-t/l:t/l)}setValue(t){const{min:e,max:i}=this.attribute;if(i===e)return;const[r,s]=Q(t),{startHandler:o,endHandler:a}=this._getHandlers();o&&this._updateHandler(o,this.calculatePosByValue(r),r),a&&this._updateHandler(a,this.calculatePosByValue(s),s),this._updateTrack()}render(){var t,e;this.removeAllChild(!0);const{layout:i="horizontal",railWidth:r,railHeight:s,startText:o,endText:a,min:l,max:h,showHandler:d=!0,showTooltip:u}=this.attribute;let{value:c}=this.attribute;D(c)&&(c=[l,h]),this._currentValue={startValue:$B(c)[0],endValue:$B(c)[1]};const g=i==="horizontal";this._isHorizontal=g;const p=Pt.group({x:0,y:0});p.name=Zn.innerView,this.add(p),this._innerView=p;let f,m=0;if(o&&o.visible){f=Pt.text(Object.assign({x:g?0:r/2,y:g?s/2:0,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:o.text,lineHeight:(t=o.style)===null||t===void 0?void 0:t.fontSize},o.style)),f.name=Zn.startText,p.add(f);const y=L(o.space)?o.space:0;m+=(g?f.AABBBounds.width():f.AABBBounds.height())+y}const v=Pt.group({x:g?m:0,y:g?0:m});p.add(v);const _=Pt.group({x:0,y:0});let b;if(_.name=Zn.railContainer,this._railContainer=_,v.add(_),this._mainContainer=v,this._renderRail(_),m+=g?r:s,a&&a.visible){const y=L(a.space)?a.space:0;b=Pt.text(Object.assign({x:g?m+y:r/2,y:g?s/2:m+y,textAlign:g?"start":"center",textBaseline:g?"middle":"top",text:a.text,lineHeight:(e=a.style)===null||e===void 0?void 0:e.fontSize},a.style)),b.name=Zn.endText,p.add(b)}this._renderTrack(_),d&&(this._renderHandlers(v),this._bindEvents()),u&&(this._renderTooltip(),this._bindTooltipEvents())}_renderRail(t){const{railWidth:e,railHeight:i,railStyle:r,slidable:s}=this.attribute;let o="default";s!==!1&&(o="pointer");const a=Pt.rect(Object.assign({x:0,y:0,width:e,height:i,cursor:o},r));return a.name=Zn.rail,t.add(a),this._rail=a,a}_renderHandlers(t){const{range:e,min:i,max:r,handlerSize:s=14,handlerStyle:o,handlerText:a,railHeight:l,railWidth:h,slidable:d}=this.attribute;let{value:u}=this.attribute;D(u)&&(u=[i,r]);const c=a&&a.visible,g=this._isHorizontal,[p,f]=$B(u),m=this.calculatePosByValue(p,e?"start":"end"),v=this._renderHandler(Object.assign({x:g?m:h/2,y:g?l/2:m,size:s,strokeBoundsBuffer:0,cursor:d===!1?"default":tC(g)},o));if(v.name=Zn.startHandler,this._startHandler=v,t.add(v),this._currentValue.startPos=m,c){const _=this._renderHandlerText(p,e?"start":"end");_.name=Zn.startHandlerText,t.add(_),this._startHandlerText=_}if(e){const _=this.calculatePosByValue(f,"end"),b=this._renderHandler(Object.assign({x:g?_:h/2,y:g?l/2:_,size:s,strokeBoundsBuffer:0,cursor:d===!1?"default":tC(g)},o));if(b.name=Zn.endHandler,this._endHandler=b,t.add(b),this._currentValue.endPos=_,c){const y=this._renderHandlerText(f,"end");y.name=Zn.endHandlerText,t.add(y),this._endHandlerText=y}}}_renderTrack(t){const{range:e,min:i,max:r,railHeight:s,railWidth:o,trackStyle:a,railStyle:l,slidable:h,value:d}=this.attribute;let u,c;if(D(d))e?(u=i,c=r):u=c=i;else if(e){const y=ts(d,i,r);u=y[0],c=y[1]}else u=i,c=Ne(d,i,r);const g=this._isHorizontal;e||(u=i);const p=Pt.group({x:0,y:0,width:o,height:s,cornerRadius:l==null?void 0:l.cornerRadius,clip:!0,pickable:!1});p.name=Zn.trackContainer;const f=kt(e)&&e.draggableTrack===!0;let m;m=h===!1?"default":e===!1||f===!1?"pointer":tC(g);const v=this.calculatePosByValue(u,"start"),_=this.calculatePosByValue(c,e?"end":"start"),b=Pt.rect(Object.assign({x:g?Math.min(v,_):0,y:g?0:Math.min(v,_),width:g?Math.abs(_-v):o,height:g?s:Math.abs(_-v),cursor:m},a));b.name=Zn.track,this._track=b,p.add(b),t.add(p)}_renderHandler(t){return Pt.symbol(t)}_renderHandlerText(t,e){var i,r,s;const{align:o,handlerSize:a=14,handlerText:l={},railHeight:h,railWidth:d,slidable:u}=this.attribute,c=this._isHorizontal,g=this.calculatePosByValue(t,e),p=(i=l.space)!==null&&i!==void 0?i:4,f={text:l.formatter?l.formatter(t):t.toFixed((r=l.precision)!==null&&r!==void 0?r:0),lineHeight:(s=l.style)===null||s===void 0?void 0:s.lineHeight,cursor:u===!1?"default":tC(c)};return c?o==="top"?(f.textBaseline="bottom",f.textAlign="center",f.x=g,f.y=(h-a)/2-p):(f.textBaseline="top",f.textAlign="center",f.x=g,f.y=(h+a)/2+p):o==="left"?(f.textBaseline="middle",f.textAlign="end",f.x=(d-a)/2-p,f.y=g):(f.textBaseline="middle",f.textAlign="start",f.x=(d+a)/2+p,f.y=g),Pt.text(Object.assign(Object.assign({},f),l.style))}_renderTooltip(){var t;const{tooltip:e,railHeight:i,railWidth:r,align:s}=this.attribute;e&&e.alwaysShow?this._tooltipState={value:this._currentValue.startValue,pos:this._currentValue.startPos}:this._tooltipState=null;const o=this._isHorizontal?0:r/2,a=this._isHorizontal?i/2:0;if(e&&e.shape){const c=Pt.symbol(Object.assign({pickable:!1,visible:!!this._tooltipState,x:o,y:a,symbolType:"circle"},e.shapeStyle));this._tooltipShape=c,this._mainContainer.add(c)}const l=e&&e.text||{},h=(t=l.space)!==null&&t!==void 0?t:6,d={pickable:!1,visible:!!this._tooltipState,text:""};this._isHorizontal?(d.x=o,d.y=s==="top"?a-i/2-h:a+i/2+h,d.textAlign="center",d.textBaseline=s==="top"?"bottom":"top"):(d.y=a,d.x=s==="left"?o-r/2-h:a+r/2+h,d.textAlign=s==="left"?"end":"start",d.textBaseline="middle");const u=Pt.text(Object.assign(Object.assign({},d),l.style));this._mainContainer.add(u),this._tooltipText=u,this._tooltipState&&this._updateTooltip()}_updateTooltip(){var t,e;if(!this._tooltipShape&&!this._tooltipText||!this._tooltipState)return;const{railWidth:i,railHeight:r}=this.attribute,s=this._isHorizontal?i:r,o=this._tooltipState.pos*s,a=this._isHorizontal?"x":"y";this._tooltipShape&&this._tooltipShape.setAttributes({visible:!0,[a]:o});const{align:l}=this.attribute;if(this._tooltipText){const h=this.attribute.tooltip&&this.attribute.tooltip.text||{};this._tooltipText.setAttributes({visible:!0,[a]:o,text:h.formatter?h.formatter(this._tooltipState.value):this._isHorizontal||l!=="left"?` ${this._tooltipState.value.toFixed((e=h.precision)!==null&&e!==void 0?e:0)}`:`${this._tooltipState.value.toFixed((t=h.precision)!==null&&t!==void 0?t:0)} `})}}_bindEvents(){if(this.attribute.disableTriggerEvent)return;const{slidable:t,range:e}=this.attribute;t&&(this._startHandler&&this._startHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._startHandlerText&&this._startHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandler&&this._endHandler.addEventListener("pointerdown",this._onHandlerPointerdown),this._endHandlerText&&this._endHandlerText.addEventListener("pointerdown",this._onHandlerPointerdown),kt(e)&&e.draggableTrack&&this._track.addEventListener("pointerdown",this._onTrackPointerdown),this._railContainer.addEventListener("pointerdown",this._onRailPointerDown),(le.env==="browser"?le:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}))}_bindTooltipEvents(){this.attribute.disableTriggerEvent||(this._mainContainer.addEventListener("pointerenter",this._onTooltipShow),this._mainContainer.addEventListener("pointermove",this._onTooltipUpdate),this._mainContainer.addEventListener("pointerleave",this._onTooltipHide))}_clearAllDragEvents(){const t=ic(),e=le.env==="browser"?le:this.stage;e.removeEventListener("pointermove",this._onHandlerPointerMove,{capture:!0}),t.forEach(i=>{e.removeEventListener(i,this._onHandlerPointerUp)}),e.removeEventListener("pointermove",this._onTrackPointerMove,{capture:!0}),t.forEach(i=>{e.removeEventListener(i,this._onTrackPointerUp)})}_updateTrack(){const{inverse:t,railWidth:e,railHeight:i}=this.attribute,r=this._startHandler,s=this._endHandler;if(this._isHorizontal){const o=r==null?void 0:r.attribute.x;if(s){const a=s==null?void 0:s.attribute.x;this._track.setAttributes({x:Math.min(o,a),width:Math.abs(o-a)})}else t?this._track.setAttributes({x:o,width:e-o}):this._track.setAttributes({width:o})}else{const o=r==null?void 0:r.attribute.y;if(s){const a=s==null?void 0:s.attribute.y;this._track.setAttributes({y:Math.min(o,a),height:Math.abs(o-a)})}else t?this._track.setAttributes({y:o,height:i-o}):this._track.setAttributes({height:o})}}_updateHandler(t,e,i){var r;const s=this._isHorizontal;t.setAttribute(s?"x":"y",e);const o=t.name===Zn.startHandler?this._startHandlerText:this._endHandlerText;if(o){const{handlerText:a={}}=this.attribute;o.setAttributes({text:a.formatter?a.formatter(i):i.toFixed((r=a.precision)!==null&&r!==void 0?r:0),[s?"x":"y"]:e})}t.name===Zn.startHandler?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_updateHandlerText(t,e,i){var r;const s=this._isHorizontal,{handlerText:o={}}=this.attribute;t.setAttributes({[s?"x":"y"]:e,text:o.formatter?o.formatter(i):i.toFixed((r=o.precision)!==null&&r!==void 0?r:0)});const a=t.name===Zn.startHandlerText?this._startHandler:this._endHandler;a&&a.setAttributes({[s?"x":"y"]:e}),t.name===Zn.startHandlerText?(this._currentValue.startValue=i,this._currentValue.startPos=e):(this._currentValue.endValue=i,this._currentValue.endPos=e)}_dispatchChangeEvent(){const t=!!this.attribute.range,e=this._currentValue;this._dispatchEvent("change",{value:t?[Math.min(e.endValue,e.startValue),Math.max(e.endValue,e.startValue)]:e.startValue,position:t?[Math.min(e.endPos,e.startPos),Math.max(e.endPos,e.startPos)]:e.startPos})}_dispatchTooltipEvent(t){this._dispatchEvent("sliderTooltip",{type:t,position:this._tooltipState&&this._tooltipState.pos,value:this._tooltipState&&this._tooltipState.value})}_getHandlers(){const{inverse:t}=this.attribute;let e=this._startHandler,i=this._endHandler;return i?(this._isHorizontal?(!t&&i.attribute.x<(e==null?void 0:e.attribute.x)||t&&i.attribute.x>(e==null?void 0:e.attribute.x))&&([e,i]=[i,e]):(!t&&i.attribute.y<(e==null?void 0:e.attribute.y)||t&&i.attribute.y>(e==null?void 0:e.attribute.y))&&([e,i]=[i,e]),{startHandler:e,endHandler:i}):{startHandler:e,endHandler:i}}release(t){super.release(t),(le.env==="browser"?le:this.stage).addEventListener("touchmove",this._handleTouchMove,{passive:!1}),this._clearAllDragEvents()}}Uf.defaultAttributes={slidable:!0,layout:"horizontal",align:"bottom",height:8,showHandler:!0,handlerSize:14,handlerStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},tooltip:{shapeStyle:{symbolType:"circle",fill:"#fff",stroke:"#91caff",lineWidth:2},text:{style:{fill:"#2C3542",fontSize:12}}},railStyle:{fill:"rgba(0,0,0,.04)"},trackStyle:{fill:"#91caff"},showValue:!0,valueStyle:{fill:"#2C3542",fontSize:12},startText:{style:{fill:"#2C3542",fontSize:12}},endText:{style:{fill:"#2C3542",fontSize:12}},handlerText:{visible:!0,space:4,precision:0,style:{fill:"#2C3542",fontSize:12}}};Hzt();class yT extends AF{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},yT.defaultAttributes,t)),this.name="colorLegend",this._onSliderToolipChange=i=>{const r=this._slider.tooltipShape;if(r&&i.detail&&!D(i.detail.value)){const s=this._colorScale.scale(i.detail.value);r.setAttribute("fill",s)}this.dispatchEvent(i)},this._onSliderChange=i=>{this._updateColor(),this.dispatchEvent(i)}}setSelected(t){this._slider&&(this._slider.setValue(t),this._updateColor())}_renderContent(){const{colors:t,slidable:e,layout:i,align:r,min:s,max:o,value:a,railWidth:l,railHeight:h,showHandler:d=!0,handlerSize:u,handlerStyle:c,railStyle:g,trackStyle:p,startText:f,endText:m,handlerText:v,showTooltip:_,tooltip:b,inverse:y,disableTriggerEvent:C}=this.attribute,S=[],w=(o-s)/(t.length-1);for(let A=0;A<t.length;A++)S.push(s+w*A);this._colorScale=new Vs().domain(S,!0).range(t),this._color=this._getTrackColor();const x=new Uf({x:0,y:0,range:{draggableTrack:!0},slidable:e,layout:i,align:r,min:s,max:o,value:a,railWidth:l,railHeight:h,showHandler:d,handlerSize:u,handlerStyle:c,railStyle:g,trackStyle:Object.assign({fill:this._color},p),startText:f,endText:m,handlerText:v,showTooltip:_,tooltip:b,disableTriggerEvent:C,inverse:y});this._innerView.add(x),this._slider=x,x.translateTo(0-x.AABBBounds.x1,(this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",xb):0)-x.AABBBounds.y1),this._updateColor()}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}_getTrackColor(){const{colors:t,layout:e,inverse:i}=this.attribute;if(xt(t))return;const r=t.length;if(r===1)return t[0];const s=[];for(let l=0;l<r;l++){const h=l/(r-1);s.push({offset:h,color:t[l]})}const o=e==="horizontal",a={gradient:"linear",stops:s,x0:0,y0:0,x1:o?1:0,y1:o?0:1};return i&&(o?(a.x0=1,a.x1=0):(a.y0=1,a.y1=0)),a}_updateColor(){var t;const{layout:e="horizontal",colors:i,railWidth:r,railHeight:s}=this.attribute,{startHandler:o,endHandler:a,track:l,attribute:h}=this._slider,{startValue:d,endValue:u,startPos:c,endPos:g}=this._slider.currentValue,p=(t=h.handlerStyle)===null||t===void 0?void 0:t.fill;if(o&&!p){const m=this._colorScale.scale(d);o.setAttribute("fill",m)}if(a&&!p){const m=this._colorScale.scale(u);a.setAttribute("fill",m)}const f=e==="horizontal"?r:s;if(Math.abs(c-g)!==f&&i&&i.length>1){const m=this._color.stops,v=Math.min(c,g),_=Math.max(c,g),b=v/f,y=_/f,C=y-b,S=m.filter(R=>R.offset>b&&R.offset<y),w=Math.min(d,u),x=Math.max(d,u),A=this._colorScale.scale(w),M=this._colorScale.scale(x),T=[{offset:0,color:A}];S.forEach(R=>{T.push({offset:(R.offset-b)/C,color:R.color})}),T.push({offset:1,color:M}),l.setAttribute("fill",Object.assign(Object.assign({},this._color),{stops:T}))}}}yT.defaultAttributes={layout:"horizontal",title:{align:"start",space:xb,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{fill:null,lineWidth:4,stroke:"#fff",outerBorder:{distance:2,lineWidth:1,stroke:"#ccc"}},tooltip:{shapeStyle:{lineWidth:4,stroke:"#fff"}}};function jzt(n="bottom"){let t=0;return n==="top"?`
    M${t},-6L${t-3.5},-2.5
    v5
    h7
    v-5
    Z
`:n==="left"?(t=1,`
    M${t-6},0L${t-6+2.5},-3.5
    h5
    v7
    h-5
    Z
`):n==="right"?(t=-1,`
    M${t+6},0L${t+6-2.5},-3.5
    h-5
    v7
    h5
    Z
  `):`
    M${t},6L${t-3.5},2.5
    v-5
    h7
    v5
    Z
`}zzt();class CT extends AF{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},CT.defaultAttributes,t)),this.name="sizeLegend",this._onSliderChange=i=>{this.dispatchEvent(i)},this._onSliderToolipChange=i=>{this.dispatchEvent(i)}}setSelected(t){this._slider&&this._slider.setValue(t)}_renderContent(){const{slidable:t,layout:e,align:i,min:r,max:s,value:o,railWidth:a,railHeight:l,showHandler:h=!0,handlerSize:d,handlerStyle:u,railStyle:c,trackStyle:g,startText:p,endText:f,handlerText:m,showTooltip:v,tooltip:_,sizeBackground:b,disableTriggerEvent:y,inverse:C}=this.attribute,S=Pt.group({x:0,y:0});this._innerView.add(S);const w=new Uf({x:0,y:0,zIndex:1,range:{draggableTrack:!0},slidable:t,layout:e,align:i,min:r,max:s,value:o,railWidth:a,railHeight:l,showHandler:h,handlerSize:d,handlerStyle:Object.assign({symbolType:jzt(i)},u),railStyle:c,trackStyle:g,startText:p,endText:f,handlerText:m,showTooltip:v,tooltip:_,disableTriggerEvent:y,inverse:C});S.add(w);let x,A=0;e==="horizontal"?i==="top"?(x=`M0,0L${a},0L${C?0:a},12Z`,A=l):(x=`M0,12L${a},12L${C?0:a},0Z`,w.setAttribute("y",12)):i==="left"?x=`M${a},0L${a+12},${C?0:l}L${a},${l}Z`:(x=`M0,${C?0:l}L12,${l}L12,0Z`,w.setAttribute("x",12));const M=Pt.path(Object.assign(Object.assign({x:0,y:A,path:x},b),{zIndex:0}));S.add(M);const T=this._title?this._title.AABBBounds.height()+Dt(this.attribute,"title.space",xb):0;S.translate(0-S.AABBBounds.x1,T-S.AABBBounds.y1),this._slider=w}_bindEvents(){this.attribute.disableTriggerEvent||this._slider&&(this._slider.addEventListener("change",this._onSliderChange),this._slider.addEventListener("sliderTooltip",this._onSliderToolipChange))}}CT.defaultAttributes={layout:"horizontal",title:{align:"start",space:xb,textStyle:{fontSize:12,fontWeight:"bold",fill:"rgba(46, 47, 50, 1)"}},handlerSize:10,handlerStyle:{lineWidth:1,stroke:"#ccc",fill:"#fff"},sizeBackground:{fill:"rgba(20,20,20,0.1)"}};function Nzt(){Xi(),al(),Xd()}Nzt();let met=class vet extends En{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},vet.defaultAttributes,t)),this.name="title"}render(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y;const{textType:C,text:S,subtextType:w,textStyle:x={},subtext:A,subtextStyle:M={},width:T,height:R,minWidth:B,maxWidth:E,minHeight:k,maxHeight:P,align:I,verticalAlign:O,padding:H=0}=this.attribute,z=Fi(H),F=this.createOrUpdateChild("title-container",{x:z[3],y:z[0],zIndex:1},"group"),j=(t=x.height)!==null&&t!==void 0?t:R;if(this.attribute.visible!==!1&&x.visible!==!1){const{width:rt,maxHeight:pt,maxWidth:at,x:W=0,y:N=0,ellipsis:K=!0,wordBreak:nt="break-word",maxWidth:X,lineClamp:ht}=x;if(C==="rich"||L(x.character)){const _t=Object.assign({x:W,y:N,width:(e=rt??T)!==null&&e!==void 0?e:0,height:j??0,ellipsis:K==null||K,wordBreak:nt??"break-word",maxHeight:pt??P,maxWidth:at??X,textConfig:(i=x.character)!==null&&i!==void 0?i:S},x);this._mainTitle=F.createOrUpdateChild("mainTitle",_t,"richtext")}else if(C==="html"){const _t=Object.assign({html:Object.assign(Object.assign({dom:S},Ow),x),x:W,y:N,width:(r=rt??T)!==null&&r!==void 0?r:0,height:j??0,ellipsis:K,wordBreak:nt,maxHeight:pt??P,maxWidth:at??X,textConfig:[]},x);this._mainTitle=F.createOrUpdateChild("mainTitle",_t,"richtext")}else L(S)&&(this._mainTitle=F.createOrUpdateChild("mainTitle",Object.assign(Object.assign({text:V(S)?S:[S],whiteSpace:"normal"},x),{maxLineWidth:(o=(s=x.maxLineWidth)!==null&&s!==void 0?s:rt)!==null&&o!==void 0?o:T,heightLimit:(a=x.height)!==null&&a!==void 0?a:P,lineClamp:ht,ellipsis:K,x:W,y:N}),"text"))}const $=this._mainTitle?this._mainTitle.AABBBounds.height():0,Y=this._mainTitle?this._mainTitle.AABBBounds.width():0;if(this.attribute.visible!==!1&&M.visible!==!1){const{width:rt,height:pt,maxWidth:at,maxHeight:W,x:N=0,y:K=0,ellipsis:nt=!0,wordBreak:X="break-word",lineClamp:ht}=M,_t=Math.max(Number.MIN_VALUE,P-$);if(w==="rich"||L(M.character)){const ct=Object.assign({x:N,y:K,width:(l=rt??T)!==null&&l!==void 0?l:0,height:(h=pt??R)!==null&&h!==void 0?h:0,ellipsis:nt,wordBreak:X,maxHeight:W??_t,maxWidth:at??E,textConfig:(d=M.character)!==null&&d!==void 0?d:A},M);this._subTitle=F.createOrUpdateChild("subTitle",ct,"richtext")}else if(w==="html"){const ct=Object.assign({html:Object.assign(Object.assign({dom:A},Ow),M),x:N,y:K,width:(u=rt??T)!==null&&u!==void 0?u:0,height:(c=pt??R)!==null&&c!==void 0?c:0,ellipsis:nt,wordBreak:X,maxHeight:W??_t,maxWidth:at??E,textConfig:[]},M);this._subTitle=F.createOrUpdateChild("subTitle",ct,"richtext")}else L(A)&&(this._subTitle=F.createOrUpdateChild("subTitle",Object.assign(Object.assign({text:V(A)?A:[A],whiteSpace:"normal"},M),{maxLineWidth:(g=M.maxLineWidth)!==null&&g!==void 0?g:T,heightLimit:(p=M.heightLimit)!==null&&p!==void 0?p:_t,lineClamp:ht,ellipsis:nt,x:0,y:$}),"text"))}const G=this._subTitle?this._subTitle.AABBBounds.height():0,tt=this._subTitle?this._subTitle.AABBBounds.width():0;let st=Math.max(Y,tt),ot=$+((f=M.height)!==null&&f!==void 0?f:G);if(L(T)&&(st=T),L(R)&&(ot=R),L(B)&&st<B&&(st=B),L(E)&&st>E&&(st=E),L(k)&&ot<k&&(ot=k),L(P)&&ot>P&&(ot=P),F.attribute.width=st,F.attribute.height=ot,F.attribute.boundsPadding=z,this._mainTitle){if(L(I)||L(x.align)){const at=x.align?x.align:I,W=(m=x.width)!==null&&m!==void 0?m:st;at==="center"?(this._mainTitle.setAttribute("x",W/2),this._mainTitle.setAttribute("textAlign","center")):at==="right"?(this._mainTitle.setAttribute("x",W),this._mainTitle.setAttribute("textAlign","right")):(this._mainTitle.setAttribute("x",0),this._mainTitle.setAttribute("textAlign","left"))}const rt=x.verticalAlign?x.verticalAlign:O,pt=j??(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height());rt==="middle"?(this._mainTitle.setAttribute("y",pt/2),this._mainTitle.setAttribute("textBaseline","middle")):rt==="bottom"?(this._mainTitle.setAttribute("y",pt),this._mainTitle.setAttribute("textBaseline","bottom")):(this._mainTitle.setAttribute("y",0),this._mainTitle.setAttribute("textBaseline","top"))}if(this._subTitle){if(L(I)||L(M.align)){const W=M.align?M.align:I,N=(_=(v=M.width)!==null&&v!==void 0?v:x.width)!==null&&_!==void 0?_:st;W==="center"?(this._subTitle.setAttribute("x",N/2),this._subTitle.setAttribute("textAlign","center")):W==="right"?(this._subTitle.setAttribute("x",N),this._subTitle.setAttribute("textAlign","right")):(this._subTitle.setAttribute("x",0),this._subTitle.setAttribute("textAlign","left"))}const rt=M.verticalAlign?M.verticalAlign:O,pt=this._mainTitle?L(j)?this._mainTitle.AABBBounds.y1+Math.max(this._mainTitle.AABBBounds.empty()?0:this._mainTitle.AABBBounds.height(),j):this._mainTitle.AABBBounds.y2:0,at=(y=(b=M.height)!==null&&b!==void 0?b:R)!==null&&y!==void 0?y:this._subTitle.AABBBounds.empty()?0:this._subTitle.AABBBounds.height();rt==="middle"?(this._subTitle.setAttribute("y",pt+at/2),this._subTitle.setAttribute("textBaseline","middle")):rt==="bottom"?(this._subTitle.setAttribute("y",pt+at),this._subTitle.setAttribute("textBaseline","bottom")):(this._subTitle.setAttribute("y",pt),this._subTitle.setAttribute("textBaseline","top"))}}};met.defaultAttributes={textStyle:{ellipsis:"...",fill:"#333",fontSize:20,fontWeight:"bold",textAlign:"left",textBaseline:"top"},subtextStyle:{ellipsis:"...",fill:"#6F6F6F",fontSize:16,fontWeight:"normal",textAlign:"left",textBaseline:"top"}};const $zt={title:{style:{text:"",fontSize:20,fill:"black",fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}},content:{style:{text:"",fontSize:16,fill:"black",fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}}};function Vzt(){Xi(),al(),Xd()}Vzt();let Gzt=class extends En{constructor(){super(...arguments),this.name="indicator"}_renderText(t,e,i,r,s,o){if(e.visible!==!1){const a=Z({},Dt($zt,s),e.style,{visible:e.visible});a.lineHeight=L(a.lineHeight)?a.lineHeight:a.fontSize,e.formatMethod&&(a._originText=a.text,a.text=e.formatMethod(a.text,a));const l=u0(a);return l.name=o,t.appendChild(l),e.autoFit&&et(i)&&this._setLocalAutoFit(i,l,e),e.autoLimit&&et(r)&&l.setAttribute("maxLineWidth",i),l}}render(){var t,e;if(this.removeAllChild(!0),this.attribute.visible!==!0)return;const{title:i={},content:r,size:s,limitRatio:o=1/0}=this.attribute,a=Math.min(s.width,s.height)*o,l=this.createOrUpdateChild("indicator-container",{x:0,y:0,zIndex:1,pickable:(t=this.attribute.pickable)===null||t===void 0||t},"group");if(L(i)&&(this._title=this._renderText(l,i,a,o,"title.style","indicator-title")),L(r)){const d=Q(r),u=[];d.forEach((c,g)=>{c.visible!==!1&&u.push(this._renderText(l,c,a,o,"content.style","indicator-content-"+g))}),this._content=u}this._setGlobalAutoFit(a),this._setYPosition();const h=(e=l==null?void 0:l.AABBBounds.height())!==null&&e!==void 0?e:0;l.setAttribute("y",s.height/2-h/2),l.setAttribute("x",s.width/2)}_setLocalAutoFit(t,e,i){var r,s,o,a,l,h,d,u,c;if(((r=i.fitStrategy)!==null&&r!==void 0?r:"default")!=="default")return;const g=nT((o=(s=i.style)===null||s===void 0?void 0:s.text)!==null&&o!==void 0?o:"",(a=i.style)!==null&&a!==void 0?a:{},(h=(l=this.stage)===null||l===void 0?void 0:l.getTheme())===null||h===void 0?void 0:h.text).width;if(g>0){const p=t*((d=i.fitPercent)!==null&&d!==void 0?d:.5)/g,f=Math.floor(((c=(u=i.style)===null||u===void 0?void 0:u.fontSize)!==null&&c!==void 0?c:20)*p);e.setAttribute("fontSize",f),e.setAttribute("lineHeight",L(i.style.lineHeight)?i.style.lineHeight:f)}}_setGlobalAutoFit(t){var e,i,r,s,o,a,l;const h=t/2,d=[];let u=0;const c=(e=this.attribute.title)!==null&&e!==void 0?e:{};c.autoFit&&c.fitStrategy==="inscribed"?(this._title.setAttribute("fontSize",12),d.push({text:this._title,spec:(i=this.attribute.title)!==null&&i!==void 0?i:{}})):u+=(a=(o=(s=(r=this._title)===null||r===void 0?void 0:r.AABBBounds)===null||s===void 0?void 0:s.height)===null||o===void 0?void 0:o.call(s))!==null&&a!==void 0?a:0;const g=(l=c.space)!==null&&l!==void 0?l:0;if(u+=g,Q(this.attribute.content).filter(C=>C.visible!==!1).forEach((C,S)=>{var w,x,A,M;const T=this._content[S];C.autoFit&&C.fitStrategy==="inscribed"?(T.setAttribute("fontSize",12),d.push({text:T,spec:C})):u+=(A=(x=(w=T==null?void 0:T.AABBBounds)===null||w===void 0?void 0:w.height)===null||x===void 0?void 0:x.call(w))!==null&&A!==void 0?A:0;const R=(M=C.space)!==null&&M!==void 0?M:0;u+=R}),d.length<=0)return;const p=12/d.reduce((C,S)=>Math.max(C,S.text.AABBBounds.width()),0)*d.length,f=u/2,m=p**2+1,v=2*f*p,_=f**2-h**2,b=2*(p*((-v+Math.sqrt(v**2-4*m*_))/(2*m))+f),y=(b-u)/d.length;et(b)&&d.forEach(C=>{var S;const w=(S=C.spec.style)===null||S===void 0?void 0:S.lineHeight;C.text.setAttribute("fontSize",y),C.text.setAttribute("lineHeight",L(w)?w:y)})}_setYPosition(){var t,e,i,r,s,o;let a=0;const l=(r=(i=(e=(t=this._title)===null||t===void 0?void 0:t.AABBBounds)===null||e===void 0?void 0:e.height)===null||i===void 0?void 0:i.call(e))!==null&&r!==void 0?r:0,h=(o=(s=this.attribute.title)===null||s===void 0?void 0:s.space)!==null&&o!==void 0?o:0;Q(this.attribute.content).filter(d=>d.visible!==!1).forEach((d,u)=>{var c;const g=this._content[u];g.setAttribute("y",l+h+a);const p=(c=d.space)!==null&&c!==void 0?c:0;a+=g.AABBBounds.height()+p})}};const Uzt="M 414.5 0.0238 c 228.9128 0 414.4762 185.5634 414.4762 414.4762 s -185.5634 414.4762 -414.4762 414.4762 S 0.0238 643.4128 0.0238 414.5 S 185.5872 0.0238 414.5 0.0238 z m 0 73.1429 C 225.9865 73.1667 73.1667 225.9865 73.1667 414.5 s 152.8198 341.3333 341.3333 341.3333 s 341.3333 -152.8198 341.3333 -341.3333 S 603.0135 73.1667 414.5 73.1667 z m -73.1429 161.4994 a 48.7619 48.7619 0 0 1 25.9901 7.5093 l 201.7524 127.1223 a 48.7619 48.7619 0 0 1 0.3657 82.2613 l -201.7524 129.6335 A 48.7619 48.7619 0 0 1 292.5952 540.1838 v -256.7314 a 48.7619 48.7619 0 0 1 48.7619 -48.7619 z m 24.381 92.9402 v 167.9116 l 131.9497 -84.7726 L 365.7381 327.6063 z",Yzt="M 414.5 0.0238 c 228.9128 0 414.4762 185.5634 414.4762 414.4762 s -185.5634 414.4762 -414.4762 414.4762 S 0.0238 643.4128 0.0238 414.5 S 185.5872 0.0238 414.5 0.0238 z m 0 73.1429 C 225.9865 73.1667 73.1667 225.9865 73.1667 414.5 s 152.8198 341.3333 341.3333 341.3333 s 341.3333 -152.8198 341.3333 -341.3333 S 603.0135 73.1667 414.5 73.1667 z m -48.7619 195.0476 v 316.9524 h -73.1429 V 268.2143 h 73.1429 z m 158.4762 0 v 316.9524 h -73.1429 V 268.2143 h 73.1429 z",Xzt="M 521.29 734.276 L 230.929 448.019 L 521.29 161.762 c 37.685 -37.153 38.003 -97.625 0.707 -134.384 c -37.297 -36.758 -98.646 -36.435 -136.331 0.718 l -357.43 352.378 c -0.155 0.153 -0.297 0.314 -0.451 0.468 c -0.084 0.082 -0.172 0.157 -0.256 0.239 c -18.357 18.092 -27.581 41.929 -27.743 65.902 c -0.004 0.311 -0.017 0.623 -0.018 0.934 c 0.001 0.316 0.014 0.632 0.018 0.948 c 0.165 23.97 9.389 47.803 27.743 65.892 c 0.083 0.082 0.171 0.157 0.255 0.239 c 0.154 0.154 0.296 0.315 0.452 0.468 l 357.43 352.378 c 37.685 37.153 99.034 37.476 136.331 0.718 c 37.297 -36.758 36.979 -97.231 -0.707 -134.384 z",Kzt="M 734.276 28.71 L 448.019 319.071 L 161.762 28.71 c -37.153 -37.685 -97.625 -38.003 -134.384 -0.707 c -36.758 37.297 -36.435 98.646 0.718 136.331 l 352.378 357.43 c 0.153 0.155 0.314 0.297 0.468 0.451 c 0.082 0.084 0.157 0.172 0.239 0.256 c 18.092 18.357 41.929 27.581 65.902 27.743 c 0.311 0.004 0.623 0.017 0.934 0.018 c 0.316 -0.001 0.632 -0.014 0.948 -0.018 c 23.97 -0.165 47.803 -9.389 65.892 -27.743 c 0.082 -0.083 0.157 -0.171 0.239 -0.255 c 0.154 -0.154 0.315 -0.296 0.468 -0.452 l 352.378 -357.43 c 37.153 -37.685 37.476 -99.034 0.718 -136.331 c -36.758 -37.297 -97.231 -36.979 -134.384 0.707 z",qzt="m 161.724 521.29 l 286.257 -290.361 l 286.257 290.361 c 37.153 37.685 97.625 38.003 134.384 0.707 c 36.758 -37.297 36.435 -98.646 -0.718 -136.331 l -352.378 -357.43 c -0.153 -0.155 -0.314 -0.297 -0.468 -0.451 c -0.082 -0.084 -0.157 -0.172 -0.239 -0.256 c -18.092 -18.357 -41.929 -27.581 -65.902 -27.743 c -0.311 -0.004 -0.623 -0.017 -0.934 -0.018 c -0.316 0.001 -0.632 0.014 -0.948 0.018 c -23.97 0.165 -47.803 9.389 -65.892 27.743 c -0.082 0.083 -0.157 0.171 -0.239 0.255 c -0.154 0.154 -0.315 0.296 -0.468 0.452 l -352.378 357.43 c -37.153 37.685 -37.476 99.034 -0.718 136.331 c 36.758 37.297 97.231 36.979 134.384 -0.707 z",Zzt="M 30 163 L 320.361 449.257 L 30 735.514 c -37.685 37.153 -38.003 97.625 -0.707 134.384 c 37.297 36.758 98.646 36.435 136.331 -0.718 l 357.43 -352.378 c 0.155 -0.153 0.297 -0.314 0.451 -0.468 c 0.084 -0.082 0.172 -0.157 0.256 -0.239 c 18.357 -18.092 27.581 -41.929 27.743 -65.902 c 0.004 -0.311 0.017 -0.623 0.018 -0.934 c -0.001 -0.316 -0.014 -0.632 -0.018 -0.948 c -0.165 -23.97 -9.389 -47.803 -27.743 -65.892 c -0.083 -0.082 -0.171 -0.157 -0.255 -0.239 c -0.154 -0.154 -0.296 -0.315 -0.452 -0.468 l -357.43 -352.378 c -37.685 -37.153 -99.034 -37.476 -136.331 -0.718 c -37.297 36.758 -36.979 97.231 0.707 134.384 z";class VB extends KM{constructor(t){super(t)}}var ss;(function(n){n.OnPlay="onPlay",n.OnPause="onPause",n.OnForward="onForward",n.OnBackward="onBackward"})(ss||(ss={}));var Jg;(function(n){n.Start="start",n.Pause="pause",n.Forward="forward",n.Backward="backward"})(Jg||(Jg={}));class Fl extends En{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Fl.defaultAttributes,t)),this._isPaused=!0,this.updateAttributes=()=>{this._startAttr={style:Object.assign(Object.assign(Object.assign({symbolType:Uzt},Fl.defaultControllerAttr),{visible:this.attribute.start.visible}),this.attribute.start.style)},this._pauseAttr={style:Object.assign(Object.assign(Object.assign({symbolType:Yzt},Fl.defaultControllerAttr),{visible:this.attribute.pause.visible}),this.attribute.pause.style)},this._forwardAttr={style:Object.assign(Object.assign(Object.assign({},Fl.defaultControllerAttr),{visible:this.attribute.forward.visible}),this.attribute.forward.style)},this._backwardAttr={style:Object.assign(Object.assign(Object.assign({},Fl.defaultControllerAttr),{visible:this.attribute.backward.visible}),this.attribute.backward.style)},this.updateLayout()},this.updateLayout=()=>{var i,r,s,o;this._layout=this.attribute.layout,this._layout==="horizontal"?(this._backwardAttr.style.symbolType=(i=this._backwardAttr.style.symbolType)!==null&&i!==void 0?i:Xzt,this._forwardAttr.style.symbolType=(r=this._forwardAttr.style.symbolType)!==null&&r!==void 0?r:Zzt):this._layout==="vertical"&&(this._backwardAttr.style.symbolType=(s=this._backwardAttr.style.symbolType)!==null&&s!==void 0?s:qzt,this._forwardAttr.style.symbolType=(o=this._forwardAttr.style.symbolType)!==null&&o!==void 0?o:Kzt)},this._initPlay=()=>{D(this._playController)&&(this._playController=new VB(Object.assign({},this._startAttr.style)),this.add(this._playController))},this._initBackward=()=>{D(this._backwardController)&&(this._backwardController=new VB(Object.assign({},this._backwardAttr.style)),this.add(this._backwardController))},this._initForward=()=>{D(this._forwardController)&&(this._forwardController=new VB(Object.assign({},this._forwardAttr.style)),this.add(this._forwardController))},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._playController.addEventListener("pointerdown",i=>{i.stopPropagation(),this._isPaused===!0?this.play():this.pause()}),this._backwardController.addEventListener("pointerdown",i=>{i.stopPropagation(),this.backward()}),this._forwardController.addEventListener("pointerdown",i=>{i.stopPropagation(),this.forward()}))},this.renderPlay=()=>{this._isPaused?this._playController.setAttributes(Object.assign({symbolType:this._playController.getComputedAttribute("symbolType")},this._startAttr.style)):this._playController.setAttributes(Object.assign({symbolType:this._playController.getComputedAttribute("symbolType")},this._pauseAttr.style))},this.renderBackward=()=>{this._backwardController.setAttributes(this._backwardAttr.style)},this.renderForward=()=>{this._forwardController.setAttributes(this._forwardAttr.style)},this.play=()=>{this._dispatchEvent(ss.OnPlay)},this.pause=()=>{this._dispatchEvent(ss.OnPause)},this.forward=()=>{this._dispatchEvent(ss.OnForward)},this.backward=()=>{this._dispatchEvent(ss.OnBackward)},this.togglePlay=()=>{this._playController.setAttributes(this._startAttr.style),this._isPaused=!0},this.togglePause=()=>{this._playController.setAttributes(this._pauseAttr.style),this._isPaused=!1},this.updateAttributes(),this._initPlay(),this._initBackward(),this._initForward(),this._initEvents()}render(){this.updateAttributes(),this.renderPlay(),this.renderBackward(),this.renderForward()}}Fl.defaultControllerAttr={visible:!0,x:0,y:0,size:20,fill:"#91caff",pickMode:"imprecise",cursor:"pointer"},Fl.defaultAttributes={[Jg.Start]:{},[Jg.Pause]:{},[Jg.Backward]:{},[Jg.Forward]:{}};const eC={visible:!0,style:{x:0,y:0,dx:0,dy:0,size:20},order:0,space:10},GB=[200,10];var Ld;(function(n){n.Default="default",n.Reverse="reverse"})(Ld||(Ld={}));var Vi;(function(n){n.change="change",n.play="play",n.pause="pause",n.backward="backward",n.forward="forward",n.end="end",n.OnChange="change",n.OnPlay="play",n.OnPause="pause",n.OnBackward="backward",n.OnForward="forward",n.OnEnd="end"})(Vi||(Vi={}));const Jzt=({direction:n,maxIndex:t,dataIndex:e})=>n===Ld.Default&&e===t,Qzt=({direction:n,minIndex:t,dataIndex:e})=>n===Ld.Reverse&&e===t,t3t=({direction:n,maxIndex:t,minIndex:e,dataIndex:i})=>Jzt({direction:n,maxIndex:t,dataIndex:i})||Qzt({direction:n,minIndex:e,dataIndex:i}),e3t=({direction:n,minIndex:t,dataIndex:e})=>n===Ld.Default&&e===t,i3t=({direction:n,maxIndex:t,dataIndex:e})=>n===Ld.Reverse&&e===t,n3t=({direction:n,maxIndex:t,minIndex:e,dataIndex:i})=>e3t({direction:n,minIndex:e,dataIndex:i})||i3t({direction:n,maxIndex:t,dataIndex:i}),ya=n=>n==="top"||n==="bottom",r3t=(n,t,e,i)=>n==="default"?Math.min(t+1,i):Math.max(t-1,e);class wb extends En{getMinIndex(){return this._minIndex}getMaxIndex(){return this._maxIndex}getDataIndex(){return this._dataIndex}constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},wb.defaultAttributes,t)),this._data=[],this._dataIndex=0,this._layoutInfo={},this._updateSliderAttrs=()=>{var i,r;let s;et(this._handlerStyle.size)?s=this._handlerStyle.size:this._handlerStyle.size&&this._handlerStyle.size.length&&(s=ti(this._handlerStyle.size[0],this._handlerStyle.size[1]));const o={visible:this._sliderVisible,min:this._minIndex,max:this._maxIndex,value:this._dataIndex,railWidth:this._railStyle.width,railHeight:this._railStyle.height,railStyle:this._railStyle,trackStyle:this._trackStyle,handlerSize:et(s)?s:void 0,handlerStyle:this._handlerStyle,dy:this.attribute.slider.dy,dx:this.attribute.slider.dx,slidable:!0,range:!1,handlerText:{visible:!1},startText:{visible:!1},endText:{visible:!1},disableTriggerEvent:this.attribute.disableTriggerEvent};if(ya(this._orient)){const a=Math.max(0,this._layoutInfo.slider.size),l=(i=this._railStyle.height)!==null&&i!==void 0?i:GB[1];o.layout="horizontal",o.railHeight=l,o.railWidth=a,o.x=this._layoutInfo.slider.x,o.y=this._layoutInfo.slider.y}else{const a=Math.max(0,this._layoutInfo.slider.size),l=(r=this._railStyle.width)!==null&&r!==void 0?r:GB[1];o.layout="vertical",o.railWidth=l,o.railHeight=a,o.x=this._layoutInfo.slider.x,o.y=this._layoutInfo.slider.y}return o},this._initSlider=()=>{const i=this._updateSliderAttrs();this._slider=new Uf(i),this._sliderVisible&&this.add(this._slider)},this._updateControllerAttrs=()=>{const i={start:this._start,pause:this._pause,forward:this._forward,backward:this._backward,disableTriggerEvent:this.attribute.disableTriggerEvent};return i.layout=ya(this._orient)?"horizontal":"vertical",i.start=Object.assign(Object.assign({},i.start),{style:Object.assign(Object.assign({},i.start.style),{x:this._layoutInfo.start.x,y:this._layoutInfo.start.y})}),i.pause=Object.assign(Object.assign({},i.pause),{style:Object.assign(Object.assign({},i.pause.style),{x:this._layoutInfo.start.x,y:this._layoutInfo.start.y})}),i.backward=Object.assign(Object.assign({},i.backward),{style:Object.assign(Object.assign({},i.backward.style),{x:this._layoutInfo.backward.x,y:this._layoutInfo.backward.y})}),i.forward=Object.assign(Object.assign({},i.forward),{style:Object.assign(Object.assign({},i.forward.style),{x:this._layoutInfo.forward.x,y:this._layoutInfo.forward.y})}),i},this._initController=()=>{const i=this._updateControllerAttrs();this._controller=new Fl(i),this._controllerVisible&&this.add(this._controller)},this._initAttributes(),this._initDataIndex(),this._initLayoutInfo(),this._initController(),this._initSlider()}_initAttributes(){this._size=this.attribute.size,this._orient=this.attribute.orient,this._data=this.attribute.data,this._minIndex=0,this._maxIndex=this._data.length-1;const{slider:t={},controller:e={}}=this.attribute;this._sliderVisible=t.visible,this._railStyle=Object.assign({},t.railStyle),this._trackStyle=Object.assign({},t.trackStyle),this._handlerStyle=Object.assign({},t.handlerStyle),this._controllerVisible=e.visible,this._start=Object.assign({},e.start),this._pause=Object.assign({},e.pause),this._forward=Object.assign({},e.forward),this._backward=Object.assign({},e.backward)}_initDataIndex(){var t;this._dataIndex=(t=this.attribute.dataIndex)!==null&&t!==void 0?t:0}_initLayoutInfo(){var t,e,i;const r=[this._start,this._backward,this._forward].sort((c,g)=>c.order-g.order),s=r.filter(c=>c.position!=="end"),o=r.filter(c=>c.position==="end"),a=(t=ya(this._orient)?this._railStyle.height:this._railStyle.width)!==null&&t!==void 0?t:GB[1],l=r.reduce((c,g)=>{const p=g.style.size,f=J(p)?p:ti(p[0],p[1]);return c+g.space+f},0),h=this._sliderVisible?(ya(this._orient)?(e=this._size)===null||e===void 0?void 0:e.width:(i=this._size)===null||i===void 0?void 0:i.height)-l:0,d=h-this.attribute.slider.space,u=s.reduce((c,g)=>{const{key:p,space:f,style:{size:m}}=g,v=J(m)?m:ti(m[0],m[1]);return this._layoutInfo[p]=Object.assign(Object.assign({},this._layoutInfo[p]),{size:v,x:ya(this._orient)?c+f:(this._size.width-v)/2,y:ya(this._orient)?(this._size.height-v)/2:c+f}),c+f+v},0);this._layoutInfo.slider=Object.assign(Object.assign({},this._layoutInfo.slider),{size:d,x:ya(this._orient)?u+this.attribute.slider.space:(this._size.width-a)/2,y:ya(this._orient)?(this._size.height-a)/2:u+this.attribute.slider.space}),o.reduce((c,g)=>{const{key:p,space:f,style:{size:m}}=g,v=J(m)?m:ti(m[0],m[1]);return this._layoutInfo[p]=Object.assign(Object.assign({},this._layoutInfo[p]),{size:v,x:ya(this._orient)?c+f:(this._size.width-v)/2,y:ya(this._orient)?(this._size.height-v)/2:c+f}),c+f+v},u+h)}render(){this._initLayoutInfo(),this.renderSlider(),this.renderController()}renderSlider(){const t=this._updateSliderAttrs();this._slider.setAttributes(t)}renderController(){const t=this._updateControllerAttrs();this._controller.setAttributes(t)}dispatchCustomEvent(t,e){this._dispatchEvent(t,{eventType:t,index:e,value:this._data[e]})}}wb.defaultAttributes={visible:!0,data:[],interval:1e3,orient:"bottom",align:"center",size:{height:20,width:300},slider:{visible:!0,space:10,dx:0,dy:0,railStyle:{cornerRadius:5},trackStyle:{},handlerStyle:{}},controller:{visible:!0,start:Object.assign(Object.assign({},eC),{key:"start",position:"start",space:0}),pause:Object.assign(Object.assign({},eC),{key:"pause",position:"start"}),forward:Object.assign(Object.assign({},eC),{key:"forward",position:"end"}),backward:Object.assign(Object.assign({},eC),{key:"backward",position:"start"})}};function _et(){bT(),Xi(),Bo()}function s3t(){_et()}function o3t(){_et()}s3t();class a3t extends wb{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},t)),this._activeIndex=-1,this._isReachEnd=!1,this._initAttributes=()=>{var i,r,s;super._initAttributes(),this._alternate=(i=this.attribute.alternate)!==null&&i!==void 0&&i,this._interval=(r=this.attribute.interval)!==null&&r!==void 0?r:1e3,this._direction=(s=this.attribute.direction)!==null&&s!==void 0?s:Ld.Default},this._initDataIndex=()=>{var i;this._dataIndex=D(this.attribute.dataIndex)?this._direction==="default"?this._minIndex:this._maxIndex:(i=this.attribute.dataIndex)!==null&&i!==void 0?i:0,this._slider.setAttribute("value",this._dataIndex)},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._controller.addEventListener(ss.OnPlay,i=>{i.stopPropagation(),this.play()}),this._controller.addEventListener(ss.OnPause,i=>{i.stopPropagation(),this.pause()}),this._controller.addEventListener(ss.OnForward,i=>{i.stopPropagation(),this.forward()}),this._controller.addEventListener(ss.OnBackward,i=>{i.stopPropagation(),this.backward()}),this._slider.addEventListener("change",i=>{const r=Math.floor(i.detail.value)+.5;this._dataIndex=i.detail.value>=r?Math.ceil(i.detail.value):Math.floor(i.detail.value),this._slider.setValue(this._dataIndex),this.dispatchCustomEvent(Vi.change)}))},this.play=()=>{this._isPlaying||this._data.length!==1&&(this._controller.togglePause(),this._isPlaying=!0,(t3t({dataIndex:this._dataIndex,maxIndex:this._maxIndex,minIndex:this._minIndex,direction:this._direction})||n3t({dataIndex:this._dataIndex,maxIndex:this._maxIndex,minIndex:this._minIndex,direction:this._direction}))&&(this._direction===Ld.Default?this._updateDataIndex(this._minIndex):this._updateDataIndex(this._maxIndex)),this.dispatchCustomEvent(Vi.play),this._isReachEnd=!1,this._tickTime=Date.now(),this._rafId=le.getRequestAnimationFrame()(this._play.bind(this,!0)))},this._play=i=>{const r=Date.now();if(this._isReachEnd&&r-this._tickTime>=this._interval)return this._isReachEnd=!1,void this._playEnd();i&&this._activeIndex!==this._dataIndex?(this.dispatchCustomEvent(Vi.change),this._activeIndex=this._dataIndex):r-this._tickTime>=this._interval&&(this._tickTime=r,this._updateDataIndex(r3t(this._direction,this._dataIndex,this._minIndex,this._maxIndex)),this._activeIndex=this._dataIndex,this.dispatchCustomEvent(Vi.change)),(this._direction==="default"&&this._dataIndex>=this._maxIndex||this._direction==="reverse"&&this._dataIndex<=this._minIndex)&&(this._isReachEnd=!0),this._rafId=le.getRequestAnimationFrame()(this._play.bind(this,!1))},this._updateDataIndex=i=>{this._dataIndex=i,this._slider.setValue(this._dataIndex)},this._playEnd=()=>{this._isPlaying=!1,this._controller.togglePlay(),le.getCancelAnimationFrame()(this._rafId),this._activeIndex=-1,this.dispatchCustomEvent(Vi.end)},this.pause=()=>{this._isPlaying&&(this._isPlaying=!1,le.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(Vi.pause))},this.backward=()=>{const{loop:i=!1}=this.attribute;let r;r=i?this._dataIndex-1<this._minIndex?this._maxIndex:this._dataIndex-1:Math.max(this._dataIndex-1,this._minIndex),this._updateDataIndex(r),this.dispatchCustomEvent(Vi.change),this.dispatchCustomEvent(Vi.backward)},this.forward=()=>{const{loop:i=!1}=this.attribute;let r;r=i?this._dataIndex+1>this._maxIndex?this._minIndex:this._dataIndex+1:Math.min(this._dataIndex+1,this._maxIndex),this._updateDataIndex(r),this.dispatchCustomEvent(Vi.change),this.dispatchCustomEvent(Vi.forward)},this._initAttributes(),this._initDataIndex(),this._initEvents()}setAttributes(t,e){super.setAttributes(t,e),this._initAttributes()}dispatchCustomEvent(t){super.dispatchCustomEvent(t,this._dataIndex)}}var l3t=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};o3t();class h3t extends wb{constructor(t){super(t),this._isPlaying=!1,this._startTime=Date.now(),this._initAttributes=()=>{var e;super._initAttributes(),this._maxIndex=this._data.length,this._slider.setAttribute("max",this._maxIndex),this._isPlaying=!1,this._elapsed=0,this._interval=(e=this.attribute.interval)!==null&&e!==void 0?e:1e3;const i=this._data.length;this.attribute.totalDuration&&this._data.length?(this._totalDuration=this.attribute.totalDuration,this._interval=this._totalDuration/(i??1)):(this._totalDuration=this._interval*i,this._interval=this.attribute.interval)},this._initDataIndex=()=>{var e;this._dataIndex=(e=this.attribute.dataIndex)!==null&&e!==void 0?e:this._minIndex},this._initEvents=()=>{this.attribute.disableTriggerEvent||(this._controller.addEventListener(ss.OnPlay,e=>{e.stopPropagation(),this.play()}),this._controller.addEventListener(ss.OnPause,e=>{e.stopPropagation(),this.pause()}),this._controller.addEventListener(ss.OnForward,e=>{e.stopPropagation(),this.forward()}),this._controller.addEventListener(ss.OnBackward,e=>{e.stopPropagation(),this.backward()}),this._slider.addEventListener("change",e=>{var i;e.stopPropagation();const r=(i=e.detail)===null||i===void 0?void 0:i.value,s=r/this._maxIndex;this._elapsed=s*this._totalDuration,this._startTime=Date.now()-this._elapsed,this._dispatchChange(r)}))},this._getSliderValue=()=>{const e=this._elapsed/this._totalDuration;return Math.min(e*this._maxIndex,this._maxIndex)},this._updateSlider=()=>{const e=this._getSliderValue();this._dataIndex=Math.floor(e),this._slider.setValue(Math.min(e,this._maxIndex)),this._dispatchChange(Math.floor(e))},this._dispatchChange=e=>{const i=Math.floor(e);i!==this._activeIndex&&(this._dataIndex=i,this._activeIndex=i,i!==this._maxIndex&&this.dispatchCustomEvent(Vi.change))},this.play=()=>l3t(this,void 0,void 0,function*(){this._isPlaying||(this._controller.togglePause(),this._isPlaying=!0,this._elapsed>=this._totalDuration&&(this._elapsed=0),this._startTime=Date.now()-this._elapsed,this.dispatchCustomEvent(Vi.play),this._rafId=le.getRequestAnimationFrame()(this._play.bind(this)))}),this._play=()=>{this._elapsed=Date.now()-this._startTime;const e=this._getSliderValue();this._updateSlider(),e>=this._maxIndex?this._playEnd():this._rafId=le.getRequestAnimationFrame()(this._play.bind(this))},this._playEnd=()=>{this._isPlaying=!1,le.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(Vi.end)},this.pause=()=>{this._isPlaying&&(this._isPlaying=!1,this._elapsed=Date.now()-this._startTime,le.getCancelAnimationFrame()(this._rafId),this._controller.togglePlay(),this.dispatchCustomEvent(Vi.pause))},this.backward=()=>{const e=Date.now(),i=1*this._interval,r=this._elapsed-i;r<=0?(this._elapsed=0,this._startTime=e):(this._elapsed=r,this._startTime=this._startTime+this._interval),this._updateSlider(),this.dispatchCustomEvent(Vi.backward)},this.forward=()=>{const e=Date.now(),i=1*this._interval,r=this._elapsed+i;r>=this._totalDuration?(this._startTime=e-this._totalDuration,this._elapsed=this._totalDuration):(this._startTime=this._startTime-i,this._elapsed=r),this._updateSlider(),this.dispatchCustomEvent(Vi.forward)},this._initAttributes(),this._initDataIndex(),this._initEvents()}dispatchCustomEvent(t){super.dispatchCustomEvent(t,this._dataIndex)}render(){super.render()}}var on;(function(n){n.drawStart="drawStart",n.drawEnd="drawEnd",n.drawing="drawing",n.moving="moving",n.moveStart="moveStart",n.moveEnd="moveEnd",n.brushActive="brushActive",n.brushClear="brushClear"})(on||(on={}));const Al={trigger:"pointerdown",updateTrigger:"pointermove",endTrigger:["pointerup","pointerleave"],resetTrigger:"pointerupoutside",hasMask:!0,brushMode:"single",brushType:"rect",brushStyle:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",strokeWidth:2},brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:10,interactiveRange:{minY:-1/0,maxY:1/0,minX:-1/0,maxX:1/0}},d3t=5;function u3t(){Xi(),iT()}const c3t={debounce:ah,throttle:ha};u3t();let bet=class yet extends En{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},yet.defaultAttributes,t)),this.name="brush",this._activeDrawState=!1,this._cacheDrawPoints=[],this._activeMoveState=!1,this._operatingMaskMoveDx=0,this._operatingMaskMoveDy=0,this._operatingMaskMoveRangeX=[-1/0,1/0],this._operatingMaskMoveRangeY=[-1/0,1/0],this._brushMaskAABBBoundsDict={},this._firstUpdate=!0,this._onBrushStart=i=>{if(this._outOfInteractiveRange(i))return void(this._isEmptyMask()||(this._clearMask(),this._dispatchBrushEvent(on.brushClear,i)));const{updateTrigger:r=Al.updateTrigger,endTrigger:s=Al.endTrigger,brushMoved:o=!0}=this.attribute;Q(r).forEach(a=>this.stage.addEventListener(a,this._onBrushingWithDelay)),Q(s).forEach(a=>this.stage.addEventListener(a,this._onBrushEnd)),i.stopPropagation(),this._firstUpdate=!0,this._activeMoveState=o&&this._isPosInBrushMask(i),this._activeDrawState=!this._activeMoveState,this._startPos=this.eventPosToStagePos(i),this._cacheDrawPoints=[this._startPos]},this._onBrushing=i=>{this._outOfInteractiveRange(i)||(i.stopPropagation(),this._firstUpdate?(this._activeDrawState&&this._initDraw(i),this._activeMoveState&&this._initMove(i),this._firstUpdate=!1):(this._activeDrawState&&this._drawing(i),this._activeMoveState&&this._moving(i)))},this._onBrushingWithDelay=this.attribute.delayTime===0?this._onBrushing:c3t[this.attribute.delayType](this._onBrushing,this.attribute.delayTime),this._onBrushEnd=i=>{this._releaseBrushUpdateEvents(),i.preventDefault(),this._activeDrawState&&this._drawEnd(i),this._activeMoveState&&this._moveEnd(i),this._activeDrawState=!1,this._activeMoveState=!1},this._onBrushClear=i=>{i.preventDefault(),this._isEmptyMask()||(this._clearMask(),this._dispatchBrushEvent(on.brushClear,i)),this._activeDrawState=!1,this._activeMoveState=!1}}_bindBrushEvents(){if(this.releaseBrushEvents(),this.attribute.disableTriggerEvent)return;const{trigger:t=Al.trigger,resetTrigger:e=Al.resetTrigger}=this.attribute;Q(t).forEach(i=>this.stage.addEventListener(i,this._onBrushStart)),Q(e).forEach(i=>this.stage.addEventListener(i,this._onBrushClear))}_initDraw(t){const{brushMode:e}=this.attribute,i=this.eventPosToStagePos(t);this._cacheDrawPoints.push(i),e==="single"&&this._clearMask(),this._addBrushMask(),this._dispatchBrushEvent(on.drawStart,t),Object.keys(this._brushMaskAABBBoundsDict).length===1&&this._dispatchBrushEvent(on.brushActive,t)}_initMove(t){var e,i;this._cacheMovePoint=this.eventPosToStagePos(t),this._operatingMaskMoveDx=(e=this._operatingMask.attribute.dx)!==null&&e!==void 0?e:0,this._operatingMaskMoveDy=(i=this._operatingMask.attribute.dy)!==null&&i!==void 0?i:0;const{interactiveRange:r}=this.attribute,{minY:s=-1/0,maxY:o=1/0,minX:a=-1/0,maxX:l=1/0}=r,{x1:h,x2:d,y1:u,y2:c}=this._operatingMask.globalAABBBounds,g=a-h,p=l-d,f=s-u,m=o-c;this._operatingMaskMoveRangeX=[g,p],this._operatingMaskMoveRangeY=[f,m],this._operatingMask.setAttribute("pickable",!0),this._dispatchBrushEvent(on.moveStart,t)}_drawing(t){var e;const i=this.eventPosToStagePos(t),{brushType:r}=this.attribute,s=this._cacheDrawPoints.length;if(s>0){const a=(e=this._cacheDrawPoints[this._cacheDrawPoints.length-1])!==null&&e!==void 0?e:{};if(i.x===a.x&&i.y===a.y)return}r==="polygon"||s<=1?this._cacheDrawPoints.push(i):this._cacheDrawPoints[s-1]=i;const o=this._computeMaskPoints();this._operatingMask.setAttribute("points",o),this._dispatchBrushEvent(on.drawing,t)}_moving(t){const e=this._cacheMovePoint,i=this.eventPosToStagePos(t);if(i.x===(e==null?void 0:e.x)&&i.y===(e==null?void 0:e.y))return;const r=i.x-e.x,s=i.y-e.y,o=Math.min(this._operatingMaskMoveRangeX[1],Math.max(this._operatingMaskMoveRangeX[0],r))+this._operatingMaskMoveDx,a=Math.min(this._operatingMaskMoveRangeY[1],Math.max(this._operatingMaskMoveRangeY[0],s))+this._operatingMaskMoveDy;this._operatingMask.setAttributes({dx:o,dy:a}),this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchBrushEvent(on.moving,t)}_drawEnd(t){const{removeOnClick:e=!0,sizeThreshold:i=d3t}=this.attribute;if(this._outOfInteractiveRange(t))this._isEmptyMask()||(this._clearMask(),this._dispatchBrushEvent(on.brushClear,t));else{const{x:r,y:s}=this._startPos,{x:o,y:a}=this.eventPosToStagePos(t);Math.abs(o-r)<=1&&Math.abs(a-s)<=1&&e?this._isEmptyMask()||(this._clearMask(),this._dispatchBrushEvent(on.brushClear,t)):Math.abs(o-r)<i&&Math.abs(s-a)<i?(delete this._brushMaskAABBBoundsDict[this._operatingMask.name],this._container.setAttributes({}),this._container.removeChild(this._operatingMask),this._isEmptyMask()&&this._dispatchBrushEvent(on.brushClear,t)):(this._brushMaskAABBBoundsDict[this._operatingMask.name]=this._operatingMask.AABBBounds,this._dispatchBrushEvent(on.drawEnd,t))}}_moveEnd(t){this._operatingMask&&this._operatingMask.setAttribute("pickable",!1),this._dispatchBrushEvent(on.moveEnd,t)}render(){this._bindBrushEvents();const t=this.createOrUpdateChild("brush-container",{},"group");this._container=t}releaseBrushEvents(){const{trigger:t=Al.trigger,resetTrigger:e=Al.resetTrigger}=this.attribute;Q(t).forEach(i=>this.stage.removeEventListener(i,this._onBrushStart)),Q(e).forEach(i=>this.stage.removeEventListener(i,this._onBrushClear)),this._releaseBrushUpdateEvents()}_releaseBrushUpdateEvents(){const{updateTrigger:t=Al.updateTrigger,endTrigger:e=Al.endTrigger}=this.attribute;Q(t).forEach(i=>this.stage.removeEventListener(i,this._onBrushingWithDelay)),Q(e).forEach(i=>this.stage.removeEventListener(i,this._onBrushEnd))}_computeMaskPoints(){const{brushType:t,xRange:e=[0,0],yRange:i=[0,0]}=this.attribute;let r=[];const s=this._cacheDrawPoints[0],o=this._cacheDrawPoints[this._cacheDrawPoints.length-1];return r=t==="rect"?[s,{x:o.x,y:s.y},o,{x:s.x,y:o.y}]:t==="x"?[{x:s.x,y:i[0]},{x:o.x,y:i[0]},{x:o.x,y:i[1]},{x:s.x,y:i[1]}]:t==="y"?[{x:e[0],y:s.y},{x:e[0],y:o.y},{x:e[1],y:o.y},{x:e[1],y:s.y}]:Pn(this._cacheDrawPoints),r}_addBrushMask(){var t;const{brushStyle:e,hasMask:i}=this.attribute,r=Pt.polygon(Object.assign(Object.assign({points:Pn(this._cacheDrawPoints),cursor:"move",pickable:!1},e),{opacity:i?(t=e.opacity)!==null&&t!==void 0?t:1:0}));r.name=`brush-${Date.now()}`,this._operatingMask=r,this._container.add(r),this._brushMaskAABBBoundsDict[r.name]=r.AABBBounds}_isPosInBrushMask(t){const e=this.eventPosToStagePos(t),i=this._container.getChildren();for(let r=0;r<i.length;r++){const{points:s=[],dx:o=0,dy:a=0}=i[r].attribute,l=s.map(h=>({x:h.x+o,y:h.y+a}));if(wO(l,e.x,e.y))return this._operatingMask=i[r],!0}return!1}_outOfInteractiveRange(t){const{interactiveRange:e}=this.attribute,{minY:i=-1/0,maxY:r=1/0,minX:s=-1/0,maxX:o=1/0}=e,a=this.eventPosToStagePos(t);return a.x>o||a.x<s||a.y>r||a.y<i}eventPosToStagePos(t){return this.stage.eventPointTransform(t)}_dispatchBrushEvent(t,e){this._dispatchEvent(t,{operateMask:this._operatingMask,operatedMaskAABBBounds:this._brushMaskAABBBoundsDict,event:e})}_clearMask(){this._brushMaskAABBBoundsDict={},this._container.incrementalClearChild(),this._operatingMask=null}_isEmptyMask(){return xt(this._brushMaskAABBBoundsDict)||Object.keys(this._brushMaskAABBBoundsDict).every(t=>this._brushMaskAABBBoundsDict[t].empty())}};bet.defaultAttributes=Al;const CU=(n,...t)=>{const e=[n.shape,...t.map(s=>s==null?void 0:s.shape)],i=[n.key,...t.map(s=>s==null?void 0:s.key)],r=[n.value,...t.map(s=>s==null?void 0:s.value)];return Z(n,...t,{shape:e.every(D)?void 0:Z({},...e),key:i.every(D)?void 0:Z({},...i),value:r.every(D)?void 0:Z({},...r)})},vg=n=>{const{width:t,height:e,wordBreak:i="break-word",textAlign:r,textBaseline:s,text:o}=n;return Array.isArray(o)?{width:t,height:e,wordBreak:i,textAlign:r,textBaseline:s,singleLine:!1,textConfig:Q(o).map(a=>Object.assign(Object.assign({},n),{text:a}))}:{width:t,height:e,wordBreak:i,textAlign:r,textBaseline:s,singleLine:!1,textConfig:o==null?void 0:o.text}},g3t={panel:{visible:!0,cornerRadius:[3,3,3,3],fill:"white",shadow:!0,shadowBlur:12,shadowColor:"rgba(0, 0, 0, 0.1)",shadowOffsetX:0,shadowOffsetY:4,shadowSpread:0,stroke:"white"},titleStyle:{value:{fill:"#4E5969",fontFamily:Pv,fontSize:14,lineHeight:18,textAlign:"left",textBaseline:"middle"},spaceRow:6},contentStyle:{shape:{fill:"black",size:8,symbolType:"circle",spacing:6},key:{fill:"#4E5969",fontFamily:Pv,fontSize:12,lineHeight:18,textAlign:"left",textBaseline:"middle",spacing:26},value:{fill:"#4E5969",fontFamily:Pv,fontSize:12,lineHeight:18,textAlign:"right",textBaseline:"middle",spacing:0},spaceRow:6},padding:10,positionX:"right",positionY:"bottom",offsetX:10,offsetY:10,parentBounds:new ie().setValue(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),autoCalculatePosition:!0,autoMeasure:!0,pickable:!1,childrenPickable:!1,zIndex:500},p3t=["pointerX","pointerY","offsetX","offsetY","positionX","positionY","parentBounds"];function f3t(){Xi(),fh(),Bo(),al(),Xd()}f3t();let Cet=class Cs extends En{constructor(t,e){super(e!=null&&e.skipDefault?t:Z({},Cs.defaultAttributes,t),e),this.name="tooltip"}render(){var t;const{visible:e,content:i,panel:r,keyWidth:s,valueWidth:o,hasContentShape:a,autoCalculatePosition:l,autoMeasure:h,align:d}=this.attribute;if(!e)return void this.hideAll();h&&Cs.measureTooltip(this.attribute),l&&Cs.calculateTooltipPosition(this.attribute);const u=Fi(this.attribute.padding);this._tooltipPanel=this.createOrUpdateChild("tooltip-background",Object.assign({visible:!0},r),"rect"),this._tooltipTitleContainer=this.createOrUpdateChild("tooltip-title",{visible:!0,x:u[3],y:u[0]},"group");const c=Cs.getTitleAttr(this.attribute);this._tooltipTitleSymbol=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-shape",Z({symbolType:"circle"},c.shape,{visible:Ni(c)&&Ni(c.shape)}),"symbol"),typeof c.value.text!="object"||c.value.text===null||c.value.text.type!=="rich"&&c.value.text.type!=="html"?c.value.multiLine?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({visible:Ni(c)&&Ni(c.value)},vg(c.value)),"richtext"):this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({text:(t=c.value.text)!==null&&t!==void 0?t:"",visible:Ni(c)&&Ni(c.value)},c.value),"text"):c.value.text.type==="rich"?this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({visible:Ni(c)&&Ni(c.value)},vg(c.value)),"richtext"):c.value.text.type==="html"&&(this._tooltipTitle=this._tooltipTitleContainer.createOrUpdateChild("tooltip-title-value",Object.assign({html:Object.assign(Object.assign({dom:c.value.text.text},Ow),c.value),visible:Ni(c)&&Ni(c.value),width:c.value.width,height:c.value.height,wordBreak:c.value.wordBreak,textAlign:c.value.textAlign,textBaseline:c.value.textBaseline,singleLine:!1,textConfig:[]},c.value),"richtext"));const g=Ni(c.shape)?c.shape.size+c.shape.spacing:0,{textAlign:p,textBaseline:f}=c.value,m=r.width-u[3]-u[0]-g;p==="center"?this._tooltipTitle.setAttribute("x",g+m/2):p==="right"||p==="end"?this._tooltipTitle.setAttribute("x",g+m):this._tooltipTitle.setAttribute("x",g),f==="bottom"?this._tooltipTitle.setAttribute("y",c.height):f==="middle"?this._tooltipTitle.setAttribute("y",c.height/2):this._tooltipTitle.setAttribute("y",0);const v=Ni(c)?c.height+c.spaceRow:0;if(this._tooltipContent=this.createOrUpdateChild("tooltip-content",{visible:!0},"group"),this._tooltipContent.removeAllChild(!0),i&&i.length){this._tooltipContent.setAttribute("x",u[3]),this._tooltipContent.setAttribute("y",u[0]+v);let _=0;i.forEach((b,y)=>{const C=Cs.getContentAttr(this.attribute,y);if(!Ni(C))return;const S=`tooltip-content-${y}`,w=this._tooltipContent.createOrUpdateChild(S,{visible:!0,x:0,y:_},"group"),x=C.shape.size+C.shape.spacing;let A=d==="right"?(a?x:0)+(Ni(C.key)?s+C.key.spacing:0)+(Ni(C.value)?o:0):0;this._createShape(d==="right"?A-C.shape.size/2:A+C.shape.size/2,C,w,S),a&&(d==="right"?A-=x:A+=x);const M=this._createKey(C,w,S);M&&(R6(d,M,C.key.textAlign,A,s),M.setAttribute("y",0),d==="right"?A-=s+C.key.spacing:A+=s+C.key.spacing);const T=this._createValue(C,w,S);if(T){let R="right";L(C.value.textAlign)?R=C.value.textAlign:Ni(C.key)||d==="right"||(R="left"),T.setAttribute("textAlign",R),R6(d,T,R,A,o),T.setAttribute("y",0)}_+=C.height+C.spaceRow})}}_createShape(t,e,i,r){var s;if(Ni(e.shape))return i.createOrUpdateChild(`${r}-shape`,Object.assign({visible:!0,x:t,y:e.shape.size/2+(((s=zM(e.key.lineHeight,e.key.fontSize))!==null&&s!==void 0?s:e.key.fontSize)-e.shape.size)/2},e.shape),"symbol")}_createKey(t,e,i){var r;if(Ni(t.key)){let s;return s=t.key.multiLine?e.createOrUpdateChild(`${i}-key`,Object.assign(Object.assign({visible:!0},vg(t.key)),{textBaseline:"top"}),"richtext"):typeof t.key.text!="object"||t.key.text===null||t.key.text.type!=="rich"&&t.key.text.type!=="html"?e.createOrUpdateChild(`${i}-key`,Object.assign(Object.assign({visible:!0,text:(r=t.key.text)!==null&&r!==void 0?r:""},t.key),{textBaseline:"top"}),"text"):t.key.text.type==="rich"?e.createOrUpdateChild(`${i}-value`,Object.assign(Object.assign({visible:!0},vg(t.key)),{textBaseline:"top"}),"richtext"):e.createOrUpdateChild(`${i}-value`,{html:Object.assign(Object.assign({dom:t.key.text.text},Ow),t.key)},"richtext"),s}}_createValue(t,e,i){var r;if(Ni(t.value)){let s;return s=t.value.multiLine?e.createOrUpdateChild(`${i}-value`,Object.assign(Object.assign({visible:!0},vg(t.value)),{textBaseline:"top"}),"richtext"):typeof t.value.text!="object"||t.value.text===null||t.value.text.type!=="rich"&&t.value.text.type!=="html"?e.createOrUpdateChild(`${i}-value`,Object.assign(Object.assign({visible:!0,text:(r=t.value.text)!==null&&r!==void 0?r:""},t.value),{textBaseline:"top"}),"text"):t.value.text.type==="rich"?e.createOrUpdateChild(`${i}-value`,Object.assign(Object.assign({visible:!0},vg(t.value)),{textBaseline:"top"}),"richtext"):e.createOrUpdateChild(`${i}-value`,{html:Object.assign({dom:t.value.text.text,container:"",width:30,height:30,style:{}},t.value)},"richtext"),s}}setAttributes(t,e){const i=Object.keys(t);this.attribute.autoCalculatePosition&&i.every(r=>p3t.includes(r))?(this._mergeAttributes(t,i),D(this.attribute.panel.width)&&this.attribute.autoMeasure&&Cs.measureTooltip(this.attribute),Cs.calculateTooltipPosition(this.attribute),super.setAttributes({x:this.attribute.x,y:this.attribute.y},e)):super.setAttributes(t,e)}static calculateTooltipPosition(t){const{width:e=0,height:i=0}=t.panel,{offsetX:r,offsetY:s,pointerX:o,pointerY:a,positionX:l,positionY:h,parentBounds:d}=t;let u=o,c=a;return l==="left"?u-=e+r:l==="center"?u-=e/2:u+=r,h==="top"?c-=i+s:h==="middle"?c-=i/2:c+=s,u+e>d.x2&&(u-=e+r),c+i>d.y2&&(c-=i+s),u<d.x1&&(u=d.x1),c<d.y1&&(c=d.y1),t.x=u,t.y=c,t}static measureTooltip(t){const{content:e,contentStyle:i}=t,r=Fi(t.padding),s=Cs.getTitleAttr(t);let o=0,a=r[0]+r[2],l=0;const{value:h,shape:d}=s,{visible:u=!1,symbolType:c=""}=d??{};if(L(h)&&typeof s.value.text!="object"){const{width:g,height:p}=Wp(h).quickMeasure(h.text);o=g,l=p}if(u&&T1[c]&&(o+=d.size+d.spacing,l=Math.max(d.size,l)),t.title&&(t.title.width=o,t.title.height=l),Ni(s)&&(a+=l+s.spaceRow),e&&e.length){const g=[];if(e.forEach((p,f)=>{const m=Cs.getContentAttr(t,f);(p.key||p.value)&&Ni(m)&&g.push([p,m])}),g.length){let p=!1;const f=[],m=[],v=[];g.forEach(([C,S],w)=>{var x;const{key:A,value:M,shape:T,spaceRow:R}=S,B=Ni(T),E=(x=T==null?void 0:T.symbolType)!==null&&x!==void 0?x:"",k=Wp(A),P=Wp(M);let I=0;if(Ni(A)){const{width:O,height:H}=k.quickMeasure(A.text);m.push(O),I=Math.max(I,H)}if(Ni(M)){const{width:O,height:H}=P.quickMeasure(M.text);v.push(O),I=Math.max(I,H)}B&&T1[E]&&(p=!0,f.push(T.size),I=Math.max(T.size,I)),C.height=I,a+=I,w<g.length-1&&(a+=R??i.spaceRow)});const _=f.length?Math.max(...f):0,b=m.length?Math.max(...m):0,y=v.length?Math.max(...v):0;o=Math.max(b+y+i.key.spacing+i.value.spacing+(p?_+i.shape.spacing:0),o),e.forEach(C=>{C.width=o}),t.hasContentShape=p,t.keyWidth=b,t.valueWidth=y}}return t.panel.width=o+r[1]+r[3],t.panel.height=a,t}static getTitleAttr(t){return CU({},Cs.defaultAttributes.titleStyle,Cs.defaultAttributes.title,t.titleStyle,t.title)}static getContentAttr(t,e){return CU({},Cs.defaultAttributes.contentStyle,t.contentStyle,t.content[e])}};Cet.defaultAttributes=g3t;const $w=di;function m3t(n,t){let e=0,i=2*Math.PI;const r=L(n),s=L(t);for(r||s?s?r?(e=n,i=t):(e=t-2*Math.PI,i=t):(e=n,i=n+2*Math.PI):(e=0,i=2*Math.PI);i<=e;)i+=2*Math.PI;for(;e>2*Math.PI;)e-=2*Math.PI,i-=2*Math.PI;for(;i<0;)e+=2*Math.PI,i+=2*Math.PI;return{startAngle:e,endAngle:i}}function v3t(n,t,e){return n.x1>t||n.x2<t||n.y1>e||n.y2<e}function xet(n,t){const e=[];return n.forEach(i=>{const r=+i[t];et(r)&&e.push(r)}),e.length===0?null:Ri(e)}function TF(n,t){const e=[];return n.forEach(i=>{const r=+i[t];et(r)&&e.push(r)}),e.length===0?null:Mi(e)}function wet(n,t){return n.reduce((e,i)=>{const r=t?+i[t]:+i;return et(r)&&(e+=r),e},0)}function Aet(n,t){let e=0,i=0;return n.forEach(r=>{const s=t?+r[t]:+r;et(s)&&(e+=s,i++)}),e/i}function Met(n,t){const e=Aet(n,t);return n.length<=1?0:n.reduce((r,s)=>r+(t?+s[t]:+s-e)**2,0)/(n.length-1)}function _3t(n,t){return Math.sqrt(Met(n,t))}function b3t(n,t){return hlt(n.map(e=>e[t]))}function y3t(n,t,e){const{predict:i}=mIt(n,l=>l[t],l=>l[e]),r=xet(n,t),s=TF(n,t),o=i(r),a=i(s);return[{[t]:r,[e]:o},{[t]:s,[e]:a}]}function C3t(n){let t="center",e="middle";return t=(n=Ka(n))>=Math.PI*(7/6)&&n<=Math.PI*(11/6)?"right":n>=Math.PI*(1/6)&&n<=Math.PI*(5/6)?"left":"center",e=n>=Math.PI*(5/3)||n<=Math.PI*(1/3)?"bottom":n>=Math.PI*(2/3)&&n<=Math.PI*(4/3)?"top":"middle",{align:t,baseline:e}}function SU(n,t){const e=Vw(n),i=Vw(t),r=Math.asin((n.x*t.y-t.x*n.y)/e/i),s=Math.acos((n.x*t.x+n.y*t.y)/e/i);return r<0?-s:s}function Vw(n,t={x:0,y:0}){return hi.distancePP(n,t)}function S3t(n,t=2){const e=n.reduce((h,d)=>h+(isNaN(d)?0:d),0);if(e===0)return 0;const i=Math.pow(10,t),r=n.map(h=>(isNaN(h)?0:h)/e*i*100),s=100*i,o=r.map(h=>Math.floor(h));let a=o.reduce((h,d)=>h+d,0);const l=r.map((h,d)=>h-o[d]);for(;a<s;){let h=Number.NEGATIVE_INFINITY,d=null;for(let u=0;u<l.length;u++)l[u]>h&&(h=l[u],d=u);++o[d],l[d]=0,++a}return o.map(h=>h/i)}function xU(n){return et(n.x)&&et(n.y)}function Oi(n,t,e){let i=!1;if(t&&it(t)){for(const r of n)for(const s of r.getSeries(e))if(i=!!t.call(null,s),i)return i}return i}function Tet(n,t){const e=[];for(const i of n)for(const r of i.getSeries(t))e.push(r);return e}const kF=(n,t)=>{for(let e=0;e<n.length;e++){const i=n[e].getSeries();for(let r=0;r<i.length;r++){const s=i[r];if(t&&s&&s.coordinate===t||!t&&s)return s}}return null};function DC(n){return function(t){let e;return e=V(n)?n.reduce((i,r)=>i==null?void 0:i[r],t):t==null?void 0:t[n],e}}var gt;(function(n){n.area="area",n.line="line",n.bar="bar",n.bar3d="bar3d",n.rangeColumn="rangeColumn",n.rangeColumn3d="rangeColumn3d",n.rangeArea="rangeArea",n.dot="dot",n.geo="geo",n.link="link",n.map="map",n.pie="pie",n.pie3d="pie3d",n.radar="radar",n.rose="rose",n.scatter="scatter",n.circularProgress="circularProgress",n.wordCloud="wordCloud",n.wordCloud3d="wordCloud3d",n.funnel="funnel",n.funnel3d="funnel3d",n.linearProgress="linearProgress",n.boxPlot="boxPlot",n.sankey="sankey",n.gaugePointer="gaugePointer",n.gauge="gauge",n.treemap="treemap",n.sunburst="sunburst",n.circlePacking="circlePacking",n.waterfall="waterfall",n.heatmap="heatmap",n.correlation="correlation",n.liquid="liquid",n.venn="venn",n.mosaic="mosaic",n.pictogram="pictogram"})(gt||(gt={}));var wU;(function(n){n.label="label",n.point="point",n.line="line",n.area="area",n.bar="bar",n.bar3d="bar3d",n.boxPlot="boxPlot",n.outlier="outlier",n.circlePacking="circlePacking",n.group="group",n.gridBackground="gridBackground",n.grid="grid",n.dot="dot",n.title="title",n.subTitle="subTitle",n.symbol="symbol",n.funnel="funnel",n.funnel3d="funnel3d",n.transform="transform",n.transform3d="transform3d",n.transformLabel="transformLabel",n.outerLabel="outerLabel",n.outerLabelLine="outerLabelLine",n.pin="pin",n.pinBackground="pinBackground",n.pointer="pointer",n.segment="segment",n.track="track",n.cell="cell",n.cellBackground="cellBackground",n.link="link",n.arrow="arrow",n.pie="pie",n.pie3d="pie3d",n.labelLine="labelLine",n.progress="progress",n.minLabel="minLabel",n.maxLabel="maxLabel",n.rose="rose",n.node="node",n.sunburst="sunburst",n.nonLeaf="nonLeaf",n.leaf="leaf",n.nonLeafLabel="nonLeafLabel",n.leaderLine="leaderLine",n.stackLabel="stackLabel",n.word="word",n.fillingWord="fillingWord",n.wordMask="wordMask",n.nodePoint="nodePoint",n.ripplePoint="ripplePoint",n.centerPoint="centerPoint",n.centerLabel="centerLabel",n.barBackground="barBackground",n.lineLabel="lineLabel",n.areaLabel="areaLabel",n.liquidGroup="liquidGroup",n.liquid="liquid",n.liquidBackground="liquidBackground",n.liquidOutline="liquidOutline",n.circle="circle",n.overlap="overlap",n.overlapLabel="overlapLabel",n.pictogram="pictogram"})(wU||(wU={}));function ket(n){var t,e;const{type:i}=n;return i===gt.sankey?(t=n.direction)!==null&&t!==void 0?t:"horizontal":(e=n.direction)!==null&&e!==void 0?e:"vertical"}const x3t={primaryFontColor:"titleFontColor",tertiaryFontColor:"labelFontColor",axisLabelFontColor:"axisFontColor",axisMarkerFontColor:"labelReverseFontColor",dataZoomHandleStrokeColor:"dataZoomHandlerStrokeColor",sliderHandleColor:"dataZoomHandlerFillColor",sliderRailColor:"dataZoomBackgroundColor",sliderTrackColor:"dataZoomSelectedColor",playerControllerColor:"dataZoomSelectedColor",popupBackgroundColor:"tooltipBackgroundColor",hoverBackgroundColor:"axisGridColor"},w3t={titleFontColor:"primaryFontColor",labelFontColor:"tertiaryFontColor",axisFontColor:"axisLabelFontColor",labelReverseFontColor:"axisMarkerFontColor",dataZoomHandlerStrokeColor:"dataZoomHandleStrokeColor",dataZoomHandlerFillColor:"sliderHandleColor",dataZoomBackgroundColor:"sliderRailColor",dataZoomSelectedColor:"sliderTrackColor",tooltipBackgroundColor:"popupBackgroundColor"};function A3t(n,t){const e=x3t[t];if(e&&n[e])return n[e];if(n[t])return n[t];const i=w3t[t];return i?n[i]:void 0}function _0(n,t){var e;if(!n)return[];const i=Ret(n,t);if(!i||V(i))return(e=i)!==null&&e!==void 0?e:[];if(kt(i)){const{dataScheme:r}=i;return r?RF(r)?r.map(s=>Object.assign(Object.assign({},s),{scheme:s.scheme.map(o=>Gw(o)?CI(n,o,t):o).filter(L)})):r.map(s=>Gw(s)?CI(n,s,t):s).filter(L):[]}return[]}function yI(n,t){var e,i;return RF(n)?(i=(e=n.find(r=>L(r.isAvailable)?it(r.isAvailable)?r.isAvailable(t):!!r.isAvailable:!L(r.maxDomainLength)||(t==null?void 0:t.length)<=r.maxDomainLength))===null||e===void 0?void 0:e.scheme)!==null&&i!==void 0?i:n[n.length-1].scheme:n}function CI(n,t,e){var i;const r=Ret(n,e);if(!r)return;let s;const{palette:o}=r;if(kt(o)&&(s=(i=A3t(o,t.key))!==null&&i!==void 0?i:t.default),!s)return;if(D(t.a)&&D(t.l)||!yt(s))return s;let a=new Tn(s);if(L(t.l)){const{r:l,g:h,b:d}=a.color,{h:u,s:c}=ZA(l,h,d),g=iS(u,c,t.l),p=new Tn(`rgb(${g.r}, ${g.g}, ${g.b})`);p.setOpacity(a.color.opacity),a=p}return L(t.a)&&a.setOpacity(t.a),a.toRGBA()}const M3t=(n,t,e)=>{if(t&&Gw(n)){const i=CI(t,n,e);if(i)return i}return n};function Gw(n){return n&&n.type==="palette"&&!!n.key}function RF(n){return!(!V(n)||n.length===0)&&n.every(t=>L(t.scheme))}function T3t(n){return V(n)?{dataScheme:n}:n}function Ret(n,t){var e,i;const{type:r}=t??{};let s;if(!t||D(r))s=n==null?void 0:n.default;else{const o=ket(t);s=(i=(e=n==null?void 0:n[`${r}_${o}`])!==null&&e!==void 0?e:n==null?void 0:n[r])!==null&&i!==void 0?i:n==null?void 0:n.default}return s}class Ab extends Mc{range(t){return t?(this._range=t,this._resetRange(),this):super.range()}domain(t){return t?(super.domain(t),this._resetRange(),this):super.domain()}_resetRange(){if(!RF(this._range))return void super.range(this._range);const t=yI(this._range,this._domain);super.range(t)}}const k3t={linear:Vs,band:qc,point:AHt,ordinal:Mc,threshold:CF,colorOrdinal:Ab};function SI(n){const t=k3t[n];return t?new t:null}function R3t(n,t){if("scale"in n&&n.scale)return yt(n.scale)&&(t!=null&&t.globalScale)?t.globalScale.registerMarkAttributeScale(n,t.seriesId):n.scale;const e=SI(n.type);return e&&B3t(e,n),e}function B3t(n,t){n&&t&&(t.domain&&n.domain(t.domain),t.range&&n.range(t.range),t.specified&&n.specified&&n.specified(t.specified),t.clamp&&n.clamp&&n.clamp(t.clamp))}function je(n,t,e){if(!t)return n;const i=t.range(),r=e&&t._calculateWholeRange?t._calculateWholeRange(i):t.range(),s=Math.min(r[0],r[r.length-1]),o=Math.max(r[0],r[r.length-1]);return Math.min(Math.max(s,n),o)}function P3t(n,t,e){if(!t)return!0;t.range();const i=t.range().map(o=>t.invert(o)),r=Math.min(i[0],i[i.length-1]),s=Math.max(i[0],i[i.length-1]);return Array.isArray(n)?n.every(o=>o>=r&&o<=s):n>=r&&n<=s}function AU(n){return L(n==null?void 0:n.field)&&L(n==null?void 0:n.scale)}function BF(n){switch(n){case"left":case"right":case"top":case"bottom":return!0;default:return!1}}function Ws(n){return!!yt(n)&&!!n.endsWith("%")&&mf(n.substring(0,n.length-1))}function E3t(n){return!!kt(n)&&("percent"in n||"offset"in n)}function Gi(n,t,e,i=0){var r,s;return J(n)?n:Ws(n)?Number(n.substring(0,n.length-1))*t/100:it(n)?n(e):kt(n)?t*((r=n.percent)!==null&&r!==void 0?r:0)+((s=n.offset)!==null&&s!==void 0?s:0):i}function Bet(n,t,e){var i,r,s,o;const a={top:0,bottom:0,left:0,right:0};return Object.values(n).every(l=>J(l))?(a.top=(i=n.top)!==null&&i!==void 0?i:0,a.right=(r=n.right)!==null&&r!==void 0?r:0,a.bottom=(s=n.bottom)!==null&&s!==void 0?s:0,a.left=(o=n.left)!==null&&o!==void 0?o:0,a):([{orients:["left","right"],size:t.width},{orients:["top","bottom"],size:t.height}].forEach(l=>{l.orients.forEach(h=>{a[h]=Gi(n[h],l.size,e)})}),a)}function L3t(n,t){return n?{width:Math.ceil(Math.min(n.x2-n.x1,t.width)),height:Math.ceil(Math.min(n.y2-n.y1,t.height))}:{width:0,height:0}}function Id(n){let t={};return V(n)?(D(n[0])||(t.top=t.left=t.bottom=t.right=n[0]),D(n[1])||(t.left=t.right=n[1]),D(n[2])||(t.bottom=n[2]),D(n[3])||(t.left=n[3]),t):J(n)||Ws(n)||it(n)||E3t(n)?(t.top=t.left=t.bottom=t.right=n,t):(kt(n)&&(t=Object.assign({},n)),t)}function MU(n,t,e){return e?{x:n.x+t.x,y:n.y+t.y}:n}const Qg=(n,t)=>{const e=Number(n),i=n.toString();return isNaN(e)&&i[i.length-1]==="%"?t*(Number(i.slice(0,i.length-1))/100):e},Pet=[{maxDomainLength:10,scheme:["#1664FF","#1AC6FF","#FF8A00","#3CC780","#7442D4","#FFC400","#304D77","#B48DEB","#009488","#FF7DDA"]},{scheme:["#1664FF","#B2CFFF","#1AC6FF","#94EFFF","#FF8A00","#FFCE7A","#3CC780","#B9EDCD","#7442D4","#DDC5FA","#FFC400","#FAE878","#304D77","#8B959E","#B48DEB","#EFE3FF","#009488","#59BAA8","#FF7DDA","#FFCFEE"]}],I3t={default:{dataScheme:Pet,palette:{backgroundColor:"#ffffff",borderColor:"#e3e5e8",shadowColor:"rgba(33,37,44,0.1)",hoverBackgroundColor:"#f1f2f5",sliderRailColor:"#f1f3f4",sliderHandleColor:"#ffffff",sliderTrackColor:"#0040ff",popupBackgroundColor:"#ffffff",primaryFontColor:"#21252c",secondaryFontColor:"#606773",tertiaryFontColor:"#89909d",axisLabelFontColor:"#89909d",disableFontColor:"#bcc1cb",axisMarkerFontColor:"#ffffff",axisGridColor:"#f1f2f5",axisDomainColor:"#d9dde4",dataZoomHandleStrokeColor:"#aeb5be",dataZoomChartColor:"#c9ced8",playerControllerColor:"#0040ff",scrollBarSliderColor:"rgba(0,0,0,0.3)",axisMarkerBackgroundColor:"#21252c",markLabelBackgroundColor:"#f1f2f5",markLineStrokeColor:"#606773",dangerColor:"#e33232",warningColor:"#ffc528",successColor:"#07a35a",infoColor:"#3073f2",discreteLegendPagerTextColor:"rgb(51, 51, 51)",discreteLegendPagerHandlerColor:"rgb(47, 69, 84)",discreteLegendPagerHandlerDisableColor:"rgb(170, 170, 170)",emptyCircleColor:"#e3e5e8",linearProgressTrackColor:"#E7EBED"}}},O3t={label:{visible:!1,offset:5,position:"top",style:{stroke:{type:"palette",key:"backgroundColor"},lineWidth:2}},point:{style:{symbolType:"circle"}},seriesMark:"area"},D3t={label:{visible:!1,position:"outside",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}},F3t={bar3d:{style:{length:3}},label:{visible:!1,style:{offset:12,position:"outside"}}},H3t={outerRadius:.8,innerRadius:.6,progress:{style:{fillOpacity:1}},track:{style:{fillOpacity:.2}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},z3t={dot:{style:{size:10,fillOpacity:1}},symbol:{style:{size:10}},title:{style:{textAlign:"left",textBaseline:"middle",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},subTitle:{style:{textAlign:"left",textBaseline:"top",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},Eet=n=>{const t={label:{style:{fill:"white",textBaseline:"middle",lineWidth:2}},outerLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"}},line:{style:{stroke:{type:"palette",key:"axisDomainColor"}}}},transformLabel:{style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle"}}};return t[n?"transform3d":"transform"]={style:{fill:{type:"palette",key:"axisGridColor"}}},t},W3t=Eet(),j3t=Eet(!0),N3t={outerRadius:.8,innerRadius:.6,padAngle:1.146,segment:{style:{fillOpacity:1}},tickMask:{visible:!1,angle:3,offsetAngle:0,forceAlign:!0}},$3t="M-0.020059 -0.978425 C-0.018029 -0.9888053 -0.013378 -1 0 -1 C0.01342 -1 0.01812 -0.989146 0.0201 -0.978425 C0.02161 -0.9702819 0.0692 -0.459505 0.09486 -0.184807 C0.10298 -0.097849 0.1089 -0.034548 0.11047 -0.018339 C0.11698 0.04908 0.07373 0.11111 0.00002 0.11111 C-0.07369 0.11111 -0.117184 0.04991 -0.110423 -0.018339 C-0.103662 -0.086591 -0.022089 -0.9680447 -0.020059 -0.978425Z",TU="M1 0 C1 0.55228 0.55228 1 0 1 C-0.552285 1 -1 0.55228 -1 0 C-1 -0.552285 -0.552285 -1 0 -1 C0.55228 -1 1 -0.552285 1 0Z",V3t={pointer:{type:"path",width:.4,height:.4,style:{path:$3t}},pin:{width:.025,height:.025,style:{path:TU,fill:"#888"}},pinBackground:{width:.06,height:.06,style:{path:TU,fill:"#ddd"}}},G3t={label:{visible:!1,position:"top",offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}},U3t={bandWidth:30,progress:{style:{fillOpacity:1}},track:{style:{fill:{type:"palette",key:"linearProgressTrackColor"},fillOpacity:1}}},Y3t={arrow:{style:{size:10}}},X3t={defaultFillColor:"#f3f3f3",area:{style:{lineWidth:.5,strokeOpacity:1,stroke:"black",fillOpacity:1}},label:{interactive:!1,style:{fontSize:{type:"token",key:"l6FontSize"},lineHeight:{type:"token",key:"l6LineHeight"},textBaseline:"middle",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},stroke:{type:"palette",key:"backgroundColor"}}}},K3t={outerRadius:.6,pie:{style:{fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside",style:{fontWeight:"normal",stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1}},innerLabel:{style:{lineWidth:2}},emptyCircle:{style:{fill:{type:"palette",key:"emptyCircleColor"},fillOpacity:1}}},q3t={outerRadius:.6,pie3d:{style:{height:10,fillOpacity:1}},label:{visible:!1,interactive:!0,position:"outside"}},Z3t={label:{visible:!1,offset:5,style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},point:{style:{symbolType:"circle"}}},J3t={point:{style:{size:8,symbolType:"circle",lineWidth:0,fillOpacity:.8}},label:{visible:!1,offset:5,position:"top",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}}},Q3t={seriesFieldName:{total:"total",increase:"increase",decrease:"decrease"},leaderLine:{style:{stroke:"black",lineWidth:1,lineDash:[4,4]}},stackLabel:{visible:!0,offset:12,position:"withChange",style:{fill:"black",fontSize:{type:"token",key:"l4FontSize"}}},label:{visible:!1,offset:12,position:"inside",style:{lineWidth:2}}},tWt={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}},eWt={word:{padding:1,style:{textAlign:"center",textBaseline:"alphabetic"}}},iWt={gapWidth:1,nodePadding:[5],nonLeaf:{visible:!1,style:{fillOpacity:.5}},label:{style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}},nonLeafLabel:{padding:24,style:{fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},textBaseline:"middle",textAlign:"center"}}},Wt="__VCHART",tp=500,ep=500,UB=`${Wt}_ARC_TRANSFORM_VALUE`,nWt=`${Wt}_ARC_RATIO`,kU=`${Wt}_ARC_START_ANGLE`,RU=`${Wt}_ARC_END_ANGLE`,rWt=`${Wt}_ARC_K`,Qh=`${Wt}_ARC_MIDDLE_ANGLE`,sWt=`${Wt}_ARC_QUADRANT`,oWt=`${Wt}_ARC_RADIAN`,ST=-Math.PI/2,PF=3*Math.PI/2,EF=-90,Let=270,Uw=.6,aWt={innerRadius:0,outerRadius:1,startAngle:EF,endAngle:Let,gap:0,labelLayout:{align:"center",offset:0,rotate:"radial"},sunburst:{style:{stroke:{type:"palette",key:"backgroundColor"},fillOpacity:1,cursor:"pointer"}},label:{visible:!0,style:{cursor:"pointer",fill:{type:"palette",key:"primaryFontColor"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},lWt={label:{visible:!1,offset:5,position:"inside",style:{lineWidth:2,fill:{type:"palette",key:"axisMarkerFontColor"}},minLabel:{position:"end"},maxLabel:{position:"start"}}},hWt={layoutPadding:5,circlePacking:{visible:!0,style:{cursor:"pointer",stroke:{type:"palette",key:"backgroundColor"}}},label:{visible:!0,style:{cursor:"pointer",fill:"black",stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},dWt={cell:{style:{shape:"square",fillOpacity:1}},cellBackground:{visible:!1}},uWt={link:{style:{fillOpacity:.15,round:!0}}},cWt={rose:{style:{fillOpacity:1}},label:{style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"},textAlign:"center",textBaseline:"middle"}}},gWt={boxPlot:{style:{lineWidth:1}},label:{style:{lineWidth:2}}},pWt={centerLabel:{visible:!0,position:"center",style:{fill:"#fff",text:""}},label:{visible:!0,position:"bottom",style:{fill:"#000"}}},fWt={outlinePadding:10,liquidBackground:{style:{lineWidth:0,fillOpacity:.2}},liquidOutline:{style:{lineWidth:2}}},mWt={circle:{style:{opacity:.8},state:{hover:{opacity:1}}},overlap:{style:{opacity:.8},state:{hover:{opacity:1,stroke:"white",lineWidth:2}}},label:{visible:!0,style:{fill:"white",textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"}}},overlapLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"center",fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"}}}},vWt={label:{visible:!1,position:"center",style:{lineWidth:2,stroke:{type:"palette",key:"backgroundColor"}}},bar:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}}},_Wt={scatter:J3t,line:G3t,area:O3t,bar:D3t,bar3d:F3t,pie:K3t,pie3d:q3t,map:X3t,radar:Z3t,dot:z3t,link:Y3t,wordCloud:tWt,wordCloud3d:eWt,funnel:W3t,funnel3d:j3t,linearProgress:U3t,circularProgress:H3t,waterfall:Q3t,gauge:N3t,gaugePointer:V3t,treemap:iWt,sunburst:aWt,rangeColumn:lWt,circlePacking:hWt,heatmap:dWt,sankey:uWt,rose:cWt,boxPlot:gWt,correlation:pWt,liquid:fWt,venn:mWt,mosaic:vWt},bWt={text:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1}}},yWt={label:{style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fillOpacity:1,lineJoin:"bevel"}},area:{style:{fillOpacity:.2}},line:{style:{lineWidth:2,lineCap:"round",lineJoin:"round"}},point:{style:{size:8,stroke:{type:"palette",key:"backgroundColor"},lineWidth:1,fillOpacity:1}},word:{style:{fontWeight:null,fontSize:null}},fillingWord:{style:{fontWeight:null,fontSize:null}},sunburst:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},circlePacking:{style:{lineWidth:1,stroke:{type:"palette",key:"backgroundColor"}}},funnel3d:{style:{stroke:!1}},barBackground:{visible:!1,style:{fill:{type:"palette",key:"primaryFontColor",a:.06},stroke:"transparent"}}},CWt={domainLine:{visible:!0},grid:{visible:!1},subGrid:{visible:!1},tick:{visible:!0},subTick:{visible:!1}},Iet={label:{space:8},title:{space:8},maxHeight:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},SWt={label:{space:12,autoLimit:!0},title:{space:12,autoRotate:!0},maxWidth:"30%",unit:{visible:!1,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}}},xWt=Object.assign(Object.assign({},Iet),{label:{space:0}}),wWt={domainLine:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},grid:{visible:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[]}},subGrid:{visible:!1,style:{lineWidth:1,stroke:{type:"palette",key:"axisGridColor"},strokeOpacity:1,lineDash:[4,4]}},tick:{visible:!0,inside:!1,tickSize:4,alignWithLabel:!0,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},subTick:{visible:!1,tickSize:2,style:{lineWidth:1,stroke:{type:"palette",key:"axisDomainColor"},strokeOpacity:1}},label:{visible:!0,inside:!1,space:10,style:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"axisLabelFontColor"},fontWeight:"normal",fillOpacity:1}},title:{space:10,padding:0,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor"},fontWeight:"normal",fillOpacity:1}}},AWt={domainLine:{visible:!1},grid:{visible:!0},subGrid:{visible:!1},tick:{visible:!1},subTick:{visible:!1}},MWt={grid:{smooth:!0,visible:!0},subGrid:{smooth:!0,visible:!1}},TWt={grid:{visible:!0,style:{lineDash:[6,6]}},label:{space:5}},kWt={style:{fill:"#B0C8F9",fillOpacity:.2,stroke:"#B0C8F9",lineWidth:2},brushMode:"single",brushType:"rect",brushMoved:!0,removeOnClick:!0,delayType:"throttle",delayTime:0},RWt={trigger:"hover",bandField:{visible:!1,line:{type:"rect",visible:!0,style:{fill:{type:"palette",key:"axisGridColor"},opacity:.7,lineWidth:0,stroke:{type:"palette",key:"markLineStrokeColor"},lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}},linearField:{visible:!1,line:{type:"line",visible:!0,style:{stroke:{type:"palette",key:"markLineStrokeColor"},fill:"transparent",opacity:.7,lineDash:[2,3]}},label:{visible:!1,style:{fontWeight:"normal",fill:{type:"palette",key:"axisMarkerFontColor"},fontSize:{type:"token",key:"l5FontSize"}},labelBackground:{padding:{bottom:0,top:0,left:2,right:2},style:{fill:{type:"palette",key:"axisMarkerBackgroundColor"},cornerRadius:1}}}}},BWt=`M-0.5-2.4h0.9c0.4,0,0.7,0.3,0.7,0.7v3.3c0,0.4-0.3,0.7-0.7,0.7h-0.9c-0.4,0-0.7-0.3-0.7-0.7v-3.3
C-1.2-2-0.9-2.4-0.5-2.4z M-0.4-1.4L-0.4-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C-0.4-1.4-0.4-1.4-0.4-1.4z M0.3-1.4L0.3-1.4c0,0,0,0.1,0,0.1v2.6c0,0.1,0,0.1,0,0.1l0,0c0,0,0-0.1,0-0.1v-2.6
C0.3-1.4,0.3-1.4,0.3-1.4z;`,BU=()=>({style:{symbolType:BWt,fill:{type:"palette",key:"sliderHandleColor"},scaleX:1.2,scaleY:1.2,stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},lineWidth:1}}),PU=n=>({area:{style:{visible:n,stroke:!1,fill:{type:"palette",key:"dataZoomChartColor"}}},line:{style:{visible:n,stroke:{type:"palette",key:"dataZoomChartColor"},lineWidth:1}}}),PWt={padding:[12,0],showDetail:"auto",brushSelect:!1,middleHandler:{visible:!1,background:{size:6,style:{stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},cornerRadius:2}},icon:{style:{size:4,fill:{type:"palette",key:"sliderHandleColor"},stroke:{type:"palette",key:"dataZoomHandleStrokeColor"},symbolType:"M 0.3 -0.5 C 0.41 -0.5 0.5 -0.41 0.5 -0.3 C 0.5 -0.3 0.5 0.3 0.5 0.3 C 0.5 0.41 0.41 0.5 0.3 0.5 C 0.3 0.5 -0.3 0.5 -0.3 0.5 C -0.41 0.5 -0.5 0.41 -0.5 0.3 C -0.5 0.3 -0.5 -0.3 -0.5 -0.3 C -0.5 -0.41 -0.41 -0.5 -0.3 -0.5 C -0.3 -0.5 0.3 -0.5 0.3 -0.5 Z",lineWidth:.5}}},background:{size:20,style:{fill:{type:"palette",key:"sliderRailColor"},lineWidth:0}},selectedBackground:{style:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.1,outerBorder:{stroke:{type:"palette",key:"sliderTrackColor"},strokeOpacity:.2,distance:-.5,lineWidth:1}}},selectedBackgroundChart:PU(!1),startHandler:BU(),endHandler:BU(),startText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},endText:{padding:8,style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}}},backgroundChart:PU(!0)},EU=(n,t)=>({fontSize:{type:"token",key:n},fill:{type:"palette",key:t},fontWeight:"normal",fillOpacity:1,textBaseline:"top",textAlign:"center"}),EWt={title:{visible:!0,autoLimit:!1,autoFit:!1,style:EU("l1FontSize","primaryFontColor")},content:{visible:!0,style:EU("l2FontSize","tertiaryFontColor")}},Oet={orient:"right",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"primaryFontColor"}},space:12},handler:{visible:!0},startText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},endText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6},handlerText:{style:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fontWeight:"normal",fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"}},space:6}},LU=n=>{const t={width:200,height:8,style:{fill:{type:"palette",key:"sliderRailColor"}}};return n?(t.width=200,t.height=8):(t.width=8,t.height=200),Object.assign(Object.assign({},Oet),{rail:t,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:"#ffffff"},shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"}}}})},LWt={horizontal:LU(!0),vertical:LU(!1)},IWt={orient:"bottom",position:"middle",padding:[16,24],title:{visible:!1,padding:0,textStyle:{fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},fill:{type:"palette",key:"primaryFontColor"},fontWeight:"normal"},space:12},pager:{textStyle:{fill:{type:"palette",key:"discreteLegendPagerTextColor"}},handler:{style:{fill:{type:"palette",key:"discreteLegendPagerHandlerColor"}},state:{disable:{fill:{type:"palette",key:"discreteLegendPagerHandlerDisableColor"}}}}},item:{visible:!0,spaceCol:10,spaceRow:6,padding:2,background:{state:{selectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}},unSelectedHover:{fill:{type:"palette",key:"hoverBackgroundColor"}}}},shape:{space:6,style:{lineWidth:0,fillOpacity:1,opacity:1},state:{unSelected:{fillOpacity:.2,opacity:1}}},label:{space:6,style:{fill:{type:"palette",key:"secondaryFontColor",default:"#89909d"},fontSize:{type:"token",key:"l5FontSize"},lineHeight:{type:"token",key:"l5LineHeight"},opacity:1},state:{unSelected:{fill:{type:"palette",key:"disableFontColor"},opacity:1}}}},allowAllCanceled:!1},IU=n=>{const t={style:{fill:{type:"palette",key:"sliderRailColor"}}};return n?(t.width=200,t.height=4):(t.height=200,t.width=4),Object.assign(Object.assign({},Oet),{sizeBackground:{fill:{type:"palette",key:"dataZoomChartColor"}},track:{style:{fill:{type:"palette",key:"sliderTrackColor",a:.8}}},rail:t,handler:{style:{symbolType:"circle",lineWidth:0,outerBorder:{lineWidth:2,distance:.8,stroke:{type:"palette",key:"sliderTrackColor"}},fill:{type:"palette",key:"sliderHandleColor"}}}})},OWt={horizontal:IU(!0),vertical:IU(!1)},DWt={visible:!0,offset:12,position:"top",space:10,nameLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},valueLabel:{visible:!0,style:{textBaseline:"middle",textAlign:"left",fill:"black",fontSize:{type:"token",key:"l6FontSize"}}},background:{visible:!0,padding:{top:4,bottom:4,left:6,right:6},style:{cornerRadius:2,lineWidth:1,fill:"white",stroke:"grey"}},leader:{visible:!1,style:{lineWidth:1,stroke:"red"}}},Det=()=>({style:{fontSize:{type:"token",key:"l4FontSize"},fontWeight:"normal",fontStyle:"normal",fill:{type:"palette",key:"primaryFontColor"}},labelBackground:{padding:{top:2,bottom:2,right:4,left:4},style:{cornerRadius:3,fill:{type:"palette",key:"markLabelBackgroundColor"}}}}),OU={area:{style:{fill:{type:"palette",key:"axisDomainColor",a:.25}}},label:Det()},DU=n=>({visible:n,symbolType:"triangle",size:10,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}}),Fet=Det();Fet.refY=5;const FU={line:{style:{lineDash:[3,3],stroke:{type:"palette",key:"markLineStrokeColor"}}},startSymbol:DU(!1),endSymbol:DU(!0),label:Fet},YB={itemLine:{decorativeLine:{visible:!1},startSymbol:{size:5,visible:!0,style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},endSymbol:{style:{fill:{type:"palette",key:"markLineStrokeColor"},stroke:null,lineWidth:0}},line:{style:{stroke:{type:"palette",key:"markLineStrokeColor"}}}},itemContent:{offsetY:-50}},FWt={visible:!0,position:"start",padding:{top:20,bottom:20},slider:{space:10,trackStyle:{fill:{type:"palette",key:"sliderTrackColor"},fillOpacity:.8},railStyle:{fill:{type:"palette",key:"sliderRailColor"}},handlerStyle:{size:15,stroke:{type:"palette",key:"backgroundColor"},lineWidth:2,fill:{type:"palette",key:"playerControllerColor"}}},controller:{start:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},pause:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},backward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}},forward:{order:0,space:10,position:"start",style:{size:12,fill:{type:"palette",key:"playerControllerColor"},fillOpacity:.8}}}},HWt={padding:{top:4,bottom:20},textStyle:{fontSize:{type:"token",key:"l3FontSize"},lineHeight:{type:"token",key:"l3LineHeight"},fill:{type:"palette",key:"primaryFontColor"}},subtextStyle:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fill:{type:"palette",key:"tertiaryFontColor"}}},zWt={offset:{x:10,y:10},panel:{padding:{top:10,left:10,right:10,bottom:10},backgroundColor:{type:"palette",key:"popupBackgroundColor"},border:{color:{type:"palette",key:"popupBackgroundColor"},width:0,radius:3},shadow:{x:0,y:4,blur:12,spread:0,color:{type:"palette",key:"shadowColor"}}},spaceRow:6,titleLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0},shape:{size:8,spacing:6},keyLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"secondaryFontColor"},textBaseline:"middle",spacing:26},valueLabel:{fontSize:{type:"token",key:"l4FontSize"},lineHeight:{type:"token",key:"l4LineHeight"},fontColor:{type:"palette",key:"primaryFontColor"},fontWeight:"bold",textBaseline:"middle",spacing:0}},WWt={visible:!0,position:"auto",padding:8,titleStyle:{fontSize:{type:"token",key:"l5FontSize"},fontWeight:"bold",fill:{type:"palette",key:"primaryFontColor"}},contentStyle:{fontSize:{type:"token",key:"l5FontSize"},fill:{type:"palette",key:"primaryFontColor"}},panel:{visible:!0,fill:{type:"palette",key:"popupBackgroundColor"},cornerRadius:3,lineWidth:0,shadowBlur:12,shadowOffsetX:0,shadowOffsetY:4,shadowColor:{type:"palette",key:"shadowColor"},size:0,space:12}},jWt={visible:!1,offset:5,overlap:{clampForce:!0,strategy:[]},smartInvert:!1,animation:!1,style:{fontSize:{type:"token",key:"l4FontSize"},fill:{type:"palette",key:"primaryFontColor"}}},NWt={horizontal:{height:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}},vertical:{width:10,slider:{style:{fill:{type:"palette",key:"scrollBarSliderColor"}}}}},$Wt={discreteLegend:IWt,colorLegend:LWt,sizeLegend:OWt,axis:wWt,axisBand:CWt,axisLinear:AWt,axisX:Iet,axisY:SWt,axisZ:xWt,axisAngle:TWt,axisRadius:MWt,markLine:FU,markArea:OU,markPoint:YB,polarMarkLine:FU,polarMarkArea:OU,polarMarkPoint:YB,geoMarkPoint:YB,tooltip:zWt,dataZoom:PWt,crosshair:RWt,player:FWt,brush:kWt,indicator:EWt,title:HWt,mapLabel:DWt,poptip:WWt,totalLabel:jWt,scrollBar:NWt};function VWt(n,t){return n&&t.key in n?n[t.key]:t.default}function GWt(n){return n&&n.type==="token"&&!!n.key}const b0={fontFamily:"PingFang SC,Helvetica Neue,Microsoft Yahei,system-ui,-apple-system,segoe ui,Roboto,Helvetica,Arial,sans-serif,apple color emoji,segoe ui emoji,segoe ui symbol",fontSize:14,l1FontSize:32,l1LineHeight:"150%",l2FontSize:20,l2LineHeight:"140%",l3FontSize:16,l3LineHeight:"150%",l4FontSize:14,l4LineHeight:"150%",l5FontSize:12,l5LineHeight:"130%",l6FontSize:10,l6LineHeight:"120%"},xI={name:"light",background:{type:"palette",key:"backgroundColor"},padding:20,fontFamily:{type:"token",key:"fontFamily"},colorScheme:I3t,token:b0,mark:bWt,markByName:yWt,series:_Wt,component:$Wt,animationThreshold:2e3},UWt={default:{dataScheme:Pet,palette:{backgroundColor:"#202226",borderColor:"#404349",shadowColor:"rgba(0,0,0,0.1)",hoverBackgroundColor:"#404349",sliderRailColor:"#404349",sliderHandleColor:"#202226",sliderTrackColor:"#4284FF",popupBackgroundColor:"#404349",primaryFontColor:"#fdfdfd",secondaryFontColor:"#bbbdc3",tertiaryFontColor:"#888c93",axisLabelFontColor:"#888c93",disableFontColor:"#55595f",axisMarkerFontColor:"#202226",axisGridColor:"#404349",axisDomainColor:"#4b4f54",dataZoomHandleStrokeColor:"#bbbdc3",dataZoomChartColor:"#55595F",playerControllerColor:"#4284FF",scrollBarSliderColor:"rgba(255,255,255,0.3)",axisMarkerBackgroundColor:"#fdfdfd",markLabelBackgroundColor:"#404349",markLineStrokeColor:"#bbbdc3",dangerColor:"#eb4b4b",warningColor:"#f0bd30",successColor:"#14b267",infoColor:"#4284ff",discreteLegendPagerTextColor:"#BBBDC3",discreteLegendPagerHandlerColor:"#BBBDC3",discreteLegendPagerHandlerDisableColor:"#55595F",emptyCircleColor:"#bbbdc3",linearProgressTrackColor:"#404349"}}},HU={name:"dark",colorScheme:UWt,component:{dataZoom:{selectedBackground:{style:{fillOpacity:.4,outerBorder:{strokeOpacity:.4}}}}}},wI=(n,t,e)=>{if(D(t))return n;const i=t[0];return D(i)?n:t.length===1?(n[i]=e,n):(D(n[i])&&(typeof t[1]=="number"?n[i]=[]:n[i]={}),wI(n[i],t.slice(1),e))},YWt=(n,t,e)=>{if(!D(t))return Dt(n,t,e)};function Nt(n,...t){let e=-1;const i=t.length;for(;++e<i;){const r=t[e];_O(n,r,!0,!0)}return n}function XWt(n,t,e,i){Object.keys(n).forEach(r=>{if(kt(t))t.type===r&&(V(n[r])?n[r].length>=t.index&&(n[r][t.index]=i?Nt({},n[r][t.index],e):e):n[r]=i?Nt({},n[r],e):e);else if(V(n[r])){const s=n[r].findIndex(o=>o.id===t);s>=0&&(n[r][s]=i?Nt({},n[r][s],e):e)}else n.id===t&&(n[r]=i?Nt({},n[r],e):e)})}let q=class ze{static registerChart(t,e){ze._charts[t]=e}static registerSeries(t,e){ze._series[t]=e}static registerComponent(t,e,i){ze._components[t]={cmp:e,alwaysCheck:i}}static registerMark(t,e){ze._marks[t]=e}static registerRegion(t,e){ze._regions[t]=e}static registerTransform(t,e){ze.transforms[t]=e}static registerLayout(t,e){ze._layout[t]=e}static registerAnimation(t,e){ze._animations[t]=e}static registerImplement(t,e){ze._implements[t]=e}static registerChartPlugin(t,e){ze._chartPlugin[t]=e}static registerComponentPlugin(t,e){ze._componentPlugin[t]=e}static createChart(t,e,i){return ze._charts[t]?new ze._charts[t](e,i):null}static createChartSpecTransformer(t,e){if(!ze._charts[t])return null;const i=ze._charts[t];return new i.transformerConstructor(Object.assign({seriesType:i.seriesType},e))}static createRegion(t,e,i){return ze._regions[t]?new ze._regions[t](e,i):null}static createRegionSpecTransformer(t,e){return ze._regions[t]?new ze._regions[t].transformerConstructor(e):null}static createSeries(t,e,i){return ze._series[t]?new ze._series[t](e,i):null}static createSeriesSpecTransformer(t,e){return ze._series[t]?new ze._series[t].transformerConstructor(e):null}static createMark(t,e,i){if(!ze._marks[t])return null;const r=new ze._marks[t](e,i);return r.type==="group"&&r.setMarkConfig({interactive:!1}),r}static getComponents(){return Object.values(ze._components)}static getComponentInKey(t){return ze._components[t].cmp}static getLayout(){return Object.values(ze._layout)}static getLayoutInKey(t){return ze._layout[t]}static getSeries(){return Object.values(ze._series)}static getSeriesInType(t){return ze._series[t]}static getRegionInType(t){return ze._regions[t]}static getAnimationInKey(t){return ze._animations[t]}static getImplementInKey(t){return ze._implements[t]}static getSeriesMarkMap(t){return ze._series[t]?ze._series[t].mark:{}}static getChartPlugins(){return Object.values(ze._chartPlugin)}static getComponentPlugins(){return Object.values(ze._componentPlugin)}static getComponentPluginInType(t){return ze._componentPlugin[t]}static registerFormatter(t){this._formatter=t}static getFormatter(){return this._formatter}};q._charts={},q._series={},q._components={},q._marks={},q._regions={},q._animations={},q._implements={},q._chartPlugin={},q._componentPlugin={},q.transforms={fields:BJ,filter:hkt,fold:pkt},q.dataParser={csv:EJ,dsv:PJ,tsv:LJ},q._layout={};function FC(n,...t){return Nt(zU(n),...t.map(zU))}function zU(n){var t;if(!n)return n;const e=KWt(n.colorScheme);return Object.assign({},n,{colorScheme:e,token:(t=n.token)!==null&&t!==void 0?t:{},series:Object.assign({},n.series)})}function KWt(n){return n&&(n=Object.keys(n).reduce((t,e)=>{const i=n[e];return t[e]=T3t(i),t},{})),n}function qWt(n,t,e,i){const r=q.getSeriesMarkMap(t);if(!r)return n;const s={};return Object.values(r).forEach(({type:o,name:a})=>{s[a]=Nt({},e==null?void 0:e[Q(o)[0]],i==null?void 0:i[a],n==null?void 0:n[a])}),Object.assign(Object.assign({},n),s)}const ZWt=["animationThreshold","colorScheme","name","padding"];function xT(n,t,e,i){if(!n)return n;t||(t=n.colorScheme),e||(e=n.token);const r={};return Object.keys(n).forEach(s=>{const o=n[s];ZWt.includes(s)?r[s]=o:os(o)?Gw(o)?r[s]=M3t(o,t,i):GWt(o)?r[s]=VWt(e,o):r[s]=xT(o,t,e,i):r[s]=o}),r}const y0={[xI.name]:xI},Mb=xI.name,Cf=new Map(Object.keys(y0).map(n=>[n,y0[n]])),LF=new Map(Object.keys(y0).map(n=>[n,xT(y0[n])])),Yw=new Map(Object.keys(y0).map(n=>[n,n===Mb])),IF=(n,t)=>{if(!n)return;const e=tjt(t);Cf.set(n,e),LF.set(n,xT(e)),Yw.set(n,!0)},Het=(n=Mb,t=!1)=>(Yw.has(n)&&!Yw.get(n)&&IF(n,Cf.get(n)),t?LF.get(n):Cf.get(n)),JWt=n=>Cf.delete(n)&&LF.delete(n)&&Yw.delete(n),QWt=n=>!!yt(n)&&Cf.has(n),tjt=n=>{var t;const e=(t=n.type)!==null&&t!==void 0?t:Mb,i=Het(e);return FC({},i,n)};class lo{static registerInstance(t){lo.instances.set(t.id,t)}static unregisterInstance(t){lo.instances.delete(t.id)}static getInstance(t){return lo.instances.get(t)}static instanceExist(t){return lo.instances.has(t)}static forEach(t,e=[],i){const r=Q(e);return lo.instances.forEach((s,o,a)=>{r.includes(o)||t(s,o,a)},i)}}lo.instances=new Map;let Tc=class Su{static registerTheme(t,e){IF(t,e)}static getTheme(t,e=!1){return Het(t,e)}static removeTheme(t){return JWt(t)}static themeExist(t){return QWt(t)}static getDefaultTheme(){return Su.themes.get(Mb)}static setCurrentTheme(t){Su.themeExist(t)&&(Su._currentThemeName=t,lo.forEach(e=>e==null?void 0:e.setCurrentTheme(t)))}static getCurrentTheme(t=!1){return Su.getTheme(Su._currentThemeName,t)}static getCurrentThemeName(){return Su._currentThemeName}};Tc.themes=Cf,Tc._currentThemeName=Mb;function kh(n,t){return yt(n)?Tc.themeExist(n)?Tc.getTheme(n,t):{}:kt(n)?n:{}}function AI(n,t={data:e=>e}){if(!n)return n;if(n.constructor===Object){const e={};for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){if(t[i]){e[i]=t[i](n[i]);continue}e[i]=AI(n[i],t)}return e}return V(n)?n.map(e=>AI(e,t)):n}function MI(n,t){if(!n)return n;if(os(n)){const e={};for(const i in n)if(Object.prototype.hasOwnProperty.call(n,i)){if(yt(n[i])&&t.getFunction(n[i])){e[i]=t.getFunction(n[i]);continue}e[i]=MI(n[i],t)}return e}return V(n)?n.map(e=>MI(e,t)):n}const ejt=(n,t,e)=>Wp(n,t,e,{fontFamily:b0.fontFamily,fontSize:b0.fontSize}),ijt=(n,t,e,i)=>ejt(t,e,i).measure(n),rr=`${Wt}_DEFAULT_DATA_INDEX`,sa=`${Wt}_DEFAULT_DATA_KEY`,Fr=`${Wt}_DEFAULT_DATA_SERIES_FIELD`,WU=`${Wt}_DEFAULT_SERIES_STYLE_NAME`,njt=`${Wt}_STACK_KEY`,To=`${Wt}_STACK_START`,Wr=`${Wt}_STACK_END`,kc=`${Wt}_STACK_START_PERCENT`,Od=`${Wt}_STACK_END_PERCENT`,TI=`${Wt}_STACK_START_OffsetSilhouette`,kI=`${Wt}_STACK_END_OffsetSilhouette`,zet=`${Wt}_STACK_TOTAL`,rjt=`${Wt}_STACK_TOTAL_PERCENT`,C0=`${Wt}_STACK_TOTAL_TOP`,OF=`${Wt}_STACK_TOTAL_BOTTOM`,HC=`${Wt}_SEGMENT_START`,XB=`${Wt}_SEGMENT_END`;function jp(n,t){for(let e=0;e<t.length;e++){const i=t[e],r=sjt(n,i.key);r?r.operations=[...new Set(r.operations.concat(i.operations))]:n.push(i)}return n}function sjt(n,t){return n.find(e=>e.key===t)}function Xw(n,t){var e;if(!n)return t??null;const i=n.getFields();return i&&i[t]?(e=i[t].alias)!==null&&e!==void 0?e:t:t??null}function Wet(n,t,e){const i=n.getStackSort(),r={};let s=null;return i&&(s={},n.getSeries().forEach(o=>{const a=o.getSeriesField();if(a){const l=o.getRawDataStatisticsByField(a);l.values&&(s[a]||(s[a]={lastIndex:0,sort:{}}),l.values.forEach((h,d)=>{h in s[a].sort||(s[a].sort[h]=s[a].lastIndex,s[a].lastIndex++)}))}})),n.getSeries().forEach(o=>{var a;const l=o.getStackData(),h=o.getStackValue(),d=o.getStackValueField(),u=!e||e(o);l&&d&&u&&(r[h]=(a=r[h])!==null&&a!==void 0?a:{groupField:l.groupField,nodes:{}},Vet(o,l,r[h],d,t,s))}),i?jet(r):r}function jet(n,t){var e;for(const i in n)!((e=n[i].sortDatums)===null||e===void 0)&&e.length?(n[i].sortDatums.sort((r,s)=>r.index-s.index),n[i].values=n[i].sortDatums.map(r=>r.datum)):jet(n[i].nodes);return n}function Net(n,t){if("values"in n&&n.values.length){const e=wet(n.values,t),i=TF(n.values,Od);n.values.forEach(r=>{r[zet]=e,r[rjt]=i})}else for(const e in n.nodes)Net(n.nodes[e],t)}function ojt(n){if(!n.values.length)return;const t=n.values[n.values.length-1][Wr]/2;for(let e=0;e<n.values.length;e++)n.values[e][TI]=n.values[e][To]-t,n.values[e][kI]=n.values[e][Wr]-t}function $et(n,t,e,i,r={key:njt,start:To,end:Wr,startPercent:kc,endPercent:Od,max:C0,min:OF}){const s=i&&L(r.min),o=i&&L(r.max);if(n.values.length>0){let a=0,l=0,h=1,d=0,u=null,c=null;const g=n.values.length;for(let p=0;p<g;p++){const f=n.values[t?g-1-p:p];d=f[r.end],d>=0?(f[r.start]=a,a+=f[r.end],f[r.end]=a):(f[r.start]=l,l+=f[r.end],f[r.end]=l),f[r.key]=n.key,o&&(delete f[r.max],(!c||f[r.end]>c[r.end])&&(c=f)),s&&(delete f[r.min],(!u||f[r.start]<u[r.start])&&(u=f))}if(o&&c&&(c[r.max]=!0),s&&u&&(u[r.min]=!0),e)for(let p=0;p<g;p++){const f=n.values[t?g-1-p:p];d=f[r.end];const m=d>=0?a:l;h=d>=0?1:-1,f[r.startPercent]=m===0?0:Math.min(1,f[r.start]/m)*h,f[r.endPercent]=m===0?0:Math.min(1,f[r.end]/m)*h}}for(const a in n.nodes)$et(n.nodes[a],t,e,i,r)}function Vet(n,t,e,i,r,s,o){var a;if("values"in t)if(r&&t.values.forEach(l=>l[Wr]=lIt(l[i])),e.series.push({s:n,values:t.values}),s){const l=n.getSeriesField();t.values.forEach(h=>{e.sortDatums.push({series:n,datum:h,index:l?s[l].sort[h[l]]:0})})}else e.values.push(...t.values);else for(const l in t.nodes){const h=o?`${o}_${l}`:l;e.nodes[l]||(e.nodes[l]={values:[],series:[],nodes:{},sortDatums:[],key:h},L((a=t.nodes[l])===null||a===void 0?void 0:a.groupField)&&(e.nodes[l].groupField=t.nodes[l].groupField)),Vet(n,t.nodes[l],e.nodes[l],i,r,s,h)}}const Get=(n,t,e="key",i="children")=>{for(let r=0;r<n.length;r++){const s=n[r];if(s[e]===t)return s;if(s[i]){const o=Get(s[i],t,e,i);if(o)return o}}return null},Uet=(n,t,e="key",i="children")=>{for(let r=0;r<n.length;r++){const s=n[r];if(s[i])for(let o=0;o<s[i].length;o++){const a=s[i][o];if(a[e]===t)return s;const l=Uet([a],t,e,i);if(l)return l}}return null},ajt=(n,t,e="key",i="children")=>{const r=[],s=(o,a)=>{for(const l of o){if(l[e]===t)return r.push(...a,l[e].toString()),!0;if(l[i]){const h=s(l[i],[...a,l[e]]);if(h===!0)return h}}return!1};return s(n,[]),r};function ljt(n,t="value",e="children"){return!!kt(n)&&!!n.hasOwnProperty(e)&&Array.isArray(n[e])}function Yet(n,t,e,i="value",r="children"){return Array.isArray(n)?n.map(s=>{const o=Object.assign({},s);return Array.isArray(o[r])&&(o[r]=Yet(o[r],t,e,i,r)),o}).filter(s=>+s[i]>=t&&+s[i]<=e||s[r]&&s[r].length>0):n}function Yo(n={}){const t=Object.assign({},n);if(it(n.style)?t.style=(e,i,r,s)=>jt(n.style(e,i,r,s)):xt(n.style)||(t.style=jt(n.style)),!xt(n.state)){const e={};Object.keys(n.state).forEach(i=>{it(n.state[i])?e[i]=(r,s,o,a)=>jt(n.state[i](r,s,o,a)):xt(n.state[i])||(e[i]=jt(n.state[i]))}),t.state=e}return t}function _g(n){if(xt(n))return null;const t={};return Object.keys(n).forEach(e=>{it(n[e])?t[e]=(i,r,s,o)=>jt(n[e](i,r,s,o)):xt(n[e])||(t[e]=jt(n[e]))}),t}function hjt(n){if(xt(n))return null;const t={};return Object.keys(n).forEach(e=>{it(n[e])?t[e]=(i,r,s,o)=>jt(n[e](i.rawValue,r,i,s,o)):xt(n[e])||(t[e]=jt(n[e]))}),t}function jU(n,t){if(xt(n))return null;const e={};return Object.keys(n).forEach(i=>{it(n[i])?e[i]=n[i](t):e[i]=n[i]}),jt(e)}function jt(n){return n!=null&&n.angle&&(n.angle=Te(n.angle)),n}var td;(function(n){n.enter="enter",n.update="update",n.exit="exit",n.group="group",n.connectNulls="connectNulls"})(td||(td={}));var Ke;(function(n){n.enter="enter",n.update="update",n.exit="exit",n.unChange="unChange"})(Ke||(Ke={}));var Tt;(function(n){n.arc="arc",n.arc3d="arc3d",n.area="area",n.image="image",n.line="line",n.path="path",n.rect="rect",n.rect3d="rect3d",n.rule="rule",n.shape="shape",n.symbol="symbol",n.text="text",n.richtext="richtext",n.polygon="polygon",n.pyramid3d="pyramid3d",n.circle="circle",n.cell="cell",n.interval="interval",n.group="group",n.glyph="glyph",n.component="component",n.largeRects="largeRects",n.largeSymbols="largeSymbols"})(Tt||(Tt={}));var Ii;(function(n){n.axis="axis",n.grid="grid",n.legend="legend",n.slider="slider",n.label="label",n.datazoom="datazoom",n.player="player",n.title="title",n.scrollbar="scrollbar"})(Ii||(Ii={}));var NU;(function(n){n[n.player=1]="player",n[n.rollUp=2]="rollUp",n[n.drillDown=3]="drillDown",n[n.slider=4]="slider",n[n.datazoom=5]="datazoom",n[n.legend=6]="legend",n[n.scrollbar=7]="scrollbar",n[n.brush=8]="brush",n[n.normal=9]="normal"})(NU||(NU={}));var Wa;(function(n){n.lineAxis="lineAxis",n.circleAxis="circleAxis"})(Wa||(Wa={}));var Dn;(function(n){n.lineAxisGrid="lineAxisGrid",n.circleAxisGrid="circleAxisGrid"})(Dn||(Dn={}));var $U;(function(n){n.discreteLegend="discreteLegend",n.colorLegend="colorLegend",n.sizeLegend="sizeLegend"})($U||($U={}));var VU;(function(n){n.lineCrosshair="lineCrosshair",n.rectCrosshair="rectCrosshair",n.sectorCrosshair="sectorCrosshair",n.circleCrosshair="circleCrosshair",n.polygonCrosshair="polygonCrosshair",n.ringCrosshair="ringCrosshair"})(VU||(VU={}));var GU;(function(n){n.symbolLabel="symbolLabel",n.rectLabel="rectLabel",n.lineLabel="lineLabel",n.dataLabel="dataLabel"})(GU||(GU={}));var UU;(function(n){n.continuousPlayer="continuousPlayer",n.discretePlayer="discretePlayer"})(UU||(UU={}));var Pl;(function(n){n.before="before",n.layouting="layouting",n.reevaluate="reevaluate",n.after="after"})(Pl||(Pl={}));var Lt;(function(n){n.BEFORE_EVALUATE_DATA="beforeEvaluateData",n.AFTER_EVALUATE_DATA="afterEvaluateData",n.BEFORE_EVALUATE_SCALE="beforeEvaluateScale",n.AFTER_EVALUATE_SCALE="afterEvaluateScale",n.BEFORE_PARSE_VIEW="beforeParseView",n.AFTER_PARSE_VIEW="afterParseView",n.BEFORE_TRANSFORM="beforeTransform",n.AFTER_TRANSFORM="afterTransform",n.BEFORE_CREATE_VRENDER_STAGE="beforeCreateVRenderStage",n.AFTER_CREATE_VRENDER_STAGE="afterCreateVRenderStage",n.BEFORE_CREATE_VRENDER_LAYER="beforeCreateVRenderLayer",n.AFTER_CREATE_VRENDER_LAYER="afterCreateVRenderLayer",n.BEFORE_STAGE_RESIZE="beforeStageResize",n.AFTER_STAGE_RESIZE="afterStageResize",n.BEFORE_VRENDER_DRAW="beforeVRenderDraw",n.AFTER_VRENDER_DRAW="afterVRenderDraw",n.BEFORE_MARK_JOIN="beforeMarkJoin",n.AFTER_MARK_JOIN="afterMarkJoin",n.BEFORE_MARK_UPDATE="beforeMarkUpdate",n.AFTER_MARK_UPDATE="afterMarkUpdate",n.BEFORE_MARK_STATE="beforeMarkState",n.AFTER_MARK_STATE="afterMarkState",n.BEFORE_MARK_ENCODE="beforeMarkEncode",n.AFTER_MARK_ENCODE="afterMarkEncode",n.BEFORE_DO_LAYOUT="beforeDoLayout",n.AFTER_DO_LAYOUT="afterDoLayout",n.BEFORE_MARK_LAYOUT_END="beforeMarkLayoutEnd",n.AFTER_MARK_LAYOUT_END="afterMarkLayoutEnd",n.BEFORE_DO_RENDER="beforeDoRender",n.AFTER_DO_RENDER="afterDoRender",n.BEFORE_MARK_RENDER_END="beforeMarkRenderEnd",n.AFTER_MARK_RENDER_END="afterMarkRenderEnd",n.BEFORE_CREATE_VRENDER_MARK="beforeCreateVRenderMark",n.AFTER_CREATE_VRENDER_MARK="afterCreateVRenderMark",n.BEFORE_ADD_VRENDER_MARK="beforeAddVRenderMark",n.AFTER_ADD_VRENDER_MARK="afterAddVRenderMark",n.AFTER_VRENDER_NEXT_RENDER="afterVRenderNextRender",n.BEFORE_ELEMENT_UPDATE_DATA="beforeElementUpdateData",n.AFTER_ELEMENT_UPDATE_DATA="afterElementUpdateData",n.BEFORE_ELEMENT_STATE="beforeElementState",n.AFTER_ELEMENT_STATE="afterElementState",n.BEFORE_ELEMENT_ENCODE="beforeElementEncode",n.AFTER_ELEMENT_ENCODE="afterElementEncode",n.ANIMATION_START="animationStart",n.ANIMATION_END="animationEnd",n.ELEMENT_ANIMATION_START="elementAnimationStart",n.ELEMENT_ANIMATION_END="elementAnimationEnd",n.ALL_ANIMATION_START="allAnimationStart",n.ALL_ANIMATION_END="allAnimationEnd"})(Lt||(Lt={}));var RI;(function(n){n.signal="signal",n.data="data",n.scale="scale",n.coordinate="coordinate",n.mark="mark"})(RI||(RI={}));var jr;(function(n){n.active="active",n.selected="selected",n.highlight="highlight",n.blur="blur"})(jr||(jr={}));const ud="__vgrammar_scene_item__",Xet=[Tt.line,Tt.area],djt=[Tt.arc3d,Tt.rect3d,Tt.pyramid3d],Jr="key",zC=[{}],ujt=["key"],cjt=!0,gjt=!0,pjt=!1,fjt=null,mjt=!0,YU="VGRAMMAR_IMMEDIATE_ANIMATION",XU=0,Ket=1e3,BI=0,KU=0,qU=!1,PI=!1,EI="quintInOut",ZU={stopWhenStateChange:!1,immediatelyApply:!0},vjt="VGRAMMAR_ANIMATION_PARAMETERS",Rc="_mo_hide_";function qet(n,t){return Q(n).reduce((e,i)=>{const r=yt(i)?t.getGrammarById(i):i;return r&&e.push(r),e},[])}function _jt(n){return!it(n)&&!!(n!=null&&n.signal)}function bjt(n){return!it(n)&&!!(n!=null&&n.callback)}function vr(n,t){if(D(n))return[];if(_jt(n)){const e=n.signal;if(yt(e))return Q(t.getGrammarById(e));if((e==null?void 0:e.grammarType)==="signal")return[e]}else if(bjt(n))return qet(n.dependency,t);return[]}function ju(n){return it(n)||(n==null?void 0:n.signal)||!!(n!=null&&n.callback)}function Mn(n,t,e,i){if(D(n))return n;if(it(n))return i?n.call(null,e,i,t):n.call(null,e,t);if(n.signal){const r=n.signal;return yt(r)?t==null?void 0:t[r]:r.output()}return n.callback?i?n.callback.call(null,e,i,t):n.callback.call(null,e,t):n}function yjt(n,t){if(D(n))return n;if(it(n))return n.call(null,t);if(n.signal){const e=n.signal;return yt(e)?t==null?void 0:t[e]:e.output()}return n.callback?n.callback.call(null,t):n}function S0(n,t){return Tb(n)?n.output():t[n]}function Cjt(n){return n&&(n.signal||n.callback)}const Tb=n=>n&&!D(n.grammarType),Ov=n=>it(n)?n:t=>t[n];function wT(n){return!!(n!=null&&n.scale)}function DF(n){return!!(n!=null&&n.field)}function lu(n,t){if(!n)return[];let e=[];return n.scale&&(e=Tb(n.scale)?[n.scale]:Q(t.getScaleById(n.scale))),e.concat(vr(n,t))}function Kw(n,t){switch(t){case"line":return n.some(e=>["x","y","defined"].includes(e));case"area":return n.some(e=>["x","y","x1","y1","defined"].includes(e));case"largeRects":return n.some(e=>["x","y","width","y1"].includes(e));case"largeSymbols":return n.some(e=>["x","y"].includes(e))}return!1}function Sjt(n){const{x:t,y:e,x1:i,y1:r}=n;return et(t)&&et(e)&&et(i)&&et(r)?[{x:t,y:e},{x:i,y:r}]:[]}function xjt(n,t,e,i){return!n||!n.length||n.length===1&&!1?[]:n.some(r=>Kw(Object.keys(r.nextAttrs),"line"))?n.map((r,s)=>{var o;const a=r.nextAttrs,{x:l,y:h,x1:d,y1:u,defined:c}=(o=e==null?void 0:e[s])!==null&&o!==void 0?o:{};return D(a.x)&&(a.x=l),D(a.y)&&(a.y=h),D(a.defined)&&c===!1&&(a.defined=!1),a.context=r.key,i&&(D(a.x1)&&(a.x1=d),D(a.y1)&&(a.y1=u)),a}):e??[]}function wjt(n,t,e=[]){if(!n||!n.length||n.length===1&&!1)return[];const i=new Float32Array(4*n.length);return n.forEach((r,s)=>{var o,a,l,h;const d=r.nextAttrs,u=(o=d.x)!==null&&o!==void 0?o:e[4*s],c=(a=d.y)!==null&&a!==void 0?a:e[4*s+1],g=(l=d.width)!==null&&l!==void 0?l:e[4*s+2],p=(h=d.y1)!==null&&h!==void 0?h:e[4*s+3];i[4*s]=u,i[4*s+1]=c,i[4*s+2]=g,i[4*s+3]=p-c}),i}function Ajt(n,t,e=[]){if(!n||!n.length||n.length===1&&!1)return[];const i=new Float32Array(2*n.length);return n.forEach((r,s)=>{var o,a;const l=r.nextAttrs,h=(o=l.x)!==null&&o!==void 0?o:e[2*s],d=(a=l.y)!==null&&a!==void 0?a:e[2*s+1];i[2*s]=h,i[2*s+1]=d}),i}function Mjt(n,t){if(["x","y","dx","dy"].includes(t))return!0;switch(n){case Tt.arc:return["innerRadius","outerRadius","startAngle","endAngle"].includes(t);case Tt.group:case Tt.rect:case Tt.image:return["width","height","y1"].includes(t);case Tt.path:case Tt.shape:return["path","customPath"].includes(t);case Tt.line:return t==="defined";case Tt.area:return["x1","y1","defined"].includes(t);case Tt.rule:return["x1","y1"].includes(t);case Tt.symbol:return t==="size";case Tt.polygon:return t==="points";case Tt.text:return t==="text"}return!1}function Tjt(n){return[Tt.line,Tt.area,Tt.largeRects,Tt.largeSymbols].includes(n)}function Bl(n,t,e,i,r){e&&(ju(e)?t.forEach(s=>{const o=Mn(e,i,s.datum,n);Object.assign(s.nextAttrs,o)}):Object.keys(e).forEach(s=>{var o,a;const l=e[s],h=r&&!Mjt(n.mark.markType,s)?[t[0]]:t;if(wT(l)){const d=S0(l.scale,i),u=(o=l==null?void 0:l.offset)!==null&&o!==void 0?o:0,c=!D(l.band)&&d.bandwidth?d.bandwidth()*l.band:null,g=yt(l==null?void 0:l.field),p=g?Za(l.field):null;let f=g?null:D(l==null?void 0:l.value)?0:(a=d.scale)===null||a===void 0?void 0:a.call(d,l.value);h.forEach(m=>{var v;g&&(f=(v=d.scale)===null||v===void 0?void 0:v.call(d,p(m.datum))),m.nextAttrs[s]=J(f)||J(c)?f+u+c:f})}else if(DF(l)){const d=Za(l.field);h.forEach(u=>{u.nextAttrs[s]=d(u.datum)})}else h.forEach(d=>{d.nextAttrs[s]=Mn(l,i,d.datum,n)})}))}function cd(n,t,e,i){if(!n)return null;if(ju(n))return Mn(n,i,t,e);const r={};return Object.keys(n).forEach(s=>{var o,a,l;const h=n[s];if(wT(h)){const d=S0(h.scale,i),u=(o=h==null?void 0:h.offset)!==null&&o!==void 0?o:0,c=!D(h.band)&&d.bandwidth?d.bandwidth()*h.band:null,g=yt(h==null?void 0:h.field),p=g?Za(h.field):null,f=g?(a=d.scale)===null||a===void 0?void 0:a.call(d,p(t)):D(h==null?void 0:h.value)?0:(l=d.scale)===null||l===void 0?void 0:l.call(d,h.value);r[s]=J(f)||J(c)?f+u+c:f}else if(DF(h)){const d=Za(h.field);r[s]=d(t)}else r[s]=Mn(h,i,t,e)}),r}class kjt{constructor(t,e,i,r){this.channelEncoder={},this.marks=t,e&&this.registerChannelEncoder(e),i&&this.registerDefaultEncoder(i),this.progressiveChannels&&this.registerProgressiveChannels(r)}getMarks(){return this.marks}registerChannelEncoder(t,e){return yt(t)?this.channelEncoder[t]=e:Object.assign(this.channelEncoder,t),this}registerFunctionEncoder(t){return this.functionEncoder=t,this}registerDefaultEncoder(t){return this.defaultEncoder=t,this}registerProgressiveChannels(t){return this.progressiveChannels=Q(t),this}getChannelEncoder(){return this.channelEncoder}getFunctionEncoder(){return this.functionEncoder}getDefaultEncoder(){return this.defaultEncoder}getProgressiveChannels(){return this.progressiveChannels}}class dt{static registerPlotMarks(t,e){dt._plotMarks[t]=e}static createPlotMark(t,e){return dt._plotMarks[t]?new dt._plotMarks[t](e):null}static registerMark(t,e){dt._marks[t]=e}static createMark(t,e,i){return dt._marks[t]?new dt._marks[t](e,t,i):null}static hasMark(t){return!!dt._marks[t]}static getMark(t){return dt._marks[t]}static registerComponent(t,e){dt._components[t]=e}static createComponent(t,e,i,r){const s=dt._components[t];return s?new s(e,i,r):null}static hasComponent(t){return!!dt._components[t]}static registerGraphicComponent(t,e){dt._graphicComponents[t]=e}static createGraphicComponent(t,e,i){const r=dt._graphicComponents[t];return r?r(e,i):null}static registerTransform(t,e,i){dt._transforms[t]=Object.assign(e,{type:t,isBuiltIn:!!i})}static getTransform(t){return dt._transforms[t]}static unregisterRuntimeTransforms(){Object.keys(dt._transforms).forEach(t=>{dt._transforms[t]&&!dt._transforms[t].isBuiltIn&&(dt._transforms[t]=null)})}static registerGrammar(t,e,i){dt._grammars[t]={grammarClass:e,specKey:i??t}}static createGrammar(t,e,i){var r;const s=(r=dt._grammars[t])===null||r===void 0?void 0:r.grammarClass;return s?new s(e,i):null}static getGrammars(){return this._grammars}static getGlyph(t){return dt._glyphs[t]}static createInteraction(t,e,i){const r=dt._interactions[t];return r?new r(e,i):null}static hasInteraction(t){return!!dt._interactions[t]}}dt._plotMarks={},dt._marks={},dt._components={},dt._graphicComponents={},dt._transforms={},dt._grammars={},dt._glyphs={},dt._animations={},dt._interactions={},dt._graphics={},dt._stageEventPlugins={},dt.registerGlyph=(n,t,e,i,r)=>(dt._glyphs[n]=new kjt(t,e,i,r),dt._glyphs[n]),dt.registerAnimationType=(n,t)=>{dt._animations[n]=t},dt.getAnimationType=n=>dt._animations[n],dt.registerInteraction=(n,t)=>{dt._interactions[n]=t},dt.registerGraphic=(n,t)=>{dt._graphics[n]=t},dt.getGraphicType=n=>dt._graphics[n],dt.createGraphic=(n,t)=>{const e=dt._graphics[n];return e?e(t):null},dt.registerDefaultLayout=n=>{dt.defaultLayout=n},dt.getDefaultLayout=()=>dt.defaultLayout,dt.registerStageEventPlugin=(n,t)=>{dt._stageEventPlugins[n]=t},dt.getStageEventPlugin=n=>dt._stageEventPlugins[n];const Rjt=n=>!!Tt[n];function Dv(n,t,e={}){var i;const r=dt.getGraphicType(t)?dt.createGraphic(t,e):dt.createGraphicComponent(t,e,{skipDefault:(i=n==null?void 0:n.spec)===null||i===void 0?void 0:i.skipTheme});return r||ge.getInstance().error(`create ${t} graphic failed!`),r}function Bjt(n,t,e={}){if(!dt.getGraphicType(Tt.glyph))return;const i=dt.createGraphic(Tt.glyph,e),r=t.getMarks(),s=Object.keys(r).map(o=>{if(dt.getGraphicType(r[o])){const a=dt.createGraphic(r[o]);if(a)return a.name=o,a}});return i.setSubGraphic(s),i}const qw=n=>{n&&(n[ud]=null,n.release(),n.parent&&n.parent.removeChild(n))},JU=["fillOpacity"],QU=(n,t,e)=>{var i;return t==="fillOpacity"?(n.fillOpacity=(i=e.fillOpacity)!==null&&i!==void 0?i:1,["fillOpacity"]):[]};function Pjt(n,t,e,i,r,s){const o=r.getGraphicAttribute(n,!1,s);if(o)return t.forEach(l=>{l in i&&(o[l]=i[l])}),o;const a={};return t.forEach(l=>{a[l]=i[l]}),e[n]=a,a}const kb={rect3d:[{channels:["x","y","z","x1","y1","width","height","length"],transform:(n,t,e)=>{var i,r,s,o,a,l,h,d,u,c,g,p;et(t.width)||!et(t.x1)&&et(e.width)?(n.x=Math.min((i=e.x)!==null&&i!==void 0?i:0,(r=e.x1)!==null&&r!==void 0?r:1/0),n.width=e.width):et(t.x1)||!et(t.width)&&et(e.x1)?(n.x=Math.min(e.x,e.x1),n.width=Math.abs(e.x1-e.x)):(n.x=Math.min((s=e.x)!==null&&s!==void 0?s:0,(o=e.x1)!==null&&o!==void 0?o:1/0),n.width=e.width),et(t.height)||!et(t.y1)&&et(e.height)?(n.y=Math.min((a=e.y)!==null&&a!==void 0?a:0,(l=e.y1)!==null&&l!==void 0?l:1/0),n.height=e.height):et(t.y1)||!et(t.height)&&et(e.y1)?(n.y=Math.min(e.y,e.y1),n.height=Math.abs(e.y1-e.y)):(n.y=Math.min((h=e.y)!==null&&h!==void 0?h:0,(d=e.y1)!==null&&d!==void 0?d:1/0),n.height=e.height),et(t.length)||!et(t.z1)&&et(e.length)?(n.z=Math.min((u=e.z)!==null&&u!==void 0?u:0,(c=e.z1)!==null&&c!==void 0?c:1/0),n.length=e.length):et(t.z1)||!et(t.length)&&et(e.z1)?(n.z=Math.min(e.z,e.z1),n.length=Math.abs(e.z1-e.z)):(n.z=Math.min((g=e.z)!==null&&g!==void 0?g:0,(p=e.z1)!==null&&p!==void 0?p:1/0),n.length=e.length)},storedAttrs:"sizeAttrs"}],[Tt.text]:[{channels:["text","limit","autoLimit","maxLineWidth","textType","_originText"],transform:(n,t,e)=>{var i,r,s,o;const a=(i=e.limit)!==null&&i!==void 0?i:1/0,l=(r=e.autoLimit)!==null&&r!==void 0?r:1/0,h=Math.min(a,l),d=os(e.text)&&!D(e.text.text),u=d?e.text.text:e.text;n.maxLineWidth=h===1/0?e.maxLineWidth:h,d||e.textType?e.text.type==="rich"||e.textType==="rich"?n.textConfig=u:e.text.type==="html"?(n.html=u,n.text=(s=e._originText)!==null&&s!==void 0?s:"",n.renderable=!1):e.text.type==="react"?(n.react=u,n.text=(o=e._originText)!==null&&o!==void 0?o:"",n.renderable=!1):n.text=u:n.text=u},storedAttrs:"limitAttrs"}],[Tt.rule]:[{channels:["x","y","x1","y1"],transform:(n,t,e)=>{const i=Sjt(e);n.points=i,n.x=0,n.y=0},storedAttrs:"pointAttrs"}],[Tt.symbol]:[{channels:["shape","symbolType"],transform:(n,t,e)=>{var i;n.symbolType=(i=t.shape)!==null&&i!==void 0?i:t.symbolType}},{channels:["image","fill","background"],transform:(n,t,e)=>{t.image?(n.background=t.image,n.fill=!1):e.image?(n.background=e.image,n.fill=!1):(n.fill=e.fill,n.background=e.background)},storedAttrs:"imageAttrs"}]};function Ejt(n,t){var e;return((e=kb[n])!==null&&e!==void 0?e:[]).reduce((i,r)=>(r.channels.forEach(s=>{Qr(t,s)&&(i[s]=t[s])}),i),{})}const Zw=(n,t,e,i)=>{const r={},s=t?Object.keys(t):[],o=yt(n)?kb[n]:n;if(o&&o.length){const a=[];s.forEach(l=>{let h=!1;o.forEach((d,u)=>{if(d.channels.includes(l)){if(!a[u])if(d.storedAttrs){const c=Pjt(d.storedAttrs,d.channels,r,t,e,i);d.transform(r,t,c)}else d.transform(r,t,null);a[u]=!0,h=!0}}),h||(JU.includes(l)?QU(r,l,t):r[l]=t[l])})}else s.forEach(a=>{JU.includes(a)?QU(r,a,t):r[a]=t[a]});return r},Ljt=(n,t)=>{var e,i;if(n===t)return!0;const r=(e=n&&n.length)!==null&&e!==void 0?e:0;return r===((i=t&&t.length)!==null&&i!==void 0?i:0)&&r!==0&&n.every((s,o)=>!s&&!t[o]||s&&t[o]&&s.color===t[o].color&&s.offset===t[o].offset)},Ijt=(n,t)=>{if(n===t)return!0;if(typeof n!=typeof t||yt(n)||n.gradient!==t.gradient)return!1;const e=Object.keys(n),i=Object.keys(t);return e.length===i.length&&e.every(r=>r==="stops"?Ljt(n[r],t[r]):n[r]===t[r])},Ojt=(n,t)=>n.length===t.length&&n.join("-")===t.join("-"),Djt=(n,t,e)=>!(!D(n)||!D(t))||!D(n)&&!D(t)&&(e==="lineDash"?Ojt(n,t):e==="stroke"||e==="fill"?Ijt(n,t):n===t),Fjt=["fill","fillOpacity","background","texture","texturePadding","textureSize","textureColor"],Zet=["stroke","strokeOpacity","lineDash","lineDashOffset","lineCap","lineJoin","lineWidth","miterLimit"],Hjt=Fjt.concat(Zet);function LI(n,t,e){var i;if(!n||n.length<=1)return null;const r=((i=e==null?void 0:e.mark)===null||i===void 0?void 0:i.markType)==="area"?Hjt:Zet,s=[];let o=null;return n.forEach((a,l)=>{o&&r.every(h=>Djt(o[h],a[h],h))||(s.length&&(s[s.length-1].endIndex=l),o=a,s.push({attrs:o,startIndex:l}))}),s.length>=2?s.map(a=>{const l=FF(a.attrs);return l.points=t.slice(a.startIndex,D(a.endIndex)?t.length:a.endIndex),l}):null}function zjt(n,t,e){if(!n||n.length<=1)return null;const i=!!e&&e.mark.getSpec().enableSegments;let r,s,o=[],a=null;if(n.forEach((l,h)=>{a=t[h],a&&a.defined!==!1?(r||(s={items:[],points:[]},o.push(s)),s.points.push(a),s.items.push(l),r===!1&&(s.isConnect=!0,s={items:[],points:[]},o.push(s)),r=!0):r=!1}),o=o.filter(l=>l.points.length>0),o.length>=2){const l=[];return o.forEach(h=>{if(h.isConnect)return void l.push({points:h.points,isConnect:!0});if(i){const u=LI(h.items,h.points,e);if(u)return void u.forEach(c=>{l.push(c)})}const d=FF(h.items[0]);d.points=h.points,l.push(d)}),l}return i?LI(n,t,e):null}function Wjt(n){return n?n.reduce((t,e)=>t.concat(e.points),[]):null}function FF(n){const t={};if(!n)return t;const e=["x","y","x1","y1","defined","size","width","height","context"];return Object.keys(n).forEach(i=>{e.includes(i)||(t[i]=n[i])}),t}function jjt(n,t){var e;if(!n||!n.segments||!n.segments.length)return n;const i=((e=t==null?void 0:t.mark)===null||e===void 0?void 0:e.markType)==="area"?["fillOpacity","strokeOpacity"]:["strokeOpacity"],r={};return Object.keys(n).forEach(s=>{i.includes(s)||(r[s]=n[s])}),r}let Jet=class{constructor(t){this.data=null,this.states=[],this.diffState=Ke.enter,this.isReserved=!1,this.runtimeStatesEncoder=null,this.items=[],this.getStateAttrs=(e,i)=>{var r,s,o,a;const l=!D((r=this.runtimeStatesEncoder)===null||r===void 0?void 0:r[e]),h=l?Object.assign(Object.assign({},(s=this.mark.getSpec().encode)===null||s===void 0?void 0:s[e]),this.runtimeStatesEncoder[e]):(o=this.mark.getSpec().encode)===null||o===void 0?void 0:o[e];if(!h)return{};if(it(h))return h(this.getDatum(),this,e,i);if(!l&&(!((a=this.graphicItem.states)===null||a===void 0)&&a[e]))return this.graphicItem.states[e];const d=this.items.map(c=>Object.assign({},c,{nextAttrs:{}}));Bl(this,d,h,this.mark.parameters());const u=this.transformElementItems(d,this.mark.markType);return this.graphicItem.states?this.graphicItem.states[e]||(this.graphicItem.states[e]=u):this.graphicItem.states={[e]:u},u},this.mark=t}initGraphicItem(t={}){if(this.graphicItem)return;const e=this.mark.getAttributeTransforms();if(this.graphicItem=this.mark.addGraphicItem(e?Zw(e,t,this):t,this.groupKey),!this.graphicItem)return;const{graphicName:i}=this.mark.getSpec();yt(i)?this.graphicItem.name=i:it(i)&&(this.graphicItem.name=i(this)),this.graphicItem[ud]=this,e&&(this.graphicItem.onBeforeAttributeUpdate=r=>this.mark?Zw(e,r,this):r),this.clearGraphicAttributes(),this.mark.needAnimate()&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(Object.assign({},t)),this.setFinalGraphicAttributes(Object.assign({},t)))}updateGraphicItem(){var t;if(!this.graphicItem)return;this.diffState===Ke.exit?this.graphicItem.releaseStatus="willRelease":this.graphicItem.releaseStatus=void 0;const e=(t=this.mark.animate)===null||t===void 0?void 0:t.getAnimationConfigs("state");e&&e.length!==0&&(this.graphicItem.stateAnimateConfig=e[0].originConfig)}getGraphicItem(){return this.graphicItem}removeGraphicItem(){var t,e;this.graphicItem&&((e=(t=this.graphicItem.animates)===null||t===void 0?void 0:t.forEach)===null||e===void 0||e.call(t,i=>i.stop())),this.graphicItem&&(qw(this.graphicItem),this.graphicItem[ud]=null,this.graphicItem=null)}resetGraphicItem(){this.graphicItem&&(this.graphicItem=null)}getBounds(){var t;return(t=this.graphicItem)===null||t===void 0?void 0:t.AABBBounds}getStates(){return this.states}updateData(t,e,i){var r;this.mark.emit(Lt.BEFORE_ELEMENT_UPDATE_DATA,{groupKey:t,data:e,key:i},this),this.data=e;const s=Ov(i);return this.items=e.map(o=>({datum:o,key:s(o),view:this.mark.view,nextAttrs:{}})),this.groupKey=t,this.key=this.mark.isCollectionMark()?t:(r=this.items)===null||r===void 0?void 0:r[0].key,this.mark.emit(Lt.AFTER_ELEMENT_UPDATE_DATA,{groupKey:t,data:e,key:i},this),this.items}state(t,e){var i;const r=this.mark.isCollectionMark(),s=this.states,o=Q(Mn(t,e,this.getDatum(),this)),a=(i=this.mark.getSpec())===null||i===void 0?void 0:i.stateSort;a&&o.length&&o.sort(a);const l=o.length!==s.length||o.some((h,d)=>h!==s[d]);this.states=o,!r&&l&&this.diffState===Ke.unChange&&(this.diffState=Ke.update)}encodeGraphic(t){this.coordinateTransformEncode(this.items);const e=this.transformElementItems(this.items,this.mark.markType);t&&Object.assign(e,t),this.graphicItem?(this.graphicItem.clearStates(),this.graphicItem.states={},this.graphicItem.stateProxy=null,Rc in this.graphicItem.attribute&&"visible"in e&&delete this.graphicItem.attribute[Rc],this.applyGraphicAttributes(e)):this.initGraphicItem(e),this.diffState!==Ke.enter&&this.diffState!==Ke.update||!this.states.length||this.useStates(this.states),this.mark.markType===Tt.shape&&(this.graphicItem.datum=this.items[0].datum),this.items.forEach(i=>{i.nextAttrs={}}),this._setCustomizedShape()}_setCustomizedShape(){var t;if(!this.graphicItem)return;const e=(t=this.mark.getSpec())===null||t===void 0?void 0:t.setCustomizedShape;e&&(this.graphicItem.pathProxy=i=>e(this.data,i,new Cn))}encodeItems(t,e,i=!1,r){const s=this.mark.isCollectionMark(),o=e[td.update],a=e[td.enter],l=e[td.exit],h=this.mark.isLargeMode()||s&&!this.mark.getSpec().enableSegments;this.diffState===Ke.enter?(a&&Bl(this,t,a,r,h),o&&Bl(this,t,o,r,h)):this.diffState===Ke.update?((s&&a||i)&&Bl(this,t,a,r,h),o&&Bl(this,t,o,r,h)):this.diffState===Ke.exit&&l&&(i&&Bl(this,t,a,r,h),Bl(this,t,l,r,h))}coordinateTransformEncode(t){if(!this.mark.coord||this.mark.markType==="arc"||this.mark.disableCoordinateTransform===!0)return;const e=this.mark.coord.output();t.forEach(i=>{const r=i.nextAttrs,s=e.convert(r);Object.assign(r,s)})}hasStateAnimation(){var t;const e=(t=this.mark.animate)===null||t===void 0?void 0:t.getAnimationConfigs("state");return e&&e.length>0}clearStates(t){const e=Re(t)?t:this.hasStateAnimation();this.states=[],this.graphicItem&&this.graphicItem.clearStates(e),this.runtimeStatesEncoder&&(this.runtimeStatesEncoder={})}_updateRuntimeStates(t,e){this.runtimeStatesEncoder||(this.runtimeStatesEncoder={}),this.runtimeStatesEncoder[t]=e}hasState(t){return this.states&&t&&this.states.includes(t)}updateStates(t){if(!this.graphicItem)return!1;let e=this.states.slice();const i=this.mark.getSpec().encode;let r=!1,s=!1;return Object.keys(t).forEach(o=>{var a;if(!o)return;const l=t[o];if(kt(l)&&!Oe(l,(a=this.runtimeStatesEncoder)===null||a===void 0?void 0:a[o]))e.includes(o)?r=!0:e.push(o),this._updateRuntimeStates(o,l),s=!0;else if(l)!e.includes(o)&&(i!=null&&i[o])&&(e.push(o),s=!0);else if(e.length){const h=e.filter(d=>d!==o);h.length!==e.length&&(s=!0,e=h),this.runtimeStatesEncoder&&this.runtimeStatesEncoder[o]&&(this.runtimeStatesEncoder[o]=null)}}),r&&this.graphicItem.clearStates(),!!s&&(this.useStates(e),!0)}addState(t,e){var i;if(!this.graphicItem)return!1;if(e&&yt(t)&&!Oe(e,(i=this.runtimeStatesEncoder)===null||i===void 0?void 0:i[t])){const o=this.states.slice();return o.includes(t)?this.graphicItem.clearStates():o.push(t),this._updateRuntimeStates(t,e),this.useStates(o),!0}const r=this.mark.getSpec().encode,s=Q(t).reduce((o,a)=>(a&&!o.includes(a)&&(r!=null&&r[a])&&o.push(a),o),this.states.slice());return s.length!==this.states.length&&(this.useStates(s),!0)}removeState(t){if(!this.graphicItem)return!1;const e=Q(t);if(!e.length)return!1;const i=this.states.filter(r=>!e.includes(r));return i.length!==this.states.length&&(this.runtimeStatesEncoder&&e.forEach(r=>{this.runtimeStatesEncoder[r]=null}),this.useStates(i),!0)}useStates(t,e){var i;if(!this.graphicItem)return!1;this.mark.emit(Lt.BEFORE_ELEMENT_STATE,{states:t},this);const r=(i=this.mark.getSpec())===null||i===void 0?void 0:i.stateSort;r&&t.sort(r),this.states=t;const s=Re(e)?e:this.hasStateAnimation();return this.graphicItem.stateProxy=this.getStateAttrs,this.graphicItem.useStates(this.states,s),this.mark.emit(Lt.AFTER_ELEMENT_STATE,{states:t},this),!0}diffAttributes(t){const e={},i=this.getFinalGraphicAttributes();for(const r in t)Qr(i,r)&&Oe(i[r],t[r])||(e[r]=t[r]);return e}transformElementItems(t,e,i){var r,s,o,a,l;const h=t[0];if(!h.nextAttrs||Object.keys(h.nextAttrs).length===0)return{};let d=h.nextAttrs;if(Tjt(e)&&t&&t.length&&D((r=h.nextAttrs)===null||r===void 0?void 0:r.points)&&(i===!0||Kw(Object.keys(h.nextAttrs),this.mark.markType))){const u=this.mark.getSpec(),c=this.getGraphicAttribute("points",!1),g=this.getGraphicAttribute("segments",!1),p=u.enableSegments,f=(s=this.mark.getSpec().encode)===null||s===void 0?void 0:s[td.connectNulls],m=t.map(_=>_.nextAttrs),v=this.mark.isProgressive();if(d=FF(d),e===Tt.line||e===Tt.area){const _=xjt(t,!0,c,e===Tt.area);if(v)d.segments=((l=(a=(o=this.graphicItem)===null||o===void 0?void 0:o.attribute)===null||a===void 0?void 0:a.segments)!==null&&l!==void 0?l:[]).concat([{points:_}]);else if(f){if(d.segments=zjt(m,_,this),d.segments&&d.segments.some(b=>b.isConnect)){const b=cd(f,this.getDatum(),this,this.mark.parameters());b&&d.segments.forEach(y=>{y.isConnect&&Object.assign(y,b)})}d.points=_}else if(p){const b=_&&_.length!==0?_:Wjt(g),y=LI(m,b,this);y?(d.segments=y,d.points=null):(d.segments=null,d.points=b),d=jjt(d,this)}else d.points=_,d.segments=null}else e===Tt.largeRects?d.points=wjt(t,!0,c):e===Tt.largeSymbols&&(d.points=Ajt(t,!0,c))}return d}applyGraphicAttributes(t){var e,i,r;if(!xt(t))if(this.mark.needAnimate()){const s=this.diffAttributes(t),o=(e=this.getPrevGraphicAttributes())!==null&&e!==void 0?e:{},a=(i=this.getFinalGraphicAttributes())!==null&&i!==void 0?i:{};Object.keys(s).forEach(u=>{o[u]=this.getGraphicAttribute(u),a[u]=s[u]}),this.setNextGraphicAttributes(s),this.setPrevGraphicAttributes(o),this.setFinalGraphicAttributes(a);const l=(r=this.mark.animate)===null||r===void 0?void 0:r.getElementAnimators(this).filter(u=>{var c;return!(!((c=u.animationOptions.timeline.controlOptions)===null||c===void 0)&&c.ignoreLoopFinalAttributes)||!u.animationOptions.timeline.loop}),h=(l||[]).reduce((u,c)=>Object.assign(u,c.getEndAttributes()),{}),d=Object.assign({},h,a);this.graphicItem.setAttributes(d)}else this.graphicItem.setAttributes(t)}getGraphicAttribute(t,e=!1){var i;if(!this.graphicItem)return;if(e){let o;const a=this.getPrevGraphicAttributes();if(!D(o=Dt(a,t)))return o}const r=this.mark.getAttributeTransforms();let s=[t];if(r&&r.length){const o=r.find(a=>a.storedAttrs&&a.channels.includes(t));o&&(s=[o.storedAttrs,t])}return Dt((i=this.graphicItem)===null||i===void 0?void 0:i.attribute,s)}setGraphicAttribute(t,e,i=!0){if(!this.graphicItem)return;const r=this.getFinalGraphicAttributes(),s=this.getPrevGraphicAttributes();i&&r&&(r[t]=e),s&&!Qr(s,t)&&(s[t]=this.graphicItem.attribute[t]),this.graphicItem.setAttribute(t,e)}setGraphicAttributes(t,e=!0){if(!this.graphicItem)return;const i=this.getFinalGraphicAttributes(),r=this.getPrevGraphicAttributes();Object.keys(t).forEach(s=>{i&&e&&(i[s]=t[s]),r&&!Qr(r,s)&&(r[s]=this.graphicItem.attribute[s])}),this.graphicItem.setAttributes(t)}getFinalGraphicAttributes(){return this.graphicItem.finalAttrs}setFinalGraphicAttributes(t){this.graphicItem.finalAttrs=t}getPrevGraphicAttributes(){return this.graphicItem.prevAttrs}setPrevGraphicAttributes(t){this.graphicItem.prevAttrs=t}getNextGraphicAttributes(){return this.graphicItem.nextAttrs}getFinalAnimationAttribute(t){var e,i;return(i=(e=this.getFinalGraphicAttributes())===null||e===void 0?void 0:e[t])!==null&&i!==void 0?i:this.getGraphicAttribute(t)}getFinalAnimationAttributes(){var t;return(t=this.getFinalGraphicAttributes())!==null&&t!==void 0?t:this.graphicItem.attribute}setNextGraphicAttributes(t){this.graphicItem.nextAttrs=t}clearChangedGraphicAttributes(){this.graphicItem&&(this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null))}clearGraphicAttributes(){this.graphicItem&&(this.graphicItem.prevAttrs&&this.setPrevGraphicAttributes(null),this.graphicItem.nextAttrs&&this.setNextGraphicAttributes(null),this.graphicItem.finalAttrs&&this.setFinalGraphicAttributes(null))}remove(){this.graphicItem&&(qw(this.graphicItem),this.graphicItem=null)}release(){this.removeGraphicItem(),this.mark=null,this.data=null,this.items=null}getItemAttribute(t){var e,i;if(!((e=this.items)===null||e===void 0)&&e.length)return this.mark.isCollectionMark()?D(t)?this.items.map(r=>r.nextAttrs):this.items.map(r=>{var s;return(s=r.nextAttrs)===null||s===void 0?void 0:s[t]}):D(t)?this.items[0].nextAttrs:(i=this.items[0].nextAttrs)===null||i===void 0?void 0:i[t]}setItemAttributes(t){var e;!((e=this.items)===null||e===void 0)&&e.length&&(this.mark.isCollectionMark()?V(t)&&this.items.forEach((i,r)=>{Object.assign(i.nextAttrs,t[r])}):Object.assign(this.items[0].nextAttrs,t))}getItem(){var t,e;return this.mark&&this.mark.isCollectionMark()?(t=this.items)!==null&&t!==void 0?t:[]:(e=this.items)===null||e===void 0?void 0:e[0]}getDatum(){var t,e;return this.mark&&this.mark.isCollectionMark()?(t=this.data)!==null&&t!==void 0?t:[]:(e=this.data)===null||e===void 0?void 0:e[0]}};class qd{constructor(t,e){this.references=new Map,this.view=t,this.depend(e==null?void 0:e.dependency)}getStartState(){return null}depend(t){this.references.clear(),Q(t).map(e=>yt(e)?this.view.getGrammarById(e):e).filter(e=>!D(e)).forEach(e=>{var i;this.references.set(e,((i=this.references.get(e))!==null&&i!==void 0?i:0)+1)})}parameters(){const t={};return this.references.forEach((e,i)=>{L(i.id())&&(t[i.id()]=i.output())}),t}bind(){const t=this.getEvents();(t??[]).forEach(e=>{e.type&&e.handler&&(V(e.type)?e.type.forEach(i=>{i&&i!=="none"&&this.view.addEventListener(i,e.handler)}):e.type!=="none"&&this.view.addEventListener(e.type,e.handler))})}unbind(){const t=this.getEvents();(t??[]).forEach(e=>{e.type&&e.handler&&(V(e.type)?e.type.forEach(i=>{i&&i!=="none"&&this.view.removeEventListener(i,e.handler)}):e.type!=="none"&&this.view.removeEventListener(e.type,e.handler))})}start(t){}reset(t){}dispatchEvent(t,e){this.view.emit(`${this.type}:${t}`,e),t==="start"&&this.options.onStart?this.options.onStart(e):t==="reset"&&this.options.onReset?this.options.onReset(e):t==="update"&&this.options.onUpdate?this.options.onUpdate(e):t==="end"&&this.options.onEnd&&this.options.onEnd(e)}}class Bc extends qd{constructor(t,e){super(t,e),this.type=Bc.type,this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{this.reset(i.element)},this.options=Object.assign({},Bc.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector)}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}getStartState(){return this.options.state}start(t){t&&this._marks&&this._marks.includes(t.mark)&&(t.addState(this.options.state),this._prevActiveElement=t)}reset(t){const e=t??this._prevActiveElement;e&&this._marks&&this._marks.includes(e.mark)&&e.removeState(this.options.state)}}Bc.type="element-active",Bc.defaultOptions={state:jr.active,trigger:"pointerover",triggerOff:"pointerout"};const HF=n=>n.filterField?t=>{var e;return(e=t.getDatum())===null||e===void 0?void 0:e[n.filterField]}:t=>t[n.filterType],Qet=(n,t)=>{if(!t||!n)return null;const e={};return n.forEach(i=>{const r=i&&i.getSpec(),s=r&&r.encode;s&&t.forEach(o=>{o&&s[o]&&(e[o]||(e[o]=[]),e[o].push(i))})}),e},Njt=n=>{const t=Q(n),e=[],i=[];return t.forEach(r=>{r==="empty"?e.push("view"):yt(r)&&r!=="none"?r.includes("view:")?(i.push(r.replace("view:","")),e.push("view")):(i.push(r),e.push("self")):J(r)&&e.push("timeout")}),{eventNames:i,resetType:e}};class gd extends qd{constructor(t,e){super(t,e),this.type=gd.type,this._resetType=[],this.resetAll=()=>{const{state:i,reverseState:r}=this.options;this._statedElements&&this._statedElements.length&&(this.clearAllStates(i,r),this.dispatchEvent("reset",{elements:this._statedElements,options:this.options}),this._statedElements=[])},this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{if(!this._statedElements||!this._statedElements.length)return;const r=i.element,s=r&&this._marks&&this._marks.includes(r.mark);(this._resetType.includes("view")&&!s||this._resetType.includes("self")&&s)&&this.resetAll()},this.options=Object.assign({},gd.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector),this._stateMarks=Qet(this._marks,[this.options.state,this.options.reverseState])}getStartState(){return this.options.state}getEvents(){const t=this.options.triggerOff,e=this.options.trigger,i=[{type:e,handler:this.handleStart}],{eventNames:r,resetType:s}=Njt(t);return r.forEach(o=>{o&&(V(e)?!e.includes(o):o!==e)&&i.push({type:o,handler:this.handleReset})}),this._resetType=s,i}start(t){const{state:e,reverseState:i,isMultiple:r}=this.options;if(t&&this._marks&&this._marks.includes(t.mark))if(t.hasState(e)){if(this._resetType.includes("self")){const s=this._statedElements&&this._statedElements.filter(o=>o!==t);s&&s.length?this._statedElements=this.updateStates(s,this._statedElements,e,i):this.resetAll()}}else this._timer&&clearTimeout(this._timer),t.addState(e),this._statedElements=this.updateStates(r&&this._statedElements?[...this._statedElements,t]:[t],this._statedElements,e,i),this.dispatchEvent("start",{elements:this._statedElements,options:this.options}),this._resetType.includes("timeout")&&(this._timer=setTimeout(()=>{this.resetAll()},this.options.triggerOff));else this._resetType.includes("view")&&this._statedElements&&this._statedElements.length&&this.resetAll()}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.state,this.options.reverseState]):this.resetAll()}}gd.type="element-select",gd.defaultOptions={state:jr.selected,trigger:"click"};class pd extends qd{constructor(t,e){super(t,e),this.type=pd.type,this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{if(!this._statedElements||!this._statedElements.length)return;const r=i.element;if(r){const s=this._marks&&this._marks.includes(r.mark);this._resetType!=="view"||s?this._resetType==="self"&&s&&this.resetAll():this.resetAll()}},this.options=Object.assign({},pd.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector),this._stateMarks=Qet(this._marks,[this.options.highlightState,this.options.blurState])}getStartState(){return this.options.highlightState}getEvents(){const t=this.options.triggerOff,e=[{type:this.options.trigger,handler:this.handleStart}];let i=t;return yt(t)&&t.includes("view:")?(i=t.replace("view:",""),this._resetType="view"):this._resetType="self",e.push({type:i,handler:this.handleReset}),e}resetAll(){const{highlightState:t,blurState:e}=this.options;this._lastElement&&(this.clearAllStates(t,e),this.dispatchEvent("reset",{elements:[this._lastElement],options:this.options}),this._lastElement=null,this._statedElements=null)}start(t){if(t&&this._marks&&this._marks.includes(t.mark)){const{highlightState:e,blurState:i}=this.options;if(this._lastElement===t)return;this._statedElements=this.updateStates([t],this._statedElements,e,i),this._lastElement=t,this.dispatchEvent("start",{elements:[t],options:this.options})}else this._lastElement&&this._resetType==="view"&&this.resetAll()}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}pd.type="element-highlight",pd.defaultOptions={highlightState:jr.highlight,blurState:jr.blur,trigger:"pointerover",triggerOff:"pointerout"};class Pc extends qd{constructor(t,e){super(t,e),this.type=Pc.type,this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{i.element&&this._marks&&this._marks.includes(i.element.mark)&&this.resetAll()},this.options=Object.assign({},Pc.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}resetAll(){const t=[this.options.highlightState,this.options.blurState];this._marks.forEach(e=>{e.elements.forEach(i=>{i.removeState(t)})})}start(t){if(t&&this._marks&&this._marks.includes(t.mark)){const e=t.key;if(D(e))return;this._marks.forEach(i=>{i.elements.forEach(r=>{r.key===e?r.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):r.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}Pc.type="element-highlight-by-key",Pc.defaultOptions={highlightState:jr.highlight,blurState:jr.blur,trigger:"pointerover",triggerOff:"pointerout"};class Ec extends qd{constructor(t,e){super(t,e),this.type=Ec.type,this.handleStart=i=>{this.start(i.element)},this.handleReset=i=>{const r=i.element;r&&this._marks&&this._marks.includes(r.mark)&&this.resetAll()},this.options=Object.assign({},Ec.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}resetAll(){const t=[this.options.highlightState,this.options.blurState];this._marks.forEach(e=>{e.elements.forEach(i=>{i.removeState(t)})})}start(t){if(t&&this._marks&&this._marks.includes(t.mark)){const e=t.groupKey;if(D(e))return;this._marks.forEach(i=>{i.elements.forEach(r=>{r.groupKey===e?r.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):r.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}Ec.type="element-highlight-by-group",Ec.defaultOptions={highlightState:jr.highlight,blurState:jr.blur,trigger:"pointerover",triggerOff:"pointerout"};class Lc extends qd{constructor(t,e){super(t,e),this.type=Lc.type,this.handleStart=i=>{var r,s;this.start((s=(r=i.detail)===null||r===void 0?void 0:r.data)===null||s===void 0?void 0:s.id)},this.handleReset=i=>{this.resetAll()},this.options=Object.assign({},Lc.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector)}getEvents(){return[{type:_r.legendItemHover,handler:this.handleStart},{type:_r.legendItemUnHover,handler:this.handleReset}]}getStartState(){return this.options.state}start(t){const e=t;if(D(e))return;const i=HF(this.options);this._marks.forEach(r=>{r.elements.forEach(s=>{i(s)===e?s.addState(this.options.state):s.removeState(this.options.state)})})}resetAll(){this._marks.forEach(t=>{t.elements.forEach(e=>{e.removeState(this.options.state)})})}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState(this.options.state):this.resetAll()}}Lc.type="element-active-by-legend",Lc.defaultOptions={state:jr.active,filterType:"groupKey"};class Ic extends qd{constructor(t,e){super(t,e),this.type=Ic.type,this.handleStart=(i,r)=>{var s,o;this.start((o=(s=i.detail)===null||s===void 0?void 0:s.data)===null||o===void 0?void 0:o.id)},this.handleReset=i=>{this.resetAll()},this.options=Object.assign({},Ic.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:_r.legendItemHover,handler:this.handleStart},{type:_r.legendItemUnHover,handler:this.handleReset}]}start(t){if(D(t))return;const e=HF(this.options);this._marks.forEach(i=>{i.elements.forEach(r=>{e(r)===t?r.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):r.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}resetAll(){const t=[this.options.highlightState,this.options.blurState];this._marks.forEach(e=>{e.elements.forEach(i=>{i.removeState(t)})})}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}Ic.type="element-highlight-by-legend",Ic.defaultOptions={highlightState:jr.highlight,blurState:jr.blur,filterType:"groupKey"};class Oc extends qd{constructor(t,e){super(t,e),this.type=Oc.type,this.handleStart=(i,r)=>{if(this.options.shouldStart?this.options.shouldStart(i):this._filterByName(i)){const s=this._parseTargetKey(i,r);this.start(s)}},this.handleReset=i=>{(this.options.shouldReset?this.options.shouldReset(i):this._filterByName(i))&&this.resetAll()},this.options=Object.assign({},Oc.defaultOptions,e),this._marks=t.getMarksBySelector(this.options.selector)}getStartState(){return this.options.highlightState}getEvents(){return[{type:this.options.trigger,handler:this.handleStart},{type:this.options.triggerOff,handler:this.handleReset}]}_filterByName(t){var e;const i=Q(this.options.graphicName);return((e=t==null?void 0:t.target)===null||e===void 0?void 0:e.name)&&i.includes(t.target.name)}_parseTargetKey(t,e){return this.options.parseData?this.options.parseData(t):t.target.type==="text"?t.target.attribute.text:null}start(t){if(D(t))return;const e=HF(this.options);this._marks.forEach(i=>{i.elements.forEach(r=>{e(r)===t?r.updateStates({[this.options.blurState]:!1,[this.options.highlightState]:!0}):r.updateStates({[this.options.blurState]:!0,[this.options.highlightState]:!1})})})}resetAll(){const t=[this.options.blurState,this.options.highlightState];this._marks.forEach(e=>{e.elements.forEach(i=>{i.removeState(t)})})}reset(t){t?this._marks&&this._marks.includes(t.mark)&&t.removeState([this.options.highlightState,this.options.blurState]):this.resetAll()}}Oc.type="element-highlight-by-name",Oc.defaultOptions={trigger:"pointerover",triggerOff:"pointerout",highlightState:jr.highlight,blurState:jr.blur,filterType:"groupKey"};function t8(n){if(n)return n.type===Ui.Band?n.bandwidth():n.type===Ui.Point?n.step():void 0}class tit{updateStates(t,e,i,r){return t&&t.length?(i&&r?e&&e.length?(this.toggleReverseStateOfElements(t,e,r),this.toggleStateOfElements(t,e,i)):this.addBothStateOfElements(t,i,r):i&&(e&&e.length?this.toggleStateOfElements(t,e,i):this.addStateOfElements(t,i)),t):null}toggleReverseStateOfElements(t,e,i){e.forEach(r=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(r.mark)&&r.addState(i)}),t.forEach(r=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(r.mark)&&r.removeState(i)})}toggleStateOfElements(t,e,i){e.forEach(r=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(r.mark)&&r.removeState(i)}),t.forEach(r=>{i&&this._stateMarks[i]&&this._stateMarks[i].includes(r.mark)&&r.addState(i)})}addBothStateOfElements(t,e,i){this._marks.forEach(r=>{var s;const o=i&&this._stateMarks[i]&&this._stateMarks[i].includes(r),a=e&&this._stateMarks[e]&&this._stateMarks[e].includes(r);(o||a)&&((s=r.elements)===null||s===void 0||s.forEach(l=>{t&&t.includes(l)?a&&l.addState(e):o&&l.addState(i)}))})}addStateOfElements(t,e){this._marks.forEach(i=>{var r;const s=e&&this._stateMarks[e]&&this._stateMarks[e].includes(i);s&&((r=i.elements)===null||r===void 0||r.forEach(o=>{t&&t.includes(o)&&s&&o.addState(e)}))})}clearAllStates(t,e){this._statedElements&&this._statedElements.length&&this._marks.forEach(i=>{i&&i.elements&&(e&&this._stateMarks[e]&&this._stateMarks[e].includes(i)&&i.elements.forEach(r=>{r.removeState(e)}),t&&this._stateMarks[t]&&this._stateMarks[t].includes(i)&&i.elements.forEach(r=>{this._statedElements.includes(r)&&r.removeState(t)}))})}}const $jt=()=>{dt.registerInteraction(Bc.type,Bc)},Vjt=()=>{Ye(gd,tit),dt.registerInteraction(gd.type,gd)},Gjt=()=>{Ye(pd,tit),dt.registerInteraction(pd.type,pd)},Ujt=()=>{dt.registerInteraction(Pc.type,Pc)},Yjt=()=>{dt.registerInteraction(Ec.type,Ec)},Xjt=()=>{dt.registerInteraction(Lc.type,Lc)},Kjt=()=>{dt.registerInteraction(Ic.type,Ic)},qjt=()=>{dt.registerInteraction(Oc.type,Oc)},e8=(n,t)=>Tb(n)?n.output():n&&kt(n)?it(n.callback)?e=>n.callback(e,t):it(n.value)?n.value(t):n:n,Zjt=(n,t)=>n&&(kt(n)?Object.keys(n).reduce((e,i)=>{const r=n[i];return e[i]=e8(r,t),e},{}):n.map(e=>e8(e,t)));let Jjt=-1;class AT extends us{constructor(t){super(),this.spec={},this.references=new Map,this.targets=[],this.transforms=[],this.view=t,this.uid=++Jjt}parse(t){return this.id(t.id),this.name(t.name),this.depend(t.dependency),this}depend(t){var e;if(!((e=this.spec)===null||e===void 0)&&e.dependency){const r=Q(this.spec.dependency).map(s=>yt(s)?this.view.getGrammarById(s):s);this.detach(r)}this.spec.dependency=t;const i=Q(t).map(r=>yt(r)?this.view.getGrammarById(r):r);return this.attach(i),this.commit(),this}addEventListener(t,e,i){let r=e;return i&&i.trap===!1||(r=e,r.raw=e),i&&i.target&&(r.target=i.target),this.on(t,r),this}removeEventListener(t,e){return e?this.off(t,e):this.off(t),this}emit(t,...e){var i,r;return(r=(i=this.view)===null||i===void 0?void 0:i.emit)===null||r===void 0||r.call(i,t,...e),super.emit(t,...e)}emitGrammarEvent(t,...e){return super.emit(t,...e)}evaluateTransform(t,e,i){if(!t||!t.length)return e;let r=e,s=0;const o=t.length;for(;s<o;){const a=t[s];this.emit(Lt.BEFORE_TRANSFORM,a.type),r=a.transform(a.isRawOptions?a.options:Zjt(a.options,i),r,i,this.view),s++,this.emit(Lt.AFTER_TRANSFORM,a.type)}return r}set(t){return!1}id(t){return arguments.length?(this.view.grammars.unrecord(this),this._id=t,this.view.grammars.record(this),this):this._id}name(t){return arguments.length?(this._name=t,this):this._name}attach(t,e=1){return Q(t).filter(i=>!D(i)).forEach(i=>{var r;D(t)||(i.targets.includes(this)||i.targets.push(this),this.references.set(i,((r=this.references.get(i))!==null&&r!==void 0?r:0)+e))}),this}detach(t,e=1){return Q(t).filter(i=>!D(i)).forEach(i=>{const r=this.references.get(i)-e;r>0?this.references.set(i,r-1):(this.references.delete(i),i.targets.includes(this)&&(i.targets=i.targets.filter(s=>s!==this)))}),this}detachAll(){this.references.forEach((t,e)=>{this.detach(e,t)})}link(t){this.grammarSource=t}run(){var t;const e=(t=this.grammarSource)===null||t===void 0?void 0:t.output(),i=this.parameters();return this.evaluate(e,i)}commit(){this.view.commit(this)}parameters(){const t={};return this.references.forEach((e,i)=>{L(i.id())&&(t[i.id()]=i.output())}),t}getSpec(){return this.spec}reuse(t){return this}clear(){this.spec=null,this.view=null}release(){this.clear()}setFunctionSpec(t,e){return D(this.spec[e])||this.detach(vr(this.spec[e],this.view)),this.spec[e]=t,this.attach(vr(t,this.view)),this.commit(),this}}const i8=(n,t,e)=>{var i;if(n==="callback"&&it(t))return{references:[],value:{callback:t,dependency:[]}};if(!D(t.data)){const r=e.getDataById(t.data);return{references:[r],value:r}}if(!D(t.customized)){const r=e.getCustomizedById(t.customized);return{references:[r],value:r}}if(!D(t.scale)){const r=e.getScaleById(t.scale);return{references:[r],value:r}}if(Cjt(t)){const r=vr(t,e);return{references:r,value:t.callback?{value:t.callback,dependency:r}:(i=r==null?void 0:r[0])!==null&&i!==void 0?i:t}}return{value:t}},Qjt=(n,t,e)=>{if(D(t))return{value:t};if(V(t)){const i=t.map(r=>i8(n,r,e));return{references:i.reduce((r,s)=>(s.references&&r.concat(s.references),r),[]),value:i.map(r=>r.value)}}return i8(n,t,e)},t5t=(n,t)=>{const e=dt.getTransform(n.type);if(!e)return;const i={};let r=[];return Object.keys(n).forEach(s=>{var o;if(s==="type")return;const a=n[s];if(s==="dependency")return void((a==null?void 0:a.length)&&(r=r.concat(qet(a,t))));const l=Qjt(s,a,t);l&&(!((o=l.references)===null||o===void 0)&&o.length&&(r=r.concat(l.references)),i[s]=l.value)}),{markPhase:e.markPhase,transform:e.transform,canProgressive:e.canProgressive,type:e.type,options:i,references:r}},Jw=(n,t)=>{if(n!=null&&n.length){const e=[];let i=[];return n.forEach(r=>{var s;const o=t5t(r,t);o&&(!((s=o.references)===null||s===void 0)&&s.length&&(i=i.concat(o.references)),e.push(o))}),{transforms:e,refs:i}}return null},e5t=(n,t={},e)=>{if(!yt(n))return Q(n);try{return Q(JSON.parse(n))}catch{return[]}},n8={csv:EJ,dsv:PJ,tsv:LJ,json:e5t},i5t=(n,t)=>{if(!t||!n8[t.type])return Q(n);const e=t.type==="dsv"?{delimiter:t.delimiter}:{};return n8[t.type](n,e,new Ve(new Bd))};class n5t extends AT{constructor(t,e,i){super(t),this.grammarType="data",this.spec={},this._dataIDKey=`VGRAMMAR_DATA_ID_KEY_${this.uid}`,this._loadTasks=[],this._postFilters=[],this.ingest=r=>{const s=yjt(r.format,this.parameters());return this._input=i5t(r.values,s),this._input},this.load=r=>{if(r.values)return this.ingest(r)},this.relay=r=>r[0],this._loadTasks=[],D(e)||this.values(e,i)}parse(t){return super.parse(t),this._isLoaded=!1,this.source(t.source,t.format,!1),this.url(t.url,t.format,!1),this.values(t.values,t.format,!1),this.transform(t.transform),this.parseLoad(t),this.commit(),this}parseDataSource(t){const e=[],i=[],r=t.format?vr(t.format,this.view)[0]:null;if(r&&e.push(r),t.values){const s=vr(t.values,this.view)[0];s&&e.push(s),i.push({type:"ingest",transform:this.ingest,isRawOptions:!0,options:{values:t.values,format:t.format}})}else if(t.url){const s=vr(t.url,this.view)[0];s&&e.push(s),i.push({type:"load",transform:this.load,options:{url:s??t.url,format:r??t.format}})}else if(t.source){const s=[];Q(t.source).forEach(o=>{const a=Tb(o)?o:this.view.getDataById(o);a&&(e.push(a),s.push(a))}),s.length&&(i.push({type:"relay",transform:this.relay,options:s}),this.grammarSource=s[0])}return{transforms:i,refs:e}}evaluate(t,e){this.view.emit(Lt.BEFORE_EVALUATE_DATA);const i=this._isLoaded?this.transforms:this._loadTasks.concat(this.transforms);this.grammarSource&&(this._input=t);const r=this.evaluateTransform(i,this._input,e),s=this._evaluateFilter(r,e);return this.setValues(s),this._isLoaded=!0,this.view.emit(Lt.AFTER_EVALUATE_DATA),this}output(){return this._values}getDataIDKey(){return this._dataIDKey}values(t,e,i=!0){const r=Object.assign({},this.spec,{values:t,format:e});return D(t)||(r.url=void 0,r.source=void 0),i?this.parseLoad(r):this}url(t,e,i=!0){const r=Object.assign({},this.spec,{url:t,format:e});return D(t)||(r.values=void 0,r.source=void 0),i?this.parseLoad(r):this}source(t,e,i=!0){const r=Object.assign({},this.spec,{source:t,format:e});return D(t)||(r.values=void 0,r.url=void 0),i?this.parseLoad(r):this}parseLoad(t){this.detach(this.parseDataSource(this.spec).refs),this.spec=t;const e=this.parseDataSource(this.spec);return this.attach(e.refs),this._loadTasks=e.transforms,this._isLoaded=!1,this.commit(),this}setValues(t){this._values=Q(t).map((e,i)=>{const r=e===Object(e)?e:{data:e};return r[this._dataIDKey]=i,r})}field(t){return this._values.map(e=>e[t])}transform(t){const e=Jw(this.spec.transform,this.view);e&&(this.detach(e.refs),this.transforms=[]),this.spec.transform=t;const i=Jw(this.spec.transform,this.view);return i&&(this.attach(i.refs),this.transforms=i.transforms),this.commit(),this}getValue(){return this._values}getInput(){return this._input}addDataFilter(t){return this._postFilters=this._postFilters.concat(Q(t)),this._postFilters.sort((e,i)=>{var r,s;return((r=e.rank)!==null&&r!==void 0?r:0)-((s=i.rank)!==null&&s!==void 0?s:0)}),this}removeDataFilter(t){const e=Q(t);return this._postFilters=this._postFilters.filter(i=>!e.includes(i)),this}_evaluateFilter(t,e){return this._postFilters.reduce((i,r)=>r.filter(i,e),t)}reuse(t){return t.grammarType!==this.grammarType||(this._isLoaded=!1,this._values=t.output()),this}clear(){super.clear(),this._input=null,this._values=null}}function WC(n,t,e,i){let r,s;const o=n[t];for(;t>e&&(s=Math.floor((t-1)/2),r=n[s],o&&r&&i(o,r)<0);)n[t]=r,t=s;return n[t]=o}function KB(n,t,e,i){const r=t,s=n.length,o=n[t];let a,l=2*t+1;for(;l<s;)a=l+1,a<s&&i(n[l],n[a])>=0&&(l=a),n[t]=n[l],l=2*(t=l)+1;return n[t]=o,WC(n,t,r,i)}class r5t{constructor(t){this.compare=t,this.nodes=[]}size(){return this.nodes.length}last(){return this.nodes[0]}validate(){for(let t=this.nodes.length-1;t>0;t-=1){const e=Math.floor((t-1)/2);if(this.compare(this.nodes[e],this.nodes[t])>0)return!1}return!0}push(t){if(this.nodes.includes(t)){const e=this.nodes.indexOf(t);return WC(this.nodes,e,0,this.compare),KB(this.nodes,e,null,this.compare)}return this.nodes.push(t),WC(this.nodes,this.nodes.length-1,0,this.compare)}remove(t){if(this.nodes.includes(t)){const e=this.nodes.indexOf(t);this.nodes=this.nodes.slice(0,e).concat(this.nodes.slice(e+1)),WC(this.nodes,e,0,this.compare),KB(this.nodes,e,null,this.compare)}}pop(){const t=this.nodes.pop();let e;return this.nodes.length?(e=this.nodes[0],this.nodes[0]=t,KB(this.nodes,0,null,this.compare)):e=t,e}clear(){this.nodes=[]}}class r8{constructor(t){this.list=[],this.ids={},this.idFunc=t||uIt}add(t){const e=this.idFunc(t);return this.ids[e]||(this.ids[e]=1,this.list.push(t)),this}remove(t){const e=this.idFunc(t);return this.ids[e]&&(this.ids[e]=0,this.list=this.list.filter(i=>i!==t)),this}forEach(t,e){e?this.list.slice().reverse().forEach(t):this.list.forEach(t)}filter(t){return this.list.filter(t)}get length(){return this.list.length}getElementByIndex(t){return this.list[t]}}class s5t{constructor(){this.grammars=[],this.logger=ge.getInstance(),this._curRank=0,this._committed=new r8(t=>t.uid),this._heap=new r5t((t,e)=>(t==null?void 0:t.qrank)-(e==null?void 0:e.qrank)),this._beforeRunner=null,this._afterRunner=null,this._updateCounter=0,this._finishFirstRender=!1}add(t){if(t)return this._setRankOfGrammar(t),this.commit(t),!this.grammars.includes(t)&&(this.grammars.push(t),!0)}remove(t){t&&(this._committed.remove(t),this._heap.remove(t),this.grammars=this.grammars.filter(e=>e!==t))}_setRankOfGrammar(t){t&&(t.rank=++this._curRank)}_reRank(t){const e=[t];for(;e.length;){const i=e.pop();this._setRankOfGrammar(i);const r=i.targets;r&&r.forEach(s=>{e.push(s),s===t&&this.logger.error("Cycle detected in dataflow graph.")})}}_enqueue(t){t&&(t.qrank=t.rank,this._heap.push(t))}_logGrammarRunInfo(t){if(this.logger.canLogError()){const e=[{key:"id",value:t.id()},{key:"name",value:t.name()}].reduce((i,r,s)=>D(r.value)?i:`${i}${s?" , ":""}${r.key}: ${r.value}`,"");this.logger.debug("Run Operator: ",t,e)}}hasCommitted(){return!!this._committed.length}commit(t){return this._committed.add(t),this}_beforeEvaluate(){this.grammars.forEach(t=>{t.targets.some(e=>(e==null?void 0:e.rank)<(t==null?void 0:t.rank))&&this._reRank(t)}),this._committed.forEach(t=>this._enqueue(t)),this._committed=new r8(t=>t.uid)}_enqueueTargets(t){t.targets&&t.targets.length&&this._finishFirstRender&&t.targets.forEach(e=>this._enqueue(e))}evaluate(){if(this._beforeRunner&&this._beforeRunner(this),!this._committed.length)return this.logger.info("Dataflow invoked, but nothing to do."),!1;this._updateCounter+=1;let t,e,i=0;for(this.logger.canLogInfo()&&(e=Date.now(),this.logger.debug(`-- START PROPAGATION (${this._updateCounter}) -----`)),this._beforeEvaluate();this._heap.size()>0;)t=this._heap.pop(),t&&(t.rank===t.qrank?(t.run(),this._logGrammarRunInfo(t),this._enqueueTargets(t),i+=1):this._enqueue(t));return this.logger.canLogInfo()&&(e=Date.now()-e,this.logger.info(`> ${i} grammars updated; ${e} ms`)),this._afterRunner&&this._afterRunner(this),this._finishFirstRender=!0,!0}runBefore(t){this._beforeRunner=t}runAfter(t){this._afterRunner=t}release(){this._heap&&(this._heap.clear(),this._heap=null),this.logger=null,this._committed=null}}const qB=(n,t,e,i,r)=>{const s=o=>{if(r||!o||i&&!i(o)||e.call(null,o),o.markType===Tt.group){const a=o[t];a&&a.forEach(l=>{s(l)})}r&&(!o||i&&!i(o)||e.call(null,o))};s(n)};class o5t{constructor(t){this.handleAfterNextRender=()=>{this._stage&&!this._viewOptions.disableDirtyBounds&&this._stage.enableDirtyBounds(),this._view.emit(Lt.AFTER_VRENDER_DRAW),this._view.emit(Lt.AFTER_VRENDER_NEXT_RENDER)},this._view=t}initialize(t,e,i,r){return this._width=t,this._height=e,this._viewOptions=i,this._eventConfig=r,this.initStage(),this}stage(){var t;return(t=this._stage)!==null&&t!==void 0?t:null}gestureController(){var t;return(t=this._gestureController)!==null&&t!==void 0?t:null}canvas(){return this._stage?this._stage.window.getNativeHandler().nativeCanvas:null}context(){return this._stage?this._stage.window.getContext().nativeContext:null}combineIncrementalLayers(){return this._stage&&CPt(this._stage).then(()=>{this._stage&&this._stage.defaultLayer.combineSubLayer()}),this}background(t){if(this._stage)return this._stage.background=t,this}setDpr(t,e){var i,r;return(r=(i=this._stage)===null||i===void 0?void 0:i.setDpr)===null||r===void 0||r.call(i,t),e&&this.renderNextFrame(),this}shouldResize(t,e){return t!==this._width||e!==this._height}resize(t,e){return this._view.emit(Lt.BEFORE_STAGE_RESIZE),this.shouldResize(t,e)&&(this._width=t,this._height=e,this._stage&&this._stage.resize(t,e)),this._view.emit(Lt.AFTER_STAGE_RESIZE),this}setViewBox(t,e=!0){return this._stage?(!t||this._viewBox&&t.x1===this._viewBox.x1&&t.x2===this._viewBox.x2&&t.y1===this._viewBox.y1&&t.y2===this._viewBox.y2||(this._viewBox=t,this._stage.setViewBox(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1,e)),this):this}render(t=!1){return this._view.emit(Lt.BEFORE_VRENDER_DRAW),this.initStage(),this._stage.disableDirtyBounds(),this._stage.afterNextRender(this.handleAfterNextRender),t&&(this._stage.render(),this._view.emit(Lt.AFTER_VRENDER_DRAW)),this}renderNextFrame(){return this.initStage(),this._stage.renderNextFrame(),this}toCanvas(){return this._stage?this._stage.toCanvas():null}preventRender(t){this._stage&&this._stage.preventRender(t)}release(){var t;this._view.traverseMarkTree(e=>{e.release()}),this._dragController&&this._dragController.release(),this._gestureController&&this._gestureController.release(),this._stage!==((t=this._viewOptions)===null||t===void 0?void 0:t.stage)&&this._stage.release(),this._stage=null,this._layer=null,this._dragController=null,this._gestureController=null}createStage(){var t,e,i,r,s;this._view.emit(Lt.BEFORE_CREATE_VRENDER_STAGE);const o=this._viewOptions,a=(t=o.stage)!==null&&t!==void 0?t:o2t({width:this._width,height:this._height,renderStyle:o.renderStyle,viewBox:o.viewBox,dpr:o.dpr,canvas:o.renderCanvas,canvasControled:o.canvasControled,container:o.container,title:o.rendererTitle,beforeRender:o.beforeRender,afterRender:o.afterRender,disableDirtyBounds:!0,autoRender:!0,pluginList:o.pluginList,enableHtmlAttribute:o.enableHtmlAttribute,optimize:o.optimize,ticker:o.ticker,supportsTouchEvents:o.supportsTouchEvents,supportsPointerEvents:o.supportsPointerEvents,event:{clickInterval:this._eventConfig.clickInterval,autoPreventDefault:!!this._eventConfig.autoPreventDefault},ReactDOM:o.ReactDOM,autoRefresh:o.autoRefresh});!((e=o.options3d)===null||e===void 0)&&e.enable&&a.set3dOptions(o.options3d),a.enableIncrementalAutoRender(),this._viewBox=o.viewBox,this._view.emit(Lt.AFTER_CREATE_VRENDER_STAGE),this._view.emit(Lt.BEFORE_CREATE_VRENDER_LAYER);const l=(i=o.layer)!==null&&i!==void 0?i:a.defaultLayer;if(this._view.emit(Lt.AFTER_CREATE_VRENDER_LAYER),!((r=this._eventConfig)===null||r===void 0)&&r.drag&&dt.getStageEventPlugin("drag")&&(this._dragController=new(dt.getStageEventPlugin("drag"))(a)),((s=this._eventConfig)===null||s===void 0?void 0:s.gesture)&&dt.getStageEventPlugin("gesture")){const h=kt(this._eventConfig.gesture)?this._eventConfig.gesture:{};this._gestureController=new(dt.getStageEventPlugin("gesture"))(a,h)}return{stage:a,layer:l}}initStage(){if(!this._stage){const{stage:t,layer:e}=this.createStage();this._stage=t,this._layer=e;const i=this._view.background();this.background(i)}}}const a5t="window",Qw="view",l5t="browser",ed="width",id="height",Fv="viewWidth",Hv="viewHeight",zo="padding",zF="viewBox",zv="autoFit",h5t="@",d5t="#";function eit(n,t,e,i){var r,s;let o=(r=t.target)===null||r===void 0?void 0:r[ud];if(!o&&i===Qw){let a=t.target;const l=(s=n.rootMark)===null||s===void 0?void 0:s.graphicItem;for(;a!=null&&a.parent&&a.parent!==l;)if(a=a.parent,a[ud]){o=a[ud];break}}return t.element=o,t}class u5t extends AT{constructor(){super(...arguments),this.grammarType="signal",this.spec={value:null,update:null}}parse(t){return super.parse(t),this.value(t.value),this.update(t.update),this.commit(),this}evaluate(t,e){return this._signal=this.spec.update?Mn(this.spec.update,e,this._signal):this.spec.value,this.spec.value=this._signal,this}output(){return this._signal}getValue(){return this.output()}set(t){if(V(t)&&V(this.value)&&t.length===this.value.length){for(let e=0;e<t.length;e++)if(this.value[e]!==t[e])return this._signal=t,this.spec.value=t,!0;return!1}return this._signal!==t&&(this._signal=t,this.spec.value=t,!0)}update(t){return D(t)||this.value(void 0),this.setFunctionSpec(t,"update")}value(t){return D(t)||this.update(void 0),this.spec.value=t,this.commit(),this}reuse(t){return t.grammarType!==this.grammarType||(this._signal=t.output()),this}clear(){super.clear(),this._signal=null}}let c5t=-1;const s8=[ed,id,zo,Fv,Hv,zF,zv],g5t=(n,t,e)=>{var i,r,s,o,a;return[{id:ed,value:(i=n[ed])!==null&&i!==void 0?i:0},{id,value:(r=n[id])!==null&&r!==void 0?r:0},{id:zo,value:ip((o=(s=n[zo])!==null&&s!==void 0?s:t[zo])!==null&&o!==void 0?o:e==null?void 0:e.padding)},{id:Fv,update:{callback:(l,h)=>{const d=ip(h[zo]);return h[ed]-d.left-d.right},dependency:[ed,zo]}},{id:Hv,update:{callback:(l,h)=>{const d=ip(h[zo]);return h[id]-d.top-d.bottom},dependency:[id,zo]}},{id:zF,update:{callback:(l,h)=>{const d=ip(h[zo]);return(l||new Bi).setValue(d.left,d.top,d.left+h[Fv],d.top+h[Hv])},dependency:[Fv,Hv,zo]}},{id:zv,value:(a=n[zv])!==null&&a!==void 0?a:t[zv]}]},ip=n=>{var t,e,i,r;return J(n)?{top:n,bottom:n,left:n,right:n}:{top:(t=n==null?void 0:n.top)!==null&&t!==void 0?t:0,bottom:(e=n==null?void 0:n.bottom)!==null&&e!==void 0?e:0,left:(i=n==null?void 0:n.left)!==null&&i!==void 0?i:0,right:(r=n==null?void 0:n.right)!==null&&r!==void 0?r:0}},p5t=n=>{var t;const e=(i,r)=>{var s,o;i.group=r;const a=(s=i.id)!==null&&s!==void 0?s:"VGRAMMAR_MARK_"+ ++c5t;i.id=a,((o=i.marks)!==null&&o!==void 0?o:[]).forEach(l=>e(l,a))};return((t=n.marks)!==null&&t!==void 0?t:[]).forEach(i=>e(i,"root")),n},f5t=n=>{var t,e,i,r,s;const{reuse:o=cjt,morph:a=gjt,morphAll:l=pjt,animation:h={},enableExitAnimation:d=mjt}=n??{};return{reuse:o,morph:a,morphAll:l,animation:{easing:(t=h.easing)!==null&&t!==void 0?t:EI,delay:(e=h.delay)!==null&&e!==void 0?e:BI,duration:(i=h.duration)!==null&&i!==void 0?i:Ket,oneByOne:(r=h.oneByOne)!==null&&r!==void 0?r:PI,splitPath:(s=h.splitPath)!==null&&s!==void 0?s:fjt},enableExitAnimation:d}};function m5t(n){n.mode&&le.setEnv(n.mode,n.modeParams||{})}function nd(n,t,e){const i=new Map;if(!n||n.length===0)return{keys:[],data:i};if(!t)return i.set(Jr,e?n.slice().sort(e):n.slice()),{keys:ujt,data:i};const r=Ov(t);if(n.length===1){const o=r(n[0]);return i.set(o,[n[0]]),{keys:[o],data:i}}const s=new Set;return n.forEach(o=>{var a;const l=r(o),h=(a=i.get(l))!==null&&a!==void 0?a:[];h.push(o),i.set(l,h),s.add(l)}),e&&s.forEach(o=>{i.get(o).sort(e)}),{keys:Array.from(s),data:i}}class iit{constructor(t,e,i){this.prevData=t!=null&&t.length?nd(t,e??null,i):null}setCurrentData(t){this.currentData=t}getCurrentData(){return this.currentData}doDiff(){if(this.callback)if(this.currentData&&this.prevData){const t=new Map(this.prevData.data);this.currentData.keys.forEach(e=>{this.callback(e,this.currentData.data.get(e),t.get(e)),t.delete(e)}),this.prevData.keys.forEach(e=>{t.has(e)&&this.callback(e,null,t.get(e))})}else this.currentData?this.currentData.keys.forEach(t=>{this.callback(t,this.currentData.data.get(t),null)}):this.prevData&&this.prevData.keys.forEach(t=>{this.callback(t,null,this.prevData.data.get(t))})}setCallback(t){this.callback=t}updateToCurrent(){this.prevData=this.currentData,this.currentData=null}reset(){this.prevData=null}}function v5t(n,t,e){const i={enter:[],exit:[],update:[]},r=new iit(n,e);return r.setCallback((s,o,a)=>{D(o)?i.exit.push({prev:a[0]}):D(a)?i.enter.push({next:o[0]}):i.update.push({next:o[0],prev:a[0]})}),r.setCurrentData(nd(t,e)),r.doDiff(),i}class Zc extends AT{constructor(t,e,i){super(t),this.grammarType="mark",this.elements=[],this.elementMap=new Map,this.isUpdated=!0,this._isReentered=!1,this.differ=new iit([]),this.markType=e,this.spec.type=e,this.spec.encode={update:{}},this.spec.group=i,i&&(this.group=i,this.attach(i),i.appendChild(this))}parse(t){var e,i,r;if(super.parse(t),this.spec.group){const o=yt(this.spec.group)?this.view.getMarkById(this.spec.group):this.spec.group;this.detach(o)}const s=yt(t.group)?this.view.getMarkById(t.group):t.group;return this.attach(s),this.join((e=t.from)===null||e===void 0?void 0:e.data,t.key,t.sort,t.groupBy,t.groupSort),this.coordinate(t.coordinate),this.state(t.state,this.spec.stateSort),Object.keys((i=this.spec.encode)!==null&&i!==void 0?i:{}).forEach(o=>{this.encodeState(o,{},!0)}),Object.keys((r=t.encode)!==null&&r!==void 0?r:{}).forEach(o=>{this.encodeState(o,t.encode[o])}),this.animation(t.animation),this.animationState(t.animationState),this.morph(t.morph,t.morphKey,t.morphElementKey),this.layout(t.layout),this.configure(t),this.transform(t.transform),this.parseAddition(t),this.spec=t,this.markType=t.type,this.commit(),this}parameters(){var t;return(t=this._finalParameters)!==null&&t!==void 0?t:super.parameters()}parseAddition(t){return this}reuse(t){var e;if(t.grammarType!==this.grammarType)return this;const i=t;return this.markType=i.markType,this.coord=i.coord,this.elementMap=i.elementMap,this.elements=i.elements,this.elementMap.forEach(r=>r.mark=this),this.differ=i.differ,(e=this.reuseAnimate)===null||e===void 0||e.call(this,i),this._context=i._context,this.graphicItem=i.graphicItem,this.graphicIndex=i.graphicIndex,this.graphicParent=i.graphicParent,this.needClear=i.needClear,this.isUpdated=i.isUpdated,this}needLayout(){return!D(this.spec.layout)}handleLayoutEnd(){}handleRenderEnd(){this.needClear&&(this.cleanExitElements(),this.elementMap.forEach(t=>{t.diffState===Ke.exit?t.clearGraphicAttributes():t.clearChangedGraphicAttributes()}),this.differ.updateToCurrent(),this.needClear=!1)}evaluateMainTasks(t,e){var i,r;if(this.needSkipBeforeLayout()&&this.view.getLayoutState()===Pl.before)return this;const s=(i=this.view.renderer)===null||i===void 0?void 0:i.stage();this.init(s,e);const o=this.evaluateTransform(this._getTransformsBeforeJoin(),t??zC,e),a=o==null?void 0:o.progressive;if(a?this.renderContext={large:!1}:(this.evaluateGroup(o),this.renderContext=this.parseRenderContext(o,e)),(r=this.renderContext)===null||r===void 0?void 0:r.progressive)this.differ.reset(),this.elementMap.clear(),this.evaluateProgressive();else{let l=null;if(a){if(this.renderContext.parameters=e,this.renderContext.beforeTransformProgressive=o.progressive,l=o.progressive.output(),o.progressive.canAnimate&&o.progressive.unfinished())return this.update(this.spec),this}else l=o;this.emit(Lt.BEFORE_MARK_JOIN),this.evaluateJoin(l),this.emit(Lt.AFTER_MARK_JOIN),this.emit(Lt.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,e),this.emit(Lt.AFTER_MARK_STATE),this.emit(Lt.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),e),this.emit(Lt.AFTER_MARK_ENCODE)}return this.update(this.spec),this}evaluateGroup(t){if(this.markType===Tt.group)return;const e=nd(t??zC,this.spec.groupBy,this.spec.groupSort);this._groupEncodeResult=null,this._groupedData=e}_getTransformsAfterEncodeItems(){return this.transforms&&this.transforms.filter(t=>t.markPhase==="afterEncodeItems")}_getTransformsAfterEncode(){return this.transforms&&this.transforms.filter(t=>D(t.markPhase)||t.markPhase==="afterEncode")}_getTransformsBeforeJoin(){return this.transforms?this.transforms.filter(t=>t.markPhase==="beforeJoin"):[]}evaluate(t,e){var i;return this.evaluateMainTasks(t,e),!((i=this.renderContext)===null||i===void 0)&&i.progressive||this.evaluateTransform(this._getTransformsAfterEncode(),this.elements,e),this}output(){return this}join(t,e,i,r,s){return this.grammarSource&&(this.detach(this.grammarSource),this.grammarSource=null),this.spec.from=null,D(t)||(yt(t)?this.grammarSource=this.view.getDataById(t):this.grammarSource=t,this.spec.from={data:t},this.attach(this.grammarSource)),this.spec.key=e,this.spec.sort=i,this.spec.groupBy=r,this.spec.groupSort=s,this.commit(),this}coordinate(t){return yt(t)?this.coord=this.view.getCoordinateById(t):this.coord=t,this.attach(this.coord),this.commit(),this}state(t,e){return this.spec.stateSort=e,this.setFunctionSpec(t,"state")}encode(t,e,i){return this.encodeState(Ke.update,t,e,i)}encodeState(t,e,i,r){if(t===Ke.enter&&(this._isReentered=!0),this.spec.encode[t]){const s=this.spec.encode[t];if(ju(s))this.detach(lu(s,this.view));else{const o=yt(e);o&&r||!o&&i?(Object.keys(s).forEach(a=>{this.detach(lu(s[a],this.view))}),this.spec.encode[t]={}):o?this.detach(lu(s[e],this.view)):Object.keys(e).forEach(a=>{this.detach(lu(s[a],this.view))})}}return e&&(this.spec.encode[t]||(this.spec.encode[t]={}),yt(e)?(this.spec.encode[t][e]=i,this.attach(lu(i,this.view))):ju(e)?(this.spec.encode[t]=e,this.attach(lu(e,this.view))):e&&(Object.assign(this.spec.encode[t],e),Object.values(e).forEach(s=>{this.attach(lu(s,this.view))}))),this.commit(),this}_getEncoders(){var t;return(t=this.spec.encode)!==null&&t!==void 0?t:{}}animation(t){return this.spec.animation=t,this}animationState(t){return this.setFunctionSpec(t,"animationState")}layout(t){return this.spec.layout=t,this.commit(),this}morph(t,e,i){return this.spec.morph=t,this.spec.morphKey=e,this.spec.morphElementKey=i,this}transform(t){const e=Jw(this.spec.transform,this.view);e&&(this.detach(e.refs),this.transforms=[]);const i=Jw(t,this.view);return i&&(this.attach(i.refs),this.transforms=i.transforms),this.spec.transform=t,this.commit(),this}configure(t){const e=["clip","clipPath","zIndex","interactive","context","setCustomizedShape","large","largeThreshold","progressiveStep","progressiveThreshold","support3d","morph","morphKey","morphElementKey","attributeTransforms","skipTheme","enableSegments","stateSort","graphicName","overflow"];return t===null?(e.forEach(i=>{D(this.spec[i])||(this.spec[i]=void 0)}),this):(e.forEach(i=>{D(t[i])||(this.spec[i]=t[i])}),this)}context(t){return this.spec.context=t,this._context=t,this}isCollectionMark(){return Xet.includes(this.markType)}needAnimate(){var t;return!(!((t=this.renderContext)===null||t===void 0)&&t.progressive)&&!D(this.spec.animation)}getAllElements(){const t=this.elements.slice();return this.elementMap.forEach(e=>{e.diffState!==Ke.exit||t.includes(e)||t.push(e)}),this.spec.sort&&t.sort((e,i)=>this.spec.sort(e.getDatum(),i.getDatum())),t}getScales(){const t={};return this.references.forEach((e,i)=>{i.grammarType===RI.scale&&(t[i.id()]=i.output())}),t}getScalesByChannel(){const t=this.spec.encode;if(!t)return{};const e={},i=this.parameters();return Object.keys(t).forEach(r=>{const s=t[r];s&&!ju(s)&&Object.keys(s).forEach(o=>{wT(s[o])&&(e[o]=S0(s[o].scale,i))})}),e}getFieldsByChannel(){const t=this.spec.encode;if(!t)return{};const e={};return Object.keys(t).forEach(i=>{const r=t[i];ju(r)||Object.keys(r).forEach(s=>{DF(r[s])&&(e[s]=r[s].field)})}),e}init(t,e){var i,r,s,o,a;if(this._delegateEvent||(this._delegateEvent=(d,u)=>{const c=eit(this.view,d,u,Qw),g=d.element;(g==null?void 0:g.mark)===this&&this.emitGrammarEvent(u,c,g)},this.initEvent()),(i=this.initAnimate)===null||i===void 0||i.call(this,this.spec),!this.group){const d=S0(this.spec.group,e);this.group=d,d&&d.appendChild(this)}const l=this.group?this.group.getGroupGraphicItem():t.defaultLayer,h=(o=(s=(r=this.group)===null||r===void 0?void 0:r.children)===null||s===void 0?void 0:s.indexOf(this))!==null&&o!==void 0?o:0;if(this.markType!==Tt.group){if(!this.graphicItem){const d=Dv(this,Tt.group,{pickable:!1,zIndex:(a=this.spec.zIndex)!==null&&a!==void 0?a:0,overflow:this.spec.overflow});(this.spec.support3d||djt.includes(this.markType))&&d.setMode("3d"),d.name=`${this.id()||this.markType}`,this.graphicItem=d}this.graphicParent=this.graphicItem,!l||this.graphicIndex===h&&this.graphicItem.parent===l||l.insertIntoKeepIdx(this.graphicItem,h)}else this.graphicParent=l,this.graphicParent.setAttributes({overflow:this.spec.overflow});this.graphicIndex=h}update(t){var e;if(this.emit(Lt.BEFORE_MARK_UPDATE),this._context=this.spec.context,this.isUpdated=!0,this.renderContext.progressive||(e=this.updateAnimate)===null||e===void 0||e.call(this,t),this.markType!==Tt.group){if(D(t.zIndex)||this.graphicItem.setAttribute("zIndex",t.zIndex),D(t.clip)||this.graphicItem.setAttribute("clip",t.clip),!D(t.clipPath)){const i=V(t.clipPath)?t.clipPath:t.clipPath(this.elements);i&&i.length?this.graphicItem.setAttribute("path",i):this.graphicItem.setAttributes({path:i,clip:!1})}D(t.overflow)||this.graphicItem.setAttribute("overflow",t.overflow),this.elementMap.forEach(i=>{i.updateGraphicItem()})}else this.elementMap.forEach(i=>{i.updateGraphicItem()});this.emit(Lt.AFTER_MARK_UPDATE)}createElement(){return new Jet(this)}evaluateJoin(t){var e,i,r,s;this.needClear=!0;const o=Ov((r=(e=this.spec.key)!==null&&e!==void 0?e:(i=this.grammarSource)===null||i===void 0?void 0:i.getDataIDKey())!==null&&r!==void 0?r:()=>Jr),a=Ov((s=this.spec.groupBy)!==null&&s!==void 0?s:()=>Jr),l=this.spec.sort,h=this.isCollectionMark(),d=new Set(this.elements.filter(g=>g.diffState===Ke.enter)),u=[];this.differ.setCallback((g,p,f)=>{var m;const v=g;let _;if(D(p))_=this.elementMap.get(v),_&&(_.diffState=Ke.exit);else if(D(f)){if(_=this.elementMap.has(v)?this.elementMap.get(v):this.createElement(),_.diffState===Ke.exit){_.diffState=Ke.enter;const y=(m=this.animate)===null||m===void 0?void 0:m.getElementAnimators(_,Ke.exit);y&&y.forEach(C=>C.stop("start"))}_.diffState=Ke.enter;const b=h?g:a(p[0]);_.updateData(b,p,o),this.elementMap.set(v,_),u.push(_)}else if(_=this.elementMap.get(v),_){_.diffState=Ke.update;const b=h?g:a(p[0]);_.updateData(b,p,o),u.push(_)}d.delete(_)});const c=t??zC;h?this.differ.setCurrentData(this._groupedData):this.differ.setCurrentData(nd(c,g=>`${a(g)}-${o(g)}`,void 0)),this.differ.doDiff(),d.forEach(g=>{this.elementMap.delete(h?g.groupKey:`${g.groupKey}-${g.key}`),g.remove(),g.release()}),this.elements=u,l&&this.elements.length>=2&&this.elements.sort((g,p)=>l(g.getDatum(),p.getDatum()))}evaluateState(t,e,i){e&&t.forEach(r=>{r.state(e,i)})}evaluateGroupEncode(t,e,i){if(!this._groupedData||!e)return;const r={};return this._groupedData.keys.forEach(s=>{const o=t.find(a=>a.groupKey===s);o&&(r[s]=cd(e,o.items&&o.items[0]&&o.items[0].datum,o,i))}),this._groupEncodeResult=r,r}getChannelsFromConfig(t){const e=this.spec;return D(e.interactive)?null:{pickable:e.interactive}}evaluateEncode(t,e,i,r){const s=this.getChannelsFromConfig();if(e){this.emit(Lt.BEFORE_ELEMENT_ENCODE,{encoders:e,parameters:i},this);const o=r?null:this.evaluateGroupEncode(t,e[td.group],i);t.forEach(a=>{this.markType===Tt.glyph&&this._groupEncodeResult?a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,s,this._groupEncodeResult[a.groupKey])}):o!=null&&o[a.groupKey]&&!this.isCollectionMark()?a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,s,o[a.groupKey])}):s&&a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,s)}),a.encodeItems(a.items,e,this._isReentered,i),this.isCollectionMark()&&(o!=null&&o[a.groupKey])&&L(o[a.groupKey].defined)&&(a.items.forEach(l=>{l.nextAttrs.defined=o[a.groupKey].defined}),delete o[a.groupKey].defined)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),t,i),t.forEach(a=>{a.encodeGraphic(this.isCollectionMark()?o==null?void 0:o[a.groupKey]:null)}),this.emit(Lt.AFTER_ELEMENT_ENCODE,{encoders:e,parameters:i},this)}else t.forEach(o=>{o.initGraphicItem(s)})}addGraphicItem(t,e,i){var r;const s=i??Dv(this,this.markType,t);if(s){if(!((r=this.renderContext)===null||r===void 0)&&r.progressive){let o;if(this._groupedData){const a=this._groupedData.keys.indexOf(e);a>=0&&(o=this.graphicParent.getChildAt(a))}else o=this.graphicParent.at(0);this.isCollectionMark()?(s.incremental=1,o.appendChild(s)):o.incrementalAppendChild(s)}else this.graphicParent.appendChild(s);return s}}parseRenderContext(t,e){const i=this.markType!==Tt.group&&this.spec.progressiveStep>0&&this.spec.progressiveThreshold>0&&this.spec.progressiveStep<this.spec.progressiveThreshold,r=this.spec.large&&this.spec.largeThreshold>0&&t.length>=this.spec.largeThreshold;if(i){const s=this._groupedData;return s&&s.keys&&s.keys.some(o=>s.data.get(o).length>this.spec.progressiveThreshold)?{large:r,parameters:e,progressive:{data:t,step:this.spec.progressiveStep,currentIndex:0,totalStep:s.keys.reduce((o,a)=>Math.max(Math.ceil(s.data.get(a).length/this.spec.progressiveStep),o),1),groupedData:s.data}}:{large:r}}return{large:r}}isProgressive(){return this.renderContext&&(!!this.renderContext.progressive||!!this.renderContext.beforeTransformProgressive)}canAnimateAfterProgressive(){return this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.canAnimate()}isDoingProgressive(){return this.renderContext&&(this.renderContext.progressive&&this.renderContext.progressive.currentIndex<this.renderContext.progressive.totalStep||this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.unfinished())}clearProgressive(){this.renderContext&&this.renderContext.progressive&&(this.elements=[],this.graphicParent.children.forEach(t=>{t.incrementalClearChild()}),this.graphicParent.removeAllChild()),this.renderContext&&this.renderContext.beforeTransformProgressive&&this.renderContext.beforeTransformProgressive.release(),this.renderContext=null}restartProgressive(){this.renderContext&&this.renderContext.progressive&&(this.renderContext.progressive.currentIndex=0)}evaluateJoinProgressive(){var t,e,i;const r=this.renderContext.progressive.currentIndex,s=Ov((i=(t=this.spec.key)!==null&&t!==void 0?t:(e=this.grammarSource)===null||e===void 0?void 0:e.getDataIDKey())!==null&&i!==void 0?i:()=>Jr),o=[];if(this.isCollectionMark())return this._groupedData.keys.forEach((l,h)=>{const d=this.renderContext.progressive.groupedData.get(l),u=this.renderContext.progressive.step,c=d.slice(r*u,(r+1)*u);if(r===0){const g=this.createElement();g.diffState=Ke.enter,g.updateData(l,c,s),o.push(g)}else{const g=this.elements[h];g.updateData(l,c,s),o.push(g)}}),o;const a={};return this._groupedData.keys.forEach(l=>{const h=this.renderContext.progressive.groupedData.get(l),d=this.renderContext.progressive.step,u=h.slice(r*d,(r+1)*d),c=[];u.forEach(g=>{const p=this.createElement();p.diffState=Ke.enter,p.updateData(l,[g],s),c.push(p),o.push(p)}),a[l]=c}),{groupElements:a,elements:o}}evaluateEncodeProgressive(t,e,i){const r=this.renderContext.progressive.currentIndex;if(r===0){if(this.evaluateEncode(t,e,i),r===0&&this._groupEncodeResult&&!this.isCollectionMark()&&this.markType!==Tt.glyph){const s=t[0],o=s.getGraphicItem(),a=o==null?void 0:o.parent;a&&this._groupEncodeResult[s.groupKey]&&a.setTheme({common:this._groupEncodeResult[s.groupKey]})}}else this.evaluateEncode(t,e,i,!0)}evaluateProgressive(){var t,e,i;if(!((t=this.renderContext)===null||t===void 0)&&t.beforeTransformProgressive){const l=this.renderContext.beforeTransformProgressive;l.progressiveRun();const h=l.output();if(l.canAnimate){if(l.unfinished())return;this.evaluateGroup(h)}return this.emit(Lt.BEFORE_MARK_JOIN),this.evaluateJoin(h),this.emit(Lt.AFTER_MARK_JOIN),this.emit(Lt.BEFORE_MARK_STATE),this.evaluateState(this.elements,this.spec.state,this.renderContext.parameters),this.emit(Lt.AFTER_MARK_STATE),this.emit(Lt.BEFORE_MARK_ENCODE),this.evaluateEncode(this.elements,this._getEncoders(),this.renderContext.parameters),void this.emit(Lt.AFTER_MARK_ENCODE)}if(!(!((e=this.renderContext)===null||e===void 0)&&e.progressive))return;const r=this.renderContext.parameters;this.emit(Lt.BEFORE_MARK_JOIN);const s=this.evaluateJoinProgressive(),o=Array.isArray(s)?s:s.elements;if(this.emit(Lt.AFTER_MARK_JOIN),this.renderContext.progressive.currentIndex===0?(this.graphicParent.removeAllChild(),this._groupedData.keys.forEach(l=>{const h=Dv(this,Tt.group,{pickable:!1,zIndex:this.spec.zIndex});h.incremental=this.renderContext.progressive.step,this.graphicParent.appendChild(h)}),this.elements=o):this.elements=this.elements.concat(o),this.emit(Lt.BEFORE_MARK_STATE),this.evaluateState(o,this.spec.state,r),this.emit(Lt.AFTER_MARK_STATE),this.emit(Lt.BEFORE_MARK_ENCODE),Array.isArray(s))this.evaluateEncodeProgressive(o,this._getEncoders(),r);else{const l=s.groupElements;Object.keys(l).forEach(h=>{this.evaluateEncodeProgressive(l[h],this._getEncoders(),r)})}this.emit(Lt.AFTER_MARK_ENCODE);const a=(i=this._getTransformsAfterEncode())===null||i===void 0?void 0:i.filter(l=>l.canProgressive===!0);a!=null&&a.length&&this.evaluateTransform(a,this.elements,r),this.renderContext.progressive.currentIndex+=1}isLargeMode(){return this.renderContext&&this.renderContext.large}cleanExitElements(){this.elementMap.forEach((t,e)=>{t.diffState!==Ke.exit||t.isReserved||(this.elementMap.delete(e),t.remove(),t.release())})}getGroupGraphicItem(){if(this.elements&&this.elements[0]&&this.elements[0].getGraphicItem)return this.elements[0].getGraphicItem()}getBounds(){var t;return this.graphicItem?this.graphicItem.AABBBounds:(t=this.getGroupGraphicItem())===null||t===void 0?void 0:t.AABBBounds}getMorphConfig(){var t;return{morph:(t=this.spec.morph)!==null&&t!==void 0&&t,morphKey:this.spec.morphKey,morphElementKey:this.spec.morphElementKey}}getAttributeTransforms(){var t;return(t=this.spec.attributeTransforms)!==null&&t!==void 0?t:kb[this.markType]}getContext(){return this._context}needSkipBeforeLayout(){var t,e;if(((t=this.spec.layout)===null||t===void 0?void 0:t.skipBeforeLayouted)===!0)return!0;let i=this.group;for(;i;){if(((e=i.getSpec().layout)===null||e===void 0?void 0:e.skipBeforeLayouted)===!0)return!0;i=i.group}return!1}initEvent(){if(this._delegateEvent){const t=this.view.renderer.stage();t&&t.on("*",this._delegateEvent)}}releaseEvent(){if(this._delegateEvent){const t=this.view.renderer.stage();t&&t.off("*",this._delegateEvent)}}clear(){var t;this.releaseEvent(),this.transforms=null,this.elementMap=null,this.elements=null,this.graphicItem=null,this.animate=null,(t=this.group)===null||t===void 0||t.removeChild(this),this.group=null,super.clear()}prepareRelease(){var t;this.differ.setCurrentData(null),(t=this.animate)===null||t===void 0||t.stop(),this.elementMap.forEach(e=>e.diffState=Ke.exit),this._finalParameters=this.parameters()}release(){this.releaseEvent(),this.elements.forEach(t=>t.release()),this.differ=null,this.elements=[],this.elementMap.clear(),this._finalParameters=null,this.animate&&this.animate.release(),this.graphicItem&&qw(this.graphicItem),this.detachAll(),super.release()}}let _5t=class extends Zc{constructor(t,e){super(t,Tt.group,e),this.children=[]}parseRenderContext(){return{large:!1}}appendChild(t){return this.children.push(t),this}removeChild(t){return this.children=this.children.filter(e=>e!==t),this}includesChild(t,e=!0){return!!this.children.includes(t)||!!e&&this.children.some(i=>i.markType===Tt.group&&i.includesChild(t,!0))}updateLayoutChildren(){return this.children.length?(this.layoutChildren||(this.layoutChildren=[]),this.layoutChildren=this.children.filter(t=>t.needLayout()),this):this}getAttributeTransforms(){return kb.rect}evaluateJoin(t){if(!this.elements.length){const e=this.createElement();e.updateData(Jr,zC,()=>""),this.elements=[e],this.elementMap.set(Jr,e)}}getChannelsFromConfig(t){const e=this.spec,i={};if(D(e.clip)||(i.clip=e.clip),D(e.zIndex)||(i.zIndex=e.zIndex),!D(e.clipPath)){const r=it(e.clipPath)?e.clipPath([t]):e.clipPath;r&&r.length?i.path=r:(i.path=null,i.clip=!1)}return D(e.interactive)||(i.pickable=e.interactive),i}evaluateGroupEncode(t,e,i){var r;const s=this.elements[0],o={},a=[Object.assign({},(r=s.items)===null||r===void 0?void 0:r[0],{nextAttrs:o})];return Bl(s,a,e,i),this._groupEncodeResult=o,o}evaluateEncode(t,e,i,r){const s=this.getChannelsFromConfig();if(e){this.emit(Lt.BEFORE_ELEMENT_ENCODE,{encoders:e,parameters:i},this);const o=r?null:this.evaluateGroupEncode(t,e[td.group],i);t.forEach(a=>{a.items.forEach(l=>{l.nextAttrs=Object.assign(l.nextAttrs,s,o)}),a.encodeItems(a.items,e,this._isReentered,i)}),this._isReentered=!1,this.evaluateTransform(this._getTransformsAfterEncodeItems(),t,i),t.forEach(a=>{a.encodeGraphic()}),this.emit(Lt.AFTER_ELEMENT_ENCODE,{encoders:e,parameters:i},this)}else t.forEach(o=>{o.initGraphicItem(s)})}addGraphicItem(t,e,i){const r=i??Dv(this,this.markType,t);if(r)return this.emit(Lt.BEFORE_ADD_VRENDER_MARK,{graphicItem:r}),r.name=`${this.id()||this.markType}`,this.graphicParent.insertIntoKeepIdx(r,this.graphicIndex),this.emit(Lt.AFTER_ADD_VRENDER_MARK,{graphicItem:r}),r}};class nit{constructor(t,e){this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}},this._size=0,this._mapKey=yt(t)?i=>i[t]:t,this._warning=e}record(t){var e,i;const r=t.grammarType,s=this._mapKey(t);return this._grammarMap[r]?(this._grammars[r].push(t),D(s)||(this._grammarMap[r][s]?(e=this._warning)===null||e===void 0||e.call(this,s,t):this._grammarMap[r][s]=t)):(this._grammars.customized.push(t),D(s)||(this._grammarMap.customized[s]?(i=this._warning)===null||i===void 0||i.call(this,s,t):this._grammarMap.customized[s]=t)),this._size+=1,this}unrecord(t){const e=t.grammarType,i=this._mapKey(t);return this._grammarMap[e]?(this._grammars[e]=this._grammars[e].filter(r=>r!==t),D(i)||this._grammarMap[e][i]!==t||delete this._grammarMap[e][i]):(this._grammars.customized=this._grammars.customized.filter(r=>r!==t),D(i)||this._grammarMap.customized[i]!==t||delete this._grammarMap.customized[i]),this._size-=1,this}size(){return this._size}getSignal(t){var e;return(e=this._grammarMap.signal[t])!==null&&e!==void 0?e:null}getData(t){var e;return(e=this._grammarMap.data[t])!==null&&e!==void 0?e:null}getScale(t){var e;return(e=this._grammarMap.scale[t])!==null&&e!==void 0?e:null}getCoordinate(t){var e;return(e=this._grammarMap.coordinate[t])!==null&&e!==void 0?e:null}getMark(t){var e;return(e=this._grammarMap.mark[t])!==null&&e!==void 0?e:null}getCustomized(t){var e;return(e=this._grammarMap.customized[t])!==null&&e!==void 0?e:null}getGrammar(t){return this._grammarMap.data[t]?this._grammarMap.data[t]:this._grammarMap.signal[t]?this._grammarMap.signal[t]:this._grammarMap.scale[t]?this._grammarMap.scale[t]:this._grammarMap.coordinate[t]?this._grammarMap.coordinate[t]:this._grammarMap.mark[t]?this._grammarMap.mark[t]:this._grammarMap.customized[t]?this._grammarMap.customized[t]:null}getAllSignals(){return this._grammars.signal}getAllData(){return this._grammars.data}getAllScales(){return this._grammars.scale}getAllCoordinates(){return this._grammars.coordinate}getAllMarks(){return this._grammars.mark}getAllCustomized(){return this._grammars.customized}traverse(t){var e;Object.values((e=this._grammars)!==null&&e!==void 0?e:{}).forEach(i=>(i??[]).forEach(r=>{t.call(null,r)}))}find(t){let e=null;return this.traverse(i=>t.call(null,i)===!0&&(e=i,!0)),e}filter(t){const e=[];return this.traverse(i=>{t.call(null,i)===!0&&e.push(i)}),e}clear(){this._size=0,this._grammars={signal:[],data:[],scale:[],coordinate:[],mark:[],customized:[]},this._grammarMap={signal:{},data:{},scale:{},coordinate:{},mark:{},customized:{}}}release(){this._size=0,this._grammars=null,this._grammarMap=null}}class b5t extends nit{constructor(){super(...arguments),this._markNodes=[]}record(t){if(super.record(t),t.grammarType==="mark"){const e=t,i={mark:e,parent:null,children:[]};this._markNodes.forEach(r=>{const s=r.mark;s.markType===Tt.group&&s.includesChild(e,!1)?(r.children.push(i),i.parent=r):e.markType===Tt.group&&e.includesChild(s,!1)&&(i.children.push(r),r.parent=i)}),this._markNodes.push(i)}return this}unrecord(t){if(super.unrecord(t),t.grammarType==="mark"){const e=t,i=this._markNodes.find(r=>r.mark===e);this._markNodes.forEach(r=>{r.mark.markType===Tt.group&&r.children.includes(i)?(r.children=r.children.filter(s=>s!==i),i.parent=null):e.markType===Tt.group&&i.children.includes(r)&&(i.children=i.children.filter(s=>s!==r),r.parent=null)}),this._markNodes=this._markNodes.filter(r=>r!==i)}return this}getAllMarkNodes(){return this._markNodes}clear(){super.clear(),this._markNodes=[]}release(){super.release(),this._markNodes=null}}class rit extends Zc{addGraphicItem(t,e){const i=t&&t.limitAttrs,r=i&&(i.textType==="rich"||i.text&&i.text.type==="rich"),s=Dv(this,r?Tt.richtext:Tt.text,t);return super.addGraphicItem(t,e,s)}release(){super.release()}}rit.markType=Tt.text;const y5t={label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#89909d",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],start:{x:0,y:0},end:{x:100,y:0},x:0,y:0},C5t={title:{space:4,padding:[0,0,0,0],textStyle:{fontSize:12,fill:"#333333",fontWeight:"normal",fillOpacity:1},text:"theta"},label:{visible:!0,inside:!1,space:4,style:{fontSize:12,fill:"#6F6F6F",fontWeight:"normal",fillOpacity:1}},tick:{visible:!0,inside:!1,alignWithLabel:!0,length:4,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},subTick:{visible:!1,inside:!1,count:4,length:2,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},line:{visible:!0,style:{lineWidth:1,stroke:"#D9DDE4",strokeOpacity:1}},items:[],startAngle:0,endAngle:2*Math.PI,radius:100,innerRadius:0,center:{x:0,y:0},x:0,y:0},S5t={style:{stroke:"#f1f2f5"}},x5t={style:{stroke:"#f1f2f5"}},w5t={layout:"vertical",title:{align:"start",space:12,textStyle:{fontSize:12,fontWeight:"bold",fill:"#2C3542"}},item:{spaceCol:10,spaceRow:10,shape:{space:4,style:{size:10,cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",stroke:"#D8D8D8",fillOpacity:.5}}},label:{space:4,style:{fontSize:12,fill:"black",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8",fillOpacity:.5}}},value:{alignRight:!1,style:{fontSize:12,fill:"#ccc",cursor:"pointer"},state:{selectedHover:{opacity:.85},unSelected:{fill:"#D8D8D8"}}},background:{style:{cursor:"pointer"},state:{selectedHover:{fillOpacity:.7,fill:"gray"},unSelectedHover:{fillOpacity:.2,fill:"gray"}}},focus:!1,focusIconStyle:{size:10,fill:"#333",cursor:"pointer"},visible:!0,padding:{top:2,bottom:2,left:2,right:2}},autoPage:!0,pager:{space:12,handler:{style:{size:10},space:4}},hover:!0,select:!0,selectMode:"multiple",allowAllCanceled:!1,items:[{index:0,id:"",label:"",shape:{fill:"#6690F2",stroke:"#6690F2",symbolType:"circle"}}]},A5t={title:{visible:!1,text:""},colors:[],layout:"horizontal",railWidth:200,railHeight:8,railStyle:{cornerRadius:5}},M5t={title:{visible:!1,text:""},trackStyle:{fill:"#ccc"},layout:"horizontal",align:"bottom",railWidth:200,railHeight:6,min:0,max:1,value:[0,1]},T5t={start:{x:0,y:0},end:{x:0,y:0}},k5t={start:{x:0,y:0},end:{x:0,y:0},rectStyle:{width:10,height:10}},R5t={center:{x:0,y:0},radius:100,startAngle:0,endAngle:Math.PI/6},B5t={center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI},P5t={center:{x:0,y:0},radius:100,startAngle:0,endAngle:2*Math.PI,sides:6},E5t={layout:"horizontal",railWidth:200,railHeight:10,railStyle:{cornerRadius:5},range:{draggableTrack:!0},startText:{visible:!0,text:"",space:8},endText:{visible:!0,text:"",space:8},min:0,max:1,value:[0,1]},L5t={size:{width:400,height:400},dataLabels:[]},I5t={type:"line-data",data:[{text:""}],position:"top",overlap:{avoidBaseMark:!1,clampForce:!1},smartInvert:!1},O5t={type:"line",data:[{text:"",data:{}}],position:"start",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},D5t={type:"area",data:[{text:"",data:{}}],position:"end",overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},F5t={type:"rect",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},H5t={type:"symbol",data:[{text:"",fill:"#606773",data:{}}],position:"top",overlap:{avoidBaseMark:!0,size:{width:1e3,height:1e3},strategy:[{type:"position"}]},smartInvert:!1},z5t={type:"arc",data:[{text:"",fill:"#606773",data:{}}],width:800,height:600,position:"outside",zIndex:302},W5t={data:[{text:"",fill:"#606773",data:{}}],overlap:{avoidBaseMark:!1,clampForce:!1,size:{width:1e3,height:1e3}},smartInvert:!1},j5t={orient:"bottom",showDetail:"auto",brushSelect:!0,start:0,end:1,position:{x:0,y:0},size:{width:500,height:40},previewData:[]},N5t={},$5t={},V5t={},G5t={textStyle:{fill:"#21252c"},subtextStyle:{fill:"#606773"}},U5t={width:12,height:12,padding:[2,2],railStyle:{fill:"rgba(0, 0, 0, .1)"}},sit={axis:y5t,circleAxis:C5t,grid:S5t,circleGrid:x5t,discreteLegend:w5t,colorLegend:A5t,sizeLegend:M5t,lineCrosshair:T5t,rectCrosshair:k5t,sectorCrosshair:R5t,circleCrosshair:B5t,polygonCrosshair:P5t,slider:E5t,dataLabel:L5t,pointLabel:W5t,lineLabel:O5t,areaLabel:D5t,rectLabel:F5t,symbolLabel:H5t,arcLabel:z5t,lineDataLabel:I5t,datazoom:j5t,continuousPlayer:N5t,discretePlayer:$5t,tooltip:V5t,title:G5t,scrollbar:U5t},oit=5,ait={symbol:{shape:"circle",size:8},text:{fontSize:14,fill:"#000000"}},Kn=Object.assign({},sit);Kn.axis=Object.assign({},Kn.axis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),Kn.circleAxis=Object.assign({},Kn.circleAxis,{label:{style:{fill:"#bbbdc3"}},line:{style:{stroke:"#4b4f54"}},tick:{style:{stroke:"#4b4f54"}},subTick:{style:{stroke:"#4b4f54"}}}),Kn.grid=Object.assign({},Kn.grid,{style:{stroke:"#404349"}}),Kn.circleGrid=Object.assign({},Kn.circleGrid,{style:{stroke:"#404349"}}),Kn.rectLabel=Object.assign({},Kn.rectLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),Kn.lineLabel=Object.assign({},Kn.lineLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),Kn.symbolLabel=Object.assign({},Kn.symbolLabel,{data:[{text:"",fill:"#888c93",data:{}}]}),Kn.title=Object.assign({},Kn.title,{textStyle:{fill:"#fdfdfd"},subtextStyle:{fill:"#888c93"}});const Y5t={name:"dark",padding:oit,background:"#202226",palette:{default:["#5383F4","#7BCF8E","#FF9D2C","#FFDB26","#7568D9","#80D8FB","#1857A3","#CAB0E8","#FF8867","#B9E493","#2CB4A8","#B9E4E3"]},marks:ait,components:Kn},X5t={name:"default",padding:oit,palette:{default:["#6690F2","#70D6A3","#B4E6E2","#63B5FC","#FF8F62","#FFDC83","#BCC5FD","#A29BFE","#63C4C7","#F68484"]},marks:ait,components:sit};class bo{static registerTheme(t,e){t&&bo._themes.set(t,e)}static unregisterTheme(t){bo._themes.delete(t)}static getTheme(t){return bo._themes.get(t)}static getDefaultTheme(){return bo.getTheme("default")}}bo._themes=new Map,bo.registerTheme("default",X5t),bo.registerTheme("dark",Y5t);class WF extends Zc{constructor(t,e,i,r){super(t,Tt.component,i),this._componentDatum={[Jr]:0},this.componentType=e,this.spec.type="component",this.spec.componentType=e,this.mode=r,this._updateComponentEncoders()}configureComponent(t){return this.spec.componentConfig=t,this.commit(),this}addGraphicItem(t,e,i){const r=i??dt.createGraphicComponent(this.componentType,t,{mode:this.mode,skipDefault:this.spec.skipTheme});return r&&(this.emit(Lt.BEFORE_ADD_VRENDER_MARK,{graphicItem:r}),this.graphicParent.appendChild(r),this.emit(Lt.AFTER_ADD_VRENDER_MARK,{graphicItem:r})),r}join(t){return super.join(t,Jr)}encodeState(t,e,i){return super.encodeState(t,e,i),this._updateComponentEncoders(),this}parseRenderContext(){return{large:!1}}_prepareRejoin(){this._componentDatum[Jr]+=1}evaluateJoin(t){return this.spec.key=Jr,t?(t[Jr]=this._componentDatum[Jr],this._componentDatum=t):this._componentDatum={[Jr]:this._componentDatum[Jr]},super.evaluateJoin([this._componentDatum])}_updateComponentEncoders(){this._encoders=this.spec.encode}_getEncoders(){var t;return(t=this._encoders)!==null&&t!==void 0?t:{}}}const ZB=Symbol.for("key");class K5t{diffGrammar(t,e){return v5t(t,e,i=>{var r;return(r=i.id())!==null&&r!==void 0?r:Symbol()})}diffMark(t,e,i){const r={enter:[],exit:[],update:[]};let s=[],o=[];t.forEach(u=>{u.markType!==Tt.group&&(i.morph&&u.getMorphConfig().morph||i.morphAll||i.reuse)?s.push(u):r.exit.push({prev:[u]})}),e.forEach(u=>{u.markType!==Tt.group&&(i.morph&&u.getMorphConfig().morph||i.morphAll||i.reuse)?o.push(u):r.enter.push({next:[u]})});const a=this.diffUpdateByGroup(s,o,u=>u.getMorphConfig().morphKey,u=>u.getMorphConfig().morphKey);s=a.prev,o=a.next,r.update=r.update.concat(a.update);const l=this.diffUpdateByGroup(s,o,u=>u.id(),u=>u.id());s=l.prev,o=l.next,r.update=r.update.concat(l.update);const h=nd(s,u=>{var c,g;return(g=(c=u.group)===null||c===void 0?void 0:c.id)===null||g===void 0?void 0:g.call(c)}),d=nd(o,u=>{var c,g;return(g=(c=u.group)===null||c===void 0?void 0:c.id)===null||g===void 0?void 0:g.call(c)});return Object.keys(d).forEach(u=>{const c=h.data.get(u),g=d.data.get(u);if(c&&g){for(let p=0;p<Math.max(c.length,g.length);p+=1){const f=c[p],m=g[p];f&&m?r.update.push({prev:[f],next:[m]}):f?r.exit.push({prev:[f]}):m&&r.enter.push({next:[m]})}s=s.filter(p=>!c.includes(p)),o=o.filter(p=>!g.includes(p))}}),s.forEach(u=>r.exit.push({prev:[u]})),o.forEach(u=>r.enter.push({next:[u]})),r}diffUpdateByGroup(t,e,i,r){const s=nd(t,d=>{var u;return(u=i(d))!==null&&u!==void 0?u:ZB}),o=nd(e,d=>{var u;return(u=r(d))!==null&&u!==void 0?u:ZB});let a=t,l=e;const h=[];return o.keys.forEach(d=>{if(d!==ZB){const u=s.data.get(d),c=o.data.get(d);u&&c&&(h.push({prev:u,next:c}),a=a.filter(g=>!u.includes(g)),l=l.filter(g=>!c.includes(g)))}}),{prev:a,next:l,update:h}}}class Zd extends us{static useRegisters(t){t.forEach(e=>{e()})}constructor(t={},e={}){super(),this._observer=null,this._onResize=ah((...i)=>{const r=this._getContainerSize();r&&this.resize(r.width,r.height)},100),this.delegateEvent=(i,r)=>{const s=eit(this,i,r,Qw);this.emit(r,s,i.element)},this.handleProgressiveFrame=()=>{this._progressiveMarks.length&&this._progressiveMarks.forEach(i=>{i.isDoingProgressive()&&i.evaluateProgressive()}),this.doPreProgressive()},this._config=e,this._options=Object.assign({mode:l5t},t),this.initialize()}getGrammarById(t){return this.grammars.getGrammar(t)}getSignalById(t){return this.grammars.getSignal(t)}getDataById(t){return this.grammars.getData(t)}getScaleById(t){return this.grammars.getScale(t)}getCoordinateById(t){return this.grammars.getCoordinate(t)}getMarkById(t){return this.grammars.getMark(t)}getCustomizedById(t){return this.grammars.getCustomized(t)}getGrammarsByName(t){return this.grammars.filter(e=>e.name()===t)}getGrammarsByType(t){return this.grammars.filter(e=>e.grammarType===t)}getMarksByType(t){return this.grammars.getAllMarks().filter(e=>e.markType===t)}getMarksByName(t){return this.grammars.getAllMarks().filter(e=>e.name()===t)}getMarksBySelector(t){if(!t)return null;const e=Q(t),i=[];return e.forEach(r=>{if(Tb(r))return void i.push(r);if(r[0]===d5t){const o=this.getMarkById(r.slice(1));return void(o&&i.push(o))}const s=r[0]===h5t?this.getMarksByName(r.slice(1)):Rjt(r)?this.getMarksByType(r):null;s&&s.length&&s.forEach(o=>{i.push(o)})}),i}updateSignal(t,e){yt(t)&&(t=this.getSignalById(t)),t.set(e),this.commit(t)}signal(t,e){const i=new u5t(this);return arguments.length>=1&&i.value(t),arguments.length>=2&&i.update(e),this.grammars.record(i),this._dataflow.add(i),i}data(t){const e=new n5t(this,t);return this.grammars.record(e),this._dataflow.add(e),e}scale(t){const e=dt.createGrammar("scale",this,t);return e&&(this.grammars.record(e),this._dataflow.add(e)),e}coordinate(t){const e=dt.createGrammar("coordinate",this,t);return e&&(this.grammars.record(e),this._dataflow.add(e)),e}mark(t,e,i){const r=yt(e)?this.getMarkById(e):e;let s;switch(t){case Tt.group:s=new _5t(this,r);break;case Tt.glyph:const o=dt.getMark(Tt.glyph);o&&(s=new o(this,i==null?void 0:i.glyphType,r));break;case Tt.component:s=dt.hasComponent(i==null?void 0:i.componentType)?dt.createComponent(i==null?void 0:i.componentType,this,r,i==null?void 0:i.mode):new WF(this,i==null?void 0:i.componentType,r,i==null?void 0:i.mode);break;case Tt.text:s=new rit(this,t,r);break;default:s=dt.hasMark(t)?dt.createMark(t,this,r):new Zc(this,t,r)}return this.grammars.record(s),this._dataflow.add(s),s}group(t){return this.mark(Tt.group,t)}glyph(t,e){return this.mark(Tt.glyph,e,{glyphType:t})}component(t,e,i="2d"){return this.mark(Tt.component,e,{componentType:t,mode:i})}axis(t,e="2d"){return this.mark(Tt.component,t,{componentType:Ii.axis,mode:e})}grid(t,e="2d"){return this.mark(Tt.component,t,{componentType:Ii.grid,mode:e})}legend(t){return this.mark(Tt.component,t,{componentType:Ii.legend})}slider(t){return this.mark(Tt.component,t,{componentType:Ii.slider})}label(t){return this.mark(Tt.component,t,{componentType:Ii.label})}datazoom(t){return this.mark(Tt.component,t,{componentType:Ii.datazoom})}player(t){return this.mark(Tt.component,t,{componentType:Ii.player})}title(t){return this.mark(Tt.component,t,{componentType:Ii.title})}scrollbar(t){return this.mark(Tt.component,t,{componentType:Ii.scrollbar})}customized(t,e){const i=dt.createGrammar(t,this,e==null?void 0:e.type);if(i)return i.parse(e),this.grammars.record(i),this._dataflow.add(i),i}addGrammar(t){return this.grammars.find(e=>e.uid===t.uid)||(this.grammars.record(t),this._dataflow.add(t),t.parse(t.getSpec()),this._needBuildLayoutTree=!0),this}removeGrammar(t){const e=yt(t)?this.getGrammarById(t):t;return e&&this.grammars.find(i=>i.uid===e.uid)?(e.grammarType==="mark"&&e.prepareRelease(),this._cachedGrammars.record(e),this._dataflow.remove(e),this.grammars.unrecord(e),this._needBuildLayoutTree=!0,this):this}removeAllGrammars(){return this.grammars.traverse(t=>{t.grammarType==="signal"&&s8.includes(t.id())||t.grammarType==="mark"&&t.id()==="root"||this.removeGrammar(t)}),this}removeAllGraphicItems(){return this.traverseMarkTree(t=>{t.graphicItem&&(qw(t.graphicItem),t.elementMap.forEach(e=>{e.resetGraphicItem()}),t.graphicItem=null)}),this}parseSpec(t){var e,i,r,s,o,a,l,h;if(this.emit(Lt.BEFORE_PARSE_VIEW),this._spec=t,p5t(t),t.theme?this.theme(t.theme):this.theme(bo.getDefaultTheme()),t.width&&this.width(t.width),t.height&&this.height(t.height),this.padding((i=(e=t.padding)!==null&&e!==void 0?e:this._options.padding)!==null&&i!==void 0?i:this._theme.padding),!this.width()||!this.height()){const u=this._getContainerSize();u&&(this.updateSignal(ed,u.width),this.updateSignal(id,u.height))}!((r=t.signals)===null||r===void 0)&&r.length&&t.signals.forEach(u=>{this.signal().parse(u)}),!((s=t.data)===null||s===void 0)&&s.length&&t.data.forEach(u=>{this.data(null).parse(u)}),!((o=t.coordinates)===null||o===void 0)&&o.length&&t.coordinates.forEach(u=>{var c;(c=this.coordinate(u.type))===null||c===void 0||c.parse(u)}),!((a=t.scales)===null||a===void 0)&&a.length&&t.scales.forEach(u=>{var c;(c=this.scale(u.type))===null||c===void 0||c.parse(u)});const d=dt.getGrammars();return Object.keys(d).forEach(u=>{const{specKey:c}=d[u];t[c]&&t[c].length&&t[c].forEach(g=>{this.customized(u,g)})}),t.marks&&t.marks.length&&t.marks.forEach(u=>{this.parseMarkSpec(u)}),t.events&&t.events.length&&t.events.forEach(u=>{var c;(c=this.event)===null||c===void 0||c.call(this,u)}),t.interactions&&t.interactions.length&&t.interactions.forEach(u=>{this.interaction(u.type,u)}),t.animation===!1?(l=this.animate)===null||l===void 0||l.disable():(h=this.animate)===null||h===void 0||h.enable(),this.emit(Lt.AFTER_PARSE_VIEW),this._needBuildLayoutTree=!0,this._layoutState=Pl.before,this}updateSpec(t){return this.removeAllInteractions(),this.removeAllGrammars(),this.parseSpec(t)}parseBuiltIn(){g5t(this._options,this._config,this.getCurrentTheme()).forEach(t=>{const e=this.signal().parse(t);t.value&&e.set(t.value)}),this.parseMarkSpec({id:"root",type:"group",encode:{enter:{x:0,y:0},update:{width:{signal:"width"},height:{signal:"height"}}}}),this.rootMark=this.getMarkById("root")}parseMarkSpec(t){var e;const i=t.type===Tt.glyph?{glyphType:t.glyphType}:t.type===Tt.component?{componentType:t.componentType,mode:t.mode}:null;this.mark(t.type,t.group,i).parse(t),(e=t.marks)===null||e===void 0||e.forEach(r=>{this.parseMarkSpec(r)})}theme(t){var e,i,r,s,o,a;yt(t)?this._theme=(e=bo.getTheme(t))!==null&&e!==void 0?e:bo.getDefaultTheme():this._theme=t;const{background:l,padding:h}=(i=this._spec)!==null&&i!==void 0?i:{};return this._theme?(this.background((r=l??this._options.background)!==null&&r!==void 0?r:this._theme.background),this.padding((s=h??this._options.padding)!==null&&s!==void 0?s:this._theme.padding),(a=(o=this.renderer.stage())===null||o===void 0?void 0:o.setTheme)===null||a===void 0||a.call(o,Object.assign({},this._theme.marks))):(this.background(l??this._options.background),this.padding(h??this._options.padding)),this}getCurrentTheme(){return this._theme}setCurrentTheme(t,e=!0){return this.theme(t),this.grammars.getAllMarks().forEach(i=>{i.commit()}),e?(this.evaluate(),this.renderer.render(!0)):this._dataflow.evaluate(),this}background(t){return arguments.length?(this._background=t,this.renderer.background(t),t):this._background}width(t){const e=this.getSignalById(ed);return arguments.length?(this._options.width=t,this.updateSignal(e,t),t):e.output()}height(t){const e=this.getSignalById(id);return arguments.length?(this._options.height=t,this.updateSignal(e,t),t):e.output()}viewWidth(t){const e=this.getSignalById(Fv);if(arguments.length){const i=this.padding();return this.width(t+i.left+i.right),t}return e.output()}viewHeight(t){const e=this.getSignalById(Hv);if(arguments.length){const i=this.padding();return this.height(t+i.top+i.bottom),t}return e.output()}padding(t){const e=this.getSignalById(zo);if(arguments.length){const i=ip(t);return this.updateSignal(e,i),i}return ip(e.output())}autoFit(t){const e=this.getSignalById(zv);return arguments.length?(this.updateSignal(e,t),t):e.output()}getViewBox(){const t=this.getSignalById(zF);return t==null?void 0:t.output()}updateLayoutTag(){return this._layoutState=Pl.before,this}getLayoutState(){return this._layoutState}buildLayoutTree(){const t={},e=[];this.traverseMarkTree(i=>{t[i.id()]=!0,i.group&&t[i.group.id()]||e.push(i),i.markType===Tt.group&&i.updateLayoutChildren()},i=>i.needLayout()),this._layoutMarks=e}doLayout(){var t;const e=this._options.doLayout||dt.getDefaultLayout();e&&(!((t=this._layoutMarks)===null||t===void 0)&&t.length)&&(this.emit(Lt.BEFORE_DO_LAYOUT),e(this._layoutMarks,this._options,this),this.emit(Lt.AFTER_DO_LAYOUT))}handleLayoutEnd(){this.emit(Lt.BEFORE_MARK_LAYOUT_END),this._layoutMarks.forEach(t=>{qB(t,"layoutChildren",e=>{e.handleLayoutEnd()},e=>e!==t)}),this.emit(Lt.AFTER_MARK_LAYOUT_END)}handleRenderEnd(){this.emit(Lt.BEFORE_MARK_RENDER_END),qB(this.rootMark,"children",t=>{t.handleRenderEnd()}),this.emit(Lt.AFTER_MARK_RENDER_END)}commit(t){return this._dataflow.commit(t),this}run(t){return this.evaluate(t),this}doRender(t){this.emit(Lt.BEFORE_DO_RENDER),this.renderer&&(!this._progressiveMarks&&this.animate?this.animate.animate():this.traverseMarkTree(e=>{e.cleanExitElements()},null,!0),this.renderer.render(t),this.handleRenderEnd()),this.emit(Lt.AFTER_DO_RENDER)}evaluate(t){var e,i;const r=f5t(t),s=this._cachedGrammars.size()>0;s&&(this.reuseCachedGrammars(r),this.detachCachedGrammar());const o=this._resizeRenderer(),a=this._dataflow.hasCommitted();return s||a||this._layoutState||o?(this.clearProgressive(),this._dataflow.evaluate(),this._needBuildLayoutTree&&(this.buildLayoutTree(),this._needBuildLayoutTree=!1),this._layoutState&&(this._layoutState=Pl.layouting,this.doLayout(),this._dataflow.hasCommitted()&&(this._layoutState=Pl.reevaluate,this._dataflow.evaluate()),this._layoutState=Pl.after,!((e=this._layoutMarks)===null||e===void 0)&&e.length&&this.handleLayoutEnd()),this._layoutState=null,this.findProgressiveMarks(),this._resizeRenderer(),(i=this.morph)===null||i===void 0||i.call(this,r),this.releaseCachedGrammars(r),this.doRender(!0),this.doPreProgressive(),this):this}reuseCachedGrammars(t){if(t.reuse){const e=i=>{i.next.reuse(i.prev),i.prev.detachAll(),i.prev.clear(),this._cachedGrammars.unrecord(i.prev)};this._differ.diffGrammar(this._cachedGrammars.getAllSignals(),this.grammars.getAllSignals().filter(i=>!s8.includes(i.id()))).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllData(),this.grammars.getAllData()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllScales(),this.grammars.getAllScales()).update.forEach(e),this._differ.diffGrammar(this._cachedGrammars.getAllCoordinates(),this.grammars.getAllCoordinates()).update.forEach(e)}this._differ.diffMark(this._cachedGrammars.getAllMarks(),this.grammars.getAllMarks().filter(e=>e.id()!=="root"),t).update.forEach(e=>{var i;const r=e.prev.length===1&&e.next.length===1&&e.prev[0].markType===e.next[0].markType,s=e.prev.every(o=>o.getMorphConfig().morph)&&e.next.every(o=>o.getMorphConfig().morph);this.morph&&(t.morph&&s||t.morphAll)?(i=this.addMorphMarks)===null||i===void 0||i.call(this,{prev:e.prev,next:e.next}):r&&t.reuse&&(e.next[0].reuse(e.prev[0]),e.prev[0].detachAll(),e.prev[0].clear(),this._cachedGrammars.unrecord(e.prev[0]))})}detachCachedGrammar(){this._cachedGrammars.traverse(t=>{var e,i;if(t.detachAll(),t.grammarType==="mark"){const r=t;(i=(e=r.group)===null||e===void 0?void 0:e.removeChild)===null||i===void 0||i.call(e,r)}})}releaseCachedGrammars(t){this._cachedGrammars.traverse(r=>{r.grammarType!=="mark"&&r.release()});const e=this._cachedGrammars.getAllMarkNodes();e.forEach(r=>{var s;(s=r.mark.animate)===null||s===void 0||s.stop(),t.enableExitAnimation&&this.animate&&this.animate.animateAddition(r.mark)});const i=r=>{if(r.mark.view&&(!r.mark.animate||r.mark.animate.getAnimatorCount()===0)&&(!r.children||r.children.length===0)){r.mark.release();const s=r.parent;s&&(r.parent.children=r.parent.children.filter(o=>o!==r),r.parent=null,i(s))}};e.forEach(r=>{const s=r.mark;s.animate&&s.animate.getAnimatorCount()!==0?s.addEventListener("animationEnd",()=>{s.animate&&s.animate.getAnimatorCount()===0&&i(r)}):i(r)}),this._cachedGrammars.clear()}runAfter(t){return this._dataflow.runAfter(()=>{t.call(null,this)}),this}runBefore(t){return this._dataflow.runBefore(()=>{t.call(null,this)}),this}getImageBuffer(){var t,e;if(this._options.mode!=="node")return void this.logger.error(new TypeError("getImageBuffer() now only support node environment."));const i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t);return i?(i.render(),i.window.getImageBuffer()):(this.logger.error(new ReferenceError("render is not defined")),null)}traverseMarkTree(t,e,i){return qB(this.rootMark,"children",t,e,i),this}_bindResizeEvent(){var t,e,i,r,s,o;if(this.autoFit()){const a=(s=(r=(i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t))===null||i===void 0?void 0:i.window)===null||r===void 0?void 0:r.getContainer)===null||s===void 0?void 0:s.call(r);if(a){const l=window.ResizeObserver;this._observer=new l(this._onResize),(o=this._observer)===null||o===void 0||o.observe(a)}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this.autoFit()&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}_getContainerSize(){var t,e,i,r,s,o,a,l,h,d,u;const c=(s=(r=(i=(e=(t=this.renderer)===null||t===void 0?void 0:t.stage)===null||e===void 0?void 0:e.call(t))===null||i===void 0?void 0:i.window)===null||r===void 0?void 0:r.getContainer)===null||s===void 0?void 0:s.call(r);if(c){const{width:g,height:p}=AP(c);return{width:(l=(a=(o=this._spec)===null||o===void 0?void 0:o.width)!==null&&a!==void 0?a:this._options.width)!==null&&l!==void 0?l:g,height:(u=(d=(h=this._spec)===null||h===void 0?void 0:h.height)!==null&&d!==void 0?d:this._options.height)!==null&&u!==void 0?u:p}}return null}resize(t,e,i=!0){let r=!1;return t!==this.width()&&(r=!0,this.updateSignal(ed,t)),e!==this.height()&&(r=!0,this.updateSignal(id,e)),r&&(i?this.evaluate({morph:!1}):this._dataflow.evaluate()),this}_resizeRenderer(){const t=this.width(),e=this.height();return!!this.renderer.shouldResize(t,e)&&(this.renderer.resize(t,e),this.emit("resize",{},{width:t,height:e}),!0)}interaction(t,e){const i=dt.createInteraction(t,this,e);return i&&(i.bind(),this._boundInteractions||(this._boundInteractions=[]),this._boundInteractions.push(i)),i}removeInteraction(t,e){if(this._boundInteractions){const i=this._boundInteractions.filter(r=>{var s;return D(e)?yt(t)?r.type===t:t?r===t:void 0:((s=r.options)===null||s===void 0?void 0:s.id)===e});i.length&&i.forEach(r=>{r.unbind()})}return this}removeAllInteractions(){return this._boundInteractions&&(this._boundInteractions.forEach(t=>{t.unbind()}),this._boundInteractions=null),this}initializeEventConfig(t){const e=Object.assign({defaults:{}},t),i=(r,s)=>{s.forEach(o=>{V(r[o])&&(r[o]=r[o].reduce((a,l)=>(a[l]=!0,a),{}))})};return i(e.defaults,["prevent","allow"]),i(e,[Qw,a5t]),e}initEvent(){const t=this.renderer.stage();t&&t.on("*",this.delegateEvent)}releaseStageEvent(){const t=this.renderer.stage();t&&t.off("*",this.delegateEvent)}addEventListener(t,e,i){let r=e;return i&&i.trap===!1||(r=e,r.raw=e),i&&i.target&&(r.target=i.target),this.on(t,r),this}removeEventListener(t,e){return e?this.off(t,e):this.off(t),this}initializeRenderer(){const t=this._options.width,e=this._options.height;this.renderer=new o5t(this),this.renderer.initialize(t,e,this._options,this._eventConfig).background(this._background)}initialize(){var t,e;this.grammars=new nit(i=>i.id(),(i,r)=>this.logger.warn(`Grammar id '${i}' has been occupied`,r)),this._cachedGrammars=new b5t(i=>i.id()),this._options.logger&&ge.setInstance(this._options.logger),this.logger=ge.getInstance((t=this._options.logLevel)!==null&&t!==void 0?t:0),this._dataflow=new s5t,this.animate=(e=this.initAnimate)===null||e===void 0?void 0:e.call(this,this),this._differ=new K5t,this._options.hooks&&(Object.keys(this._options.hooks).forEach(i=>{this.on(i,this._options.hooks[i])}),this.hooks=this._options.hooks),this.container=null,this.renderer=null,this._eventListeners=[],this._eventConfig=this.initializeEventConfig(this._options.eventConfig),this._theme=this._options.disableTheme?null:bo.getDefaultTheme(),this.parseBuiltIn(),m5t(this._options),this.initializeRenderer(),this._eventConfig.disable||this.initEvent(),this._bindResizeEvent(),this._needBuildLayoutTree=!0,this._layoutState=Pl.before,this.theme(this._theme)}pauseProgressive(){return!1}resumeProgressive(){return!1}restartProgressive(){return!1}findProgressiveMarks(){const t=[];return this.traverseMarkTree(e=>{t.push(e)},e=>e.markType!==Tt.group&&e.isProgressive()),t.length?(this._progressiveMarks=t,this.renderer&&this.renderer.combineIncrementalLayers(),t):(this._progressiveMarks=null,null)}doPreProgressive(){if(this._progressiveMarks&&this._progressiveMarks.some(t=>t.isDoingProgressive())){const t=le.getRequestAnimationFrame();this._progressiveRafId=t(this.handleProgressiveFrame)}else this._progressiveMarks&&this.animate&&this._progressiveMarks.every(t=>t.canAnimateAfterProgressive())?this.animate.animate():this._progressiveMarks&&(this._progressiveMarks=null)}clearProgressive(){this._progressiveRafId&&le.getCancelAnimationFrame()(this._progressiveRafId),this._progressiveMarks&&this._progressiveMarks.length&&(this._progressiveMarks.forEach(t=>{t.clearProgressive()}),this._progressiveMarks=null)}release(){var t,e,i,r;this.removeAllInteractions(),this.releaseStageEvent(),this._unBindResizeEvent(),this.clearProgressive(),dt.unregisterRuntimeTransforms(),ge.setInstance(null),(t=this.animate)===null||t===void 0||t.stop(),this.grammars.release(),this._cachedGrammars.release(),this._dataflow.release(),this._dataflow=null,(i=(e=this.renderer)===null||e===void 0?void 0:e.release)===null||i===void 0||i.call(e),this.renderer=null,this._boundInteractions=null,this.removeAllListeners(),(r=this._eventListeners)===null||r===void 0||r.forEach(s=>{s.source.removeEventListener(s.type,s.handler)}),this._eventListeners=null}}const q5t=()=>{lr(),Gf(),dt.registerGraphic(Tt.arc,rF),azt()},Z5t=()=>{lr(),JDt(),dt.registerGraphic(Tt.arc3d,OQ)},J5t=()=>{lr(),eFt(),dt.registerGraphic(Tt.pyramid3d,FQ)},Q5t=()=>{lr(),stt(),dt.registerGraphic(Tt.area,IQ),Ztt(),cT()},tNt=()=>{lr(),Xi(),dt.registerGraphic(Tt.group,XD)},eNt=()=>{lr(),ott(),dt.registerGraphic(Tt.image,nF)},iNt=()=>{lr(),ph(),Ztt(),cT(),dt.registerGraphic(Tt.line,eF)},lit=()=>{lr(),_b(),dt.registerGraphic(Tt.path,LQ)},jF=()=>{lr(),fh(),nzt(),dt.registerGraphic(Tt.rect,mb)},nNt=()=>{lr(),iFt(),dt.registerGraphic(Tt.rect3d,BQ)},NF=()=>{lr(),ph(),dt.registerGraphic(Tt.rule,eF)},hit=()=>{lr(),Bo(),cT(),dt.registerGraphic(Tt.symbol,fb)},dit=()=>{lr(),al(),Xd(),dt.registerGraphic(Tt.text,uf)},rNt=()=>{lr(),iT(),dt.registerGraphic(Tt.polygon,DQ)},sNt=()=>{lr(),Xd(),dt.registerGraphic(Tt.richtext,EQ)},oNt=()=>{lr(),Bo(),cT(),dt.registerGraphic(Tt.cell,fb)},MT=()=>{lr(),tFt(),dt.registerGraphic(Tt.glyph,PQ)};class aNt extends Jet{constructor(t){super(t),this.getStateAttrs=(e,i)=>{var r,s,o,a;const l=!D((r=this.runtimeStatesEncoder)===null||r===void 0?void 0:r[e]),h=l?Object.assign(Object.assign({},(s=this.mark.getSpec().encode)===null||s===void 0?void 0:s[e]),this.runtimeStatesEncoder[e]):(o=this.mark.getSpec().encode)===null||o===void 0?void 0:o[e],d={};if(!h)return d;if(it(h))return d.attributes=h(this.getDatum(),this,e,i),d;if(!l&&(!((a=this.graphicItem.glyphStates)===null||a===void 0)&&a[e]))return this.graphicItem.glyphStates[e];if(h){const u=this.items[0],c=[Object.assign({},u,{nextAttrs:{}})];return Bl(this,c,h,this.mark.parameters()),this.coordinateTransformEncode(c),d.attributes=c[0].nextAttrs,this.graphicItem.glyphStates?this.graphicItem.glyphStates[e]||(this.graphicItem.glyphStates[e]=d):this.graphicItem.glyphStates={[e]:d},d}return d},this.glyphMeta=this.mark.getGlyphMeta()}getGlyphGraphicItems(){return this.glyphGraphicItems}initGraphicItem(t={}){if(this.graphicItem)return;this.graphicItem=this.mark.addGraphicItem(t,this.groupKey),this.graphicItem[ud]=this,this.graphicItem.onBeforeAttributeUpdate=this._onGlyphAttributeUpdate(!1);const e=this.glyphMeta.getMarks();this.glyphGraphicItems={},this.graphicItem.getSubGraphic().forEach(i=>{const r=e[i.name];this.glyphGraphicItems[i.name]=i,i.onBeforeAttributeUpdate=s=>this.mark?Zw(r,s,this,i.name):s}),this.clearGraphicAttributes()}useStates(t,e){if(!this.graphicItem)return!1;this.mark.emit(Lt.BEFORE_ELEMENT_STATE,{states:t},this),this.states=t.slice();const i=Re(e)?e:this.hasStateAnimation();return this.graphicItem.glyphStateProxy=this.getStateAttrs,this.graphicItem.useStates(this.states,i),this.mark.emit(Lt.AFTER_ELEMENT_STATE,{states:t},this),!0}encodeGraphic(){this.coordinateTransformEncode(this.items);const t=this.transformElementItems(this.items,this.mark.markType),e=!this.graphicItem;this.graphicItem?(this.graphicItem.clearStates(),this.graphicItem.states={},this.graphicItem.stateProxy=null):this.initGraphicItem(),this.diffState===Ke.enter||e?(this.graphicItem.onBeforeAttributeUpdate=this._onGlyphAttributeUpdate(!0),this.applyGraphicAttributes(t),this.graphicItem.onBeforeAttributeUpdate=this._onGlyphAttributeUpdate(!1)):this.applyGraphicAttributes(t),this.diffState!==Ke.enter&&this.diffState!==Ke.update||!this.states.length||(Object.values(this.glyphGraphicItems).forEach(i=>{i.states={}}),this.useStates(this.states)),this.items.map(i=>{i.nextAttrs={}})}encodeCustom(t){var e;let i={};const r=this.glyphMeta.getChannelEncoder(),s=this.glyphMeta.getFunctionEncoder();if(s&&(i=s.call(null,Object.assign({},(e=this.graphicItem)===null||e===void 0?void 0:e.attribute,t),this.getDatum(),this,this.mark.getGlyphConfig())),r){let o;Object.keys(r).forEach(a=>{var l;if(!D(t[a])){o||(o=Object.assign({},(l=this.graphicItem)===null||l===void 0?void 0:l.attribute,t));const h=r[a].call(null,a,t[a],o,this.getDatum(),this,this.mark.getGlyphConfig());Object.keys(h??{}).forEach(d=>{var u;i[d]=Object.assign((u=i[d])!==null&&u!==void 0?u:{},h[d])})}})}return i}encodeDefault(){const t={};if(this.glyphMeta.getDefaultEncoder()){const e=this.glyphMeta.getDefaultEncoder().call(null,this.getDatum(),this,this.mark.getGlyphConfig());Object.assign(t,e)}return t}_onGlyphAttributeUpdate(t=!1){return e=>{if(!this.mark)return e;const i=this.glyphMeta.getMarks(),r=Zw(this.mark.getAttributeTransforms(),e,this),s=t?this.encodeDefault():null,o=this.encodeCustom(e);return Object.keys(i).forEach(a=>{const l=i[a],h=this.glyphGraphicItems[a],d=o==null?void 0:o[a],u=Object.assign({},d);if(t){const f=s==null?void 0:s[a];Object.keys(f??{}).forEach(m=>{Qr(this.items[0].nextAttrs,m)||Qr(u,m)||(u[m]=f[m])})}const c=Object.assign({},Ejt(l,e),u),g=this._generateGlyphItems(l,this.items,c);this.coordinateTransformEncode(g);const p=this.transformElementItems(g,l);this.applyGlyphGraphicAttributes(p,a,h),l===Tt.shape&&(h.datum=g[0].datum)}),r}}_generateGlyphItems(t,e,i){const r=e.map(s=>Object.assign({},s,{nextAttrs:i}));return Xet.includes(t)&&this.mark.getSpec().enableSegments&&r.forEach((s,o)=>{s.nextAttrs=Object.assign({},e[o].nextAttrs,i)}),r}getGraphicAttribute(t,e=!1,i){if(!this.graphicItem)return;const r=this.getPrevGraphicAttributes(i);return e&&Qr(r,t)?r[t]:(i?this.glyphGraphicItems[i]:this.graphicItem).attribute[t]}setGraphicAttribute(t,e,i=!0,r){if(!this.graphicItem)return;const s=r?this.glyphGraphicItems[r]:this.graphicItem,o=this.getFinalGraphicAttributes(r),a=this.getPrevGraphicAttributes(r);i&&(o[t]=e),Qr(a,t)||(a[t]=s.attribute[t]),s.setAttribute(t,e)}setGraphicAttributes(t,e=!0,i){if(!this.graphicItem)return;const r=i?this.glyphGraphicItems[i]:this.graphicItem,s=this.getFinalGraphicAttributes(i),o=this.getPrevGraphicAttributes(i);Object.keys(t).forEach(a=>{e&&(s[a]=t[a]),Qr(o,a)||(o[a]=r.attribute[a])}),r.setAttributes(t)}diffAttributes(t,e){const i={},r=this.getFinalGraphicAttributes(e);for(const s in t)Qr(r,s)&&Oe(r[s],t[s])||(i[s]=t[s]);return i}applyGlyphGraphicAttributes(t,e,i){var r,s;if(this.mark.needAnimate()){const o=this.diffAttributes(t,e),a=(r=this.getPrevGraphicAttributes(e))!==null&&r!==void 0?r:{},l=(s=this.getFinalGraphicAttributes(e))!==null&&s!==void 0?s:{};Object.keys(o).forEach(h=>{a[h]=i.attribute[h],l[h]=o[h]}),this.setNextGraphicAttributes(o,e),this.setPrevGraphicAttributes(a,e),this.setFinalGraphicAttributes(l,e),i.setAttributes(o)}else i.setAttributes(t)}getFinalGraphicAttributes(t){return(t?this.glyphGraphicItems[t]:this.graphicItem).finalAttrs}setFinalGraphicAttributes(t,e){(e?this.glyphGraphicItems[e]:this.graphicItem).finalAttrs=t}getPrevGraphicAttributes(t){return(t?this.glyphGraphicItems[t]:this.graphicItem).prevAttrs}setPrevGraphicAttributes(t,e){(e?this.glyphGraphicItems[e]:this.graphicItem).prevAttrs=t}getNextGraphicAttributes(t){return(t?this.glyphGraphicItems[t]:this.graphicItem).nextAttrs}setNextGraphicAttributes(t,e){(e?this.glyphGraphicItems[e]:this.graphicItem).nextAttrs=t}clearChangedGraphicAttributes(){this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null),Object.keys(this.glyphGraphicItems).forEach(t=>{this.setPrevGraphicAttributes(null,t),this.setNextGraphicAttributes(null,t)})}clearGraphicAttributes(){this.setPrevGraphicAttributes(null),this.setNextGraphicAttributes(null),this.setFinalGraphicAttributes(null),Object.keys(this.glyphGraphicItems).forEach(t=>{this.setPrevGraphicAttributes(null,t),this.setNextGraphicAttributes(null,t),this.setFinalGraphicAttributes(null,t)})}remove(){this.glyphGraphicItems=null,super.remove()}release(){this.glyphGraphicItems&&(Object.values(this.glyphGraphicItems).forEach(t=>{t[ud]=null}),this.glyphGraphicItems=null),super.release()}}class uit extends Zc{constructor(t,e,i){super(t,Tt.glyph,i),this.glyphType=e,this.glyphMeta=dt.getGlyph(e)}configureGlyph(t){return this.spec.glyphConfig=t,this.commit(),this}getGlyphMeta(){return this.glyphMeta}getGlyphConfig(){return this.spec.glyphConfig}addGraphicItem(t,e){const i=Bjt(this,this.glyphMeta,t);return super.addGraphicItem(t,e,i)}createElement(){return new aNt(this)}}uit.markType=Tt.glyph;const TT=()=>{dt.registerMark(Tt.glyph,uit)},cit=n=>(t,e,i)=>{var r,s,o;const a=(o=(r=t.getGraphicAttribute("direction",!1))!==null&&r!==void 0?r:(s=t.mark.getGlyphConfig())===null||s===void 0?void 0:s.direction)!==null&&o!==void 0?o:"vertical",l=n(t,a,e);if(!et(l))return{};const h=t.getGraphicAttribute("x",!1),d=t.getGraphicAttribute("y",!1),u=t.getGraphicAttribute("min",!1),c=t.getGraphicAttribute("max",!1),g=t.getGraphicAttribute("q1",!1),p=t.getGraphicAttribute("q3",!1),f=t.getGraphicAttribute("median",!1),m={from:{x:h,y:d},to:{x:h,y:d}};return et(u)&&(m.from.min=l,m.to.min=u),et(c)&&(m.from.max=l,m.to.max=c),et(g)&&(m.from.q1=l,m.to.q1=g),et(p)&&(m.from.q3=l,m.to.q3=p),et(f)&&(m.from.median=l,m.to.median=f),m},git=n=>(t,e,i)=>{var r,s,o;const a=(o=(r=t.getGraphicAttribute("direction",!1))!==null&&r!==void 0?r:(s=t.mark.getGlyphConfig())===null||s===void 0?void 0:s.direction)!==null&&o!==void 0?o:"vertical",l=n(t,a,e);if(!et(l))return{};const h=t.getGraphicAttribute("x",!0),d=t.getGraphicAttribute("y",!0),u=t.getGraphicAttribute("min",!0),c=t.getGraphicAttribute("max",!0),g=t.getGraphicAttribute("q1",!0),p=t.getGraphicAttribute("q3",!0),f=t.getGraphicAttribute("median",!0),m={from:{x:h,y:d},to:{x:h,y:d}};return et(u)&&(m.to.min=l,m.from.min=u),et(c)&&(m.to.max=l,m.from.max=c),et(g)&&(m.to.q1=l,m.from.q1=g),et(p)&&(m.to.q3=l,m.from.q3=p),et(f)&&(m.to.median=l,m.from.median=f),m},pit=(n,t,e)=>{var i,r,s,o,a,l,h,d,u,c,g,p;if(e&&et(e.center))return e.center;let f,m,v,_,b;if(er(t)){f=(r=(i=n.getGraphicAttribute("points",!1,"median"))===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.x,m=(o=(s=n.getGraphicAttribute("points",!1,"max"))===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.x,v=(l=(a=n.getGraphicAttribute("points",!1,"min"))===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.x;const y=n.getGraphicAttribute("width",!1,"box"),C=n.getGraphicAttribute("x",!1,"box");_=C,b=C+y}else{f=(d=(h=n.getGraphicAttribute("points",!1,"median"))===null||h===void 0?void 0:h[0])===null||d===void 0?void 0:d.y,m=(c=(u=n.getGraphicAttribute("points",!1,"max"))===null||u===void 0?void 0:u[0])===null||c===void 0?void 0:c.y,v=(p=(g=n.getGraphicAttribute("points",!1,"min"))===null||g===void 0?void 0:g[0])===null||p===void 0?void 0:p.y;const y=n.getGraphicAttribute("height",!1,"box"),C=n.getGraphicAttribute("y",!1,"box");_=C,b=C+y}return et(f)?f:et(_)&&et(b)?(_+b)/2:et(m)&&et(v)?(m+v)/2:et(v)?v:et(m)?m:NaN},lNt=(n,t,e,i)=>{var r,s,o,a,l,h,d,u;const c={shaft:{},box:{},max:{},min:{},median:{}},g=(r=n.x)!==null&&r!==void 0?r:e.getGraphicAttribute("x",!1),p=(s=n.y)!==null&&s!==void 0?s:e.getGraphicAttribute("y",!1),f=(o=n.width)!==null&&o!==void 0?o:e.getGraphicAttribute("width",!1),m=(a=n.height)!==null&&a!==void 0?a:e.getGraphicAttribute("height",!1),v=(l=n.boxWidth)!==null&&l!==void 0?l:e.getGraphicAttribute("boxWidth",!1),_=(h=n.boxHeight)!==null&&h!==void 0?h:e.getGraphicAttribute("boxHeight",!1),b=(d=n.ruleWidth)!==null&&d!==void 0?d:e.getGraphicAttribute("ruleWidth",!1),y=(u=n.ruleHeight)!==null&&u!==void 0?u:e.getGraphicAttribute("ruleHeight",!1);return i&&er(i.direction)?(et(_)?(Object.assign(c.box,{y:p-_/2,y1:p+_/2}),Object.assign(c.median,{y:p-_/2,y1:p+_/2})):(Object.assign(c.box,{y:p-m/2,y1:p+m/2}),Object.assign(c.median,{y:p-m/2,y1:p+m/2})),et(y)?(Object.assign(c.max,{y:p-y/2,y1:p+y/2}),Object.assign(c.min,{y:p-y/2,y1:p+y/2})):(Object.assign(c.max,{y:p-m/2,y1:p+m/2}),Object.assign(c.min,{y:p-m/2,y1:p+m/2}))):(et(v)?(Object.assign(c.box,{x:g-v/2,x1:g+v/2}),Object.assign(c.median,{x:g-v/2,x1:g+v/2})):(Object.assign(c.box,{x:g-f/2,x1:g+f/2}),Object.assign(c.median,{x:g-f/2,x1:g+f/2})),et(b)?(Object.assign(c.max,{x:g-b/2,x1:g+b/2}),Object.assign(c.min,{x:g-b/2,x1:g+b/2})):(Object.assign(c.max,{x:g-f/2,x1:g+f/2}),Object.assign(c.min,{x:g-f/2,x1:g+f/2}))),c},hNt=cit(pit),dNt=git(pit);function uNt(){dt.registerGlyph("boxplot",{shaft:"rule",box:"rect",max:"rule",min:"rule",median:"rule"}).registerProgressiveChannels(["x","y","q1","q3","min","max","median","angle","width","height","boxWidth","boxHeight","ruleWidth","ruleHeight"]).registerFunctionEncoder(lNt).registerChannelEncoder("x",(n,t,e,i,r,s)=>s&&er(s.direction)?null:{shaft:{x:t,x1:t}}).registerChannelEncoder("y",(n,t,e,i,r,s)=>s&&er(s.direction)?{shaft:{y:t,y1:t}}:null).registerChannelEncoder("q1",(n,t,e,i,r,s)=>s&&er(s.direction)?{box:{x:t}}:{box:{y:t}}).registerChannelEncoder("q3",(n,t,e,i,r,s)=>s&&er(s.direction)?{box:{x1:t}}:{box:{y1:t}}).registerChannelEncoder("min",(n,t,e,i,r,s)=>s&&er(s.direction)?{shaft:{x:t},min:{x:t,x1:t,visible:!0}}:{shaft:{y:t},min:{y:t,y1:t,visible:!0}}).registerChannelEncoder("max",(n,t,e,i,r,s)=>s&&er(s.direction)?{shaft:{x1:t},max:{x:t,x1:t,visible:!0}}:{shaft:{y1:t},max:{y:t,y1:t,visible:!0}}).registerChannelEncoder("median",(n,t,e,i,r,s)=>s&&er(s.direction)?{median:{x:t,x1:t,visible:!0}}:{median:{y:t,y1:t,visible:!0}}).registerChannelEncoder("angle",(n,t,e,i,r,s)=>{var o;const a=s&&er(s.direction)?[(e.min+e.max)/2,e.y]:[e.x,(e.min+e.max)/2],l=(o=e.anchor)!==null&&o!==void 0?o:a;return{shaft:{angle:t,anchor:l},box:{angle:t,anchor:l},max:{angle:t,anchor:l},min:{angle:t,anchor:l},median:{angle:t,anchor:l}}}).registerDefaultEncoder(()=>({max:{visible:!1},min:{visible:!1},median:{visible:!1}})),dt.registerAnimationType("boxplotScaleIn",hNt),dt.registerAnimationType("boxplotScaleOut",dNt),TT(),MT(),jF(),NF()}const fit=(n,t,e)=>{var i,r,s,o;if(et(e==null?void 0:e.center))return e.center;let a,l,h,d,u;if(er(t)){a=(r=(i=n.getGraphicAttribute("points",!1,"median"))===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.x;const c=n.getGraphicAttribute("width",!1,"minMaxBox"),g=n.getGraphicAttribute("x",!1,"minMaxBox");h=g,l=g+c;const p=n.getGraphicAttribute("width",!1,"q1q3Box"),f=n.getGraphicAttribute("x",!1,"q1q3Box");d=f,u=f+p}else{a=(o=(s=n.getGraphicAttribute("points",!1,"median"))===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.y;const c=n.getGraphicAttribute("height",!1,"minMaxBox"),g=n.getGraphicAttribute("y",!1,"minMaxBox");h=g,l=g+c;const p=n.getGraphicAttribute("height",!1,"q1q3Box"),f=n.getGraphicAttribute("y",!1,"q1q3Box");d=f,u=f+p}return et(a)?a:et(d)&&et(u)?(d+u)/2:et(l)&&et(h)?(l+h)/2:et(h)?h:et(l)?l:NaN},cNt=(n,t,e,i)=>{var r,s,o,a,l,h,d,u;const c={minMaxBox:{},q1q3Box:{},median:{}},g=(r=n.x)!==null&&r!==void 0?r:e.getGraphicAttribute("x",!1),p=(s=n.y)!==null&&s!==void 0?s:e.getGraphicAttribute("y",!1),f=(o=n.width)!==null&&o!==void 0?o:e.getGraphicAttribute("width",!1),m=(a=n.minMaxWidth)!==null&&a!==void 0?a:e.getGraphicAttribute("minMaxWidth",!1),v=(l=n.q1q3Width)!==null&&l!==void 0?l:e.getGraphicAttribute("q1q3Width",!1),_=(h=n.height)!==null&&h!==void 0?h:e.getGraphicAttribute("height",!1),b=(d=n.minMaxHeight)!==null&&d!==void 0?d:e.getGraphicAttribute("minMaxHeight",!1),y=(u=n.q1q3Height)!==null&&u!==void 0?u:e.getGraphicAttribute("q1q3Height",!1);return i&&er(i.direction)?(et(b)?Object.assign(c.minMaxBox,{y:p-b/2,y1:p+b/2}):Object.assign(c.minMaxBox,{y:p-_/2,y1:p+_/2}),et(y)?(Object.assign(c.q1q3Box,{y:p-y/2,y1:p+y/2}),Object.assign(c.median,{y:p-y/2,y1:p+y/2})):(Object.assign(c.q1q3Box,{y:p-_/2,y1:p+_/2}),Object.assign(c.median,{y:p-_/2,y1:p+_/2}))):(et(m)?Object.assign(c.minMaxBox,{x:g-m/2,x1:g+m/2}):Object.assign(c.minMaxBox,{x:g-f/2,x1:g+f/2}),et(v)?(Object.assign(c.q1q3Box,{x:g-v/2,x1:g+v/2}),Object.assign(c.median,{x:g-v/2,x1:g+v/2})):(Object.assign(c.q1q3Box,{x:g-f/2,x1:g+f/2}),Object.assign(c.median,{x:g-f/2,x1:g+f/2}))),c},gNt=cit(fit),pNt=git(fit);function fNt(){dt.registerGlyph("barBoxplot",{minMaxBox:"rect",q1q3Box:"rect",median:"rule"}).registerProgressiveChannels(["x","y","q1","q3","min","max","median","angle","width","height","minMaxWidth","q1q3Width","minMaxHeight","q1q3Height"]).registerFunctionEncoder(cNt).registerChannelEncoder("q1",(n,t,e,i,r,s)=>s&&er(s.direction)?{q1q3Box:{x:t}}:{q1q3Box:{y:t}}).registerChannelEncoder("q3",(n,t,e,i,r,s)=>s&&er(s.direction)?{q1q3Box:{x1:t}}:{q1q3Box:{y1:t}}).registerChannelEncoder("min",(n,t,e,i,r,s)=>s&&er(s.direction)?{minMaxBox:{x:t}}:{minMaxBox:{y:t}}).registerChannelEncoder("max",(n,t,e,i,r,s)=>s&&er(s.direction)?{minMaxBox:{x1:t}}:{minMaxBox:{y1:t}}).registerChannelEncoder("median",(n,t,e,i,r,s)=>s&&er(s.direction)?{median:{x:t,x1:t,visible:!0}}:{median:{y:t,y1:t,visible:!0}}).registerChannelEncoder("angle",(n,t,e,i,r,s)=>{var o;const a=(o=e.anchor)!==null&&o!==void 0?o:[e.x,(e.min+e.max)/2];return{minMaxBox:{angle:t,anchor:a},q1q3Box:{angle:t,anchor:a},median:{angle:t,anchor:a}}}).registerChannelEncoder("lineWidth",(n,t,e,i,r,s)=>({minMaxBox:{lineWidth:0},q1q3Box:{lineWidth:0}})).registerChannelEncoder("minMaxFillOpacity",(n,t,e,i,r,s)=>({minMaxBox:{fillOpacity:t}})).registerChannelEncoder("stroke",(n,t,e,i,r,s)=>({minMaxBox:{stroke:!1},q1q3Box:{stroke:!1}})).registerDefaultEncoder(()=>({minMaxBox:{lineWidth:0},q1q3Box:{lineWidth:0},median:{visible:!1}})),dt.registerAnimationType("barBoxplotScaleIn",gNt),dt.registerAnimationType("barBoxplotScaleOut",pNt),TT(),MT(),jF(),NF()}const mNt=()=>{dt.registerGlyph("ripplePoint",{symbol:"symbol",ripple0:"symbol",ripple1:"symbol",ripple2:"symbol"}).registerFunctionEncoder((n,t,e,i)=>{var r;const s=Math.max(0,Math.min(n.ripple,1)),o=(r=n.size)!==null&&r!==void 0?r:e.getGraphicAttribute("size"),a=.5*o;return{ripple0:{size:o+a*s,fillOpacity:.75-.25*s},ripple1:{size:o+a*(1+s),fillOpacity:.5-.25*s},ripple2:{size:o+a*(2+s),fillOpacity:.25-.25*s}}}).registerDefaultEncoder(()=>({ripple0:{fillOpacity:.75},ripple1:{fillOpacity:.5},ripple2:{fillOpacity:.25}})),TT(),MT(),hit()},vNt=(n,t)=>{var e;const i=(e=n.curvature)!==null&&e!==void 0?e:.5,r=typeof t=="number"?n.thickness*t:n.thickness;let s=n.x0,o=n.x1,a=n.y0,l=n.y1,h=s+i*(o-s),d=o+i*(s-o),u=v=>v;n.round!==!1&&(s=Math.round(s),o=Math.round(o),a=Math.round(a),l=Math.round(l),h=Math.round(h),d=Math.round(d),u=Math.round),n.pathType==="line"||n.pathType,n.align==="center"?(a=u(n.y0-r/2),l=u(n.y1-r/2)):n.align==="end"?(a=u(n.y0+n.thickness/2-r),l=u(n.y1+n.thickness/2-r)):(a=u(n.y0-n.thickness/2),l=u(n.y1-n.thickness/2));const c=u(a+r),g=u(l+r),p=Math.abs(o-s)>1e-6,f=n.endArrow&&p?`L${o},${u(l-r/2)}L${u(o+r)},${u((l+g)/2)}L${o},${u(g+r/2)}`:"",m=n.startArrow&&p?`L${s},${u(c+r/2)}L${u(s-r)},${u((a+c)/2)}L${s},${u(a-r/2)}`:"";return n.pathType==="line"?`M${s},${a}L${o},${l}${f}L${o},${g}L${s},${c}${m}Z`:n.pathType==="polyline"?`M${s},${a}L${h},${a}L${h},${l}L${o},${l}
    ${f}L${o},${g}L${h},${g}L${h},${c}L${s},${c}${m}Z`:`M${s},${a}C${h},${a},${d},${l},${o},${l}
  ${f}L${o},${g}C${d},${g},${h},${c},${s},${c}${m}Z`},_Nt=(n,t)=>{var e;const i=(e=n.curvature)!==null&&e!==void 0?e:.5,r=typeof t=="number"?n.thickness*t:n.thickness;let s=n.y0,o=n.y1,a=n.x0,l=n.x1,h=s+i*(o-s),d=o+i*(s-o),u=v=>v;n.round!==!1&&(u=Math.round,s=Math.round(s),o=Math.round(o),a=Math.round(a),l=Math.round(l),h=Math.round(h),d=Math.round(d)),n.pathType==="line"||n.pathType,n.align==="center"?(a=u(n.x0-r/2),l=u(n.x1-r/2)):n.align==="end"?(a=u(n.x0+n.thickness/2-r),l=u(n.x1+n.thickness/2-r)):(a=u(n.x0-n.thickness/2),l=u(n.x1-n.thickness/2));const c=u(a+r),g=u(l+r),p=Math.abs(o-s)>1e-6,f=n.endArrow&&p?`L${u(l-r/2)},${o}L${u((l+g)/2)},${u(o+r)}L${u(g+r/2)},${o}`:"",m=n.startArrow&&p?`L${u(c+r/2)},${s}L${u((c+a)/2)},${u(s-r)}L${u(a-r/2)},${s}`:"";return n.pathType==="line"?`M${a},${s}L${l},${o}${f}L${g},${o}L${c},${s}${m}Z`:n.pathType==="polyline"?`M${a},${s}L${a},${h}L${l},${h}L${l},${o}
    ${f}L${g},${o}L${g},${h}L${c},${h}L${c},${s}${m}Z`:`M${a},${s}C${a},${h},${l},${d},${l},${o}
  ${f}L${g},${o}C${g},${d},${c},${h},${c},${s}${m}Z`},bNt=(n,t,e,i)=>{var r;const s=(r=n.direction)!==null&&r!==void 0?r:i==null?void 0:i.direction,o=["vertical","TB","BT"].includes(s)?_Nt:vNt,a=typeof n.ratio=="number"&&n.ratio>=0&&n.ratio<=1,l=Object.keys(n);return["x0","y0","x1","y1"].every(h=>l.includes(h))?{back:{path:a?o(n,1):""},front:{path:o(n,a?n.ratio:1)}}:{}},yNt=(n,t,e)=>{const i={x0:n.getGraphicAttribute("x0",!1),x1:n.getGraphicAttribute("x1",!1),y0:n.getGraphicAttribute("y0",!1),y1:n.getGraphicAttribute("y1",!1),thickness:n.getGraphicAttribute("thickness",!1),round:n.getGraphicAttribute("round",!1),align:n.getGraphicAttribute("align",!1),pathType:n.getGraphicAttribute("pathType",!1),endArrow:n.getGraphicAttribute("endArrow",!1),startArrow:n.getGraphicAttribute("startArrow",!1)};return Object.keys(i).forEach(r=>{D(i[r])&&delete i[r]}),{from:Object.assign({},i,{x1:i.x0,y1:i.y0}),to:i}},CNt=(n,t,e)=>{const i={x0:n.getGraphicAttribute("x0",!0),x1:n.getGraphicAttribute("x1",!0),y0:n.getGraphicAttribute("y0",!0),y1:n.getGraphicAttribute("y1",!0),thickness:n.getGraphicAttribute("thickness",!0),round:n.getGraphicAttribute("round",!0),align:n.getGraphicAttribute("align",!0),pathType:n.getGraphicAttribute("pathType",!0),endArrow:n.getGraphicAttribute("endArrow",!0),startArrow:n.getGraphicAttribute("startArrow",!0)};return Object.keys(i).forEach(r=>{D(i[r])&&delete i[r]}),{from:i,to:Object.assign({},i,{x1:i.x0,y1:i.y0})}},SNt=(n,t,e)=>{const i={thickness:n.getGraphicAttribute("thickness",!1),round:n.getGraphicAttribute("round",!1),align:n.getGraphicAttribute("align",!1),pathType:n.getGraphicAttribute("pathType",!1),endArrow:n.getGraphicAttribute("endArrow",!1),startArrow:n.getGraphicAttribute("startArrow",!1)};return Object.keys(i).forEach(r=>{D(i[r])&&delete i[r]}),{from:Object.assign(Object.assign({x0:n.getGraphicAttribute("x0",!0),x1:n.getGraphicAttribute("x1",!0),y0:n.getGraphicAttribute("y0",!0),y1:n.getGraphicAttribute("y1",!0)},i),i),to:Object.assign({x0:n.getGraphicAttribute("x0",!1),x1:n.getGraphicAttribute("x1",!1),y0:n.getGraphicAttribute("y0",!1),y1:n.getGraphicAttribute("y1",!1)},i)}},xNt=()=>{dt.registerGlyph("linkPath",{back:"path",front:"path"}).registerFunctionEncoder(bNt).registerChannelEncoder("backgroundStyle",(n,t)=>({back:t})).registerDefaultEncoder(()=>({back:{zIndex:0},front:{zIndex:1}})),dt.registerAnimationType("linkPathGrowIn",yNt),dt.registerAnimationType("linkPathGrowOut",CNt),dt.registerAnimationType("linkPathUpdate",SNt),TT(),MT(),lit()};class mit extends WF{parseAddition(t){return super.parseAddition(t),this.scale(t.scale),this}scale(t){if(this.spec.scale){const i=yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this.detach(i),this.spec.scale=void 0}const e=yt(t)?this.view.getScaleById(t):t;return this.spec.scale=e,this.attach(e),this._updateComponentEncoders(),this.commit(),this}getScale(){return yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale}}const wNt=(n,t,e,i)=>{var r,s,o,a;const l=(s=(r=t==null?void 0:t.components)===null||r===void 0?void 0:r.axis)!==null&&s!==void 0?s:{};if(!n)return Z({},l,e??{});const h=[((a=(o=n.tickData)===null||o===void 0?void 0:o.call(n,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return Z({},l,{items:h},e??{})},ANt=(n,t,e,i)=>{var r,s,o,a;const l=(s=(r=t==null?void 0:t.components)===null||r===void 0?void 0:r.circleAxis)!==null&&s!==void 0?s:{};if(!n)return Z({},l,e??{});const h=[((a=(o=n.tickData)===null||o===void 0?void 0:o.call(n,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}))];return Z({},l,{items:h},e??{})},vit=(n,t,e,i,r,s)=>{var o;const a=n.getCoordinateAxisPosition();r&&r.position==="auto"&&(r.position=e?"content":a);const l=n.getCoordinateAxisPoints(i);if(l){const u={start:l[0],end:l[1],verticalFactor:(a==="top"||a==="left"?-1:1)*(e?-1:1)*(!((o=n.getSpec().range)===null||o===void 0)&&o.reversed?-1:1)};if(s&&t.type==="polar"){const c=t.angle();u.center=t.origin(),u.startAngle=c[0],u.endAngle=c[1]}return u}const h=t.radius(),d=t.angle();return{center:t.origin(),radius:h[1],innerRadius:h[0],inside:e,startAngle:d[0],endAngle:d[1]}};class $F extends mit{constructor(t,e,i){super(t,Ii.axis,e),this.spec.componentType=Ii.axis,this.mode=i}parseAddition(t){return super.parseAddition(t),this.axisType(t.axisType),this.tickCount(t.tickCount),this.inside(t.inside),this.baseValue(t.baseValue),this}scale(t){return super.scale(t),this._axisComponentType=null,this}axisType(t){return this.spec.axisType=t,this._axisComponentType=null,this._prepareRejoin(),this.commit(),this}addGraphicItem(t,e){const i=Z({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),r=dt.createGraphicComponent(this._getAxisComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,r)}tickCount(t){const e=yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}getAxisComponentType(){return this._axisComponentType}_updateComponentEncoders(){const t=yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale,e=Object.assign({update:{}},this.spec.encode),i=Object.keys(e).reduce((r,s)=>{const o=e[s];return o&&(r[s]={callback:(a,l,h)=>{var d,u;const c=this.spec.skipTheme?null:this.view.getCurrentTheme();let g=cd(o,a,l,h);const p=Mn(this.spec.inside,h,a,l),f=Mn(this.spec.baseValue,h,a,l),m=(d=t==null?void 0:t.getCoordinate)===null||d===void 0?void 0:d.call(t);m&&(g=Object.assign(vit(t,m,p,f,this.spec.layout),g));const v=(u=t==null?void 0:t.getScale)===null||u===void 0?void 0:u.call(t),_=Mn(this.spec.tickCount,h,a,l);switch(this._getAxisComponentType()){case Wa.lineAxis:return wNt(v,c,g,_);case Wa.circleAxis:return ANt(v,c,g,_)}return g}}),r},{});this._encoders=i}_getAxisComponentType(){var t;if(this._axisComponentType)return this._axisComponentType;let e=this.spec.axisType;if(D(e)){const i=yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;e=!((t=i==null?void 0:i.getCoordinate)===null||t===void 0)&&t.call(i)?i.getCoordinateAxisPoints()?"line":"circle":"line"}return this._axisComponentType=e==="circle"?Wa.circleAxis:Wa.lineAxis,this._axisComponentType}}$F.componentType=Ii.axis;const Jc=()=>{dt.registerGraphicComponent(Wa.lineAxis,(n,t)=>new g0(n,t)),dt.registerComponent(Ii.axis,$F)},_it=()=>{dt.registerGraphicComponent(Wa.circleAxis,n=>new p0(n)),dt.registerComponent(Ii.axis,$F)};var MNt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const TNt=(n,t,e,i,r,s={})=>{var o;const a=(o=s.components)===null||o===void 0?void 0:o.dataLabel,l=n.map((d,u)=>{var c,g,p,f,m;const v=Object.assign(Object.assign({},r),{labelIndex:u}),_=(c=Mn(i,v,d))!==null&&c!==void 0?c:{},{components:b={}}=s;let y={};switch(d.markType){case Tt.line:case Tt.area:y=_.type==="line"?b.lineLabel:_.type==="area"?b.areaLabel:b.lineDataLabel;break;case Tt.rect:case Tt.rect3d:case Tt.interval:y=b.rectLabel;break;case Tt.symbol:case Tt.circle:case Tt.cell:y=b.symbolLabel;break;case Tt.arc:case Tt.arc3d:y=b.arcLabel;break;case Tt.polygon:case Tt.path:default:y=b.pointLabel}const C=(g=_.data)!==null&&g!==void 0?g:[],S=(f=(p=y==null?void 0:y.data)===null||p===void 0?void 0:p[0])!==null&&f!==void 0?f:{};if(C&&C.length>0)C.forEach((A,M)=>{if(d.elements[M]){const T=cd(e,A,d.elements[M],v);Z(A,S,T)}});else{const A=(M,T)=>{const{data:R}=M,B=MNt(M,["data"]);return Object.assign(Object.assign({},Z({},T,B)),{data:R})};d.elements.forEach(M=>{if(M.getGraphicItem().releaseStatus!=="willRelease")if(d.isCollectionMark())M.getDatum().forEach(T=>{const R=cd(e,T,M,v);C.push(A(R,S))});else{const T=cd(e,M.getDatum(),M,v);C.push(A(T,S))}})}const w=(m=d.graphicItem)===null||m===void 0?void 0:m.name,x=Z({},y,{baseMarkGroupName:w,getBaseMarks:()=>d.elements.map(A=>A.getGraphicItem())},_??{});return x.data=C??y.data,x}).filter(d=>!D(d)),h=Z({},a,{size:t});return h.dataLabels=l,h};let bit=class extends WF{constructor(t,e){super(t,Ii.label,e),this.spec.componentType=Ii.label}parseAddition(t){return super.parseAddition(t),this.labelStyle(t.labelStyle),this.size(t.size),this.target(t.target),this}labelStyle(t){return this.setFunctionSpec(t,"labelStyle")}size(t){return this.setFunctionSpec(t,"size")}target(t){if(this.spec.target){const e=Q(this.spec.target).map(i=>yt(i)?this.view.getMarkById(i):i);this.detach(e)}if(this.spec.target=t,t){const e=Q(t).map(i=>yt(i)?this.view.getMarkById(i):i);this.attach(e)}return this.commit(),this}_updateComponentEncoders(){const t=Object.assign({update:{}},this.spec.encode),e=Object.keys(t).reduce((i,r)=>{const s=t[r];return s&&(i[r]={callback:(o,a,l)=>{var h,d,u,c;const g=Q(this.spec.target).map(v=>yt(v)?this.view.getMarkById(v):v),p=(d=(h=this.group)===null||h===void 0?void 0:h.getGroupGraphicItem)===null||d===void 0?void 0:d.call(h);let f=Mn(this.spec.size,l);f||(f=p?{width:(u=p.attribute.width)!==null&&u!==void 0?u:p.AABBBounds.width(),height:(c=p.attribute.height)!==null&&c!==void 0?c:p.AABBBounds.height()}:{width:1/0,height:1/0});const m=this.spec.skipTheme?null:this.view.getCurrentTheme();return TNt(g,f,s,this.spec.labelStyle,l,m)}}),i},{});this._encoders=e}};bit.componentType=Ii.label;const yit=()=>{dt.registerGraphicComponent(Ii.label,n=>new pT(n)),dt.registerComponent(Ii.label,bit)},kNt=(n,t,e,i)=>{var r,s,o,a;const l=(s=(r=t==null?void 0:t.components)===null||r===void 0?void 0:r.grid)!==null&&s!==void 0?s:{};if(!n)return Z({},l,e??{});const h=((a=(o=n.tickData)===null||o===void 0?void 0:o.call(n,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return Z({},l,{items:h},e??{})},RNt=(n,t,e,i)=>{var r,s,o,a;const l=(s=(r=t==null?void 0:t.components)===null||r===void 0?void 0:r.circleGrid)!==null&&s!==void 0?s:{};if(!n)return Z({},l,e??{});const h=((a=(o=n.tickData)===null||o===void 0?void 0:o.call(n,i))!==null&&a!==void 0?a:[]).map(d=>({id:d.index,label:d.tick,value:d.value,rawValue:d.tick}));return Z({},l,{items:h},e??{})};class VF extends mit{constructor(t,e,i){super(t,Ii.grid,e),this.spec.componentType=Ii.grid,this.mode=i}parseAddition(t){return super.parseAddition(t),this.target(t.target),this.gridType(t.gridType),this.gridShape(t.gridShape),this}scale(t){return super.scale(t),this._gridComponentType=null,this}gridType(t){return this.spec.gridType=t,this._gridComponentType=null,this._prepareRejoin(),this.commit(),this}gridShape(t){return this.spec.gridShape=t,this.commit(),this}target(t){if(this.spec.target){const i=yt(this.spec.target)?this.view.getMarkById(this.spec.target):this.spec.target;this.detach(i)}this.spec.target=t;const e=yt(t)?this.view.getMarkById(t):t;return this.attach(e),this._targetAxis=e,this._gridComponentType=null,this._updateComponentEncoders(),this.commit(),this}tickCount(t){const e=yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;return e&&e.tickCount(t),this.setFunctionSpec(t,"tickCount")}inside(t){return this.setFunctionSpec(t,"inside")}baseValue(t){return this.setFunctionSpec(t,"baseValue")}addGraphicItem(t,e){const i=Z({x:0,y:0,start:{x:0,y:0},end:{x:0,y:0}},t),r=dt.createGraphicComponent(this._getGridComponentType(),i,{mode:this.mode,skipDefault:this.spec.skipTheme});return super.addGraphicItem(i,e,r)}_updateComponentEncoders(){const t=Object.assign({update:{}},this.spec.encode),e=Object.keys(t).reduce((i,r)=>{const s=t[r];return s&&(i[r]={callback:(o,a,l)=>{var h,d,u,c;const g=this.spec.skipTheme?null:this.view.getCurrentTheme();let p,f=cd(s,o,a,l);const m=Mn(this.spec.baseValue,l,o,a);if(this._targetAxis){const b=(h=this._targetAxis.getSpec())===null||h===void 0?void 0:h.scale;p=yt(b)?this.view.getScaleById(b):b;const y=this._targetAxis.elements[0];if(y)switch(this._getGridComponentType()){case Dn.lineAxisGrid:f=Object.assign({x:y.getGraphicAttribute("x"),y:y.getGraphicAttribute("y"),start:y.getGraphicAttribute("start"),end:y.getGraphicAttribute("end"),verticalFactor:(d=y.getGraphicAttribute("verticalFactor"))!==null&&d!==void 0?d:1},f);break;case Dn.circleAxisGrid:f=Object.assign({x:y.getGraphicAttribute("x"),y:y.getGraphicAttribute("y"),center:y.getGraphicAttribute("center"),radius:y.getGraphicAttribute("radius"),innerRadius:y.getGraphicAttribute("innerRadius"),inside:y.getGraphicAttribute("inside"),startAngle:y.getGraphicAttribute("startAngle"),endAngle:y.getGraphicAttribute("endAngle")},f)}}else{p=yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;const b=Mn(this.spec.inside,l,o,a),y=(u=p==null?void 0:p.getCoordinate)===null||u===void 0?void 0:u.call(p);y&&(f=Object.assign(vit(p,y,b,m,this.spec.layout,!0),f))}this._getGridComponentType()===Dn.lineAxisGrid&&(f=this.spec.gridShape!=="line"&&this.spec.gridShape?Object.assign({center:f.start,closed:!0},f,{type:this.spec.gridShape}):Object.assign({},f,{type:"line"}));const v=(c=p==null?void 0:p.getScale)===null||c===void 0?void 0:c.call(p),_=Mn(this.spec.tickCount,l,o,a);switch(this._getGridComponentType()){case Dn.lineAxisGrid:return kNt(v,g,f,_);case Dn.circleAxisGrid:return RNt(v,g,f,_)}return f}}),i},{});this._encoders=e}_getGridComponentType(){var t;if(this._gridComponentType)return this._gridComponentType;if(this.spec.gridType)this.spec.gridType==="circle"?this._gridComponentType=Dn.circleAxisGrid:this._gridComponentType=Dn.lineAxisGrid;else if(this._targetAxis)switch(this._targetAxis.getAxisComponentType()){case Wa.circleAxis:this._gridComponentType=Dn.circleAxisGrid;break;case Wa.lineAxis:default:this._gridComponentType=Dn.lineAxisGrid}else if(this.spec.scale){const e=yt(this.spec.scale)?this.view.getScaleById(this.spec.scale):this.spec.scale;this._gridComponentType=!((t=e==null?void 0:e.getCoordinate)===null||t===void 0)&&t.call(e)?e.getCoordinateAxisPoints()?Dn.lineAxisGrid:Dn.circleAxisGrid:Dn.lineAxisGrid}else this._gridComponentType=Dn.lineAxisGrid;return this._gridComponentType}}VF.componentType=Ii.grid;const Qc=()=>{dt.registerGraphicComponent(Dn.lineAxisGrid,(n,t)=>new Jtt(n,t)),dt.registerComponent(Ii.grid,VF)},Cit=()=>{dt.registerGraphicComponent(Dn.circleAxisGrid,(n,t)=>new Qtt(n,t)),dt.registerComponent(Ii.grid,VF)},BNt=(n,t,e)=>t.filter(i=>n.callback(i,e)),PNt=(n,t,e)=>{const i=n.callback,r=n.as;if(!n.all)return t.forEach(o=>{const a=i(o,e);if(!D(r)){if(D(o))return;o[r]=a}return a}),t;const s=i(t,e);return D(r)||D(t)?s:(t[r]=s,t)};function Sit(n){return n.reduce((t,e)=>t+e,0)}function ENt(n){return n.length===0?0:Sit(n)/n.length}const LNt={min:Ri,max:Mi,average:ENt,sum:Sit};function INt(n,t,e,i){const r=Math.floor(t.length/n),s=[],o=t.length;let a,l,h,d=0,u=0;s[u++]=d;for(let c=1;c<o-1;c+=r){const g=Math.min(c+r,o-1),p=Math.min(c+2*r,o),f=(p+g)/2;let m=0;for(let C=g;C<p;C++){const S=t[C][i];Number.isNaN(S)||(m+=S)}m/=p-g;const v=c,_=Math.min(c+r,o),b=c-1,y=t[d][i];a=-1,h=v;for(let C=v;C<_;C++){const S=t[C][i];Number.isNaN(i)||(l=Math.abs((b-f)*(S-y)-(b-C)*(m-y)),l>a&&(a=l,h=C))}s[u++]=h,d=h}return s[u-1]!==o-1&&(s[u++]=o-1),s.map(c=>e?t[c].i:c)}function kT(n,t,e,i,r){let s=Math.floor(t.length/n);const o=[],a=t.length;let l=0,h=[];o.push(l),t[l][r]=t[l][r];for(let d=1;d<a-1;d+=s){s>a-d&&(s=a-d,h.length=s),h=[];for(let c=0;c<s;c++)h.push(t[d+c][r]);const u=LNt[i](h);l=Math.min(Math.round(d+h.length/2)||0,a-1),t[l][r]=u,o.push(l)}return o.map(d=>e?t[d].i:d)}function ONt(n,t,e,i){return kT(n,t,e,"min",i)}function DNt(n,t,e,i){return kT(n,t,e,"max",i)}function FNt(n,t,e,i){return kT(n,t,e,"average",i)}function HNt(n,t,e,i){return kT(n,t,e,"sum",i)}const zNt=(n,t)=>{let e=n.size;const i=n.factor||1;if(Array.isArray(e)&&(e=Math.floor(e[1]-e[0])),e*=i,e<=0)return[];if(t.length<=e)return t;if(n.skipfirst)return t.slice(0,1);const{mode:r,yfield:s,groupBy:o}=n,a=s??"y";let l=INt;if(r==="min"?l=ONt:r==="max"?l=DNt:r==="average"?l=FNt:r==="sum"&&(l=HNt),t.length){const h={};if(o){for(let u=0,c=t.length;u<c;u++){const g=t[u],p=g[o];h[p]?h[p].push({[a]:g[a],i:u}):(h[p]=[],h[p].push({[a]:g[a],i:u}))}let d=[];return Object.keys(h).forEach(u=>{const c=h[u];if(c.length<=e){const g=c.map(p=>p.i);d=d.concat(g)}else{const g=l(e,c,!0,a);d=d.concat(g),c.forEach(p=>t[p.i][a]=p[a])}}),d.sort((u,c)=>u-c),d.map(u=>t[u])}return l(e,t,!1,a).map(d=>t[d])}return[]};function WNt(n){return n.forEach(t=>{t.getGraphicAttribute(Rc)&&(t.setGraphicAttribute("visible",!0),t.setGraphicAttribute(Rc,!1))}),n}function jNt(n,t,e,i){if(i){let r=-1/0,s=0;const o=D(t);let a=t;n.forEach(l=>{if(l.getGraphicAttribute("visible")===!1)return;const h=l.getGraphicAttribute("size")/2,d=l.getGraphicAttribute("x");o&&(a=(h+s)*e),Math.abs(d-r)<a+s+h?l.getGraphicAttribute("forceShow")||(l.setGraphicAttribute(Rc,!0),l.setGraphicAttribute("visible",!1)):r=d,s=h})}}function NNt(n,t,e,i){if(i){let r=-1/0,s=0;const o=D(t);let a=t;n.forEach(l=>{if(l.getGraphicAttribute("visible")===!1)return;const h=l.getGraphicAttribute("size")/2,d=l.getGraphicAttribute("y");o&&(a=(h+s)*e),Math.abs(d-r)<a+s+h?l.getGraphicAttribute("forceShow")||(l.setGraphicAttribute(Rc,!0),l.setGraphicAttribute("visible",!1)):r=d,s=h})}}function $Nt(n,t,e,i){if(i){let s=-1/0,o=0,a=0;const l=D(t);let h=t;n.forEach(d=>{if(d.getGraphicAttribute("visible")===!1)return;const u=d.getGraphicAttribute("size")/2,c=d.getGraphicAttribute("x"),g=d.getGraphicAttribute("y");l&&(h=(u+o)*e),a=(-1/0-c)**2+(s-g)**2,a<(h+o+u)**2?d.getGraphicAttribute("forceShow")||(d.setGraphicAttribute(Rc,!0),d.setGraphicAttribute("visible",!1)):s=g,o=u})}}const VNt=(n,t)=>{if(!t||t.length===0)return;let{radius:e}=n;D(e)&&t[0].mark.markType==="symbol"&&(e=!0);const{direction:i,delta:r,deltaMul:s=1,groupBy:o}=n,a=l=>{WNt(l);const h=n.sort?l.slice().sort((d,u)=>d.getGraphicAttribute("x")-u.getGraphicAttribute("x")):l;i===0?$Nt(h,r,s,e):i===1?jNt(h,r,s,e):NNt(h,r,s,e)};if(o){const l=t.reduce((h,d)=>{const u=d.getDatum()[o];return h[u]?h[u].push(d):h[u]=[d],h},{});Object.keys(l).forEach(h=>{a(l[h])})}else a(t);return t},GNt=()=>{dt.registerTransform("filter",{transform:BNt,markPhase:"beforeJoin"},!0)},UNt=()=>{dt.registerTransform("map",{transform:PNt,markPhase:"beforeJoin"},!0)},GF=()=>{dt.registerTransform("sampling",{transform:zNt,markPhase:"afterEncode"},!0)},xit=()=>{dt.registerTransform("markoverlap",{transform:VNt,markPhase:"afterEncode"},!0)},YNt=(n,t,e)=>{var i;const r=n.getGraphicAttribute("clipRangeByDimension",!1),s=(i=n.getGraphicAttribute("clipRange",!1))!==null&&i!==void 0?i:1;return t&&t.clipDimension?{from:{clipRange:0,clipRangeByDimension:t.clipDimension},to:{clipRange:s,clipRangeByDimension:r}}:{from:{clipRange:0},to:{clipRange:s}}},XNt=(n,t,e)=>{var i;const r=n.getGraphicAttribute("clipRangeByDimension",!0),s=(i=n.getGraphicAttribute("clipRange",!0))!==null&&i!==void 0?i:1;return t&&t.clipDimension?{from:{clipRange:s,clipRangeByDimension:t.clipDimension},to:{clipRange:0,clipRangeByDimension:r}}:{from:{clipRange:s},to:{clipRange:0}}},KNt=(n,t,e)=>{var i,r,s,o;const a=(i=n.getFinalAnimationAttributes())!==null&&i!==void 0?i:{};return{from:{opacity:0,fillOpacity:0,strokeOpacity:0},to:{opacity:(r=a.opacity)!==null&&r!==void 0?r:1,fillOpacity:(s=a.fillOpacity)!==null&&s!==void 0?s:1,strokeOpacity:(o=a.strokeOpacity)!==null&&o!==void 0?o:1}}},qNt=(n,t,e)=>{var i,r,s;return{from:{opacity:(i=n.getGraphicAttribute("opacity",!0))!==null&&i!==void 0?i:1,fillOpacity:(r=n.getGraphicAttribute("fillOpacity",!0))!==null&&r!==void 0?r:1,strokeOpacity:(s=n.getGraphicAttribute("strokeOpacity",!0))!==null&&s!==void 0?s:1},to:{opacity:0,fillOpacity:0,strokeOpacity:0}}},ZNt=(n,t,e)=>{switch(t==null?void 0:t.direction){case"x":{const i=n.getFinalAnimationAttribute("x"),r=n.getFinalAnimationAttribute("x1"),s=n.getFinalAnimationAttribute("width");return{from:L(s)?{x:i+s/2,x1:void 0,width:0}:{x:(i+r)/2,x1:(i+r)/2,width:void 0},to:{x:i,x1:r,width:s}}}case"y":{const i=n.getFinalAnimationAttribute("y"),r=n.getFinalAnimationAttribute("y1"),s=n.getFinalAnimationAttribute("height");return{from:L(s)?{y:i+s/2,y1:void 0,height:0}:{y:(i+r)/2,y1:(i+r)/2,height:void 0},to:{y:i,y1:r,height:s}}}default:{const i=n.getFinalAnimationAttribute("x"),r=n.getFinalAnimationAttribute("x1"),s=n.getFinalAnimationAttribute("width"),o=n.getFinalAnimationAttribute("y"),a=n.getFinalAnimationAttribute("y1"),l=n.getFinalAnimationAttribute("height"),h={};return L(s)?(h.x=i+s/2,h.width=0,h.x1=void 0):(h.x=(i+r)/2,h.x1=(i+r)/2,h.width=void 0),L(l)?(h.y=o+l/2,h.height=0,h.y1=void 0):(h.y=(o+a)/2,h.y1=(o+a)/2,h.height=void 0),{from:h,to:{x:i,y:o,x1:r,y1:a,width:s,height:l}}}}},JNt=(n,t,e)=>{switch(t==null?void 0:t.direction){case"x":{const i=n.getFinalAnimationAttribute("x"),r=n.getFinalAnimationAttribute("x1"),s=n.getFinalAnimationAttribute("width");return{to:L(s)?{x:i+s/2,x1:void 0,width:0}:{x:(i+r)/2,x1:(i+r)/2,width:void 0}}}case"y":{const i=n.getFinalAnimationAttribute("y"),r=n.getFinalAnimationAttribute("y1"),s=n.getFinalAnimationAttribute("height");return{to:L(s)?{y:i+s/2,y1:void 0,height:0}:{y:(i+r)/2,y1:(i+r)/2,height:void 0}}}default:{const i=n.getFinalAnimationAttribute("x"),r=n.getFinalAnimationAttribute("y"),s=n.getFinalAnimationAttribute("x1"),o=n.getFinalAnimationAttribute("y1"),a=n.getFinalAnimationAttribute("width"),l=n.getFinalAnimationAttribute("height"),h={};return L(a)?(h.x=i+a/2,h.width=0,h.x1=void 0):(h.x=(i+s)/2,h.x1=(i+s)/2,h.width=void 0),L(l)?(h.y=r+l/2,h.height=0,h.y1=void 0):(h.y=(r+o)/2,h.y1=(r+o)/2,h.height=void 0),{to:h}}}};function QNt(n,t,e){const i=n.getFinalAnimationAttribute("x"),r=n.getFinalAnimationAttribute("x1"),s=n.getFinalAnimationAttribute("width");if(t&&t.orient==="negative"){const a=L(s)?Math.max(i,i+s):Math.max(i,r);return{from:{x:a,x1:D(r)?void 0:a,width:D(s)?void 0:0},to:{x:i,x1:r,width:s}}}const o=L(s)?Math.min(i,i+s):Math.min(i,r);return{from:{x:o,x1:D(r)?void 0:o,width:D(s)?void 0:0},to:{x:i,x1:r,width:s}}}function t$t(n,t,e){var i;const r=n.getFinalAnimationAttribute("x"),s=n.getFinalAnimationAttribute("x1"),o=n.getFinalAnimationAttribute("width");let a;return t&&t.orient==="negative"?J(t.overall)?a=t.overall:e.group?(a=(i=e.groupWidth)!==null&&i!==void 0?i:e.group.getBounds().width(),e.groupWidth=a):a=e.width:a=J(t==null?void 0:t.overall)?t==null?void 0:t.overall:0,{from:{x:a,x1:D(s)?void 0:a,width:D(o)?void 0:0},to:{x:r,x1:s,width:o}}}const e$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?t$t(n,t,e):QNt(n,t)};function i$t(n,t,e){const i=n.getFinalAnimationAttribute("x"),r=n.getFinalAnimationAttribute("x1"),s=n.getFinalAnimationAttribute("width");if(t&&t.orient==="negative"){const a=L(s)?Math.max(i,i+s):Math.max(i,r);return{to:{x:a,x1:D(r)?void 0:a,width:D(s)?void 0:0}}}const o=L(s)?Math.min(i,i+s):Math.min(i,r);return{to:{x:o,x1:D(r)?void 0:o,width:D(s)?void 0:0}}}function n$t(n,t,e){var i;const r=n.getFinalAnimationAttribute("x1"),s=n.getFinalAnimationAttribute("width");let o;return t&&t.orient==="negative"?J(t.overall)?o=t.overall:e.group?(o=(i=e.groupWidth)!==null&&i!==void 0?i:e.group.getBounds().width(),e.groupWidth=o):o=e.width:o=J(t==null?void 0:t.overall)?t.overall:0,{to:{x:o,x1:D(r)?void 0:o,width:D(s)?void 0:0}}}const r$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?n$t(n,t,e):i$t(n,t)};function s$t(n,t,e){const i=n.getFinalAnimationAttribute("y"),r=n.getFinalAnimationAttribute("y1"),s=n.getFinalAnimationAttribute("height");if(t&&t.orient==="negative"){const a=L(s)?Math.max(i,i+s):Math.max(i,r);return{from:{y:a,y1:D(r)?void 0:a,height:D(s)?void 0:0},to:{y:i,y1:r,height:s}}}const o=L(s)?Math.min(i,i+s):Math.min(i,r);return{from:{y:o,y1:D(r)?void 0:o,height:D(s)?void 0:0},to:{y:i,y1:r,height:s}}}function o$t(n,t,e){var i;const r=n.getFinalAnimationAttribute("y"),s=n.getFinalAnimationAttribute("y1"),o=n.getFinalAnimationAttribute("height");let a;return t&&t.orient==="negative"?J(t.overall)?a=t.overall:e.group?(a=(i=e.groupHeight)!==null&&i!==void 0?i:e.group.getBounds().height(),e.groupHeight=a):a=e.height:a=J(t==null?void 0:t.overall)?t.overall:0,{from:{y:a,y1:D(s)?void 0:a,height:D(o)?void 0:0},to:{y:r,y1:s,height:o}}}const a$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?o$t(n,t,e):s$t(n,t)};function l$t(n,t,e){const i=n.getFinalAnimationAttribute("y"),r=n.getFinalAnimationAttribute("y1"),s=n.getFinalAnimationAttribute("height");if(t&&t.orient==="negative"){const a=L(s)?Math.max(i,i+s):Math.max(i,r);return{to:{y:a,y1:D(r)?void 0:a,height:D(s)?void 0:0}}}const o=L(s)?Math.min(i,i+s):Math.min(i,r);return{to:{y:o,y1:D(r)?void 0:o,height:D(s)?void 0:0}}}function h$t(n,t,e){var i;const r=n.getFinalAnimationAttribute("y1"),s=n.getFinalAnimationAttribute("height");let o;return t&&t.orient==="negative"?J(t.overall)?o=t.overall:e.group?(o=(i=e.groupHeight)!==null&&i!==void 0?i:e.group.getBounds().height(),e.groupHeight=o):o=e.height:o=J(t==null?void 0:t.overall)?t.overall:0,{to:{y:o,y1:D(r)?void 0:o,height:D(s)?void 0:0}}}const d$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?h$t(n,t,e):l$t(n,t)},u$t=(n,t,e)=>{const i=n.getFinalAnimationAttributes();return t&&t.orient==="anticlockwise"?{from:{startAngle:i==null?void 0:i.endAngle},to:{startAngle:i==null?void 0:i.startAngle}}:{from:{endAngle:i==null?void 0:i.startAngle},to:{endAngle:i==null?void 0:i.endAngle}}},c$t=(n,t,e)=>{const i=n.getFinalAnimationAttributes();if(t&&t.orient==="anticlockwise"){const s=J(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:s,endAngle:s},to:{startAngle:i==null?void 0:i.startAngle,endAngle:i==null?void 0:i.endAngle}}}const r=J(t==null?void 0:t.overall)?t.overall:0;return{from:{startAngle:r,endAngle:r},to:{startAngle:i==null?void 0:i.startAngle,endAngle:i==null?void 0:i.endAngle}}},g$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?c$t(n,t):u$t(n,t)},p$t=(n,t,e)=>{const i=n.getFinalAnimationAttributes();return t&&t.orient==="anticlockwise"?{from:{startAngle:n.getGraphicAttribute("startAngle",!0)},to:{startAngle:i==null?void 0:i.endAngle}}:{from:{endAngle:n.getGraphicAttribute("endAngle",!0)},to:{endAngle:i==null?void 0:i.startAngle}}},f$t=(n,t,e)=>{if(t&&t.orient==="anticlockwise"){const r=J(t.overall)?t.overall:2*Math.PI;return{from:{startAngle:n.getGraphicAttribute("startAngle",!0),endAngle:n.getGraphicAttribute("endAngle",!0)},to:{startAngle:r,endAngle:r}}}const i=J(t==null?void 0:t.overall)?t.overall:0;return{from:{startAngle:n.getGraphicAttribute("startAngle",!0),endAngle:n.getGraphicAttribute("endAngle",!0)},to:{startAngle:i,endAngle:i}}},m$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?f$t(n,t):p$t(n,t)},v$t=(n,t,e)=>{const i=n.getFinalAnimationAttributes();return t&&t.orient==="inside"?{from:{innerRadius:i==null?void 0:i.outerRadius},to:{innerRadius:i==null?void 0:i.innerRadius}}:{from:{outerRadius:i==null?void 0:i.innerRadius},to:{outerRadius:i==null?void 0:i.outerRadius}}},_$t=(n,t,e)=>{const i=n.getFinalAnimationAttributes(),r=J(t==null?void 0:t.overall)?t.overall:0;return{from:{innerRadius:r,outerRadius:r},to:{innerRadius:i==null?void 0:i.innerRadius,outerRadius:i==null?void 0:i.outerRadius}}},b$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?_$t(n,t):v$t(n,t)},y$t=(n,t,e)=>{const i=n.getFinalAnimationAttributes();return t&&t.orient==="inside"?{from:{innerRadius:n.getGraphicAttribute("innerRadius",!0)},to:{innerRadius:i==null?void 0:i.outerRadius}}:{from:{outerRadius:n.getGraphicAttribute("outerRadius",!0)},to:{outerRadius:i==null?void 0:i.innerRadius}}},C$t=(n,t,e)=>{const i=J(t==null?void 0:t.overall)?t.overall:0;return{from:{innerRadius:n.getGraphicAttribute("innerRadius",!0),outerRadius:n.getGraphicAttribute("outerRadius",!0)},to:{innerRadius:i,outerRadius:i}}},S$t=(n,t,e)=>{var i;return((i=t==null?void 0:t.overall)!==null&&i!==void 0&&i)!==!1?C$t(n,t):y$t(n,t)},wit=(n,t,e)=>{const i=n.getGraphicAttribute("points",!1),r={x:0,y:0};return i.forEach(s=>{r.x+=s.x,r.y+=s.y}),r.x/=i.length,r.y/=i.length,t&&t.center&&(et(t.center.x)&&(r.x=t.center.x),et(t.center.y)&&(r.y=t.center.y)),n.mark.markType==="area"&&(r.x1=r.x,r.y1=r.y),i.map(s=>Object.assign({},s,r))},x$t=(n,t,e)=>({from:{points:wit(n,t)},to:{points:n.getGraphicAttribute("points",!1)}}),w$t=(n,t,e)=>({from:{points:n.getGraphicAttribute("points",!0)},to:{points:wit(n,t)}}),Ait=(n,t,e)=>n.getGraphicAttribute("points",!1).map(i=>{var r;if(t&&t.orient==="negative"){let s=e.width;return e.group&&(s=(r=e.groupWidth)!==null&&r!==void 0?r:e.group.getBounds().width(),e.groupWidth=s),Object.assign(Object.assign({},i),{x:s,y:i.y,x1:s,y1:i.y1,defined:i.defined!==!1})}return Object.assign(Object.assign({},i),{x:0,y:i.y,x1:0,y1:i.y1,defined:i.defined!==!1})}),A$t=(n,t,e)=>({from:{points:Ait(n,t,e)},to:{points:n.getGraphicAttribute("points",!1)}}),M$t=(n,t,e)=>({from:{points:n.getGraphicAttribute("points",!0)},to:{points:Ait(n,t,e)}}),Mit=(n,t,e)=>n.getGraphicAttribute("points",!1).map(i=>{var r;if(t&&t.orient==="negative"){let s=e.height;return e.group&&(s=(r=e.groupHeight)!==null&&r!==void 0?r:e.group.getBounds().height(),e.groupHeight=s),Object.assign(Object.assign({},i),{x:i.x,y:s,x1:i.x1,y1:s,defined:i.defined!==!1})}return Object.assign(Object.assign({},i),{x:i.x,y:0,x1:i.x1,y1:0,defined:i.defined!==!1})}),T$t=(n,t,e)=>({from:{points:Mit(n,t,e)},to:{points:n.getGraphicAttribute("points",!1)}}),k$t=(n,t,e)=>({from:{points:n.getGraphicAttribute("points",!0)},to:{points:Mit(n,t,e)}}),R$t=(n,t,e)=>{var i,r;const{offset:s=0,orient:o,direction:a,point:l,excludeChannels:h=[]}=t??{};let d=0,u=0;o==="negative"&&(e.group?(d=(i=e.groupWidth)!==null&&i!==void 0?i:e.group.getBounds().width(),u=(r=e.groupHeight)!==null&&r!==void 0?r:e.group.getBounds().height(),e.groupWidth=d,e.groupHeight=u):(d=e.width,u=e.height)),d+=s,u+=s;const c=it(l)?l.call(null,n.getDatum(),n,e):l,g=c&&et(c.x)?c.x:d,p=c&&et(c.y)?c.y:u,f=h.includes("x")?n.getGraphicAttribute("x"):n.getFinalAnimationAttribute("x"),m=h.includes("y")?n.getGraphicAttribute("y"):n.getFinalAnimationAttribute("y");switch(a){case"x":return{from:{x:g},to:{x:f}};case"y":return{from:{y:p},to:{y:m}};default:return{from:{x:g,y:p},to:{x:f,y:m}}}},B$t=(n,t,e)=>{var i,r;const{offset:s=0,orient:o,direction:a,point:l}=t??{},h=e.group?e.group.getBounds():null,d=(i=h==null?void 0:h.width())!==null&&i!==void 0?i:e.width,u=(r=h==null?void 0:h.height())!==null&&r!==void 0?r:e.height,c=(o==="negative"?d:0)+s,g=(o==="negative"?u:0)+s,p=it(l)?l.call(null,n.getDatum(),n,e):l,f=p&&et(p.x)?p.x:c,m=p&&et(p.y)?p.y:g;switch(a){case"x":return{from:{x:n.getGraphicAttribute("x",!0)},to:{x:f}};case"y":return{from:{y:n.getGraphicAttribute("y",!0)},to:{y:m}};default:return{from:{x:n.getGraphicAttribute("x",!0),y:n.getGraphicAttribute("y",!0)},to:{x:f,y:m}}}},P$t=(n,t,e)=>{var i,r,s,o;const a=n.getFinalAnimationAttributes();switch(t==null?void 0:t.direction){case"x":return{from:{scaleX:0},to:{scaleX:(i=a==null?void 0:a.scaleX)!==null&&i!==void 0?i:1}};case"y":return{from:{scaleY:0},to:{scaleY:(r=a==null?void 0:a.scaleY)!==null&&r!==void 0?r:1}};default:return{from:{scaleX:0,scaleY:0},to:{scaleX:(s=a==null?void 0:a.scaleX)!==null&&s!==void 0?s:1,scaleY:(o=a==null?void 0:a.scaleY)!==null&&o!==void 0?o:1}}}},E$t=(n,t,e)=>{var i,r,s,o;switch(t==null?void 0:t.direction){case"x":return{from:{scaleX:(i=n.getGraphicAttribute("scaleX",!0))!==null&&i!==void 0?i:1},to:{scaleX:0}};case"y":return{from:{scaleY:(r=n.getGraphicAttribute("scaleY",!0))!==null&&r!==void 0?r:1},to:{scaleY:0}};default:return{from:{scaleX:(s=n.getGraphicAttribute("scaleX",!0))!==null&&s!==void 0?s:1,scaleY:(o=n.getGraphicAttribute("scaleY",!0))!==null&&o!==void 0?o:1},to:{scaleX:0,scaleY:0}}}},L$t={symbol:["_mo_hide_","visible"]},I$t=(n,t,e)=>{const i=Object.assign({},n.getPrevGraphicAttributes()),r=Object.assign({},n.getNextGraphicAttributes());let s;t&&Q(t.excludeChannels).forEach(a=>{delete i[a],delete r[a]}),n.mark&&n.mark.markType&&(s=L$t[n.mark.markType])&&s.forEach(a=>{delete i[a],delete r[a]}),Object.keys(r).forEach(a=>{Oe(i[a],r[a])&&(delete i[a],delete r[a])});const o=n.getFinalGraphicAttributes();return Object.keys(i).forEach(a=>{D(r[a])&&(D(o[a])||Oe(i[a],o[a])?delete i[a]:r[a]=o[a])}),{from:i,to:r}},O$t=(n,t,e)=>{var i;const r=(i=n.getFinalAnimationAttribute("angle"))!==null&&i!==void 0?i:0;let s=0;return s=di(r/(2*Math.PI),0)?Math.round(r/(2*Math.PI))*Math.PI*2:et(t==null?void 0:t.angle)?t.angle:(t==null?void 0:t.orient)==="anticlockwise"?Math.ceil(r/(2*Math.PI))*Math.PI*2:Math.floor(r/(2*Math.PI))*Math.PI*2,{from:{angle:s},to:{angle:r}}},D$t=(n,t,e)=>{var i;const r=(i=n.getGraphicAttribute("angle",!0))!==null&&i!==void 0?i:0;let s=0;return s=di(r/(2*Math.PI),0)?Math.round(r/(2*Math.PI))*Math.PI*2:et(t==null?void 0:t.angle)?t.angle:(t==null?void 0:t.orient)==="anticlockwise"?Math.ceil(r/(2*Math.PI))*Math.PI*2:Math.floor(r/(2*Math.PI))*Math.PI*2,{from:{angle:r},to:{angle:s}}},F$t=()=>{dt.registerAnimationType("clipIn",YNt)},H$t=()=>{dt.registerAnimationType("clipOut",XNt)},z$t=()=>{dt.registerAnimationType("fadeIn",KNt)},W$t=()=>{dt.registerAnimationType("fadeOut",qNt)},j$t=()=>{dt.registerAnimationType("growCenterIn",ZNt)},N$t=()=>{dt.registerAnimationType("growCenterOut",JNt)},$$t=()=>{dt.registerAnimationType("growHeightIn",a$t)},V$t=()=>{dt.registerAnimationType("growHeightOut",d$t)},G$t=()=>{dt.registerAnimationType("growWidthIn",e$t)},U$t=()=>{dt.registerAnimationType("growWidthOut",r$t)},Tit=()=>{dt.registerAnimationType("growPointsIn",x$t)},kit=()=>{dt.registerAnimationType("growPointsOut",w$t)},Y$t=()=>{dt.registerAnimationType("growPointsXIn",A$t)},X$t=()=>{dt.registerAnimationType("growPointsXOut",M$t)},K$t=()=>{dt.registerAnimationType("growPointsYIn",T$t)},q$t=()=>{dt.registerAnimationType("growPointsYOut",k$t)},Z$t=()=>{dt.registerAnimationType("growAngleIn",g$t)},J$t=()=>{dt.registerAnimationType("growAngleOut",m$t)},Q$t=()=>{dt.registerAnimationType("growRadiusIn",b$t)},tVt=()=>{dt.registerAnimationType("growRadiusOut",S$t)},eVt=()=>{dt.registerAnimationType("moveIn",R$t)},iVt=()=>{dt.registerAnimationType("moveOut",B$t)},nVt=()=>{dt.registerAnimationType("scaleIn",P$t)},rVt=()=>{dt.registerAnimationType("scaleOut",E$t)},sVt=()=>{dt.registerAnimationType("rotateIn",O$t)},oVt=()=>{dt.registerAnimationType("rotateOut",D$t)},aVt=()=>{dt.registerAnimationType("update",I$t)};class Rit extends Zc{encodeState(t,e,i){return super.encodeState(t,e,i),this._updateComponentEncoders(t),this}_updateComponentEncoders(t){this._encoders||(this._encoders={});const e=this.spec.encode[t];if(e&&t==="update"){const i=this.parameters(),r=ju(e)?null:Object.keys(e).reduce((s,o)=>(wT(e[o])&&(s[o]=S0(e[o].scale,i)),s),{});this._encoders[t]={callback:(s,o,a)=>{const l=cd(e,s,o,a);if(D(l.size)){const h=r.x?t8(r.x):void 0,d=r.y?t8(r.y):void 0;D(h)&&D(d)?l.size=10:D(h)?l.size=d:D(d)&&(l.size=h),l.size=[h,d]}return D(l.shape)&&(l.shape="rect"),l}}}else this._encoders[t]=e}_getEncoders(){var t;return(t=this._encoders)!==null&&t!==void 0?t:{}}getAttributeTransforms(){return[{channels:["size","padding"],transform:(t,e,i)=>{if(J(i.padding)&&i.padding>0)t.size=V(i.size)?i.size.map(r=>Math.max(r-i.padding,1)):Math.max(i.size-i.padding,1);else if(V(i.padding)&&i.padding.length===2){const r=V(i.size)?i.size:[i.size,i.size];t.size=[Math.max(r[0]-i.padding[0],1),Math.max(r[1]-i.padding[1],1)]}else t.size=i.size},storedAttrs:"paddingAttrs"}].concat(kb.symbol)}release(){super.release(),this._encoders=null}}Rit.markType=Tt.cell;const lVt=()=>{dt.registerMark(Tt.cell,Rit)};class hVt{constructor(t){this._animations=[],this._additionalAnimateMarks=[],this.isEnabled=!0,this._onAnimationStart=e=>{this._additionalAnimateMarks=this._additionalAnimateMarks.filter(i=>{var r;return(r=i==null?void 0:i.animate)===null||r===void 0?void 0:r.isAnimating()}),this._animations.length===0&&this._additionalAnimateMarks.length===0&&this._view.emit(Lt.ALL_ANIMATION_START,{}),this._animations=this._animations.concat({config:e.animationConfig,mark:e.mark})},this._onAnimationEnd=e=>{this._additionalAnimateMarks=this._additionalAnimateMarks.filter(i=>{var r;return(r=i==null?void 0:i.animate)===null||r===void 0?void 0:r.isAnimating()}),this._animations=this._animations.filter(i=>i.config!==e.animationConfig||i.mark!==e.mark),this._animations.length===0&&this._additionalAnimateMarks.length===0&&this._view.emit(Lt.ALL_ANIMATION_END,{})},this._view=t,this._view.addEventListener(Lt.ANIMATION_START,this._onAnimationStart),this._view.addEventListener(Lt.ANIMATION_END,this._onAnimationEnd)}stop(){return this._view.traverseMarkTree(t=>{var e,i;t.animate&&((i=(e=t.animate).stop)===null||i===void 0||i.call(e))}),this._additionalAnimateMarks.forEach(t=>{var e,i;t.view&&t.animate&&((i=(e=t.animate).stop)===null||i===void 0||i.call(e))}),this._additionalAnimateMarks=[],this}pause(){return this._view.traverseMarkTree(t=>{var e,i;t.animate&&((i=(e=t.animate).pause)===null||i===void 0||i.call(e))}),this._additionalAnimateMarks.forEach(t=>{var e,i;t.view&&t.animate&&((i=(e=t.animate).pause)===null||i===void 0||i.call(e))}),this}resume(){return this._view.traverseMarkTree(t=>{var e,i;t.animate&&((i=(e=t.animate).resume)===null||i===void 0||i.call(e))}),this._additionalAnimateMarks.forEach(t=>{var e,i;t.view&&t.animate&&((i=(e=t.animate).resume)===null||i===void 0||i.call(e))}),this}enable(){return this.isEnabled=!0,this._view.traverseMarkTree(t=>{var e,i;t.animate&&((i=(e=t.animate).enable)===null||i===void 0||i.call(e))}),this}disable(){return this.isEnabled=!1,this._view.traverseMarkTree(t=>{var e,i;t.animate&&((i=(e=t.animate).disable)===null||i===void 0||i.call(e))}),this._additionalAnimateMarks.forEach(t=>{var e,i;t.view&&t.animate&&((i=(e=t.animate).stop)===null||i===void 0||i.call(e))}),this._additionalAnimateMarks=[],this}enableAnimationState(t){return this._view.traverseMarkTree(e=>{var i,r;e.animate&&((r=(i=e.animate).enableAnimationState)===null||r===void 0||r.call(i,t))}),this}disableAnimationState(t){return this._view.traverseMarkTree(e=>{var i,r;e.animate&&((r=(i=e.animate).disableAnimationState)===null||r===void 0||r.call(i,t))}),this}isAnimating(){return this._animations.length!==0||this._additionalAnimateMarks.some(t=>{var e;return((e=t==null?void 0:t.animate)===null||e===void 0?void 0:e.isAnimating())||!1})}animate(){return this.isEnabled?(this._view.traverseMarkTree(t=>{t.isUpdated&&t.animate&&t.animate.animate(),t.cleanExitElements(),t.isUpdated=!1},null,!0),this):this}animateAddition(t){var e;const i=(e=t.animate)===null||e===void 0?void 0:e.animate();return i&&i.isAnimating()&&this._additionalAnimateMarks.push(t),this}release(){this._additionalAnimateMarks=[],this._animations=[],this._view.removeEventListener(Lt.ALL_ANIMATION_START,this._onAnimationStart),this._view.removeEventListener(Lt.ALL_ANIMATION_END,this._onAnimationEnd),this._view=null}}class dVt{initAnimate(t){return this.animate=new hVt(t),this.animate}}const uVt=()=>{Ye(Zd,dVt)},Bit=(n,t)=>{if(!n)return null;if(n.from){const e=n.from,i=Object.keys(e);i.forEach(s=>{D(e[s])&&delete e[s]});const r=Kw(i,t.mark.markType)&&!L(e.segments);if(r){const s=t.items.map(o=>Object.assign({},o,{nextAttrs:Object.assign({},e)}));n.from=t.transformElementItems(s,t.mark.markType,r)}}if(n.to){const e=n.to,i=Object.keys(e);i.forEach(s=>{D(e[s])&&delete e[s]});const r=Kw(i,t.mark.markType)&&!L(e.segments);if(r){const s=t.items.map(o=>Object.assign({},o,{nextAttrs:Object.assign({},e)}));n.to=t.transformElementItems(s,t.mark.markType,r)}}return n};function cVt(n,t,e,i){const r=it(t.options)?t.options.call(null,n.getDatum(),n,i):t.options;if(!t.type||!dt.getAnimationType(t.type))return null;const s=dt.getAnimationType(t.type)(n,r,e);return Bit(s,n)}const o8=(n,t,e,i,r)=>it(e)?e(n.getDatum(),n,r):e;function gVt(n,t,e,i){const r=t.channel;let s=null;return V(r)?s=r.reduce((o,a)=>(o.from[a]=n.getGraphicAttribute(a,!0),o.to[a]=n.getGraphicAttribute(a,!1),o),{from:{},to:{}}):kt(r)&&(s=Object.keys(r).reduce((o,a)=>{var l,h;const d=!D((l=r[a])===null||l===void 0?void 0:l.from),u=!D((h=r[a])===null||h===void 0?void 0:h.to);return(d||u)&&(o.from[a]=d?o8(n,0,r[a].from,0,i):void 0,o.to[a]=u?o8(n,0,r[a].to,0,i):n.getGraphicAttribute(a,!1)),o},{from:{},to:{}})),Bit(s,n)}class pVt extends fs{constructor(t,e,i,r,s){super(t,e,i,r,s),this._interpolator=s==null?void 0:s.interpolator,this._element=s==null?void 0:s.element}onBind(){var t,e;this.from=(t=this.from)!==null&&t!==void 0?t:{},this.to=(e=this.to)!==null&&e!==void 0?e:{}}getEndProps(){return this.to}onUpdate(t,e,i){this._interpolator&&this._element&&this._interpolator.call(this,e,this.from,this.to,i,this._element.getDatum(),this._element,this.params.parameters)}}class fVt extends fs{getEndProps(){return this.to}onBind(){var t;const e=(t=this.target.constructor.NOWORK_ANIMATE_ATTR)!==null&&t!==void 0?t:ar,i=Object.keys(e).filter(a=>e[a]!==0);this.subAnimate.animate.preventAttrs(i);const r=Object.assign({},this.from),s=Object.assign({},this.to),o=[];Object.keys(s).forEach(a=>{i.includes(a)?(r[a]=s[a],this.from[a]=s[a]):D(r[a])?r[a]=this.target.getComputedAttribute(a):o.push(a)}),this.target.animates.forEach(a=>{a!==this.subAnimate.animate&&a.preventAttrs(o)}),this._fromAttribute=r,this._toAttribute=s}onStart(){if(this._fromAttribute){const t={};Object.keys(this._fromAttribute).forEach(e=>{this.subAnimate.animate.validAttr(e)&&(t[e]=this._fromAttribute[e])}),this.target.setAttributes(t,!1,{type:qi.ANIMATE_UPDATE,animationState:{ratio:0,end:!1}})}}onEnd(){if(this._toAttribute){const t={};Object.keys(this._toAttribute).forEach(e=>{this.subAnimate.animate.validAttr(e)&&(t[e]=this._toAttribute[e])}),this.target.setAttributes(t,!1,{type:qi.ANIMATE_END})}}update(t,e,i){this.updateCount===0&&this.onFirstRun(),this.updateCount+=1;const r=this.step.getLastProps();Object.keys(r).forEach(s=>{this.subAnimate.animate.validAttr(s)&&(i[s]=r[s])}),this.onUpdate(t,e,i),t&&this.onEnd()}onUpdate(t,e,i){this.target.stepInterpolate(this.subAnimate,this.subAnimate.animate,i,this.step,e,t,this._toAttribute,this._fromAttribute)}}M1.mode|=hf.SET_ATTR_IMMEDIATELY;let mVt=0;const a8=n=>{var t;if(D(n)||D(n.prototype))return!1;const e=(t=n.prototype)!==null&&t!==void 0?t:{};return e instanceof fs||"onBind"in e&&"onStart"in e&&"onEnd"in e&&"onUpdate"in e};class vVt{constructor(t,e,i){this.id=mVt++,this.isAnimating=!1,this.runnings=[],this.element=t,this.animationOptions=i,this.unit=e}callback(t){return this.callbackFunction=t,this}animate(t,e){return this.isAnimating=!0,this.animateElement(t,e),this.runnings.length===0&&this.animationEnd(),this}stop(t="end",e=!0){return this.runnings.forEach(i=>i.stop(t)),this.animationEnd(e),this}pause(){return this.runnings.forEach(t=>t.pause()),this}resume(){return this.runnings.forEach(t=>t.resume()),this}startAt(t){return this.runnings.forEach(e=>{const i=this.unit.initialDelay;e.startAt(i+t)}),this}getTotalAnimationTime(){var t;const e=this.unit.initialDelay+this.unit.loopDuration*this.unit.loopCount;return(t=this.unit.totalTime)!==null&&t!==void 0?t:e}getEndAttributes(){return this.runnings.reduce((t,e)=>Object.assign(t,e.getEndProps()),{})}animationEnd(t=!0){var e;this.isAnimating=!1,this.runnings=null,t&&((e=this.callbackFunction)===null||e===void 0||e.call(null))}animateElement(t,e){const i=this.element.getGraphicItem();if(!i)return;const r=i.animate();this.runnings.push(r),r.startAt(this.unit.initialDelay),r.wait(this.unit.loopDelay),this.unit.timeSlices.forEach(s=>{this.animateTimeSlice(r,s,t,e)}),r.wait(this.unit.loopDelayAfter),r.loop(this.unit.loopCount-1),et(this.unit.totalTime)&&setTimeout(()=>{r&&r.stop("end")},this.unit.totalTime),r.onEnd(()=>{this.runnings=this.runnings.filter(s=>s!==r),this.runnings.length===0&&this.animationEnd()})}animateTimeSlice(t,e,i,r){const s=e.delay,o=e.delayAfter,a=e.duration,l=e.effects;if(s>0&&t.wait(s),l.length<0)t.wait(a);else{const h=l.map((d,u)=>{var c;const g=(c=d.type?cVt(this.element,d,i,r):d.channel?gVt(this.element,d,i,r):void 0)!==null&&c!==void 0?c:{},p=g.custom||(d==null?void 0:d.custom),f=(g==null?void 0:g.customParameters)||(d==null?void 0:d.customParameters);g.from&&Object.keys(g.from).length&&this.unit&&this.animationOptions.timeline.controlOptions.immediatelyApply&&this.element.mark.markType!=="component"&&this.element.getGraphicItem().setAttributes(g.from);const m=a8(p);return!D(p)&&!a8(p)?new pVt(g.from,g.to,a,d.easing,{interpolator:p,element:this.element,parameters:f}):m?new p(g.from,g.to,a,d.easing,f):g.to?new fVt(g.from,g.to,a,d.easing):void 0}).filter(d=>!D(d));h.length===1?t.play(h[0]):h.length>1&&t.play(new sBt(a,h))}o>0&&t.wait(o)}}function _Vt(n){var t,e,i,r,s,o,a,l,h,d,u,c;if(D(n.timeSlices)){const p=n;return{startTime:(t=p.startTime)!==null&&t!==void 0?t:XU,totalTime:p.totalTime,oneByOne:(e=p.oneByOne)!==null&&e!==void 0?e:PI,loop:(i=p.loop)!==null&&i!==void 0?i:qU,controlOptions:Z({},ZU,(r=p.controlOptions)!==null&&r!==void 0?r:{}),timeSlices:[{duration:(s=p.duration)!==null&&s!==void 0?s:Ket,delay:(o=p.delay)!==null&&o!==void 0?o:BI,delayAfter:(a=p.delayAfter)!==null&&a!==void 0?a:KU,effects:[{type:p.type,channel:p.channel,custom:p.custom,easing:(l=p.easing)!==null&&l!==void 0?l:EI,customParameters:p.customParameters,options:p.options}]}]}}const g=Q(n.timeSlices).filter(p=>p.effects&&Q(p.effects).filter(f=>f.channel||f.type).length);if(g.length)return{startTime:(h=n.startTime)!==null&&h!==void 0?h:XU,totalTime:n.totalTime,oneByOne:(d=n.oneByOne)!==null&&d!==void 0?d:PI,loop:(u=n.loop)!==null&&u!==void 0?u:qU,controlOptions:Z({},ZU,(c=n.controlOptions)!==null&&c!==void 0?c:{}),timeSlices:g.map(p=>{var f,m;return{duration:p.duration,delay:(f=p.delay)!==null&&f!==void 0?f:BI,delayAfter:(m=p.delayAfter)!==null&&m!==void 0?m:KU,effects:Q(p.effects).filter(v=>v.channel||v.type).map(v=>{var _;return{type:v.type,channel:v.channel,custom:v.custom,easing:(_=v.easing)!==null&&_!==void 0?_:EI,customParameters:v.customParameters,options:v.options}})}}),partitioner:n.partitioner,sort:n.sort}}function l8(n){let t=[];return Object.keys(n).forEach(e=>{t=t.concat(Pit(e,n[e]))}),t}function Pit(n,t,e=0){const i=[];let r=e;return Q(t).forEach(s=>{var o;const a=_Vt(s);a&&(i.push({state:n,id:(o=a.id)!==null&&o!==void 0?o:`${n}-${r}`,timeline:a,originConfig:s}),r+=1)}),i}function Rh(n,t,e){return it(n)?n.call(null,t.getDatum(),t,e):n}class h8{constructor(t){this.parallelArrangers=[this],this.totalTime=0,this.startTime=0,this.endTime=0,this.animators=t.filter(e=>!D(e)),this.totalTime=this.animators.reduce((e,i)=>Math.max(e,i.getTotalAnimationTime()),0)}parallel(t){const e=Array.from(new Set(this.parallelArrangers.concat(t.parallelArrangers)));return e.forEach(i=>{i.parallelArrangers=e}),this.arrangeTime(),this}after(t){return this.afterArranger=t,this.arrangeTime(),this}arrangeTime(){const t=this.parallelArrangers.reduce((i,r)=>Math.max(i,r.totalTime),this.totalTime),e=this.parallelArrangers.reduce((i,r)=>{var s,o;return Math.max(i,(o=(s=r.afterArranger)===null||s===void 0?void 0:s.endTime)!==null&&o!==void 0?o:0)},0);this.parallelArrangers.forEach(i=>{i.startTime=e,i.endTime=e+t,i.animators.forEach(r=>{r.startAt(e)})})}}class d8{constructor(t,e){this.state=null,this.immediateConfigs=[],this.isEnabled=!0,this.disabledStates=[],this.animators=new Map,this.elementRecorder=new WeakMap,this.timelineCount={},this.mark=t,this.configs=l8(e??{})}getAnimationConfigs(t){var e;return this.isEnabled?((e=this.configs)!==null&&e!==void 0?e:[]).filter(i=>i.state===t):[]}updateConfig(t){this.configs=l8(t??{})}updateState(t){this.state=t}animate(){if(!this.isEnabled||!this.configs||!this.configs.length)return;const t=this.mark.getAllElements(),e=this.mark.parameters();return t.forEach(i=>{var r;i.isReserved&&i.diffState!==Ke.exit&&(i.isReserved=!1);const s=(r=this.elementRecorder.get(i))===null||r===void 0?void 0:r.prevState;(this.configs.some(o=>s!==i.diffState&&o.state===s&&o.timeline.controlOptions.stopWhenStateChange)||i.diffState===Ke.exit&&s!==i.diffState)&&this.clearElementAnimation(i,!1)}),this.configs.forEach(i=>{this.animateByTimeline(i,t,e)}),this.mark.cleanExitElements(),this}runAnimationByState(t){if(!this.isEnabled)return;const e=this.configs.filter(o=>o.state===t),i=this.mark.getAllElements(),r=this.mark.parameters(),s=e.reduce((o,a)=>o.concat(this.animateByTimeline(a,i,r,!0)),[]);return new h8(s)}stopAnimationByState(t){const e=this.animators.get(t);return e&&e.forEach(i=>i.stop("end")),this}pauseAnimationByState(t){const e=this.animators.get(t);return e&&e.forEach(i=>i.pause()),this}resumeAnimationByState(t){const e=this.animators.get(t);return e&&e.forEach(i=>i.resume()),this}run(t){if(!this.isEnabled)return;const e=Pit(YU,t,this.immediateConfigs.length);this.immediateConfigs=this.immediateConfigs.concat(e);const i=this.mark.getAllElements(),r=this.mark.parameters(),s=e.reduce((o,a)=>o.concat(this.animateByTimeline(a,i,r,!0)),[]);return new h8(s)}stop(){return this.animators.forEach(t=>{t.forEach(e=>e.stop("end"))}),this}pause(){return this.animators.forEach(t=>t.forEach(e=>e.pause())),this}resume(){return this.animators.forEach(t=>t.forEach(e=>e.resume())),this}reverse(){return this}restart(){return this}record(){return this}recordEnd(){return this}isAnimating(){let t=!1;return this.animators.forEach(e=>{t=t||e.some(i=>i.isAnimating)}),t}isElementAnimating(t){var e;const i=(e=this.elementRecorder.get(t))===null||e===void 0?void 0:e.count;return D(i)||Object.values(i).every(r=>r===0)}getAnimatorCount(){let t=0;return this.animators.forEach(e=>t+=e.length),t}getAllAnimators(){const t=[];return this.animators.forEach(e=>{t.push(...e)}),t}getElementAnimators(t,e){var i;const r=Q(t);let s=[];return e?s=(i=this.animators.get(e))!==null&&i!==void 0?i:[]:this.animators.forEach(o=>{s=s.concat(o)}),s.filter(o=>r.includes(o.element))}enable(){return this.isEnabled=!0,this}disable(){return this.isEnabled=!1,this.stop(),this.animators.clear(),this}enableAnimationState(t){const e=Q(t);return this.disabledStates=this.disabledStates.filter(i=>!e.includes(i)),this}disableAnimationState(t){const e=Q(t);return this.disabledStates=this.disabledStates.concat(e),this}release(){this.stop(),this.animators.clear(),this.configs=null,this.animators=null,this.elementRecorder=null,this.timelineCount=null}animateByTimeline(t,e,i,r=!1){var s;const o=[],a=e.filter(l=>{const h=!(l.isReserved&&l.diffState===Ke.exit),d=this.getAnimationState(l),u=!this.disabledStates.includes(d),c=r||d===t.state,g=!t.timeline.partitioner||t.timeline.partitioner(l.getDatum(),l,i);return h&&u&&c&&g});if(a.length){D(this.timelineCount[t.id])&&(this.timelineCount[t.id]=0),t.timeline.sort&&a.sort((h,d)=>t.timeline.sort(h.getDatum(),d.getDatum(),h,d,i));const l={width:this.mark.view.width(),height:this.mark.view.height(),group:(s=this.mark.group)!==null&&s!==void 0?s:null,mark:this.mark,view:this.mark.view,elementCount:a.length,elementIndex:0};a.forEach(h=>{var d;((d=this.animators.get(t.state))!==null&&d!==void 0?d:[]).filter(u=>u.element===h&&u.animationOptions.id===t.id).forEach(u=>{u.stop(null,!1),this.handleAnimatorEnd(u,!1)})}),a.forEach((h,d)=>{l.elementIndex=d;const u=Object.assign({[vjt]:l},i),c=this.getAnimationUnit(t.timeline,h,d,a.length,u);o.push(this.animateElement(t,c,h,l,u))})}return o}animateElement(t,e,i,r,s){var o,a;const l=new vVt(i,e,t);if(l.animate(r,s),!l.isAnimating)return;i.diffState===Ke.exit&&(i.isReserved=!0);const h=this.timelineCount[t.id]===0;this.timelineCount[t.id]+=1;const d=(o=this.elementRecorder.get(i))!==null&&o!==void 0?o:{prevState:t.state,count:{}};d.prevState=t.state,d.count[t.state]=((a=d.count[t.state])!==null&&a!==void 0?a:0)+1,this.elementRecorder.set(i,d);const u=this.animators.get(t.state);u?u.push(l):this.animators.set(t.state,[l]),l.callback(()=>{this.handleAnimatorEnd(l)});const c={mark:this.mark,animationState:t.state,animationConfig:t.originConfig};return h&&this.mark.emit(Lt.ANIMATION_START,c),this.mark.emit(Lt.ELEMENT_ANIMATION_START,c,i),l}getAnimationState(t){const e=Mn(this.state,this.mark.parameters(),t.getDatum(),t);return e??t.diffState}getAnimationUnit(t,e,i,r,s){const o=[],a=Rh(t.startTime,e,s),l=Rh(t.totalTime,e,s),h=Rh(t.oneByOne,e,s),d=Rh(t.loop,e,s);let u=0;t.timeSlices.forEach(g=>{var p;const f=Rh(g.delay,e,s),m=Rh(g.delayAfter,e,s),v=(p=Rh(g.duration,e,s))!==null&&p!==void 0?p:l/r,_=Q(g.effects).map(b=>Object.assign({},b,{customParameters:Rh(b.customParameters,e,s)}));o.push({effects:_,duration:v,delay:f,delayAfter:m}),u+=f+v+m});const c=J(h)?h:h===!0?u:0;return{initialDelay:a,loopCount:J(d)?d:d===!0?1/0:1,loopDelay:c*i,loopDelayAfter:c*(r-i-1),loopAnimateDuration:u,loopDuration:u+c*(r-1),totalTime:l,timeSlices:o}}clearElementAnimation(t,e=!0){this.animators.forEach(i=>{i.forEach(r=>{r.element===t&&(r.animationOptions.state===Ke.exit?r.stop("start",!1):r.stop("end",!1),this.handleAnimatorEnd(r,e))})}),this.elementRecorder.delete(t)}clearAllElements(){const t=this.mark.getAllElements();t&&t.forEach((e,i)=>{this.clearElement(e,i===t.length-1)})}clearElement(t,e=!0){this.clearElementAnimation(t),t.getGraphicItem()&&(t.clearGraphicAttributes(),t.diffState===Ke.exit&&(t.isReserved=!1),e&&this.mark.cleanExitElements())}handleAnimatorEnd(t,e=!0){const i=t.element,r=t.animationOptions,s=r.state,o=s===YU,a=this.elementRecorder.get(i).count;a[s]-=1,this.animators.set(s,this.animators.get(s).filter(u=>u!==t)),this.animators.get(s).length===0&&this.animators.delete(s),this.timelineCount[r.id]-=1;const l=this.timelineCount[r.id]===0,h=o?this.immediateConfigs.find(u=>u.id===r.id).originConfig:this.configs.find(u=>u.id===r.id).originConfig;l&&(delete this.timelineCount[r.id],o&&(this.immediateConfigs=this.immediateConfigs.filter(u=>u.id!==r.id))),e&&(Object.keys(this.timelineCount).length===0?this.clearAllElements():s===Ke.exit&&a[Ke.exit]===0&&this.clearElement(i));const d={mark:this.mark,animationState:s,animationConfig:h};l&&this.mark.emit(Lt.ANIMATION_END,d),this.mark.emit(Lt.ELEMENT_ANIMATION_END,d,i)}}class bVt{constructor(){this.animate=new d8(this,{})}initAnimate(t){this.animate||(this.animate=new d8(this,t.animation),this.needAnimate()&&this.animate.updateState(t.animationState))}reuseAnimate(t){this.animate=t.animate,this.animate.mark=this}updateAnimate(t){this.animate.updateConfig(t.animation),this.animate.updateState(t.animationState)}}const yVt=()=>{Ye(Zc,bVt)},CVt=()=>{dt.registerStageEventPlugin("gesture",BIt)},SVt=()=>{uVt(),yVt()},xVt=["pointerdown","pointerup","pointerupoutside","pointertap","pointerover","pointermove","pointerenter","pointerleave","pointerout","mousedown","mouseup","mouseupoutside","rightdown","rightup","rightupoutside","click","dblclick","mousemove","mouseover","mouseout","mouseenter","mouseleave","wheel","touchstart","touchend","touchendoutside","touchmove","touchcancel","tap","dragstart","drag","dragenter","dragleave","dragover","dragend","drop","pan","panstart","panend","press","pressup","pressend","pinch","pinchstart","pinchend","swipe"];var Ot;(function(n){n.initialized="initialized",n.rendered="rendered",n.renderFinished="renderFinished",n.animationFinished="animationFinished",n.regionSeriesDataFilterOver="regionSeriesDataFilterOver",n.afterInitData="afterInitData",n.afterInitEvent="afterInitEvent",n.afterInitMark="afterInitMark",n.rawDataUpdate="rawDataUpdate",n.viewDataFilterOver="viewDataFilterOver",n.viewDataUpdate="viewDataUpdate",n.viewDataStatisticsUpdate="viewDataStatisticsUpdate",n.markDeltaYUpdate="markDeltaYUpdate",n.viewDataLabelUpdate="viewDataLabelUpdate",n.scaleDomainUpdate="scaleDomainUpdate",n.scaleUpdate="scaleUpdate",n.dataZoomChange="dataZoomChange",n.drill="drill",n.layoutStart="layoutStart",n.layoutEnd="layoutEnd",n.layoutRectUpdate="layoutRectUpdate",n.playerPlay="playerPlay",n.playerPause="playerPause",n.playerEnd="playerEnd",n.playerChange="playerChange",n.playerForward="playerForward",n.playerBackward="playerBackward",n.scrollBarChange="scrollBarChange",n.brushStart="brushStart",n.brushChange="brushChange",n.brushEnd="brushEnd",n.brushClear="brushClear",n.brushActive="brushActive",n.legendSelectedDataChange="legendSelectedDataChange",n.legendFilter="legendFilter",n.legendItemClick="legendItemClick",n.legendItemHover="legendItemHover",n.legendItemUnHover="legendItemUnHover",n.tooltipShow="tooltipShow",n.tooltipHide="tooltipHide",n.tooltipRelease="tooltipRelease",n.afterResize="afterResize",n.afterRender="afterRender",n.afterLayout="afterLayout"})(Ot||(Ot={}));var Ee;(function(n){n.chart="chart",n.window="window",n.canvas="canvas"})(Ee||(Ee={}));var mi;(function(n){n.vchart="vchart",n.chart="chart",n.model="model",n.mark="mark"})(mi||(mi={}));const iC=[mi.mark,mi.model,mi.chart,mi.vchart],wVt=(n,t,e)=>n.x>=t.x&&n.x<=e.x&&n.y>=t.y&&n.y<=e.y,AVt=(n,t,e)=>{const i=n.getRegionsInIds(Q(t.layout.layoutBindRegionID));return i==null?void 0:i.some(r=>{const s=r.getLayoutRect(),o=r.getLayoutStartPoint();return wVt(e,{x:o.x,y:o.y},{x:s.width+o.x,y:s.height+o.y})})},Eit=(n,t)=>{var e,i;return n===t||!D(n)&&!D(t)&&n.value===t.value&&((e=n.axis)===null||e===void 0?void 0:e.id)===((i=t.axis)===null||i===void 0?void 0:i.id)},MVt=(n,t)=>{const e=n.tooltipFilterRange,i=typeof e=="function"?e({scale:t}):e;return et(i)?[-i,i]:i},II=(n,t,e,i)=>{var r;const s=t.getScale(),o=xr(s.type),a=[],l=t.getOption().getChart().getSeriesInIndex(t.getSpecInfo().seriesIndexes);for(const h of l)if(h.coordinate===e){const d=Q(i(h)),u=(r=h.getViewData())===null||r===void 0?void 0:r.latestData;if(d&&u)if(o){const c=[],g=[];u.forEach((p,f)=>{var m;((m=p[d[0]])===null||m===void 0?void 0:m.toString())===(n==null?void 0:n.toString())&&(c.push(p),g.push(f))}),a.push({series:h,datum:c,key:JB(h,g)})}else if(L(d[1])){const c=[],g=[];u.forEach((p,f)=>{var m;(((m=p[d[0]])===null||m===void 0?void 0:m.toString())===(n==null?void 0:n.toString())||L(p[d[0]])&&L(p[d[1]])&&n>=p[d[0]]&&n<p[d[1]])&&(c.push(p),g.push(f))}),a.push({series:h,datum:c,key:JB(h,g)})}else{const c=t.getSpec(),g=MVt(c,s);let p=[],f=[];if(g)u.forEach((m,v)=>{if(L(m[d[0]])){const _=m[d[0]]-n;_>=g[0]&&_<=g[1]&&(p.push(m),f.push(v))}});else{let m=1/0,v=0;u.forEach((_,b)=>{if(L(_[d[0]])){const y=Math.abs(_[d[0]]-n),C=Math.sign(_[d[0]]-n);y<m?(m=y,p=[_],f=[b],v=C):y===m&&C===v&&(p.push(_),f.push(b))}})}a.push({series:h,datum:p,key:JB(h,f)})}}return a},JB=(n,t)=>`${n.id}_${t.join("_")}`,tA=(n,t,e)=>{const i=n.getAllComponents().filter(r=>r.specKey==="axes"&&t(r)&&AVt(n,r,e));return i.length?i:null},TVt=(n,t)=>{const e=2*Math.PI,i=Ri(t),r=Mi(t);return n<i?n+=Math.ceil((i-n)/e)*e:n>r&&(n-=Math.ceil((n-r)/e)*e),n},Lit=(n,t)=>{if(!n)return null;const e=tA(n,l=>l.getOrient()==="angle",t),i=tA(n,l=>l.getOrient()==="radius",t);if(!(e&&e.length||i&&i.length))return null;const r=[],s=l=>l.getDimensionField()[0],{x:o,y:a}=t;return e&&e.forEach(l=>{var h;const d=l.getScale();if(d&&xr(d.type)){const u=d.domain(),c=d.range(),g=l.getCenter(),p={x:o-l.getLayoutStartPoint().x-g.x,y:a-l.getLayoutStartPoint().y-g.y};let f=SU({x:1,y:0},p);f=TVt(f,c);const m=Vw(p),v=(h=i[0])===null||h===void 0?void 0:h.getScale(),_=v==null?void 0:v.range();if((f-(c==null?void 0:c[0]))*(f-(c==null?void 0:c[1]))>0||(m-(_==null?void 0:_[0]))*(m-(_==null?void 0:_[1]))>0)return;const b=l.invert(f);if(D(b))return;let y=u.findIndex(S=>(S==null?void 0:S.toString())===b.toString());y<0&&(y=void 0);const C=II(b,l,"polar",s);r.push({index:y,value:b,position:d.scale(b),axis:l,data:C})}}),i&&i.forEach(l=>{var h;const d=l.getScale(),u=d==null?void 0:d.range();if(d&&xr(d.type)){const c=l.getCenter(),g={x:o-l.getLayoutStartPoint().x-c.x,y:a-l.getLayoutStartPoint().y-c.y};let p=SU({x:1,y:0},g);p<-Math.PI/2&&(p=2*Math.PI+p);const f=Vw(g),m=(h=e[0])===null||h===void 0?void 0:h.getScale(),v=m==null?void 0:m.range();if((p-(v==null?void 0:v[0]))*(p-(v==null?void 0:v[1]))>0||(f-(u==null?void 0:u[0]))*(f-(u==null?void 0:u[1]))>0)return;const _=d.invert(f);if(D(_))return;let b=d.domain().findIndex(C=>(C==null?void 0:C.toString())===_.toString());b<0&&(b=void 0);const y=II(_,l,"polar",s);r.push({index:b,value:_,position:d.scale(_),axis:l,data:y})}}),r.length?r:null};function xi(n){return n==="bottom"||n==="top"}function Fa(n){return n==="left"||n==="right"}function Ml(n){return n==="z"}function kVt(n,t){return t?xi(n)?"linear":"band":xi(n)?"band":"linear"}function Bu(n,t){return BF(n.orient)||t&&t.includes(n.orient)?n.orient:"left"}function Iit(n){return n==="top"||n==="bottom"?"horizontal":"vertical"}function RVt(n,t){let e=n.inverse;return t&&!xi(n.orient)&&(e=!L(n.inverse)||!n.inverse),e}function u8(n,t){var e;const i=(e=n.type)!==null&&e!==void 0?e:kVt(n.orient,t);return{axisType:i,componentName:`${vt.cartesianAxis}-${i}`}}const Oit=n=>n.fieldX[0],Dit=n=>n.fieldY[0],BVt=n=>{var t;return[n.fieldX[0],(t=n.fieldX2)!==null&&t!==void 0?t:n.fieldX[1]]},PVt=n=>{var t;return[n.fieldY[0],(t=n.fieldY2)!==null&&t!==void 0?t:n.fieldY[1]]},c8=(n,t)=>n?t?Oit:BVt:t?Dit:PVt,Fit=(n,t,e)=>{var i,r;if(!n)return null;const{x:s,y:o}=t,a=(i=tA(n,p=>xi(p.getOrient()),t))!==null&&i!==void 0?i:[],l=(r=tA(n,p=>Fa(p.getOrient()),t))!==null&&r!==void 0?r:[];if(!a.length&&!l.length)return null;const h=new Set,d=new Set,u=new Set;[a,l].forEach(p=>p.forEach(f=>{xr(f.getScale().type)?h.add(f):d.add(f),e&&f.getSpec().hasDimensionTooltip&&u.add(f)}));const c=[],g=p=>{const f=p==="x",m=f?s:o;(f?a:l).forEach(v=>{if(u.size>0){if(u.has(v)){const _=g8(v,m,c8(f,xr(v.getScale().type)));_&&c.push(_)}}else{const _=h.size>0;if((_?h:d).has(v)){const b=g8(v,m,c8(f,_));b&&c.push(b)}}})};return n.getSpec().direction==="horizontal"?(g("y"),c.length===0&&g("x")):(g("x"),c.length===0&&g("y")),c.length?c:null},g8=(n,t,e)=>{const i=n.positionToData(t,!0);return D(i)?null:Hit(n,i,e)},Hit=(n,t,e)=>{const i=n.getScale();if(D(t))return null;let r=i.domain().findIndex(o=>(o==null?void 0:o.toString())===t.toString());r<0&&(r=void 0);const s=II(t,n,"cartesian",e??(xi(n.getOrient())?Oit:Dit));return{index:r,value:t,position:i.scale(t),axis:n,data:s}};class zit{constructor(t,e){this._eventDispatcher=t,this._mode=e}get chart(){var t,e;return this._chart||(this._chart=(e=(t=this._eventDispatcher.globalInstance).getChart)===null||e===void 0?void 0:e.call(t)),this._chart}register(t,e){var i,r;((r=(i=this.chart)===null||i===void 0?void 0:i.getOption().onError)!==null&&r!==void 0?r:h0)("Method not implemented.")}unregister(){var t,e;((e=(t=this.chart)===null||t===void 0?void 0:t.getOption().onError)!==null&&e!==void 0?e:h0)("Method not implemented.")}getTargetDimensionInfo(t,e){var i,r;const s=(i=Fit(this.chart,{x:t,y:e}))!==null&&i!==void 0?i:[],o=(r=Lit(this.chart,{x:t,y:e}))!==null&&r!==void 0?r:[],a=[].concat(s,o);return a.length===0?null:a}dispatch(t,e){var i;const r=(i=this.chart)===null||i===void 0?void 0:i.getAllComponents().filter(l=>l.specKey==="axes"&&(!(e!=null&&e.filter)||e.filter(l))),s=r.filter(l=>{const h=l.getScale();return xr(h.type)}),o=s.length?s:r.filter(l=>{const h=l.getOrient();return xi(h)||h==="angle"}),a=[];return o.forEach(l=>{const h=Hit(l,t);h&&a.push(h)}),this._callback.call(null,{action:"enter",dimensionInfo:a}),a}}class EVt extends zit{constructor(){super(...arguments),this.onClick=t=>{if(!t)return;const e=t.event.viewX,i=t.event.viewY,r=this.getTargetDimensionInfo(e,i);r&&this._callback.call(null,Object.assign(Object.assign({},t),{action:"click",dimensionInfo:r.slice()}))}}register(t,e){this._callback=e.callback,this._eventDispatcher.register("pointertap",{query:Object.assign(Object.assign({},e.query),{source:Ee.chart}),callback:this.onClick})}unregister(){this._eventDispatcher.unregister("pointertap",{query:null,callback:this.onClick})}}class LVt extends zit{constructor(){super(...arguments),this._cacheDimensionInfo=null,this.onMouseMove=t=>{if(!t)return;const e=t.event.viewX,i=t.event.viewY,r=this.getTargetDimensionInfo(e,i);r===null&&this._cacheDimensionInfo!==null?(this._callback.call(null,Object.assign(Object.assign({},t),{action:"leave",dimensionInfo:this._cacheDimensionInfo.slice()})),this._cacheDimensionInfo=r):r===null||this._cacheDimensionInfo!==null&&r.length===this._cacheDimensionInfo.length&&!r.some((s,o)=>!Eit(s,this._cacheDimensionInfo[o]))?r!==null&&this._callback.call(null,Object.assign(Object.assign({},t),{action:"move",dimensionInfo:r.slice()})):(this._callback.call(null,Object.assign(Object.assign({},t),{action:"enter",dimensionInfo:r.slice()})),this._cacheDimensionInfo=r)},this.onMouseOut=t=>{t&&(this._callback.call(null,Object.assign(Object.assign({},t),{action:"leave",dimensionInfo:this._cacheDimensionInfo?this._cacheDimensionInfo.slice():[]})),this._cacheDimensionInfo=null)}}register(t,e){this._callback=e.callback,this._eventDispatcher.register("pointermove",{query:Object.assign(Object.assign({},e.query),{source:Ee.chart}),callback:this.onMouseMove}),this._eventDispatcher.register("pointerout",{query:Object.assign(Object.assign({},e.query),{source:Ee.canvas}),callback:this.onMouseOut}),Pd(this._mode)&&this._eventDispatcher.register("pointerdown",{query:Object.assign(Object.assign({},e.query),{source:Ee.chart}),callback:this.onMouseMove})}unregister(){this._eventDispatcher.unregister("pointermove",{query:null,callback:this.onMouseMove}),Pd(this._mode)&&this._eventDispatcher.unregister("pointerdown",{query:null,callback:this.onMouseMove})}}var rh;(function(n){n.dimensionHover="dimensionHover",n.dimensionClick="dimensionClick"})(rh||(rh={}));const QB={[rh.dimensionHover]:LVt,[rh.dimensionClick]:EVt};let RT=class{getComposedEventMap(){return this._composedEventMap}constructor(t,e){this._composedEventMap=new Map,this._eventDispatcher=t,this._mode=e}on(t,e,i){const r=typeof e=="function"?{query:null,callback:e}:{query:e,callback:i};if(QB[t]){const s=new QB[t](this._eventDispatcher,this._mode);s.register(t,r),this._composedEventMap.set(i,{eventType:t,event:s})}else this._eventDispatcher.register(t,r);return this}off(t,e,i){var r,s;const o=i??e;if(QB[t])if(o)(r=this._composedEventMap.get(o))===null||r===void 0||r.event.unregister(),this._composedEventMap.delete(o);else for(const a of this._composedEventMap.entries())a[1].eventType===t&&((s=this._composedEventMap.get(a[0]))===null||s===void 0||s.event.unregister(),this._composedEventMap.delete(a[0]));else if(o){const a={callback:o,query:null,filter:{nodeName:null,type:t,level:null,source:e.source,markName:null,filter:null,userId:null}};this._eventDispatcher.unregister(t,a)}else this._eventDispatcher.unregister(t);return this}emit(t,e,i){return this._eventDispatcher.dispatch(t,e,i),this}prevent(t,e){return this._eventDispatcher.prevent(t,e),this}allow(t){return this._eventDispatcher.allow(t),this}release(){this._eventDispatcher.clear(),this._composedEventMap.clear()}};class IVt{constructor(){this._map=new Map,this._levelNodes=new Map,this._levelNodes.set(mi.vchart,[]),this._levelNodes.set(mi.chart,[]),this._levelNodes.set(mi.model,[]),this._levelNodes.set(mi.mark,[])}addHandler(t,e){var i;const r={level:e,handler:t};return(i=this._levelNodes.get(e))===null||i===void 0||i.push(r),this._map.set(t.callback,r),this}removeHandler(t){const e=this._map.get(t.callback);if(!e)return this;this._map.delete(t.callback);const i=this._levelNodes.get(e.level),r=i==null?void 0:i.findIndex(s=>s.handler.callback===t.callback);return r!==void 0&&r>=0&&(i==null||i.splice(r,1)),this}preventHandler(t){return t&&(t.prevented=!0),this}allowHandler(t){return t&&(t.prevented=!1),this}getHandlers(t){var e;return((e=this._levelNodes.get(t))===null||e===void 0?void 0:e.map(i=>i.handler))||[]}getAllHandlers(){return Array.from(this._map.values()).map(t=>t.handler)||[]}getCount(){return this._map.size}release(){this._map.clear(),this._levelNodes.clear()}}const p8={cartesianAxis:"axis","cartesianAxis-band":"axis","cartesianAxis-linear":"axis","cartesianAxis-time":"axis",polarAxis:"axis","polarAxis-band":"axis","polarAxis-linear":"axis",discreteLegend:"legend",continuousLegend:"legend",colorLegend:"legend",sizeLegend:"legend"};class OVt{constructor(t,e){this._viewBubbles=new Map,this._windowBubbles=new Map,this._canvasBubbles=new Map,this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this._onDelegate=i=>{var r,s;const o=this.globalInstance.getChart(),a=L(i.modelId)&&(o==null?void 0:o.getModelById(i.modelId))||void 0,l=L(i.markId)&&(o==null?void 0:o.getMarkById(i.markId))||null,h=new Map;let d=(r=i.item)===null||r===void 0?void 0:r.mark;for(d&&L(d.id())&&h.set(d.id(),i.item);d!=null&&d.elements;){const p=d.id();L(p)&&!h.has(p)&&h.set(p,d.elements[0]),d=d.group}const u=Dt(i.event,"target");let c=i.datum;a&&a.modelType==="component"&&(c=(s=a.getDatum(u))!==null&&s!==void 0?s:c);const g={event:i.event,item:i.item,source:i.source,datum:c,itemMap:h,chart:o,model:a,mark:l??void 0,node:Dt(i.event,"target")};this.dispatch(i.type,g)},this._onDelegateInteractionEvent=i=>{const r=this.globalInstance.getChart(),s=i.event;let o=null;s.elements&&(o=s.elements);const a={event:i.event,chart:r,items:o,datums:o&&o.map(l=>l.getDatum())};this.dispatch(i.type,a)},this.globalInstance=t,this._compiler=e}register(t,e){var i,r,s,o,a;this._parseQuery(e);const l=this.getEventBubble(((i=e.filter)===null||i===void 0?void 0:i.source)||Ee.chart),h=this.getEventListeners(((r=e.filter)===null||r===void 0?void 0:r.source)||Ee.chart);if(l.get(t)||l.set(t,new IVt),l.get(t).addHandler(e,(s=e.filter)===null||s===void 0?void 0:s.level),this._isValidEvent(t)&&!h.has(t)){const d=this._onDelegate.bind(this);this._compiler.addEventListener((o=e.filter)===null||o===void 0?void 0:o.source,t,d),h.set(t,d)}else if(this._isInteractionEvent(t)&&!h.has(t)){const d=this._onDelegateInteractionEvent.bind(this);this._compiler.addEventListener((a=e.filter)===null||a===void 0?void 0:a.source,t,d),h.set(t,d)}return this}unregister(t,e){var i,r,s,o;let a=!1;const l=this.getEventBubble(((i=e==null?void 0:e.filter)===null||i===void 0?void 0:i.source)||Ee.chart),h=this.getEventListeners(((r=e==null?void 0:e.filter)===null||r===void 0?void 0:r.source)||Ee.chart);if(e){const d=l.get(t);d==null||d.removeHandler(e),(d==null?void 0:d.getCount())===0&&(d==null||d.release(),l.delete(t),a=!0),!((s=e==null?void 0:e.wrappedCallback)===null||s===void 0)&&s.cancel&&e.wrappedCallback.cancel()}else{const d=l.get(t);d==null||d.release(),l.delete(t),a=!0}if(a&&this._isValidEvent(t)){const d=h.get(t);this._compiler.removeEventListener(((o=e==null?void 0:e.filter)===null||o===void 0?void 0:o.source)||Ee.chart,t,d),h.delete(t)}return this}dispatch(t,e,i){const r=this.getEventBubble(e.source||Ee.chart).get(t);if(!r)return this;let s=!1;if(i){const o=r.getHandlers(i);s=this._invoke(o,t,e)}else{let o=0;for(;!s&&o<iC.length;)s=this._invoke(r.getHandlers(iC[o]),t,e),o++}return this}prevent(t,e){return["canvas","chart","window"].forEach(i=>{const r=this.getEventBubble(i).get(t);r&&r.getAllHandlers().forEach(s=>{e?iC.indexOf(s.filter.level)<iC.indexOf(e.level)&&s.callback!==e.handler&&r.preventHandler(s):r.preventHandler(s)})}),this}allow(t){return["canvas","chart","window"].forEach(e=>{const i=this.getEventBubble(e).get(t);i&&i.getAllHandlers().forEach(r=>i.allowHandler(r))}),this}clear(){[Ee.chart,Ee.window,Ee.canvas].forEach(t=>{const e=this.getEventListeners(t);for(const i of e.entries())this._compiler.removeEventListener(t,i[0],i[1]);e.clear()}),[this._viewBubbles,this._windowBubbles,this._canvasBubbles].forEach(t=>{for(const e of t.values())e.release();t.clear()})}release(){this.clear(),this.globalInstance=null,this._compiler=null}_filter(t,e,i){var r,s,o;if(it(t.filter)&&!t.filter(i)||t.nodeName&&Dt(i,"node.name")!==t.nodeName||t.markName&&((r=i==null?void 0:i.mark)===null||r===void 0?void 0:r.name)!==t.markName)return!1;let a=(s=i.model)===null||s===void 0?void 0:s.type;return p8[a]&&(a=p8[a]),(!t.type||a===t.type)&&!(t.level==="mark"&&!t.type&&!(i!=null&&i.mark))&&!(t.level==="model"&&!t.type&&!(i!=null&&i.model))&&(!L(t.userId)||((o=i.model)===null||o===void 0?void 0:o.userId)===t.userId)}_prepareParams(t,e){if(t.markName&&e.mark&&e.itemMap){const i=e.mark.getProductId(),r=e.itemMap.get(i),s=r==null?void 0:r.getDatum();return Object.assign(Object.assign({},e),{item:r,datum:s})}return Object.assign({},e)}_invoke(t,e,i){return t.map(r=>{var s,o,a;const l=r.filter;if(!r.prevented&&(!r.query||this._filter(l,e,i))){const h=(r.wrappedCallback||r.callback).call(null,this._prepareParams(l,i)),d=h??((s=r.query)===null||s===void 0?void 0:s.consume);return d&&((o=i.event)===null||o===void 0||o.stopPropagation(),(a=i.event)===null||a===void 0||a.preventDefault()),!!d}}).some(r=>r===!0)}_getQueryLevel(t){return t?t.level?t.level:L(t.id)?mi.model:mi.vchart:mi.vchart}_parseQuery(t){var e;const i=t.query;i!=null&&i.throttle?t.wrappedCallback=ha(t.callback,i.throttle):i!=null&&i.debounce&&(t.wrappedCallback=ah(t.callback,i.debounce));let r=this._getQueryLevel(i),s=null,o=Ee.chart,a=null,l=null,h=null;return i!=null&&i.nodeName&&(a=i.nodeName),i!=null&&i.markName&&(l=i.markName),!(i!=null&&i.type)||r!==mi.model&&r!==mi.mark||(s=i.type),i!=null&&i.source&&(o=i.source),L(i==null?void 0:i.id)&&(h=i==null?void 0:i.id,r=mi.model),t.filter={level:r,markName:l,type:s,source:o,nodeName:a,userId:h,filter:(e=i==null?void 0:i.filter)!==null&&e!==void 0?e:null},t}getEventBubble(t){switch(t){case Ee.chart:return this._viewBubbles;case Ee.window:return this._windowBubbles;case Ee.canvas:return this._canvasBubbles;default:return this._viewBubbles}}getEventListeners(t){switch(t){case Ee.chart:return this._viewListeners;case Ee.window:return this._windowListeners;case Ee.canvas:return this._canvasListeners;default:return this._viewListeners}}_isValidEvent(t){return xVt.includes(t)||Object.values(Lt).includes(t)}_isInteractionEvent(t){let e;return t&&(e=t.split(":")[0],e)&&dt.hasInteraction(e)}}function Vt(n,t,e){n.getTransform(t)||n.registerTransform(t,e)}function Xl(n,t,e){n.getParser(t)||n.registerParser(t,e)}const Dc=new Map;let Pg;function DVt(){Pg||(Pg=new Bd,Xl(Pg,"geojson",OJ),Xl(Pg,"topojson",bkt),Vt(Pg,"simplify",gkt))}function FVt(n,t,e={type:"geojson",centroid:!0}){Dc.has(n)&&ls(`map type of '${n}' already exists, will be overwritten.`),DVt();const i=new Ve(Pg),r=Z({},{centroid:!0,simplify:!1},e);e.type==="topojson"?i.parse(t,{type:"topojson",options:r}):i.parse(t,{type:"geojson",options:r});const{simplify:s}=e;s===!0?i.transform({type:"simplify"}):kt(s)&&i.transform({type:"simplify",options:s}),Dc.set(n,i)}function HVt(n){Dc.has(n)?Dc.delete(n):ls(`map type of '${n}' does not exists.`)}function zVt(n){return Dc.get(n)}function f8(n,t=!1){let e=t;return n.latestData instanceof Ve&&(e=!1),e?Pn(n.latestData):n.latestData&&n.latestData.slice()}const BT=(n,t)=>n.length===0?[]:n.length===1?f8(n[0],t==null?void 0:t.deep):n.map(e=>f8(e,t==null?void 0:t.deep));function OI(n,t,e){t=t instanceof Bd?t:n.dataSet,Vt(t,"copyDataView",BT);const i=new Ve(t,e);return i.parse([n],{type:"dataview"}),i.transform({type:"copyDataView",level:oa.copyDataView}),i}function UF(n,t,e=[]){var i;if(n instanceof Ve)return n;const{id:r,values:s=[],fromDataIndex:o,fromDataId:a,transforms:l=[]}=n,h=n.parser?Pn(n.parser):{clone:!0},d=Pn(n.fields);let u;h.clone=h.clone!==!1;const c=e.find(g=>g.name===r);if(c)u=c;else{const g={name:r};if(d&&(g.fields=d),u=new Ve(t,g),typeof a=="string"){const p=e.find(f=>f.name===a);if(!p)return ls(`no data matches fromDataId ${a}`),null;u.parse([p],{type:"dataview"}),u.transform({type:"copyDataView"})}else if(typeof o=="number"){const p=e[o];if(!p)return ls(`no data matches fromDataIndex ${o}`),null;u.parse([p],{type:"dataview"}),u.transform({type:"copyDataView"})}else Array.isArray(s)?u.parse(s,h):!yt(s)||h&&!["csv","dsv","tsv"].includes(h.type)?(u.parse([]),ls("values should be array")):u.parse(s,(i=h)!==null&&i!==void 0?i:{type:"csv"});l&&l.length&&l.forEach(p=>{t.getTransform(p.type)&&u.transform(p)})}return u}function YF(n,t,e){n&&(t.fields&&n.setFields(t.fields,e),n.parseNewData(t.values,t.parser))}var oa;(function(n){n[n.copyDataView=-10]="copyDataView",n[n.treemapFilter=-8]="treemapFilter",n[n.treemapFlatten=-7]="treemapFlatten",n[n.dotObjFlat=-7]="dotObjFlat",n[n.linkDotInfo=-7]="linkDotInfo",n[n.sankeyLayout=-7]="sankeyLayout",n[n.dataZoomFilter=-6]="dataZoomFilter",n[n.legendFilter=-5]="legendFilter"})(oa||(oa={}));var hn;(function(n){n.appear="appear",n.disappear="disappear",n.enter="enter",n.update="update",n.state="state",n.exit="exit",n.normal="normal",n.none="none"})(hn||(hn={}));var fd;(function(n){n.data="data",n.signal="signal",n.mark="mark"})(fd||(fd={}));function WVt(n){switch(n){case an["desktop-browser"]:case an["mobile-browser"]:return"browser";case an.node:case an.worker:return"node";case an.miniApp:case an["desktop-miniApp"]:return"feishu";case an.lynx:return"lynx";case an.wx:return"wx";case an.tt:return"tt";case an.harmony:return"harmony"}return"browser"}var jVt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class NVt{getVGrammarView(){return this._view}getModel(){return this._model}constructor(t,e){this._viewListeners=new Map,this._windowListeners=new Map,this._canvasListeners=new Map,this.isInited=!1,this._released=!1,this._model={[fd.signal]:{},[fd.data]:{},[fd.mark]:{}},this._compileChart=null,this.handleStageRender=()=>{var i,r;(r=(i=this._compileChart)===null||i===void 0?void 0:i.getEvent())===null||r===void 0||r.emit(Ot.afterRender,{chart:this._compileChart})},this._container=t,this._option=e}getRenderer(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer}getCanvas(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer.canvas()}getStage(){var t;return(t=this._view)===null||t===void 0?void 0:t.renderer.stage()}initView(){var t,e,i,r;if(this._released||(this.isInited=!0,this._view))return;const s=new ge((t=this._option.logLevel)!==null&&t!==void 0?t:ks.Error);!((e=this._option)===null||e===void 0)&&e.onError&&s.addErrorHandler((...m)=>{var v,_;(_=(v=this._option)===null||v===void 0?void 0:v.onError)===null||_===void 0||_.call(v,...m)});const o=this._option,{performanceHook:a,autoRefreshDpr:l,dpr:h,mode:d,gestureConfig:u,interactive:c,clickInterval:g,autoPreventDefault:p}=o,f=jVt(o,["performanceHook","autoRefreshDpr","dpr","mode","gestureConfig","interactive","clickInterval","autoPreventDefault"]);this._view=new Zd(Object.assign(Object.assign({width:this._width,height:this._height,container:(i=this._container.dom)!==null&&i!==void 0?i:null,renderCanvas:(r=this._container.canvas)!==null&&r!==void 0?r:null,hooks:a},f),{dpr:h,autoRefresh:L(l)?l:!L(h),mode:WVt(d),autoFit:!1,eventConfig:{gesture:L(u)?u:Pd(d),disable:c===!1,clickInterval:g,autoPreventDefault:p},doLayout:()=>{var m;(m=this._compileChart)===null||m===void 0||m.onLayout(this._view)},logger:s,logLevel:s.level()})),this._setCanvasStyle(),this.getStage().hooks.afterRender.tap("chart-event",this.handleStageRender),c!==!1&&this._viewListeners.forEach(m=>{var v;(v=this._view)===null||v===void 0||v.addEventListener(m.type,m.callback)})}_setCanvasStyle(){if(this._view&&this._container.dom&&!yt(this._container.dom)){this._container.dom.style.display="block",this._container.dom.style.position="relative";const t=this.getCanvas();t&&(t.style.display="block")}}compileInteractions(){var t;if(this._view.removeAllInteractions(),(t=this._interactions)===null||t===void 0?void 0:t.length){const e={};this._interactions.forEach(i=>{var r;if(i.regionId){const s=`${i.regionId}-${i.type}-${(r=i.id)!==null&&r!==void 0?r:""}`,o=e[s];e[s]=o?Object.assign(Object.assign(Object.assign({},o),i),{selector:[...o.selector,...i.selector]}):i}else this._view.interaction(i.type,i)}),Object.keys(e).forEach(i=>{const r=this._view.interaction(e[i].type,e[i]);if(this._compileChart){const s=this._compileChart.getRegionsInIds([e[i].regionId])[0];s&&s.interaction.addVgrammarInteraction(r.getStartState(),r)}})}}compile(t,e){if(this._released)return;const{chart:i}=t;this._compileChart=i,this.initView(),this._view&&(i.compile(),i.afterCompile(),this.updateDepend(),this.compileInteractions())}clearNextRender(){return!!this._nextRafId&&(le.getCancelAnimationFrame()(this._nextRafId),this._nextRafId=null,!0)}clear(t,e=!1){const{chart:i}=t;this.clearNextRender(),i.clear(),this.releaseGrammar(e)}renderNextTick(t){this._released||this._nextRafId||(this._nextRafId=le.getRequestAnimationFrame()(()=>{this._nextRafId=null,this.render(t)}))}render(t){var e,i;this._released||(this.initView(),this._view&&((e=this._view)===null||e===void 0||e.run(t),this.clearNextRender()&&((i=this._view)===null||i===void 0||i.run(t))))}updateViewBox(t,e=!0){this._view&&this._view.renderer.setViewBox(t,e)}resize(t,e,i=!0){this._view&&(this._width=t,this._height=e,this._view.resize(t,e),i&&this.render({morph:!1}))}setBackground(t){var e;(e=this._view)===null||e===void 0||e.background(t)}setSize(t,e){this._width=t,this._height=e,this._view&&(this._view.width(t),this._view.height(e))}setViewBox(t,e=!0){this._view&&this._view.renderer.setViewBox(t,e)}addEventListener(t,e,i){var r,s;if(this._option.interactive!==!1){if(t===Ee.chart){const o=(function(a,l){var h,d,u;const c=(d=(h=l==null?void 0:l.mark)===null||h===void 0?void 0:h.getContext())!==null&&d!==void 0?d:{},g=L(c.modelId)?c.modelId:null,p=L(c.markId)?c.markId:null,f=L(c.modelUserId)?c.modelUserId:null,m=L(c.markUserId)?c.markUserId:null,v={event:a,type:e,source:t,item:l,datum:((u=l==null?void 0:l.getDatum)===null||u===void 0?void 0:u.call(l))||null,markId:p,modelId:g,markUserId:m,modelUserId:f};i.call(null,v)}).bind(this);this._viewListeners.set(i,{type:e,callback:o}),(r=this._view)===null||r===void 0||r.addEventListener(e,o)}else if(t===Ee.window){const o=(function(l){const h={event:l,type:e,source:t,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};i.call(null,h)}).bind(this);this._windowListeners.set(i,{type:e,callback:o});const a=this._getGlobalThis();a==null||a.addEventListener(e,o)}else if(t===Ee.canvas){const o=(function(l){const h={event:l,type:e,source:t,item:null,datum:null,markId:null,modelId:null,markUserId:null,modelUserId:null};i.call(null,h)}).bind(this);this._canvasListeners.set(i,{type:e,callback:o});const a=(s=this.getStage())===null||s===void 0?void 0:s.window;a==null||a.addEventListener(e,o)}}}removeEventListener(t,e,i){var r,s,o,a,l;if(this._option.interactive!==!1){if(t===Ee.chart){const h=(r=this._viewListeners.get(i))===null||r===void 0?void 0:r.callback;h&&((s=this._view)===null||s===void 0||s.removeEventListener(e,h)),this._viewListeners.delete(i)}else if(t===Ee.window){const h=this._getGlobalThis(),d=(o=this._windowListeners.get(i))===null||o===void 0?void 0:o.callback;d&&(h==null||h.removeEventListener(e,d)),this._windowListeners.delete(i)}else if(t===Ee.canvas){const h=(a=this.getStage())===null||a===void 0?void 0:a.window,d=(l=this._canvasListeners.get(i))===null||l===void 0?void 0:l.callback;h&&d&&(h==null||h.removeEventListener(e,d)),this._canvasListeners.delete(i)}}}releaseEvent(){const t=this.getStage();t&&t.hooks.afterRender.unTap("chart-event",this.handleStageRender),this._viewListeners.clear(),this._windowListeners.clear(),this._canvasListeners.clear()}release(){var t;this.clearNextRender(),this.releaseEvent(),this._option=this._container=null,this._releaseModel(),(t=this._view)===null||t===void 0||t.release(),this._view=null,this.isInited=!1,this._compileChart=null,this._released=!0}releaseGrammar(t=!1){var e,i;this._releaseModel(),t&&((e=this._view)===null||e===void 0||e.removeAllGraphicItems()),(i=this._view)===null||i===void 0||i.removeAllGrammars()}_releaseModel(){Object.keys(this._model).forEach(t=>{Object.values(this._model[t]).forEach(e=>{Object.values(e).forEach(i=>{i.removeProduct(!0)})}),this._model[t]={}})}addGrammarItem(t){const e=t.getProduct();if(D(e))return;const i=e.id(),r=t.grammarType;D(this._model[r][i])&&(this._model[r][i]={}),this._model[r][i][t.id]=t}removeGrammarItem(t,e){var i;const r=t.getProduct();if(D(r))return;const s=r.id(),o=t.grammarType,a=this._model[o][s];L(a)&&(delete a[t.id],Object.keys(a).length===0&&delete this._model[o][s]),e||(i=this._view)===null||i===void 0||i.removeGrammar(r)}addInteraction(t){this._interactions||(this._interactions=[]),this._interactions.push(t)}removeInteraction(t){this._interactions&&(this._interactions=this._interactions.filter(e=>e.seriesId!==t))}updateDepend(t){return L(t)&&t.length>0?t.every(e=>e.updateDepend()):(Object.values(this._model).forEach(e=>{Object.values(e).forEach(i=>{const r=Object.values(i),s=r[0].getProduct(),o=r.reduce((a,l)=>l.getDepend().length>0?a.concat(l.getDepend()):a,[]).filter(a=>!!a).map(a=>a.getProduct());s.depend(o)})}),!0)}_getGlobalThis(){var t;return Ua(this._option.mode)?globalThis:(t=this.getStage())===null||t===void 0?void 0:t.window}}var $Vt=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})};function VVt(n="vchart",t){const e=document.createElement("a");e.setAttribute("href",t),e.setAttribute("target","_blank"),e.setAttribute("download",`${n}.png`),e.dispatchEvent(new MouseEvent("click"))}function GVt(n){return new Promise(t=>{n.convertToBlob().then(e=>{const i=new FileReader;i.readAsDataURL(e),i.onload=()=>{t(i.result)}})})}function UVt(n,t){var e;return $Vt(this,void 0,void 0,function*(){if(!n)return"";try{if(OffscreenCanvas!==void 0&&n instanceof OffscreenCanvas)return GVt(n)}catch(i){((e=t==null?void 0:t.onError)!==null&&e!==void 0?e:h0)(`getCanvasDataURL error : ${i.toString()}`)}return n.toDataURL()})}function Jd(n){n.crosshair=Q(n.crosshair||{}).map(t=>Nt({[n.direction==="horizontal"?"yField":"xField"]:{visible:!0,line:{visible:!0,type:"rect"}}},t))}function Wit(n,t,e){var i;const{width:r,height:s}=n;if(L(r)&&L(s))return{width:r,height:s};let o=e.width,a=e.height;const l=t.container,h=t.canvas;if(l){const{width:d,height:u}=AP(l,e.width,e.height);o=d,a=u}else if(h&&Ua(t.mode)){let d;d=yt(h)?le.getElementById(h):h;const{width:u,height:c}=AP(d,e.width,e.height);o=u,a=c}else if(Yd(t.mode)&&(!((i=t.modeParams)===null||i===void 0)&&i.domref)){const d=t.modeParams.domref;o=d.width,a=d.height}return o=r??o,a=s??a,{width:o,height:a}}function Eg(n,...t){const e=i=>t.reduce((r,s)=>r||(s==null?void 0:s[i]),n[i]);return Object.assign(n,{change:e("change"),reCompile:e("reCompile"),reMake:e("reMake"),reRender:e("reRender"),reSize:e("reSize"),reTransformSpec:e("reTransformSpec"),changeTheme:e("changeTheme"),changeBackground:e("changeBackground")}),n}function jit(n,t){return n==="line"||n==="area"||n==="common"&&t.series.every(e=>e.type==="area"||e.type==="line")?{paddingInner:1,paddingOuter:0}:{paddingOuter:0}}var Rt;(function(n){n.STATE_NORMAL="normal",n.STATE_HOVER="hover",n.STATE_HOVER_REVERSE="hover_reverse",n.STATE_DIMENSION_HOVER="dimension_hover",n.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",n.STATE_SELECTED="selected",n.STATE_SELECTED_REVERSE="selected_reverse",n.STATE_SANKEY_EMPHASIS="selected",n.STATE_SANKEY_EMPHASIS_REVERSE="blur"})(Rt||(Rt={}));var Wv;(function(n){n.STATE_HOVER_REVERSE="hover_reverse",n.STATE_DIMENSION_HOVER_REVERSE="dimension_hover_reverse",n.STATE_SELECTED_REVERSE="selected_reverse"})(Wv||(Wv={}));class Sf{constructor(){this._children=[],this._markNameMap={},this._infoMap=new Map}getMarkNameMap(){return this._markNameMap}addMark(t,e){D(t)||(this._children.push(t),this._markNameMap[t.name]=t,this._infoMap.set(t,Z({},Sf.defaultMarkInfo,e)))}removeMark(t){const e=this._children.findIndex(i=>i.name===t);e>=0&&(this._infoMap.delete(this._children[e]),delete this._markNameMap[t],this._children.splice(e,1))}clear(){this._children=[],this._markNameMap={},this._infoMap.clear()}forEach(t){this._children.forEach(t)}includes(t,e){return this._children.includes(t,e)}get(t){return isNaN(Number(t))?this._markNameMap[t]:this._children[t]}getMarks(){return this._children.slice()}getMarksInType(t){const e=Q(t);return this._children.filter(i=>e.includes(i.type))}getMarkInId(t){return this._children.find(e=>e.id===t)}getMarkWithInfo(t){return this._children.find(e=>Object.keys(t).every(i=>t[i]===this._infoMap.get(e)[i]))}}Sf.defaultMarkInfo={};class YVt{get hover(){return this._hover}get select(){return this._select}constructor(t){this._marks=new Sf,this._markReverse=new Sf,this.onHover=e=>{switch(e.action){case"enter":this.interaction.getEventElement(Rt.STATE_DIMENSION_HOVER).forEach(i=>this.interaction.addEventElement(Rt.STATE_DIMENSION_HOVER_REVERSE,i)),this.interaction.clearEventElement(Rt.STATE_DIMENSION_HOVER,!1),this.getEventElement(e).forEach(i=>this.interaction.addEventElement(Rt.STATE_DIMENSION_HOVER,i)),this.interaction.reverseEventElement(Rt.STATE_DIMENSION_HOVER);break;case"leave":this.interaction.clearEventElement(Rt.STATE_DIMENSION_HOVER,!0),e=null}},this._option=t,this.event=this._option.model.getOption().getChart().getEvent(),this.interaction=t.interaction,this.initConfig(t.mode)}setStateKeys(t){}registerMark(t){xt(t.stateStyle[Rt.STATE_DIMENSION_HOVER])||this._marks.addMark(t),xt(t.stateStyle[Rt.STATE_DIMENSION_HOVER_REVERSE])||this._markReverse.addMark(t)}init(){this.initEvent()}release(){this.releaseEvent()}initEvent(){this.event.on(rh.dimensionHover,this.onHover)}releaseEvent(){this.event.release()}initConfig(t){}getEventElement(t,e=!1){const i=[];return t.dimensionInfo.forEach(r=>{r.data.forEach(s=>{(e?this._markReverse:this._marks).getMarks().filter(o=>o.model===s.series&&o.getVisible()).forEach(o=>{const a=o.getProduct();if(!a||!a.elements)return;const l=a.elements.filter(h=>{const d=h.getDatum();let u;return u=V(d)?d.every((c,g)=>c===s.datum[g]):s.datum.some(c=>c===d),e?!u:u});i.push(...l)})})}),i}}function XVt(n,t,e){var i;const r=(i=t[n])===null||i===void 0?void 0:i.style;return KVt(n,r)||it(r)?!0:!(!(r!=null&&r.scale)||r.field===e)}function KVt(n,t){return(n==="fill"||n==="stroke")&&(t==null?void 0:t.gradient)&&(t==null?void 0:t.stops)}const Nit={};Object.values(Rt).forEach(n=>{Nit[n]=!0});function qVt(n){return!!Nit[n]}const ZVt={[Rt.STATE_HOVER]:Rt.STATE_HOVER_REVERSE,[Rt.STATE_SELECTED]:Rt.STATE_SELECTED_REVERSE,[Rt.STATE_DIMENSION_HOVER]:Rt.STATE_DIMENSION_HOVER_REVERSE};function nC(n){return ZVt[n]}class JVt{constructor(){this._stateMarks=new Map,this._stateElements=new Map,this._vgrammarInteractions=new Map,this._disableTriggerEvent=!1}addVgrammarInteraction(t,e){t&&(this._vgrammarInteractions.get(t)?this._vgrammarInteractions.get(t).push(e):this._vgrammarInteractions.set(t,[e]))}static markStateEnable(t,e){return!xt(t.stateStyle[e])}setDisableActiveEffect(t){this._disableTriggerEvent=t}registerMark(t,e){var i;this._stateMarks.has(t)||this._stateMarks.set(t,[]),(i=this._stateMarks.get(t))===null||i===void 0||i.push(e)}getStateMark(t){return this._stateMarks.get(t)}filterEventMark(t,e){var i;return!(!t.mark||!(!((i=this._stateMarks.get(e))===null||i===void 0)&&i.includes(t.mark)))}getEventElement(t){var e;return(e=this._stateElements.get(t))!==null&&e!==void 0?e:[]}getEventElementData(t){return this.getEventElement(t).map(e=>e.getDatum())}exchangeEventElement(t,e){var i;if(this._disableTriggerEvent)return;const r=nC(t);(i=this._stateElements.get(t))===null||i===void 0||i.forEach(s=>{s.removeState(t),r&&this.addEventElement(r,s)}),e.getStates().includes(t)||(e.addState(t),r&&e.removeState(r)),this._stateElements.set(t,[e])}removeEventElement(t,e){var i,r;if(this._disableTriggerEvent)return;e.removeState(t);const s=(r=(i=this._stateElements.get(t))===null||i===void 0?void 0:i.filter(a=>a!==e))!==null&&r!==void 0?r:[];this._stateElements.set(t,s);const o=nC(t);o&&(s.length===0?this.clearEventElement(o,!1):this.addEventElement(o,e))}addEventElement(t,e){var i;if(this._disableTriggerEvent)return;e.getStates().includes(t)||e.addState(t);const r=(i=this._stateElements.get(t))!==null&&i!==void 0?i:[];r.push(e),this._stateElements.set(t,r)}clearEventElement(t,e){var i;if(!this._disableTriggerEvent&&((i=this._stateElements.get(t))===null||i===void 0||i.forEach(r=>{r.removeState(t)}),this._stateElements.set(t,[]),e)){const r=nC(t);r&&this.clearEventElement(r,!1)}}clearAllEventElement(){if(!this._disableTriggerEvent)for(const[t,e]of this._stateElements)e.forEach(i=>{i.clearStates()}),this._stateElements.set(t,[])}reverseEventElement(t){if(this._disableTriggerEvent)return;const e=nC(t);if(!e)return;const i=this.getStateMark(e);if(!i)return;const r=this.getEventElement(t);r.length&&(this.getEventElement(e).length||(r.length===1?i.forEach(s=>{s.getProduct().elements.filter(o=>o!==r[0]).forEach(o=>{this.addEventElement(e,o)})}):i.forEach(s=>{s.getProduct().elements.filter(o=>!r.includes(o)).forEach(o=>{this.addEventElement(e,o)})})))}startInteraction(t,e){const i=this._vgrammarInteractions.get(t);i&&i.forEach(r=>{r.start(e)})}resetInteraction(t,e){const i=this._vgrammarInteractions.get(t);i&&i.forEach(r=>{r.reset(e)})}resetAllInteraction(){for(const[t,e]of this._vgrammarInteractions)e&&e.forEach(i=>{i.reset(null)})}}const Wh=9,Kr=0;var Qe;(function(n){n[n.SeriesGroup=0]="SeriesGroup",n[n.Axis_Grid=50]="Axis_Grid",n[n.CrossHair_Grid=100]="CrossHair_Grid",n[n.Region=450]="Region",n[n.Mark=300]="Mark",n[n.Node=400]="Node",n[n.Axis=100]="Axis",n[n.MarkLine=500]="MarkLine",n[n.MarkArea=100]="MarkArea",n[n.MarkPoint=500]="MarkPoint",n[n.DataZoom=500]="DataZoom",n[n.ScrollBar=500]="ScrollBar",n[n.Player=500]="Player",n[n.Legend=500]="Legend",n[n.CrossHair=500]="CrossHair",n[n.Indicator=500]="Indicator",n[n.Title=500]="Title",n[n.Label=500]="Label",n[n.Brush=500]="Brush",n[n.CustomMark=500]="CustomMark",n[n.Interaction=700]="Interaction"})(Qe||(Qe={}));var aa;(function(n){n[n.Indicator=10]="Indicator",n[n.Region=20]="Region",n[n.Axis=30]="Axis",n[n.DataZoom=40]="DataZoom",n[n.Player=40]="Player",n[n.ScrollBar=40]="ScrollBar",n[n.Legend=50]="Legend",n[n.Title=70]="Title",n[n.CustomMark=70]="CustomMark"})(aa||(aa={}));var wt;(function(n){n[n.Default=0]="Default",n[n.Theme=1]="Theme",n[n.Chart=2]="Chart",n[n.Base_Series=3]="Base_Series",n[n.Series=4]="Series",n[n.Mark=5]="Mark",n[n.User_Chart=6]="User_Chart",n[n.User_Series=7]="User_Series",n[n.User_Mark=8]="User_Mark",n[n.User_SeriesStyle=9]="User_SeriesStyle",n[n.Built_In=99]="Built_In"})(wt||(wt={}));class PT{getOption(){return this._option}constructor(t){this._option=t,this.getCompiler=this._option.getCompiler}getVGrammarView(){var t;return(t=this.getCompiler())===null||t===void 0?void 0:t.getVGrammarView()}release(){this._option=null,this.getCompiler=null}}class XF extends PT{constructor(){super(...arguments),this.id=Kc(),this._compiledProductId=null,this._depend=[]}getProduct(){if(L(this._product))return this._product;const t=this.getVGrammarView(),e=this.getProductId();return L(e)&&L(t)&&(this._product=this._lookupGrammar(e)),this._product}getProductId(){var t;return(t=this._compiledProductId)!==null&&t!==void 0?t:this.generateProductId()}getDepend(){return this._depend}setDepend(...t){this._depend=t}compile(t){this._compileProduct(t),this._afterCompile(t)}_afterCompile(t){var e;L(this._product)&&((e=this.getCompiler())===null||e===void 0||e.addGrammarItem(this))}updateDepend(){if(L(this._product)){const t=this.getDepend().map(e=>e.getProduct()).filter(L);return this._product.depend(t),t.length===this.getDepend().length}return!1}release(){this.removeProduct(),super.release(),this._depend=[]}removeProduct(t){this.getCompiler().removeGrammarItem(this,t),this._product=null,this._compiledProductId=null}}class QVt extends XF{getValue(){return this._value}getUpdateFunc(){return this._updateFunc}constructor(t,e,i,r){super(t),this.grammarType=fd.signal,this.name=e,this._value=i,this._updateFunc=r}updateSignal(t,e){this._value=t,this._updateFunc=e,this.compile()}_compileProduct(){const t=this.getVGrammarView();if(t){if(!this.getProduct()){const e=this.getProductId();this._product=t.signal().id(e),this._compiledProductId=e}L(this._value)&&this._product.value(this._value),L(this._updateFunc)&&this._product.update(this._updateFunc)}}generateProductId(){return this.name}_lookupGrammar(t){var e;return(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getSignalById(t)}}class tGt extends PT{constructor(){super(...arguments),this._signalMap={}}getSignalMap(){return this._signalMap}getSignal(t){return this._signalMap[t]}updateSignal(t,e,i){this._signalMap[t]?this._signalMap[t].updateSignal(e,i):(this._signalMap[t]=new QVt(this._option,t,e,i),this._signalMap[t].compile())}compile(){Object.values(this._signalMap).forEach(t=>{t.compile()})}release(){super.release(),Object.values(this._signalMap).forEach(t=>{t.release()}),this._signalMap={}}}class $it extends tGt{getStateMap(){return this._stateMap}_getDefaultStateMap(){return{}}constructor(t){super(t),t.stateKeyToSignalName?this.stateKeyToSignalName=t.stateKeyToSignalName:this.stateKeyToSignalName=()=>"state_signal",this.initStateMap()}initStateMap(t){this._stateMap=t??this._getDefaultStateMap()}compile(t){const e=t??this._stateMap;Object.keys(e).forEach(i=>{const r=this.stateKeyToSignalName(i),s=e[i];this.updateSignal(r,s)})}updateState(t,e){if(t&&(Z(this._stateMap,t),this.compile(t),!e))return this.getCompiler().renderNextTick()}}class Vit extends $it{constructor(){super(...arguments),this.id=Kc(),this.stateKeyToSignalName=t=>`${Wt}_animate_${this.id}_${t}`}getAnimationStateSignalName(){return this.stateKeyToSignalName("animationState")}updateAnimateState(t,e){t===hn.update?this.updateState({animationState:{callback:(i,r)=>r.diffState}},e):t===hn.appear?this.updateState({animationState:{callback:(i,r)=>r.diffState==="exit"?hn.none:hn.appear}},e):this.updateState({animationState:{callback:(i,r)=>t}},e)}_getDefaultStateMap(){return{animationState:{callback:(t,e)=>e.diffState==="exit"?hn.exit:e.diffState==="update"?hn.update:hn.appear}}}}class ET{constructor(t){this._option=t,this.type=t.type}_initTheme(t,e){return this._theme=this.getTheme(t,e),this._mergeThemeToSpec(t,e)}getTheme(t,e){}transformSpec(t,e,i){this._transformSpecBeforeMergingTheme(t,e,i);const r=this._initTheme(t,e);return this._transformSpecAfterMergingTheme(r.spec,e,i),r}_transformSpecBeforeMergingTheme(t,e,i){}_transformSpecAfterMergingTheme(t,e,i){}_mergeThemeToSpec(t,e){const i=this._theme;if(this._shouldMergeThemeToSpec()){const r=this._getDefaultSpecFromChart(e),s=o=>Nt({},i,r,o);return V(t)?{spec:t.map(o=>s(o)),theme:i}:{spec:s(t),theme:i}}return{spec:t,theme:i}}_shouldMergeThemeToSpec(){return!0}_getDefaultSpecFromChart(t){}}class KF extends PT{getSpec(){return this._spec||{}}getSpecPath(){var t;return(t=this._option)===null||t===void 0?void 0:t.specPath}getSpecInfoPath(){var t,e,i;return(e=(t=this._option)===null||t===void 0?void 0:t.specInfoPath)!==null&&e!==void 0?e:(i=this._option)===null||i===void 0?void 0:i.specPath}getData(){return this._data}get layout(){return this._layout}getOption(){return this._option}getMarks(){var t,e;return(e=(t=this._marks)===null||t===void 0?void 0:t.getMarks())!==null&&e!==void 0?e:[]}getMarkNameMap(){var t;return(t=this._marks)===null||t===void 0?void 0:t.getMarkNameMap()}getMarkSet(){return this._marks}getChart(){return this._option.getChart()}get _theme(){var t;return(t=this.getSpecInfo())===null||t===void 0?void 0:t.theme}constructor(t,e){var i;super(e),this.transformerConstructor=ET,this.type="null",this.modelType="null",this.userId=void 0,this._data=null,this._layout=null,this.specKey="",this._marks=new Sf,this._lastLayoutRect=null,this.id=Kc(),this.userId=t.id,this._spec=t,this.effect={},this.event=new RT(e.eventDispatcher,e.mode),(i=e.map)===null||i===void 0||i.set(this.id,this)}_releaseEvent(){this.event.release()}created(){this.setAttrFromSpec()}init(t){}afterInit(){}getVisible(){var t;return((t=this._spec)===null||t===void 0?void 0:t.visible)!==!1}onLayoutStart(t,e,i){var r;(r=this._layout)===null||r===void 0||r.onLayoutStart(t,e,i)}onLayoutEnd(t){var e;(e=this._layout)===null||e===void 0||e.onLayoutEnd(t),this.getMarks().forEach(i=>i.updateLayoutState(!0,!0))}onEvaluateEnd(t){}onDataUpdate(){}beforeRelease(){}clear(){this.getMarks().forEach(t=>{var e;return(e=t.clear)===null||e===void 0?void 0:e.call(t)})}release(){var t;this._releaseEvent(),this._spec=void 0,this.getMarks().forEach(e=>e.release()),(t=this._data)===null||t===void 0||t.release(),this._data=null,this._marks.clear(),super.release()}updateSpec(t){const e=this._compareSpec(t,this._spec);return this._spec=t,e}_compareSpec(t,e){return{change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1}}reInit(t){t&&(this._spec=t),this.setAttrFromSpec()}updateLayoutAttribute(){}setAttrFromSpec(){var t;(t=this._layout)===null||t===void 0||t.setAttrFromSpec(this._spec,this._option.getChartViewRect())}_convertMarkStyle(t){return Object.assign({},t)}setMarkStyle(t,e,i,r){L(t)&&L(e)&&t.setStyle(this._convertMarkStyle(e),i,r)}initMarkStyleWithSpec(t,e,i){if(!L(t)||!L(e))return;const{style:r,state:s}=e,o=Object.assign({},e);r&&(o.style=this._convertMarkStyle(r)),s&&(o.state={},Object.keys(s).forEach(a=>{o.state[a]=this._convertMarkStyle(s[a])})),t.initStyleWithSpec(o,i)}stateKeyToSignalName(t,e){let i=`${Wt}_${this.modelType}_${this.type}_${this.id}_${t}`;return e&&(i+=`_${e}`),i}compileData(){var t;(t=this._data)===null||t===void 0||t.compile()}compileMarks(t){this.getMarks().forEach(e=>{e.compile({group:t})})}_createMark(t,e={},i){const{type:r,name:s}=t,o=q.createMark(r,s,Object.assign({model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._option.globalScale},e));return o&&(o.created(),i&&o.setMarkConfig(i)),o}_getDataIdKey(){}getColorScheme(){var t,e;return(e=(t=this._option).getTheme)===null||e===void 0?void 0:e.call(t).colorScheme}getSpecInfo(){var t,e,i;const r=(i=(e=(t=this._option).getSpecInfo)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:{};return YWt(r,this.getSpecInfoPath())}getSpecIndex(){const t=this.getSpecPath();if(!(t!=null&&t.length))return 0;const e=Number(t[t.length-1]);return isNaN(e)?0:e}}class eGt{getSpec(){return this._spec||{}}getLayoutStartPoint(){return this._layoutStartPoint}get layoutRectLevelMap(){return this._layoutRectLevelMap}get minWidth(){return this._minWidth}set minWidth(t){this._minWidth=t}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth=t}get minHeight(){return this._minHeight}set minHeight(t){this._minHeight=t}get maxHeight(){return this._maxHeight}set maxHeight(t){this._maxHeight=t}getLastComputeOutBounds(){return this._lastComputeOutBounds}get layoutOrient(){return this._layoutOrient}set layoutOrient(t){this._layoutOrient=t}get model(){return this._model}get type(){return this._model.type}constructor(t,e){var i;this.layoutClip=!1,this.autoIndent=!1,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:0,height:0},this._layoutRectLevelMap={width:Kr,height:Kr},this._minWidth=null,this._maxWidth=null,this._minHeight=null,this._maxHeight=null,this._lastComputeRect=null,this._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0},this.getLayoutRect=()=>this._layoutRect,this.layoutType="normal",this._layoutOrient="left",this.layoutPaddingLeft=0,this.layoutPaddingTop=0,this.layoutPaddingRight=0,this.layoutPaddingBottom=0,this.layoutOffsetX=0,this.layoutOffsetY=0,this.layoutLevel=aa.Region,this._model=t,this._option=e,this.layoutLevel=e.layoutLevel,this.layoutType=e.layoutType,e.layoutOrient&&(this.layoutOrient=e.layoutOrient),this._spec=(i=t==null?void 0:t.getSpec)===null||i===void 0?void 0:i.call(t)}_setLayoutAttributeFromSpec(t,e){var i,r,s,o;if(this._spec&&this._spec.visible!==!1){const a=Id(t.padding),l=Bet(a,e,e);this.layoutPaddingLeft=l.left,this.layoutPaddingRight=l.right,this.layoutPaddingTop=l.top,this.layoutPaddingBottom=l.bottom,this._minHeight=D(t.minHeight)?(i=this._minHeight)!==null&&i!==void 0?i:null:Gi(t.minHeight,e.height,e),this._maxHeight=D(t.maxHeight)?(r=this._maxHeight)!==null&&r!==void 0?r:null:Gi(t.maxHeight,e.height,e),this._minWidth=D(t.minWidth)?(s=this._minWidth)!==null&&s!==void 0?s:null:Gi(t.minWidth,e.width,e),this._maxWidth=D(t.maxWidth)?(o=this._maxWidth)!==null&&o!==void 0?o:null:Gi(t.maxWidth,e.width,e),t.width&&this.setLayoutRect({width:Gi(t.width,e.width,e)},{width:Wh}),t.height&&this.setLayoutRect({height:Gi(t.height,e.height,e)},{height:Wh}),D(t.offsetX)||(this.layoutOffsetX=Gi(t.offsetX,e.width,e)),D(t.offsetY)||(this.layoutOffsetY=Gi(t.offsetY,e.height,e)),t.alignSelf&&(this.alignSelf=t.alignSelf)}}setAttrFromSpec(t,e){var i,r,s,o;this._spec=t,this.layoutType=(i=t.layoutType)!==null&&i!==void 0?i:this.layoutType,this.layoutLevel=(r=t.layoutLevel)!==null&&r!==void 0?r:this.layoutLevel,this.layoutOrient=(s=t.orient)!==null&&s!==void 0?s:this.layoutOrient,this._setLayoutAttributeFromSpec(t,e),this.layoutClip=(o=t.clip)!==null&&o!==void 0?o:this.layoutClip}onLayoutStart(t,e,i){this._setLayoutAttributeFromSpec(this._spec,e)}onLayoutEnd(t){}_getAbsoluteSpecValue(t){const e={top:null,bottom:null,left:null,right:null};return["top","bottom","left","right"].forEach(i=>{D(this._spec[i])||(e[i]=Gi(this._spec[i],i==="top"||i==="bottom"?t.height:t.width,t))}),e}absoluteLayoutInRect(t){const{top:e,bottom:i,left:r,right:s}=this._getAbsoluteSpecValue(t),o={width:t.width-this.layoutPaddingLeft-this.layoutPaddingRight,height:t.height-this.layoutPaddingTop-this.layoutPaddingBottom};D(r)||(o.width-=r),D(s)||(o.width-=s),D(e)||(o.height-=e),D(i)||(o.height-=i),this.setLayoutRect(o);const{width:a,height:l}=this.computeBoundsInRect(this.getLayoutRect());this.setLayoutRect({width:a,height:l});const h={x:t.x,y:t.y};this._spec.center===!0?(h.x=t.x+.5*t.width-.5*a,h.y=t.y+.5*t.height-.5*l):(D(r)?D(s)||(h.x=t.x+t.width-this.layoutPaddingRight-s-a):h.x=t.x+r+this.layoutPaddingLeft,D(e)?D(i)||(h.y=t.y+t.height-this.layoutPaddingBottom-i-l):h.y=t.y+e+this.layoutPaddingTop),this.setLayoutStartPosition(h)}setLayoutStartPosition(t){var e,i;this._option.transformLayoutPosition&&(t=this._option.transformLayoutPosition(t)),et(t.x)&&(this._layoutStartPoint.x=t.x),et(t.y)&&(this._layoutStartPoint.y=t.y),(i=(e=this._model).afterSetLayoutStartPoint)===null||i===void 0||i.call(e,this._layoutStartPoint)}setLayoutRect({width:t,height:e},i){var r,s,o,a;et(t)&&((r=i==null?void 0:i.width)!==null&&r!==void 0?r:Kr)>=this._layoutRectLevelMap.width&&(this._layoutRect.width=t,this._layoutRectLevelMap.width=(s=i==null?void 0:i.width)!==null&&s!==void 0?s:Kr),et(e)&&((o=i==null?void 0:i.height)!==null&&o!==void 0?o:Kr)>=this._layoutRectLevelMap.height&&(this._layoutRect.height=e,this._layoutRectLevelMap.height=(a=i==null?void 0:i.height)!==null&&a!==void 0?a:Kr),this.setRectInSpec(this._layoutRect)}getLayout(){return{x:this._layoutStartPoint.x,y:this._layoutStartPoint.y,width:this._layoutRect.width,height:this._layoutRect.height}}mergeLayoutRect({width:t,height:e}){const i={width:t,height:e};return this._layoutRectLevelMap.width>Kr&&(i.width=this._layoutRect.width),this._layoutRectLevelMap.height>Kr&&(i.height=this._layoutRect.height),i}getOrientPosAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"x":"y"}getOrientSizeAttribute(){return this._layoutOrient==="bottom"||this._layoutOrient==="top"?"width":"height"}changeBoundsBySetting(t){return this._layoutRectLevelMap.width>Kr&&(t.x2=t.x1+this._layoutRect.width),this._layoutRectLevelMap.height>Kr&&(t.y2=t.y1+this._layoutRect.height),t.x1-=this._layoutStartPoint.x,t.x2-=this._layoutStartPoint.x,t.y1-=this._layoutStartPoint.y,t.y2-=this._layoutStartPoint.y,t}setRectInSpec(t){const e=Object.assign({},t);return this._layoutRectLevelMap.width<Wh?(D(this._minWidth)||(e.width=Math.max(e.width,this._minWidth)),D(this._maxWidth)||(e.width=Math.min(e.width,this._maxWidth))):e.width=this._layoutRect.width,this._layoutRectLevelMap.height<Wh?(D(this._minHeight)||(e.height=Math.max(e.height,this._minHeight)),D(this._maxHeight)||(e.height=Math.min(e.height,this._maxHeight))):e.height=this._layoutRect.height,e}computeBoundsInRect(t){if(this._lastComputeRect=t,!(this.layoutType!=="region-relative"&&this.layoutType!=="region-relative-overlap"||(this._layoutRectLevelMap.width!==Wh||this.layoutOrient!=="left"&&this.layoutOrient!=="right")&&(this._layoutRectLevelMap.height!==Wh||this.layoutOrient!=="bottom"&&this.layoutOrient!=="top")))return this._layoutRect;const e=Object.assign({},this._model.getBoundsInRect(this.setRectInSpec(t),t));this.changeBoundsBySetting(e),this.autoIndent&&e.x2-e.x1>0&&e.y2-e.y1>0&&(this._lastComputeOutBounds.x1=Math.ceil(-e.x1),this._lastComputeOutBounds.x2=Math.ceil(e.x2-t.width),this._lastComputeOutBounds.y1=Math.ceil(-e.y1),this._lastComputeOutBounds.y2=Math.ceil(e.y2-t.height));let i=this.setRectInSpec(L3t(e,t));return this._option.transformLayoutRect&&(i=this._option.transformLayoutRect(i)),i}getModelId(){return this._model.id}getModelVisible(){return this._model.getVisible()}}class Git extends KF{constructor(){super(...arguments),this.layoutType="normal",this.layoutLevel=0,this.layoutZIndex=0,this._forceLayoutTag=!1,this._layout=null,this._orient=null,this._layoutRect={width:0,height:0},this._layoutStartPos={x:0,y:0},this._isLayout=!0,this.getGraphicBounds=()=>this._layout?{x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}:{x1:0,x2:0,y1:0,y2:0},this._transformLayoutRect=null,this._transformLayoutPosition=null}get layoutOrient(){return this._orient}set layoutOrient(t){this._orient=t,this._layout&&(this._layout.layoutOrient=t)}initLayout(){this.layoutType!=="none"&&(this._layout=new eGt(this,{layoutType:this.layoutType,layoutLevel:this.layoutLevel,layoutOrient:this._orient,transformLayoutRect:this._transformLayoutRect,transformLayoutPosition:this._transformLayoutPosition}),this._orient&&this._orient!=="radius"&&this._orient!=="angle"&&this._layout&&(this._layout.layoutOrient=this._orient))}onLayoutStart(t,e,i){this._isLayout=!0,super.onLayoutStart(t,e,i)}onLayoutEnd(t){super.onLayoutEnd(t),this.updateLayoutAttribute();const e=this.getLayoutRect();!this._forceLayoutTag&&Oe(this._lastLayoutRect,e)||(this._lastLayoutRect=Object.assign({},e)),this._forceLayoutTag=!1,this._isLayout=!1}afterSetLayoutStartPoint(t){}_forceLayout(){var t;this._isLayout||(this._forceLayoutTag=!0,(t=this._option.globalInstance.getChart())===null||t===void 0||t.setLayoutTag(!0))}getLayoutStartPoint(){return this._layout?this._layout.getLayoutStartPoint():this._layoutStartPos}setLayoutStartPosition(t){return this._layout?this._layout.setLayoutStartPosition(t):this._layoutStartPos=Z(this._layoutStartPos,t)}getLayoutRect(){return this._layout?this._layout.getLayoutRect():this._layoutRect}setLayoutRect(t,e){return this._layout?this._layout.setLayoutRect(t):this._lastLayoutRect=Z(this._layoutRect,t)}getLastComputeOutBounds(){var t;return(t=this._layout)===null||t===void 0?void 0:t.getLastComputeOutBounds()}setAttrFromSpec(){var t,e,i,r,s;super.setAttrFromSpec(),this.layoutClip=(t=this._spec.clip)!==null&&t!==void 0?t:this.layoutClip,this.layoutZIndex=(e=this._spec.zIndex)!==null&&e!==void 0?e:this.layoutZIndex,this.layoutType=(i=this._spec.layoutType)!==null&&i!==void 0?i:this.layoutType,this._orient=(r=this._spec.orient)!==null&&r!==void 0?r:this._orient,this.layoutLevel=(s=this._spec.layoutLevel)!==null&&s!==void 0?s:this.layoutLevel}}class Uit extends ET{_initTheme(t,e){return{spec:t,theme:this._theme}}}class Np extends Git{getMaxWidth(){return this._layout.maxWidth}setMaxWidth(t){this._layout.maxWidth=t}getMaxHeight(){return this._layout.maxHeight}setMaxHeight(t){this._layout.maxHeight=t}getGroupMark(){return this._groupMark}getInteractionMark(){return this._interactionMark}getStackInverse(){return this._spec.stackInverse===!0}getStackSort(){return this._spec.stackSort===!0}constructor(t,e){var i;super(t,e),this.transformerConstructor=Uit,this.modelType="region",this.specKey="region",this.type=Np.type,this._series=[],this.layoutType="region",this.layoutZIndex=Qe.Region,this.interaction=new JVt,this.seriesDataFilterOver=()=>{this.event.emit(Ot.regionSeriesDataFilterOver,{model:this,chart:this.getChart()}),this._series.forEach(r=>{r.getViewDataFilter()&&r.reTransformViewData()})},this.getBoundsInRect=()=>({x1:this._layout.getLayoutStartPoint().x,y1:this._layout.getLayoutStartPoint().y,x2:this._layout.getLayoutStartPoint().x+this._layout.getLayoutRect().width,y2:this._layout.getLayoutStartPoint().y+this._layout.getLayoutRect().height}),this.userId=t.id,this.coordinate=(i=t.coordinate)!==null&&i!==void 0?i:"cartesian",this._option.animation&&(this.animate=new Vit({getCompiler:e.getCompiler})),this.interaction.setDisableActiveEffect(this._option.disableTriggerEvent)}_getClipDefaultValue(){var t,e,i,r;const s=this._option.getChart().getSpec(),o=(e=(t=s.dataZoom)===null||t===void 0?void 0:t.some)===null||e===void 0?void 0:e.call(t,l=>{var h;return((h=l.filterMode)!==null&&h!==void 0?h:"filter")==="axis"}),a=(r=(i=s.scrollBar)===null||i===void 0?void 0:i.some)===null||r===void 0?void 0:r.call(i,l=>{var h;return((h=l.filterMode)!==null&&h!==void 0?h:"axis")==="axis"});return!(!o&&!a)||this._layout.layoutClip}created(){var t,e;this.initLayout(),super.created();const i=(t=this._spec.clip)!==null&&t!==void 0?t:this._getClipDefaultValue();this._groupMark=this._createGroupMark("regionGroup",this.userId,this.layoutZIndex),this._spec.roam&&this._groupMark.setMarkConfig({interactive:!0}),this._interactionMark=this._createGroupMark("regionInteractionGroup",((e=this.userId)!==null&&e!==void 0?e:this.type)+"_interaction",Qe.Interaction),xt(this._spec.style)||(this._backgroundMark=this._createMark({type:"rect",name:"regionBackground"}),i&&(this._foregroundMark=this._createMark({type:"rect",name:"regionForeground"})),[this._backgroundMark,this._foregroundMark].forEach(r=>{r&&(r.created(),this.setMarkStyle(r,{width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height},"normal",wt.Built_In),this._groupMark.addMark(r))}),this._backgroundMark&&this._backgroundMark.setMarkConfig({zIndex:Qe.SeriesGroup-1}),this._foregroundMark&&this._foregroundMark.setMarkConfig({zIndex:Qe.Mark+1})),this.createTrigger()}_createGroupMark(t,e,i){var r,s;const o=this._createMark({type:"group",name:t});o.setUserId(e),o.setMarkConfig({zIndex:i});const a=(r=this._spec.clip)!==null&&r!==void 0?r:this._getClipDefaultValue();return this.setMarkStyle(o,{x:()=>this.getLayoutStartPoint().x,y:()=>this.getLayoutStartPoint().y,width:()=>this.getLayoutRect().width,height:()=>this.getLayoutRect().height,clip:a},"normal",wt.Built_In),this.setMarkStyle(o,{cornerRadius:(s=this._spec.style)===null||s===void 0?void 0:s.cornerRadius},"normal",wt.User_Mark),this._marks.addMark(o),o}init(t){super.init(t),this.initMark(),this.initSeriesDataflow(),this.initInteraction(),this.initTrigger()}initMark(){this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}_initBackgroundMarkStyle(){var t,e;this._backgroundMark&&(this.setMarkStyle(this._backgroundMark,Object.assign({fillOpacity:!((t=this._spec.style)===null||t===void 0)&&t.fill?1:0},this._spec.style),"normal",wt.User_Mark),((e=this._spec.clip)!==null&&e!==void 0?e:this._getClipDefaultValue())&&this.setMarkStyle(this._backgroundMark,{strokeOpacity:0},"normal",wt.Built_In))}_initForegroundMarkStyle(){this._foregroundMark&&this.setMarkStyle(this._foregroundMark,Object.assign(Object.assign({},this._spec.style),{fillOpacity:0,pickable:!1}),"normal",wt.User_Mark)}_compareSpec(t,e){const i=super._compareSpec(t,e);return Oe(e==null?void 0:e.style,t==null?void 0:t.style)||(i.reMake=!0),i}reInit(t){super.reInit(t),this._initBackgroundMarkStyle(),this._initForegroundMarkStyle()}addSeries(t){t&&(this._series.includes(t)||this._series.push(t))}removeSeries(t){if(!t)return;const e=this._series.findIndex(i=>i===t);e>=0&&this._series.splice(e,1)}getSeries(t={}){return this._series.filter(e=>{var i,r;return(!t.name||(e==null?void 0:e.name)===t.name)&&(!t.userId||Q(t.userId).includes(e.userId))&&(!L(t.specIndex)||Q(t.specIndex).includes(e.getSpecIndex()))&&(!t.id||e.id===t.id)&&(!t.type||e.type===t.type)&&(!t.coordinateType||e.coordinate===t.coordinateType)&&(!t.dataName||((r=(i=e.getRawData)===null||i===void 0?void 0:i.call(e))===null||r===void 0?void 0:r.name)===t.dataName)})}getSeriesInName(t){return this.getSeries({name:t})[0]}getSeriesInUserId(t){return this.getSeries({userId:t})[0]}getSeriesInId(t){return this.getSeries({id:t})[0]}getSeriesInType(t){return this.getSeries({type:t})}getSeriesInCoordinateType(t){return this.getSeries({coordinateType:t})}getSeriesInDataName(t){return this.getSeries({dataName:t})}onRender(t){}initSeriesDataflow(){const t=this._series.map(e=>{var i;return(i=e.getViewDataFilter())!==null&&i!==void 0?i:e.getViewData()}).filter(e=>!!e);this._option.dataSet.multipleDataViewAddListener(t,"change",this.seriesDataFilterOver)}release(){super.release(),this._series=[]}createTrigger(){const t=Object.assign(Object.assign({},this._option),{model:this,interaction:this.interaction});this._trigger=new YVt(t)}initTrigger(){this._series.forEach(t=>{t.getMarksWithoutRoot().forEach(e=>{this._trigger.registerMark(e)})}),this._trigger.init()}initInteraction(){this._option.disableTriggerEvent||this._series.forEach(t=>{t.getMarksWithoutRoot().forEach(e=>{for(const i in Wv)xt(e.stateStyle[Wv[i]])||this.interaction.registerMark(Wv[i],e)})})}compileMarks(t){this.getMarks().forEach(e=>{var i;e.compile({group:t,context:{model:this}}),(i=e.getProduct())===null||i===void 0||i.layout((r,s,o,a)=>{})})}compile(){var t;(t=this.animate)===null||t===void 0||t.compile(),this.compileMarks()}onLayoutEnd(t){this._series.forEach(e=>e.onLayoutEnd(t)),super.onLayoutEnd(t)}}Np.type="region",Np.transformerConstructor=Uit,Np.specKey="region";function LT(n){const t=[],e=[],i=[];return n.forEach(r=>{D(r.getSpec().position)||r.getSpec().position==="start"?t.push(r):r.getSpec().position==="middle"?e.push(r):r.getSpec().position==="end"&&i.push(r)}),{startItems:t,endItems:i,middleItems:e}}function Yit(n,t,e){t?n.forEach(i=>{const r=de(i),s=r.getLayoutStartPoint().y+r.getLayoutRect().height-i[0].getLayoutStartPoint().y,o=(e-s)/2;i.forEach(a=>{a.setLayoutStartPosition({x:a.getLayoutStartPoint().x,y:a.getLayoutStartPoint().y+o})})}):n.forEach(i=>{const r=de(i),s=r.getLayoutStartPoint().x+r.getLayoutRect().width-i[0].getLayoutStartPoint().x,o=(e-s)/2;i.forEach(a=>{a.setLayoutStartPosition({x:a.getLayoutStartPoint().x+o,y:a.getLayoutStartPoint().y})})})}function IT(n,t,e,i){let r;n.forEach((s,o)=>{s.length>1&&(r=e[o],s.forEach(a=>{if(!a.alignSelf||a.alignSelf==="start")return;const l=a.getLayoutStartPoint(),h=a.alignSelf==="middle"?.5:1,d=t?r-(a.getLayoutRect().width+a.layoutPaddingLeft+a.layoutPaddingRight):r-(a.getLayoutRect().height+a.layoutPaddingTop+a.layoutPaddingBottom);t?a.setLayoutStartPosition({x:l.x+i*d*h,y:l.y}):a.setLayoutStartPosition({x:l.x,y:l.y+i*d*h})}))})}function eA(n,t,e,i,r){if(n.length){let s=0;const o=r==="right",a=o?-1:1;let l=o?t.rightCurrent:t.leftCurrent,h=t.topCurrent;const d=[];let u=[];const c=[];n.forEach(g=>{const p=t.getItemComputeLayoutRect(g),f=g.computeBoundsInRect(p);g.setLayoutRect(f);const m=f.height+g.layoutPaddingTop+g.layoutPaddingBottom,v=f.width+g.layoutPaddingLeft+g.layoutPaddingRight,_=o?-f.width-g.layoutPaddingRight:g.layoutPaddingLeft;g.setLayoutStartPosition({x:l+g.layoutOffsetX+_,y:h+g.layoutOffsetY+g.layoutPaddingTop}),h+=m,h>e&&u.length?(c.push(s),l+=a*s,s=v,h=t.topCurrent+m,g.setLayoutStartPosition({x:l+g.layoutOffsetX+_,y:t.topCurrent+g.layoutOffsetY+g.layoutPaddingTop}),d.push(u),u=[g]):(s=Math.max(s,v),u.push(g))}),c.push(s),d.push(u),IT(d,!0,c,a),i&&Yit(d,!0,e),o?t.rightCurrent=l+a*s:t.leftCurrent=l+a*s}}function Xit(n,t,e,i){if(n.length){let r=0;const s=i==="right",o=s?-1:1;let a=s?t.rightCurrent:t.leftCurrent,l=t.bottomCurrent;const h=[];let d=[];const u=[];n.forEach(c=>{const g=t.getItemComputeLayoutRect(c),p=c.computeBoundsInRect(g);c.setLayoutRect(p);const f=p.height+c.layoutPaddingTop+c.layoutPaddingBottom,m=p.width+c.layoutPaddingLeft+c.layoutPaddingRight,v=s?-p.width-c.layoutPaddingRight:c.layoutPaddingLeft;l<f&&d.length?(u.push(r),a+=o*r,r=m,l=t.bottomCurrent,c.setLayoutStartPosition({x:a+c.layoutOffsetX+v,y:l+c.layoutOffsetY-p.height-c.layoutPaddingBottom}),h.push(d),d=[c]):(c.setLayoutStartPosition({x:a+c.layoutOffsetX+v,y:l+c.layoutOffsetY-p.height-c.layoutPaddingBottom}),r=Math.max(r,m),l-=f,d.push(c))}),u.push(r),h.push(d),IT(h,!0,u,o),s?t.rightCurrent=a+o*r:t.leftCurrent=a+o*r}}function iA(n,t,e,i,r){if(n.length){const s=r==="top",o=s?1:-1;let a=0,l=t.leftCurrent,h=s?t.topCurrent:t.bottomCurrent;const d=[];let u=[];const c=[];n.forEach(g=>{const p=t.getItemComputeLayoutRect(g),f=g.computeBoundsInRect(p);g.setLayoutRect(f);const m=f.height+g.layoutPaddingTop+g.layoutPaddingBottom,v=f.width+g.layoutPaddingLeft+g.layoutPaddingRight,_=s?g.layoutPaddingTop:-f.height-g.layoutPaddingBottom;g.setLayoutStartPosition({x:l+g.layoutOffsetX+g.layoutPaddingLeft,y:h+g.layoutOffsetY+_}),l+=v,l>e&&u.length?(c.push(a),l=t.leftCurrent+v,h+=o*a,a=m,g.setLayoutStartPosition({x:t.leftCurrent+g.layoutOffsetX+g.layoutPaddingLeft,y:h+g.layoutOffsetY+_}),d.push(u),u=[g]):(a=Math.max(a,m),u.push(g))}),c.push(a),d.push(u),IT(d,!1,c,o),i&&Yit(d,!1,e),s?t.topCurrent=h+o*a:t.bottomCurrent=h+o*a}}function Kit(n,t,e,i){if(n.length){const r=i==="top",s=r?1:-1;let o=0,a=t.rightCurrent,l=r?t.topCurrent:t.bottomCurrent;const h=[];let d=[];const u=[];n.forEach(c=>{const g=t.getItemComputeLayoutRect(c),p=c.computeBoundsInRect(g);c.setLayoutRect(p);const f=p.height+c.layoutPaddingTop+c.layoutPaddingBottom,m=p.width+c.layoutPaddingLeft+c.layoutPaddingRight,v=r?c.layoutPaddingTop:-p.height-c.layoutPaddingBottom;a<m&&d.length?(a=t.rightCurrent,l+=s*o,o=f,c.setLayoutStartPosition({x:t.rightCurrent+c.layoutOffsetX-p.width-c.layoutPaddingRight,y:l+c.layoutOffsetY+v}),h.push(d),d=[c]):(d.push(c),c.setLayoutStartPosition({x:a+c.layoutOffsetX-p.width-c.layoutPaddingRight,y:l+c.layoutOffsetY+v}),o=Math.max(o,f),a-=m)}),u.push(o),h.push(d),IT(h,!1,u,s),r?t.topCurrent=l+s*o:t.bottomCurrent=l+s*o}}function iGt(n,t,e){const{startItems:i,middleItems:r,endItems:s}=LT(n);i.length&&eA(i,t,e,!1,"left"),r.length&&eA(r,t,e,!0,"left"),s.length&&Xit(s,t,e,"left")}function nGt(n,t,e){const{startItems:i,middleItems:r,endItems:s}=LT(n);i.length&&eA(i,t,e,!1,"right"),r.length&&eA(r,t,e,!0,"right"),s.length&&Xit(s,t,e,"right")}function rGt(n,t,e){const{startItems:i,middleItems:r,endItems:s}=LT(n);i.length&&iA(i,t,e,!1,"top"),r.length&&iA(r,t,e,!0,"top"),s.length&&Kit(s,t,e,"top")}function sGt(n,t,e){const{startItems:i,middleItems:r,endItems:s}=LT(n);i.length&&iA(i,t,e,!1,"bottom"),r.length&&iA(r,t,e,!0,"bottom"),s.length&&Kit(s,t,e,"bottom")}let qF=class{constructor(t,e){this.leftCurrent=0,this.topCurrent=0,this.rightCurrent=0,this.bottomCurrent=0,this._onError=e==null?void 0:e.onError}_layoutInit(t,e,i,r){this._chartLayoutRect=i,this._chartViewBox=r,this.leftCurrent=i.x,this.topCurrent=i.y,this.rightCurrent=i.x+i.width,this.bottomCurrent=i.height+i.y,e.sort((s,o)=>o.layoutLevel-s.layoutLevel)}_layoutNormalItems(t){this.layoutNormalInlineItems(t.filter(e=>e.layoutType==="normal-inline")),this.layoutNormalItems(t.filter(e=>e.layoutType==="normal"))}_groupItems(t){const e=t.filter(a=>a.layoutType==="region"),i=t.filter(a=>a.layoutType==="region-relative"),r=t.filter(a=>a.layoutType==="region-relative-overlap"),s=i.concat(r),o={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}};return r.forEach(a=>{o[a.layoutOrient].items.push(a)}),{regionItems:e,relativeItems:i,relativeOverlapItems:r,allRelatives:s,overlapItems:o}}layoutItems(t,e,i,r){this._layoutInit(t,e,i,r),this._layoutNormalItems(e);const s={left:this.leftCurrent,top:this.topCurrent,right:this.rightCurrent,bottom:this.bottomCurrent},{regionItems:o,relativeItems:a,relativeOverlapItems:l,allRelatives:h,overlapItems:d}=this._groupItems(e);this.layoutRegionItems(o,a,l,d),this._processAutoIndent(o,a,l,d,h,s),this.layoutAbsoluteItems(e.filter(u=>u.layoutType==="absolute"))}_processAutoIndent(t,e,i,r={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}},s,o){if(s.some(a=>a.autoIndent)){const{top:a,bottom:l,left:h,right:d}=this._checkAutoIndent(s,o);(a||l||h||d)&&(this.topCurrent=o.top+a,this.bottomCurrent=o.bottom-l,this.leftCurrent=o.left+h,this.rightCurrent=o.right-d,this.layoutRegionItems(t,e,i,r))}}layoutNormalItems(t){t.forEach(e=>{const i=this.getItemComputeLayoutRect(e),r=e.computeBoundsInRect(i);e.setLayoutRect(r),e.layoutOrient==="left"?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.leftCurrent+=r.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient==="top"?(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingLeft,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.topCurrent+=r.height+e.layoutPaddingTop+e.layoutPaddingBottom):e.layoutOrient==="right"?(e.setLayoutStartPosition({x:this.rightCurrent+e.layoutOffsetX-r.width-e.layoutPaddingRight,y:this.topCurrent+e.layoutOffsetY+e.layoutPaddingTop}),this.rightCurrent-=r.width+e.layoutPaddingLeft+e.layoutPaddingRight):e.layoutOrient==="bottom"&&(e.setLayoutStartPosition({x:this.leftCurrent+e.layoutOffsetX+e.layoutPaddingRight,y:this.bottomCurrent+e.layoutOffsetY-r.height-e.layoutPaddingBottom}),this.bottomCurrent-=r.height+e.layoutPaddingTop+e.layoutPaddingBottom)})}layoutNormalInlineItems(t){const e=t.filter(l=>l.layoutOrient==="left"),i=t.filter(l=>l.layoutOrient==="right"),r=t.filter(l=>l.layoutOrient==="top"),s=t.filter(l=>l.layoutOrient==="bottom"),o=this._chartLayoutRect.width+this._chartLayoutRect.x,a=this._chartLayoutRect.height+this._chartLayoutRect.y;e.length&&iGt(e,this,a),r.length&&rGt(r,this,o),i.length&&nGt(i,this,a),s.length&&sGt(s,this,o)}_layoutRelativeOverlap(t,e){e.items.forEach(i=>{const r=this.getItemComputeLayoutRect(i),s=i.computeBoundsInRect(r);e.rect.width=Math.max(s.width+i.layoutPaddingLeft+i.layoutPaddingRight,e.rect.width),e.rect.height=Math.max(s.height+i.layoutPaddingTop+i.layoutPaddingBottom,e.rect.height)}),e.items.forEach(i=>{i.setLayoutRect(e.rect),t==="left"?i.setLayoutStartPosition({x:this.leftCurrent+i.layoutOffsetX}):t==="right"?i.setLayoutStartPosition({x:this.rightCurrent-e.rect.width+i.layoutOffsetX}):t==="top"?i.setLayoutStartPosition({x:this.topCurrent+i.layoutOffsetY}):i.setLayoutStartPosition({x:this.bottomCurrent-e.rect.height+i.layoutOffsetY})}),t==="left"?this.leftCurrent+=e.rect.width:t==="right"?this.rightCurrent-=e.rect.width:t==="top"?this.topCurrent+=e.rect.height:this.bottomCurrent-=e.rect.height}_layoutRelativeItem(t,e){const i=t.computeBoundsInRect(e);t.layoutOrient==="left"||t.layoutOrient==="right"?t.setLayoutRect({width:i.width}):t.setLayoutRect({height:i.height}),t.layoutOrient==="left"?(t.setLayoutStartPosition({x:this.leftCurrent+t.layoutOffsetX+t.layoutPaddingLeft}),this.leftCurrent+=i.width+t.layoutPaddingLeft+t.layoutPaddingRight):t.layoutOrient==="right"?(this.rightCurrent-=i.width+t.layoutPaddingLeft+t.layoutPaddingRight,t.setLayoutStartPosition({x:this.rightCurrent+t.layoutOffsetX+t.layoutPaddingLeft})):t.layoutOrient==="top"?(t.setLayoutStartPosition({y:this.topCurrent+t.layoutOffsetY+t.layoutPaddingTop}),this.topCurrent+=i.height+t.layoutPaddingTop+t.layoutPaddingBottom):t.layoutOrient==="bottom"&&(this.bottomCurrent-=i.height+t.layoutPaddingTop+t.layoutPaddingBottom,t.setLayoutStartPosition({y:this.bottomCurrent+t.layoutOffsetY+t.layoutPaddingTop}))}_layoutRegionItem(t,e,i){const r=Math.max(Math.min(e,...t.map(o=>{var a;return(a=o.maxWidth)!==null&&a!==void 0?a:Number.MAX_VALUE})),0),s=Math.max(Math.min(i,...t.map(o=>{var a;return(a=o.maxHeight)!==null&&a!==void 0?a:Number.MAX_VALUE})),0);return t.forEach(o=>{const a=r-o.layoutPaddingLeft-o.layoutPaddingRight,l=s-o.layoutPaddingTop-o.layoutPaddingBottom;o.setLayoutRect({width:a,height:l}),o.setLayoutStartPosition({x:this.leftCurrent+o.layoutOffsetX+o.layoutPaddingLeft,y:this.topCurrent+o.layoutOffsetY+o.layoutPaddingTop})}),{regionHeight:s,regionWidth:r}}layoutRegionItems(t,e,i,r={left:{items:[],rect:{width:0,height:0}},right:{items:[],rect:{width:0,height:0}},top:{items:[],rect:{width:0,height:0}},bottom:{items:[],rect:{width:0,height:0}},z:{items:[],rect:{width:0,height:0}}}){let s=this.rightCurrent-this.leftCurrent,o=this.bottomCurrent-this.topCurrent;e.filter(h=>h.layoutOrient==="left"||h.layoutOrient==="right").forEach(h=>{this._layoutRelativeItem(h,this.getItemComputeLayoutRect(h))}),this._layoutRelativeOverlap("left",r.left),this._layoutRelativeOverlap("right",r.right),s=this.rightCurrent-this.leftCurrent,e.filter(h=>h.layoutOrient==="top"||h.layoutOrient==="bottom").forEach(h=>{this._layoutRelativeItem(h,this.getItemComputeLayoutRect(h))}),this._layoutRelativeOverlap("top",r.top),this._layoutRelativeOverlap("bottom",r.bottom),o=this.bottomCurrent-this.topCurrent;const{regionWidth:a,regionHeight:l}=this._layoutRegionItem(t,s,o);e.concat(i).forEach(h=>{if(["left","right"].includes(h.layoutOrient)){const d=this.filterRegionsWithID(t,h.layoutBindRegionID[0]);h.setLayoutRect({height:d.getLayoutRect().height}),h.setLayoutStartPosition({y:d.getLayoutStartPoint().y+h.layoutOffsetY+h.layoutPaddingTop}),h.layoutOrient==="right"&&h.setLayoutStartPosition({x:h.getLayoutStartPoint().x+a-s})}else if(["top","bottom"].includes(h.layoutOrient)){const d=this.filterRegionsWithID(t,h.layoutBindRegionID[0]);h.setLayoutRect({width:d.getLayoutRect().width}),h.setLayoutStartPosition({x:d.getLayoutStartPoint().x+h.layoutOffsetX+h.layoutPaddingLeft}),h.layoutOrient==="bottom"&&h.setLayoutStartPosition({y:h.getLayoutStartPoint().y+l-o})}})}layoutAbsoluteItems(t){t.forEach(e=>{e.absoluteLayoutInRect(this._chartLayoutRect)})}filterRegionsWithID(t,e){var i;const r=t.find(s=>s.getModelId()===e);return r||((i=this._onError)!==null&&i!==void 0?i:h0)("can not find target region item, invalid id"),r}getItemComputeLayoutRect(t){return{width:this.rightCurrent-this.leftCurrent-t.layoutPaddingLeft-t.layoutPaddingRight,height:this.bottomCurrent-this.topCurrent-t.layoutPaddingTop-t.layoutPaddingBottom}}_checkAutoIndent(t,e){const i={top:0,left:0,bottom:0,right:0};return t.forEach(r=>{if(!r.getModelVisible()||!r.autoIndent)return;const s=r.layoutOrient==="left"||r.layoutOrient==="right",o=r.getLastComputeOutBounds(),a=this._getOutInLayout(o,r,e);s?(i.top=Math.max(i.top,a.top),i.bottom=Math.max(i.bottom,a.bottom)):(i.left=Math.max(i.left,a.left),i.right=Math.max(i.right,a.right))}),i}_getOutInLayout(t,e,i){const{x:r,y:s}=e.getLayoutStartPoint(),{width:o,height:a}=e.getLayoutRect();return{left:i.left-(r-t.x1),right:r+o+t.x2-i.right,top:i.top-(s-t.y1),bottom:s+a+t.y2-i.bottom}}};qF.type="base";const m8=["linear","radial","conical"],oGt={x0:0,y0:0,x1:1,y1:1},aGt={x0:0,y0:0,x1:1,y1:1,r0:0,r1:1},lGt={x:.5,y:.5,startAngle:0,endAngle:2*Math.PI},hGt={linear:oGt,radial:aGt,conical:lGt},dGt=["line","area","trail"];function tP(n){return dGt.includes(n)}function uGt(n,t){return n==="monotone"?t==="horizontal"?"monotoneY":"monotoneX":n}function cGt(n){return["arc3d","rect3d","pyramid3d"].includes(n)}class gGt extends $it{getStateInfoList(){return this._stateInfoList}constructor(t,e){super(t),this._stateInfoList=[],this._mark=e}_getDefaultStateMap(){return{markUpdateRank:1}}getStateInfo(t){return this._stateInfoList.find(e=>e.stateValue===t)}addStateInfo(t){if(this.getStateInfo(t.stateValue))return;t.level=t.level||0;let e=!0;for(let i=0;i<this._stateInfoList.length;i++){const r=this._stateInfoList[i].level;if(r&&r>t.level){this._stateInfoList.splice(i,0,t),e=!1;break}}e&&this._stateInfoList.push(t)}_clearStateBeforeSet(t){t.datums=null,t.items=null,t.fields=null,t.filter=null}changeStateInfo(t){const e=this.getStateInfo(t.stateValue);if(e){if(t.datums!==void 0&&(this._clearStateBeforeSet(e),e.datums=t.datums,e.datumKeys=t.datumKeys),t.items!==void 0&&(this._clearStateBeforeSet(e),e.items=t.items),t.fields!==void 0)if(this._clearStateBeforeSet(e),t.fields===null)e.fields=t.fields;else{e.fields=e.fields||{};for(const i in t.fields){const r=t.fields[i];e.fields[i]=e.fields[i]||{};const s=e.fields[i];L(r.domain)&&(s.domain=r.domain),L(r.type)&&(s.type=r.type)}}t.filter&&(this._clearStateBeforeSet(e),e.filter=t.filter)}else this.addStateInfo(t)}clearStateInfo(t){t.forEach(e=>{this.getStateInfo(e)&&this.changeStateInfo({stateValue:e,datumKeys:null,datums:null,fields:null,items:null,filter:null,cache:{}})})}checkOneState(t,e,i,r){var s;r=Re(tP)?r:!t.mark||tP(t.mark.markType);let o=!1,a=!1;if(L(i.datums)&&i.datums.length>0)o=this.checkDatumState(i,e,r),a=!0;else if(i.items)o=(s=this.checkItemsState(i,t))!==null&&s!==void 0&&s,a=!0;else if(i.fields)o=this.checkFieldsState(i,e,t,r),a=!0;else if(!o&&i.filter){const l={mark:this._mark,renderNode:t,type:t.mark.markType};o=i.filter(e,l),a=!0}return a?o?"in":"out":"skip"}checkState(t,e){const i=t.getStates().filter(s=>qVt(s)).map(s=>[s,10]),r=!t.mark||tP(t.mark.markType);for(let s=0;s<this._stateInfoList.length;s++){const o=this._stateInfoList[s],a=this.checkOneState(t,e,o,r);a!=="skip"&&a==="in"&&i.push([o.stateValue,o.level])}return i.map(s=>s[0])}checkDatumState(t,e,i){let r=!1;const s=i?e[0]:e;if(V(t.datums)){const o=t.datumKeys||Object.keys(t.datums[0]).filter(a=>!a.startsWith(Wt));r=t.datums.some(a=>i&&V(a==null?void 0:a.items)?o.every(l=>{var h,d;return((d=(h=a==null?void 0:a.items)===null||h===void 0?void 0:h[0])===null||d===void 0?void 0:d[l])===(s==null?void 0:s[l])}):o.every(l=>(a==null?void 0:a[l])===(s==null?void 0:s[l])))}else kt(t.datums)?r=(t.datumKeys||Object.keys(t.datums).filter(o=>!o.startsWith(Wt))).every(o=>{var a,l;return i?((a=t.datums.items)===null||a===void 0?void 0:a[0][o])===s[o]:((l=t.datums)===null||l===void 0?void 0:l[o])===s[o]}):r=e===t.datums;return r}checkItemsState(t,e){var i;return(i=t.items)===null||i===void 0?void 0:i.includes(e)}checkFieldsState(t,e,i,r){var s;let o=!0;for(const a in t.fields){const l=t.fields[a],h=l.type,d=l.domain,u=r?(s=e[0])===null||s===void 0?void 0:s[a]:e[a];if(Je(h)&&d.length>1){if(this.checkLinearFieldState(d,a,e,i,r)){o=!1;break}o=!0}else{if(!d.some(c=>c===u)){o=!1;break}o=!0}}return o}checkLinearFieldState(t,e,i,r,s){var o;const a=s?(o=i[0])===null||o===void 0?void 0:o[e]:i[e];return a<t[0]||a>t[t.length-1]}updateLayoutState(t){return this._stateMap.markUpdateRank++,this.updateState({markUpdateRank:this._stateMap.markUpdateRank},t)}compileState(t,e){t.state({callback:(i,r)=>this.checkState(r,i)},e)}}class Qa extends XF{getDataView(){return this._data}setDataView(t){this._data=t}getLatestData(){var t;return(t=this._data)===null||t===void 0?void 0:t.latestData}constructor(t,e){super(t),this.grammarType=fd.data,this._data=null,this._data=e}release(){super.release(),this._data=null}updateData(t){const e=this.getProduct(),i=this.getLatestData();if(e&&i&&(e.values(i),!t))return this.getCompiler().renderNextTick()}_compileProduct(){const t=this.getLatestData();D(t)||(D(this.getProduct())?this._initProduct(t):this._product.values(t))}_initProduct(t){var e,i;const r=this.getVGrammarView();if(!r||!t)return;const s=this.getProductId();this._product=(i=(e=r==null?void 0:r.data)===null||e===void 0?void 0:e.call(r,t))===null||i===void 0?void 0:i.id(s),this._compiledProductId=s}generateProductId(){var t;return`${(t=this.getDataView())===null||t===void 0?void 0:t.name}`}_lookupGrammar(t){var e,i;return(i=(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getDataById)===null||i===void 0?void 0:i.call(e,t)}}class pGt extends Qa{constructor(t){super(t),this._mark=t.mark}setCompiledProductId(t){this._compiledProductId=t}generateProductId(){const t=super.generateProductId();return L(t)?t:`${Wt}_markData_${this._mark.id}`}_compileProduct(){var t;const e=(t=this._data)===null||t===void 0?void 0:t.latestData;D(e)||L(this.getProduct())||this._initProduct(e)}}var v8=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class fGt extends XF{getMarkConfig(){return this._markConfig}setMarkConfig(t){Object.keys(t).forEach(e=>{this._markConfig[e]=t[e]})}getVisible(){return this._visible}setVisible(t){this._visible=t}getUserId(){return this._userId}setUserId(t){L(t)&&(this._userId=t)}getDataView(){var t;return(t=this._data)===null||t===void 0?void 0:t.getDataView()}setDataView(t,e){D(this._data)&&this.initMarkData(Object.assign(Object.assign({},this._option),{mark:this})),L(e)&&this._data.setCompiledProductId(e),this._data.setDataView(t)}getData(){return this._data}setData(t){this._data=t}hasState(t){return t in this.state.getStateMap()}getState(t){return this.state.getStateMap()[t]}getAnimationConfig(){return this._animationConfig}setAnimationConfig(t){this._animationConfig=t}setSkipBeforeLayouted(t){this._skipBeforeLayouted=t}getSkipBeforeLayouted(){return this._skipBeforeLayouted}getGroupKey(){return this._groupKey}setGroupKey(t){this._groupKey=t}setStateSortCallback(t){this._stateSort=t}constructor(t,e,i){super(t),this.grammarType=fd.mark,this.type=void 0,this.name="mark",this._markConfig={zIndex:Qe.Mark,morph:!1},this._visible=!0,this.stateStyle={},this._unCompileChannel={},this._skipBeforeLayouted=!1,this.name=e,this.model=i,this.key=t.key,this.state=new gGt(Object.assign(Object.assign({},t),{stateKeyToSignalName:this.stateKeyToSignalName.bind(this)}),this),this._event=new RT(i.getOption().eventDispatcher,i.getOption().mode)}setTransform(t){this._transform=t}initMarkData(t){this._data=new pGt(t)}stateKeyToSignalName(t){return`${Wt}_${this.type}_${this.id}_${t}`}getAttribute(t,e,i,r){}_compileProduct(t){const e=this.getProduct();if(!this.getVisible())return void(L(e)&&this.removeProduct());L(e)||this.getCompiler().isInited&&(this._initProduct(t==null?void 0:t.group),D(this._product)||(this.compileSignal(),this.compileData(),this.compileState(),this.compileEncode(),this.compileAnimation(),this.compileContext(t==null?void 0:t.context),this.compileTransform()))}_initProduct(t){const e=this.getVGrammarView(),i=this.getProductId();this._product=e.mark(this.type,t??e.rootMark).id(i),this.name&&this._product&&this._product.name(this.name),this._compiledProductId=i}generateProductId(){return this._userId?`${this._userId}`:`${this.name}_${this.id}`}compileData(){if(D(this._data))return;this._data.compile();const t=this._data.getProduct();L(this._product)&&L(t)&&this._product.join(t,this.key,void 0,this.getGroupKey())}updateStaticEncode(){if(!this._product)return;const{enterStyles:t,updateStyles:e}=this._separateStyle();this._product.encodeState("group",t,!0),this._product.encode(e,!0)}_separateStyle(){const t=this.stateStyle,e=Rt.STATE_NORMAL,i=t[e],r=(v8(t,[typeof e=="symbol"?e:e+""]),this._option.noSeparateStyle?null:{}),s={};return Object.keys(i).forEach(o=>{this._unCompileChannel[o]||(this._option.noSeparateStyle||XVt(o,i,this.getGroupKey())?s[o]={callback:this.compileCommonAttributeCallback(o,"normal"),dependency:[this.stateKeyToSignalName("markUpdateRank")]}:r[o]=this.compileCommonAttributeCallback(o,"normal"))}),{enterStyles:r,updateStyles:s}}compileEncode(){const t=this.stateStyle,e=Rt.STATE_NORMAL,i=(t[e],v8(t,[typeof e=="symbol"?e:e+""])),{enterStyles:r,updateStyles:s}=this._separateStyle();this._product.encode(s,!0),this._product.encodeState("group",r,!0),Object.keys(i).forEach(o=>{const a={};Object.keys(i[o]).forEach(l=>{this._unCompileChannel[l]||(a[l]={callback:this.compileCommonAttributeCallback(l,o),dependency:[this.stateKeyToSignalName("markUpdateRank")]})}),this._product.encodeState(o,a,!0)}),this._skipBeforeLayouted&&this._product.layout({skipBeforeLayouted:this._skipBeforeLayouted})}compileState(){this.state.compileState(this._product,this._stateSort)}compileAnimation(){var t,e,i,r;if(this._animationConfig){let s;if(this.type==="component")s=(t=this.model.animate)===null||t===void 0?void 0:t.getAnimationStateSignalName();else{const o=(i=(e=this.model).getRegion)===null||i===void 0?void 0:i.call(e);s=(r=o==null?void 0:o.animate)===null||r===void 0?void 0:r.getAnimationStateSignalName()}this._product.animation(this._animationConfig),this._product.animationState({callback:(o,a,l)=>{var h;return(h=l[s])===null||h===void 0?void 0:h.callback(o,a)},dependency:s}),this._animationConfig.normal&&(this._animationConfig.appear?this._event.on(Lt.ANIMATION_END,({event:o})=>{o.mark===this.getProduct()&&o.animationState===hn.appear&&this.runAnimationByState(hn.normal)}):this._event.on(Lt.AFTER_DO_RENDER,()=>{this.runAnimationByState(hn.normal)}))}}compileContext(t){const e=Object.assign(Object.assign({},this._markConfig),{context:Object.assign({markId:this.id,modelId:this.model.id,markUserId:this._userId,modelUserId:this.model.userId},t)});this._product.configure(e)}compileSignal(){this.state.compile()}_computeAttribute(t,e){return(i,r)=>{}}compileCommonAttributeCallback(t,e){const i=this._computeAttribute(t,e),r={mark:null,parent:null,element:null};return(s,o)=>(r.mark=o.mark,r.parent=o.mark.group,r.element=o,i(s,r))}compileTransform(){var t;!((t=this._transform)===null||t===void 0)&&t.length&&this.getProduct().transform(this._transform)}_lookupGrammar(t){var e;return(e=this.getCompiler().getVGrammarView())===null||e===void 0?void 0:e.getMarkById(t)}updateState(t,e){return this.state.updateState(t,e)}updateLayoutState(t,e){return e&&this.getMarks().length>0&&this.getMarks().forEach(i=>i.state.updateLayoutState(!0)),this.state.updateLayoutState(t)}updateMarkState(t){if(!this._product)return;const e=this.state.getStateInfo(t);this._product.elements.forEach(i=>{this.state.checkOneState(i,i.getDatum(),e)==="in"?i.addState(t):i.removeState(t)})}getMarks(){return[]}runAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.runAnimationByState(t)}stopAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.stopAnimationByState(t)}pauseAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.pauseAnimationByState(t)}resumeAnimationByState(t){var e,i;return(i=(e=this.getProduct())===null||e===void 0?void 0:e.animate)===null||i===void 0?void 0:i.resumeAnimationByState(t)}getProductElements(){const t=this.getProduct();if(t)return t.elements}clear(){this._event.off(Lt.AFTER_DO_RENDER)}release(){super.release(),this.state.release()}}var _8=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class sr extends fGt{constructor(t,e){var i;super(e,t,e.model),this._extensionChannel={},this._computeExChannel={},this._attributeContext=e.attributeContext,(i=e.map)===null||i===void 0||i.set(this.id,this)}created(){this._initStyle()}initStyleWithSpec(t,e){t&&(L(t.id)&&(this._userId=t.id),Re(t.interactive)&&(this._markConfig.interactive=t.interactive),L(t.zIndex)&&(this._markConfig.zIndex=t.zIndex),Re(t.visible)&&this.setVisible(t.visible),this._initSpecStyle(t,this.stateStyle,e))}_transformStyleValue(t,e){if(t.scale){const i=t.scale,r=i.range();return i.range(r.map(e)),t}return typeof t=="function"?(...i)=>e(t(...i)):e(t)}convertAngleToRadian(t){return this._transformStyleValue(t,Te)}isUserLevel(t){return[wt.User_Mark,wt.User_Series,wt.User_Chart,wt.User_SeriesStyle].includes(t)}setStyle(t,e="normal",i=0,r=this.stateStyle){if(D(t))return;r[e]===void 0&&(r[e]={});const s=this.isUserLevel(i);Object.keys(t).forEach(o=>{let a=t[o];D(a)||(a=this._filterAttribute(o,a,e,i,s,r),this.setAttribute(o,a,e,i,r))})}getStyle(t,e="normal"){var i;return(i=this.stateStyle[e][t])===null||i===void 0?void 0:i.style}_filterAttribute(t,e,i,r,s,o=this.stateStyle){let a=this._styleConvert(e);if(s)switch(t){case"angle":a=this.convertAngleToRadian(a);break;case"innerPadding":case"outerPadding":a=this._transformStyleValue(a,l=>-l);break;case"curveType":a=this._transformStyleValue(a,l=>uGt(l,this._option.model.direction))}return a}setReferer(t,e,i,r=this.stateStyle){var s;if(t)if(e&&i){const o=(s=r[i])!==null&&s!==void 0?s:{[e]:{}};r[i][e]=Object.assign(Object.assign({},o[e]),{referer:t})}else Object.entries(r).forEach(([o,a])=>{Object.entries(a).forEach(([l,h])=>{r[o][l].referer=t})})}setPostProcess(t,e,i="normal"){var r;!((r=this.stateStyle[i])===null||r===void 0)&&r[t]&&(this.stateStyle[i][t].postProcess=e)}getAttribute(t,e,i="normal",r){return this._computeAttribute(t,i)(e,r)}setAttribute(t,e,i="normal",r=0,s=this.stateStyle){var o;s[i]===void 0&&(s[i]={}),s[i][t]===void 0&&(s[i][t]={level:r,style:e,referer:void 0});const a=(o=s[i][t])===null||o===void 0?void 0:o.level;L(a)&&a<=r&&Nt(s[i][t],{style:e,level:r}),i!=="normal"&&t in this._extensionChannel&&this._extensionChannel[t].forEach(l=>{s[i][l]===void 0&&(s[i][l]=s.normal[l])})}_getDefaultStyle(){return{visible:!0,x:0,y:0}}_styleConvert(t){if(!t)return t;if(dI(t.type)||t.scale){const e=R3t(t,{globalScale:this._option.globalScale,seriesId:this._option.seriesId});if(e)return{scale:e,field:t.field,changeDomain:t.changeDomain}}return t}_computeAttribute(t,e){var i;let r=(i=this.stateStyle[e])===null||i===void 0?void 0:i[t];r||(r=this.stateStyle.normal[t]);const s=this._computeStateAttribute(r,t,e),o=it(r==null?void 0:r.postProcess),a=t in this._computeExChannel;if(o&&a){const l=this._computeExChannel[t];return(h,d)=>{let u=s(h,d);return u=r.postProcess(u,h,this._attributeContext,d,this.getDataView()),l(t,h,e,d,u)}}if(o)return(l,h)=>r.postProcess(s(l,h),l,this._attributeContext,h,this.getDataView());if(a){const l=this._computeExChannel[t];return(h,d)=>l(t,h,e,d,s(h,d))}return s}_computeStateAttribute(t,e,i){var r;return t?t.referer?t.referer._computeAttribute(e,i):t.style?typeof t.style=="function"?(s,o)=>t.style(s,this._attributeContext,o,this.getDataView()):m8.includes(t.style.gradient)?this._computeGradientAttr(t.style):["outerBorder","innerBorder"].includes(e)?this._computeBorderAttr(t.style):dI((r=t.style.scale)===null||r===void 0?void 0:r.type)?(s,o)=>{let a=s;return this.model.modelType==="series"&&this.model.getMarkData&&(a=this.model.getMarkData(s)),t.style.scale.scale(a[t.style.field])}:(s,o)=>t.style:(s,o)=>t.style:(s,o)=>{}}_initStyle(){const t=this._getDefaultStyle();this.setStyle(t,"normal",0)}_initSpecStyle(t,e,i){t.style&&this.setStyle(t.style,"normal",wt.User_Mark,e);const r=t.state;r&&Object.keys(r).forEach(s=>{const o=r[s];if("style"in o){const a=o.style;let l={stateValue:s};"level"in o&&(l.level=o.level),"filter"in o&&(l=it(o.filter)?Object.assign({filter:o.filter},l):Object.assign(Object.assign({},o.filter),l)),this.state.addStateInfo(l),this.setStyle(a,s,wt.User_Mark,e)}else this.setStyle(o,s,wt.User_Mark,e)})}_computeGradientAttr(t){var e,i;const{gradient:r,scale:s,field:o}=t,a=_8(t,["gradient","scale","field"]);let l=s,h=o;if(!(s&&o||this.model.modelType!=="series")){const{scale:c,field:g}=this.model.getColorAttribute();s||(l=c),h||(h=g)}const d=yI(_0(this.model.getColorScheme(),this.model.modelType==="series"?(i=(e=this.model).getSpec)===null||i===void 0?void 0:i.call(e):void 0),this.model.getDefaultColorDomain()),u=Object.assign(Object.assign({},hGt[r]),a);return(c,g)=>{const p={},f=this.getDataView();return Object.keys(u).forEach(m=>{const v=u[m];m==="stops"?p.stops=v.map(_=>{const{opacity:b,color:y,offset:C}=_;let S=y??(l==null?void 0:l.scale(c[h]));return it(y)&&(S=y(c,this._attributeContext,g,f)),L(b)&&(S=Tn.SetOpacity(S,b)),{offset:it(C)?C(c,this._attributeContext,g,f):C,color:S||d[0]}}):it(v)?p[m]=v(c,this._attributeContext,g,f):p[m]=v}),p.gradient=r,p}}_computeBorderAttr(t){const{scale:e,field:i}=t,r=_8(t,["scale","field"]);return(s,o)=>{var a,l,h;const d={};if(Object.keys(r).forEach(u=>{const c=r[u];it(c)?d[u]=c(s,this._attributeContext,o,this.getDataView()):d[u]=c}),"stroke"in d)m8.includes((h=r.stroke)===null||h===void 0?void 0:h.gradient)&&(d.stroke=this._computeGradientAttr(r.stroke)(s,o));else{const u=yI(_0(this.model.getColorScheme(),this.model.modelType==="series"?(l=(a=this.model).getSpec)===null||l===void 0?void 0:l.call(a):void 0),this.model.getDefaultColorDomain());let c=e,g=i;if(!(e&&i||this.model.modelType!=="series")){const{scale:p,field:f}=this.model.getColorAttribute();e||(c=p),g||(g=f),d.stroke=(c==null?void 0:c.scale(s[g]))||u[0]}}return d}}}class x0 extends sr{constructor(){super(...arguments),this.type=x0.type,this._marks=[]}getMarks(){return this._marks}_getDefaultStyle(){return Object.assign({},super._getDefaultStyle())}isMarkExist(t){return this._marks.find(e=>e.id===t.id)!==void 0}addMark(t){return this.isMarkExist(t)?(ls("Mark already exists, add mark failed."),!1):(this._marks.push(t),!0)}removeMark(t){const e=this._marks.findIndex(i=>i.id===t.id||i.name===t.name);return e===-1?(ls("Mark does not exists, removeMark failed."),!1):(this._marks.splice(e,1),!0)}getMarkInType(t){return this._marks.filter(e=>e.type===t)}getMarkInId(t){return this._marks.find(e=>e.id===t)}getMarkInUserId(t){let e;if(this._marks.forEach(i=>{i.getUserId()===t&&(e=i)}),!e)for(let i=0;i<this._marks.length;i++){const r=this._marks[i];if(r.type==="group"&&(e=r.getMarkInUserId(t)),e)break}return e}getMarkInName(t){return this._marks.filter(e=>e.name===t)}_compileProduct(t){super._compileProduct(t),this._product.configure({zIndex:this._markConfig.zIndex}),t!=null&&t.ignoreChildren||this.getMarks().forEach(e=>{e.getProduct()&&e.removeProduct(),e.compile({group:this._product})})}}x0.type="group";const qit=()=>{tNt(),q.registerMark(x0.type,x0)},mGt={measureText:ijt};class Ps{static instance(){return Ps.instance_||(Ps.instance_=new Ps),Ps.instance_}constructor(){this.functions={}}registerFunction(t,e){t&&e&&(this.functions[t]=e)}unregisterFunction(t){t&&delete this.functions[t]}getFunction(t){return this.functions[t]||null}getFunctionNameList(){return Object.keys(this.functions)}}const vGt=()=>{gw(Qt)},_Gt=()=>{vw(Qt)};class Zit{constructor(){this.id=Kc(),this._plugins=[]}add(t){if(!t||t.length===0)return null;const e=[];return t.forEach(i=>{this._plugins.find(r=>r.id===i.id)?ls("plugin"):(this._plugins.push(i),e.push(i),i.onAdd&&i.onAdd(this))}),e}load(t){const e=this.add(t);e&&e.length&&this.activate(t)}activate(t){t.length&&t.forEach(e=>{e.init&&e.init()})}get(t){return this._plugins.find(e=>e.id===t)}getAll(){return this._plugins.slice()}release(t){const e=this.get(t);e&&(e.release(this),this._plugins=this._plugins.filter(i=>i!==e))}releaseAll(){this._plugins.forEach(t=>{t.release(this)}),this._plugins=[]}clear(t){const e=this.get(t);e&&e.clear(this)}clearAll(){this._plugins.forEach(t=>{var e;(e=t.clear)===null||e===void 0||e.call(t,this)})}}class bGt extends Zit{constructor(t){super(),this.globalInstance=t}onInit(t){this._plugins.forEach(e=>{e.onInit&&e.onInit(this,t)})}onBeforeResize(t,e){this._plugins.forEach(i=>{i.onBeforeResize&&i.onBeforeResize(this,t,e)})}onAfterChartSpecTransform(t,e){this._plugins.forEach(i=>{i.onAfterChartSpecTransform&&i.onAfterChartSpecTransform(this,t,e)})}onAfterModelSpecTransform(t,e,i){this._plugins.forEach(r=>{r.onAfterModelSpecTransform&&r.onAfterModelSpecTransform(this,t,e,i)})}onBeforeInitChart(t,e){this._plugins.forEach(i=>{i.onBeforeInitChart&&i.onBeforeInitChart(this,t,e)})}releaseAll(){super.releaseAll(),this.globalInstance=null}}const yGt=new Map;function CGt(n){return yGt.get(n)}var Oo=function(n,t,e,i){return new(e||(e=Promise))(function(r,s){function o(h){try{l(i.next(h))}catch(d){s(d)}}function a(h){try{l(i.throw(h))}catch(d){s(d)}}function l(h){var d;h.done?r(h.value):(d=h.value,d instanceof e?d:new e(function(u){u(d)})).then(o,a)}l((i=i.apply(n,t||[])).next())})},SGt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class zn{static useRegisters(t){t.forEach(e=>{typeof e=="function"?e():console.error("Invalid function:",e)})}static useChart(t){t.forEach(e=>q.registerChart(e.type,e))}static useSeries(t){t.forEach(e=>q.registerSeries(e.type,e))}static useComponent(t){t.forEach(e=>q.registerComponent(e.type,e))}static useMark(t){t.forEach(e=>{var i;return q.registerMark((i=e.constructorType)!==null&&i!==void 0?i:e.type,e)})}static useLayout(t){t.forEach(e=>q.registerLayout(e.type,e))}static registerDataSetTransform(t,e){q.registerTransform(t,e)}static registerFunction(t,e){t&&e&&Ps.instance().registerFunction(t,e)}static unregisterFunction(t){t&&Ps.instance().unregisterFunction(t)}static getFunction(t){return t?Ps.instance().getFunction(t):null}static getFunctionList(){return Ps.instance().getFunctionNameList()}static registerMap(t,e,i){const r=q.getImplementInKey("registerMap");r&&r(t,e,i)}static unregisterMap(t){const e=q.getImplementInKey("unregisterMap");e&&e(t)}static getMap(t){return zVt(t)}static registerSVG(t,e,i){const r=q.getImplementInKey("registerSVG");r&&r(t,e,i)}static unregisterSVG(t){const e=q.getImplementInKey("unregisterSVG");e&&e(t)}static getSVG(t){return CGt(t)}static hideTooltip(t=[]){lo.forEach(e=>{var i;return(i=e==null?void 0:e.hideTooltip)===null||i===void 0?void 0:i.call(e)},t)}static getLogger(){return ge.getInstance()}getSpec(){return this._spec}getSpecInfo(){return this._specInfo}getDataSet(){return this._dataSet}constructor(t,e){var i,r,s,o,a,l,h,d;this.id=Kc(),this._userEvents=[],this._autoSize=!0,this._option={mode:an["desktop-browser"],onError:C=>{throw new Error(C)},optimize:{disableCheckGraphicWidthOutRange:!0}},this._observer=null,this._context={},this._doResize=()=>{const{width:C,height:S}=this.getCurrentSize();this._currentSize.width===C&&this._currentSize.height===S||(this._currentSize={width:C,height:S},this.resizeSync(C,S))},this._renderSync=(C={})=>{var S;const w=this;return this._beforeRender(C)&&((S=this._compiler)===null||S===void 0||S.render(C.morphConfig),this._afterRender()),w},this._updateSpec=(C,S=!1,w)=>{var x,A;const M=this._spec,T={changeBackground:!1,reTransformSpec:!1,change:!1,reMake:!1,reCompile:!1,reSize:!1,changeTheme:!1};if(!this._setNewSpec(C,S))return;Oe(M.theme,this._spec.theme)?Oe(this._spec.background,M.background)||(T.reMake=!0,T.changeBackground=!0):T.changeTheme=!0;const R=this._shouldChartResize(M);if(T.reSize=R,this._spec.type!==M.type)return(A=(x=this._compiler)===null||x===void 0?void 0:x.getVGrammarView())===null||A===void 0||A.updateLayoutTag(),T.reMake=!0,T.reTransformSpec=!0,T.change=!0,T.changeTheme=!0,T;this._initChartSpec(this._spec,"updateSpec");const B=Eg(this._chart.updateSpec(this._spec),T);return w?Object.assign(Object.assign({},B),w):B},this._option=Object.assign(Object.assign(Object.assign({},this._option),{animation:t.animation!==!1}),e),e!=null&&e.optimize&&(this._option.optimize=Object.assign(Object.assign({},this._option.optimize),e.optimize)),this._onError=(i=this._option)===null||i===void 0?void 0:i.onError;const u=this._option,{dom:c,renderCanvas:g,mode:p,stage:f,poptip:m}=u,v=SGt(u,["dom","renderCanvas","mode","stage","poptip"]),_=Ua(p);if(_?vGt():p==="node"&&_Gt(),_&&c&&(this._container=yt(c)?le.getElementById(c):c),g&&(this._canvas=g),f&&(this._stage=f),p!=="node"&&!this._container&&!this._canvas&&!this._stage)return void((r=this._option)===null||r===void 0||r.onError("please specify container or renderCanvas!"));this._viewBox=this._option.viewBox,this._currentThemeName=Tc.getCurrentThemeName(),this._setNewSpec(t),this._updateCurrentTheme(),this._currentSize=this.getCurrentSize();const b=[];!m&&b.push("poptipForText"),t.type==="sankey"&&b.push("scrollbar");const y=Object.assign({},v.performanceHook||{});Object.keys(y).forEach(C=>{v.performanceHook[C]=(...S)=>{y[C](...S,this)}}),this._compiler=new NVt({dom:(s=this._container)!==null&&s!==void 0?s:"none",canvas:g},Object.assign(Object.assign({mode:this._option.mode,stage:f,pluginList:b},v),{background:this._getBackground(),onError:this._onError})),this._compiler.setSize(this._currentSize.width,this._currentSize.height),this._eventDispatcher=new OVt(this,this._compiler),this._event=new RT(this._eventDispatcher,p),this._compiler.initView(),this._setFontFamilyTheme((o=this._currentTheme)===null||o===void 0?void 0:o.fontFamily),this._initDataSet(this._option.dataSet),this._autoSize=!!_&&((l=(a=t.autoFit)!==null&&a!==void 0?a:this._option.autoFit)===null||l===void 0||l),this._bindResizeEvent(),this._bindVGrammarViewEvent(),this._initChartPlugin(),lo.registerInstance(this),(d=(h=this._option.performanceHook)===null||h===void 0?void 0:h.afterCreateVChart)===null||d===void 0||d.call(h,this)}_setNewSpec(t,e){return!!t&&(yt(t)&&(t=JSON.parse(t)),e&&this._originalSpec&&(t=Nt({},this._originalSpec,t)),this._originalSpec=t,this._spec=this._getSpecFromOriginalSpec(),!0)}_getSpecFromOriginalSpec(){var t;const e=AI(this._originalSpec);return e.data=(t=e.data)!==null&&t!==void 0?t:[],e}_initChartSpec(t,e){var i,r;zn.getFunctionList()&&zn.getFunctionList().length&&(t=MI(t,zn)),this._spec=t,this._chartSpecTransformer||(this._chartSpecTransformer=q.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),(i=this._chartSpecTransformer)===null||i===void 0||i.transformSpec(this._spec),this._chartPluginApply("onAfterChartSpecTransform",this._spec,e),this._specInfo=(r=this._chartSpecTransformer)===null||r===void 0?void 0:r.transformModelSpec(this._spec),this._chartPluginApply("onAfterModelSpecTransform",this._spec,this._specInfo,e)}_updateSpecInfo(){var t;this._chartSpecTransformer||(this._chartSpecTransformer=q.createChartSpecTransformer(this._spec.type,this._getChartOption(this._spec.type))),this._specInfo=(t=this._chartSpecTransformer)===null||t===void 0?void 0:t.createSpecInfo(this._spec)}_initChart(t){var e,i,r;if(!this._compiler)return void((e=this._option)===null||e===void 0||e.onError("compiler is not initialized"));if(this._chart)return void((i=this._option)===null||i===void 0||i.onError("chart is already initialized"));const s=q.createChart(t.type,t,this._getChartOption(t.type));s?(this._chart=s,this._chart.setCanvasRect(this._currentSize.width,this._currentSize.height),this._chart.created(this._chartSpecTransformer),this._chart.init(),this._event.emit(Ot.initialized,{chart:s,vchart:this})):(r=this._option)===null||r===void 0||r.onError("init chart fail")}_releaseData(){this._dataSet&&(this._dataSet.dataViewMap={},this._dataSet=null)}_bindVGrammarViewEvent(){if(!this._compiler)return;const t=this._compiler.getVGrammarView();t.addEventListener(Lt.ALL_ANIMATION_END,()=>{this._event.emit(Ot.animationFinished,{chart:this._chart,vchart:this})}),t.addEventListener(Lt.AFTER_VRENDER_NEXT_RENDER,()=>{this._event.emit(Ot.renderFinished,{chart:this._chart,vchart:this})})}_bindResizeEvent(){var t,e;if(this._autoSize){if(this._onResize=ha(this._doResize,(t=this._option.resizeDelay)!==null&&t!==void 0?t:100),this._container){const i=window.ResizeObserver;i&&(this._observer=new i(this._onResize),(e=this._observer)===null||e===void 0||e.observe(this._container))}window.addEventListener("resize",this._onResize)}}_unBindResizeEvent(){this._autoSize&&(window.removeEventListener("resize",this._onResize),this._observer&&(this._observer.disconnect(),this._observer=null))}getCurrentSize(){var t,e,i,r;return Wit(this._spec,{container:this._container,canvas:this._canvas,mode:this._getMode(),modeParams:this._option.modeParams},{width:(e=(t=this._currentSize)===null||t===void 0?void 0:t.width)!==null&&e!==void 0?e:tp,height:(r=(i=this._currentSize)===null||i===void 0?void 0:i.height)!==null&&r!==void 0?r:ep})}_initDataSet(t){this._dataSet=t instanceof Bd?t:new Bd,Xl(this._dataSet,"dataview",LM),Xl(this._dataSet,"array",kJ),Vt(this._dataSet,"copyDataView",BT);for(const e in q.transforms)Vt(this._dataSet,e,q.transforms[e]);for(const e in q.dataParser)Xl(this._dataSet,e,q.dataParser[e])}updateCustomConfigAndRerender(t,e,i={}){if(!this._isReleased&&t)return it(t)&&(t=t()),t.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._reCompile(t),e?this._renderSync(i):this._renderAsync(i)}_updateCustomConfigAndRecompile(t,e={}){return!!t&&(this._reCompile(t),this._beforeRender(e))}_reCompile(t,e){var i,r,s,o,a,l,h,d,u,c;if(t.reMake&&(this._releaseData(),this._initDataSet(),(i=this._chart)===null||i===void 0||i.release(),this._chart=null),t.reTransformSpec&&(this._chartSpecTransformer=null),t.changeTheme?(this._setCurrentTheme(),this._setFontFamilyTheme((r=this._currentTheme)===null||r===void 0?void 0:r.fontFamily)):t.changeBackground&&((s=this._compiler)===null||s===void 0||s.setBackground(this._getBackground())),t.reMake)(o=this._compiler)===null||o===void 0||o.releaseGrammar(((a=this._option)===null||a===void 0?void 0:a.animation)===!1||((l=this._spec)===null||l===void 0?void 0:l.animation)===!1),this._userEvents.forEach(g=>{var p;return(p=this._event)===null||p===void 0?void 0:p.on(g.eType,g.query,g.handler)}),t.reSize&&this._doResize();else if(t.reCompile&&((h=this._compiler)===null||h===void 0||h.clear({chart:this._chart,vChart:this},((d=this._option)===null||d===void 0?void 0:d.animation)===!1||((u=this._spec)===null||u===void 0?void 0:u.animation)===!1),(c=this._compiler)===null||c===void 0||c.compile({chart:this._chart,vChart:this},{})),t.reSize){const{width:g,height:p}=this.getCurrentSize();this._chart.onResize(g,p,!1),this._compiler.resize(g,p,!1)}}_beforeRender(t={}){var e,i,r,s,o,a,l,h;if(this._isReleased)return!1;if(this._chart)return!0;const{transformSpec:d,actionSource:u}=t;return d&&this._initChartSpec(this._spec,"render"),this._chartPluginApply("onBeforeInitChart",this._spec,u),(i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeInitializeChart)===null||i===void 0||i.call(e,this),this._initChart(this._spec),(s=(r=this._option.performanceHook)===null||r===void 0?void 0:r.afterInitializeChart)===null||s===void 0||s.call(r,this),!(!this._chart||!this._compiler)&&((a=(o=this._option.performanceHook)===null||o===void 0?void 0:o.beforeCompileToVGrammar)===null||a===void 0||a.call(o),this._compiler.compile({chart:this._chart,vChart:this},{performanceHook:this._option.performanceHook}),(h=(l=this._option.performanceHook)===null||l===void 0?void 0:l.afterCompileToVGrammar)===null||h===void 0||h.call(l),!0)}_afterRender(){return!this._isReleased&&(this._updateAnimateState(),this._event.emit(Ot.rendered,{chart:this._chart,vchart:this}),!0)}renderSync(t){return this._renderSync({morphConfig:t,transformSpec:!0,actionSource:"render"})}renderAsync(t){return Oo(this,void 0,void 0,function*(){return this._renderAsync({morphConfig:t,transformSpec:!0,actionSource:"render"})})}_renderAsync(t={}){return Oo(this,void 0,void 0,function*(){return this._renderSync(t)})}_updateAnimateState(t){var e,i;if(this._option.animation){const r=t?hn.appear:hn.update;(e=this._chart)===null||e===void 0||e.getAllRegions().forEach(s=>{var o;(o=s.animate)===null||o===void 0||o.updateAnimateState(r,!0)}),(i=this._chart)===null||i===void 0||i.getAllComponents().forEach(s=>{var o;(o=s.animate)===null||o===void 0||o.updateAnimateState(r,!0)})}}release(){var t,e,i,r;!((t=this._onResize)===null||t===void 0)&&t.cancel&&this._onResize.cancel(),this._chartPluginApply("releaseAll"),this._chartPlugin=null,this._chartSpecTransformer=null,(e=this._chart)===null||e===void 0||e.release(),(i=this._eventDispatcher)===null||i===void 0||i.release(),(r=this._compiler)===null||r===void 0||r.release(),this._unBindResizeEvent(),this._releaseData(),this._onError=null,this._onResize=null,this._container=null,this._currentTheme=null,this._option=null,this._chart=null,this._compiler=null,this._spec=null,this._specInfo=null,this._originalSpec=null,this._userEvents=null,this._event=null,this._eventDispatcher=null,this._isReleased=!0,lo.unregisterInstance(this)}updateData(t,e,i,r){return Oo(this,void 0,void 0,function*(){return this.updateDataSync(t,e,i,r)})}_updateDataById(t,e,i){const r=this._spec.data.find(s=>s.name===t||s.id===t);r?r.id===t?r.values=e:r.name===t&&r.parse(e,i):V(e)?this._spec.data.push({id:t,values:e}):this._spec.data.push(e)}updateDataInBatches(t){return Oo(this,void 0,void 0,function*(){return this._chart?(this._chart.updateFullData(t.map(({id:e,data:i,options:r})=>({id:e,values:i,parser:r}))),this._chart.updateGlobalScaleDomain(),this._compiler.render(),this):(this._spec.data=Q(this._spec.data),t.forEach(({id:e,data:i,options:r})=>{this._updateDataById(e,i,r)}),this)})}updateDataSync(t,e,i,r){return D(this._dataSet)?this:this._chart?(r!=null&&r.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateData(t,e,!0,i),this._compiler.render(),this):(this._spec.data=Q(this._spec.data),this._updateDataById(t,e,i),this)}updateFullDataSync(t,e=!0,i){if(this._chart)return i!=null&&i.reAnimate&&(this.stopAnimation(),this._updateAnimateState(!0)),this._chart.updateFullData(t),e&&this._compiler.render(),this;const r=Q(this._spec.data);return Q(t).forEach(s=>{const{id:o,values:a,parser:l,fields:h}=s,d=r.find(u=>u.name===o);if(d)d instanceof Ve?(d.setFields(Pn(h)),d.parse(a,Pn(l))):(d.values=a,L(l)&&(d.parser=l),L(h)&&(d.fields=h));else{const u=UF(s,this._dataSet,r);V(this._spec.data)&&this._spec.data.push(u)}}),this}updateFullData(t,e=!0){return Oo(this,void 0,void 0,function*(){return this.updateFullDataSync(t,e)})}updateSpec(t,e=!1,i,r){return Oo(this,void 0,void 0,function*(){const s=this._updateSpec(t,e,r);return s?(yield this.updateCustomConfigAndRerender(s,!1,{morphConfig:i,transformSpec:s.reTransformSpec,actionSource:"updateSpec"}),this):this})}updateSpecSync(t,e=!1,i,r){const s=this._updateSpec(t,e,r);return s?(this.updateCustomConfigAndRerender(s,!0,{morphConfig:i,transformSpec:s.reTransformSpec,actionSource:"updateSpec"}),this):this}updateSpecAndRecompile(t,e=!1,i={}){const r=this._updateSpec(t,e);return this._updateCustomConfigAndRecompile(r,Object.assign({actionSource:"updateSpecAndRecompile"},i))}updateModelSpec(t,e,i=!1,r){return Oo(this,void 0,void 0,function*(){return this.updateModelSpecSync(t,e,i,r)})}updateModelSpecSync(t,e,i=!1,r){if(!e||!this._spec)return this;if(yt(e)&&(e=JSON.parse(e)),it(t)||XWt(this._spec,t,e,i),this._chart){const s=this._chart.getModelInFilter(t);if(s)return this._updateModelSpec(s,e,!0,i,r)}return this}_updateModelSpec(t,e,i=!1,r=!1,s){r&&(e=Nt({},t.getSpec(),e));const o=t.updateSpec(e);return t.reInit(e),(o.change||o.reCompile||o.reMake||o.reSize||o.reRender)&&this._chart.reDataFlow(),this.updateCustomConfigAndRerender(o,i,{morphConfig:s,transformSpec:!1,actionSource:"updateModelSpec"})}resize(t,e){return Oo(this,void 0,void 0,function*(){return this.resizeSync(t,e)})}resizeSync(t,e){var i,r;return this._beforeResize(t,e)?((r=(i=this._compiler).resize)===null||r===void 0||r.call(i,t,e),this._afterResize()):this}_beforeResize(t,e){var i,r,s,o;if(!this._chart||!this._compiler)return!1;const a=this._chart.getCanvasRect();return(!a||a.width!==t||a.height!==e)&&(this._chartPluginApply("onBeforeResize",t,e),(r=(i=this._option.performanceHook)===null||i===void 0?void 0:i.beforeResizeWithUpdate)===null||r===void 0||r.call(i),this._chart.onResize(t,e,!1),(o=(s=this._option.performanceHook)===null||s===void 0?void 0:s.afterResizeWithUpdate)===null||o===void 0||o.call(s),!0)}_afterResize(){return this._isReleased||this._event.emit(Ot.afterResize,{chart:this._chart}),this}updateViewBox(t,e=!0,i=!0){return this._chart&&this._compiler?(this._viewBox=t,this._chart.updateViewBox(t,i),i&&(this._compiler.render(),this._chart.onEvaluateEnd()),this._compiler.updateViewBox(t,e),this):this}on(t,e,i){var r;this._userEvents&&(this._userEvents.push({eType:t,query:typeof e=="function"?null:e,handler:typeof e=="function"?e:i}),(r=this._event)===null||r===void 0||r.on(t,e,i))}off(t,e){var i;if(this._userEvents&&this._userEvents.length!==0)if(e){const r=this._userEvents.findIndex(s=>s.eType===t&&s.handler===e);r>=0&&(this._userEvents.splice(r,1),(i=this._event)===null||i===void 0||i.off(t,e))}else this._userEvents.forEach(r=>{var s;r.eType===t&&((s=this._event)===null||s===void 0||s.off(t,r.handler))}),this._userEvents=this._userEvents.filter(r=>r.eType!==t)}updateState(t,e){this._chart&&this._chart.updateState(t,e)}setSelected(t,e,i){this._chart&&this._chart.setSelected(t,e,i)}setHovered(t,e,i){this._chart&&this._chart.setHovered(t,e,i)}clearState(t){this._chart&&this._chart.clearState(t)}clearAllStates(){this._chart&&this._chart.clearAllStates()}clearSelected(){this._chart&&this._chart.clearSelected()}clearHovered(){this._chart&&this._chart.clearHovered()}_updateCurrentTheme(t){var e,i,r;const s=this._option.theme,o=(e=this._spec)===null||e===void 0?void 0:e.theme,a=(i=this._spec)===null||i===void 0?void 0:i.type;t&&(this._currentThemeName=t);const l=(d,u)=>{var c;return!((c=u.chart)===null||c===void 0)&&c[d]&&(u=FC({},u,u.chart[d])),u};let h;if(xt(s)&&xt(o))h=kh(this._currentThemeName,!0),this._currentTheme=l(a,h);else if(yt(s)&&(!o||yt(o))||yt(o)&&(!s||yt(s))){const d=FC({},kh(this._currentThemeName,!0),kh(s,!0),kh(o,!0));this._currentTheme=l(a,d)}else{const d=FC({},kh(this._currentThemeName),kh(s),kh(o));this._currentTheme=xT(l(a,d))}CFt(Dt(this._currentTheme,"component.poptip")),(r=this._compiler)===null||r===void 0||r.setBackground(this._getBackground())}_shouldChartResize(t){var e,i;let r=!1;D(this._spec.width)?!D(t.width)&&(this._spec.width=t.width):this._spec.width!==t.width&&(r=!0),D(this._spec.height)?!D(t.height)&&(this._spec.height=t.height):this._spec.height!==t.height&&(r=!0);const s=this._autoSize;return this._autoSize=!!Ua(this._option.mode)&&((i=(e=this._spec.autoFit)!==null&&e!==void 0?e:this._option.autoFit)===null||i===void 0||i),this._autoSize!==s&&(r=!0),r}_getBackground(){return(typeof this._spec.background=="string"||kt(this._spec.background)&&this._spec.background.gradient?this._spec.background:null)||this._currentTheme.background||this._option.background}getCurrentTheme(){return kh(this._currentThemeName)}getCurrentThemeName(){return this._currentThemeName}setCurrentTheme(t){return Oo(this,void 0,void 0,function*(){return this.setCurrentThemeSync(t)})}setCurrentThemeSync(t){var e;if(!Tc.themeExist(t))return this;const i=this._setCurrentTheme(t);return this._setFontFamilyTheme((e=this._currentTheme)===null||e===void 0?void 0:e.fontFamily),this.updateCustomConfigAndRerender(i,!0,{transformSpec:!1,actionSource:"setCurrentTheme"}),this}_setCurrentTheme(t){var e;return this._updateCurrentTheme(t),this._initChartSpec(this._getSpecFromOriginalSpec(),"setCurrentTheme"),(e=this._chart)===null||e===void 0||e.setCurrentTheme(),{change:!0,reMake:!1}}_setFontFamilyTheme(t){var e;t&&((e=this.getStage())===null||e===void 0||e.setTheme({text:{fontFamily:t},richtext:{fontFamily:t}}))}_getTooltipComponent(){var t;return(t=this._chart)===null||t===void 0?void 0:t.getComponentsByType(vt.tooltip)[0]}setTooltipHandler(t){var e,i;this._context.tooltipHandler=t;const r=this._getTooltipComponent();r&&((i=(e=r.tooltipHandler)===null||e===void 0?void 0:e.release)===null||i===void 0||i.call(e),r.tooltipHandler=t)}getTooltipHandlerByUser(){var t;return(t=this._context)===null||t===void 0?void 0:t.tooltipHandler}getTooltipHandler(){const t=this._getTooltipComponent();return t?t.tooltipHandler:this._context.tooltipHandler}showTooltip(t,e){var i;const r=this._getTooltipComponent();return(i=L(t)&&(r==null?void 0:r.showTooltip(t,e))!=="none")!==null&&i!==void 0&&i}hideTooltip(){var t;const e=this._getTooltipComponent();return(t=e==null?void 0:e.hideTooltip())!==null&&t!==void 0&&t}getLegendDataById(t){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentByUserId(t);return i?i.getLegendData():[]}getLegendDataByIndex(t=0){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentsByType(vt.discreteLegend);return i&&i[t]?i[t].getLegendData():[]}getLegendSelectedDataById(t){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentByUserId(t);return i?i.getSelectedData():[]}getLegendSelectedDataByIndex(t=0){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getComponentsByType(vt.discreteLegend);return i&&i[t]?i[t].getSelectedData():[]}setLegendSelectedDataById(t,e){var i;const r=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(t);r&&r.setSelectedData(e)}setLegendSelectedDataByIndex(t=0,e){var i;const r=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(vt.discreteLegend);r&&r[t]&&r[t].setSelectedData(e)}getDataURL(){var t;return Oo(this,void 0,void 0,function*(){const e=this.getStage();if(this._chart&&e){e.render();const i=this._chart.getCanvas();return yield UVt(i,{onError:this._onError})}return(t=this._option)===null||t===void 0||t.onError(new ReferenceError("render is not defined")),null})}exportImg(t){var e,i;return Oo(this,void 0,void 0,function*(){if(!Ua(this._option.mode))return void((e=this._option)===null||e===void 0||e.onError(new TypeError("non-browser environment can not export img")));const r=yield this.getDataURL();r?VVt(t,r):(i=this._option)===null||i===void 0||i.onError(new ReferenceError("render is not defined"))})}exportCanvas(){var t;const e=this.getStage();if(this._chart&&e)return e.toCanvas();(t=this._option)===null||t===void 0||t.onError(new ReferenceError("render is not defined"))}getImageBuffer(){var t,e;if(this._option.mode!=="node")return void((t=this._option)===null||t===void 0||t.onError(new TypeError("getImageBuffer() now only support node environment.")));const i=this.getStage();return i?(i.render(),i.window.getImageBuffer()):((e=this._option)===null||e===void 0||e.onError(new ReferenceError("render is not defined")),null)}setLayout(t){var e;this._option.layout=t,(e=this._chart)===null||e===void 0||e.setLayout(t)}reLayout(){var t;(t=this._chart)===null||t===void 0||t.setLayoutTag(!0)}getCompiler(){return this._compiler}getChart(){return this._chart}getStage(){return this._compiler.getStage()}getCanvas(){var t;return(t=this._compiler)===null||t===void 0?void 0:t.getCanvas()}getContainer(){var t;if(L(this._container))return this._container;let e;return e=yt(this._canvas)?le.getElementById(this._canvas):this._canvas,L(e)?e.parentElement:(t=this.getCanvas())===null||t===void 0?void 0:t.parentElement}getComponents(){return this._chart.getAllComponents()}getScale(t){var e;const i=(e=this._chart)===null||e===void 0?void 0:e.getGlobalScale();return i==null?void 0:i.getScale(t)}setDimensionIndex(t,e={}){var i;return(i=this._chart)===null||i===void 0?void 0:i.setDimensionIndex(t,e)}stopAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.stop()}pauseAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.pause()}resumeAnimation(){var t,e,i;(i=(e=(t=this._compiler)===null||t===void 0?void 0:t.getVGrammarView())===null||e===void 0?void 0:e.animate)===null||i===void 0||i.resume()}convertDatumToPosition(t,e={},i=!1,r){var s;if(!this._chart||xt(t))return null;const{seriesId:o,seriesIndex:a=0}=e;let l;if(L(o)?l=this._chart.getSeriesInUserId(o):L(a)&&(l=(s=this._chart.getSeriesInIndex([a]))===null||s===void 0?void 0:s[0]),l){const h=Object.keys(t),d=l.getViewData().latestData.find(g=>h.every(p=>g[p]==t[p])),u=l.getRegion().getLayoutStartPoint();let c;return c=d?l.dataToPosition(d,r):l.dataToPosition(t,r),c?MU(c,u,i):null}return null}convertValueToPosition(t,e,i=!1){var r,s;if(!this._chart||D(t)||xt(e))return null;if(!V(t)){const{axisId:h,axisIndex:d}=e;let u;if(L(h)?u=this._chart.getComponentsByKey("axes").find(g=>g.userId===h):L(d)&&(u=(r=this._chart.getComponentsByKey("axes"))===null||r===void 0?void 0:r[d]),!u)return ls("Please check whether the `axisId` or `axisIndex` is set!"),null;const c=u==null?void 0:u.valueToPosition(t);if(i){const g=u.getLayoutStartPoint(),p=u.getOrient();return c+(p==="bottom"||p==="top"?g.x:g.y)}return c}const{seriesId:o,seriesIndex:a}=e;let l;return L(o)?l=this._chart.getSeriesInUserId(o):L(a)&&(l=(s=this._chart.getSeriesInIndex([a]))===null||s===void 0?void 0:s[0]),l?MU(l.valueToPosition(t[0],t[1]),l.getRegion().getLayoutStartPoint(),i):(ls("Please check whether the `seriesId` or `seriesIndex` is set!"),null)}getFunction(t){return Ps.instance().getFunction(t)}registerFunction(t,e){t&&e&&Ps.instance().registerFunction(t,e)}unregisterFunction(t){t&&Ps.instance().unregisterFunction(t)}getFunctionList(){return Ps.instance().getFunctionNameList()}setRuntimeSpec(t){this._spec=t,this._updateSpecInfo()}updateIndicatorDataById(t,e){var i;const r=(i=this._chart)===null||i===void 0?void 0:i.getComponentByUserId(t);r&&r.updateDatum(e)}updateIndicatorDataByIndex(t=0,e){var i;const r=(i=this._chart)===null||i===void 0?void 0:i.getComponentsByType(vt.indicator);r&&r[t]&&r[t].updateDatum(e)}geoZoomByIndex(t=0,e,i){this._geoZoomByQuery({regionIndex:t},e,i)}geoZoomById(t,e,i){this._geoZoomByQuery({regionId:t},e,i)}_geoZoomByQuery(t,e,i){var r,s;const o=(r=this._chart)===null||r===void 0?void 0:r.getRegionsInQuerier(t)[0],a=(s=this._chart)===null||s===void 0?void 0:s.getComponentsByType(vt.geoCoordinate),l=a==null?void 0:a.find(h=>{var d;return(d=h.getRegions())===null||d===void 0?void 0:d.includes(o)});l&&l.dispatchZoom(e,i)}_initChartPlugin(){const t=q.getChartPlugins();t.length>0&&(this._chartPlugin=new bGt(this),this._chartPlugin.load(t.map(e=>new e)),this._chartPluginApply("onInit",this._spec))}_chartPluginApply(t,...e){this._chartPlugin&&this._chartPlugin[t]&&this._chartPlugin[t].apply(this._chartPlugin,e)}_getMode(){return this._option.mode||an["desktop-browser"]}_getChartOption(t){return{type:t,globalInstance:this,eventDispatcher:this._eventDispatcher,dataSet:this._dataSet,container:this._container,canvas:this._canvas,map:new Map,mode:this._getMode(),modeParams:this._option.modeParams,getCompiler:()=>this._compiler,performanceHook:this._option.performanceHook,viewBox:this._viewBox,animation:this._option.animation,getTheme:()=>{var e;return(e=this._currentTheme)!==null&&e!==void 0?e:{}},getSpecInfo:()=>{var e;return(e=this._specInfo)!==null&&e!==void 0?e:{}},layout:this._option.layout,onError:this._onError,disableTriggerEvent:this._option.disableTriggerEvent===!0}}}zn.InstanceManager=lo,zn.ThemeManager=Tc,zn.globalConfig={uniqueTooltip:!0},zn.Utils=mGt,zn.vglobal=le;q.registerRegion("region",Np),q.registerLayout("base",qF),qit(),Zd.useRegisters([CVt]),Gjt(),Vjt(),IF(HU.name,HU),ge.getInstance(ks.Error);const Yf=(n,t)=>{const e=t.beforeCall();return n&&n.forEach((i,r)=>t.call(i,r,e)),e.keyMap&&(e.keyMap.clear(),e.keyMap=null),n};function es(n,t){return Dt(t,`component.${n}`)}function sh(n,t,e,i){if(n)return{formatFunc:n,args:[e,i]};const r=q.getFormatter();return t&&r?{formatFunc:r,args:[e,i,t]}:{}}const la=(n,t,e,i)=>{if(D(n[t]))return;const r=V(n[t]),s=r?n[t]:[n[t]],o=[];return s.forEach((a,l)=>{!a||i&&!i(a)||o.push({spec:a,specPath:r?[t,l]:[t],specInfoPath:["component",t,l],type:e})}),o},Nu=(n,t,e,i)=>{let r;if(r=it(n)?n(t,e):os(n)&&L(n.field)?Dt(t,n.field):n,i){const{formatFunc:s,args:o}=sh(void 0,i,n,t);s&&o&&(r=s(...o))}return r},b8=(n,t,e)=>D(n)?n:it(n)?n(t,e):n;function xGt(n){var t;const e=!((t=n[0])===null||t===void 0)&&t.series?[{data:n,value:""}]:n;for(const{data:i}of e)for(const{datum:r}of i)for(const s of r??[])if(s)return s}var wGt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const AGt=n=>{var t,e,i;if((n==null?void 0:n.visible)===!1)return[];const r={mark:((t=n==null?void 0:n.mark)===null||t===void 0?void 0:t.visible)!==!1,dimension:((e=n==null?void 0:n.dimension)===null||e===void 0?void 0:e.visible)!==!1,group:((i=n==null?void 0:n.group)===null||i===void 0?void 0:i.visible)!==!1};return L(n==null?void 0:n.activeType)&&Object.keys(r).forEach(s=>{var o;r[s]=(o=n==null?void 0:n.activeType)===null||o===void 0?void 0:o.includes(s)}),Object.keys(r).filter(s=>r[s])},ZF=(n,t)=>!t||t.visible!==!1&&(!t[n]||t[n].visible!==!1)&&!(t.activeType&&!(V(t.activeType)?t.activeType.includes(n):t.activeType===n));function MGt(n){return D(n.mark)&&D(n.model)&&D(n.datum)}function DI(n,t,e,i,r,s){const o=a=>{if(a){const l={datum:r},h=D(a.key)&&D(a.value)&&!xt(a)?Object.assign(Object.assign(Object.assign({},i),e),a):Object.assign(Object.assign({},i),a),{key:d,keyFormatter:u,keyTimeFormat:c,keyTimeFormatMode:g,value:p,valueFormatter:f,valueTimeFormat:m,valueTimeFormatMode:v}=h,_=wGt(h,["key","keyFormatter","keyTimeFormat","keyTimeFormatMode","value","valueFormatter","valueTimeFormat","valueTimeFormatMode"]);l.key=FI(Nu(d,r,s,u),c,g),l.value=FI(Nu(p,r,s,f),m,v),Object.keys(_).forEach(b=>{l[b]=Nu(h[b],r,s)}),l.visible!==!1&&(L(l.key)||L(l.value))&&n.push(l)}};V(t)?t.forEach(a=>{o(a)}):o(t)}function y8(n,t,e,i,r,s,o){it(t)?DI(n,t(r,o),e,i,s,o):t&&DI(n,t,e,i,s,o)}function TGt(n,t,e,i,r,s){if(r&&r.length){const o=[];return r.forEach(a=>{V(n)?n.forEach(l=>{y8(o,l,t,e,i,a,s)}):it(n)?y8(o,n,t,e,i,a,s):n&&DI(o,n,t,e,a,s)}),o}return null}function kGt(n){if(!n||!n.length)return null;const t=[];return n.forEach(({content:e})=>{e&&e.forEach(i=>{t.push(i)})}),t.length?Object.assign(Object.assign({},n[0]),{content:t}):n[0]}const FI=(n,t,e)=>{if(!t&&!e)return typeof n!="object"?n==null?void 0:n.toString():n;const i=Xo.getInstance();return t=t||"%Y%m%d",((e=e||"local")==="local"?i.timeFormat:i.timeUTCFormat)(t,n)};class wr{constructor(t){this.activeTriggerSet={mark:new Set,group:new Set},this.ignoreTriggerSet={mark:new Set},this._getSeriesCacheInfo=()=>{var e,i,r;const{series:s}=this,o=s.getSeriesField();return{seriesFields:L(o)?Q(o):(e=s.getSeriesKeys())!==null&&e!==void 0?e:[],dimensionFields:(i=s.getDimensionField())!==null&&i!==void 0?i:[],measureFields:(r=s.getMeasureField())!==null&&r!==void 0?r:[],type:s.type}},this._getDimensionData=e=>{const{dimensionFields:i}=this._seriesCacheInfo;return i[0]&&(e==null?void 0:e[i[0]])},this._getMeasureData=e=>{const{measureFields:i}=this._seriesCacheInfo;return i[0]&&(e==null?void 0:e[i[0]])},this._getSeriesFieldData=e=>{const{dimensionFields:i,seriesFields:r}=this._seriesCacheInfo;if(L(r[0])&&(e!=null&&e[r[0]]))return e==null?void 0:e[r[0]];const s=i[i.length-1];return i.length>1&&(r.length===0||this.series.getSeriesKeys().length),e==null?void 0:e[s]},this._getSeriesStyle=(e,i,r)=>{var s;for(const o of Q(i)){const a=(s=this.series.getSeriesStyle(e))===null||s===void 0?void 0:s(o);if(L(a))return a}return r},this.markTooltipKeyCallback=(e,i)=>this._getSeriesFieldData(e),this.markTooltipValueCallback=(e,i)=>this._getMeasureData(e),this.shapeTypeCallback=(e,i)=>{var r;return(r=this._getSeriesStyle(e,"shape",null))!==null&&r!==void 0?r:this._getSeriesStyle(e,"symbolType",this.series.getDefaultShapeType())},this.shapeColorCallback=(e,i)=>this._getSeriesStyle(e,["fill","stroke"]),this.shapeStrokeCallback=(e,i)=>this._getSeriesStyle(e,["stroke","fill"]),this.dimensionTooltipTitleCallback=(e,i)=>this._getDimensionData(e),this.groupTooltipTitleCallback=(e,i)=>this._getSeriesFieldData(e),this.groupTooltipKeyCallback=(e,i)=>{const{seriesFields:r}=this._seriesCacheInfo;let s=this._seriesCacheInfo.dimensionFields;return r[0]&&(s=s.filter(o=>o!==r[0])),s.map(o=>e==null?void 0:e[o]).join("-")},this.getHasShape=e=>!!e,this.series=t,this.updateTooltipSpec()}updateTooltipSpec(){var t;const e=(t=this.series.getSpec())===null||t===void 0?void 0:t.tooltip;this.spec=e,this._seriesCacheInfo=this._getSeriesCacheInfo()}getShapeAttrs(t,e,i){var r,s,o,a,l,h,d,u,c,g,p,f;const m=e?"content":"title",v=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},(r=i==null?void 0:i.style)===null||r===void 0?void 0:r.shape),i==null?void 0:i[t]),(s=i==null?void 0:i[t])===null||s===void 0?void 0:s[m]),(o=this.spec)===null||o===void 0?void 0:o[t]),(l=(a=this.spec)===null||a===void 0?void 0:a[t])===null||l===void 0?void 0:l[m]);return{shapeType:(h=v.shapeType)!==null&&h!==void 0?h:this.shapeTypeCallback,shapeFill:(u=(d=v.shapeFill)!==null&&d!==void 0?d:v.shapeColor)!==null&&u!==void 0?u:this.shapeColorCallback,shapeStroke:(c=v.shapeStroke)!==null&&c!==void 0?c:this.shapeStrokeCallback,shapeHollow:(g=v.shapeHollow)!==null&&g!==void 0&&g,shapeLineWidth:v.shapeLineWidth,shapeSize:(p=v.shapeSize)!==null&&p!==void 0?p:v.size,hasShape:(f=v.hasShape)!==null&&f!==void 0?f:this.getHasShape(e)}}enableByType(t){return!0}getDefaultContentList(t){return[this.getDefaultContentPattern(t)]}getContentList(t,e,i,r,s,o){var a;return TGt((a=e==null?void 0:e.content)!==null&&a!==void 0?a:this.getDefaultContentList(t),this.getDefaultContentPattern(t),i,r,s,o)}getTitleResult(t,e,i,r,s){let o=it(e)?e(r,s):e;if(o?D(o.value)&&(o=Object.assign(Object.assign({},this.getDefaultTitlePattern(t)),o)):o=this.getDefaultTitlePattern(t),o&&o.visible!==!1){const a=xGt(r),l={visible:Nu(o.visible,a,s),value:FI(Nu(o.value,a,s,o.valueFormatter),o.valueTimeFormat,o.valueTimeFormatMode),valueStyle:Nu(o.valueStyle,a,s),hasShape:o.hasShape};return Object.keys(i).forEach(h=>{l[h]=Nu(i[h],a,s)}),l}return{hasShape:!1,visible:!1}}getTooltipData(t,e,i,r,s){var o,a;if(!(this.enableByType(t)&&ZF(t,this.spec)&&(t!=="dimension"||r&&r.length)))return null;const l=(a=(o=this.spec)===null||o===void 0?void 0:o[t])!==null&&a!==void 0?a:e==null?void 0:e[t],h=this.getShapeAttrs(t,!0,e),d=this.getShapeAttrs(t,!1,e);let u;return t==="dimension"?(u=[],this.getContentList(t,l,h,i,r,s).forEach(c=>{u.push(c)})):u=this.getContentList(t,l,h,i,r,s),{visible:!0,activeType:t,data:i,title:this.getTitleResult(t,l==null?void 0:l.title,d,i,s),content:u}}getDefaultTitlePattern(t){return{key:void 0,value:t==="group"?this.groupTooltipTitleCallback:this.dimensionTooltipTitleCallback}}getDefaultContentPattern(t){return{seriesId:this.series.id,key:t==="group"?this.groupTooltipKeyCallback:this.markTooltipKeyCallback,value:this.markTooltipValueCallback}}}const RGt={min:n=>n.length?Ri(n.map(t=>1*t)):0,max:n=>n.length?Mi(n.map(t=>1*t)):0,"array-min":n=>n.length?Ri(n.map(t=>1*t)):0,"array-max":n=>n.length?Mi(n.map(t=>1*t)):0,values:n=>{const t={},e=[];for(const i of n)t[i]||(e.push(i),t[i]=1);return e}},HI=(n,t)=>{var e,i;let r=t.fields;if(it(r)&&(r=r()),!(r!=null&&r.length)||!(n!=null&&n.length))return{};r=jp([],r);const s=t.target==="parser"?"parserData":"latestData",o=n[0][s]?n[0][s]:n||[],a=(i=(e=n[0]).getFields)===null||i===void 0?void 0:i.call(e);return Jit(o,r,a)},Jit=(n,t,e)=>{const i={};let r=[],s=[];return t.forEach(o=>{const a=o.key;i[a]={};const l=e==null?void 0:e[a],h=o.operations,d=h.some(g=>g==="min"||g==="max"||g==="allValid");let u=!0;r.length=0,n&&n.forEach(g=>{g&&r.push(g[a])});const c=r.length;if(d){s.length=0,r.forEach((p,f)=>{mf(p)&&s.push(p)});const g=r;r=s,s=g,u=r.length===c}else r=h.some(g=>g==="array-min"||g==="array-max")?r.reduce((g,p)=>(p&&p.forEach(f=>{mf(f)&&g.push(f)}),g),[]):r.filter(g=>g!==void 0);o.filter&&(r=r.filter(o.filter)),h.forEach(g=>{if(o.customize)i[a][g]=o.customize;else{if(l&&l.lockStatisticsByDomain===!0&&!D(l.domain)){if(g==="values")return void(i[a][g]=l.domain.slice())}else if(g==="allValid")return;i[a][g]=RGt[g](r),g==="array-max"&&(i[a].max=i[a][g]),g==="array-min"&&(i[a].min=i[a][g])}}),d&&(i[a].allValid=u)}),i},BGt=(n,t)=>{const{config:e}=t;if(!e)return n;const{invalidType:i,checkField:r}=e();return i!=="zero"||r&&r.length&&n.forEach(s=>{r.forEach(o=>{mf(s[o])||(s[o]=0)})}),n};class tl extends Qa{_compileProduct(){var t;const e=(t=this._data)===null||t===void 0?void 0:t.latestData;D(e)||L(this.getProduct())||this._initProduct([])}generateProductId(){var t;return(t=this._data)===null||t===void 0?void 0:t.name}}const zI=`${Wt}_HIERARCHY_DEPTH`,Fc=`${Wt}_HIERARCHY_ROOT`,PGt=`${Wt}_HIERARCHY_ROOT_INDEX`;function xf(){return{keyMap:new Map,needDefaultSeriesField:!this._seriesField,defaultSeriesField:this._seriesField?null:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey)}}function Hc(n,t,e){n&&(e.needDefaultSeriesField&&(n[Fr]=e.defaultSeriesField),n[rr]=t,n[sa]=e.getKey(n,t,e))}function JF(){return{keyMap:new Map,needDefaultSeriesField:!0,defaultSeriesField:this.getSeriesKeys()[0],getKey:this.generateDefaultDataKey(this._spec.dataKey),categoryField:this.getCategoryField()}}function OT(n,t,e,i=0,r,s){s===void 0&&(s=t),Hc(n,t,e),n[zI]=i,n[Fc]=r||n[e.categoryField],n[PGt]=s,n.children&&n.children.length&&n.children.forEach((o,a)=>OT(o,a,e,n[zI]+1,n[Fc],s))}const Hi={label:{name:"label",type:"text"}},C8=`${Wt}_rect_x`,S8=`${Wt}_rect_x1`,x8=`${Wt}_rect_y`,w8=`${Wt}_rect_y1`,EGt={data:!0},A8={invalidType:!0,animation:!0,animationAppear:!0,animationEnter:!0,animationUpdate:!0,animationExit:!0,animationNormal:!0},LGt=n=>({type:"clipIn",options:{clipDimension:n.direction==="horizontal"?"y":"x"}}),IGt={type:"fadeIn"},OGt=n=>({type:n.direction==="horizontal"?"growPointsXIn":"growPointsYIn",options:{orient:n.direction==="horizontal"?"positive":"negative"}});function DGt(n,t){switch(t){case"grow":return OGt(n);case"fadeIn":return IGt;default:return LGt(n)}}const ja={appear:{duration:1e3,easing:"cubicOut"},update:{type:"update",duration:300,easing:"linear"},enter:{duration:300,easing:"linear"},exit:{duration:300,easing:"linear"},disappear:{duration:500,easing:"cubicIn"},state:{duration:300,easing:"linear"}},QF={appear:{type:"scaleIn"},enter:{type:"scaleIn"},exit:{type:"scaleOut"},disappear:{type:"scaleOut"}},DT={appear:{type:"fadeIn"},enter:{type:"fadeIn"},exit:{type:"fadeOut"},disappear:{type:"fadeOut"}},FT=()=>{q.registerAnimation("scaleInOut",()=>QF)},mh=()=>{q.registerAnimation("fadeInOut",()=>DT)},FGt=()=>{q.registerAnimation("cartesianGroupClip",n=>({appear:{custom:XV,customParameters:(t,e)=>({animationType:"in",group:e.getGraphicItem(),direction:n.direction(),width:n.width(),height:n.height(),orient:n.orient()})},disappear:{custom:XV,customParameters:(t,e)=>({animationType:"out",group:e.getGraphicItem(),direction:n.direction(),width:n.width(),height:n.height(),orient:n.orient()})}}))},Qit=(n,t)=>({appear:DGt(n,t),enter:{type:"fadeIn"},exit:{type:"fadeOut"},update:[{type:"update",options:{excludeChannels:["points","defined","segments"]}},{channel:["points","segments"],custom:gQ,duration:ja.update.duration,easing:ja.update.easing,customParameters:{clipRangeByDimension:n.direction==="horizontal"?"y":"x"}}],disappear:{type:"clipOut"}}),tnt=()=>{q.registerAnimation("line",Qit)},HGt=()=>{q.registerAnimation("area",Qit)},zGt=()=>{Zd.useRegisters([nVt,rVt,z$t,W$t,eVt,iVt,sVt,oVt,aVt])},ent=()=>{Zd.useRegisters([$$t,V$t,G$t,U$t,j$t,N$t])},int=()=>{Zd.useRegisters([Q$t,tVt,Z$t,J$t])},nnt=()=>{Zd.useRegisters([Tit,kit,Y$t,X$t,K$t,q$t,F$t,H$t])},rnt=()=>{Zd.useRegisters([Tit,kit])},M8=[...Object.keys(ja),"normal"];function Ae(n={},t,e){const i={};for(let r=0;r<M8.length;r++){const s=M8[r],o=t?t[s]:void 0;if(o===!1)continue;if(s==="normal"){o&&(i.normal=o);continue}if(s==="state"){o!==!1&&(i.state=o??ja.state);continue}if(s!=="update"&&!o&&!n[s])continue;let a,l;a=V(n[s])?n[s]:[Object.assign(Object.assign({},ja[s]),n[s])],s==="exit"&&a.forEach(h=>{h.controlOptions={stopWhenStateChange:!0}}),o?(l=V(o)?o.map((h,d)=>{var u;let c=h;return R8(c)&&delete c.type,c.oneByOne&&(c=T8(c,(u=e==null?void 0:e.dataIndex)!==null&&u!==void 0?u:k8,e==null?void 0:e.dataCount)),c}):a.map((h,d)=>{var u;let c=Nt({},a[d],o);return R8(c)&&delete c.type,c.oneByOne&&(c=T8(c,(u=e==null?void 0:e.dataIndex)!==null&&u!==void 0?u:k8,e==null?void 0:e.dataCount)),c}),i[s]=l):i[s]=a}return i}function Fe(n,t,e){var i,r,s,o,a,l;const h={};return L(t.animationAppear)&&(h.appear=(i=t.animationAppear[n])!==null&&i!==void 0?i:t.animationAppear),L(t.animationDisappear)&&(h.disappear=(r=t.animationDisappear[n])!==null&&r!==void 0?r:t.animationDisappear),L(t.animationEnter)&&(h.enter=(s=t.animationEnter[n])!==null&&s!==void 0?s:t.animationEnter),L(t.animationExit)&&(h.exit=(o=t.animationExit[n])!==null&&o!==void 0?o:t.animationExit),L(t.animationUpdate)&&(h.update=(a=t.animationUpdate[n])!==null&&a!==void 0?a:t.animationUpdate),L(t.animationState)&&(h.state=(l=t.animationState[n])!==null&&l!==void 0?l:t.animationState),t.animationNormal&&t.animationNormal[n]&&(h.normal=t.animationNormal[n]),jGt(h,e)}function T8(n,t,e){const{oneByOne:i,duration:r,delay:s,delayAfter:o}=n;return n.delay=(a,l,h)=>{const d=t(a,h),u=it(r)?r(a,l,h):et(r)?r:0,c=it(s)?s(a,l,h):et(s)?s:0;let g=it(i)?i(a,l,h):i;return g===!1?c:(g=g===!0?0:g,c+d*(u+g))},n.delayAfter=(a,l,h)=>{const d=t(a,h),u=it(r)?r(a,l,h):et(r)?r:0,c=it(o)?o(a,l,h):et(o)?o:0;let g=it(i)?i(a,l,h):i;return g===!1?c:(g=g===!0?0:g,c+((e?e():l.mark.elements.length)-d)*(u+g))},delete n.oneByOne,n}function k8(n,t){var e,i;return(e=n==null?void 0:n[rr])!==null&&e!==void 0?e:(i=t==null?void 0:t.VGRAMMAR_ANIMATION_PARAMETERS)===null||i===void 0?void 0:i.elementIndex}function ll(n,t){var e,i,r,s,o;if(n.animation===!1||((e=n.morph)===null||e===void 0?void 0:e.enable)===!1)return!1;const a=((r=(i=n.animationAppear)===null||i===void 0?void 0:i[t])!==null&&r!==void 0?r:n.animationAppear)!==!1,l=((o=(s=n.animationUpdate)===null||s===void 0?void 0:s[t])!==null&&o!==void 0?o:n.animationUpdate)!==!1;return!(!a||!l)}function WGt(n){return L(n.timeSlices)}function R8(n){return!WGt(n)&&L(n.channel)}function jGt(n,t){if(!n)return n;const e=["custom","customParameters"];return WI(n=Pn(n,null,e),i=>{var r;return it(i)&&((r=i.prototype)===null||r===void 0?void 0:r.constructor)!==i?(...s)=>i(...s,t):i},e),n}function WI(n,t,e=[]){if(V(n))n.forEach((i,r)=>{n[r]=t(n[r],r),WI(n[r],t,e)});else if(kt(n))for(const i in n)e.includes(i)||(n[i]=t(n[i],i),WI(n[i],t,e))}function B8(n){var t,e,i,r;const s=n.getSpec();if(s.animation===!1||!L(n.getRegion().animate))return!1;let o=(t=s.animationThreshold)!==null&&t!==void 0?t:Number.MAX_SAFE_INTEGER;return(e=n.getMarks())===null||e===void 0||e.forEach(a=>{const l=a.getMarkConfig();l&&(l.large&&l.largeThreshold&&(o=Math.min(o,l.largeThreshold)),l.progressiveThreshold&&(o=Math.min(o,l.progressiveThreshold)))}),!(((r=(i=n.getRawData())===null||i===void 0?void 0:i.latestData)===null||r===void 0?void 0:r.length)>=o)}class Ar extends ET{constructor(){super(...arguments),this.markLabelSpec={}}getLabelSpec(t){return this.markLabelSpec[t]}setLabelSpec(t,e){this.markLabelSpec[t]=Q(e)}addLabelSpec(t,e,i=!1){this.markLabelSpec[t]||(this.markLabelSpec[t]=[]),i?this.markLabelSpec[t].unshift(e):this.markLabelSpec[t].push(e)}getTheme(t,e){var i,r,s;const o=ket(t),a=(i=this._option)===null||i===void 0?void 0:i.getTheme(),{markByName:l,mark:h}=a,d=this._option.type,u=q.getSeriesMarkMap(d)?qWt(Dt(a,`series.${d}`),d,h,l):{},c=Dt(a,`series.${d}_${o}`),g=((s=(r=this.stack)!==null&&r!==void 0?r:c==null?void 0:c.stack)!==null&&s!==void 0?s:u!=null&&u.stack)?Dt(a,`series.${d}_stack`):void 0;return Nt({},u,c,g)}transformSpec(t,e,i){this._transformStack(t);const r=super.transformSpec(t,e,i);return this._transformLabelSpec(r.spec),Object.assign(Object.assign({},r),{markLabelSpec:this.markLabelSpec,stack:this.stack})}_transformLabelSpec(t){}_transformStack(t){Re(t.stack)&&(this.stack=t.stack),Re(t.percent)&&(this.stack=t.percent||this.stack),D(this.stack)&&this._supportStack&&t.seriesField&&(this.stack=!0)}_addMarkLabelSpec(t,e,i="label",r="initLabelMarkStyle",s=!0,o){t&&Q(t[i]).forEach(a=>{var l,h,d;if(a&&a.visible){const{animation:u=!0,animationUpdate:c=!0,animationEnter:g=!0,animationExit:p=!0}=a,{animationUpdate:f=!0,animationEnter:m=!0,animationExit:v=!0}=t,_=!!((d=(h=(l=this._option)===null||l===void 0?void 0:l.animation)!==null&&h!==void 0?h:t.animation)!==null&&d!==void 0?d:a.animation)&&!!s;this.addLabelSpec(it(e)?e(a):e,Object.assign(Object.assign({},a),{animation:!!_&&u,animationUpdate:!!(_&&f&&c)&&f,animationEnter:!!(_&&m&&g)&&m,animationExit:!!(_&&m&&p)&&v,getStyleHandler:b=>{var y;return(y=b[r])===null||y===void 0?void 0:y.bind(b)}}),o)}})}_getDefaultSpecFromChart(t){var e;const i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{outerRadius:r,innerRadius:s,direction:o}=t;return L(r)&&(i.outerRadius=r),L(s)&&(i.innerRadius=s),L(o)&&(i.direction=o),Object.keys(i).length>0?i:void 0}_mergeThemeToSpec(t,e){const i=this._theme;if(this._shouldMergeThemeToSpec()){const r=this._getDefaultSpecFromChart(e),s=o=>{const a=Nt({},i,r,o),l=i.label;return l&&kt(l)&&V(a.label)&&(a.label=a.label.map(h=>Nt({},l,h))),a};return V(t)?{spec:t.map(o=>s(o)),theme:i}:{spec:s(t),theme:i}}return{spec:t,theme:i}}}function NGt(n){return n===an["desktop-browser"]||n===an["desktop-miniApp"]?{hover:{enable:!0,trigger:"pointermove",triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"pointertap"}}:Pd(n)||Yd(n)?{hover:{enable:!0,trigger:["pointerdown","pointermove"],triggerOff:"view:pointerleave"},select:{enable:!0,trigger:"tap"}}:null}class zc extends KF{getRegion(){return this._region}getLayoutStartPoint(){return this._region.getLayoutStartPoint()}getRootMark(){return this._rootMark}getSeriesMark(){return this._seriesMark}getRawData(){return this._rawData}getViewDataFilter(){return this._viewDataFilter}getViewData(){var t;return(t=this._data)===null||t===void 0?void 0:t.getDataView()}getViewDataProductId(){var t;return(t=this._data)===null||t===void 0?void 0:t.getProductId()}getViewDataStatistics(){return this._viewDataStatistics}getViewStackData(){return this._viewStackData}getSeriesField(){return this._seriesField}setSeriesField(t){L(t)&&(this._seriesField=t)}getGroups(){return this._groups}getStack(){var t;return(t=this.getSpecInfo())===null||t===void 0?void 0:t.stack}getStackValue(){var t;return(t=this._spec.stackValue)!==null&&t!==void 0?t:`${Wt}_series_${this.type}`}getPercent(){return this._spec.percent}getStackOffsetSilhouette(){return this._spec.stackOffsetSilhouette}get tooltipHelper(){return this._tooltipHelper||this.initTooltip(),this._tooltipHelper}getInvalidType(){return this._invalidType}setInvalidType(t){var e;this._invalidType=t,(e=this.getViewData())===null||e===void 0||e.reRunAllTransform()}getMarkAttributeContext(){return this._markAttributeContext}constructor(t,e){var i;super(t,e),this.specKey="series",this.type="series",this.layoutType="absolute",this.modelType="series",this.name=void 0,this.transformerConstructor=Ar,this.coordinate="none",this._region=null,this._layoutStartPoint={x:0,y:0},this._layoutRect={width:null,height:null},this.getLayoutRect=()=>{var r,s;return{width:(r=this._layoutRect.width)!==null&&r!==void 0?r:this._region.getLayoutRect().width,height:(s=this._layoutRect.height)!==null&&s!==void 0?s:this._region.getLayoutRect().height}},this._rootMark=null,this._seriesMark=null,this._viewDataMap=new Map,this._viewDataFilter=null,this._data=null,this.layoutZIndex=Qe.SeriesGroup,this._invalidType="break",this._region=e.region,this._dataSet=e.dataSet,!((i=this._spec)===null||i===void 0)&&i.name&&(this.name=this._spec.name)}created(){super.created(),this._buildMarkAttributeContext(),this.initData(),this.initGroups(),this.initStatisticalData(),this.event.emit(Ot.afterInitData,{model:this}),this.initRootMark(),this.initMark();const t=B8(this);this._initExtensionMark({hasAnimation:t}),this.initMarkStyle(),this.initMarkState(),t&&this.initAnimation(),this._option.disableTriggerEvent||this.initInteraction(),this.afterInitMark(),this.initEvent(),this.event.emit(Ot.afterInitEvent,{model:this})}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(t,e)=>{var i;return(i=this._option.globalScale.getScale(t))===null||i===void 0?void 0:i.scale(e)},seriesColor:t=>{var e;return D(t)&&(t=this.getSeriesKeys()[0]),(e=this._option.globalScale.getScale("color"))===null||e===void 0?void 0:e.scale(t)},getRegion:()=>this._region}}setAttrFromSpec(){super.setAttrFromSpec(),this.setSeriesField(this._spec.seriesField),L(this._spec.invalidType)&&(this._invalidType=this._spec.invalidType)}getInvalidCheckFields(){return[this.getStackValueField()]}initInvalidDataTransform(){var t,e;this._invalidType==="zero"&&(!((t=this._rawData)===null||t===void 0)&&t.dataSet)&&(Vt(this._rawData.dataSet,"invalidTravel",BGt),(e=this._rawData)===null||e===void 0||e.transform({type:"invalidTravel",options:{config:()=>({invalidType:this._invalidType,checkField:this.getInvalidCheckFields()})}},!1))}initData(){var t,e,i;const r=(t=this._spec.data)!==null&&t!==void 0?t:this._option.getSeriesData(this._spec.dataId,this._spec.dataIndex);if(r&&(this._rawData=UF(r,this._dataSet,this._option.sourceDataList)),(i=(e=this._rawData)===null||e===void 0?void 0:e.target)===null||i===void 0||i.addListener("change",this.rawDataUpdate.bind(this)),this._addDataIndexAndKey(),this._rawData){this.getStack()&&(this._viewDataFilter=OI(this._rawData,this._dataSet,{name:`${this.type}_${this.id}_viewDataFilter`}));const s=OI(this.getStack()?this._viewDataFilter:this._rawData,this._dataSet,{name:`${this.type}_${this.id}_viewData`});this._data=new tl(this._option,s),this.getStack()&&this._viewDataFilter.target.removeListener("change",s.reRunAllTransform)}this.initInvalidDataTransform()}initGroups(){const t=this.getGroupFields();t&&t.length&&(this._groups={fields:t})}initStatisticalData(){this._data&&this._statisticViewData()}getRawDataStatisticsByField(t,e){var i,r,s;if(this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[t]||e&&(D(this._rawStatisticsCache[t].min)||D(this._rawStatisticsCache[t].max))||!e&&D(this._rawStatisticsCache[t].values)){if(this._viewDataStatistics&&(!this._viewDataFilter||this._viewDataFilter.transformsArr.length<=1)&&this.getViewData().transformsArr.length<=1&&(!((i=this._viewDataStatistics.latestData)===null||i===void 0)&&i[t]))this._rawStatisticsCache[t]=this._viewDataStatistics.latestData[t];else if(this._rawData){const o=(r=this._rawData.getFields())===null||r===void 0?void 0:r[t];if(o&&o.lockStatisticsByDomain&&o.domain)this._rawStatisticsCache[t]={},e?(this._rawStatisticsCache[t].min=Ri(o.domain),this._rawStatisticsCache[t].max=Mi(o.domain)):this._rawStatisticsCache[t].values=o.domain;else{const a=Jit(this._rawData.latestData,[{key:t,operations:e?["min","max"]:["values"]}])[t];this._rawStatisticsCache[t]=Z((s=this._rawStatisticsCache[t])!==null&&s!==void 0?s:{},a)}}}return this._rawStatisticsCache[t]}_statisticViewData(){Vt(this._dataSet,"dimensionStatistics",HI);const t=`${this.type}_${this.id}_viewDataStatic`;this._viewDataStatistics=new Ve(this._dataSet,{name:t}),this._viewDataStatistics.parse([this._data.getDataView()],{type:"dataview"}),this._viewDataStatistics.transform({type:"dimensionStatistics",options:{fields:()=>{const e=this.getStatisticFields();return this._seriesField&&jp(e,[{key:this._seriesField,operations:["values"]}]),e},target:"latest"}},!1),this._data.getDataView().target.removeListener("change",this._viewDataStatistics.reRunAllTransform),this.getStack()&&this.createdStackData()}createStatisticalData(t,e,i){Vt(this._dataSet,"dimensionStatistics",HI);const r=new Ve(this._dataSet,{name:t});return r.parse([e],{type:"dataview"}),r.transform({type:"dimensionStatistics",options:{operations:["max","min","values"],fields:()=>{var s;const o=jp(this.getStatisticFields(),(s=i==null?void 0:i(e.name))!==null&&s!==void 0?s:[]);return this._seriesField&&jp(o,[{key:this._seriesField,operations:["values"]}]),o},target:"latest"}},!1),r}createdStackData(){const t=`${this.type}_${this.id}_viewStackData`;this._viewStackData=new Ve(this._dataSet,{name:t}),this._viewStackData.parse([this._viewDataFilter],{type:"dataview"}),this._viewStackData.transform({type:"stackSplit",options:{fields:this.getStackGroupFields()}},!1)}_noAnimationDataKey(t,e){return e}generateDefaultDataKey(t){var e;return D(t)?(i,r,s)=>{if(this._spec.animation===!1){const l=this._noAnimationDataKey(i,r);if(l!==void 0)return l}const{keyMap:o}=s,a=this._getSeriesDataKey(i);return o.get(a)===void 0?(o.set(a,0),a):(o.set(a,o.get(a)+1),`${a}_${o.get(a)}`)}:yt(t)?i=>i[t]:V(t)&&t.every(i=>yt(i))?i=>t.map(r=>i[r]).join("-"):it(t)?(i,r)=>t(i,r):((e=this._option)===null||e===void 0||e.onError(`invalid dataKey: ${t}`),(i,r)=>{})}_addDataIndexAndKey(){var t;!((t=this._rawData)===null||t===void 0)&&t.dataSet&&(Vt(this._rawData.dataSet,"addVChartProperty",Yf),this._rawData.transform({type:"addVChartProperty",options:{beforeCall:xf.bind(this),call:Hc}},!1))}updateRawData(t){this._rawData&&this._rawData.updateRawData(t)}rawDataUpdate(t){var e;(e=this._rawDataStatistics)===null||e===void 0||e.reRunAllTransform(),this._rawStatisticsCache=null,this.event.emit(Ot.rawDataUpdate,{model:this})}viewDataFilterOver(t){this.event.emit(Ot.viewDataFilterOver,{model:this})}viewDataUpdate(t){var e;this.event.emit(Ot.viewDataUpdate,{model:this}),(e=this._data)===null||e===void 0||e.updateData(),this._viewDataStatistics&&this._viewDataStatistics.reRunAllTransform()}viewDataStatisticsUpdate(t){this.event.emit(Ot.viewDataStatisticsUpdate,{model:this})}getDatumPositionValue(t,e){return!t||D(e)?null:t[e]}getDatumPositionValues(t,e){return!t||D(e)?[]:yt(e)?[t[e]]:e.map(i=>t[i])}setValueFieldToStack(){}setValueFieldToPercent(){}setValueFieldToStackOffsetSilhouette(){}initRootMark(){var t,e,i;this._rootMark=this._createMark({type:"group",name:`seriesGroup_${this.type}_${this.id}`},{parent:(e=(t=this._region).getGroupMark)===null||e===void 0?void 0:e.call(t),dataView:!1}),this._rootMark.setMarkConfig({zIndex:(i=this._spec.zIndex)!==null&&i!==void 0?i:this.layoutZIndex})}_getExtensionMarkNamePrefix(){return`${this.type}_${this.id}_extensionMark`}_initExtensionMark(t){var e;if(!this._spec.extensionMark)return;const i=this.getMarksWithoutRoot();t.depend=i,(e=this._spec.extensionMark)===null||e===void 0||e.forEach((r,s)=>{this._createExtensionMark(r,null,this._getExtensionMarkNamePrefix(),s,t)})}_createExtensionMark(t,e,i,r,s){var o;const a=this._createMark({type:t.type,name:L(t.name)?`${t.name}`:`${i}_${r}`},{skipBeforeLayouted:!0,markSpec:t,parent:e,dataView:!1,componentType:t.componentType,depend:s.depend,key:t.dataKey},{setCustomizedShape:t==null?void 0:t.customShape});if(a){if(L(t.id)&&a.setUserId(t.id),s.hasAnimation){const l=Ae({},Fe(t.type,t,this._markAttributeContext));a.setAnimationConfig(l)}if(t.type==="group")i=`${i}_${r}`,(o=t.children)===null||o===void 0||o.forEach((l,h)=>{this._createExtensionMark(l,a,i,h,s)});else if(!(e||D(t.dataId)&&D(t.dataIndex))){const l=this._option.getSeriesData(t.dataId,t.dataIndex);l===this._rawData?a.setDataView(this.getViewData(),this.getViewDataProductId()):(a.setDataView(l),l.target.addListener("change",()=>{a.getData().updateData()}))}}}_updateExtensionMarkSpec(){var t;(t=this._spec.extensionMark)===null||t===void 0||t.forEach((e,i)=>{const r=this._marks.getMarkWithInfo({name:L(e.name)?`${e.name}`:`${this._getExtensionMarkNamePrefix()}_${i}`});r&&(this.initMarkStyleWithSpec(r,e),r.updateStaticEncode(),r.updateLayoutState())})}getStackData(){var t;return(t=this._viewStackData)===null||t===void 0?void 0:t.latestData}_parseSelectorOfInteraction(t,e){if(!e||!e.length)return[];const i=[];return t.markIds?e.filter(r=>{t.markIds.includes(r.getProductId())&&i.push(`#${r.getProductId()}`)}):t.markNames?e.forEach(r=>{t.markNames.includes(r.name)&&i.push(`#${r.getProductId()}`)}):e.forEach(r=>{i.push(`#${r.getProductId()}`)}),i}_parseDefaultInteractionConfig(t){if(!(t!=null&&t.length))return[];const e=NGt(this._option.mode);let i=Object.assign({},e==null?void 0:e.hover),r=Object.assign({},e==null?void 0:e.select);const s=this._spec.hover;Re(s)?i.enable=s:kt(s)&&(i.enable=!0,i=Nt(i,s));const o=this._spec.select;Re(o)?r.enable=o:kt(o)&&(r.enable=!0,r=Nt(r,o));const a=[];if(i.enable){const l=this._parseSelectorOfInteraction(i,t);l.length&&a.push(this._defaultHoverConfig(l,i))}if(r.enable){const l=this._parseSelectorOfInteraction(r,t);l.length&&a.push(this._defaultSelectConfig(l,r))}return a}_defaultHoverConfig(t,e){return{seriesId:this.id,regionId:this._region.id,selector:t,type:"element-highlight",trigger:e.trigger,triggerOff:e.triggerOff,blurState:Rt.STATE_HOVER_REVERSE,highlightState:Rt.STATE_HOVER}}_defaultSelectConfig(t,e){const i=e.mode==="multiple",r=L(e.triggerOff)?e.triggerOff:i?["empty"]:["empty",e.trigger];return{type:"element-select",seriesId:this.id,regionId:this._region.id,selector:t,trigger:e.trigger,triggerOff:r,reverseState:Rt.STATE_SELECTED_REVERSE,state:Rt.STATE_SELECTED,isMultiple:i}}_parseInteractionConfig(t){const e=this.getCompiler();if(!e)return;const{interactions:i}=this._spec,r=this._parseDefaultInteractionConfig(t);r&&r.length&&r.forEach(s=>{e.addInteraction(s)}),i&&i.length&&i.forEach(s=>{const o=this._parseSelectorOfInteraction(s,this.getMarks());o.length&&e.addInteraction(Object.assign(Object.assign({},s),{selector:o,seriesId:this.id,regionId:this._region.id}))})}initInteraction(){const t=this.getMarksWithoutRoot();this._parseInteractionConfig(t)}initAnimation(){}initMarkState(){this.initSeriesStyleState()}initSeriesStyleState(){var t;const e=this._spec.seriesStyle;if(!e||!e.length)return;const i=(t=this._seriesField)!==null&&t!==void 0?t:Fr;this.getMarksWithoutRoot().forEach(r=>{const s={},o={},a={};e.forEach(h=>{var d;const u=(d=h[r.name])===null||d===void 0?void 0:d.style;u&&(s[h.name]=!0,a[h.name]=a[h.name]||{},Object.keys(u).forEach(c=>{o[c]=!0,a[h.name][c]=u[c]}))}),r.state.addStateInfo({stateValue:WU,level:-1,filter:h=>Array.isArray(h)?h.length!==0&&s[h[0][i]]===!0:s[h[i]]===!0});const l={};Object.keys(o).forEach(h=>{l[h]=d=>{var u,c;let g;if(Array.isArray(d)){if(d.length===0)return;g=(u=a[d[0][i]])===null||u===void 0?void 0:u[h]}return g=(c=a[d[i]])===null||c===void 0?void 0:c[h],L(g)?g:r.getAttribute(h,d)}}),this.setMarkStyle(r,l,WU,wt.User_SeriesStyle)})}afterInitMark(){this.event.emit(Ot.afterInitMark,{model:this}),this.setSeriesField(this._spec.seriesField),this.getMarks().forEach(t=>{var e,i;!((i=(e=t.stateStyle)===null||e===void 0?void 0:e.normal)===null||i===void 0)&&i.lineWidth&&t.setAttribute("stroke",this.getColorAttribute(),"normal",wt.Base_Series)})}getMarksWithoutRoot(){return this.getMarks().filter(t=>{var e;return!(!((e=t.name)===null||e===void 0)&&e.includes("seriesGroup"))})}getMarksInType(t){return this._marks.getMarksInType(t)}getMarkInName(t){return this._marks.get(t)}getMarkInId(t){return this.getMarks().find(e=>e.id===t)}initEvent(){var t,e,i;(e=(t=this._data)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.target.addListener("change",this.viewDataUpdate.bind(this)),(i=this._viewDataStatistics)===null||i===void 0||i.target.addListener("change",this.viewDataStatisticsUpdate.bind(this))}_releaseEvent(){super._releaseEvent(),this.getCompiler().removeInteraction(this.id)}initTooltip(){this._tooltipHelper=new wr(this)}_compareExtensionMarksSpec(t,e,i){t.length!==e.length||e.some((r,s)=>r.type!==t[s].type||r.id!==t[s].id||r.name!==t[s].name)?i.reMake=!0:e.some((r,s)=>r.visible!==t[s].visible)&&(i.reCompile=!0)}_compareLabelSpec(t,e,i){t.length!==e.length||e.some((r,s)=>r.labelLayout!==t[s].labelLayout||r.visible!==t[s].visible)?i.reMake=!0:!i.reCompile&&e.some((r,s)=>!Oe(r,t[s]))&&(i.reCompile=!0)}_compareSpec(t,e,i){const r=super._compareSpec(t,e),s=Object.keys(e||{}).sort(),o=Object.keys(t||{}).sort();if(!Oe(s,o))return r.reMake=!0,r;const a=Object.assign(Object.assign(Object.assign(Object.assign({},EGt),A8),i),{extensionMark:!0,label:!0,totalLabel:!0});return this._compareExtensionMarksSpec(Q(t.extensionMark),Q(e.extensionMark),r),!r.reMake&&this._compareLabelSpec(Q(t.label),Q(e.label),r),!r.reMake&&this._compareLabelSpec(Q(t.totalLabel),Q(e.totalLabel),r),r.reMake?r:(!r.reCompile&&this._marks.getMarks().some(l=>{var h,d;return a[l.name]=!0,((h=e[l.name])===null||h===void 0?void 0:h.visible)!==((d=t[l.name])===null||d===void 0?void 0:d.visible)})&&(r.reCompile=!0),!r.reCompile&&s.some(l=>A8[l]&&!Oe(t[l],e[l]))&&(r.reCompile=!0),s.some(l=>!a[l]&&!Oe(t[l],e[l]))&&(r.reMake=!0),r)}_updateSpecData(){!this._rawData||!this._spec.data||this._spec.data instanceof Ve||YF(this._rawData,this._spec.data,!0)}reInit(t){super.reInit(t);const e=this.getMarksWithoutRoot();e.forEach(i=>{this._spec[i.name]&&this.initMarkStyleWithSpec(i,this._spec[i.name])}),this.initMarkStyle(),e.forEach(i=>{i.updateStaticEncode(),i.updateLayoutState(!0)}),this._updateExtensionMarkSpec(),this._updateSpecData(),this._tooltipHelper&&this._tooltipHelper.updateTooltipSpec(),B8(this)&&this.initAnimation()}onEvaluateEnd(t){this._data.updateData()}onRender(t){}release(){var t,e,i;super.release(),this._viewDataMap.clear();const r=(e=(t=this._rawData)===null||t===void 0?void 0:t.transformsArr)===null||e===void 0?void 0:e.findIndex(s=>s.type==="addVChartProperty");r>=0&&this._rawData.transformsArr.splice(r,1),(i=this._data)===null||i===void 0||i.release(),this._dataSet=this._data=this._rawData=this._rawDataStatistics=this._spec=this._region=this._viewDataStatistics=this._viewStackData=null}setLayoutStartPosition(t){et(t.x)&&(this._layoutStartPoint.x=t.x),et(t.y)&&(this._layoutStartPoint.y=t.y)}setLayoutRect({width:t,height:e},i){et(t)&&(this._layoutRect.width=t),et(e)&&(this._layoutRect.height=e)}getSeriesKeys(){var t,e;return this._seriesField?(e=(t=this.getRawDataStatisticsByField(this._seriesField))===null||t===void 0?void 0:t.values)!==null&&e!==void 0?e:[]:this.name?[this.name]:this.userId?[`${this.userId}`]:[`${this.type}_${this.id}`]}getSeriesStyle(t){return e=>{var i,r;return(r=(i=this._seriesMark)===null||i===void 0?void 0:i.getAttribute(e,t))!==null&&r!==void 0?r:void 0}}_getSeriesInfo(t,e){const i=this.getDefaultShapeType();return e.map(r=>({key:r,originalKey:r,style:this.getSeriesStyle({[t]:r}),shapeType:i}))}getSeriesInfoInField(t){var e,i;return this._getSeriesInfo(t,(i=(e=this.getRawDataStatisticsByField(t))===null||e===void 0?void 0:e.values)!==null&&i!==void 0?i:[])}getSeriesInfoList(){var t;return this._getSeriesInfo((t=this._seriesField)!==null&&t!==void 0?t:Fr,this.getSeriesKeys())}_getDefaultColorScale(){var t,e;const i=this.getDefaultColorDomain(),r=this._getDataScheme();return(e=(t=new Ab().domain(i)).range)===null||e===void 0?void 0:e.call(t,r)}_getDataScheme(){return _0(this.getColorScheme(),this.type)}getDefaultColorDomain(){var t,e;return this._seriesField?(e=(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._seriesField])===null||e===void 0?void 0:e.values:[]}getColorAttribute(){var t,e;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:(e=this._seriesField)!==null&&e!==void 0?e:Fr}}getDimensionField(){return[]}getMeasureField(){return[]}onMarkPositionUpdate(){this.onMarkTreePositionUpdate(this.getMarksWithoutRoot())}onMarkTreePositionUpdate(t){}_createMark(t,e={},i={}){var r,s,o,a,l,h;const{key:d,groupKey:u,skipBeforeLayouted:c,themeSpec:g={},markSpec:p,dataView:f,dataProductId:m,parent:v,isSeriesMark:_,depend:b,stateSort:y,noSeparateStyle:C=!1}=e,S=super._createMark(t,{key:d??this._getDataIdKey(),seriesId:this.id,attributeContext:this._markAttributeContext,componentType:e.componentType,noSeparateStyle:C});if(L(S)){const w=this.getSpec()||{};this._marks.addMark(S,{name:t.name}),_&&(this._seriesMark=S),D(v)?(r=this._rootMark)===null||r===void 0||r.addMark(S):v!==!1&&v.addMark(S),D(f)?(S.setDataView(this.getViewData(),this.getViewDataProductId()),S.setSkipBeforeLayouted(!0)):f!==!1&&S.setDataView(f,m),Re(c)&&S.setSkipBeforeLayouted(c),L(b)&&S.setDepend(...Q(b)),D(u)||S.setGroupKey(u),y&&S.setStateSortCallback(y);const x=Object.assign(Object.assign({},i),{morph:(s=i.morph)!==null&&s!==void 0&&s,support3d:cGt(t.type)||((o=i.support3d)!==null&&o!==void 0?o:w.support3d||!!w.zField),morphKey:((a=w.morph)===null||a===void 0?void 0:a.morphKey)||`${this.getSpecIndex()}_${this.getMarks().length}`,morphElementKey:(h=(l=w.morph)===null||l===void 0?void 0:l.morphElementKey)!==null&&h!==void 0?h:i.morphElementKey});S.setMarkConfig(x),this.initMarkStyleWithSpec(S,Nt({},g,p||w[S.name]))}return S}_getDataIdKey(){var t;return(t=super._getDataIdKey())!==null&&t!==void 0?t:sa}_getSeriesDataKey(t){let e="";if(!t)return e;const i=this.getDimensionField();e=i.map(s=>t[s]).join("_");const r=this.getSeriesField();return r&&!i.includes(r)&&(e+=`_${t[r]}`),e}addViewDataFilter(t){var e,i;(i=(e=this._viewDataFilter)!==null&&e!==void 0?e:this.getViewData())===null||i===void 0||i.transform(t,!1)}reFilterViewData(){var t,e;(e=(t=this._viewDataFilter)!==null&&t!==void 0?t:this.getViewData())===null||e===void 0||e.reRunAllTransform()}reTransformViewData(){var t,e;(e=(t=this._data)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}fillData(){var t;(t=this.getRawData())===null||t===void 0||t.reRunAllTransform()}compile(){this.compileData()}getDefaultShapeType(){return"circle"}getFieldAlias(t){var e;return t!==Wr&&t!==Od&&t!==To&&t!==kc||(t=this.getStackValueField()),(e=Xw(this.getRawData(),t))!==null&&e!==void 0?e:t}_getInvalidConnectType(){return this._invalidType==="zero"?"zero":this._invalidType==="link"?"connect":"none"}_getInvalidDefined(t){const e=this.getInvalidCheckFields();return!e.length||e.every(i=>mf(t[i]))}_getRelatedComponentSpecInfo(t){var e;const i=this.getSpecIndex(),r=(e=this._option.getSpecInfo().component[t])===null||e===void 0?void 0:e.filter(s=>s.seriesIndexes.includes(i));return r??[]}_forEachStackGroup(t,e){var i,r;(e=e??((i=this._viewStackData)===null||i===void 0?void 0:i.latestData))&&(!((r=e.values)===null||r===void 0)&&r.length?t(e):e.nodes&&Object.values(e.nodes).forEach(s=>{this._forEachStackGroup(t,s)}))}isDatumInViewData(t){if(!t)return!1;const e=this.getViewData().latestData;return!!e&&(!!e.includes(t)||e.some(i=>Object.keys(t).every(r=>t[r]===i[r])))}getSeriesFieldValue(t,e){var i;return t[(i=e??this.getSeriesField())!==null&&i!==void 0?i:Fr]}}zc.mark=Hi,zc.transformerConstructor=Ar;function $Gt(n){return[gt.rose,gt.radar,gt.circularProgress].includes(n)}function snt(n,t,e){const i=n.getScale(0),r="isInverse"in n&&n.isInverse();Je(i.type)?e.sort((s,o)=>(s[t]-o[t])*(r?-1:1)):e.sort((s,o)=>(i.index(s[t])-i.index(o[t]))*(r?-1:1))}function Qd(n){return{dataIndex:t=>{var e,i;const r=n.direction==="horizontal"?n.fieldY[0]:n.fieldX[0],s=t==null?void 0:t[r],o=n.direction==="horizontal"?n.scaleY:n.scaleX;return((i=(e=o==null?void 0:o.domain)===null||e===void 0?void 0:e.call(o))!==null&&i!==void 0?i:[]).indexOf(s)||0},dataCount:()=>{var t,e,i;const r=n.direction==="horizontal"?n.scaleY:n.scaleX;return(i=((e=(t=r==null?void 0:r.domain)===null||t===void 0?void 0:t.call(r))!==null&&e!==void 0?e:[]).length)!==null&&i!==void 0?i:0}}}class Po extends zc{constructor(){super(...arguments),this.coordinate="cartesian",this._bandPosition=.5,this._scaleConfig={bandPosition:this._bandPosition},this._direction="vertical",this._sortDataByAxis=!1,this._getPositionXEncoder=()=>{var t;return(t=this._positionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setPositionXEncoder=t=>{this._positionXEncoder=t.bind(this)},this._getPositionYEncoder=()=>{var t;return(t=this._positionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setPositionYEncoder=t=>{this._positionYEncoder=t.bind(this)}}_buildScaleConfig(){this._scaleConfig={bandPosition:this._bandPosition}}get fieldX(){return this._fieldX}setFieldX(t){this._fieldX=Q(t)}get fieldY(){return this._fieldY}setFieldY(t){this._fieldY=Q(t)}get fieldZ(){return this._fieldZ}setFieldZ(t){this._fieldZ=t&&Q(t)}get fieldX2(){return this._fieldX2}setFieldX2(t){this._fieldX2=t}get fieldY2(){return this._fieldY2}setFieldY2(t){this._fieldY2=t}get direction(){return this._direction}get scaleX(){return this._scaleX}setScaleX(t){this._scaleX=t}get scaleY(){return this._scaleY}setScaleY(t){this._scaleY=t}get scaleZ(){return this._scaleZ}setScaleZ(t){this._scaleZ=t}getXAxisHelper(){return this._xAxisHelper}setXAxisHelper(t){this._xAxisHelper=t,this.onXAxisHelperUpdate()}getYAxisHelper(){return this._yAxisHelper}setYAxisHelper(t){this._yAxisHelper=t,this.onYAxisHelperUpdate()}getZAxisHelper(){return this._zAxisHelper}setZAxisHelper(t){this._zAxisHelper=t,this.onYAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}getStatisticFields(){const t=[];return[{axisHelper:this.getXAxisHelper(),fields:this._fieldX2?[...this._fieldX,this._fieldX2]:this._fieldX},{axisHelper:this.getYAxisHelper(),fields:this._fieldY2?[...this._fieldY,this._fieldY2]:this._fieldY},{axisHelper:this.getZAxisHelper(),fields:this._fieldZ}].forEach(e=>{e.axisHelper&&e.axisHelper.getScale&&e.fields&&e.fields.forEach(i=>{const r={key:i,operations:[]},s=e.axisHelper.getScale(0);Je(s.type)?(r.operations=["max","min"],s.type==="log"&&(r.filter=o=>o>0)):r.operations=["values"],t.push(r)})}),this.getStack()&&t.push({key:this.getStackValueField(),operations:["allValid"]}),t}getGroupFields(){return this.direction==="vertical"?this._fieldX:this._fieldY}getStackGroupFields(){return this.getGroupFields()}getStackValue(){var t,e;const i=(t=this.direction==="horizontal"?this.getXAxisHelper():this.getYAxisHelper())===null||t===void 0?void 0:t.getAxisId();return(e=this._spec.stackValue)!==null&&e!==void 0?e:`${Wt}_series_${this.type}_${i}`}getStackValueField(){return this.direction==="horizontal"?Q(this._spec.xField)[0]:Q(this._spec.yField)[0]}setValueFieldToStack(){this.direction==="horizontal"?(this.setFieldX(Wr),this.setFieldX2(To)):(this.setFieldY(Wr),this.setFieldY2(To))}setValueFieldToPercent(){this.direction==="horizontal"?(this.setFieldX(Od),this.setFieldX2(kc)):(this.setFieldY(Od),this.setFieldY2(kc))}setValueFieldToStackOffsetSilhouette(){this.direction==="horizontal"?(this.setFieldX(kI),this.setFieldX2(TI)):(this.setFieldY(kI),this.setFieldY2(TI))}onXAxisHelperUpdate(){this.onMarkPositionUpdate()}onYAxisHelperUpdate(){this.onMarkPositionUpdate()}onZAxisHelperUpdate(){this.onMarkPositionUpdate()}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.setFieldX(this._spec.xField),this.setFieldY(this._spec.yField),this.setFieldZ(this._spec.zField),this._specXField=Q(this._spec.xField),this._specYField=Q(this._spec.yField),L(this._spec.direction)&&(this._direction=this._spec.direction),this.setFieldX2((t=this._spec)===null||t===void 0?void 0:t.x2Field),this.setFieldY2((e=this._spec)===null||e===void 0?void 0:e.y2Field),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent(),this.getStackOffsetSilhouette()&&this.setValueFieldToStackOffsetSilhouette(),L(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}dataToPosition(t,e){return t?e&&!this.isDatumInViewData(t)?null:{x:this.dataToPositionX(t),y:this.dataToPositionY(t)}:null}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToX=this.valueToPositionX.bind(this),this._markAttributeContext.valueToY=this.valueToPositionY.bind(this),this._markAttributeContext.xBandwidth=(t=0)=>{var e,i,r;return(r=(i=(e=this.getXAxisHelper()).getBandwidth)===null||i===void 0?void 0:i.call(e,t))!==null&&r!==void 0?r:0},this._markAttributeContext.yBandwidth=(t=0)=>{var e,i,r;return(r=(i=(e=this.getYAxisHelper()).getBandwidth)===null||i===void 0?void 0:i.call(e,t))!==null&&r!==void 0?r:0},this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this)}valueToPosition(t,e){return{x:this.valueToPositionX(t),y:this.valueToPositionY(e)}}_axisPosition(t,e,i){return this._scaleConfig.datum=i,t.isContinuous?t.valueToPosition(e,this._scaleConfig):t.dataToPosition(Q(e),this._scaleConfig)}valueToPositionX(t,e){return this._axisPosition(this._xAxisHelper,t,e)}valueToPositionY(t,e){return this._axisPosition(this._yAxisHelper,t,e)}_dataToPosition(t,e,i,r,s,o){const a=s();if(a)return a(t);if(!e)return o(h=>Number.NaN),Number.NaN;const l=(e.getFields?e.getFields():i).slice(0,r);return l&&l.length!==0?(e.isContinuous?o(h=>(this._scaleConfig.datum=h,e.valueToPosition(this.getDatumPositionValue(h,l[0]),this._scaleConfig))):o(h=>(this._scaleConfig.datum=h,e.dataToPosition(Q(this.getDatumPositionValues(h,l)),this._scaleConfig))),s()(t)):(o(h=>null),null)}dataToPositionX(t){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,void 0,this._getPositionXEncoder,this._setPositionXEncoder)}dataToPositionY(t){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,void 0,this._getPositionYEncoder,this._setPositionYEncoder)}dataToPositionZ(t){if(!this._zAxisHelper)return Number.NaN;const{dataToPosition:e}=this._zAxisHelper;return e(this.getDatumPositionValues(t,this._fieldZ),{bandPosition:this._bandPosition})}dataToPositionX1(t){return this._xAxisHelper?this._fieldX2&&this._fieldX2 in t?this.valueToPositionX(this.getDatumPositionValues(t,this._fieldX2)):this.valueToPositionX(0):Number.NaN}dataToPositionY1(t){return this._yAxisHelper?this._fieldY2&&this._fieldY2 in t?this.valueToPositionY(this.getDatumPositionValues(t,this._fieldY2)):this.valueToPositionY(0):Number.NaN}positionToData(t){return t?{x:this.positionToDataX(t.x),y:this.positionToDataY(t.y)}:null}positionToDataX(t){return this._scaleX?this._scaleX.invert(t):null}positionToDataY(t){return this._scaleY?this._scaleY.invert(t):null}getRegionRectLeft(){if(!this._xAxisHelper)return Number.NaN;const{getScale:t}=this._xAxisHelper;return t(0).range()[0]}getRegionRectRight(){if(!this._xAxisHelper)return Number.NaN;const{getScale:t}=this._xAxisHelper;return t(0).range()[1]}afterInitMark(){super.afterInitMark(),this.setFieldX(this._fieldX),this.setFieldY(this._fieldY),this._buildScaleConfig()}getDimensionField(){return this._direction==="horizontal"?this._specYField:this._specXField}getDimensionContinuousField(){return this._direction==="horizontal"?[this.fieldY[0],this.fieldY2]:[this.fieldX[0],this.fieldX2]}getMeasureField(){return this._direction==="horizontal"?this._specXField:this._specYField}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(Ot.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e,i;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&(snt(this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper,this._direction==="horizontal"?this._fieldY[0]:this._fieldX[0],this.getViewData().latestData),(i=this._data)===null||i===void 0||i.updateData(!0))}getInvalidCheckFields(){const t=[];return this._xAxisHelper&&this._xAxisHelper.isContinuous&&this._xAxisHelper.getAxisType()!==vt.geoCoordinate&&(this._xAxisHelper.getFields?this._xAxisHelper.getFields():this._specXField).forEach(e=>{t.push(e)}),this._yAxisHelper&&this._yAxisHelper.isContinuous&&this._yAxisHelper.getAxisType()!==vt.geoCoordinate&&(this._yAxisHelper.getFields?this._yAxisHelper.getFields():this._specYField).forEach(e=>{t.push(e)}),t}reInit(t){this._positionXEncoder&&(this._positionXEncoder=null),this._positionYEncoder&&(this._positionYEncoder=null),super.reInit(t)}}const ont="monotone",ant="linear",VGt="bevel",Vh={point:{name:"point",type:"symbol"},line:{name:"line",type:"line"}};class tH{addSamplingCompile(){if(this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],r=this._fieldY,s=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?s[0]:r[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}addOverlapCompile(){var t;if(this._spec.markOverlap){const e=[];e.push({type:"markoverlap",direction:this._direction==="horizontal"&&this.coordinate==="cartesian"?2:1,delta:this._spec.pointDis,deltaMul:this._spec.pointDisMul,groupBy:this._seriesField}),(t=this._symbolMark)===null||t===void 0||t.getProduct().transform(e)}}reCompileSampling(){this._spec.sampling&&this.compile()}initLineMark(t,e){var i,r;return this._lineMark=this._createMark(Vh.line,{groupKey:this._seriesField,isSeriesMark:e==null||e,stateSort:(i=this._spec.line)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:(r=this._spec.line)===null||r===void 0?void 0:r.customShape,morphElementKey:this.getDimensionField()[0]})),this._lineMark}initLineMarkStyle(t,e){var i,r;const s=this._lineMark;if(s){if(this.setMarkStyle(s,{stroke:this.getColorAttribute()},"normal",wt.Series),this._invalidType!=="zero"&&this.setMarkStyle(s,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",wt.Series),this.event.on(Ot.viewDataStatisticsUpdate,{filter:o=>o.model===this},()=>{this.encodeDefined(s,"defined")}),this.coordinate==="polar")this.setMarkStyle(s,{lineJoin:VGt,curveType:ant,closePath:!0},"normal",wt.Series);else{const o=e??((r=(i=this.getSpec().line)===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.curveType),a=o===ont?t==="horizontal"?"monotoneY":"monotoneX":o;this.setMarkStyle(s,{curveType:a},"normal",wt.Built_In)}this.setMarkStyle(s,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",wt.Series)}return s}_getEventElement(t,e=!1){let i=[];return t.dimensionInfo.some(r=>(r.data.some(s=>s.series===this&&(i=s.datum,!0)),!i.length)),i}_dimensionTrigger(t){const e=this._getEventElement(t);switch(t.action){case"enter":this._symbolActiveMark.getDataView().parse(e),this._symbolActiveMark.getData().updateData(!1);break;case"leave":this._symbolActiveMark.getDataView().parse([]),this._symbolActiveMark.getData().updateData(!1)}}initSymbolMark(t,e){const i=this._spec.point||{};if(i.visible!==!1&&(this._symbolMark=this._createMark(Vh.point,{groupKey:this._seriesField,isSeriesMark:!!e,stateSort:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:i.customShape,morph:ll(this._spec,Vh.point.name),morphElementKey:this.getDimensionField()[0]}))),this._spec.activePoint===!0){const r=new Ve(this._option.dataSet,{name:`${Wt}_series_${this.id}_active_point`});r.parse([]),this._symbolActiveMark=this._createMark({name:`active_point_${this.id}`,type:"symbol"},{groupKey:this._seriesField,isSeriesMark:!1,dataView:r,parent:this._region.getInteractionMark(),stateSort:i.stateSort},{setCustomizedShape:i.customShape,morph:!1}),this._symbolActiveMark.setVisible(!1)}return this._symbolMark}initSymbolMarkStyle(){const t=this._symbolMark;if(!t)return this._initSymbolActiveMarkAlone(),t;if(this._initSymbolMark(t),this._symbolActiveMark&&this._symbolMark.stateStyle.dimension_hover){this._symbolActiveMark.setVisible(!0),this.event.on(rh.dimensionHover,this._dimensionTrigger.bind(this));for(const e in this._symbolMark.stateStyle){this._symbolActiveMark.stateStyle[e]={};for(const i in this._symbolMark.stateStyle[e])i!=="visible"&&(this._symbolActiveMark.stateStyle[e][i]={style:null,level:wt.Series,referer:t})}this._symbolActiveMark.state.changeStateInfo({stateValue:Rt.STATE_DIMENSION_HOVER,filter:()=>!0})}return t}_initSymbolMark(t){t&&(this.setMarkStyle(t,{fill:this.getColorAttribute()},"normal",wt.Series),this.setMarkStyle(t,{x:e=>this._invalidType==="zero"||this._getInvalidDefined(e)?this.dataToPositionX(e):Number.NaN,y:e=>this._invalidType==="zero"||this._getInvalidDefined(e)?this.dataToPositionY(e):Number.NaN,z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",wt.Series))}_initSymbolActiveMarkAlone(){var t,e;const i=this._symbolActiveMark;i&&(this._initSymbolMark(i),i&&(!((e=(t=this._spec[Vh.point.name])===null||t===void 0?void 0:t.state)===null||e===void 0)&&e.dimension_hover)&&(i.setVisible(!0),this.event.on(rh.dimensionHover,this._dimensionTrigger.bind(this)),this.initMarkStyleWithSpec(i,Nt({},this._spec[Vh.point.name],{visible:!0})),this._symbolActiveMark.state.changeStateInfo({stateValue:Rt.STATE_DIMENSION_HOVER,filter:()=>!0})))}initLabelMarkStyle(t){var e;t&&(((e=t.getTarget())===null||e===void 0?void 0:e.type)!=="symbol"&&t.setRule("line-data"),this.setMarkStyle(t,{fill:this.getColorAttribute(),text:i=>i[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},"normal",wt.Series),this.event.on(Ot.viewDataStatisticsUpdate,{filter:i=>i.model===this},()=>{this.encodeDefined(t,"visible")}))}initLineLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>{var i;return(i=e[this.getSeriesField()])!==null&&i!==void 0?i:this.getSeriesKeys()[0]},z:this._fieldZ?this.dataToPositionZ.bind(this):null})}encodeDefined(t,e){var i,r,s,o;if(!t)return;const a=this._isFieldAllValid();if(this._invalidType==="zero"||a){if(((r=(i=t.stateStyle.normal)===null||i===void 0?void 0:i[e])===null||r===void 0?void 0:r.style)===!0)return;this.setMarkStyle(t,{[e]:!0},"normal",wt.Series)}else{if(((o=(s=t.stateStyle.normal)===null||s===void 0?void 0:s[e])===null||o===void 0?void 0:o.style)!==!0)return;this.setMarkStyle(t,{[e]:this._getInvalidDefined.bind(this)},"normal",wt.Series)}t.getProduct()&&t.compileEncode()}_isFieldAllValid(){const t=this.getViewDataStatistics(),e=this.getStackValueField();return!!(t&&t.latestData&&e)&&t.latestData[e]&&t.latestData[e].allValid}}const GGt=Object.assign(Object.assign({},Hi),Vh);class lnt extends sr{setStyle(t,e="normal",i=0,r=this.stateStyle){if(D(t))return;r[e]===void 0&&(r[e]={});const s=this._getIgnoreAttributes(),o=["strokeWidth","lineWidth","lineDash","strokeDash","lineJoin","stroke","strokeOpacity","opacity","fill","fillOpacity","texture","texturePadding","textureSize","textureColor"],a=this.isUserLevel(i);let l=!1;Object.keys(t).forEach(h=>{const d=t[h];if(D(d)||s.includes(h))return;a&&o.includes(h)&&(dI(d==null?void 0:d.type)||d!=null&&d.scale||it(d))&&(l=!0);const u=this._filterAttribute(h,d,e,i,a,r);this.setAttribute(h,u,e,i,r)}),l&&this.setMarkConfig({enableSegments:!0})}}class w0 extends lnt{constructor(){super(...arguments),this.type=w0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:1})}_getIgnoreAttributes(){var t,e;return((t=this.model)===null||t===void 0?void 0:t.type)===gt.radar&&((e=this.model)===null||e===void 0?void 0:e.coordinate)==="polar"?[]:["fill","fillOpacity"]}}w0.type="line";const HT=()=>{q.registerMark(w0.type,w0),iNt(),nnt()};class hnt extends sr{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{size:1,symbolType:"circle",fill:void 0,lineWidth:0})}}class A0 extends hnt{constructor(){super(...arguments),this.type=A0.type}}A0.type="symbol";const vh=()=>{q.registerMark(A0.type,A0),hit()};class Rb extends Ar{_transformLabelSpec(t){var e,i,r;((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((r=(i=t.point)===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.visible)!==!1?this._addMarkLabelSpec(t,"point"):this._addMarkLabelSpec(t,"line"),this._addMarkLabelSpec(t,"line","lineLabel","initLineLabelMarkStyle",void 0,!0)}}function P8(n){return n.length>=2&&et(n[0])&&et(de(n))&&de(n)>=n[0]}function E8(n,t){var e;const i=de(t)-t[0],r=de(t)*t[0]<0;let s=t[0]<=0?0-t[0]:0,o=de(t)>0?de(t)-0:0;i===0?t[0]<0?(s=1,o=0):t[0]>0&&(s=0,o=1):(s/=i,o/=i);const a=n.getDomainSpec(),l={total:i,negative:s,positive:o,includeZero:r,domain:t,extendable_min:!et(a.min),extendable_max:!et(a.max)};if(!((e=n._break)===null||e===void 0)&&e.scope){const h=t.findIndex(c=>c>=0);let d,u;h===0?(d=n._break.scope[h],u=[t[0],t[1]],l.positive=1,l.negative=0):de(t)<=0?(l.positive=0,l.negative=1,u=[t[t.length-2],t[t.length-1]]):(d=n._break.scope[h-1],u=[t[h-1],t[h]],l.negative=d[0]+(0-u[0])/(u[1]-u[0])*(d[1]-d[0]),l.positive=1-l.negative),l.break=!0,l.extendable_max=!1,l.extendable_min=!1,l.domain=u}return l}function L8(n,t){const{positive:e,negative:i,extendable_min:r,extendable_max:s,domain:o}=n,{positive:a,negative:l,extendable_min:h,extendable_max:d,domain:u}=t;if(a>0){if(!h)return!1;let c=i/e;s&&(c=i/Math.max(e,a),o[1]=-o[0]/c),u[0]=-u[1]*c}else if(l>0){if(!d)return!1;let c=e/i;r&&(c=e/Math.max(i,i),o[0]=-o[1]/c),u[1]=-u[0]*c}return!0}function I8(n,t){const{extendable_min:e,extendable_max:i,domain:r}=n,{positive:s,negative:o,domain:a}=t;return(s!==0||o!==0)&&!(s>0&&!i)&&!(o>0&&!e)&&(r[0]=a[0],r[1]=a[1],!0)}function O8(n,t){const{positive:e,negative:i,extendable_max:r,domain:s}=n,{positive:o,negative:a,extendable_min:l,domain:h}=t;if(r&&l){const d=Math.max(i,a)/Math.max(e,o);s[1]=-s[0]/d,h[0]=-h[1]*d}else if(l){const d=i/e;h[0]=-h[1]*d}else{if(!r)return!1;{const d=a/o;s[1]=-s[0]/d}}return!0}function D8(n,t){const{extendable_min:e,domain:i}=n,{extendable_max:r,domain:s}=t;return!(!e||!r)&&(i[0]=-i[1],s[1]=-s[0],!0)}const UGt=(n,t)=>{var e,i,r,s,o,a;const l=n.getScale(),h=t.getScale();if(!l||!h)return;const d=(r=(i=(e=n).getDomainAfterSpec)===null||i===void 0?void 0:i.call(e))!==null&&r!==void 0?r:[0,1],u=(a=(o=(s=t).getDomainAfterSpec)===null||o===void 0?void 0:o.call(s))!==null&&a!==void 0?a:[0,1];if(!(d&&u&&P8(d)&&P8(u)))return;const c=E8(n,d),g=E8(t,u);if(c.break===!0&&g.break===!0)return;const{positive:p,negative:f,extendable_min:m,extendable_max:v,includeZero:_}=c,{positive:b,negative:y,extendable_min:C,extendable_max:S,includeZero:w}=g;if(p===0&&f===0){if(!I8(c,g))return}else if(b===0&&y===0){if(!I8(g,c))return}else if(_||w)if(_&&!w){if(!L8(c,g))return}else if(w&&!_){if(!L8(g,c))return}else{if(f===y)return;if(f>y){if(!O8(c,g))return}else if(!O8(g,c))return}else{if(f===0&&b===0){if(!D8(c,g))return}else if(y===0&&p===0&&!D8(g,c))return;if(f===0&&y===0)if(d[0]===0&&u[0]>0){if(!C)return;u[0]=0}else{if(!(u[0]===0&&d[0]>0)||!m)return;d[0]=0}if(p===0&&b===0)if(d[1]===0&&u[1]>0){if(!S)return;u[1]=0}else{if(!(u[1]===0&&d[1]>0)||!v)return;d[1]=0}}l.domain(d),h.domain(u)};function YGt(n,t,e,i,r){const s=tS(n,t),o=Math.max(Td(e),Td(s));return r*(Math.round(s*10**o)/Math.round(e*10**o))+i}const XGt=(n,t)=>{var e,i,r,s,o;if(!n)return n;const a=(e=t==null?void 0:t.targetAxis)===null||e===void 0?void 0:e.call(t);if(!a)return n;const l=(i=t==null?void 0:t.currentAxis)===null||i===void 0?void 0:i.call(t);if(!l)return n;const h=(r=l.getTickData())===null||r===void 0?void 0:r.getDataView();if(!h||!h.transformsArr.find(_=>_.type.includes("ticks")))return n;const d=l.getScale();if(!d)return n;const u=(o=(s=a.getTickData())===null||s===void 0?void 0:s.getDataView())===null||o===void 0?void 0:o.latestData;if(!(u!=null&&u.length))return n;const c=a.getScale();if(!c)return n;const g=c.domain(),p=de(g)-g[0];if(p===0)return n;const f=d.domain(),m=de(f)-f[0];if(p===0)return n;const v=u.map(_=>YGt(_.value,g[0],p,f[0],m));return Yl(v)};class eH{constructor(t){this.id=Kc(),this.name=`${t}_${this.id}`}onAdd(t){this.service=t}release(){this.service=null}}class M0 extends eH{constructor(){super(M0.type),this.type="AxisSyncPlugin"}_checkEnableSync(t){if(!Je(t.getScale().type))return!1;const e=t.getSpec().sync;return!!(e!=null&&e.axisId)&&e}_getTargetAxis(t,e){const i=t.getOption().getChart().getComponentByUserId(e.axisId);return i!=null&&i.type.startsWith("cartesianAxis")?i:null}onInit(t,e){const i=this._checkEnableSync(e);if(!i||!i.zeroAlign)return;const r=this._getTargetAxis(e,i);r&&e.event.on(Ot.scaleDomainUpdate,{filter:({model:s})=>s.id===e.id||s.id===r.id},()=>{UGt(r,e)})}onDidCompile(t,e){const i=this._checkEnableSync(e);if(!i)return;const r=this._getTargetAxis(e,i);if(r&&i.tickAlign){Vt(e.getOption().dataSet,"tickAlign",XGt);const s={targetAxis:()=>r,currentAxis:()=>e};e.addTransformToTickData({type:"tickAlign",options:s,level:Number.MAX_SAFE_INTEGER},!1)}}}M0.pluginType="component",M0.type="AxisSyncPlugin";const KGt={left:{textAlign:"center",textBaseline:"bottom"},right:{textAlign:"center",textBaseline:"bottom"},radius:{},angle:{}};function qGt(n){return(n=Yo(n)).startSymbol=Yo(n.startSymbol),n.endSymbol=Yo(n.endSymbol),n}function iH(n){let t=0;return Dt(n,"tick.visible")&&(t+=Dt(n,"tick.tickSize")),Dt(n,"label.visible")&&(t+=Dt(n,"label.space")),t}function T0(n,t){var e,i,r,s,o,a;return{min:(r=(e=n.min)!==null&&e!==void 0?e:(i=n.range)===null||i===void 0?void 0:i.min)!==null&&r!==void 0?r:t==null?void 0:t.min,max:(a=(s=n.max)!==null&&s!==void 0?s:(o=n.range)===null||o===void 0?void 0:o.max)!==null&&a!==void 0?a:t==null?void 0:t.max}}function F8(n){const t=n==null?void 0:n.orient;return t==="top"||t==="bottom"||t==="left"||t==="right"||t==="z"}function ZGt(n){const t=n==null?void 0:n.orient;return t==="angle"||t==="radius"}const Am=(n,t,e)=>{var i;const r=(i=t==="band"?es("axisBand",e):["linear","log","symlog"].includes(t)?es("axisLinear",e):{})!==null&&i!==void 0?i:{},s=xi(n)?es("axisX",e):Fa(n)?es("axisY",e):es("axisZ",e);return Nt({},es("axis",e),r,s)},eP=(n,t,e)=>{var i;const r=(i=t==="band"?es("axisBand",e):t==="linear"?es("axisLinear",e):{})!==null&&i!==void 0?i:{},s=es(n==="angle"?"axisAngle":"axisRadius",e);return Nt({},es("axis",e),r,s)},dnt=n=>n==="band"||n==="ordinal"||n==="point";function wf(n,t){return{id:n,label:n,value:t,rawValue:n}}function oo(n,t,e){return e||!n||n.getAxisId()===t.getAxisId()}class JGt extends Zit{constructor(t){super(),this.component=t}releaseAll(){super.releaseAll(),this.component=null}}function QGt(n,t){const{x1:e,y1:i,x2:r,y2:s}=t,{x1:o,y1:a,x2:l,y2:h}=n.AABBBounds,{dx:d=0,dy:u=0}=n.attribute;let c=0,g=0;o<e&&(c=e-o),a<i&&(g=i-a),l>r&&(c=r-l),h>s&&(g=s-h),c&&n.setAttribute("dx",c+d),g&&n.setAttribute("dy",g+u)}function t4t(n,t,e,i){for(let r=0,s=n.length;r<s;r++){const o=n[r];if(o){const a=o[e],l=o[i||e];if(a<=t&&l>=t)return o}}return null}const e4t=(n,t)=>{var e,i;const r=Q((e=t.axes)!==null&&e!==void 0?e:[]),{bandField:s,linearField:o,xField:a,yField:l}=(i=es(vt.crosshair,n))!==null&&i!==void 0?i:{},h=r.find(g=>xi(g.orient));let d;d=L(h)?Nt({},dnt(h.type)?s:o,a):a;const u=r.find(g=>Fa(g.orient));let c;return c=L(u)?Nt({},xr(u.type)?s:o,l):l,{xField:d,yField:c}},i4t=(n,t)=>{var e,i;const r=Q((e=t.axes)!==null&&e!==void 0?e:[]),{bandField:s,linearField:o,categoryField:a,valueField:l}=(i=es(vt.crosshair,n))!==null&&i!==void 0?i:{},h=r.find(g=>g.orient==="angle");let d;d=L(h)?Nt({},dnt(h.type)?s:o,a):a;const u=r.find(g=>g.orient==="radius");let c;return c=L(u)?Nt({},xr(u.type)?s:o,l):l,{categoryField:d,valueField:c}};function n4t(n,t,e,i){switch(n){case vt.cartesianBandAxis:return Am(Bu(e,["z"]),"band",t);case vt.cartesianLinearAxis:return Am(Bu(e,["z"]),"linear",t);case vt.cartesianLogAxis:return Am(Bu(e,["z"]),"log",t);case vt.cartesianSymlogAxis:return Am(Bu(e,["z"]),"symlog",t);case vt.cartesianAxis:case vt.cartesianTimeAxis:return Am(Bu(e),void 0,t);case vt.polarBandAxis:return eP(e.orient,"band",t);case vt.polarLinearAxis:return eP(e.orient,"linear",t);case vt.polarAxis:return eP(e.orient,void 0,t);case vt.cartesianCrosshair:return e4t(t,i);case vt.polarCrosshair:return i4t(t,i);case vt.colorLegend:case vt.sizeLegend:case vt.discreteLegend:case vt.dataZoom:case vt.scrollBar:return r4t(e,es(n,t));default:return es(n,t)}}const r4t=(n,t)=>{var e;const i=(e=n.orient)!==null&&e!==void 0?e:t.orient,r=t[Iit(i)],s=Nt({},t,r);return delete s.horizontal,delete s.vertical,s};class Bb extends ET{getTheme(t,e){return n4t(this.type,this._option.getTheme(),t,e)}_mergeThemeToSpec(t,e){const{spec:i,theme:r}=super._mergeThemeToSpec(t,e);return this._adjustPadding(i),{spec:i,theme:r}}_adjustPadding(t){const{padding:e,noOuterPadding:i=!0,orient:r}=t;i&&e&&r&&(t.padding=Object.assign(Object.assign({},Id(e)),{[r]:0}))}}var s4t=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class $r extends Git{static createComponent(t,e){const{spec:i}=t,r=s4t(t,["spec"]);return new this(i,Object.assign(Object.assign({},e),r))}getRegions(){return this._regions}created(){super.created(),this.initLayout(),this.pluginService=new JGt(this)}constructor(t,e){super(t,e),this.name="component",this.modelType="component",this.transformerConstructor=Bb,this._delegateEvent=(i,r,s,o=null,a=null)=>{var l,h;r instanceof FM||this.event.emit(s,{model:this,node:i,event:r,item:o,datum:a,source:Ee.chart,chart:(h=(l=this._option)===null||l===void 0?void 0:l.globalInstance)===null||h===void 0?void 0:h.getChart()},"model")},this._option.animation&&(this.animate=new Vit({getCompiler:e.getCompiler}))}initLayout(){var t;super.initLayout(),this._regions=(t=this._regions)!==null&&t!==void 0?t:this._option.getRegionsInIndex(),this._layout&&(this._layout.layoutBindRegionID=this._regions.map(e=>e==null?void 0:e.id))}changeRegions(t){throw new Error("Method not implemented.")}_getNeedClearVRenderComponents(){throw new Error("Method not implemented.")}onRender(t){throw new Error("Method not implemented.")}getVRenderComponents(){return this._getNeedClearVRenderComponents()}callPlugin(t){this.pluginService&&this.pluginService.getAll().forEach(e=>t(e))}getContainer(){var t;return this._container||(this._container=(t=this._option)===null||t===void 0?void 0:t.globalInstance.getStage().find(e=>e.name==="root",!0)),this._container}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||(i.reMake=["seriesId","seriesIndex","regionId","regionIndex"].some(r=>!Oe(e==null?void 0:e[r],t[r]))),(e==null?void 0:e.visible)!==t.visible&&(i.reCompile=!0),i}release(){var t;super.release(),this.clear(),(t=this.pluginService)===null||t===void 0||t.releaseAll(),this.pluginService=null}clear(){var t;const e=this._getNeedClearVRenderComponents();e&&e.length&&e.forEach(i=>{var r;i&&((r=this.getContainer())===null||r===void 0||r.removeChild(i),i=null)}),this._container=null,(t=this.pluginService)===null||t===void 0||t.clearAll()}compile(){this.compileMarks(),this.reAppendComponents()}compileMarks(t){this.getMarks().forEach(e=>{e.compile({group:t,context:{model:this}})})}reAppendComponents(){const t=this._getNeedClearVRenderComponents();t&&t.length&&t.forEach(e=>{var i;e&&!e.stage&&((i=this.getContainer())===null||i===void 0||i.appendChild(e))})}getBoundsInRect(t,e){return{x1:0,x2:0,y1:0,y2:0}}getDatum(t){}}$r.transformerConstructor=Bb;class jI extends sr{constructor(t,e){super(t,e),this.type="component",this._componentType=e.componentType,this._mode=e.mode}_initProduct(t){const e=this.getVGrammarView(),i=this.getProductId();this._product=e.mark(Tt.component,t??e.rootMark,{componentType:this._componentType,mode:this._mode}).id(i),this._compiledProductId=i}}jI.type="component";const zT=()=>{q.registerMark(jI.type,jI)},o4t=n=>n;var a4t=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class nH extends $r{getOrient(){return this._orient}getScale(){return this._scale}getScales(){return this._scales}getTickData(t=0){return this._tickData[t]}get visible(){return this._visible}getInverse(){return this._inverse}getCoordinateType(){return this._coordinateType}constructor(t,e){var i;super(t,e),this.specKey="axes",this._scales=[],this._tickData=[],this._visible=!0,this._tick=void 0,this._visible=(i=t.visible)===null||i===void 0||i,this._coordinateType="none"}_getNeedClearVRenderComponents(){return[]}getVRenderComponents(){var t,e,i,r;return[(e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem(),(r=(i=this._gridMark)===null||i===void 0?void 0:i.getProduct())===null||r===void 0?void 0:r.getGroupGraphicItem()].filter(L)}created(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_;if(super.created(),this.setSeriesAndRegionsFromSpec(),this.initEvent(),this.initScales(),this.updateSeriesScale(),this._shouldComputeTickData()&&this._initData(),this._visible){const b=this._createMark({type:"component",name:`axis-${this.getOrient()}`},{componentType:this.getOrient()==="angle"?"circleAxis":"axis",mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});if(this._axisMark=b,b.setMarkConfig({zIndex:this.layoutZIndex}),L(this._spec.id)&&b.setUserId(this._spec.id),b.setMarkConfig({interactive:(t=this._spec.interactive)!==null&&t!==void 0?t:this.getDefaultInteractive()}),this._marks.addMark(b),(e=this._spec.grid)===null||e===void 0?void 0:e.visible){const y=this._createMark({type:"component",name:`axis-${this.getOrient()}-grid`},{componentType:this.getOrient()==="angle"?Dn.circleAxisGrid:Dn.lineAxisGrid,mode:this._spec.mode,noSeparateStyle:!0},{skipTheme:!0});y.setMarkConfig({zIndex:(a=(s=(r=(i=this._spec.grid)===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.zIndex)!==null&&s!==void 0?s:(o=this._spec.grid)===null||o===void 0?void 0:o.zIndex)!==null&&a!==void 0?a:Qe.Axis_Grid,interactive:!1}),this._marks.addMark(y),this._gridMark=y}if(this._option.animation!==!1&&Dt(this._option.getChart().getSpec(),"animation")!==!1&&this._spec.animation===!0){const y=Ae((l=q.getAnimationInKey("axis"))===null||l===void 0?void 0:l(),{appear:(d=(h=this._spec.animationAppear)!==null&&h!==void 0?h:Dt(this._option.getChart().getSpec(),"animationAppear.axis"))!==null&&d!==void 0?d:Dt(this._option.getChart().getSpec(),"animationAppear"),disappear:(c=(u=this._spec.animationDisappear)!==null&&u!==void 0?u:Dt(this._option.getChart().getSpec(),"animationDisappear.axis"))!==null&&c!==void 0?c:Dt(this._option.getChart().getSpec(),"animationDisappear"),enter:(p=(g=this._spec.animationEnter)!==null&&g!==void 0?g:Dt(this._option.getChart().getSpec(),"animationEnter.axis"))!==null&&p!==void 0?p:Dt(this._option.getChart().getSpec(),"animationEnter"),exit:(m=(f=this._spec.animationExit)!==null&&f!==void 0?f:Dt(this._option.getChart().getSpec(),"animationExit.axis"))!==null&&m!==void 0?m:Dt(this._option.getChart().getSpec(),"animationExit"),update:(_=(v=this._spec.animationUpdate)!==null&&v!==void 0?v:Dt(this._option.getChart().getSpec(),"animationUpdate.axis"))!==null&&_!==void 0?_:Dt(this._option.getChart().getSpec(),"animationUpdate")});y.enter&&(y.update[0].customParameters={enter:y.enter[0]}),this._marks.forEach(C=>C.setAnimationConfig(y))}}}_shouldComputeTickData(){return this.getVisible()||this._spec.forceInitTick}_initData(){const t=this._initTickDataSet(this._tickTransformOption());t.target.addListener("change",this._forceLayout.bind(this)),this._tickData=[new Qa(this._option,t)]}collectData(t,e){const i=[];return Oi(this._regions,r=>{var s;let o=this.collectSeriesField(t,r);if(o=V(o)?Je(this._scale.type)?o:[o[0]]:[o],t||(this._dataFieldText=r.getFieldAlias(o[0])),o){const a=r.getViewData();if(e)o.forEach(l=>{i.push(r.getRawDataStatisticsByField(l,!1))});else if(a&&a.latestData&&a.latestData.length){const l=(s=r.getViewDataStatistics)===null||s===void 0?void 0:s.call(r),h=this.type===vt.cartesianLinearAxis&&this._spec.breaks&&this._spec.breaks.length;o.forEach(d=>{var u;!((u=l==null?void 0:l.latestData)===null||u===void 0)&&u[d]&&(h?i.push(Object.assign(Object.assign({},l.latestData[d]),{values:a.latestData.map(c=>c[d])})):i.push(l.latestData[d]))})}}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),i}isSeriesDataEnable(){let t=!0;return Oi(this._regions,e=>{var i;V((i=e.getViewDataStatistics())===null||i===void 0?void 0:i.latestData)&&(t=!1)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}setSeriesAndRegionsFromSpec(){const{seriesId:t,seriesIndex:e,regionId:i,regionIndex:r}=this._spec;L(t)&&(this._seriesUserId=Q(t)),L(i)&&(this._regionUserId=Q(i)),L(e)&&(this._seriesIndex=Q(e)),L(r)&&(this._regionIndex=Q(r)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionIndex),this.layout.layoutBindRegionID=this._regions.map(s=>s.id)}getBindSeriesFilter(){return{userId:this._seriesUserId,specIndex:this._seriesIndex}}initEvent(){this.event.on(Ot.scaleUpdate,{filter:({model:e})=>(e==null?void 0:e.id)===this.id},this.effect.scaleUpdate.bind(this));const t=Tet(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}).map(e=>e.getViewDataStatistics()).filter(e=>!!e);t.length>1?this._option.dataSet.multipleDataViewAddListener(t,"change",()=>{this.updateScaleDomain()}):t.length===1&&t[0].target.addListener("change",()=>{this.updateScaleDomain()}),Oi(this._regions,e=>{e.event.on(Ot.rawDataUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===e.id},()=>{this._clearRawDomain()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}updateScaleDomain(){}_clearRawDomain(){}onLayoutEnd(t){this.updateScaleRange(),this.event.emit(Ot.scaleUpdate,{model:this,value:"range"}),super.onLayoutEnd(t)}computeData(t){t!=="force"||this._tickData&&this._tickData.length?!this._tickData||!this._tickData.length||t!=="force"&&Oe(this._scale.range(),[0,1])||this._tickData.forEach(e=>{e.getDataView().reRunAllTransform(),e.updateData()}):Oi(this._regions,e=>{var i;(i=e.getViewData())===null||i===void 0||i.reRunAllTransform()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}initScales(){this._scales=[this._scale];const t=[];if(Oi(this._regions,e=>{const i=e.getGroups();i&&t.push(i)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t.length!==0){const e=Mi(t.map(i=>i.fields.length));for(let i=1;i<e;i++){const r=this._scale.clone();this._scales.push(r)}}}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake?i:(i.reRender=!0,(e==null?void 0:e.type)!==(t==null?void 0:t.type)||(e==null?void 0:e.visible)!==(t==null?void 0:t.visible)?(i.reMake=!0,i):(i.reMake=["grid","subGrid","tick","subTick","label","domainLine","title"].some(r=>{var s,o;return((s=e==null?void 0:e[r])===null||s===void 0?void 0:s.visible)!==((o=t==null?void 0:t[r])===null||o===void 0?void 0:o.visible)}),i))}_getAxisAttributes(){const t=this._spec,e={orient:this.getOrient(),select:this._option.disableTriggerEvent!==!0&&t.select,hover:this._option.disableTriggerEvent!==!0&&t.hover};if(t.domainLine&&t.domainLine.visible?e.line=qGt(t.domainLine):e.line={visible:!1},t.label&&t.label.visible){const i=Jl(t.label,["style","formatMethod","state"]);e.label=i,t.label.style&&(e.label.style=it(t.label.style)?(r,s,o,a)=>{var l;const h=t.label.style(r.rawValue,s,r,o,a);return jt(Nt({},(l=this._theme.label)===null||l===void 0?void 0:l.style,h))}:jt(t.label.style)),(t.label.formatMethod||t.label.formatter)&&(e.label.formatMethod=this._getLabelFormatMethod()),t.label.state&&(e.label.state=hjt(t.label.state)),it(t.label.dataFilter)&&(e.label.dataFilter=(r,s)=>t.label.dataFilter(r,s,{vchart:this._option.globalInstance}))}else e.label={visible:!1};if(t.tick&&t.tick.visible?(e.tick={visible:t.tick.visible,length:t.tick.tickSize,inside:t.tick.inside,alignWithLabel:t.tick.alignWithLabel,dataFilter:it(t.tick.dataFilter)?i=>t.tick.dataFilter(i,{vchart:this._option.globalInstance}):void 0},t.tick.style&&(e.tick.style=it(t.tick.style)?(i,r,s,o)=>{var a;const l=t.tick.style(i,r,s,o);return jt(Nt({},(a=this._theme.tick)===null||a===void 0?void 0:a.style,l))}:jt(t.tick.style)),t.tick.state&&(e.tick.state=_g(t.tick.state))):e.tick={visible:!1},t.subTick&&t.subTick.visible?(e.subTick={visible:t.subTick.visible,length:t.subTick.tickSize,inside:t.subTick.inside,count:t.subTick.tickCount},t.subTick.style&&(e.subTick.style=it(t.subTick.style)?(i,r,s,o)=>{var a;const l=t.subTick.style(i,r,s,o);return jt(Nt({},(a=this._theme.subTick)===null||a===void 0?void 0:a.style,l))}:jt(t.subTick.style)),t.subTick.state&&(e.subTick.state=_g(t.subTick.state))):e.subTick={visible:!1},t.title&&t.title.visible){const i=t.title,{autoRotate:r,angle:s,style:o={},background:a,state:l,shape:h}=i,d=a4t(i,["autoRotate","angle","style","background","state","shape"]);let u,c=s;t.orient!=="left"&&t.orient!=="right"||r&&D(c)&&(c=t.orient==="left"?-90:90,u=KGt[t.orient]),e.title=Object.assign(Object.assign({},d),{autoRotate:!1,angle:c?Te(c):null,textStyle:Nt({},u,jt(o)),pickable:o.pickable!==!1,childrenPickable:o.pickable!==!1,state:{}}),h&&h.visible?(e.title.shape=Object.assign(Object.assign({},h),{style:jt(h.style)}),h.state&&(e.title.state.shape=_g(h.state))):e.title.shape={visible:!1},a&&a.visible?(e.title.background=Object.assign(Object.assign({},a),{style:jt(a.style)}),a.state&&(e.title.state.background=_g(a.state))):e.title.background={visible:!1},l&&(e.title.state.text=_g(l))}else e.title={visible:!1};return t.background&&t.background.visible?(e.panel={visible:!0},t.background.style&&(e.panel.style=jt(t.background.style)),t.background.state&&(e.panel.state=_g(t.background.state))):e.panel={visible:!1},e}_getGridAttributes(){const t=this._spec;return{alternateColor:t.grid.alternateColor,alignWithLabel:t.grid.alignWithLabel,style:it(t.grid.style)?()=>(e,i)=>{var r,s;const o=t.grid.style((r=e.datum)===null||r===void 0?void 0:r.rawValue,i,e.datum);return jt(Nt({},(s=this._theme.grid)===null||s===void 0?void 0:s.style,o))}:jt(t.grid.style),subGrid:t.subGrid.visible===!1?{visible:!1}:{type:"line",visible:t.subGrid.visible,alternateColor:t.subGrid.alternateColor,style:jt(t.subGrid.style)}}}_getLabelFormatMethod(){const{formatMethod:t,formatter:e}=this._spec.label,{formatFunc:i}=sh(t,e);return i?(r,s,o)=>i(s.rawValue,s,e):null}_initTickDataSet(t,e=0){Xl(this._option.dataSet,"scale",o4t);const i=this.registerTicksTransform();return new Ve(this._option.dataSet,{name:`${this.type}_${this.id}_ticks_${e}`}).parse(this._scales[e],{type:"scale"}).transform({type:i,options:t},!1)}_tickTransformOption(){const t=this._tick||{},e=this._spec.label||{},{tickCount:i,forceTickCount:r,tickStep:s,tickMode:o}=t,{style:a,formatMethod:l,minGap:h}=e;return{sampling:this._spec.sampling!==!1,tickCount:i,forceTickCount:r,tickStep:s,tickMode:o,axisOrientType:this._orient,coordinateType:this._coordinateType,labelStyle:a,labelFormatter:l,labelGap:h}}addTransformToTickData(t,e){this._tickData.forEach(i=>{var r;(r=i==null?void 0:i.getDataView())===null||r===void 0||r.transform(t,e)})}dataToPosition(t){return this._scale.scale(t)}getDatum(t){var e,i;return t&&t.name===_n.label?t.data:this._axisMark?(i=(e=this._axisMark.getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem())===null||i===void 0?void 0:i.attribute.items:void 0}}nH.specKey="axes";const tg=()=>{zT(),q.registerAnimation("axis",()=>({appear:{custom:uBt},update:{custom:rHt},exit:{custom:cBt}}))};var H8=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const l4t=[M0];class nA extends nH{getOrient(){return this._orient}getDefaultInteractive(){return!0}set autoIndentOnce(t){this._autoIndentOnce=t}getScales(){return this._scales}constructor(t,e){super(t,e),this.type=vt.cartesianAxis,this.name=vt.cartesianAxis,this._defaultBandPosition=.5,this._defaultBandInnerPadding=.1,this._defaultBandOuterPadding=.3,this.layoutType="region-relative",this.layoutZIndex=Qe.Axis,this.layoutLevel=aa.Axis,this._orient="left",this._autoIndentOnce=!1,this._hasAutoIndent=!1,this._scales=[],this._tick=void 0,this._layoutCache={width:0,height:0,_lastComputeOutBounds:{x1:0,x2:0,y1:0,y2:0}},this._innerOffset={top:0,bottom:0,left:0,right:0},this.effect={scaleUpdate:i=>{this.computeData(i==null?void 0:i.value),Oi(this._regions,r=>{const s=this.getOrient();xi(s)?oo(r.getXAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&r.setXAxisHelper(this.axisHelper()):Fa(s)?oo(r.getYAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&r.setYAxisHelper(this.axisHelper()):Ml(s)&&oo(r.getZAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&r.setZAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=i=>{let{x:r,y:s}=i;return et(r)&&(r+=+(this._orient==="left")*this.getLayoutRect().width),et(s)&&(s+=+(this._orient==="top")*this.getLayoutRect().height),{x:r,y:s}},this._transformLayoutRect=i=>{if(!this._visible)return i;const r=this._latestBounds.clone().translate(-this.getLayoutStartPoint().x,-this.getLayoutStartPoint().y);switch(this._layout.layoutOrient){case"left":this._layout.layoutRectLevelMap.width===Kr&&(i.width=r.x1<0?-r.x1:0);break;case"right":this._layout.layoutRectLevelMap.width===Kr&&(i.width=r.x2>0?r.x2:0);break;case"top":this._layout.layoutRectLevelMap.height===Kr&&(i.height=r.y1<0?-r.y1:0);break;case"bottom":this._layout.layoutRectLevelMap.height===Kr&&(i.height=r.y2>0?r.y2:0)}return i.width=Math.ceil(i.width),i.height=Math.ceil(i.height),this._layout.setRectInSpec(this._layoutCacheProcessing(i))},this._updateAxisLayout=()=>{const i=this.getLayoutStartPoint(),r=this._getUpdateAttribute(!1),{grid:s}=r,o=H8(r,["grid"]),a=this._axisMark.getProduct(),l=Nt({x:i.x,y:i.y},this._axisStyle,o);a.encode(l),this._gridMark&&this._gridMark.getProduct().encode(Nt({x:i.x,y:i.y},this._getGridAttributes(),s))},this._fixAxisOnZero=()=>{const{onZero:i,visible:r}=this._spec.domainLine;if(this.visible&&i&&r!==!1){const{onZeroAxisId:s,onZeroAxisIndex:o}=this._spec.domainLine,a=this._option.getComponentsByKey("axes"),l=xi(this.getOrient()),h=u=>{var c;return(l?!xi(u.getOrient()):xi(u.getOrient()))&&Je(u.getScale().type)&&(u.getTickData()?(c=u.getTickData().getLatestData())===null||c===void 0?void 0:c.find(g=>g.value===0):u.getScale().domain()[0]<=0&&de(u.getScale().domain())>=0)},d=a.filter(u=>h(u));if(d.length){let u;if(L(s))u=d.find(c=>c.id===s);else if(L(o)){const c=a[o];h(c)&&(u=c)}else u=d[0];if(u){const c=this._axisMark.getProduct(),g=u.valueToPosition(0);l?c.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dy:this._orient==="bottom"?-((u.getInverse()?u.getScale().range()[1]:u.getScale().range()[0])-g):g})}):c.encode({line:Object.assign(Object.assign({},this._axisStyle.line),{dx:this._orient==="left"?g:-((u.getInverse()?u.getScale().range()[0]:u.getScale().range()[1])-g)})})}}}},this._orient=Bu(t,["z"]),Ml(this._orient)&&(this.layoutType="absolute"),this._dataSet=e.dataSet,this._coordinateType="cartesian"}static getSpecInfo(t){const e=t[this.specKey];if(!e)return null;const i=t.direction==="horizontal";if(!V(e)){if(!F8(e))return null;const{axisType:a,componentName:l}=u8(e,i);return e.type=a,[{spec:e,specPath:[this.specKey],specInfoPath:["component",this.specKey,0],type:l}]}let r=!0;if(e.filter(a=>a.orient==="z")[0]){const a=e.filter(h=>h.orient==="bottom")[0],l=e.filter(h=>Fa(h.orient))[0];r=e.length===3&&a&&l}let s=e.map((a,l)=>({spec:a,index:l}));r||(s=s.filter(({spec:a})=>a.orient!=="z"));const o=[];return s.forEach(({spec:a,index:l})=>{if(!F8(a))return;const{axisType:h,componentName:d}=u8(a,i);a.type=h,o.push({spec:a,specPath:[this.specKey,l],specInfoPath:["component",this.specKey,l],type:d})}),o}static createComponent(t,e){const{spec:i}=t,r=H8(t,["spec"]),s=q.getComponentInKey(r.type);return s?new s(i,Object.assign(Object.assign({},e),r)):(e.onError(`Component ${r.type} not found`),null)}initLayout(){super.initLayout(),this._layout.autoIndent=this._spec.autoIndent!==!1,this._layout.layoutOrient=this._orient}setLayout3dBox(t){this.layout3dBox=t}getNewScaleRange(){const{width:t,height:e}=this.getLayoutRect(),{left:i,right:r,top:s,bottom:o}=this._innerOffset;let a=[];return xi(this.getOrient())?et(t)&&(a=this._inverse?[t-r,i]:[i,t-r]):Ml(this.getOrient())?et(t)&&(a=this._inverse?[t-r,i]:[i,t-r],this._scale.range(a)):et(e)&&(a=this._inverse?[s,e-o]:[e-o,s]),a}updateScaleRange(){let t=!1;const e=this.getNewScaleRange(),i=this._scale.range();return e.length===i.length&&e.every((r,s)=>r===i[s])?t=!1:(t=!0,this._scale.range(e)),t}init(t){var e;super.init(t),(e=this.pluginService)===null||e===void 0||e.load(l4t.map(i=>new i)),this.callPlugin(i=>{this.pluginService&&i.onInit&&i.onInit(this.pluginService,this)})}setAttrFromSpec(){var t;if(super.setAttrFromSpec(),this.visible){xi(this.getOrient())?ce(this._spec.maxHeight)&&(this._spec.maxHeight="30%"):ce(this._spec.maxWidth)&&(this._spec.maxWidth="30%");const i=this._getAxisAttributes();i.label.formatMethod=this._getLabelFormatMethod(),i.verticalFactor=this.getOrient()==="top"||this.getOrient()==="right"?-1:1,this._axisStyle=i}this._tick=this._spec.tick;const e=(t=this._option.getChart())===null||t===void 0?void 0:t.getSpec();this._inverse=RVt(this._spec,(e==null?void 0:e.direction)==="horizontal")}onLayoutStart(t,e,i){if(super.onLayoutStart(t,e,i),!Ml(this.getOrient())&&this._spec.innerOffset){const r=this._spec;Fa(this.getOrient())?["top","bottom"].forEach(s=>{this._innerOffset[s]=Gi(r.innerOffset[s],e.height,e)}):["left","right"].forEach(s=>{this._innerOffset[s]=Gi(r.innerOffset[s],e.width,e)})}}getSeriesStatisticsField(t){let e;return e=xi(this.getOrient())?t.fieldX:Ml(this.getOrient())?t.fieldZ:t.fieldY,Je(this._scale.type)?e:[e[0]]}_tickTransformOption(){var t,e,i,r;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimals:(t=this._tick)===null||t===void 0?void 0:t.noDecimals,labelLastVisible:(e=this._spec.label)===null||e===void 0?void 0:e.lastVisible,labelFirstVisible:(i=this._spec.label)===null||i===void 0?void 0:i.firstVisible,labelFlush:(r=this._spec.label)===null||r===void 0?void 0:r.flush})}axisHelper(){return{isContinuous:Je(this._scale.type),dataToPosition:this.dataToPosition.bind(this),getScale:(t=0)=>this._scales[t],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse===!0,getSpec:()=>this._spec}}afterCompile(){var t;const e=(t=this._axisMark)===null||t===void 0?void 0:t.getProduct();e&&e.addEventListener(Lt.AFTER_ELEMENT_ENCODE,()=>{if(this._isLayout===!1&&(xi(this.getOrient())?this.callPlugin(i=>{this.pluginService&&i.onDidLayoutHorizontal&&i.onDidLayoutHorizontal(this.pluginService,this)}):this.callPlugin(i=>{this.pluginService&&i.onDidLayoutVertical&&i.onDidLayoutVertical(this.pluginService,this)}),this._unitText)){const{x:i,y:r}=this.getLayoutStartPoint(),s=xi(this._orient)?{x:Mi(this._scale.range())+i,y:r}:{x:i,y:Ri(this._scale.range())+r};this._unitText.setAttributes(s)}}),this.callPlugin(i=>{this.pluginService&&i.onDidCompile&&i.onDidCompile(this.pluginService,this)})}onRender(t){}changeRegions(t){}update(t){}resize(t){}collectScale(){const t=[];return Oi(this._regions,e=>{t.push(this.getOrient()==="left"||this.getOrient()==="right"?e.scaleY:e.scaleX)},{userId:this._seriesUserId,specIndex:this._seriesIndex}),t}collectSeriesField(t,e){var i,r;let s;return s=t>0?(r=(i=e.getGroups())===null||i===void 0?void 0:i.fields)===null||r===void 0?void 0:r[t]:xi(this.getOrient())?e.getSpec().x2Field?[...e.fieldX,e.fieldX2]:e.fieldX:Ml(this.getOrient())?e.fieldZ:e.getSpec().y2Field?[...e.fieldY,e.fieldY2]:e.fieldY,s}updateSeriesScale(){const t=this.getOrient();Oi(this._regions,e=>{xi(t)?oo(e.getXAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&(e.setScaleX(this._scale),e.setXAxisHelper(this.axisHelper())):Fa(t)?oo(e.getYAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&(e.setScaleY(this._scale),e.setYAxisHelper(this.axisHelper())):Ml(t)&&oo(e.getZAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&(e.setScaleZ(this._scale),e.setZAxisHelper(this.axisHelper()))},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getBoundsInRect(t){var e;let i={x1:0,y1:0,x2:0,y2:0};if(!this._visible)return i;this._verticalLimitSize=xi(this.getOrient())?t.height:t.width,this.setLayoutRect(t),!this.updateScaleRange()&&V((e=this.getTickData())===null||e===void 0?void 0:e.getLatestData())||this.computeData("range");const r={skipLayout:!1},s=xi(this.getOrient());this.pluginService&&(s?this.callPlugin(l=>{l.onWillLayoutHorizontal&&l.onWillLayoutHorizontal(this.pluginService,r,this)}):this.callPlugin(l=>{l.onWillLayoutVertical&&l.onWillLayoutVertical(this.pluginService,r,this)}));const o=this._axisMark.getProduct();let a=!1;if(!r.skipLayout){const l=this._getUpdateAttribute(!0),h=o.getGroupGraphicItem(),d=Nt(Object.assign({},this.getLayoutStartPoint()),this._axisStyle,l,{line:{visible:!1}});let u=h.getBoundsWithoutRender(d);u.empty()&&(u=new Bi().set(d.x,d.y,d.x,d.y)),a=!0,this._latestBounds=u,i=this._appendAxisUnit(u,s)}return a||(this._latestBounds=o.getBounds()),i}positionToData(t,e){const i=xi(this.getOrient());e&&(t-=i?this.getLayoutStartPoint().x:this.getLayoutStartPoint().y),this._innerOffset&&(t=i?Ne(t,this._innerOffset.left,this.getLayoutRect().width-this._innerOffset.right):Ne(t,this._innerOffset.top,this.getLayoutRect().height-this._innerOffset.bottom));const r=this._scale.range();return(t-r[0])*(t-de(r))>0?null:this._scale.invert(t)}_getTitleLimit(t){var e,i,r,s,o;const a=this._spec.title;if(a.visible&&D((e=a.style)===null||e===void 0?void 0:e.maxLineWidth)){const l=(o=(r=(i=this._axisStyle.title)===null||i===void 0?void 0:i.angle)!==null&&r!==void 0?r:(s=a.style)===null||s===void 0?void 0:s.angle)!==null&&o!==void 0?o:0;if(t){const u=this.getLayoutRect().width,c=Math.abs(Math.cos(l));return c<1e-6?1/0:u/c}const h=this.getLayoutRect().height,d=Math.abs(Math.sin(l));return d<1e-6?1/0:h/d}return null}_getUpdateAttribute(t){var e;let i=0,r=0;if(!t){const m=this.getRegions();let{x:v,y:_}=m[0].getLayoutStartPoint(),b=v+m[0].getLayoutRect().width,y=_+m[0].getLayoutRect().height;for(let C=1;C<m.length;C++){const S=m[C],{x:w,y:x}=S.getLayoutStartPoint(),{width:A,height:M}=S.getLayoutRect();v=Math.min(v,w),b=Math.max(b,A+w),_=Math.min(_,x),y=Math.max(y,M+x)}i=Math.abs(y-_),r=Math.abs(b-v)}const{width:s,height:o}=this.getLayoutRect(),a=xi(this._orient),l=Fa(this._orient),h=Ml(this._orient),d=this.layout3dBox?this.layout3dBox.length:0;let u={x:0,y:0},c=i,g=s;a?u={x:s,y:0}:l?(u={x:0,y:o},c=r,g=o):h&&(u={x:d,y:0});const p=this.getLabelItems(g),f={start:{x:0,y:0},end:u,title:{text:this._spec.title.text||this._dataFieldText,maxWidth:this._getTitleLimit(a)},items:p};if(t||(f.grid={type:"line",start:{x:0,y:0},end:u,items:p[0],verticalFactor:this._axisStyle.verticalFactor,depth:d,length:c}),h){const m=(e=this.directionStr)!==null&&e!==void 0?e:"r2l",v=this.layout3dBox?this.layout3dBox.width:0;let _=[0,0],b=-Math.PI/2,y=0;m==="l2r"&&(y=this.layout3dBox.length,_=[0,0,0],b=Math.PI/2),f.z=y,f.alpha=b,f.anchor3d=_,t||(f.grid.depth=v)}else{let m=a?this.layout.minHeight:this.layout.minWidth;(a&&this._layout.layoutRectLevelMap.height===Wh||l&&this._layout.layoutRectLevelMap.width===Wh)&&(m=this._verticalLimitSize),f.verticalLimitSize=this._verticalLimitSize,f.verticalMinSize=m,f.label={overflowLimitLength:this._getLabelOverflowLimit(a)}}return f}getLabelItems(t){var e;const i=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();return i&&i.length?[i.map(r=>{const s=this._getNormalizedValue([r.value],t);return wf(r.value,s)}).filter(r=>{const{value:s,rawValue:o}=r,a=this._scale.domain();return this.getSpec().type==="log"?s>=0&&s<=1:Je(this._scale.type)?o>=a[0]&&o<=de(a):a.includes(o)})]:[]}initEvent(){super.initEvent(),this.visible&&(this.event.on(Ot.layoutEnd,this._updateAxisLayout),this.event.on(Ot.layoutEnd,this._fixAxisOnZero),this.event.on(Ot.layoutRectUpdate,()=>{this._clearLayoutCache()}))}_getNormalizedValue(t,e){return e===0?0:this.dataToPosition(t)/e}_layoutCacheProcessing(t){return["width","height"].forEach(e=>{t[e]<this._layoutCache[e]?t[e]=this._layoutCache[e]:this._layoutCache[e]=t[e]}),this._autoIndentOnce&&this._hasAutoIndent?["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]}):(this._hasAutoIndent=!0,["x1","x2","y1","y2"].forEach(e=>{this.layout.getLastComputeOutBounds()[e]<this._layoutCache._lastComputeOutBounds[e]?this.layout.getLastComputeOutBounds()[e]=this._layoutCache._lastComputeOutBounds[e]:this._layoutCache._lastComputeOutBounds[e]=this.layout.getLastComputeOutBounds()[e]})),t}_clearLayoutCache(){this._hasAutoIndent=!1,this._layoutCache.width=0,this._layoutCache.height=0,this._layoutCache._lastComputeOutBounds={x1:0,x2:0,y1:0,y2:0}}onDataUpdate(){this._clearLayoutCache()}_appendAxisUnit(t,e){var i;if(this._spec.unit&&this._spec.unit.visible){const{text:r,style:s}=this._spec.unit;let o,a;const{x:l,y:h}=this.getLayoutStartPoint();e?(o={x:Mi(this._scale.range())+l,y:h},a={textAlign:"left",textBaseline:"middle"}):(o={x:l,y:Ri(this._scale.range())+h},a={textAlign:this._orient==="left"?"left":"right",textBaseline:"bottom"}),a=Object.assign(Object.assign(Object.assign({},a),s),{x:o.x,y:o.y,text:r}),this._unitText?this._unitText.setAttributes(a):(this._unitText=uf(a),this._unitText.name="axis-unit",(i=this.getContainer())===null||i===void 0||i.add(this._unitText));const d=this._unitText.AABBBounds;e?(t.x2+=d.x2>t.x2?d.x2-t.x2:0,t.y2+=d.y2>t.y2?d.y2-t.y2:0):(t.x1+=d.x1<t.x1?d.x1-t.x1:0,t.y1+=d.y1<t.y1?d.y1-t.y1:0)}return t}_getNeedClearVRenderComponents(){return this._unitText?[this._unitText]:[]}_getLabelOverflowLimit(t){var e,i;if(t&&((e=this._spec.label)===null||e===void 0?void 0:e.visible)!==!1&&((i=this._spec.label)===null||i===void 0?void 0:i.autoLimit)===!0){const r=this._option.getComponentsByKey("axes"),s=this.getRegions(),o=r.filter(u=>{const c=u.getOrient();return(c==="left"||c==="right")&&u.getRegions().some(g=>s.includes(g))});let a=0,l=0;const h=this.getLayoutStartPoint().x,d=h+this.getLayoutRect().width;return o.forEach(u=>{const c=u.getLayoutStartPoint().x;if(u.getOrient()==="left"&&c===h){const g=u.getLayoutRect().width;a=Math.max(a,g)}else if(c===d){const g=u.getLayoutRect().width;l=Math.max(l,g)}}),{left:a,right:l}}}}nA.type=vt.cartesianAxis,nA.specKey="axes";const h4t=(n,t,e)=>e.reduce((i,r,s)=>(i.push([r,e.length===s+1?t:e[s+1]]),i),[[n,e[0]]]);function d4t(n,t){const e=n[0],i=n[n.length-1],r=t.filter(s=>s>e&&s<i);return r.length===0?[[e,i]]:h4t(e,i,r)}const z8=(n,t)=>n-t,u4t=(n,t)=>{const e=[{count:0,sub:[],max:t[0],min:t[0]}];let i=0,r=0;for(;i<t.length;)n[r]<=t[i]?(e[i].count+=1,e[i].sub.push(n[r]),r+=1):(i+=1,e[i]={count:0,sub:[],max:t[i],min:t[i]});e.forEach(o=>{o.count&&(o.min=Math.min.apply(null,o.sub))});const s=n.slice(r);return e[i]={count:s.length,sub:s,min:t[t.length-1],max:Math.max.apply(null,s)},e};function c4t(n,t,e="count"){const i=u4t(n,t),r=e==="count"?n.length:i.reduce((l,h,d)=>h.count>0?l+h.max-h.min:l,0),s=[];let o=0,a=0;return i.forEach((l,h)=>{if(r===0)s.push([0,h/i.length-1]);else{const d=e==="count"?l.count:l.max-l.min,u=s[a-1]?s[a-1][1]:0,c=h===i.length-1?1:Math.min((o+d)/r,1);(u!==c||u!==0&&u!==1)&&(a+=1,s.push([u,c]),o+=d)}}),s}function g4t(n,t,e){return n.sort(z8),t.sort(z8),{domain:d4t(n,t),scope:c4t(n,t,e)}}const p4t=Math.sqrt(50),f4t=Math.sqrt(10),m4t=Math.sqrt(2);class WT{constructor(){this._extend={},this.niceLabelFormatter=null}setExtraAttrFromSpec(){L(this._spec.nice)&&(this._nice=this._spec.nice),L(this._spec.zero)&&(this._zero=this._spec.zero),this._expand=this._spec.expand,this._domain=T0(this._spec)}transformScaleDomain(){this.setScaleNice()}setLinearScaleNice(){var t;if(!this._nice)return!1;let e=5;const i=this._spec.tick||{};if(et(i.forceTickCount))e=i.forceTickCount;else if(it(i.tickCount)){const o=this._scale.range();let a=Math.abs(de(o)-o[0]);a===1&&this._option&&(a=xi(this._orient)?this._option.getChartViewRect().width:this._option.getChartViewRect().height),e=i.tickCount({axisLength:a,labelStyle:this._spec.label&&this._spec.label.style})}else e=et(i.tickCount)?i.tickCount:5;this._spec.niceType==="accurateFirst"&&(e=Math.max(5,e));const{min:r,max:s}=(t=this._domain)!==null&&t!==void 0?t:{};return D(r)&&D(s)&&D(this._softMaxValue)&&D(this._softMinValue)?this._scale.nice(e):(L(r)||L(this._softMinValue))&&D(s)&&D(this._softMaxValue)?this._scale.niceMax(e):!(!D(r)||!D(this._softMinValue)||!L(s)&&!L(this._softMaxValue))&&this._scale.niceMin(e)}setLogScaleNice(){var t;if(!this._nice)return!1;const{min:e,max:i}=(t=this._domain)!==null&&t!==void 0?t:{};return D(e)&&D(i)&&D(this._softMaxValue)&&D(this._softMinValue)?this._scale.nice():(L(e)||L(this._softMinValue))&&D(i)&&D(this._softMaxValue)?this._scale.niceMax():!(!D(e)||!D(this._softMinValue)||!L(i)&&!L(this._softMaxValue))&&this._scale.niceMin()}setScaleNice(){return this._spec.type==="log"?this.setLogScaleNice():this.setLinearScaleNice()}dataToPosition(t,e){return this.valueToPosition(t[0])}valueToPosition(t){return this._scale.scale(t)}computeLinearDomain(t){let e=[];if(t.length){const i=this._spec.breaks&&this._spec.breaks.length;let r,s,o=[];if(t.forEach(a=>{const{min:l,max:h}=a;r=r===void 0?l:Math.min(r,l),s=s===void 0?h:Math.max(s,h),i&&(o=o.concat(a.values))}),i){const a=[],l=[],h=D(this._domain.max)?s:this._domain.max;for(let d=0;d<this._spec.breaks.length;d++){const{range:u}=this._spec.breaks[d];u[0]<=u[1]&&u[1]<=h&&(a.push(u),l.push(this._spec.breaks[d]))}if(a.sort((d,u)=>d[0]-u[0]),a.length){const{domain:d,scope:u}=g4t(o,E2(a),this._spec.breaks[0].scopeType);e=E2(d),this._break={domain:d,scope:u,breakDomains:a,breaks:l}}else e=[r,s]}else e=[r,s]}else e[0]=0,e[1]=0;return this.setSoftDomainMinMax(e),this.expandDomain(e),this.includeZero(e),this.setDomainMinMax(e),e}expandDomain(t){if(!this._expand)return;let e=t[0],i=de(t);e===i&&(i===0?i=1:i>0?e=0:i<0&&(i=0)),L(this._expand.min)&&(t[0]=e-(i-e)*this._expand.min),L(this._expand.max)&&(t[t.length-1]=i+(i-e)*this._expand.max)}niceDomain(t){const{min:e,max:i}=T0(this._spec);if(L(e)||L(i)||this._spec.type!=="linear")return t;if(Math.abs(Ri(t)-Mi(t))<=1e-12){let r=t[0];const s=r>=0?1:-1;if(r=Math.abs(r),r<1)t[0]=0,t[t.length-1]=1;else{let o=r/5;const a=Math.floor(Math.log(o)/Math.LN10),l=o/Math.pow(10,a);o=(l>=p4t?10:l>=f4t?5:l>=m4t?2:1)*Math.pow(10,a),t[0]=0,t[t.length-1]=10*o}s<0&&(t.reverse(),t[0]*=-1,t[t.length-1]*=-1)}return t}includeZero(t){this._zero&&(t[0]=Math.min(t[0],0),t[t.length-1]=Math.max(de(t),0))}setExtendDomain(t,e){if(e===void 0)return void delete this._extend[t];this._extend[t]=e;const i=this._scale.domain();this.extendDomain(i),this.includeZero(i),this.setDomainMinMax(i),this.niceDomain(i),this._scale.domain(i,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this.event.emit(Ot.scaleUpdate,{model:this,value:"domain"})}extendDomain(t){let e;const i=t.length-1,r=t[0]-t[i]>0,s=r?i:0,o=r?0:i;for(const a in this._extend)e=this._extend[a],e>t[o]&&(t[o]=e),e<t[s]&&(t[s]=e)}getDomainSpec(){return this._domain}setDomainMinMax(t){if(!this._domain)return;const{min:e,max:i}=this._domain;L(e)&&(t[0]=e),L(i)&&(t[t.length-1]=i)}setSoftDomainMinMax(t){const{softMin:e,softMax:i}=this._spec;if(L(e)){let r=it(e)?e(t):e;D(r)&&(r=t[0]),r<=t[0]&&(t[0]=r,this._softMinValue=r)}if(L(i)){let r=it(i)?i(t):i;D(r)&&(r=de(t)),r>=de(t)&&(t[t.length-1]=r),this._softMaxValue=r}}setZero(t){this._zero!==t&&(this._zero=t,this.updateScaleDomain())}updateScaleDomain(){if(!this.isSeriesDataEnable())return;const t=this.collectData(),e=this.computeLinearDomain(t);this.updateScaleDomainByModel(e)}updateScaleDomainByModel(t){t=t??this._scale.domain(),this.extendDomain(t),this.includeZero(t),this.setDomainMinMax(t),this.niceDomain(t),this._scale.domain(t,this._nice),this._nice&&!this.setScaleNice()&&this._scale.rescale(),this._updateNiceLabelFormatter(t),this._domainAfterSpec=this._scale.domain(),this.event.emit(Ot.scaleDomainUpdate,{model:this}),this.event.emit(Ot.scaleUpdate,{model:this,value:"domain"})}getDomainAfterSpec(){return this._domainAfterSpec}_updateNiceLabelFormatter(t){const e=Math.abs(de(t)-t[0]),i=Math.max(-Math.floor(Math.log10(e)),0)+2,r=Math.pow(10,i);this.niceLabelFormatter=s=>et(+s)?Math.round(+s*r)/r:s}}class md extends nA{constructor(){super(...arguments),this.type=vt.cartesianLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new Vs}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.setExtraAttrFromSpec();const i=(e=(t=this._tickData)===null||t===void 0?void 0:t[0])===null||e===void 0?void 0:e.getDataView().transformsArr.find(r=>r.type===this.registerTicksTransform());i&&(i.options=this._tickTransformOption())}initScales(){var t,e;super.initScales();const i=[0,1];L((t=this._domain)===null||t===void 0?void 0:t.min)&&(i[0]=this._domain.min),L((e=this._domain)===null||e===void 0?void 0:e.max)&&(i[1]=this._domain.max),this._scale.domain(i)}_tickTransformOption(){var t;return Object.assign(Object.assign({},super._tickTransformOption()),{breakData:!((t=this._spec.breaks)===null||t===void 0)&&t.length?()=>this._break:null})}_getUpdateAttribute(t){var e,i;const r=super._getUpdateAttribute(t);if(!Ml(this._orient)&&(!((i=(e=this._break)===null||e===void 0?void 0:e.breaks)===null||i===void 0)&&i.length)){const{width:s,height:o}=this.getLayoutRect(),a=xi(this._orient),l=a?s:o;r.breaks=this._break.breaks.map(h=>{const{range:d,breakSymbol:u,gap:c=6}=h,g=this.valueToPosition((d[0]+d[1])/2)/l;let p;p=Ws(c)?Number(c.substring(0,c.length-1))/100:c/l;const f=et(u==null?void 0:u.angle)?u.angle:a?60:15;return{range:[g-p/2,g+p/2],breakSymbol:Object.assign(Object.assign({visible:!0},u),{angle:f*Math.PI/180}),rawRange:d}})}return r}getNewScaleRange(){var t,e;let i=super.getNewScaleRange();return!((t=this._spec.breaks)===null||t===void 0)&&t.length&&(!((e=this._break)===null||e===void 0)&&e.scope)&&(i=E2(this._break.scope).map(r=>i[0]+(de(i)-i[0])*r)),i}computeDomain(t){return this.computeLinearDomain(t)}axisHelper(){const t=super.axisHelper();return t.setExtendDomain=this.setExtendDomain.bind(this),t.valueToPosition=this.valueToPosition.bind(this),t}registerTicksTransform(){const t=`${this.type}-ticks`;return Vt(this._option.dataSet,t,Cb),t}}md.type=vt.cartesianLinearAxis,md.specKey="axes",Ye(md,WT);const ms=()=>{Jc(),Qc(),tg(),q.registerComponent(md.type,md)};class unt{constructor(){this._rawDomainIndex=[]}_initData(){var t;if(this._spec.showAllGroupLayers&&this._scales.length>1)for(let e=0;e<this._scales.length;e++){const i=((t=this._spec.layers)!==null&&t!==void 0?t:[])[this._scales.length-1-e]||{};if(i.visible!==!1&&i.tickCount!==0&&i.forceTickCount!==0){const r=this._initTickDataSet(Object.assign(Object.assign({},this._tickTransformOption()),i),e);r.target.addListener("change",this._forceLayout.bind(this));const s=new Qa(this._option,r);this._tickData.push(s),this._tickDataMap||(this._tickDataMap={}),this._tickDataMap[e]=s}}else{const e=this._initTickDataSet(this._tickTransformOption());e.target.addListener("change",this._forceLayout.bind(this));const i=new Qa(this._option,e);this._tickData=[i],this._tickDataMap={0:i}}}dataToPosition(t,e={}){var i,r;if(t.length===0||this._scales.length===0)return 0;const{position:s,bandScale:o}=this.getPosition(t);return s+o.bandwidth()*((r=(i=e.bandPosition)!==null&&i!==void 0?i:this._spec.bandPosition)!==null&&r!==void 0?r:this._defaultBandPosition)}valueToPosition(t){return this._scale.scale(t)}updateGroupScaleRange(){let t=this._scale;this._scales.forEach((e,i)=>{i>0&&(e.range([0,t.bandwidth()]),t=e)})}getPosition(t){let e=0,i=this._scale;if(this._scales.length===1||t.length===1)e=this.valueToPosition(t[0]);else{const r=Math.min(t.length,this._scales.length);for(let s=0;s<r;s++)e+=this._scales[s].scale(t[s]);i=this._scales[r-1]}return{position:e,bandScale:i}}calcScales(t,e){var i,r;const{bandPadding:s,paddingInner:o,paddingOuter:a}=this._spec,l=V(s),h=V(o),d=V(a);for(let u=0;u<this._scales.length;u++){const c=l?s[u]:s,g=h?o[u]:o,p=d?a[u]:a;this._scales[u].paddingInner((i=g??c)!==null&&i!==void 0?i:t,!0).paddingOuter((r=p??c)!==null&&r!==void 0?r:e,!0)}}computeBandDomain(t){if(!t.length)return[];if(t.length===1)return t[0].values;const e=new Set;for(let i=0;i<t.length;i++)for(let r=0;r<t[i].values.length;r++)e.add(t[i].values[r]);return Array.from(e)}updateScaleDomain(){var t;if(!this.isSeriesDataEnable())return;!(!((t=this._rawDomainIndex)===null||t===void 0)&&t.length)&&this._scales.length&&this._updateRawDomain();const e=this._spec.domain;for(let i=0;i<this._scales.length;i++)if(e&&e.length&&i===0)this._scales[i].domain(e);else{const r=this.collectData(i),s=this.computeBandDomain(r);this._scales[i].domain(s.sort((o,a)=>this._rawDomainIndex[i][o]-this._rawDomainIndex[i][a]))}this.transformScaleDomain(),this.event.emit(Ot.scaleDomainUpdate,{model:this}),this.event.emit(Ot.scaleUpdate,{model:this,value:"domain"})}getLabelItems(t){const e=[];let i=[];return this._scales.forEach((r,s)=>{var o;const a=this._tickDataMap[s],l=(o=a==null?void 0:a.getLatestData())===null||o===void 0?void 0:o.length,h=l?a.getLatestData().map(d=>d.value):r.domain();if(h&&h.length)if(i&&i.length){const d=[],u=[];i.forEach(c=>{h.forEach(g=>{const p=Q(c).concat(g);if(u.push(p),l){const f=wf(g,this._getNormalizedValue(p,t));d.push(f)}})}),l&&e.push(d.filter(c=>c.value>=0&&c.value<=1)),i=u}else h.forEach(d=>{i.push(d)}),l&&e.push(a.getLatestData().map(d=>wf(d.value,this._getNormalizedValue([d.value],t))).filter(d=>d.value>=0&&d.value<=1))}),e.reverse()}_updateRawDomain(){this._rawDomainIndex=[];const t=this._spec.domain;for(let e=0;e<this._scales.length;e++)if(t&&t.length&&e===0)this._scales[e].domain(t);else{const i=this.collectData(e,!0),r=this.computeBandDomain(i);this._rawDomainIndex[e]={},r.forEach((s,o)=>this._rawDomainIndex[e][s]=o)}}_clearRawDomain(){this._rawDomainIndex=[]}}class jv extends nA{constructor(){super(...arguments),this.type=vt.cartesianBandAxis,this._scale=new qc}computeDomain(t){return this.computeBandDomain(t)}updateScaleRange(){const t=super.updateScaleRange();return this.updateGroupScaleRange(),t}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}axisHelper(){const t=(e=0)=>this._scales[e];return{isContinuous:!1,dataToPosition:this.dataToPosition.bind(this),getScale:t,getBandwidth:(e=0)=>t(e).bandwidth(),getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>this._inverse,getSpec:()=>this._spec}}registerTicksTransform(){const t=`${this.type}-ticks`;return Vt(this._option.dataSet,t,MHt),t}transformScaleDomain(){this.updateFixedWholeLength()}updateFixedWholeLength(){if(this._scale){const{bandSize:t,maxBandSize:e,minBandSize:i}=this._getOuterBandSizeFromSpec();if(t&&this._scale.bandwidth(t),e&&this._scale.maxBandwidth(e),i&&this._scale.minBandwidth(i),this._scale.isBandwidthFixed()&&this._spec.autoRegionSize&&(t||e)){const r=cI(this._scale.domain().length,t??e,this._scale.paddingInner(),this._scale.paddingOuter());["bottom","top"].includes(this._orient)?this._regions.forEach(s=>s.setMaxWidth(r)):["left","right"].includes(this._orient)&&this._regions.forEach(s=>s.setMaxHeight(r))}}}_getOuterBandSizeFromSpec(){var t;let{bandSize:e,maxBandSize:i,minBandSize:r,bandSizeLevel:s=0}=this._spec;const{gap:o,extend:a=0}=(t=this._spec.bandSizeExtend)!==null&&t!==void 0?t:{};s=Math.min(s,this._scales.length-1);for(let l=s;l>0;l--){const h=this._scales[l],d=h.domain(),u=h.paddingInner(),c=h.paddingOuter(),g=p=>{const f=l===s?a:0;return D(o)||l<s?cI(d.length,p,u,c)+f:(p+(yt(o)?p*(Number(o.substring(0,o.length-1))/100):o))*d.length/(this._scales[l-1].paddingInner()+1)+f};L(e)&&(e=g(e)),L(i)&&(i=g(i)),L(r)&&(r=g(r))}return{bandSize:e,maxBandSize:i,minBandSize:r}}}jv.type=vt.cartesianBandAxis,jv.specKey="axes",Ye(jv,unt);const vs=()=>{Jc(),Qc(),tg(),q.registerComponent(jv.type,jv)};class rA extends md{constructor(){super(...arguments),this.type=vt.cartesianTimeAxis,this._zero=!1,this.effect={scaleUpdate:t=>{this.computeData(t==null?void 0:t.value),Oi(this._regions,e=>{xi(this.getOrient())?oo(e.getXAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&e.setXAxisHelper(this.axisHelper()):oo(e.getYAxisHelper(),this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&e.setYAxisHelper(this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._tick=Nt({},this._spec.tick,(t=this._spec.layers)===null||t===void 0?void 0:t[0])}_initData(){var t;if(super._initData(),(t=this._spec.layers)===null||t===void 0?void 0:t[1]){const e=new Ve(this._option.dataSet,{name:`${this.type}_${this.id}_layer_1_ticks`}).parse(this._scale,{type:"scale"}).transform({type:`${this.type}-ticks`,options:Object.assign(Object.assign({},this._tickTransformOption()),{tickCount:this._spec.layers[1].tickCount,forceTickCount:this._spec.layers[1].forceTickCount,tickStep:this._spec.layers[1].tickStep})},!1);this._layerTickData=new Qa(this._option,e)}}computeData(t){super.computeData(t),this._layerTickData&&(this._layerTickData.getDataView().reRunAllTransform(),this._layerTickData.updateData())}_getLabelFormatMethod(){var t,e,i,r,s,o,a,l;const h=Xo.getInstance(),d=((e=(t=this._spec.layers)===null||t===void 0?void 0:t[1])===null||e===void 0?void 0:e.timeFormat)||"%Y%m%d",u=(((r=(i=this._spec.layers)===null||i===void 0?void 0:i[1])===null||r===void 0?void 0:r.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat,c=((o=(s=this._spec.layers)===null||s===void 0?void 0:s[0])===null||o===void 0?void 0:o.timeFormat)||"%Y%m%d",g=(((l=(a=this._spec.layers)===null||a===void 0?void 0:a[0])===null||l===void 0?void 0:l.timeFormatMode)||"local")==="local"?h.timeFormat:h.timeUTCFormat;return(p,f,m,v,_)=>{var b;let y;return y=_===0?g(c,p):u(d,p),!((b=this._spec.label)===null||b===void 0)&&b.formatMethod?this._spec.label.formatMethod(y,f):y}}getLabelItems(t){var e,i;const r=[],s=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();s&&s.length&&r.push(s.map(a=>wf(a.value,this._getNormalizedValue([a.value],t))));const o=(i=this._layerTickData)===null||i===void 0?void 0:i.getLatestData();return o&&o.length&&r.push(o.map(a=>wf(a.value,this._getNormalizedValue([a.value],t)))),r}registerTicksTransform(){const t=`${this.type}-ticks`;return Vt(this._option.dataSet,t,Cb),t}transformScaleDomain(){}}rA.type=vt.cartesianTimeAxis,rA.specKey="axes";const v4t=()=>{Jc(),Qc(),tg(),q.registerComponent(rA.type,rA)};class Nv extends md{constructor(){super(...arguments),this.type=vt.cartesianLogAxis,this._zero=!1,this._scale=new dT}initScales(){var t;super.initScales(),this._scale.base((t=this._spec.base)!==null&&t!==void 0?t:10),this._scale.clamp(!0,null,!1)}registerTicksTransform(){const t=`${this.type}-ticks`;return Vt(this._option.dataSet,t,Cb),t}transformScaleDomain(){}}Nv.type=vt.cartesianLogAxis,Nv.specKey="axes",Ye(Nv,WT);const _4t=()=>{Jc(),Qc(),tg(),q.registerComponent(Nv.type,Nv)};class $v extends md{constructor(){super(...arguments),this.type=vt.cartesianSymlogAxis,this._zero=!1,this._scale=new uT}initScales(){var t;super.initScales(),this._scale.constant((t=this._spec.constant)!==null&&t!==void 0?t:10)}registerTicksTransform(){const t=`${this.type}-ticks`;return Vt(this._option.dataSet,t,Cb),t}transformScaleDomain(){}}$v.type=vt.cartesianSymlogAxis,$v.specKey="axes",Ye($v,WT);const b4t=()=>{Jc(),Qc(),tg(),q.registerComponent($v.type,$v)};class np extends Po{constructor(){super(...arguments),this.type=gt.line,this.transformerConstructor=Rb,this._sortDataByAxis=!1}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}initMark(){var t;const e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"line";this.initLineMark(e,i==="line"),this.initSymbolMark(e,i==="point")}initTooltip(){super.initTooltip();const{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}initMarkStyle(){this.initLineMarkStyle(this._direction),this.initSymbolMarkStyle()}initAnimation(){var t,e,i,r;const s={direction:this.direction},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;if(this._lineMark.setAnimationConfig(Ae((i=q.getAnimationInKey("line"))===null||i===void 0?void 0:i(s,o),Fe("line",this._spec,this._markAttributeContext))),this._symbolMark){const a=Qd(this);this._symbolMark.setAnimationConfig(Ae((r=q.getAnimationInKey("scaleInOut"))===null||r===void 0?void 0:r(),Fe("point",this._spec,this._markAttributeContext),a))}}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){var e;const i=((e=this._spec)===null||e===void 0?void 0:e.seriesMark)!=="point";return r=>{var s,o;return i&&r==="fill"&&(r="stroke"),(o=(s=this._seriesMark)===null||s===void 0?void 0:s.getAttribute(r,t))!==null&&o!==void 0?o:void 0}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._lineMark,this._symbolMark]}}np.type=gt.line,np.mark=GGt,np.transformerConstructor=Rb,Ye(np,tH);const y4t=()=>{GF(),xit(),HT(),vh(),tnt(),FT(),vs(),ms(),q.registerSeries(np.type,np)};class C4t{get dataList(){return this._dataArr}constructor(t){this._dataArr=[],this._dataSet=t}parseData(t){this._dataArr=[];const e=Q(t);for(let i=0;i<e.length;i++)this._dataArr.push(UF(e[i],this._dataSet,this._dataArr))}updateData(t,e=!1,i=!0){const r=Q(t);return(!e||r.length===this._dataArr.length)&&(this._dataValueForEach(r,(s,o)=>{o.markRunning()}),this._dataValueForEach(r,(s,o)=>{YF(o,s,i)}),!0)}_dataValueForEach(t,e){t.forEach((i,r)=>{if(i instanceof Ve)return;const s=this.getSeriesData(i.id,r);s&&e(i,s,r)})}getSeriesData(t,e){if(!this._dataArr.length)return null;if(typeof t=="string"){const i=this._dataArr.filter(r=>r.name===t);if(i[0])return i[0];ls(`no data matches dataId ${t}!`)}if(typeof e=="number"){if(this._dataArr[e])return this._dataArr[e];ls(`no data matches dataIndex ${e}!`)}return this._dataArr[0]}}class S4t{constructor(t,e){this._scaleSpecMap=new Map,this._scaleMap=new Map,this._modelScaleSpecMap=new Map,this._markAttributeScaleMap=new Map,this._spec=null,this._chart=null,this.getStatisticalFields=i=>{const r=[];return this._scaleSpecMap.forEach((s,o)=>{Kg(s.domain)&&s.domain.forEach(a=>{a.dataId===i&&a.fields.forEach(l=>{jp(r,[{key:l,operations:Je(s.type)?["max","min"]:["values"]}])})})}),this._markAttributeScaleMap.forEach((s,o)=>{const a=this.getScale(o);s.forEach(l=>{this._getSeriesBySeriesId(l.seriesId).getRawData().name===i&&l.field&&jp(r,[{key:l.field,operations:Je(a.type)?["max","min"]:["values"]}])})}),r},this._spec=t,this._chart=e,this._setAttrFromSpec()}_createFromSpec(t){if(!t.id)return null;let e=this._scaleMap.get(t.id);return e||(e=t.type==="ordinal"&&t.id==="color"?SI("colorOrdinal"):SI(t.type)),e?(V(t.range)&&e.range(t.range),V(t.domain)&&(Kg(t.domain)||e.domain(t.domain)),t.specified&&e.specified&&e.specified(t.specified),t.clamp&&e.clamp&&e.clamp(t.clamp),e):null}_setAttrFromSpec(){var t;if(!(!((t=this._spec)===null||t===void 0)&&t.length))return;const e=new Map,i=new Map;this._spec.forEach(r=>{const s=this._createFromSpec(r);s&&(e.set(r.id,s),i.set(r.id,r))}),this._modelScaleSpecMap.forEach(r=>{const s=this._createFromSpec(r);s&&(e.set(r.id,s),i.set(r.id,r))}),this._scaleSpecMap=i,this._scaleMap=e}updateSpec(t){const e={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(Oe(t,this._spec))return e;e.change=!0;for(let i=0;i<t.length;i++){const r=t[i],s=this._scaleMap.get(r.id);if(!s)return e.reMake=!0,e;const o=this._spec.find(a=>a.id===r.id);if(!o.id||o.type!==r.type||!Oe(o.specified,r.specified))return e.reMake=!0,e;r.range&&!Oe(r.range,s.range())&&(s.range(r.range),e.reRender=!0),Kg(r.domain)?e.reRender=!0:Oe(r.domain,s.domain())||(s.domain(r.domain),e.reRender=!0),this._scaleSpecMap.set(r.id,r)}return this._spec=t,e}registerModelScale(t){const e=this._createFromSpec(t);e&&(this._modelScaleSpecMap.set(t.id,t),this._scaleSpecMap.set(t.id,t),this._scaleMap.set(t.id,e))}removeModelScale(t){this._modelScaleSpecMap.forEach(e=>{t(e)&&(this._modelScaleSpecMap.delete(e.id),this._scaleSpecMap.delete(e.id),this._scaleMap.delete(e.id))})}getScale(t){return this._scaleMap.get(t)}getScaleSpec(t){return this._scaleSpecMap.get(t)}_getSeriesByRawDataId(t){const e=this._chart.getAllSeries();for(let i=0;i<e.length;i++){const r=e[i];if(r.getRawData().name===t)return r}return null}_getSeriesBySeriesId(t){const e=this._chart.getAllSeries();for(let i=0;i<e.length;i++){const r=e[i];if(r.id===t)return r}return null}updateScaleDomain(t){this._scaleSpecMap.forEach((e,i)=>{const r=this._scaleMap.get(i);if(!r)return;if(!Kg(e.domain))return e.domain&&e.domain.length!==0||r.domain(t),void this._updateMarkScale(i,r,r.domain().slice());let s;s=Je(e.type)?[null,null]:new Set,e.domain.forEach(a=>{const l=this._getSeriesByRawDataId(a.dataId);if(!l)return;const h=Je(e.type);a.fields.forEach(d=>{const u=l.getRawDataStatisticsByField(d,h);u&&(h?(D(s[0])?s[0]=u.min:s[0]=Math.min(u.min,s[0]),D(s[1])?s[1]=u.max:s[1]=Math.max(u.max,s[1])):u.values.forEach(c=>{s.add(c)}))})});const o=s;Je(e.type)||(s=Array.from(s)),r.domain(s),this._updateMarkScale(i,r,o)})}_updateMarkScale(t,e,i){const r=this._markAttributeScaleMap.get(t);r&&r.length!==0&&r.forEach(s=>{if(!s.field||!s.markScale||s.markScale===e)return;if(D(s.changeDomain)||s.changeDomain==="none"||D(s.seriesId))return void(Je(e.type)?s.markScale.domain(i):e.domain(Array.from(i)));const o=this._getSeriesBySeriesId(s.seriesId),a=Je(e.type),l=o.getRawDataStatisticsByField(s.field,a);if(!xt(l))return s.changeDomain==="expand"?(a?(i[0]=Math.min(i[0],l.min),i[1]=Math.max(i[1],l.max)):(l.values.forEach(h=>{i.add(h)}),i=Array.from(i)),void s.markScale.domain(i)):void(s.changeDomain!=="replace"||(a?s.markScale.domain([l.min,l.max]):s.markScale.domain(l.values)));Je(e.type)?s.markScale.domain(i):e.domain(Array.from(i))})}registerMarkAttributeScale(t,e){const i=this._scaleMap.get(t.scale);let r=this._markAttributeScaleMap.get(t.scale);r||(r=[],this._markAttributeScaleMap.set(t.scale,r));let s=i;return(D(t.field)||!D(t.changeDomain)&&t.changeDomain!=="none"&&!D(e))&&(s=i.clone()),r.push(Object.assign(Object.assign({},t),{seriesId:e,markScale:s})),s}}var W8=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class Pi extends PT{getSpec(){return this._spec}setSpec(t){this._spec=t}getOption(){return this._option}getLayoutRect(){return this._layoutRect}getViewRect(){return this._viewRect}getLayoutTag(){return this._layoutTag}setLayoutTag(t,e,i=!0){this._layoutTag=t;const r=this.getCompiler();return r!=null&&r.getVGrammarView()&&(r.getVGrammarView().updateLayoutTag(),t&&i&&r.renderNextTick(e)),this._layoutTag}getGlobalScale(){return this._globalScale}getEvent(){return this._event}get chartData(){return this._chartData}constructor(t,e){var i,r,s;super(e),this.type="chart",this.id=Kc(),this._regions=[],this._series=[],this._components=[],this._layoutRect={x:0,y:0,width:tp,height:ep},this._viewRect={width:tp,height:ep},this._viewBox={x1:0,y1:0,x2:tp,y2:ep},this._layoutTag=!0,this._idMap=new Map,this.state={layoutUpdateRank:1},this.padding={top:0,left:0,right:0,bottom:0},this.getAllSeries=()=>{var o;return(o=this._series)!==null&&o!==void 0?o:[]},this.getRegionsInIndex=o=>o&&o.length!==0?this._regions.filter((a,l)=>o.includes(l)):[this._regions[0]],this.getAllRegions=()=>this._regions,this.getRegionsInIds=o=>o?this._regions.filter(a=>o.includes(a.id)):[],this.getRegionsInQuerier=o=>o?this._regions.filter((a,l)=>Q(o).some(h=>L(h.regionId)&&h.regionId===a.userId||h.regionIndex===l)):this._regions,this.getRegionsInUserId=o=>{if(o)return this._regions.find(a=>a.userId===o)},this.getRegionsInUserIdOrIndex=(o,a)=>this.getAllRegions().filter(l=>o!=null&&o.length?l.userId&&o.includes(l.userId):!(a!=null&&a.length)||a.includes(l.getSpecIndex())),this.getComponents=()=>this._components,this.getSeriesInIndex=o=>o&&o.length!==0?this._series.filter((a,l)=>o.includes(l)):[this._series[0]],this.getSeriesInIds=o=>o?this._series.filter(a=>o.includes(a.id)):[],this.getSeriesInUserId=o=>{if(o)return this._series.find(a=>a.userId===o)},this.getSeriesInUserIdOrIndex=(o,a)=>this.getAllSeries().filter(l=>o!=null&&o.length?l.userId&&o.includes(l.userId):!(a!=null&&a.length)||a.includes(l.getSpecIndex())),this.getComponentByIndex=(o,a)=>{const l=this._components.filter(h=>(h.specKey||h.type)===o);if(l&&l.length!==0)return l[a]},this.getComponentsByKey=o=>this._components.filter(a=>(a.specKey||a.type)===o),this.getComponentByUserId=o=>{const a=this._components.find(l=>l.userId===o);if(a)return a},this.getComponentsByType=o=>this._components.filter(a=>a.type===o),this._paddingSpec=Id((i=t.padding)!==null&&i!==void 0?i:e.getTheme().padding),this._event=new RT(e.eventDispatcher,e.mode),this._dataSet=e.dataSet,this._chartData=new C4t(this._dataSet),this._modelOption=Object.assign(Object.assign({},e),{mode:this._option.mode,map:this._idMap,getChartLayoutRect:()=>this._layoutRect,getChartViewRect:()=>this._viewRect,getChart:()=>this,globalScale:this._globalScale,onError:(r=this._option)===null||r===void 0?void 0:r.onError,disableTriggerEvent:((s=this._option)===null||s===void 0?void 0:s.disableTriggerEvent)===!0,getSeriesData:this._chartData.getSeriesData.bind(this._chartData)}),this._spec=t}created(t){this._chartData.parseData(this._spec.data),this._createGlobalScale(),this._createBackground(),this._createLayout(),t.forEachRegionInSpec(this._spec,this._createRegion.bind(this)),t.forEachSeriesInSpec(this._spec,this._createSeries.bind(this)),t.forEachComponentInSpec(this._spec,this._createComponent.bind(this),this._option.getSpecInfo())}init(){var t,e;(t=this._beforeInit)===null||t===void 0||t.call(this),this._regions.forEach(i=>i.init({})),this._series.forEach(i=>i.init({})),this._components.forEach(i=>i.init({dataSet:this._dataSet})),this._initEvent(),(e=this._initStack)===null||e===void 0||e.call(this),this.reDataFlow()}reDataFlow(){this._series.forEach(t=>{var e;return(e=t.getRawData())===null||e===void 0?void 0:e.markRunning()}),this._series.forEach(t=>t.fillData()),this.updateGlobalScaleDomain()}onResize(t,e,i=!0){const r={width:t,height:e};this._canvasRect=r,this._updateLayoutRect(this._option.viewBox),this.setLayoutTag(!0,null,i)}updateViewBox(t,e){this._option.viewBox=t,this._updateLayoutRect(t),this.setLayoutTag(!0,null,e)}_createBackground(){const t=this._spec.background;if(!t||typeof t!="object"||L(t.gradient))return;const e=Jl(t,["x","y","width","height","x1","y1","image"]);e.background=t.image,this._backgroundMark=q.createMark("group","chart-background",{model:this,map:this._option.map,getCompiler:this.getCompiler,globalScale:this._globalScale}),this._backgroundMark.created(),this._backgroundMark.setStyle(Object.assign(Object.assign({},e),{x:()=>this._viewBox.x1,y:()=>this._viewBox.y1,width:()=>this._viewBox.x2-this._viewBox.x1,height:()=>this._viewBox.y2-this._viewBox.y1})),this._backgroundMark.setMarkConfig({zIndex:Qe.SeriesGroup-2})}_createRegion(t,e){if(!t)return;const{spec:i}=e,r=W8(e,["spec"]),s=new t(i,Object.assign(Object.assign({},this._modelOption),r));s&&(s.created(),this._regions.push(s))}_createSeries(t,e){if(!t)return;const{spec:i}=e,r=W8(e,["spec"]);let s;if(L(i.regionId)?s=this.getRegionsInUserId(i.regionId):L(i.regionIndex)&&(s=this.getRegionsInIndex([i.regionIndex])[0]),!s&&!(s=this._regions[0]))return;const o=new t(i,Object.assign(Object.assign(Object.assign({},this._modelOption),r),{type:i.type,region:s,globalScale:this._globalScale,sourceDataList:this._chartData.dataList}));o&&(o.created(),this._series.push(o),s.addSeries(o))}getSeriesById(t){return this._series.find(e=>e.id===t)}_createComponent(t,e){const i=t.createComponent(e,Object.assign(Object.assign({},this._modelOption),{type:t.type,getAllRegions:this.getAllRegions,getRegionsInIndex:this.getRegionsInIndex,getRegionsInIds:this.getRegionsInIds,getRegionsInUserIdOrIndex:this.getRegionsInUserIdOrIndex,getAllSeries:this.getAllSeries,getSeriesInIndex:this.getSeriesInIndex,getSeriesInIds:this.getSeriesInIds,getSeriesInUserIdOrIndex:this.getSeriesInUserIdOrIndex,getAllComponents:this.getComponents,getComponentByIndex:this.getComponentByIndex,getComponentByUserId:this.getComponentByUserId,getComponentsByKey:this.getComponentsByKey,getComponentsByType:this.getComponentsByType}));i&&(i.created(),this._components.push(i))}getAllComponents(){return this._components}getAllModels(){return[].concat(this.getAllSeries(),this.getAllComponents(),this.getAllRegions())}getModelInFilter(t){if(yt(t))return this.getAllModels().find(i=>i.userId===t);if(it(t))return this.getAllModels().find(i=>t(i));let e=0;return this.getAllModels().find(i=>{var r;if(((r=i.specKey)!==null&&r!==void 0?r:i.type)===t.type){if(e===t.index)return!0;e++}return!1})}_createLayout(){this._updateLayoutRect(this._option.viewBox),this._initLayoutFunc()}setLayout(t){this._option.layout=t,this._initLayoutFunc()}_initLayoutFunc(){var t,e,i;if(this._layoutFunc=this._option.layout,!this._layoutFunc){let r=!1;(this._spec.zField||this._spec.series&&this._spec.series.some(o=>o.zField))&&(r=!0);const s=q.getLayoutInKey((e=(t=this._spec.layout)===null||t===void 0?void 0:t.type)!==null&&e!==void 0?e:r?"layout3d":"base");if(s){const o=new s(this._spec.layout,{onError:(i=this._option)===null||i===void 0?void 0:i.onError});this._layoutFunc=o.layoutItems.bind(o)}}}layout(t){var e,i,r,s;if((i=(e=this._option.performanceHook)===null||e===void 0?void 0:e.beforeLayoutWithSceneGraph)===null||i===void 0||i.call(e),this.getLayoutTag()){this._event.emit(Ot.layoutStart,{chart:this,vchart:this._option.globalInstance}),this.onLayoutStart(t);const o=this.getLayoutElements();this._layoutFunc(this,o,this._layoutRect,this._viewBox),this._event.emit(Ot.afterLayout,{elements:o,chart:this}),this.setLayoutTag(!1),this.onLayoutEnd(t),this._event.emit(Ot.layoutEnd,{chart:this,vchart:this._option.globalInstance})}(s=(r=this._option.performanceHook)===null||r===void 0?void 0:r.afterLayoutWithSceneGraph)===null||s===void 0||s.call(r)}onLayoutStart(t){this.getAllModels().forEach(e=>e.onLayoutStart(this._layoutRect,this._viewRect,t))}onLayoutEnd(t){this.getAllModels().forEach(e=>{e.modelType!=="series"&&e.onLayoutEnd(t)})}onEvaluateEnd(t){[...this._components,...this._regions,...this._series].forEach(e=>e.onEvaluateEnd(t))}getLayoutElements(){return this.getAllModels().map(t=>t.layout).filter(t=>!!t)}getModelById(t){const e=this._idMap.get(t);if(e&&e instanceof KF)return e}getModelByUserId(t){const e=this.getSeriesInUserId(t);if(e)return e;const i=this.getRegionsInUserId(t);return i||this.getComponentByUserId(t)||void 0}getAllMarks(){return Array.from(this._idMap.values()).filter(t=>t&&t instanceof sr)}getMarkById(t){const e=this._idMap.get(t);if(e&&e instanceof sr)return e}getMarkByUserName(t){return this.getAllMarks().filter(e=>e.name&&e.name===t)}updateData(t,e,i=!0,r){const s=this._dataSet.getDataView(t);s&&(s.markRunning(),s.parseNewData(e,r)),i&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(o=>o.onDataUpdate())}updateFullData(t,e=!0){Q(t).forEach(i=>{const r=this._dataSet.getDataView(i.id);r&&r.markRunning()}),Q(t).forEach(i=>{const r=this._dataSet.getDataView(i.id);r&&YF(r,i,!0)}),e&&this.updateGlobalScaleDomain(),this.getAllModels().forEach(i=>i.onDataUpdate())}onRender(t){}setCanvasRect(t,e){this._canvasRect={width:t,height:e}}getCanvasRect(){return this._canvasRect||(this._canvasRect=Wit(this._spec,this._option,{width:tp,height:ep})),this._canvasRect}getSeriesData(t,e){return this._chartData.getSeriesData(t,e)}_transformSpecScale(){var t;const e=this._spec.scales?[...this._spec.scales]:[];let i=e.find(s=>s.id==="color");const r=this.getColorScheme();if(!i&&(i={type:"ordinal",id:"color",domain:null,range:null},e.push(i),this._spec.color)){const s=this._spec.color;if(V(s))i.range=s;else{const o=s;Object.prototype.hasOwnProperty.call(o,"type")&&(i.type=o.type),Object.prototype.hasOwnProperty.call(o,"domain")&&(i.domain=o.domain),Object.prototype.hasOwnProperty.call(o,"range")&&(i.range=o.range),Object.prototype.hasOwnProperty.call(o,"specified")&&(i.specified=o.specified),Object.prototype.hasOwnProperty.call(o,"clamp")&&(i.clamp=o.clamp)}}return!((t=i.range)===null||t===void 0)&&t.length||(i.range=_0(r),i.rangeTheme=!0),e}_createGlobalScale(){this._globalScale=new S4t(this._transformSpecScale(),this),this._modelOption.globalScale=this._globalScale}updateGlobalScaleDomain(){const t=new Set;this._series.forEach(i=>{const r=i.getSeriesKeys();r&&r.forEach(s=>t.add(s))});const e=Array.from(t);this._globalScale.updateScaleDomain(e)}updateGlobalScale(t){Eg(t,this._globalScale.updateSpec(this._transformSpecScale()))}updateGlobalScaleTheme(){const t=this._globalScale.getScaleSpec("color"),e=this.getColorScheme();t.rangeTheme&&(t.range=_0(e),this._globalScale.getScale("color").range(t.range))}_getSpecKeys(t){const e={width:!0,height:!0};return Object.keys(t).filter(i=>!e[i]).sort()}updateSpec(t){const e={change:!1,reMake:!1,reRender:!1,reSize:!1,reCompile:!1};if(this.setLayoutTag(!0,null,!1),t.type!==this.type)return e.reMake=!0,e;const i=this._getSpecKeys(this._spec),r=this._getSpecKeys(t);if(!Oe(i,r))return e.reMake=!0,e;for(let o=0;o<i.length;o++){const a=i[o];if(V(this._spec[a])&&this._spec[a].length!==Q(t[a]).length)return e.reMake=!0,e}const s=this._spec;return this._spec=t,this.updateChartConfig(e,s),e.reMake?e:(this.updateGlobalScale(e),e.reMake?e:(this.updateRegionSpec(e),e.reMake?e:(this.updateComponentSpec(e),e.reMake||(this.updateSeriesSpec(e),e.reMake||(this.reInit(),this.updateDataSpec(),this.updateGlobalScaleDomain())),e)))}updateChartConfig(t,e){var i,r;this._paddingSpec=Id((i=this._spec.padding)!==null&&i!==void 0?i:(r=this._option)===null||r===void 0?void 0:r.getTheme().padding),this._updateLayoutRect(this._viewBox)}updateDataSpec(){this._spec.data&&this._chartData.updateData(this._spec.data,!1,!0)}updateRegionSpec(t){var e;!((e=this._spec)===null||e===void 0)&&e.region&&(this._spec.region.length===this._regions.length?this._regions.forEach(i=>{Eg(t,i.updateSpec(this._spec.region[i.getSpecIndex()]))}):t.reMake=!0)}updateComponentSpec(t){const e={},i={[vt.title]:!0,[vt.brush]:!0,[vt.mapLabel]:!0,[vt.indicator]:!0};this._components.forEach(s=>{var o,a;if(s.type===vt.label||s.type===vt.totalLabel)return;i[s.type]&&(i[s.type]=!1);const l=s.specKey||s.type,h=(o=this._spec[l])!==null&&o!==void 0?o:{};V(h)?(e[l]=e[l]||{specCount:h.length,componentCount:0},e[l].componentCount++,Eg(t,s.updateSpec((a=h[s.getSpecIndex()])!==null&&a!==void 0?a:{},h))):Eg(t,s.updateSpec(h))});for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)){const o=e[s];o.componentCount!==o.specCount&&(t.reMake=!0)}const r=s=>s&&s.visible!==!1;Object.keys(i).forEach(s=>{if(i[s]){const o=this._spec[s];(V(o)?o.some(r):r(o))&&(t.reMake=!0)}})}updateSeriesSpec(t){this._spec.series.length===this._series.length?this._series.forEach(e=>{const i=this._spec.series[e.getSpecIndex()];Eg(t,e.updateSpec(i))}):t.reMake=!0}getCanvas(){var t,e;return(e=(t=this.getCompiler())===null||t===void 0?void 0:t.getCanvas())!==null&&e!==void 0?e:null}_updateLayoutRect(t){let e=this.getCanvasRect();if(t){this._viewBox=t;const{x1:i=0,y1:r=0,x2:s,y2:o}=t;e={width:s-i,height:o-r}}else this._viewBox={x1:0,y1:0,x2:e.width,y2:e.height};this._viewRect=e,this.padding=Bet(this._paddingSpec,e,e),this._layoutRect.width=e.width-this.padding.left-this.padding.right,this._layoutRect.height=e.height-this.padding.top-this.padding.bottom,this._layoutRect.x=this.padding.left,this._layoutRect.y=this.padding.top,this._event.emit(Ot.layoutRectUpdate,{chart:this})}setCurrentTheme(){this.updateChartConfig({change:!0,reMake:!1},this._spec),this.setLayoutTag(!0,null,!1),this.updateGlobalScaleTheme(),this.reInit()}reInit(){[...this._regions,...this._series,...this._components].forEach(t=>{const e=t.getSpecInfo();e&&e.spec&&t.reInit(e.spec)})}clear(){this.getAllModels().forEach(t=>{var e;return(e=t.clear)===null||e===void 0?void 0:e.call(t)})}compile(){this.compileBackground(),this.compileLayout(),this.compileRegions(),this.compileSeries(),this.compileComponents()}afterCompile(){this.getAllRegions().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)}),this.getAllSeries().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)}),this.getAllComponents().forEach(t=>{var e;(e=t.afterCompile)===null||e===void 0||e.call(t)})}compileLayout(){const{width:t,height:e}=this.getCanvasRect();this.getCompiler().setSize(t,e)}compileBackground(){var t;this._backgroundMark&&(this._backgroundMark.compile({context:{model:this}}),(t=this._backgroundMark.getProduct())===null||t===void 0||t.layout(()=>{}))}compileRegions(){var t,e,i,r;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeRegionCompile)===null||e===void 0||e.call(t),this.getAllRegions().forEach(s=>{s.compile()}),(r=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterRegionCompile)===null||r===void 0||r.call(i)}compileSeries(){var t,e,i,r;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeSeriesCompile)===null||e===void 0||e.call(t),this.getAllSeries().forEach(s=>{s.compile()}),(r=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterSeriesCompile)===null||r===void 0||r.call(i)}compileComponents(){var t,e,i,r;(e=(t=this._option.performanceHook)===null||t===void 0?void 0:t.beforeComponentCompile)===null||e===void 0||e.call(t),this.getAllComponents().forEach(s=>{s.compile()}),(r=(i=this._option.performanceHook)===null||i===void 0?void 0:i.afterComponentCompile)===null||r===void 0||r.call(i)}release(){[...this._components,...this._regions,...this._series].forEach(t=>{t.beforeRelease()}),super.release(),this.clear(),[...this._components,...this._regions,...this._series].forEach(t=>{t.release()}),this._components=this._regions=this._series=[],this._spec={},this._dataSet=this._globalScale=this._layoutFunc=null,this._layoutTag=!1,this._idMap.clear()}onLayout(t){const e=t.rootMark;this.layout({group:e,srView:t})}updateState(t,e){const i=this.getAllSeries();for(const r in t){if(xt(t[r]))continue;const s=t[r];let o={stateValue:r};o=it(s.filter)?Object.assign({filter:s.filter},o):Object.assign(Object.assign({},s.filter),o),s.level&&(o.level=s.level),i.forEach(a=>{a.getMarks().forEach(l=>{l.stateStyle[r]&&(e&&!e(a,l,r)||(l.state.changeStateInfo(o),l.updateMarkState(r)))})})}}setSelected(t,e,i){this._setStateInDatum(Rt.STATE_SELECTED,!0,t,e,i)}setHovered(t,e,i){this._setStateInDatum(Rt.STATE_HOVER,!0,t,e,i)}clearState(t){this.getAllRegions().forEach(e=>{e.interaction.clearEventElement(t,!0),e.interaction.resetInteraction(t,null)})}clearAllStates(){this.getAllRegions().forEach(t=>{t.interaction.clearAllEventElement(),t.interaction.resetAllInteraction()})}clearSelected(){this.clearState(Rt.STATE_SELECTED)}clearHovered(){this.clearState(Rt.STATE_HOVER)}_initEvent(){[Ot.dataZoomChange,Ot.scrollBarChange].forEach(t=>{this._event.on(t,({value:e})=>{this._disableMarkAnimation(["exit","update"]);const i=()=>{this._enableMarkAnimation(["exit","update"]),this._event.off(Lt.AFTER_MARK_RENDER_END,i)};this._event.on(Lt.AFTER_MARK_RENDER_END,i)})})}_enableMarkAnimation(t){this.getAllMarks().forEach(e=>{const i=e.getProduct();i&&i.animate&&i.animate.enableAnimationState(t)})}_disableMarkAnimation(t){this.getAllMarks().forEach(e=>{const i=e.getProduct();i&&i.animate&&i.animate.disableAnimationState(t)})}filterGraphicsByDatum(t,e={}){var i;const r=(t=t?Q(t):null)?Object.keys(t[0]):null,s=[],o=(i=e.getDatum)!==null&&i!==void 0?i:a=>a.getDatum();return this.getRegionsInQuerier(e.region).forEach(a=>{const l=[];t&&a.getSeries().forEach(h=>{h.getMarks().forEach(d=>{if(d.getProduct()&&(!e.filter||it(e.filter)&&e.filter(h,d))){const u=d.getProduct().isCollectionMark(),c=d.getProduct().elements;if(u)c.filter(g=>{const p=o(g,d,h,a);p&&t.every((f,m)=>r.every(v=>f[v]==p[m][v]))&&(l.push(g),s.push(g),e.callback&&e.callback(g,d,h,a))});else if(t.length>1){const g=t.slice();c.forEach(p=>{const f=o(p,d,h,a),m=f&&g.findIndex(v=>r.every(_=>v[_]==f[_]));m>=0&&(g.splice(m,1),l.push(p),s.push(p),e.callback&&e.callback(p,d,h,a))})}else{const g=c.find(p=>{const f=o(p,d,h,a);return f&&r.every(m=>t[0][m]==f[m])});g&&(l.push(g),s.push(g),e.callback&&e.callback(g,d,h,a))}}})}),e.regionCallback&&e.regionCallback(l,a)}),s}_setStateInDatum(t,e,i,r,s){this.filterGraphicsByDatum(i,{filter:r,region:s,regionCallback:(o,a)=>{i?o.length&&(o.forEach(l=>{a.interaction.startInteraction(t,l)}),e&&a.interaction.reverseEventElement(t)):a.interaction.clearEventElement(t,!0)}})}setDimensionIndex(t,e){var i,r;let s=null;Array.from(this._event.getComposedEventMap().values()).forEach(a=>{const{eventType:l,event:h}=a;if(l===rh.dimensionHover||l===rh.dimensionClick){const d=h.dispatch(t,e);d!=null&&d.length&&(s=d)}});const o=D(t)||!s||s.every(a=>xr(a.axis.getScale().type)&&D(a.index));if(e.tooltip!==!1){const a=this.getComponentsByType(vt.tooltip)[0];if(a!=null&&a.getVisible())if(o)(r=(i=a).hideTooltip)===null||r===void 0||r.call(i);else{const l={};s.forEach(h=>{const{axis:d,value:u,data:c}=h,g=d.getOrient()==="left"||d.getOrient()==="right";c.forEach(p=>{var f,m,v;const _=g?p.series.fieldY[0]:p.series.fieldX[0];l[_]=(v=(m=(f=p.datum)===null||f===void 0?void 0:f[0])===null||m===void 0?void 0:m[_])!==null&&v!==void 0?v:u})}),a.showTooltip(l,e.showTooltipOption)}}if(e.crosshair!==!1){const a=this.getComponentsByType(vt.cartesianCrosshair)[0];a&&a.clearAxisValue&&a.setAxisValue&&(o?a.hideCrosshair():a.showCrosshair(s))}}getColorScheme(){var t,e;return(e=(t=this._option).getTheme)===null||e===void 0?void 0:e.call(t).colorScheme}}const j8=(n,t)=>{var e;const i=n.spec,{regionId:r,regionIndex:s}=i;if(L(r)){const o=Q(r);return(e=t.region)===null||e===void 0?void 0:e.filter(({spec:a})=>o.includes(a.id))}if(L(s))return Q(s).map(o=>{var a;return(a=t.region)===null||a===void 0?void 0:a[o]}).filter(L)},x4t=(n,t)=>{var e;const i=n.spec,{seriesId:r,seriesIndex:s}=i;if(L(r)){const o=Q(r);return(e=t.series)===null||e===void 0?void 0:e.filter(({spec:a})=>o.includes(a.id))}if(L(s))return Q(s).map(o=>{var a;return(a=t.series)===null||a===void 0?void 0:a[o]}).filter(L)};class Eo{constructor(t){this._option=t,this.type=t.type,this.seriesType=t.seriesType}initChartSpec(t){return this.transformSpec(t),this.transformModelSpec(t)}transformSpec(t){t.region&&t.region.length!==0||(t.region=[{}]),t.tooltip===void 0&&(t.tooltip={}),L(t.stackInverse)&&t.region.forEach(e=>{!L(e.stackInverse)&&(e.stackInverse=t.stackInverse)}),L(t.stackSort)&&t.region.forEach(e=>{!L(e.stackSort)&&(e.stackSort=t.stackSort)})}generateTransform(t,e){return(i,r,s)=>{const{spec:o,specPath:a,specInfoPath:l,type:h}=r,d=new i.transformerConstructor(Object.assign(Object.assign({},this._option),{type:h})),u=d.transformSpec(o,t,s),c=Object.assign(Object.assign({},r),u);e?c.theme=d.getTheme(o,t):wI(t,a,u.spec),wI(s,l??a,c)}}transformModelSpec(t){return this.createSpecInfo(t,this.generateTransform(t,!1))}createSpecInfo(t,e){var i,r;e||(e=this.generateTransform(t,!0));const s={};return this.forEachRegionInSpec(t,e,s),this.forEachSeriesInSpec(t,e,s),(i=s.series)===null||i===void 0||i.forEach((o,a)=>{var l,h;const d=((h=(l=j8(o,s))!==null&&l!==void 0?l:s.region)!==null&&h!==void 0?h:[])[0];d&&(d.seriesIndexes||(d.seriesIndexes=[]),d.seriesIndexes.push(a),o.regionIndexes=d.regionIndexes.slice())}),this.forEachComponentInSpec(t,e,s),Object.values((r=s.component)!==null&&r!==void 0?r:{}).forEach(o=>o.forEach((a,l)=>{var h,d,u;if(a){if(!a.regionIndexes){const c=(d=(h=j8(a,s))!==null&&h!==void 0?h:s.region)!==null&&d!==void 0?d:[];a.regionIndexes=c.map(g=>g.regionIndexes[0])}if(!a.seriesIndexes){const c=x4t(a,s);if(c)a.seriesIndexes=c.map(({seriesIndexes:g})=>g[0]);else{const g=new Set;((u=a.regionIndexes)!==null&&u!==void 0?u:[]).forEach(p=>{var f,m;const v=(f=s.region)===null||f===void 0?void 0:f[p];(m=v==null?void 0:v.seriesIndexes)===null||m===void 0||m.forEach(_=>g.add(_))}),a.seriesIndexes=Array.from(g)}}}})),s}_isValidSeries(t){return!0}_getDefaultSeriesSpec(t,e,i){var r,s,o,a;const l={dataKey:t.dataKey,hover:t.hover,select:t.select,label:t.label,seriesStyle:t.seriesStyle,animation:(r=t.animation)!==null&&r!==void 0?r:this._option.animation,animationThreshold:(s=t.animationThreshold)!==null&&s!==void 0?s:(a=(o=this._option).getTheme)===null||a===void 0?void 0:a.call(o).animationThreshold,animationAppear:t.animationAppear,animationDisappear:t.animationDisappear,animationEnter:t.animationEnter,animationUpdate:t.animationUpdate,animationExit:t.animationExit,animationNormal:t.animationNormal,animationState:t.animationState,extensionMark:t.extensionMark,large:t.large,largeThreshold:t.largeThreshold,progressiveStep:t.progressiveStep,progressiveThreshold:t.progressiveThreshold,background:t.seriesBackground,invalidType:t.invalidType,seriesField:t.seriesField,morph:t.morph,interactions:t.interactions},h=this.seriesType;return h&&(l.type=h,l[h]=t[h]),e&&e.length&&e.forEach(d=>{l[d]=t[d]}),i&&i.length&&i.forEach(d=>{l[d]=t[d]}),l}forEachRegionInSpec(t,e,i){var r;return((r=t.region)!==null&&r!==void 0?r:[]).map((s,o)=>e(q.getRegionInType("region"),{spec:s,specPath:["region",o],type:"region",regionIndexes:[o]},i))}forEachSeriesInSpec(t,e,i){var r;return((r=t.series)!==null&&r!==void 0?r:[]).map((s,o)=>e(q.getSeriesInType(s.type),{spec:s,specPath:["series",o],type:s.type,seriesIndexes:[o]},i))}forEachComponentInSpec(t,e,i){var r,s,o;const a=[],l=q.getComponents();let h,d,u,c;const g=[];for(let f=0;f<l.length;f++){const{cmp:m,alwaysCheck:v}=l[f];m.type.startsWith(vt.cartesianAxis)?h=m:m.type.startsWith(vt.polarAxis)?d=m:m.type===vt.geoCoordinate?u=m:(v||t[(r=m.specKey)!==null&&r!==void 0?r:m.type])&&(m.type===vt.tooltip?c=m:g.push(m))}let p=!1;if(h){const f=h.getSpecInfo(t,i);(f==null?void 0:f.length)>0&&(p=!0,f.forEach(m=>{const v=q.getComponentInKey(m.type);a.push(e(v,m,i))}))}if(d&&!p){const f=d.getSpecInfo(t,i);(f==null?void 0:f.length)>0&&(p=!0,f.forEach(m=>{const v=q.getComponentInKey(m.type);a.push(e(v,m,i))}))}return u&&!p&&((s=u.getSpecInfo(t,i))===null||s===void 0||s.forEach(f=>{a.push(e(u,f,i))})),g.forEach(f=>{var m;(m=f.getSpecInfo?f.getSpecInfo(t,i):la(t,f.specKey,f.type))===null||m===void 0||m.forEach(v=>{a.push(e(f,v,i))})}),c&&((o=la(t,c.specKey,c.type))===null||o===void 0||o.forEach(f=>{a.push(e(c,f,i))})),a}transformSeriesSpec(t){const e=this._getDefaultSeriesSpec(t);t.series&&t.series.length!==0?t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(r=>{r in i||(i[r]=e[r])})}):t.series=[e]}_findBandAxisBySeries(t,e,i){const r=(t==null?void 0:t.direction)==="horizontal"?["left","right"]:["top","bottom"];return i.find(s=>{if(!r.includes(s.orient))return!1;if(L(s.seriesId)){if(Q(s.seriesId).includes(t==null?void 0:t.id))return!0}else if(L(s.seriesIndex)){if(Q(s.seriesIndex).includes(e))return!0}else if(s.type==="band")return!0;return!0})}_applyAxisBandSize(t,e,i){const{barMaxWidth:r,barMinWidth:s,barWidth:o,barGapInGroup:a}=i;let l=!1;J(s)?(t.minBandSize=s,l=!0):J(o)?(t.minBandSize=o,l=!0):J(r)&&(t.minBandSize=r,l=!0),l&&(t.bandSizeLevel=Number.MAX_VALUE,t.bandSizeExtend={extend:e,gap:V(a)?a[a.length-1]:a})}}class ga extends Eo{needAxes(){return!0}_isValidSeries(t){return!this.seriesType||t===this.seriesType}_getDefaultSeriesSpec(t,e){return super._getDefaultSeriesSpec(t,["xField","yField","zField","direction","stack","percent","stackOffsetSilhouette","totalLabel","sortDataByAxis"],e)}transformSpec(t){super.transformSpec(t),super.transformSeriesSpec(t),this._transformAxisSpec(t)}_setDefaultXAxisSpec(t){return{orient:"bottom"}}_setDefaultYAxisSpec(t){return{orient:"left"}}_setDefaultZAxisSpec(t){return{orient:"z"}}_transformAxisSpec(t){if(this.needAxes()){t.axes||(t.axes=[]);const e={x:!1,y:!1,z:!1};t.axes.forEach(i=>{const{orient:r}=i;let s=null;r!=="top"&&r!=="bottom"||(e.x=!0,s=this._setDefaultXAxisSpec(t)),r!=="left"&&r!=="right"||(e.y=!0,s=this._setDefaultYAxisSpec(t)),r==="z"&&(e.z=!0,s=this._setDefaultZAxisSpec(t)),s&&Object.keys(s).forEach(o=>{D(i[o])&&(i[o]=s[o])}),Dt(i,"trimPadding")&&Nt(i,jit(this.type,t))}),e.x||t.axes.push(this._setDefaultXAxisSpec(t)),e.y||t.axes.push(this._setDefaultYAxisSpec(t)),t.zField&&!e.z&&t.axes.push(this._setDefaultZAxisSpec(t))}}}class cnt extends ga{_getDefaultSeriesSpec(t){var e;const i=super._getDefaultSeriesSpec(t,["point","line","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","lineLabel"]);return i.seriesMark=(e=t.seriesMark)!==null&&e!==void 0?e:"line",i}transformSpec(t){super.transformSpec(t),Jd(t)}}const w4t=(n,t)=>{const e={nodes:{}},{fields:i}=t;if(!(i!=null&&i.length))return e;const r=i.length-1;let s,o,a=e;return n.forEach(l=>{l.latestData&&l.latestData.forEach(h=>{a=e;for(let d=0;d<i.length;d++){const u=i[d],c=h[u];if(D(c))break;a.groupField=u,a.nodes[c]||(d===r?a.nodes[c]={values:[]}:(s={nodes:{}},a.nodes[c]=s)),d===r?(o=a.nodes[c],o.values.push(h)):a=a.nodes[c]}})}),e};class A4t{constructor(t,e){this.stackRegion=({model:i})=>{var r;const s=i.getSeries();if(!s.some(d=>d.getStack()))return;const o=s.some(d=>{var u,c,g,p;return!!(!((c=(u=d.getSpec())===null||u===void 0?void 0:u.totalLabel)===null||c===void 0)&&c.alwayCalculateTotal)||((p=(g=d.getSpec())===null||g===void 0?void 0:g.totalLabel)===null||p===void 0?void 0:p.visible)}),a=o||s.some(d=>d.getPercent()),l=s.some(d=>d.getStackOffsetSilhouette()),h=Wet(i,!0);for(const d in h)for(const u in h[d].nodes)$et(h[d].nodes[u],i.getStackInverse(),a,o);if(l)for(const d in h)for(const u in h[d].nodes)ojt(h[d].nodes[u]);o&&i.getSeries().forEach(d=>{const u=d.getStackData(),c=d.getStackValue(),g=d.getStackValueField();u&&g&&Net(h[c],g)}),!((r=this._options)===null||r===void 0)&&r.afterStackRegion&&this._options.afterStackRegion(i,h)},this._chart=t,this._options=e}init(){this._chart.getAllRegions().forEach(t=>{t.event.on(Ot.regionSeriesDataFilterOver,{filter:({model:e})=>(e==null?void 0:e.id)===t.id},this.stackRegion)})}stackAll(){this._chart.getAllRegions().forEach(t=>{this.stackRegion({model:t})})}}class hl{_beforeInit(){this._dataSet&&Vt(this._dataSet,"stackSplit",w4t)}_initStack(){this._stack=new A4t(this),this._stack.init()}}class rp extends Pi{constructor(){super(...arguments),this.transformerConstructor=cnt,this.type="line",this.seriesType=gt.line}}rp.type="line",rp.seriesType=gt.line,rp.transformerConstructor=cnt,Ye(rp,hl);const M4t=()=>{y4t(),q.registerChart(rp.type,rp)};class k0 extends lnt{constructor(){super(...arguments),this.type=k0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}_getIgnoreAttributes(){return[]}}k0.type="area";const jT=()=>{q.registerMark(k0.type,k0),Q5t(),nnt()};class T4t extends wr{constructor(){super(...arguments),this._getSeriesStyle=(t,e,i)=>{var r,s,o,a;for(const l of Q(e)){let h=(r=this.series.getSeriesStyle(t))===null||r===void 0?void 0:r(l);if(h!==!1||l!=="fill"&&l!=="stroke"||(h=l==="fill"?(o=(s=this.series.getSeriesStyle(t))===null||s===void 0?void 0:s("stroke"))===null||o===void 0?void 0:o[0]:(a=this.series.getSeriesStyle(t))===null||a===void 0?void 0:a("fill")),L(h))return h}return i}}}const gnt=Object.assign(Object.assign(Object.assign({},Hi),Vh),{area:{name:"area",type:"area"}}),k4t=()=>{HGt(),tnt(),FT()};class pnt extends Rb{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){var e,i,r;const s=((e=t.point)===null||e===void 0?void 0:e.visible)!==!1&&((r=(i=t.point)===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.visible)!==!1;this._addMarkLabelSpec(t,o=>{const a=o.position==="inside-middle";return!s||a?"area":"point"}),this._addMarkLabelSpec(t,"area","areaLabel","initLineLabelMarkStyle",void 0,!0)}_transformSpecAfterMergingTheme(t,e,i){var r,s,o,a,l;super._transformSpecAfterMergingTheme(t,e,i);const{area:h={},line:d={},seriesMark:u}=t,c=h.visible!==!1&&((r=h.style)===null||r===void 0?void 0:r.visible)!==!1,g=d.visible!==!1&&((s=d.style)===null||s===void 0?void 0:s.visible)!==!1;h.support3d=!(!h.support3d&&!d.support3d),h.zIndex=L(h.zIndex)||L(d.zIndex)?Math.max((o=h.zIndex)!==null&&o!==void 0?o:0,(a=d.zIndex)!==null&&a!==void 0?a:0):void 0,h.style&&delete h.style.stroke,h.state&&Object.keys(h.state).forEach(m=>{"style"in h.state[m]?delete h.state[m].style.stroke:delete h.state[m].stroke});let p=h,f=d;(u==="line"||g&&!c)&&(p=d,f=h),h.style=Nt({},f.style,p.style),h.state=Nt({},f.state,p.state),h.interactive===!1&&(h.style.fillPickable=!1),d.interactive===!1&&(d.style.strokePickable=!1),h.interactive=!(!h.interactive&&(l=d.interactive)!==null&&l!==void 0&&!l),t.area=h,t.line=d}}class Wl extends Po{constructor(){super(...arguments),this.type=gt.area,this.transformerConstructor=pnt,this._sortDataByAxis=!1}initMark(){var t;const e={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},i=this._spec.area||{},r=(t=this._spec.seriesMark)!==null&&t!==void 0?t:"area",s=this._isAreaVisible()||this._isLineVisible();this._areaMark=this._createMark(Wl.mark.area,{groupKey:this._seriesField,isSeriesMark:s&&r!=="point",stateSort:i.stateSort},Object.assign(Object.assign({},e),{morphElementKey:this.getDimensionField()[0],setCustomizedShape:i.customShape})),this.initSymbolMark(e,r==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initSymbolMarkStyle()}initAreaMarkStyle(){var t,e,i,r,s;const o=(i=(e=(t=this.getSpec().area)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.curveType)!==null&&i!==void 0?i:(s=(r=this.getSpec().line)===null||r===void 0?void 0:r.style)===null||s===void 0?void 0:s.curveType,a=o===ont?this._direction==="horizontal"?"monotoneY":"monotoneX":o,l=this._areaMark;if(l){const h=this._isAreaVisible(),d=this._isLineVisible();h||d?l.setVisible(!0):l.setVisible(!1),this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:u=>{var c,g;return je(this.dataToPositionX1(u),(g=(c=this._xAxisHelper)===null||c===void 0?void 0:c.getScale)===null||g===void 0?void 0:g.call(c,0))},y:this.dataToPositionY.bind(this),y1:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,orient:this._direction},"normal",wt.Series):this.setMarkStyle(this._areaMark,{x:this.dataToPositionX.bind(this),x1:this.dataToPositionX.bind(this),y1:u=>{var c,g;return je(this.dataToPositionY1(u),(g=(c=this._yAxisHelper)===null||c===void 0?void 0:c.getScale)===null||g===void 0?void 0:g.call(c,0))},y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null},"normal",wt.Series),this.setMarkStyle(l,{fill:!!h&&this.getColorAttribute(),stroke:!!d&&this.getColorAttribute()},"normal",wt.Series),this._invalidType!=="zero"&&this.setMarkStyle(l,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",wt.Series),this.getStack()&&this.setMarkStyle(l,{zIndex:u=>-u[Wr]},"normal",wt.Series),this.setMarkStyle(l,{curveType:a},"normal",wt.Built_In),Object.keys(l.stateStyle).forEach(u=>{l.stateStyle[u].stroke&&l.setPostProcess("stroke",c=>[c,!1,!1,!1],u)})}}initAnimation(){var t,e,i,r;const s={direction:this.direction},o=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._lineMark&&this._lineMark.setAnimationConfig(Ae((e=q.getAnimationInKey("line"))===null||e===void 0?void 0:e(s,o),Fe("line",this._spec,this._markAttributeContext))),this._areaMark&&this._areaMark.setAnimationConfig(Ae((i=q.getAnimationInKey("area"))===null||i===void 0?void 0:i(s,o),Fe("area",this._spec,this._markAttributeContext))),this._symbolMark){const a=Qd(this);this._symbolMark.setAnimationConfig(Ae((r=q.getAnimationInKey("scaleInOut"))===null||r===void 0?void 0:r(),Fe("point",this._spec,this._markAttributeContext),a))}}_isAreaVisible(){var t;const e=this._spec.area||{};return e.visible!==!1&&((t=e.style)===null||t===void 0?void 0:t.visible)!==!1}_isLineVisible(){var t;const e=this._spec.line||{};return e.visible!==!1&&((t=e.style)===null||t===void 0?void 0:t.visible)!==!1}initTooltip(){this._tooltipHelper=new T4t(this);const{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._areaMark&&t.add(this._areaMark),this._lineMark&&t.add(this._lineMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t),this.encodeDefined(this._areaMark,"defined")}compile(){super.compile(),this.addSamplingCompile(),this.addOverlapCompile()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}onLayoutEnd(t){super.onLayoutEnd(t),this.reCompileSampling()}getSeriesStyle(t){return e=>{var i,r,s,o,a;const l=(i=this._spec.seriesMark)!==null&&i!==void 0?i:"area";let h=(s=(r=this._seriesMark)===null||r===void 0?void 0:r.getAttribute(e,t))!==null&&s!==void 0?s:void 0;return e!=="fill"||h&&l!=="line"||(e="stroke",h=(a=(o=this._seriesMark)===null||o===void 0?void 0:o.getAttribute(e,t))!==null&&a!==void 0?a:void 0),e==="stroke"&&V(h)?h[0]:h}}}Wl.type=gt.area,Wl.mark=gnt,Wl.transformerConstructor=pnt,Ye(Wl,tH);const R4t=()=>{GF(),xit(),HT(),jT(),vh(),k4t(),vs(),ms(),q.registerSeries(Wl.type,Wl)};class fnt extends ga{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["point","line","area","seriesMark","activePoint","sampling","samplingFactor","pointDis","pointDisMul","markOverlap","areaLabel"])}transformSpec(t){super.transformSpec(t),Jd(t)}}class sp extends Pi{constructor(){super(...arguments),this.transformerConstructor=fnt,this.type="area",this.seriesType=gt.area}}sp.type="area",sp.seriesType=gt.area,sp.transformerConstructor=fnt,Ye(sp,hl);const B4t=()=>{R4t(),q.registerChart(sp.type,sp)};function mnt(n,t=!0){return(e,i,r)=>{const s=n.direction==="vertical"?n.yField:n.xField,o=e==null?void 0:e[s];return n.direction==="vertical"?{overall:t&&n.growFrom(),orient:o>0?"negative":"positive"}:{overall:!!t&&n.growFrom(),orient:o>0?"positive":"negative"}}}const Pb=(n,t=!0)=>({type:n.direction==="horizontal"?"growWidthIn":"growHeightIn",options:mnt(n,t)}),Af=(n,t=!0)=>({type:n.direction==="horizontal"?"growWidthOut":"growHeightOut",options:mnt(n,t)}),P4t={type:"fadeIn"},E4t={type:"growCenterIn"};function vnt(n,t){if(t===!1)return{};switch(t){case"fadeIn":return P4t;case"scaleIn":return E4t;default:return Pb(n)}}const L4t=()=>{q.registerAnimation("bar",(n,t)=>({appear:vnt(n,t),enter:Pb(n,!1),exit:Af(n,!1),disappear:Af(n)}))},I4t=()=>{q.registerAnimation("bar3d",(n,t)=>({appear:vnt(n,t),enter:Pb(n,!1),exit:Af(n,!1),disappear:Af(n)}))};class R0 extends sr{constructor(){super(...arguments),this.type=R0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,lineWidth:0})}}R0.type="rect";const _h=()=>{q.registerMark(R0.type,R0),jF(),ent()},rH=Object.assign(Object.assign({},Hi),{bar:{name:"bar",type:"rect"},barBackground:{name:"barBackground",type:"rect"}}),_nt=Object.assign(Object.assign({},Hi),{bar3d:{name:"bar3d",type:"rect3d"}});function bnt(n,t,e){var i,r;if(n.values.length>0){let s;if(n.sortDatums.length){let o=n.sortDatums;t&&(o=n.sortDatums.slice().reverse());for(let a=0;a<o.length;a++)s=N8(o[a].datum,s,o[a].series,e,(r=(i=o[a].series[e.axisHelper]).getScale)===null||r===void 0?void 0:r.call(i,0),a===0)}else{let o=n.series;t&&(o=o.slice().reverse()),o.forEach(({s:a,values:l},h)=>{var d,u;const c=(u=(d=a[e.axisHelper]).getScale)===null||u===void 0?void 0:u.call(d,0);for(let g=0;g<l.length;g++){const p=l[t?l.length-1-g:g];s=N8(p,s,a,e,c,g===0&&h===0)}})}}for(const s in n.nodes)bnt(n.nodes[s],t,e)}function N8(n,t,e,i,r,s){const o=e.getSpec().barMinHeight,a=e[i.axisHelper].isInverse(),l=je(e[i.startMethod](n),r);let h=je(e[i.endMethod](n),r);s&&(t=l);let d=Math.abs(l-h);d<o&&(d=o);let u=1;return h<l?u=-1:h===l&&(u=i.isVertical?a?1:-1:a?-1:1),h=t+u*d,n[i.start]=t,n[i.end]=h,h}class Eb extends Ar{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar")}}class ea extends Po{constructor(){super(...arguments),this.type=gt.bar,this._barMarkName="bar",this._barMarkType="rect",this.transformerConstructor=Eb,this._bandPosition=0,this._getBarXStart=(t,e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[C8]):this._spec.barMinHeight?this._calculateRectPosition(t,!1,i):je(this._dataToPosX(t),e,i),this._getBarXEnd=(t,e,i)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!1),t[S8]):je(this._dataToPosX1(t),e,i),this._getBarYStart=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[x8]):this._spec.barMinHeight?this._calculateRectPosition(t,!0):je(this._dataToPosY(t),e),this._getBarYEnd=(t,e)=>this._shouldDoPreCalculate()?(this._calculateStackRectPosition(!0),t[w8]):je(this._dataToPosY1(t),e),this._getBarBackgroundXStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundXEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundYStart=t=>{const e=t.range();return Math.min(e[0],e[e.length-1])},this._getBarBackgroundYEnd=t=>{const e=t.range();return Math.max(e[0],e[e.length-1])},this._getBarBackgroundPositionXEncoder=()=>{var t;return(t=this._barBackgroundPositionXEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionXEncoder=t=>{this._barBackgroundPositionXEncoder=t.bind(this)},this._getBarBackgroundPositionYEncoder=()=>{var t;return(t=this._barBackgroundPositionYEncoder)===null||t===void 0?void 0:t.bind(this)},this._setBarBackgroundPositionYEncoder=t=>{this._barBackgroundPositionYEncoder=t.bind(this)}}initMark(){var t,e;this._initBarBackgroundMark(),this._barMark=this._createMark(Object.assign(Object.assign({},ea.mark.bar),{name:this._barMarkName,type:this._barMarkType}),{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.bar)===null||t===void 0?void 0:t.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morphElementKey:this.getDimensionField()[0],morph:ll(this._spec,this._barMarkName),setCustomizedShape:(e=this._spec.bar)===null||e===void 0?void 0:e.customShape})}_initBarBackgroundMark(){this._spec.barBackground&&this._spec.barBackground.visible&&(this._barBackgroundMark=this._createMark(ea.mark.barBackground,{dataView:this._barBackgroundViewData.getDataView(),dataProductId:this._barBackgroundViewData.getProductId(),stateSort:this._spec.barBackground.stateSort},{setCustomizedShape:this._spec.barBackground.customShape,progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold}))}initMarkStyle(){this._barMark&&this.setMarkStyle(this._barMark,{fill:this.getColorAttribute()},"normal",wt.Series)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null})}initTooltip(){super.initTooltip();const{mark:t,group:e}=this._tooltipHelper.activeTriggerSet;this._barMark&&(t.add(this._barMark),e.add(this._barMark))}_statisticViewData(){var t,e;super._statisticViewData();const i=(t=this._spec.barBackground)!==null&&t!==void 0?t:{};if(!i.visible)return;const r=this._getRelatedComponentSpecInfo("axes").some(o=>o.type===vt.cartesianBandAxis);let s;if(Vt(this._option.dataSet,"addVChartProperty",Yf),r){const o=([a],{scaleDepth:l})=>{var h,d;let u=[{}];const c=this.getDimensionField(),g=D(l)?c.length:Math.min(c.length,l);for(let p=0;p<g;p++){const f=c[p],m=(h=a.latestData[f])===null||h===void 0?void 0:h.values;if(!(m!=null&&m.length))continue;const v=[],_=(d=this._spec.dataKey)!==null&&d!==void 0?d:sa;for(let b=0;b<m.length;b++)for(let y=0;y<u.length;y++)v.push(Object.assign(Object.assign({},u[y]),{[f]:m[b],[_]:m[b]}));u=v}return u};Vt(this._option.dataSet,"dimensionItems",o),s=new Ve(this._option.dataSet).parse([this._viewDataStatistics],{type:"dataview"}).transform({type:"dimensionItems",options:{scaleDepth:D(i.fieldLevel)?void 0:i.fieldLevel+1}},!1).transform({type:"addVChartProperty",options:{beforeCall:xf.bind(this),call:Hc}},!1),(e=this._viewDataStatistics)===null||e===void 0||e.target.addListener("change",s.reRunAllTransform)}else{const o=([l])=>{const h=[],[d,u]=this.getDimensionContinuousField(),c={};return a.latestData.forEach(g=>{const p=`${g[d]}-${g[u]}`;c[p]||(c[p]={[d]:g[d],[u]:g[u]},h.push(c[p]))}),h};Vt(this._option.dataSet,"dimensionItems",o);const a=this.getViewData();s=new Ve(this._option.dataSet).parse([a],{type:"dataview"}).transform({type:"dimensionItems"},!1).transform({type:"addVChartProperty",options:{beforeCall:xf.bind(this),call:Hc}},!1),a==null||a.target.addListener("change",s.reRunAllTransform)}this._barBackgroundViewData=new tl(this._option,s)}init(t){var e,i;super.init(t),this.direction==="vertical"?((e=this._xAxisHelper)===null||e===void 0?void 0:e.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle():((i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale(0).type)==="band"?this.initBandRectMarkStyle():this.initLinearRectMarkStyle()}_shouldDoPreCalculate(){const t=this.getRegion();return this.getStack()&&t.getSeries().filter(e=>e.type===this.type&&e.getSpec().barMinHeight).length}_calculateStackRectPosition(t){const e=this.getRegion();if(e._bar_series_position_calculated)return;let i,r,s,o,a;e._bar_series_position_calculated=!0,t?(i=w8,r=x8,s="_dataToPosY1",o="_dataToPosY",a="_yAxisHelper"):(i=S8,r=C8,s="_dataToPosX1",o="_dataToPosX",a="_xAxisHelper");const l=Wet(e,!1,h=>h.type===this.type);for(const h in l)for(const d in l[h].nodes)bnt(l[h].nodes[d],e.getStackInverse(),{isVertical:t,start:i,end:r,startMethod:s,endMethod:o,axisHelper:a})}_calculateRectPosition(t,e,i){var r,s;let o,a,l;e?(o="_dataToPosY1",a="_dataToPosY",l="_yAxisHelper"):(o="_dataToPosX1",a="_dataToPosX",l="_xAxisHelper");const h=(s=(r=this[l]).getScale)===null||s===void 0?void 0:s.call(r,0),d=this[l].isInverse(),u=this._spec.barMinHeight,c=je(this[o](t),h,i),g=je(this[a](t),h,i);let p=Math.abs(c-g);p<u&&(p=u);let f=1;return g<c?f=-1:g===c&&(f=e?d?1:-1:d?-1:1),c+f*p}_dataToPosX(t){return this.dataToPositionX(t)}_dataToPosX1(t){return this.dataToPositionX1(t)}_dataToPosY(t){return this.dataToPositionY(t)}_dataToPosY1(t){return this.dataToPositionY1(t)}initBandRectMarkStyle(){var t,e,i,r;const s=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),o=(r=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||r===void 0?void 0:r.call(i,0);this.direction==="horizontal"?this.setMarkStyle(this._barMark,{x:a=>this._getBarXStart(a,s),x1:a=>this._getBarXEnd(a,s),y:a=>this._getPosition(this.direction,a),height:()=>this._getBarWidth(this._yAxisHelper),width:()=>{},y1:()=>{}},"normal",wt.Series):this.setMarkStyle(this._barMark,{y:a=>this._getBarYStart(a,o),y1:a=>this._getBarYEnd(a,o),x:a=>this._getPosition(this.direction,a),width:()=>this._getBarWidth(this._xAxisHelper),x1:()=>{},height:()=>{}},"normal",wt.Series),this._initStackBarMarkStyle(),this._initBandBarBackgroundMarkStyle()}_initStackBarMarkStyle(){var t,e,i,r;if(!this._spec.stackCornerRadius)return;const s=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),o=(r=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||r===void 0?void 0:r.call(i,0);this._barMark.setMarkConfig({clip:!0,clipPath:()=>{const a=[];return this._forEachStackGroup(l=>{let h=1/0,d=-1/0,u=!1,c=1/0,g=-1/0;l.values.forEach(m=>{const v=m[To],_=m[Wr],b=m[kc],y=m[Od];h=Math.min(h,v,_),d=Math.max(d,v,_),L(b)&&L(y)&&(u=!0,c=Math.min(c,b,y),g=Math.max(g,b,y))});const p=Object.assign(Object.assign(Object.assign({},l.values[0]),{[To]:h,[Wr]:d}),u?{[kc]:c,[Od]:g}:void 0),f=this.direction==="horizontal"?{x:this._getBarXStart(p,s),x1:this._getBarXEnd(p,s),y:this._getPosition(this.direction,p),height:this._getBarWidth(this._yAxisHelper)}:{y:this._getBarYStart(p,o),y1:this._getBarYEnd(p,o),x:this._getPosition(this.direction,p),width:this._getBarWidth(this._xAxisHelper)};a.push(mb(Object.assign(Object.assign({},f),{cornerRadius:it(this._spec.stackCornerRadius)?this._spec.stackCornerRadius(f,p,this._markAttributeContext):this._spec.stackCornerRadius,fill:!0})))}),a}})}initLinearRectMarkStyle(){var t,e,i,r;const s=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),o=(r=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||r===void 0?void 0:r.call(i,0);if(this.direction==="horizontal"){const a=L(this._fieldY2)?{y:l=>je(this._dataToPosY(l),o,!0),y1:l=>je(this._dataToPosY1(l),o,!0)}:{y:l=>je(this._dataToPosY(l)-this._getBarWidth(this._yAxisHelper)/2,o,!0),height:l=>this._getBarWidth(this._yAxisHelper)};this.setMarkStyle(this._barMark,Object.assign({x:l=>this._getBarXStart(l,s,!0),x1:l=>this._getBarXEnd(l,s,!0)},a),"normal",wt.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign({x:()=>this._getBarBackgroundXStart(s),x1:()=>this._getBarBackgroundXEnd(s)},a),"normal",wt.Series)}else{const a=L(this._fieldX2)?{x:l=>je(this._dataToPosX(l),s,!0),x1:l=>je(this._dataToPosX1(l),s,!0)}:{x:l=>je(this._dataToPosX(l)-this._getBarWidth(this._xAxisHelper)/2,s,!0),width:l=>this._getBarWidth(this._xAxisHelper)};this.setMarkStyle(this._barMark,Object.assign(Object.assign({},a),{y:l=>this._getBarYStart(l,o),y1:l=>this._getBarYEnd(l,o)}),"normal",wt.Series),this.setMarkStyle(this._barBackgroundMark,Object.assign(Object.assign({},a),{y:()=>this._getBarBackgroundYStart(o),y1:()=>this._getBarBackgroundYEnd(o)}),"normal",wt.Series)}}_initBandBarBackgroundMarkStyle(){var t,e,i,r,s;if(!this._barBackgroundMark)return;const o=(e=(t=this._xAxisHelper)===null||t===void 0?void 0:t.getScale)===null||e===void 0?void 0:e.call(t,0),a=(r=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||r===void 0?void 0:r.call(i,0),l=(s=this._spec.barBackground)!==null&&s!==void 0?s:{},h=D(l.fieldLevel)?void 0:l.fieldLevel+1;this.direction==="horizontal"?this.setMarkStyle(this._barBackgroundMark,{x:()=>this._getBarBackgroundXStart(o),x1:()=>this._getBarBackgroundXEnd(o),y:d=>this._getPosition(this.direction,d,h,"barBackground"),height:()=>this._getBarWidth(this._yAxisHelper,h),width:()=>{},y1:()=>{}},"normal",wt.Series):this.setMarkStyle(this._barBackgroundMark,{x:d=>this._getPosition(this.direction,d,h,"barBackground"),y:()=>this._getBarBackgroundYStart(a),y1:()=>this._getBarBackgroundYEnd(a),width:()=>this._getBarWidth(this._xAxisHelper,h),x1:()=>{},height:()=>{}},"normal",wt.Series)}initAnimation(){var t,e;const i={yField:this._fieldY[0],xField:this._fieldX[0],direction:this.direction,growFrom:()=>{var o;const a=this.direction==="horizontal"?(o=this._xAxisHelper)===null||o===void 0?void 0:o.getScale(0):this._yAxisHelper.getScale(0);if(a){const l=a.domain(),h=Ri(l),d=Mi(l);return d<0?a.scale(d):h>0?a.scale(h):a.scale(0)}}},r=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset,s=Qd(this);this._barMark.setAnimationConfig(Ae((e=q.getAnimationInKey("bar"))===null||e===void 0?void 0:e(i,r),Fe(this._barMarkName,this._spec,this._markAttributeContext),s))}_getBarWidth(t,e){var i,r;const s=this._groups?this._groups.fields.length:1,o=D(e)?s:Math.min(s,e),a=(r=(i=t.getBandwidth)===null||i===void 0?void 0:i.call(t,o-1))!==null&&r!==void 0?r:6,l=L(this._spec.barWidth)&&o===s,h=L(this._spec.barMinWidth),d=L(this._spec.barMaxWidth);let u=a;return l&&(u=Qg(this._spec.barWidth,a)),h&&(u=Math.max(u,Qg(this._spec.barMinWidth,a))),d&&(u=Math.min(u,Qg(this._spec.barMaxWidth,a))),u}_getPosition(t,e,i,r){var s,o,a,l,h;let d,u,c;t==="horizontal"?(d=this.getYAxisHelper(),u="height",c=r==="barBackground"?this.dataToBarBackgroundPositionY.bind(this):this.dataToPositionY.bind(this)):(d=this.getXAxisHelper(),u="width",c=r==="barBackground"?this.dataToBarBackgroundPositionX.bind(this):this.dataToPositionX.bind(this));const g=d.getScale(0),p=this._groups?this._groups.fields.length:1,f=D(i)?p:Math.min(p,i),m=(o=(s=d.getBandwidth)===null||s===void 0?void 0:s.call(d,f-1))!==null&&o!==void 0?o:6,v=f===p?this._barMark.getAttribute(u,e):m;if(f>1&&L(this._spec.barGapInGroup)){const b=this._groups.fields,y=Q(this._spec.barGapInGroup);let C=0,S=0;for(let w=b.length-1;w>=1;w--){const x=b[w],A=(l=(a=d.getScale(w))===null||a===void 0?void 0:a.domain())!==null&&l!==void 0?l:[],M=A.length,T=Qg((h=y[w-1])!==null&&h!==void 0?h:de(y),m),R=A.indexOf(e[x]);w===b.length-1?(C+=M*v+(M-1)*T,S+=R*(v+T)):(S+=R*(C+T),C+=C+(M-1)*T)}return g.scale(e[b[0]])+d.getBandwidth(0)/2-C/2+S}const _=Je(g.type||"band");return c(e,f)+.5*(m-v)+(_?-m/2:0)}dataToBarBackgroundPositionX(t,e){return this._dataToPosition(t,this._xAxisHelper,this.fieldX,e,this._getBarBackgroundPositionXEncoder,this._setBarBackgroundPositionXEncoder)}dataToBarBackgroundPositionY(t,e){return this._dataToPosition(t,this._yAxisHelper,this.fieldY,e,this._getBarBackgroundPositionYEncoder,this._setBarBackgroundPositionYEncoder)}onLayoutEnd(t){super.onLayoutEnd(t),this.getRegion()._bar_series_position_calculated=!1,this._spec.sampling&&this.compile()}compile(){if(super.compile(),this._spec.sampling){const{width:t,height:e}=this._region.getLayoutRect(),i=[],r=this._fieldY,s=this._fieldX;i.push({type:"sampling",size:this._direction==="horizontal"?e:t,factor:this._spec.samplingFactor,yfield:this._direction==="horizontal"?s[0]:r[0],groupBy:this._seriesField,mode:this._spec.sampling}),this._data.getProduct().transform(i)}}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._barMark]}compileData(){var t;super.compileData(),(t=this._barBackgroundViewData)===null||t===void 0||t.compile()}fillData(){var t,e;super.fillData(),(e=(t=this._barBackgroundViewData)===null||t===void 0?void 0:t.getDataView())===null||e===void 0||e.reRunAllTransform()}viewDataUpdate(t){var e,i,r;super.viewDataUpdate(t),(i=(e=this._barBackgroundViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform(),(r=this._barBackgroundViewData)===null||r===void 0||r.updateData()}release(){var t;super.release(),(t=this._barBackgroundViewData)===null||t===void 0||t.release(),this._barBackgroundViewData=null}}ea.type=gt.bar,ea.mark=rH,ea.transformerConstructor=Eb;const ynt=()=>{GF(),_h(),L4t(),vs(),ms(),q.registerSeries(ea.type,ea)};class NT extends ga{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barMinHeight","sampling","samplingFactor","barBackground","stackCornerRadius"])}transformSpec(t){super.transformSpec(t),Jd(t)}_transformAxisSpec(t){var e,i;if(super._transformAxisSpec(t),!t.axes)return;const r=t.series.some(o=>o.direction==="horizontal"),s=(e=t.axes.find(o=>o.type==="band"))!==null&&e!==void 0?e:t.axes.find(o=>(r?["left","right"]:["top","bottom"]).includes(o.orient));if(s&&!s.bandSize&&!s.maxBandSize&&!s.minBandSize&&t.autoBandSize){const o=kt(t.autoBandSize)&&(i=t.autoBandSize.extend)!==null&&i!==void 0?i:0,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d}=t.series.find(u=>u.type==="bar");this._applyAxisBandSize(s,o,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d})}}}class rd extends Pi{constructor(){super(...arguments),this.transformerConstructor=NT,this.type="bar",this.seriesType=gt.bar}}rd.type="bar",rd.seriesType=gt.bar,rd.transformerConstructor=NT,Ye(rd,hl);const O4t=()=>{ynt(),q.registerChart(rd.type,rd)};class B0 extends sr{constructor(){super(...arguments),this.type=B0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,length:3})}}B0.type="rect3d";const sH=()=>{q.registerMark(B0.type,B0),nNt(),ent()};class Cnt extends Eb{_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar3d")}}class Vv extends ea{constructor(){super(...arguments),this.type=gt.bar3d,this._barMarkName="bar3d",this._barMarkType="rect3d",this.transformerConstructor=Cnt}}Vv.type=gt.bar3d,Vv.mark=_nt,Vv.transformerConstructor=Cnt;const Snt=()=>{I4t(),sH(),vs(),ms(),q.registerSeries(Vv.type,Vv)};class xnt extends NT{_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return e.barWidth=t.barWidth,e.barMaxWidth=t.barMaxWidth,e.barMinWidth=t.barMinWidth,e.barGapInGroup=t.barGapInGroup,e}}const Dd=()=>{dF(),uF(),aIt()},D4t=()=>{SVt(),zGt()};class Gv extends rd{constructor(){super(...arguments),this.transformerConstructor=xnt,this.type="bar3d",this.seriesType=gt.bar3d}}Gv.type="bar3d",Gv.seriesType=gt.bar3d,Gv.transformerConstructor=xnt;const F4t=()=>{Dd(),Snt(),q.registerChart(Gv.type,Gv)},$8=10,H4t=[10,20],z4t=Ui.Linear,V8="circle",W4t=Ui.Ordinal,j4t=["circle","square","triangle","diamond","star"],N4t=(n,t)=>t==="fadeIn"?{type:"fadeIn"}:{type:"scaleIn"},$4t=()=>{q.registerAnimation("scatter",(n,t)=>Object.assign({appear:N4t(0,t)},QF))},V4t=Object.assign(Object.assign({},Hi),{point:{name:"point",type:"symbol"}});class wnt extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"point")}}class vd extends Po{constructor(){super(...arguments),this.type=gt.scatter,this.transformerConstructor=wnt,this._invalidType="zero"}setAttrFromSpec(){super.setAttrFromSpec(),this._size=this._spec.size,this._sizeField=this._spec.sizeField,this._shape=this._spec.shape,this._shapeField=this._spec.shapeField}_getSeriesAttribute(t,e,{defaultScaleType:i,defaultRange:r},s){var o,a,l,h;if(it(e))return e;if(V(e)){if(D(t))return(o=this._option)===null||o===void 0||o.onError(`${s}Field is required.`),e;if(i!=="ordinal"&&e.length>2)return(a=this._option)===null||a===void 0||a.onError(`${s} length is invalid, specify up to 2 ${s}s.`),e;const d=`${Wt}_series_scatter_${this.id}_scale_${s}`;return this._option.globalScale.registerModelScale({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:e}),{scale:d,field:t}}if(kt(e)){if(D(t))return(l=this._option)===null||l===void 0||l.onError(`${s}Field is required.`),e;const d=`${Wt}_series_scatter_${this.id}_scale_${s}`,u=Object.assign({id:d,type:i,domain:[{dataId:this._rawData.name,fields:[t]}],range:r},e);return this._option.globalScale.registerModelScale(u),{scale:u.id,field:t}}return(h=this._option)===null||h===void 0||h.onError(`${s} attribute is invalid.`),e}getSizeAttribute(t,e){return D(e)?$8:J(e)?e:yt(e)&&qat(e)?parseFloat(e):this._getSeriesAttribute(t,e,{defaultScaleType:z4t,defaultRange:H4t},"size")}getShapeAttribute(t,e){return D(e)?V8:yt(e)?e:this._getSeriesAttribute(t,e,{defaultScaleType:W4t,defaultRange:j4t},"shape")}initMark(){var t,e;this._symbolMark=this._createMark(vd.mark.point,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.point)===null||t===void 0?void 0:t.stateSort},{progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold,morph:ll(this._spec,vd.mark.point.name),morphElementKey:this.getDimensionField()[0],setCustomizedShape:(e=this._spec.point)===null||e===void 0?void 0:e.customShape})}initMarkStyle(){this.initSymbolMarkStyle()}initAnimation(){var t,e,i;const r=Qd(this),s=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._symbolMark.setAnimationConfig(Ae((i=q.getAnimationInKey("scatter"))===null||i===void 0?void 0:i({},s),Fe("point",this._spec,this._markAttributeContext),r))}initSymbolMarkStyle(){const t=this._symbolMark;t&&(this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)}),this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),z:this._fieldZ?this.dataToPositionZ.bind(this):null,fill:this.getColorAttribute(),size:J(this._size)||it(this._size)?this._size:$8,symbolType:yt(this._shape)||it(this._shape)?this._shape:V8},Rt.STATE_NORMAL,wt.Series),(L(this._sizeField)||L(this._size))&&this.setMarkStyle(t,{size:this.getSizeAttribute(this._sizeField,this._size)},Rt.STATE_NORMAL,wt.User_Mark),(L(this._shapeField)||L(this._shape))&&this.setMarkStyle(t,{symbolType:this.getShapeAttribute(this._shapeField,this._shape)},Rt.STATE_NORMAL,wt.User_Mark))}initTooltip(){super.initTooltip(),this._symbolMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._symbolMark)}viewDataStatisticsUpdate(t){super.viewDataStatisticsUpdate(t);const e=[this.getDimensionField()[0],this.getStackValueField()].every(i=>{var r,s,o;return i&&((o=(s=(r=this.getViewDataStatistics())===null||r===void 0?void 0:r.latestData)===null||s===void 0?void 0:s[i])===null||o===void 0?void 0:o.allValid)});this._invalidType==="zero"||e?this.setMarkStyle(this._symbolMark,{visible:!0},"normal",wt.Series):this.setMarkStyle(this._symbolMark,{visible:this._getInvalidDefined.bind(this)},"normal",wt.Series),this._symbolMark.getProduct()&&this._symbolMark.compileEncode()}initLabelMarkStyle(t){t&&(this._labelMark=t,this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getStackValueField()],z:this._fieldZ?this.dataToPositionZ.bind(this):null},Rt.STATE_NORMAL,wt.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{visible:this._getInvalidDefined.bind(this)},Rt.STATE_NORMAL,wt.Series))}handleZoom(t){var e,i;this.getMarksWithoutRoot().forEach(s=>{const o=s.getProduct();!o||!o.elements||!o.elements.length||o.elements.forEach((a,l)=>{const h=a.getGraphicItem(),d=a.getDatum(),u=this.dataToPosition(d);u&&h&&h.translateTo(u.x,u.y)})});const r=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct();r&&r.evaluate(null,null)}handlePan(t){this.handleZoom(t)}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._symbolMark]}}vd.type=gt.scatter,vd.mark=V4t,vd.transformerConstructor=wnt;const G4t=()=>{vh(),$4t(),vs(),ms(),q.registerSeries(vd.type,vd)};class Ant extends ga{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["point","size","shape","shapeField","sizeField"])}}class op extends Pi{constructor(){super(...arguments),this.transformerConstructor=Ant,this.type="scatter",this.seriesType=gt.scatter}}op.type="scatter",op.seriesType=gt.scatter,op.transformerConstructor=Ant,Ye(op,hl);const U4t=()=>{G4t(),q.registerChart(op.type,op)};vD();const G8={},oH=["clipAngle","clipExtent","scale","translate","center","rotate","precision","reflectX","reflectY","parallels","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];function Y4t(n,t){return function e(){const i=t();return i.type=n,i.path=vD().projection(i),i.copy=i.copy||function(){const r=e();return oH.forEach(s=>{i[s]&&r[s](i[s]())}),r.path.pointRadius(i.path.pointRadius()),r},i}}function Gh(n,t){n&&yt(n)||ec("Projection type must be a name string.");const e=n.toLowerCase();return arguments.length>1&&(G8[e]=Y4t(e,t)),G8[e]||null}const U8={albers:HZ,albersusa:Gwt,azimuthalequalarea:Uwt,azimuthalequidistant:Ywt,conicconformal:qwt,conicequalarea:l1,conicequidistant:Qwt,equalEarth:eAt,equirectangular:Zwt,gnomonic:iAt,identity:nAt,mercator:Xwt,naturalEarth1:rAt,orthographic:sAt,stereographic:oAt,transversemercator:aAt};Object.keys(U8).forEach(n=>{Gh(n,U8[n])});const Y8="Feature",Mnt="FeatureCollection";function X4t(n){return n.type===Mnt?n.features:Q(n).filter(t=>!D(t)).map(t=>t.type===Y8?t:{type:Y8,geometry:t})}function K4t(n){const t=Q(n);return t.length===1?t[0]:{type:Mnt,features:t.reduce((e,i)=>e.concat(X4t(i)),[])}}function q4t(n){const t=Gh((n||"mercator").toLowerCase());return t||ec("Unrecognized projection type: "+n),t()}function Z4t(n,t,e){it(n[t])&&n[t](e)}const J4t=oH.concat(["pointRadius","fit","extent","size"]);function X8(n,t){let e=[];return n&&Object.keys(n).forEach(i=>{J4t.includes(i)&&(e=e.concat(vr(n[i],t)))}),e}let Q4t=class extends AT{constructor(t){super(t),this.grammarType="projection"}parse(t){return super.parse(t),this.pointRadius(t.pointRadius),this.size(t.size),this.extent(t.extent),this.fit(t.fit),this.configure(t),this.commit(),this}pointRadius(t){return D(this.spec.pointRadius)||this.detach(vr(this.spec.pointRadius,this.view)),this.spec.pointRadius=t,this.attach(vr(t,this.view)),this.commit(),this}size(t){return D(this.spec.size)||this.detach(vr(this.spec.size,this.view)),this.spec.size=t,this.attach(vr(t,this.view)),this.commit(),this}extent(t){return D(this.spec.extent)||this.detach(vr(this.spec.extent,this.view)),this.spec.extent=t,this.attach(vr(t,this.view)),this.commit(),this}fit(t){return D(this.spec.fit)||this.detach(vr(this.spec.fit,this.view)),this.spec.fit=t,this.attach(vr(t,this.view)),this.commit(),this}configure(t){return this.detach(X8(this.spec,this.view)),D(t)?this.spec={type:this.spec.type,fit:this.spec.fit,extent:this.spec.extent,size:this.spec.size,pointRadius:this.spec.pointRadius}:(Object.assign(this.spec,t),this.attach(X8(this.spec,this.view))),this.commit(),this}evaluate(t,e){if(this.projection&&this.projection.type===this.spec.type||(this.projection=q4t(this.spec.type),this.projection.type=this.spec.type),oH.forEach(i=>{D(this.spec[i])||Z4t(this.projection,i,Mn(this.spec[i],e,Gh))}),D(this.spec.pointRadius)||this.projection.path.pointRadius(Mn(this.spec.pointRadius,e,Gh)),!(D(this.spec.fit)||D(this.spec.extent)&&D(this.spec.size))){const i=K4t(Mn(this.spec.fit,e,Gh));this.spec.extent?this.projection.fitExtent(Mn(this.spec.extent,e,Gh),i):this.spec.size&&this.projection.fitSize(Mn(this.spec.size,e,Gh),i)}return this.projection}output(){return this.projection}};const t6t=()=>{dt.registerGrammar("projection",Q4t,"projections")},e6t=(n,t)=>{if(!t.from||!t.from())return n;const e=t.fields,i=t.key,r=t.values,s=t.default,o=t.as||[e],a=t.from().reduce(function(h,d){return d[e]&&h.set(d[e],d),h},new Map);let l;if(it(t.set))l=function(h){const d=a.get(h[i]);t.set(h,d)};else if(r){const h=r.length;l=function(d){const u=a.get(d[i]);if(D(u))for(let c=0;c<h;++c)d[o[c]]=s;else for(let c=0;c<h;++c)d[o[c]]=u[r[c]]}}else l=function(h){const d=a.get(h[i]);h[o[0]]=L(d)?d:s};return n.length===0?[]:n.map(h=>(l(h),h))};class i6t extends zc{constructor(){super(...arguments),this.type=gt.geo,this.coordinate="geo",this._nameProperty="name"}getMapViewData(){var t;return(t=this._mapViewData)===null||t===void 0?void 0:t.getDataView()}get nameField(){return this._nameField}set nameField(t){this._nameField=t}get valueField(){return this._valueField}set valueField(t){this._valueField=t}getNameProperty(){return this._nameProperty}getCentroidProperty(){return this._centroidProperty}getCoordinateHelper(){return this._coordinateHelper}setCoordinateHelper(t){this._coordinateHelper=t}getStatisticFields(){const t=[];return t.push({key:this._nameField,operations:["values"]}),t.push({key:this._valueField,operations:["max","min"]}),t}getGroupFields(){return null}dataToPosition(t,e){var i;let r=null;if(!t||e&&!this.isDatumInViewData(t))return r;const{dataToPosition:s,latitudeField:o,longitudeField:a}=this._coordinateHelper;if(r=this.nameToPosition(t),r===null){const l=a?t==null?void 0:t[a]:Number.NaN,h=o?t==null?void 0:t[o]:Number.NaN;r=(i=s==null?void 0:s([l,h]))!==null&&i!==void 0?i:null}return r}nameToPosition(t){const e=this.getDatumName(t);return D(e)?null:this.nameValueToPosition(e)}nameValueToPosition(t){var e,i;const r=(i=(e=this.getMapViewData())===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.filter(l=>this.getDatumName(l)===t)[0];if(D(r))return null;const{dataToPosition:s}=this._coordinateHelper,o=this.getDatumCenter(r),a=s==null?void 0:s(o);return D(a)||isNaN(a.x)||isNaN(a.y)?null:a}dataToLatitude(t){if(!this._coordinateHelper)return Number.NaN;const{dataToLatitude:e}=this._coordinateHelper;return e(t)}dataToLongitude(t){if(!this._coordinateHelper)return Number.NaN;const{dataToLatitude:e}=this._coordinateHelper;return e(t)}valueToPosition(t,e){return{x:this.dataToLongitude(t),y:this.dataToLatitude(e)}}positionToData(t){}latitudeToData(t){}longitudeToData(t){}dataToPositionX(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}dataToPositionY(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}dataToPositionZ(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}release(){super.release(),this._mapViewData.release(),this._mapViewData=this._mapViewDataStatistics=null}getStackGroupFields(){return[this._nameField]}getStackValueField(){return this._spec.valueField}compileData(){var t;(t=this._mapViewData)===null||t===void 0||t.compile()}initStatisticalData(){if(super.initStatisticalData(),this._mapViewData){const t=`${Wt}_series_${this.id}_mapViewDataStatic`;this._mapViewDataStatistics=this.createStatisticalData(t,this._mapViewData.getDataView()),this._mapViewData.getDataView().target.removeListener("change",this._mapViewDataStatistics.reRunAllTransform)}}getSeriesKeys(){var t,e,i,r,s;return this._seriesField?(s=(e=(t=this.getRawDataStatisticsByField(this._seriesField))===null||t===void 0?void 0:t.values)!==null&&e!==void 0?e:(r=(i=this._mapViewDataStatistics)===null||i===void 0?void 0:i.latestData[this._seriesField])===null||r===void 0?void 0:r.values)!==null&&s!==void 0?s:[]:this.name?[this.name]:this.userId?[`${this.userId}`]:[`${this.type}_${this.id}`]}fillData(){var t,e;super.fillData(),(t=this._mapViewData.getDataView())===null||t===void 0||t.reRunAllTransform(),(e=this._mapViewDataStatistics)===null||e===void 0||e.reRunAllTransform()}getActiveMarks(){return[]}}const sA=`${Wt}_MAP_LOOK_UP_KEY`,n6t=(n,t)=>(n.features&&n.features.forEach((e,i)=>{var r;e[rr]=i;const s=(r=e.properties)===null||r===void 0?void 0:r[t.nameProperty];t.nameMap&&t.nameMap[s]?e[sA]=t.nameMap[s]:e[sA]=s}),n.features);class r6t extends wr{constructor(){super(...arguments),this.dimensionTooltipTitleCallback=t=>{var e;const i=this.series;return(e=this._getDimensionData(t))!==null&&e!==void 0?e:i.getDatumName(t)}}}class P0 extends sr{constructor(){super(...arguments),this.type=P0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0,path:""})}}P0.type="path";const aH=()=>{q.registerMark(P0.type,P0),lit()},s6t=Object.assign(Object.assign({},Hi),{area:{name:"area",type:"path"}});class o6t{constructor(t){this.projection=Gh(t.type)()}fit(t,e,i){const r={type:"FeatureCollection",features:i};this.projection.fitExtent([t,e],r)}center(t){var e,i;(i=(e=this.projection)===null||e===void 0?void 0:e.center)===null||i===void 0||i.call(e,t)}project(t){var e;return(e=this.projection)===null||e===void 0?void 0:e.call(this,t)}shape(t){var e,i;return(i=(e=this.projection)===null||e===void 0?void 0:e.path)===null||i===void 0?void 0:i.call(e,t)}invert(t){var e,i;return(i=(e=this.projection)===null||e===void 0?void 0:e.invert)===null||i===void 0?void 0:i.call(e,t)}scale(t){var e;if(!((e=this.projection)===null||e===void 0)&&e.scale){if(t===void 0)return this.projection.scale();this.projection.scale(t)}}translate(t){var e;if(!((e=this.projection)===null||e===void 0)&&e.scale){if(t===void 0)return this.projection.translate();this.projection.translate(t)}}evaluate(t,e,i){const r=this.projection.copy();return r==null?void 0:r.fitExtent([t,e],{type:"FeatureCollection",features:i})}}class a6t{parserScrollEvent(t){return t&&!(t.ctrlKey||t.deltaY===0&&t.deltaX===0)&&(t.scrollX=t.deltaX,t.scrollY=t.deltaY,t)}parserZoomEvent(t){if(!t)return t;const e=Math.pow(1.0005,-t.deltaY*Math.pow(16,t.deltaMode));return t.zoomDelta=e,t.zoomX=t.canvasX,t.zoomY=t.canvasY,t}clearZoom(){}clearScroll(){}clearDrag(){}}class l6t{constructor(){this._lastScale=0}clearZoom(){this._lastScale=0}parserZoomEvent(t){const e=t.scale;if(this._lastScale===0)return this._lastScale=e,t;t.zoomDelta=e/this._lastScale;const i=t.center;return t.zoomX=i.x,t.zoomY=i.y,this._lastScale=e,t}parserScrollEvent(t){return t}clearScroll(){}clearDrag(){}}function Tl(n){return n===an["desktop-browser"]||n===an["desktop-miniApp"]?{start:"pointerdown",move:"pointermove",end:["pointerup","pointerupoutside"],zoom:"wheel",zoomEnd:"pointerup",scroll:"wheel",trigger:a6t}:Pd(n)||Yd(n)?{start:"pointerdown",move:"pointermove",end:["pointerup","pointerupoutside","pointerleave"],zoom:"pinch",zoomEnd:"pinchend",scroll:"pan",scrollEnd:"panend",trigger:l6t}:null}const bg={debounce:ah,throttle:ha};class lH{constructor(){this._isGestureListener=!1}initZoomable(t,e=an["desktop-browser"]){this._eventObj=t,this._renderMode=e,this._gestureController=this._option.getChart().getVGrammarView().renderer._gestureController,this._isGestureListener=Pd(this._renderMode)||Yd(this._renderMode),Tl(this._renderMode)&&(this._clickEnable=!0,this._zoomableTrigger=new(this._getZoomTriggerEvent("trigger")))}_getZoomTriggerEvent(t){return Tl(this._renderMode)[t]}_zoomEventDispatch(t,e,i,r){if(!this._isGestureListener&&!t.event)return;const s=this._isGestureListener?t:t.event.clone();this._zoomableTrigger.parserZoomEvent(s);const{zoomDelta:o,zoomX:a,zoomY:l,path:h}=s;if(!r&&!h.some(u=>u.name&&u.name.includes("region"))||D(o)||!vp({x:a,y:l},this._getRegionOrSeriesLayout(e),!1))return;this._clearDragEvent(),this._zoomableTrigger.clearScroll();let d={};i&&(d=i({zoomDelta:o,zoomX:a,zoomY:l},s)),this._eventObj.emit("zoom",Object.assign(Object.assign({scale:s.zoomDelta,scaleCenter:{x:s.zoomX,y:s.zoomY}},d),{model:this}))}_getRegionOrSeriesLayout(t){t.type!=="region"&&(t=t.getRegion());const{x:e,y:i,width:r,height:s}=t.layout.getLayout();return{x1:e,y1:i,x2:e+r,y2:i+s}}_bindZoomEventAsRegion(t,e,i,r){var s,o;const a=(s=r==null?void 0:r.delayType)!==null&&s!==void 0?s:"throttle",l=(o=r==null?void 0:r.delayTime)!==null&&o!==void 0?o:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("zoom")]:[this._getZoomTriggerEvent("zoom"),{level:mi.chart,consume:!0}],u=this._isGestureListener?[this._getZoomTriggerEvent("zoomEnd")]:[this._getZoomTriggerEvent("zoomEnd"),{level:mi.chart,consume:!1}];h.on(...u,bg[a](c=>{this._zoomableTrigger.clearZoom()},l)),h.on(...d,bg[a](c=>{var g;this._zoomEventDispatch(c,e,i,(g=r==null?void 0:r.allowComponentZoom)!==null&&g!==void 0&&g)},l))}initZoomEventOfSeries(t,e,i){this._option.disableTriggerEvent||Tl(this._renderMode)&&this._bindZoomEventAsRegion(t.event,t,e,i)}initZoomEventOfRegions(t,e,i,r){this._option.disableTriggerEvent||Tl(this._renderMode)&&t.forEach(s=>{e?s.getSeries().forEach(o=>{e(o)&&this._bindZoomEventAsRegion(o.event,o,i,r)}):this._bindZoomEventAsRegion(this._eventObj,s,i,r)})}_scrollEventDispatch(t,e,i){let r=!1;if(!this._isGestureListener&&(!t.event||this._option.disableTriggerEvent))return r;const s=this._isGestureListener?t:t.event;this._zoomableTrigger.parserScrollEvent(s);const{scrollX:o,scrollY:a,canvasX:l,canvasY:h}=s;return D(o)&&D(a)||vp({x:l,y:h},this._getRegionOrSeriesLayout(e),!1)&&(this._clearDragEvent(),this._zoomableTrigger.clearZoom(),i&&(r=i({scrollX:o,scrollY:a},s)),this._eventObj.emit("scroll",{scrollX:o,scrollY:a,model:this})),r}_bindScrollEventAsRegion(t,e,i,r){var s,o;const a=(s=r==null?void 0:r.delayType)!==null&&s!==void 0?s:"throttle",l=(o=r==null?void 0:r.delayTime)!==null&&o!==void 0?o:0,h=this._isGestureListener?this._gestureController:t,d=this._isGestureListener?[this._getZoomTriggerEvent("scroll")]:[this._getZoomTriggerEvent("scroll"),{level:mi.chart,consume:!0}],u=this._isGestureListener?[this._getZoomTriggerEvent("scrollEnd")]:[this._getZoomTriggerEvent("scrollEnd"),{level:mi.chart,consume:!1}];h.on(...u,bg[a](c=>{this._zoomableTrigger.clearScroll()},l)),h.on(...d,bg[a](c=>this._scrollEventDispatch(c,e,i),l))}initScrollEventOfSeries(t,e,i){Tl(this._renderMode)&&this._bindScrollEventAsRegion(t.event,t,e,i)}initScrollEventOfRegions(t,e,i,r){this._option.disableTriggerEvent||Tl(this._renderMode)&&t.forEach(s=>{e?s.getSeries().forEach(o=>{e(o)&&this._bindScrollEventAsRegion(o.event,o,i,r)}):this._bindScrollEventAsRegion(this._eventObj,s,i,r)})}_bindDragEventAsRegion(t,e,i,r){t.on(this._getZoomTriggerEvent("start"),{level:mi.chart},s=>{if(!s.event)return;const{event:o}=s;vp({x:o.canvasX,y:o.canvasY},this._getRegionOrSeriesLayout(e),!1)&&this._handleDrag(s,i,r)}),t.on("click",{level:mi.chart},()=>!this._clickEnable)}initDragEventOfSeries(t,e,i){this._option.disableTriggerEvent||Tl(this._renderMode)&&t.event.on(this._getZoomTriggerEvent("start"),{level:mi.model,filter:({model:r})=>(r==null?void 0:r.id)===t.id},r=>{this._handleDrag(r,e,i)})}initDragEventOfRegions(t,e,i,r){this._option.disableTriggerEvent||Tl(this._renderMode)&&t.forEach(s=>{e?s.getSeries().forEach(o=>{e(o)&&(o.event.on(this._getZoomTriggerEvent("start"),{level:mi.model,filter:({model:a})=>(a==null?void 0:a.id)===o.id},a=>{this._handleDrag(a,i)}),o.event.on("click",{level:mi.model,filter:({model:a})=>(a==null?void 0:a.id)===o.id},()=>!this._clickEnable))}):this._bindDragEventAsRegion(this._eventObj,s,i,r)})}_clearDragEvent(){const t=this._getZoomTriggerEvent("move"),e=this._getZoomTriggerEvent("end");this._handleDragMouseMove&&(this._eventObj.off(t,{level:mi.chart,source:Ee.chart},this._handleDragMouseMove),this._handleDragMouseMove=void 0),this._handleDragMouseUp&&(e.forEach(i=>{this._eventObj.off(i,{level:mi.chart,source:Ee.chart},this._handleDragMouseUp),this._eventObj.allow(i)}),this._handleDragMouseUp=void 0)}isDragEnable(t){if(this._isGestureListener&&this._gestureController){const e=this._gestureController.cachedEvents;return!e||e.length<2}return!0}_handleDrag(t,e,i){var r,s,o;if(this._clearDragEvent(),this._option.disableTriggerEvent||(this._clickEnable=!1,!this.isDragEnable(t.event)))return;this._zoomableTrigger.clearZoom(),this._zoomableTrigger.clearScroll();const a=(r=i==null?void 0:i.delayType)!==null&&r!==void 0?r:"throttle",l=(s=i==null?void 0:i.delayTime)!==null&&s!==void 0?s:0,h=(o=i==null?void 0:i.realTime)===null||o===void 0||o,d=this._getZoomTriggerEvent("move"),u=this._getZoomTriggerEvent("end"),c=t.event;let g=c.canvasX,p=c.canvasY,f=c.canvasX,m=c.canvasY;this._handleDragMouseUp=bg[a](v=>{this._clickEnable=!0;const _=v.event,b=[_.canvasX-f,_.canvasY-m];f=_.canvasX,m=_.canvasY,!h&&e&&e(b,v.event),this._eventObj.emit("panend",{delta:b,model:this}),this._clearDragEvent()},l),this._handleDragMouseMove=bg[a](v=>{if(!this.isDragEnable(v.event))return;this._clickEnable=!1,u.forEach(y=>{this._eventObj.prevent(y,{handler:this._handleDragMouseUp,level:mi.chart})});const _=v.event,b=[_.canvasX-g,_.canvasY-p];g=_.canvasX,p=_.canvasY,h&&e&&e(b,v.event),this._eventObj.emit("panmove",{delta:b,model:this})},l),this._eventObj.on(d,{level:mi.chart,source:Ee.chart},this._handleDragMouseMove),u.forEach(v=>{this._eventObj.on(v,{level:mi.chart,source:Ee.chart},this._handleDragMouseUp)})}}function h6t(n,t){return`${Wt}_${t}_${n}`}class oA extends $r{constructor(){super(...arguments),this.type=vt.geoCoordinate,this.name=vt.geoCoordinate,this.layoutType="none",this.layoutZIndex=Qe.Mark,this._projectionSpec={name:h6t(this.type,this.id),type:"mercator"},this._actualScale=1,this._initialScale=1,this.effect={scaleUpdate:()=>{this.coordinateHelper()}},this._handleChartZoom=(t,e)=>{var i,r,s,o,a,l;let h=t.zoomDelta;const d=this._actualScale;return this._actualScale*=h,this._actualScale<((i=this._spec.zoomLimit)===null||i===void 0?void 0:i.min)?(this._actualScale=(r=this._spec.zoomLimit)===null||r===void 0?void 0:r.min,h=((s=this._spec.zoomLimit)===null||s===void 0?void 0:s.min)/d):this._actualScale>((o=this._spec.zoomLimit)===null||o===void 0?void 0:o.max)&&(this._actualScale=(a=this._spec.zoomLimit)===null||a===void 0?void 0:a.max,h=((l=this._spec.zoomLimit)===null||l===void 0?void 0:l.max)/d),this.zoom(h,[t.zoomX,t.zoomY]),{scale:h,totalScale:this._actualScale}},this.pan=(t=[0,0])=>{var e,i,r;const s=(i=(e=this._projection)===null||e===void 0?void 0:e.translate())!==null&&i!==void 0?i:[0,0];let o=s[0],a=s[1];o+=t[0],a+=t[1],(r=this._projection)===null||r===void 0||r.translate([o,a])}}get longitudeField(){return this._longitudeField}get latitudeField(){return this._latitudeField}get projectionSpec(){return this._projectionSpec}setProjection(t){this._projectionSpec=Object.assign(Object.assign({},t),{name:this._projectionSpec.name})}getZoom(){return this._actualScale}static getSpecInfo(t){if(D(t))return null;const e=[];return t.region.forEach((i,r)=>{if(i.coordinate==="geo"){const s=Object.assign(Object.assign({},i),{padding:0});e.push({spec:s,regionIndex:r,type:vt.geoCoordinate,specInfoPath:["component","geoCoordinate",r]})}}),e}setAttrFromSpec(){var t,e,i;super.setAttrFromSpec(),this._spec.roam&&this.initZoomable(this.event,this._option.mode),this._projectionSpec=Nt(this._projectionSpec,this._spec.projection),this._projectionSpec.zoom>((t=this._spec.zoomLimit)===null||t===void 0?void 0:t.max)&&(this._projectionSpec.zoom=this._spec.zoomLimit.max),this._projectionSpec.zoom<((e=this._spec.zoomLimit)===null||e===void 0?void 0:e.min)&&(this._projectionSpec.zoom=this._spec.zoomLimit.min),this._actualScale=(i=this._projectionSpec.zoom)!==null&&i!==void 0?i:1,this._initialScale=this._actualScale,this._longitudeField=this._spec.longitudeField,this._latitudeField=this._spec.latitudeField}created(){super.created(),this._regions=this._option.getRegionsInIndex([this._option.regionIndex]),this.initProjection(),this.coordinateHelper(),this.initEvent(),this._initCenterCache()}dispatchZoom(t,e){const i=e||{x:this.getLayoutStartPoint().x+this.getLayoutRect().width/2,y:this.getLayoutStartPoint().y+this.getLayoutRect().height/2},{scale:r,totalScale:s}=this._handleChartZoom({zoomDelta:t,zoomX:i.x,zoomY:i.y});r!==1&&this.event.emit("zoom",{scale:r,scaleCenter:i,totalScale:s,model:this})}initEvent(){this.event.on(Ot.scaleUpdate,{filter:({model:e})=>(e==null?void 0:e.id)===this.id},this.effect.scaleUpdate.bind(this));const{roam:t}=this._spec;t&&(this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom),this.initDragEventOfRegions(this._regions,t.blank?null:()=>!0,this.pan),this._regions.forEach(e=>{e.getSeries().forEach(i=>{i.event.on("zoom",r=>(i.handleZoom(r),!0)),i.event.on("panmove",r=>(i.handlePan(r),!0))})}))}initProjection(){var t;this._projection=new o6t(this._projectionSpec),this._projection.projection!==null||(t=this._option)===null||t===void 0||t.onError("unsupported projection type!")}coordinateHelper(){const t={longitudeField:this._longitudeField,latitudeField:this._latitudeField,dataToPosition:this.dataToPosition.bind(this),dataToLongitude:this.dataToLongitude.bind(this),dataToLatitude:this.dataToLatitude.bind(this),shape:this.shape.bind(this),getCoordinateId:()=>this.id};this._regions.forEach(e=>{e.getSeries().forEach(i=>{i.type===gt.map||i.type===gt.pictogram?i.setCoordinateHelper(t):(i.setXAxisHelper(Object.assign(Object.assign({},t),{isContinuous:!0,dataToPosition:(r,s)=>{var o;let a=r[0];if(D(a)&&(s!=null&&s.datum)){const l=s.datum[i.getDimensionField()[0]];a=(o=this._centerCache.get(l))===null||o===void 0?void 0:o.x}return this.dataToLongitude(a)},valueToPosition:(r,s)=>{var o;if(D(r)&&(s!=null&&s.datum)){const a=s.datum[i.getDimensionField()[0]];r=(o=this._centerCache.get(a))===null||o===void 0?void 0:o.x}return this.dataToLongitude(r)},getFields:()=>[this._longitudeField],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>!1})),i.setYAxisHelper(Object.assign(Object.assign({},t),{isContinuous:!0,dataToPosition:(r,s)=>{var o;let a=r[0];if(D(a)&&(s!=null&&s.datum)){const l=s.datum[i.getDimensionField()[0]];a=(o=this._centerCache.get(l))===null||o===void 0?void 0:o.y}return this.dataToLatitude(a)},valueToPosition:(r,s)=>{var o;if(D(r)&&(s!=null&&s.datum)){const a=s.datum[i.getDimensionField()[0]];r=(o=this._centerCache.get(a))===null||o===void 0?void 0:o.y}return this.dataToLatitude(r)},getFields:()=>[this._latitudeField],getAxisType:()=>this.type,getAxisId:()=>this.id,isInverse:()=>!1})))})})}onLayoutEnd(t){this.setLayoutRect(this._regions[0].getLayoutRect()),this.setLayoutStartPosition(this._regions[0].getLayoutStartPoint());const{width:e,height:i}=this.getLayoutRect(),{translate:r,scale:s,center:o}=this.evaluateProjection([0,0],[e,i]);r&&this._projection.translate(r),s&&this._projection.scale(s),o&&this._projection.center(o),Oi(this._regions,a=>{var l,h;if(a.type===gt.map||a.type===gt.pictogram){(l=a.areaPath)===null||l===void 0||l.clear();const d=(h=a.getRootMark().getProduct())===null||h===void 0?void 0:h.getGroupGraphicItem();d&&d.attribute.postMatrix&&d.setAttributes({postMatrix:new Pe})}}),this._actualScale=this._initialScale,super.onLayoutEnd(t)}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}collectFeatures(){const t=[];return this._regions.forEach(e=>{e.getSeries().forEach(i=>{var r,s;i.type!==gt.map&&i.type!==gt.pictogram||t.push(...(s=(r=i.getMapViewData())===null||r===void 0?void 0:r.latestData)!==null&&s!==void 0?s:[])})}),t}dataToPosition(t=[]){var e;const i=(e=this._projection)===null||e===void 0?void 0:e.project([t[0],t[1]]);return{x:i==null?void 0:i[0],y:i==null?void 0:i[1]}}dataToLatitude(t){var e;const i=(e=this._projection)===null||e===void 0?void 0:e.project([0,t]);return i==null?void 0:i[1]}dataToLongitude(t){var e;const i=(e=this._projection)===null||e===void 0?void 0:e.project([t,0]);return i==null?void 0:i[0]}zoom(t,e=[0,0]){var i,r,s,o,a,l;let h=(r=(i=this._projection)===null||i===void 0?void 0:i.scale())!==null&&r!==void 0?r:0;const d=(o=(s=this._projection)===null||s===void 0?void 0:s.translate())!==null&&o!==void 0?o:[0,0];let u=d[0],c=d[1];h*=t,u-=(e[0]-u)*(t-1),c-=(e[1]-c)*(t-1),(a=this._projection)===null||a===void 0||a.scale(h),(l=this._projection)===null||l===void 0||l.translate([u,c])}shape(t){return this._projection.shape(t)}invert(t){return this._projection.invert(t)}evaluateProjection(t,e){var i;const r=this._projection.evaluate(t,e,this.collectFeatures());let s=r.translate();const o=r.scale()*this._initialScale,a=(i=this._projectionSpec.center)!==null&&i!==void 0?i:r.invert([e[0]/2,e[1]/2]);return a&&(s=[e[0]/2,e[1]/2]),{translate:s,scale:o,center:a}}_initCenterCache(){this._centerCache||(this._centerCache=new Map),this._regions.forEach(t=>{t.getSeries().forEach(e=>{var i,r;e.type==="map"&&((r=(i=e.getMapViewData())===null||i===void 0?void 0:i.latestData)!==null&&r!==void 0?r:[]).forEach((s={})=>{const o=s[e.getDimensionField()[0]]||s[sA],a=e.getDatumCenter(s);o&&L(a)&&this._centerCache.set(o,{x:a[0],y:a[1]})})})})}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||(i.reMake=["roam","longitudeField","latitudeField","projection","zoomLimit"].some(r=>!Oe(e==null?void 0:e[r],t[r]))),i}release(){super.release(),this._centerCache&&this._centerCache.clear(),this._centerCache=null}}oA.type=vt.geoCoordinate,Ye(oA,lH);const Tnt=()=>{q.registerComponent(oA.type,oA)};class knt extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"area",void 0,void 0,!1)}}class _d extends i6t{constructor(){super(...arguments),this.type=gt.map,this.transformerConstructor=knt,this._areaCache=new Map}getNameMap(){return this._nameMap}get areaPath(){return this._areaCache}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this.map=this._spec.map,this._nameMap=this._spec.nameMap,this._nameField=this._spec.nameField,this._valueField=this._spec.valueField,this._spec.nameProperty&&(this._nameProperty=this._spec.nameProperty),this._spec.centroidProperty&&(this._centroidProperty=this._spec.centroidProperty),this.map||(t=this._option)===null||t===void 0||t.onError(`map type '${this.map}' is not specified !`),Dc.get(this.map)||(e=this._option)===null||e===void 0||e.onError(`'${this.map}' data is not registered !`)}initData(){var t,e;super.initData(),Vt(this._dataSet,"copyDataView",BT),Vt(this._dataSet,"map",n6t),Vt(this._dataSet,"lookup",e6t);const i=Dc.get(this.map);i||(t=this._option)===null||t===void 0||t.onError("no valid map data found!");const r=new Ve(this._dataSet,{name:`map_${this.id}_data`});r.parse([i],{type:"dataview"}).transform({type:"copyDataView",options:{deep:!0},level:oa.copyDataView}).transform({type:"map",options:{nameMap:this._nameMap,nameProperty:this._nameProperty}}).transform({type:"lookup",options:{from:()=>{var s;return(s=this._data)===null||s===void 0?void 0:s.getLatestData()},key:sA,fields:this._nameField,set:(s,o)=>{o&&Object.keys(o).forEach(a=>{a in s||(s[a]=o[a])})}}}),(e=this._data)===null||e===void 0||e.getDataView().target.addListener("change",r.reRunAllTransform),this._mapViewData=new tl(this._option,r)}compileData(){var t;super.compileData(),(t=this._mapViewData)===null||t===void 0||t.compile()}initMark(){this._pathMark=this._createMark(_d.mark.area,{groupKey:this.getDimensionField()[0],isSeriesMark:!0,skipBeforeLayouted:!0,dataView:this._mapViewData.getDataView(),dataProductId:this._mapViewData.getProductId()},{morph:ll(this._spec,_d.mark.area.name),morphElementKey:this.getDimensionField()[0]})}initMarkStyle(){const t=this._pathMark;t&&(this.setMarkStyle(t,{fill:e=>{var i,r,s,o;return L(e[(i=this._seriesField)!==null&&i!==void 0?i:Fr])?((r=this._option.globalScale.getScale("color"))!==null&&r!==void 0?r:this._getDefaultColorScale()).scale(e[(s=this._seriesField)!==null&&s!==void 0?s:Fr]):(o=this._spec)===null||o===void 0?void 0:o.defaultFillColor},path:this.getPath.bind(this)},"normal",wt.Series),t.setPostProcess("fill",e=>L(e)?e:this._spec.defaultFillColor),this.setMarkStyle(t,{smoothScale:!0},"normal",wt.Built_In))}initLabelMarkStyle(t){t&&(this._labelMark=t,this.setMarkStyle(t,{text:e=>this.getDatumName(e),x:e=>{var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.x},y:e=>{var i;return(i=this.dataToPosition(e))===null||i===void 0?void 0:i.y}}))}initAnimation(){var t;this._pathMark.setAnimationConfig(Ae((t=q.getAnimationInKey("fadeInOut"))===null||t===void 0?void 0:t(),Fe("area",this._spec,this._markAttributeContext)))}initTooltip(){this._tooltipHelper=new r6t(this),this._pathMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pathMark)}getPath(t){var e;const i=this._areaCache.get(t[rr]);if(i)return i.shape;const r=(e=this._coordinateHelper)===null||e===void 0?void 0:e.shape(t);return this._areaCache.set(t[rr],{shape:r}),r}onEvaluateEnd(){this._mapViewData.updateData()}getDimensionField(){return[this.nameField]}getMeasureField(){return[this.valueField]}release(){super.release(),this._areaCache.clear(),this._nameMap={},this._mapViewData=null}handleZoom(t){var e,i,r;const{scale:s,scaleCenter:o}=t;if(s===1)return;const a=(e=this.getRootMark().getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem();a&&(a.attribute.postMatrix||a.setAttributes({postMatrix:new Pe}),a.scale(s,s,o));const l=(r=(i=this._labelMark)===null||i===void 0?void 0:i.getComponent())===null||r===void 0?void 0:r.getProduct();l&&l.evaluate(null,null)}handlePan(t){var e,i,r;const{delta:s}=t;if(s[0]===0&&s[1]===0)return;const o=(e=this.getRootMark().getProduct())===null||e===void 0?void 0:e.getGroupGraphicItem();o&&(o.attribute.postMatrix||o.setAttributes({postMatrix:new Pe}),o.translate(s[0],s[1]));const a=(r=(i=this._labelMark)===null||i===void 0?void 0:i.getComponent())===null||r===void 0?void 0:r.getProduct();a&&a.evaluate(null,null)}getDatumCenter(t){var e,i,r,s;return this._centroidProperty&&(!((e=t.properties)===null||e===void 0)&&e[this._centroidProperty])?(i=t.properties)===null||i===void 0?void 0:i[this._centroidProperty]:et(t.centroidX*t.centroidY)?[t.centroidX,t.centroidY]:!((r=t.properties)===null||r===void 0)&&r.center?t.properties.center:!((s=t.properties)===null||s===void 0)&&s.centroid?t.properties.centroid:[Number.NaN,Number.NaN]}getDatumName(t){var e;if(t[this.nameField])return t[this.nameField];const i=(e=t.properties)===null||e===void 0?void 0:e[this._nameProperty];if(i){if(this._spec.nameMap&&this._spec.nameMap[i])return this._spec.nameMap[i];if(this._spec.showDefaultName||!this._spec.nameMap)return i}return""}dataToPositionX(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}dataToPositionY(t){var e;return(e=this._option)===null||e===void 0||e.onError("Method not implemented."),0}viewDataUpdate(t){var e,i,r;super.viewDataUpdate(t),(i=(e=this._mapViewData)===null||e===void 0?void 0:e.getDataView())===null||i===void 0||i.reRunAllTransform(),(r=this._mapViewData)===null||r===void 0||r.updateData()}_getDataIdKey(){return rr}getActiveMarks(){return[this._pathMark]}}_d.type=gt.map,_d.mark=s6t,_d.transformerConstructor=knt;const d6t=()=>{t6t(),Tnt(),aH(),q.registerSeries(_d.type,_d),q.registerImplement("registerMap",FVt),q.registerImplement("unregisterMap",HVt),mh()},aA=`${Wt}_waterfall_default_seriesField`,u6t=(n,t)=>{if(!n||n.length===0)return n;const{indexField:e,total:i,groupData:r}=t,s=[],{dimensionValues:o,dimensionData:a}=r().latestData,l=Array.from(o[e]);let h={start:0,end:0,positive:0,negative:0,lastIndex:null};return l.forEach((d,u)=>{const c={start:h.end,end:h.end,lastIndex:h.lastIndex,lastEnd:h.end,index:d,isTotal:!1,positive:h.end,negative:h.end},g=t.stackInverse===!0?a[d].reverse():a[d];if(g==null||g.forEach((p,f)=>{f===g.length-1?p[C0]=!0:delete p[C0]}),g.length>1){const p=f=>{if(i&&i.type!=="end"){if(i.type==="field"||i.type==="custom")return!!f[i.tagField]}else if(u===l.length-1)return!0;return!1};if(g.some(f=>p(f)))return h=c6t(g,d,c,s,h,l,u,t,p),void s.push(c)}h=Rnt(g,d,c,s,h,l,u,t),s.push(c)}),s};function c6t(n,t,e,i,r,s,o,a,l){e.isTotal=!0;const{valueField:h,startAs:d,endAs:u,total:c}=a,g=[],p=[];if(n.forEach(C=>{l(C)?p.push(C):g.push(C)}),p.length===n.length){const C=Rnt([n[0]],t,e,i,r,s,o,a);return p.forEach(S=>{S[d]=n[0][d],S[u]=n[0][u],S[h]=n[0][h]}),C}const f=p[0];let{start:m,end:v}=Bnt(f,e,i,r,c);e.start=m,e.end=v;let _=m,b=m,y=v-m;return g.forEach(C=>{const S=+C[h];S>=0?(C[d]=+_,_=Vo(_,S)):(C[d]=+b,b=Vo(b,S)),C[u]=Vo(C[d],S),m=Vo(m,S),y=tS(y,S)}),p.forEach(C=>{C[d]=+m,C[u]=Vo(C[d],y),C[h]=y}),Object.assign(Object.assign({},e),{lastIndex:t})}function Rnt(n,t,e,i,r,s,o,a){const{valueField:l,startAs:h,endAs:d,total:u,seriesField:c,seriesFieldName:g}=a;return n.forEach(p=>{let f=!1;if(u&&u.type!=="end"){if((u.type==="field"||u.type==="custom")&&p[u.tagField]){f=!0;const{start:m,end:v}=Bnt(p,e,i,r,u);p[h]=m,p[d]=v,p[l]=v-m,e.start=m,e.end=v}}else o===s.length-1&&(e.start=0,p[h]=e.start,p[d]=e.end,f=!0);if(!f){const m=+p[l];m>=0?(p[h]=+e.positive,e.positive=Vo(e.positive,m)):(p[h]=+e.negative,e.negative=Vo(e.negative,m)),p[d]=Vo(p[h],m),e.end=Vo(e.end,m)}e.isTotal=f,(D(c)||c===aA)&&(p[aA]=f?g.total:+p[l]>=0?g.increase:g.decrease)}),Object.assign(Object.assign({},e),{lastIndex:t})}function Bnt(n,t,e,i,r){return r&&r.type!=="end"?r.type==="field"||r.type==="custom"?r.type==="custom"?p6t(n,i,r):r.collectCountField&&!D(n[r.collectCountField])?f6t(n,e,t,r):m6t(n,t,r):{start:0,end:0}:g6t(t)}function g6t(n){return{start:0,end:n.end}}function p6t(n,t,e){return e.product(n,t)}function f6t(n,t,e,i){let r=0,s=e.end;const o=t.length-+n[i.collectCountField],a=t.length-1;return o<0?ls("total.collectCountField error"):r=t[o].start,a<0?ls("total.collectCountField error"):s=t[a].end,{start:r,end:s}}function m6t(n,t,e){let i=0,r=t.end;return e.startField&&!D(n[e.startField])&&(i=+n[e.startField]),e.valueField&&!D(n[e.valueField])&&(r=Vo(i,+n[e.valueField])),{start:i,end:r}}const v6t=(n,t)=>{if(!n)return n;const{indexField:e,valueField:i,total:r,seriesField:s}=t,o={[e]:(r==null?void 0:r.text)||"total",[i]:n.reduce((a,l)=>Vo(a,+l[i]),0)};return s&&(o[s]="total"),n.push(o),n},_6t={type:"fadeIn"},b6t={type:"growCenterIn"};function y6t(n,t){switch(t){case"fadeIn":return _6t;case"scaleIn":return b6t;default:return Pb(n,!1)}}const C6t=()=>{q.registerAnimation("waterfall",(n,t)=>({appear:y6t(n,t),enter:Pb(n,!1),exit:Af(n,!1),disappear:Af(n,!1)}))};class E0 extends sr{constructor(){super(...arguments),this.type=E0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x1:0,y1:0})}}E0.type="rule";const Xf=()=>{q.registerMark(E0.type,E0),NF()},S6t=Object.assign(Object.assign({},rH),{leaderLine:{name:"leaderLine",type:"rule"},stackLabel:{name:"stackLabel",type:"text"}}),x6t=(n,t)=>{if(!t.fields)return n;const e={};return{dimensionValues:e,dimensionData:Pnt(n.map(i=>i.latestData).flat(),t.fields,e)}};function Pnt(n,t,e){if(t.length===0)return n;const i=t[0],r=t.slice(1);e[i]=new Set;const s=w6t(n,i,e[i]);return r.length?A6t(s,(o,a)=>Pnt(o,r,e)):s}function w6t(n,t,e){const i={};return n.forEach(r=>{const s=r[t];i[s]||(i[s]=[],e.add(s)),i[s].push(r)}),i}function A6t(n,t){return Object.keys(n).reduce((e,i)=>(e[i]=t(n[i],i),e),{})}class M6t{get fields(){return this._fields}get groupData(){return this._groupData}constructor(t){this._fields=[],this._fields=t}initData(t,e){const i=t.name,r=new Ve(e instanceof Bd?e:t.dataSet);r.name=i,r.parse([t],{type:"dataview"}),Vt(e,"dimensionTree",x6t),r.transform({type:"dimensionTree",options:{fields:this._fields}},!1),r.target.addListener("change",this.groupDataUpdate.bind(this)),this._groupData=r}groupDataUpdate(){}getGroupValueInField(t){var e,i,r;const s=(r=(i=(e=this.groupData)===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.dimensionValues)===null||r===void 0?void 0:r[t];return s?Array.from(s):[]}}class Ent extends Eb{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(t){this._addMarkLabelSpec(t,"bar"),this._addMarkLabelSpec(t,"bar","stackLabel","initStackLabelMarkStyle")}}const K8={rect:q8,symbol:Lnt,arc:Z8,point:P6t,"line-data":k6t,stackLabel:Int,line:J8,area:J8,rect3d:q8,arc3d:Z8,treemap:I6t,venn:O6t};function T6t(n,t){var e;const{labelSpec:i}=t;i.overlap&&!kt(i.overlap)&&(i.overlap={});const r=(e=K8[n])!==null&&e!==void 0?e:K8.point;return t.series.type===gt.sankey?D6t(t):r(t)}function hH(n,t,e,i){var r;const{labelMark:s,series:o}=n,a={text:t[o.getMeasureField()[0]],data:t,textType:(r=n.labelSpec.textType)!==null&&r!==void 0?r:"text"},l=Object.keys(s.stateStyle.normal);for(const h of l){const d=s.getAttribute(h,t);a[h]=d}if(o.type!==gt.sankey){const{formatFunc:h,args:d}=sh(e,i,a.text,t);h&&(a._originText=a.text,a.text=h(...d,{series:o}))}return a}function $T(n){return it(n)?t=>n(t.data):n}function Lnt(n){var t,e,i;const{series:r,labelSpec:s}=n,o=r.direction==="horizontal"?"right":"top",a=(t=$T(s.position))!==null&&t!==void 0?t:o;let l;return l=s.overlap!==!1&&{strategy:(i=(e=s.overlap)===null||e===void 0?void 0:e.strategy)!==null&&i!==void 0?i:R6t(),avoidBaseMark:a!=="center"},{position:a,overlap:l}}function k6t(n){const t=Lnt(n);return Re(t.overlap)||(t.overlap.avoidBaseMark=!1),t}function R6t(){return[{type:"position",position:["top","bottom","right","left","top-right","top-left","bottom-left","bottom-right"]}]}function q8(n){var t,e,i,r,s,o;const{series:a,labelSpec:l={}}=n,h=(t=$T(l.position))!==null&&t!==void 0?t:"outside",d=(e=a.direction)!==null&&e!==void 0?e:"vertical",u=a.direction==="horizontal"?(i=a.getXAxisHelper())===null||i===void 0?void 0:i.isInverse():(r=a.getYAxisHelper())===null||r===void 0?void 0:r.isInverse();let c,g=h;g=f=>{var m;const{data:v}=f,_=(m=typeof l.position=="function"?l.position(v):l.position)!==null&&m!==void 0?m:"outside";if(_==="outside"){const b=a.getMeasureField()[0],y={vertical:["top","bottom"],horizontal:["right","left"]},C=(v==null?void 0:v[b])>=0&&u||(v==null?void 0:v[b])<0&&!u?1:0;return y[d][C]}return _},c=l.overlap!==!1&&{strategy:(o=(s=l.overlap)===null||s===void 0?void 0:s.strategy)!==null&&o!==void 0?o:B6t(a)};let p=!1;return yt(h)&&h.includes("inside")&&(p=!0),{position:g,overlap:c,smartInvert:p}}function B6t(n){return[{type:"position",position:t=>{var e,i;const{data:r}=t,s=n.getMeasureField()[0];return(n.direction==="horizontal"?!((e=n.getXAxisHelper())===null||e===void 0)&&e.isInverse():!((i=n.getYAxisHelper())===null||i===void 0)&&i.isInverse())?(r==null?void 0:r[s])>=0?n.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]:n.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:(r==null?void 0:r[s])>=0?n.direction==="horizontal"?["right","inside-right"]:["top","inside-top"]:n.direction==="horizontal"?["left","inside-left"]:["bottom","inside-bottom"]}}]}function P6t(n){const{labelSpec:t}=n;let e;return e=t.overlap!==!1&&{avoidBaseMark:!1},{position:"center",overlap:e}}function Z8(n){var t;const{labelSpec:e}=n,i=(t=$T(e.position))!==null&&t!==void 0?t:"outside",r=i;let s;return s=e.smartInvert?e.smartInvert:yt(i)&&i.includes("inside"),{position:r,smartInvert:s}}function E6t(n,t,e,i){return t.direction==="horizontal"?e==="middle"?.5*(t.totalPositionX(n,"end")+t.totalPositionY(n,"start")):e==="max"?t.totalPositionX(n,n.end>=n.start?"end":"start")+i:e==="min"?t.totalPositionX(n,n.end>=n.start?"start":"end")-i:t.totalPositionX(n,"end")+(n.end>=n.start?i:-i):t.totalPositionX(n,"index",.5)}function L6t(n,t,e,i){return t.direction==="horizontal"?t.totalPositionY(n,"index",.5):e==="middle"?.5*(t.totalPositionY(n,"end")+t.totalPositionY(n,"start")):e==="max"?t.totalPositionY(n,n.end>=n.start?"end":"start")-i:e==="min"?t.totalPositionY(n,n.end>=n.start?"start":"end")+i:t.totalPositionY(n,"end")+(n.end>=n.start?-i:i)}function Int(n,t,e){const i=n.series,r=n.labelSpec||{},s=i.getTotalData();return{customLayoutFunc:o=>o.map(a=>{const l=r.position||"withChange",h=r.offset||0,d=t?t(a.data):a.data,u=hH(n,d,r.formatMethod);return u.x=E6t(d,i,l,h),u.y=L6t(d,i,l,h),i.direction==="horizontal"?u.textAlign=l==="middle"?"center":l==="withChange"&&d.end-d.start>=0||l==="max"?"left":"right":u.textBaseline=l==="middle"?l:l==="withChange"&&d.end-d.start>=0||l==="max"?"bottom":"top",e==null||e(a,d,u),uf(Object.assign(Object.assign({},u),{id:a.id}))}),dataFilter:o=>{const a=[];return s.forEach(l=>{const h=o.find(d=>{var u;return l.index===((u=d.data)===null||u===void 0?void 0:u[i.getDimensionField()[0]])});h&&(h.data=l,a.push(h))}),a},overlap:{strategy:[]}}}function I6t(n){return{customLayoutFunc:(t,e)=>e,overlap:!1}}function O6t(n){return{customLayoutFunc:(t,e)=>e,smartInvert:!0}}function J8(n){var t,e,i,r;const{labelSpec:s,series:o}=n,a=(i=(e=(t=o.getViewDataStatistics)===null||t===void 0?void 0:t.call(o).latestData)===null||e===void 0?void 0:e[o.getSeriesField()])===null||i===void 0?void 0:i.values,l=a?a.map((h,d)=>({[o.getSeriesField()]:h,index:d})):[{index:0,[Fr]:o.getSeriesKeys()[0]}];return{position:(r=s.position)!==null&&r!==void 0?r:"end",data:l}}function D6t(n){var t,e,i;const{series:r,labelSpec:s={}}=n,o=(t=$T(s.position))!==null&&t!==void 0?t:"outside",a=r.direction;let l,h=o;return yt(o)&&(a==="vertical"?h=o==="inside-start"?d=>"inside-left":o==="inside-middle"?d=>"center":o==="inside-end"?d=>"inside-right":d=>"bottom":o==="inside-start"?h=d=>"inside-left":o==="inside-middle"?h=d=>"center":o==="inside-end"?h=d=>"inside-right":o==="outside"&&(h=d=>"right")),l=s.overlap!==!1&&(!yt(o)||!o.includes("inside"))&&{strategy:(i=(e=s.overlap)===null||e===void 0?void 0:e.strategy)!==null&&i!==void 0?i:F6t(r)},{position:h,overlap:l,smartInvert:!1,offset:0,syncState:!0}}function F6t(n){return[{type:"position",position:t=>n.direction==="horizontal"?["right","left"]:["bottom","top"]}]}class nc extends ea{constructor(){super(...arguments),this.type=gt.waterfall,this.transformerConstructor=Ent,this._leaderLineMark=null,this._stackLabelMark=null,this._labelMark=null}getTotalData(){var t;return(t=this._totalData)===null||t===void 0?void 0:t.getLatestData()}initGroups(){const t=this.getGroupFields();t&&t.length&&(this._groups=new M6t(t),this._data&&this._groups.initData(this._data.getDataView(),this._dataSet))}setAttrFromSpec(){super.setAttrFromSpec(),this.setValueFieldToStack(),this._fieldX=[this._fieldX[0]],this._fieldY=[this._fieldY[0]],D(this._seriesField)&&(this._seriesField=aA)}getSeriesKeys(){return this._seriesField===aA?[this._theme.seriesFieldName.increase,this._theme.seriesFieldName.decrease,this._theme.seriesFieldName.total]:super.getSeriesKeys()}initData(){var t;super.initData(),Vt(this._dataSet,"waterfallFillTotal",v6t),Vt(this._dataSet,"waterfall",u6t),(D(this._spec.total)||this._spec.total.type==="end")&&((t=this._rawData)===null||t===void 0||t.transform({type:"waterfallFillTotal",options:{indexField:this.getGroupFields()[0],valueField:this.getStackValueField(),seriesField:this.getSeriesField(),seriesFieldName:this._theme.seriesFieldName,total:this._spec.total,stackInverse:this.getRegion().getStackInverse()}},!1));const e=OI(this.getViewData(),this._dataSet,{name:`${Wt}_series_${this.id}_totalData`});this.getViewData().target.removeListener("change",e.reRunAllTransform),this._totalData=new tl(this._option,e),e.transform({type:"waterfall",options:{indexField:this.getGroupFields()[0],valueField:this.getStackValueField(),seriesField:this.getSeriesField(),seriesFieldName:this._theme.seriesFieldName,startAs:To,endAs:Wr,total:this._spec.total,groupData:()=>this.getGroups().groupData,stackInverse:this.getRegion().getStackInverse()}},!1)}compileData(){var t;super.compileData(),(t=this._totalData)===null||t===void 0||t.compile()}initAnimation(){var t,e,i,r;const s={yField:this.direction==="horizontal"?this._fieldY[0]:this.getStackValueField(),xField:this.direction==="horizontal"?this.getStackValueField():this._fieldX[0],direction:this.direction,growFrom:()=>{var l,h;return this.direction==="horizontal"?(l=this._xAxisHelper)===null||l===void 0?void 0:l.getScale(0).scale(0):(h=this._yAxisHelper)===null||h===void 0?void 0:h.getScale(0).scale(0)}},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset,a=Qd(this);this._barMark.setAnimationConfig(Ae((i=q.getAnimationInKey("waterfall"))===null||i===void 0?void 0:i(s,o),Fe("bar",this._spec,this._markAttributeContext),a)),this._leaderLineMark&&this._leaderLineMark.setAnimationConfig(Ae((r=q.getAnimationInKey("fadeInOut"))===null||r===void 0?void 0:r(),Fe("leaderLine",this._spec,this._markAttributeContext)))}viewDataUpdate(t){this._totalData.getDataView().reRunAllTransform(),this._totalData.updateData(),super.viewDataUpdate(t)}addViewDataFilter(t){}reFilterViewData(){}onEvaluateEnd(t){super.onEvaluateEnd(t),this._totalData.updateData()}initMark(){var t,e;super.initMark();const i=this._createMark(nc.mark.leaderLine,{key:"index",stateSort:(t=this._spec.leaderLine)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.leaderLine)===null||e===void 0?void 0:e.customShape});i&&(this._leaderLineMark=i,i.setDataView(this._totalData.getDataView(),this._totalData.getProductId()))}initLabelMarkStyle(t){var e;if(t)return!this._labelMark&&(!((e=this._spec.label)===null||e===void 0)&&e.visible)?(super.initLabelMarkStyle(t),void(this._labelMark=t)):void 0}initStackLabelMarkStyle(t){t&&(this._stackLabelMark=t,t.skipEncode=!0,t.setRule("stackLabel"),t.setDataView(this._totalData.getDataView(),this._totalData.getProductId()),this.setMarkStyle(t,{text:e=>{var i;return((i=this._spec.stackLabel)===null||i===void 0?void 0:i.valueType)==="absolute"?e.end:tS(e.end,e.start)}}))}initTotalLabelMarkStyle(t){this.setMarkStyle(t,{text:e=>{var i;return"end"in e?((i=this._spec.totalLabel)===null||i===void 0?void 0:i.valueType)==="absolute"?e.end:tS(e.end,e.start):this.direction==="horizontal"?e[this._fieldX[0]]:e[this._fieldY[0]]}})}getTotalLabelComponentStyle(t){return Int(Object.assign(Object.assign({},t),{series:this,labelSpec:this._spec.totalLabel}),e=>{const i=this.direction==="vertical"?e[this._fieldX[0]]:e[this._fieldY[0]];return this._totalData.getLatestData().find(r=>r.index===i)})}totalPositionX(t,e,i=.5){const{dataToPosition:r,getBandwidth:s}=this._xAxisHelper;return this._direction==="horizontal"?je(r([t[e]],{bandPosition:this._bandPosition})):r([t[e]],{bandPosition:this._bandPosition})+.5*s(0)-this._barMark.getAttribute("width",t)*(.5-i)}totalPositionY(t,e,i=.5){const{dataToPosition:r,getBandwidth:s}=this._yAxisHelper;return this._direction==="horizontal"?r([t[e]],{bandPosition:this._bandPosition})+.5*s(0)-this._barMark.getAttribute("height",t)*(.5-i):je(r([t[e]],{bandPosition:this._bandPosition}))}initMarkStyle(){super.initMarkStyle(),this._leaderLineMark&&(this._direction==="horizontal"?this.setMarkStyle(this._leaderLineMark,{visible:t=>this.isVisibleLeaderLine(t),x:t=>this.totalPositionX(t,"lastEnd",0),x1:t=>this.totalPositionX(t,t.isTotal?"end":"start",0),y:t=>t.lastIndex?this.totalPositionY(t,"lastIndex",1):0,y1:t=>this.totalPositionY(t,"index",0)},"normal",wt.Series):this.setMarkStyle(this._leaderLineMark,{visible:t=>this.isVisibleLeaderLine(t),x:t=>t.lastIndex?this.totalPositionX(t,"lastIndex",1):0,x1:t=>this.totalPositionX(t,"index",0),y:t=>this.totalPositionY(t,"lastEnd",0),y1:t=>this.totalPositionY(t,t.isTotal?"end":"start",0)},"normal",wt.Series))}isVisibleLeaderLine(t){return!D(t.lastIndex)&&P3t([t.lastEnd,t[t.isTotal?"end":"start"]],this.direction==="horizontal"?this._xAxisHelper.getScale(0):this._yAxisHelper.getScale(0))}}nc.type=gt.waterfall,nc.mark=S6t,nc.transformerConstructor=Ent;const H6t=()=>{Xf(),_h(),C6t(),mh(),vs(),ms(),q.registerSeries(nc.type,nc)},L0=`${Wt}_BOX_PLOT_OUTLIER_VALUE`;var gi;(function(n){n.OUTLIER="outlier",n.MAX="max",n.MIN="min",n.MEDIAN="median",n.Q1="q1",n.Q3="q3",n.SERIES_FIELD="seriesField"})(gi||(gi={}));const z6t=(n,t)=>{const e=[],{outliersField:i,dimensionField:r}=t;return(n[0].latestData||[]).forEach(s=>{let o=s[i];V(o)||(o=[o]),e.push(...o.map(a=>{const l={[L0]:a};return r.forEach(h=>{l[h]=s[h]}),l}))}),e};class W6t extends wr{constructor(){super(...arguments),this.getContentKey=t=>e=>{if(this.isOutlierMark(e))return t===gi.OUTLIER?this.series.getOutliersField():t===gi.SERIES_FIELD?this.series.getSeriesField():null;switch(t){case gi.MIN:return this.series.getMinField();case gi.MAX:return this.series.getMaxField();case gi.MEDIAN:return this.series.getMedianField();case gi.Q1:return this.series.getQ1Field();case gi.Q3:return this.series.getQ3Field();case gi.SERIES_FIELD:return this.series.getSeriesField()}return null},this.getContentValue=t=>e=>{if(this.isOutlierMark(e))return t===gi.OUTLIER?e[L0]:t===gi.SERIES_FIELD?e[this.series.getSeriesField()]:null;switch(t){case gi.MIN:return e[this.series.getMinField()];case gi.MAX:return e[this.series.getMaxField()];case gi.MEDIAN:return e[this.series.getMedianField()];case gi.Q1:return e[this.series.getQ1Field()];case gi.Q3:return e[this.series.getQ3Field()];case gi.SERIES_FIELD:return e[this.series.getSeriesField()]}return null},this.shapeColorCallback=t=>this.series.getShaftShape()==="line"?this.series.getMarkInName("boxPlot").getAttribute("stroke",t):this.series.getMarkInName("boxPlot").getAttribute("fill",t),this.getOutlierFillColor=t=>{var e;const i=this.series.getOutliersStyle();return(e=i==null?void 0:i.fill)!==null&&e!==void 0?e:this.series.getMarkInName("outlier").getAttribute("fill",t)},this.isOutlierMark=t=>L(t[L0])}getDefaultContentList(t){return[{key:this.getContentKey(gi.OUTLIER),value:this.getContentValue(gi.OUTLIER),shapeType:this.shapeTypeCallback,shapeColor:this.getOutlierFillColor,shapeStroke:this.getOutlierFillColor},{key:this.getContentKey(gi.MAX),value:this.getContentValue(gi.MAX)},{key:this.getContentKey(gi.Q3),value:this.getContentValue(gi.Q3)},{key:this.getContentKey(gi.MEDIAN),value:this.getContentValue(gi.MEDIAN)},{key:this.getContentKey(gi.Q1),value:this.getContentValue(gi.Q1)},{key:this.getContentKey(gi.MIN),value:this.getContentValue(gi.MIN)},{key:this.getContentKey(gi.SERIES_FIELD),value:this.getContentValue(gi.SERIES_FIELD)}]}}class I0 extends sr{constructor(){super(...arguments),this.type=I0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:2,boxWidth:30,shaftWidth:20,shaftShape:"line"})}_initProduct(t){const e=this.getStyle("shaftShape"),i=this.getVGrammarView(),r=this.getProductId(),s=e==="bar"?"barBoxplot":"boxplot",o=this.getStyle("direction");this._product=i.glyph(s,t??i.rootMark).id(r).configureGlyph({direction:o}),this._compiledProductId=r}}I0.type="boxPlot";const j6t=()=>{q.registerMark(I0.type,I0),uNt(),fNt()},N6t=Object.assign(Object.assign({},Hi),{boxPlot:{name:"boxPlot",type:"boxPlot"},outlier:{name:"outlier",type:"symbol"}});class Wc extends Po{constructor(){super(...arguments),this.type=gt.boxPlot}getMinField(){return this._minField}getMaxField(){return this._maxField}getQ1Field(){return this._q1Field}getMedianField(){return this._medianField}getQ3Field(){return this._q3Field}getOutliersField(){return this._outliersField}getShaftShape(){return this._shaftShape}getBoxFillColor(){return this._boxFillColor}getStrokeColor(){return this._strokeColor}getOutliersStyle(){return this._outliersStyle}setAttrFromSpec(){var t,e,i,r,s;super.setAttrFromSpec();const o=(e=(t=this._spec.boxPlot)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{};this._minField=this._spec.minField,this._maxField=this._spec.maxField,this._q1Field=this._spec.q1Field,this._medianField=this._spec.medianField,this._q3Field=this._spec.q3Field,this._outliersField=this._spec.outliersField,this._lineWidth=(i=o.lineWidth)!==null&&i!==void 0?i:2,this._boxWidth=o.boxWidth,this._shaftShape=(r=o.shaftShape)!==null&&r!==void 0?r:"line",this._shaftWidth=o.shaftWidth,this._boxFillColor=o.boxFill,this._strokeColor=o.stroke,this._shaftFillOpacity=this._shaftShape==="bar"?(s=o.shaftFillOpacity)!==null&&s!==void 0?s:.5:void 0,this._outliersStyle=this._spec.outliersStyle}initMark(){const t={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._boxPlotMark=this._createMark(Wc.mark.boxPlot,{groupKey:this._seriesField,isSeriesMark:!0},t),this._outlierMark=this._createMark(Wc.mark.outlier,{key:rr,groupKey:this._seriesField,dataView:this._outlierDataView.getDataView(),dataProductId:this._outlierDataView.getProductId()},t)}initMarkStyle(){var t,e,i,r,s;const o=this._boxPlotMark;if(o){const l={direction:this._direction,lineWidth:this._lineWidth,shaftShape:this._shaftShape,fill:(t=this._boxFillColor)!==null&&t!==void 0?t:this._shaftShape==="line"?"#FFF":this.getColorAttribute(),minMaxFillOpacity:this._shaftFillOpacity,stroke:(e=this._strokeColor)!==null&&e!==void 0?e:this._shaftShape==="line"?this.getColorAttribute():"#000"},h=this._direction==="horizontal"?Object.assign(Object.assign({y:this.dataToPositionY.bind(this)},l),{boxHeight:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},ruleHeight:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()},q1q3Height:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},minMaxHeight:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()}}):Object.assign(Object.assign({x:this.dataToPositionX.bind(this)},l),{boxWidth:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},ruleWidth:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()},q1q3Width:()=>{var d;return(d=this._boxWidth)!==null&&d!==void 0?d:this._getMarkWidth()},minMaxWidth:()=>{var d;return(d=this._shaftWidth)!==null&&d!==void 0?d:this._getMarkWidth()}});this.setMarkStyle(o,h,Rt.STATE_NORMAL,wt.Series)}const a=this._outlierMark;a&&this.setMarkStyle(a,{fill:(r=(i=this._outliersStyle)===null||i===void 0?void 0:i.fill)!==null&&r!==void 0?r:this.getColorAttribute(),size:J((s=this._outliersStyle)===null||s===void 0?void 0:s.size)?this._outliersStyle.size:10,symbolType:"circle"},Rt.STATE_NORMAL,wt.Series)}initBoxPlotMarkStyle(){var t,e;const i=this._boxPlotMark,r=this._direction==="horizontal"?this._xAxisHelper:this._yAxisHelper;if(i&&r){const{dataToPosition:o}=r,a=(t=r==null?void 0:r.getScale)===null||t===void 0?void 0:t.call(r,0);this.setMarkStyle(i,{min:l=>je(o(this.getDatumPositionValues(l,this._minField),{bandPosition:this._bandPosition}),a),q1:l=>je(o(this.getDatumPositionValues(l,this._q1Field),{bandPosition:this._bandPosition}),a),median:l=>je(o(this.getDatumPositionValues(l,this._medianField),{bandPosition:this._bandPosition}),a),q3:l=>je(o(this.getDatumPositionValues(l,this._q3Field),{bandPosition:this._bandPosition}),a),max:l=>je(o(this.getDatumPositionValues(l,this._maxField),{bandPosition:this._bandPosition}),a)},Rt.STATE_NORMAL,wt.Series)}const s=this._outlierMark;if(s&&r){const{dataToPosition:o}=r,a=(e=r==null?void 0:r.getScale)===null||e===void 0?void 0:e.call(r,0),l=this._direction==="horizontal"?{y:this.dataToPositionY.bind(this),x:h=>je(o(this.getDatumPositionValues(h,L0),{bandPosition:this._bandPosition}),a)}:{x:this.dataToPositionX.bind(this),y:h=>je(o(this.getDatumPositionValues(h,L0),{bandPosition:this._bandPosition}),a)};this.setMarkStyle(s,l,Rt.STATE_NORMAL,wt.Series)}}initData(){if(super.initData(),!this._data)return;Vt(this._dataSet,"foldOutlierData",z6t),Vt(this._dataSet,"addVChartProperty",Yf);const t=new Ve(this._dataSet,{name:`${this.type}_outlier_${this.id}_data`});t.parse([this.getViewData()],{type:"dataview"}),t.name=`${Wt}_series_${this.id}_outlierData`,t.transform({type:"foldOutlierData",options:{dimensionField:this._direction==="horizontal"?this._fieldY:this._fieldX,outliersField:this._outliersField}}),t.transform({type:"addVChartProperty",options:{beforeCall:xf.bind(this),call:Hc}},!1),this._outlierDataView=new tl(this._option,t)}compileData(){var t;super.compileData(),(t=this._outlierDataView)===null||t===void 0||t.compile()}init(t){super.init(t),this.initBoxPlotMarkStyle()}_getMarkWidth(){if(this._autoBoxWidth)return this._autoBoxWidth;const t=this._direction==="horizontal"?this._yAxisHelper:this._xAxisHelper,e=this._direction==="horizontal"?this._fieldY:this._fieldX,i=t.getBandwidth(e.length-1)/e.length;return this._autoBoxWidth=i,this._autoBoxWidth}onLayoutEnd(t){super.onLayoutEnd(t),this._autoBoxWidth=null}_initAnimationSpec(t={}){const e=Z({},t);return["appear","enter","update","exit","disappear"].forEach(i=>{e[i]&&e[i].type==="scaleIn"?e[i].type=this._shaftShape==="line"?"boxplotScaleIn":"barBoxplotScaleIn":e[i]&&e[i].type==="scaleOut"&&(e[i].type=this._shaftShape==="line"?"boxplotScaleOut":"barBoxplotScaleOut")}),e}initAnimation(){var t,e,i,r,s,o,a;const l=Qd(this);if(this._boxPlotMark){const h=this._initAnimationSpec((t=q.getAnimationInKey("scaleInOut"))===null||t===void 0?void 0:t()),d=this._initAnimationSpec(Fe("boxPlot",this._spec,this._markAttributeContext));this._boxPlotMark.setAnimationConfig(Ae(h,d,l))}if(this._outlierMark){const h={appear:(e=this._spec.animationAppear)===null||e===void 0?void 0:e.symbol,disappear:(i=this._spec.animationDisappear)===null||i===void 0?void 0:i.symbol,enter:(r=this._spec.animationEnter)===null||r===void 0?void 0:r.symbol,exit:(s=this._spec.animationExit)===null||s===void 0?void 0:s.symbol,update:(o=this._spec.animationUpdate)===null||o===void 0?void 0:o.symbol};this._outlierMark.setAnimationConfig(Ae((a=q.getAnimationInKey("scaleInOut"))===null||a===void 0?void 0:a(),h,l))}}initTooltip(){this._tooltipHelper=new W6t(this),this._boxPlotMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._boxPlotMark),this._outlierMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._outlierMark)}getStatisticFields(){const t=super.getStatisticFields(),e=t.find(i=>i.key===this._outliersField);return e&&(e.operations=["array-min","array-max"]),t}onEvaluateEnd(t){super.onEvaluateEnd(t),this._outlierDataView.updateData()}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._boxPlotMark]}}Wc.type=gt.boxPlot,Wc.mark=N6t;const $6t=()=>{j6t(),vh(),FT(),vs(),ms(),q.registerSeries(Wc.type,Wc)};class Mf extends sr{getTextType(){return this._textType}constructor(t,e){super(t,e),this.type=Mf.type,this._textType="text"}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{angle:0,textAlign:"center",lineWidth:0,textConfig:[]})}initStyleWithSpec(t,e){super.initStyleWithSpec(t,e),t.textType&&(this._textType=t.textType)}compileEncode(){super.compileEncode(),this._textType==="rich"&&this._product.encodeState("group",{textType:this._textType})}}Mf.type="text";const _s=()=>{q.registerMark(Mf.type,Mf),dit(),sNt()};function V6t(n,t,e,i,r,s,o,a,l){n.setMarkStyle(t,{textAlign:h=>{if(l()==="vertical")return"center";const d=r(h),u=s(h);if(e==="middle")return"center";if(d>=u){if(e==="start")return"left";if(e==="end")return"right";if(e==="outside")return"left"}else{if(e==="start")return"right";if(e==="end")return"left";if(e==="outside")return"right"}return"center"},textBaseline:h=>{if(l()==="horizontal")return"middle";const d=o(h),u=a(h);if(e==="middle")return"middle";if(u>=d){if(e==="start")return"bottom";if(e==="end")return"top";if(e==="outside")return"bottom"}else{if(e==="start")return"top";if(e==="end")return"bottom";if(e==="outside")return"top"}return"middle"}}),n.setMarkStyle(t,{x:h=>{const d=l(),u=r(h),c=s(h);if(d==="vertical"||e==="middle")return(u+c)/2;if(u>=c){if(e==="start")return c+i;if(e==="end")return u-i;if(e==="outside")return u+i}else{if(e==="start")return c-i;if(e==="end")return u+i;if(e==="outside")return u-i}return(u+c)/2},y:h=>{const d=l(),u=o(h),c=a(h);if(d==="horizontal"||e==="middle")return(u+c)/2;if(u>=c){if(e==="start")return c+i;if(e==="end")return u-i;if(e==="outside")return u+i}else{if(e==="start")return c-i;if(e==="end")return u+i;if(e==="outside")return u-i}return(u+c)/2}},"normal",wt.Series)}class G6t extends wr{constructor(){super(...arguments),this._getMeasureData=t=>this.series.getSpec().direction==="horizontal"?t[this.series.getSpec().xField[0]]+"-"+t[this.series.getSpec().xField[1]]:t[this.series.getSpec().yField[0]]+"-"+t[this.series.getSpec().yField[1]]}}const Ont=n=>({type:"growCenterIn",options:{direction:n.direction==="horizontal"?"x":"y"}}),U6t={type:"fadeIn"},Q8=n=>({type:"growCenterOut",options:{direction:n.direction==="horizontal"?"x":"y"}});function Y6t(n,t){return t==="fadeIn"?U6t:Ont(n)}const X6t=()=>{q.registerAnimation("rangeColumn",(n,t)=>({appear:Y6t(n,t),enter:Ont(n),exit:Q8(n),disappear:Q8(n)}))},K6t=Object.assign(Object.assign({},rH),{minLabel:{name:"minLabel",type:"text"},maxLabel:{name:"maxLabel",type:"text"}}),q6t=Object.assign(Object.assign({},_nt),{minLabel:{name:"minLabel",type:"text"},maxLabel:{name:"maxLabel",type:"text"}});class Dnt extends Eb{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(t){var e;((e=t.label)===null||e===void 0?void 0:e.position)!=="bothEnd"&&this._addMarkLabelSpec(t,"bar")}}class Jo extends ea{constructor(){super(...arguments),this.type=gt.rangeColumn,this._barMarkType="rect",this._barName=gt.bar,this.transformerConstructor=Dnt}initMark(){var t,e,i,r,s,o,a,l,h,d;this._initBarBackgroundMark();const u=(t=this._spec.label)===null||t===void 0?void 0:t.position;this._barMark=this._createMark(Jo.mark.bar,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(e=this._spec.bar)===null||e===void 0?void 0:e.stateSort},{setCustomizedShape:(i=this._spec.bar)===null||i===void 0?void 0:i.customShape,morph:ll(this._spec,Jo.mark.bar.name),morphElementKey:this.getDimensionField()[0]}),((r=this._spec.label)===null||r===void 0?void 0:r.visible)!==!1&&u==="bothEnd"&&(((o=(s=this._spec.label)===null||s===void 0?void 0:s.minLabel)===null||o===void 0?void 0:o.visible)!==!1&&(this._minLabelMark=this._createMark(Jo.mark.minLabel,{markSpec:(a=this._spec.label)===null||a===void 0?void 0:a.minLabel})),((h=(l=this._spec.label)===null||l===void 0?void 0:l.maxLabel)===null||h===void 0?void 0:h.visible)!==!1&&(this._maxLabelMark=this._createMark(Jo.mark.maxLabel,{markSpec:(d=this._spec.label)===null||d===void 0?void 0:d.maxLabel})))}initMarkStyle(){var t,e;super.initMarkStyle(),this._initLabelMarkPos(this._minLabelMark,(t=this._spec.label)===null||t===void 0?void 0:t.minLabel,0,"end"),this._initLabelMarkPos(this._maxLabelMark,(e=this._spec.label)===null||e===void 0?void 0:e.maxLabel,1,"start")}_initLabelMarkPos(t,e,i,r){var s,o,a,l;if(t){this.setMarkStyle(t,{fill:(o=(s=e==null?void 0:e.style)===null||s===void 0?void 0:s.fill)!==null&&o!==void 0?o:this.getColorAttribute(),text:u=>{const c=this._spec.direction==="horizontal"?u[this._spec.xField[i]]:u[this._spec.yField[i]];return e!=null&&e.formatMethod?e.formatMethod(c,u):c}});const h=(a=e==null?void 0:e.position)!==null&&a!==void 0?a:r,d=(l=e==null?void 0:e.offset)!==null&&l!==void 0?l:this._direction==="vertical"?-20:-25;V6t(this,t,h,d,u=>this._barMark.getAttribute("x",u),u=>this._direction==="vertical"?this._barMark.getAttribute("x",u)+this._barMark.getAttribute("width",u):this._barMark.getAttribute("x1",u),u=>this._barMark.getAttribute("y",u),u=>this._direction==="vertical"?this._barMark.getAttribute("y1",u):this._barMark.getAttribute("y",u)+this._barMark.getAttribute("height",u),()=>this._direction)}}initLabelMarkStyle(t){t&&(this.setMarkStyle(t,{text:e=>{let i,r;return this._spec.direction==="horizontal"?(i=e[this._spec.xField[0]],r=e[this._spec.xField[1]]):(i=e[this._spec.yField[0]],r=e[this._spec.yField[1]]),i+"-"+r},z:this._fieldZ?this.dataToPositionZ.bind(this):null}),this._labelMark=t)}_dataToPosX(t){return this._xAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.xField[0]),{bandPosition:this._bandPosition})}_dataToPosX1(t){return this._xAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.xField[1]),{bandPosition:this._bandPosition})}_dataToPosY(t){return this._yAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.yField[0]),{bandPosition:this._bandPosition})}_dataToPosY1(t){return this._yAxisHelper.dataToPosition(this.getDatumPositionValues(t,this._spec.yField[1]),{bandPosition:this._bandPosition})}initAnimation(){var t,e,i,r,s;const o=Qd(this),a=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._barMark.setAnimationConfig(Ae((i=q.getAnimationInKey("rangeColumn"))===null||i===void 0?void 0:i({direction:this.direction},a),Fe("bar",this._spec,this._markAttributeContext),o)),this._minLabelMark&&this._minLabelMark.setAnimationConfig(Ae((r=q.getAnimationInKey("fadeInOut"))===null||r===void 0?void 0:r(),Fe("label",this._spec,this._markAttributeContext),o)),this._maxLabelMark&&this._maxLabelMark.setAnimationConfig(Ae((s=q.getAnimationInKey("fadeInOut"))===null||s===void 0?void 0:s(),Fe("label",this._spec,this._markAttributeContext),o))}initTooltip(){this._tooltipHelper=new G6t(this),this._barMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._barMark),this._minLabelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._minLabelMark),this._maxLabelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._maxLabelMark),this._labelMark&&this._tooltipHelper.ignoreTriggerSet.mark.add(this._labelMark)}}Jo.type=gt.rangeColumn,Jo.mark=K6t,Jo.transformerConstructor=Dnt;const Z6t=()=>{_h(),_s(),X6t(),mh(),vs(),ms(),q.registerSeries(Jo.type,Jo)};class lA extends Jo{constructor(){super(...arguments),this.type=gt.rangeColumn3d,this._barMarkType="rect3d",this._barName=gt.bar3d}}lA.type=gt.rangeColumn3d,lA.mark=q6t;const J6t=()=>{sH(),vs(),ms(),q.registerSeries(lA.type,lA)};class Q6t extends wr{constructor(){super(...arguments),this._getMeasureData=t=>this.series.getSpec().direction==="horizontal"?t[this.series.getSpec().xField[0]]+"-"+t[this.series.getSpec().xField[1]]:t[this.series.getSpec().yField[0]]+"-"+t[this.series.getSpec().yField[1]]}}const tUt=Object.assign({},gnt);class Tf extends Wl{constructor(){super(...arguments),this.type=gt.rangeArea}initMark(){var t;const{customShape:e,stateSort:i}=(t=this._spec.area)!==null&&t!==void 0?t:{};this._areaMark=this._createMark(Tf.mark.area,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:i},{setCustomizedShape:e,morphElementKey:this.getDimensionField()[0]})}initMarkStyle(){this.initAreaMarkStyle()}initAreaMarkStyle(){const t=this._areaMark;t&&(super.initAreaMarkStyle(),this._direction==="horizontal"?this.setMarkStyle(this._areaMark,{x1:e=>{if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:i}=this._xAxisHelper;return i(this.getDatumPositionValues(e,this._spec.xField[1]),{bandPosition:this._bandPosition})}},"normal",wt.Series):this.setMarkStyle(this._areaMark,{y1:e=>{if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:i}=this._yAxisHelper;return i(this.getDatumPositionValues(e,this._spec.yField[1]),{bandPosition:this._bandPosition})}},"normal",wt.Series),this.setMarkStyle(t,{stroke:!1},"normal",wt.Series))}initTooltip(){this._tooltipHelper=new Q6t(this)}_isFieldAllValid(){const t=this.getViewDataStatistics(),e=this.fieldY;return!!(t&&t.latestData&&e.length)&&e.every(i=>t.latestData[i]&&t.latestData[i].allValid)}}Tf.type=gt.rangeArea,Tf.mark=tUt;const eUt=()=>{jT(),vs(),ms(),q.registerSeries(Tf.type,Tf)};class Lb extends zc{constructor(){super(...arguments),this.coordinate="polar",this._outerRadius=Uw,this._innerRadius=0,this._angleField=[],this._radiusField=[],this._sortDataByAxis=!1}get outerRadius(){return this._outerRadius}get innerRadius(){return this._innerRadius}getAngleField(){return this._angleField}setAngleField(t){return this._angleField=L(t)?Q(t):[],this._angleField}getRadiusField(){return this._radiusField}setRadiusField(t){return this._radiusField=L(t)?Q(t):[],this._radiusField}get innerRadiusField(){return this._innerRadiusField}setInnerRadiusField(t){return this._innerRadiusField=Q(t),this._innerRadiusField}get radiusScale(){return this._radiusScale}setRadiusScale(t){return this._radiusScale=t,t}get angleScale(){return this._angleScale}setAngleScale(t){return this._angleScale=t,t}get angleAxisHelper(){return this._angleAxisHelper}set angleAxisHelper(t){this._angleAxisHelper=t,this.onAngleAxisHelperUpdate()}get radiusAxisHelper(){return this._radiusAxisHelper}set radiusAxisHelper(t){this._radiusAxisHelper=t,this.onRadiusAxisHelperUpdate()}get sortDataByAxis(){return this._sortDataByAxis}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getCenter=()=>this.angleAxisHelper.center(),this._markAttributeContext.getLayoutRadius=()=>this._computeLayoutRadius()}valueToPosition(t,e){if(D(t)||D(e)||!this.angleAxisHelper||!this.radiusAxisHelper)return{x:Number.NaN,y:Number.NaN};const i=this.radiusAxisHelper.dataToPosition(Q(e));if(i<0){if(this._invalidType==="break"||this._invalidType==="link")return{x:Number.NaN,y:Number.NaN};if(this._invalidType==="zero")return this.angleAxisHelper.center()}const r=this.angleAxisHelper.dataToPosition(Q(t));return this.angleAxisHelper.coordToPoint({angle:r,radius:i})}dataToPosition(t,e){return t&&this.angleAxisHelper&&this.radiusAxisHelper?e&&!this.isDatumInViewData(t)?null:this.valueToPosition(this.getDatumPositionValues(t,this._angleField),this.getDatumPositionValues(t,this._radiusField)):null}dataToPositionX(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.x}dataToPositionY(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.y}dataToPositionZ(t){return 0}positionToData(t){}radiusToData(t){}angleToData(t){}getStatisticFields(){var t,e;const i=[];return!((t=this.radiusAxisHelper)===null||t===void 0)&&t.getScale&&this._radiusField.forEach(r=>{const s={key:r,operations:[]};Je(this.radiusAxisHelper.getScale(0).type)?s.operations=["max","min"]:s.operations=["values"],i.push(s)}),!((e=this.angleAxisHelper)===null||e===void 0)&&e.getScale&&this._angleField.forEach(r=>{const s={key:r,operations:[]};Je(this.angleAxisHelper.getScale(0).type)?s.operations=["max","min"]:s.operations=["values"],i.push(s)}),i}setAttrFromSpec(){super.setAttrFromSpec(),L(this._spec.outerRadius)&&(this._outerRadius=this._spec.outerRadius),L(this._spec.radius)&&(this._outerRadius=this._spec.radius),L(this._spec.innerRadius)&&(this._innerRadius=this._spec.innerRadius),L(this._spec.sortDataByAxis)&&(this._sortDataByAxis=this._spec.sortDataByAxis===!0)}onRadiusAxisHelperUpdate(){this.onMarkPositionUpdate()}onAngleAxisHelperUpdate(){this.onMarkPositionUpdate()}afterInitMark(){super.afterInitMark()}_computeLayoutRadius(){const t=this._angleAxisHelper||this._radiusAxisHelper;if(t)return t.layoutRadius();const{width:e,height:i}=this._region.getLayoutRect();return Math.min(e/2,i/2)}initEvent(){super.initEvent(),this.sortDataByAxis&&this.event.on(Ot.scaleDomainUpdate,{filter:t=>{var e;return t.model.id===((e=this._angleAxisHelper)===null||e===void 0?void 0:e.getAxisId())}},()=>{this._sortDataInAxisDomain()})}_sortDataInAxisDomain(){var t,e;!((e=(t=this.getViewData())===null||t===void 0?void 0:t.latestData)===null||e===void 0)&&e.length&&snt(this.angleAxisHelper,this._angleField[0],this.getViewData().latestData)}getInvalidCheckFields(){const t=[];return this.angleAxisHelper.isContinuous&&this._angleField.forEach(e=>{t.push(e)}),this.radiusAxisHelper.isContinuous&&this._radiusField.forEach(e=>{t.push(e)}),t}}function hA(n){return mf(n)?Number.parseFloat(n):0}const iUt=(n,t)=>{const{asStartAngle:e,asEndAngle:i,asMiddleAngle:r,asRadian:s,asRatio:o,asQuadrant:a,asK:l,showAllZero:h,supportNegative:d,showEmptyCircle:u}=t,c=t.angleField(),g=t.startAngle(),p=t.endAngle(),f=t.minAngle(),m=n.map(T=>Object.assign({},T));if(!m||m.length===0)return m;if(!h&&u&&nUt(m,c,d))return[];const v=(T,R,B)=>{T[e]=R,T[i]=R+B,T[r]=R+B/2,T[s]=B,T[a]=kY(R+B/2)};let _=0,b=-1/0,y=!0;for(let T=0;T<m.length;T++){const R=d?Math.abs(hA(m[T][c])):hA(m[T][c]);_+=R,b=Math.max(R,b),y&&R!==0&&(y=!1),m[T][UB]=R}const C=m.map(T=>Number(T[c])),S=p-g;let w=g,x=S,A=0;const M=S3t(C);if(m.forEach((T,R)=>{const B=T[UB],E=_?B/_:0;let k=E*S;k<f?(k=f,x-=f):A+=B;const P=w,I=w+k;T[o]=E,T[l]=b?B/b:0,T._percent_=M[R],v(T,P,k),w=I}),x<S)if(x<=.001){const T=S/m.length;m.forEach((R,B)=>{v(R,g+B*T,T)})}else{const T=x/A;w=g,m.forEach(R=>{const B=R[s]===f?f:R[UB]*T;v(R,w,B),w+=B})}if(_!==0&&(m[m.length-1][i]=p),y&&h){const T=S/m.length;m.forEach((R,B)=>{v(R,g+B*T,T)})}return m},nUt=(n,t,e)=>!!D(n)||n.length===0||!!n.every(i=>hA(i[t])===0)||!e&&n.reduce((i,r)=>i+hA(r[t]),0)===0;function VT(n,t,e){return(i,r,s)=>t?n.growField==="radius"?{overall:0}:{overall:n.growFrom(i,r,e)}:{overall:!1}}const t7=n=>({type:n.growField==="radius"?"growRadiusIn":"growAngleIn",options:VT(n,!0,hn.appear)}),rUt={type:"fadeIn"},Fnt=n=>({type:n.growField==="radius"?"growRadiusIn":"growAngleIn",easing:"linear",options:VT(n,!0,hn.enter)}),Hnt=n=>({type:n.growField==="radius"?"growRadiusOut":"growAngleOut",easing:"linear",options:VT(n,!0,hn.exit)}),znt=n=>({type:n.growField==="radius"?"growRadiusOut":"growAngleOut",options:VT(n,!0,hn.exit)});function dH(n,t){if(t===!1)return{};switch(t){case"fadeIn":return rUt;case"growRadius":return t7(Object.assign(Object.assign({},n),{growField:"radius"}));default:return t7(Object.assign(Object.assign({},n),{growField:"angle"}))}}const sUt=()=>{q.registerAnimation("pie",(n,t)=>({appear:dH(n,t),enter:Fnt(n),exit:Hnt(n),disappear:znt(n)}))},oUt=()=>{q.registerAnimation("emptyCircle",(n,t)=>({appear:dH(n,t)}))},aUt=()=>{q.registerAnimation("pie3d",(n,t)=>({appear:dH(n,t),enter:Fnt(n),exit:Hnt(n),disappear:znt(n)}))};function lUt(n,t){var e,i,r,s;const o=(i=(e=t.options)===null||e===void 0?void 0:e.distance)!==null&&i!==void 0?i:10,a=et(t.duration)?t.duration/2:1e3,l=(r=t.options.easing)!==null&&r!==void 0?r:"cubicOut";return{oneByOne:t.oneByOne,loop:(s=t.loop)!==null&&s!==void 0&&s,timeSlices:[{duration:a,effects:{easing:l,channel:{x:{from:h=>n.getAttribute("x",h),to:h=>n.getAttribute("x",h)+ui({x:0,y:0},o,h[Qh]).x},y:{from:h=>n.getAttribute("y",h),to:h=>n.getAttribute("y",h)+ui({x:0,y:0},o,h[Qh]).y}}}},{duration:a,effects:{easing:l,channel:{x:{to:h=>n.getAttribute("x",h),from:h=>n.getAttribute("x",h)+ui({x:0,y:0},o,h[Qh]).x},y:{to:h=>n.getAttribute("y",h),from:h=>n.getAttribute("y",h)+ui({x:0,y:0},o,h[Qh]).y}}}}]}}class Wnt extends sr{constructor(t,e){super(t,e),this.type=kf.type,this._unCompileChannel={centerOffset:!0,radiusOffset:!0},this.computeOuterRadius=(i,r,s="normal",o,a)=>{var l;return a+((l=this.getAttribute("radiusOffset",r,s,o))!==null&&l!==void 0?l:0)},this.computeCenter=(i,r,s="normal",o,a)=>ui({x:0,y:0},this.getAttribute("centerOffset",r,s,o),r[Qh])[i]+a,this._computeExChannel.x=this.computeCenter,this._computeExChannel.y=this.computeCenter,this._computeExChannel.outerRadius=this.computeOuterRadius,this._extensionChannel.centerOffset=["x","y"],this._extensionChannel.radiusOffset=["outerRadius"]}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{startAngle:0,endAngle:0,outerRadius:0,innerRadius:0,cornerRadius:0,lineWidth:0,innerPadding:0,outerPadding:0})}}class kf extends Wnt{constructor(){super(...arguments),this.type=kf.type}}kf.type="arc";const eg=()=>{q5t(),int(),q.registerMark(kf.type,kf)},hUt=Object.assign(Object.assign({},Hi),{pie:{name:"pie",type:"arc"},labelLine:{name:"labelLine",type:"path"}}),dUt=Object.assign(Object.assign({},Hi),{pie3d:{name:"pie3d",type:"arc3d"},labelLine:{name:"labelLine",type:"path"}});class uH extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"pie")}_mergeThemeToSpec(t,e){const i=this._theme;let r=t;if(this._shouldMergeThemeToSpec()){const s=this._getDefaultSpecFromChart(e);r=Nt({},this._theme,s,t);const o=(a,l)=>Nt({},a==="inside"||a==="inside-center"?this._theme.innerLabel:this._theme.outerLabel,l);V(r.label)?r.label=r.label.map(a=>o(a.position,a)):r.label=o(r.label.position,r.label)}return{spec:r,theme:i}}_getDefaultSpecFromChart(t){var e;const i=(e=super._getDefaultSpecFromChart(t))!==null&&e!==void 0?e:{},{centerX:r,centerY:s}=t;return L(r)&&(i.centerX=r),L(s)&&(i.centerY=s),Object.keys(i).length>0?i:void 0}}const uUt=`${Wt}_LABEL_VISIBLE`,cUt=(n,t)=>{var e,i,r,s,o,a;const l=(e=n.type)!==null&&e!==void 0?e:n.orient==="angle"?"band":"linear",h=`${vt.polarAxis}-${l}`,d=(i=n.startAngle)!==null&&i!==void 0?i:t.startAngle,u=(r=n.endAngle)!==null&&r!==void 0?r:t.endAngle;return{axisType:l,componentName:h,startAngle:d??EF,endAngle:u??(L(d)?d+360:Let),center:L(t.center)?t.center:L(t==null?void 0:t.centerX)||L(t==null?void 0:t.centerY)?{x:t==null?void 0:t.centerX,y:t==null?void 0:t.centerY}:void 0,outerRadius:(a=(o=(s=n.outerRadius)!==null&&s!==void 0?s:n.radius)!==null&&o!==void 0?o:t.outerRadius)!==null&&a!==void 0?a:t.radius,layoutRadius:t.layoutRadius}},jnt=(n,t,e,i)=>{const r=n();if(J(r))return r;if(it(r))return r(t(),e());const s=t();if(r==="auto"&&s.width>0&&s.height>0){const{startAngle:o=0,endAngle:a=2*Math.PI}=i();return blt(s,e(),o,a)}return Math.min(s.width/2,s.height/2)};class Rf extends Lb{constructor(){super(...arguments),this.transformerConstructor=uH,this._pieMarkName="pie",this._pieMarkType="arc",this.getCenter=()=>{var t,e;const i=this._region.getLayoutRect();return{x:Gi((t=this._spec)===null||t===void 0?void 0:t.centerX,i.width,i,i.width/2),y:Gi((e=this._spec)===null||e===void 0?void 0:e.centerY,i.height,i,i.height/2)}},this._startAngle=ST,this._endAngle=PF,this._pieMark=null,this._labelMark=null,this._labelLineMark=null,this._emptyArcMark=null,this.dataToCentralPosition=t=>{const e=t[Qh];if(D(e))return null;const i=this.computeDatumRadius(t),r=this.computeDatumInnerRadius(t),s=this.computeCenter(t);return ui(s,(i+r)/2,e)}}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.getCenter().x,y:()=>this.getCenter().y}),this._markAttributeContext.startAngleScale=t=>this.startAngleScale(t),this._markAttributeContext.endAngleScale=t=>this.endAngleScale(t)}setAttrFromSpec(){var t,e,i,r,s,o;super.setAttrFromSpec(),this._centerOffset=(t=this._spec.centerOffset)!==null&&t!==void 0?t:0,this._cornerRadius=(e=this._spec.cornerRadius)!==null&&e!==void 0?e:0;const a=m3t(L(this._spec.startAngle)?Te(this._spec.startAngle):this._startAngle,L(this._spec.endAngle)?Te(this._spec.endAngle):this._endAngle);this._startAngle=a.startAngle,this._endAngle=a.endAngle,this._padAngle=L(this._spec.padAngle)?Te(this._spec.padAngle):0,this.setAngleField(this._spec.valueField||this._spec.angleField),this._spec.categoryField&&this.setSeriesField(this._spec.categoryField),this._radiusField=[],this._specAngleField=this._angleField.slice(),this._specRadiusField=[],this._showEmptyCircle=(r=(i=this._spec.emptyPlaceholder)===null||i===void 0?void 0:i.showEmptyCircle)!==null&&r!==void 0&&r,this._showAllZero=(s=this._spec.showAllZero)!==null&&s!==void 0&&s,this._supportNegative=(o=this._spec.supportNegative)!==null&&o!==void 0&&o}initData(){super.initData();const t=this.getViewData();if(!t)return;Vt(this._dataSet,"pie",iUt),t.transform({type:"pie",options:{angleField:()=>this._angleField[0],startAngle:()=>this._startAngle,endAngle:()=>this._endAngle,minAngle:()=>L(this._spec.minAngle)?Te(this._spec.minAngle):0,asStartAngle:kU,asEndAngle:RU,asRatio:nWt,asMiddleAngle:Qh,asRadian:oWt,asQuadrant:sWt,asK:rWt,showAllZero:this._showAllZero,supportNegative:this._supportNegative,showEmptyCircle:this._showEmptyCircle}},!1);const e=new Ve(this._dataSet,{name:`${Wt}_series_${this.id}_viewDataLabel`});e.parse([this.getViewData()],{type:"dataview"}),this._viewDataLabel=new tl(this._option,e)}compileData(){var t;super.compileData(),(t=this._viewDataLabel)===null||t===void 0||t.compile()}initMark(){var t,e;this._pieMark=this._createMark(Object.assign(Object.assign({},Rf.mark.pie),{name:this._pieMarkName,type:this._pieMarkType}),{key:sa,groupKey:this._seriesField,skipBeforeLayouted:!0,isSeriesMark:!0,stateSort:(t=this._spec.pie)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.pie)===null||e===void 0?void 0:e.customShape,morph:ll(this._spec,this._pieMarkName),morphElementKey:this._seriesField}),this._showEmptyCircle&&(this._emptyArcMark=this._createMark({name:"emptyCircle",type:"arc"},{dataView:!1}),this._emptyArcMark.setDepend(this._pieMark))}startAngleScale(t){return DC(kU)(t)}endAngleScale(t){return DC(RU)(t)}_computeLayoutRadius(){return jnt(()=>this._spec.layoutRadius,this.getLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}initMarkStyle(){const t={x:()=>this.getCenter().x,y:()=>this.getCenter().y,fill:this.getColorAttribute(),outerRadius:AU(this._outerRadius)?this._outerRadius:()=>this._computeLayoutRadius()*this._outerRadius,innerRadius:AU(this._innerRadius)?this._innerRadius:()=>this._computeLayoutRadius()*this._innerRadius,cornerRadius:()=>this._computeLayoutRadius()*this._cornerRadius,startAngle:r=>this.startAngleScale(r),endAngle:r=>this.endAngleScale(r),padAngle:this._padAngle,centerOffset:this._centerOffset},e=this._pieMark;e&&this.setMarkStyle(e,t,"normal",wt.Series);const i=this._emptyArcMark;i&&this.setMarkStyle(i,Object.assign(Object.assign({},t),{visible:()=>{const r=this.getViewData().latestData;return!r||!r.length}}),"normal",wt.Series)}initInteraction(){this._parseInteractionConfig(this._pieMark?[this._pieMark]:[])}initTooltip(){super.initTooltip(),this._pieMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pieMark)}initMarkStyleWithSpec(t,e,i){if(super.initMarkStyleWithSpec(t,e,i),t.name===this._pieMarkName){const r=this.getSpec()[t.name];if(r)for(const s in r.state||{})this.setMarkStyle(t,this.generateRadiusStyle(r.state[s]),s,wt.User_Mark)}t.name==="emptyCircle"&&this.setMarkStyle(t,this.generateRadiusStyle(e.style),"normal",wt.User_Mark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{visible:DC(uUt).bind(this),text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:this.dataToPositionZ.bind(this)})}afterInitMark(){super.afterInitMark()}initEvent(){var t;super.initEvent(),(t=this._viewDataLabel.getDataView())===null||t===void 0||t.target.addListener("change",this.viewDataLabelUpdate.bind(this))}initGroups(){}onLayoutEnd(t){this._viewDataLabel.getDataView().reRunAllTransform(),this.onMarkPositionUpdate(),super.onLayoutEnd(t)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return this._specAngleField}viewDataLabelUpdate(){this.event.emit(Ot.viewDataLabelUpdate,{model:this}),this._viewDataLabel.updateData()}generateRadiusStyle(t){if(!t)return;const e={};return t.outerRadius&&(e.outerRadius=()=>this._computeLayoutRadius()*t.outerRadius),t.innerRadius&&(e.innerRadius=()=>this._computeLayoutRadius()*t.innerRadius),t.cornerRadius&&(e.cornerRadius=()=>this._computeLayoutRadius()*t.cornerRadius),e}computeCenter(t){return{x:this._pieMark.getAttribute("x",t,"normal"),y:this._pieMark.getAttribute("y",t,"normal")}}getRadius(t="normal"){var e,i,r,s,o,a,l;const h=t==="normal"?(r=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.outerRadius:(l=(a=(o=this.getSpec()[((s=this._pieMark)===null||s===void 0?void 0:s.name)||"pie"])===null||o===void 0?void 0:o.state)===null||a===void 0?void 0:a[t])===null||l===void 0?void 0:l.outerRadius;return h??this._outerRadius}getInnerRadius(t="normal"){var e,i,r,s,o,a,l;const h=t==="normal"?(r=(i=this.getSpec()[((e=this._pieMark)===null||e===void 0?void 0:e.name)||"pie"])===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.innerRadius:(l=(a=(o=this.getSpec()[((s=this._pieMark)===null||s===void 0?void 0:s.name)||"pie"])===null||o===void 0?void 0:o.state)===null||a===void 0?void 0:a[t])===null||l===void 0?void 0:l.innerRadius;return h??this._innerRadius}computeRadius(t,e){return this._computeLayoutRadius()*t*(D(e)?1:e)+this._centerOffset}computeDatumRadius(t,e){return this._computeLayoutRadius()*this.getRadius(e)+this._centerOffset}_compareSpec(t,e,i){i=i??{data:!0};const r=["centerX","centerY","centerOffset","radius","innerRadius","cornerRadius","startAngle","endAngle","padAngle"];r.forEach(o=>{i[o]=!0});const s=super._compareSpec(t,e,i);return t=t??{},r.some(o=>t[o]!==e[o])&&(s.reRender=!0,s.change=!0),s}computeDatumInnerRadius(t,e){return this._computeLayoutRadius()*this.getInnerRadius(e)+this._centerOffset}dataToPosition(t,e){const i=t[Qh];if(D(i)||e&&!this.isDatumInViewData(t))return null;const r=this.computeDatumRadius(t),s=this.computeCenter(t);return ui(s,r,i)}initAnimation(){var t,e,i;const r={growFrom:(o,a,l)=>{var h;if(l===hn.appear)return this._startAngle;if(l===hn.disappear)return this._endAngle;const d=[hn.disappear,hn.exit],u=a.mark.elements,c=o,g=c==null?void 0:c[rr];if(u.find(f=>{var m;return((m=f.data[0])===null||m===void 0?void 0:m[rr])<g})===void 0)return this._startAngle;if(u.find(f=>{var m;return((m=f.data[0])===null||m===void 0?void 0:m[rr])>g})===void 0)return this._endAngle;const p=[...u].reverse().find(f=>{var m;return((m=f.data[0])===null||m===void 0?void 0:m[rr])<g});return d.includes(l)?(h=p==null?void 0:p.getNextGraphicAttributes())===null||h===void 0?void 0:h.endAngle:p==null?void 0:p.getGraphicAttribute("endAngle",!0)}},s=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;if(this._pieMark){const o=Ae((e=q.getAnimationInKey("pie"))===null||e===void 0?void 0:e(r,s),Fe("pie",this._spec,this._markAttributeContext));o.normal&&o.normal.type&&(o.normal=lUt(this._pieMark,o.normal)),this._pieMark.setAnimationConfig(o)}if(this._emptyArcMark){const o=Ae((i=q.getAnimationInKey("emptyCircle"))===null||i===void 0?void 0:i(r,s??"fadeIn"));this._emptyArcMark.setAnimationConfig(o)}}getDefaultShapeType(){return"circle"}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(t,e){return e}getActiveMarks(){return[this._pieMark]}}Rf.transformerConstructor=uH,Rf.mark=hUt;class NI extends Rf{constructor(){super(...arguments),this.type=gt.pie}}NI.type=gt.pie;const gUt=()=>{eg(),sUt(),oUt(),q.registerSeries(NI.type,NI)};class O0 extends Wnt{constructor(){super(...arguments),this.type=O0.type,this._support3d=!0}}O0.type="arc3d";const Nnt=()=>{int(),Z5t(),q.registerMark(O0.type,O0)};class $nt extends uH{_transformLabelSpec(t){this._addMarkLabelSpec(t,"pie3d")}}class Uv extends Rf{constructor(){super(...arguments),this.type=gt.pie3d,this._pieMarkName="pie3d",this._pieMarkType="arc3d",this.transformerConstructor=$nt}setAttrFromSpec(){var t,e;super.setAttrFromSpec(),this._angle3d=(e=(t=this._spec)===null||t===void 0?void 0:t.angle3d)!==null&&e!==void 0?e:-Math.PI/3}initMarkStyle(){super.initMarkStyle();const t=this._pieMark;t&&this.setMarkStyle(t,{beta:()=>this._angle3d},"normal",wt.Series)}initLabelMarkStyle(t,e={}){t&&(super.initLabelMarkStyle(t),this.setMarkStyle(t,{support3d:!0},void 0,wt.Mark))}}Uv.type=gt.pie3d,Uv.mark=dUt,Uv.transformerConstructor=$nt;const pUt=()=>{aUt(),Nnt(),q.registerSeries(Uv.type,Uv)},e7=n=>{const t=n.growField==="angle"?0:n.innerRadius;return n.growField==="angle"?{type:n.growField==="angle"?"growAngleIn":"growRadiusIn"}:{channel:{innerRadius:{from:t,to:(e,i)=>{var r;return(r=i.getFinalGraphicAttributes())===null||r===void 0?void 0:r.innerRadius}},outerRadius:{from:t,to:(e,i)=>{var r;return(r=i.getFinalGraphicAttributes())===null||r===void 0?void 0:r.outerRadius}}}}},fUt={type:"fadeIn"},mUt=n=>({type:n.growField==="angle"?"growAngleIn":"growRadiusIn"}),vUt=n=>({type:n.growField==="angle"?"growAngleOut":"growRadiusOut"}),_Ut=n=>({type:n.growField==="angle"?"growAngleOut":"growRadiusOut"});function bUt(n,t){if(t===!1)return{};switch(t){case"fadeIn":return fUt;case"growAngle":return e7(Object.assign(Object.assign({},n),{growField:"angle"}));default:return e7(Object.assign(Object.assign({},n),{growField:"radius"}))}}const yUt=()=>{q.registerAnimation("rose",(n,t)=>({appear:bUt(n,t),enter:mUt(n),exit:vUt(n),disappear:_Ut(n)}))};class Vnt extends Lb{getStackGroupFields(){return this._angleField}getStackValueField(){return Q(this._spec.valueField)[0]||Q(this._spec.radiusField)[0]}getGroupFields(){return this._angleField}setAttrFromSpec(){super.setAttrFromSpec(),this.setAngleField(this._spec.categoryField||this._spec.angleField),this.setRadiusField(this._spec.valueField||this._spec.radiusField),this._specAngleField=this._angleField.slice(),this._specRadiusField=this._radiusField.slice(),this.setInnerRadiusField(this._spec.valueField||this._spec.radiusField),this.getStack()&&this.setValueFieldToStack(),this.getPercent()&&this.setValueFieldToPercent()}setValueFieldToStack(){this.setRadiusField(Wr),this.setInnerRadiusField(To)}setValueFieldToPercent(){this.setRadiusField(Od),this.setInnerRadiusField(kc)}getDimensionField(){return this._specAngleField}getMeasureField(){return this._specRadiusField}getDefaultShapeType(){return"square"}}const CUt=Object.assign(Object.assign({},Hi),{rose:{name:"rose",type:"arc"}});class Gnt extends Ar{constructor(){super(...arguments),this._supportStack=!0}_transformLabelSpec(t){this._addMarkLabelSpec(t,"rose")}}var i7=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class dA extends nH{get center(){return this._center}get startAngle(){return this._startAngle}get endAngle(){return this._endAngle}getOrient(){return this._orient}getDefaultInteractive(){return this._orient!=="angle"}getGroupScales(){return this._groupScales}static getSpecInfo(t){if(!t[this.specKey])return null;const e=V(t[this.specKey]),i=e?t[this.specKey]:[t[this.specKey]],r=[];let s,o;const a=[],l=[];return i.forEach((h,d)=>{if(!ZGt(h))return;const{axisType:u,componentName:c,startAngle:g,endAngle:p,center:f,outerRadius:m,layoutRadius:v}=cUt(h,t);h.center=f,h.startAngle=g,h.endAngle=p,h.outerRadius=m,h.type=u,h.layoutRadius=v;const _={spec:h,specPath:e?[this.specKey,d]:[this.specKey],specInfoPath:["component",this.specKey,d],type:c};r.push(_),h.orient==="radius"?(a.push(_),o=d):(l.push(_),s=d)}),a.forEach(h=>{h.angleAxisIndex=s}),l.forEach(h=>{h.radiusAxisIndex=o}),r}static createComponent(t,e){const{spec:i}=t,r=i7(t,["spec"]),s=q.getComponentInKey(r.type);return s?new s(i,Object.assign(Object.assign({},e),r)):(e.onError(`Component ${r.type} not found`),null)}constructor(t,e){super(t,e),this.type=vt.polarAxis,this.name=vt.polarAxis,this._defaultBandPosition=0,this._defaultBandInnerPadding=0,this._defaultBandOuterPadding=0,this.layoutType="absolute",this.layoutZIndex=Qe.Axis,this._tick=void 0,this._center=null,this._startAngle=ST,this._endAngle=PF,this._orient="radius",this._groupScales=[],this.effect={scaleUpdate:i=>{this.computeData(i==null?void 0:i.value),Oi(this._regions,r=>{this.getOrient()==="radius"?oo(r.radiusAxisHelper,this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&(r.radiusAxisHelper=this.axisHelper()):oo(r.angleAxisHelper,this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&(r.angleAxisHelper=this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._transformLayoutPosition=i=>{var r;const s=(r=this.getRegions())===null||r===void 0?void 0:r[0];return s?s.getLayoutStartPoint():i},this.getCenter=()=>{var i,r;const s=this.getRefLayoutRect(),{width:o,height:a}=s;return{x:Gi((i=this._center)===null||i===void 0?void 0:i.x,o,s,o/2),y:Gi((r=this._center)===null||r===void 0?void 0:r.y,a,s,a/2)}},this.getRefLayoutRect=()=>this.getRegions()[0].getLayoutRect(),this._coordinateType="polar"}setAttrFromSpec(){super.setAttrFromSpec(),this.visible&&(this._axisStyle=this._getAxisAttributes(),this._gridStyle=this._getGridAttributes()),this._tick=this._spec.tick,this._orient=this._spec.orient==="angle"?"angle":"radius",this._center=this._spec.center,this._startAngle=Te(this._spec.startAngle),this._endAngle=Te(this._spec.endAngle),this._inverse=this._spec.inverse}onRender(t){}changeRegions(){}_tickTransformOption(){var t;return Object.assign(Object.assign({},super._tickTransformOption()),{noDecimal:(t=this._tick)===null||t===void 0?void 0:t.noDecimals,startAngle:this.startAngle,labelOffset:iH(this._spec),getRadius:()=>this.getOuterRadius(),inside:this._spec.inside})}updateScaleRange(){const t=this._scale.range();let e;return e=this.getOrient()==="radius"?this._inverse?[this.computeLayoutOuterRadius(),this.computeLayoutInnerRadius()]:[this.computeLayoutInnerRadius(),this.computeLayoutOuterRadius()]:this._inverse?[this._endAngle,this._startAngle]:[this._startAngle,this._endAngle],(!t||!e||t[0]!==e[0]||t[1]!==e[1])&&(this._scale.range(e),!0)}collectSeriesField(t,e){var i,r;let s;return s=t>0?(r=(i=e.getGroups())===null||i===void 0?void 0:i.fields)===null||r===void 0?void 0:r[t]:this.getOrient()==="radius"?e.getRadiusField():e.getAngleField(),s}updateSeriesScale(){Oi(this._regions,t=>{this.getOrient()==="radius"?oo(t.radiusAxisHelper,this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&(t.setRadiusScale(this._scale),t.radiusAxisHelper=this.axisHelper()):oo(t.angleAxisHelper,this.axisHelper(),L(this._seriesUserId)||L(this._seriesIndex))&&(t.setAngleScale(this._scale),t.angleAxisHelper=this.axisHelper())},{userId:this._seriesUserId,specIndex:this._seriesIndex})}getSeriesStatisticsField(t){const e=this.getOrient()==="radius"?t.getRadiusField():t.getAngleField();return Je(this._scale.type)?e:[e[0]]}initGroupScales(){}axisHelper(){return{isContinuous:Je(this._scale.type),dataToPosition:this.dataToPosition.bind(this),coordToPoint:this.coordToPoint.bind(this),pointToCoord:this.pointToCoord.bind(this),center:this.getCenter.bind(this),layoutRadius:this._computeLayoutRadius.bind(this),getScale:(t=0)=>this._scales[t],getAxisId:()=>this.id,getSpec:()=>this._spec}}positionToData(t){const e=this.pointToCoord(t);return this.getOrient()==="radius"?this.invert(e.radius):this.invert(e.angle)}coordToPoint(t){const e=this.getCenter();return ui(e,t.radius,t.angle)}pointToCoord(t){const e=this.getCenter(),i=this._startAngle,r=this._endAngle;return k_(t,e,i,r)}getOuterRadius(){return this.computeLayoutOuterRadius()}getInnerRadius(){return this.computeLayoutInnerRadius()}updateLayoutAttribute(){this._visible&&(this.getOrient()==="radius"?this._layoutRadiusAxis():this._layoutAngleAxis()),super.updateLayoutAttribute()}_getNormalizedValue(t,e){return e===0?0:(this.dataToPosition(t)-this._getStartValue())/e}getLabelItems(t){var e;const i=(e=this.getTickData())===null||e===void 0?void 0:e.getLatestData();return i&&i.length?[i.map(r=>wf(r.value,this._getNormalizedValue([r.value],t)))]:[]}_getStartValue(){return this.getOrient()==="radius"?this.computeLayoutInnerRadius():this._startAngle}_layoutAngleAxis(){var t,e,i;const r=this.getCenter(),s=this.computeLayoutOuterRadius(),o=this.computeLayoutInnerRadius(),a=this._endAngle-this._startAngle,l=this.getLabelItems(a),h=Object.assign(Object.assign({},this.getLayoutStartPoint()),{inside:this._spec.inside,center:r,radius:s,innerRadius:o,startAngle:this._startAngle,endAngle:this._endAngle,sides:!((i=(e=(t=this._getRelatedAxis(this._option.radiusAxisIndex))===null||t===void 0?void 0:t.getSpec())===null||e===void 0?void 0:e.grid)===null||i===void 0)&&i.smooth?void 0:this.getScale().domain().length}),d=Object.assign(Object.assign({},h),{size:this.getRefLayoutRect(),title:{text:this._spec.title.text||this._dataFieldText},items:l,orient:"angle"});this._spec.grid.visible&&(d.grid=Object.assign({type:"line",smoothLink:!0,items:l[0]},h)),this._update(d)}_layoutRadiusAxis(){var t,e,i;const r=this.getCenter(),s=this.computeLayoutOuterRadius(),o=this.computeLayoutInnerRadius(),a=this.coordToPoint({angle:this._startAngle,radius:s}),l=this.coordToPoint({angle:this._startAngle,radius:o}),h=hi.distancePP(l,a),d=this.getLabelItems(h),u=Object.assign(Object.assign({},this.getLayoutStartPoint()),{start:l,end:a,verticalFactor:-1}),c=Object.assign(Object.assign({},u),{title:{text:this._spec.title.text||this._dataFieldText},items:d,orient:"radius"});!((t=this._spec.grid)===null||t===void 0)&&t.visible&&(c.grid=Object.assign({items:d[0],type:!((e=this._spec.grid)===null||e===void 0)&&e.smooth?"circle":"polygon",center:r,closed:!0,sides:(i=this._getRelatedAxis(this._option.angleAxisIndex))===null||i===void 0?void 0:i.getScale().domain().length,startAngle:this._startAngle,endAngle:this._endAngle},u)),this._update(c)}_getRelatedAxis(t){if(L(t))return this._option.getComponentByIndex(this.specKey,t)}_computeLayoutRadius(){return jnt(()=>this._spec.layoutRadius,this.getRefLayoutRect,this.getCenter,()=>({startAngle:this._startAngle,endAngle:this._endAngle}))}computeLayoutOuterRadius(){var t;const e=(t=this._spec.outerRadius)!==null&&t!==void 0?t:this._spec.radius,i=e??this.getRefSeriesRadius().outerRadius;return this._computeLayoutRadius()*i}computeLayoutInnerRadius(){var t;const e=(t=this._spec.innerRadius)!==null&&t!==void 0?t:this.getRefSeriesRadius().innerRadius;return this._computeLayoutRadius()*e}getRefSeriesRadius(){let t=Uw,e=0;const i=this.getChart().getSpec();return Oi(this.getRegions(),r=>{const s=r;if($Gt(s.type)){const{outerRadius:o=i.outerRadius,innerRadius:a=i.innerRadius}=s;et(o)&&(t=o),et(a)&&(e=a)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),{outerRadius:t,innerRadius:e}}_update(t){const{grid:e}=t,i=i7(t,["grid"]);this._axisMark.getProduct().encode(Nt({},this._axisStyle,i)),this._gridMark&&this._gridMark.getProduct().encode(Nt({},this._gridStyle,e))}invert(t){var e;if(this.getOrient()==="angle"&&this._scale.type==="band"){const i=this._scale.range(),r=i[i.length-1]-i[0],s=((e=this.getSpec().bandPosition)!==null&&e!==void 0?e:this._defaultBandPosition)===.5?0:this._scale.bandwidth()/2;if(i[0]<0){const o=(t+s+Math.abs(i[0]))%r-Math.abs(i[0]);return this._scale.invert(o)}return this._scale.invert((t+s)%r)}return this._scale.invert(t)}}dA.type=vt.polarAxis,dA.specKey="axes";class Yv extends dA{constructor(){super(...arguments),this.type=vt.polarLinearAxis,this._zero=!0,this._nice=!0,this._extend={},this._scale=new Vs}setAttrFromSpec(){super.setAttrFromSpec(),this.setExtraAttrFromSpec()}initScales(){super.initScales(),this.setScaleNice()}computeDomain(t){return this.computeLinearDomain(t)}axisHelper(){const t=super.axisHelper();return t.setExtendDomain=this.setExtendDomain.bind(this),t}registerTicksTransform(){const t=`${this.type}-ticks`;return Vt(this._option.dataSet,t,Cb),t}}Yv.type=vt.polarLinearAxis,Yv.specKey="axes",Ye(Yv,WT);const Kf=()=>{Jc(),Qc(),_it(),Cit(),tg(),q.registerComponent(Yv.type,Yv)};class Xv extends dA{constructor(){super(...arguments),this.type=vt.polarBandAxis,this._scale=new qc}computeDomain(t){return this.computeBandDomain(t)}updateScaleRange(){const t=super.updateScaleRange();return this.updateGroupScaleRange(),t}axisHelper(){const t=super.axisHelper();return Object.assign(Object.assign({},t),{getBandwidth:e=>t.getScale(e).bandwidth()})}initScales(){super.initScales(),this.calcScales(this._defaultBandInnerPadding,this._defaultBandOuterPadding)}registerTicksTransform(){const t=`${this.type}-ticks`;return Vt(this._option.dataSet,t,RHt),t}transformScaleDomain(){}}Xv.type=vt.polarBandAxis,Xv.specKey="axes",Ye(Xv,unt);const Ib=()=>{Jc(),Qc(),_it(),Cit(),tg(),q.registerComponent(Xv.type,Xv)};class bd extends Vnt{constructor(){super(...arguments),this.type=gt.rose,this.transformerConstructor=Gnt,this._roseMark=null,this._labelMark=null}initMark(){this.initRoseMark()}initMarkStyle(){this.initRoseMarkStyle()}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.getCenter=()=>({x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y}),this._markAttributeContext.startAngleScale=t=>this.startAngleScale(t),this._markAttributeContext.endAngleScale=t=>this.endAngleScale(t)}initRoseMark(){var t,e;this._roseMark=this._createMark(bd.mark.rose,{groupKey:this._seriesField,isSeriesMark:!0,stateSort:(t=this._spec.rose)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.rose)===null||e===void 0?void 0:e.customShape,morph:ll(this._spec,bd.mark.rose.name),morphElementKey:this.getDimensionField()[0]})}getRoseAngle(){var t,e,i;return(i=(e=(t=this.angleAxisHelper).getBandwidth)===null||e===void 0?void 0:e.call(t,this._groups?this._groups.fields.length-1:0))!==null&&i!==void 0?i:.5}startAngleScale(t){return this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()))-.5*this.angleAxisHelper.getBandwidth(this.getGroupFields().length-1)}endAngleScale(t){return this.angleAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()))+this.getRoseAngle()-.5*this.angleAxisHelper.getBandwidth(this.getGroupFields().length-1)}initRoseMarkStyle(){const t=this._roseMark;t&&this.setMarkStyle(t,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:e=>this.startAngleScale(e),endAngle:e=>this.endAngleScale(e),fill:this.getColorAttribute(),outerRadius:e=>je(this.radiusAxisHelper.dataToPosition([e[this._radiusField[0]]]),this.radiusAxisHelper.getScale(0)),innerRadius:e=>{var i;if(!this.getStack())return 0;const r=je(this.radiusAxisHelper.dataToPosition([e[this._innerRadiusField[0]]]),this.radiusAxisHelper.getScale(0));return r<=Number.MIN_VALUE?this._computeLayoutRadius()*((i=this._spec.innerRadius)!==null&&i!==void 0?i:0):r}})}initTooltip(){super.initTooltip(),this._roseMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._roseMark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{text:e=>e[this.getDimensionField()[0]],fill:this.getColorAttribute(),z:0})}initAnimation(){var t,e,i;const r=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;if(this._roseMark){const s={innerRadius:()=>{var o;return this._computeLayoutRadius()*((o=this._spec.innerRadius)!==null&&o!==void 0?o:0)}};this._roseMark.setAnimationConfig(Ae((i=q.getAnimationInKey("rose"))===null||i===void 0?void 0:i(s,r),Fe("rose",this._spec,this._markAttributeContext)))}}getDefaultShapeType(){return"circle"}getActiveMarks(){return[this._roseMark]}}bd.type=gt.rose,bd.mark=CUt,bd.transformerConstructor=Gnt;const SUt=()=>{q.registerSeries(bd.type,bd),eg(),yUt(),Ib(),Kf()};class xUt extends fs{constructor(t,e,i,r,s){super(t,e,i,r,s),this._center=e.center,this._prevCenter=t.center,this._center&&this._prevCenter||(this.valid=!1)}getEndProps(){return this.valid===!1?{}:ui(this._center,this._toRadius,this._toAngle)}onBind(){const{angle:t,radius:e}=k_(this.from,this._prevCenter),{angle:i,radius:r}=k_(this.to,this._center);et(i*r)||(this.valid=!1),this._fromAngle=et(t)?t:i,this._fromRadius=et(e)?e:r,this._toAngle=i,this._toRadius=r,$w(this._fromAngle,this._toAngle)&&$w(this._fromRadius,this._toRadius)&&(this.valid=!1)}onUpdate(t,e,i){if(this.valid===!1)return i.x=this.to.x,void(i.y=this.to.y);if(t){const{x:r,y:s}=this.getEndProps();i.x=r,i.y=s,i.center=this._center}else{const{x:r,y:s}=ui({x:this._prevCenter.x+(this._center.x-this._prevCenter.x)*e,y:this._prevCenter.y+(this._center.y-this._prevCenter.y)*e},this._fromRadius+(this._toRadius-this._fromRadius)*e,this._fromAngle+(this._toAngle-this._fromAngle)*e);i.x=r,i.y=s}}}class wUt extends gQ{constructor(t,e,i,r,s){super(t,e,i,r,s),this._center=e.center,this._prevCenter=t.center}onUpdate(t,e,i){this.points=this.points.map((r,s)=>{const o=this.polarPointInterpolation(this.interpolatePoints[s][0],this.interpolatePoints[s][1],e);return t&&(i.center=this._center),o.context=r.context,o}),i.points=this.points}_interpolationSinglePoint(t,e,i){if(!xU(t)&&!xU(e))return e;const r=k_(t,this._prevCenter),s=k_(e,this._center);let o=Ka(r.angle),a=Ka(s.angle);!et(o)&&et(a)&&(o=a),et(o)&&!et(a)&&(a=o);const l=o+(a-o)*i,h=r.radius+(s.radius-r.radius)*i;return ui({x:this._prevCenter.x+(this._center.x-this._prevCenter.x)*i,y:this._prevCenter.y+(this._center.y-this._prevCenter.y)*i},h,l)}polarPointInterpolation(t,e,i){const{x:r,y:s}=this._interpolationSinglePoint(t,e,i),{x:o,y:a}=this._interpolationSinglePoint({x:t.x1,y:t.y1},{x:e.x1,y:e.y1},i),l=new Yt(r,s,o,a);return l.defined=e.defined,l}}const Unt=n=>({type:n==="in"?"fadeIn":"fadeOut"}),AUt=(n,t)=>({type:t==="in"?"growPointsIn":"growPointsOut",options:()=>({center:n.center()})});function rC(n,t,e){return t==="fadeIn"?Unt(e):AUt(n,e)}const MUt=(n,t)=>{const e=()=>{var o;return(o=n.center())===null||o===void 0?void 0:o.x},i=(o,a)=>a.getGraphicAttribute("x"),r=()=>{var o;return(o=n.center())===null||o===void 0?void 0:o.y},s=(o,a)=>a.getGraphicAttribute("y");return t==="in"?{channel:{x:{from:e,to:i},y:{from:r,to:s}}}:{channel:{x:{from:i,to:e},y:{from:s,to:r}}}};function n7(n,t,e){return t==="fadeIn"?Unt(e):MUt(n,e)}const r7=(n,t)=>({custom:nBt,customParameters:(e,i)=>{var r;return{group:i.getGraphicItem(),startAngle:(r=n.startAngle)!==null&&r!==void 0?r:Math.PI/2,orient:"clockwise",center:n.center(),radius:n.radius(),animationType:t}}}),TUt=()=>{q.registerAnimation("radar",(n,t)=>({appear:t==="clipIn"?void 0:rC(n,t,"in"),enter:rC(n,t,"in"),exit:rC(n,t,"out"),disappear:t==="clipIn"?void 0:rC(n,t,"out"),update:[{options:{excludeChannels:["points","defined","center"]}},{channel:["points","center"],custom:wUt,customParameters:n,duration:ja.update.duration,easing:ja.update.easing}]})),q.registerAnimation("radarSymbol",(n,t)=>({appear:t==="clipIn"?void 0:n7(n,t,"in"),enter:{type:"scaleIn"},exit:{type:"scaleOut"},disappear:t==="clipIn"?void 0:n7(n,t,"out"),update:[{options:{excludeChannels:["x","y","center"]}},{channel:["x","y","center"],custom:xUt,customParameters:n,duration:ja.update.duration,easing:ja.update.easing}]})),q.registerAnimation("radarGroup",(n,t)=>({appear:r7(n,"in"),disappear:r7(n,"out")})),Gf()},kUt=Object.assign(Object.assign(Object.assign({},Hi),Vh),{area:{name:"area",type:"area"}});class sd extends Vnt{constructor(){super(...arguments),this.type=gt.radar,this.transformerConstructor=Rb,this._sortDataByAxis=!1}initGroups(){}compile(){super.compile(),this.addOverlapCompile()}initMark(){var t,e,i,r;const s={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold},o=((t=this._spec.area)===null||t===void 0?void 0:t.visible)!==!1&&((i=(e=this._spec.area)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.visible)!==!1,a=(r=this._spec.seriesMark)!==null&&r!==void 0?r:"area";this.initAreaMark(s,o&&a==="area"),this.initLineMark(s,a==="line"||a==="area"&&!o),this.initSymbolMark(s,a==="point")}initMarkStyle(){this.initAreaMarkStyle(),this.initLineMarkStyle(),this.initSymbolMarkStyle(),[this._lineMark,this._symbolMark,this._areaMark].forEach(t=>{t&&this.setMarkStyle(t,{center:()=>{var e;return(e=this.angleAxisHelper)===null||e===void 0?void 0:e.center()}})})}initAreaMark(t,e){var i,r;this._areaMark=this._createMark(sd.mark.area,{groupKey:this._seriesField,isSeriesMark:e,stateSort:(i=this._spec.area)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},t),{setCustomizedShape:(r=this._spec.area)===null||r===void 0?void 0:r.customShape}))}initAreaMarkStyle(){const t=this._areaMark;t&&(this.setMarkStyle(t,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),x1:e=>e&&this.angleAxisHelper&&this.radiusAxisHelper?this.valueToPosition(this.getDatumPositionValues(e,this._angleField),this.getStack()?this.getDatumPositionValues(e,this._innerRadiusField):this.radiusScale.domain()[0]).x:Number.NaN,y1:e=>!e||!this.angleAxisHelper||!this.radiusAxisHelper?Number.NaN:this.valueToPosition(this.getDatumPositionValues(e,this._angleField),this.getStack()?this.getDatumPositionValues(e,this._innerRadiusField):this.radiusScale.domain()[0]).y,fill:this.getColorAttribute(),curveType:ant,closePath:!0},"normal",wt.Series),this._invalidType!=="zero"&&this.setMarkStyle(t,{defined:this._getInvalidDefined.bind(this),connectedType:this._getInvalidConnectType()},"normal",wt.Series),this.event.on(Ot.viewDataStatisticsUpdate,{filter:e=>e.model===this},()=>{this.encodeDefined(t,"defined")}))}initTooltip(){super.initTooltip();const{group:t,mark:e}=this._tooltipHelper.activeTriggerSet;this._lineMark&&t.add(this._lineMark),this._areaMark&&t.add(this._areaMark),this._symbolMark&&(e.add(this._symbolMark),t.add(this._symbolMark))}initAnimation(){var t,e,i,r;const s={center:()=>{var a;return(a=this.angleAxisHelper)===null||a===void 0?void 0:a.center()},radius:()=>{const a=this.getLayoutRect();return Math.min(a.width,a.height)},startAngle:L(this._spec.startAngle)?Te(this._spec.startAngle):ST},o=(i=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset)!==null&&i!==void 0?i:"clipIn";o==="clipIn"&&this._rootMark&&this._rootMark.setAnimationConfig(Ae((r=q.getAnimationInKey("radarGroup"))===null||r===void 0?void 0:r(s,o),Fe("group",this._spec,this._markAttributeContext))),[[this._areaMark,"radar"],[this._lineMark,"radar"],[this._symbolMark,"radarSymbol"]].forEach(([a,l])=>{if(L(a)){const h=q.getAnimationInKey(l);a.setAnimationConfig(Ae(h==null?void 0:h(s,o),Fe(a.name,this._spec,this._markAttributeContext)))}})}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._areaMark,this._symbolMark,this._lineMark]}getSeriesStyle(t){return e=>{var i,r,s,o;let a=(r=(i=this._seriesMark)===null||i===void 0?void 0:i.getAttribute(e,t))!==null&&r!==void 0?r:void 0;return e!=="fill"||a||(e="stroke",a=(o=(s=this._seriesMark)===null||s===void 0?void 0:s.getAttribute(e,t))!==null&&o!==void 0?o:void 0),e==="stroke"&&V(a)?a[0]:a}}}sd.type=gt.radar,sd.mark=kUt,sd.transformerConstructor=Rb,Ye(sd,tH);const RUt=()=>{q.registerSeries(sd.type,sd),jT(),HT(),vh(),TUt(),Ib(),Kf()};class BUt extends wr{constructor(){super(...arguments),this.shapeTypeCallback=()=>"square"}enableByType(t){return t==="mark"}getDefaultTitlePattern(t){return{key:"event info",value:"event info"}}getDefaultContentList(){return[{key:t=>t.type,value:t=>t.id},{key:"event_time",value:t=>Xo.getInstance().timeFormat("%Y%m%d",t.event_time)},{key:"action_type",value:t=>t.action_type},{key:"children",value:t=>t.children}]}getTooltipData(t,e,i,r,s){var o,a,l,h;const d=super.getTooltipData(t,e,i,r,s),u=(l=(a=(o=this.spec)===null||o===void 0?void 0:o[t])===null||a===void 0?void 0:a.updateContent)!==null&&l!==void 0?l:(h=e==null?void 0:e[t])===null||h===void 0?void 0:h.updateContent;return d&&!u&&(d.updateContent=(c,g,p)=>{const f=[],m=c.filter(v=>v.key==="children");return m.length>0&&m[0].value.forEach(v=>{let _=!0;for(const b in v)f.push(Object.assign(Object.assign({},m[0]),{shapeType:"circle",hasShape:_,key:b,value:v[b]+""})),_=!1}),c.concat(f)}),d}}const PUt=(n,t)=>{var e;const i=!((e=n[0])===null||e===void 0)&&e.latestData?n[0].latestData:n||[],r=[];return i.forEach(s=>{const o={};for(const l in s)l!==t&&(o[l]=s[l]);const a=s[t];a==null||a.forEach(l=>{r.push(Object.assign({},o,l))})}),r},EUt={fill:"#bbb",fillOpacity:.2},LUt=Object.assign(Object.assign({},Hi),{group:{name:"group",type:"group"},grid:{name:"grid",type:"rule"},gridBackground:{name:"gridBackground",type:"rect"},dot:{name:"dot",type:"symbol"},title:{name:"title",type:"text"},subTitle:{name:"subTitle",type:"text"},symbol:{name:"symbol",type:"symbol"}});class Es extends Po{constructor(){super(...arguments),this.type=gt.dot}getSeriesGroupField(){return this._seriesField}setSeriesGroupField(t){L(t)&&(this._seriesGroupField=t)}getTitleField(){return this._titleField}setTitleField(t){L(t)&&(this._titleField=t)}getSubTitleField(){return this._subTitleField}setSubTitleField(t){L(t)&&(this._subTitleField=t)}getDotTypeField(){return this._dotTypeField}setDotTypeField(t){L(t)&&(this._dotTypeField=t)}getHighLightSeriesGroup(){return this._highLightSeriesGroup}setHighLightSeriesGroup(t){L(t)&&(this._highLightSeriesGroup=t)}setGridBackground(t){L(t)&&(this._gridBackground=t)}initData(){var t;super.initData(),this._xDimensionStatisticsDomain=this.getRawData().latestData.map(e=>e[this._fieldY[0]]),Vt(this._option.dataSet,"objFlat",PUt),Vt(this._option.dataSet,"copyDataView",BT),Xl(this._option.dataSet,"dataview",LM),(t=this.getViewData())===null||t===void 0||t.transform({type:"objFlat",options:"dots",level:oa.dotObjFlat},!1)}getStatisticFields(){return[{key:this._fieldY[0],operations:["values"],customize:this._xDimensionStatisticsDomain}]}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setSeriesGroupField(this._spec.seriesGroupField),this.setTitleField(this._spec.titleField),this.setSubTitleField(this._spec.subTitleField),this.setDotTypeField(this._spec.dotTypeField),this.setHighLightSeriesGroup(this._spec.highLightSeriesGroup),this.setGridBackground(Nt(EUt,((t=this._spec.grid)===null||t===void 0?void 0:t.background)||{}))}initMark(){this._clipMark=this._createMark(Es.mark.group),this._containerMark=this._createMark(Es.mark.group,{parent:this._clipMark,dataView:this.getRawData()}),this._gridBackgroundMark=this._createMark(Es.mark.gridBackground,{parent:this._containerMark,dataView:this.getRawData()}),this._gridMark=this._createMark(Es.mark.grid,{parent:this._containerMark,dataView:this.getRawData()}),this._dotMark=this._createMark(Es.mark.dot,{skipBeforeLayouted:!1,isSeriesMark:!0,parent:this._containerMark}),this._titleMark=this._createMark(Es.mark.title,{parent:this._containerMark,dataView:this.getRawData()}),this._subTitleMark=this._createMark(Es.mark.subTitle,{parent:this._containerMark,dataView:this.getRawData()}),this._symbolMark=this._createMark(Es.mark.symbol,{parent:this._containerMark,dataView:this.getRawData()})}initMarkStyle(){const t=this._clipMark;t&&(this.setMarkStyle(t,{x:-this._spec.leftAppendPadding,y:0,width:1e4,height:this._spec.clipHeight},"normal",wt.Series),t.setMarkConfig({interactive:!1,clip:!0}));const e=this._containerMark;e&&(this.setMarkStyle(e,{x:this._spec.leftAppendPadding},"normal",wt.Series),e.setMarkConfig({interactive:!1}));const i=this._gridBackgroundMark;i&&this.setMarkStyle(i,{x:this.getRegionRectLeft.bind(this),x1:this.getRegionRectRight.bind(this),y:this.dataToGridBackgroundPositionY.bind(this),y1:this.dataToGridBackgroundPositionY1.bind(this),fill:this._gridBackground.fill,fillOpacity:this.dataToGridBackgroundOpacity.bind(this)},"normal",wt.Series);const r=this._gridMark;r&&this.setMarkStyle(r,{stroke:this.getColorAttribute(),x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this),x1:this.getRegionRectRight.bind(this),y1:this.dataToPositionY.bind(this)},"normal",wt.Series);const s=this._dotMark;s&&this.setMarkStyle(s,{x:this.dataToPositionX.bind(this),y:this.dataToPositionY.bind(this),fill:this.getDotColorAttribute(),fillOpacity:this.dataToOpacity.bind(this)},"normal",wt.Series);const o=this._titleMark;o&&this.setMarkStyle(o,{fill:this.getColorAttribute(),text:h=>h[this.getTitleField()],x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this)},"normal",wt.Series);const a=this._subTitleMark;a&&this.setMarkStyle(a,{fill:this.getColorAttribute(),text:h=>h[this.getSubTitleField()],x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this)},"normal",wt.Series);const l=this._symbolMark;l&&this.setMarkStyle(l,{x:this.getRegionRectLeft.bind(this),y:this.dataToPositionY.bind(this),fill:this.getColorAttribute()},"normal",wt.Series)}dataToGridBackgroundPositionY(t){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:e,getBandwidth:i}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._fieldY),{bandPosition:this._bandPosition})-i(0)/2}dataToGridBackgroundPositionY1(t){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:e,getBandwidth:i}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._fieldY),{bandPosition:this._bandPosition})+i(0)/2}dataToOpacity(t){var e,i,r,s;if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:o,getScale:a}=this._xAxisHelper;return o(this.getDatumPositionValues(t,this._fieldX),{bandPosition:this._bandPosition})<a(0).range()[0]||o(this.getDatumPositionValues(t,this._fieldX),{bandPosition:this._bandPosition})>a(0).range()[1]?0:(s=(r=(i=(e=this._theme)===null||e===void 0?void 0:e.dot)===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.fillOpacity)!==null&&s!==void 0?s:1}dataToGridBackgroundOpacity(t){return t[this._seriesGroupField]===this._highLightSeriesGroup?this._gridBackground.fillOpacity:0}onLayoutEnd(t){var e,i;super.onLayoutEnd(t);const r=(i=(e=this._spec)===null||e===void 0?void 0:e.leftAppendPadding)!==null&&i!==void 0?i:0;this.setMarkStyle(this._clipMark,{width:this.getLayoutRect().width+r},"normal",wt.Series)}getDefaultColorDomain(){var t,e;return this._seriesGroupField?(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._seriesGroupField].values:this._seriesField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesField].values:[]}getColorAttribute(){var t,e,i;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:(i=(e=this._seriesGroupField)!==null&&e!==void 0?e:this._seriesField)!==null&&i!==void 0?i:Fr}}getDotColorScale(){var t,e,i;const r=this._dotTypeField?(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._dotTypeField].values:this._seriesGroupField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesGroupField].values:this._seriesField?(i=this.getViewDataStatistics())===null||i===void 0?void 0:i.latestData[this._seriesField].values:[],s=this._getDataScheme();return new Ab().domain(r).range(s)}getDotColorAttribute(){var t,e,i,r;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this.getDotColorScale(),field:(r=(i=(e=this._dotTypeField)!==null&&e!==void 0?e:this._seriesGroupField)!==null&&i!==void 0?i:this._seriesField)!==null&&r!==void 0?r:Fr}}initTooltip(){this._tooltipHelper=new BUt(this),this._dotMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._dotMark)}onEvaluateEnd(t){super.onEvaluateEnd(t)}onMarkTreePositionUpdate(t){t.forEach(e=>{e.type==="group"?this.onMarkTreePositionUpdate(e.getMarks()):e.updateLayoutState()})}getDotData(){var t;return(t=this._dotMark)===null||t===void 0?void 0:t.getData()}_getDataIdKey(){}getStackValueField(){return null}getActiveMarks(){return[this._dotMark]}}Es.type=gt.dot,Es.mark=LUt;const IUt=()=>{vh(),Xf(),_h(),_s(),q.registerSeries(Es.type,Es)};class OUt extends wr{constructor(){super(...arguments),this.shapeTypeCallback=()=>"square"}enableByType(t){return t==="mark"}getDefaultTitlePattern(t){return{key:"link info",value:"link info"}}getDefaultContentList(){return[{key:"time",value:t=>Xo.getInstance().timeFormat("%Y%m%d %H:%M",t.from.split("_")[1])},{key:"type",value:t=>t.action_type},{key:"from",value:t=>t.from},{key:"to",value:t=>t.to}]}}const DUt=Object.assign(Object.assign({},Hi),{group:{name:"group",type:"group"},link:{name:"link",type:"rule"},arrow:{name:"arrow",type:"symbol"}}),FUt=(n,t)=>{const{infoKey:e,fields:i,linkData:r,dotData:s}=t,{fromField:o,toField:a,xField:l,yField:h}=i(),d=r(),u=s(),c={};return u.forEach(g=>{const p={};for(const m in g)m!==e&&(p[m]=g[m]);const f=g[e];f==null||f.forEach(m=>{c[m.node_name]=Object.assign({},p,m)})}),d.forEach(g=>{var p,f,m,v;g[o+"_xField"]=(p=c==null?void 0:c[g[o]])===null||p===void 0?void 0:p[l],g[o+"_yField"]=(f=c==null?void 0:c[g[o]])===null||f===void 0?void 0:f[h],g[a+"_xField"]=(m=c==null?void 0:c[g[a]])===null||m===void 0?void 0:m[l],g[a+"_yField"]=(v=c==null?void 0:c[g[a]])===null||v===void 0?void 0:v[h]}),d};class jl extends Po{constructor(){super(...arguments),this.type=gt.link}getFromField(){return this._fromField}setFromField(t){L(t)&&(this._fromField=t)}getToField(){return this._toField}setToField(t){L(t)&&(this._toField=t)}getDotTypeField(){return this._dotTypeField}setDotTypeField(t){L(t)&&(this._dotTypeField=t)}getDotSeriesSpec(){return this._dotSeriesSpec}setDotSeriesSpec(t){L(t)&&(this._dotSeriesSpec=t)}_getDotData(){const t=this._option.getChart().getSeriesInIndex([this._spec.dotSeriesIndex])[0];return t?t.getRawData().latestData:[]}initData(){var t;super.initData(),Vt(this._option.dataSet,"linkDotInfo",FUt),(t=this.getViewData())===null||t===void 0||t.transform({type:"linkDotInfo",options:{infoKey:"dots",fields:()=>({fromField:this._fromField,toField:this._toField,xField:this._dotSeriesSpec.xField,yField:this._dotSeriesSpec.yField}),linkData:()=>this._rawData.latestData,dotData:()=>this._getDotData()},level:oa.linkDotInfo},!1)}setAttrFromSpec(){super.setAttrFromSpec(),this.setFromField(this._spec.fromField),this.setToField(this._spec.toField),this.setDotTypeField(this._spec.dotTypeField),this.setDotSeriesSpec(this._spec.dotSeriesSpec)}initMark(){this._clipMark=this._createMark(jl.mark.group),this._containerMark=this._createMark(jl.mark.group,{parent:this._clipMark}),this._linkMark=this._createMark(jl.mark.link,{skipBeforeLayouted:!1,parent:this._containerMark}),this._arrowMark=this._createMark(jl.mark.arrow,{skipBeforeLayouted:!1,isSeriesMark:!0,parent:this._containerMark})}initMarkStyle(){var t,e,i,r;const s=this._clipMark;s&&(this.setMarkStyle(s,{x:-this._spec.leftAppendPadding,y:0,width:1e4,height:this._spec.clipHeight},"normal",wt.Series),s.setMarkConfig({interactive:!1,clip:!0}));const o=this._containerMark;o&&(this.setMarkStyle(o,{x:this._spec.leftAppendPadding,width:this.getLayoutRect().width},"normal",wt.Series),o.setMarkConfig({interactive:!1}));const a=this._linkMark;a&&this.setMarkStyle(a,{stroke:this.getColorAttribute(),strokeOpacity:this.dataToOpacity.bind(this),x:this.dataToPositionXFrom.bind(this),y:this.dataToPositionYFrom.bind(this),x1:this.dataToPositionXTo.bind(this),y1:this.dataToPositionYTo.bind(this)},"normal",wt.Series);const l=this._arrowMark;if(l){const h=(r=(i=(e=(t=this._theme)===null||t===void 0?void 0:t.arrow)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.size)!==null&&r!==void 0?r:10;this.setMarkStyle(l,{x:this.dataToPositionXTo.bind(this),y:d=>this.dataToPositionArrowYTo(d,h),fill:this.getColorAttribute(),fillOpacity:this.dataToOpacity.bind(this),size:h,symbolType:d=>this.isPositionYFromHigher(d)?"triangleDown":"triangleUp"},"normal",wt.Series)}}afterInitMark(){super.afterInitMark()}dataToPositionXFrom(t){if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:e}=this._xAxisHelper;return e(this.getDatumPositionValues(t,this._fromField+"_xField"),{bandPosition:this._bandPosition})}dataToPositionYFrom(t){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:e}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._fromField+"_yField"))}dataToPositionXTo(t){if(!this._xAxisHelper)return Number.NaN;const{dataToPosition:e}=this._xAxisHelper;return e(this.getDatumPositionValues(t,this._toField+"_xField"),{bandPosition:this._bandPosition})}dataToPositionYTo(t){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:e}=this._yAxisHelper;return e(this.getDatumPositionValues(t,this._toField+"_yField"),{bandPosition:this._bandPosition})}dataToPositionArrowYTo(t,e){if(!this._yAxisHelper)return Number.NaN;const{dataToPosition:i}=this._yAxisHelper,r=this.isPositionYFromHigher(t)?-e/2:e/2;return i(this.getDatumPositionValues(t,this._toField+"_yField"),{bandPosition:this._bandPosition})+r}dataToOpacity(t){return this.isPositionXOuterRange(t,this._fromField+"_xField")||this.isPositionXOuterRange(t,this._toField+"_xField")||t[this._fromField]===t[this._toField]?0:1}isPositionYFromHigher(t){return this.dataToPositionYFrom(t)<this.dataToPositionYTo(t)}isPositionXOuterRange(t,e){if(!this._xAxisHelper)return!1;const{dataToPosition:i,getScale:r}=this._xAxisHelper;return i(this.getDatumPositionValues(t,e),{bandPosition:this._bandPosition})<r(0).range()[0]||i(this.getDatumPositionValues(t,e),{bandPosition:this._bandPosition})>r(0).range()[1]}getDefaultColorDomain(){var t,e;return this._dotTypeField?(t=this.getViewDataStatistics())===null||t===void 0?void 0:t.latestData[this._dotTypeField].values:this._seriesField?(e=this.getViewDataStatistics())===null||e===void 0?void 0:e.latestData[this._seriesField].values:[]}getColorAttribute(){var t,e,i;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:(i=(e=this._dotTypeField)!==null&&e!==void 0?e:this._seriesField)!==null&&i!==void 0?i:Fr}}initInteraction(){const t=[];this._linkMark&&t.push(this._linkMark),this._arrowMark&&t.push(this._arrowMark),this._parseInteractionConfig(t)}initTooltip(){this._tooltipHelper=new OUt(this),this._linkMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._linkMark),this._arrowMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._arrowMark)}onMarkTreePositionUpdate(t){t.forEach(e=>{e.type==="group"?this.onMarkTreePositionUpdate(e.getMarks()):e.updateLayoutState()})}getDotInfoData(){var t,e;return(e=(t=this._linkMark)!==null&&t!==void 0?t:this._arrowMark)===null||e===void 0?void 0:e.getData()}getActiveMarks(){return[this._linkMark,this._arrowMark]}}jl.type=gt.link,jl.mark=DUt;const HUt=()=>{Xf(),vh(),vs(),ms(),q.registerSeries(jl.type,jl)},cH=Object.assign(Object.assign({},Hi),{group:{name:"group",type:"group"}});class qf extends Lb{constructor(){super(...arguments),this._arcGroupMark=null,this._getAngleValueStart=t=>{const e=this._getAngleAxis(),{tickMask:i}=this._spec;if(i!=null&&i.forceAlign&&this._isTickMaskVisible(e)){const r=t[this.getStack()?To:HC],s=this._getAngleAxisSubTickData(e),o=s[1].value-s[0].value,a=Te(i.offsetAngle);let l;if(L(r)){const h=Sz(s,u=>u.value-r),d=h>=s.length||r>s[h].value-o/2?Math.min(h,s.length-1):h>0?h-1:void 0;d!==void 0&&(l=this.angleAxisHelper.dataToPosition([s[d].value-o/2]))}return D(l)&&(l=this.angleAxisHelper.dataToPosition([s[0].value-o/2])),l+a}return this._getAngleValueStartWithoutMask(t)},this._getAngleValueEnd=t=>{const e=this._getAngleAxis(),{tickMask:i}=this._spec;if(i!=null&&i.forceAlign&&this._isTickMaskVisible(e)){const r=t[this.getStack()?Wr:this._angleField[0]],s=this._getAngleAxisSubTickData(e),o=s[1].value-s[0].value,a=Te(i.offsetAngle),l=Sz(s,u=>u.value-r),h=l>=s.length||r>s[l].value-o/2?Math.min(l,s.length-1):l>0?l-1:void 0;let d;return d=h!==void 0?this.angleAxisHelper.dataToPosition([s[h].value+o/2]):this.angleAxisHelper.dataToPosition([s[0].value-o/2]),d+a}return this._getAngleValueEndWithoutMask(t)}}setAttrFromSpec(){var t,e,i;super.setAttrFromSpec();const r=(t=this._option.globalInstance.getChart())===null||t===void 0?void 0:t.getSpec(),s=(e=this._spec.startAngle)!==null&&e!==void 0?e:r==null?void 0:r.startAngle;this._startAngle=L(s)?Te(s):ST;const o=(i=this._spec.endAngle)!==null&&i!==void 0?i:r==null?void 0:r.endAngle;this._endAngle=L(o)?Te(o):PF,this.setAngleField(this._spec.valueField||this._spec.angleField),this.setRadiusField(this._spec.categoryField||this._spec.radiusField),this._specAngleField=this._angleField.slice(),this._specRadiusField=this._radiusField.slice()}getStackGroupFields(){return this._radiusField}getStackValueField(){var t;return(t=this._angleField)===null||t===void 0?void 0:t[0]}getGroupFields(){return this._angleField}_convertMarkStyle(t){const e=super._convertMarkStyle(t);if(e.fill){const i=t.fill;(i==null?void 0:i.gradient)!=="conical"||L(i==null?void 0:i.startAngle)||L(i==null?void 0:i.endAngle)||(e.fill=Object.assign(Object.assign({},i),{startAngle:this._startAngle,endAngle:this._endAngle}))}return e}_getAngleValueStartWithoutMask(t){if(this.getStack()){const e=je(this.angleAxisHelper.dataToPosition([t[To]]),this.angleAxisHelper.getScale(0));if(et(e))return e}return this._startAngle}_getAngleValueEndWithoutMask(t){if(this.getStack()){const i=je(this.angleAxisHelper.dataToPosition([t[Wr]]),this.angleAxisHelper.getScale(0));if(et(i))return i}const e=this.angleAxisHelper.dataToPosition([t[this._angleField[0]]]);return this._spec.clamp?je(e,this.angleAxisHelper.getScale(0)):e}getDimensionField(){return this._specRadiusField}getMeasureField(){return this._specAngleField}initMark(){this._initArcGroupMark()}initMarkStyle(){this._initArcGroupMarkStyle()}_initArcGroupMark(){return this._arcGroupMark=this._createMark(qf.mark.group,{skipBeforeLayouted:!1}),this._arcGroupMark}_initArcGroupMarkStyle(){const t=this._arcGroupMark;t.created(),this.setMarkStyle(t,{x:0,y:0},"normal",wt.Series),this._arcGroupMark.setMarkConfig({interactive:!1,zIndex:this.layoutZIndex,clip:!0,clipPath:()=>{const e=this._getAngleAxis(),{x:i,y:r}=this.angleAxisHelper.center(),s=this._computeLayoutRadius();if(this._isTickMaskVisible(e)){const{tickMask:l}=this._spec,{angle:h,offsetAngle:d,style:u={}}=l,c=this._getAngleAxisSubTickData(e),g=u;return c.map(({value:p})=>{const f=this.angleAxisHelper.dataToPosition([p])+Te(d),m=Te(h)/2;return rF(Object.assign(Object.assign({},g),{x:i,y:r,startAngle:f-m,endAngle:f+m,innerRadius:s*this._innerRadius,outerRadius:s*this._outerRadius,fill:!0}))})}const{width:o,height:a}=this.getLayoutRect();return[mb({width:o,height:a,fill:!0})]}})}_getAngleAxis(){if(!this.angleAxisHelper)return;const t=this.angleAxisHelper.getAxisId();return this._option.getChart().getAllComponents().find(e=>e.id===t)}_getAngleAxisTickData(t){var e;return(e=t==null?void 0:t.getTickData())===null||e===void 0?void 0:e.getLatestData()}_isTickMaskVisible(t){const e=this._getAngleAxisTickData(t),{tickMask:i}=this._spec;return i&&i.visible!==!1&&(e==null?void 0:e.length)>1}_getAngleAxisSubTickData(t){var e;const i=this._getAngleAxisTickData(t),r=[],{subTick:s={},tick:o={}}=(e=t==null?void 0:t.getSpec())!==null&&e!==void 0?e:{},{tickCount:a=4}=s,{alignWithLabel:l}=o;if((i==null?void 0:i.length)>=2){const h=i[1].value-i[0].value;for(let d=0;d<i.length-1;d++){const u=i[d],c=i[d+1];r.push(u);for(let g=0;g<a;g++){const p=(g+1)/(a+1),f=(1-p)*u.value+p*(c?c.value:l?1:u.value+h);r.push({value:f})}}return r.push(i[i.length-1]),r}return i}}qf.mark=cH;const zUt=Object.assign(Object.assign({},cH),{track:{name:"track",type:"arc"},progress:{name:"progress",type:"arc"}}),WUt=n=>({type:"growAngleIn",options:{overall:n.startAngle}}),jUt={type:"fadeIn"};function NUt(n,t){return t==="fadeIn"?jUt:WUt(n)}const Ynt=()=>{q.registerAnimation("circularProgress",(n,t)=>({appear:NUt(n,t),enter:{type:"growAngleIn"},disappear:{type:"growAngleOut"}}))};class Xnt extends Ar{constructor(){super(...arguments),this._supportStack=!0}}class yd extends qf{constructor(){super(...arguments),this.type=gt.circularProgress,this.transformerConstructor=Xnt,this._progressMark=null,this._trackMark=null,this._getRadiusValueStart=t=>{if(this.getGroupFields().length>1){const e=this.radiusAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()));if(et(e))return e}return this.radiusAxisHelper.dataToPosition([t[this._radiusField[0]]])},this._getRadiusValueEnd=t=>{var e,i;if(this.getGroupFields().length>1){const r=this.radiusAxisHelper.dataToPosition(this.getDatumPositionValues(t,this.getGroupFields()))+((i=(e=this.radiusAxisHelper).getBandwidth)===null||i===void 0?void 0:i.call(e,this._groups?this._groups.fields.length-1:0));if(et(r))return r}return this.radiusAxisHelper.dataToPosition([t[this._radiusField[0]]])+this.radiusAxisHelper.getScale(0).step()}}getStackGroupFields(){return this.getGroupFields()}getGroupFields(){return this._radiusField}initMark(){super.initMark(),this._initTrackMark(),this._initProgressMark()}initMarkStyle(){super.initMarkStyle(),this._initTrackMarkStyle(),this._initProgressMarkStyle()}_initProgressMark(){var t,e;return this._progressMark=this._createMark(yd.mark.progress,{parent:this._arcGroupMark,isSeriesMark:!0,stateSort:(t=this._spec.progress)===null||t===void 0?void 0:t.stateSort},{morph:ll(this._spec,"progress"),setCustomizedShape:(e=this._spec.progress)===null||e===void 0?void 0:e.customShape}),this._progressMark}_initProgressMarkStyle(){var t;const e=this._progressMark;e&&this.setMarkStyle(e,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._getAngleValueStart,endAngle:this._getAngleValueEnd,innerRadius:this._getRadiusValueStart,outerRadius:this._getRadiusValueEnd,cap:(t=this._spec.roundCap)!==null&&t!==void 0&&t,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:200,forceShowCap:!0},"normal",wt.Series)}initInteraction(){const t=[];this._trackMark&&t.push(this._trackMark),this._progressMark&&t.push(this._progressMark),this._parseInteractionConfig(t)}initTooltip(){super.initTooltip(),this._progressMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._progressMark)}_initTrackMark(){var t,e;return this._trackMark=this._createMark(yd.mark.track,{parent:this._arcGroupMark,stateSort:(t=this._spec.track)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.track)===null||e===void 0?void 0:e.customShape}),this._trackMark.setMarkConfig({morph:!1,morphKey:null,morphElementKey:null}),this._trackMark}_initTrackMarkStyle(){const t=this._trackMark;t&&this.setMarkStyle(t,{visible:e=>{const i=this.angleAxisHelper.getScale(0).range(),r=Math.min(i[0],i[i.length-1]),s=this._getAngleValueStartWithoutMask(e);return Math.abs(s-r)<=1e-14},x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:()=>{const e=this.getStack()?To:this._angleField[0],i=this.angleAxisHelper.getScale(0).domain();return this._getAngleValueStart({[e]:i[0]})},endAngle:()=>{const e=this.getStack()?Wr:this._angleField[0],i=this.angleAxisHelper.getScale(0).domain();return this._getAngleValueEnd({[e]:i[i.length-1]})},innerRadius:this._getRadiusValueStart,outerRadius:this._getRadiusValueEnd,cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:100},"normal",wt.Series)}initAnimation(){var t,e,i,r;const s=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._progressMark.setAnimationConfig(Ae((i=q.getAnimationInKey("circularProgress"))===null||i===void 0?void 0:i({startAngle:this._startAngle},s),Fe("progress",this._spec,this._markAttributeContext))),this._trackMark.setAnimationConfig(Ae((r=q.getAnimationInKey("fadeInOut"))===null||r===void 0?void 0:r(),Fe("track",this._spec,this._markAttributeContext)))}getActiveMarks(){return[this._progressMark]}}yd.type=gt.circularProgress,yd.mark=zUt,yd.transformerConstructor=Xnt;const Knt=()=>{q.registerSeries(yd.type,yd),eg(),Ynt(),mh(),Ib(),Kf()};function qnt(n){return()=>n.direction==="vertical"?{orient:"negative"}:{orient:"positive"}}const $Ut=n=>({type:n.direction==="horizontal"?"growWidthIn":"growHeightIn",options:qnt(n)}),VUt=n=>({type:n.direction==="horizontal"?"growWidthOut":"growHeightOut",options:qnt(n)}),GUt={type:"fadeIn"};function UUt(n,t){return t===!1?{}:t==="fadeIn"?GUt:$Ut(n)}const YUt=()=>{q.registerAnimation("linearProgress",(n,t)=>({appear:UUt(n,t),enter:{type:"grow"},disappear:VUt(n)}))};class XUt extends wr{enableByType(t){return t!=="dimension"}}const KUt=Object.assign(Object.assign({},Hi),{track:{name:"track",type:"rect"},progress:{name:"progress",type:"rect"},group:{name:"group",type:"group"}});class jc extends Po{constructor(){super(...arguments),this.type=gt.linearProgress,this._progressMark=null,this._trackMark=null,this._defaultProgressCustomShape=(t,e,i)=>{var r,s;const o=(r=this._spec)===null||r===void 0?void 0:r.cornerRadius,a=L(e.width)?e.width:e.x1-e.x,l=L(e.height)?e.height:e.y1-e.y,h=Math.min(0,a),d=Math.max(0,a),u=Math.min(0,l),c=Math.max(0,l);if(o>0){let g=o;if(((s=this._spec)===null||s===void 0?void 0:s.direction)==="vertical"){if(g=Math.min(Math.abs(a/2),o),2*g>Math.abs(l)){const p=Math.acos((g-Math.abs(l)/2)/g);return i.moveTo(h+g,u),i.arc(h+g,u+g,g,1.5*Math.PI,1.5*Math.PI-p,!0),i.arc(h+g,c-g,g,p+Math.PI/2,Math.PI/2,!0),i.lineTo(d-o,c),i.arc(d-g,c-g,g,Math.PI/2,Math.PI/2-p,!0),i.arc(d-g,u+g,g,-Math.PI/2+p,-Math.PI/2,!0),i.lineTo(h+g,u),i.closePath(),i}}else if(g=Math.min(Math.abs(l/2),o),2*g>Math.abs(a)){const p=Math.acos((g-Math.abs(a)/2)/g);return i.moveTo(h,u+g),i.arc(h+g,u+g,g,Math.PI,Math.PI+p),i.arc(d-g,u+g,g,-p,0),i.lineTo(d,c-g),i.arc(d-g,c-g,g,0,p),i.arc(h+g,c-g,g,Math.PI-p,Math.PI),i.closePath(),i}i.moveTo(h,u+g),i.arc(h+g,u+g,g,Math.PI,1.5*Math.PI),i.lineTo(d-g,u),i.arc(d-g,u+g,g,-Math.PI/2,0),i.lineTo(d,c-g),i.arc(d-g,c-g,g,0,Math.PI/2),i.lineTo(h+g,c),i.arc(h+g,c-g,g,Math.PI/2,Math.PI),i.closePath()}else i.moveTo(h,u),i.lineTo(d,u),i.lineTo(d,c),i.lineTo(h,c),i.closePath();return i}}initMark(){this._initTrackMark(),this._initProgressMark()}initMarkStyle(){this._initTrackMarkStyle(),this._initProgressMarkStyle()}_initProgressMark(){var t,e,i;return this._progressMark=this._createMark(jc.mark.progress,{isSeriesMark:!0,stateSort:(t=this._spec.progress)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(i=(e=this._spec.progress)===null||e===void 0?void 0:e.customShape)!==null&&i!==void 0?i:this._defaultProgressCustomShape}),this._progressMark}_initProgressMarkStyle(){var t,e,i,r;const s=this._progressMark;if(s)if(this._spec.direction==="vertical"){const o=this._spec.progress||{},a=(t=o.leftPadding)!==null&&t!==void 0?t:0,l=(e=o.rightPadding)!==null&&e!==void 0?e:0;this.setMarkStyle(s,{x:h=>{var d,u;return je(this.dataToPositionX(h),(u=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||u===void 0?void 0:u.call(d,0),!0)-this._spec.bandWidth/2+a},y1:h=>{var d,u;return je(this.dataToPositionY(h),(u=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||u===void 0?void 0:u.call(d,0))},y:()=>{var h,d,u;const c=(h=this._yAxisHelper)===null||h===void 0?void 0:h.dataToPosition([0],{bandPosition:this._bandPosition});return this._spec.clamp?je(c,(u=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||u===void 0?void 0:u.call(d,0)):c},width:this._spec.bandWidth-a-l,cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute()},"normal",wt.Series)}else{const o=this._spec.progress||{},a=(i=o.topPadding)!==null&&i!==void 0?i:0,l=(r=o.bottomPadding)!==null&&r!==void 0?r:0;this.setMarkStyle(s,{x1:h=>{var d,u;return je(this.dataToPositionX(h),(u=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||u===void 0?void 0:u.call(d,0))},y:h=>{var d,u;return je(this.dataToPositionY(h),(u=(d=this._yAxisHelper)===null||d===void 0?void 0:d.getScale)===null||u===void 0?void 0:u.call(d,0),!0)-this._spec.bandWidth/2+a},height:this._spec.bandWidth-a-l,x:()=>{var h,d,u;const c=(h=this._xAxisHelper)===null||h===void 0?void 0:h.dataToPosition([0],{bandPosition:this._bandPosition});return this._spec.clamp?je(c,(u=(d=this._xAxisHelper)===null||d===void 0?void 0:d.getScale)===null||u===void 0?void 0:u.call(d,0)):c},cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute()},"normal",wt.Series)}}_initTrackMark(){var t,e;return this._trackMark=this._createMark(jc.mark.track,{stateSort:(t=this._spec.track)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.track)===null||e===void 0?void 0:e.customShape}),this._trackMark}_initTrackMarkStyle(){const t=this._trackMark;t&&(this._spec.direction==="vertical"?this.setMarkStyle(t,{x:e=>{var i,r;return je(this.dataToPositionX(e),(r=(i=this._xAxisHelper)===null||i===void 0?void 0:i.getScale)===null||r===void 0?void 0:r.call(i,0),!0)-this._spec.bandWidth/2},y:0,width:this._spec.bandWidth,height:()=>this._scaleY.range()[0],cornerRadius:this._spec.cornerRadius},"normal",wt.Series):this.setMarkStyle(t,{x:0,y:e=>{var i,r;return je(this.dataToPositionY(e),(r=(i=this._yAxisHelper)===null||i===void 0?void 0:i.getScale)===null||r===void 0?void 0:r.call(i,0),!0)-this._spec.bandWidth/2},height:this._spec.bandWidth,width:()=>this._scaleX.range()[1],cornerRadius:this._spec.cornerRadius},"normal",wt.Series))}initInteraction(){const t=[];this._trackMark&&t.push(this._trackMark),this._progressMark&&t.push(this._progressMark),this._parseInteractionConfig(t)}initAnimation(){var t,e,i,r;const s={direction:this.direction},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._progressMark.setAnimationConfig(Ae((i=q.getAnimationInKey("linearProgress"))===null||i===void 0?void 0:i(s,o),Fe("progress",this._spec,this._markAttributeContext))),this._trackMark.setAnimationConfig(Ae((r=q.getAnimationInKey("fadeInOut"))===null||r===void 0?void 0:r(),Fe("track",this._spec,this._markAttributeContext)))}initTooltip(){this._tooltipHelper=new XUt(this),this._progressMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._progressMark),this._trackMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._trackMark)}getActiveMarks(){return[this._progressMark]}}jc.type=gt.linearProgress,jc.mark=KUt;const qUt=()=>{_h(),YUt(),mh(),q.registerSeries(jc.type,jc)},s7=[0],ZUt="hidden",o7=20,JUt=[20,40],QUt=[200,500],t8t="circle",e8t={shrink:!1,enlarge:!1,fontSizeLimitMin:0},i8t=!0,a7=1,n8t=["triangleForward","triangle","diamond","square","star","cardioid","circle","pentagon","rect"],r8t=`${Wt}_WORD_CLOUD_TEXT`,s8t=Object.assign(Object.assign({},Hi),{word:{name:"word",type:"text"},fillingWord:{name:"fillingWord",type:"text"},wordMask:{name:"wordMask",type:"rect"}});class Nc extends zc{constructor(){super(...arguments),this._fontSizeRange=[o7,o7],this._isWordCloudShape=!1,this._dataChange=!0,this.handleMaskCanvasUpdate=(t,e)=>{this._maskCanvas=t},this.getWordColor=t=>t.isFillingWord?(this._fillingColorCallback&&!this._dataChange||(this._fillingColorCallback=this._wordCloudShapeConfig.fillingColorHexField?e=>e[this._wordCloudShapeConfig.fillingColorHexField]:this.initColorCallback(this._wordCloudShapeConfig.fillingSeriesField,!0)),this._fillingColorCallback(t)):(this._keyWordColorCallback&&!this._dataChange||(this._keyWordColorCallback=this._spec.colorHexField?e=>e[this._spec.colorHexField]:this.initColorCallback(this._seriesField,!1)),this._keyWordColorCallback(t)),this._calculateFontWeight=t=>{const e=this.getRawDataStatisticsByField(this._valueField,!0);return e.min===e.max?this._fontWeightRange[0]:this._fontWeightRange[0]+(this._fontWeightRange[this._fontWeightRange.length-1]-this._fontWeightRange[0])*(t[this._valueField]-e.min)/(e.max-e.min)}}setValueField(t){L(t)&&(this._valueField=t)}setFontSizeRange(t){L(t)?this._fontSizeRange=t:this._fontSizeRange=JUt}setAttrFromSpec(){var t,e,i,r,s;super.setAttrFromSpec(),this._padding=this._option.getChart().padding,this._nameField=this._spec.nameField,this._colorMode=(t=this._spec.colorMode)!==null&&t!==void 0?t:"ordinal",this._colorList=this._spec.colorList,this.setValueField(this._spec.valueField),this._fontWeightRange=(e=this._spec.fontWeightRange)!==null&&e!==void 0?e:QUt,this._rotateAngles=(i=this._spec.rotateAngles)!==null&&i!==void 0?i:s7,this.setFontSizeRange(this._spec.fontSizeRange),this._maskShape=(r=this._spec.maskShape)!==null&&r!==void 0?r:t8t,this._textField=!((s=this._spec.word)===null||s===void 0)&&s.formatMethod?r8t:this._nameField;const o=this._spec.wordCloudConfig;this._wordCloudConfig=Object.assign({drawOutOfBound:ZUt,layoutMode:"default",zoomToFit:e8t},this._spec.wordCloudConfig),o&&!D(o.layoutMode)||Ua(this._option.mode)||(this._wordCloudConfig.layoutMode="fast"),this._wordCloudShapeConfig=Object.assign({fillingSeriesField:this.getSeriesField(),fillingRotateAngles:s7,layoutMode:"default"},this._spec.wordCloudShapeConfig),this._isWordCloudShape=!n8t.includes(this._maskShape)&&!["fast","grid","cloud"].includes(this._wordCloudConfig.layoutMode),this._defaultFontFamily=this._option.getTheme().fontFamily}initData(){var t,e;super.initData(),(e=(t=this.getViewData())===null||t===void 0?void 0:t.target)===null||e===void 0||e.addListener("change",()=>{this._dataChange=!0,this.compile()})}initMark(){var t;!((t=this._spec.wordMask)===null||t===void 0)&&t.visible&&(this._maskMark=this._createMark(Nc.mark.wordMask,{dataView:!1})),this._wordMark=this._createMark(Nc.mark.word,{key:sa,groupKey:this._seriesField,isSeriesMark:!0},{morphElementKey:this._seriesField})}initMarkStyle(){this.initMarkStyleOfWord(this._wordMark,this._spec.word,this._spec.colorHexField,this._seriesField),this._maskMark&&this.setMarkStyle(this._maskMark,{width:()=>this._region.getLayoutRect().width,height:()=>this._region.getLayoutRect().height,background:()=>this._maskCanvas},"normal",wt.Series)}initMarkStyleOfWord(t,e,i,r,s){var o,a;t&&(this.setMarkStyle(t,{text:e!=null&&e.formatMethod?l=>e.formatMethod(l):l=>l[this._textField],x:l=>l.x,y:l=>l.y,fontSize:l=>l.fontSize,fontStyle:l=>l.fontStyle,angle:l=>l.angle,visible:l=>l.visible},"normal",wt.Series),this.setMarkStyle(t,{fill:(a=(o=e==null?void 0:e.style)===null||o===void 0?void 0:o.fill)!==null&&a!==void 0?a:this.getWordColor,fontWeight:l=>l.fontWeight,fontFamily:l=>l.fontFamily},"normal",wt.User_Mark))}initTooltip(){super.initTooltip(),this._wordMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._wordMark)}initAnimation(){[this._wordMark].forEach(t=>{var e,i;if(t){const r=(i=(e=this._spec)===null||e===void 0?void 0:e.animationAppear)===null||i===void 0?void 0:i.preset,s={animationConfig:()=>{var o,a;return(a=(o=t.getAnimationConfig())===null||o===void 0?void 0:o.appear)===null||a===void 0?void 0:a[0]}};t.setAnimationConfig(Ae(q.getAnimationInKey("wordCloud")(s,r),Fe("word",this._spec,this._markAttributeContext)))}})}getWordOrdinalColorScale(t,e){var i,r,s,o,a;const l=e?this._wordCloudShapeConfig.fillingColorList:this._colorList,h=t?(i=this.getViewData())===null||i===void 0?void 0:i.latestData.map(u=>u[t]):[],d=(s=l??((r=this._option.globalScale.getScale("color"))===null||r===void 0?void 0:r.range()))!==null&&s!==void 0?s:this._getDataScheme();return(a=(o=new Ab().domain(h)).range)===null||a===void 0?void 0:a.call(o,d)}initColorCallback(t,e){var i,r,s,o;if(this._colorMode==="ordinal"){const h=this.getWordOrdinalColorScale(t,e);return d=>h.scale(d[t??Fr])}const a=(i=e?this._colorList:this._wordCloudShapeConfig.fillingColorList)!==null&&i!==void 0?i:this._option.globalScale.getScale("color").range();if(a.length===1)return h=>a[0];if(this._valueField){const h=this.getRawDataStatisticsByField(this._valueField,!0);if(h.min===h.max)return a[0];const d=new Vs().domain([h.min,h.max]).range(a);return u=>d.scale(u[this._valueField])}const l=new Vs().domain([0,(o=(s=(r=this.getViewData())===null||r===void 0?void 0:r.latestData)===null||s===void 0?void 0:s.length)!==null&&o!==void 0?o:1]).range(a);return h=>l.scale(h[rr])}compile(){super.compile();const{width:t,height:e}=this._region.getLayoutRect();if(!et(t)||!et(e)||!(e>0&&t>0))return;const i=this._wordMark.getProduct();if(i){const r=[];this._isWordCloudShape?r.push(Object.assign({type:"wordcloudShape"},this._wordCloudShapeTransformOption())):r.push(Object.assign({type:"wordcloud"},this._wordCloudTransformOption())),i.transform(r)}}_getCommonTransformOptions(){var t,e,i,r,s,o;const{width:a,height:l}=this._region.getLayoutRect(),h=(t=this._spec.word)!==null&&t!==void 0?t:{},d=(e=h.style)!==null&&e!==void 0?e:{};return{size:[a,l],shape:kt(this._maskShape)&&this._maskShape.type==="text"&&D(this._maskShape.fontFamily)?Object.assign({fontFamily:(i=this._option.getTheme())===null||i===void 0?void 0:i.fontFamily},this._maskShape):this._maskShape,onUpdateMaskCanvas:this.handleMaskCanvasUpdate,dataIndexKey:sa,text:h.formatMethod?u=>h.formatMethod(u):{field:this._textField},fontSize:this._valueField?{field:this._valueField}:this._fontSizeRange[0],fontSizeRange:this._fontSizeRange==="auto"?null:this._fontSizeRange,padding:(s=(r=this._spec.word)===null||r===void 0?void 0:r.padding)!==null&&s!==void 0?s:a7,fontFamily:L(this._spec.fontFamilyField)?{field:this._spec.fontFamilyField}:(o=d.fontFamily)!==null&&o!==void 0?o:this._defaultFontFamily,fontWeight:L(this._spec.fontWeightField)?{field:this._spec.fontWeightField}:L(d.fontWeight)?d.fontWeight:L(this._valueField)?this._calculateFontWeight:"normal",fontStyle:L(this._spec.fontStyleField)?{field:this._spec.fontStyleField}:d.fontStyle}}_wordCloudTransformOption(){var t,e;const i=(t=this._wordCloudConfig)!==null&&t!==void 0?t:{};return Object.assign(Object.assign(Object.assign({},i),this._getCommonTransformOptions()),{layoutType:this._wordCloudConfig.layoutMode,rotate:this._rotateAngles,randomVisible:(e=this._spec.random)!==null&&e!==void 0?e:i8t,clip:this._wordCloudConfig.drawOutOfBound==="clip",shrink:this._wordCloudConfig.zoomToFit.shrink,enlarge:this._wordCloudConfig.zoomToFit.enlarge,minFontSize:this._wordCloudConfig.zoomToFit.fontSizeLimitMin,progressiveTime:this._wordCloudConfig.progressiveTime,progressiveStep:this._wordCloudConfig.progressiveStep,repeatFill:this._wordCloudConfig.zoomToFit.repeat})}_wordCloudShapeTransformOption(){var t,e,i,r,s,o;const a=(e=(t=this._spec.fillingWord)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{},l=(i=this._wordCloudShapeConfig)!==null&&i!==void 0?i:{};return Object.assign(Object.assign(Object.assign({},l),this._getCommonTransformOptions()),{rotateList:this._rotateAngles,fillingRotateList:l.fillingRotateAngles,fillingFontFamily:L(l.fillingFontFamilyField)?{field:l.fillingFontFamilyField}:(r=a.fontFamily)!==null&&r!==void 0?r:this._defaultFontFamily,fillingPadding:(o=(s=this._spec.fillingWord)===null||s===void 0?void 0:s.padding)!==null&&o!==void 0?o:a7,fillingFontStyle:L(l.fillingFontStyleField)?{field:l.fillingFontStyleField}:a.fontStyle,fillingFontWeight:L(l.fillingFontWeightField)?{field:l.fillingFontWeightField}:a.fontWeight})}getStatisticFields(){const t=[];return t.push({key:this._nameField,operations:["values"]}),t.push({key:this._valueField,operations:["max","min"]}),t}dataToPosition(t){return null}dataToPositionX(t){return null}dataToPositionY(t){return null}dataToPositionZ(t){return null}valueToPosition(t,e){return null}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}onLayoutEnd(t){super.onLayoutEnd(t),this.compile(),this._dataChange=!1}getActiveMarks(){return[this._wordMark]}reInit(){super.reInit(),this._keyWordColorCallback&&(this._keyWordColorCallback=null),this._fillingColorCallback&&(this._fillingColorCallback=null)}}Nc.mark=s8t;const o8t=n=>({custom:rBt,customParameters:(t,e)=>n,easing:"linear",loop:1/0,duration:6e3});function a8t(n,t,e){return n*e<t?n+(t-e*n)/(e-1):(t-n)/(e-1)}const l8t=n=>({channel:{fontSize:{from:0}},duration:200,delay:(t,e,i)=>{const r=n.animationConfig(),s=(r==null?void 0:r.duration)||200,o=(r==null?void 0:r.totalTime)||ja.appear.duration,a=i.VGRAMMAR_ANIMATION_PARAMETERS.elementCount;return i.VGRAMMAR_ANIMATION_PARAMETERS.elementIndex*a8t(s,o,a)}});function h8t(n,t){return t===!1?{}:t==="fadeIn"?{type:"fadeIn"}:l8t(n)}const Znt=()=>{q.registerAnimation("wordCloud",(n,t)=>({appear:h8t(n,t),enter:{type:"fadeIn"},exit:{type:"fadeOut"},disappear:{type:"fadeOut"}}))},Jnt=()=>{q.registerAnimation("wordCloud3d",n=>({enter:o8t(n)}))},l7=(n,t)=>"hsl("+(360*Math.random()).toFixed()+","+(30*Math.random()+70).toFixed()+"%,"+(Math.random()*(t-n)+n).toFixed()+"%)";function xu(n){return it(n)?n:function(){return n}}class Zf{constructor(t){var e,i;switch(this.options=Z({},Zf.defaultOptions,t),it(this.options.shape)?this.shape=this.options.shape:this.shape=QQ(this.options.shape),this.getText=(e=xu(this.options.text))!==null&&e!==void 0?e:r=>r,this.getTextFontWeight=xu(this.options.fontWeight),this.getTextFontSize=xu(this.options.fontSize),this.getTextFontStyle=xu(this.options.fontStyle),this.getTextFontFamily=xu(this.options.fontFamily),this.outputCallback=(i=this.options.outputCallback)!==null&&i!==void 0?i:r=>r,this.options.color){case"random-dark":this.getTextColor=()=>l7(10,50);break;case"random-light":this.getTextColor=()=>l7(50,90);break;default:this.getTextColor=xu(this.options.color)}if(D(this.options.rotate))if(this.options.useRandomRotate){const r=Math.abs(this.options.maxRotation-this.options.minRotation),s=Math.abs(Math.floor(this.options.rotationSteps)),o=Math.min(this.options.maxRotation,this.options.minRotation);this.getTextRotate=()=>this.options.rotateRatio===0||Math.random()>this.options.rotateRatio?0:r===0?o:s>0?o+Math.floor(Math.random()*s)*r/(s-1):o+Math.random()*r}else this.getTextRotate=()=>0;else this.getTextRotate=it(this.options.rotate)?r=>{var s;return Te((s=this.options.rotate(r))!==null&&s!==void 0?s:0)}:(r,s)=>{const o=Q(this.options.rotate),a=this.options.random?Math.random():flt(s);return Te(o[Math.floor(a*o.length)])}}canRepeat(){return!1}exceedTime(){var t;return this.options.progressiveStep>0?this.progressiveIndex>=(((t=this.currentStepIndex)!==null&&t!==void 0?t:-1)+1)*this.options.progressiveStep:this.options.progressiveTime>0&&new Date().getTime()-this.escapeTime>this.options.progressiveTime}progressiveRun(){var t;if(this.options.progressiveStep>0?this.currentStepIndex=((t=this.currentStepIndex)!==null&&t!==void 0?t:-1)+1:this.options.progressiveTime>0&&(this.escapeTime=Date.now()),this.data&&this.progressiveIndex<this.data.length){this.progressiveResult=[];let e=this.progressiveIndex,i=0;const r=this.options.maxSingleWordTryCount,s=Math.min(this.options.maxFailCount,this.originalData.length);for(;e<this.data.length&&this.failCount<s;){const o=this.layoutWord(e);if(i++,(o||i>r)&&(e++,i=0,this.failCount=o?0:this.failCount+1),this.progressiveIndex=e,this.exceedTime())break;e===this.data.length&&this.failCount<s&&this.options.repeatFill&&this.canRepeat()&&(this.data=[...this.data,...this.originalData.map(a=>Object.assign(Object.assign({},a),{isFill:!0}))],this.isTryRepeatFill=!0)}return this.progressiveResult}return this.result}initProgressive(){this.failCount=0,this.progressiveIndex=0,this.options.progressiveStep>0?this.currentStepIndex=-1:this.options.progressiveTime>0&&(this.escapeTime=Date.now()),this.progressiveResult=[]}output(){return this.result?this.outputCallback(this.result):null}progressiveOutput(){return this.progressiveResult?this.outputCallback(this.progressiveResult):null}unfinished(){return this.data&&this.data.length&&!D(this.progressiveIndex)&&this.progressiveIndex<this.data.length}release(){this.data=null,this.result=null,this.progressiveIndex=null,this.progressiveResult=null}}Zf.defaultOptions={fontFamily:'"Trebuchet MS", "Heiti TC", "", "Arial Unicode MS", "Droid Fallback Sans", sans-serif',fontWeight:"normal",color:"random-dark",fontStyle:"normal",minFontSize:12,drawOutOfBound:!1,shrink:!1,minRotation:-Math.PI/2,maxRotation:Math.PI/2,rotationSteps:0,rotateRatio:.1,random:!1,shape:"circle",progressiveTime:0,progressiveStep:0,repeatFill:!1,fillTextFontSize:12,maxFailCount:20};const h7={archimedean:d8t,rectangular:u8t};function d8t(n){const t=n[0]/n[1];return e=>[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}function u8t(n){const t=4*n[0]/n[1];let e=0,i=0;return r=>{const s=r<0?-1:1;switch(Math.sqrt(1+4*s*r)-s&3){case 0:e+=t;break;case 1:i+=4;break;case 2:e-=t;break;default:i-=4}return[e,i]}}class $p extends Zf{constructor(t){var e;super(Z({},$p.defaultOptions,t)),this.cw=64,this.ch=2048,this._size=[256,256],this._isBoardExpandCompleted=!1,this._placeStatus=0,this._tTemp=null,this._dtTemp=null,this._dy=0,this.cacheMap=new Map,this.options.minFontSize<=$p.defaultOptions.minFontSize&&(this.options.minFontSize=$p.defaultOptions.minFontSize),this.spiral=yt(this.options.spiral)?(e=h7[this.options.spiral])!==null&&e!==void 0?e:h7.archimedean:this.options.spiral,this.random=this.options.random?Math.random:()=>1,this.getTextPadding=xu(this.options.padding)}zoomRatio(){return this._originSize[0]/this._size[0]}dy(){return this._dy}layoutWord(t){const e=this.data[t];if((""+e.text).trim()==="")return!0;const{maxRadius:i,center:r}=cF(this.options.shape,this._size);if(e.x=r[0],e.y=r[1],c8t(this.contextAndRatio,e,this.data,t,this.cw,this.ch),this._placeStatus=0,e.hasText&&this.place(this._board,e,this._bounds,i))return this.result.push(e),this._bounds?p8t(this._bounds,e):this._bounds=[{x:e.x+e.x0,y:e.y+e.y0},{x:e.x+e.x1,y:e.y+e.y1}],e.x-=this._size[0]>>1,e.y-=this._size[1]>>1,this._tTemp=null,this._dtTemp=null,!0;if(this.updateBoardExpandStatus(e.fontSize),e.hasText&&this.shouldShrinkContinue()){if(this._placeStatus===1){const s=e.fontSize*this._originSize[0]/this.options.minFontSize,o=Math.max(e.width,e.height);if(o<=s)this.expandBoard(this._board,this._bounds,o/this._size[0]);else{if(!this.options.clip)return!0;this.expandBoard(this._board,this._bounds,s/this._size[0])}}else this._placeStatus,this.expandBoard(this._board,this._bounds);return this.updateBoardExpandStatus(e.fontSize),!1}return this._tTemp=null,this._dtTemp=null,!0}layout(t,e){this.initProgressive(),this.result=[],this._size=[e.width,e.height],this.clearCache(),this._originSize=[...this._size];const i=this.getContext(le.createCanvas({width:1,height:1}));this.contextAndRatio=i,this._board=new Array((this._size[0]>>5)*this._size[1]).fill(0),this._bounds=null,t.length,this.result=[];const r=t.map((s,o)=>({text:this.getText(s),fontFamily:this.getTextFontFamily(s),fontStyle:this.getTextFontStyle(s),fontWeight:this.getTextFontWeight(s),angle:this.getTextRotate(s,o),fontSize:~~this.getTextFontSize(s),padding:this.getTextPadding(s),xoff:0,yoff:0,x1:0,y1:0,x0:0,y0:0,hasText:!1,sprite:null,datum:s,x:0,y:0,width:0,height:0})).sort(function(s,o){return o.fontSize-s.fontSize});if(this.originalData=r,this.data=r,this.progressiveRun(),!this.options.clip&&this.options.enlarge&&this._bounds&&this.shrinkBoard(this._bounds),this._bounds&&["cardioid","triangle","triangle-upright"].includes(this.options.shape)){const s=(this._bounds[0].y+this._bounds[1].y)/2;this._dy=-(s-this._originSize[1]/2)}return this.result}formatTagItem(t){const e=this._size,i=this.zoomRatio(),r=this.dy(),s=e[0]>>1,o=e[1]>>1,a=t.length,l=[];let h,d;for(let u=0;u<a;++u)h=t[u],d={},d.datum=h.datum,d.x=(h.x+s)*i,d.y=(h.y+o+r)*i,d.fontFamily=h.fontFamily,d.fontSize=h.fontSize*i,d.fontStyle=h.fontStyle,d.fontWeight=h.fontWeight,d.angle=h.angle,l.push(d);return l}output(){return this.outputCallback?this.outputCallback(this.formatTagItem(this.result)):this.formatTagItem(this.result)}progressiveOutput(){return this.outputCallback?this.outputCallback(this.formatTagItem(this.progressiveResult)):this.formatTagItem(this.progressiveResult)}updateBoardExpandStatus(t){this._isBoardExpandCompleted=t*(this._originSize[0]/this._size[0])<this.options.minFontSize}shouldShrinkContinue(){return!this.options.clip&&this.options.shrink&&!this._isBoardExpandCompleted}shrinkBoard(t){const e=t[0],i=t[1];if(i.x>=this._size[0]||i.y>=this._size[1])return;const r=Math.min(e.x,this._size[0]-i.x),s=Math.min(e.y,this._size[1]-i.y),o=2*Math.min(r/this._size[0],s/this._size[1]);this._size=this._size.map(a=>a*(1-o))}expandBoard(t,e,i){const r=this._size[0]*(i||1.1)-this._size[0]>>5;let s=2*r>2?r:2;s%2!=0&&s++;let o=Math.ceil(this._size[1]*(s<<5)/this._size[0]);o%2!=0&&o++;const a=this._size[0],l=this._size[1],h=new Array(s).fill(0),d=new Array(o/2*(s+(a>>5))).fill(0);this.insertZerosToArray(t,l*(a>>5),d.length+s/2);for(let u=l-1;u>0;u--)this.insertZerosToArray(t,u*(a>>5),h.length);this.insertZerosToArray(t,0,d.length+s/2),this._size=[a+(s<<5),l+o],e&&(e[0].x+=(s<<5)/2,e[0].y+=o/2,e[1].x+=(s<<5)/2,e[1].y+=o/2)}insertZerosToArray(t,e,i){if(this.options.customInsertZerosToArray)return this.options.customInsertZerosToArray(t,e,i);const r=Math.floor(i/6e4),s=i%6e4;for(let o=0;o<r;o++)t.splice(e+6e4*o,0,...new Array(6e4).fill(0));t.splice(e+6e4*r,0,...new Array(s).fill(0))}getContext(t){t.width=1,t.height=1;const e=t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,1,1),i=Math.sqrt(e.data.length>>2);t.width=(this.cw<<5)/i,t.height=this.ch/i;const r=t.getContext("2d",{willReadFrequently:!0});return r.fillStyle=r.strokeStyle="red",r.textAlign="center",{context:r,ratio:i,canvas:t}}place(t,e,i,r){let s=!1;if(this.shouldShrinkContinue()&&(e.width>this._size[0]||e.height>this._size[1]))return this._placeStatus=1,!1;const o=this.random()<.5?1:-1;if(!this.shouldShrinkContinue()&&this.isSizeLargerThanMax(e,o))return null;const a=e.x,l=e.y,h=Math.sqrt(this._size[0]*this._size[0]+this._size[1]*this._size[1]),d=this.spiral(this._size);let u,c,g,p,f=-o;for(this._tTemp=null,this._dtTemp=null;u=d(f+=o);){c=u[0],g=u[1];const m=Math.sqrt(c**2+g**2);let v=Math.atan(g/c);c<0?v+=Math.PI:g<0&&(v=2*Math.PI+v);const _=this.shape(v);if(Math.min(Math.abs(c),Math.abs(g))>=h)break;if(m>=r)s&&this._tTemp===null&&(this._tTemp=f,this._dtTemp=o);else{if(e.x=a+~~(m*_*Math.cos(-v)),e.y=l+~~(m*_*Math.sin(-v)),p=e,this.options.clip)if(this.shouldShrinkContinue()){if(iP(p,this._size)){s&&this._tTemp===null&&(this._tTemp=f,this._dtTemp=o);continue}}else{if(m8t(p,this._size)){s&&this._tTemp===null&&(this._tTemp=f,this._dtTemp=o);continue}iP(p,this._size)&&(p=v8t(p,this._size))}else if(iP(p,this._size)){s&&this._tTemp===null&&(this._tTemp=f,this._dtTemp=o);continue}if(s=!0,(!i||f8t(p,i))&&(!i||!g8t(p,t,this._size))){const b=p.sprite,y=p.width>>5,C=this._size[0]>>5,S=p.x-(y<<4),w=127&S,x=32-w,A=p.y1-p.y0;let M,T=(p.y+p.y0)*C+(S>>5);for(let R=0;R<A;R++){M=0;for(let B=0;B<=y;B++)t[T+B]|=M<<x|(B<y?(M=b[R*y+B])>>>w:0);T+=C}return e.sprite=null,p.sprite=null,!0}}}return this._tTemp!==null&&(this._placeStatus=3),!this.shouldShrinkContinue()&&this.setCache(p,o),!1}clearCache(){this.cacheMap.clear()}setCache(t,e){const i=`${t.angle}-${e}`,r=t.x1-t.x0,s=t.y1-t.y0;if(!this.cacheMap.has(i))return void this.cacheMap.set(i,{width:r,height:s});const{width:o,height:a}=this.cacheMap.get(i);(r<o&&s<a||r<=o&&s<a)&&this.cacheMap.set(i,{width:r,height:s})}isSizeLargerThanMax(t,e){const i=`${t.angle}-${e}`;if(!this.cacheMap.has(i))return!1;const{width:r,height:s}=this.cacheMap.get(i),o=t.x1-t.x0,a=t.y1-t.y0;return o>=r&&a>=s}}function c8t(n,t,e,i,r,s){if(t.sprite)return;const o=n.context,a=n.ratio;o.setTransform(a,0,0,a,0,0),o.clearRect(0,0,(r<<5)/a,s/a);let l=0,h=0,d=0;const u=e.length;let c,g,p,f,m;for(--i;++i<u;){if(t=e[i],o.save(),o.font=t.fontStyle+" "+t.fontWeight+" "+~~((t.fontSize+1)/a)+"px "+t.fontFamily,c=o.measureText(t.text+"m").width*a,p=t.fontSize<<1,t.angle){const b=Math.sin(t.angle),y=Math.cos(t.angle),C=c*y,S=c*b,w=p*y,x=p*b;c=Math.max(Math.abs(C+x),Math.abs(C-x))+31>>5<<5,p=~~Math.max(Math.abs(S+w),Math.abs(S-w))}else c=c+31>>5<<5;if(p>d&&(d=p),l+c>=r<<5&&(l=0,h+=d,d=0),h+p>=s)break;o.translate((l+(c>>1))/a,(h+(p>>1))/a),t.angle&&o.rotate(t.angle),o.fillText(t.text,0,0),t.padding&&(o.lineWidth=2*t.padding,o.strokeText(t.text,0,0)),o.restore(),t.width=c,t.height=p,t.xoff=l,t.yoff=h,t.x1=c>>1,t.y1=p>>1,t.x0=-t.x1,t.y0=-t.y1,t.hasText=!0,l+=c}const v=o.getImageData(0,0,(r<<5)/a,s/a).data,_=[];for(;--i>=0;){if(!(t=e[i]).hasText)continue;for(c=t.width,g=c>>5,p=t.y1-t.y0,f=0;f<p*g;f++)_[f]=0;if(l=t.xoff,l==null)return;h=t.yoff;let b=0,y=-1;for(m=0;m<p;m++){for(f=0;f<c;f++){const C=g*m+(f>>5),S=v[(h+m)*(r<<5)+(l+f)<<2]?1<<31-f%32:0;_[C]|=S,b|=S}b?y=m:(t.y0++,p--,m--,h++)}t.y1=t.y0+y,t.sprite=_.slice(0,(t.y1-t.y0)*g)}}function g8t(n,t,e){const i=e[0]>>5,r=n.sprite,s=n.width>>5,o=n.x-(s<<4),a=127&o,l=32-a,h=n.y1-n.y0;let d,u=(n.y+n.y0)*i+(o>>5);for(let c=0;c<h;c++){d=0;for(let g=0;g<=s;g++)if((d<<l|(g<s?(d=r[c*s+g])>>>a:0))&t[u+g])return!0;u+=i}return!1}function p8t(n,t){const e=n[0],i=n[1];t.x+t.x0<e.x&&(e.x=t.x+t.x0),t.y+t.y0<e.y&&(e.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function f8t(n,t){return n.x+n.x1>t[0].x&&n.x+n.x0<t[1].x&&n.y+n.y1>t[0].y&&n.y+n.y0<t[1].y}$p.defaultOptions={enlarge:!1,minFontSize:2,maxSingleWordTryCount:2};const m8t=(n,t)=>n.x+n.x0>t[0]||n.y+n.y0>t[0]||n.x+n.x1<0||n.y+n.y1<0,iP=(n,t)=>n.x+n.x0<0||n.y+n.y0<0||n.x+n.x1>t[0]||n.y+n.y1>t[1];function v8t(n,t){const e=n.sprite,i=n.y1-n.y0,r=n.width>>5;let s=0;const o=[],a=Math.max(-(n.y0+n.y),0),l=Math.min(i+(t[1]-(n.y1+n.y)),i),h=Math.max(-(n.x0+n.x),0)>>5,d=Math.min(r+(t[0]-(n.x1+n.x)>>5)+1,r);for(let f=0;f<i;f++){for(let m=0;m<r;m++)f<a||l<=f||m<h||d<=m||o.push(e[s+m]);s+=r}const u=h<<5,c=r-d<<5,g=a,p=i-l;return Object.assign(Object.assign({},n),{width:n.width-u-c,height:n.height-g-p,x0:n.x0+u,x1:n.x1-c,y0:n.y0+g,y1:n.y1-p,x:n.x+u/2-c/2,sprite:o})}let Qnt=class trt extends Zf{constructor(t){super(Z({},trt.defaultOptions,t)),this.fillGridAt=(e,i)=>{e>=this.ngx||i>=this.ngy||e<0||i<0||(this.grid[e][i]=!1)},this.updateGrid=(e,i,r,s,o)=>{const a=o.occupied;let l=a.length;for(;l--;){const h=e+a[l][0],d=i+a[l][1];h>=this.ngx||d>=this.ngy||h<0||d<0||this.fillGridAt(h,d)}},this.gridSize=Math.max(Math.floor(this.options.gridSize),4)}getPointsAtRadius(t){if(this.pointsAtRadius[t])return this.pointsAtRadius[t];const e=8*t;let i=e;const r=[];for(t===0&&r.push([this.center[0],this.center[1],0]);i--;){const s=this.shape(i/e*2*Math.PI);r.push([this.center[0]+t*s*Math.cos(-i/e*2*Math.PI),this.center[1]+t*s*Math.sin(-i/e*2*Math.PI)*this.options.ellipticity,i/e*2*Math.PI])}return this.pointsAtRadius[t]=r,r}getTextInfo(t,e=1,i){var r;const s=this.options.clip?1:e,o=Math.max(Math.floor((this.isTryRepeatFill?this.options.fillTextFontSize:this.getTextFontSize(t))*s),this.options.minFontSize);let a=this.getText(t)+"";if(this.options.clip&&(a=a.slice(0,Math.ceil(a.length*e))),!a)return null;const l=this.getTextFontWeight(t),h=this.getTextFontStyle(t),d=this.getTextRotate&&(r=this.getTextRotate(t,i))!==null&&r!==void 0?r:0,u=this.getTextFontFamily(t),c=document.createElement("canvas"),g=c.getContext("2d",{willReadFrequently:!0});g.font=h+" "+l+" "+o.toString(10)+"px "+u;const p=g.measureText(a).width,f=Math.max(o,g.measureText("m").width,g.measureText("").width);let m=p+2*f,v=3*f;const _=Math.ceil(m/this.gridSize),b=Math.ceil(v/this.gridSize);m=_*this.gridSize,v=b*this.gridSize;const y=-p/2,C=.4*-f,S=Math.ceil((m*Math.abs(Math.sin(d))+v*Math.abs(Math.cos(d)))/this.gridSize),w=Math.ceil((m*Math.abs(Math.cos(d))+v*Math.abs(Math.sin(d)))/this.gridSize),x=w*this.gridSize,A=S*this.gridSize;c.setAttribute("width",""+x),c.setAttribute("height",""+A),g.scale(1,1),g.translate(x/2,A/2),g.rotate(-d),g.font=h+" "+l+" "+o.toString(10)+"px "+u,g.fillStyle="#000",g.textBaseline="middle",g.fillText(a,y,C);const M=g.getImageData(0,0,x,A).data;if(this.exceedTime())return null;const T=[];let R,B=w;const E=[S/2,w/2,S/2,w/2],k=(P,I,O)=>{let H=this.gridSize;for(;H--;){let z=this.gridSize;for(;z--;)if(M[4*((I*this.gridSize+H)*x+(P*this.gridSize+z))+3])return O.push([P,I]),P<E[3]&&(E[3]=P),P>E[1]&&(E[1]=P),I<E[0]&&(E[0]=I),void(I>E[2]&&(E[2]=I))}};for(;B--;)for(R=S;R--;)k(B,R,T);return{datum:t,occupied:T,bounds:E,gw:w,gh:S,fillTextOffsetX:y,fillTextOffsetY:C,fillTextWidth:p,fillTextHeight:f,fontSize:o,fontStyle:h,fontWeight:l,fontFamily:u,angle:d,text:a}}calculateEmptyRate(){const t=this.ngx*this.ngy;let e=0;for(let i=0;i<this.ngx;i++)for(let r=0;r<this.ngy;r++)this.grid[i][r]&&e++;return e/t}canFitText(t,e,i,r,s){let o=s.length;for(;o--;){const a=t+s[o][0],l=e+s[o][1];if(a>=this.ngx||l>=this.ngy||a<0||l<0){if(!this.options.drawOutOfBound)return!1}else if(!this.grid[a][l])return!1}return!0}layoutWord(t,e=1){const i=this.data[t],r=this.getTextInfo(i,e,t);if(!r||this.exceedTime())return!1;if(!this.options.drawOutOfBound&&(!this.options.shrink||r.fontSize<=this.options.minFontSize)&&!this.options.clip){const a=r.bounds;if(a[1]-a[3]+1>this.ngx||a[2]-a[0]+1>this.ngy)return!1}let s=this.maxRadius+1;const o=a=>{const l=Math.floor(a[0]-r.gw/2),h=Math.floor(a[1]-r.gh/2),d=r.gw,u=r.gh;return!!this.canFitText(l,h,d,u,r.occupied)&&(r.distance=this.maxRadius-s,r.theta=a[2],this.outputText(l,h,r),this.updateGrid(l,h,d,u,r),!0)};for(;s--;){let a=this.getPointsAtRadius(this.maxRadius-s);if(this.options.random&&(a=[].concat(a),yY(a)),a.some(o))return!0}return(this.options.clip||!!(this.options.shrink&&r.fontSize>this.options.minFontSize))&&this.layoutWord(t,.75*e)}outputText(t,e,i){const r=this.getTextColor(i),s={text:i.text,datum:i.datum,color:r,fontStyle:i.fontStyle,fontWeight:i.fontWeight,fontFamily:i.fontFamily,angle:i.angle,width:i.fillTextWidth,height:i.fillTextHeight,x:(t+i.gw/2)*this.gridSize,y:(e+i.gh/2)*this.gridSize+i.fillTextOffsetY+.5*i.fontSize,fontSize:i.fontSize};this.result.push(s),this.progressiveResult&&this.progressiveResult.push(s)}initGrid(t){this.grid=[];const e=this.options.shape;if(kt(e)){const i=ttt(e,t.width,t.height);let r=i.getContext("2d").getImageData(0,0,this.ngx*this.gridSize,this.ngy*this.gridSize);this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(i);let s=L2(e.backgroundColor);const o=(l,h)=>{let d=this.gridSize;for(;d--;){let u=this.gridSize;for(;u--;)if(!s(r,h*this.gridSize+d,l*this.gridSize+u))return void(this.grid[l][h]=!0)}this.grid[l][h]=!1};let a=this.ngx;for(;a--;){this.grid[a]=[];let l=this.ngy;for(;l--;)o(a,l),this.grid[a][l]!==!1&&(this.grid[a][l]=!0)}r=s=void 0}else{let i=this.ngx;for(;i--;){this.grid[i]=[];let r=this.ngy;for(;r--;)this.grid[i][r]=!0}}}canRepeat(){return this.calculateEmptyRate()>.001}layout(t,e){this.initProgressive(),this.drawnCount=0,this.isTryRepeatFill=!1,this.originalData=t,this.data=t,this.pointsAtRadius=[],this.ngx=Math.floor(e.width/this.gridSize),this.ngy=Math.floor(e.height/this.gridSize);const{center:i,maxRadius:r}=cF(this.options.shape,[e.width,e.height]);return this.center=e.origin?[e.origin[0]/this.gridSize,e.origin[1]/this.gridSize]:[i[0]/this.gridSize,i[1]/this.gridSize],this.maxRadius=Math.floor(r/this.gridSize),this.initGrid(e),this.result=[],this.progressiveRun()}};Qnt.defaultOptions={gridSize:8,ellipticity:1,maxSingleWordTryCount:1};class GT extends Zf{constructor(t){super(Z({},GT.defaultOptions,t)),this.random=this.options.random?Math.random:()=>0,this.aspectRatio=1}fit(t){for(let e=0,i=this.result.length;e<i;e++)if(_8t(t,this.result[e]))return!1;return!0}getTextInfo(t,e){const i={datum:t,fontSize:this.getTextFontSize(t),fontWeight:this.getTextFontWeight(t),fontStyle:this.getTextFontStyle(t),fontFamily:this.getTextFontFamily(t),angle:this.getTextRotate(t,e),text:this.getText(t)+"",x:this.center[0],y:this.center[1]},r=QM(i);return i.width=r.width(),i.height=r.height(),i.top=this.center[1]-i.height+.21*i.height,i.left=this.center[0]-i.width/2,i}layoutWord(t){const e=this.getTextInfo(this.data[t],t);let i=2*Math.PI,r=0,s=e.left,o=e.top;const a=e.width,l=e.height;let h=1,d=this.fit(e);for(;!d&&r<this.maxRadius;)r+=.5,h=this.shape(r/this.maxRadius*2*Math.PI),i+=.5*(this.options.random?this.random()>.5?1:-1:t%2==0?1:-1),s=this.center[0]-a/2+r*h*Math.cos(i)*this.aspectRatio,o=this.center[1]-l/2+r*h*Math.sin(i),e.left=s,e.top=o,e.x=s+a/2,e.y=o+l/2,d=this.fit(e);return!!d&&!!(this.options.clip||e.left>=0&&e.left+e.width<=this.width&&e.top>=0&&e.top+e.height<=this.height)&&(this.result.push(e),!0)}layout(t,e){if(!(t!=null&&t.length))return[];this.initProgressive(),this.result=[],this.maxRadius=Math.sqrt(e.width*e.width+e.height*e.height)/2,this.center=[e.width/2,e.height/2],this.width=e.width,this.height=e.height,this.data=t.sort((r,s)=>this.getTextFontSize(s)-this.getTextFontSize(r));let i=0;for(;i<t.length&&(this.layoutWord(i),i++,this.progressiveIndex=i,!this.exceedTime()););return this.result}}function _8t(n,t){return!(n.left+n.width<t.left||n.top+n.height<t.top||n.left>t.left+t.width||n.top>t.top+t.height)}GT.defaultOptions={enlarge:!1};const d7={x:"x",y:"y",z:"z",fontFamily:"fontFamily",fontSize:"fontSize",fontStyle:"fontStyle",fontWeight:"fontWeight",angle:"angle"},b8t=(n,t)=>{var e,i,r,s,o,a;if(n.size&&(n.size[0]<=0||n.size[1]<=0))return ge.getInstance().info("Wordcloud size dimensions must be greater than 0"),[];const l=t,h=((e=n.size)!==null&&e!==void 0?e:[500,500]).slice();h[0]=Math.floor(h[0]),h[1]=Math.floor(h[1]);const d=n.fontFamily?hu(n.fontFamily):"sans-serif",u=n.fontStyle?hu(n.fontStyle):"normal",c=n.fontWeight?hu(n.fontWeight):"normal",g=n.rotate?hu(n.rotate):0,p=hu(n.text),f=(i=n.spiral)!==null&&i!==void 0?i:"archimedean",m=n.padding?hu(n.padding):1,v=(r=n.shape)!==null&&r!==void 0?r:"square",_=(s=n.shrink)!==null&&s!==void 0&&s,b=(o=n.enlarge)!==null&&o!==void 0&&o,y=(a=n.clip)!==null&&a!==void 0&&a,C=n.minFontSize,S=n.randomVisible,w=n.as?Object.assign(Object.assign({},d7),n.as):d7,x=n.depth_3d,A=n.postProjection;let M=n.fontSize?hu(n.fontSize):14;const T=n.fontSizeRange;if(T&&!J(M)){const E=M,k=y8t(C8t(E,l),T);M=P=>k(E(P))}let R=$p;n.layoutType==="fast"?R=GT:n.layoutType==="grid"&&(R=Qnt);const B=new R(Object.assign(Object.assign({},n),{text:p,padding:m,spiral:f,shape:v,rotate:g,fontFamily:d,fontStyle:u,fontWeight:c,fontSize:M,shrink:_,clip:y,enlarge:b,minFontSize:C,random:S,outputCallback:E=>{const k=[];let P,I;for(let O=0,H=E.length;O<H;O++)I=E[O],P=I.datum,P[w.x]=I.x,P[w.y]=I.y,P[w.fontFamily]=I.fontFamily,P[w.fontSize]=I.fontSize,P[w.fontStyle]=I.fontStyle,P[w.fontWeight]=I.fontWeight,P[w.angle]=I.angle,A==="StereographicProjection"&&S8t(h,I,P,w,x),n.dataIndexKey&&(P[n.dataIndexKey]=`${O}`),k.push(P);return k}}));return B.layout(l,{width:h[0],height:h[1]}),n.progressiveStep>0||n.progressiveTime>0?{progressive:B}:B.output()},hu=n=>yt(n)||J(n)||it(n)||V(n)?n:t=>t[n.field],nP=n=>n<0?-Math.sqrt(-n):Math.sqrt(n),y8t=(n,t,e)=>{if(n[0]===n[1])return a=>t[0];const i=nP(n[0]),r=nP(n[1]),s=Math.min(i,r),o=Math.max(i,r);return a=>(nP(a)-s)/(o-s)*(t[1]-t[0])+t[0]},C8t=(n,t)=>{let e=1/0,i=-1/0;const r=t.length;let s;for(let o=0;o<r;++o)s=zl(n(t[o])),s<e&&(e=s),s>i&&(i=s);return t.length===1&&e===i&&(e-=1e4),[e,i]};function S8t(n,t,e,i,r){const s=Math.max(n[0],n[1])/2,o=x8t(n[0],n[1],s,{x:s,y:s,z:r??s},t);e[i.x]=o.x,e[i.y]=o.y,e[i.z]=o.z}function x8t(n,t,e,i,r){const{x:s,y:o}=r,a=s/n*Math.PI*2;let l=Math.PI-o/t*Math.PI;return l+=(l<Math.PI/2?1:-1)*Math.pow(Math.min(l-Math.PI/2,1),2)/5,{x:e*Math.sin(l)*Math.cos(a)+i.x,y:e*Math.cos(l)+i.y,z:e*Math.sin(l)*Math.sin(a)+i.z}}const UT=()=>{dt.registerTransform("wordcloud",{transform:b8t,markPhase:"beforeJoin"},!0)};var $u;(function(n){n.BEFORE_WORDCLOUD_SHAPE_LAYOUT="beforeWordcloudShapeLayout",n.AFTER_WORDCLOUD_SHAPE_LAYOUT="afterWordcloudShapeLayout",n.AFTER_WORDCLOUD_SHAPE_DRAW="afterWordcloudShapeDraw"})($u||($u={}));const w8t=(n,t)=>{if(t.length===1&&t[0]==="#537EF5")return!0;if(!Array.isArray(n)||!Array.isArray(t)||n.length!==t.length)return!1;for(let e=0;e<n.length;e++)if(n[e]!==t[e])return!1;return!0},A8t=()=>{let n=-1;const t=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9];return()=>(n=(n+1)%t.length,t[n])},M8t=n=>/^[\u4e00-\u9fa5]+$/.test(n),ert=(n,t)=>{if(D(n))return 0;let e=0;for(const i of n)M8t(i)?e+=1:e+=.53;return e};function T8t(n){return n&&(mO(n)||vO(n)||n.startsWith("<svg"))?new Promise((t,e)=>{var i;const r=nF({image:n}),s=(i=r.resources)===null||i===void 0?void 0:i.get(n);s&&s.state==="success"&&s.data?t(s.data):(r.successCallback=()=>{var o;if(r){const a=(o=r.resources)===null||o===void 0?void 0:o.get(n);a&&a.state==="success"&&a.data?t(a.data):e(new Error("image load failed"+n))}else e(new Error("image load failed"+n))},r.failCallback=()=>{ge.getInstance().error("image ",n)})}):null}function k8t(n){return typeof n=="function"?n:function(){return n}}function R8t(n){const{size:t,maskCanvas:e}=n,i=e.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e.width,e.height),r=new Array(t[0]*t[1]).fill(0);let s=1;const o=[[0,1],[1,0],[-1,0],[0,-1]];let a=[];for(let x=0;x<t[1];x++)for(let A=0;A<t[0];A++)if(r[x*t[0]+A]===0&&!n.isEmptyPixel(i,x,A)){r[x*t[0]+A]=s,a.push([x,A]);for(let M=0;M<a.length;M++)for(let T=0;T<4;T++){let R=a[M][0]+o[T][0],B=a[M][1]+o[T][1];R=R<0?0:R>=t[1]?t[1]-1:R,B=B<0?0:B>=t[0]?t[0]-1:B,r[R*t[0]+B]!==0||n.isEmptyPixel(i,R,B)||(r[R*t[0]+B]=s,a.push([R,B]))}s++,a=[]}const l={},h={},d={},u={},c={},g={},p={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0,width:0,height:0};for(let x=0;x<t[1];x++)for(let A=0;A<t[0];A++){const M=r[x*t[0]+A];M!==0&&(w(x,A)&&(l[M]=l[M]||[],l[M].push([A,x]),u[M]||(u[M]=[1/0,-1/0,1/0,-1/0]),x<u[M][0]&&(u[M][0]=x),x>u[M][1]&&(u[M][1]=x),A<u[M][2]&&(u[M][2]=A),A>u[M][3]&&(u[M][3]=A),A<p.x1&&(p.x1=A),A>p.x2&&(p.x2=A),x<p.y1&&(p.y1=x),x>p.y2&&(p.y2=x)),h[M]=h[M]||0,h[M]++)}const f=[];for(const x in l){const A=l[x],M=~~(A.reduce((P,I)=>P+I[0],0)/A.length),T=~~(A.reduce((P,I)=>P+I[1],0)/A.length);d[x]=[M,T],f.push(...A);const[R,B,E,k]=u[x];c[x]=~~Math.max(Math.sqrt((M-E)**2+(T-R)**2),Math.sqrt((M-k)**2+(T-B)**2),Math.sqrt((M-E)**2+(T-B)**2),Math.sqrt((M-k)**2+(T-R)**2)),g[x]=(k-E)/(B-R)}const m=Object.keys(d).map(x=>({label:x-1,boundary:l[x],area:h[x],center:d[x],maxPoint:u[x],maxR:c[x],ratio:g[x]}));p.width=p.x2-p.x1+1,p.height=p.y2-p.y1+1;const v=~~(f.reduce((x,A)=>x+A[0],0)/f.length),_=~~(f.reduce((x,A)=>x+A[1],0)/f.length),b=~~Math.max(Math.sqrt((v-p.x1)**2+(_-p.y1)**2),Math.sqrt((v-p.x2)**2+(_-p.y2)**2),Math.sqrt((v-p.x1)**2+(_-p.y2)**2),Math.sqrt((v-p.x2)**2+(_-p.y1)**2)),y=p.width/p.height,C=Object.keys(h).reduce((x,A)=>x+h[A],0),S={regions:m,labels:r,labelNumber:s-1};return Object.assign(n,{segmentation:S,shapeBounds:p,shapeMaxR:b,shapeRatio:y,shapeCenter:[v,_],shapeArea:C});function w(x,A){const M=[[0,1],[1,0],[-1,0],[0,-1]];if(x===0||A===0||x===t[1]-1||A===t[0]-1)return!0;for(let T=0;T<4;T++){let R=x+M[T][0],B=A+M[T][1];if(R=R<0?0:R>=t[1]?t[1]-1:R,B=B<0?0:B>=t[0]?t[0]-1:B,r[R*t[0]+B]===0)return!0}return!1}}function B8t(n,t,e){t.width=n.width,t.height=n.height;const i=t.getContext("2d",{willReadFrequently:!0});i.clearRect(0,0,t.width,t.height),i.drawImage(n,0,0);const r=t.width,s=i.getImageData(0,0,t.width,t.height);let o=0,a=s.height,l=0,h=s.width;const d=(g,p)=>{for(let f=0;f<g;++f)if(!e(s,p,f))return!1;return!0},u=(g,p,f)=>{for(let m=p;m<f;++m)if(!e(s,m,g))return!1;return!0};for(;o<a&&d(r,o);)++o;for(;a-1>o&&d(r,a-1);)--a;for(;l<h&&u(l,o,a);)++l;for(;h-1>l&&u(h-1,o,a);)--h;const c=i.getImageData(l,o,h-l,a-o);return t.width=c.width,t.height=c.height,i.clearRect(0,0,t.width,t.height),i.putImageData(c,0,0),t}function P8t(n,t){const e=n.width,i=n.height;let r=t[0]/e;i*r>t[1]&&(r=t[1]/i);const s=Math.floor(r*e),o=Math.floor(r*i);return{x:(t[0]-s)/2,y:(t[1]-o)/2,width:s,height:o,scale:r}}function E8t(n,t){const{segmentation:{regions:e}}=t;let i=-1/0,r=0,s=0;e.forEach((h,d)=>{const u=h.area;u>i&&(i=u,s=d),r+=u});let o=0;e.forEach(h=>{const d=h.area,u=Math.ceil(d/r*n.length),c=d/i;h.words=[],h.regionNum=u,h.regionWeight=c,o+=u}),o<n.length&&(e[s].wordsNum+=n.length-o);let a=s;const l=e.map(h=>h.regionNum);n.forEach(h=>{let d=0,u=0;h.regionIndex=-1;do{if(l[a]>0&&h.weight<=e[a].regionWeight){h.regionIndex=a,e[a].words.push(h),l[a]--,a=(a+1)%e.length;break}a=(a+1)%e.length,d++,u++,u>e.length+1&&(e.forEach(c=>{c.regionWeight+=.15}),u=0)}while(h.regionIndex===-1&&d<3*e.length);h.regionIndex===-1&&(h.regionIndex=s,e[s].words.push(h),l[s]--)}),e.forEach(h=>{h.words.sort((d,u)=>u.weight-d.weight)})}function L8t(n,t,e){const{size:i,stepFactor:r}=t,{segmentation:{regions:s},tempCanvas:o,boardSize:a,shapeCenter:l,shapeMaxR:h,shapeRatio:d}=e,u=gH(e),c=o.getContext("2d",{willReadFrequently:!0});for(const g of s){const{words:p,center:f,maxR:m,ratio:v}=g;for(let _=0;_<p.length;_++){$c(o,c,n,_);const b=p[_];b.x=f[0],b.y=f[1],b.hasText&&b.sprite&&Bf(u,b,m,v,i,a,r)&&(b.hasPlaced=!0)}}for(let g=0;g<t.textLayoutTimes;g++){const p=n.filter(f=>(f.hasPlaced||(f.hasText=!1,f.sprite=null,f.fontSize=Math.max(~~(f.fontSize*t.fontSizeShrinkFactor),t.minFontSize)),!f.hasPlaced));if(p.length===0)break;for(let f=0;f<p.length;f++){const m=p[f];$c(o,c,p,f),m.x=l[0],m.y=l[1],m.hasText&&Bf(u,m,h,d,i,a,r)&&(m.hasPlaced=!0)}}t.board=u}function irt(n,t,e){const{stepFactor:i,importantWordCount:r,globalShinkLimit:s}=t,{size:o,segmentation:{regions:a},tempCanvas:l,boardSize:h,shapeCenter:d,shapeMaxR:u,shapeRatio:c}=e,g=l.getContext("2d",{willReadFrequently:!0}),p=gH(e);let f=p.slice(0);const m=t.fontSizeShrinkFactor;let v=null,_=1,b=1;const y=r;let C=0;n.length>y&&(C=n.sort((S,w)=>w.weight-S.weight)[y].weight);for(let S=0;S<a.length;S++){const w=a[S],{words:x,center:A,maxR:M,ratio:T}=w;let R=!1;for(let B=0;B<x.length;B++){$c(l,g,n,B);const E=x[B];if(E.x=A[0],E.y=A[1],!E.skip&&E.hasText&&E.sprite&&Bf(f,E,M,T,o,h,i))E.hasPlaced=!0;else{if(!E.skip&&E.weight>C&&b>s){const k=E.datum[Symbol.for("vGrammar_id")];k!==v&&(v=k,_=b),b*=m,n.forEach(P=>{P.hasText=!1,P.sprite=null,P.fontSize=P.fontSize*m}),f=p.slice(0),R=!0;break}if(!E.skip&&E.datum[Symbol.for("vGrammar_id")]===v){n.forEach(k=>{k.hasText=!1,k.sprite=null,k.fontSize=k.fontSize/b}),E.skip=!0,b=_,v=null,f=p.slice(0),R=!0;break}}}R&&(S=-1)}for(let S=0;S<t.textLayoutTimes;S++){const w=n.filter(x=>(x.hasPlaced||(x.hasText=!1,x.sprite=null,x.fontSize=Math.max(~~(x.fontSize*t.fontSizeShrinkFactor),t.minFontSize)),!x.hasPlaced));if(w.length===0)break;for(let x=0;x<w.length;x++){const A=w[x];$c(l,g,w,x),A.x=d[0],A.y=d[1],A.hasText&&Bf(f,A,u,c,o,h,i)&&(A.hasPlaced=!0)}}t.board=f}function I8t(n,t,e){const{size:i,stepFactor:r,importantWordCount:s}=t,{segmentation:{regions:o},tempCanvas:a,boardSize:l,shapeCenter:h,shapeMaxR:d,shapeRatio:u}=e,c=a.getContext("2d",{willReadFrequently:!0}),g=gH(e);let p=g.slice(0);const f=t.fontSizeEnlargeFactor,m=Math.min(s,n.length);let v=0;n.length>m&&(v=n.sort((C,S)=>S.weight-C.weight)[m-1].weight);let _=0,b=1,y=!1;for(let C=0;C<o.length;C++){const S=o[C],{words:w,center:x,maxR:A,ratio:M}=S;let T=!1;for(let R=0;R<w.length;R++){$c(a,c,n,R);const B=w[R];if(B.x=x[0],B.y=x[1],B.hasText&&B.sprite&&Bf(p,B,A,M,i,l,r)){if(B.hasPlaced=!0,B.weight>=v&&_++,_>=m&&!y){b*=f,n.forEach(E=>{E.hasText=!1,E.sprite=null,E.fontSize=E.fontSize*f}),p=g.slice(0),T=!0,_=0;break}}else{if(B.weight>=v&&b>1){n.forEach(E=>{E.hasText=!1,E.sprite=null,E.fontSize=E.fontSize/f}),b/=f,y=!0,p=g.slice(0),T=!0;break}if(B.weight>=v)return irt(n,t,e)}}T&&(C=-1)}for(let C=0;C<t.textLayoutTimes;C++){const S=n.filter(w=>(w.hasPlaced||(w.hasText=!1,w.sprite=null,w.fontSize=Math.max(~~(w.fontSize*t.fontSizeShrinkFactor),t.minFontSize)),!w.hasPlaced));if(S.length===0)break;for(let w=0;w<S.length;w++){const x=S[w];$c(a,c,S,w),x.x=h[0],x.y=h[1],x.hasText&&Bf(p,x,d,u,i,l,r)&&(x.hasPlaced=!0)}}t.board=p}function Bf(n,t,e,i,r,s,o){const a=t.x,l=t.y,h=O8t(i),d=1*o;let u,c,g,p=-d;for(;u=h(p+=d);){const{wordSize:f,bounds:{dTop:m,dBottom:v,dLeft:_,dRight:b}}=t;if(c=u[0],g=u[1],Math.min(Math.abs(c),Math.abs(g))>=e)break;if(t.x=~~(a+c),t.y=~~(l+g),!(t.x-_<0||t.x+b>r[0]||t.y-m<0||t.y+v>r[1]||rrt(t,n,s)))return nrt(t,n,s),!0}return!1}function nrt(n,t,e){const{wordSize:i}=n,r=n.sprite,s=i[0]>>5,o=e[0]>>5,a=n.x-(s<<4),l=a%32,h=32-l,d=i[1];let u,c=(n.y-(i[1]>>1))*o+(a>>5);if(l===0)for(let g=0;g<d;g++){for(let p=0;p<s;p++)t[c+p]|=r[g*s+p];c+=o}else for(let g=0;g<d;g++){u=0;for(let p=0;p<=s;p++)t[c+p]|=u<<h|(p<s?(u=r[g*s+p])>>>l:0);c+=o}}function rrt(n,t,e){const{sprite:i,wordSize:r}=n,s=e[0]>>5,o=r[0]>>5,a=n.x-(o<<4),l=a%32,h=32-l,d=r[1];let u,c=(n.y-(r[1]>>1))*s+(a>>5);if(l===0)for(let g=0;g<d;g++){for(let p=0;p<o;p++)if(t[c+p]&i[g*o+p])return!0;c+=s}else for(let g=0;g<d;g++){u=0;for(let p=0;p<=o;p++)if((u<<h|(p<o?(u=i[g*o+p])>>>l:0))&t[c+p])return!0;c+=s}return!1}function O8t(n){return function(t){return[n*(t*=.1)*Math.cos(t),t*Math.sin(t)]}}function $c(n,t,e,i){if(e[i].sprite||e[i].fontSize===0)return;const r=2048,s=Math.PI/180,o=e.length;n.width=r,n.height=2048,t.clearRect(0,0,r,2048),t.textAlign="center";let a,l,h=0,d=0,u=0,c=0;const g=i;for(--i;++i<o;){const v=e[i],_=Math.max(v.fontSize,2);if(t.save(),t.font=v.fontStyle+" "+v.fontWeight+" "+_+"px "+v.fontFamily,a=t.measureText(v.text+"m").width+2*v.padding,l=2*_+2*v.padding,v.rotate!==0){const b=Math.sin(v.rotate*s),y=Math.cos(v.rotate*s),C=a*y,S=a*b,w=l*y,x=l*b;a=Math.max(Math.abs(C+x),Math.abs(C-x)),l=~~Math.max(Math.abs(S+w),Math.abs(S-w))}if(a=a+31>>5<<5,l=Math.ceil(l),l>u&&(u=l),h+a>=r&&(h=0,d+=u,u=l),d+l>=2048){if(d===0){v.hasText=!1;continue}break}d+l>=c&&(c=d+l),t.translate(h+(a>>1),d+(l>>1)),v.rotate!==0&&t.rotate(v.rotate*s),t.fillText(v.text,0,0),v.padding&&(t.lineWidth=2*v.padding,t.strokeText(v.text,0,0)),t.restore(),v.LT=[h,d],v.wordSize=[a,l],v.hasText=!0,h+=a}if(c===0)return;const p=t.getImageData(0,0,r,c).data;let f,m;for(;--i>=g;){const v=e[i];if(!v.hasText){v.bounds={dTop:1/0,dBottom:-1/0,dLeft:1/0,dRight:-1/0};break}const{LT:_=[0,0],wordSize:b}=v;[h,d]=_;const y=b[0]>>5,C=new Array(y*b[1]).fill(0);let[S,w,x,A]=[1/0,-1/0,1/0,-1/0];for(m=0;m<b[1];m++){let M;for(f=0;f<b[0];f++)if(p[4*((d+m)*r+(h+f))+3]>0){const T=1<<31-f%32;C[y*m+(f>>5)]|=T,f<x&&(x=f),f>A&&(A=f),M|=T}M&&(m<S&&(S=m),m>w&&(w=m))}v.bounds={dTop:(b[1]>>1)-S,dBottom:w-(b[1]>>1),dLeft:(b[0]>>1)-x,dRight:A-(b[0]>>1)},v.sprite=C,delete v.LT}}function gH(n){const{segmentation:{labels:t},boardSize:e,size:i}=n,r=e[0]>>5,s=new Array(r*i[1]).fill(0);for(let o=0;o<i[1];o++)for(let a=0;a<i[0];a++)if(t[o*i[0]+a]===0){const l=1<<31-a%32;s[r*o+(a>>5)]|=l}if(e[0]>i[0]){const o=(1<<e[0]-i[0])-1;for(let a=0;a<i[1];a++)s[r*a+r-1]|=o}return s}function D8t(n,t,e){const{size:i,fillingTimes:r,fillingXStep:s,fillingYStep:o,getFillingFontStyle:a,getFillingFontWeight:l,getFillingFontFamily:h,fillingInitialFontSize:d,fillingDeltaFontSize:u,fillingInitialOpacity:c,fillingDeltaOpacity:g,fillingRotateList:p,getFillingPadding:f,random:m,board:v,minFillFontSize:_}=t,{boardSize:b,shapeBounds:y,tempCanvas:C,randomGenerator:S}=e,w=C.getContext("2d",{willReadFrequently:!0});let x=d,A=c;const M=[];for(let B=0;B<r;B++)T(x,A),x=Math.max(x>u?x-u:u,_),A=A>g?A-g:g;return M;function T(B,E){const k=n.map($=>{const{text:Y,color:G,fillingColor:tt,hasPlaced:st,datum:ot}=$;return{x:0,y:0,weight:0,text:Y,fontFamily:h(ot),fontStyle:a(ot),fontWeight:l(ot),fontSize:B,rotate:p[~~(S()*p.length)],padding:f(ot),opacity:E,visible:!0,color:G,fillingColor:tt,hasPlaced:st,datum:ot}});R(k);let P=0;const{x1:I,y1:O,x2:H,y2:z}=y,[F,j]=[I+~~(S()*s*2),O+~~(S()*o*2)];for(let $=j;$<=z;$+=o)for(let Y=F;Y<=H;Y+=s){$c(C,w,k,P);const G=k[P];G.x=Y,G.y=$;const{wordSize:tt,bounds:st,hasPlaced:ot}=G;if(!ot||!st){++P===k.length&&(P=0,m&&R(k));continue}const{dTop:rt,dBottom:pt,dLeft:at,dRight:W}=st;G.x-at<0||G.x+W>i[0]||G.y-rt<0||G.y+pt>i[1]||G.hasText&&G.sprite&&!rrt(G,v,b)&&(nrt(G,v,b),M.push(Object.assign({},G)),++P===k.length&&(P=0,m&&R(k)))}}function R(B){return B.sort(()=>S()-.5)}}function F8t(n,t,e){E8t(n,e),t.layoutMode==="ensureMapping"?irt(n,t,e):t.layoutMode==="ensureMappingEnlarge"?I8t(n,t,e):L8t(n,t,e);const i=D8t(n,t,e),r=[],s=[];for(let o=0;o<n.length;o++)n[o].hasPlaced?s.push(n[o]):r.push(n[o]);return r.forEach(o=>o.visible=!1),{fillingWords:i,successedWords:s,failedWords:r}}const u7={x:"x",y:"y",fontFamily:"fontFamily",fontSize:"fontSize",fontStyle:"fontStyle",fontWeight:"fontWeight",angle:"angle",opacity:"opacity",visible:"visible",isFillingWord:"isFillingWord",color:"color"};class H8t{constructor(t,e){this.progressiveResult=[],this.options=t,this.view=e}layout(t){this.data=t;const e=this.options,i={shapeUrl:e.shape,size:e.size,ratio:e.ratio||.8,tempCanvas:void 0,boardSize:[0,0],random:!1,randomGenerator:void 0},r=le.createCanvas({width:e.size[0],height:e.size[1]}),s=r.getContext("2d",{willReadFrequently:!0});s.textAlign="center",s.textBaseline="middle",i.tempCanvas=r;const o=e.size[0]+31>>5<<5;if(i.boardSize=[o,e.size[1]],i.random?i.randomGenerator=Math.random:i.randomGenerator=A8t(),this.segmentationInput=i,yt(i.shapeUrl)){i.isEmptyPixel=L2();const a=T8t(i.shapeUrl);a?(this.isImageFinished=!1,this.isLayoutFinished=!1,a.then(l=>{this.isImageFinished=!0;const h=le.createCanvas({width:e.size[0],height:e.size[1],dpr:1});i.maskCanvas=h;const d=h.getContext("2d");e.removeWhiteBorder&&B8t(l,h,i.isEmptyPixel);const u=P8t(l,e.size);d.clearRect(0,0,e.size[0],e.size[1]),d.drawImage(l,u.x,u.y,u.width,u.height),this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(i.maskCanvas)}).catch(l=>{this.isImageFinished=!0})):(this.isImageFinished=!0,this.isLayoutFinished=!0)}else if(i.shapeUrl&&(i.shapeUrl.type==="text"||i.shapeUrl.type==="geometric")){i.isEmptyPixel=L2(i.shapeUrl.backgroundColor);const a=ttt(i.shapeUrl,e.size[0],e.size[1]);i.maskCanvas=a,this.options.onUpdateMaskCanvas&&this.options.onUpdateMaskCanvas(a),this.doLayout(),this.isImageFinished=!0,this.isLayoutFinished=!0}}canAnimate(){return!0}unfinished(){return!this.isLayoutFinished}output(){return this.progressiveResult}progressiveRun(){this.isImageFinished&&!this.isLayoutFinished&&(this.segmentationInput.maskCanvas&&this.doLayout(),this.isLayoutFinished=!0)}progressiveOutput(){return this.progressiveResult}doLayout(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S;const w=this.segmentationInput,x=R8t(w);if(!x.segmentation.regions.length)return;const A=this.options,M=this.data,T=A.colorMode||"ordinal",R={getText:kr(A.text),getFontSize:kr(A.fontSize),fontSizeRange:A.fontSizeRange,colorMode:T,getColor:A.colorField?kr(A.colorField):kr(A.text),getFillingColor:kr(A.fillingColorField),colorList:A.colorList||(T==="ordinal"?["#2E62F1"]:["#537EF5","#2E62F1","#2358D8","#184FBF","#0C45A6","#013B8E"]),getColorHex:kr(A.colorHexField),getFontFamily:kr(A.fontFamily||"sans-serif"),rotateList:A.rotateList||[0],getPadding:kr(A.padding||1),getFontStyle:kr(A.fontStyle||"normal"),getFontWeight:kr(A.fontWeight||"normal"),getFontOpacity:A.fontOpacity?kr(A.fontOpacity):()=>1};W8t(M,R,x);const B={size:A.size,ratio:A.ratio||.8,shapeUrl:A.shape,random:A.random===void 0||A.random,textLayoutTimes:(t=A.textLayoutTimes)!==null&&t!==void 0?t:3,removeWhiteBorder:A.removeWhiteBorder,layoutMode:(e=A.layoutMode)!==null&&e!==void 0?e:"default",fontSizeShrinkFactor:(i=A.fontSizeShrinkFactor)!==null&&i!==void 0?i:.8,stepFactor:(r=A.stepFactor)!==null&&r!==void 0?r:1,importantWordCount:(s=A.importantWordCount)!==null&&s!==void 0?s:10,globalShinkLimit:A.globalShinkLimit||.2,fontSizeEnlargeFactor:(o=A.fontSizeEnlargeFactor)!==null&&o!==void 0?o:1.5,fillingRatio:(a=A.fillingRatio)!==null&&a!==void 0?a:.7,fillingTimes:(l=A.fillingTimes)!==null&&l!==void 0?l:4,fillingXStep:A.fillingXRatioStep?Math.max(Math.floor(A.size[0]*A.fillingXRatioStep),1):(h=A.fillingXStep)!==null&&h!==void 0?h:4,fillingYStep:A.fillingYRatioStep?Math.max(Math.floor(A.size[1]*A.fillingYRatioStep),1):(d=A.fillingYStep)!==null&&d!==void 0?d:4,fillingInitialFontSize:A.fillingInitialFontSize,fillingDeltaFontSize:A.fillingDeltaFontSize,fillingInitialOpacity:(u=A.fillingInitialOpacity)!==null&&u!==void 0?u:.8,fillingDeltaOpacity:(c=A.fillingDeltaOpacity)!==null&&c!==void 0?c:.05,getFillingFontFamily:kr(A.fillingFontFamily||"sans-serif"),getFillingFontStyle:kr(A.fillingFontStyle||"normal"),getFillingFontWeight:kr(A.fillingFontWeight||"normal"),getFillingPadding:kr((g=A.fillingPadding)!==null&&g!==void 0?g:.4),fillingRotateList:(p=A.fillingRotateList)!==null&&p!==void 0?p:[0,90],fillingDeltaFontSizeFactor:(f=A.fillingDeltaFontSizeFactor)!==null&&f!==void 0?f:.2,fillingColorList:A.fillingColorList||["#537EF5"],sameColorList:!1,minInitFontSize:(m=A.minInitFontSize)!==null&&m!==void 0?m:10,minFontSize:(v=A.minFontSize)!==null&&v!==void 0?v:4,minFillFontSize:(_=A.minFillFontSize)!==null&&_!==void 0?_:2},E=w8t(R.colorList,B.fillingColorList);B.sameColorList=E,z8t(M,R,B,A),j8t(M,R,B,x);const{getText:k,getFontFamily:P,getFontStyle:I,getFontWeight:O,getPadding:H,getColor:z,getFillingColor:F,getColorHex:j,fontSizeScale:$,colorScale:Y,fillingColorScale:G,getFontOpacity:tt,rotateList:st}=R,ot=M.map(U=>{var ut,lt;return{x:0,y:0,weight:0,text:k(U),fontFamily:P(U),fontWeight:O(U),fontStyle:I(U),rotate:st[~~(w.randomGenerator()*st.length)],fontSize:Math.max(B.minInitFontSize,~~$(U)),opacity:tt(U),padding:H(U),color:j&&j(U)||Y&&Y(z(U))||"black",fillingColor:!F||((ut=A.colorField)===null||ut===void 0?void 0:ut.field)===((lt=A.fillingColorField)===null||lt===void 0?void 0:lt.field)&&E?void 0:j&&j(U)||G&&G(F(U))||"black",datum:U,visible:!0,hasPlaced:!1}}),rt=Mi(ot.map(U=>U.fontSize));ot.forEach(U=>U.weight=U.fontSize/rt),ot.sort((U,ut)=>ut.weight-U.weight);const{fillingWords:pt,successedWords:at,failedWords:W}=F8t(ot,B,x),N=(y=(b=A.text)===null||b===void 0?void 0:b.field)!==null&&y!==void 0?y:"textKey",K=(C=A.dataIndexKey)!==null&&C!==void 0?C:"defaultDataIndexKey",nt=A.as?Object.assign(Object.assign({},u7),A.as):u7;let X,ht;const _t=[];for(let U=0;U<ot.length;++U)X=ot[U],ht=X.datum,ht[nt.x]=X.x,ht[nt.y]=X.y,ht[nt.fontFamily]=X.fontFamily,ht[nt.fontSize]=X.fontSize,ht[nt.fontStyle]=X.fontStyle,ht[nt.fontWeight]=X.fontWeight,ht[nt.angle]=Te(X.rotate),ht[nt.opacity]=X.opacity,ht[nt.visible]=X.visible,ht[nt.isFillingWord]=!1,ht[nt.color]=X.color,ht[K]=`${X.text}_${U}_keyword`,_t.push(ht);const ct=[];if(pt.forEach((U,ut)=>{var lt,At;const ft=Object.assign({},U.datum);ft[nt.x]=U.x,ft[nt.y]=U.y,ft[nt.fontFamily]=U.fontFamily,ft[nt.fontSize]=U.fontSize,ft[nt.fontStyle]=U.fontStyle,ft[nt.fontWeight]=U.fontWeight,ft[nt.angle]=Te(U.rotate),ft[nt.opacity]=U.opacity,ft[nt.visible]=U.visible,ft[nt.isFillingWord]=!0,ft[nt.color]=F?((lt=A.colorField)===null||lt===void 0?void 0:lt.field)===((At=A.fillingColorField)===null||At===void 0?void 0:At.field)&&E?U.color:U.fillingColor:B.fillingColorList[~~(w.randomGenerator()*B.fillingColorList.length)],ft[N]=U.text,ft[K]=`${U.text}_${ut}_fillingWords`,ct.push(ft)}),this.view&&this.view.emit){this.view.emit($u.AFTER_WORDCLOUD_SHAPE_LAYOUT,{successedWords:at,failedWords:W});const U=(S=this.view.renderer)===null||S===void 0?void 0:S.stage();U&&U.hooks.afterRender.tap($u.AFTER_WORDCLOUD_SHAPE_DRAW,()=>{this.view.emit($u.AFTER_WORDCLOUD_SHAPE_DRAW,{successedWords:at,failedWords:W}),U.hooks.afterRender.unTap($u.AFTER_WORDCLOUD_SHAPE_DRAW)})}this.progressiveResult=_t.concat(ct)}release(){this.segmentationInput=null,this.data=null,this.progressiveResult=null,this.options=null}}const z8t=(n,t,e,i)=>{var r,s,o,a;const{colorMode:l,getColor:h,getFillingColor:d}=t,{sameColorList:u}=e;let c,g,p=t.colorList,f=e.fillingColorList;if(l==="ordinal"){const m=n.map(v=>h(v));if(c=v=>new Mc().domain(m).range(p).scale(v),d&&(((r=i.colorField)===null||r===void 0?void 0:r.field)!==((s=i.fillingColorField)===null||s===void 0?void 0:s.field)||!u)){const v=n.map(_=>d(_));g=_=>new Mc().domain(v).range(f).scale(_)}}else{p.length===1&&(p=[p[0],p[0]]);const m=new Vs().domain(Kv(h,n)).range(p);if(c=v=>m.scale(v),d&&(((o=i.colorField)===null||o===void 0?void 0:o.field)!==((a=i.fillingColorField)===null||a===void 0?void 0:a.field)||!u)){f.length===1&&(f=[f[0],f[0]]);const v=new Vs().domain(Kv(d,n)).range(f);g=_=>v.scale(_)}}Object.assign(t,{colorScale:c,fillingColorScale:g})},W8t=(n,t,e)=>{let{fontSizeRange:i}=t;const{getFontSize:r,getText:s}=t;let o;if(r){if(r&&i){const a=new jw().domain(Kv(r,n)).range(i);o=l=>a.scale(r(l))}else if(r&&it(r)&&!i){const[l,h]=Kv(r,n),d=n.map(g=>({text:s(g),value:r(g),weight:h===l?1:(r(g)-l)/(h-l)})),u=c7(d,e,!0);i=[~~(.5*u),~~u];const c=new jw().domain(Kv(r,n)).range(i);o=g=>c.scale(r(g))}}else{const a=n.map(h=>({text:s(h)})),l=c7(a,e,!1);o=k8t(l)}Object.assign(t,{getFontSize:r,fontSizeRange:i,fontSizeScale:o})},c7=(n,t,e)=>{const i=t.shapeArea,r=t.ratio,s=t.segmentation.regions,o=Math.ceil(Math.sqrt(i)/12),a=n.reduce((h,d)=>{const u=ert(d.text);return u<o?h+u*(e?(.5+.5*d.weight)**2:1):h},0);if(a===0)return 12;let l=20;if(s.length===1)l=Math.sqrt(r*(i/(1.7*a)));else{const h=[];for(let d=0;d<s.length;d++){const u=s[d].area,c=s[d].ratio,g=u/i;if(g<.1)continue;const p=g*(a*(c<1?2.7-c:1.7)),f=Math.sqrt(r*(u/p));h.push(f)}l=h.length?Math.min(...h):Math.sqrt(r*(i/(1.7*a)))}return l};function j8t(n,t,e,i){const{getText:r}=t;let{fillingInitialFontSize:s,fillingDeltaFontSize:o}=e;const{fillingRatio:a}=e,l=Math.ceil(Math.sqrt(i.shapeArea)/4);if(!s||!o){const h=a/100,d=n.reduce((c,g)=>{const p=ert(r(g));return p>l?c:c+p},0)/n.length;let u;if(d===0)u=8;else{const c=.2*i.shapeArea;u=Math.sqrt(h*(c/d))}s=~~u,o=u*e.fillingDeltaFontSizeFactor,Object.assign(e,{fillingInitialFontSize:s,fillingDeltaFontSize:o})}}const Kv=(n,t)=>{let e=1/0,i=-1/0;const r=t.length;let s;for(let o=0;o<r;++o)s=zl(n(t[o])),s<e&&(e=s),s>i&&(i=s);return t.length===1&&e===i&&(e-=1e4),[e,i]},kr=n=>n?typeof n=="string"||typeof n=="number"?()=>n:it(n)?n:t=>t[n.field]:null,N8t=(n,t,e,i)=>{if(!n.size||D(n.size[0])||D(n.size[1])||n.size[0]<=0||n.size[1]<=0)return ge.getInstance().info("Wordcloud size dimensions must be greater than 0"),[];if(n.size=[Math.ceil(n.size[0]),Math.ceil(n.size[1])],n.shape||ec("WordcloudShape shape must be specified."),n.text||ec("WordcloudShape text must be specified."),i!=null&&i.emit&&i.emit($u.BEFORE_WORDCLOUD_SHAPE_LAYOUT),!t||t.length===0)return[];const r=new H8t(n,i);return r.layout(t),r.unfinished()?{progressive:r}:r.output()},srt=()=>{dt.registerTransform("wordcloudShape",{transform:N8t,markPhase:"beforeJoin"},!0)};class D0 extends Nc{constructor(){super(...arguments),this.type=gt.wordCloud}}D0.type=gt.wordCloud;const ort=()=>{UT(),_s(),Znt(),q.registerSeries(D0.type,D0)},$8t=()=>{srt(),UT(),_s(),Znt(),q.registerSeries(D0.type,D0)};class F0 extends Nc{constructor(){super(...arguments),this.type=gt.wordCloud3d}_wordCloudTransformOption(){var t;return Object.assign(Object.assign({},super._wordCloudTransformOption()),{postProjection:(t=this._spec.postProjection)!==null&&t!==void 0?t:"StereographicProjection",depth_3d:this._spec.depth_3d})}_wordCloudShapeTransformOption(){var t;return Object.assign(Object.assign({},super._wordCloudShapeTransformOption()),{postProjection:(t=this._spec.postProjection)!==null&&t!==void 0?t:"StereographicProjection",depth_3d:this._spec.depth_3d})}initMark(){this._wordMark=this._createMark(Nc.mark.word,{groupKey:this._seriesField,isSeriesMark:!0},{support3d:!0})}initMarkStyle(){super.initMarkStyle();const t=this._wordMark;t&&this.setMarkStyle(t,{z:e=>{var i;return(i=e.z)!==null&&i!==void 0?i:0}},"normal",wt.Series)}initAnimation(){var t,e;const i=(t=this._padding)!==null&&t!==void 0?t:{};this._wordMark&&this._wordMark.setAnimationConfig(Ae((e=q.getAnimationInKey("wordCloud3d"))===null||e===void 0?void 0:e(()=>{var r;const s=this.getCompiler().getVGrammarView(),o=s.width()-i.left||0-i.right||0,a=s.height()-i.top||0-i.bottom||0,l=Math.max(o,a)/2;return{center:{x:l,y:l,z:(r=this._spec.depth_3d)!==null&&r!==void 0?r:l},r:l}}),Fe("word",this._spec,this._markAttributeContext)))}}F0.type=gt.wordCloud3d;const art=()=>{UT(),_s(),Jnt(),q.registerSeries(F0.type,F0)},V8t=()=>{srt(),UT(),_s(),Jnt(),q.registerSeries(F0.type,F0)},G8t=(n,t)=>{var e,i;const r=n.map(C=>Object.assign({},C));if(!r||r.length===0)return r;const{valueField:s,asTransformRatio:o,asReachRatio:a,asHeightRatio:l,asValueRatio:h,asNextValueRatio:d,asLastValueRatio:u,asLastValue:c,asCurrentValue:g,asNextValue:p,heightVisual:f=!1,isCone:m=!0,range:v}=t,_=r.reduce((C,S)=>Math.max(C,Number.parseFloat(S[s])||-1/0),-1/0),b=r.reduce((C,S)=>Math.min(C,Number.parseFloat(S[s])||1/0),1/0),y=[(e=v==null?void 0:v.min)!==null&&e!==void 0?e:b,(i=v==null?void 0:v.max)!==null&&i!==void 0?i:_];return r.forEach((C,S)=>{var w,x;const A=Number.parseFloat(C[s]),M=Number.parseFloat((w=r[S-1])===null||w===void 0?void 0:w[s]),T=Number.parseFloat((x=r[S+1])===null||x===void 0?void 0:x[s]),R=et(T*A)&&A!==0?T/A:0,B=et(A*M)&&M!==0?A/M:0;c&&(C[c]=M),p&&(C[p]=T),o&&(C[o]=R),a&&(C[a]=S===0?1:B),l&&(C[l]=f===!0?R:1/r.length),h&&(C[h]=A/y[1]),d&&(C[d]=S===r.length-1?m?0:C[h]:T/y[1]),u&&(C[u]=S===0?1:M/y[1]),g&&(C[g]=A)}),r},U8t=(n,t)=>{var e,i;const r=(i=(e=n[0])===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.map(s=>Object.assign({},s));return r&&r.length!==0&&(r.shift(),r.forEach(s=>{s[t.asIsTransformLevel]=!0})),r},Y8t=`${Wt}_FUNNEL_TRANSFORM_RATIO`,$I=`${Wt}_FUNNEL_REACH_RATIO`,X8t=`${Wt}_FUNNEL_HEIGHT_RATIO`,sC=`${Wt}_FUNNEL_VALUE_RATIO`,g7=`${Wt}_FUNNEL_LAST_VALUE_RATIO`,p7=`${Wt}_FUNNEL_NEXT_VALUE_RATIO`,K8t=`${Wt}_FUNNEL_LAST_VALUE`,q8t=`${Wt}_FUNNEL_CURRENT_VALUE`,Z8t=`${Wt}_FUNNEL_NEXT_VALUE`,f7=`${Wt}_FUNNEL_TRANSFORM_LEVEL`,J8t=20,du=5,Q8t="80%",t7t=0;class e7t extends wr{constructor(t){var e,i;super(t),this.dimensionTooltipTitleCallback=(r,s)=>{var o,a,l;const h=this.series;return((o=s==null?void 0:s.mark)===null||o===void 0?void 0:o.name)==="transform"?this._transformRatioText:(a=this._getDimensionData(r))!==null&&a!==void 0?a:(l=r.properties)===null||l===void 0?void 0:l[`${h.getCategoryField()}`]},this.markTooltipValueCallback=(r,s)=>{var o;return((o=s==null?void 0:s.mark)===null||o===void 0?void 0:o.name)==="transform"?`${(100*(r==null?void 0:r[$I])).toFixed(1)}%`:this._getMeasureData(r)},this.markTooltipKeyCallback=(r,s)=>{var o;if(((o=s==null?void 0:s.mark)===null||o===void 0?void 0:o.name)==="transform")return this._transformRatioText;const{dimensionFields:a,seriesFields:l}=this._seriesCacheInfo,h=a[a.length-1];return L(l[0])?r==null?void 0:r[l[0]]:r==null?void 0:r[h]},this._transformRatioText=(i=(e=t.getSpec())===null||e===void 0?void 0:e.transformRatioText)!==null&&i!==void 0?i:""}}class lrt extends sr{_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{points:[]})}}class H0 extends lrt{constructor(){super(...arguments),this.type=H0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{lineWidth:0})}}H0.type="polygon";const hrt=()=>{q.registerMark(H0.type,H0),rNt(),rnt()},i7t=Object.assign(Object.assign({},Hi),{funnel:{name:"funnel",type:"polygon"},transform:{name:"transform",type:"polygon"},transformLabel:{name:"transformLabel",type:"text"},outerLabel:{name:"outerLabel",type:"text"},outerLabelLine:{name:"outerLabelLine",type:"rule"}}),n7t=Object.assign(Object.assign({},Hi),{funnel3d:{name:"funnel3d",type:"pyramid3d"},transform3d:{name:"transform3d",type:"pyramid3d"},transformLabel:{name:"transformLabel",type:"text"},outerLabel:{name:"outerLabel",type:"text"},outerLabelLine:{name:"outerLabelLine",type:"rule"}});class pH extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"funnel"),t.isTransform&&this._addMarkLabelSpec(t,"transform","transformLabel")}}class Qo extends zc{constructor(){super(...arguments),this.type=gt.funnel,this._funnelMarkName="funnel",this._funnelMarkType="polygon",this._transformMarkName="transform",this._transformMarkType="polygon",this.transformerConstructor=pH,this._funnelMark=null,this._funnelTransformMark=null,this._labelMark=null,this._transformLabelMark=null,this._funnelOuterLabelMark={}}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}setAttrFromSpec(){var t,e,i,r,s;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this._funnelOrient=(t=this._spec.funnelOrient)!==null&&t!==void 0?t:"top",this._shape=(e=this._spec.shape)!==null&&e!==void 0?e:"trapezoid",this._minLabelLineWidth=(s=(r=(i=this._spec.outerLabel)===null||i===void 0?void 0:i.line)===null||r===void 0?void 0:r.minLength)!==null&&s!==void 0?s:J8t,this._isHorizontal()?this._funnelAlign=["top","bottom"].includes(this._spec.funnelAlign)?this._spec.funnelAlign:"center":this._funnelAlign=["left","right"].includes(this._spec.funnelAlign)?this._spec.funnelAlign:"center",!this._seriesField&&this._spec.categoryField&&this.setSeriesField(this._spec.categoryField)}initData(){if(super.initData(),!this._data)return;Vt(this._dataSet,"funnel",G8t),Vt(this._dataSet,"funnelTransform",U8t);const t=new Ve(this._dataSet,{name:`${Wt}_series_${this.id}_viewDataTransform`});t.parse([this.getViewData()],{type:"dataview"}),this._viewDataTransform=new tl(this._option,t)}compileData(){var t;super.compileData(),(t=this._viewDataTransform)===null||t===void 0||t.compile()}getStatisticFields(){const t=[];return t.push({key:this._categoryField,operations:["values"]}),t.push({key:this._valueField,operations:["max","min"]}),t}_statisticViewData(){var t,e,i,r,s,o,a,l,h;super._statisticViewData(),this._data.getDataView().transform({type:"funnel",options:{valueField:this.getValueField(),isCone:this._spec.isCone,asCurrentValue:q8t,asTransformRatio:Y8t,asReachRatio:$I,asHeightRatio:X8t,asValueRatio:sC,asNextValueRatio:p7,asLastValueRatio:g7,asLastValue:K8t,asNextValue:Z8t,range:{min:(e=(t=this._spec.range)===null||t===void 0?void 0:t.min)!==null&&e!==void 0?e:(r=(i=this.getViewDataStatistics().latestData)===null||i===void 0?void 0:i[this.getValueField()])===null||r===void 0?void 0:r.min,max:(o=(s=this._spec.range)===null||s===void 0?void 0:s.max)!==null&&o!==void 0?o:(l=(a=this.getViewDataStatistics().latestData)===null||a===void 0?void 0:a[this.getValueField()])===null||l===void 0?void 0:l.max}}}),(h=this._viewDataTransform.getDataView())===null||h===void 0||h.transform({type:"funnelTransform",options:{asIsTransformLevel:f7}})}initMark(){var t,e,i,r,s,o,a,l,h,d,u,c;if(this._funnelMark=this._createMark(Object.assign(Object.assign({},Qo.mark.funnel),{name:this._funnelMarkName,type:this._funnelMarkType}),{themeSpec:(t=this._theme)===null||t===void 0?void 0:t.funnel,groupKey:this._seriesField,isSeriesMark:!0,stateSort:(e=this._spec.funnel)===null||e===void 0?void 0:e.stateSort,noSeparateStyle:!0},{setCustomizedShape:(i=this._spec.funnel)===null||i===void 0?void 0:i.customShape,morph:ll(this._spec,this._funnelMarkName),morphElementKey:this._seriesField}),this._spec.isTransform&&(this._funnelTransformMark=this._createMark(Object.assign(Object.assign({},Qo.mark.transform),{name:this._transformMarkName,type:this._transformMarkType}),{themeSpec:(r=this._theme)===null||r===void 0?void 0:r.transform,skipBeforeLayouted:!0,dataView:this._viewDataTransform.getDataView(),dataProductId:this._viewDataTransform.getProductId(),stateSort:(s=this._spec.transform)===null||s===void 0?void 0:s.stateSort,noSeparateStyle:!0},{setCustomizedShape:(o=this._spec.transform)===null||o===void 0?void 0:o.customShape})),(l=(a=this._spec)===null||a===void 0?void 0:a.outerLabel)===null||l===void 0?void 0:l.visible){const{line:g}=(h=this._spec.outerLabel)!==null&&h!==void 0?h:{},{line:p}=(u=(d=this._theme)===null||d===void 0?void 0:d.outerLabel)!==null&&u!==void 0?u:{};this._funnelOuterLabelMark.label=this._createMark(Qo.mark.outerLabel,{themeSpec:(c=this._theme)===null||c===void 0?void 0:c.outerLabel,markSpec:this._spec.outerLabel,skipBeforeLayouted:!0,noSeparateStyle:!0}),this._funnelOuterLabelMark.line=this._createMark(Qo.mark.outerLabelLine,{themeSpec:p,markSpec:g,depend:[this._funnelOuterLabelMark.label],noSeparateStyle:!0})}}initTooltip(){this._tooltipHelper=new e7t(this),this._funnelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._funnelMark),this._funnelTransformMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._funnelTransformMark)}getDimensionField(){return this._seriesField?[this._seriesField]:[]}getMeasureField(){return[this._valueField]}getGroupFields(){return null}initMarkStyle(){const t=this._funnelMark;t&&this.setMarkStyle(t,{points:s=>this.getPoints(s),visible:s=>L(s[this._valueField]),fill:this.getColorAttribute()},"normal",wt.Series);const e=this._funnelTransformMark;e&&this.setMarkStyle(e,{points:s=>this.getPoints(s)},"normal",wt.Series);const i=this._funnelOuterLabelMark.label;i&&(this.setMarkStyle(i,{text:s=>`${s[this.getCategoryField()]}`,x:s=>this._computeOuterLabelPosition(s).x,y:s=>this._computeOuterLabelPosition(s).y,textAlign:s=>this._computeOuterLabelPosition(s).align,textBaseline:s=>this._computeOuterLabelPosition(s).textBaseline,maxLineWidth:s=>this._computeOuterLabelLimit(s),width:0,height:0},"normal",wt.Series),it(this._spec.outerLabel.formatMethod)&&this.setMarkStyle(i,{text:s=>this._spec.outerLabel.formatMethod(`${s[this.getCategoryField()]}`,s)},"normal",wt.User_Mark));const r=this._funnelOuterLabelMark.line;r&&i&&this.setMarkStyle(r,{x:s=>this._computeOuterLabelLinePosition(s).x1,y:s=>this._computeOuterLabelLinePosition(s).y1,x1:s=>this._computeOuterLabelLinePosition(s).x2,y1:s=>this._computeOuterLabelLinePosition(s).y2},"normal",wt.Series)}initLabelMarkStyle(t){var e,i;if(!t)return;const r=t.getTarget(),s=t.getComponent();r===this._funnelMark?(this._labelMark=t,this.setMarkStyle(t,{text:o=>`${o[this.getCategoryField()]} ${o[this.getValueField()]}`,x:o=>this._computeLabelPosition(o).x,y:o=>this._computeLabelPosition(o).y,maxLineWidth:o=>this._computeLabelLimit(o,this._spec.label),stroke:this.getColorAttribute()},"normal",wt.Series),!((e=this._funnelOuterLabelMark)===null||e===void 0)&&e.label&&this._funnelOuterLabelMark.label.setDepend(s),!((i=this._funnelOuterLabelMark)===null||i===void 0)&&i.line&&this._funnelOuterLabelMark.line.setDepend(...this._funnelOuterLabelMark.line.getDepend())):this._funnelTransformMark&&r===this._funnelTransformMark&&(this._transformLabelMark=t,this.setMarkStyle(t,{text:o=>`${(100*DC($I).bind(this)(o)).toFixed(1)}%`,x:o=>this._computeLabelPosition(o).x,y:o=>this._computeLabelPosition(o).y,maxLineWidth:o=>this._computeLabelLimit(o,this._spec.transformLabel)},"normal",wt.Series))}initAnimation(){var t,e,i,r,s,o,a;const l=(i=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset)!==null&&i!==void 0?i:"clipIn";l==="clipIn"&&this._rootMark&&this._rootMark.setAnimationConfig(Ae((r=q.getAnimationInKey("cartesianGroupClip"))===null||r===void 0?void 0:r({direction:()=>this._isHorizontal()?"x":"y",width:()=>{const h=this.getRootMark().getProduct();if(h){const{x1:d,x2:u}=h.getBounds();return Math.max(d,u)}return this.getLayoutRect().width},height:()=>{const h=this.getRootMark().getProduct();if(h){const{y1:d,y2:u}=h.getBounds();return Math.max(d,u)}return this.getLayoutRect().height},orient:()=>this._isReverse()?"negative":"positive"},l),Fe("group",this._spec,this._markAttributeContext))),[(s=this._funnelOuterLabelMark)===null||s===void 0?void 0:s.label].forEach(h=>{h&&h.setAnimationConfig(Ae(q.getAnimationInKey("fadeInOut")(),Fe(h.name,this._spec,this._markAttributeContext)))}),[this._funnelMark,this._funnelTransformMark].forEach(h=>{h&&h.setAnimationConfig(Ae(q.getAnimationInKey("funnel")({},l),Fe(h.name,this._spec,this._markAttributeContext)))}),!((o=this._funnelOuterLabelMark)===null||o===void 0)&&o.line&&this._funnelOuterLabelMark.line.setAnimationConfig(Ae((a=q.getAnimationInKey("fadeInOut"))===null||a===void 0?void 0:a(),Fe("outerLabelLine",this._spec,this._markAttributeContext)))}initGroups(){}getStackGroupFields(){return[]}getStackValueField(){return null}initEvent(){var t;super.initEvent(),(t=this._viewDataTransform.getDataView())===null||t===void 0||t.target.addListener("change",e=>{this._viewDataTransform.updateData()})}getPoints(t){const e=this.isTransformLevel(t),i=this._getMainAxisLength(e)/2;let r,s;e?(r=this._shape==="rect"?this._getSecondaryAxisLength(t[g7])/2:this._getSecondaryAxisLength(t[sC])/2,s=this._getSecondaryAxisLength(t[sC])/2):(r=this._getSecondaryAxisLength(t[sC])/2,s=this._shape==="rect"?r:this._getSecondaryAxisLength(t[p7])/2);const{x:o,y:a}=this._getPositionByData(t),l=this._getPolygonPoints([o,a],r,s,r,s,i);return this._funnelAlign!=="center"&&this._adjustPoints(l),l}isTransformLevel(t){return!!(t!=null&&t[f7])}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToPosition=this.valueToPosition.bind(this),this._markAttributeContext.getPoints=this.getPoints.bind(this),this._markAttributeContext.isTransformLevel=this.isTransformLevel.bind(this)}valueToPosition(t){var e,i,r;const s=(r=(i=(e=this.getViewData())===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i.find)===null||r===void 0?void 0:r.call(i,o=>o[this._categoryField]===t);return L(s)?this._getPolygonCenter(this.getPoints(s)):null}dataToPosition(t,e){return e&&!this.isDatumInViewData(t)?null:this.valueToPosition(t[this._categoryField])}dataToPositionX(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.x}dataToPositionY(t){var e;return(e=this.dataToPosition(t))===null||e===void 0?void 0:e.y}dataToPositionZ(t){return 0}_getMainAxisLength(t=!1){var e;const i=this.getViewData().latestData.length,r=this._isHorizontal()?this.getLayoutRect().width:this.getLayoutRect().height,s=!!this._spec.isTransform,o=s?0:(e=this._spec.gap)!==null&&e!==void 0?e:0,a=s?Math.max(0,i-1):0,l=this._spec.heightRatio||.5,h=(r-o*Math.max(0,i-1))/(i+l*a);return t?s?h*l:0:h}_getSecondaryAxisLength(t){const e=Number.isNaN(t)||!Number.isFinite(t)?0:t,i=this._computeMaxSize(),r=this._computeMinSize();return r+(i-r)*e}_getPositionByData(t){var e;const i=(e=this.getViewData().latestData)===null||e===void 0?void 0:e.findIndex(c=>c[this._categoryField]===t[this._categoryField]&&c[sa]===t[sa]);if(!L(i)||i<0)return{};const r=this.isTransformLevel(t),s=this._isHorizontal(),o=s?this.getLayoutRect().height:this.getLayoutRect().width,a=s?this.getLayoutRect().width:this.getLayoutRect().height,l=o/2;let h=0;const d=this._getMainAxisLength(),u=this._getMainAxisLength(!0);return h+=i*(d+u),h+=r?-u/2:d/2,!this._spec.isTransform&&this._spec.gap&&(h+=this._spec.gap*i),this._isReverse()&&(h=a-h),this._isHorizontal()?{x:h,y:l}:{x:l,y:h}}_getPolygonPoints(t,e,i,r,s,o){const a=t[0],l=t[1];switch(this._funnelOrient){case"left":return[{x:a-o,y:l+e},{x:a-o,y:l-r},{x:a+o,y:l-s},{x:a+o,y:l+i}];case"right":return[{x:a+o,y:l-r},{x:a+o,y:l+r},{x:a-o,y:l+i},{x:a-o,y:l-i}];case"bottom":return[{x:a+e,y:l+o},{x:a-r,y:l+o},{x:a-s,y:l-o},{x:a+i,y:l-o}];default:return[{x:a-e,y:l-o},{x:a+r,y:l-o},{x:a+s,y:l+o},{x:a-i,y:l+o}]}}_getPolygonCenter(t){if(this._isHorizontal()){const r=(t[0].x+t[3].x)/2,s=(t[0].y+t[3].y)/2;return{x:(r+(t[1].x+t[2].x)/2)/2,y:(s+(t[1].y+t[2].y)/2)/2}}const e=(t[0].x+t[3].x)/2,i=(t[0].y+t[3].y)/2;return{x:(e+(t[1].x+t[2].x)/2)/2,y:(i+(t[1].y+t[2].y)/2)/2}}_adjustPoints(t){let e,i,r;return this._isHorizontal()?(r="y",this._funnelOrient==="left"?(e=this._funnelAlign==="bottom"?-t[1].y:t[1].y,i=this._funnelAlign==="bottom"?-t[2].y:t[2].y):(e=this._funnelAlign==="bottom"?-t[0].y:t[0].y,i=this._funnelAlign==="bottom"?-t[3].y:t[3].y)):(r="x",this._funnelOrient==="top"?(e=this._funnelAlign==="left"?t[0].x:-t[0].x,i=this._funnelAlign==="left"?t[3].x:-t[3].x):(e=this._funnelAlign==="left"?t[1].x:-t[1].x,i=this._funnelAlign==="left"?t[2].x:-t[2].x)),t[0][r]-=e,t[1][r]-=e,t[2][r]-=i,t[3][r]-=i,t}_computeLabelPosition(t){const e=this.getPoints(t);return this._getPolygonCenter(e)}_computeLabelLimit(t,e){const i=e==null?void 0:e.limit;if(J(i))return i;const r=this.getPoints(t);return i==="shapeSize"?this._isHorizontal()?Math.abs(r[3].x-r[0].x):(Math.abs(r[0].x-r[1].x)+Math.abs(r[2].x-r[3].x))/2:this._isHorizontal()?Math.abs(r[3].x-r[0].x):void 0}_computeOuterLabelPosition(t){var e,i;let r,s,o=(e=this._spec.outerLabel)===null||e===void 0?void 0:e.position,a="center",l="middle";if(o=this._isHorizontal()?["top","bottom"].includes(o)?o:this._funnelAlign==="bottom"?"top":"bottom":["left","right"].includes(o)?o:this._funnelAlign==="left"?"right":"left",((i=this._spec.outerLabel)===null||i===void 0?void 0:i.alignLabel)!==!1)({x:r,y:s}=this._getPositionByData(t)),o==="left"?(r=0,a="left"):o==="right"?(r=this.getLayoutRect().width,a="right"):o==="top"?(s=0,l="top"):o==="bottom"&&(s=this.getLayoutRect().height,l="bottom");else{const{x2:h,y2:d}=this._computeOuterLabelLinePosition(t);r=h,s=d,o==="left"?(r-=du,a="right"):o==="right"?(r+=du,a="left"):o==="top"?(s-=du,l="bottom"):o==="bottom"&&(s+=du,l="top")}return{x:r,y:s,align:a,textBaseline:l}}_computeOuterLabelLimit(t){var e,i,r,s,o,a,l;if(this._isHorizontal())return this._getMainAxisLength(this.isTransformLevel(t));const h=this.getPoints(t),d=(Math.abs(h[0].x-h[1].x)+Math.abs(h[2].x-h[3].x))/2,u=this.getCategoryField(),c=(o=(s=(r=(i=(e=this._labelMark)===null||e===void 0?void 0:e.getComponent())===null||i===void 0?void 0:i.getProduct())===null||r===void 0?void 0:r.getGroupGraphicItem())===null||s===void 0?void 0:s.find(({attribute:m,type:v})=>{var _;return v==="text"&&((_=m.data)===null||_===void 0?void 0:_[u])===t[u]},!0))===null||o===void 0?void 0:o.AABBBounds,g=c?c.x2-c.x1:0,p=this._funnelOuterLabelMark.line?this._minLabelLineWidth:0;let f=this.getLayoutRect().width-Math.max(d,g);return this._funnelAlign==="center"&&(f/=2),f-p-((l=(a=this._spec.outerLabel)===null||a===void 0?void 0:a.spaceWidth)!==null&&l!==void 0?l:du)}_computeOuterLabelLinePosition(t){var e,i,r,s,o,a,l,h,d,u,c,g,p;const f=this.getCategoryField(),m=(o=(s=(r=(i=(e=this._funnelOuterLabelMark)===null||e===void 0?void 0:e.label)===null||i===void 0?void 0:i.getProduct())===null||r===void 0?void 0:r.elements)===null||s===void 0?void 0:s.find(T=>{var R;return((R=T.data[0])===null||R===void 0?void 0:R[f])===t[f]}))===null||o===void 0?void 0:o.getBounds(),v=(u=(d=(h=(l=(a=this._labelMark)===null||a===void 0?void 0:a.getComponent())===null||l===void 0?void 0:l.getProduct())===null||h===void 0?void 0:h.getGroupGraphicItem())===null||d===void 0?void 0:d.find(({attribute:T,type:R})=>{var B;return R==="text"&&((B=T.data)===null||B===void 0?void 0:B[f])===t[f]},!0))===null||u===void 0?void 0:u.AABBBounds,_=(c=this._spec.outerLabel)!==null&&c!==void 0?c:{};let b,y,C,S;if(this._isHorizontal()){const T=(g=_.spaceWidth)!==null&&g!==void 0?g:du,R=this.getPoints(t),B=(Math.abs(R[0].y-R[1].y)+Math.abs(R[2].y-R[3].y))/2;return this._spec.outerLabel.position==="top"||this._funnelAlign==="bottom"?(C=this._getPolygonCenter(R).y-B/2-T,S=_.alignLabel!==!1?(m==null?void 0:m.y2)+T:C-T,b=this._getPolygonCenter(R).x,C-S<this._minLabelLineWidth&&(S=C-this._minLabelLineWidth),y=b):(C=this._getPolygonCenter(R).y+B/2+T,S=_.alignLabel!==!1?(m==null?void 0:m.y1)-T:C+T,b=this._getPolygonCenter(R).x,S-C<this._minLabelLineWidth&&(S=C+this._minLabelLineWidth),y=b),{x1:b,x2:y,y1:C,y2:S}}const w=this.getPoints(t),x=(Math.abs(w[0].x-w[1].x)+Math.abs(w[2].x-w[3].x))/2,A=(v==null?void 0:v.x2)-(v==null?void 0:v.x1)||0,M=(p=_.spaceWidth)!==null&&p!==void 0?p:du;return this._spec.outerLabel.position==="right"||this._funnelAlign==="left"?(b=this._getPolygonCenter(w).x+Math.max(A/2,x/2)+M,y=_.alignLabel!==!1?(m==null?void 0:m.x1)-M:b+M,C=this._getPolygonCenter(w).y,y-b<this._minLabelLineWidth&&(y=b+this._minLabelLineWidth),S=C):(b=this._getPolygonCenter(w).x-Math.max(A/2,x/2)-M,y=_.alignLabel!==!1?(m==null?void 0:m.x2)+M:b-M,C=this._getPolygonCenter(w).y,b-y<this._minLabelLineWidth&&(y=b-this._minLabelLineWidth),S=C),{x1:b,x2:y,y1:C,y2:S}}_computeMaxSize(){var t;const e=this._isHorizontal()?this.getLayoutRect().height:this.getLayoutRect().width,i=(t=this._spec.maxSize)!==null&&t!==void 0?t:Q8t;return Gi(i,e)}_computeMinSize(){var t;const e=this._isHorizontal()?this.getLayoutRect().height:this.getLayoutRect().width,i=(t=this._spec.minSize)!==null&&t!==void 0?t:t7t;return Gi(i,e)}_isHorizontal(){return this._funnelOrient==="left"||this._funnelOrient==="right"}_isReverse(){return this._funnelOrient==="bottom"||this._funnelOrient==="right"}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._funnelMark]}}Qo.type=gt.funnel,Qo.mark=i7t,Qo.transformerConstructor=pH;const r7t=()=>{hrt(),_s(),Xf(),q.registerSeries(Qo.type,Qo),q.registerAnimation("funnel",(n,t)=>Object.assign({appear:t==="clipIn"?void 0:{type:"fadeIn"}},DT)),FGt(),mh()};class z0 extends lrt{constructor(){super(...arguments),this.type=z0.type}}z0.type="pyramid3d";const drt=()=>{q.registerMark(z0.type,z0),J5t(),rnt()};class urt extends pH{_transformLabelSpec(t){this._addMarkLabelSpec(t,"funnel3d"),t.isTransform&&this._addMarkLabelSpec(t,"transform3d","transformLabel")}}class Na extends Qo{constructor(){super(...arguments),this.type=gt.funnel3d,this._funnelMarkName="funnel3d",this._funnelMarkType="pyramid3d",this._transformMarkName="transform3d",this._transformMarkType="pyramid3d",this.transformerConstructor=urt}initMark(){var t,e,i,r,s,o,a,l;if(this._funnelMark=this._createMark(Object.assign(Object.assign({},Na.mark.funnel3d),{name:this._funnelMarkName,type:this._funnelMarkType}),{themeSpec:(t=this._theme)===null||t===void 0?void 0:t.funnel3d,key:this._seriesField,isSeriesMark:!0},{support3d:!0}),this._spec.isTransform&&(this._funnelTransformMark=this._createMark(Object.assign(Object.assign({},Na.mark.transform3d),{name:this._transformMarkName,type:this._transformMarkType}),{themeSpec:(e=this._theme)===null||e===void 0?void 0:e.transform3d,key:this._seriesField,skipBeforeLayouted:!1,dataView:this._viewDataTransform.getDataView(),dataProductId:this._viewDataTransform.getProductId()})),(r=(i=this._spec)===null||i===void 0?void 0:i.outerLabel)===null||r===void 0?void 0:r.visible){const{line:h}=(s=this._spec.outerLabel)!==null&&s!==void 0?s:{},{line:d}=(a=(o=this._theme)===null||o===void 0?void 0:o.outerLabel)!==null&&a!==void 0?a:{};this._funnelOuterLabelMark.label=this._createMark(Na.mark.outerLabel,{themeSpec:(l=this._theme)===null||l===void 0?void 0:l.outerLabel,key:this._seriesField,markSpec:this._spec.outerLabel}),this._funnelOuterLabelMark.line=this._createMark(Na.mark.outerLabelLine,{themeSpec:d,key:this._seriesField,markSpec:h,depend:[this._funnelOuterLabelMark.label]})}}initMarkStyle(){super.initMarkStyle();const t=this._funnelMark;t&&this.setMarkStyle(t,{z:e=>{if(this._isHorizontal())return 0;const i=this.getPoints(e),r=Math.max(Math.abs(i[0].x-i[1].x),Math.abs(i[2].x-i[3].x));return(this._computeMaxSize()-r)/2}},"normal",wt.Series)}initLabelMarkStyle(t){var e,i;super.initLabelMarkStyle(t),this.setMarkStyle(t,{z:r=>{if(this._isHorizontal())return 0;const s=this.getPoints(r),o=Math.max(Math.abs(s[0].x-s[1].x),Math.abs(s[2].x-s[3].x));return(this._computeMaxSize()-o)/2}},"normal",wt.Series),this._labelMark=t,!((e=this._funnelOuterLabelMark)===null||e===void 0)&&e.label&&this._funnelOuterLabelMark.label.setDepend(t.getComponent()),!((i=this._funnelOuterLabelMark)===null||i===void 0)&&i.line&&this._funnelOuterLabelMark.line.setDepend(...this._funnelOuterLabelMark.line.getDepend())}}Na.type=gt.funnel3d,Na.mark=n7t,Na.transformerConstructor=urt;const s7t=()=>{drt(),_s(),Xf(),q.registerSeries(Na.type,Na)},uA=(n,t)=>{const e=(n-t[0])/(t[1]-t[0]||1);return Math.max(0,Math.min(1,e))},cA=n=>{const t=n.mark.elements.filter(i=>i.diffState===Ke.update),e=Ri(t.map(i=>{var r;return(r=i==null?void 0:i.data)===null||r===void 0?void 0:r[0].depth}));return t.filter(i=>{var r;return((r=i==null?void 0:i.data)===null||r===void 0?void 0:r[0].depth)===e})},m7=(n,t,e)=>xt(n)?[t,e]:[Ri(n.map(i=>1*i.getGraphicAttribute("startAngle",!1))),Mi(n.map(i=>1*i.getGraphicAttribute("endAngle",!1)))],o7t=n=>({channel:{startAngle:{from:(t,e)=>{const{startAngle:i,endAngle:r}=n.animationInfo(),s=cA(e),o=m7(s,i,r);return uA(t.startAngle,o)*(r-i)+i},to:t=>t.startAngle},endAngle:{from:(t,e)=>{const{startAngle:i,endAngle:r}=n.animationInfo(),s=cA(e),o=m7(s,i,r);return uA(t.endAngle,o)*(r-i)+i},to:t=>t.endAngle},outerRadius:{from:t=>t.innerRadius,to:t=>t.outerRadius},innerRadius:{from:t=>t.innerRadius,to:t=>t.innerRadius}}}),v7=n=>[Ri(n.map(t=>1*t.getGraphicAttribute("startAngle",!1))),Mi(n.map(t=>1*t.getGraphicAttribute("endAngle",!1)))],_7=n=>({channel:{startAngle:{from:(t,e)=>e.getGraphicAttribute("startAngle",!1),to:(t,e)=>{const{startAngle:i,endAngle:r}=n.animationInfo(),s=cA(e),o=v7(s);return uA(e.getGraphicAttribute("startAngle",!1),o)*(r-i)+i}},endAngle:{from:(t,e)=>e.getGraphicAttribute("endAngle",!1),to:(t,e)=>{const{startAngle:i,endAngle:r}=n.animationInfo(),s=cA(e),o=v7(s);return uA(e.getGraphicAttribute("endAngle",!1),o)*(r-i)+i}},outerRadius:{from:(t,e)=>e.getGraphicAttribute("outerRadius",!1),to:()=>n.animationInfo().innerRadius},innerRadius:{from:(t,e)=>e.getGraphicAttribute("innerRadius",!1),to:()=>n.animationInfo().innerRadius}}}),a7t=(n,t)=>{switch(t){case"fadeIn":return{type:"fadeIn"};case"growAngle":return{type:"growAngleIn"};default:return{type:"growRadiusIn"}}},l7t=()=>{q.registerAnimation("sunburst",(n,t)=>({appear:a7t(n,t),enter:o7t(n),exit:_7(n),disappear:_7(n)}))},fH=(n,t=[],e)=>{const i=(e==null?void 0:e.maxDepth)>=0;return n.forEach(r=>{(!i||r.depth<=e.maxDepth)&&(t.push(e!=null&&e.callback?e.callback(r):r),r.children&&(i&&r.depth===e.maxDepth?(r.children=null,r.isLeaf=!0):fH(r.children,t,e)))}),t};function h7t(n,t,e,i,r){const s=n.children,o=s.length;let a=0;const l=new Array(o+1);l[0]=0;for(let d=0;d<o;++d)a+=s[d].value,l[d+1]=a;const h=(d,u,c,g,p,f,m)=>{if(d>=u-1){const w=s[d];return w.x0=g,w.y0=p,w.x1=f,void(w.y1=m)}const v=l[d],_=c/2+v;let b=d+1,y=u-1;for(;b<y;){const w=b+y>>>1;l[w]<_?b=w+1:y=w}_-l[b-1]<l[b]-_&&d+1<b&&--b;const C=l[b]-v,S=c-C;if(f-g>m-p){const w=c?(g*S+f*C)/c:f;h(d,b,C,g,p,w,m),h(b,u,S,w,p,f,m)}else{const w=c?(p*S+m*C)/c:m;h(d,b,C,g,p,f,w),h(b,u,S,g,w,f,m)}};h(0,o,n.value,t,e,i,r)}function YT(n,t,e,i,r,s={x0:"x0",x1:"x1",y0:"y0",y1:"y1"}){const o=n.children;let a,l=-1;const h=o.length,d=n.value&&(i-t)/n.value;for(;++l<h;)a=o[l],a[s.y0]=e,a[s.y1]=r,a[s.x0]=t,a[s.x1]=t+=a.value*d}function mH(n,t,e,i,r){const s=n.children;let o,a=-1;const l=s.length,h=n.value&&(r-e)/n.value;for(;++a<l;)o=s[a],o.x0=t,o.x1=i,o.y0=e,e+=o.value*h,o.y1=e}function d7t(n,t,e,i,r){(n.depth%2==1?mH:YT)(n,t,e,i,r)}function u7t(n,t,e,i,r,s){const o=[],a=t.children;let l,h,d=0,u=0;const c=a.length;let g,p,f,m,v,_,b,y,C,S=t.value;for(;d<c;){g=r-e,p=s-i;do f=a[u++].value;while(!f&&u<c);for(m=f,v=f,y=Math.max(p/g,g/p)/(S*n),C=f*f*y,b=Math.max(v/C,C/m);u<c;++u){if(h=a[u].value,f+=h,h<m&&(m=h),h>v&&(v=h),C=f*f*y,_=Math.max(v/C,C/m),_>b){f-=h;break}b=_}l=Object.assign({},t,{value:f,children:a.slice(d,u)}),o.push(l),g<p?YT(l,e,i,r,S?i+=p*f/S:s):mH(l,e,i,S?e+=g*f/S:r,s),S-=f,d=u}return o}const c7t=n=>(t,e,i,r,s)=>{u7t(n,t,e,i,r,s)},XT=(n,t,e=0,i=-1,r,s,o="value")=>{let a=0,l=i??-1,h=e;return n.forEach((d,u)=>{var c,g;const p={flattenIndex:++l,key:s?s(d):`${(c=r==null?void 0:r.key)!==null&&c!==void 0?c:""}-${u}`,maxDepth:-1,depth:e,index:u,value:d[o],isLeaf:!0,datum:r?r.datum.concat(d):[d],parentKey:r==null?void 0:r.key};if(!((g=d.children)===null||g===void 0)&&g.length){p.children=[],p.isLeaf=!1;const f=XT(d.children,p.children,e+1,l,p,s,o);p.value=D(d[o])?f.sum:Math.max(f.sum,wu(d[o])),l=f.flattenIndex,h=Math.max(f.maxDepth,h)}else p.isLeaf=!0,p.value=wu(d[o]);a+=Math.abs(p.value),t.push(p)}),{sum:a,maxDepth:h,flattenIndex:l}},Lg=(n,t,e,i)=>{let r=i;return n.forEach((s,o)=>{var a;r=t(s,o,e,r),!((a=s.children)===null||a===void 0)&&a.length&&(r=Lg(s.children,t,s,r))}),i},jC=(n,t,e,i)=>{let r=i;return n.forEach((s,o)=>{var a;!((a=s.children)===null||a===void 0)&&a.length&&(r=jC(s.children,t,s,r)),r=t(s,o,e,r)}),r},b7={binary:h7t,dice:YT,slice:mH,sliceDice:d7t};class KT{constructor(t){var e;this._filterByArea=(s,o)=>{var a;const l=this._getMinAreaByDepth(s.depth);if(l>0&&s.value*o<l)return!1;if(!((a=s.children)===null||a===void 0)&&a.length){const h=s.children.filter(d=>this._filterByArea(d,o));h.length?h.length!==s.children.length&&(s.children=h):(s.isLeaf=!0,s.children=null)}return!0},this._getMinAreaByDepth=s=>{var o;return s<0?0:(o=V(this.options.minVisibleArea)?this.options.minVisibleArea[s]:this.options.minVisibleArea)!==null&&o!==void 0?o:0},this._getGapWidthByDepth=s=>{var o;return s<0?0:(o=V(this.options.gapWidth)?this.options.gapWidth[s]:this.options.gapWidth)!==null&&o!==void 0?o:0},this._getPaddingByDepth=s=>{var o;return s<0?0:(o=V(this.options.padding)?this.options.padding[s]:this.options.padding)!==null&&o!==void 0?o:0},this._getLabelPaddingByDepth=s=>{var o;return s<0?0:(o=V(this.options.labelPadding)?this.options.labelPadding[s]:this.options.labelPadding)!==null&&o!==void 0?o:0},this._layoutNode=s=>{const o=this._getGapWidthByDepth(s.depth);let a=s.x0,l=s.y0,h=s.x1,d=s.y1;if(s.maxDepth=this._maxDepth,o>0&&(a+=o/2,h-=o/2,l+=o/2,d-=o/2,a>h&&(a=(a+h)/2,h=a),l>d&&(l=(l+d)/2,d=l),s.x0=a,s.x1=h,s.y0=l,s.y1=d),s.children){const u=this._getLabelPaddingByDepth(s.depth),c=this._getPaddingByDepth(s.depth);c>0&&c<Math.min(h-a,d-l)/2&&(l+=c,d-=c,a+=c,h-=c),u>0&&(this.options.labelPosition==="top"&&l+u<d?(s.labelRect={x0:a,y0:l,x1:h,y1:l+u},l+=u):this.options.labelPosition==="bottom"&&d-u>l?(s.labelRect={x0:a,y0:d-u,x1:h,y1:d},d-=u):this.options.labelPosition==="left"&&a+u<h?(s.labelRect={x0:a,y0:l,x1:a+u,y1:d},a+=u):this.options.labelPosition==="right"&&h-u>a&&(s.labelRect={x0:h-u,y0:l,x1:h,y1:d},h-=u));const g=this._getGapWidthByDepth(s.depth+1);g>0&&(a-=g/2,h+=g/2,l-=g/2,d+=g/2),this._splitNode(s,a,l,h,d)}},this.options=Object.assign({},KT.defaultOpionts,t);const i=this.options.nodeKey,r=it(i)?i:i?Za(i):null;this._getNodeKey=r,this._splitNode=this.options.splitType==="squarify"?c7t(this.options.aspectRatio):(e=b7[this.options.splitType])!==null&&e!==void 0?e:b7.binary,this._maxDepth=-1}layout(t,e){var i;if(!t||!t.length)return[];const r="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)},s=[],o=XT(t,s,0,-1,null,this._getNodeKey,this.options.valueField);if(this._maxDepth=o.maxDepth,o.sum<=0)return[];const a={flattenIndex:-1,maxDepth:-1,key:"-1",depth:-1,index:-1,value:o.sum,datum:null,x0:r.x0,x1:r.x1,y0:r.y0,y1:r.y1,children:s},l=r.width*r.height/o.sum;return this._filterByArea(a,l),this._layout(a),(i=a.children)!==null&&i!==void 0?i:[]}_filterChildren(t){const e=this.options.maxDepth;if(J(e)&&e>=0&&t.depth>=e)return!1;const i=this.options.minChildrenVisibleArea;if(J(i)&&Math.abs((t.x1-t.x0)*(t.y1-t.y0))<i)return!1;const r=this.options.minChildrenVisibleSize;return!J(r)||!(Math.abs(t.x1-t.x0)<r||Math.abs(t.y1-t.y0)<r)}_layout(t){var e;this._filterChildren(t)||(t.children=null,t.isLeaf=!0),this._layoutNode(t),!((e=t.children)===null||e===void 0)&&e.length&&t.children.forEach(i=>{var r;!((r=i==null?void 0:i.children)===null||r===void 0)&&r.length?this._layout(i):this._layoutNode(i)})}}KT.defaultOpionts={aspectRatio:(1+Math.sqrt(5))/2,gapWidth:0,labelPadding:0,labelPosition:"top",splitType:"binary",minVisibleArea:10};const g7t=(n,t)=>{const e=new KT(n).layout(t,"width"in n?{width:n.width,height:n.height}:{x0:n.x0,x1:n.x1,y0:n.y0,y1:n.y1});if(n.flatten){const i=[];return fH(e,i,{maxDepth:n==null?void 0:n.maxDepth}),i}return e},p7t={x0:"startAngle",x1:"endAngle",y0:"innerRadius",y1:"outerRadius"};class W0{constructor(t){this._layoutNode=r=>{if(r.maxDepth=this._maxDepth,r.children){const s=this._parsedInnerRadius[r.depth+1],o=this._parsedOutterRadius[r.depth+1];YT(r,r.startAngle,Math.min(s,o),r.endAngle,Math.max(s,o),p7t);const a=V(this.options.label)?this.options.label[r.depth+1]:this.options.label;r.children.forEach(l=>{if(l.x=this._parsedCenter[0],l.y=this._parsedCenter[1],a)return this._layoutLabel(l,Re(a)?{align:"center",rotate:"radial"}:a)})}},this.options=t?Object.assign({},W0.defaultOpionts,t):Object.assign({},W0.defaultOpionts);const e=this.options.nodeKey,i=it(e)?e:e?Za(e):null;this._getNodeKey=i,this._maxDepth=-1}_parseRadius(t,e){const i=t.x0+Wo(this.options.center[0],t.width),r=t.y0+Wo(this.options.center[1],t.height),s=Math.min(t.width/2,t.height/2),o=this.options.innerRadius,a=this.options.outerRadius,l=V(o),h=l?o.map(p=>Wo(p,s)):Wo(o,s),d=V(a),u=this.options.gapRadius,c=d?a.map(p=>Wo(p,s)):Wo(a,s),g=bO(0,e+1);if(l)this._parsedInnerRadius=g.map((p,f)=>{const m=h[f];return D(m)?s:m}),this._parsedOutterRadius=g.map((p,f)=>{var m,v;return d?(m=c[f])!==null&&m!==void 0?m:s:f<e?this._parsedInnerRadius[f+1]-(V(u)?(v=u[f])!==null&&v!==void 0?v:0:u):c});else if(d)this._parsedOutterRadius=g.map((p,f)=>D(c[f])?s:c[f]),this._parsedInnerRadius=g.map((p,f)=>{var m;return f===0?h:this._parsedOutterRadius[f-1]-(V(u)?(m=u[f])!==null&&m!==void 0?m:0:u)});else{const p=Wo(o,s),f=(c-p)/(e+1);this._parsedInnerRadius=g.map((m,v)=>p+v*f),this._parsedOutterRadius=g.map((m,v)=>{var _;return this._parsedInnerRadius[v]+f-(V(u)?(_=u[v])!==null&&_!==void 0?_:0:u)})}this._parsedCenter=[i,r],this._maxRadius=s}layout(t,e){const i="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};if(!t||!t.length)return[];const r=[],s=XT(t,r,0,-1,null,this._getNodeKey);return this._parseRadius(i,s.maxDepth),this._maxDepth=s.maxDepth,this._layout(r,{flattenIndex:-1,maxDepth:-1,key:"-1",depth:-1,index:-1,value:s.sum,datum:null,children:r,startAngle:this.options.startAngle,endAngle:this.options.endAngle}),r}_layout(t,e){this._layoutNode(e),t.forEach(i=>{var r;!((r=i==null?void 0:i.children)===null||r===void 0)&&r.length?this._layout(i.children,i):this._layoutNode(i)})}_layoutLabel(t,e){var i;const r=(t.startAngle+t.endAngle)/2,s=(e.align==="start"?t.innerRadius:e.align==="end"?t.outerRadius:(t.innerRadius+t.outerRadius)/2)+((i=e.offset)!==null&&i!==void 0?i:0),o=ui({x:this._parsedCenter[0],y:this._parsedCenter[1]},s,r);if(t.label={x:o.x,y:o.y,textBaseline:"middle"},e.rotate==="tangential")t.label.angle=r-Math.PI/2,t.label.textAlign="center",t.label.maxLineWidth=Math.abs(t.endAngle-t.startAngle)*s;else{const a=r%(2*Math.PI),l=a<0?a+2*Math.PI:a;l>Math.PI/2&&l<1.5*Math.PI?(t.label.angle=l+Math.PI,t.label.textAlign=e.align==="start"?"end":e.align==="end"?"start":"center"):(t.label.angle=l,t.label.textAlign=e.align),t.label.maxLineWidth=t.isLeaf?void 0:Math.abs(t.outerRadius-t.innerRadius)}}}W0.defaultOpionts={startAngle:Math.PI/2,endAngle:-3*Math.PI/2,center:["50%","50%"],gapRadius:0,innerRadius:0,outerRadius:"70%"};const f7t=1664525,m7t=1013904223,y7=4294967296;function v7t(n=1){let t=n;return()=>(t=(f7t*t+m7t)%y7)/y7}function _7t(n,t){let e=0;const i=yY(Array.from(n),t),r=i.length;let s,o,a=[];for(;e<r;)s=i[e],o&&crt(o,s)?++e:(a=b7t(a,s),o=y7t(a),e=0);return o}function b7t(n,t){let e,i;if(rP(t,n))return[t];for(e=0;e<n.length;++e)if(oC(t,n[e])&&rP(iv(n[e],t),n))return[n[e],t];for(e=0;e<n.length-1;++e)for(i=e+1;i<n.length;++i)if(oC(iv(n[e],n[i]),t)&&oC(iv(n[e],t),n[i])&&oC(iv(n[i],t),n[e])&&rP(grt(n[e],n[i],t),n))return[n[e],n[i],t];ge.getInstance().error("error when packEncloseRandom")}function oC(n,t){const e=n.radius-t.radius,i=t.x-n.x,r=t.y-n.y;return e<0||e*e<i*i+r*r}function crt(n,t){const e=n.radius-t.radius+1e-9*Math.max(n.radius,t.radius,1),i=t.x-n.x,r=t.y-n.y;return e>0&&e*e>i*i+r*r}function rP(n,t){for(let e=0;e<t.length;++e)if(!crt(n,t[e]))return!1;return!0}function y7t(n){switch(n.length){case 1:return C7t(n[0]);case 2:return iv(n[0],n[1]);case 3:return grt(n[0],n[1],n[2])}}function C7t(n){return{x:n.x,y:n.y,radius:n.radius}}function iv(n,t){const e=n.x,i=n.y,r=n.radius,s=t.x,o=t.y,a=t.radius,l=s-e,h=o-i,d=a-r,u=Math.sqrt(l*l+h*h);return{x:(e+s+l/u*d)/2,y:(i+o+h/u*d)/2,radius:(u+r+a)/2}}function grt(n,t,e){const i=n.x,r=n.y,s=n.radius,o=t.x,a=t.y,l=t.radius,h=e.x,d=e.y,u=e.radius,c=i-o,g=i-h,p=r-a,f=r-d,m=l-s,v=u-s,_=i*i+r*r-s*s,b=_-o*o-a*a+l*l,y=_-h*h-d*d+u*u,C=g*p-c*f,S=(p*y-f*b)/(2*C)-i,w=(f*m-p*v)/C,x=(g*b-c*y)/(2*C)-r,A=(c*v-g*m)/C,M=w*w+A*A-1,T=2*(s+S*w+x*A),R=S*S+x*x-s*s,B=-(Math.abs(M)>1e-6?(T+Math.sqrt(T*T-4*M*R))/(2*M):R/T);return{x:i+S+w*B,y:r+x+A*B,radius:B}}function C7(n,t,e){const i=n.x-t.x;let r,s;const o=n.y-t.y;let a,l;const h=i*i+o*o;h?(s=t.radius+e.radius,s*=s,l=n.radius+e.radius,l*=l,s>l?(r=(h+l-s)/(2*h),a=Math.sqrt(Math.max(0,l/h-r*r)),e.x=n.x-r*i-a*o,e.y=n.y-r*o+a*i):(r=(h+s-l)/(2*h),a=Math.sqrt(Math.max(0,s/h-r*r)),e.x=t.x+r*i-a*o,e.y=t.y+r*o+a*i)):(e.x=t.x+e.radius,e.y=t.y)}function S7(n,t){const e=n.radius+t.radius-1e-6,i=t.x-n.x,r=t.y-n.y;return e>0&&e*e>i*i+r*r}function x7(n){const t=n._,e=n.next._,i=t.radius+e.radius,r=(t.x*e.radius+e.x*t.radius)/i,s=(t.y*e.radius+e.y*t.radius)/i;return r*r+s*s}function aC(n){return{_:n,next:null,prev:null}}function S7t(n,t){const e=(n=Q(n)).length;if(!e)return 0;let i=n[0];if(i.x=0,i.y=0,e===1)return i.radius;const r=n[1];if(i.x=-r.radius,r.x=i.radius,r.y=0,e===2)return i.radius+r.radius;let s=n[2];C7(r,i,s);let o,a,l,h,d,u,c,g=aC(i),p=aC(r),f=aC(s);g.next=p,f.prev=p,p.next=f,g.prev=f,f.next=g,p.prev=g;for(let v=3;v<e;++v){c=!1,s=n[v],C7(g._,p._,s),f=aC(s),o=p.next,a=g.prev,l=p._.radius,h=g._.radius;do if(l<=h){if(S7(o._,f._)){p=o,g.next=p,p.prev=g,--v,c=!0;break}l+=o._.radius,o=o.next}else{if(S7(a._,f._)){g=a,g.next=p,p.prev=g,--v,c=!0;break}h+=a._.radius,a=a.prev}while(o!==a.next);if(!c){for(f.prev=g,f.next=p,g.next=p.prev=p=f,d=x7(g),f=f.next;f!==p;)u=x7(f),u<d&&(g=f,d=u),f=f.next;p=g.next}}const m=[p._];for(f=p.next;f!==p;)m.push(f._),f=f.next;s=_7t(m,t);for(let v=0;v<e;++v)i=n[v],i.x-=s.x,i.y-=s.y;return s.radius}function w7(n){return function(t){t.children||(t.radius=Math.max(0,+n(t)||0))}}function sP(n,t,e){return function(i){const r=i==null?void 0:i.children;if(r){let s;const o=r.length,a=n(i)*t||0;if(a)for(s=0;s<o;++s)r[s].radius+=a;const l=S7t(r,e);if(a)for(s=0;s<o;++s)r[s].radius-=a;i.radius=l+a}}}function A7(n,t){return function(e,i,r){e.radius*=n,e.maxDepth=t,r&&(e.x=r.x+n*e.x,e.y=r.y+n*e.y)}}class j0{constructor(t){this.options=t;const e=t==null?void 0:t.nodeKey,i=it(e)?e:e?Za(e):null;this._getNodeKey=i,this._getPadding=J(t==null?void 0:t.padding)?r=>t.padding:V(t==null?void 0:t.padding)?r=>{var s;return(s=t.padding[r.depth+1])!==null&&s!==void 0?s:0}:()=>0,this._maxDepth=-1}layout(t,e){var i;const r="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};if(!t||!t.length)return[];const s=[],o=XT(t,s,0,-1,null,this._getNodeKey);this._maxDepth=o.maxDepth;const a=v7t(),l={flattenIndex:-1,maxDepth:-1,key:"root",depth:-1,index:-1,value:o.sum,datum:null,children:s,x:r.x0+r.width/2,y:r.y0+r.height/2},{nodeSort:h,setRadius:d,padding:u,includeRoot:c}=(i=this.options)!==null&&i!==void 0?i:{};if(h!==!1){const g=it(h)?this.options.nodeKey:j0.defaultOpionts.nodeSort;Lg([l],p=>{p.children&&p.children.length&&p.children.sort(g)})}if(d)Lg([l],w7(d)),jC([l],sP(this._getPadding,.5,a)),Lg([l],A7(1,this._maxDepth));else{const g=Math.min(r.width,r.height);Lg([l],w7(j0.defaultOpionts.setRadius)),jC([l],sP(cIt,1,a)),u&&jC([l],sP(this._getPadding,l.radius/g,a)),Lg([l],A7(g/(2*l.radius),this._maxDepth))}return c?[l]:s}}j0.defaultOpionts={setRadius:n=>Math.sqrt(n.value),padding:0,nodeSort:(n,t)=>t.value-n.value};const x7t=()=>{dt.registerTransform("treemap",{transform:g7t,markPhase:"beforeJoin"},!0)},Ob=(n,t={})=>{if(!n)return[];const e=[];return fH(n,e,t),e},w7t=(n,t)=>{if(!n)return n;const e=t(),{width:i,height:r}=e;return new W0(e).layout(n,{width:i,height:r})},A7t=10;class M7t extends wr{constructor(){super(...arguments),this.markTooltipKeyCallback=t=>t==null?void 0:t[this.series.getDimensionField()[0]]}}var od;(function(n){n.DrillDown="drillDown",n.DrillUp="drillUp"})(od||(od={}));const T7t=(n,t)=>{const e=t.info(),i=t.keyField(),r=e==null?void 0:e.key;if(D(r))return n;if(e.type===od.DrillDown){const s=Get(n,r,i,"children");return Q(s)}if(e.type===od.DrillUp){const s=Uet(n,r,i,"children");if(s)return Q(s)}return n};class vH{_getDrillTriggerEvent(t){var e;const{mode:i}=this._drillParams;return(e=Tl(i))===null||e===void 0?void 0:e[t]}_hideTooltip(){const t=this.getChart().getComponentsByType(vt.tooltip)[0];t&&t.hideTooltip()}initDrillable(t){this._drillParams=t}initDrillableData(t){const{getRawData:e}=this._drillParams;Vt(t,"drillFilter",T7t),e().transform({type:"drillFilter",options:{info:()=>this._drillInfo,keyField:()=>this._drillParams.drillField()}})}bindDrillEvent(){const{event:t,getRawData:e,drillField:i}=this._drillParams,r=i();this._getDrillTriggerEvent("start")&&t.on(this._getDrillTriggerEvent("start"),s=>{var o,a,l;if(D(s.datum)||D((o=s.datum)===null||o===void 0?void 0:o[r]))return void this.drillUp();this._hideTooltip();const h=s.datum[r],d=(l=(a=this._drillInfo)===null||a===void 0?void 0:a.path)!==null&&l!==void 0?l:[],u=ajt(e().rawData,h,r,"children");d[d.length-1]===u[u.length-1]?this.drillUp():this.drillDown(u)})}drillDown(t=[]){const{getRawData:e,event:i}=this._drillParams;if(!V(t)||xt(t))return t;const r=t[t.length-1];return this._drillInfo={key:r,path:t,type:od.DrillDown},e().reRunAllTransform(),i.emit(Ot.drill,{value:{path:t,type:od.DrillDown},model:this}),t}drillUp(){var t,e;const{getRawData:i,event:r}=this._drillParams,s=(e=(t=this._drillInfo)===null||t===void 0?void 0:t.path)!==null&&e!==void 0?e:[];if(!V(s)||xt(s))return s;const o=s.pop();return this._drillInfo={key:o,path:s,type:od.DrillUp},i().reRunAllTransform(),r.emit(Ot.drill,{value:{path:s,type:od.DrillUp},model:this}),s}}const k7t=Object.assign(Object.assign({},Hi),{sunburst:{name:"sunburst",type:"arc"}}),_H=(n,t,e)=>(n.push({key:t,operations:["values"]}),n.push({key:e,operations:["max","min"]}),n.push({key:zI,operations:["max","min","values"]}),n.push({key:Fc,operations:["values"]}),n);class Cd extends Lb{constructor(){super(...arguments),this.type=gt.sunburst}setCategoryField(t){return this._categoryField=t,this._categoryField}getCategoryField(){return this._categoryField}setValueField(t){return this._valueField=t,this._valueField}getValueField(){return this._valueField}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:Fc),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var e;return(e=this._spec.drillField)!==null&&e!==void 0?e:sa},getRawData:()=>this.getRawData()}),this._startAngle=Te(this._spec.startAngle),this._endAngle=Te(this._spec.endAngle),this._centerX=this._spec.centerX,this._centerY=this._spec.centerY,this._offsetX=this._spec.offsetX,this._offsetY=this._spec.offsetY,this.__innerRadius=this._spec.innerRadius,this.__outerRadius=this._spec.outerRadius,this._gap=this._spec.gap,this._labelLayout=this._spec.labelLayout,this._sunburst=this._spec.sunburst,this._label=this._spec.label,this._labelAutoVisible=this._spec.labelAutoVisible}initData(){super.initData();const t=this.getRawData();t&&(this._spec.drill&&this.initDrillableData(this._dataSet),Vt(this._dataSet,"sunburstLayout",w7t),Vt(this._dataSet,"flatten",Ob),t.transform({type:"sunburstLayout",options:()=>{const{innerRadius:e,outerRadius:i,gap:r,label:s}=this._computeLevel();return{nodeKey:this._categoryField,width:this.getLayoutRect().width,height:this.getLayoutRect().height,center:[L(this._centerX)?this._centerX:this.getLayoutRect().width/2,L(this._centerY)?this._centerY:this.getLayoutRect().height/2],startAngle:this._startAngle,endAngle:this._endAngle,innerRadius:e,outerRadius:i,gapRadius:r,label:s}}}),t.transform({type:"flatten",options:{callback:e=>{if(e.datum){const i=e.datum[e.depth];return Object.assign(Object.assign({},e),i)}return e}}}))}getStatisticFields(){return _H(super.getStatisticFields(),this._categoryField,this._valueField)}_addDataIndexAndKey(){const t=this.getRawData();D(t==null?void 0:t.dataSet)||(Vt(t.dataSet,"addVChartProperty",Yf),t.transform({type:"addVChartProperty",options:{beforeCall:JF.bind(this),call:OT}}))}initMark(){this._initArcMark(),this._initLabelMark()}initMarkStyle(){this._initArcMarkStyle(),this._initLabelMarkStyle()}_initArcMark(){var t,e;if(this._sunburst.visible===!1)return;const i=this._createMark(Cd.mark.sunburst,{isSeriesMark:!0,stateSort:(t=this._spec.sunburst)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.sunburst)===null||e===void 0?void 0:e.customShape});this._sunburstMark=i}_initArcMarkStyle(){D(this._sunburstMark)||this.setMarkStyle(this._sunburstMark,{x:t=>t.x+(L(this._offsetX)?this._offsetX:0),y:t=>t.y+(L(this._offsetY)?this._offsetY:0),outerRadius:t=>t.outerRadius,innerRadius:t=>t.innerRadius,startAngle:t=>t.startAngle,endAngle:t=>t.endAngle,fill:this.getColorAttribute()},Rt.STATE_NORMAL,wt.Series)}_initLabelMark(){if(this._label.visible!==!0)return;const t=this._createMark(Cd.mark.label,{isSeriesMark:!1});this._labelMark=t}_initLabelMarkStyle(){D(this._labelMark)||this.setMarkStyle(this._labelMark,{visible:t=>{var e;const i=this._labelAutoVisible;return kt(i)&&i.enable===!0?(t.endAngle-t.startAngle)*(t.outerRadius-t.innerRadius)>((e=i==null?void 0:i.circumference)!==null&&e!==void 0?e:A7t):this._spec.label.visible},x:t=>{var e;return((e=t.label)===null||e===void 0?void 0:e.x)+(L(this._offsetX)?this._offsetX:0)},y:t=>{var e;return((e=t.label)===null||e===void 0?void 0:e.y)+(L(this._offsetY)?this._offsetY:0)},textBaseline:t=>{var e;return(e=t.label)===null||e===void 0?void 0:e.textBaseline},textAlign:t=>{var e;return(e=t.label)===null||e===void 0?void 0:e.textAlign},angle:t=>{var e,i;return(i=(e=t.label)===null||e===void 0?void 0:e.angle)!==null&&i!==void 0?i:0},fontSize:10,text:t=>t.name},Rt.STATE_NORMAL,wt.Series)}initTooltip(){this._tooltipHelper=new M7t(this),this._sunburstMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._sunburstMark),this._labelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._labelMark)}initAnimation(){var t,e;const i={animationInfo:()=>({innerRadius:this._computeRadius(Q(this.__innerRadius))[0],outerRadius:this._computeRadius(Q(this.__outerRadius))[0],startAngle:Q(this._startAngle)[0],endAngle:Q(this._endAngle)[0]})},r=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this.getMarksInType("arc").forEach(s=>{var o;s.setAnimationConfig(Ae((o=q.getAnimationInKey("sunburst"))===null||o===void 0?void 0:o(i,r),Fe(s.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("text").forEach(s=>{var o;s.setAnimationConfig(Ae((o=q.getAnimationInKey("fadeInOut"))===null||o===void 0?void 0:o(),Fe(s.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.drill&&this.bindDrillEvent()}onLayoutEnd(t){super.onLayoutEnd(t),this._rawData.reRunAllTransform()}_computeRadius(t){return V(t)?t.map(e=>this._computeLayoutRadius()*e):this._computeLayoutRadius()*t}_computeLevel(){return{innerRadius:this._computeRadius(this.__innerRadius),outerRadius:this._computeRadius(this.__outerRadius),gap:this._gap,label:this._labelLayout}}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}_noAnimationDataKey(t,e){}getActiveMarks(){return[this._sunburstMark]}getMarkData(t){return t!=null&&t.datum?t.datum[t.datum.length-1]:t}}Cd.type=gt.sunburst,Cd.mark=k7t,Ye(Cd,vH);const R7t=()=>{q.registerSeries(Cd.type,Cd),eg(),_s(),mh(),l7t()},B7t=(n,t)=>{if(!n)return n;const e=t(),{width:i,height:r}=e;return i===0||r===0?n:new j0(e).layout(n,{width:i,height:r})};class P7t extends wr{constructor(){super(...arguments),this.markTooltipKeyCallback=t=>t==null?void 0:t[this.series.getDimensionField()[0]]}}const E7t=n=>n==="fadeIn"?{type:"fadeIn"}:{type:"growRadiusIn"},L7t=()=>{q.registerAnimation("circlePacking",(n,t)=>({appear:E7t(t),enter:{type:"growRadiusIn"},exit:{type:"growRadiusOut"},disappear:{type:"growRadiusOut"}}))},I7t=Object.assign(Object.assign({},Hi),{circlePacking:{name:"circlePacking",type:"arc"}});class Sd extends Po{constructor(){super(...arguments),this.type=gt.circlePacking}setCategoryField(t){return this._categoryField=t,this._categoryField}getCategoryField(){return this._categoryField}setValueField(t){return this._valueField=t,this._valueField}getValueField(){return this._valueField}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:Fc),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var e;return(e=this._spec.drillField)!==null&&e!==void 0?e:sa},getRawData:()=>this.getRawData()}),this._circlePacking=this._spec.circlePacking,this._label=this._spec.label,this._layoutPadding=this._spec.layoutPadding}initData(){super.initData();const t=this.getRawData();D(t)||(this._spec.drill&&this.initDrillableData(this._dataSet),Vt(this._dataSet,"circlePackingLayout",B7t),Vt(this._dataSet,"flatten",Ob),t.transform({type:"circlePackingLayout",options:()=>({nodeKey:this._categoryField,padding:this._layoutPadding,includeRoot:!1,width:this.getLayoutRect().width||1,height:this.getLayoutRect().height||1})}),t.transform({type:"flatten",options:{callback:e=>{if(e.datum){const i=e.datum[e.depth];return Object.assign(Object.assign({},e),i)}return e}}}))}_addDataIndexAndKey(){const t=this.getRawData();D(t==null?void 0:t.dataSet)||(Vt(t.dataSet,"addVChartProperty",Yf),t.transform({type:"addVChartProperty",options:{beforeCall:JF.bind(this),call:OT}}))}initMark(){this._initCirclePackingMark(),this._initLabelMark()}initMarkStyle(){this._initCirclePackingMarkStyle(),this._initLabelMarkStyle()}_initCirclePackingMark(){var t,e;if(((t=this._circlePacking)===null||t===void 0?void 0:t.visible)===!1)return;const i=this._createMark(Sd.mark.circlePacking,{isSeriesMark:!0},{setCustomizedShape:(e=this._spec.circlePacking)===null||e===void 0?void 0:e.customShape});this._circlePackingMark=i}_initCirclePackingMarkStyle(){D(this._circlePackingMark)||this.setMarkStyle(this._circlePackingMark,{x:t=>t.x,y:t=>t.y,outerRadius:t=>t.radius,innerRadius:0,startAngle:0,endAngle:2*Math.PI,fill:this.getColorAttribute(),zIndex:t=>t.depth},Rt.STATE_NORMAL,wt.Series)}_initLabelMark(){var t;if(((t=this._label)===null||t===void 0?void 0:t.visible)===!1)return;const e=this._createMark(Sd.mark.label,{isSeriesMark:!1});this._labelMark=e}_initLabelMarkStyle(){D(this._labelMark)||this.setMarkStyle(this._labelMark,{x:t=>t.x,y:t=>t.y,text:t=>t.key,cursor:"pointer"},Rt.STATE_NORMAL,wt.Series)}getStatisticFields(){return _H(super.getStatisticFields(),this._categoryField,this._valueField)}initTooltip(){this._tooltipHelper=new P7t(this),this._circlePackingMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._circlePackingMark),this._labelMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._labelMark)}initAnimation(){var t;const e=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;this.getMarksInType("arc").forEach(i=>{var r;i.setAnimationConfig(Ae((r=q.getAnimationInKey("circlePacking"))===null||r===void 0?void 0:r(void 0,e),Fe(i.name,this._spec,this._markAttributeContext)))}),this.getMarksInType("text").forEach(i=>{var r;i.setAnimationConfig(Ae((r=q.getAnimationInKey("scaleInOut"))===null||r===void 0?void 0:r(),Fe(i.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.drill&&this.bindDrillEvent()}onLayoutEnd(t){super.onLayoutEnd(t),this._rawData.reRunAllTransform()}_noAnimationDataKey(t,e){}getActiveMarks(){return[this._circlePackingMark]}getMarkData(t){return t!=null&&t.datum?t.datum[t.datum.length-1]:t}}Sd.type=gt.circlePacking,Sd.mark=I7t,Ye(Sd,vH);const O7t=()=>{q.registerSeries(Sd.type,Sd),eg(),_s(),FT(),L7t()},prt=n=>{let t=0;return n.forEach((e,i)=>{var r;D(e.value)&&(!((r=e.children)===null||r===void 0)&&r.length?e.value=prt(e.children):e.value=0),t+=Math.abs(e.value)}),t};function M7(n){return n.depth}function T7(n,t){return t-1-n.endDepth}function D7t(n,t){return n.sourceLinks.length?n.depth:t-1}function F7t(n,t,e){return n.targetLinks.length?n.depth:n.sourceLinks.length?Ri(n.sourceLinks.map(i=>e[i.target].depth))-1:0}const lC=(n,t)=>(n==null?void 0:n.y0)-(t==null?void 0:t.y0),k7=(n,t)=>{if(D(n.value))return null;const e=(t?n.targetLinks:n.sourceLinks).reduce((i,r)=>(D(r.value)?i.count+=1:i.sum+=r.value,i),{sum:0,count:0});return e.count>0?(n.value-e.sum)/e.count:null},H7t={left:M7,right:T7,justify:D7t,center:F7t,start:M7,end:T7},z7t=gc(0,1);class Db{constructor(t){this._ascendingSourceBreadth=(r,s)=>lC(this._nodeMap[r.source],this._nodeMap[s.source])||r.index-s.index,this._ascendingTargetBreadth=(r,s)=>lC(this._nodeMap[r.target],this._nodeMap[s.target])||r.index-s.index,this.options=Object.assign({},Db.defaultOptions,t);const e=this.options.nodeKey,i=it(e)?e:e?Za(e):null;this._getNodeKey=i,this._logger=ge.getInstance(),this._alignFunc=it(this.options.setNodeLayer)?r=>this.options.setNodeLayer(r.datum):H7t[this.options.nodeAlign]}layout(t,e){if(!t)return null;const i="width"in e?{x0:0,x1:e.width,y0:0,y1:e.height,width:e.width,height:e.height}:{x0:Math.min(e.x0,e.x1),x1:Math.max(e.x0,e.x1),y0:Math.min(e.y0,e.y1),y1:Math.max(e.y0,e.y1),width:Math.abs(e.x1-e.x0),height:Math.abs(e.y1-e.y0)};x4(this.options.direction)?this._viewBox={x0:i.y0,x1:i.y1,y0:i.x0,y1:i.x1,width:i.height,height:i.width}:this._viewBox=i;const r=this.computeNodeLinks(t),s=r.nodes;let o=r.links;if(this._nodeMap=r.nodeMap,this.computeNodeValues(s),this.computeNodeDepths(s),["right","end","justify"].includes(this.options.nodeAlign)&&this.computeNodeEndDepths(s),this._maxDepth<=0)return null;const a=this.computeNodeBreadths(s);if(this.computeLinkBreadths(s),s.forEach(l=>{l.sourceLinks=l.sourceLinks.filter(h=>!D(h.source)&&!D(h.target)),l.targetLinks=l.targetLinks.filter(h=>!D(h.source)&&!D(h.target))}),o=o.filter(l=>!D(l.source)&&!D(l.target)),x4(this.options.direction))if(this.options.inverse){const l=this._viewBox.x1;s.forEach(h=>{const{y0:d,y1:u,x0:c,x1:g}=h;h.y0=l-g,h.y1=l-c,h.x0=d,h.x1=u}),o.forEach(h=>{h.vertical=!0;const{x0:d,x1:u,y0:c,y1:g}=h;h.x0=c,h.x1=g,h.y0=l-d,h.y1=l-u})}else s.forEach(l=>{const{y0:h,y1:d}=l;l.y0=l.x0,l.y1=l.x1,l.x0=h,l.x1=d}),o.forEach(l=>{l.vertical=!0;const h=l.x0,d=l.x1;l.x0=l.y0,l.x1=l.y1,l.y0=h,l.y1=d});else this.options.inverse&&(s.forEach(l=>{const{x0:h,x1:d}=l;l.x0=i.x1-d,l.x1=i.x1-h}),o.forEach(l=>{l.x0=i.x1-l.x0,l.x1=i.x1-l.x1}));return o.forEach(l=>{const h=this._nodeMap[l.source],d=this._nodeMap[l.target];l.sourceRect={x0:h.x0,x1:h.x1,y0:h.y0,y1:h.y1},l.targetRect={x0:d.x0,x1:d.x1,y1:d.y1,y0:d.y0}}),{nodes:s,links:o,columns:a}}computeHierarchicNodeLinks(t){const e=[],i=[],r={},s={},o=[];prt(t);const a=(l,h,d)=>{l.forEach((u,c)=>{const g=this._getNodeKey?this._getNodeKey(u):d?`${d[d.length-1].key}-${c}`:`${h}-${c}`,p=D(u.value)?0:wu(u.value);if(r[g])r[g].value=void 0;else{const f={depth:h,datum:u,index:c,key:g,value:p,sourceLinks:[],targetLinks:[]};r[g]=f,e.push(f)}d&&o.push({source:d[d.length-1].key,target:g,value:p,parents:d}),u.children&&u.children.length&&a(u.children,h+1,d?d.concat([r[g]]):[r[g]])})};return a(t,0,null),o.forEach((l,h)=>{const d=`${l.source}-${l.target}`,u=Jl(l,["parents"]);if(u.parents=l.parents.map(g=>Jl(g,["sourceLinks","targetLinks"])),s[d])return s[d].value+=wu(l.value),void s[d].datum.push(u);const c={index:h,key:`${l.source}-${l.target}`,source:l.source,target:l.target,datum:[u],value:l.value,parents:l.parents.map(g=>g.key)};i.push(c),r[l.source].sourceLinks.push(c),r[l.target].targetLinks.push(c),s[d]=c}),{nodes:e,links:i,nodeMap:r}}computeSourceTargetNodeLinks(t){const e=[],i=[],r={};t.nodes&&t.nodes.forEach((o,a)=>{const l={depth:-1,datum:o,index:a,key:this._getNodeKey?this._getNodeKey(o):a,value:o.value,sourceLinks:[],targetLinks:[]};r[l.key]=l,e.push(l)});const s=[];return t.links.forEach((o,a)=>{const l=!D(o.source),h=!D(o.target);if(t.nodes&&(!r[o.source]||!r[o.target]))return;t.nodes||!l||r[o.source]||(r[o.source]={value:void 0,depth:-1,index:e.length,key:o.source,datum:null,sourceLinks:[],targetLinks:[]},e.push(r[o.source])),t.nodes||!h||r[o.target]||(r[o.target]={value:void 0,depth:-1,index:e.length,key:o.target,datum:null,sourceLinks:[],targetLinks:[]},e.push(r[o.target]));const d={index:a,source:o.source,target:o.target,datum:o,value:o.value};this.options.divideNodeValueToLink&&D(o.value)&&s.push(d),i.push(d),l&&r[o.source].sourceLinks.push(d),h&&r[o.target].targetLinks.push(d)}),this.options.divideNodeValueToLink&&s.length&&s.forEach(o=>{const a=[k7(r[o.source]),k7(r[o.target],!0)].filter(l=>!D(l));a.length&&(o.value=Ri(a))}),{nodeMap:r,nodes:e,links:i}}computeNodeLinks(t){let e;"links"in t?e=this.computeSourceTargetNodeLinks(t):(this._isHierarchic=!0,e=this.computeHierarchicNodeLinks(t.nodes));let i=e.nodes;const r=e.links;if(this.options.linkSortBy)for(let s=0,o=i.length;s<o;s++)i[s].sourceLinks.sort(this.options.linkSortBy),i[s].targetLinks.sort(this.options.linkSortBy);return this.options.dropIsolatedNode&&(i=i.filter(s=>s.targetLinks.length||s.sourceLinks.length)),{nodes:i,links:r,nodeMap:e.nodeMap}}computeNodeValues(t){for(let e=0,i=t.length;e<i;e++){const r=t[e];r.value=Math.max(D(r.value)?0:wu(r.value),r.sourceLinks.reduce((s,o)=>{var a;return s+((a=wu(o.value))!==null&&a!==void 0?a:0)},0),r.targetLinks.reduce((s,o)=>{var a;return s+((a=wu(o.value))!==null&&a!==void 0?a:0)},0))}}computeNodeDepths(t){var e;const i=t.length;let r,s,o=t,a=0,l=-1;const h=it(this.options.setNodeLayer)?this.options.setNodeLayer:null;for(;o.length&&a<i;){r=[],s={};for(let d=0,u=o.length;d<u;d++){const c=o[d];if(c&&(c.depth=h&&(e=h(c.datum))!==null&&e!==void 0?e:a,h&&(l=Math.max(c.depth,l)),c.sourceLinks&&c.sourceLinks.length))for(let g=0,p=c.sourceLinks.length;g<p;g++){const f=c.sourceLinks[g];s[f.target]||(r.push(this._nodeMap[f.target]),s[f.target]=!0)}}o=r,a+=1}a>i&&this._logger.warn("Error: there is a circular link"),this._maxDepth=h?l+1:a}computeNodeEndDepths(t){const e=t.length;let i,r,s=t,o=0;for(;s.length&&o<e;){i=[],r={};for(let a=0,l=s.length;a<l;a++){const h=s[a];if(h){h.endDepth=o;for(let d=0,u=h.targetLinks.length;d<u;d++){const c=h.targetLinks[d];r[c.source]||(i.push(this._nodeMap[c.source]),r[c.source]=!0)}}}s=i,o+=1}o>e&&this._logger.warn("Error: there is a circular link")}computeNodeLayers(t){const e=this.options.nodeWidth,i=this.options.linkWidth,r=this.options.minStepWidth,s=this._viewBox.width;let o=null,a=null,l=!1;if(yt(e)){const d=Ne(parseFloat(e.replace("%",""))/100,0,1);let u=s/(this._maxDepth-1+d);r>0&&(u=Math.max(r,u)),o=u*d,a=u*(1-d),l=!0}else if(J(e)){if(o=e,J(i))a=i;else if(D(i)){let d=(s-e)/(this._maxDepth-1);r>0&&(d=Math.max(r,d)),a=d-e}l=!0}else it(e)&&J(i)&&(a=i);const h=[];for(let d=0,u=t.length;d<u;d++){const c=t[d];c.layer=this._isHierarchic?c.depth:Ne(Math.floor(this._alignFunc(c,this._maxDepth,this._nodeMap)),0,this._maxDepth-1);const g=c.layer;g===this._maxDepth-1&&(c.isLastLayer=!0),l&&(c.x0=this._viewBox.x0+g*(o+a),c.x1=c.x0+o),h[g]?h[g].push(c):h[g]=[c]}if(this.options.nodeSortBy)for(let d=0,u=h.length;d<u;d++)h[d].sort(this.options.nodeSortBy);if(!l&&it(e)){let d=this._viewBox.x0;for(let u=0;u<this._maxDepth;u++){const c=h[u];let g=0,p=0;for(let f=0,m=c&&c.length;f<m;f++){const v=c[f],_=e(v);v.x0=d,v.x1=d+_,g=Math.max(o,_);const b=v.sourceLinks;for(let y=0,C=b.length;y<C;y++){const S=b[y],w=it(i)?i(S,this._viewBox):a;p=Math.max(p,w)}}d+=g+p}}return h}initializeNodeBreadths(t){var e,i,r;const s=(e=this.options.minLinkHeight)!==null&&e!==void 0?e:0;let o=(i=this.options.minNodeHeight)!==null&&i!==void 0?i:0;const a=(r=this.options.maxNodeHeight)!==null&&r!==void 0?r:1/0;let l=this.options.maxLinkHeight;(D(o)||o<s)&&(o=s),(D(l)||l>a)&&(l=a);let h=0,d=null,u=null;if(it(this.options.nodeGap))d=this.options.nodeGap,h=t.reduce((m,v)=>{const _=v.reduce((y,C)=>y+C.value,0),b=v.reduce((y,C)=>y+this.options.nodeGap(C),0);return Math.min(m,(this._viewBox.height-b)/_)},1/0);else{const m=t.reduce((b,y)=>Math.max(b,y.length),0),v=this._viewBox.height/m;let _=Math.min(this.options.nodeGap,v);if(o+_>v&&(_=o>=v?v/2:(v-o)/2,o=Math.min(v-_,o)),d=()=>_,this._gapY=_,this.options.equalNodeHeight)u=this._viewBox.height/m-_;else{const b=o>0?Math.max(_,o):_;h=t.reduce((y,C)=>{const S=C.reduce((w,x)=>w+x.value,0);return Math.min(y,(this._viewBox.height-((C.length-1)*b+o))/S)},1/0)}}const c=this.options.gapPosition==="start",g=!c&&this.options.gapPosition!=="end",p=J(this.options.nodeHeight)?m=>this.options.nodeHeight:it(this.options.nodeHeight)?this.options.nodeHeight:u>0?m=>u:m=>Math.max(m.value*h,0),f=J(this.options.linkHeight)?()=>this.options.linkHeight:it(this.options.linkHeight)?this.options.linkHeight:(m,v,_)=>Math.min(Math.max(v.value?_*z7t(m.value/v.value):0,s,0),l);for(let m=0,v=t.length;m<v;m++){const _=t[m];if(!_||!_.length)continue;let b=this._viewBox.y0,y=0,C=0,S=0;for(let x=0,A=_.length;x<A;x++){const M=_[x];y=d(M),c&&(b+=y),S=p(M),C=Math.min(Math.max(S,o),a),M.y0=b,M.y1=b+C,b=c?M.y1:M.y1+y;for(let T=0,R=M.sourceLinks.length;T<R;T++){const B=M.sourceLinks[T];B.thickness=f(B,M,S)}}let w=this._viewBox.y1-b+(g?y:0);if(w>0){if(this.options.crossNodeAlign!=="start")if(this.options.crossNodeAlign==="end")for(let x=0,A=_.length;x<A;++x){const M=_[x];M.y0+=w,M.y1+=w}else if(this.options.crossNodeAlign==="parent"){const x=_.reduce((A,M)=>(M.targetLinks&&M.targetLinks.length&&M.targetLinks.forEach(T=>{A[T.source]=!0}),A),{});if(Object.keys(x).length&&t[m-1]&&t[m-1].length){const A=t[m-1].filter(M=>x[M.key]);if(A&&A.length&&A[0].y0!==_[0].y0){const M=A[0].y0-_[0].y0;for(let T=0,R=_.length;T<R;++T){const B=_[T];B.y0+=M,B.y1+=M}}}}else{w/=_.length+1;for(let x=0,A=_.length;x<A;++x){const M=_[x];M.y0+=w*(x+1),M.y1+=w*(x+1)}}}else if(w<0&&_.length>1&&(w/=_.length-1,y+w>=0)){y+=w,this._gapY=Math.min(y);for(let x=1,A=_.length;x<A;++x){const M=_[x];M.y0+=w*x,M.y1+=w*x}}this.reorderLinks(_)}}computeNodeBreadths(t){const e=this.computeNodeLayers(t);this.initializeNodeBreadths(e);const i=this.options.iterations;if(!this._isHierarchic&&!it(this.options.setNodeLayer)&&!it(this.options.nodeGap))for(let r=0;r<i;++r){const s=Math.pow(.99,r),o=Math.max(1-s,(r+1)/i);this.relaxRightToLeft(e,s,o),this.relaxLeftToRight(e,s,o)}return e}relaxLeftToRight(t,e,i){for(let r=1,s=t.length;r<s;++r){const o=t[r];for(let a=0,l=o.length;a<l;a++){const h=o[a];let d=0,u=0;for(let g=0,p=h.targetLinks.length;g<p;g++){const f=h.targetLinks[g],m=f.value*(h.layer-this._nodeMap[f.source].layer);d+=this.targetTop(this._nodeMap[f.source],h)*m,u+=m}if(!(u>0))continue;const c=(d/u-h.y0)*e;h.y0+=c,h.y1+=c,this.reorderNodeLinks(h)}D(this.options.nodeSortBy)&&o.sort(lC),this.resolveCollisions(o,i)}}relaxRightToLeft(t,e,i){for(let r=t.length-2;r>=0;--r){const s=t[r];for(let o=0,a=s.length;o<a;o++){const l=s[o];let h=0,d=0;for(let c=0,g=l.sourceLinks.length;c<g;c++){const p=l.sourceLinks[c],f=p.value*(this._nodeMap[p.target].layer-l.layer);h+=this.sourceTop(l,this._nodeMap[p.target])*f,d+=f}if(!(d>0))continue;const u=(h/d-l.y0)*e;l.y0+=u,l.y1+=u,this.reorderNodeLinks(l)}this.options.nodeSortBy===void 0&&s.sort(lC),this.resolveCollisions(s,i)}}resolveCollisions(t,e){const i=t.length>>1,r=t[i];this.resolveCollisionsBottomToTop(t,r.y0-this._gapY,i-1,e),this.resolveCollisionsTopToBottom(t,r.y1+this._gapY,i+1,e),this.resolveCollisionsBottomToTop(t,this._viewBox.y1,t.length-1,e),this.resolveCollisionsTopToBottom(t,this._viewBox.y0,0,e)}resolveCollisionsTopToBottom(t,e,i,r){for(;i<t.length;++i){const s=t[i],o=(e-s.y0)*r;o>1e-6&&(s.y0+=o,s.y1+=o),e=s.y1+this._gapY}}resolveCollisionsBottomToTop(t,e,i,r){for(;i>=0;--i){const s=t[i],o=(s.y1-e)*r;o>1e-6&&(s.y0-=o,s.y1-=o),e=s.y0-this._gapY}}targetTop(t,e){let i,r,s,o=t.y0-(t.sourceLinks.length-1)*this._gapY/2;for(i=0,r=t.sourceLinks.length;i<r&&(s=t.sourceLinks[i],s.target!==e.key);i++)o+=s.thickness+this._gapY;for(i=0,r=e.targetLinks.length;i<r&&(s=e.targetLinks[i],s.source!==t.key);i++)o-=s.thickness;return o}sourceTop(t,e){let i,r,s,o=e.y0-(e.targetLinks.length-1)*this._gapY/2;for(i=0,r=e.targetLinks.length;i<r&&(s=e.targetLinks[i],s.source!==t.key);i++)o+=s.thickness+this._gapY;for(i=0,r=t.sourceLinks.length;i<r&&(s=t.sourceLinks[i],s.target!==e.key);i++)o-=s.thickness;return o}computeLinkBreadthsNoOverlap(t){for(let e=0,i=t.length;e<i;e++){const r=t[e];let s=r.y0,o=!1;for(let l=0,h=r.sourceLinks.length;l<h;l++){const d=r.sourceLinks[l];o||(d.y0=s+d.thickness/2),d.x0=r.x1,s+d.thickness>r.y1||o?(d.y0=r.y1-d.thickness/2,o=!0):s+=d.thickness}let a=r.y0;o=!1;for(let l=0,h=r.targetLinks.length;l<h;l++){const d=r.targetLinks[l];o||(d.y1=a+d.thickness/2),d.x1=r.x0,a+d.thickness>r.y1||o?(d.y1=r.y1-d.thickness/2,o=!0):a+=d.thickness}}}computeLinkBreadthsOverlap(t){const e=this.options.linkOverlap;for(let i=0,r=t.length;i<r;i++){const s=t[i],o=e==="start"?s.y0:e==="end"?s.y1:(s.y0+s.y1)/2,a=e==="start"?.5:e==="end"?-.5:0;for(let l=0,h=s.sourceLinks.length;l<h;l++){const d=s.sourceLinks[l];d.y0=o+a*d.thickness,d.x0=s.x1}for(let l=0,h=s.targetLinks.length;l<h;l++){const d=s.targetLinks[l];d.y1=o+a*d.thickness,d.x1=s.x0}}}computeLinkBreadths(t){this.options.linkOverlap?this.computeLinkBreadthsOverlap(t):this.computeLinkBreadthsNoOverlap(t)}reorderNodeLinks(t){if(D(this.options.linkSortBy)){const e=t.targetLinks,i=t.sourceLinks;for(let r=0,s=e.length;r<s;r++){const o=e[r];this._nodeMap[o.source].sourceLinks.sort(this._ascendingTargetBreadth)}for(let r=0,s=i.length;r<s;r++){const o=i[r];this._nodeMap[o.target].targetLinks.sort(this._ascendingSourceBreadth)}}}reorderLinks(t){if(D(this.options.linkSortBy))for(let e=0,i=t.length;e<i;e++){const r=t[e];r.sourceLinks.sort(this._ascendingTargetBreadth),r.targetLinks.sort(this._ascendingSourceBreadth)}}}Db.defaultOptions={iterations:6,nodeAlign:"justify",direction:"horizontal",nodeWidth:24,nodeGap:8,crossNodeAlign:"middle",dropIsolatedNode:!0};const W7t=(n,t)=>{const e=new Db(n).layout(Array.isArray(t)?t[0]:t,"width"in n?{width:n.width,height:n.height}:{x0:n.x0,x1:n.x1,y0:n.y0,y1:n.y1});return e?[e]:[]},j7t=()=>{dt.registerTransform("sankey",{transform:W7t,markPhase:"beforeJoin"},!0)},frt=(n,t,e)=>{t.forEach(i=>{D(i[e])||n.add(i[e]),i.children&&i.children.length>0&&frt(n,i.children,e)})},N7t=n=>{var t;if(!n||!V(n))return[];if(n.length>1){const e={links:[],nodes:[]};return n.forEach(i=>{i.id!=="links"&&i.id!=="nodes"||(e[i.id]=i.values)}),[e]}return!((t=n[0])===null||t===void 0)&&t.latestData?n[0].latestData:n},$7t=(n,t)=>{if(!n||!(t!=null&&t.view)||!n.length)return[];const e=t.view();if(e.x1-e.x0==0||e.y1-e.y0==0||e.x1-e.x0==-1/0||e.x1-e.x0==1/0||e.y1-e.y0==-1/0||e.y1-e.y0==1/0)return[];const i=n[0];if((t.sourceField!=="source"||t.targetField!=="target"||t.valueField!=="value")&&i.links){const o=[];i.links.forEach(a=>{const l={};for(const h in a)h===t.sourceField?l.source=a[t.sourceField]:h===t.targetField?l.target=a[t.targetField]:h===t.valueField?l.value=a[t.valueField]:l[h]=a[h];o.push(l)}),i.links=o}const r=new Db(t),s=[];return s.push(r.layout(i,e)),s},V7t=n=>{var t,e;return n&&V(n)&&(!((t=n[0])===null||t===void 0)&&t.latestData)&&n[0].latestData.length&&n[0].latestData[0]&&(e=n[0].latestData[0].nodes)!==null&&e!==void 0?e:[]},G7t=n=>{var t,e;return n&&V(n)&&(!((t=n[0])===null||t===void 0)&&t.latestData)&&n[0].latestData.length&&n[0].latestData[0]&&(e=n[0].latestData[0].links)!==null&&e!==void 0?e:[]};class U7t extends wr{constructor(){super(...arguments),this._getDimensionData=t=>{if(t.source){if(J(t.source)){const e=this.series.getSeriesKeys();return e[t.source]+" => "+e[t.target]}return t.source+" => "+t.target}return t.datum?t.datum[this.series.getSpec().categoryField]:t.key},this.markTooltipValueCallback=t=>t.value}}const Y7t=(n,t=!0)=>({type:n.direction==="horizontal"?"growWidthIn":"growHeightIn",options:{overall:t&&n.growFrom(),orient:"positive"}}),X7t=(n,t)=>t==="fadeIn"?{type:"fadeIn"}:Y7t(n),K7t=n=>n==="fadeIn"?{type:"fadeIn"}:{type:"linkPathGrowIn"},q7t=()=>{q.registerAnimation("sankeyNode",(n,t)=>Object.assign({appear:X7t(n,t)},DT)),q.registerAnimation("sankeyLinkPath",(n,t)=>({appear:K7t(t),enter:{type:"linkPathGrowIn"},exit:{type:"linkPathGrowOut"},disappear:{type:"linkPathGrowOut"}}))};class N0 extends sr{constructor(){super(...arguments),this.type=N0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x:0,y:0,x0:0,y0:0,x1:100,y1:100,thickness:1,round:!0})}_initProduct(t){const e=this.getVGrammarView(),i=this.getProductId(),r=this.getStyle("direction");this._product=e.glyph("linkPath",t??e.rootMark).id(i).configureGlyph({direction:r}),this._compiledProductId=i}}N0.type="linkPath";const Z7t=()=>{xNt(),q.registerMark(N0.type,N0)},J7t=Object.assign(Object.assign({},Hi),{node:{name:"node",type:"rect"},link:{name:"link",type:"linkPath"}});class mrt extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"node")}}class xd extends Po{constructor(){super(...arguments),this.type=gt.sankey,this.transformerConstructor=mrt,this._nodeLayoutZIndex=Qe.Node,this._labelLayoutZIndex=Qe.Label,this._viewBox=new Bi,this._fillByNode=t=>{var e,i,r,s,o;if(t&&t.sourceRect&&t.targetRect)return this._fillByLink(t);const a=(i=(e=this._spec.node)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.fill;if(L(a))return a;if(L(this._spec.seriesField)){const l=(s=(r=this._option)===null||r===void 0?void 0:r.globalScale)===null||s===void 0?void 0:s.getScale("color"),h=t!=null&&t.datum?t.datum:t;return l==null?void 0:l.scale(h==null?void 0:h[this._spec.seriesField])}return(o=this._colorScale)===null||o===void 0?void 0:o.scale(this._getNodeNameFromData(t))},this._fillByLink=t=>{var e,i,r,s,o,a,l;const h=(i=(e=this._spec.link)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.fill;if(h)return h;if(L(this._spec.seriesField)){const u=(s=(r=this._nodesSeriesData)===null||r===void 0?void 0:r.getLatestData())===null||s===void 0?void 0:s.find(p=>t.source===p.key),c=u==null?void 0:u.datum,g=(a=(o=this._option)===null||o===void 0?void 0:o.globalScale)===null||a===void 0?void 0:a.getScale("color");return g==null?void 0:g.scale(c==null?void 0:c[this._spec.seriesField])}const d=J(t.source)?this.getNodeList()[t.source]:t.source;return(l=this._colorScale)===null||l===void 0?void 0:l.scale(d)},this._handleEmphasisElement=t=>{var e,i,r,s,o;const a=(e=this._spec.emphasis)!==null&&e!==void 0?e:{},l=t.item;a.effect==="adjacency"?l&&l.mark===((i=this._nodeMark)===null||i===void 0?void 0:i.getProduct())?this._handleNodeAdjacencyClick(l):l&&l.mark===((r=this._linkMark)===null||r===void 0?void 0:r.getProduct())?this._handleLinkAdjacencyClick(l):this._handleClearEmpty():a.effect==="related"&&(l&&l.mark===((s=this._nodeMark)===null||s===void 0?void 0:s.getProduct())?this._handleNodeRelatedClick(l):l&&l.mark===((o=this._linkMark)===null||o===void 0?void 0:o.getProduct())?this._handleLinkRelatedClick(l):this._handleClearEmpty())},this._handleClearEmpty=()=>{var t,e;if(!this._needClear)return;const i=(t=this._nodeMark)===null||t===void 0?void 0:t.getProductElements();if(!i||!i.length)return;const r=(e=this._linkMark)===null||e===void 0?void 0:e.getProductElements();if(!r||!r.length)return;const s=[Rt.STATE_SANKEY_EMPHASIS,Rt.STATE_SANKEY_EMPHASIS_REVERSE];i.forEach(o=>{o.removeState(s)}),r.forEach(o=>{o.removeState(s)}),this._needClear=!1},this._handleNodeAdjacencyClick=t=>{const e=t.getDatum(),i=[e.key];if(this._linkMark){const r=this._linkMark.getProductElements();if(!r||!r.length)return;r.forEach((s,o)=>{const a=s.getDatum();a.source===e.key?(i.includes(a.target)||i.push(a.target),s.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),s.addState(Rt.STATE_SANKEY_EMPHASIS)):a.target===e.key?(i.includes(a.source)||i.push(a.source),s.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),s.addState(Rt.STATE_SANKEY_EMPHASIS)):(s.removeState(Rt.STATE_SANKEY_EMPHASIS),s.addState(Rt.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),i),this._needClear=!0},this._handleLinkAdjacencyClick=t=>{const e=t.getDatum(),i=[e.source,e.target];if(this._linkMark){const r=this._linkMark.getProductElements();if(!r||!r.length)return;r.forEach(s=>{s===t?(s.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),s.addState(Rt.STATE_SANKEY_EMPHASIS,{ratio:1})):(s.removeState(Rt.STATE_SANKEY_EMPHASIS),s.addState(Rt.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),i),this._needClear=!0},this._handleNodeRelatedClick=t=>{var e;const i=t.getDatum(),r=this._nodeMark.getProductElements();if(!r||!r.length)return;const s=this._linkMark.getProductElements();if(!s||!s.length)return;const o=!((e=s[0].getDatum())===null||e===void 0)&&e.parents?"parents":"source";if(o==="source"){const a=[i.key],l=[];if(s.forEach((h,d)=>{var u,c,g,p;const f=h.getDatum(),m=f!=null&&f.parents?"parents":"source";if(Q(f[m]).includes(i.key)){if(l.includes((u=f.key)!==null&&u!==void 0?u:f.index)||l.push((c=f.key)!==null&&c!==void 0?c:f.index),a.includes(f.source)||a.push(f.source),!a.includes(f.target)){a.push(f.target);let v=r.find(_=>_.data[0].key===f.target).data[0].sourceLinks;for(;(v==null?void 0:v.length)>0;){const _=[];return v.forEach(b=>{var y,C;if(!l.includes((y=b.key)!==null&&y!==void 0?y:b.index)&&(l.push((C=b.key)!==null&&C!==void 0?C:b.index),!a.includes(b.target))){a.push(b.target);const S=r.find(w=>w.data[0].key===b.target);_.push(S.data[0].targetLinks)}}),void(v=_)}}}else if(f.target===i.key&&(l.includes((g=f.key)!==null&&g!==void 0?g:f.index)||l.push((p=f.key)!==null&&p!==void 0?p:f.index),!a.includes(f.source))){a.push(f.source);let v=r.find(_=>_.data[0].key===f.source).data[0].targetLinks;for(;(v==null?void 0:v.length)>0;){const _=[];return v.forEach(b=>{var y,C;if(!l.includes((y=b.key)!==null&&y!==void 0?y:b.index)&&(l.push((C=b.key)!==null&&C!==void 0?C:b.index),!a.includes(b.source))){a.push(b.source);const S=r.find(w=>w.data[0].key===b.source);_.push(S.data[0].targetLinks)}}),void(v=_)}}}),this._linkMark){const h=this._linkMark.getProductElements();if(!h||!h.length)return;h.forEach((d,u)=>{var c;l.includes((c=d.getDatum().key)!==null&&c!==void 0?c:d.getDatum().index)?(d.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),d.addState(Rt.STATE_SANKEY_EMPHASIS)):(d.removeState(Rt.STATE_SANKEY_EMPHASIS),d.addState(Rt.STATE_SANKEY_EMPHASIS_REVERSE))})}this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),a)}else{const a=[i.key],l=i.targetLinks.reduce((h,d)=>(Q(d.datum).forEach(u=>{const c=u.parents,g=c.length;for(let p=0;p<g;p++){const f=c[p].key,m=c[p+1]?c[p+1].key:i.key,v=u.value,_=h.find(b=>b.source===f&&b.target===m);_?_.value+=v:h.push({source:f,target:m,value:v})}}),h),[]);s.forEach((h,d)=>{const u=h.getDatum(),c=u.datum,g=c?c.filter(f=>f[o].some(m=>m.key===i.key)):null,p=l.find(f=>f.source===u.source&&f.target===u.target);if(g&&g.length){a.includes(u.source)||a.push(u.source),a.includes(u.target)||a.push(u.target);const f=g.reduce((m,v)=>m+v.value,0)/u.value;return h.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),void h.addState(Rt.STATE_SANKEY_EMPHASIS,{ratio:f})}if(p)return a.includes(u.source)||a.push(u.source),a.includes(u.target)||a.push(u.target),h.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),void h.addState(Rt.STATE_SANKEY_EMPHASIS,{ratio:p.value/u.value});h.removeState(Rt.STATE_SANKEY_EMPHASIS),h.addState(Rt.STATE_SANKEY_EMPHASIS_REVERSE)}),this._nodeMark&&this._highLightElements(this._nodeMark.getProductElements(),a)}this._needClear=!0},this._handleLinkRelatedClick=t=>{var e;const i=this._nodeMark.getProductElements();if(!i||!i.length)return;const r=this._linkMark.getProductElements();if(!(!r||!r.length)){if((!((e=t.getDatum())===null||e===void 0)&&e.parents?"parents":"source")=="source"){const s=[Rt.STATE_SANKEY_EMPHASIS,Rt.STATE_SANKEY_EMPHASIS_REVERSE];this._linkMark&&r.forEach(o=>{o.removeState(s)}),this._nodeMark&&i.forEach(o=>{o.removeState(s)})}else{const s=t.getDatum(),o=[s.source,s.target],a=[];Q(s.datum).forEach(l=>{const h=l.parents,d=h.length;for(let u=0;u<d-1;u++){const c=h[u].key,g=h[u+1].key,p=l.value,f=a.find(m=>m.source===c&&m.target===g);a.push({source:h[u].key,target:h[u+1].key,value:l.value}),f?f.value+=p:a.push({source:c,target:g,value:p})}}),r.forEach(l=>{const h=l.getDatum(),d=h.datum;if(h.source===s.source&&h.target===s.target)return l.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),void l.addState(Rt.STATE_SANKEY_EMPHASIS,{ratio:1});const u=d?d.filter(g=>{const p=g.parents.map(f=>f.key);return p.includes(s.source)&&p.includes(s.target)}):null;if(u&&u.length){o.includes(h.source)||o.push(h.source),o.includes(h.target)||o.push(h.target);const g=u.filter(f=>f.parents.some((m,v)=>{var _;return m.key===s.source&&((_=f.parents[v+1])===null||_===void 0?void 0:_.key)===s.target})).reduce((f,m)=>f+m.value,0),p=g/h.value;return l.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),void l.addState(Rt.STATE_SANKEY_EMPHASIS,{ratio:p})}const c=a.find(g=>g.source===h.source&&g.target===h.target);if(c)return o.includes(h.source)||o.push(h.source),o.includes(h.target)||o.push(h.target),l.removeState(Rt.STATE_SANKEY_EMPHASIS_REVERSE),void l.addState(Rt.STATE_SANKEY_EMPHASIS,{ratio:c.value/h.value});l.removeState(Rt.STATE_SANKEY_EMPHASIS),l.addState(Rt.STATE_SANKEY_EMPHASIS_REVERSE)}),this._highLightElements(i,o)}this._needClear=!0}}}get direction(){var t;return(t=this._spec.direction)!==null&&t!==void 0?t:"horizontal"}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:this._spec.categoryField)}initData(){var t,e,i,r;super.initData();const s=this.getViewData(),o=this.getRawData();if(o&&s){Vt(this._dataSet,"sankeyLayout",$7t),Vt(this._dataSet,"sankeyFormat",N7t),o.transform({type:"sankeyFormat"},!1),s.transform({type:"sankeyLayout",options:{view:()=>({x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2}),sourceField:this._spec.sourceField,targetField:this._spec.targetField,valueField:this._spec.valueField,direction:this.direction,crossNodeAlign:this._spec.crossNodeAlign,nodeAlign:(t=this._spec.nodeAlign)!==null&&t!==void 0?t:"justify",nodeGap:(e=this._spec.nodeGap)!==null&&e!==void 0?e:8,nodeWidth:(i=this._spec.nodeWidth)!==null&&i!==void 0?i:10,linkWidth:this._spec.linkWidth,minStepWidth:this._spec.minStepWidth,minNodeHeight:(r=this._spec.minNodeHeight)!==null&&r!==void 0?r:4,maxNodeHeight:this._spec.maxNodeHeight,minLinkHeight:this._spec.minLinkHeight,maxLinkHeight:this._spec.maxLinkHeight,iterations:this._spec.iterations,nodeKey:this._spec.nodeKey,linkSortBy:this._spec.linkSortBy,nodeSortBy:this._spec.nodeSortBy,setNodeLayer:this._spec.setNodeLayer,dropIsolatedNode:this._spec.dropIsolatedNode,nodeHeight:this._spec.nodeHeight,linkHeight:this._spec.linkHeight,equalNodeHeight:this._spec.equalNodeHeight,linkOverlap:this._spec.linkOverlap,inverse:this._spec.inverse},level:oa.sankeyLayout});const{dataSet:a}=this._option;Vt(a,"sankeyNodes",V7t),Vt(a,"flatten",Ob);const l=new Ve(a,{name:`sankey-node-${this.id}-data`});l.parse([this.getViewData()],{type:"dataview"}),l.transform({type:"sankeyNodes"}),l.transform({type:"flatten",options:{callback:d=>{if(d.datum){const u=d.datum[d.depth];return Object.assign(Object.assign({},d),u)}return d}}},!1),l.transform({type:"addVChartProperty",options:{beforeCall:xf.bind(this),call:Hc}},!1),this._nodesSeriesData=new tl(this._option,l),Vt(a,"sankeyLinks",G7t);const h=new Ve(a,{name:`sankey-link-${this.id}-data`});h.parse([this.getViewData()],{type:"dataview"}),h.transform({type:"sankeyLinks"}),h.transform({type:"addVChartProperty",options:{beforeCall:xf.bind(this),call:Hc}},!1),this._linksSeriesData=new tl(this._option,h)}}compileData(){var t,e;super.compileData(),(t=this._linksSeriesData)===null||t===void 0||t.compile(),(e=this._nodesSeriesData)===null||e===void 0||e.compile()}initMark(){var t,e,i,r;this._rootMark.setMarkConfig({overflow:this._spec.overflow,interactive:!!this._spec.overflow});const s=this._createMark(xd.mark.node,{isSeriesMark:!0,dataView:this._nodesSeriesData.getDataView(),dataProductId:this._nodesSeriesData.getProductId(),stateSort:(t=this._spec.node)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.node)===null||e===void 0?void 0:e.customShape});s&&(s.setMarkConfig({zIndex:this._nodeLayoutZIndex}),this._nodeMark=s);const o=this._createMark(xd.mark.link,{dataView:this._linksSeriesData.getDataView(),dataProductId:this._linksSeriesData.getProductId(),stateSort:(i=this._spec.link)===null||i===void 0?void 0:i.stateSort},{setCustomizedShape:(r=this._spec.link)===null||r===void 0?void 0:r.customShape});o&&(this._linkMark=o)}_buildMarkAttributeContext(){super._buildMarkAttributeContext(),this._markAttributeContext.valueToNode=this.valueToNode.bind(this),this._markAttributeContext.valueToLink=this.valueToLink.bind(this)}valueToNode(t){const e=this._nodesSeriesData.getLatestData(),i=Q(t)[0];return e&&e.find(r=>r.key===i)}valueToLink(t){const e=this._linksSeriesData.getLatestData(),i=Q(t);return e&&e.find(r=>r&&r.source===i[0]&&r.target===i[1])}valueToPositionX(t){const e=this.valueToNode(t);return e==null?void 0:e.x0}valueToPositionY(t){const e=this.valueToNode(t);return e==null?void 0:e.y0}initMarkStyle(){this._initNodeMarkStyle(),this._initLinkMarkStyle()}_initNodeMarkStyle(){var t,e;const i=this._nodeMark;i&&(this.setMarkStyle(i,{x:r=>r.x0,x1:r=>r.x1,y:r=>r.y0,y1:r=>r.y1},Rt.STATE_NORMAL,wt.Mark),this.setMarkStyle(i,{fill:(e=(t=this._spec.node.style)===null||t===void 0?void 0:t.fill)!==null&&e!==void 0?e:this._fillByNode},"normal",wt.User_Mark))}_initLinkMarkStyle(){var t,e;const i=this._linkMark;i&&(this.setMarkStyle(i,{x0:r=>r.x0,x1:r=>r.x1,y0:r=>r.y0,y1:r=>r.y1,thickness:r=>r.thickness,direction:this.direction},Rt.STATE_NORMAL,wt.Series),this.setMarkStyle(i,{fill:(e=(t=this._spec.link.style)===null||t===void 0?void 0:t.fill)!==null&&e!==void 0?e:this._fillByLink},"normal",wt.User_Mark))}initLabelMarkStyle(t,e){if(!t)return;const i=e.position;i&&i.includes("inside")?this.setMarkStyle(t,{fill:"#ffffff",text:r=>this._createText(r,e),maxLineWidth:r=>{var s;return(s=e.limit)!==null&&s!==void 0?s:r.x1-r.x0}}):this.setMarkStyle(t,{fill:this._fillByNode,text:r=>this._createText(r,e),maxLineWidth:e.limit}),t.setMarkConfig({zIndex:this._labelLayoutZIndex})}_createText(t,e){if(D(t)||D(t.datum))return"";let i=t.datum[this._spec.categoryField]||"";const{formatMethod:r,formatter:s}=e||{},{formatFunc:o,args:a}=sh(r,s,i,t.datum);return o&&(i=o(...a,{series:this})),i}initAnimation(){var t,e,i,r;const s={direction:this.direction,growFrom:()=>{var a,l;return this.direction==="horizontal"?(a=this._xAxisHelper)===null||a===void 0?void 0:a.getScale(0).scale(0):(l=this._yAxisHelper)===null||l===void 0?void 0:l.getScale(0).scale(0)}},o=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._nodeMark&&this._nodeMark.setAnimationConfig(Ae((i=q.getAnimationInKey("sankeyNode"))===null||i===void 0?void 0:i(s,o),Fe("node",this._spec,this._markAttributeContext))),this._linkMark&&this._linkMark.setAnimationConfig(Ae((r=q.getAnimationInKey("sankeyLinkPath"))===null||r===void 0?void 0:r(s,o),Fe("link",this._spec,this._markAttributeContext)))}initEvent(){var t,e,i;super.initEvent(),(t=this._nodesSeriesData.getDataView())===null||t===void 0||t.target.addListener("change",this.nodesSeriesDataUpdate.bind(this)),(e=this._linksSeriesData.getDataView())===null||e===void 0||e.target.addListener("change",this.linksSeriesDataUpdate.bind(this));const r=(i=this._spec.emphasis)!==null&&i!==void 0?i:{};if(this._option.disableTriggerEvent!==!0&&r.enable&&(r.effect==="adjacency"||r.effect==="related")){const s=r.trigger==="hover"?"pointerover":"pointerdown";this.event.on(s,{level:mi.chart},this._handleEmphasisElement)}}nodesSeriesDataUpdate(){this._nodesSeriesData.updateData(),this._nodeList=null,this._setNodeOrdinalColorScale()}linksSeriesDataUpdate(){this._linksSeriesData.updateData()}_highLightElements(t,e){t&&t.length&&t.forEach(i=>{i.removeState([Rt.STATE_SANKEY_EMPHASIS_REVERSE,Rt.STATE_SANKEY_EMPHASIS]),e.includes(i.getDatum().key)?i.addState(Rt.STATE_SANKEY_EMPHASIS):i.addState(Rt.STATE_SANKEY_EMPHASIS_REVERSE)})}initTooltip(){this._tooltipHelper=new U7t(this),this._nodeMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nodeMark),this._linkMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._linkMark)}_setNodeOrdinalColorScale(){var t,e,i,r,s;const o=(e=(t=this._option)===null||t===void 0?void 0:t.globalScale)===null||e===void 0?void 0:e.getScale("color");if(o!=null&&o._specified)return void(this._colorScale=o);let a,l;o&&(a=o.domain(),l=o.range()),l||(l=this._getDataScheme()),a&&!D(a[0])||(a=this.getNodeList(),a.length>10&&(l=(i=this._getDataScheme()[1])===null||i===void 0?void 0:i.scheme));const h=new Ab;(s=(r=h.domain(a)).range)===null||s===void 0||s.call(r,l),this._colorScale=h}getNodeList(){var t,e;if(this._nodeList)return this._nodeList;const i=this._rawData.latestData[0],r=i!=null&&i.nodes?!((t=i.nodes[0])===null||t===void 0)&&t.children?Array.from(this.extractNamesFromTree(i.nodes,this._spec.categoryField)):i.nodes.map((s,o)=>s[this._spec.categoryField]):i!=null&&i.links?Array.from(this.extractNamesFromLink(i.links)):(e=i==null?void 0:i.values)===null||e===void 0?void 0:e.map((s,o)=>s[this._spec.categoryField]);return this._nodeList=r,r}_getNodeNameFromData(t){var e;return t!=null&&t.datum?t.datum[this._spec.categoryField]:(e=t.key)!==null&&e!==void 0?e:t[this._spec.categoryField]}extractNamesFromTree(t,e){const i=new Set;return t.forEach(r=>{i.add(r[e]),r.children&&this.extractNamesFromTree(r.children,e).forEach(s=>i.add(s))}),i}extractNamesFromLink(t){const e=new Set,{sourceField:i,targetField:r}=this._spec;return t.forEach(s=>{L(s[i])&&e.add(s[i]),L(s[r])&&e.add(s[r])}),e}getDimensionField(){return[this._spec.categoryField]}getMeasureField(){return[this._valueField]}getRawDataStatisticsByField(t,e){var i;return this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[t]&&(this._viewDataStatistics&&this.getViewData().transformsArr.length<=1&&(!((i=this._viewDataStatistics.latestData)===null||i===void 0)&&i[t])?this._rawStatisticsCache[t]=this._viewDataStatistics.latestData[t]:this._rawData&&(this._rawStatisticsCache[t]={values:this._collectByField(t)})),this._rawStatisticsCache[t]}_collectByField(t){var e,i,r;const s=[],o=(i=(e=this.getRawData())===null||e===void 0?void 0:e.latestData)===null||i===void 0?void 0:i[0];if(!o)return[];if(o.links)!((r=o.nodes)===null||r===void 0)&&r.length&&o.nodes.forEach(a=>{a[this._seriesField]&&s.push(a[this._seriesField])});else if(o.nodes){const a=new Set;return frt(a,o.nodes,this._seriesField),Array.from(a)}return s}onLayoutEnd(t){super.onLayoutEnd(t),this._viewBox.set(0,0,this._region.getLayoutRect().width,this._region.getLayoutRect().height),this.getViewData().reRunAllTransform()}getDefaultShapeType(){return"square"}_noAnimationDataKey(t,e){}getActiveMarks(){return[this._nodeMark,this._linkMark]}getMarkData(t){return t.datum?V(t.datum)?t.datum[t.datum.length-1]:t.datum:t}}xd.type=gt.sankey,xd.transformerConstructor=mrt,xd.mark=J7t;const Q7t=()=>{j7t(),_h(),Z7t(),_s(),q7t(),mh(),q.registerSeries(xd.type,xd)},R7=(n,t)=>{let e={},i=t.fields;if(it(i)&&(i=i()),!(i!=null&&i.length)||!(n!=null&&n.length)||!n[0].latestData)return e;const r=n[0].latestData,s=Ob(r);return e=HI([{latestData:s}],t),e};class t9t extends wr{constructor(){super(...arguments),this.markTooltipKeyCallback=t=>{var e,i;return(i=(e=this.series)===null||e===void 0?void 0:e.getMarkData(t))===null||i===void 0?void 0:i[this.series.getDimensionField()[0]]},this.markTooltipValueCallback=t=>{var e,i;const{measureFields:r}=this._seriesCacheInfo,s=(e=this.series)===null||e===void 0?void 0:e.getMarkData(t);if(r[0]&&s)return(i=s[r[0]])!==null&&i!==void 0?i:t.value},this.dimensionTooltipTitleCallback=t=>{var e;const{dimensionFields:i}=this._seriesCacheInfo,r=(e=this.series)===null||e===void 0?void 0:e.getMarkData(t);if(i[0]&&r)return r[i[0]]}}get defaultShapeType(){return"square"}}const e9t=Object.assign(Object.assign({},Hi),{nonLeaf:{name:"nonLeaf",type:"rect"},leaf:{name:"leaf",type:"rect"},nonLeafLabel:{name:"nonLeafLabel",type:"text"}}),i9t=n=>n==="fadeIn"?{type:"fadeIn"}:{type:"growCenterIn"},n9t=()=>{q.registerAnimation("treemap",(n,t)=>({appear:i9t(t),enter:{type:"growCenterIn"},exit:{type:"growCenterOut"},disappear:{type:"growCenterOut"}}))};class vrt extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"nonLeaf","nonLeafLabel","initNonLeafLabelMarkStyle"),this._addMarkLabelSpec(t,"leaf")}}class Ha extends Po{constructor(){super(...arguments),this.type=gt.treemap,this.transformerConstructor=vrt,this._categoryField="name",this._valueField="value",this._viewBox=new Bi,this._enableAnimationHook=this.enableMarkAnimation.bind(this),this.isHierarchyData=()=>!0}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField((t=this._spec.seriesField)!==null&&t!==void 0?t:Fc),this._spec.roam&&(this.initZoomable(this.event,this._option.mode),this._matrix=new Pe),this._spec.drill&&this.initDrillable({event:this.event,mode:this._option.mode,drillField:()=>{var e,i;return(i=(e=this._spec.drillField)!==null&&e!==void 0?e:this._categoryField)!==null&&i!==void 0?i:sa},getRawData:()=>this.getRawData()}),et(this._spec.maxDepth)&&(this._maxDepth=this._spec.maxDepth-1)}initData(){super.initData(),this.getViewData()&&this._spec.drill&&this.initDrillableData(this._dataSet)}compile(){super.compile(),this._runTreemapTransform()}_runTreemapTransform(t=!1){var e,i,r,s;const o=this._data.getProduct();o&&o.transform([{type:"treemap",nameField:this._categoryField,valueField:this._valueField,x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2,maxDepth:this._maxDepth,gapWidth:this._spec.gapWidth,padding:this._spec.nodePadding,splitType:this._spec.splitType,aspectRatio:this._spec.aspectRatio,labelPadding:!((e=this._spec.nonLeafLabel)===null||e===void 0)&&e.visible?(i=this._spec.nonLeafLabel)===null||i===void 0?void 0:i.padding:0,labelPosition:(r=this._spec.nonLeafLabel)===null||r===void 0?void 0:r.position,minVisibleArea:(s=this._spec.minVisibleArea)!==null&&s!==void 0?s:10,minChildrenVisibleArea:this._spec.minChildrenVisibleArea,minChildrenVisibleSize:this._spec.minChildrenVisibleSize,flatten:!0},{type:"map",callback:a=>(a&&[Fc,"name"].forEach(l=>{a[l]=a.datum[a.depth][this._categoryField]}),a)}]),t&&this.getCompiler().renderNextTick()}_addDataIndexAndKey(){var t;!((t=this._rawData)===null||t===void 0)&&t.dataSet&&(Vt(this._rawData.dataSet,"addVChartProperty",Yf),this._rawData.transform({type:"addVChartProperty",options:{beforeCall:JF.bind(this),call:OT}}))}getRawDataStatisticsByField(t,e){var i;if(this._rawStatisticsCache||(this._rawStatisticsCache={}),!this._rawStatisticsCache[t]&&this._rawData){const r=R7([this._rawData],{fields:[{key:t,operations:e?["min","max"]:["values"]}]})[t];this._rawStatisticsCache[t]=Z((i=this._rawStatisticsCache[t])!==null&&i!==void 0?i:{},r)}return this._rawStatisticsCache[t]}_createHierarchyDataStatistics(t,e){Vt(this._dataSet,"hierarchyDimensionStatistics",R7),Vt(this._dataSet,"flatten",Ob);const i=new Ve(this._dataSet,{name:t});return i.parse(e,{type:"dataview"}),i.transform({type:"hierarchyDimensionStatistics",options:{fields:()=>{const r=this.getStatisticFields();return this._seriesField&&this._seriesField!==this._categoryField&&r.push({key:this._seriesField,operations:["values"]}),r}}},!1),i}getStatisticFields(){return _H(super.getStatisticFields(),this._categoryField,this._valueField)}initMark(){var t,e,i,r;const s=this._createMark(Ha.mark.nonLeaf,{isSeriesMark:!0,stateSort:(t=this._spec.nonLeaf)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.nonLeaf)===null||e===void 0?void 0:e.customShape});s&&(s.setTransform([{type:"filter",callback:a=>!this._shouldFilterElement(a,"nonLeaf")}]),this._nonLeafMark=s);const o=this._createMark(Ha.mark.leaf,{isSeriesMark:!0,stateSort:(i=this._spec.leaf)===null||i===void 0?void 0:i.stateSort},{setCustomizedShape:(r=this._spec.leaf)===null||r===void 0?void 0:r.customShape});o&&(o.setTransform([{type:"filter",callback:a=>!this._shouldFilterElement(a,"leaf")}]),this._leafMark=o)}initMarkStyle(){this._initLeafMarkStyle(),this._initNonLeafMarkStyle()}_initLeafMarkStyle(){this._leafMark&&this.setMarkStyle(this._leafMark,{x:t=>t.x0,y:t=>t.y0,x1:t=>t.x1,y1:t=>t.y1,fill:this.getColorAttribute()},Rt.STATE_NORMAL,wt.Series)}_initNonLeafMarkStyle(){this._nonLeafMark&&this.setMarkStyle(this._nonLeafMark,{x:t=>t.x0,y:t=>t.y0,x1:t=>t.x1,y1:t=>t.y1,fill:this.getColorAttribute()},Rt.STATE_NORMAL,wt.Series)}_initRichStyleOfLabelMark(t){t.getTextType()==="rich"&&this.setMarkStyle(t,{maxWidth:e=>Math.abs(e.x0-e.x1),maxHeight:e=>Math.abs(e.y0-e.y1),ellipsis:!0},Rt.STATE_NORMAL,wt.Series)}initLabelMarkStyle(t){t&&(this._labelMark=t,t.setRule("treemap"),this.setMarkStyle(t,{x:e=>(e.x0+e.x1)/2,y:e=>(e.y0+e.y1)/2,text:e=>{var i;return(i=e.datum[e.depth])===null||i===void 0?void 0:i[this.getDimensionField()[0]]},maxLineWidth:e=>e.x1===e.x0?Number.MIN_VALUE:e.x1-e.x0},Rt.STATE_NORMAL,wt.Series),this._initRichStyleOfLabelMark(t))}initNonLeafLabelMarkStyle(t){t&&(this._nonLeafLabelMark=t,t.setRule("treemap"),this.setMarkStyle(t,{x:e=>e.labelRect?(e.labelRect.x0+e.labelRect.x1)/2:(e.x0+e.x1)/2,y:e=>e.labelRect?(e.labelRect.y0+e.labelRect.y1)/2:(e.y0+e.y1)/2,text:e=>{var i;return(i=e.datum[e.depth])===null||i===void 0?void 0:i[this.getDimensionField()[0]]},maxLineWidth:e=>e.x1===e.x0?Number.MIN_VALUE:e.x1-e.x0},Rt.STATE_NORMAL,wt.Series),this._initRichStyleOfLabelMark(t))}initAnimation(){this.getMarksInType("rect").forEach(t=>{var e;t.setAnimationConfig(Ae((e=q.getAnimationInKey("treemap"))===null||e===void 0?void 0:e(),Fe(t.name,this._spec,this._markAttributeContext)))})}initEvent(){super.initEvent(),this._spec.roam&&(this.initDragEventOfSeries(this),this.event.on("panmove",t=>{this.handlePan(t)}),this.initZoomEventOfSeries(this),this.event.on("zoom",t=>{this.handleZoom(t)})),this._spec.drill&&this.bindDrillEvent()}_getDataIdKey(){return"key"}initTooltip(){this._tooltipHelper=new t9t(this),this._leafMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._leafMark),this._nonLeafMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nonLeafMark)}_shouldFilterElement(t,e){const i=t.isLeaf;return e==="leaf"?!i:i}handlePan(t){const{delta:e}=t;if(e[0]===0&&e[1]===0)return;this._matrix.reset(),this._matrix.translate(e[0],e[1]);const{a:i,b:r,c:s,d:o,e:a,f:l}=this._matrix;this._matrix.multiply(i,r,s,o,a,l),this._viewBox.transformWithMatrix(this._matrix),this._runTreemapTransform(!0)}handleZoom(t){const{scale:e,scaleCenter:i}=t;if(e===1)return;this._matrix.reset();const{x:r,y:s}=i;this._matrix.translate(r,s),this._matrix.scale(e,e),this._matrix.translate(-r,-s);const{a:o,b:a,c:l,d:h,e:d,f:u}=this._matrix;this._matrix.multiply(o,a,l,h,d,u),this.disableMarkAnimation(),this.event.on(Lt.AFTER_DO_RENDER,this._enableAnimationHook),this._viewBox.transformWithMatrix(this._matrix),this._runTreemapTransform(!0)}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}onLayoutEnd(t){super.onLayoutEnd(t),this._viewBox.set(0,0,this.getLayoutRect().width,this.getLayoutRect().height),this._runTreemapTransform()}enableMarkAnimation(){this.getMarks().forEach(t=>{var e;(e=t.getProduct().animate)===null||e===void 0||e.enable()}),[this._labelMark,this._nonLeafLabelMark].forEach(t=>{t&&t.getComponent()&&t.getComponent().getProduct().getGroupGraphicItem().enableAnimation()}),this.event.off(Lt.AFTER_DO_RENDER,this._enableAnimationHook)}disableMarkAnimation(){this.getMarks().forEach(t=>{var e;(e=t.getProduct().animate)===null||e===void 0||e.disable()}),[this._labelMark,this._nonLeafLabelMark].forEach(t=>{t&&t.getComponent()&&t.getComponent().getProduct().getGroupGraphicItem().disableAnimation()})}getDefaultShapeType(){return"square"}getActiveMarks(){return[this._nonLeafMark,this._leafMark]}getMarkData(t){return t!=null&&t.datum?t.datum[t.datum.length-1]:t}}Ha.type=gt.treemap,Ha.mark=e9t,Ha.transformerConstructor=vrt,Ye(Ha,vH),Ye(Ha,lH);const r9t=()=>{GNt(),UNt(),_h(),_s(),n9t(),mh(),x7t(),q.registerSeries(Ha.type,Ha)},s9t=Object.assign(Object.assign({},cH),{segment:{name:"segment",type:"arc"},track:{name:"track",type:"arc"}}),o9t=Object.assign(Object.assign({},Hi),{pin:{name:"pin",type:"path"},pinBackground:{name:"pinBackground",type:"path"},pointer:{name:"pointer",type:["path","rect"]}}),a9t=n=>({channel:{angle:{from:n.startAngle+Math.PI/2}}}),l9t={type:"fadeIn"};function h9t(n,t){return t==="fadeIn"?l9t:a9t(n)}const d9t=()=>{q.registerAnimation("gaugePointer",(n,t)=>{const e=h9t(n,t);return{appear:e,enter:e,disappear:{type:"fadeOut"}}})};class _rt extends Ar{constructor(){super(...arguments),this._supportStack=!1}}class u9t extends wr{enableByType(t){return t!=="dimension"}}class Kl extends qf{constructor(){super(...arguments),this.type=gt.gaugePointer,this.transformerConstructor=_rt,this._pinMark=null,this._pointerMark=null,this._pinBackgroundMark=null}setAttrFromSpec(){var t;super.setAttrFromSpec(),this.setRadiusField(this._spec.radiusField),this._pointerType=((t=this._spec.pointer)===null||t===void 0?void 0:t.type)==="rect"?"rect":"path"}initMark(){this._pinBackgroundMark=this._createMark(Kl.mark.pinBackground),this._pointerMark=this._createMark(Object.assign(Object.assign({},Kl.mark.pointer),{type:this._pointerType}),{isSeriesMark:!0}),this._pinMark=this._createMark(Kl.mark.pin)}initMarkStyle(){this.initPinBackgroundMarkStyle(),this.initPointerMarkStyle(),this.initPinMarkStyle()}initGroups(){}initPointerMarkStyle(){const t=this._pointerMark,e=this._spec.pointer;t&&(this.setMarkStyle(t,{x:i=>{var r,s;const{x:o}=this._getPointerAnchor(i,e);return o-this._getPointerWidth()*((s=(r=e==null?void 0:e.center)===null||r===void 0?void 0:r[0])!==null&&s!==void 0?s:0)},y:i=>{var r,s;const{y:o}=this._getPointerAnchor(i,e);return o-this._getPointerHeight(i)*((s=(r=e==null?void 0:e.center)===null||r===void 0?void 0:r[1])!==null&&s!==void 0?s:0)},anchor:i=>{const{x:r,y:s}=this._getPointerAnchor(i,e);return[r,s]},fill:this.getColorAttribute(),zIndex:200}),this._pointerType==="path"?this.setMarkStyle(t,{scaleX:this._getPointerWidth.bind(this),scaleY:this._getPointerHeight.bind(this),angle:i=>this._getPointerAngle(i)+Math.PI/2}):this.setMarkStyle(t,{width:this._getPointerWidth.bind(this),height:this._getPointerHeight.bind(this),angle:i=>this._getPointerAngle(i)-Math.PI/2}))}initTooltip(){this._tooltipHelper=new u9t(this),this._pointerMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._pointerMark)}_getPointerAnchor(t,e){var i;return(i=e.isOnCenter)===null||i===void 0||i?this.angleAxisHelper.center():this.radiusAxisHelper.coordToPoint({radius:this._innerRadius*this._computeLayoutRadius(),angle:this.angleAxisHelper.dataToPosition([t[this._angleField[0]]])})}_getPointerWidth(){return this._spec.pointer.width*this._computeLayoutRadius()}_getPointerHeight(t){var e,i;const r=this._spec.pointer,s=this._radiusField[0];return L(this.radiusAxisHelper)&&L(s)?this.radiusAxisHelper.dataToPosition([t[s]])-((e=r==null?void 0:r.innerPadding)!==null&&e!==void 0?e:0)-((i=r==null?void 0:r.outerPadding)!==null&&i!==void 0?i:10):r.height*this._computeLayoutRadius()}_getPointerAngle(t){const e=this.angleAxisHelper.getScale().domain(),i=Mi(e),r=Ri(e),s=Ne(t[this._angleField[0]],r,i);return this.angleAxisHelper.dataToPosition([s])}_getRotatedPointerCenterOffset(t){var e,i,r,s;const o=this._spec.pointer,a=this._getPointerWidth()*((i=(e=o==null?void 0:o.center)===null||e===void 0?void 0:e[0])!==null&&i!==void 0?i:0),l=-this._getPointerHeight(t)*((s=(r=o==null?void 0:o.center)===null||r===void 0?void 0:r[1])!==null&&s!==void 0?s:0),h=this._getPointerAngle(t)-Math.PI/2,d=Math.cos(h),u=Math.sin(h);return{x:a*d+l*u,y:-(l*d-a*u)}}initPinBackgroundMarkStyle(){const t=this._pinBackgroundMark,e=this._spec.pinBackground;t&&this.setMarkStyle(t,{x:i=>this._getPointerAnchor(i,e).x,y:i=>this._getPointerAnchor(i,e).y,scaleX:()=>e.width*this._computeLayoutRadius(),scaleY:()=>e.height*this._computeLayoutRadius(),fill:this.getColorAttribute(),zIndex:100})}initPinMarkStyle(){const t=this._pinMark,e=this._spec.pin;t&&this.setMarkStyle(t,{x:i=>this._getPointerAnchor(i,e).x,y:i=>this._getPointerAnchor(i,e).y,scaleX:()=>e.width*this._computeLayoutRadius(),scaleY:()=>e.height*this._computeLayoutRadius(),fill:this.getColorAttribute(),zIndex:300})}initInteraction(){this._parseInteractionConfig(this._pointerMark?[this._pointerMark]:[])}initAnimation(){var t,e,i;const r=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._pointerMark.setAnimationConfig(Ae((i=q.getAnimationInKey("gaugePointer"))===null||i===void 0?void 0:i({startAngle:this._startAngle},r),Fe("pointer",this._spec,this._markAttributeContext)))}getDefaultShapeType(){return"circle"}getActiveMarks(){return[]}}Kl.type=gt.gaugePointer,Kl.mark=o9t,Kl.transformerConstructor=_rt;const c9t=()=>{q.registerSeries(Kl.type,Kl),aH(),_h(),d9t(),Ib(),Kf()};class brt extends Ar{constructor(){super(...arguments),this._supportStack=!1}_transformLabelSpec(t){this._addMarkLabelSpec(t,"segment")}}class wd extends qf{constructor(){super(...arguments),this.type=gt.gauge,this.transformerConstructor=brt,this._segmentMark=null,this._trackMark=null,this._padAngle=0}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._padAngle=Te((t=this._spec.padAngle)!==null&&t!==void 0?t:0)}initData(){var t;super.initData(),Vt(this._option.dataSet,"spiltSegment",(e,i)=>{const r=e.slice();return r.sort((s,o)=>s[this._angleField[0]]-o[this._angleField[0]]),r.forEach((s,o)=>{s[XB]=s[this._angleField[0]],s[HC]=o>0?r[o-1][XB]:void 0}),r}),(t=this.getViewData())===null||t===void 0||t.transform({type:"spiltSegment"},!1)}initMark(){super.initMark(),this._trackMark=this._createMark(wd.mark.track,{parent:this._arcGroupMark,dataView:!1}),this._segmentMark=this._createMark(wd.mark.segment,{parent:this._arcGroupMark,isSeriesMark:!0})}initMarkStyle(){super.initMarkStyle(),this.initTrackMarkStyle(),this.initSegmentMarkStyle()}initSegmentMarkStyle(){var t;const e=this._segmentMark;e&&this.setMarkStyle(e,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._getAngleValueStart.bind(this),endAngle:this._getAngleValueEnd.bind(this),innerRadius:()=>{var i;return this._computeLayoutRadius()*((i=this._spec.innerRadius)!==null&&i!==void 0?i:0)},outerRadius:()=>{var i,r;return this._computeLayoutRadius()*((r=(i=this._spec.radius)!==null&&i!==void 0?i:this._spec.outerRadius)!==null&&r!==void 0?r:1)},cap:(t=this._spec.roundCap)!==null&&t!==void 0&&t,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,fill:this.getColorAttribute(),zIndex:200,forceShowCap:!0})}generateRadiusStyle(t){if(!t)return;const e={};return t.outerRadius&&(e.outerRadius=()=>this._computeLayoutRadius()*t.outerRadius),t.innerRadius&&(e.innerRadius=()=>this._computeLayoutRadius()*t.innerRadius),e}initMarkStyleWithSpec(t,e,i){if(super.initMarkStyleWithSpec(t,e,i),t&&t.name==="segment"){const r=this.getSpec().segment;if(r)for(const s in r.state||{})this.setMarkStyle(t,this.generateRadiusStyle(r.state[s]),s,wt.User_Mark)}}initTooltip(){super.initTooltip(),this._segmentMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._segmentMark)}initTrackMarkStyle(){var t;const e=this._trackMark;e&&this.setMarkStyle(e,{x:()=>this.angleAxisHelper.center().x,y:()=>this.angleAxisHelper.center().y,startAngle:this._startAngle,endAngle:this._endAngle,innerRadius:()=>{var i;return this._computeLayoutRadius()*((i=this._spec.innerRadius)!==null&&i!==void 0?i:0)},outerRadius:()=>{var i,r;return this._computeLayoutRadius()*((r=(i=this._spec.radius)!==null&&i!==void 0?i:this._spec.outerRadius)!==null&&r!==void 0?r:1)},cap:(t=this._spec.roundCap)!==null&&t!==void 0&&t,boundsMode:"imprecise",cornerRadius:this._spec.cornerRadius,zIndex:100})}_getAngleValueStartWithoutMask(t){const e=this._getAngleValueStartWithoutPadAngle(t),i=this._getAngleValueEndWithoutPadAngle(t),r=gc(e,(e+i)/2)(e+(i>e?1:-1)*Math.abs(this._padAngle/2));return this._spec.clamp?je(r,this.angleAxisHelper.getScale(0)):r}_getAngleValueEndWithoutMask(t){const e=this._getAngleValueStartWithoutPadAngle(t),i=this._getAngleValueEndWithoutPadAngle(t),r=gc(i,(e+i)/2)(i-(i>e?1:-1)*Math.abs(this._padAngle/2));return this._spec.clamp?je(r,this.angleAxisHelper.getScale(0)):r}_getAngleValueStartWithoutPadAngle(t){return L(t[HC])?this.angleAxisHelper.dataToPosition([t[HC]]):this._startAngle}_getAngleValueEndWithoutPadAngle(t){return this.angleAxisHelper.dataToPosition([t[XB]])}initAnimation(){var t,e,i;const r=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset;this._segmentMark.setAnimationConfig(Ae((i=q.getAnimationInKey("circularProgress"))===null||i===void 0?void 0:i({startAngle:this._startAngle},r),Fe("segment",this._spec,this._markAttributeContext)))}getDefaultShapeType(){return"circle"}getActiveMarks(){return[]}}wd.type=gt.gauge,wd.mark=s9t,wd.transformerConstructor=brt;const g9t=()=>{q.registerSeries(wd.type,wd),eg(),Ynt(),Kf()};class $0 extends hnt{constructor(){super(...arguments),this.type=$0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{padding:0})}}$0.type="cell";const p9t=()=>{q.registerMark($0.type,$0),oNt(),lVt()};function f9t(n){return n===!1?{}:{type:"fadeIn"}}const m9t=()=>{q.registerAnimation("heatmap",(n,t)=>Object.assign(Object.assign({},DT),{appear:f9t(t)}))};class v9t extends wr{enableByType(t){return t!=="dimension"}}const _9t=Object.assign(Object.assign({},Hi),{cell:{name:"cell",type:"cell"},cellBackground:{name:"cellBackground",type:"cell"}});class yrt extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"cell")}}class ql extends Po{constructor(){super(...arguments),this.type=gt.heatmap,this.transformerConstructor=yrt}getFieldValue(){return this._fieldValue}setFieldValue(t){this._fieldValue=Q(t)}setAttrFromSpec(){super.setAttrFromSpec(),this.setFieldValue(this._spec.valueField)}initMark(){var t,e,i,r;const s={progressiveStep:this._spec.progressiveStep,progressiveThreshold:this._spec.progressiveThreshold,large:this._spec.large,largeThreshold:this._spec.largeThreshold};this._cellMark=this._createMark(ql.mark.cell,{isSeriesMark:!0,stateSort:(t=this._spec.cell)===null||t===void 0?void 0:t.stateSort},Object.assign(Object.assign({},s),{setCustomizedShape:(e=this._spec.cell)===null||e===void 0?void 0:e.customShape,morph:ll(this._spec,ql.mark.cell.name),morphElementKey:this.getDimensionField()[0]})),this._backgroundMark=this._createMark(ql.mark.cellBackground,{stateSort:(i=this._spec.cellBackground)===null||i===void 0?void 0:i.stateSort},Object.assign(Object.assign({},s),{setCustomizedShape:(r=this._spec.cellBackground)===null||r===void 0?void 0:r.customShape}))}initMarkStyle(){this.initCellMarkStyle(),this.initCellBackgroundMarkStyle()}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this.getMeasureField()[0]]})}initCellMarkStyle(){this.setMarkStyle(this._cellMark,{x:t=>this.dataToPositionX(t),y:t=>this.dataToPositionY(t),size:()=>[this.getCellSize(this._xAxisHelper),this.getCellSize(this._yAxisHelper)],fill:this.getColorAttribute()},"normal",wt.Series)}initCellBackgroundMarkStyle(){var t,e,i;const r=Fi((i=(e=(t=this._spec.cellBackground)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.padding)!==null&&i!==void 0?i:0);this.setMarkStyle(this._backgroundMark,{x:s=>{const o=this.getCellSize(this._xAxisHelper);return this.dataToPositionX(s)-o/2+r[3]},y:s=>{const o=this.getCellSize(this._yAxisHelper);return this.dataToPositionY(s)-o/2+r[0]},width:()=>this.getCellSize(this._xAxisHelper)-r[1]-r[3],height:()=>this.getCellSize(this._yAxisHelper)-r[0]-r[2]},"normal",wt.Series)}getColorAttribute(){var t;return{scale:(t=this._option.globalScale.getScale("color"))!==null&&t!==void 0?t:this._getDefaultColorScale(),field:this.getFieldValue[0]}}initInteraction(){this._parseInteractionConfig(this._cellMark?[this._cellMark]:[])}initAnimation(){var t,e,i;const r=(e=(t=this._spec)===null||t===void 0?void 0:t.animationAppear)===null||e===void 0?void 0:e.preset,s=Qd(this);this._cellMark.setAnimationConfig(Ae((i=q.getAnimationInKey("heatmap"))===null||i===void 0?void 0:i(r),Fe("cell",this._spec,this._markAttributeContext),s))}getCellSize(t){var e,i;return(i=(e=t.getBandwidth)===null||e===void 0?void 0:e.call(t,0))!==null&&i!==void 0?i:6}initTooltip(){this._tooltipHelper=new v9t(this),this._cellMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._cellMark)}getDefaultShapeType(){return"square"}getDimensionField(){return[].concat(this.fieldX,this.fieldY)}getMeasureField(){return this.getFieldValue()}getActiveMarks(){return[this._cellMark]}}ql.type=gt.heatmap,ql.mark=_9t,ql.transformerConstructor=yrt;const b9t=()=>{_s(),p9t(),m9t(),vs(),ms(),q.registerSeries(ql.type,ql)},y9t=Object.assign(Object.assign({},Hi),{nodePoint:{name:"nodePoint",type:"symbol"},ripplePoint:{name:"ripplePoint",type:"ripple"},centerPoint:{name:"centerPoint",type:"symbol"},centerLabel:{name:"centerLabel",type:"text"}}),Crt=`${Wt}_CORRELATION_X`,Srt=`${Wt}_CORRELATION_Y`,xrt=`${Wt}_CORRELATION_SIZE`,C9t=(n,t)=>{var e,i,r,s,o,a,l,h,d,u,c,g,p,f,m;if(!n||!(t!=null&&t.view)||!V(n))return n;const v=t.view();if(v.x1-v.x0==0||v.y1-v.y0==0||v.x1-v.x0==-1/0||v.x1-v.x0==1/0||v.y1-v.y0==-1/0||v.y1-v.y0==1/0)return n;const _=Te((e=t.startAngle)!==null&&e!==void 0?e:-90),b=Te((i=t.endAngle)!==null&&i!==void 0?i:270),y=Math.max((v.x1-v.x0)/2,(v.y1-v.y0)/2),C=Wo((r=t.innerRadius)!==null&&r!==void 0?r:0,y),S=Wo(t.outerRadius,y),w=[J((s=t.center)===null||s===void 0?void 0:s[0])?t.center[0]:v.x0+Wo((a=(o=t.center)===null||o===void 0?void 0:o[0])!==null&&a!==void 0?a:"50%",v.x1-v.x0),J((l=t.center)===null||l===void 0?void 0:l[1])?t.center[1]:v.y0+Wo((d=(h=t.center)===null||h===void 0?void 0:h[1])!==null&&d!==void 0?d:"50%",v.y1-v.y0)],x=Za(t.field),A=n.map(x),[M,T]=S4(A),R=M===T?F=>(C+S)/2:F=>C+(S-C)*(F-M)/(T-M),B=D(t.radiusField)?x:Za(t.radiusField),E=(c=(u=t==null?void 0:t.radiusRange)===null||u===void 0?void 0:u[1])!==null&&c!==void 0?c:5;let k=F=>E;if(B){const[F,j]=B!==x?S4(n.map(B)):[M,T],$=(p=(g=t.radiusRange)===null||g===void 0?void 0:g[0])!==null&&p!==void 0?p:5,Y=(m=(f=t.radiusRange)===null||f===void 0?void 0:f[1])!==null&&m!==void 0?m:5;F!==j&&(k=G=>$+(Y-$)*(B(G)-F)/(j-F))}const P=Math.min(_,b),I=Math.max(_,b),O=S9t(P,I,n.length),H=[],z=(I-P)/60;return n.forEach((F,j)=>{const $=R(A[j]),Y=k(F);let G,tt,st=O[j];for(let ot=0;ot<60&&(G=w[0]+$*Math.cos(st),tt=w[1]+$*Math.sin(st),x9t({x:G,y:tt,size:Y},H)||G-Y<v.x0||G+Y>v.x1||tt-Y<v.y0||tt+Y>v.y1);ot++)ot<59&&(st+=z,st>I?st=P:st<P&&(st=I));H.push(Object.assign({[Crt]:G,[Srt]:tt,[xrt]:Y},F))}),H},S9t=(n,t,e)=>{let i=0,r=Math.max(Math.ceil(2*(t-n)/Math.PI),2),s=(t-n)/r,o=0,a=1,l=0,h=0;const d=[];let u=n;for(;l<e;)h<r&&(d.push(u+(h%2?Math.floor(h/2)+Math.floor(r/2):h/2)*s*a),h++),l++,h===r&&(h=0,o+=1,a*=-1,i===0?i=s/2:i/=2,u=a===-1?t-i:n+i,o>=2&&(s/=2,r*=2));return d},x9t=(n,t)=>!(!t||!t.length)&&t.some(e=>Math.pow(n.x-e.x,2)+Math.pow(n.y-e.y,2)<Math.pow(n.size+e.size,2)),w9t=(n,t)=>{if(!n||!V(n))return[];const{keyword:e,categoryField:i}=t,r=n[0].latestData[0];return{[i]:e,[rr]:r==null?void 0:r[rr],[Fr]:r==null?void 0:r[Fr]}};class V0 extends sr{constructor(){super(...arguments),this.type=V0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{x:0,y:0,ripple:0})}_initProduct(t){const e=this.getVGrammarView(),i=this.getProductId();this._product=e.glyph("ripplePoint",t??e.rootMark).id(i),this._compiledProductId=i}}V0.type="ripple";const wrt=()=>{q.registerMark(V0.type,V0),mNt()},A9t=(n,t)=>t==="fadeIn"?{type:"fadeIn"}:{type:"scaleIn"},M9t=()=>{q.registerAnimation("correlation",(n,t)=>Object.assign({appear:A9t(0,t)},QF))};class Art extends Ar{_transformLabelSpec(t){this._addMarkLabelSpec(t,"nodePoint"),this._addMarkLabelSpec(t,"centerPoint","centerLabel")}}class Zl extends Lb{constructor(){super(...arguments),this.type=gt.correlation,this.transformerConstructor=Art,this._viewBox=new Bi}getCategoryField(){return this._categoryField}setCategoryField(t){return this._categoryField=t,this._categoryField}getValueField(){return this._valueField}setValueField(t){return this._valueField=t,this._valueField}getSeriesField(){return this._seriesField}setSeriesField(t){L(t)&&(this._seriesField=t)}getSizeField(){return this._sizeField}setSizeField(t){L(t)&&(this._sizeField=t)}getSizeRange(){return this._sizeRange}setSizeRange(t){L(t)&&(this._sizeRange=t)}setAttrFromSpec(){super.setAttrFromSpec(),this.setCategoryField(this._spec.categoryField),this.setValueField(this._spec.valueField),this.setSeriesField(this._spec.seriesField),this.setSizeField(this._spec.sizeField),this.setSizeRange(this._spec.sizeRange)}initData(){var t,e,i;if(super.initData(),!this._data)return;Vt(this._dataSet,"correlation",C9t);const r=new Bd;Xl(r,"dataview",LM),Vt(r,"correlationCenter",w9t);const s=new Ve(r,{name:`${this.type}_${this.id}_center`});s.parse([this.getViewData()],{type:"dataview"}),s.transform({type:"correlationCenter",options:{keyword:(i=(e=(t=this._spec.centerLabel)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.text)!==null&&i!==void 0?i:"",categoryField:this._spec.categoryField}}),this._centerSeriesData=new tl(this._option,s)}compileData(){var t;super.compileData(),(t=this._centerSeriesData)===null||t===void 0||t.compile()}_statisticViewData(){super._statisticViewData(),this._data.getDataView().transform({type:"correlation",options:{view:()=>({x0:this._viewBox.x1,x1:this._viewBox.x2,y0:this._viewBox.y1,y1:this._viewBox.y2}),field:this._spec.valueField,radiusRange:this._spec.sizeRange,radiusField:this._spec.sizeField,center:[this._spec.centerX,this._spec.centerY],innerRadius:this._spec.innerRadius,outerRadius:this._spec.outerRadius,startAngle:this._spec.startAngle,endAngle:this._spec.endAngle}})}initMark(){var t,e,i,r;const s=this._createMark(Zl.mark.nodePoint,{groupKey:this._seriesField,isSeriesMark:!0,key:rr,stateSort:(t=this._spec.nodePoint)===null||t===void 0?void 0:t.stateSort},{setCustomizedShape:(e=this._spec.nodePoint)===null||e===void 0?void 0:e.customShape});s&&(s.setMarkConfig({zIndex:Qe.Node}),this._nodePointMark=s);const o=this._createMark(Zl.mark.ripplePoint,{key:rr,dataView:this._centerSeriesData.getDataView(),dataProductId:this._centerSeriesData.getProductId()});o&&(this._ripplePointMark=o);const a=this._createMark(Zl.mark.centerPoint,{key:rr,dataView:this._centerSeriesData.getDataView(),dataProductId:this._centerSeriesData.getProductId(),stateSort:(i=this._spec.centerPoint)===null||i===void 0?void 0:i.stateSort},{setCustomizedShape:(r=this._spec.centerPoint)===null||r===void 0?void 0:r.customShape});a&&(a.setMarkConfig({zIndex:Qe.Node}),this._centerPointMark=a)}initMarkStyle(){this._initNodePointMarkStyle(),this._initRipplePointMarkStyle(),this._initCenterPointMarkStyle()}_initNodePointMarkStyle(){var t,e,i,r;const s=this._nodePointMark;if(!s)return;const o=(e=(t=this._spec.nodePoint)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{};this.setMarkStyle(s,{x:a=>a[Crt],y:a=>a[Srt],size:a=>a[xrt],fill:(i=o.fill)!==null&&i!==void 0?i:this.getColorAttribute(),fillOpacity:(r=o.fillOpacity)!==null&&r!==void 0?r:1,lineWidth:0},Rt.STATE_NORMAL,wt.Series)}_initRipplePointMarkStyle(){var t,e,i,r,s;const o=this._ripplePointMark;if(!o)return;const a=(e=(t=this._spec.ripplePoint)===null||t===void 0?void 0:t.style)!==null&&e!==void 0?e:{};this.setMarkStyle(o,{x:()=>{var l;return(l=this._spec.centerX)!==null&&l!==void 0?l:(this._viewBox.x1+this._viewBox.x2)/2},y:()=>{var l;return(l=this._spec.centerY)!==null&&l!==void 0?l:(this._viewBox.y1+this._viewBox.y2)/2},size:()=>Math.max(this._viewBox.x2-this._viewBox.x1,this._viewBox.y2-this._viewBox.y1)/2,fill:(i=a.fill)!==null&&i!==void 0?i:this.getColorAttribute(),opacity:(r=a.fillOpacity)!==null&&r!==void 0?r:.2,ripple:(s=a.ripple)!==null&&s!==void 0?s:0},Rt.STATE_NORMAL,wt.Series)}_initCenterPointMarkStyle(){var t,e,i,r,s,o;const a=this._centerPointMark;a&&this.setMarkStyle(a,{x:()=>{var l;return(l=this._spec.centerX)!==null&&l!==void 0?l:(this._viewBox.x1+this._viewBox.x2)/2},y:()=>{var l;return(l=this._spec.centerY)!==null&&l!==void 0?l:(this._viewBox.y1+this._viewBox.y2)/2},size:()=>.2*Math.max(this._viewBox.x2-this._viewBox.x1,this._viewBox.y2-this._viewBox.y1)/2,fill:(i=(e=(t=this._spec.centerPoint)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.fill)!==null&&i!==void 0?i:this.getColorAttribute(),fillOpacity:(o=(s=(r=this._spec.centerPoint)===null||r===void 0?void 0:r.style)===null||s===void 0?void 0:s.fillOpacity)!==null&&o!==void 0?o:1},Rt.STATE_NORMAL,wt.Series)}initTooltip(){super.initTooltip(),this._nodePointMark&&this._tooltipHelper.activeTriggerSet.mark.add(this._nodePointMark)}initLabelMarkStyle(t){t&&this.setMarkStyle(t,{fill:this.getColorAttribute(),text:e=>e[this._categoryField],z:this.dataToPositionZ.bind(this)},Rt.STATE_NORMAL,wt.Series)}initAnimation(){var t,e;const i=(t=this._spec.animationAppear)===null||t===void 0?void 0:t.preset;this._nodePointMark.setAnimationConfig(Ae((e=q.getAnimationInKey("correlation"))===null||e===void 0?void 0:e({},i),Fe("nodePoint",this._spec,this._markAttributeContext)))}getGroupFields(){return[]}getStackGroupFields(){return[]}getStackValueField(){return""}getActiveMarks(){return[this._nodePointMark,this._centerPointMark]}getDimensionField(){return[this._categoryField]}getMeasureField(){return[this._valueField]}onLayoutEnd(t){super.onLayoutEnd(t),this._viewBox.set(0,0,this._region.getLayoutRect().width,this._region.getLayoutRect().height),this._rawData.reRunAllTransform(),this.getViewData().reRunAllTransform()}}Zl.type=gt.correlation,Zl.mark=y9t,Zl.transformerConstructor=Art;const T9t=()=>{vh(),wrt(),q.registerSeries(Zl.type,Zl),M9t()};class Mrt extends Eo{_isValidSeries(t){return t===gt.map}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["type","nameField","valueField","map","nameProperty","centroidProperty","nameMap","area","defaultFillColor","showDefaultName"])}transformSpec(t){super.transformSpec(t),t.region.forEach(e=>{e.coordinate="geo"}),super.transformSeriesSpec(t)}}class qv extends Pi{constructor(){super(...arguments),this.transformerConstructor=Mrt,this.type="map",this.seriesType=gt.map}}qv.type="map",qv.seriesType=gt.map,qv.transformerConstructor=Mrt;const k9t=()=>{d6t(),q.registerChart(qv.type,qv)};class bH extends Eo{_isValidSeries(t){return!this.seriesType||t===this.seriesType}getIndicatorSpec(t){var e,i,r;const s=Q(t.indicator),o=(e=t.innerRadius)!==null&&e!==void 0?e:(r=(i=t.series)===null||i===void 0?void 0:i[0])===null||r===void 0?void 0:r.innerRadius;return L(o)&&s.forEach(a=>{D(a.limitRatio)&&(a.limitRatio=o)}),s}_getDefaultSeriesSpec(t,e){return super._getDefaultSeriesSpec(t,["radius","outerRadius","innerRadius","startAngle","endAngle","sortDataByAxis"],e)}transformSpec(t){super.transformSpec(t),V(t.dataZoom)&&t.dataZoom.length>0&&t.dataZoom.forEach(e=>{e.filterMode==="axis"&&(e.filterMode="filter")}),this.transformSeriesSpec(t),L(t.indicator)&&(t.indicator=this.getIndicatorSpec(t))}}class Trt extends bH{needAxes(){return!1}_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t,["startAngle","endAngle","centerX","centerY"]);return e.categoryField=t.categoryField||t.radiusField,e.valueField=t.valueField||t.angleField,e}_transformProgressAxisSpec(t,e,i,r,s){var o,a;t.axes||(t.axes=[]);let l=((o=t.axes)!==null&&o!==void 0?o:[]).find(u=>u.orient==="radius"),h=((a=t.axes)!==null&&a!==void 0?a:[]).find(u=>u.orient==="angle");h||(h=e,t.axes.push(h)),l||(l=i,t.axes.push(l)),D(h.type)&&(h.type="linear"),D(l.type)&&(l.type="band");const d=T0(h,{min:0,max:1});D(h.min)&&(h.min=d.min),D(h.max)&&(h.max=d.max),r&&Object.assign(h,Nt({},r,h)),s&&Object.assign(l,Nt({},s,l))}}class krt extends bH{needAxes(){return!0}_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return e.categoryField=t.categoryField||t.angleField,e.valueField=t.valueField||t.radiusField,e}transformSpec(t){var e;if(super.transformSpec(t),this.needAxes()){t.axes||(t.axes=[]);const i={radius:!1,angle:!1};((e=t.axes)!==null&&e!==void 0?e:[]).forEach(r=>{const{orient:s}=r;s==="radius"&&(i.radius=!0),s==="angle"&&(i.angle=!0)}),i.angle||t.axes.push({orient:"angle"}),i.radius||t.axes.push({orient:"radius"})}}}class Fb extends bH{needAxes(){return!1}_getDefaultSeriesSpec(t){var e;const i=super._getDefaultSeriesSpec(t,["center","centerOffset","cornerRadius","padAngle","minAngle","emptyPlaceholder","showAllZero","supportNegative","layoutRadius"]);return i.categoryField=t.categoryField||t.seriesField,i.valueField=t.valueField||t.angleField,i.emptyCircle=(e=t.emptyPlaceholder)===null||e===void 0?void 0:e.emptyCircle,i}}class yH extends Pi{constructor(){super(...arguments),this.transformerConstructor=Fb}}yH.transformerConstructor=Fb;class Zv extends yH{constructor(){super(...arguments),this.transformerConstructor=Fb,this.type="pie",this.seriesType=gt.pie}}Zv.type="pie",Zv.seriesType=gt.pie,Zv.transformerConstructor=Fb;const R9t=()=>{gUt(),q.registerChart(Zv.type,Zv)};class Rrt extends Fb{transformSpec(t){super.transformSpec(t),t.series.forEach(e=>{e.type==="pie3d"&&(e.angle3d=t.angle3d)})}}class Jv extends yH{constructor(){super(...arguments),this.transformerConstructor=Rrt,this.type="pie3d",this.seriesType=gt.pie3d}}Jv.type="pie3d",Jv.seriesType=gt.pie3d,Jv.transformerConstructor=Rrt;const B9t=()=>{Dd(),pUt(),q.registerChart(Jv.type,Jv)};class Brt extends krt{_getDefaultSeriesSpec(t){var e,i,r;const s=super._getDefaultSeriesSpec(t);return s.radius=(e=t.radius)!==null&&e!==void 0?e:Uw,s.outerRadius=(i=t.outerRadius)!==null&&i!==void 0?i:Uw,s.innerRadius=(r=t.innerRadius)!==null&&r!==void 0?r:0,s.stack=t.stack,s.percent=t.percent,s}transformSpec(t){var e;super.transformSpec(t),((e=t.axes)!==null&&e!==void 0?e:[]).forEach(i=>{["domainLine","grid","label","tick"].forEach(r=>{i[r]||(i[r]={visible:!1})}),i.orient==="angle"&&D(i.bandPosition)&&(i.bandPosition=.5)}),t.crosshair=Q(t.crosshair||{}).map(i=>Nt({categoryField:{visible:!0,line:{visible:!0,type:"rect"}}},i))}}class ap extends Pi{constructor(){super(...arguments),this.transformerConstructor=Brt,this.type="rose",this.seriesType=gt.rose}}ap.type="rose",ap.seriesType=gt.rose,ap.transformerConstructor=Brt,Ye(ap,hl);const P9t=()=>{SUt(),q.registerChart(ap.type,ap)};class Prt extends krt{_getDefaultSeriesSpec(t){var e;const i=super._getDefaultSeriesSpec(t);return i.line=t.line,i.point=t.point,i.stack=t.stack,i.percent=t.percent,i.area=Nt({visible:!1},t.area),i.seriesMark=(e=t.seriesMark)!==null&&e!==void 0?e:"area",i.activePoint=t.activePoint,i.pointDis=t.pointDis,i.pointDisMul=t.pointDisMul,i.markOverlap=t.markOverlap,i}transformSpec(t){var e;super.transformSpec(t),((e=t.axes)!==null&&e!==void 0?e:[]).forEach(i=>{i.orient==="radius"&&(["domainLine","label","tick"].forEach(r=>{i[r]||(i[r]={visible:!1})}),i.grid||(i.grid={visible:!0}))}),t.crosshair=Q(t.crosshair||{}).map(i=>Nt({categoryField:{visible:!0,line:{visible:!0,type:"line"}}},i))}}class lp extends Pi{constructor(){super(...arguments),this.transformerConstructor=Prt,this.type="radar",this.seriesType=gt.radar}}lp.type="radar",lp.seriesType=gt.radar,lp.transformerConstructor=Prt,Ye(lp,hl);const E9t=()=>{RUt(),q.registerChart(lp.type,lp)};class Ert extends Eo{_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return delete e.data,e}_transformAxisSpec(t){t.axes&&t.autoBandSize&&t.series.forEach((e,i)=>{var r;if(e.type==="bar"){const s=this._findBandAxisBySeries(e,i,t.axes);if(s&&!s.bandSize&&!s.maxBandSize&&!s.minBandSize){const o=kt(e.autoBandSize)&&(r=e.autoBandSize.extend)!==null&&r!==void 0?r:0,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d}=e;this._applyAxisBandSize(s,o,{barMaxWidth:a,barMinWidth:l,barWidth:h,barGapInGroup:d})}}})}transformSpec(t){if(super.transformSpec(t),t.series&&t.series.length){const e=this._getDefaultSeriesSpec(t);t.series.forEach(i=>{this._isValidSeries(i.type)&&Object.keys(e).forEach(r=>{r in i||(i[r]=e[r])})})}t.axes&&t.axes.length&&t.axes.forEach(e=>{Dt(e,"trimPadding")&&Nt(e,jit(this.type,t))}),this._transformAxisSpec(t)}}class Qv extends Pi{constructor(){super(...arguments),this.transformerConstructor=Ert,this.type="common"}}Qv.type="common",Qv.transformerConstructor=Ert,Ye(Qv,hl);const L9t=()=>{q.registerChart(Qv.type,Qv)},VI=12;class Lrt extends Eo{_getSeriesDataLength(t,e){var i,r;if(e.data){const o=Q(e.data)[0];return o instanceof Ve?(i=o.latestData)===null||i===void 0?void 0:i.length:(r=o.values)===null||r===void 0?void 0:r.length}const s=Q(t.data).find((o,a)=>e.dataId?o instanceof Ve?o.name===e.dataId:o.id===e.dataId:e.dataIndex===a);return s?s instanceof Ve?s.latestData.length:s.values.length:0}addAttrToComponentSpec(t,e,i){return Array.isArray(t)?t[0][e]=i:t[e]=i,t}addPaddingRow(t,e,i){t.push({index:e,size:i})}addOrientAxes(t,e,i,r){t.push({id:`regionAxesRow${i}`}),e.push({modelId:`axesRow${i}`,col:1,row:i}),r.axes[0].id=`axesRow${i}`,r.axes[0].regionIndex=Array.from(Array(r.series.length),(s,o)=>r.axes[0].orient==="top"?o+1:o)}transformSpec(t){var e,i,r,s,o,a,l,h,d,u,c,g,p,f,m;super.transformSpec(t);let v=0;const _=[],b=[],y=[],C=[],S=[],w=(this._option.getCompiler().getVGrammarView().width(),this._option.getCompiler().getVGrammarView().height());let x=0;if(t!=null&&t.legends){_.push({modelId:`legendRow${v}`,col:1,row:v}),this.addAttrToComponentSpec(t.legends,"id",`legendRow${v}`);const E=Q(t.legends);let k=(e=E[0].height)!==null&&e!==void 0?e:40;if(E[0].padding){const P=Id(E[0].padding);k+=Number((i=P==null?void 0:P.bottom)!==null&&i!==void 0?i:0),k+=Number((r=P==null?void 0:P.top)!==null&&r!==void 0?r:0),E[0].offsetY=Number((o=(s=E[0])===null||s===void 0?void 0:s.offsetY)!==null&&o!==void 0?o:0)+Number((a=P==null?void 0:P.top)!==null&&a!==void 0?a:0)}S.push({index:v,size:k}),x+=k,v++}t!=null&&t.dataZoom&&(_.push({modelId:`dataZoomRow${v}`,col:1,row:v}),this.addAttrToComponentSpec(t.dataZoom,"id",`dataZoomRow${v}`),x+=60,v++,this.addPaddingRow(S,v,10),x+=10,v++),x+=60,t.axes!==null&&((h=(l=t==null?void 0:t.axes)===null||l===void 0?void 0:l[0])===null||h===void 0?void 0:h.orient)!=="top"||(this.addOrientAxes(b,_,v,t),v++);const A=t.series.filter(E=>E.type!==gt.link).length,M=(w-x-20*A)/A,T=((d=t==null?void 0:t.appendPadding)===null||d===void 0?void 0:d.left)||0,R=((u=t==null?void 0:t.appendPadding)===null||u===void 0?void 0:u.right)||0;(c=t==null?void 0:t.series)===null||c===void 0||c.forEach(E=>{var k,P;if([gt.bar,gt.line,gt.area,gt.dot].includes(E.type)){if(_.push({modelId:`${E.type}Row${v}`,col:1,row:v}),_.push({modelId:`axesLeftRow${v}`,col:0,row:v}),b.push({id:`${E.type}Row${v}`,clip:!1}),S.push({index:v,size:(E==null?void 0:E.height)||M}),y.push({orient:"left",id:`axesLeftRow${v}`,type:E.type===gt.dot?"band":"linear",visible:E.type!==gt.dot,title:{visible:!0,autoRotate:!1,style:{text:E==null?void 0:E.barTitle,dx:-20,textBaseline:"middle",textAlign:"end"}},grid:{visible:typeof((k=E==null?void 0:E.grid)===null||k===void 0?void 0:k.visible)!="boolean"||((P=E==null?void 0:E.grid)===null||P===void 0?void 0:P.visible),style:(I,O)=>{var H,z,F,j,$;let Y=0;if(O===0){const G=(H=E==null?void 0:E.grid)===null||H===void 0?void 0:H.style;Y=(F=(z=G==null?void 0:G.lineWidth)!==null&&z!==void 0?z:G==null?void 0:G.strokeWidth)!==null&&F!==void 0?F:1}return{lineWidth:Y,stroke:(($=(j=E==null?void 0:E.grid)===null||j===void 0?void 0:j.style)===null||$===void 0?void 0:$.stroke)||"#dfdfdf",lineDash:[0,0]}}},domainLine:{visible:!1},tick:{visible:!1},label:{visible:!1},regionIndex:b.length-1}),E.type===gt.dot){_.push({modelId:`scrollBarRightRow${v}`,col:2,row:v});const I=this._getSeriesDataLength(t,E);let O=0;I&&(O=((E==null?void 0:E.height)||M)/(30*I)),C.push(Object.assign({orient:"right",visible:E.type===gt.dot&&O<1,id:`scrollBarRightRow${v}`,start:0,end:Math.min(O,1),filterMode:"axis",regionIndex:b.length-1,axisId:`axesLeftRow${v}`},Q(t==null?void 0:t.scrollBar)[0]))}E.regionIndex=b.length-1,v++,this.addPaddingRow(S,v,(E==null?void 0:E.padding)||20),v++,E.leftAppendPadding=T,E.type===gt.dot&&(E.title.style.dx=-T,E.subTitle.style.dx=-T)}}),this.addPaddingRow(S,v,20),v++,(g=t==null?void 0:t.series)===null||g===void 0||g.forEach(E=>{if(E.type===gt.link){const k=E.dotSeriesIndex+1;_.push({modelId:`${E.type}Row${k}`,col:1,row:k-1}),E.regionIndex=t.series[E.dotSeriesIndex].regionIndex,E.leftAppendPadding=T,E.height=t.series[E.dotSeriesIndex].height,E.clipHeight=t.series[E.dotSeriesIndex].clipHeight}}),t!=null&&t.legends&&this.addAttrToComponentSpec(t.legends,"regionIndex",[b.length-1]),((f=(p=t==null?void 0:t.axes)===null||p===void 0?void 0:p[0])===null||f===void 0?void 0:f.orient)==="bottom"&&(this.addOrientAxes(b,_,v,t),v++);const B={type:"grid",col:4,row:v,colWidth:[{index:0,size:T},{index:2,size:VI},{index:3,size:R}],rowHeight:S,elements:_};t.layout=B,t.region=b,(m=t.axes)===null||m===void 0||m.push(...y),t.scrollBar=C}}var I9t=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class gA extends Pi{constructor(){super(...arguments),this.transformerConstructor=Lrt,this.type="sequence"}_createSeries(t,e){if(!t)return;const{spec:i}=e,r=I9t(e,["spec"]);let s;if(i.type===gt.link&&(i.dotSeriesSpec=this._spec.series[i.dotSeriesIndex]),i.regionId&&(s=this.getRegionsInUserId(i.regionId)),s||(s=this.getRegionsInIndex(i.regionIndex?[i.regionIndex]:void 0)[0]),!s)return;const o=new t(i,Object.assign(Object.assign(Object.assign({},this._modelOption),r),{region:s,specKey:"series",globalScale:this._globalScale}));o&&(o.created(),this._series.push(o),s.addSeries(o))}}gA.type="sequence",gA.transformerConstructor=Lrt;const O9t=()=>{IUt(),HUt(),vs(),ms(),q.registerChart(gA.type,gA)};class CH extends ga{transformSpec(t){super.transformSpec(t),t.axes.forEach(e=>e.type="linear")}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["x2Field","y2Field","barMinHeight","barBackground"])}}class pA extends Pi{constructor(){super(...arguments),this.transformerConstructor=CH}}pA.transformerConstructor=CH,Ye(pA,hl);class qT extends CH{transformSpec(t){super.transformSpec(t),Jd(t)}}class t_ extends pA{constructor(){super(...arguments),this.transformerConstructor=qT,this.type="histogram",this.seriesType=gt.bar}}t_.type="histogram",t_.seriesType=gt.bar,t_.transformerConstructor=qT;const D9t=()=>{ynt(),q.registerChart(t_.type,t_)};class e_ extends pA{constructor(){super(...arguments),this.transformerConstructor=qT,this.type="histogram3d",this.seriesType=gt.bar3d}}e_.type="histogram3d",e_.seriesType=gt.bar3d,e_.transformerConstructor=qT;const F9t=()=>{Dd(),Snt(),q.registerChart(e_.type,e_)};class Irt extends Trt{_getDefaultSeriesSpec(t){var e,i;const r=super._getDefaultSeriesSpec(t);return r.progress=t.progress,r.track=t.track,r.tickMask=t.tickMask,r.cornerRadius=(e=t.cornerRadius)!==null&&e!==void 0?e:0,r.roundCap=(i=t.roundCap)!==null&&i!==void 0&&i,r}transformSpec(t){super.transformSpec(t),this._transformProgressAxisSpec(t,{orient:"angle",visible:!1},{orient:"radius",visible:!1},{forceInitTick:t.tickMask&&t.tickMask.visible!==!1})}}class hp extends Pi{constructor(){super(...arguments),this.transformerConstructor=Irt,this.type="circularProgress",this.seriesType=gt.circularProgress}}hp.type="circularProgress",hp.seriesType=gt.circularProgress,hp.transformerConstructor=Irt,Ye(hp,hl);const H9t=()=>{Knt(),q.registerChart(hp.type,hp)};class Ort extends Trt{_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return e.radiusField=t.radiusField,e.pin=t.pin,e.pinBackground=t.pinBackground,e.pointer=t.pointer,e}_getDefaultCircularProgressSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return e.type=gt.circularProgress,e}transformSpec(t){var e,i,r,s,o;super.transformSpec(t);let a=(e=t.series)===null||e===void 0?void 0:e.find(l=>l.type===gt.gauge||l.type===gt.circularProgress);D(a)&&(a=(i=t.gauge)!==null&&i!==void 0?i:this._getDefaultCircularProgressSeriesSpec(t),a.type==="circularProgress"&&(D(a.radiusField)&&D(a.categoryField)&&(a.radiusField=(s=(r=t.radiusField)!==null&&r!==void 0?r:t.categoryField)!==null&&s!==void 0?s:t.seriesField),D(a.valueField)&&D(a.angleField)&&(a.valueField=(o=t.valueField)!==null&&o!==void 0?o:t.angleField)),t.series.length===1?t.series.push(a):t.series.forEach(l=>{l.type===a.type&&Object.keys(a).forEach(h=>{h in l||(l[h]=a[h])})})),a.type===gt.circularProgress?this._transformProgressAxisSpec(t,{orient:"angle",visible:!0,domainLine:{visible:!1},grid:{visible:!1}},{orient:"radius",visible:!1},{zIndex:Qe.Region+50}):this._transformGaugeAxisSpec(t)}_transformGaugeAxisSpec(t){var e;t.axes||(t.axes=[]);const i={radius:null,angle:null};((e=t.axes)!==null&&e!==void 0?e:[]).forEach(r=>{const{orient:s}=r;s==="radius"&&(i.radius=r),s==="angle"&&(i.angle=r)}),i.angle||(i.angle={orient:"angle",visible:!0},t.axes.push(i.angle)),i.radius||(i.radius={orient:"radius",visible:!1},t.axes.push(i.radius)),D(i.angle.type)&&(i.angle.type="linear"),D(i.radius.type)&&(i.radius.type="linear"),D(i.angle.zIndex)&&(i.angle.zIndex=Qe.Region+50)}}class i_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Ort,this.type="gauge",this.seriesType=gt.gaugePointer}}i_.type="gauge",i_.seriesType=gt.gaugePointer,i_.transformerConstructor=Ort;const z9t=()=>{c9t(),g9t(),Knt(),q.registerChart(i_.type,i_)};class Hb extends Eo{transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["nameField","valueField","fontFamilyField","fontWeightField","fontStyleField","colorHexField","colorMode","colorList","rotateAngles","fontWeightRange","fontSizeRange","maskShape","keepAspect","random","wordCloudConfig","wordCloudShapeConfig","word","fillingWord","wordMask"])}}class SH extends Pi{constructor(){super(...arguments),this.transformerConstructor=Hb,this.type="wordCloud",this.seriesType=gt.wordCloud}}SH.transformerConstructor=Hb;class rc extends SH{constructor(){super(...arguments),this.transformerConstructor=Hb,this.type="wordCloud",this.seriesType=gt.wordCloud}}rc.type="wordCloud",rc.seriesType=gt.wordCloud,rc.transformerConstructor=Hb;const W9t=()=>{ort(),q.registerChart(rc.type,rc)},j9t=()=>{$8t(),ort(),q.registerChart(rc.type,rc)};class Drt extends Hb{_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return e.depth_3d=t.depth_3d,e}}class sc extends SH{constructor(){super(...arguments),this.transformerConstructor=Drt,this.type="wordCloud3d",this.seriesType=gt.wordCloud3d}}sc.type="wordCloud3d",sc.seriesType=gt.wordCloud3d,sc.transformerConstructor=Drt;const N9t=()=>{Dd(),art(),q.registerChart(sc.type,sc)},$9t=()=>{Dd(),V8t(),Dd(),art(),q.registerChart(sc.type,sc)};class ZT extends Eo{needAxes(){return!1}_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","funnelAlign","funnelOrient","heightRatio","shape","funnel","transform","outerLabel","transformLabel","isTransform","maxSize","minSize","gap","isCone","range","transformRatioText"])}transformSpec(t){super.transformSpec(t),super.transformSeriesSpec(t)}}class n_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=ZT,this.type="funnel",this.seriesType=gt.funnel}}n_.type="funnel",n_.seriesType=gt.funnel,n_.transformerConstructor=ZT;const V9t=()=>{r7t(),q.registerChart(n_.type,n_)};class r_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=ZT,this.type="funnel3d",this.seriesType=gt.funnel3d}}r_.type="funnel3d",r_.seriesType=gt.funnel3d,r_.transformerConstructor=ZT;const G9t=()=>{Dd(),s7t(),q.registerChart(r_.type,r_)};class Frt extends ga{needAxes(){return!1}_getDefaultSeriesSpec(t){var e,i;const r=super._getDefaultSeriesSpec(t,["bandWidth","progress","track","clamp"]);return r.direction=(e=t.direction)!==null&&e!==void 0?e:"horizontal",r.cornerRadius=(i=t.cornerRadius)!==null&&i!==void 0?i:0,r}transformSpec(t){var e,i;if(super.transformSpec(t),t.axes||(t.axes=[]),t.direction==="vertical"){let r=null,s=null;((e=t.axes)!==null&&e!==void 0?e:[]).forEach(a=>{const{orient:l}=a;l==="left"&&(r=a),l==="bottom"&&(s=a)}),r||(r={orient:"left",visible:!1},t.axes.push(r)),s||(s={orient:"bottom",visible:!1},t.axes.push(s)),D(s.type)&&(s.type="band"),D(r.type)&&(r.type="linear");const o=T0(r,{min:0,max:1});D(r.min)&&(r.min=o.min),D(r.max)&&(r.max=o.max)}else{let r=null,s=null;((i=t.axes)!==null&&i!==void 0?i:[]).forEach(a=>{const{orient:l}=a;l==="left"&&(r=a),l==="bottom"&&(s=a)}),r||(r={type:"band",orient:"left",visible:!1},t.axes.push(r)),s||(s={orient:"bottom",visible:!1},t.axes.push(s)),D(s.type)&&(s.type="linear"),D(r.type)&&(r.type="band");const o=T0(s,{min:0,max:1});D(s.min)&&(s.min=o.min),D(s.max)&&(s.max=o.max)}}}class dp extends Pi{constructor(){super(...arguments),this.transformerConstructor=Frt,this.type="linearProgress",this.seriesType=gt.linearProgress}}dp.type="linearProgress",dp.seriesType=gt.linearProgress,dp.transformerConstructor=Frt,Ye(dp,hl);const U9t=()=>{qUt(),q.registerChart(dp.type,dp)};class Hrt extends ga{_getDefaultSeriesSpec(t){var e,i;const r=super._getDefaultSeriesSpec(t,["barWidth","barMaxWidth","barMinWidth","barGapInGroup","barBackground","barMinHeight","stackCornerRadius","bar"]);return t.direction==="horizontal"?r.xField=(e=t.xField)!==null&&e!==void 0?e:[t.minField,t.maxField]:r.yField=(i=t.yField)!==null&&i!==void 0?i:[t.minField,t.maxField],r}transformSpec(t){super.transformSpec(t),Jd(t)}}class s_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Hrt,this.type="rangeColumn",this.seriesType=gt.rangeColumn}}s_.type="rangeColumn",s_.seriesType=gt.rangeColumn,s_.transformerConstructor=Hrt;const Y9t=()=>{Z6t(),q.registerChart(s_.type,s_)};class zrt extends ga{_getDefaultSeriesSpec(t){var e,i;const r=super._getDefaultSeriesSpec(t,["bar3d","barGapInGroup"]);return t.direction==="horizontal"?r.xField=(e=t.xField)!==null&&e!==void 0?e:[t.minField,t.maxField]:r.yField=(i=t.yField)!==null&&i!==void 0?i:[t.minField,t.maxField],r}}class o_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=zrt,this.type="rangeColumn3d",this.seriesType=gt.rangeColumn3d}}o_.type="rangeColumn3d",o_.seriesType=gt.rangeColumn3d,o_.transformerConstructor=zrt;const X9t=()=>{Dd(),J6t(),q.registerChart(o_.type,o_)};class Wrt extends Eo{_getDefaultSeriesSpec(t){const e=L(t.startAngle)?t.startAngle:EF,i=L(t.endAngle)?t.endAngle:e+T_(2*Math.PI),r=super._getDefaultSeriesSpec(t,["categoryField","valueField","centerX","centerY","offsetX","offsetY","innerRadius","outerRadius","gap","labelLayout","label","labelAutoVisible","drill","drillField"]);return r.startAngle=e,r.endAngle=i,r}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}}class a_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Wrt,this.type="sunburst",this.seriesType=gt.sunburst}}a_.type="sunburst",a_.seriesType=gt.sunburst,a_.transformerConstructor=Wrt;const K9t=()=>{R7t(),q.registerChart(a_.type,a_)};class jrt extends Eo{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","layoutPadding","circlePacking","drill","drillField"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}}class l_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=jrt,this.type="circlePacking",this.seriesType=gt.circlePacking}}l_.type="circlePacking",l_.seriesType=gt.circlePacking,l_.transformerConstructor=jrt;const q9t=()=>{O7t(),q.registerChart(l_.type,l_)};class Nrt extends Eo{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","aspectRatio","splitType","maxDepth","gapWidth","nodePadding","minVisibleArea","minChildrenVisibleArea","minChildrenVisibleSize","roam","drill","drillField","leaf","nonLeaf","nonLeafLabel"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}}class h_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Nrt,this.type="treemap",this.seriesType=gt.treemap}}h_.type="treemap",h_.seriesType=gt.treemap,h_.transformerConstructor=Nrt;const Z9t=()=>{r9t(),q.registerChart(h_.type,h_)};class $rt extends NT{transformSpec(t){super.transformSpec(t),t.legends&&Q(t.legends).forEach(e=>{e.select=!1,e.hover=!1,e.filter=!1}),Jd(t)}_getDefaultSeriesSpec(t){const e=super._getDefaultSeriesSpec(t);return e.bar=t.bar,e.stackLabel=t.stackLabel,e.leaderLine=t.leaderLine,e.total=t.total,e}}class d_ extends rd{constructor(){super(...arguments),this.transformerConstructor=$rt,this.type="waterfall",this.seriesType=gt.waterfall}}d_.type="waterfall",d_.seriesType=gt.waterfall,d_.transformerConstructor=$rt;const J9t=()=>{H6t(),q.registerChart(d_.type,d_)};class Vrt extends ga{_getDefaultSeriesSpec(t){var e;const i=[t.maxField,t.medianField,t.q1Field,t.q3Field,t.minField,t.outliersField],r=super._getDefaultSeriesSpec(t,["boxPlot","minField","maxField","q1Field","medianField","q3Field","outliersField","outliersStyle"]);return r.direction=(e=t.direction)!==null&&e!==void 0?e:"vertical",r[r.direction==="horizontal"?"xField":"yField"]=i,r}transformSpec(t){super.transformSpec(t),t.axes||(t.axes=[{orient:"bottom"},{orient:"left"}]),Jd(t)}}class u_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Vrt,this.type="boxPlot",this.seriesType=gt.boxPlot}}u_.type="boxPlot",u_.seriesType=gt.boxPlot,u_.transformerConstructor=Vrt;const Q9t=()=>{$6t(),q.registerChart(u_.type,u_)};class Grt extends Eo{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","sourceField","targetField","direction","nodeAlign","crossNodeAlign","nodeGap","nodeWidth","linkWidth","minStepWidth","minNodeHeight","maxNodeHeight","minLinkHeight","maxLinkHeight","dropIsolatedNode","nodeHeight","linkHeight","equalNodeHeight","linkOverlap","iterations","nodeKey","linkSortBy","nodeSortBy","setNodeLayer","node","link","emphasis","inverse","overflow"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}}class c_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Grt,this.type="sankey",this.seriesType=gt.sankey}_setStateInDatum(t,e,i,r,s){const o=V(i)?i[0]:i;this.filterGraphicsByDatum(o,{filter:(a,l)=>l.type!=="text"&&l.getProduct()&&(!r||r(a,l)),region:s,getDatum:a=>{var l;let h=(l=a.getDatum())===null||l===void 0?void 0:l.datum;return V(h)&&(h=h[0]),h},callback:(a,l,h,d)=>{var u,c,g;const p=(u=l.getProduct())===null||u===void 0?void 0:u.id();p&&(p.includes("node")||p.includes("link"))&&((g=(c=h)._handleEmphasisElement)===null||g===void 0||g.call(c,{item:a}))},regionCallback:(a,l)=>{o?a.length&&(a.forEach(h=>{l.interaction.startInteraction(t,h)}),e&&l.interaction.reverseEventElement(t)):l.interaction.clearEventElement(t,!0)}})}}c_.type="sankey",c_.seriesType=gt.sankey,c_.transformerConstructor=Grt;const tYt=()=>{lFt(),Q7t(),q.registerChart(c_.type,c_)};class Urt extends ga{_getDefaultSeriesSpec(t){var e,i;const r=super._getDefaultSeriesSpec(t);return r.area=t.area,t.direction==="horizontal"?r.xField=(e=t.xField)!==null&&e!==void 0?e:[t.minField,t.maxField]:r.yField=(i=t.yField)!==null&&i!==void 0?i:[t.minField,t.maxField],r.stack=!1,r}transformSpec(t){super.transformSpec(t),Jd(t)}}class g_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Urt,this.type="rangeArea",this.seriesType=gt.rangeArea}}g_.type="rangeArea",g_.seriesType=gt.rangeArea,g_.transformerConstructor=Urt;const eYt=()=>{eUt(),q.registerChart(g_.type,g_)};class Yrt extends ga{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["valueField","cell"])}}class p_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Yrt,this.type="heatmap",this.seriesType=gt.heatmap}}p_.type="heatmap",p_.seriesType=gt.heatmap,p_.transformerConstructor=Yrt;const iYt=()=>{b9t(),q.registerChart(p_.type,p_)};class Xrt extends Eo{_getDefaultSeriesSpec(t){return super._getDefaultSeriesSpec(t,["categoryField","valueField","sizeField","sizeRange","centerX","centerY","innerRadius","outerRadius","startAngle","endAngle","ripplePoint","centerPoint","centerLabel","nodePoint"])}transformSpec(t){super.transformSpec(t),this.transformSeriesSpec(t)}}class f_ extends Pi{constructor(){super(...arguments),this.transformerConstructor=Xrt,this.type="correlation",this.seriesType=gt.correlation}}f_.type="correlation",f_.seriesType=gt.correlation,f_.transformerConstructor=Xrt;const nYt=()=>{T9t(),q.registerChart(f_.type,f_)};function Krt(n){var t,e;const i=Object.assign({},n);return xt(n.style)||(i.textStyle=jt(n.style)),xt(n.textStyle)||Nt(i.textStyle,jt(n.textStyle)),!((t=n.shape)===null||t===void 0)&&t.style&&jt(i.shape.style),!((e=n.background)===null||e===void 0)&&e.style&&jt(i.background.style),i}var rYt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};function sYt(n,t){const{title:e={},item:i={},pager:r={},background:s={},type:o,id:a,visible:l,orient:h,position:d,data:u,filter:c,regionId:g,regionIndex:p,seriesIndex:f,seriesId:m,padding:v}=n,_=rYt(n,["title","item","pager","background","type","id","visible","orient","position","data","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return e.visible?_.title=Krt(e):_.title={visible:!1},xt(i.focusIconStyle)||jt(i.focusIconStyle),i.shape&&(i.shape=Yo(i.shape)),i.label&&(i.label=Yo(i.label)),i.value&&(i.value=Yo(i.value)),i.background&&(i.background=Yo(i.background)),Ws(i.maxWidth)&&(i.maxWidth=Number(i.maxWidth.substring(0,i.maxWidth.length-1))*t.width/100),Ws(i.width)&&(i.width=Number(i.width.substring(0,i.width.length-1))*t.width/100),Ws(i.height)&&(i.height=Number(i.height.substring(0,i.height.length-1))*t.width/100),_.item=i,r.type==="scrollbar"?(xt(r.railStyle)||jt(r.railStyle),xt(r.sliderStyle)||jt(r.sliderStyle)):(xt(r.textStyle)||jt(r.textStyle),r.handler&&Yo(r.handler)),_.pager=r,s.visible&&!xt(s.style)&&(Nt(_,s.style),L(s.padding)&&(_.padding=s.padding)),_}const oYt=(n,t)=>{const e=[],i={},{series:r,seriesField:s}=t;return r().forEach(o=>{const a=s(o);let l;l=a===o.getSeriesField()?o.getSeriesInfoList():o.getSeriesInfoInField(a),l.forEach(h=>{i[h.key]||(i[h.key]=!0,e.push(h))})}),e},aYt=(n,t)=>{var e,i,r;const{series:s,selected:o,field:a,data:l,customFilter:h}=t,d=o(),u=l();if(d.length===0&&u.length)return[];if(d.length===u.length)return n;const c={};d.forEach(p=>{c[p]=!0});const g=(e=a())!==null&&e!==void 0?e:Fr;return h?h(n,d,g):(V(n)&&(!((i=n[0])===null||i===void 0)&&i.nodes)?(n[0].nodes=n[0].nodes.filter(p=>c[p.key]===!0),!((r=n[0])===null||r===void 0)&&r.links&&(n[0].links=n[0].links.filter(p=>c[p.source]===!0&&c[p.target]===!0))):L(g)&&(n=n.filter(p=>c[s.getSeriesFieldValue(p,g)]===!0)),n)};class xH extends $r{constructor(){super(...arguments),this.layoutType="normal",this.layoutZIndex=Qe.Legend,this.layoutLevel=aa.Legend,this.specKey="legends",this._orient="left",this._visible=!0,this._position="middle",this._preSelectedData=[],this._selectedData=[],this.effect={onSelectedDataChange:()=>{Oi(this._regions,t=>{var e;(e=t.getViewData())===null||e===void 0||e.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),Oi(this._regions,t=>{t.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}}}get orient(){return this._orient}get visible(){return this._visible}get position(){return this._position}getLegendData(){return this._legendData.getLatestData()}getSelectedData(){return this._selectedData}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._orient=BF(this._spec.orient)?this._spec.orient:"left",this._position=(t=this._spec.position)!==null&&t!==void 0?t:"middle",this._visible=this._spec.visible!==!1;const{regionId:e,regionIndex:i,seriesId:r,seriesIndex:s}=this._spec;L(r)&&(this._seriesUserId=Q(r)),L(e)&&(this._regionUserId=Q(e)),L(s)&&(this._seriesIndex=Q(s)),L(i)&&(this._regionUserIndex=Q(i)),this._regions=this._option.getRegionsInUserIdOrIndex(this._regionUserId,this._regionUserIndex)}created(){super.created(),this.initData()}onRender(t){}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reRender=!0,(t==null?void 0:t.orient)!==(e==null?void 0:e.orient)?(i.reMake=!0,i):(Oe(e,t)||(i.reCompile=!0),i)}changeRegions(t){}_bindLegendDataChange(){this._preSelectedData=this._selectedData.slice(),this._initSelectedData()}initData(){const t=this._initLegendData();t.target.addListener("change",this._bindLegendDataChange.bind(this)),this._legendData=new Qa(this._option,t),this._initSelectedData(),Oi(this._regions,e=>{e.event.on(Ot.rawDataUpdate,{filter:({model:i})=>(i==null?void 0:i.id)===e.id},()=>{this._legendData.getDataView().reRunAllTransform()})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}setSelectedData(t){var e,i,r;const s=this._selectedData;D(t)||JSON.stringify(s)===JSON.stringify(t)||(Oi(this._regions,o=>{o.legendSelectedFilter&&(t=o.legendSelectedFilter(this,t))},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._selectedData=[...t],(i=(e=this.effect).onSelectedDataChange)===null||i===void 0||i.call(e),this.event.emit(Ot.legendSelectedDataChange,{model:this}),(r=this._legendComponent)===null||r===void 0||r.setSelected(this._selectedData))}afterSetLayoutStartPoint(t){if(super.afterSetLayoutStartPoint(t),this._legendComponent){const{x:e,y:i}=t;et(e*i)&&this._legendComponent.setAttributes({x:e,y:i})}}getBoundsInRect(t,e){if(!this._visible)return this._legendComponent&&this._legendComponent.parent&&(this._legendComponent.parent.removeChild(this._legendComponent),this._legendComponent=null),{x1:0,y1:0,x2:0,y2:0};const i={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0},r=this._getLegendAttributes(t);if(r.disableTriggerEvent=this._option.disableTriggerEvent,this._legendComponent)Oe(r,this._cacheAttrs)||this._legendComponent.setAttributes(Nt({},r,{defaultSelected:this._selectedData}));else{const a=new(this._getLegendConstructor())(Nt({},r,{defaultSelected:this._selectedData}));a.name="legend",this._legendComponent=a,this.getContainer().add(a),this._option.disableTriggerEvent||this._initEvent(),a.on("*",(l,h)=>this._delegateEvent(this._legendComponent,l,h))}this._cacheAttrs=r;const s=isFinite(this._legendComponent.AABBBounds.width())?this._legendComponent.AABBBounds.width():0,o=isFinite(this._legendComponent.AABBBounds.height())?this._legendComponent.AABBBounds.height():0;if(this.layoutType!=="normal-inline"){const a=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",l=this._position,{width:h,height:d}=e;let u=0,c=0;a==="horizontal"?l==="middle"?u=(h-s)/2:l==="end"&&(u=h-s):l==="middle"?c=(d-o)/2:l==="end"&&(c=d-o),this._legendComponent.setAttributes({dx:u,dy:c})}return i.x2=i.x1+s,i.y2=i.y1+o,i}onDataUpdate(){var t,e,i;if(JSON.stringify(this._preSelectedData)!==JSON.stringify(this._selectedData)){if(this._legendComponent){const r=this._getLegendAttributes(this.getLayoutRect());Oe(r,this._cacheAttrs)||this._legendComponent.setAttributes(Nt({},r,{defaultSelected:this._selectedData}))}(e=(t=this.effect).onSelectedDataChange)===null||e===void 0||e.call(t),(i=this.getChart())===null||i===void 0||i.setLayoutTag(!0,null,!1),this.event.emit(Ot.legendSelectedDataChange,{model:this})}}_getNeedClearVRenderComponents(){return[this._legendComponent]}clear(){super.clear(),this._cacheAttrs=null,this._preSelectedData=null}}xH.specKey="legends";class fA extends xH{constructor(){super(...arguments),this.type=vt.discreteLegend,this.name=vt.discreteLegend}static getSpecInfo(t){return la(t,this.specKey,this.type,e=>!e.type||e.type==="discrete")}init(t){super.init(t),Oi(this._regions,e=>{e.addViewDataFilter({type:"discreteLegendFilter",options:{series:e,selected:()=>this._selectedData,field:()=>this._getSeriesLegendField(e),data:()=>this.getLegendDefaultData(),customFilter:this._spec.customFilter},level:oa.legendFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}_initLegendData(){Vt(this._option.dataSet,"discreteLegendFilter",aYt),Vt(this._option.dataSet,"discreteLegendDataMake",oYt);const t=new Ve(this._option.dataSet,{name:`${this.type}_${this.id}_data`});return t.transform({type:"discreteLegendDataMake",options:{series:()=>{const e=[];return Oi(this._regions,i=>{e.push(i)},{specIndex:this._spec.seriesIndex,userId:this._spec.seriesId}),e},seriesField:e=>this._getSeriesLegendField(e)}}),t}_getSeriesLegendField(t){var e,i,r;const s=t.getSeriesField(),o=(e=this._spec.scaleName)!==null&&e!==void 0?e:this._spec.scale;if(D(o)||!t.getRawData())return s;const a=this._option.globalScale.getScaleSpec(o);if(!a)return s;if(this._spec.field)return this._spec.field;if(!Kg(a.domain))return s;const l=a.domain.find(h=>h.dataId===t.getRawData().name);return l&&(r=(i=l.fields)===null||i===void 0?void 0:i[0])!==null&&r!==void 0?r:s}_initSelectedData(){const t=this.getLegendDefaultData();if(this._unselectedData){const e=[],i=[];t.forEach(r=>{this._unselectedData.includes(r)?i.push(r):e.push(r)}),this._selectedData=e,this._unselectedData=i}else this._spec.defaultSelected?this._selectedData=[...this._spec.defaultSelected]:this._selectedData=t}getLegendDefaultData(t){return it(this._spec.data)?this._getLegendItems().map(e=>e.label):this._legendData.getLatestData().map(t?e=>e.originalKey:e=>e.key)}_addDefaultTitleText(t){var e,i,r,s;if(!((e=t.title)===null||e===void 0)&&e.visible&&D(t.title.text)&&D((i=t.title.style)===null||i===void 0?void 0:i.text)){const o=(s=(r=this._regions)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.getSeries()[0];if(!o)return;t.title.text=Xw(o.getRawData(),o.getSeriesField())}}_getLegendAttributes(t){const e=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",i=Object.assign(Object.assign({layout:e,items:this._getLegendItems(),zIndex:this.layoutZIndex},sYt(this._spec,t)),{maxWidth:t.width,maxHeight:t.height});return this._addDefaultTitleText(i),this._addLegendItemFormatMethods(i),i}_getLegendConstructor(){return pet}setSelectedData(t){t&&(this._unselectedData=this.getLegendDefaultData().filter(e=>!t.includes(e))),super.setSelectedData(t)}_initEvent(){if(this._legendComponent){const t=this._spec.filter!==!1;this._legendComponent.addEventListener(_r.legendItemClick,e=>{const i=Dt(e,"detail.currentSelected");t&&this.setSelectedData(i),this.event.emit(Ot.legendItemClick,{model:this,value:i,event:e})}),this._legendComponent.addEventListener(_r.legendItemHover,e=>{const i=Dt(e,"detail");this.event.emit(Ot.legendItemHover,{model:this,value:i,event:e})}),this._legendComponent.addEventListener(_r.legendItemUnHover,e=>{const i=Dt(e,"detail");this.event.emit(Ot.legendItemUnHover,{model:this,value:i,event:e})})}}_getLegendItems(){const t=(this._legendData.getLatestData()||[]).map(e=>{var i,r;const s=e.style("fillOpacity"),o=e.style("strokeOpacity"),a=e.style("opacity"),l=e.style("texture");return{label:e.key,shape:{symbolType:(r=(i=e.style("symbolType"))!==null&&i!==void 0?i:e.shapeType)!==null&&r!==void 0?r:"circle",fillOpacity:et(s)?s:1,strokeOpacity:et(o)?o:1,opacity:et(a)?a:1,texturePadding:l?1:null,textureSize:l?4:null,texture:l,fill:e.style("fill"),stroke:e.style("stroke"),textureColor:e.style("textureColor"),innerBorder:e.style("innerBorder"),outerBorder:e.style("outerBorder"),lineDash:e.style("lineDash"),lineDashOffset:e.style("lineDashOffset"),lineWidth:e.style("lineWidth")}}});return it(this._spec.data)?this._spec.data(t,this._option.globalScale.getScale("color"),this._option.globalScale):t}_addLegendItemFormatMethods(t){var e,i,r,s;const{formatMethod:o,formatter:a}=(i=(e=this._spec.item)===null||e===void 0?void 0:e.label)!==null&&i!==void 0?i:{},{formatMethod:l,formatter:h}=(s=(r=this._spec.item)===null||r===void 0?void 0:r.value)!==null&&s!==void 0?s:{},{formatFunc:d}=sh(o,a);a&&!o&&d&&(t.item.label.formatMethod=(c,g)=>d(c,g,a));const{formatFunc:u}=sh(l,h);h&&!l&&u&&(t.item.value.formatMethod=(c,g)=>u(h,c,g,a))}}fA.specKey="legends",fA.type=vt.discreteLegend;const lYt=()=>{q.registerComponent(fA.type,fA)},hYt=(n,t)=>{const{series:e,field:i,scale:r}=t,s=i();if(i&&s){let o=1/0,a=-1/0;return e().forEach(l=>{const h=l.getRawDataStatisticsByField(s,!0),d=h==null?void 0:h.min,u=h==null?void 0:h.max;et(d)&&(o=Math.min(d,o)),et(u)&&(a=Math.max(u,a))}),[o,a]}if(r){const o=r();return o?o.domain():[]}return[]},dYt=(n,t)=>{const{selected:e,field:i,data:r,isHierarchyData:s,customFilter:o}=t,a=e(),l=i(),h=s||(d=>d&&d.some(u=>u&&ljt(u)));if(a===r())return n;if(l&&!xt(a)){const[d,u]=a;return o?o(n,a,l):h(n)?Yet(n,+d,+u,l):n.filter(c=>c[l]>=d&&c[l]<=u)}return n};var uYt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};function cYt(n){const t=Nt({},n),{title:e={},handler:i={},rail:r={},track:s={},startText:o,endText:a,handlerText:l,sizeBackground:h,background:d={},type:u,id:c,visible:g,orient:p,position:f,data:m,defaultSelected:v,field:_,filter:b,regionId:y,regionIndex:C,seriesIndex:S,seriesId:w,padding:x}=t,A=uYt(t,["title","handler","rail","track","startText","endText","handlerText","sizeBackground","background","type","id","visible","orient","position","data","defaultSelected","field","filter","regionId","regionIndex","seriesIndex","seriesId","padding"]);return e.visible?A.title=Krt(e):A.title={visible:!1},A.showHandler=i.visible!==!1,xt(i.style)||(A.handlerStyle=jt(i.style)),L(r.width)&&(A.railWidth=r.width),L(r.height)&&(A.railHeight=r.height),xt(r.style)||(A.railStyle=jt(r.style)),xt(s.style)||(A.trackStyle=jt(s.style)),A.startText=Yo(o),A.endText=Yo(a),A.handlerText=Yo(l),xt(h)||(A.sizeBackground=jt(h)),d.visible&&!xt(d.style)&&(Nt(A,d.style),L(d.padding)&&(A.padding=d.padding)),A}function gYt(n){return n==="color"||n==="size"}const pYt={color:yT,size:CT},fYt=["#C4E7FF","#98CAFF","#75ACFF","#518FF9","#2775DC","#005CBE","#00429F","#00287E"],mYt=[2,10];class mA extends xH{static getSpecInfo(t){const e=la(t,this.specKey,this.type,i=>gYt(i.type));return e&&e.forEach(i=>{i.type=i.spec.type==="color"?vt.colorLegend:vt.sizeLegend}),e}constructor(t,e){super(t,e),this.type=vt.colorLegend,this.name=vt.colorLegend;const i=this._spec.type==="color"?vt.colorLegend:vt.sizeLegend;this.type=i,this.name=i}setAttrFromSpec(){super.setAttrFromSpec(),this._field=this._spec.field,this._legendType=this._spec.type}init(t){super.init(t),Oi(this._regions,e=>{e.addViewDataFilter({type:"continuousLegendFilter",options:{selected:()=>this._selectedData,field:()=>this._field,data:()=>this._legendData.getLatestData(),isHierarchyData:e.isHierarchyData,customFilter:this._spec.customFilter},level:oa.legendFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex})}_getScaleInGlobal(){const t=this._option.globalScale;let e=this._spec.scale;return e||(e=this._legendType),t.getScale(e)}_initLegendData(){Vt(this._option.dataSet,"continuousLegendFilter",dYt),Vt(this._option.dataSet,"continuousLegendDataMake",hYt);const t=new Ve(this._option.dataSet,{name:`${this.type}_${this.id}_data`});return t.transform({type:"continuousLegendDataMake",options:{series:()=>Tet(this._regions,{userId:this._seriesUserId,specIndex:this._seriesIndex}),field:()=>this._field,scale:this._getScaleInGlobal.bind(this)}}),t}_initSelectedData(){this._spec.defaultSelected?this._selectedData=this._spec.defaultSelected.slice():this._selectedData=this._legendData.getLatestData()}_addDefaultTitleText(t){var e,i,r,s;if(!((e=t.title)===null||e===void 0)&&e.visible&&D(t.title.text)&&D((i=t.title.style)===null||i===void 0?void 0:i.text)){const o=this._field;if(o){const d=(s=(r=this._regions)===null||r===void 0?void 0:r[0])===null||s===void 0?void 0:s.getSeries()[0];return d?void(t.title.text=Xw(d.getRawData(),o)):void 0}let a=this._spec.scale;a||(a=this._legendType);const l=this._option.globalScale.getScaleSpec(a);if(!Kg(l==null?void 0:l.domain))return;const h=l.domain[0];if(h.fields.length===0)return;t.title.text=Xw(this._option.dataSet.getDataView(h.dataId),h.fields[0])}}_getLegendAttributes(t){var e,i;const r=this.layoutOrient==="bottom"||this.layoutOrient==="top"?"horizontal":"vertical",s=r==="horizontal"?"bottom":this.layoutOrient;let o=[];const a=this._getScaleInGlobal();a&&a.type==="linear"&&(o=a.range()),xt(o)&&(o=this._legendType==="color"?fYt:mYt);let l=(e=this._legendData.getLatestData()[0])!==null&&e!==void 0?e:0,h=(i=this._legendData.getLatestData()[1])!==null&&i!==void 0?i:1;this._legendData.getLatestData()[0]===this._legendData.getLatestData()[1]&&(l=Math.min(0,this._legendData.getLatestData()[0]),h=this._legendData.getLatestData()[0]===0?1:Math.max(0,this._legendData.getLatestData()[0]));const d=Object.assign({layout:r,align:s,zIndex:this.layoutZIndex,min:l,max:h,value:this._spec.defaultSelected,[this._legendType==="color"?"colors":"sizeRange"]:o},cYt(this._spec));return this._addDefaultTitleText(d),d}_getLegendConstructor(){return pYt[this._legendType]}_initEvent(){if(this._legendComponent){const t=this._spec.filter!==!1;this._legendComponent.addEventListener("change",ah(e=>{const i=Dt(e,"detail.value");t&&this.setSelectedData(i),this.event.emit(Ot.legendFilter,{model:this,value:i,event:e})},30))}}}mA.specKey="legends",mA.type=vt.continuousLegend;const vYt=()=>{q.registerComponent(mA.type,mA)},yg=(n,t)=>L(t)?n.map(e=>t[e]):void 0,Vu=(n,t)=>e=>n.every((i,r)=>e[i]===(t==null?void 0:t[r])),Mm=n=>!D(n)&&(V(n)?n.length>0&&n.every(L):Object.keys(n).length>0);function _Yt(n,t,e){var i,r,s;const o=Object.assign({regionIndex:0},t),a=e.getOption(),l=a.getRegionsInUserIdOrIndex(L(o.regionId)?[o.regionId]:void 0,L(o.regionIndex)?[o.regionIndex]:void 0)[0];if(!l)return"none";const h=bYt(n,l),d=(i=o.activeType)!==null&&i!==void 0?i:h.length>1?"dimension":"mark",u=l.getLayoutStartPoint(),c=l.getLayoutRect(),g=a.globalInstance.getContainer(),p=Object.assign({x:0,y:0},g?Rlt(g):{}),f=v=>{var _;const{dimensionFields:b,dimensionData:y,measureFields:C,measureData:S,groupField:w,groupData:x}=v.data;return(_=v.series.getViewData())===null||_===void 0?void 0:_.latestData.find(M=>Vu(b,y)(M)&&Vu(C,S)(M)&&(D(w)||Vu([w],[x])(M)))},m=v=>{var _,b;const y=(w=>({x:Math.min(Math.max(w.x,0),c.width),y:Math.min(Math.max(w.y,0),c.height)}))(v),C=(_=o.x)!==null&&_!==void 0?_:u.x+y.x,S=(b=o.y)!==null&&b!==void 0?b:u.y+y.y;return{canvasX:C,canvasY:S,clientX:p.x+C,clientY:p.y+S}};if(d==="dimension"){const v=h[0];if(!v)return"none";const _=new Map;h.forEach(S=>{var w;_.has(S.series)||_.set(S.series,[]),(w=_.get(S.series))===null||w===void 0||w.push(S)});const b=[{value:n[v.data.dimensionFields[0]],data:[..._.keys()].map(S=>{var w,x;return{series:S,datum:(x=(w=_.get(S))===null||w===void 0?void 0:w.map(A=>f(A)))!==null&&x!==void 0?x:[]}})}];L(v.dimType)&&(b[0].position=v.pos[v.dimType],b[0].dimType=v.dimType);const y={changePositionOnly:!1,action:"enter",tooltip:null,dimensionInfo:b,chart:(r=a.globalInstance.getChart())!==null&&r!==void 0?r:void 0,datum:void 0,model:void 0,source:Ee.chart,event:m({x:h.reduce((S,w)=>S+w.pos.x,0)/h.length,y:h.reduce((S,w)=>S+w.pos.y,0)/h.length}),item:void 0,itemMap:new Map};e.processor.dimension.showTooltip(b,y,!1);const C=a.globalInstance;return zn.globalConfig.uniqueTooltip&&zn.hideTooltip(C.id),d}if(d==="mark"){const v=h[0];if(!v)return"none";const _=Object.assign(Object.assign({},f(v)),n),b=[{datum:[_],series:v.series}],y={changePositionOnly:!1,tooltip:null,dimensionInfo:[{value:_[v.data.dimensionFields[0]],data:b}],chart:(s=a.globalInstance.getChart())!==null&&s!==void 0?s:void 0,datum:_,model:v.series,source:Ee.chart,event:m(v.pos),item:void 0,itemMap:new Map};e.processor.mark.showTooltip({datum:_,mark:null,series:v.series},y,!1);const C=a.globalInstance;return zn.globalConfig.uniqueTooltip&&zn.hideTooltip(C.id),d}return"none"}const bYt=(n,t)=>{const e=t.getSeries(),i=[];return e.forEach(r=>{var s,o,a,l,h,d,u;const c=r.getDimensionField(),g=r.getMeasureField(),p=r.getSeriesField(),f=L(p)?n[p]:void 0,m=L(p)&&(l=(a=(o=(s=r.getViewDataStatistics)===null||s===void 0?void 0:s.call(r))===null||o===void 0?void 0:o.latestData[p])===null||a===void 0?void 0:a.values)!==null&&l!==void 0?l:[],v=yg(c,n);let _=yg(g,n);const b=Mm(_),y=!b&&L(p)&&D(f)&&m.length>0,C=()=>{var S;const w=(S=r.getViewData())===null||S===void 0?void 0:S.latestData.find(Vu(c,v));if(!b&&(_=yg(g,w),!Mm(_)))return;const x=r.type===gt.pie?r.dataToCentralPosition(w):r.dataToPosition(w);D(x)||isNaN(x.x)||isNaN(x.y)||i.push({pos:x,data:{dimensionFields:c,dimensionData:v,measureFields:g,measureData:_,hasMeasureData:b,groupField:p,groupData:f},series:r})};if(r.coordinate==="cartesian"){const S=r,w=xr((d=(h=r.getYAxisHelper())===null||h===void 0?void 0:h.getScale(0))===null||d===void 0?void 0:d.type)?"y":"x",x=c.map((M,T)=>[M,T]).filter(([,M])=>D(v==null?void 0:v[M]));let A=[v??[]];x.length>0&&x.forEach(([M,T])=>{var R,B,E,k;const P=(k=(E=(B=(R=r.getViewDataStatistics)===null||R===void 0?void 0:R.call(r))===null||B===void 0?void 0:B.latestData[M])===null||E===void 0?void 0:E.values)!==null&&k!==void 0?k:[],I=[];A.forEach(O=>{P.forEach(H=>{var z;const F=(z=O==null?void 0:O.slice())!==null&&z!==void 0?z:[];F[T]=H,I.push(F)})}),A=I}),A.forEach(M=>{var T,R;if(y){const B=(T=S.getViewData())===null||T===void 0?void 0:T.latestData.filter(Vu(c,M));m.forEach(E=>{const k=B.find(I=>I[p]===E);if(_=yg(g,k),!Mm(_))return;const P=S.dataToPosition(k);D(P)||isNaN(P.x)||isNaN(P.y)||i.push({pos:P,data:{dimensionFields:c,dimensionData:M,measureFields:g,measureData:_,hasMeasureData:b,groupField:p,groupData:E},series:r,dimType:w})})}else{const B=(R=S.getViewData())===null||R===void 0?void 0:R.latestData.find(Vu(c,M));if(!b&&(_=yg(g,B),!Mm(_)))return;const E=S.dataToPosition(B);if(D(E)||isNaN(E.x)||isNaN(E.y))return;i.push({pos:E,data:{dimensionFields:c,dimensionData:M,measureFields:g,measureData:_,hasMeasureData:b,groupField:p,groupData:f},dimType:w,series:r})}})}else if(r.coordinate==="polar")if(r.type===gt.pie)C();else{const S=r;if(y){const w=((u=S.getViewData())===null||u===void 0?void 0:u.latestData.filter(Vu(c,v))).find(x=>x[p]===f);m.forEach(x=>{if(_=yg(g,w),!Mm(_))return;const A=S.dataToPosition(w);D(A)||isNaN(A.x)||isNaN(A.y)||i.push({pos:A,data:{dimensionFields:c,dimensionData:v,measureFields:g,measureData:_,hasMeasureData:b,groupField:p,groupData:x},series:r})})}else C()}else r.coordinate==="geo"&&C()}),i},yYt=["updateTitle","updateContent","updatePosition","maxLineCount","othersLine"],CYt=(n,t,e,i,r)=>{var s,o,a;const l={activeType:n};switch(n){case"mark":case"group":if(e){const h=(s=e.getSpec())===null||s===void 0?void 0:s.tooltip;return l.visible=!0,h!=null&&h.handler&&(l.handler=h.handler),!((o=l.handler)===null||o===void 0)&&o.showTooltip?l:(h!=null&&h[n]&&yYt.forEach(d=>{L(h[n][d])&&(l[d]=h[n][d])}),Object.assign(Object.assign({},l),e.tooltipHelper.getTooltipData(n,t,i,i[0].datum,r)))}break;case"dimension":if(i!=null&&i.length){if(SYt(i).every(d=>{var u;return!ZF("dimension",(u=d.tooltipHelper)===null||u===void 0?void 0:u.spec)})?l.visible=!1:l.visible=!0,l.handler=t.handler,(a=l.handler)===null||a===void 0?void 0:a.showTooltip)return l;const h=[];return i.forEach(d=>d.data.forEach(u=>{const{series:c}=u,g=c.tooltipHelper.getTooltipData(n,t,i,u.datum,r);g&&h.push(g)})),kGt(h)}}return null},SYt=n=>{const t=[];return n.forEach(e=>{e.data.forEach(i=>{L(i.series)&&t.push(i.series)})}),t},Pf={dom:`${Wt}_TOOLTIP_HANDLER_DOM`,canvas:`${Wt}_TOOLTIP_HANDLER_CANVAS`},xYt="vchart-tooltip-element",wYt=20,B7={key:"",value:"..."},P7=["group","mark","dimension"],oP=50;class wH{constructor(t){this._showTooltipByHandler=(e,i)=>{var r,s,o;if(D(e))return 1;i.changePositionOnly||this.clearCache(),this._updateViewSpec(e,i);const a=this._cacheActiveSpec;if(D(a)||a.visible===!1)return 1;i.tooltipSpec=this.component.getSpec(),i.activeTooltipSpec=a;const{title:l,content:h}=a,d=D(l==null?void 0:l.key)&&D(l==null?void 0:l.value)&&!(h!=null&&h.length);if(this.component.event.emit(Ot.tooltipShow,Object.assign(Object.assign({},i),{isEmptyTooltip:d,tooltipData:e,activeType:this.activeType,tooltip:this.component})),d)return 1;let u;return!((r=a.handler)===null||r===void 0)&&r.showTooltip?u=a.handler.showTooltip.bind(a.handler):!((s=this.component.tooltipHandler)===null||s===void 0)&&s.showTooltip&&(u=this.component.tooltipHandler.showTooltip.bind(this.component.tooltipHandler)),u?(o=u(this.activeType,e,i))!==null&&o!==void 0?o:0:1},this.component=t}_preprocessDimensionInfo(t){const e=[];if(t==null||t.forEach(i=>{const r=Object.assign(Object.assign({},i),{data:i.data.filter(({series:s})=>{var o,a;return((a=(o=s.getSpec())===null||o===void 0?void 0:o.tooltip)===null||a===void 0?void 0:a.visible)!==!1})});r.data.length>0&&e.push(r)}),e.length>0)return e}_updateViewSpec(t,e){var i,r,s,o,a,l,h,d,u;const{changePositionOnly:c,model:g}=e;if(!c||!this._cacheActiveSpec){const p=this.component.getSpec();if(this._cacheActiveSpec=CYt(this.activeType,this.component.getSpec(),g,t,e),this._cacheActiveSpec){D(this._cacheActiveSpec.handler)&&L(p.handler)&&(this._cacheActiveSpec.handler=p.handler);const f=(i=p[this.activeType])!==null&&i!==void 0?i:{},m=(r=this._cacheActiveSpec.updateTitle)!==null&&r!==void 0?r:f.updateTitle,v=(s=this._cacheActiveSpec.updateContent)!==null&&s!==void 0?s:f.updateContent,_=(a=(o=this._cacheActiveSpec.maxLineCount)!==null&&o!==void 0?o:f.maxLineCount)!==null&&a!==void 0?a:wYt;if(m&&(this._cacheActiveSpec.title=(l=m(this._cacheActiveSpec.title,t,e))!==null&&l!==void 0?l:this._cacheActiveSpec.title),v)this._cacheActiveSpec.content=(h=v(this._cacheActiveSpec.content,t,e))!==null&&h!==void 0?h:this._cacheActiveSpec.content;else if(_>=1&&((d=this._cacheActiveSpec.content)===null||d===void 0?void 0:d.length)>_){const b=(u=this._cacheActiveSpec.othersLine)!==null&&u!==void 0?u:f.othersLine,y=b?Object.assign(Object.assign({},B7),b):B7;this._cacheActiveSpec.content=[...this._cacheActiveSpec.content.slice(0,_-1),Object.assign(Object.assign({},this._cacheActiveSpec.content[_-1]),y)]}}}}shouldHandleTooltip(t,e){var i,r;return!D(e)&&ZF(this.activeType,(r=(i=t.model)===null||i===void 0?void 0:i.tooltipHelper)===null||r===void 0?void 0:r.spec)}clearCache(){this._cacheActiveSpec=void 0}}class AYt extends wH{constructor(){super(...arguments),this.activeType="dimension"}showTooltip(t,e,i){const r=Object.assign(Object.assign({},e),{dimensionInfo:this._preprocessDimensionInfo(t),changePositionOnly:i,tooltip:this.component});return this._showTooltipByHandler(t,r)}_getDimensionInfo(t){var e,i;let r;const s=this.component.getChart(),o=s.getCompiler().getStage().getLayer(void 0),a={x:t.event.viewX,y:t.event.viewY};if(o.globalTransMatrix.transformPoint({x:t.event.viewX,y:t.event.viewY},a),r=[...(e=Fit(s,a,!0))!==null&&e!==void 0?e:[],...(i=Lit(s,a))!==null&&i!==void 0?i:[]],r.length===0)r=void 0;else if(r.length>1){const l=r.filter(h=>{var d;const u=h.axis;if(u.getSpec().hasDimensionTooltip)return!0;if(!xr(u.getScale().type))return!1;let c;for(const g of(d=u==null?void 0:u.getRegions())!==null&&d!==void 0?d:[]){for(const p of g.getSeries())if(p.coordinate==="cartesian"){c=p;break}if(L(c))break}return L(c)&&c.getDimensionField()[0]===c.fieldY[0]?u.getOrient()==="left"||u.getOrient()==="right":u.getOrient()==="bottom"||u.getOrient()==="top"});if(r=l.length?l:r.slice(0,1),r.length>1){const h=new Set;r.forEach(d=>{d.data=d.data.filter(({key:u})=>!h.has(u)&&(h.add(u),!0))})}}return r}getMouseEventData(t){return{tooltipInfo:this._getDimensionInfo(t),ignore:!1}}}class MYt extends wH{constructor(){super(...arguments),this.activeType="mark"}showTooltip(t,e,i){var r,s,o;const{datum:a,series:l}=t,h=this.component.getSpec(),d=[{datum:[a],series:l}],u=l.tooltipHelper,c=(r=l.getSpec())===null||r===void 0?void 0:r.tooltip,g=(s=c==null?void 0:c.mark)===null||s===void 0?void 0:s.checkOverlap;let p=!1;if(g===!0||((o=h.mark)===null||o===void 0?void 0:o.checkOverlap)===!0&&g!==!1){const m=u==null?void 0:u.activeTriggerSet.mark;if(m){p=!0;const v=this.component.getChart().getCompiler().getStage().getLayer(void 0),_={x:e.event.viewX,y:e.event.viewY};v.globalTransMatrix.transformPoint({x:e.event.viewX,y:e.event.viewY},_),m.forEach(b=>{b.getProductElements().forEach(y=>{const C=y.getGraphicItem();y!==e.item&&C&&C.containsPoint(_.x,_.y,lf.GLOBAL,C.stage.getPickerService())&&d[0].datum.push(y.getDatum())})})}}const f=Object.assign(Object.assign({},e),{model:l,changePositionOnly:i,tooltip:this.component});if(i&&p){const m=this._cacheActiveSpec&&this._cacheActiveSpec.data;m&&m[0].series===d[0].series&&m[0].datum.length===d[0].datum.length&&!m[0].datum.some((v,_)=>v!==d[0].datum[_])||(f.changePositionOnly=!1)}return this._showTooltipByHandler(d,f)}getMouseEventData(t){var e;let i,r;const s=(e=t.model)===null||e===void 0?void 0:e.modelType;if(s==="series"){const o=t.model,a=o.tooltipHelper,l=a==null?void 0:a.activeTriggerSet.mark,h=a==null?void 0:a.ignoreTriggerSet.mark;l!=null&&l.has(t.mark)?i={mark:t.mark,datum:t.datum,series:o}:h!=null&&h.has(t.mark)&&(r=!0)}else if(s==="component"){const o=t.model,a=t.node;if(o.name==="label"&&a){const l=o.getLabelInfoByTextGraphic(a),{baseMark:h,series:d,labelMark:u}=l??{},c=d.tooltipHelper,g=c==null?void 0:c.activeTriggerSet.mark,p=c==null?void 0:c.ignoreTriggerSet.mark;g!=null&&g.has(u)?i={mark:h,datum:a.attribute.data,series:d}:p!=null&&p.has(u)&&(r=!0)}}return{tooltipInfo:i,ignore:r}}}class TYt extends wH{constructor(){super(...arguments),this.activeType="group"}showTooltip(t,e,i){const{datum:r,series:s}=t,o=[{datum:Q(r),series:s}],a=Object.assign(Object.assign({},e),{groupDatum:this._getGroupDatum(e),changePositionOnly:i,tooltip:this.component});return this._showTooltipByHandler(o,a)}getMouseEventData(t){var e,i;let r;if(((e=t.model)===null||e===void 0?void 0:e.modelType)==="series"){const s=t.model,o=s.tooltipHelper,a=o==null?void 0:o.activeTriggerSet.group;if(a!=null&&a.has(t.mark)){const l=this.component.getSpec()[this.activeType];(l!=null&&l.triggerMark?Q(l.triggerMark):[]).includes((i=t.mark)===null||i===void 0?void 0:i.name)&&(r={mark:t.mark,datum:t.datum,series:s})}}return{tooltipInfo:r,ignore:!1}}_getGroupDatum(t){const{model:e,mark:i,datum:r}=t,s=e;if(["line","area"].includes(i.type))return Q(r);const o=s.getViewData().latestData,a=s.getSeriesField();if(!a)return o;const l=Q(r)[0][a];return o.filter(h=>h[a]===l)}}const E7=n=>L(n)&&!V(n),L7=n=>L(n)&&V(n);class qrt extends Bb{_shouldMergeThemeToSpec(){return!1}_initTheme(t,e){var i;const{spec:r,theme:s}=super._initTheme(t,e);return r.style=Nt({},this._theme,r.style),r.offset=Nt({},s.offset,t.offset),r.transitionDuration=(i=t.transitionDuration)!==null&&i!==void 0?i:s.transitionDuration,{spec:r,theme:s}}_transformSpecAfterMergingTheme(t,e,i){var r,s,o,a,l,h,d;super._transformSpecAfterMergingTheme(t,e,i),t.visible=(r=t.visible)===null||r===void 0||r,t.activeType=AGt(t),t.renderMode=(s=t.renderMode)!==null&&s!==void 0?s:Yd(this._option.mode)||!Ua(this._option.mode)?"canvas":"html",t.trigger=(o=t.trigger)!==null&&o!==void 0?o:"hover",t.className=(a=t.className)!==null&&a!==void 0?a:xYt,t.enterable=(l=t.enterable)!==null&&l!==void 0&&l,t.transitionDuration=(h=t.transitionDuration)!==null&&h!==void 0?h:150,t.confine=(d=t.confine)!==null&&d!==void 0?d:t.renderMode==="canvas",L(t.parentElement)?yt(t.parentElement)&&(t.parentElement=le.getElementById(t.parentElement)):Ua(this._option.mode)&&(t.parentElement=Xg==null?void 0:Xg.body)}}class m_ extends $r{constructor(){super(...arguments),this.layoutZIndex=1,this.type=vt.tooltip,this.name=vt.tooltip,this.transformerConstructor=qrt,this.specKey="tooltip",this.layoutType="none",this._isReleased=!1,this._alwaysShow=!1,this._eventList=[],this._isTooltipShown=!1,this._clickLock=!1,this._mountEvent=(t,e,i)=>{this.event.on(t,e,i),this._eventList.push({eventType:t,handler:i})},this._handleClickToLock=t=>{this._clickLock?(this._handleChartMouseOut(t),this._clickLock=!1):this._clickLock=!0},this._getMouseOutHandler=t=>e=>{var i,r,s,o,a;if(this._isReleased||this._alwaysShow||this._clickLock||!this._isTooltipShown&&!(!((r=(i=this.tooltipHandler)===null||i===void 0?void 0:i.isTooltipShown)===null||r===void 0)&&r.call(i)))return;const l=Ua((s=this._option)===null||s===void 0?void 0:s.mode),{clientX:h,clientY:d}=e.event;l&&t&&this._isPointerInChart({x:h,y:d})||(this._enterable?this._outTimer=setTimeout(()=>{this._handleChartMouseOut(e)},(a=(o=this._spec)===null||o===void 0?void 0:o.showDelay)!==null&&a!==void 0?a:oP):this._handleChartMouseOut(e))},this._handleChartMouseOut=t=>{this._alwaysShow||this._isReleased||this._isEnterTooltip||this._spec.triggerOff!=="none"&&(this._hideTooltipByHandler(Object.assign(Object.assign({},t),{tooltip:this})),this._handleMouseMove&&this._handleMouseMove.cancel&&this._handleMouseMove.cancel(),this._cacheEnterableRect=null,this._cacheInfo=void 0,this._cacheParams=void 0,this._cacheActiveType=void 0)},this._getMouseMoveHandler=t=>e=>{var i,r,s,o;this._isReleased||this._isEnterTooltip||(this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),this._alwaysShow||(this._clickLock?t&&(this._handleChartMouseOut(e),this._clickLock=!1):!t&&this._enterable&&(!((r=(i=this.tooltipHandler)===null||i===void 0?void 0:i.isTooltipShown)===null||r===void 0)&&r.call(i))?(this._showTimer&&clearTimeout(this._showTimer),this._showTimer=setTimeout(()=>{this._handleChartMouseMove(e,t)},(o=(s=this._spec)===null||s===void 0?void 0:s.showDelay)!==null&&o!==void 0?o:oP)):this._handleChartMouseMove(e,t)))},this._handleChartMouseMove=(t,e)=>{if(this._isReleased)return;const i=this._getMouseEventData(t),{tooltipInfo:{dimension:r},ignore:{mark:s}}=i,o={mark:!1,dimension:!1,group:!1};for(let a=0,l=P7.length;a<l;a++){const h=P7[a];if(this.processor[h]&&this._showTooltipByMouseEvent(h,i,t,e)){o[h]=!0;break}}Object.values(o).every(a=>!a)&&!MGt(t)&&(s&&E7(this._cacheInfo)?o.mark=this._showTooltipByMouseEvent("mark",i,t,e,!0):L(r)&&(o.dimension=this._showTooltipByMouseEvent("dimension",i,t,e))),o.mark||o.group||o.dimension&&!D(r)?this._initEventOfTooltipContent():this._handleChartMouseOut(t)},this._showTooltipByMouseEvent=(t,e,i,r,s)=>{var o;const a=this.processor[t];if(!a.shouldHandleTooltip(i,e.tooltipInfo[t]))return!1;let l;if(this._hideTimer&&clearTimeout(this._hideTimer),s)l=!a.showTooltip(this._cacheInfo,i,!0);else{const d=e.tooltipInfo[t],u=this._isSameAsCache(d,i,t);l=!a.showTooltip(d,i,u),l&&(this._cacheInfo=d,this._cacheParams=i,this._cacheActiveType=t)}l&&(this._isTooltipShown=!0,r&&this._spec.lockAfterClick&&!this._clickLock?this._clickLock=!0:Number.isFinite(this._spec.hideTimer)&&(this._hideTimer=setTimeout(()=>{this._handleChartMouseOut()},this._spec.hideTimer)));const h=(o=this._option)===null||o===void 0?void 0:o.globalInstance;return l&&zn.globalConfig.uniqueTooltip&&h&&zn.hideTooltip(h.id),l},this._getMouseEventData=t=>{const e={tooltipInfo:{},ignore:{}};return Object.keys(this.processor).forEach(i=>{const{tooltipInfo:r,ignore:s}=this.processor[i].getMouseEventData(t);e.tooltipInfo[i]=r,e.ignore[i]=s}),e},this._hideTooltipByHandler=t=>{var e,i,r;if(!this._isTooltipShown&&!(!((i=(e=this.tooltipHandler)===null||e===void 0?void 0:e.isTooltipShown)===null||i===void 0)&&i.call(e)))return 0;this.event.emit(Ot.tooltipHide,Object.assign(Object.assign({},t),{source:Ee.chart,tooltip:this})),Object.values(this.processor).forEach(o=>{o.clearCache()});const s=(r=this._spec.handler)!==null&&r!==void 0?r:this.tooltipHandler;if(s.hideTooltip){const o=s.hideTooltip.call(s,t);return o||(this._isTooltipShown=!1),o}return 1},this.hideTooltip=()=>{if(this._isReleased)return!1;const t={changePositionOnly:!1,tooltip:this,item:void 0,datum:void 0,source:Ee.chart};return this._alwaysShow=!1,!this._hideTooltipByHandler(t)}}isTooltipShown(){return this._isTooltipShown}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}_registerEvent(){}_releaseEvent(){}onLayout(t){}onLayoutEnd(t){}onRender(t){}created(){super.created(),this._regions=this._option.getAllRegions(),this._initEvent()}release(){var t,e;super.release(),this._isReleased=!0,this._hideTimer&&clearTimeout(this._hideTimer),this._eventList.forEach(({eventType:i,handler:r})=>{this.event.off(i,r)}),this._eventList=[],(e=(t=this.tooltipHandler)===null||t===void 0?void 0:t.release)===null||e===void 0||e.call(t),this._isTooltipShown=!1}beforeRelease(){this.event.emit(Ot.tooltipHide,{tooltip:this,chart:this.getChart()}),this.event.emit(Ot.tooltipRelease,{tooltip:this,chart:this.getChart()})}_initHandler(){var t,e,i;const r=(t=this._spec.renderMode)!==null&&t!==void 0?t:"html",s=this._option.globalInstance.getTooltipHandlerByUser();if(s)this.tooltipHandler=s,this._enterable=!1;else{const o=r==="canvas"?Pf.canvas:Pf.dom,a=q.getComponentPluginInType(o);a||h0("Can not find tooltip handler: "+o);const l=new a;l.name=`${this._spec.className}-${(e=this._option.globalInstance.id)!==null&&e!==void 0?e:0}-${this.getSpecIndex()}`,(i=this.pluginService)===null||i===void 0||i.load([l]),this.tooltipHandler=l,this._spec.enterable&&r==="html"&&this.tooltipHandler?(this._enterable=!0,this._needInitEventOfTooltip=!0):this._enterable=!1}}_initEventOfTooltipContent(){var t,e;if(!this._needInitEventOfTooltip)return;const i=(e=(t=this.tooltipHandler).getTooltipContainer)===null||e===void 0?void 0:e.call(t),r=i==null?void 0:i.firstChild;r&&(r.addEventListener("pointerenter",()=>{var s;if(!this._enterable)return;this._isEnterTooltip=!0;const o=(s=r.getBoundingClientRect)===null||s===void 0?void 0:s.call(r);o&&(this._cacheEnterableRect={x:o.x,y:o.y,width:o.width,height:o.height}),this._outTimer&&(clearTimeout(this._outTimer),this._outTimer=null),this._showTimer&&(clearTimeout(this._showTimer),this._showTimer=null)}),r.addEventListener("pointerleave",()=>{var s,o,a;if(this._enterable&&(this._isEnterTooltip=!1,this._cacheEnterableRect)){const l=(s=r.getBoundingClientRect)===null||s===void 0?void 0:s.call(r);l&&Object.keys(this._cacheEnterableRect).every(h=>this._cacheEnterableRect[h]===l[h])&&(this._cacheEnterableRect=null,this._outTimer=setTimeout(this.hideTooltip,(a=(o=this._spec)===null||o===void 0?void 0:o.showDelay)!==null&&a!==void 0?a:oP))}}),this._needInitEventOfTooltip=!1)}_initProcessor(){const t=this._spec.activeType;this.processor={},t.includes("dimension")&&(this.processor.dimension=new AYt(this)),t.includes("group")&&(this.processor.group=new TYt(this)),t.includes("mark")&&(this.processor.mark=new MYt(this))}_initEvent(){var t;if(this._option.disableTriggerEvent)return;const e=Q((t=this._spec.trigger)!==null&&t!==void 0?t:"hover"),i=Q(this._spec.triggerOff),r=this._option.mode;e.forEach(s=>{var o;s==="hover"?(this._handleMouseMove=this._throttle(this._getMouseMoveHandler(!1)),this._mountEvent("pointermove",{source:"chart"},this._handleMouseMove),(Pd(r)||Yd(r))&&(this._mountEvent("pointerdown",{source:"chart"},this._getMouseMoveHandler(!1)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))),this._mountEvent("pointerleave",{source:"chart"},this._getMouseOutHandler(!1))):s==="click"?(this._mountEvent("pointertap",{source:"chart"},this._getMouseMoveHandler(!0)),this._mountEvent("pointerup",{source:"window"},this._getMouseOutHandler(!0))):kt(s)&&this._mountEvent(s.eventType,{source:(o=s.source)!==null&&o!==void 0?o:"chart",consume:s.consume},this._getMouseMoveHandler(!0))}),i.filter(s=>kt(s)).forEach(s=>{var o,a;this._mountEvent(s.eventType,{source:(o=s.source)!==null&&o!==void 0?o:"chart",consume:s.consume},this._getMouseOutHandler((a=s.checkOutside)!==null&&a!==void 0&&a))}),!e.includes("click")&&this._spec.lockAfterClick&&this._mountEvent("pointertap",{source:"chart"},this._handleClickToLock)}_throttle(t){let e;return e=J(this._spec.throttleInterval)?this._spec.throttleInterval:this._spec.renderMode==="html"&&this._spec.transitionDuration?50:10,ha(t,e)}reInit(t){var e,i,r;if(super.reInit(t),this.tooltipHandler){const s=(e=this._spec.renderMode)!==null&&e!==void 0?e:"html",o=this._spec.enterable&&s==="html";o&&!this._enterable&&(this._needInitEventOfTooltip=!0),this._enterable=o,(r=(i=this.tooltipHandler).reInit)===null||r===void 0||r.call(i)}else this._initHandler()}showTooltip(t,e){var i;if(this.tooltipHandler||this._initHandler(),this.processor||this._initProcessor(),!(!((i=this.tooltipHandler)===null||i===void 0)&&i.showTooltip))return!1;const r=_Yt(t,e,this);return r!=="none"&&(this._alwaysShow=!!(e!=null&&e.alwaysShow)),r}_isSameAsCache(t,e,i){if(i!==this._cacheActiveType)return!1;if(t===this._cacheInfo)return!0;if(D(this._cacheInfo)||D(t))return!1;if(L7(t)){if(E7(this._cacheInfo))return!1;const o=this._cacheInfo;return o.length===t.length&&t.every((a,l)=>Eit(a,o[l]))}if(L7(this._cacheInfo))return!1;const r=this._cacheInfo;if(!((t==null?void 0:t.datum)===r.datum&&(t==null?void 0:t.mark)===r.mark&&(t==null?void 0:t.series)===r.series))return!1;const s=this._cacheParams;return!D(s)&&!D(e)&&s.mark===e.mark&&s.model===e.model&&s.datum===e.datum}_isPointerInChart(t){var e;const i=(e=this._option)===null||e===void 0?void 0:e.globalInstance;if(!i||!i.getChart())return!1;const{x:r,y:s}=t,o=i.getCanvas(),{x:a,y:l,width:h,height:d}=o.getBoundingClientRect();return r>=a&&r<=a+h&&s>=l&&s<=l+d}getVisible(){return this._spec.visible!==!1}}m_.type=vt.tooltip,m_.transformerConstructor=qrt,m_.specKey="tooltip";const kYt=()=>{q.registerComponent(m_.type,m_)};function RYt(n){return n===an["desktop-browser"]||n===an["desktop-miniApp"]?{click:"pointertap",hover:"pointermove",hoverOut:"pointerleave",clickOut:"pointerleave"}:Pd(n)||Yd(n)?{click:"tap",hover:["pointerdown","pointermove"],hoverOut:"pointerleave",clickOut:"pointerleave"}:null}var I7;(function(n){n[n.ALL=3]="ALL",n[n.HORIZONTAL=2]="HORIZONTAL",n[n.VERTICAL=1]="VERTICAL"})(I7||(I7={}));var O7=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const BYt={x:["top","bottom"],y:["left","right"],category:["angle"],value:["radius"]};class AH extends $r{get enableRemain(){return this.triggerOff==="none"}constructor(t,e){super(t,e),this.specKey="crosshair",this.layoutType="none",this.gridZIndex=Qe.CrossHair_Grid,this.labelZIndex=Qe.CrossHair,this.trigger="hover",this._handleIn=i=>{if(!this._option)return;const{x:r,y:s}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(r,s);const o=this._getNeedClearVRenderComponents();this._hasActive=o.some(a=>a&&a.attribute.visible!==!1)},this._handleClickInEvent=i=>{if(!this._hasActive||!this._spec.lockAfterClick||this._clickLock)return this._clickLock?(this._clickLock=!1,void this._handleOutEvent()):void(this._onlyLockClick||(this._handleIn(i),J(this.triggerOff)&&(this._timer&&clearTimeout(this._timer),this._timer=setTimeout(()=>{this._handleOutEvent()},this.triggerOff))));this._clickLock=!0},this._handleHoverInEvent=ha(i=>{this._clickLock||this._handleIn(i)},10),this._handleOutEvent=()=>{this.enableRemain||this._clickLock||!this._hasActive||(this.clearOutEvent(),this.hide())},this._handleTooltipShow=i=>{const r=i.tooltipData;if(i.isEmptyTooltip||!r||!r.length)return void this._handleTooltipHideOrRelease();if(kt(this._spec.followTooltip)&&this._spec.followTooltip[i.activeType]===!1)return void this._handleTooltipHideOrRelease();const{x:s,y:o}=this.calculateTriggerPoint(i);this.showDefault=!1,this._layoutCrosshair(s,o,r,i.activeType);const a=this._getNeedClearVRenderComponents();this._hasActive=a.some(l=>l&&l.attribute.visible!==!1)},this._handleTooltipHideOrRelease=()=>{this.clearOutEvent(),this.hide()},this.enable=!0,this.showDefault=!0}_setAllAxisValues(t,e,i){let r=!1;if(t.forEach(o=>{xr(o.axis.getScale().type)&&(r?this.enable=!1:r=!0)}),!this.enable)return!1;const{currentValue:s}=this._stateByField[i];return t.forEach((o,a)=>{const l=o.axis;s.set(a,{datum:this._getDatumAtPoint(l,e),axis:l})}),!0}clearAxisValue(){Object.keys(this._stateByField).forEach(t=>{this._stateByField[t].currentValue.clear()})}hideCrosshair(){this.clearAxisValue(),this.hide()}showCrosshair(t){t&&t.length&&(this.showDefault=!1,this.clearAxisValue(),t.forEach(e=>{const{axis:i,value:r}=e;this.setAxisValue(r,i)}),this.layoutByValue(!1))}_getLimitBounds(){var t,e;if(!this._limitBounds){const{width:i,height:r}=(e=(t=this._option.globalInstance.getChart())===null||t===void 0?void 0:t.getViewRect())!==null&&e!==void 0?e:{width:0,height:0};this._limitBounds={x1:0,y1:0,x2:i,y2:r}}return this._limitBounds}_showDefaultCrosshairBySpec(){Object.keys(this._stateByField).forEach(t=>{const e=this._spec[t];if(e&&e.visible&&e.defaultSelect){const{axisIndex:i=0,datum:r}=e.defaultSelect,s=this._option.getComponentsByKey("axes").find(o=>o.getSpecIndex()===i);s&&(this._stateByField[t].currentValue.clear(),this._stateByField[t].currentValue.set(i,{axis:s,datum:r}))}})}_updateVisibleCrosshair(){let t=!1;Object.keys(this._stateByField).forEach(e=>{const i=this._spec[e];i&&i.visible&&this._stateByField[e].currentValue.size?t=!0:this._hideByField(e)}),t&&this.layoutByValue(!1)}_showDefaultCrosshair(){this.showDefault?(this._showDefaultCrosshairBySpec(),this.layoutByValue(!1)):this._updateVisibleCrosshair()}setAttrFromSpec(){super.setAttrFromSpec(),this._parseCrosshairSpec()}created(){super.created(),this._initEvent()}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||Oe(e,t)||(i.reRender=!0,i.reMake=!0),i}_initEvent(){if(!this._option.disableTriggerEvent)if(this._spec.followTooltip)this._registerTooltipEvent();else{const t=this._getTriggerEvent();t&&t.forEach(e=>{this._registerEvent(e.in,!1,e.click),e.out&&this._registerEvent(e.out,!0)})}}_registerEvent(t,e,i){const r=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent,s=e?{level:mi.chart}:{source:Ee.chart};V(t)?t.forEach(o=>{this.event.on(o,s,r)}):this.event.on(t,s,r)}_eventOff(t,e,i){const r=e?this._handleOutEvent:i?this._handleClickInEvent:this._handleHoverInEvent;V(t)?t.forEach(s=>{this.event.off(s,r)}):this.event.off(t,r)}updateLayoutAttribute(){this._limitBounds=null,this._showDefaultCrosshair()}calculateTriggerPoint(t){const{event:e}=t,i=this._option.getCompiler().getStage().getLayer(void 0),r={x:e.viewX,y:e.viewY};return i.globalTransMatrix.transformPoint({x:e.viewX,y:e.viewY},r),{x:r.x-this.getLayoutStartPoint().x,y:r.y-this.getLayoutStartPoint().y}}_getTriggerEvent(){const{mode:t=an["desktop-browser"]}=this._option,e=RYt(t);if(e){const i=Q(this.trigger||"hover"),r=o=>o==="click"?this.triggerOff==="none"?null:e.clickOut:e.hoverOut;this._spec.lockAfterClick&&!i.includes("click")?(i.push("click"),this._onlyLockClick=!0):this._onlyLockClick=!1;const s=[];return i.forEach(o=>{s.push({click:o==="click",in:e[o],out:r(o)})}),s}return null}_registerTooltipEvent(){this.event.on(Ot.tooltipHide,{source:Ee.chart},this._handleTooltipHideOrRelease),this.event.on(Ot.tooltipShow,{source:Ee.chart},this._handleTooltipShow),this.event.on(Ot.tooltipRelease,{source:Ee.chart},this._handleTooltipHideOrRelease)}_getAxisInfoByField(t){var e,i;const r=(i=(e=this._option).getComponentsByKey)===null||i===void 0?void 0:i.call(e,"axes");if(!(r!=null&&r.length))return null;let s=Dt(this._spec,`${t}Field.bindingAxesIndex`);if(s||(s=[],r.forEach((g,p)=>{BYt[t].includes(g.getOrient())&&s.push(p)})),!s.length)return null;const o=new Map;let a=1/0,l=1/0,h=-1/0,d=-1/0;const{x:u,y:c}=this.getLayoutStartPoint();return s.forEach(g=>{a=1/0,l=1/0,h=-1/0,d=-1/0;const p=r.find(f=>f.getSpecIndex()===g);p&&(p.getRegions().forEach(f=>{const{x:m,y:v}=f.getLayoutStartPoint();a=Math.min(a,m-u),l=Math.min(l,v-c),h=Math.max(h,m+f.getLayoutRect().width-u),d=Math.max(d,v+f.getLayoutRect().height-c)}),o.set(g,{x1:a,y1:l,x2:h,y2:d,axis:p}))}),o}changeRegions(t){}onLayoutEnd(t){const e=this._regions[0];this.setLayoutRect(e.getLayoutRect()),this.setLayoutStartPosition(e.getLayoutStartPoint()),super.onLayoutEnd(t)}onRender(t){}_releaseEvent(){this.clearOutEvent();const t=this._getTriggerEvent();t&&t.forEach(e=>{this._eventOff(e.in,!1,e.click),e.out&&this._eventOff(e.out,!0)})}_parseFieldInfo(){Object.keys(this._stateByField).forEach(t=>{const e=this._spec[t],{crosshairComp:i}=this._stateByField[t];if(e&&e.visible){if(this._stateByField[t].attributes=this._parseField(e,t),i){const{style:r,type:s}=this._stateByField[t].attributes,o=s==="rect"?"rectStyle":"lineStyle";i.setAttributes({[o]:r})}}else i&&i.parent&&i.parent.removeChild(i)})}_parseCrosshairSpec(){this._parseFieldInfo();const{trigger:t,triggerOff:e,labelZIndex:i,gridZIndex:r}=this._spec;t&&(this.trigger=t),(e==="none"||J(e)&&e>0)&&(this.triggerOff=e),i!==void 0&&(this.labelZIndex=i),r!==void 0&&(this.gridZIndex=r)}_parseField(t,e){var i,r;const s={},{line:o={},label:a={},visible:l}=t;if(s.visible=l,s.type=o.type||"line",o.visible===!1)s.style={visible:!1};else{const h=o.style||{},{stroke:d,fill:u,lineWidth:c}=h,g=h,{strokeOpacity:p,fillOpacity:f,opacity:m}=g,v=O7(g,["strokeOpacity","fillOpacity","opacity"]),_=s.type==="line";let b=_?p:f;if(J(m)&&(b=(b??1)*m),s.style=Object.assign({opacity:b,pickable:!1,visible:!0},v),_)s.style.stroke=d||u,s.style.lineWidth=Dt(o,"width",c||2);else{s.style.fill=u||d,!((r=(i=t==null?void 0:t.line)===null||i===void 0?void 0:i.style)===null||r===void 0)&&r.stroke&&(s.style.stroke=t.line.style.stroke);const y=Dt(o,"width");if(typeof y=="string"){const C=parseInt(y.substring(0,y.length-1),10)/100;s.style.sizePercent=C}else typeof y!="number"&&typeof y!="function"||(s.style.size=y)}}if(a.visible){const h=a.labelBackground||{},d=a.style||{},u=h.style||{},{fill:c="rgba(47, 59, 82, 0.9)",stroke:g,outerBorder:p}=u,f=O7(u,["fill","stroke","outerBorder"]);s.label={visible:!0,formatMethod:a.formatMethod,formatter:a.formatter,minWidth:h.minWidth,maxWidth:h.maxWidth,padding:h.padding,textStyle:Object.assign(Object.assign({fontSize:14,pickable:!1},d),{fill:d.fill||"#fff",stroke:Dt(d,"stroke")}),panel:(Re(h.visible)?h.visible:h)?Object.assign({visible:!0,pickable:!1,fill:c,stroke:g,outerBorder:Object.assign({stroke:c,distance:0,lineWidth:3},p)},f):{visible:!1},zIndex:this.labelZIndex,childrenPickable:!1,pickable:!1}}else s.label={visible:!1};return s}_filterAxisByPoint(t,e,i){return t&&t.forEach(r=>{const s=r.axis;if(v3t(r,e,i)&&t.delete(s.getSpecIndex()),s.type.startsWith("polarAxis")){const o=s.getCenter(),a=s.getInnerRadius(),l=s.getOuterRadius(),h=hi.distancePP({x:e,y:i},o);(h>l||h<a)&&t.delete(s.getSpecIndex())}}),t}_updateCrosshairLabel(t,e,i){const r=this.getContainer();t?t.setAttributes(e):(t=new Ja(e),r==null||r.add(t),i(t)),QGt(t,this._getLimitBounds())}clearOutEvent(){this._timer&&(clearTimeout(this._timer),this._timer=null),this._clickLock&&(this._clickLock=null),this._hasActive&&(this._hasActive=null)}_hideByField(t){const{crosshairComp:e,labelsComp:i}=this._stateByField[t];e&&e.hideAll(),i&&Object.keys(i).forEach(r=>{i[r]&&i[r].hideAll()})}hide(){Object.keys(this._stateByField).forEach(t=>{this._hideByField(t)})}_getNeedClearVRenderComponents(){return Object.keys(this._stateByField).reduce((t,e)=>{const{crosshairComp:i,labelsComp:r}=this._stateByField[e];return i&&t.push(i),r&&Object.keys(r).forEach(s=>{r[s]&&t.push(r[s])}),t},[])}}AH.specKey="crosshair";const Zrt=(n,t,e,i=!1)=>(e||(e={x:0,y:0}),Object.keys(n).forEach(r=>{const{currentValue:s,cacheInfo:o,labelsComp:a,attributes:l,coordKey:h}=n[r];let d=null,u=0;if(s.size){const v=Array.from(s.values())[0];u=v.axis.getScale().scale(v.datum)+v.axis.getLayoutStartPoint()[h]-e[h],d=v.axis}const c=!!s.size&&Number.isFinite(u)&&!Number.isNaN(u),g=i&&!c&&L(o),p=g?o:{coordRange:[0,0],sizeRange:[0,0],coord:u,labelsTextStyle:{},labels:a?Object.keys(a).reduce((v,_)=>(v[_]={visible:!1,text:"",dx:0,dy:0},v),{}):null,visible:c,axis:d};let f;p&&(p._isCache=g);let m=0;if(l&&s.forEach(({axis:v,datum:_=""})=>{var b;let y=null;const C=v.getScale();if(xr(C.type))f=C.bandwidth(),f===0&&C.step&&(m=C.step());else if(Je(C.type)){const S=r==="xField"?t.fieldX[0]:t.fieldY[0],w=r==="xField"?t.fieldX2:t.fieldY2,x=t4t(t.getViewData().latestData,+_,S,w);if(x){const A=r==="xField"?t.dataToPositionX(x):t.dataToPositionY(x);w?(f=Math.abs(A-(r==="xField"?t.dataToPositionX1(x):t.dataToPositionY1(x))),_=`${x[S]} ~ ${x[w]}`):f=1,u=A}y=v.niceLabelFormatter}if(p&&(!((b=l.label)===null||b===void 0)&&b.visible)&&!g){const S=iH(v.getSpec()),w=v.getOrient();p.labels[w]&&(p.labels[w].visible=!0,p.labels[w].text=_,w==="left"?(p.labels[w].dx=-S,p.labelsTextStyle[w]={textAlign:"right",textBaseline:"middle"}):w==="right"?(p.labels[w].dx=S,p.labelsTextStyle[w]={textAlign:"left",textBaseline:"middle"}):w==="top"?(p.labels[w].y=0,p.labels[w].dy=-S,p.labelsTextStyle[w]={textAlign:"center",textBaseline:"bottom"}):w==="bottom"&&(p.labels[w].dy=S,p.labelsTextStyle[w]={textAlign:"center",textBaseline:"top"}),p.labels[w].defaultFormatter=y)}}),p&&!g){const v={x1:1/0,y1:1/0,x2:-1/0,y2:-1/0};EYt(v,s),r==="xField"?(p.coordRange=[v.x1,v.x2],p.sizeRange=[v.y1,v.y2],p.coord=u+e.x,p.labels&&(p.labels.top.y=v.y1,p.labels.bottom.y=v.y2)):(p.coordRange=[v.y1,v.y2],p.sizeRange=[v.x1,v.x2],p.coord=u+e.y,p.labels&&(p.labels.left.x=v.x1,p.labels.right.x=v.x2)),(p.coord<p.coordRange[0]||p.coord>p.coordRange[1])&&(p.visible=!1),l&&l.label&&Object.keys(p.labels).forEach(_=>{p.labels[_].visible&&PYt(p.labels[_],_,l.label)})}n[r].bandSize=f??0,n[r].offsetSize=m,n[r].cacheInfo=p}),n),PYt=(n,t,e)=>{const{formatMethod:i,formatter:r}=e,{formatFunc:s,args:o}=sh(i,r,n.text,{label:n.text,position:t});s?n.text=s(...o):n.defaultFormatter&&(n.text=n.defaultFormatter(n.text))},EYt=(n,t)=>{t.forEach(({axis:e})=>{e.getRegions().forEach(i=>{const{x:r,y:s}=i.getLayoutStartPoint(),{width:o,height:a}=i.getLayoutRect();n.x1=Math.min(n.x1,r),n.y1=Math.min(n.y1,s),n.x2=Math.max(n.x2,r+o),n.y2=Math.max(n.y2,s+a)})})},GI=n=>{const{cacheInfo:t,attributes:e,bandSize:i,offsetSize:r,coordKey:s,anotherAxisKey:o}=n,{coord:a,sizeRange:l}=t,h=e.type;let d;if(h==="line"){const u=a+i/2;d={visible:!0,start:{[s]:u,[o]:l[0]},end:{[s]:u,[o]:l[1]}}}else if(h==="rect"){const[u,c]=LYt(e,i,r,t.axis),{coordRange:g}=t;d={visible:!0,start:{[s]:Math.max(a+u,g[0]),[o]:l[0]},end:{[s]:Math.min(a+c,g[1]),[o]:l[1]}}}return d},LYt=(n,t,e,i)=>{var r,s,o;const a=t===0?e:t;let l=a;if(!((r=n.style)===null||r===void 0)&&r.sizePercent)l=a*n.style.sizePercent;else if(typeof((s=n.style)===null||s===void 0?void 0:s.size)=="number")l=n.style.size;else if(typeof((o=n.style)===null||o===void 0?void 0:o.size)=="function"){const h=i.getLayoutRect();l=n.style.size(h,i)}return t===0?[-l/2,l/2]:[t/2-l/2,l/2+t/2]};class vA extends AH{static getSpecInfo(t){return la(t,this.specKey,this.type,e=>e.xField&&e.xField.visible!==!1||e.yField&&e.yField.visible!==!1)}constructor(t,e){super(t,e),this.type=vt.cartesianCrosshair,this.name=vt.cartesianCrosshair,this._stateByField={xField:{coordKey:"x",anotherAxisKey:"y",currentValue:new Map,labelsComp:{top:null,bottom:null}},yField:{coordKey:"y",anotherAxisKey:"x",currentValue:new Map,labelsComp:{left:null,right:null}}}}_findAllAxisContains(t,e){const i=this._getAxisInfoByField("x"),r=this._getAxisInfoByField("y");return{xAxisMap:this._filterAxisByPoint(i,t,e),yAxisMap:this._filterAxisByPoint(r,t,e)}}_getDatumAtPoint(t,e){const i=xi(t.getOrient())?"x":"y",r=e[i]-(t.getLayoutStartPoint()[i]-this.getLayoutStartPoint()[i]);return t.getScale().invert(r)}setAxisValue(t,e){xi(e.getOrient())?this._stateByField.xField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e}):this._stateByField.yField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e})}_layoutCrosshair(t,e,i,r){var s;let o=t,a=e;if(i&&i.length){if(r==="dimension"){const d=i[0],u=d.data.findIndex(g=>g.datum.length>0);let c;if(u>-1){const g=d.data[u];c=g.series.dataToPosition(g.datum[0])}(L(d.dimType)?d.dimType==="y":Fa((s=d==null?void 0:d.axis)===null||s===void 0?void 0:s.getOrient()))?a=c==null?void 0:c.y:o=c==null?void 0:c.x}else if(r==="mark"){const d=i[0],u=d.series.dataToPosition(d.datum[0]);o=u==null?void 0:u.x,a=u==null?void 0:u.y}}this.clearAxisValue();const{xAxisMap:l,yAxisMap:h}=this._findAllAxisContains(o,a);if(l&&l.size===0||h&&h.size===0){if(this.enableRemain)return;this.hide()}else l&&l.size&&this._setAllAxisValues(l,{x:o,y:a},"xField"),h&&h.size&&this._setAllAxisValues(h,{x:o,y:a},"yField"),this.layoutByValue()}layoutByValue(t){if(!this.enable)return;const e=kF(this._regions,"cartesian");e&&(Zrt(this._stateByField,e,this.getLayoutStartPoint(),t??this.enableRemain),Object.keys(this._stateByField).forEach(i=>{this._layoutByField(i)}))}_layoutByField(t){const{cacheInfo:e,attributes:i,labelsComp:r,bandSize:s,coordKey:o}=this._stateByField[t];if(!i||!e||e._isCache&&this.enableRemain)return;const{coord:a,labels:l,visible:h,labelsTextStyle:d}=e;if(h){const u=GI(this._stateByField[t]);this._updateCrosshairByField(t,u),Object.keys(l).forEach(c=>{var g;if(l[c].visible){const p=Object.assign(Object.assign(Object.assign({[o]:a+s/2},l[c]),i.label),{textStyle:Object.assign(Object.assign({},(g=i.label)===null||g===void 0?void 0:g.textStyle),d[c]),zIndex:this.labelZIndex,visible:!0});this._updateCrosshairLabel(r[c],p,f=>{f.name=`crosshair-${t.replace("Field","")}-${c}-label`,r[c]=f})}else r[c]&&r[c].hideAll()})}else this._hideByField(t)}_updateCrosshairByField(t,e){const i=this.getContainer(),{attributes:r}=this._stateByField[t];let{crosshairComp:s}=this._stateByField[t];if(s)s.setAttributes(e);else{const o=r.style;r.type==="line"?s=new yb(Object.assign(Object.assign({},e),{lineStyle:o,zIndex:this.gridZIndex+1,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1})):r.type==="rect"&&(s=new sT(Object.assign(Object.assign({},e),{rectStyle:o,zIndex:this.gridZIndex,disableTriggerEvent:this._option.disableTriggerEvent,pickable:!1}))),i==null||i.add(s),this._stateByField[t].crosshairComp=s}}}vA.specKey="crosshair",vA.type=vt.cartesianCrosshair;const IYt=()=>{q.registerComponent(vA.type,vA)},OYt=(n,t,e=!1)=>{Object.keys(n).forEach(i=>{const{attributes:r,currentValue:s,cacheInfo:o,coordKey:a}=n[i];if(r){const l=!!s.size,h=e&&!l&&L(o),d=h?o:{coord:0,axis:null,visible:l,coordRange:[0,0],sizeRange:[0,0],labels:{all:{visible:!1,text:"",offset:0}}};if(o&&(o._isCache=h),i==="valueField"&&(d.sides=t.angleAxisHelper.getScale(0).domain().length),s.forEach(({axis:u,datum:c=""})=>{var g;const p=u.niceLabelFormatter;if(!((g=r.label)===null||g===void 0)&&g.visible&&(d.labels.all.visible=!0,d.labels.all.defaultFormatter=p,d.labels.all.text=c,d.labels.all.offset=iH(u.getSpec())),i==="categoryField"){const f=t.angleAxisHelper.dataToPosition([c]),m=t.angleAxisHelper.getBandwidth(0),v=u.getOuterRadius();d.coord=f,d.coordRange=[f-m/2,f+m/2],d.sizeRange=[v,v]}else{const f=u.startAngle,m=t.radiusAxisHelper.dataToPosition([c]);d.coord=m,d.coordRange=[m,m],d.sizeRange=[f,f]}d.axis=u}),d&&!h&&d.labels.all.visible&&r&&r.label){const u=d.labels.all,{formatMethod:c,formatter:g}=r.label,{formatFunc:p,args:f}=sh(c,g,u.text,{label:u.text,orient:a});p?u.text=p(...f):u.defaultFormatter&&(u.text=u.defaultFormatter(u.text))}n[i].cacheInfo=d}})},DYt=(n,t,e)=>{const{cacheInfo:i,coordKey:r,attributes:s}=n,{axis:o,coord:a,sizeRange:l,coordRange:h}=i,d=o.getCenter(),u={x:d.x+t.x,y:d.y+t.y};if(r==="angle")return(s.type==="rect"?"sector":"line")=="sector"?{center:u,innerRadius:o.getInnerRadius(),radius:o.getOuterRadius(),startAngle:h[0],endAngle:h[1]}:{start:ui(u,o.getInnerRadius(),a),end:ui(u,o.getOuterRadius(),a)};const c=o.startAngle,g=o.endAngle,p=i.sides;let f=a;if(!e){const m=o.getCenter(),v=o.coordToPoint({angle:l[0],radius:a}),_=TY(m,v),b=(g-c)/p,y=Math.floor((_-c)/b),C=y*b+c,S=Math.min((y+1)*b+c,g),w=ui(m,a,C),x=ui(m,a,S),A=ylt([x.x,x.y],[w.x,w.y],[m.x,m.y],[v.x,v.y]);A&&(f=Ne(hi.distancePN(v,A[0],A[1])+a,o.getInnerRadius(),o.getOuterRadius()))}return{center:u,startAngle:c,endAngle:g,radius:f,sides:p}};class _A extends AH{static getSpecInfo(t){return la(t,this.specKey,this.type,e=>e.categoryField&&e.categoryField.visible!==!1||e.valueField&&e.valueField.visible!==!1)}constructor(t,e){super(t,e),this.type=vt.polarCrosshair,this.name=vt.polarCrosshair,this._stateByField={categoryField:{coordKey:"angle",anotherAxisKey:"radius",currentValue:new Map,labelsComp:{all:null}},valueField:{coordKey:"radius",anotherAxisKey:"angle",currentValue:new Map,labelsComp:{all:null}}}}setAxisValue(t,e){e.getOrient()==="radius"?this._stateByField.valueField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e}):this._stateByField.categoryField.currentValue.set(e.getSpecIndex(),{datum:t,axis:e})}_findAllAxisContains(t,e){const i=this._getAxisInfoByField("category"),r=this._getAxisInfoByField("value");return{angleAxisMap:this._filterAxisByPoint(i,t,e),radiusAxisMap:this._filterAxisByPoint(r,t,e)}}_getDatumAtPoint(t,e){const{x:i,y:r}=t.getLayoutStartPoint(),{x:s,y:o}=this.getLayoutStartPoint();return t.positionToData({x:e.x-(i-s),y:e.y-(r-o)})}_layoutCrosshair(t,e,i,r){let s=t,o=e;if(i&&i.length){if(r==="dimension"){const h=i[0];if(h.axis){const d=h.axis.pointToCoord({x:s,y:o}),u=h.axis.getOrient()==="radius"?{radius:h.position,angle:d.angle}:{radius:d.radius,angle:h.position},c=h.axis.coordToPoint(u);s=c.x,o=c.y}}else if(r==="mark"){const h=i[0],d=h.series.dataToPosition(h.datum[0]);s=d.x,o=d.y}}this.clearAxisValue();const{angleAxisMap:a,radiusAxisMap:l}=this._findAllAxisContains(s,o);if(a.size!==0||l.size!==0)a&&this._setAllAxisValues(a,{x:s,y:o},"categoryField"),l&&this._setAllAxisValues(l,{x:s,y:o},"valueField"),this.layoutByValue();else{if(this.enableRemain)return;this.hide()}}layoutByValue(t){if(!this.enable)return;const e=kF(this._regions,"polar");e&&(OYt(this._stateByField,e,t??this.enableRemain),Object.keys(this._stateByField).forEach(i=>{this._layoutByField(i)}))}_layoutByField(t){var e,i,r;const{cacheInfo:s,attributes:o,crosshairComp:a,labelsComp:l,coordKey:h}=this._stateByField[t];if(!s||s._isCache&&this.enableRemain)return;const d=this.getContainer(),{visible:u,labels:c,coord:g,sizeRange:p,axis:f}=s;if(u){const m=this.getLayoutStartPoint(),v=(i=(e=this._spec.valueField)===null||e===void 0?void 0:e.line)===null||i===void 0?void 0:i.smooth,_=DYt(this._stateByField[t],m,v);if(a)a.setAttributes(_);else{let y;if(h==="angle"){const C=o.type==="rect"?"sector":"line";C==="line"?y=new yb(Object.assign(Object.assign({},_),{lineStyle:o.style,zIndex:this.gridZIndex,pickable:!1})):C==="sector"&&(y=new aT(Object.assign(Object.assign({},_),{sectorStyle:o.style,zIndex:this.gridZIndex,pickable:!1})))}else y=(v?"circle":"polygon")=="polygon"?new lT(Object.assign(Object.assign({},_),{lineStyle:o.style,zIndex:this.gridZIndex+1})):new oT(Object.assign(Object.assign({},_),{lineStyle:o.style,zIndex:this.gridZIndex}));this._stateByField[t].crosshairComp=y,d.add(y)}const b=c.all;if(b.visible){const y=f.getCenter(),C={x:y.x+m.x,y:y.y+m.y},S=h==="angle"?zFt(g):C3t(f.startAngle),w=h==="angle"?ui(C,p[1]+b.offset,g):ui(C,_.radius,f.startAngle),x=Object.assign(Object.assign(Object.assign(Object.assign({},w),o.label),b),{textStyle:Object.assign(Object.assign({},(r=o.label)===null||r===void 0?void 0:r.textStyle),{textAlign:S.align,textBaseline:S.baseline}),zIndex:this.labelZIndex});this._updateCrosshairLabel(l.all,x,A=>{A.name=`crosshair-${h}-label`,l.all=A})}else l.all&&l.all.hideAll()}}}_A.specKey="crosshair",_A.type=vt.polarCrosshair;const FYt=()=>{q.registerComponent(_A.type,_A)},HYt=(n,t)=>{const{getNewDomain:e,isContinuous:i,field:r,originalFields:s}=t,o=r(),a=e();if(D(a)||D(o))return n;const l=s(),h=V(o)?o[0]:o;return n[h]&&l&&l[h]&&l[h].lockStatisticsByDomain&&!i()&&(n[h].values=a),n},zYt=(n,t)=>{const{getNewDomain:e,isContinuous:i,field:r}=t,s=r(),o=e();if(D(o)||D(s))return n;if(o.length===0)return[];const a={};o.forEach(h=>{a[h]||(a[h]=1)});let l=null;return l=i()?h=>{let d=!1;return Q(s).every(u=>{h[u]>=o[0]&&h[u]<=de(o)&&(d=!0)}),d}:h=>{let d=!1;return Q(s).every(u=>{(a[h[u]+""]||a[h[u]])&&(d=!0)}),d},n.filter(l)},WYt=(n,t)=>{const{stateFields:e,valueFields:i,dataCollection:r}=t.input,{stateField:s,valueField:o}=t.output,a={},l=[];return r.forEach((h,d)=>{var u;if(D(e[d]))return;const c=(u=h.getFields())===null||u===void 0?void 0:u[e[d]];c&&c.lockStatisticsByDomain&&c.domain.forEach(g=>{a[g]=0}),h.latestData.forEach(g=>{Q(e[d]).forEach(p=>{D(g[p])||(D(a[g[p]])&&(a[g[p]]=0),D(i[d])||(a[g[p]]+=isNaN(parseFloat(g[i[d]]))?1:parseFloat(g[i[d]])))})})}),Object.keys(a).forEach((h,d)=>{const u={[s]:h};o&&(u[o]=a[h]),l.push(u)}),l};class MH extends $r{get relatedAxisComponent(){return this._relatedAxisComponent}setStartAndEnd(t,e,i=["percent","percent"]){const[r="percent",s="percent"]=i,o=r==="percent"?t:this.dataToStatePoint(t),a=s==="percent"?e:this.dataToStatePoint(e);this._handleChange(o,a,!0)}enableInteraction(){this._activeRoam=!0}disableInteraction(){this._activeRoam=!1}zoomIn(t){this._handleChartZoom({zoomDelta:1.2,zoomX:t==null?void 0:t.x,zoomY:t==null?void 0:t.y})}zoomOut(t){this._handleChartZoom({zoomDelta:.8,zoomX:t==null?void 0:t.x,zoomY:t==null?void 0:t.y})}_handleChange(t,e,i){var r,s;(s=(r=this._spec)===null||r===void 0?void 0:r.zoomLock)!==null&&s!==void 0&&s||e-t!==this._spanCache&&(e-t<this._minSpan||e-t>this._maxSpan)?this._shouldChange=!1:(this._shouldChange=!0,this._spanCache=e-t)}_isReverse(){const t=this._relatedAxisComponent;if(!t)return!1;const e=t.getScale();return e.range()[0]>e.range()[1]&&(!t.getInverse()||this._isHorizontal)}_updateRangeFactor(t){const e=this._relatedAxisComponent.getScale(),i=this._isReverse(),r=i?[1-this._end,1-this._start]:[this._start,this._end];if(i)switch(t){case"startHandler":e.rangeFactorEnd(r[1]);break;case"endHandler":e.rangeFactorStart(r[0]);break;default:e.rangeFactorStart(r[0],!0),e.rangeFactorEnd(r[1])}else switch(t){case"startHandler":e.rangeFactorStart(r[0]);break;case"endHandler":e.rangeFactorEnd(r[1]);break;default:e.rangeFactorEnd(r[1],!0),e.rangeFactorStart(r[0])}const s=e.rangeFactor();s?(this._start=i?1-s[1]:s[0],this._end=i?1-s[0]:s[1]):(this._start=0,this._end=1)}get visible(){return this._visible}constructor(t,e){super(t,e),this.layoutType="none",this._orient="left",this._cacheVisibility=void 0,this._dataUpdating=!1,this._shouldChange=!0,this._stateField="x",this._activeRoam=!0,this._zoomAttr={enable:!0,rate:1,focus:!0},this._dragAttr={enable:!0,rate:1,reverse:!0},this._scrollAttr={enable:!0,rate:1,reverse:!0},this.effect={onZoomChange:i=>{var r,s;const o=this._relatedAxisComponent;if(o&&this._filterMode==="axis"){const a=o.getScale(),l=o.getSpec();this._auto&&this._getAxisBandSize(l)&&this._spec.ignoreBandSize&&(a.bandwidth("auto"),a.maxBandwidth("auto"),a.minBandwidth("auto")),this._updateRangeFactor(i),this._auto&&((s=(r=this._component)===null||r===void 0?void 0:r.setStartAndEnd)===null||s===void 0||s.call(r,this._start,this._end)),o.effect.scaleUpdate({value:"force"})}else Oi(this._regions,a=>{var l;(l=a.getViewData())===null||l===void 0||l.markRunning()},{userId:this._seriesUserId,specIndex:this._seriesIndex}),Oi(this._regions,a=>{a.reFilterViewData()},{userId:this._seriesUserId,specIndex:this._seriesIndex})}},this._visible=!0,this._handleStateChange=(i,r,s)=>{var o,a;return this._startValue=i,this._endValue=r,this._newDomain=this._parseDomainFromState(this._startValue,this._endValue),(a=(o=this.effect).onZoomChange)===null||a===void 0||a.call(o,s),!0},this._handleChartZoom=(i,r)=>{var s,o;if(!this._activeRoam||this._zoomAttr.filter&&!this._zoomAttr.filter(i,r))return;const{zoomDelta:a,zoomX:l,zoomY:h}=i,{x:d,y:u}=this._regions[0].getLayoutStartPoint(),{width:c,height:g}=this._regions[0].getLayoutRect(),p=Math.abs(this._start-this._end),f=(o=(s=this._spec.roamZoom)===null||s===void 0?void 0:s.rate)!==null&&o!==void 0?o:1;if(p>=1&&a<1||p<=.01&&a>1)return;const m=this._isHorizontal?l:h,v=p*(a-1)*f;let _=v/2,b=v/2;if(m){const S=this._isHorizontal?d:u,w=this._isHorizontal?c:g;_=Math.abs(S-m)/Math.abs(w-S)*v,b=Math.abs(w-m)/Math.abs(w-S)*v}const y=Ne(this._start+_,0,1),C=Ne(this._end-b,0,1);this._handleChange(Math.min(y,C),Math.max(y,C),!0)},this._handleChartScroll=(i,r)=>{var s;if(!this._activeRoam||this._scrollAttr.filter&&!this._scrollAttr.filter(i,r))return!1;const{scrollX:o,scrollY:a}=i;let l=this._isHorizontal?o:a;const h=this._isHorizontal?Et(o/a)>=.5:Et(a/o)>=.5;this._scrollAttr.reverse||(l=-l),h&&this._handleChartMove(l,(s=this._scrollAttr.rate)!==null&&s!==void 0?s:1);const d=this._start!==0&&this._end!==1;return h&&d},this._handleChartDrag=(i,r)=>{var s;if(!this._activeRoam||this._dragAttr.filter&&!this._dragAttr.filter(i,r))return;const[o,a]=i;let l=this._isHorizontal?o:a;this._dragAttr.reverse&&(l=-l),this._handleChartMove(l,(s=this._dragAttr.rate)!==null&&s!==void 0?s:1)},this._handleChartMove=(i,r)=>{const s=this._isHorizontal?this.getLayoutRect().width:this.getLayoutRect().height;if(Math.abs(i)>=1e-6){if(i>0&&this._end<1){const o=Math.min(1-this._end,i/s)*r;this._handleChange(this._start+o,this._end+o,!0)}else if(i<0&&this._start>0){const o=Math.max(-this._start,i/s)*r;this._handleChange(this._start+o,this._end+o,!0)}}return!1},this._orient=Bu(t),this._isHorizontal=Iit(this._orient)==="horizontal"}created(){super.created(),this._setAxisFromSpec(),this._setRegionsFromSpec(),this._initEvent(),this._initData(),this._initStateScale(),this._setStateFromSpec()}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}_setAxisFromSpec(){if(L(this._spec.axisId)?this._relatedAxisComponent=this._option.getComponentByUserId(this._spec.axisId):L(this._spec.axisIndex)&&(this._relatedAxisComponent=this._option.getComponentByIndex("axes",this._spec.axisIndex)),D(this._spec.field)&&!this._relatedAxisComponent){const t=this._option.getComponentsByKey("axes"),e=t.find(i=>i._orient===this._orient);if(e)this._relatedAxisComponent=e;else{const i=t.find(r=>!Je(r.getScale().type));this._relatedAxisComponent=i}}this._relatedAxisComponent&&this._filterMode==="axis"&&(this._relatedAxisComponent.autoIndentOnce=!0)}_setRegionsFromSpec(){var t,e;this._regions=this._relatedAxisComponent?this._relatedAxisComponent.getRegions():this._option.getAllRegions();const i=this._relatedAxisComponent?(e=(t=this._relatedAxisComponent).getBindSeriesFilter)===null||e===void 0?void 0:e.call(t):null;if(L(i)&&(L(i.userId)&&(this._seriesUserId=Q(i.userId)),L(i.specIndex)&&(this._seriesIndex=Q(i.specIndex))),L(this._spec.seriesId)){const r=Q(this._spec.seriesId);this._seriesUserId?this._seriesUserId=this._seriesUserId.filter(s=>r.includes(s)):this._seriesUserId=r}if(L(this._spec.seriesIndex)){const r=Q(this._spec.seriesIndex);this._seriesIndex?this._seriesIndex=this._seriesIndex.filter(s=>r.includes(s)):this._seriesIndex=r}if(L(this._spec.regionIndex)){const r=this._option.getRegionsInIndex(Q(this._spec.regionIndex));this._regions=this._regions.filter(s=>r.includes(s))}else if(L(this._spec.regionId)){const r=Q(this._spec.regionId);this._regions=r.length?this._regions.filter(s=>r.includes(s.id)):[]}}onDataUpdate(){var t;const e=this._computeDomainOfStateScale(Je(this._stateScale.type));this._stateScale.domain(e,!1),this._handleChange(this._start,this._end,!0),this._spec.auto&&!Oe(this._domainCache,e)&&(this._domainCache=e,this._dataUpdating=!0,(t=this.getChart())===null||t===void 0||t.setLayoutTag(!0,null,!1))}_computeDomainOfStateScale(t){if(this._spec.customDomain)return this._spec.customDomain;const e=this._data.getLatestData().map(i=>i[this._stateField]);if(t){const i=e.map(r=>1*r);return e.length?[Ri(i),Mi(i)]:[-1/0,1/0]}return e}_initEvent(){this._initCommonEvent()}_initData(){const t=[],e=[],i=[];if(this._relatedAxisComponent){const o={};Oi(this._regions,a=>{var l,h;const d=a.coordinate==="cartesian"?a.getXAxisHelper():a.coordinate==="polar"?a.angleAxisHelper:null,u=a.coordinate==="cartesian"?a.getYAxisHelper():a.coordinate==="polar"?a.radiusAxisHelper:null;if(!d||!u)return;const c=d.getAxisId()===this._relatedAxisComponent.id?d:u.getAxisId()===this._relatedAxisComponent.id?u:this._isHorizontal?d:u,g=c===d?u:d,p=Je(g.getScale(0).type),f=Je(c.getScale(0).type);t.push(a.getRawData());const m=a.getSpec(),v=a.coordinate==="cartesian"?Q(m.xField):Q((l=m.angleField)!==null&&l!==void 0?l:m.categoryField),_=a.coordinate==="cartesian"?Q(m.yField):Q((h=m.radiusField)!==null&&h!==void 0?h:m.valueField);if(o[a.id]=a.type==="link"?["from_xField"]:c===d?v:_,f?e.push(o[a.id]):e.push(o[a.id][0]),this._valueField){const b=a.type==="link"?["from_yField"]:g===d?v:_;p&&i.push(...b)}},{userId:this._seriesUserId,specIndex:this._seriesIndex}),this._originalStateFields=o}else Oi(this._regions,o=>{t.push(o.getRawData()),e.push(this._field),this._valueField&&i.push(this._spec.valueField)},{userId:this._seriesUserId,specIndex:this._seriesIndex});const{dataSet:r}=this._option;Xl(r,"dataview",LM),Vt(r,"dataFilterComputeDomain",WYt);const s=new Ve(r,{name:`${this.type}_${this.id}_data`});s.transform({type:"dataFilterComputeDomain",options:{input:{dataCollection:t,stateFields:e,valueFields:i},output:{stateField:this._stateField,valueField:this._valueField}}},!1),this._data=new Qa(this._option,s),s.reRunAllTransform(),r.multipleDataViewAddListener(t,"change",this._handleDataCollectionChange.bind(this))}setAttrFromSpec(){var t;super.setAttrFromSpec(),this._spec.roamZoom===!0||this._spec.roamZoom?this._zoomAttr=Z({},this._zoomAttr,this._spec.roamZoom):this._zoomAttr.enable=!1,this._spec.roamDrag===!0||this._spec.roamDrag?this._dragAttr=Z({},this._dragAttr,this._spec.roamDrag):this._dragAttr.enable=!1,this._spec.roamScroll===!0||this._spec.roamScroll?this._scrollAttr=Z({},this._scrollAttr,this._spec.roamScroll):this._scrollAttr.enable=!1,this._field=this._spec.field,this._width=this._computeWidth(),this._height=this._computeHeight(),this._visible=(t=this._spec.visible)===null||t===void 0||t}statePointToData(t){const e=this._stateScale,i=e.domain();if(Je(e.type))return this._isReverse()?i[0]+(de(i)-i[0])*(1-t):i[0]+(de(i)-i[0])*t;let r=e.range();this._isReverse()&&(r=r.slice().reverse());const s=r[0]+(de(r)-r[0])*t;return e.invert(s)}dataToStatePoint(t){const e=this._stateScale,i=e.scale(t);let r=e.range();return!this._isHorizontal&&Je(e.type)&&(r=r.slice().reverse()),(i-r[0])/(de(r)-r[0])}_modeCheck(t,e){return t==="start"?e==="percent"&&L(this._spec.start)||e==="value"&&L(this._spec.startValue):e==="percent"&&L(this._spec.end)||e==="value"&&L(this._spec.endValue)}_setStateFromSpec(){var t,e;let i,r;if(this._auto=!!this._spec.auto,this._spec.rangeMode){const[s,o]=this._spec.rangeMode;this._modeCheck("start",s)&&this._modeCheck("end",o)&&(i=s==="percent"?this._spec.start:this.dataToStatePoint(this._spec.startValue),r=o==="percent"?this._spec.end:this.dataToStatePoint(this._spec.endValue))}else i=this._spec.start?this._spec.start:this._spec.startValue?this.dataToStatePoint(this._spec.startValue):0,r=this._spec.end?this._spec.end:this._spec.endValue?this.dataToStatePoint(this._spec.endValue):1;this._startValue=this.statePointToData(i),this._endValue=this.statePointToData(r),this._start=i,this._end=r,this._minSpan=(t=this._spec.minSpan)!==null&&t!==void 0?t:0,this._maxSpan=(e=this._spec.maxSpan)!==null&&e!==void 0?e:1,Je(this._stateScale.type)&&this._stateScale.domain()[0]!==de(this._stateScale.domain())&&(this._spec.minValueSpan&&(this._minSpan=this._spec.minValueSpan/(de(this._stateScale.domain())-this._stateScale.domain()[0])),this._spec.maxValueSpan&&(this._maxSpan=this._spec.maxValueSpan/(de(this._stateScale.domain())-this._stateScale.domain()[0]))),this._minSpan=Math.max(0,this._minSpan),this._maxSpan=Math.min(this._maxSpan,1),this._relatedAxisComponent&&this._filterMode==="axis"||this._start===0&&this._end===1||(this._newDomain=this._parseDomainFromState(this._startValue,this._endValue))}_parseFieldOfSeries(t){var e;return(e=this._originalStateFields)===null||e===void 0?void 0:e[t.id]}_initStateScale(){const t=[0,1];if(this._relatedAxisComponent){const e=this._relatedAxisComponent.getScale(),i=Je(e.type),r=this._computeDomainOfStateScale(i);if(this._stateScale=e.clone(),i){const s=r.map(o=>1*o);this._stateScale.domain(r.length?[Ri(s),Mi(s)]:[0,1],!0).range(t)}else this._stateScale.domain(r,!0).range(t)}else this._stateScale=new qc,this._stateScale.domain(this._computeDomainOfStateScale(),!0).range(t)}init(t){super.init(t),this._addTransformToSeries(),this._start===0&&this._end===1||this.effect.onZoomChange()}_addTransformToSeries(){this._relatedAxisComponent&&this._filterMode==="axis"||(Vt(this._option.dataSet,"dataFilterWithNewDomain",zYt),Vt(this._option.dataSet,"lockStatisticsFilter",HYt),Oi(this._regions,t=>{t.getViewDataStatistics().transform({type:"lockStatisticsFilter",options:{originalFields:()=>t.getViewDataStatistics().getFields(),getNewDomain:()=>this._newDomain,field:()=>{var e;return(e=this._field)!==null&&e!==void 0?e:this._parseFieldOfSeries(t)},isContinuous:()=>Je(this._stateScale.type)},level:1},!1),t.addViewDataFilter({type:"dataFilterWithNewDomain",options:{getNewDomain:()=>this._newDomain,field:()=>{var e;return(e=this._field)!==null&&e!==void 0?e:this._parseFieldOfSeries(t)},isContinuous:()=>Je(this._stateScale.type)},level:oa.dataZoomFilter})},{userId:this._seriesUserId,specIndex:this._seriesIndex}))}onRender(t){}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reMake||Oe(e,t)||(i.reRender=!0,i.reMake=!0),i}reInit(t){super.reInit(t),this._marks.forEach(e=>{e.getMarks().forEach(i=>{this.initMarkStyleWithSpec(i,this._spec[i.name])})})}changeRegions(){}update(t){}resize(t){}_parseDomainFromState(t,e){if(Je(this._stateScale.type))return[Math.min(e,t),Math.max(e,t)];const i=this._stateScale.domain(),r=i.indexOf(t),s=i.indexOf(e);return i.slice(Math.min(r,s),Math.max(r,s)+1)}_initCommonEvent(){var t,e,i,r,s,o,a;const l={delayType:(e=(t=this._spec)===null||t===void 0?void 0:t.delayType)!==null&&e!==void 0?e:"throttle",delayTime:L((i=this._spec)===null||i===void 0?void 0:i.delayType)?(s=(r=this._spec)===null||r===void 0?void 0:r.delayTime)!==null&&s!==void 0?s:30:0,realTime:(a=(o=this._spec)===null||o===void 0?void 0:o.realTime)===null||a===void 0||a,allowComponentZoom:!0};this._zoomAttr.enable&&this.initZoomEventOfRegions(this._regions,null,this._handleChartZoom,l),this._scrollAttr.enable&&this.initScrollEventOfRegions(this._regions,null,this._handleChartScroll,l),this._dragAttr.enable&&this.initDragEventOfRegions(this._regions,null,this._handleChartDrag,l)}updateLayoutAttribute(){this._visible&&this._createOrUpdateComponent(),super.updateLayoutAttribute()}_autoVisible(t){if(!this._auto)return;t?this.show():this.hide();const e=this._isHorizontal?"height":"width";this.layout.setLayoutRect({[e]:t?this[`_${e}`]:0},{[e]:wt.Built_In})}onLayoutStart(t,e,i){super.onLayoutStart(t,e,i);const r=this._autoUpdate(t);this._autoVisible(r),this._dataUpdating=!1}onLayoutEnd(t){const e=!(this._start===0&&this._end===1);this._autoVisible(e),super.onLayoutEnd(t)}getBoundsInRect(t){const e={x1:this.getLayoutStartPoint().x,y1:this.getLayoutStartPoint().y,x2:0,y2:0};return this._isHorizontal?(e.y2=e.y1+this._height,e.x2=e.x1+t.width):(e.x2=e.x1+this._width,e.y2=e.y1+t.height),e}hide(){var t;(t=this._component)===null||t===void 0||t.hideAll()}show(){var t;(t=this._component)===null||t===void 0||t.showAll()}_getAxisBandSize(t){const e=t==null?void 0:t.bandSize,i=t==null?void 0:t.maxBandSize,r=t==null?void 0:t.minBandSize;if(e||r||i)return{bandSize:e,maxBandSize:i,minBandSize:r}}_autoUpdate(t){var e,i,r,s,o,a;if(!this._auto)return this._cacheVisibility=void 0,!0;const l=this._relatedAxisComponent,h=l==null?void 0:l.getSpec(),d=l==null?void 0:l.getScale(),u=this._getAxisBandSize(h);if(!this._dataUpdating&&xr(d.type)&&(t==null?void 0:t.height)===((e=this._cacheRect)===null||e===void 0?void 0:e.height)&&(t==null?void 0:t.width)===((i=this._cacheRect)===null||i===void 0?void 0:i.width)&&this._fixedBandSize===(u==null?void 0:u.bandSize))return this._cacheVisibility;let c=!0;if(this._isHorizontal&&(t==null?void 0:t.width)!==((r=this._cacheRect)===null||r===void 0?void 0:r.width)?d.range(l.getInverse()?[t.width,0]:[0,t.width]):(t==null?void 0:t.height)!==((s=this._cacheRect)===null||s===void 0?void 0:s.height)&&d.range(l.getInverse()?[0,t.height]:[t.height,0]),this._cacheRect={width:t==null?void 0:t.width,height:t==null?void 0:t.height},this._fixedBandSize=u==null?void 0:u.bandSize,xr(d.type)){u&&(this._start||this._end)&&(this.type===vt.scrollBar&&(this._start=0,this._end=1),this._updateRangeFactor());const[g,p]=(o=d.rangeFactor())!==null&&o!==void 0?o:[];c=(!D(g)||!D(p))&&!(g===0&&p===1)}else{const[g,p]=(a=d.rangeFactor())!==null&&a!==void 0?a:[this._start,this._end];c=!(g===0&&p===1)}return this.setStartAndEnd(this._start,this._end),this._cacheVisibility=c,c}_getNeedClearVRenderComponents(){return[this._component]}}Ye(MH,lH);class Jrt extends Bb{_mergeThemeToSpec(t,e){const i=this._theme;let r=t;if(this._shouldMergeThemeToSpec()){const s=a=>{const l=Nt({selectedBackgroundChart:{line:{},area:{}}},this._theme,a),{selectedBackgroundChart:h={}}=a,{line:d,area:u}=h;return d&&d.visible!==!1&&(l.selectedBackgroundChart.line.style=Object.assign(Object.assign({},l.selectedBackgroundChart.line.style),{visible:!0})),u&&u.visible!==!1&&(l.selectedBackgroundChart.area.style=Object.assign(Object.assign({},l.selectedBackgroundChart.area.style),{visible:!0})),l},o=t;r=V(o)?o.map(a=>s(a)):s(o)}return this._adjustPadding(r),{spec:r,theme:i}}}class v_ extends MH{constructor(t,e){var i;super(t,e),this.type=vt.dataZoom,this.name=vt.dataZoom,this.transformerConstructor=Jrt,this.specKey="dataZoom",this.layoutZIndex=Qe.DataZoom,this.layoutLevel=aa.DataZoom,this.layoutType="region-relative",this._isReverseCache=!1,this._dataToPositionX=r=>{const s=this._orient==="left"?this._middleHandlerSize:0,o=this._isHorizontal?this._startHandlerSize/2:0,a=this._isHorizontal?this._stateScale:this._valueScale,l=this._isHorizontal?this._stateField:this._valueField;return a.scale(r[l])+this.getLayoutStartPoint().x+s+o},this._dataToPositionX2=r=>{const s=this._orient==="left"?this._middleHandlerSize:0,o=this._isHorizontal?this._startHandlerSize/2:0,a=this._isHorizontal?this._stateScale:this._valueScale,l=a.domain()[0];return a.scale(l)+this.getLayoutStartPoint().x+s+o},this._dataToPositionY=r=>{const s=this._isHorizontal?this._middleHandlerSize:0,o=this._isHorizontal?0:this._startHandlerSize/2,a=this._isHorizontal?this._valueScale:this._stateScale,l=this._isHorizontal?this._valueField:this._stateField;return a.scale(r[l])+this.getLayoutStartPoint().y+s+o},this._dataToPositionY2=r=>{const s=this._isHorizontal?this._middleHandlerSize:0,o=this._isHorizontal?0:this._startHandlerSize/2,a=this._isHorizontal?this._valueScale:this._stateScale,l=a.domain()[0];return a.scale(l)+this.getLayoutStartPoint().y+s+o},this._valueField="y",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"filter"}created(){super.created(),this._initValueScale()}setAttrFromSpec(){var t,e,i,r,s,o,a,l,h,d;super.setAttrFromSpec(),Re(this._spec.roam)&&(this._zoomAttr.enable=this._spec.roam,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode),this._backgroundSize=(e=(t=this._spec.background)===null||t===void 0?void 0:t.size)!==null&&e!==void 0?e:30,this._middleHandlerSize=this._computeMiddleHandlerSize(),this._width=this._computeWidth(),this._height=this._computeHeight(),D((s=(r=(i=this._spec)===null||i===void 0?void 0:i.startHandler)===null||r===void 0?void 0:r.style)===null||s===void 0?void 0:s.size)&&(this._spec.startHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize),D((l=(a=(o=this._spec)===null||o===void 0?void 0:o.endHandler)===null||a===void 0?void 0:a.style)===null||l===void 0?void 0:l.size)&&(this._spec.endHandler.style.size=this._isHorizontal?this._height-this._middleHandlerSize:this._width-this._middleHandlerSize);const u=(h=this._spec.startHandler.style.visible)===null||h===void 0||h,c=(d=this._spec.endHandler.style.visible)===null||d===void 0||d;this._startHandlerSize=u?this._spec.startHandler.style.size:0,this._endHandlerSize=c?this._spec.endHandler.style.size:0}onLayoutEnd(t){this._updateScaleRange(),this._isReverse()&&!this._isReverseCache&&(this._isReverseCache=this._isReverse(),this.effect.onZoomChange()),this._cacheVisibility!==!1&&super.onLayoutEnd(t)}_initValueScale(){const t=this._computeDomainOfValueScale();if(t){const e=new Vs;e.domain(t),this._valueScale=e}}_updateScaleRange(){var t,e;const i=this._startHandlerSize+this._endHandlerSize;if(!this._stateScale||!this._valueScale)return;let r;const s=this._isHorizontal?this.getLayoutRect().width-i:this.getLayoutRect().height-i,o=(e=(t=this._relatedAxisComponent)===null||t===void 0?void 0:t.getScale().range())!==null&&e!==void 0?e:[this._startHandlerSize/2,s+this._startHandlerSize/2],a=this._computeWidth(),l=this._computeHeight();this._isHorizontal?(r=this._visible?[this._startHandlerSize/2,a-i+this._startHandlerSize/2]:o,this._stateScale.range(r),this._valueScale.range([l-this._middleHandlerSize,0])):(r=this._visible?[this._startHandlerSize/2,l-i+this._startHandlerSize/2]:o,this._stateScale.range(r),this.layoutOrient==="left"?this._valueScale.range([a-this._middleHandlerSize,0]):this._valueScale.range([0,a-this._middleHandlerSize])),this._component&&this._cacheVisibility!==!1&&this._component.setAttributes({size:{width:a,height:l},position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y}})}_computeDomainOfValueScale(){const t=this._data.getLatestData().map(i=>i[this._valueField]),e=t.map(i=>1*i);return t.length?[Ri(e),Mi(e)]:null}_computeMiddleHandlerSize(){var t,e,i,r;let s=0;if(!((e=(t=this._spec)===null||t===void 0?void 0:t.middleHandler)===null||e===void 0)&&e.visible){const o=(i=this._spec.middleHandler.icon.style.size)!==null&&i!==void 0?i:8,a=(r=this._spec.middleHandler.background.size)!==null&&r!==void 0?r:40;s+=Math.max(o,a)}return s}_computeWidth(){return this._visible===!1?0:J(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:this._backgroundSize+this._middleHandlerSize}_computeHeight(){return this._visible===!1?0:J(this._spec.height)?this._spec.height:this._isHorizontal?this._backgroundSize+this._middleHandlerSize:this.getLayoutRect().height}_isScaleValid(t){if(!t||!t.domain())return!1;const e=t.domain();return(!Je(t.type)||e[0]!==de(e))&&(!xr(t.type)||olt(e).length!==1)}_getAttrs(t){var e,i,r,s,o;const a=(e=this._spec)!==null&&e!==void 0?e:{};return Object.assign({zIndex:this.layoutZIndex,start:this._start,end:this._end,position:{x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y},orient:this._orient,size:{width:this._computeWidth(),height:this._computeHeight()},showDetail:a.showDetail,brushSelect:(i=a.brushSelect)!==null&&i!==void 0&&i,zoomLock:(r=a.zoomLock)!==null&&r!==void 0&&r,minSpan:this._minSpan,maxSpan:this._maxSpan,delayType:a.delayType,delayTime:L(a.delayType)?(s=a.delayTime)!==null&&s!==void 0?s:30:0,realTime:(o=a.realTime)===null||o===void 0||o,previewData:t&&this._data.getLatestData(),previewPointsX:t&&this._dataToPositionX,previewPointsY:t&&this._dataToPositionY,tolerance:this._spec.tolerance},this._getComponentAttrs(t))}_createOrUpdateComponent(){if(this._visible){const t=this._isHorizontal?this._stateScale:this._valueScale,e=this._isHorizontal?this._valueScale:this._stateScale,i=this._isScaleValid(t)&&this._isScaleValid(e)&&this._spec.showBackgroundChart!==!1,r=this._getAttrs(i);if(this._component)this._component.setAttributes(r);else{const s=this.getContainer();this._component=new tet(r),this._isHorizontal?i&&this._component.setPreviewPointsY1(this._dataToPositionY2):i&&this._component.setPreviewPointsX1(this._dataToPositionX2),this._component.setStatePointToData(o=>this.statePointToData(o)),this._component.addEventListener("change",o=>{const{start:a,end:l,tag:h}=o.detail;this._handleChange(a,l,void 0,h)}),s.add(this._component),this._updateScaleRange()}}}_handleChange(t,e,i,r){if(super._handleChange(t,e,i),this._shouldChange){i&&this._component&&this._component.setStartAndEnd(t,e),this._start=t,this._end=e;const s=this.statePointToData(t),o=this.statePointToData(e);(it(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,s,o):this._handleStateChange(s,o,r))&&this.event.emit(Ot.dataZoomChange,{model:this,value:{filterData:this._filterMode!=="axis",start:t,end:e,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){var t;const e=this._data.getDataView();if(e.reRunAllTransform(),(t=this._component)===null||t===void 0||t.setPreviewData(e.latestData),this._valueScale){const i=this._computeDomainOfValueScale();i&&this._valueScale.domain(i)}}_getComponentAttrs(t){var e,i,r,s,o,a,l,h,d,u,c;const{middleHandler:g={},startText:p={},endText:f={},backgroundChart:m={},selectedBackgroundChart:v={}}=this._spec;return{backgroundStyle:jt((e=this._spec.background)===null||e===void 0?void 0:e.style),startHandlerStyle:jt((i=this._spec.startHandler)===null||i===void 0?void 0:i.style),middleHandlerStyle:g.visible?{visible:!0,icon:jt((r=g.icon)===null||r===void 0?void 0:r.style),background:{size:(s=g.background)===null||s===void 0?void 0:s.size,style:jt((o=g.background)===null||o===void 0?void 0:o.style)}}:{visible:!1},endHandlerStyle:jt((a=this._spec.endHandler)===null||a===void 0?void 0:a.style),startTextStyle:{padding:p.padding,formatMethod:this._getHandlerTextFormatMethod(p),textStyle:jt(p.style)},endTextStyle:{padding:f.padding,formatMethod:this._getHandlerTextFormatMethod(f),textStyle:jt(f.style)},selectedBackgroundStyle:jt(this._spec.selectedBackground.style),dragMaskStyle:jt((l=this._spec.dragMask)===null||l===void 0?void 0:l.style),backgroundChartStyle:t?{line:Nt(jt((h=m.line)===null||h===void 0?void 0:h.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},jt((d=m.area)===null||d===void 0?void 0:d.style))}:{line:{visible:!1},area:{visible:!1}},selectedBackgroundChartStyle:t?{line:Nt(jt((u=v.line)===null||u===void 0?void 0:u.style),{fill:!1}),area:Object.assign({curveType:"basis",visible:!0},jt((c=v.area)===null||c===void 0?void 0:c.style))}:{line:{visible:!1},area:{visible:!1}},disableTriggerEvent:this._option.disableTriggerEvent}}_getHandlerTextFormatMethod(t){const{formatMethod:e,formatter:i}=t,{formatFunc:r}=sh(e,i);return r?s=>r(s,{label:s},i):void 0}_getNeedClearVRenderComponents(){return[this._component]}clear(){if(this._component){const t=this.getContainer();this._component.removeAllChild(),t&&t.removeChild(this._component),this._component=null}super.clear()}}v_.type=vt.dataZoom,v_.transformerConstructor=Jrt,v_.specKey="dataZoom";const jYt=()=>{q.registerComponent(v_.type,v_)};class bA extends MH{constructor(t,e){var i;super(t,e),this.type=vt.scrollBar,this.name=vt.scrollBar,this.specKey="scrollBar",this.layoutZIndex=Qe.DataZoom,this.layoutLevel=aa.DataZoom,this.layoutType="region-relative",this._filterMode=(i=t.filterMode)!==null&&i!==void 0?i:"axis"}setAttrFromSpec(){super.setAttrFromSpec(),Re(this._spec.roam)&&(this._zoomAttr.enable=!1,this._dragAttr.enable=this._spec.roam,this._scrollAttr.enable=this._spec.roam),(this._zoomAttr.enable||this._dragAttr.enable||this._scrollAttr.enable)&&this.initZoomable(this.event,this._option.mode)}onLayoutEnd(t){var e,i;this._updateScaleRange(),(i=(e=this.effect).onZoomChange)===null||i===void 0||i.call(e),super.onLayoutEnd(t)}_updateScaleRange(){this._component&&this._component.setAttributes({x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height})}_computeWidth(){return J(this._spec.width)?this._spec.width:this._isHorizontal?this.getLayoutRect().width:VI}_computeHeight(){return J(this._spec.height)?this._spec.height:this._isHorizontal?VI:this.getLayoutRect().height}_getAttrs(){var t,e,i,r,s,o;return Object.assign({zIndex:this.layoutZIndex,x:this.getLayoutStartPoint().x,y:this.getLayoutStartPoint().y,width:this.getLayoutRect().width,height:this.getLayoutRect().height,range:[this._start,this._end],direction:this._isHorizontal?"horizontal":"vertical",delayType:(t=this._spec)===null||t===void 0?void 0:t.delayType,delayTime:L((e=this._spec)===null||e===void 0?void 0:e.delayType)?(r=(i=this._spec)===null||i===void 0?void 0:i.delayTime)!==null&&r!==void 0?r:30:0,realTime:(o=(s=this._spec)===null||s===void 0?void 0:s.realTime)===null||o===void 0||o},this._getComponentAttrs())}_createOrUpdateComponent(){const t=this._getAttrs();if(this._component)this._component.setAttributes(t);else{const e=this.getContainer();this._component=new d0(t),this._component.addEventListener("scrollDrag",i=>{const r=i.detail.value;this._handleChange(r[0],r[1])}),this._component.addEventListener("scrollUp",i=>{const r=i.detail.value;this._handleChange(r[0],r[1])}),e.add(this._component)}}_handleChange(t,e,i){super._handleChange(t,e,i);const r=$w(this._start,t)&&$w(this._end,e);if(this._shouldChange&&(!r||this._spec.realTime===!1)){i&&this._component&&this._component.setAttribute("range",[t,e]),this._start=t,this._end=e;const s=this.statePointToData(t),o=this.statePointToData(e);(it(this._spec.updateDataAfterChange)?this._spec.updateDataAfterChange(t,e,s,o):this._handleStateChange(this.statePointToData(t),this.statePointToData(e)))&&this.event.emit(Ot.scrollBarChange,{model:this,value:{filterData:this._filterMode!=="axis",start:this._start,end:this._end,startValue:this._startValue,endValue:this._endValue,newDomain:this._newDomain}})}}_handleDataCollectionChange(){this._spec.auto&&this._data.getDataView().reRunAllTransform()}_getComponentAttrs(){const{rail:t,slider:e,innerPadding:i}=this._spec,r={};return D(i)||(r.padding=i),xt(t==null?void 0:t.style)||(r.railStyle=jt(t.style)),xt(e==null?void 0:e.style)||(r.sliderStyle=jt(e.style)),r.disableTriggerEvent=this._option.disableTriggerEvent,r}_getNeedClearVRenderComponents(){return[this._component]}}bA.type=vt.scrollBar,bA.specKey="scrollBar";const NYt=()=>{q.registerComponent(bA.type,bA)},$Yt=(n,t)=>{const{datum:e,title:i,content:r}=t,s=[],o=e.call(null);return i.visible&&s.push({type:"title",index:0,datum:o,spec:i}),Q(r).forEach((a,l)=>{a.visible&&s.push({type:"content",index:l,datum:o,spec:a})}),s};var VYt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class yA extends $r{constructor(){super(...arguments),this.type=vt.indicator,this.name=vt.indicator,this.specKey="indicator",this.layoutType="none",this.layoutZIndex=Qe.Indicator,this.layoutLevel=aa.Indicator,this._gap=0,this._activeDatum=null}static getSpecInfo(t){return la(t,this.specKey,this.type,e=>e&&e.visible!==!1)}created(){super.created(),this.initData(),this.initEvent()}setAttrFromSpec(){super.setAttrFromSpec(),this._gap=this._spec.gap||0,this._title=this._spec.title,this._content=Q(this._spec.content),this._regions=this._option.getRegionsInUserIdOrIndex(Q(this._spec.regionId),Q(this._spec.regionIndex))}onRender(t){}changeRegions(t){}initEvent(){var t;if(this._option.disableTriggerEvent||this._spec.trigger==="none")return;const e=(t=this.getCompiler())===null||t===void 0?void 0:t.getVGrammarView();e&&(this._spec.trigger==="hover"?(e.addEventListener("element-highlight:start",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(i.elements[0].getDatum())}),e.addEventListener("element-highlight:reset",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(null)})):(e.addEventListener("element-select:start",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(i.elements[0].getDatum())}),e.addEventListener("element-select:reset",i=>{this.isRelativeModel(i.options.regionId)&&this.updateDatum(null)})))}updateDatum(t){this._activeDatum=t,this._displayData.updateData();const e=this._getIndicatorAttrs();this._createOrUpdateIndicatorComponent(e)}initData(){Vt(this._option.dataSet,"indicatorFilter",$Yt);const t=new Ve(this._option.dataSet,{name:`${this.type}_${this.id}_data`});t.transform({type:"indicatorFilter",options:{title:this._title,content:this._content,datum:()=>this._activeDatum}}),t.target.addListener("change",this.updateDatum.bind(this)),this._displayData=new Qa(this._option,t)}updateLayoutAttribute(){const t=this._getIndicatorAttrs();this._createOrUpdateIndicatorComponent(t),super.updateLayoutAttribute()}_getIndicatorAttrs(){if(this._spec.visible===!1||this._spec.fixed===!1&&this._activeDatum===null)return{visible:!1};const t=this._regions[0],{width:e,height:i}=t.getLayoutRect(),{x:r,y:s}=t.getLayoutStartPoint(),o=this._spec,{content:a,offsetX:l,offsetY:h,limitRatio:d,title:u}=o,c=VYt(o,["content","offsetX","offsetY","limitRatio","title"]),g=[];return Q(a).forEach(p=>{const f=Nt({},this._theme.content,p);g.push({visible:f.visible!==!1&&(!f.field||this._activeDatum!==null),space:f.space||this._gap,autoLimit:f.autoLimit,autoFit:f.autoFit,fitPercent:f.fitPercent,fitStrategy:f.fitStrategy,style:Object.assign(Object.assign({},jU(Jl(f.style,["text"]),this._activeDatum)),{text:this._createText(f.field,f.style.text)})})}),Object.assign({visible:!0,size:{width:e,height:i},zIndex:this.layoutZIndex,x:r,y:s,dx:l?Qg(l,this._computeLayoutRadius()):0,dy:h?Qg(h,this._computeLayoutRadius()):0,limitRatio:d||1/0,title:{visible:u.visible!==!1&&(!L(u.field)||this._activeDatum!==null),space:u.space||this._gap,autoLimit:u.autoLimit,autoFit:u.autoFit,fitPercent:u.fitPercent,fitStrategy:u.fitStrategy,style:Object.assign(Object.assign({},jU(Jl(u.style,["text"]),this._activeDatum)),{text:this._createText(u.field,u.style.text)})},content:g},c)}_createOrUpdateIndicatorComponent(t){if(t.visible===!1)return this._indicatorComponent&&this._indicatorComponent.parent&&this._indicatorComponent.parent.removeChild(this._indicatorComponent),void(this._indicatorComponent=null);if(this._indicatorComponent)Oe(t,this._cacheAttrs)||this._indicatorComponent.setAttributes(t);else{const e=this.getContainer(),i=new Gzt(t);i.name="indicator",e.add(i),this._indicatorComponent=i,this._indicatorComponent.on("*",(r,s)=>this._delegateEvent(this._indicatorComponent,r,s))}this._cacheAttrs=t}_createText(t,e){var i;return t?this._activeDatum?this._activeDatum[t]:"":it(e)?(i=e(this._activeDatum,void 0))!==null&&i!==void 0?i:"":e??""}_computeLayoutRadius(){const t=this._regions[0],{width:e,height:i}=t.getLayoutRect();return Math.min(e/2,i/2)}isRelativeModel(t){return this._regions.some(e=>e.id===t)}_getNeedClearVRenderComponents(){return[this._indicatorComponent]}clear(){this._cacheAttrs=null,super.clear()}getIndicatorComponent(){return this._indicatorComponent}}yA.type=vt.indicator,yA.specKey="indicator";const GYt=()=>{q.registerComponent(yA.type,yA)},UYt=["sum","average","min","max","variance","standardDeviation","median"];var YYt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};function Fd(n,t,e){if(!e)return!1;const i=n.map(o=>1*o),r=Ri(i),s=Mi(i);return t<r||t>s}function D7(n,t,e,i,r,s){var o,a;const{relativeSeries:l}=i;let h;return J(n.x)&&Fd(t,n.x,e)&&((a=l==null?void 0:(o=l.getXAxisHelper()).setExtendDomain)===null||a===void 0||a.call(o,"marker_xAxis_extend",n.x)),h=Ws(n.x)?CA(n.x,r)+s.x:l.getXAxisHelper().dataToPosition([n.x])+s.x,h}function F7(n,t,e,i,r,s){var o,a;const{relativeSeries:l}=i;let h;return J(n.y)&&Fd(t,n.y,e)&&((a=(o=l.getYAxisHelper())===null||o===void 0?void 0:o.setExtendDomain)===null||a===void 0||a.call(o,"marker_yAxis_extend",n.y)),h=Ws(n.y)?CA(n.y,r)+s.y:l.getYAxisHelper().dataToPosition([n.y])+s.y,h}function H7(n,t,e,i){var r,s;const{relativeSeries:o}=i;return J(n.angle)&&Fd(t,n.angle,e)&&((s=(r=o.angleAxisHelper)===null||r===void 0?void 0:r.setExtendDomain)===null||s===void 0||s.call(r,"marker_angleAxis_extend",n.angle)),o.angleAxisHelper.dataToPosition([n.angle])}function z7(n,t,e,i){var r,s;const{relativeSeries:o}=i;return J(n.radius)&&Fd(t,n.radius,e)&&((s=(r=o.radiusAxisHelper)===null||r===void 0?void 0:r.setExtendDomain)===null||s===void 0||s.call(r,"marker_radiusAxis_extend",n.radius)),o.radiusAxisHelper.dataToPosition([n.radius])}function CA(n,t){return Number(n.substring(0,n.length-1))*t/100}function nv(n){return UYt.includes(n)}function SA(n,t,e,i,r){const s=t.getRegion(),o=s.getLayoutStartPoint(),a=e.getRegion(),l=a.getLayoutStartPoint(),h=Math.abs(Math.min(o.x,l.x)-Math.max(o.x+s.getLayoutRect().width,l.x+a.getLayoutRect().width)),d=Math.abs(Math.min(o.y,l.y)-Math.max(o.y+s.getLayoutRect().height,l.y+a.getLayoutRect().height)),u={relativeSeries:i},c=[],g=n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData,p=i.getXAxisHelper().getScale(0).domain(),f=i.getYAxisHelper().getScale(0).domain();return g.forEach(m=>{const v=L(m.x),_=L(m.y);if(v&&_){const b=D7(m,p,r,u,h,o),y=F7(m,f,r,u,d,o);c.push([{x:b,y}])}else if(v){const b=D7(m,p,r,u,h,o),y=Math.max(o.y+s.getLayoutRect().height,l.y+a.getLayoutRect().height),C=Math.min(o.y,l.y);c.push([{x:b,y},{x:b,y:C}])}else if(_){const b=Math.min(o.x,l.x),y=F7(m,f,r,u,d,o),C=Math.max(o.x+s.getLayoutRect().width,l.x+a.getLayoutRect().width);c.push([{x:b,y},{x:C,y}])}}),c}function TH(n,t,e,i,r){const s={relativeSeries:i},o=[],a=n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData,l=i.angleAxisHelper.getScale(0).domain(),h=i.radiusAxisHelper.getScale(0).domain(),d=Math.min(i.getRegion().getLayoutRect().width/2,i.getRegion().getLayoutRect().height/2);return a.forEach(u=>{const c=L(u.angle),g=L(u.radius);if(c&&g){const p=H7(u,l,r,s),f=z7(u,h,r,s);o.push([{angle:p,radius:f}])}else if(c){const p=H7(u,l,r,s);o.push([{angle:p,radius:-d},{angle:p,radius:d}])}else if(g){const p=z7(u,h,r,s);o.push([{radius:p,angle:0},{radius:p,angle:2*Math.PI}])}}),o}function XYt(n,t){const e=[];return(n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData).forEach(i=>{L(i.areaName)&&e.push([{x:t.nameValueToPosition(i.areaName).x+t.getRegion().getLayoutStartPoint().x,y:t.nameValueToPosition(i.areaName).y+t.getRegion().getLayoutStartPoint().y}])}),e}function kH(n,t,e,i){const r=[],s=n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData,o=V(i);return s.forEach((a,l)=>{var h,d,u,c;const g=a!=null&&a.getRefRelativeSeries?a.getRefRelativeSeries():t,p=g.getRegion(),f=p.getLayoutStartPoint(),{width:m,height:v}=p.getLayoutRect();let _=0,b=0;if(i){const x=o?i[l]:i,A=x.x,M=x.y;A&&(_=Ws(A)?Number(A.substring(0,A.length-1))*m/100:A),M&&(b=Ws(M)?Number(M.substring(0,M.length-1))*v/100:M)}const y=g.getXAxisHelper().getScale(0).domain(),C=g.getYAxisHelper().getScale(0).domain(),S=Q(a.x),w=Q(a.y);S.length===1&&J(S[0])&&Fd(y,S[0],e)&&((d=(h=g.getXAxisHelper())===null||h===void 0?void 0:h.setExtendDomain)===null||d===void 0||d.call(h,"marker_xAxis_extend",S[0])),w.length===1&&J(w[0])&&Fd(C,w[0],e)&&((c=(u=g.getYAxisHelper())===null||u===void 0?void 0:u.setExtendDomain)===null||c===void 0||c.call(u,"marker_yAxis_extend",w[0])),r.push({x:g.getXAxisHelper().dataToPosition(S)+f.x+_,y:g.getYAxisHelper().dataToPosition(w)+f.y+b})}),r}function Qrt(n,t,e){const i=[];return(n.latestData[0]&&n.latestData[0].latestData?n.latestData[0].latestData:n.latestData).forEach(r=>{var s,o,a,l;const h=r!=null&&r.getRefRelativeSeries?r.getRefRelativeSeries():t,d=h.angleAxisHelper.getScale(0).domain(),u=h.radiusAxisHelper.getScale(0).domain(),c=Q(r.angle),g=Q(r.radius);c.length===1&&J(c[0])&&Fd(d,c[0],e)&&((o=(s=h.angleAxisHelper)===null||s===void 0?void 0:s.setExtendDomain)===null||o===void 0||o.call(s,"marker_xAxis_extend",c[0])),g.length===1&&J(g[0])&&Fd(u,g[0],e)&&((l=(a=h.radiusAxisHelper)===null||a===void 0?void 0:a.setExtendDomain)===null||l===void 0||l.call(a,"marker_yAxis_extend",g[0])),i.push({angle:h.angleAxisHelper.dataToPosition(c),radius:h.radiusAxisHelper.dataToPosition(g)})}),i}function W7(n,t,e){let{x:i,y:r}=n;return Ws(i)&&(i=CA(i,t)),Ws(r)&&(r=CA(r,e)),{x:i,y:r}}function RH(n,t,e){let i;if(i=it(n)?Q(n(t.getData().getLatestData(),t)):Q(n),e){const o=t.getRegion(),{x:a,y:l}=o.getLayoutStartPoint(),{width:h,height:d}=o.getLayoutRect();return i.map(u=>{let{x:c,y:g}=W7(u,h,d);return c+=a,g+=l,{x:c,y:g}})}const{width:r,height:s}=t.getOption().getChart().getViewRect();return i.map(o=>W7(o,r,s))}function BH(n){let t=1/0,e=-1/0,i=1/0,r=-1/0;return n.forEach(s=>{const o=s.getLayoutStartPoint(),a=s.getLayoutRect();o.x<t&&(t=o.x),o.x+a.width>e&&(e=o.x+a.width),o.y<i&&(i=o.y),o.y+a.height>r&&(r=o.y+a.height)}),{minX:t,maxX:e,minY:i,maxY:r}}function PH(n,t,e){const{labelBackground:i={},style:r,shape:s}=n,o=YYt(n,["labelBackground","style","shape"]);if(n.visible!==!1){const a=o;return s!=null&&s.visible?a.shape=Object.assign({visible:!0},jt(s.style)):a.shape={visible:!1},i.visible!==!1?(a.panel=Object.assign({visible:!0,customShape:i.customShape},$a(jt(i.style),t,e)),L(i.padding)&&(a.padding=Fi(i.padding))):(a.panel={visible:!1},a.padding=0),r&&(a.textStyle=$a(jt(r),t,e)),a}return{visible:!1}}function $n(n,t,e){for(const i in n)it(n[i])&&(n[i]=n[i](t,e));return n}function $a(n,t,e){return it(n)?n(t,e):n}function j7(n,t){return it(n)?n(t):n}function N7(n,t,e){return L(n)?t==="regionLeft"?e.getLayoutStartPoint().x-n.x:t==="regionRight"?e.getLayoutStartPoint().x+e.getLayoutRect().width-n.x:t==="regionTop"?e.getLayoutStartPoint().y-n.y:t==="regionBottom"?e.getLayoutStartPoint().y+e.getLayoutRect().height-n.y:t:t}function tst(n){return{isXProcess:L(n.x),isYProcess:L(n.y),isX1Process:L(n.x1),isY1Process:L(n.y1),isAngleProcess:L(n.angle),isRadiusProcess:L(n.radius),isAngle1Process:L(n.angle1),isRadius1Process:L(n.radius1),isCoordinatesProcess:L(n.coordinates),isValidProcess:L(n.process)}}function oc(n){const{isXProcess:t,isYProcess:e,isX1Process:i,isY1Process:r,isAngleProcess:s,isRadiusProcess:o,isAngle1Process:a,isRadius1Process:l,isCoordinatesProcess:h,isValidProcess:d}=tst(n);return{doXProcess:t&&!e&&!r,doXYY1Process:t&&e&&r,doYProcess:e&&!t&&!i,doYXX1Process:e&&t&&i,doXYProcess:t&&e&&i&&r,doAngleProcess:s&&!a&&!o&&!l,doRadiusProcess:o&&!l&&!s&&!a,doAngRadRad1Process:s&&!a&&o&&l,doRadAngAng1Process:o&&s&&a&&!l,doRadAngProcess:s&&o&&a&&l,doCoordinatesProcess:h&&(!d||"process"in n&&"xy"in n.process)}}function ac(n){const{isXProcess:t,isYProcess:e,isX1Process:i,isY1Process:r,isAngleProcess:s,isRadiusProcess:o,isAngle1Process:a,isRadius1Process:l,isCoordinatesProcess:h}=tst(n);return{doXProcess:t&&i&&!e&&!r,doYProcess:e&&r&&!t&&!i,doXYProcess:t&&i&&e&&r,doAngleProcess:s&&a&&!o&&!l,doRadiusProcess:o&&l&&!s&&!a,doRadAngProcess:s&&o&&a&&l,doCoordinatesProcess:h}}function UI(n){return{doXYProcess:L(n.x)&&L(n.y),doPolarProcess:L(n.angle)&&L(n.radius),doGeoProcess:L(n.areaName)}}function KYt(n,t,e,i=0){const r=[],s=n.y-t.y,o=n.x-t.x;switch(e){case"top":r.push(n),r.push({x:n.x,y:s>0?n.y-i-Math.abs(s):n.y-i}),r.push({x:t.x,y:s>0?t.y-i:t.y-i-Math.abs(s)}),r.push(t);break;case"bottom":r.push(n),r.push({x:n.x,y:s<0?n.y+i+Math.abs(s):n.y+i}),r.push({x:t.x,y:s<0?t.y+i:t.y+i+Math.abs(s)}),r.push(t);break;case"left":r.push(n),r.push({x:o>0?n.x-i-Math.abs(o):n.x-i,y:n.y}),r.push({x:o>0?t.x-i:t.x-i-Math.abs(o),y:t.y}),r.push(t);break;case"right":r.push(n),r.push({x:o>0?n.x+i:n.x+i+Math.abs(o),y:n.y}),r.push({x:o>0?t.x+i+Math.abs(o):t.x+i,y:t.y}),r.push(t)}return r}function qYt(n,t,e,i=0){const r=n.y-t.y,s=n.x-t.x;return e==="bottom"?{dx:s>0?-s/2:Math.abs(s/2),dy:r>0?i:Math.abs(r)+i}:e==="top"?{dx:s>0?-Math.abs(s/2):+Math.abs(s/2),dy:r>0?-(Math.abs(r)+i):-i}:e==="left"?{dx:s>0?-s-i:-i,dy:r>0?-r/2:Math.abs(r/2)}:e==="right"?{dx:s>0?i:Math.abs(s)+i,dy:r>0?-r/2:Math.abs(r/2)}:{}}var ZYt=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};const JYt=(n,t)=>{const e=n[0].latestData;return xet(e,t.field)},QYt=(n,t)=>{const e=n[0].latestData;return TF(e,t.field)};function tXt(n,t){const e=n[0].latestData;return wet(e,t.field)}function eXt(n,t){const e=n[0].latestData;return Aet(e,t.field)}function iXt(n,t){const e=n[0].latestData;return Met(e,t.field)}function nXt(n,t){const e=n[0].latestData;return _3t(e,t.field)}function rXt(n,t){const e=n[0].latestData;return b3t(e,t.field)}function est(n,t){let e;if(t.coordinates){const r=t,{coordinates:s,coordinateType:o,getSeriesByIdOrIndex:a}=r,l=ZYt(r,["coordinates","coordinateType","getSeriesByIdOrIndex"]);let h,d;if(it(s)){const u=t.getRelativeSeries();h=s(u.getData().getLatestData(),u)}else h=s;h=Q(h),e=h.map(u=>{const c=a(u.refRelativeSeriesId,u.refRelativeSeriesIndex);if(o==="cartesian"){const{xField:g,yField:p}=c.getSpec(),{xFieldDim:f,xFieldIndex:m,yFieldDim:v,yFieldIndex:_}=u;let b=g;L(m)&&(b=Q(g)[m]),f&&Q(g).includes(f)&&(b=f);let y=p;L(_)&&(y=Q(p)[_]),v&&Q(p).includes(v)&&(y=v),d=Object.assign({x:void 0,y:void 0},l),yt(u[b])&&nv(u[b])?d.x={field:b,aggrType:u[b]}:d.x=Q(b).map(C=>u[C]),yt(u[y])&&nv(u[y])?d.y={field:y,aggrType:u[y]}:d.y=Q(y).map(C=>u[C])}else if(o==="polar"){const{valueField:g,categoryField:p}=c.getSpec(),{angleFieldDim:f,angleFieldIndex:m}=u;let v=p;L(m)&&(v=Q(p)[m]),f&&Q(p).includes(f)&&(v=f);const _=g;d=Object.assign({angle:void 0,radius:void 0},l),yt(u[v])&&nv(u[v])?d.angle={field:v,aggrType:u[v]}:d.angle=Q(v).map(b=>u[b]),yt(u[_])&&nv(u[_])?d.radius={field:_,aggrType:u[_]}:d.radius=Q(_).map(b=>u[b])}return d.getRefRelativeSeries=()=>c,d})}else e=t;const i=[];return e.forEach(r=>{const s={x:null,y:null,angle:null,radius:null,areaName:null};if(L(r.x)){const o=r.x;V(o)?s.x=o.map(a=>Sl(a,n,r)):s.x=Sl(o,n,r)}if(L(r.y)){const o=r.y;V(o)?s.y=o.map(a=>Sl(a,n,r)):s.y=Sl(o,n,r)}if(L(r.angle)){const o=r.angle;V(o)?s.angle=o.map(a=>Sl(a,n,r)):s.angle=Sl(o,n,r)}if(L(r.radius)){const o=r.radius;V(o)?s.radius=o.map(a=>Sl(a,n,r)):s.radius=Sl(o,n,r)}if(L(r.areaName)){const o=r.areaName;s.areaName=Sl(o,n,r)}r.getRefRelativeSeries&&(s.getRefRelativeSeries=r.getRefRelativeSeries),i.push(s)}),i}const sXt={min:JYt,max:QYt,sum:tXt,average:eXt,variance:iXt,standardDeviation:nXt,median:rXt};function Sl(n,t,e){const i=e.getRelativeSeries(),r=e.getStartRelativeSeries(),s=e.getEndRelativeSeries(),o=i.getData().getLatestData(),a=r.getData().getLatestData(),l=s.getData().getLatestData();if(it(n))return n(o,a,l,i,r,s);if(os(n)){const{aggrType:h,field:d}=n;return sXt[h](t,{field:d})}return n}function ist(n,t){if(t&&t.getRelativeSeries){const e=t.getRelativeSeries();if(e){const i=e.getViewData();return i&&i.latestData&&i.latestData.length?n:[]}}return n}class EH extends $r{constructor(){super(...arguments),this.layoutType="none",this._layoutOffsetX=0,this._layoutOffsetY=0}getRelativeSeries(){return this._relativeSeries}getMarkerData(){return this._markerData}static _getMarkerCoordinateType(t){return"cartesian"}static getSpecInfo(t){return la(t,this.specKey,this.type,e=>e.visible!==!1&&this._getMarkerCoordinateType(e)===this.coordinateType)}getMarkAttributeContext(){return this._markAttributeContext}_buildMarkerAttributeContext(){this._markAttributeContext={relativeSeries:this._relativeSeries,startRelativeSeries:this._startRelativeSeries,endRelativeSeries:this._endRelativeSeries,vchart:this._option.globalInstance}}created(){super.created(),this._bindSeries(),this._initDataView(),this.initEvent(),this._buildMarkerAttributeContext()}_getAllRelativeSeries(){return{getRelativeSeries:()=>this._relativeSeries,getStartRelativeSeries:()=>this._startRelativeSeries,getEndRelativeSeries:()=>this._endRelativeSeries}}_getFieldInfoFromSpec(t,e,i){const r={x:"xField",y:"yField",radius:"valueField",angle:"categoryField",areaName:"nameField"};return yt(e)&&nv(e)?{field:i.getSpec()[r[t]],aggrType:e}:e}_processSpecByDims(t){const e=this._relativeSeries,i={};return t.forEach(r=>i[r.dim]=this._getFieldInfoFromSpec(r.dim,r.specValue,e)),Object.assign(Object.assign({},i),this._getAllRelativeSeries())}_processSpecCoo(t){return Object.assign(Object.assign({coordinates:t.coordinates||t.coordinate},this._getAllRelativeSeries()),{getSeriesByIdOrIndex:(e,i)=>this._getSeriesByIdOrIndex(e,i),coordinateType:this.coordinateType})}_getRelativeDataView(){if(this._specifiedDataSeries){let t=[];Q(this._specifiedDataSeries).forEach(i=>{t=t.concat(i.getViewData().latestData)});const e=new Bd;return e.registerParser("array",kJ),new Ve(e).parse(t,{type:"array"})}return this._relativeSeries.getViewData()}updateLayoutAttribute(){var t,e,i;if((t=this._spec.visible)===null||t===void 0||t){if(!this._markerComponent){const r=this._createMarkerComponent();r.name=(e=this._spec.name)!==null&&e!==void 0?e:this.type,r.id=(i=this._spec.id)!==null&&i!==void 0?i:`${this.type}-${this.id}`,this._markerComponent=r,this.getContainer().add(this._markerComponent),this._markerComponent.on("*",(s,o)=>{this._delegateEvent(this._markerComponent,s,o,null,this.getMarkerData.bind(this))})}this._markerLayout()}super.updateLayoutAttribute()}_getSeriesByIdOrIndex(t,e){var i,r;let s;return s=(i=this._option.getSeriesInUserIdOrIndex(L(t)?[t]:[],[e]))===null||i===void 0?void 0:i[0],s||(s=(r=this._relativeSeries)!==null&&r!==void 0?r:this._getFirstSeries()),s}_bindSeries(){const t=this._spec;this._relativeSeries=this._getSeriesByIdOrIndex(t.relativeSeriesId,t.relativeSeriesIndex),this._startRelativeSeries=this._getSeriesByIdOrIndex(t.startRelativeSeriesId,t.startRelativeSeriesIndex),this._endRelativeSeries=this._getSeriesByIdOrIndex(t.endRelativeSeriesId,t.endRelativeSeriesIndex),t.specifiedDataSeriesIndex&&t.specifiedDataSeriesIndex==="all"||t.specifiedDataSeriesId&&t.specifiedDataSeriesId==="all"?this._specifiedDataSeries=this._option.getAllSeries():(t.specifiedDataSeriesIndex||t.specifiedDataSeriesId)&&(this._specifiedDataSeries=this._getSeriesByIdOrIndex(t.specifiedDataSeriesId,t.specifiedDataSeriesIndex))}initEvent(){this._relativeSeries.coordinate!=="cartesian"&&(this._relativeSeries.event.on("zoom",this._markerLayout.bind(this)),this._relativeSeries.event.on("panmove",this._markerLayout.bind(this)),this._relativeSeries.event.on("scroll",this._markerLayout.bind(this)))}onRender(t){}changeRegions(t){}clear(){super.clear(),this._firstSeries=null}_getFirstSeries(){var t;if(this._firstSeries)return this._firstSeries;const e=kF(this._regions);return e?(this._firstSeries=e,e):((t=this._option)===null||t===void 0||t.onError("need at least one series"),null)}_getNeedClearVRenderComponents(){return[this._markerComponent]}onLayoutStart(t,e,i){D(this._spec.offsetX)||(this._layoutOffsetX=Gi(this._spec.offsetX,e.width,e)),D(this._spec.offsetY)||(this._layoutOffsetY=Gi(this._spec.offsetY,e.height,e)),super.onLayoutStart(t,e,i)}_compareSpec(t,e){const i=super._compareSpec(t,e);return Oe(e,t)||(i.reRender=!0,i.reMake=!0,i.change=!0),i}_initCommonDataView(){const{options:t}=this._computeOptions(),e=this._getRelativeDataView();Vt(this._option.dataSet,"markerAggregation",est),Vt(this._option.dataSet,"markerFilter",ist);const i=new Ve(this._option.dataSet,{name:`${this.type}_${this.id}_data`});i.parse([e],{type:"dataview"}),i.transform({type:"markerAggregation",options:t}),i.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),i.target.on("change",()=>{this._markerLayout()}),this._markerData=i}}function oXt(n,t){const e=n[0].latestData;return y3t(e,t.fieldX,t.fieldY)}class LH extends EH{constructor(){super(...arguments),this.specKey="markLine",this.layoutZIndex=Qe.MarkLine}static _getMarkerCoordinateType(t){const{doAngleProcess:e,doRadiusProcess:i,doAngRadRad1Process:r,doRadAngAng1Process:s,doRadAngProcess:o}=oc(t);return t.coordinateType==="polar"||e||i||r||s||o?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,r,s,o,a,l,h,d,u,c,g;const{startSymbol:p={},endSymbol:f={}}=this._spec,m=Q((t=this._spec.label)!==null&&t!==void 0?t:{}),v={zIndex:this.layoutZIndex,interactive:(e=this._spec.interactive)===null||e===void 0||e,hover:(i=this._spec.interactive)===null||i===void 0||i,select:(r=this._spec.interactive)===null||r===void 0||r,points:[{x:0,y:0},{x:0,y:0}],center:{x:0,y:0},radius:0,startAngle:0,endAngle:0,lineStyle:$a(jt((s=this._spec.line)===null||s===void 0?void 0:s.style),this._markerData,this._markAttributeContext),clipInRange:(o=this._spec.clip)!==null&&o!==void 0&&o,label:m.map(_=>PH(_,this._markerData,this._markAttributeContext)),state:{line:$n((l=(a=this._spec.line)===null||a===void 0?void 0:a.state)!==null&&l!==void 0?l:{},this._markerData,this._markAttributeContext),lineStartSymbol:$n((d=(h=this._spec.startSymbol)===null||h===void 0?void 0:h.state)!==null&&d!==void 0?d:{},this._markerData,this._markAttributeContext),lineEndSymbol:$n((c=(u=this._spec.endSymbol)===null||u===void 0?void 0:u.state)!==null&&c!==void 0?c:{},this._markerData,this._markAttributeContext),label:m.map(_=>{var b;return $n((b=_.state)!==null&&b!==void 0?b:{},this._markerData,this._markAttributeContext)}),labelBackground:m.map(_=>{var b,y;return $n((y=(b=_.labelBackground)===null||b===void 0?void 0:b.state)!==null&&y!==void 0?y:{},this._markerData,this._markAttributeContext)})},animation:(g=this._spec.animation)!==null&&g!==void 0&&g,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return p.visible?v.startSymbol=Object.assign(Object.assign({},p),{visible:!0,style:$a(jt(p.style),this._markerData,this._markAttributeContext)}):v.startSymbol={visible:!1},f.visible?v.endSymbol=Object.assign(Object.assign({},f),{visible:!0,style:$a(jt(f.style),this._markerData,this._markAttributeContext)}):v.endSymbol={visible:!1},this._newMarkLineComponent(v)}_getUpdateMarkerAttrs(){var t,e;const i=this._spec,r=this._markerData,s=this._startRelativeSeries,o=this._endRelativeSeries,a=this._relativeSeries,l=this._computePointsAttr(),h=a.getViewData().latestData,d=r.latestData[0]&&r.latestData[0].latestData?r.latestData[0].latestData:r.latestData;let u;if(i.clip||Q(i.label).some(m=>m==null?void 0:m.confine)){const{minX:m,maxX:v,minY:_,maxY:b}=BH([s.getRegion(),o.getRegion(),a.getRegion()]);u={x:m,y:_,width:v-m,height:b-_}}const c=(e=(t=this._markerComponent)===null||t===void 0?void 0:t.attribute)!==null&&e!==void 0?e:{},g=Q(c.label),p=Q(this._spec.label),f=g.map((m,v)=>{const _=p[v]||{};return Object.assign(Object.assign({},m),{text:_.formatMethod?_.formatMethod(d,h):m==null?void 0:m.text})});return Object.assign(Object.assign({},l),{label:f,limitRect:u,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}_markerLayout(){var t;const e=this._getUpdateMarkerAttrs();(t=this._markerComponent)===null||t===void 0||t.setAttributes(e)}_initDataView(){const t=this._spec,e="coordinates"in t,{doXProcess:i,doYProcess:r,doXYY1Process:s,doYXX1Process:o,doXYProcess:a,doAngleProcess:l,doRadiusProcess:h,doAngRadRad1Process:d,doRadAngAng1Process:u,doRadAngProcess:c}=oc(t);if(this._markerData=this._getRelativeDataView(),!(i||r||s||o||a||l||h||d||u||c||e))return;Vt(this._option.dataSet,"markerAggregation",est),Vt(this._option.dataSet,"markerRegression",oXt),Vt(this._option.dataSet,"markerFilter",ist);const{options:g,needAggr:p,needRegr:f,processData:m}=this._computeOptions(),v=new Ve(this._option.dataSet);v.parse([m],{type:"dataview"}),p&&v.transform({type:"markerAggregation",options:g}),f&&v.transform({type:"markerRegression",options:g}),v.transform({type:"markerFilter",options:this._getAllRelativeSeries()}),v.target.on("change",()=>{this._markerLayout()}),this._markerData=v}}LH.specKey="markLine";class xA extends LH{constructor(){super(...arguments),this.type=vt.markLine,this.name=vt.markLine,this.coordinateType="cartesian"}_newMarkLineComponent(t){return new Oa(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,r=this._startRelativeSeries,s=this._endRelativeSeries,o=this._relativeSeries,a=L(e.coordinates),l=L(e.process),h=l&&L(e.process.x),d=l&&L(e.process.y),u=L(e.positions),c=(t=e.autoRange)!==null&&t!==void 0&&t,{doXProcess:g,doYProcess:p,doXYY1Process:f,doYXX1Process:m,doXYProcess:v,doCoordinatesProcess:_}=oc(e);let b=[];if(g||f||p||m||v||a&&h||a&&d){const y=SA(i,r,s,o,c);b=y.length===1?y[0]:y.map(C=>C[0])}else _?b=kH(i,o,c,e.coordinatesOffset):u&&(b=RH(e.positions,o,e.regionRelative));return{points:b}}_markerLayout(){var t,e,i,r;const s=this._getUpdateMarkerAttrs();if(this._spec.type==="type-step"){const o=this._startRelativeSeries,a=this._endRelativeSeries,{multiSegment:l,mainSegmentIndex:h}=this._spec.line||{},{connectDirection:d,expandDistance:u=0}=this._spec;let c;if(Ws(u)){const C=o.getRegion(),S=C.getLayoutStartPoint(),w=a.getRegion(),x=w.getLayoutStartPoint();if(d==="bottom"||d==="top"){const A=Math.abs(Math.min(S.y,x.y)-Math.max(S.y+C.getLayoutRect().height,x.y+w.getLayoutRect().height));c=Number(u.substring(0,u.length-1))*A/100}else{const A=Math.abs(Math.min(S.x,x.x)-Math.max(S.x+C.getLayoutRect().width,x.x+w.getLayoutRect().width));c=Number(u.substring(0,u.length-1))*A/100}}else c=u;const{points:g,limitRect:p}=s,f=KYt(g[0],g[1],d,c);let m;m=l&&L(h)?{position:"middle",autoRotate:!1}:Object.assign({position:"start",autoRotate:!1},qYt(g[0],g[1],d,c));const v=(e=(t=this._markerComponent)===null||t===void 0?void 0:t.attribute)!==null&&e!==void 0?e:{},_=Q(v.label),b=Q(s.label),y=Q(this._spec.label);(i=this._markerComponent)===null||i===void 0||i.setAttributes({points:l?[[f[0],f[1]],[f[1],f[2]],[f[2],f[3]]]:f,label:b.map((C,S)=>{var w,x,A,M;let T=0,R=0,B=(w=m.dx)!==null&&w!==void 0?w:0,E=(x=m.dy)!==null&&x!==void 0?x:0;const k=(A=y[S])!==null&&A!==void 0?A:y[0];return et(k==null?void 0:k.refX)&&(T+=k.refX),et(k==null?void 0:k.refY)&&(R+=k.refY),et(k==null?void 0:k.dx)&&(B+=k.dx),et(k==null?void 0:k.dy)&&(E+=k.dy),Object.assign(Object.assign(Object.assign({},C),m),{refX:T,refY:R,dx:B,dy:E,textStyle:Object.assign(Object.assign({},(M=_[S])===null||M===void 0?void 0:M.textStyle),{textAlign:"center",textBaseline:"middle"})})}),limitRect:p,multiSegment:l,mainSegmentIndex:h,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}else(r=this._markerComponent)===null||r===void 0||r.setAttributes(s)}_computeOptions(){let t,e=this._getRelativeDataView(),i=!0,r=!1;const s=this._spec,o=this._relativeSeries,{doXProcess:a,doYProcess:l,doXYY1Process:h,doYXX1Process:d,doXYProcess:u,doCoordinatesProcess:c}=oc(s);if(u)t=[this._processSpecByDims([{dim:"x",specValue:s.x},{dim:"y",specValue:s.y}]),this._processSpecByDims([{dim:"x",specValue:s.x1},{dim:"y",specValue:s.y1}])];else if(a)t=[this._processSpecByDims([{dim:"x",specValue:s.x}])];else if(l)t=[this._processSpecByDims([{dim:"y",specValue:s.y}])];else if(h)t=[this._processSpecByDims([{dim:"x",specValue:s.x},{dim:"y",specValue:s.y}]),this._processSpecByDims([{dim:"x",specValue:s.x},{dim:"y",specValue:s.y1}])];else if(d)t=[this._processSpecByDims([{dim:"x",specValue:s.x},{dim:"y",specValue:s.y}]),this._processSpecByDims([{dim:"x",specValue:s.x1},{dim:"y",specValue:s.y}])];else if(c){if(t=this._processSpecCoo(s),i=!1,e=new Ve(this._option.dataSet,{name:`${this.type}_${this.id}_data`}).parse([o.getViewData()],{type:"dataview"}).transform({type:"markerAggregation",options:t}),s.process&&L(s.process.x)&&(t=[this._processSpecByDims([{dim:"x",specValue:s.process.x}])],i=!0),s.process&&L(s.process.y)&&(t=t=[this._processSpecByDims([{dim:"y",specValue:s.process.y}])],i=!0),s.process&&L(s.process.xy)){const{xField:g,yField:p}=o.getSpec();t={fieldX:g,fieldY:p},r=!0}}else i=!1;return{options:t,needAggr:i,needRegr:r,processData:e}}}xA.type=vt.markLine,xA.coordinateType="cartesian";const aXt=()=>{q.registerComponent(xA.type,xA),aet()};class wA extends LH{constructor(){super(...arguments),this.type=vt.polarMarkLine,this.name=vt.polarMarkLine,this.coordinateType="polar"}_newMarkLineComponent(t){const{doRadiusProcess:e,doRadAngAng1Process:i}=oc(this._spec);return e||i?new Dl(t):new Oa(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,r=this._startRelativeSeries,s=this._endRelativeSeries,o=this._relativeSeries,a=(t=e.autoRange)!==null&&t!==void 0&&t,{doAngleProcess:l,doRadiusProcess:h,doAngRadRad1Process:d,doRadAngAng1Process:u,doRadAngProcess:c,doCoordinatesProcess:g}=oc(e);let p=[],f={};const m={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};if(l||h||d||u||c){const v=TH(i,r,s,o,a);p=v.length===1?v[0]:v.map(_=>_[0]),f=p[0].radius===p[1].radius?{radius:p[0].radius,startAngle:p[0].angle,endAngle:p[1].angle,center:m}:{points:p.map(_=>ui(m,_.radius,_.angle))}}else g&&(p=Qrt(i,o,a),f={points:p.map(v=>ui(m,v.radius,v.angle))});return f}_computeOptions(){const t=this._spec,{doAngleProcess:e,doRadiusProcess:i,doAngRadRad1Process:r,doRadAngAng1Process:s,doRadAngProcess:o,doCoordinatesProcess:a}=oc(t);let l;const h=this._getRelativeDataView();return o?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius1}])]:e?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle}])]:i?l=[this._processSpecByDims([{dim:"radius",specValue:t.radius}])]:r?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius1}])]:s?l=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius}])]:a&&(l=this._processSpecCoo(t)),{options:l,needAggr:!0,needRegr:!1,processData:h}}}wA.type=vt.polarMarkLine,wA.coordinateType="polar";const lXt=()=>{q.registerComponent(wA.type,wA),Izt(),aet()};class AA extends $r{get orient(){return this._orient}constructor(t,e){super(t,e),this.type=vt.title,this.specKey=vt.title,this.layoutType="normal",this.layoutZIndex=Qe.Title,this.layoutLevel=aa.Title,this._orient="top",this._orient=BF(t.orient)?t.orient:"top"}initLayout(){super.initLayout(),this._layout&&(this._layout.layoutOrient=this._orient)}static getSpecInfo(t){return la(t,this.specKey,vt.title,e=>e.visible!==!1)}onRender(t){}_compareSpec(t,e){const i=super._compareSpec(t,e);return(e==null?void 0:e.orient)===(t==null?void 0:t.orient)&&(e==null?void 0:e.visible)===t.visible||(i.reMake=!0),i.change=!0,i.reRender=!0,i}changeRegions(t){}update(t){}resize(t){}afterSetLayoutStartPoint(t){et(t.x)&&this._titleComponent&&this._titleComponent.setAttribute("x",t.x),et(t.y)&&this._titleComponent&&this._titleComponent.setAttribute("y",t.y),super.afterSetLayoutStartPoint(t)}getBoundsInRect(t){let e={};this.setLayoutRect(t);const i=this._getTitleAttrs();this._createOrUpdateTitleComponent(i),e=this._getTitleLayoutRect();const{x:r,y:s}=this.getLayoutStartPoint();return{x1:r,y1:s,x2:r+e.width,y2:s+e.height}}_getTitleLayoutRect(){const t=this._titleComponent.AABBBounds;return{width:this._spec.width?this._spec.width:et(t.width())?t.width():0,height:this._spec.height?this._spec.height:et(t.height())?t.height():0}}_getTitleAttrs(){var t,e,i,r,s,o,a,l;if(this._spec.visible===!1)return{visible:!1};const h=this.getLayoutRect(),d=Gi(this._spec.width,h.width,null,h.width),u=Gi(this._spec.maxWidth,h.width,null,h.width),c=Math.max(Math.min(d,u,h.width),0),g=Object.assign(Object.assign({},Jl(this._spec,["padding"])),{textType:(t=this._spec.textType)!==null&&t!==void 0?t:"text",text:(e=this._spec.text)!==null&&e!==void 0?e:"",subtextType:(i=this._spec.subtextType)!==null&&i!==void 0?i:"text",subtext:(r=this._spec.subtext)!==null&&r!==void 0?r:"",x:(s=this._spec.x)!==null&&s!==void 0?s:0,y:(o=this._spec.y)!==null&&o!==void 0?o:0,height:this._spec.height,minWidth:this._spec.minWidth,maxWidth:c,minHeight:this._spec.minHeight,maxHeight:this._spec.maxHeight,padding:this._spec.innerPadding,align:(a=this._spec.align)!==null&&a!==void 0?a:"left",verticalAlign:(l=this._spec.verticalAlign)!==null&&l!==void 0?l:"top",textStyle:Object.assign({width:c,maxLineWidth:c},this._spec.textStyle),subtextStyle:Object.assign({maxLineWidth:c},this._spec.subtextStyle)});return L(this._spec.width)&&(g.textStyle.width=Math.max(d,h.width),g.subtextStyle.width=g.textStyle.width),g}_createOrUpdateTitleComponent(t){if(this._titleComponent)Oe(t,this._cacheAttrs)||this._titleComponent.setAttributes(t);else{const e=this.getContainer(),i=new met(t);i.name="title",e.add(i),this._titleComponent=i,i.on("*",(r,s)=>this._delegateEvent(i,r,s))}return this._cacheAttrs=t,this._titleComponent}_getNeedClearVRenderComponents(){return[this._titleComponent]}clear(){super.clear(),this._cacheAttrs=null}}AA.type=vt.title,AA.specKey=vt.title;const hXt=()=>{q.registerComponent(AA.type,AA)};class IH extends EH{constructor(){super(...arguments),this.specKey="markArea",this.layoutZIndex=Qe.MarkArea}static _getMarkerCoordinateType(t){const{doAngleProcess:e,doRadiusProcess:i,doRadAngProcess:r}=ac(t);return t.coordinateType==="polar"||e||i||r?"polar":"cartesian"}_createMarkerComponent(){var t,e,i,r,s,o,a,l;const h=Q((t=this._spec.label)!==null&&t!==void 0?t:{}),d={zIndex:this.layoutZIndex,interactive:(e=this._spec.interactive)===null||e===void 0||e,hover:(i=this._spec.interactive)===null||i===void 0||i,select:(r=this._spec.interactive)===null||r===void 0||r,points:[{x:0,y:0}],center:{x:0,y:0},innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,areaStyle:$a(jt((s=this._spec.area)===null||s===void 0?void 0:s.style),this._markerData,this._markAttributeContext),clipInRange:(o=this._spec.clip)!==null&&o!==void 0&&o,label:h.map(u=>PH(u,this._markerData,this._markAttributeContext)),state:{area:$n((a=this._spec.area)===null||a===void 0?void 0:a.state,this._markerData,this._markAttributeContext),label:h.map(u=>$n(u.state,this._markerData,this._markAttributeContext)),labelBackground:h.map(u=>{var c;return $n((c=u.labelBackground)===null||c===void 0?void 0:c.state,this._markerData,this._markAttributeContext)})},animation:(l=this._spec.animation)!==null&&l!==void 0&&l,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};return this._newMarkAreaComponent(d)}_markerLayout(){var t;const e=this._spec,i=this._markerData,r=this._startRelativeSeries,s=this._endRelativeSeries,o=this._relativeSeries,a=this._computePointsAttr(),l=this._getRelativeDataView().latestData,h=i?i.latestData[0]&&i.latestData[0].latestData?i.latestData[0].latestData:i.latestData:l;let d;if(e.clip||Q(e.label).some(u=>u==null?void 0:u.confine)){const{minX:u,maxX:c,minY:g,maxY:p}=BH([r.getRegion(),s.getRegion(),o.getRegion()]);d={x:u,y:g,width:c-u,height:p-g}}if(this._markerComponent){const u=Q((t=this._markerComponent.attribute)===null||t===void 0?void 0:t.label),c=Q(this._spec.label);this._markerComponent.setAttributes(Object.assign(Object.assign({},a),{label:u.map((g,p)=>{const f=c[p]||{};return Object.assign(Object.assign({},g),{text:f.formatMethod?f.formatMethod(h,l):g==null?void 0:g.text})}),limitRect:d,dx:this._layoutOffsetX,dy:this._layoutOffsetY}))}}_initDataView(){const t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:r,doAngleProcess:s,doRadiusProcess:o,doRadAngProcess:a,doCoordinatesProcess:l}=ac(t);if(!(e||i||r||s||o||a||l))return null;this._initCommonDataView()}}IH.specKey="markArea";class MA extends IH{constructor(){super(...arguments),this.type=vt.markArea,this.name=vt.markArea,this.coordinateType="cartesian"}_newMarkAreaComponent(t){return new Uo(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,r=this._startRelativeSeries,s=this._endRelativeSeries,o=this._relativeSeries,{doXProcess:a,doYProcess:l,doXYProcess:h,doCoordinatesProcess:d}=ac(e),u=L(e.positions),c=(t=e.autoRange)!==null&&t!==void 0&&t;let g=[],p=[];if(h){p=SA(i,r,s,o,c);const[f,m]=p;f&&f.length&&m&&m.length&&(g=[{x:f[0].x,y:m[0].y},f[0],{x:m[0].x,y:f[0].y},m[0]])}else if(a||l){p=SA(i,r,s,o,c);const[f,m]=p;f&&f.length&&m&&m.length&&(g=[...f,m[1],m[0]])}else d?g=kH(i,o,c,e.coordinatesOffset):u&&(g=RH(e.positions,o,e.regionRelative));return{points:g}}_computeOptions(){const t=this._spec,{doXProcess:e,doYProcess:i,doXYProcess:r,doCoordinatesProcess:s}=ac(t);let o;return r?o=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"x",specValue:t.x1},{dim:"y",specValue:t.y1}])]:e?o=[this._processSpecByDims([{dim:"x",specValue:t.x}]),this._processSpecByDims([{dim:"x",specValue:t.x1}])]:i?o=[this._processSpecByDims([{dim:"y",specValue:t.y}]),this._processSpecByDims([{dim:"y",specValue:t.y1}])]:s&&(o=this._processSpecCoo(t)),{options:o}}}MA.type=vt.markArea,MA.coordinateType="cartesian";const dXt=()=>{q.registerComponent(MA.type,MA),het()};class TA extends IH{constructor(){super(...arguments),this.type=vt.polarMarkArea,this.name=vt.polarMarkArea,this.coordinateType="polar"}_newMarkAreaComponent(t){const{doRadiusProcess:e,doAngleProcess:i,doRadAngProcess:r}=ac(this._spec);return i||e||r?new Da(t):new Uo(t)}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,r=this._startRelativeSeries,s=this._endRelativeSeries,o=this._relativeSeries,{doAngleProcess:a,doRadiusProcess:l,doRadAngProcess:h,doCoordinatesProcess:d}=ac(e),u=(t=e.autoRange)!==null&&t!==void 0&&t;let c,g={};const p={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};if(a||l||h){const f=TH(i,r,s,o,u);h?g={innerRadius:f[0][0].radius,outerRadius:f[1][0].radius,startAngle:f[0][0].angle,endAngle:f[1][0].angle,center:p}:a?g={innerRadius:0,outerRadius:Math.abs(f[0][0].radius),startAngle:f[0][1].angle,endAngle:f[1][1].angle,center:p}:l&&(g={innerRadius:f[0][0].radius,outerRadius:f[1][0].radius,startAngle:f[0][0].angle,endAngle:f[1][1].angle,center:p})}else d&&(c=Qrt(i,o,u),g={points:c.map(f=>ui(p,f.radius,f.angle))});return g}_computeOptions(){const t=this._spec,{doAngleProcess:e,doRadiusProcess:i,doRadAngProcess:r,doCoordinatesProcess:s}=ac(t);let o;return r?o=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius1}])]:e?o=[this._processSpecByDims([{dim:"angle",specValue:t.angle},{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"angle",specValue:t.angle1},{dim:"radius",specValue:t.radius}])]:i?o=[this._processSpecByDims([{dim:"radius",specValue:t.radius}]),this._processSpecByDims([{dim:"radius",specValue:t.radius1}])]:s&&(o=this._processSpecCoo(t)),{options:o}}}TA.type=vt.polarMarkArea,TA.coordinateType="polar";const uXt=()=>{q.registerComponent(TA.type,TA),Ozt(),het()},$7=n=>{const t=Object.assign({},n);return jt(t)},cXt=n=>{const t=Object.assign({},n);return jt(t)},hC=n=>Object.assign(Object.assign({},n),{style:Object.assign({},jt(n.style))}),nst=n=>{var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f;const m=$7((e=(t=n==null?void 0:n.slider)===null||t===void 0?void 0:t.trackStyle)!==null&&e!==void 0?e:{}),v=$7((r=(i=n==null?void 0:n.slider)===null||i===void 0?void 0:i.railStyle)!==null&&r!==void 0?r:{}),_=cXt((o=(s=n==null?void 0:n.slider)===null||s===void 0?void 0:s.handlerStyle)!==null&&o!==void 0?o:{}),b=hC((l=(a=n==null?void 0:n.controller)===null||a===void 0?void 0:a.start)!==null&&l!==void 0?l:{}),y=hC((d=(h=n==null?void 0:n.controller)===null||h===void 0?void 0:h.pause)!==null&&d!==void 0?d:{}),C=hC((c=(u=n==null?void 0:n.controller)===null||u===void 0?void 0:u.backward)!==null&&c!==void 0?c:{}),S=hC((p=(g=n==null?void 0:n.controller)===null||g===void 0?void 0:g.forward)!==null&&p!==void 0?p:{}),w=Object.assign(Object.assign({},n),{direction:n.direction,interval:n.interval,visible:n.visible,orient:(f=n.orient)!==null&&f!==void 0?f:"bottom",slider:Object.assign(Object.assign({},n.slider),{trackStyle:m,railStyle:v,handlerStyle:_}),controller:Object.assign(Object.assign({},n.controller),{start:b,pause:y,backward:C,forward:S})});return n.visible||(w.controller.visible=!1,w.slider.visible=!1),w},gXt=(n,t)=>Object.assign(Object.assign({},nst(n)),{data:t,type:"continuous"}),pXt=(n,t)=>Object.assign(Object.assign({},nst(n)),{data:t,type:"discrete"}),Tm=n=>n==="left"||n==="right",aP=n=>n==="top"||n==="bottom";class kA extends $r{constructor(){super(...arguments),this.layoutZIndex=Qe.Player,this.layoutLevel=aa.Player,this.specKey="player",this.type=vt.player,this._orient="bottom",this._getPlayerAttrs=()=>{var t,e,i,r,s,o;const a=this._spec.type,l={size:{width:this._width,height:this._height},dx:(t=this._spec.dx)!==null&&t!==void 0?t:0+this._dx,dy:(e=this._spec.dy)!==null&&e!==void 0?e:0+this._dy};return a==="discrete"?Object.assign(Object.assign(Object.assign({},pXt(this._spec,this._specs)),l),{disableTriggerEvent:this._option.disableTriggerEvent,loop:(r=(i=this._spec)===null||i===void 0?void 0:i.loop)===null||r===void 0||r}):Object.assign(Object.assign(Object.assign({},gXt(this._spec,this._specs)),l),{disableTriggerEvent:this._option.disableTriggerEvent,loop:(o=(s=this._spec)===null||s===void 0?void 0:s.loop)===null||o===void 0||o})},this._createOrUpdatePlayerComponent=()=>{const t=Object.assign({},this._getPlayerAttrs()),e=this.getContainer();this._playerComponent?Oe(t,this._cacheAttrs)||(this._cacheAttrs=t,this._playerComponent.setAttributes(t),this._playerComponent._initAttributes(),this._playerComponent.render()):(t.type==="discrete"?this._playerComponent=new a3t(t):this._playerComponent=new h3t(t),this._cacheAttrs=t,this._playerComponent.name="player",e.add(this._playerComponent),this._initEvent())},this._maxSize=()=>{var t,e,i,r,s,o,a,l,h;return Math.max(...Q((e=(t=this._spec.controller.start)===null||t===void 0?void 0:t.style)===null||e===void 0?void 0:e.size),...Q((r=(i=this._spec.controller.pause)===null||i===void 0?void 0:i.style)===null||r===void 0?void 0:r.size),...Q((o=(s=this._spec.controller.backward)===null||s===void 0?void 0:s.style)===null||o===void 0?void 0:o.size),...Q((l=(a=this._spec.controller.forward)===null||a===void 0?void 0:a.style)===null||l===void 0?void 0:l.size),(h=Tm(this._orient)?this._spec.slider.railStyle.width:this._spec.slider.railStyle.height)!==null&&h!==void 0?h:10)},this._sliderExceededSize=()=>{var t,e,i,r,s,o,a,l,h;const d=(t=Tm(this._orient)?this._spec.slider.railStyle.width:this._spec.slider.railStyle.height)!==null&&t!==void 0?t:10,u=Math.max(...Q((i=(e=this._spec.controller.start)===null||e===void 0?void 0:e.style)===null||i===void 0?void 0:i.size),...Q((s=(r=this._spec.controller.pause)===null||r===void 0?void 0:r.style)===null||s===void 0?void 0:s.size),...Q((a=(o=this._spec.controller.backward)===null||o===void 0?void 0:o.style)===null||a===void 0?void 0:a.size),...Q((h=(l=this._spec.controller.forward)===null||l===void 0?void 0:l.style)===null||h===void 0?void 0:h.size));return d>=u?d-u:0},this._initEvent=()=>{this._option.disableTriggerEvent||(this._option.globalInstance.on(Ot.rendered,()=>{var t;!((t=this._spec)===null||t===void 0)&&t.auto&&this._playerComponent.play()}),this._playerComponent.addEventListener(Vi.end,()=>{var t;this.event.emit(Ot.playerEnd,{model:this}),this._alternate&&this._spec.type==="discrete"&&(this._direction=this._direction==="default"?"reverse":"default",this._playerComponent.setAttributes({direction:this._direction,dataIndex:this._direction==="reverse"?this._specs.length-2:1})),!((t=this._spec)===null||t===void 0)&&t.loop&&this._playerComponent.play()}),this._playerComponent.addEventListener(Vi.change,t=>{const{index:e}=t.detail;this.changePlayerIndex(e)}),this._playerComponent.addEventListener(Vi.backward,t=>{const{index:e}=t.detail,i=this._specs[e];this.event.emit(Ot.playerBackward,{model:this,value:{spec:i,index:e,specs:this._specs}})}),this._playerComponent.addEventListener(Vi.forward,t=>{const{index:e}=t.detail,i=this._specs[e];this.event.emit(Ot.playerForward,{model:this,value:{spec:i,index:e,specs:this._specs}})}),this._playerComponent.addEventListener(Vi.play,t=>{const{index:e}=t.detail,i=this._specs[e];this.event.emit(Ot.playerPlay,{model:this,value:{spec:i,index:e,specs:this._specs}})}),this._playerComponent.addEventListener(Vi.pause,t=>{const{index:e}=t.detail,i=this._specs[e];this.event.emit(Ot.playerPause,{model:this,value:{spec:i,index:e,specs:this._specs}})}))}}get orient(){return this._orient}set layoutOrient(t){this._orient=t}setAttrFromSpec(){var t,e,i,r,s,o,a,l;super.setAttrFromSpec(),this._orient=(t=this._spec.orient)!==null&&t!==void 0?t:"bottom",this._specs=(e=this._spec.specs)!==null&&e!==void 0?e:[],this._direction=(i=this._spec.direction)!==null&&i!==void 0?i:"default",this._alternate=(r=this._spec.alternate)!==null&&r!==void 0&&r,this._dx=(s=this._spec.dx)!==null&&s!==void 0?s:0,this._dy=(o=this._spec.dy)!==null&&o!==void 0?o:0,this._position=(a=this._spec.position)!==null&&a!==void 0?a:"middle",this._visible=(l=this._spec.visible)===null||l===void 0||l}afterSetLayoutStartPoint(t){if(super.afterSetLayoutStartPoint(t),et(t.x)){const e=Tm(this._orient)?t.x+this._sliderExceededSize()/2:t.x;this._playerComponent&&this._playerComponent.setAttribute("x",e)}if(et(t.y)){const e=aP(this._orient)?t.y+this._sliderExceededSize()/2:t.y;this._playerComponent&&this._playerComponent.setAttribute("y",e)}}getBoundsInRect(t,e){this._width=this._computeWidth(t),this._height=this._computeHeight(t),this._dx=this._computeDx(e),this._dy=this._computeDy(e);const i=this._computeLayoutRect(t,this._width,this._height);return this._createOrUpdatePlayerComponent(),i}changeRegions(t){}onRender(t){}_getNeedClearVRenderComponents(){return[this._playerComponent]}_computeLayoutRect(t,e,i){if(this._visible===!1)return{x1:0,x2:0,y1:0,y2:0};switch(this._orient){case"top":case"left":return{x1:0,y1:0,x2:e,y2:i};case"right":return{x1:t.width-e,y1:0,x2:t.width,y2:t.height};default:return{x1:0,y1:t.height-i,x2:t.width,y2:t.height}}}_computeWidth(t){return J(this._spec.width)?Math.min(t.width,Number(this._spec.width)):Tm(this._orient)?this._maxSize():t.width}_computeHeight(t){return J(this._spec.height)?(this._height=this._spec.height,Math.min(t.height,Number(this._spec.height))):aP(this._orient)?this._maxSize():t.height}_computeDx(t){return Tm(this._orient)||this._position==="start"?0:this._position==="middle"?(t.width-this._width)/2:t.width-this._width}_computeDy(t){return aP(this._orient)||this._position==="start"?0:this._position==="middle"?(t.height-this._height)/2:t.height-this._height}changePlayerIndex(t){const e=this._specs[t];Q(e.data).forEach(i=>{var r,s;(s=(r=this._option)===null||r===void 0?void 0:r.globalInstance)===null||s===void 0||s.updateData(i.id,i.values)}),this.event.emit(Ot.playerChange,{model:this,value:{spec:e,index:t,specs:this._specs}})}}kA.specKey="player",kA.type=vt.player;const fXt=()=>{q.registerComponent(kA.type,kA)};class OH extends $r{constructor(t,e){super(t,e),this.type=vt.label,this.name=vt.label,this.layoutType="none",this.layoutZIndex=Qe.Label,this._regions=e.getRegionsInIndex(e.regionIndexes)}_interactiveConfig(t){const{interactive:e}=t,i={hover:!1,select:!1,state:t.state};if(e!==!0)return i;const{hover:r,select:s}=this._option.getChart().getSpec();return r===!1&&r.enable===!1||(i.hover=!0),s===!1&&s.enable===!1||(i.select=!0),i}_compareSpec(t,e){const i=super._compareSpec(t,e);return i.reRender=!0,Oe(e,t)||(i.reMake=!0),i}onRender(t){}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}}OH.type=vt.label;class RA extends Mf{constructor(){super(...arguments),this.skipEncode=!1}getRule(){return this._rule}setRule(t){this._rule=t}getTarget(){return this._target}setTarget(t){this._target=t,this._rule||this.setRule(t.type)}getComponent(){return this._component}setComponent(t){this._component=t}}RA.type="text",RA.constructorType="label";const rst=()=>{q.registerMark(RA.constructorType,RA),dit()};class sst extends Bb{_initTheme(t,e){return{spec:t,theme:this._theme}}}class __ extends OH{constructor(t,e){super(t,e),this.type=vt.label,this.name=vt.label,this.specKey="label",this.transformerConstructor=sst,this.layoutZIndex=Qe.Label,this._layoutRule=t.labelLayout||"series"}static getSpecInfo(t,e){const i=[];return((e==null?void 0:e.region)||[]).forEach((s,o)=>{(s.seriesIndexes||[]).some(a=>{const l=e.series[a],{markLabelSpec:h={}}=l;return Object.values(h).some(d=>Array.isArray(d)&&(u=>u.some(c=>c.visible))(d))})&&i.push({spec:t,type:vt.label,specInfoPath:["component",this.specKey,o],regionIndexes:[o]})}),i}init(t){super.init(t),this.initEvent(),this._initTextMark(),this._initLabelComponent(),this._initTextMarkStyle()}reInit(t){super.reInit(t),this._labelInfoMap&&this._labelInfoMap.clear(),this._initTextMark(),this._initTextMarkStyle()}initEvent(){this.event.on(Ot.dataZoomChange,()=>{this._labelComponentMap.forEach((e,i)=>{const r=i.getProduct().getGroupGraphicItem();r&&r.disableAnimation()}),this.event.on(Lt.AFTER_MARK_RENDER_END,t)});const t=()=>{this._labelComponentMap.forEach((e,i)=>{const r=i.getProduct().getGroupGraphicItem();r&&r.enableAnimation()}),this.event.off(Lt.AFTER_MARK_RENDER_END,t)}}_initTextMark(){this._labelInfoMap||(this._labelInfoMap=new Map),this._labelComponentMap||(this._labelComponentMap=new Map),Oi(this._regions,t=>{const{markLabelSpec:e={}}=t.getSpecInfo(),i=Object.keys(e),r=t.getRegion();this._labelInfoMap.get(r)||this._labelInfoMap.set(r,[]);for(let s=0;s<i.length;s++){const o=i[s],a=t.getMarkInName(o);a&&e[o].forEach((l,h)=>{var d,u;if(l.visible){const c=this._labelInfoMap.get(r),g=this._createMark({type:"label",name:`${o}-label-${h}`},{noSeparateStyle:!0,attributeContext:t.getMarkAttributeContext()});l.showRelatedMarkTooltip&&((u=(d=t.tooltipHelper)===null||d===void 0?void 0:d.activeTriggerSet.mark)===null||u===void 0||u.add(g)),g.setTarget(a),c.push({labelMark:g,baseMark:a,series:t,labelSpec:l})}})}})}_initLabelComponent(){this._labelInfoMap.forEach((t,e)=>{if(this._layoutRule==="region"){const i=this._createMark({type:"component",name:`${e.getGroupMark().name}-label-component`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});i&&(i.setSkipBeforeLayouted(!0),t[0]&&L(t[0].labelSpec.zIndex)&&i.setMarkConfig({zIndex:t[0].labelSpec.zIndex}),this._marks.addMark(i),this._labelComponentMap.set(i,()=>this._labelInfoMap.get(e)))}else t.forEach((i,r)=>{const s=this._createMark({type:"component",name:`${i.labelMark.name}-component`},{componentType:"label",noSeparateStyle:!0},{support3d:i.baseMark.getMarkConfig().support3d});s&&(L(i.labelSpec.zIndex)&&s.setMarkConfig({zIndex:i.labelSpec.zIndex}),s.setSkipBeforeLayouted(!0),this._marks.addMark(s),this._labelComponentMap.set(s,()=>this._labelInfoMap.get(e)[r]))})})}_initTextMarkStyle(){this._labelComponentMap.forEach((t,e)=>{Q(t()).forEach(({labelMark:i})=>{i.setComponent(e)})}),this._labelInfoMap.forEach(t=>{t.forEach(e=>{var i,r;const{labelMark:s,labelSpec:o,series:a}=e;if(this.initMarkStyleWithSpec(s,o,void 0),it(o==null?void 0:o.getStyleHandler)){const l=o.getStyleHandler(a);l==null||l.call(a,s,o)}!((r=(i=s.stateStyle)===null||i===void 0?void 0:i.normal)===null||r===void 0)&&r.lineWidth&&s.setAttribute("stroke",a.getColorAttribute(),"normal",wt.Base_Series)})})}updateLayoutAttribute(){super.updateLayoutAttribute(),this._labelComponentMap.forEach((t,e)=>{const i=t();V(i)?this._updateMultiLabelAttribute(i,e):this._updateSingleLabelAttribute(i,e)})}_updateMultiLabelAttribute(t,e){this._updateLabelComponentAttribute(e.getProduct(),t.map(({baseMark:i})=>i.getProduct()),t)}_updateSingleLabelAttribute(t,e){const{baseMark:i}=t;this._updateLabelComponentAttribute(e.getProduct(),i.getProduct(),[t])}_updateLabelComponentAttribute(t,e,i){const r=this._option.getComponentsByType("totalLabel");t.target(e).configure({interactive:!1}).depend(r.map(s=>s.getMarks()[0].getProduct())).labelStyle((s,o)=>{var a,l;const h=i[o.labelIndex];if(h){const{labelSpec:d,labelMark:u,series:c}=h,g=u.getRule(),p=this._interactiveConfig(d),f=(l=(a=this._spec)===null||a===void 0?void 0:a.centerOffset)!==null&&l!==void 0?l:0;let m=Nt({textStyle:Object.assign({pickable:d.interactive===!0},d.style),overlap:{avoidMarks:r.map(v=>v.getMarks()[0].getProductId())}},T6t(g,h),Object.assign(Object.assign(Object.assign({},Jl(d,["position","style","state","type","stackDataFilterType","getStyleHandler"])),p),{centerOffset:f}),d.stackDataFilterType?{dataFilter:d.stackDataFilterType==="min"?v=>v.filter(_=>_.data[OF]):v=>v.filter(_=>_.data[C0])}:{});return c&&c.parseLabelStyle&&(m=c.parseLabelStyle(m,d,u)),g!=="line"&&g!=="area"||(m.type=g),m}}).encode((s,o,a)=>{if(i[a.labelIndex]){const{labelSpec:l,labelMark:h}=i[a.labelIndex];return h.skipEncode?{data:s}:hH(i[a.labelIndex],s,l.formatMethod,l.formatter)}}).size(()=>{var s;return Object.assign({padding:(s=i[0].labelSpec.overlap)===null||s===void 0?void 0:s.padding},i[0].series.getRegion().getLayoutRect())})}compileMarks(){this.getMarks().forEach(t=>{const e=this._labelComponentMap.get(t)();let i;i=V(e)?e[0].series.getRegion().getGroupMark().getProduct():e.series.getRegion().getGroupMark().getProduct(),t.compile({group:i,context:{model:this,labelInfo:e}})})}getVRenderComponents(){const t=[];return this._labelComponentMap.forEach((e,i)=>{const r=i.getProduct().getGroupGraphicItem();r&&t.push(r)}),t}getLabelInfoByTextGraphic(t){let e;const i=t==null?void 0:t.parent,r=i==null?void 0:i.parent;if(r){const s=r.getChildren().indexOf(i);this._labelComponentMap.forEach((o,a)=>{a.getProduct().getGroupGraphicItem()===r&&(e=Q(o())[s])})}return e}}__.type=vt.label,__.specKey="label",__.transformerConstructor=sst;const mXt=()=>{yit(),rst(),zT(),q.registerComponent(__.type,__,!0)};class BA extends OH{constructor(){super(...arguments),this.type=vt.totalLabel,this.name=vt.totalLabel,this.specKey="totalLabel",this.layoutZIndex=Qe.Label}static getSpecInfo(t,e){var i;const r=[];return(i=e==null?void 0:e.region)===null||i===void 0||i.forEach((s,o)=>{var a;(a=s.seriesIndexes)===null||a===void 0||a.forEach(l=>{const{spec:h}=e.series[l],d=h[this.specKey];d!=null&&d.visible&&r.push({spec:d,type:vt.totalLabel,specPath:["series",l,this.specKey],specInfoPath:["component",this.specKey,l],regionIndexes:[o],seriesIndexes:[l]})})}),r}init(t){super.init(t),this._initTextMark(),this._initLabelComponent()}reInit(t){super.reInit(t),this._initTextMark()}_initTextMark(){var t;const e=this._getSeries();if(!((t=e.getSpec().totalLabel)===null||t===void 0)&&t.visible){const i=e.getSeriesMark();if(i){const r=this._createMark({type:"label",name:`${i.name}-total-label`});this._baseMark=i,this._textMark=r,this._initTextMarkStyle()}}}_initTextMarkStyle(){var t;super.initMarkStyleWithSpec(this._textMark,this._spec),this.setMarkStyle(this._textMark,{text:i=>i[zet]},"normal",wt.Default);const e=this._getSeries();(t=e.initTotalLabelMarkStyle)===null||t===void 0||t.call(e,this._textMark)}_initLabelComponent(){const t=this._getSeries(),e=this._createMark({type:"component",name:`${t.name}-total-label-component`},{componentType:"label",noSeparateStyle:!0},{support3d:this._spec.support3d});e&&this._marks.addMark(e)}updateLayoutAttribute(){super.updateLayoutAttribute();const t=this._getSeries();this._marks.forEach((e,i)=>{e.getProduct().target(this._baseMark.getProduct()).configure({interactive:!1}).labelStyle(()=>{var r,s;if(this._baseMark){const{offset:o,animation:a,overlap:l,position:h="top"}=this._spec,d=this._interactiveConfig(this._spec);return Nt({textStyle:{pickable:this._spec.interactive===!0},position:vXt(t,this._baseMark.type,h),x:0,y:0},(s=(r=t.getTotalLabelComponentStyle)===null||r===void 0?void 0:r.call(t,{baseMark:this._baseMark,labelMark:this._textMark}))!==null&&s!==void 0?s:{},Object.assign({offset:o,animation:a,overlap:l,dataFilter:u=>u.filter(c=>h==="bottom"?c.data[OF]:c.data[C0])},d))}}).encode(r=>hH({baseMark:this._baseMark,labelMark:this._textMark,series:t,labelSpec:t.getSpec().totalLabel},r,this._spec.formatMethod)).size(()=>{var r;return Object.assign({padding:(r=this._spec.overlap)===null||r===void 0?void 0:r.padding},this._regions[0].getLayoutRect())})})}compileMarks(){this.getMarks().forEach(t=>{const e=this._regions[0].getGroupMark().getProduct();t.compile({group:e,context:{model:this}})})}getVRenderComponents(){const t=[];return this.getMarks().forEach(e=>{const i=e.getProduct().getGroupGraphicItem();i&&t.push(i)}),t}_getSeries(){return this._option.getSeriesInIndex([this.getSpecPath()[1]])[0]}}BA.type=vt.totalLabel,BA.specKey="totalLabel";function vXt(n,t,e="top"){var i,r;let s;const{direction:o}=n;let a;a=e==="bottom"?{vertical:["bottom","top"],horizontal:["left","right"]}:{vertical:["top","bottom"],horizontal:["right","left"]};const l=(o==="horizontal"?!((i=n.getXAxisHelper())===null||i===void 0)&&i.isInverse():!((r=n.getYAxisHelper())===null||r===void 0)&&r.isInverse())?1:0;switch(t){case"rect":case"symbol":s=a[o][l];break;default:s="top"}return s}const _Xt=()=>{yit(),rst(),zT(),q.registerComponent(BA.type,BA,!0)};var V7=function(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var r=0;for(i=Object.getOwnPropertySymbols(n);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(n,i[r])&&(e[i[r]]=n[i[r]])}return e};class JT extends EH{constructor(){super(...arguments),this.specKey="markPoint",this.layoutZIndex=Qe.MarkPoint}static _getMarkerCoordinateType(t){const{doPolarProcess:e,doGeoProcess:i}=UI(t);return t.coordinateType==="polar"||e?"polar":t.coordinateType==="geo"||i?"geo":"cartesian"}_createMarkerComponent(){var t,e,i,r,s,o,a,l,h,d,u,c,g,p,f,m,v,_,b,y,C,S,w,x,A,M,T,R;const{itemContent:B={},itemLine:E={},targetSymbol:k={}}=this._spec,{text:P={},symbol:I,image:O,richText:H}=B,z=V7(B,["text","symbol","image","richText"]),F={zIndex:this.layoutZIndex,interactive:(t=this._spec.interactive)===null||t===void 0||t,hover:(e=this._spec.interactive)===null||e===void 0||e,select:(i=this._spec.interactive)===null||i===void 0||i,position:{x:0,y:0},clipInRange:(r=this._spec.clip)!==null&&r!==void 0&&r,itemContent:Object.assign({offsetX:j7(B.offsetX,this._relativeSeries.getRegion()),offsetY:j7(B.offsetX,this._relativeSeries.getRegion())},z),targetSymbol:{offset:(s=k.offset)!==null&&s!==void 0?s:0,visible:(o=k.visible)!==null&&o!==void 0&&o,size:(a=k.size)!==null&&a!==void 0?a:20,style:$a(k.style,this._markerData,this._markAttributeContext)},state:{line:$n((h=(l=this._spec.itemLine.line)===null||l===void 0?void 0:l.state)!==null&&h!==void 0?h:{},this._markerData,this._markAttributeContext),lineStartSymbol:$n((u=(d=this._spec.itemLine.startSymbol)===null||d===void 0?void 0:d.state)!==null&&u!==void 0?u:{},this._markerData,this._markAttributeContext),lineEndSymbol:$n((g=(c=this._spec.itemLine.endSymbol)===null||c===void 0?void 0:c.state)!==null&&g!==void 0?g:{},this._markerData,this._markAttributeContext),symbol:$n((f=(p=this._spec.itemContent.symbol)===null||p===void 0?void 0:p.state)!==null&&f!==void 0?f:{},this._markerData,this._markAttributeContext),image:$n((v=(m=this._spec.itemContent.image)===null||m===void 0?void 0:m.state)!==null&&v!==void 0?v:{},this._markerData,this._markAttributeContext),text:$n((b=(_=this._spec.itemContent.text)===null||_===void 0?void 0:_.state)!==null&&b!==void 0?b:{},this._markerData,this._markAttributeContext),textBackground:$n((C=(y=this._spec.itemContent.text)===null||y===void 0?void 0:y.labelBackground)===null||C===void 0?void 0:C.state,this._markerData,this._markAttributeContext),richText:$n((w=(S=this._spec.itemContent.richText)===null||S===void 0?void 0:S.state)!==null&&w!==void 0?w:{},this._markerData,this._markAttributeContext),customMark:$n((A=(x=this._spec.itemContent.customMark)===null||x===void 0?void 0:x.state)!==null&&A!==void 0?A:{},this._markerData,this._markAttributeContext),targetItem:$n((T=(M=this._spec.targetSymbol)===null||M===void 0?void 0:M.state)!==null&&T!==void 0?T:{},this._markerData,this._markAttributeContext)},animation:(R=this._spec.animation)!==null&&R!==void 0&&R,animationEnter:this._spec.animationEnter,animationExit:this._spec.animationExit,animationUpdate:this._spec.animationUpdate};I!=null&&I.style&&(F.itemContent.symbolStyle=jt($a(I.style,this._markerData,this._markAttributeContext))),O!=null&&O.style&&(F.itemContent.imageStyle=$a(O.style,this._markerData,this._markAttributeContext)),P&&(F.itemContent.textStyle=PH(P,this._markerData,this._markAttributeContext)),H!=null&&H.style&&(F.itemContent.richTextStyle=$a(H.style,this._markerData,this._markAttributeContext));const{visible:j,line:$={}}=E,Y=V7(E,["visible","line"]);return F.itemLine=j!==!1?Object.assign(Object.assign({},Y),{visible:!0,lineStyle:jt($.style)}):{visible:!1},new dd(F)}_markerLayout(){var t,e,i,r,s;const o=this._spec,a=this._markerData,l=this._relativeSeries,{point:h}=this._computePointsAttr(),d=this._getRelativeDataView().latestData,u=a?a.latestData[0]&&a.latestData[0].latestData?a.latestData[0].latestData:a.latestData:d;let c;if(o.clip||!((t=o.itemContent)===null||t===void 0)&&t.confine){const{minX:g,maxX:p,minY:f,maxY:m}=BH([l.getRegion()]);c={x:g,y:f,width:p-g,height:m-f}}if(this._markerComponent){const g=(e=this._markerComponent.attribute)!==null&&e!==void 0?e:{},p=(r=(i=g.itemContent)===null||i===void 0?void 0:i.textStyle)!==null&&r!==void 0?r:{};this._markerComponent.setAttributes({position:h===void 0?{x:null,y:null}:h,itemContent:Object.assign(Object.assign({},g.itemContent),{textStyle:Object.assign(Object.assign({},p),{text:!((s=this._spec.itemContent.text)===null||s===void 0)&&s.formatMethod?this._spec.itemContent.text.formatMethod(u,d):p.text}),offsetX:N7(h,g.itemContent.offsetX,this._relativeSeries.getRegion()),offsetY:N7(h,g.itemContent.offsetY,this._relativeSeries.getRegion())}),limitRect:c,dx:this._layoutOffsetX,dy:this._layoutOffsetY})}}_initDataView(){const t=this._spec,{doXYProcess:e,doPolarProcess:i,doGeoProcess:r}=UI(t);(L(t.coordinate)||e||i||r)&&this._initCommonDataView()}}JT.specKey="markPoint";class PA extends JT{constructor(){super(...arguments),this.type=vt.markPoint,this.name=vt.markPoint,this.coordinateType="cartesian"}_computePointsAttr(){var t;const e=this._spec,i=this._markerData,r=this._relativeSeries,s=L(e.x)&&L(e.y),o=L(e.coordinate),a=L(e.position),l=(t=e==null?void 0:e.autoRange)!==null&&t!==void 0&&t;let h;return s?h=SA(i,r,r,r,l)[0][0]:o?h=kH(i,r,l,e.coordinatesOffset)[0]:a&&(h=RH(e.position,r,e.regionRelative)[0]),{point:h}}_computeOptions(){const t=this._spec,{doXYProcess:e}=UI(t),i=L(t.coordinate);let r;return e?r=[this._processSpecByDims([{dim:"x",specValue:t.x},{dim:"y",specValue:t.y}])]:i&&(r=this._processSpecCoo(t)),{options:r}}}PA.type=vt.markPoint,PA.coordinateType="cartesian";const bXt=()=>{q.registerComponent(PA.type,PA),wF()};class EA extends JT{constructor(){super(...arguments),this.type=vt.polarMarkPoint,this.name=vt.polarMarkPoint,this.coordinateType="polar"}_computePointsAttr(){var t,e;const i=this._markerData,r=this._relativeSeries,s=(e=(t=this._spec)===null||t===void 0?void 0:t.autoRange)!==null&&e!==void 0&&e,o=TH(i,r,r,r,s)[0][0],a={x:this._relativeSeries.getRegion().getLayoutStartPoint().x+this._relativeSeries.angleAxisHelper.center().x,y:this._relativeSeries.getRegion().getLayoutStartPoint().y+this._relativeSeries.angleAxisHelper.center().y};return{point:ui(a,o.radius,o.angle)}}_computeOptions(){const t=this._spec;return{options:[this._processSpecByDims([{dim:"radius",specValue:t.radius},{dim:"angle",specValue:t.angle}])]}}}EA.type=vt.polarMarkPoint,EA.coordinateType="polar";const yXt=()=>{q.registerComponent(EA.type,EA),wF()};class LA extends JT{constructor(){super(...arguments),this.type=vt.geoMarkPoint,this.name=vt.geoMarkPoint,this.coordinateType="geo"}_computePointsAttr(){const t=this._markerData,e=this._relativeSeries;return{point:XYt(t,e)[0][0]}}_computeOptions(){const t=this._spec;return{options:[this._processSpecByDims([{dim:"areaName",specValue:t.areaName}])]}}}LA.type=vt.geoMarkPoint,LA.coordinateType="geo";const CXt=()=>{q.registerComponent(LA.type,LA),wF()};class IA extends $r{constructor(){super(...arguments),this.layoutType="none",this.type=vt.brush,this.name=vt.brush,this.specKey="brush",this.layoutZIndex=Qe.Brush,this._linkedSeries=[],this._itemMap={},this._linkedItemMap={},this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={},this._cacheInteractiveRangeAttrs=[],this._needDisablePickable=!1,this._releatedAxes=[],this._regionAxisMap={},this._axisDataZoomMap={},this._zoomRecord=[]}static getSpecInfo(t){return la(t,this.specKey,this.type,e=>e.visible!==!1)}init(){const t=this._transformBrushedMarkAttr(this._spec.inBrush),e=this._transformBrushedMarkAttr(this._spec.outOfBrush);this._option.getAllSeries().forEach(i=>{i.getActiveMarks().forEach(r=>{r&&(i.setMarkStyle(r,Object.assign({},t),"inBrush",wt.Series),i.setMarkStyle(r,Object.assign({},e),"outOfBrush",wt.Series))})})}_initNeedOperatedItem(){const t=this._spec.seriesId,e=this._spec.seriesIndex;this._relativeRegions.forEach(i=>{const r=[];i.getSeries().forEach(s=>{(t&&Q(t).includes(s.userId.toString())||e&&Q(e).includes(s.getSpecIndex())||!e&&!t)&&r.push(...s.getMarksWithoutRoot()),this._itemMap[i.id]=r})}),this._linkedSeries.forEach(i=>{this._linkedItemMap[i.id]=i.getMarksWithoutRoot()})}created(){super.created(),this.initEvent(),this._bindRegions(),this._bindLinkedSeries(),this._initRegionAxisMap(),this._initAxisDataZoomMap(),this._initNeedOperatedItem()}_bindRegions(){L(this._spec.regionId)||L(this._spec.regionIndex)?this._relativeRegions=this._option.getRegionsInUserIdOrIndex(Q(this._spec.regionId),Q(this._spec.regionIndex)):this._relativeRegions=this._option.getAllRegions()}_bindLinkedSeries(){(L(this._spec.brushLinkSeriesId)||L(this._spec.brushLinkSeriesIndex))&&(this._linkedSeries=this._option.getSeriesInUserIdOrIndex(Q(this._spec.brushLinkSeriesId),Q(this._spec.brushLinkSeriesIndex)))}_initRegionAxisMap(){L(this._spec.axisId)?Q(this._spec.axisId).forEach(t=>{this._releatedAxes.push(this._option.getComponentByUserId(t))}):L(this._spec.axisIndex)?Q(this._spec.axisIndex).forEach(t=>{this._releatedAxes.push(this._option.getComponentByIndex("axes",t))}):this._releatedAxes=this._option.getComponentsByKey("axes"),this._releatedAxes.forEach(t=>{t==null||t.getRegions().forEach(e=>{this._regionAxisMap["region_"+e.id]?this._regionAxisMap["region_"+e.id].push(t):this._regionAxisMap["region_"+e.id]=[t]})})}_initAxisDataZoomMap(){this._option.getComponentsByKey("dataZoom").forEach(t=>{t.relatedAxisComponent&&(this._axisDataZoomMap[t.relatedAxisComponent.id]=t)})}initEvent(){}onRender(t){}changeRegions(t){}_compareSpec(t,e){this._brushComponents&&this._relativeRegions.forEach((r,s)=>{this._updateBrushComponent(r,s)});const i=super._compareSpec(t,e);return Oe(e,t)||(i.reRender=!0,i.reMake=!0),i}onLayoutEnd(t){var e;super.onLayoutEnd(t),!this._option.disableTriggerEvent&&((e=this._spec.visible)===null||e===void 0||e)&&(this._brushComponents?this._relativeRegions.forEach((i,r)=>{this._updateBrushComponent(i,r)}):(this._brushComponents=[],this._relativeRegions.forEach((i,r)=>{this._createBrushComponent(i,r)})))}_updateBrushComponent(t,e){const i=this._getBrushInteractiveAttr(t),r=this._brushComponents[e];r.setAttributes(i),this._initMarkBrushState(e,""),r.children[0].removeAllChild()}_createBrushComponent(t,e){var i,r;const s=this._getBrushInteractiveAttr(t),o=new bet(Object.assign(Object.assign(Object.assign({zIndex:this.layoutZIndex,brushStyle:jt((i=this._spec)===null||i===void 0?void 0:i.style)},s),this._spec),{disableTriggerEvent:this._option.disableTriggerEvent}));o.id=(r=this._spec.id)!==null&&r!==void 0?r:`brush-${this.id}`,this.getContainer().add(o),this._brushComponents.push(o),this._cacheInteractiveRangeAttrs.push(s),o.addEventListener(on.brushActive,a=>{this._initMarkBrushState(e,"outOfBrush"),this._emitEvent(Ot.brushActive,t)}),o.addEventListener(on.drawStart,a=>{this._emitEvent(Ot.brushStart,t)}),o.addEventListener(on.moveStart,a=>{this._emitEvent(Ot.brushStart,t)}),o.addEventListener(on.drawing,a=>{this._needDisablePickable=!0,this._handleBrushChange(t,a),this._emitEvent(Ot.brushChange,t)}),o.addEventListener(on.moving,a=>{this._handleBrushChange(t,a),this._emitEvent(Ot.brushChange,t)}),o.addEventListener(on.brushClear,a=>{this._initMarkBrushState(e,""),this._needDisablePickable=!1,this._emitEvent(Ot.brushClear,t)}),o.addEventListener(on.drawEnd,a=>{var l;this._needDisablePickable=!1;const{operateMask:h}=a.detail;if(!((l=this._spec)===null||l===void 0)&&l.onBrushEnd)this._spec.onBrushEnd(a)===!0?(this.clearGraphic(),this._initMarkBrushState(e,""),this._needDisablePickable=!1,this._emitEvent(Ot.brushClear,t)):(this._spec.onBrushEnd(a),this._emitEvent(Ot.brushEnd,t));else{const d=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&d.length>0&&this._setAxisAndDataZoom(h,t),this._emitEvent(Ot.brushEnd,t)}}),o.addEventListener(on.moveEnd,a=>{const{operateMask:l}=a.detail,h=this._extendDataInBrush(this._inBrushElementsMap);!this._spec.zoomWhenEmpty&&h.length>0&&this._setAxisAndDataZoom(l,t),this._emitEvent(Ot.brushEnd,t)})}_getBrushInteractiveAttr(t){const e=t.getLayoutStartPoint(),i=t.getLayoutRect(),r=e.x,s=r+i.width,o=e.y,a=o+i.height;return{interactiveRange:{minY:o,maxY:a,minX:r,maxX:s},xRange:[r,s],yRange:[o,a]}}_transformBrushedMarkAttr(t){const e={};return t!=null&&t.symbol&&(e.symbolType=t.symbol),t!=null&&t.symbolSize&&(e.size=t.symbolSize),t!=null&&t.color&&(e.fill=t.color),t!=null&&t.colorAlpha&&(e.fillOpacity=t.colorAlpha),Object.assign(Object.assign({},jt(t)),e)}_handleBrushChange(t,e){const{operateMask:i}=e.detail;this._reconfigItem(i,t),this._reconfigLinkedItem(i,t)}_extendDataInBrush(t){var e,i;const r=[];for(const s in t)for(const o in t[s])r.push(Object.assign({},(i=(e=t[s][o])===null||e===void 0?void 0:e.data)===null||i===void 0?void 0:i[0]));return r}_extendDatumOutOfBrush(t){var e;const i=[];for(const r in t)i.push((e=t[r].data)===null||e===void 0?void 0:e[0]);return i}_emitEvent(t,e){var i;this.event.emit(t,{model:this,value:{operateType:t,operateRegion:e,inBrushData:this._extendDataInBrush(this._inBrushElementsMap),outOfBrushData:this._extendDatumOutOfBrush(this._outOfBrushElementsMap),linkInBrushData:this._extendDataInBrush(this._linkedInBrushElementsMap),linkOutOfBrushData:this._extendDatumOutOfBrush(this._linkedOutOfBrushElementsMap),inBrushElementsMap:this._inBrushElementsMap,outOfBrushElementsMap:this._outOfBrushElementsMap,linkedInBrushElementsMap:this._linkedInBrushElementsMap,linkedOutOfBrushElementsMap:this._linkedOutOfBrushElementsMap,zoomRecord:this._zoomRecord},vchart:(i=this._option)===null||i===void 0?void 0:i.globalInstance})}_reconfigItem(t,e){var i,r,s;if(!(t!=null&&t.globalTransMatrix)||!(!((i=t==null?void 0:t.attribute)===null||i===void 0)&&i.points))return;const o=(s=(r=t==null?void 0:t.attribute)===null||r===void 0?void 0:r.points)!==null&&s!==void 0?s:[],{a,b:l,c:h,d,e:u,f:c}=t.globalTransMatrix,g=o.map(f=>({x:a*f.x+h*f.y+u,y:l*f.x+d*f.y+c})),{markTypeFilter:p=[]}=this._spec;this._itemMap[e.id].forEach(f=>{if(p.includes(f.type))return;const m=f.getProduct();!m||!m.elements||!m.elements.length||m.elements.forEach(v=>{var _,b,y;const C=v.getGraphicItem(),S=f.id+"_"+v.key,w=this._isBrushContainItem(t.globalAABBBounds,g,C);!((_=this._outOfBrushElementsMap)===null||_===void 0)&&_[S]&&w?(v.addState("inBrush"),this._inBrushElementsMap[t==null?void 0:t.name]||(this._inBrushElementsMap[t==null?void 0:t.name]={}),this._inBrushElementsMap[t==null?void 0:t.name][S]=v,delete this._outOfBrushElementsMap[S]):!((y=(b=this._inBrushElementsMap)===null||b===void 0?void 0:b[t==null?void 0:t.name])===null||y===void 0)&&y[S]&&!w&&(v.removeState("inBrush"),v.addState("outOfBrush"),this._outOfBrushElementsMap[S]=v,delete this._inBrushElementsMap[t.name][S]),C.setAttribute("pickable",!this._needDisablePickable)})})}_reconfigLinkedItem(t,e){var i;if(!(t!=null&&t.globalTransMatrix)||!(!((i=t==null?void 0:t.attribute)===null||i===void 0)&&i.points))return;const r=e.getLayoutStartPoint(),s=e.getSeries().map(o=>o.id);this._linkedSeries.forEach(o=>{var a,l;if(!s.includes(o.id)){const h=o.getRegion().getLayoutStartPoint(),d=h.x-r.x,u=h.y-r.y,c=(l=(a=t==null?void 0:t.attribute)===null||a===void 0?void 0:a.points)!==null&&l!==void 0?l:[],{a:g,b:p,c:f,d:m,e:v,f:_}=t.globalTransMatrix,b=d||0,y=u||0,C=c.map(w=>({x:g*w.x+f*w.y+v+b,y:p*w.x+m*w.y+_+y}));t.globalAABBBounds.clone().set(t.globalAABBBounds.x1+b,t.globalAABBBounds.y1+y,t.globalAABBBounds.x2+b,t.globalAABBBounds.y2+y);const{markTypeFilter:S=[]}=this._spec;this._linkedItemMap[o.id].forEach(w=>{if(S.includes(w.type))return;const x=w.getProduct();!x||!x.elements||!x.elements.length||x.elements.forEach(A=>{var M,T,R;const B=A.getGraphicItem(),E=w.id+"_"+A.key;!((M=this._linkedOutOfBrushElementsMap)===null||M===void 0)&&M[E]&&this._isBrushContainItem(t.globalAABBBounds,C,B)?(A.addState("inBrush"),this._linkedInBrushElementsMap[t==null?void 0:t.name]||(this._linkedInBrushElementsMap[t==null?void 0:t.name]={}),this._linkedInBrushElementsMap[t==null?void 0:t.name][E]=A,delete this._linkedOutOfBrushElementsMap[E]):!((R=(T=this._linkedInBrushElementsMap)===null||T===void 0?void 0:T[t==null?void 0:t.name])===null||R===void 0)&&R[E]&&!this._isBrushContainItem(t.globalAABBBounds,C,B)&&(A.removeState("inBrush"),A.addState("outOfBrush"),this._linkedOutOfBrushElementsMap[E]=A),B.setAttribute("pickable",!this._needDisablePickable)})})}})}_isBrushContainItem(t,e,i){let r=[];if(["symbol","rect"].includes(i.type)){const{x1:s,x2:o,y1:a,y2:l}=i==null?void 0:i.globalAABBBounds;return r=[{x:s,y:a},{x:o,y:a},{x:o,y:l},{x:s,y:l}],wlt(e,r)}return t.intersects(i.globalAABBBounds)}_initMarkBrushState(t,e){this._brushComponents.forEach((r,s)=>{s!==t&&r.children[0].removeAllChild()}),this._inBrushElementsMap={},this._outOfBrushElementsMap={},this._linkedInBrushElementsMap={},this._linkedOutOfBrushElementsMap={};const{markTypeFilter:i=[]}=this._spec;Object.entries(this._itemMap).forEach(([r,s])=>{s.forEach(o=>{if(i.includes(o.type))return;const a=o.getProduct();!a||!a.elements||!a.elements.length||a.elements.forEach(l=>{const h=o.id+"_"+l.key;l.removeState("inBrush"),l.removeState("outOfBrush"),l.addState(e),this._outOfBrushElementsMap[h]=l})})}),Object.entries(this._linkedItemMap).forEach(([r,s])=>{s.forEach(o=>{if(i.includes(o.type))return;const a=o.getProduct();!a||!a.elements||!a.elements.length||a.elements.forEach(l=>{const h=o.id+"_"+l.key;l.removeState("inBrush"),l.removeState("outOfBrush"),l.addState(e),this._linkedOutOfBrushElementsMap[h]=l})})})}_stateClamp(t){return Math.min(Math.max(0,t),1)}_setAxisAndDataZoom(t,e){var i;if(this._zoomRecord=[],this._spec.zoomAfterBrush){const r=t.AABBBounds;(i=this._regionAxisMap["region_"+e.id])===null||i===void 0||i.forEach(s=>{var o,a;const l=s.layoutOrient==="bottom"||s.layoutOrient==="top",h=(o=this._spec.axisRangeExpand)!==null&&o!==void 0?o:0,{x1:d,x2:u,y1:c,y2:g}=r,p=l?"x":"y",f=l?d:c,m=l?u:g;if(this._axisDataZoomMap[s.id]){const v=this._axisDataZoomMap[s.id],_=v.relatedAxisComponent,b=_.getScale().invert(f-e.getLayoutStartPoint()[p]),y=_.getScale().invert(m-e.getLayoutStartPoint()[p]),C=v.dataToStatePoint(b),S=v.dataToStatePoint(y),w=this._stateClamp(C-h),x=this._stateClamp(S+h);v.setStartAndEnd(Math.min(w,x),Math.max(w,x),["percent","percent"]),this._zoomRecord.push({operateComponent:v,start:w,end:x,startValue:v.statePointToData(w),endValue:v.statePointToData(x)})}else{const v=s.getScale().range(),_=(a=s.getScale().rangeFactor())!==null&&a!==void 0?a:[0,1],b=de(v)<v[0],y=f-e.getLayoutStartPoint()[p],C=m-e.getLayoutStartPoint()[p],S=b?Math.min(y,C):Math.max(y,C),w=b?Math.max(y,C):Math.min(y,C),x=(w-v[0])/(de(v)-v[0])*(_[1]-_[0])+_[0],A=(S-v[0])/(de(v)-v[0])*(_[1]-_[0])+_[0],M=this._stateClamp(x-h),T=this._stateClamp(A+h);s.getScale().rangeFactor([M,T]),s.effect.scaleUpdate(),this._zoomRecord.push({operateComponent:s,start:M,end:T,startValue:s.getScale().invert(w),endValue:s.getScale().invert(S)})}})}}_getNeedClearVRenderComponents(){return this._brushComponents}clearGraphic(){this._brushComponents&&this._brushComponents.forEach(t=>{t._container.incrementalClearChild()})}clear(){if(this._brushComponents){const t=this.getContainer();this._brushComponents.forEach((e,i)=>{this._initMarkBrushState(i,""),this._needDisablePickable=!1,e.removeAllChild(),e.releaseBrushEvents(),t&&t.removeChild(e)}),this._brushComponents=null}}}IA.type=vt.brush,IA.specKey="brush";const SXt=()=>{q.registerComponent(IA.type,IA)};class OA extends $r{constructor(){super(...arguments),this.type=vt.customMark,this.specKey="customMark",this.layoutType="none",this.layoutZIndex=Qe.CustomMark,this.layoutLevel=aa.CustomMark}created(){super.created(),this.initMarks(),this.initEvent()}getMarkAttributeContext(){return this._markAttributeContext}_buildMarkAttributeContext(){this._markAttributeContext={vchart:this._option.globalInstance,globalScale:(t,e)=>{var i;return(i=this._option.globalScale.getScale(t))===null||i===void 0?void 0:i.scale(e)}}}initMarks(){if(!this._spec)return;const t=this._option&&this._option.getAllSeries(),e=this._option.animation!==!1,i=[];t&&t.length&&t.forEach(s=>{const o=s&&s.getMarksWithoutRoot();o&&o.length&&o.forEach(a=>{i.push(a)})});let r=null;if(this._spec.parent){const s=this.getChart().getAllMarks().find(o=>o.getUserId()===this._spec.parent);s.type==="group"&&(r=s)}this._createExtensionMark(this._spec,r,`${Wt}_series_${this.id}_extensionMark`,0,{depend:i,hasAnimation:e})}_createExtensionMark(t,e,i,r=0,s){var o;const a=this._createMark({type:t.type,name:L(t.name)?`${t.name}`:`${i}_${r}`},{skipBeforeLayouted:!0,attributeContext:this._getMarkAttributeContext(),componentType:t.componentType,key:t.dataKey});if(a){if(L(t.id)&&a.setUserId(t.id),s.hasAnimation&&t.animation){const l=Ae({},Fe(t.type,t,this._markAttributeContext));a.setAnimationConfig(l)}if(s.depend&&s.depend.length&&a.setDepend(...s.depend),D(e)?this._marks.addMark(a):e&&e.addMark(a),this.initMarkStyleWithSpec(a,t),t.type==="group"&&(i=`${i}_${r}`,(o=t.children)===null||o===void 0||o.forEach((l,h)=>{this._createExtensionMark(l,a,i,h,s)})),L(t.dataId)||et(t.dataIndex)){const l=this.getChart().getSeriesData(t.dataId,t.dataIndex);l&&(l.target.addListener("change",()=>{a.getData().updateData()}),a.setDataView(l))}}}initEvent(){}_compareSpec(t,e){const i=super._compareSpec(t,e);return Oe(e,t)||(i.reMake=!0),i.change=!0,i.reRender=!0,i}changeRegions(t){}_getNeedClearVRenderComponents(){return[]}onRender(t){}_getMarkAttributeContext(){return{vchart:this._option.globalInstance,chart:this.getChart(),globalScale:(t,e)=>{var i;return(i=this._option.globalScale.getScale(t))===null||i===void 0?void 0:i.scale(e)},getLayoutBounds:()=>{const{x:t,y:e}=this.getLayoutStartPoint(),{width:i,height:r}=this.getLayoutRect();return new Bi().set(t,e,t+i,e+r)}}}_getLayoutRect(){const t=new Bi;return this.getMarks().forEach(e=>{const i=e.getProduct();i&&t.union(i.getBounds())}),t.empty()?{width:0,height:0}:{width:t.width(),height:t.height()}}getBoundsInRect(t){this.setLayoutRect(t);const e=this._getLayoutRect(),{x:i,y:r}=this.getLayoutStartPoint();return{x1:i,y1:r,x2:i+e.width,y2:r+e.height}}getVRenderComponents(){const t=[],e=i=>{var r;if(i&&i.type==="group")i.getMarks().forEach(s=>{e(s)});else if(i.type==="component"){const s=(r=i==null?void 0:i.getProduct())===null||r===void 0?void 0:r.getGroupGraphicItem();s&&t.push(s)}};return this.getMarks().forEach(i=>{e(i)}),t}}OA.type=vt.customMark,OA.specKey="customMark";const xXt=()=>{q.registerComponent(OA.type,OA)};function G7(n,t,e=0){return e>Math.max(t.x1-n.x2,n.x1-t.x2,t.y1-n.y2,n.y1-t.y2)}function wXt(n){return{x1:n.x,x2:n.x+n.width,y1:n.y,y2:n.y+n.height}}function AXt(n){return{x:n.x1,y:n.y1,width:n.x2-n.x1,height:n.y2-n.y1}}function ost(n){var t;if(!n||n.length===0)return[];if(n.length===1)return[n[0].rect];const e=n.map(r=>{var s;return Object.assign(Object.assign({},r),{bound:wXt(r.rect),anchorCandidates:kXt((s=r.anchors)!==null&&s!==void 0?s:[],r.point,r.rect,r.offset)})}),i=[];i.push(e[0].bound);for(let r=1;r<=e.length-1;r++){const s=e[r],o=s.bound;let a=i.some(l=>G7(l,o));if(s.anchorCandidates)if(a&&((t=s.anchorCandidates)===null||t===void 0?void 0:t.length)>0){for(let l=0;l<s.anchorCandidates.length;l++){const h=s.anchorCandidates[l],d={x1:h.x,y1:h.y,x2:h.x+o.x2-o.x1,y2:h.y+o.y2-o.y1,anchor:h};if(!i.some(u=>G7(u,d))){i.push(d),a=!1;break}}a&&i.push(s.bound)}else i.push(s.bound)}return i.map(r=>AXt(r))}function MXt(n,t,e){const i=n.map(h=>h.pointCoord),{x1:r,x2:s,y1:o,y2:a}=Clt(i),l=e([(r+s)/2,(o+a)/2]);return l?ost(n.map(h=>{const d=h.rect,u=ast(t,h.pointCoord)?e(TXt(t,[h.pointCoord.x,h.pointCoord.y],U7(Y7(h.point,l)))):h.point;u&&(d.x=u.x,d.y=u.y);const c=U7(Y7(h.point,l));let g;const p=[];return c>=-45&&c<45?(g="top",p.push("left","right")):c>=45&&c<135?g="right":c>=-135&&c<-45?(g="left",p.push("left")):(g="bottom",p.push("left","right")),h.anchors=p,h.offset=20,h.rect=DH(h.rect,g,0),h})):[]}function U7(n){return n>180?n-360:n}function Y7(n,t){return 180*Math.atan2(n.y-t.y,n.x-t.x)/Math.PI+90}function TXt(n,t,e,i=200){const r=5621/i;let s=t;for(let o=1;o<=r;o++){const a=Dlt(s,i,e);if(!ast(n,a))return[a.x,a.y];s=[a.x,a.y]}return t}function ast(n,t){for(let e=0;e<n.length;e++)if(Olt(t,n[e]))return!0;return!1}function DH(n,t,e=0){const i=Object.assign({},n);return t==="top"?(i.x-=n.width/2,i.y-=e+n.height/2):t==="bottom"?(i.x-=n.width/2,i.y+=e-n.height/2):t==="left"?(i.x-=e+n.width,i.y-=n.height/2):t==="right"&&(i.x+=e,i.y-=n.height/2),i}function kXt(n,t,e,i=0){const r=[];return n.forEach(s=>{const{x:o,y:a}=DH(Object.assign(Object.assign({},t),{width:e.width,height:e.height}),s,i);r.push({x:o,y:a})}),r}class DA extends $r{constructor(){super(...arguments),this.type=vt.mapLabel,this.name=vt.mapLabel,this.specKey="mapLabel",this.layoutType="none",this.layoutZIndex=Qe.MarkPoint,this._activeDatum=[]}static getSpecInfo(t){return la(t,this.specKey,this.type,e=>e.visible&&L(e.seriesId))}setAttrFromSpec(){var t,e,i,r;this.nameField=(t=this._spec.nameField)!==null&&t!==void 0?t:(e=this._series)===null||e===void 0?void 0:e.getDimensionField()[0],this.valueField=(i=this._spec.valueField)!==null&&i!==void 0?i:(r=this._series)===null||r===void 0?void 0:r.getMeasureField()[0]}created(){super.created(),this._spec.visible&&(this.initRelatedInfo(),this.initData(),this.initEvent())}initRelatedInfo(){var t,e,i,r,s,o,a,l;this._series=this._option.getSeriesInUserIdOrIndex([this._spec.seriesId])[0],this._spec.position==="outer"&&(this._map=(e=(t=this._regions[0].getSeriesInType("map")[0])===null||t===void 0?void 0:t.getMapViewData())===null||e===void 0?void 0:e.latestData,this._longitudeField=(s=(r=(i=this._regions[0]).getSpec)===null||r===void 0?void 0:r.call(i))===null||s===void 0?void 0:s.longitudeField,this._latitudeField=(l=(a=(o=this._regions[0]).getSpec)===null||a===void 0?void 0:a.call(o))===null||l===void 0?void 0:l.latitudeField)}initData(){const t=this._series;if(!t)return;const e=t.getViewData();if(e){const i=new Ve(this._option.dataSet,{name:`${this.name}_data`});i.parse([e],{type:"dataview"}),i.transform({type:"copyDataView",level:oa.copyDataView},!1),this._data=new Qa(this._option,i),i.target.addListener("change",()=>{this._spec.trigger!=="hover"&&this._spec.trigger!=="click"&&(this._activeDatum=this._data.getLatestData())})}}initEvent(){var t;this.event.on("zoom",{filter:r=>this._isRelativeModel(r.model)},r=>(this.handleZoom(r),!0)),this.event.on("panmove",{filter:r=>this._isRelativeModel(r.model)},r=>(this.handlePan(r),!0));const e=this._spec.trigger;if(e==="none")return;const i=(t=this.getCompiler())===null||t===void 0?void 0:t.getVGrammarView();i&&(e==="hover"?(i.addEventListener("element-highlight:start",r=>{this._isRelativeSeries(r.options.seriesId)&&this._updateDatum(r.elements[0].getDatum())}),i.addEventListener("element-highlight:reset",r=>{this._isRelativeSeries(r.options.seriesId)&&this._updateDatum(null)})):e==="click"&&(i.addEventListener("element-select:start",r=>{this._isRelativeSeries(r.options.seriesId)&&this._updateDatum(r.elements[0].getDatum())}),i.addEventListener("elementSelectReset",r=>{this._isRelativeSeries(r.options.seriesId)&&this._updateDatum([])})))}handlePan(t){const{delta:e}=t;this._markerComponents.forEach(i=>{i.translate(e[0],e[1])})}handleZoom(t){this._updateMarkerLayoutAttribute()}_updateDatum(t){this._activeDatum=t,this._markerComponents.forEach((e,i)=>{var r;const s=(r=this._data)===null||r===void 0?void 0:r.getLatestData()[i];this._activeDatum.includes(s)?e.setAttribute("visible",!0):e.setAttribute("visible",!1)})}dataToPosition(t){return this._series.dataToPosition(t)}updateLayoutAttribute(){var t;const e=(t=this._data)===null||t===void 0?void 0:t.getLatestData();e&&e.length!==0&&(super.updateLayoutAttribute(),this._updateMarkerLayoutAttribute())}_updateMarkerLayoutAttribute(){var t;const e=[],i=[];this._markerComponents||(this._markerComponents=(t=this._data)===null||t===void 0?void 0:t.getLatestData().map((s,o)=>{var a;const l=new dd({position:void 0,animation:!1});return l&&(l.name=`${this.name}_marker_${o}`,l.id=(a=this._spec.id)!==null&&a!==void 0?a:`${this.name}_marker_${this.id}`,l.setAttribute("zIndex",this.layoutZIndex)),l})),this._markerComponents.forEach((s,o)=>{s.removeAllChild();const{pairInfo:a,contentMarks:l}=this._evaluateMarker(this._data.getLatestData()[o],o);a&&e.push(a),l&&i.push(l)});const r=this._layoutLabels(e);this._layoutMarkers(r,i),this._renderMarkers()}_evaluateMarker(t,e){var i,r,s,o,a,l,h,d,u,c,g,p;let f=0,m=0,v=0,_=0,b=0;const y=this._spec.position||"top",C=this._spec.offset,S=Id((i=this._spec.background)===null||i===void 0?void 0:i.padding),w=this._spec.space||0;m+=((S==null?void 0:S.left)||0)+((S==null?void 0:S.right)||0),v+=((S==null?void 0:S.top)||0)+((S==null?void 0:S.bottom)||0);const x={},A=this.dataToPosition(t),M=XD({});if(M.name=`${this.name}_marker_itemContainer_${e}`,x.container=M,(r=this._spec.background)===null||r===void 0?void 0:r.visible){const k=mb(jt(Object.assign({},this._spec.background.style)));k.setAttributes(A),x.labelBackground=k,M.appendChild(k)}if(!((s=this._spec.icon)===null||s===void 0)&&s.visible){const k=fb(jt(Object.assign({},this._spec.icon.style)));k.setAttributes(A),k.setAttribute("symbolType",(o=this._spec.icon.style)===null||o===void 0?void 0:o.shape);const P=k.AABBBounds,I=(a=(P==null?void 0:P.y2)-(P==null?void 0:P.y1))!==null&&a!==void 0?a:0,O=(l=(P==null?void 0:P.x2)-(P==null?void 0:P.x1))!==null&&l!==void 0?l:0;x.icon=k,M.appendChild(k),b=I,_+=O,f++}if(!((h=this._spec.nameLabel)===null||h===void 0)&&h.visible){const k=uf(jt(Object.assign({},this._spec.nameLabel.style)));k.setAttributes(A),k.setAttribute("text",t[this.nameField]);const P=k.AABBBounds,I=(d=(P==null?void 0:P.y2)-(P==null?void 0:P.y1))!==null&&d!==void 0?d:0,O=(u=(P==null?void 0:P.x2)-(P==null?void 0:P.x1))!==null&&u!==void 0?u:0;x.nameLabel=k,M.appendChild(k),b=Math.max(b,I),_+=O,f++}if(!((c=this._spec.valueLabel)===null||c===void 0)&&c.visible&&L(t[this.valueField])){const k=uf(jt(Object.assign({},this._spec.valueLabel.style)));k.setAttributes(A),k.setAttribute("text",t[this.valueField]);const P=k.AABBBounds,I=(g=(P==null?void 0:P.y2)-(P==null?void 0:P.y1))!==null&&g!==void 0?g:0,O=(p=(P==null?void 0:P.x2)-(P==null?void 0:P.x1))!==null&&p!==void 0?p:0;x.valueLabel=k,M.appendChild(k),b=Math.max(b,I),_+=O,f++}const T=Object.values(x).find(k=>!!k&&k.type!=="group"),R={x:T==null?void 0:T.getComputedAttribute("x"),y:T==null?void 0:T.getComputedAttribute("y")},B={x:R.x,y:R.y,width:0,height:0};B.width=m+_+(f-1)*w,B.height=v+b;const E={rect:B,point:R,index:e};if(y!=="outer"){const k=["top","right","left","bottom"].filter(P=>P!==y);E.rect=DH(B,y,C),E.anchors=k,E.offset=C}else E.pointCoord={x:+(t==null?void 0:t[this._longitudeField]),y:+(t==null?void 0:t[this._latitudeField])};return{pairInfo:E,contentMarks:x}}_layoutMarkers(t,e){var i,r,s;for(let o=0;o<e.length;o++){if(!t[o]||!e[o])return;const{icon:a,nameLabel:l,valueLabel:h,labelBackground:d,container:u}=e[o],c=t[o],g=Id((i=this._spec.background)===null||i===void 0?void 0:i.padding),p=this._spec.space||0,f=c.height/2;let m=(g==null?void 0:g.left)||0;[a,l,h].forEach((C,S)=>{var w,x;if(C){const A=C.AABBBounds;let M=0;C.type==="symbol"&&(M+=((w=A.x2-A.x1)!==null&&w!==void 0?w:0)/2),C.setAttributes({x:m+M,y:f}),m+=(x=A.x2-A.x1)!==null&&x!==void 0?x:0,S!==2&&(m+=p)}}),d==null||d.setAttributes({x:0,y:0,width:c.width,height:c.height}),u==null||u.setAttributes({dx:-c.width/2,dy:-c.height/2});const v=this._data.getLatestData()[o],_=this.dataToPosition(v),b=this.getRegions()[0].getLayoutStartPoint(),y=!(!(!((r=this._spec.leader)===null||r===void 0)&&r.visible)||!(a||l||h));this._markerComponents[o].setAttributes({x:b.x,y:b.y,position:_,visible:this._activeDatum.includes(v),itemContent:{refX:0,type:"custom",renderCustomCallback:()=>u,autoRotate:!1,offsetX:c.x+c.width/2-_.x,offsetY:c.y+c.height/2-_.y},itemLine:{visible:y,type:"type-po",lineStyle:jt(Object.assign({},(s=this._spec.leader)===null||s===void 0?void 0:s.style)),startSymbol:{visible:!1}}})}}_renderMarkers(){if(this._markerComponents&&this._markerComponents.length)for(let t=0;t<this._markerComponents.length;t++)this.getContainer().add(this._markerComponents[t])}_layoutLabels(t){return this._spec.position==="outer"&&this._map?MXt(t,this._map,e=>this._series.dataToPosition({[this._longitudeField]:e[0],[this._latitudeField]:e[1]})):ost(t)}_isRelativeModel(t){var e,i,r;const s=(i=(e=this._series.getXAxisHelper())===null||e===void 0?void 0:e.getAxisId())!==null&&i!==void 0?i:(r=this._series.getCoordinateHelper())===null||r===void 0?void 0:r.getCoordinateId();return(t==null?void 0:t.id)===s}_isRelativeSeries(t){return(t==null?void 0:t.id)===this._series.id}onRender(t){}changeRegions(){}_getNeedClearVRenderComponents(){return this._markerComponents}}DA.type=vt.mapLabel,DA.specKey="mapLabel";const RXt=()=>{q.registerComponent(DA.type,DA)};class YI{constructor(t,e){this._chartLayoutRect={x:0,y:0,width:1,height:1},this._col=1,this._row=1,this._elementMap=new Map,this.standardizationSpec(t),this._gridInfo=t,this._col=t.col,this._row=t.row,this._colSize=new Array(this._col).fill(null),this._rowSize=new Array(this._row).fill(null),this._colElements=new Array(this._col).fill([]),this._rowElements=new Array(this._row).fill([]),this._onError=e==null?void 0:e.onError,this.initUserSetting()}standardizationSpec(t){var e,i,r;t.col=(e=t.col)!==null&&e!==void 0?e:1,t.row=(i=t.row)!==null&&i!==void 0?i:1,t.elements=(r=t.elements)!==null&&r!==void 0?r:[]}initUserSetting(){this._gridInfo.colWidth&&this.setSizeFromUserSetting(this._gridInfo.colWidth,this._colSize,this._col,this._chartLayoutRect.width),this._gridInfo.rowHeight&&this.setSizeFromUserSetting(this._gridInfo.rowHeight,this._rowSize,this._row,this._chartLayoutRect.height),this._colSize.forEach((t,e)=>{t||(this._colSize[e]={value:0,isUserSetting:!1,isLayoutSetting:!1})}),this._rowSize.forEach((t,e)=>{t||(this._rowSize[e]={value:0,isUserSetting:!1,isLayoutSetting:!1})})}setSizeFromUserSetting(t,e,i,r){t.forEach(s=>{s.index<0&&s.index>=i||(et(s.size)?e[s.index]={value:+s.size,isUserSetting:!0,isLayoutSetting:!1}:it(s.size)&&(e[s.index]={value:s.size(r),isUserSetting:!0,isLayoutSetting:!1}))})}clearLayoutSize(){this._colSize.forEach(t=>{t.isLayoutSetting=!1,t.isUserSetting||(t.value=0)}),this._rowSize.forEach(t=>{t.isLayoutSetting=!1,t.isUserSetting||(t.value=0)})}getItemGridInfo(t){var e;const i=this._elementMap.get(t);if(i)return i;let r;return r=(e=this._gridInfo.elements)===null||e===void 0?void 0:e.find(s=>{var o;if("modelId"in s&&L(s.modelId)){if(L(t.model.userId)&&t.model.userId===s.modelId)return!0}else if("modelKey"in s&&L(s.modelKey)&&"modelIndex"in s&&L(s.modelIndex)&&((o=t.model.specKey)!==null&&o!==void 0?o:t.model.type)===s.modelKey&&t.model.getSpecIndex()===s.modelIndex)return!0;return!1}),r||(r={col:0,colSpan:1,row:0,rowSpan:1}),this._elementMap.set(t,r),r}getSizeFromGrid(t,e){var i;const r=e==="col"?this._colSize:this._rowSize;let s=0;for(let o=t[e];o<t[e]+((i=t[`${e}Span`])!==null&&i!==void 0?i:1);o++)s+=r[o].value;return s}getSizeFromUser(t,e){var i,r;const s=e==="col"?this._colSize:this._rowSize;if(!(!((i=s[t[e]])===null||i===void 0)&&i.isUserSetting))return;let o=0;for(let a=t[e];a<t[e]+((r=t[`${e}Span`])!==null&&r!==void 0?r:1);a++){if(!s[a].isUserSetting)return;o+=s[a].value}return o}setItemLayoutSizeToGrid(t,e){if(km(t)){if(e.colSpan&&e.colSpan>1||this._colSize[e.col].isUserSetting)return;this._colSize[e.col].value=Math.max(this._colSize[e.col].value,t.getLayoutRect().width+t.layoutPaddingLeft+t.layoutPaddingRight),this._colSize[e.col].isLayoutSetting=!0}else{if(e.rowSpan&&e.rowSpan>1||this._rowSize[e.row].isUserSetting)return;this._rowSize[e.row].value=Math.max(this._rowSize[e.row].value,t.getLayoutRect().height+t.layoutPaddingTop+t.layoutPaddingBottom),this._rowSize[e.row].isLayoutSetting=!0}}layoutGrid(t){const e=t==="col"?this._colSize:this._rowSize;let i=t==="col"?this._chartLayoutRect.width:this._chartLayoutRect.height;const r=[];e.forEach(s=>{s.isUserSetting||s.isLayoutSetting?i-=s.value:r.push(s)}),i<0&&console.warn(`layout content ${t} size bigger than chart`),r.forEach(s=>s.value=i/r.length)}getItemPosition(t){const e=this.getItemGridInfo(t),i={x:this._chartLayoutRect.x,y:this._chartLayoutRect.y};for(let r=0;r<e.col;r++)i.x+=this._colSize[r].value;for(let r=0;r<e.row;r++)i.y+=this._rowSize[r].value;return i.x+=t.layoutPaddingLeft+t.layoutOffsetX,i.y+=t.layoutPaddingTop+t.layoutOffsetY,i}getItemLayoutRect(t){var e,i;const r=this.getItemGridInfo(t);return{width:((e=this.getSizeFromGrid(r,"col"))!==null&&e!==void 0?e:this._chartLayoutRect.width)-t.layoutPaddingLeft-t.layoutPaddingRight,height:((i=this.getSizeFromGrid(r,"row"))!==null&&i!==void 0?i:this._chartLayoutRect.height)-t.layoutPaddingTop-t.layoutPaddingBottom}}layoutItems(t,e,i,r){this._chartLayoutRect=i,this._chartViewBox=r,this.clearLayoutSize(),e.sort((u,c)=>c.layoutLevel-u.layoutLevel);const s=e.filter(u=>u.layoutType==="normal"&&u.getModelVisible()!==!1),o=s.filter(u=>km(u)),a=s.filter(u=>!km(u));s.forEach(u=>{this.layoutOneItem(u,"user",!1)});const l=e.filter(u=>u.layoutType==="region-relative"),h=l.filter(u=>km(u)),d=l.filter(u=>!km(u));h.forEach(u=>this.layoutOneItem(u,"user",!1)),this.layoutGrid("col"),a.forEach(u=>this.layoutOneItem(u,"colGrid",!1)),d.forEach(u=>{this.layoutOneItem(u,"colGrid",!1)}),this.layoutGrid("row"),d.forEach(u=>{this.layoutOneItem(u,"grid",!1)}),o.forEach(u=>this.layoutOneItem(u,"grid",!1)),h.forEach(u=>{this.layoutOneItem(u,"grid",!0)}),this.layoutGrid("col"),e.filter(u=>u.layoutType==="region").forEach(u=>this.layoutOneItem(u,"grid",!1)),this.layoutAbsoluteItems(e.filter(u=>u.layoutType==="absolute")),e.filter(u=>u.layoutType!=="absolute").forEach(u=>{u.setLayoutStartPosition(this.getItemPosition(u))})}layoutAbsoluteItems(t){t.forEach(e=>{e.absoluteLayoutInRect(this._chartLayoutRect)})}layoutOneItem(t,e,i){var r,s;const o=e==="rowGrid"||e==="grid"?this.getSizeFromGrid.bind(this):this.getSizeFromUser.bind(this),a=e==="colGrid"||e==="grid"?this.getSizeFromGrid.bind(this):this.getSizeFromUser.bind(this),l=this.getItemGridInfo(t),h={width:((r=a(l,"col"))!==null&&r!==void 0?r:this._chartLayoutRect.width)-t.layoutPaddingLeft-t.layoutPaddingRight,height:((s=o(l,"row"))!==null&&s!==void 0?s:this._chartLayoutRect.height)-t.layoutPaddingTop-t.layoutPaddingBottom},d=t.computeBoundsInRect(h);et(d.width)||(d.width=h.width),et(d.height)||(d.height=h.height),t.setLayoutRect(e!=="grid"?d:h),this.setItemLayoutSizeToGrid(t,l)}}function km(n){return n.layoutOrient==="left"||n.layoutOrient==="right"}YI.type="grid";const BXt=()=>{q.registerLayout(YI.type,YI)};class XI extends qF{layoutItems(t,e,i,r){this._layoutInit(t,e,i,r),this._layoutNormalItems(e);const s={left:this.leftCurrent,top:this.topCurrent,right:this.rightCurrent,bottom:this.bottomCurrent},o=e.filter(v=>v.layoutType==="absolute"),a=o.filter(v=>v.layoutOrient==="z");let l={width:0,height:0};a.length&&(l=a[0].getLayoutRect()),this.leftCurrent+=l.width/8,this.rightCurrent-=l.width/8,this.topCurrent+=l.height/8,this.bottomCurrent-=l.height/8;const{regionItems:h,relativeItems:d,relativeOverlapItems:u,allRelatives:c,overlapItems:g}=this._groupItems(e);this.layoutRegionItems(h,d,u,g),this._processAutoIndent(h,d,u,g,c,s);const p=o.filter(v=>v.layoutOrient!=="z");this.layoutAbsoluteItems(p);const f=d.filter(v=>v.model.specKey==="axes"&&xi(v.layoutOrient))[0],m=d.filter(v=>v.model.specKey==="axes"&&Fa(v.layoutOrient))[0];if(f&&a.length){const v=f.getLayoutStartPoint(),_=f.getLayoutRect(),b={x:m.layoutOrient==="left"?v.x+_.width:v.x,y:v.y,width:this._chartLayoutRect.width,height:this._chartLayoutRect.height};a[0].model.directionStr=m.layoutOrient==="left"?"r2l":"l2r";const y=f.getLayoutRect(),C=m.getLayoutRect(),S={length:a[0].getLayoutRect().width,width:y.width,height:C.height};f.model.setLayout3dBox&&f.model.setLayout3dBox(S),m.model.setLayout3dBox&&m.model.setLayout3dBox(S),a[0].model.setLayout3dBox&&a[0].model.setLayout3dBox(S),this.layoutZAxisItems(a,b)}}layoutZAxisItems(t,e){t.forEach(i=>{i.absoluteLayoutInRect(e)})}getItemComputeLayoutRect(t,e){return e||(e={offsetLeft:0,offsetRight:0,offsetTop:0,offsetBottom:0}),{width:this.rightCurrent-this.leftCurrent-t.layoutPaddingLeft-t.layoutPaddingRight-(e.offsetLeft+e.offsetRight),height:this.bottomCurrent-this.topCurrent-t.layoutPaddingTop-t.layoutPaddingBottom-(e.offsetTop+e.offsetBottom)}}_checkAutoIndent(t){const e={top:0,left:0,bottom:0,right:0},i=this._chartViewBox.x2-this._chartViewBox.x1-this.rightCurrent,r=this._chartViewBox.y2-this._chartViewBox.y1-this.bottomCurrent;return t.forEach(s=>{if(!s.getModelVisible()||!s.autoIndent)return;const o=s.layoutOrient==="left"||s.layoutOrient==="right",a=s.getLastComputeOutBounds();o?(e.top=Math.max(e.top,a.y1-this.topCurrent),e.bottom=Math.max(e.bottom,a.y2-r)):(e.left=Math.max(e.left,a.x1-this.leftCurrent),e.right=Math.max(e.right,a.x2-i))}),e}}XI.type="layout3d";const PXt=()=>{q.registerLayout(XI.type,XI)},EXt=()=>{TFt()},Vp="vchart-tooltip",X7=`${Vp}-container`,dC=`${Vp}-title`,lP=`${Vp}-content-box`,LXt="",hP={offsetX:10,offsetY:10},K7="99999999999999";function Ig(n){return String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\(/g,"&#40;").replace(/  /g," &nbsp;")}const q7=(n,t)=>n?(t||(t=n.getBoundingClientRect()),n.offsetWidth>0?t.width/n.offsetWidth:n.offsetHeight>0?t.height/n.offsetHeight:1):1,Z7=n=>yt(n)&&(n==null?void 0:n.trim())!==""||J(n)?Ig(n):LXt,Rm=(n,t)=>{let e;if(L(n)){if(J(n))e=n;else if(it(n)){const i=n(t);J(i)&&(e=i)}}return e},IXt={left:[-2,0],right:[2,0],top:[0,-2],lt:[-2,-2],tl:[-2,-2],rt:[2,-2],tr:[2,-2],bottom:[0,2],bl:[-2,2],lb:[-2,2],br:[2,2],rb:[2,2],inside:[0,0],center:[0,0],centerBottom:[0,1],centerTop:[0,-1],centerLeft:[-1,0],centerRight:[1,0]},J7=(n,t,e=2)=>{var i,r;return(r=(i=IXt[n])===null||i===void 0?void 0:i[t==="x"?0:1])!==null&&r!==void 0?r:e},OXt=(n,t)=>{var e;const i=new Map,r=new Map,{series:s,datum:o}=n,a=s.direction==="horizontal",l=(a?s.getYAxisHelper():s.getXAxisHelper()).getAxisId(),h=s.getChart().getComponentsByKey("axes").find(u=>u.id===l);if(!h)return;(a?r:i).set(h.getSpecIndex(),{datum:(e=s.getDatumPositionValues(o[0],s.getDimensionField()))===null||e===void 0?void 0:e[0],axis:h});const d={xField:{coordKey:"x",anotherAxisKey:"y",currentValue:i,attributes:{visible:!!i.size,type:"rect"}},yField:{coordKey:"y",anotherAxisKey:"x",currentValue:r,attributes:{visible:!!r.size,type:"rect"}}};return Zrt(d,s,t),d.xField.cacheInfo?GI(d.xField):d.yField.cacheInfo?GI(d.yField):void 0},DXt=n=>kt(n)&&(L(n.left)||L(n.right)||L(n.top)||L(n.bottom)),FXt=n=>kt(n)&&(L(n.x)||L(n.y));class FH extends eH{constructor(){super(...arguments),this._visible=!0,this._isReleased=!1,this.showTooltip=(t,e,i)=>{const{changePositionOnly:r}=i;return r?this.changeTooltipPosition(i,e):this.changeTooltip(!0,i,e)},this.changeTooltip=(t,e,i)=>this._isReleased?1:t?this.changeTooltipPosition(e,i):(this._updateTooltip(!1,e),0),this.changeTooltipPosition=(t,e)=>{var i,r,s,o,a;if(this._isReleased)return 1;const l=t.event,{tooltipSpec:h,activeTooltipSpec:d,changePositionOnly:u}=t;if(!d)return 1;const c=d.activeType;if(d.handler)return(s=(r=(i=d.handler).showTooltip)===null||r===void 0?void 0:r.call(i,c,e,t))!==null&&s!==void 0?s:0;const g=d,p=this._getActualTooltipPosition(d,t,this._getTooltipBoxSize(d,u));d.position=p;const f=(o=d.updatePosition)!==null&&o!==void 0?o:(a=h[c])===null||a===void 0?void 0:a.updatePosition;f&&(d.position=f(d.position,e,t));let m=(g==null?void 0:g.visible)!==!1;return e&&l.type!=="pointerout"&&d.visible&&(d.title||d.content)||(m=!1),this._updateTooltip(m,Object.assign(Object.assign({},t),{changePositionOnly:u})),0},this._getActualTooltipPosition=(t,e,i)=>{var r,s,o,a,l,h,d,u,c;const{tooltipSpec:g}=e,p={x:1/0,y:1/0};if(!g)return p;const f=e.event,{activeType:m,data:v}=t,_=m==="dimension"?(s=(r=v[0])===null||r===void 0?void 0:r.data)===null||s===void 0?void 0:s[0]:v==null?void 0:v[0],{offsetX:b,offsetY:y}=this._option,C=g[m],S=b8(C==null?void 0:C.position,v,e),w=(o=b8(C==null?void 0:C.positionMode,v,e))!==null&&o!==void 0?o:m==="mark"?"mark":"pointer",{width:x=0,height:A=0}=i??{},M=g.renderMode==="canvas",T=(a=e==null?void 0:e.chart)===null||a===void 0?void 0:a.getCanvasRect(),R=(l=T==null?void 0:T.width)!==null&&l!==void 0?l:tp,B=(h=T==null?void 0:T.height)!==null&&h!==void 0?h:ep;let E=!1;const k={width:0,height:0};let P,I={x:0,y:0},O={x:0,y:0},H=1,z=1;const F=Ua(this._env);if(F&&!g.confine?(k.width=window.innerWidth,k.height=window.innerHeight):(k.width=R,k.height=B),F&&!M){const rt=this._getParentElement(g);O=(u=(d=rt==null?void 0:rt.getBoundingClientRect)===null||d===void 0?void 0:d.call(rt))!==null&&u!==void 0?u:p;const pt=(c=this._compiler.getCanvas())!==null&&c!==void 0?c:this._chartContainer;P=pt==null?void 0:pt.getBoundingClientRect(),I={x:P.x-O.x,y:P.y-O.y},H=q7(pt,P),z=q7(rt,O)}const j=z/H,$={},Y={x:S,y:S},G={x:["left","right"],y:["top","bottom"]},tt=({orient:rt,mode:pt,offset:at},W)=>{var N;let K,nt;const X=e.model,ht=X==null?void 0:X.getLayoutStartPoint(),_t=at??(W==="x"?b:y);if(pt==="mark"){E=!0;const ct=e.item,U=ct==null?void 0:ct.getBounds();U&&ht&&(K=(W==="x"?U.x1:U.y1)+ht[W],nt=(W==="x"?U.x2:U.y2)+ht[W])}else if(pt==="crosshair"&&((N=_==null?void 0:_.series)===null||N===void 0?void 0:N.coordinate)==="cartesian"&&_.datum&&_.datum.length){E=!0;const ct=OXt(_,ht);ct&&(K=ct.start[W],nt=ct.end[W])}else Y[W]=rt;if(E){const ct=G[W][0],U=W==="x"?x:A;switch(J7(rt,W)){case-2:$[ct]=K-U*j-_t;break;case 0:$[ct]=(K+nt)/2-U*j/2;break;case-1:$[ct]=(K+nt)/2-U*j-_t;break;case 1:$[ct]=(K+nt)/2+_t;break;case 2:$[ct]=nt+_t}}},st=["x","y"];if(kt(S))if(DXt(S)){const{left:rt,right:pt,top:at,bottom:W}=S;$.left=Rm(rt,f),$.top=Rm(at,f),$.right=Rm(pt,f),$.bottom=Rm(W,f)}else FXt(S)&&st.forEach(rt=>{const pt=S[rt];J(pt)||it(pt)?$[G[rt][0]]=Rm(pt,f):tt(pt,rt)});else L(S)&&(tt({orient:S,mode:w},"x"),tt({orient:S,mode:w},"y"));const ot={x:null,y:null};return st.forEach(rt=>{var pt;const at=rt==="x"?x:A,W=rt==="x"?R:B,N=rt==="x"?b:y,K=J7(Y[rt],rt);if(et($[G[rt][0]]))ot[rt]=$[G[rt][0]];else if(et($[G[rt][1]]))ot[rt]=W-at*j-$[G[rt][1]];else{const _t=rt==="x"?f.canvasX:f.canvasY;ot[rt]=K>0?_t+N:K===0?_t-at*j/2:_t-at*j-N}ot[rt]*=H,F&&(ot[rt]+=I[rt]),ot[rt]/=z;const nt=rt==="x"?k.width:k.height,X=g.confine?-(O[rt]-((pt=P==null?void 0:P[rt])!==null&&pt!==void 0?pt:0)/H)/z:-O[rt]/z,ht=nt/z+X-at;K!==2&&ot[rt]<X?E?ot[rt]=X:(ot[rt]+=K===0?N+at/2:2*N+at,ot[rt]>ht&&(ot[rt]=ht)):K!==-2&&ot[rt]>ht&&(E?ot[rt]=ht:(ot[rt]-=K===0?N+at/2:2*N+at,ot[rt]<X&&(ot[rt]=X)))}),ot}}get env(){return this._env}onAdd(t){super.onAdd(t);const e=t.component;this._component=e,this._chartOption=e.getOption(),this._env=this._chartOption.mode,this._chartContainer=this._chartOption.globalInstance.getContainer(),this._compiler=e.getCompiler(),this._initFromSpec()}hideTooltip(t){return this.changeTooltip(!1,t)}release(){var t,e,i;const r=(t=this._component.getSpec())!==null&&t!==void 0?t:{};r.handler?(i=(e=r.handler).release)===null||i===void 0||i.call(e):(this._removeTooltip(),this._isReleased=!0)}_getDefaultOption(){var t,e;const{offset:i}=this._component.getSpec();return i?{offsetX:(t=i.x)!==null&&t!==void 0?t:hP.offsetX,offsetY:(e=i.y)!==null&&e!==void 0?e:hP.offsetY}:hP}_getParentElement(t){return t.parentElement}getTooltipContainer(){return this._container}_initFromSpec(){this._option=this._getDefaultOption()}reInit(){this._initFromSpec()}}FH.specKey="tooltip";const Gu=(n,t)=>L(n)?V(n)?n.map(e=>`${e}px`).join(" "):`${n}px`:t??"initial",b_=(n={},t={})=>{var e,i;L(n.fontFamily)&&(t.fontFamily=n.fontFamily);const r=(e=n.fill)!==null&&e!==void 0?e:n.fontColor;return L(r)&&(t.color=r),L(n.fontWeight)&&(t.fontWeight=n.fontWeight),L(n.textAlign)&&(t.textAlign=n.textAlign),L(n.fontSize)&&(t.fontSize=Gu(n.fontSize)),L(n.maxWidth)&&(t.maxWidth=Gu(n.maxWidth)),n.multiLine||L(n.maxWidth)&&n.multiLine!==!1?(t.whiteSpace="initial",t.wordBreak=(i=n.wordBreak)!==null&&i!==void 0?i:"break-word"):(t.wordBreak="normal",t.whiteSpace="nowrap"),t},Q7=(n={})=>{const{lineHeight:t}=n;return n.fontSize?Gi(t,n.fontSize):0},HXt=(n={})=>{var t,e,i,r;const{style:s={},enterable:o,transitionDuration:a}=n,{panel:l={},titleLabel:h,shape:d,keyLabel:u,valueLabel:c,spaceRow:g,align:p}=s,{panelStyle:f,panelPadding:m}=zXt(l),v={marginTop:"0px",marginBottom:"0px"};f.pointerEvents=o?"auto":"none",a&&(f.transitionDuration=a?`${a}ms`:"initial",f.transitionProperty=a?"transform":"initial",f.transitionTimingFunction=a?"ease-out":"initial"),et(g)&&(v.marginBottom=`${g}px`);const _={width:Gu((t=d==null?void 0:d.size)!==null&&t!==void 0?t:8)},b=b_(h),y=b_(u),C=b_(c),S=p==="right"?"marginLeft":"marginRight";p==="right"?(f.direction="rtl",b.textAlign="right",y.textAlign="right",C.textAlign="left"):(b.textAlign="left",y.textAlign="left",C.textAlign="right"),_[S]=Gu((e=d.spacing)!==null&&e!==void 0?e:8),y[S]=Gu((i=u.spacing)!==null&&i!==void 0?i:26),C[S]=Gu((r=c.spacing)!==null&&r!==void 0?r:0);const w=Math.max(Q7(c),Q7(u));return v.lineHeight=w>0?`${w}px`:"20px",{panelPadding:m,row:v,panel:f,title:b,shape:_,key:y,value:C}},zXt=n=>{var t;const{backgroundColor:e,border:i,shadow:r,padding:s}=n,o={borderWidth:`${(t=i==null?void 0:i.width)!==null&&t!==void 0?t:0}px`};let a=null;i!=null&&i.color&&(o.borderColor=i.color),e&&(o.backgroundColor=e),o.boxShadow=r?`${r.x}px ${r.y}px ${r.blur}px ${r.spread}px ${r.color}`:"initial";const{radius:l}=i??{};return L(l)&&(o.borderRadius=et(l)?`${l}px`:`${l}`),s&&(a=Fi(s),o.padding=Gu(a)),{panelStyle:o,panelPadding:a}};function uu(n,t){n&&n.style&&t&&Object.keys(t).forEach(e=>{n.style[e]=t[e]})}const lst=n=>{q.registerComponentPlugin(n.type,n)};function WXt(n,t){var e,i,r,s,o,a;if(!n||!n.hasShape||!n.shapeType)return"";const l='style="display:inline-block;vertical-align:middle;"',{shapeType:h,shapeFill:d,shapeStroke:u,shapeHollow:c=!1}=n,g=(e=n.shapeSize)!==null&&e!==void 0?e:8,p=n.shapeLineWidth?Ig(n.shapeLineWidth)+"px":"0px";let f="currentColor";const m=()=>u?Ig(u):f,v=g,_=x=>new KM({symbolType:x,size:v,fill:!0});let b=_(h);const y=b.getParsedPath();let C,S;if(!y.path&&y.pathStr&&(b=_(y.pathStr)),b.getParsedPath().path){const x=b.getParsedPath().path;S=x.toString(),C=x.bounds}else y.isSvg&&y.svgCache&&(S=y.svgCache.map(x=>x.path.toString()).join(),C=y.svgCache.reduce((x,A)=>x.union(A.path.bounds),new Bi));let w=`${C.x1} ${C.y1} ${C.width()} ${C.height()}`;if(p!=="0px"){const[x,A,M,T]=w.split(" ").map(B=>Number(B)),R=Number(p.slice(0,-2));w=`${x-R/2} ${A-R/2} ${M+R} ${T+R}`}if(!d||yt(d)||c)return f=c?"none":d?Ig(d):"currentColor",`
    <svg ${l} width="${g}" height="${g}" viewBox="${w}">
      <path
        d="${S}"
        style="fill: ${f}; stroke: ${m()}; stroke-width: ${p}"
      >
      </path>
    </svg>`;if(kt(d)){f="gradientColor"+(t??"");let x="";const A=((i=d.stops)!==null&&i!==void 0?i:[]).map(M=>`<stop offset="${Ig(M.offset.toString())}" stop-color="${Ig(M.color)}"/>`).join("");return d.gradient==="radial"?x=`<radialGradient id="${f}" cx="50%" cy="50%" r="50%" fx="0%" fy="0%">
      ${A}
      </radialGradient>`:d.gradient==="linear"&&(x=`<linearGradient id="${f}" x1="${100*((r=d.x0)!==null&&r!==void 0?r:0)}%" y1="${100*((s=d.y0)!==null&&s!==void 0?s:0)}%" x2="${100*((o=d.x1)!==null&&o!==void 0?o:0)}%" y2="${100*((a=d.y1)!==null&&a!==void 0?a:0)}%">
      ${A}
      </linearGradient>`),`
    <svg ${l} width="${g}" height="${g}" viewBox="-0.5 -0.5 1 1">
      ${x}
      <path
        d="${S}"
        style="fill: url(#${f}); stroke: ${m()}; stroke-width: ${p}"
      >
      </path>
    </svg>`}return""}class QT extends FH{getVisibility(){return!!this._rootDom&&this._rootDom.style.visibility==="visible"}setVisibility(t){t!==this.getVisibility()&&this._rootDom&&(this._rootDom.style.visibility=t?"visible":"hidden")}constructor(){super(QT.type),this.type=Pf.dom,this._tooltipContainer=Xg==null?void 0:Xg.body}onAdd(t){super.onAdd(t),this._initStyle(),this.initEl()}initEl(){const t=this._component.getSpec().parentElement;if(Xg&&t&&t.children&&t.children.length){for(let e=0;e<t.children.length;e++)if(t.children[e].classList.contains(X7)){this._container=t.children[e];break}this._container||(this._container=Xg.createElement("div"),this._container.style.position="relative",this._container.style.zIndex=K7,this._container.classList.add(X7),t.appendChild(this._container))}}initRootDom(){var t,e,i;const r=this._component.getSpec(),s=document.createElement("div"),o=(e=(t=this._chartOption)===null||t===void 0?void 0:t.getTheme())!==null&&e!==void 0?e:{};uu(s,Object.assign({left:"0",top:"0",pointerEvents:"none",padding:"12px",position:"absolute",zIndex:K7,fontFamily:(i=o==null?void 0:o.fontFamily)!==null&&i!==void 0?i:b0.fontFamily,fontSize:"11px",borderRadius:"3px",borderStyle:"solid",lineHeight:"initial",background:"#fff",boxShadow:"2px 2px 4px rgba(0, 0, 0, 0.1)",maxWidth:"100wh",maxHeight:"100vh",visibility:"hidden"},this._domStyle.panel)),s.classList.add(r.className),s.setAttribute("vchart-tooltip-id",`${this.id}`),this._container.appendChild(s),this._rootDom=s}_getTooltipBoxSize(t,e){var i;this._rootDom||this.initRootDom(),e||this._updateDomStringByCol(t),this._updateDomStyle("height");const r=(i=this._rootDom)===null||i===void 0?void 0:i.getBoundingClientRect();return{width:r==null?void 0:r.width,height:r==null?void 0:r.height}}_removeTooltip(){this._rootDom&&this._rootDom.parentNode&&(this._rootDom.parentNode.removeChild(this._rootDom),this._rootDom=null),this._container=null}_updateTooltip(t,e){var i,r,s;if(t&&this._rootDom){const{tooltipSpec:o,activeTooltipSpec:a}=e;e.changePositionOnly||(this._tooltipActual=a);const l=this.getVisibility(),h=this._rootDom;if(h){const{x:d=0,y:u=0}=(i=a.position)!==null&&i!==void 0?i:{};if(o.updateElement){this._updatePosition((r=this._cacheCustomTooltipPosition)!==null&&r!==void 0?r:{x:d,y:u}),o.updateElement(h,a,e);const c=this._getActualTooltipPosition(a,e,{width:h.offsetWidth,height:h.offsetHeight});this._updatePosition(c),this._cacheCustomTooltipPosition=c}else this._rootDom.style.transitionDuration=l?(s=this._domStyle.panel.transitionDuration)!==null&&s!==void 0?s:"initial":"0ms",this._updatePosition({x:d,y:u})}this.setVisibility(t)}else this.setVisibility(t),this._cacheCustomTooltipPosition=void 0}_initStyle(){const t=this._component.getSpec();this._domStyle=HXt(t)}_updateDomStringByCol(t){var e;const{title:i={},content:r}=t,s=r&&r.length,o=this._domStyle.row,a=[...this._rootDom.children];let l=a.find(u=>u.className.includes(dC));if(!l&&i.visible!==!1){l=document.createElement("h2");const u=document.createElement("span");l.appendChild(u),l.classList.add(dC),this._rootDom.appendChild(l)}l&&i.visible!==!1?(uu(l,Object.assign(Object.assign(Object.assign({},this._domStyle.title),s?o:{marginBottom:"0px"}),{marginTop:"0px"})),l.firstChild.innerHTML=`${(e=i.value)!==null&&e!==void 0?e:""}`):l&&i.visible===!1&&l.parentNode.removeChild(l);let h=a.find(u=>u.className.includes(lP));const d=["shape","key","value"];if(!h&&s&&(h=document.createElement("div"),d.forEach(u=>{const c=document.createElement("div");c.classList.add(`${Vp}-column`),c.classList.add(`${Vp}-${u}-column`),c.setAttribute("data-col",u),h.appendChild(c)}),h.classList.add(lP),this._rootDom.appendChild(h)),h&&s){const u=[...h.children];uu(h,{whiteSpace:"nowrap"}),u.forEach((c,g)=>{const p=c.getAttribute("data-col");if(p&&d.includes(p)){const f=p==="shape"&&r.every(v=>!v.hasShape||!v.shapeType);uu(c,Object.assign(Object.assign({},this._domStyle[p]),{display:f?"none":"inline-block",verticalAlign:"top"}));const m=[...c.children];m.slice(r.length).forEach(v=>{v.parentNode.removeChild(v)}),r.forEach((v,_)=>{let b=m[_];b||(b=document.createElement("div"),b.classList.add(`${Vp}-${p}`),c.appendChild(b));const y=Object.assign({},o);_===r.length-1&&(y.marginBottom="0px"),y.display=v.visible===!1?"none":"block",y.height="initial",p==="key"?(b.innerHTML=Z7(v.key),v.keyStyle&&b_(v.keyStyle,y)):p==="value"?(b.innerHTML=Z7(v.value),v.valueStyle&&b_(v.valueStyle,y)):p==="shape"&&(b.innerHTML=WXt(v,`${this.id}_${_}`)),uu(b,y)})}})}else h&&!s&&h.parentNode.removeChild(h)}_updateDomStyle(t="width"){var e,i,r,s,o;const a=this._rootDom,l=[...a.children].find(d=>d.className.includes(lP)),h=[...a.children].find(d=>d.className.includes(dC));if(l){const d=this._component.getSpec(),u={},c=(e=d.style)===null||e===void 0?void 0:e.titleLabel;if(c&&c.autoWidth&&c.multiLine!==!1&&h){const f=[...l.children].reduce((m,v)=>t==="height"?m+v.getBoundingClientRect().width:Math.max(m,v.getBoundingClientRect().width),0);f>0&&(h.style.maxWidth=`${f}px`,h.style.maxWidth=`${Math.ceil(l.getBoundingClientRect().width)}px`)}if(L((i=d==null?void 0:d.style)===null||i===void 0?void 0:i.maxContentHeight)){const f=h&&h.className.includes(dC)?h.getBoundingClientRect().height+((r=d.style.spaceRow)!==null&&r!==void 0?r:0):0,m=this._chartOption.getChartViewRect(),v=Gi(d.style.maxContentHeight,Math.min(m.height,document.body.clientHeight)-f-(this._domStyle.panelPadding?this._domStyle.panelPadding[0]+this._domStyle.panelPadding[1]:0));v>0&&(u.maxHeight=`${v}px`,u.overflowY="auto",u.width=`calc(100% + ${this._domStyle.panelPadding?this._domStyle.panelPadding[1]+"px":"10px"})`,uu(l,u))}const g=l.children,p=[];if(g){for(let f=0;f<g.length;f++){const m=(s=g[f].children)!==null&&s!==void 0?s:[];for(let v=0;v<m.length;v++){const _=m[v].getBoundingClientRect()[t];(p[v]===void 0||p[v]<_)&&(p[v]=_)}}for(let f=0;f<g.length;f++){const m=(o=g[f].children)!==null&&o!==void 0?o:[];for(let v=0;v<m.length;v++)m[v].style[t]=`${p[v]}px`}}}}_getParentElement(t){var e;return(e=this._container)!==null&&e!==void 0?e:super._getParentElement(t)}isTooltipShown(){return this.getVisibility()}reInit(){super.reInit(),this._initStyle(),this._rootDom&&uu(this._rootDom,this._domStyle.panel),this.getVisibility()&&(this._updateDomStringByCol(this._tooltipActual),this._updateDomStyle("height"))}_updatePosition({x:t,y:e}){this._rootDom&&(this._rootDom.style.transform=`translate3d(${t}px, ${e}px, 0)`)}}QT.type=Pf.dom;const jXt=()=>{lst(QT)},NXt={fontFamily:b0.fontFamily,spacing:10,wordBreak:"break-word"},dP=(n,t)=>{var e;let i,r;(n==null?void 0:n.type)!=="rich"&&(n==null?void 0:n.type)!=="html"?(n=(n??"").toString(),t.multiLine?(i=n.split(`
`),i=i.map((o,a)=>a<i.length-1?o+`
`:o)):i=[n],r=i.map(o=>Object.assign(Object.assign({},t),{text:o}))):(r=n.text,i=n);const s=aEt({wordBreak:(e=t.wordBreak)!==null&&e!==void 0?e:"break-word",maxWidth:t.maxWidth?t.maxWidth:void 0,width:0,height:0,textConfig:r});return{width:s.width(),height:s.height(),text:i}};function Cg(n={},t,e){var i,r;return Object.assign(Object.assign({},e??NXt),{fill:(i=n.fill)!==null&&i!==void 0?i:n.fontColor,textAlign:n.textAlign,textBaseline:n.textBaseline,fontFamily:(r=n.fontFamily)!==null&&r!==void 0?r:t==null?void 0:t.fontFamily,fontSize:n.fontSize,fontWeight:n.fontWeight,lineHeight:n.lineHeight,spacing:n.spacing,multiLine:L(n.maxWidth)?n.multiLine!==!1:n.multiLine,maxWidth:n.maxWidth,wordBreak:n.wordBreak,autoWidth:n.autoWidth})}const $Xt=n=>{var t;const{backgroundColor:e,border:i,shadow:r}=n,s={lineWidth:(t=i==null?void 0:i.width)!==null&&t!==void 0?t:0,shadow:!!r};i!=null&&i.color&&(s.stroke=i.color),e&&(s.fill=e),r&&(s.shadowColor=r.color,s.shadowBlur=r.blur,s.shadowOffsetX=r.x,s.shadowOffsetY=r.y,s.shadowSpread=r.spread);const{radius:o}=i??{};return L(o)&&(s.cornerRadius=[o,o,o,o]),s},VXt=(n,t,e)=>{var i,r,s,o,a;const{style:l={},enterable:h,transitionDuration:d}=t,{panel:u={},titleLabel:c,shape:g,keyLabel:p,valueLabel:f,spaceRow:m,align:v}=l,_=Fi(u.padding),b=Id(u.padding),y=Cg(Object.assign({textAlign:v==="right"?"right":"left"},c),e),C=Cg(Object.assign({textAlign:v==="right"?"right":"left"},p),e),S=Cg(f,e),w={fill:!0,size:(i=g==null?void 0:g.size)!==null&&i!==void 0?i:8,spacing:(r=g==null?void 0:g.spacing)!==null&&r!==void 0?r:6},x={panel:$Xt(u),padding:_,title:{},content:[],titleStyle:{value:y,spaceRow:m},contentStyle:{shape:w,key:C,value:S,spaceRow:m},hasContentShape:!1,keyWidth:0,valueWidth:0,enterable:h,transitionDuration:d,align:v},{title:A={},content:M=[]}=n;let T=b.left+b.right,R=b.top+b.bottom,B=0;const E=!!M.length;let k=0,P=0,I=0,O=0;if(E){const ot=[],rt=[],pt=[],at=[];let W=0;x.content=M.map((N,K)=>{let nt=0;const{hasShape:X,key:ht,shapeType:_t="",shapeFill:ct,shapeStroke:U,shapeLineWidth:ut,shapeSize:lt,value:At,isKeyAdaptive:ft,spaceRow:Ct,keyStyle:Ht,valueStyle:Xt,shapeHollow:ae}=N,re={height:0,spaceRow:Ct??m};if(L(ht)){const be=Nt({},C,Cg(Ht,void 0,{})),{width:Xe,height:_i,text:Gt}=dP(ht,be);re.key=Object.assign(Object.assign({width:Xe,height:_i},be),{text:Gt}),ft?rt.push(Xe):ot.push(Xe),nt=Math.max(nt,_i)}if(L(At)){const be=Nt({},S,Cg(Xt,void 0,{})),{width:Xe,height:_i,text:Gt}=dP(At,be);re.value=Object.assign(Object.assign({width:Xe,height:_i},be),{text:Gt}),pt.push(Xe),nt=Math.max(nt,_i)}if(X){const be={visible:!0,symbolType:_t};ae?be.stroke=ct:be.fill=ct,be.stroke=U??ct,be.lineWidth=ut,re.shape=be;const Xe=lt??w.size;nt=Math.max(Xe,nt),at.push(Xe)}else re.shape={visible:!1};return re.height=nt,W+=nt,K<M.length-1&&(W+=re.spaceRow),re}),R+=W,k=ot.length?Mi(ot):0,P=rt.length?Mi(rt):0,I=pt.length?Mi(pt):0,O=at.length?Mi(at)+w.spacing:0,B=Math.max(O+k+C.spacing+I+S.spacing,O+P,B),x.hasContentShape=!!at.length,x.keyWidth=k,x.valueWidth=I}let H=0,z=0,F=0;const{visible:j=!0,value:$="",valueStyle:Y,spaceRow:G}=A;x.title.visible=j,x.title.spaceRow=G??m;let tt={};const st=()=>tt.autoWidth&&tt.multiLine!==!1;if(j){tt=Nt({},y,Cg(Y,void 0,{})),st()&&(tt.multiLine=(s=tt.multiLine)===null||s===void 0||s,tt.maxWidth=(o=tt.maxWidth)!==null&&o!==void 0?o:E?Math.ceil(B):void 0);const{text:ot,width:rt,height:pt}=dP($,tt);x.title.value=Object.assign(Object.assign({width:st()?Math.min(rt,(a=tt.maxWidth)!==null&&a!==void 0?a:Number.MAX_VALUE):rt,height:pt},tt),{text:ot}),H=x.title.value.width,z=x.title.value.height,F=z+(E?x.title.spaceRow:0)}return R+=F,x.title.width=H,x.title.height=z,st()?T+=B||H:T+=Math.max(H,B),E&&x.content.forEach(ot=>{var rt;const pt=ot.value;pt&&((rt=pt.autoWidth)===null||rt===void 0||rt)&&(pt.width=T-b.left-b.right-O-k-C.spacing-S.spacing,pt.maxWidth||(pt.maxWidth=Math.ceil(pt.width)),x.valueWidth=Math.max(x.valueWidth,pt.width))}),x.panel.width=T,x.panel.height=R,x};class tk extends FH{constructor(){super(tk.type),this.type=Pf.canvas,this._attributes=null}onAdd(t){var e;super.onAdd(t),this._tooltipCanvasId=(e=this._chartOption.modeParams)===null||e===void 0?void 0:e.tooltipCanvasId}_initTooltipComponent(t){const e=this._getLayer(t);this._tooltipComponent=new Cet({autoCalculatePosition:!1,autoMeasure:!1}),e.add(this._tooltipComponent)}_getLayer(t){if(this._layer)return this._layer;this._layer=t.createLayer(this._tooltipCanvasId);const e=this._layer.layerHandler.canvas.nativeCanvas;return e&&e.style&&(e.style.touchAction="none",e.style.pointerEvents="none"),this._layer}_getTooltipBoxSize(t,e){var i,r,s;if(!e||D(this._attributes)){const a=(r=(i=this._chartOption)===null||i===void 0?void 0:i.getTheme())!==null&&r!==void 0?r:{};this._attributes=VXt(t,this._component.getSpec(),a)}const{panel:o}=(s=this._attributes)!==null&&s!==void 0?s:{};return{width:o.width+o.lineWidth,height:o.height+o.lineWidth}}_removeTooltip(){this._layer&&this._layer.removeAllChild(),this._attributes=null}_updateTooltip(t,e){this._visible=t;const i=this._compiler.getStage();if(!i)return;if(!t)return void(this._tooltipComponent&&this._tooltipComponent.attribute.visible&&(this._tooltipComponent.hideAll(),this._tooltipComponent.setAttributes({visibleAll:!1})));this._tooltipComponent||this._initTooltipComponent(i);const{activeTooltipSpec:r}=e,s=r.position;e.changePositionOnly?L(s)&&this._tooltipComponent.setAttributes(s):this._tooltipComponent.setAttributes(Object.assign(Object.assign({},this._attributes),s)),this._tooltipComponent.attribute.visible||(this._tooltipComponent.showAll(),this._tooltipComponent.setAttributes({visibleAll:!0}))}isTooltipShown(){var t;return(t=this._tooltipComponent)===null||t===void 0?void 0:t.attribute.visibleAll}release(){var t;super.release(),(t=this._layer)===null||t===void 0||t.release()}}tk.type=Pf.canvas;const GXt=()=>{lst(tk)},UXt=n=>{q.registerChartPlugin(n.type,n)},YXt=/\{([^}]+)\}/,XXt=/\{([^}]+)\}/g,KXt=/:/;class lc extends eH{constructor(){super(lc.type),this.type="formatterPlugin",this._timeModeFormat={utc:Xo.getInstance().timeUTCFormat,local:Xo.getInstance().timeFormat},this._formatter=this._format,this._timeFormatter=this._timeModeFormat.local,this._numericFormatter=Pu.getInstance().format,this._numericSpecifier=Pu.getInstance().formatter,this._numericFormatterCache=new Map,this._isNumericFormatterCache=new Map}onInit(t,e){var i;const{globalInstance:r}=t;if(!r)return;this._spec=(i=e==null?void 0:e[lc.specKey])!==null&&i!==void 0?i:{};const{timeMode:s,customFormatter:o,numericFormatter:a,timeFormatter:l}=this._spec;it(o)?this._formatter=o:(this._formatter=this._format.bind(this),it(l)?this._timeFormatter=l:s&&this._timeModeFormat[s]&&(this._timeFormatter=this._timeModeFormat[s]),a&&(this._numericFormatter=a,this._numericSpecifier=null,this._numericFormatterCache=null)),q.registerFormatter(this._formatter)}_format(t,e,i){return V(t)?t.map((r,s)=>{const o=V(i)?i[s]:i;return o?this._formatSingleLine(r,e,o):r}):V(i)?i.map(r=>this._formatSingleLine(t,e,r)):this._formatSingleLine(t,e,i)}_formatSingleLine(t,e,i){let r;return this._isNumericFormatterCache&&(this._isNumericFormatterCache.get(i)?r=this._isNumericFormatterCache.get(i):(r=YXt.test(i),this._isNumericFormatterCache.set(i,r))),r?i.replace(XXt,(s,o)=>{if(!KXt.test(o)){const d=e[o.trim()];return d!==void 0?d:s}const a=o.split(":"),l=e[a.shift()],h=a.join(":");return this._formatSingleText(l,h)}):this._formatSingleText(t,i)}_formatSingleText(t,e){if(WY.test(e)&&this._numericFormatter){let i;return this._numericFormatterCache&&this._numericSpecifier?(this._numericFormatterCache.get(e)?i=this._numericFormatterCache.get(e):(i=this._numericSpecifier(e),this._numericFormatterCache.set(e,i)),i(Number(t))):this._numericFormatter(e,Number(t))}return e.includes("%")&&this._timeFormatter?this._timeFormatter(e,t):t}release(){super.release(),this._format=null,this._timeFormatter=null,this._numericFormatter=null,this._numericSpecifier=null,this._numericFormatterCache=null,this._isNumericFormatterCache=null}}lc.pluginType="chart",lc.specKey="formatter",lc.type="formatterPlugin";const qXt=()=>{UXt(lc)};class G0 extends sr{constructor(){super(...arguments),this.type=G0.type}_getDefaultStyle(){return Object.assign(Object.assign({},super._getDefaultStyle()),{width:void 0,height:void 0,lineWidth:0})}}G0.type="image";const ZXt=()=>{q.registerMark(G0.type,G0),eNt()},JXt=()=>{qit(),HT(),vh(),Xf(),_s(),jT(),_h(),aH(),eg(),hrt(),ZXt(),wrt(),zT(),Nnt(),sH(),drt()};zn.useRegisters([M4t,B4t,O4t,U4t,R9t,P9t,E9t,D9t,k9t,z9t,W9t,j9t,V9t,J9t,Q9t,H9t,U9t,Y9t,eYt,K9t,q9t,Z9t,tYt,iYt,O9t,nYt,L9t,F4t,B9t,F9t,G9t,X9t,N9t,$9t,ms,vs,v4t,_4t,b4t,Ib,Kf,lYt,vYt,kYt,IYt,FYt,jYt,NYt,GYt,Tnt,aXt,dXt,bXt,lXt,uXt,yXt,CXt,hXt,fXt,mXt,_Xt,SXt,xXt,RXt,EXt,BXt,PXt,JXt,jXt,GXt,qXt,$jt,Xjt,Kjt,qjt,Yjt,Ujt,D4t,sIt,nIt]);const QXt=(n,t)=>{const e=n.__vccOpts||n;for(const[i,r]of t)e[i]=r;return e},tKt={class:"container"},eKt={class:"sidebar"},iKt=["aria-label"],nKt={class:"param-row"},rKt={class:"param-block"},sKt={class:"param-form"},oKt=["for"],aKt=["onUpdate:modelValue","id"],lKt=["onUpdate:modelValue","id"],hKt=["onUpdate:modelValue","id"],dKt=["onUpdate:modelValue","id","type"],uKt={class:"param-block"},cKt={class:"param-form"},gKt=["for"],pKt=["onUpdate:modelValue","id"],fKt=["onUpdate:modelValue","id"],mKt=["onUpdate:modelValue","id","type"],vKt=["disabled"],_Kt={key:0,style:{color:"red","margin-top":"8px"}},bKt={key:1,style:{color:"red","margin-top":"8px"}},yKt={__name:"App",setup(n){const t=`http://${window.location.hostname}:5012`,e={window_seconds:"()",max_steps:"",mode:"",keep_deepest:"",path_filter_mode:""},i={mark_event:"",mark_type:"",session_interval_seconds:"()",max_steps:"",max_group_count:"",replace_value:"",session_mode:""},r=()=>({window_seconds:10,max_steps:5,mode:"default",keep_deepest:!0,path_filter_mode:"max_duration"}),s=()=>({mark_event:"reg",mark_type:"start",session_interval_seconds:1800,max_steps:10,max_group_count:2,replace_value:"replace_value",session_mode:"session_uniq_with_group"}),o=Us(r()),a=Us(s()),l=Us(!1),h=Us(!1),d=Us(""),u=Us(""),c=Us(null),g=Us(null),p=Us(!1),f=Us(null),m=Us(null),v=Us(null);function _(B){const E=B.keep_deepest?"and step_count=funnel_track_max_step":"";let k="";switch(B.path_filter_mode){case"all_paths":k=`
select 
uid
,group0
,array_popfront(cast(funnel_path as ARRAY<bigint>)) as funnel_track 
from track_explode
      `;break;case"first_path":k=`
select 
uid
,group0
,array_popfront(cast(funnel_path as ARRAY<bigint>)) as funnel_track 
from track_explode
where path_rank=1
      `;break;case"max_duration":k=`
select 
uid
,group0
,array_popfront(cast(max_by(funnel_path,duration_sum_second) as ARRAY<bigint>)) as funnel_track 
from track_explode
group by uid,group0
      `;break;case"min_duration":k=`
select 
uid
,group0
,array_popfront(cast(min_by(funnel_path,duration_sum_second) as ARRAY<bigint>)) as funnel_track 
from track_explode
group by uid,group0
      `;break}return`
-- SQL
with track_udf as (
    SELECT 
        uid,
        group0 as link_col,
        window_funnel_track(
            ${B.window_seconds}, 
            ${B.max_steps}, 
            '${B.mode}', 
            group_concat(_event_string)
        ) as funnel_result
    FROM (
        select 
            *,
            concat(dt,'#'
            ,event='reg'
            ,'@',event='iap'
            ,'@',event='chat'
            ,'#',group0
            ) as _event_string
        from doris_udf_test.user_event_log
    ) t1
    GROUP BY 
    uid
    ,link_col
)
,track_explode as (
select * from (
    select uid
    ,group0
    ,funnel_result
    ,funnel_path
    ,ifnull(duration_sum_second,0) as duration_sum_second
    ,step_count
    ,max(step_count) over(partition by uid,funnel_result) as funnel_track_max_step
    ,row_number() over(partition by uid,group0 order by funnel_path) as path_rank
    from (     
        select 
            uid
            ,link_col
            ,funnel_result
            ,e1 as funnel_path
            ,cast(cast(array_slice(cast(e1 as ARRAY<varchar>),-1,1) as array<string>)[1] as array<string>)[1] as group0
            ,abs(array_sum(array_popfront(array_popback(cast(e1 as ARRAY<bigint>)))))/1000 as duration_sum_second
            ,array_size(cast(e1 as ARRAY<bigint>))-1 as step_count
            from 
            track_udf
            lateral view EXPLODE(cast(funnel_result as ARRAY<varchar>)) tmp as e1
        ) t1
) t2 where 1=1 
${E}
)
,path_filter_mode as (
${k}
)
select
  ifnull (group0, 'Total') as group0,
  funnel_level,
  count(distinct uid) as value,
  count(1) as path_count,
  round(avg(duration), 1) as avg_duration,
  cast(percentile(duration, 0) as int) as p0,
  cast(percentile(duration, 0.25) as int) as p25,
  cast(percentile(duration, 0.5) as int) as p50,
  cast(percentile(duration, 0.75) as int) as p75,
  cast(percentile(duration, 0.90) as int) as p90,
  cast(percentile(duration, 1) as int) as p100,
  percentile(duration, 0.75) + 1.5 * (percentile(duration, 0.75) - percentile(duration, 0.25)) as Q3_plus_1_5IQR,
  percentile(duration, 0.25) -1.5 * (percentile(duration, 0.75) - percentile(duration, 0.25)) as Q1_minus_1_5IQR
from
  (
    SELECT
      uid,
      group0,
      funnel_track,
      abs(funnel_track[e1] / 1000) as duration,
      e1 as funnel_level
    FROM
      path_filter_mode 
      lateral VIEW explode (array_enumerate (funnel_track)) tmp1 AS e1
  ) t
where
  funnel_level >= 1
group by
  grouping sets ((funnel_level), (group0, funnel_level))
order by
  ifnull (group0, 'Total'),
  funnel_level
  `}function b(B){return`
-- SQL
with session_udf as (
select 
    path_uid,
    session_agg(
        '${B.mark_event}',
        '${B.mark_type}',
        group_concat(path),
        ${B.session_interval_seconds},
        ${B.max_steps},
        ${B.max_group_count},
        '${B.replace_value}',
        '${B.session_mode}' 
    ) as session_result
    from (
        select 
            json_array(dt,event,group0,group1) as path,
            uid as path_uid
        from doris_udf_test.user_event_log
    ) t1
group by 
    path_uid
)
select 
    e1,
    count(1) as value
from
    session_udf lateral view EXPLODE(cast(session_result as ARRAY<varchar>)) tmp as e1    
group by e1
  `}async function y(){l.value=!0,d.value="",c.value=null,f.value=null,m.value=null;const B=_(o.value);try{const E=await fetch(`${t}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql1:B})});if(!E.ok)throw new Error("");const k=await E.json();c.value=k.result1,k.result1&&k.result1.data&&S(k.result1.data)}catch(E){d.value=E.message}finally{l.value=!1}}async function C(){h.value=!0,u.value="",g.value=null,v.value=null;const B=b(a.value);try{const E=await fetch(`${t}/query`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql1:B})});if(!E.ok)throw new Error("");const k=await E.json();g.value=k.result1,k.result1&&k.result1.data&&w(k.result1.data)}catch(E){u.value=E.message}finally{h.value=!1}}function S(B){const E=B.filter(P=>P.group0==="Total").map(P=>{var I;return{step:`${P.funnel_level}`,value:P.value,conversion:P.funnel_level===1?100:Math.round(P.value/((I=B.find(O=>O.group0==="Total"&&O.funnel_level===1))==null?void 0:I.value)*100)}});f.value=E;const k=B.filter(P=>P.group0==="Total").map(P=>({step:`${P.funnel_level}`,min:P.p0,q1:P.p25,median:P.p50,q3:P.p75,max:P.p100,avg:P.avg_duration}));m.value=k,Og(()=>{x(),A()})}function w(B){const E={nodes:[],links:[]},k=[...new Set(B.map(P=>P.e1))];E.nodes=k.map((P,I)=>({id:P,name:P}));for(let P=0;P<k.length-1;P++){const I=B.find(H=>H.e1===k[P]),O=B.find(H=>H.e1===k[P+1]);I&&O&&E.links.push({source:k[P],target:k[P+1],value:Math.min(I.value,O.value)})}v.value=E,Og(()=>{M()})}function x(){const B=document.getElementById("funnel-chart");if(!B||!f.value)return;B.innerHTML="";const E={type:"funnel",data:{values:f.value},categoryField:"step",valueField:"value",label:{visible:!0,position:"right",style:{fontSize:12}},title:{visible:!0,text:""}};new zn(E,{dom:"funnel-chart"}).renderSync()}function A(){const B=document.getElementById("box-chart");if(!B||!m.value)return;B.innerHTML="";const E={type:"boxplot",data:{values:m.value},xField:"step",yField:["min","q1","median","q3","max"],boxStyle:{fill:"#5470c6",stroke:"#5470c6"},title:{visible:!0,text:""},axes:[{orient:"left",title:{visible:!0,text:"()"}},{orient:"bottom",title:{visible:!0,text:""}}]};new zn(E,{dom:"box-chart"}).renderSync()}function M(){const B=document.getElementById("sankey-chart");if(!B||!v.value)return;B.innerHTML="";const E={type:"sankey",data:{nodes:v.value.nodes,links:v.value.links},nodeKey:"id",sourceField:"source",targetField:"target",valueField:"value",title:{visible:!0,text:""}};new zn(E,{dom:"sankey-chart"}).renderSync()}function T(B,E){const k=document.getElementById(B);if(!k||!E||!E.data)return;k.innerHTML="";const P=E.column_order.map(O=>({field:O,title:O,width:120})),I={records:E.data,columns:P,theme:{bodyStyle:{fontSize:12},headerStyle:{fontSize:14}}};new lkt(k,I)}hv(c,B=>{Og(()=>{T("table1",B)})}),hv(g,B=>{Og(()=>{T("table2",B)})});function R(){y(),C()}return E9(()=>{R()}),(B,E)=>(dr(),Tr("div",tKt,[bh(Ei("div",eKt,[Ei("div",{class:y_(["sidebar-toggle-btn",{collapsed:p.value}]),onClick:E[0]||(E[0]=k=>p.value=!p.value),"aria-label":p.value?"":""},E[2]||(E[2]=[Ei("span",{class:"arrow"},"",-1)]),10,iKt),Ei("div",nKt,[Ei("div",rKt,[E[5]||(E[5]=Ei("h2",null,"",-1)),Ei("div",sKt,[(dr(!0),Tr(jo,null,$H(o.value,(k,P)=>(dr(),Tr("div",{key:P,class:"form-row"},[Ei("label",{for:"funnel-"+P},Sg(e[P]||P),9,oKt),P==="mode"?bh((dr(),Tr("select",{key:0,"onUpdate:modelValue":I=>o.value[P]=I,id:"funnel-"+P},E[3]||(E[3]=[Ei("option",{value:"default"},"default",-1),Ei("option",{value:"backtrack"},"backtrack",-1),Ei("option",{value:"increase"},"increase",-1)]),8,aKt)),[[Pm,o.value[P]]]):P==="keep_deepest"?bh((dr(),Tr("input",{key:1,"onUpdate:modelValue":I=>o.value[P]=I,id:"funnel-"+P,type:"checkbox"},null,8,lKt)),[[sY,o.value[P]]]):P==="path_filter_mode"?bh((dr(),Tr("select",{key:2,"onUpdate:modelValue":I=>o.value[P]=I,id:"funnel-"+P},E[4]||(E[4]=[Ei("option",{value:"all_paths"},"",-1),Ei("option",{value:"first_path"},"",-1),Ei("option",{value:"max_duration"},"",-1),Ei("option",{value:"min_duration"},"",-1)]),8,hKt)),[[Pm,o.value[P]]]):bh((dr(),Tr("input",{key:3,"onUpdate:modelValue":I=>o.value[P]=I,id:"funnel-"+P,type:typeof k=="number"?"number":"text",step:"any"},null,8,dKt)),[[mz,o.value[P]]])]))),128))])]),Ei("div",uKt,[E[8]||(E[8]=Ei("h2",null,"",-1)),Ei("div",cKt,[(dr(!0),Tr(jo,null,$H(a.value,(k,P)=>(dr(),Tr("div",{key:P,class:"form-row"},[Ei("label",{for:"session-"+P},Sg(i[P]||P),9,gKt),P==="mark_type"?bh((dr(),Tr("select",{key:0,"onUpdate:modelValue":I=>a.value[P]=I,id:"session-"+P},E[6]||(E[6]=[Ei("option",{value:"start"},"start",-1),Ei("option",{value:"end"},"end",-1)]),8,pKt)),[[Pm,a.value[P]]]):P==="session_mode"?bh((dr(),Tr("select",{key:1,"onUpdate:modelValue":I=>a.value[P]=I,id:"session-"+P},E[7]||(E[7]=[QH('<option value="default" data-v-51786c48>default</option><option value="cons_uniq" data-v-51786c48>cons_uniq</option><option value="session_uniq" data-v-51786c48>session_uniq</option><option value="cons_uniq_with_group" data-v-51786c48>cons_uniq_with_group</option><option value="session_uniq_with_group" data-v-51786c48>session_uniq_with_group</option>',5)]),8,fKt)),[[Pm,a.value[P]]]):bh((dr(),Tr("input",{key:2,"onUpdate:modelValue":I=>a.value[P]=I,id:"session-"+P,type:typeof k=="number"?"number":"text",step:"any"},null,8,mKt)),[[mz,a.value[P]]])]))),128))])])]),Ei("button",{class:"query-btn",onClick:R,disabled:l.value||h.value},Sg(l.value||h.value?"...":""),9,vKt),d.value?(dr(),Tr("div",_Kt,Sg(d.value),1)):lk("",!0),u.value?(dr(),Tr("div",bKt,Sg(u.value),1)):lk("",!0)],512),[[uat,!p.value]]),p.value?(dr(),Tr("div",{key:0,class:"sidebar-toggle-btn collapsed",onClick:E[1]||(E[1]=k=>p.value=!1),"aria-label":"",style:{position:"fixed",left:"0",top:"880px",height:"36px",width:"40px","z-index":"1000"}},E[9]||(E[9]=[Ei("span",{class:"arrow"},"",-1)]))):lk("",!0),Ei("div",{class:y_(["result-area",{expand:p.value}])},E[10]||(E[10]=[QH('<h2 data-v-51786c48></h2><div class="result-block" data-v-51786c48><h3 data-v-51786c48></h3><div id="table1" class="table-container" data-v-51786c48></div><div class="chart-row" data-v-51786c48><div id="funnel-chart" class="chart-container" data-v-51786c48></div><div id="box-chart" class="chart-container" data-v-51786c48></div></div></div><div class="result-block" data-v-51786c48><h3 data-v-51786c48></h3><div id="table2" class="table-container" data-v-51786c48></div><div id="sankey-chart" class="chart-container" data-v-51786c48></div></div>',3)]),2)]))}},CKt=QXt(yKt,[["__scopeId","data-v-51786c48"]]);Bat(CKt).mount("#app");
