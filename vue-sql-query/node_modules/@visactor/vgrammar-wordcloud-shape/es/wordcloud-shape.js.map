{"version":3,"sources":["../src/wordcloud-shape.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,MAAM,EAAE,KAAK,EAAE,MAAM,kBAAkB,CAAC;AACjD,OAAO,EAAE,KAAK,EAAE,MAAM,yBAAyB,CAAC;AAEhD,OAAO,EAAE,0BAA0B,EAAE,MAAM,QAAQ,CAAC;AAEpD,OAAO,EAAE,MAAM,EAAE,MAAM,UAAU,CAAC;AAElC,MAAM,CAAC,MAAM,SAAS,GAAG,CACvB,OAA8B,EAC9B,YAAmB,EACnB,UAAgB,EAChB,IAAY,EACgC,EAAE;IAE9C,IACE,CAAC,OAAO,CAAC,IAAI;QACb,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACtB,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;QACtB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC;QACpB,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,EACpB;QACA,MAAM,MAAM,GAAG,MAAM,CAAC,WAAW,EAAE,CAAC;QACpC,MAAM,CAAC,IAAI,CAAC,kDAAkD,CAAC,CAAC;QAEhE,OAAO,EAAE,CAAC;KACX;IAED,OAAO,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAExE,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE;QAClB,KAAK,CAAC,yCAAyC,CAAC,CAAC;KAClD;IACD,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE;QACjB,KAAK,CAAC,wCAAwC,CAAC,CAAC;KACjD;IAED,CAAA,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,IAAI,KAAI,IAAI,CAAC,IAAI,CAAC,0BAA0B,CAAC,6BAA6B,CAAC,CAAC;IAGlF,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,MAAM,KAAK,CAAC,EAAE;QAC9C,OAAO,EAAE,CAAC;KACX;IAED,MAAM,MAAM,GAAG,IAAI,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IAEzC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,CAAC;IAE5B,IAAI,MAAM,CAAC,UAAU,EAAE,EAAE;QACvB,OAAO;YACL,WAAW,EAAE,MAAM;SAC6B,CAAC;KACpD;IACD,OAAO,MAAM,CAAC,MAAM,EAAE,CAAC;AACzB,CAAC,CAAC","file":"wordcloud-shape.js","sourcesContent":["import { Logger, isNil } from '@visactor/vutils';\nimport { error } from '@visactor/vgrammar-util';\nimport type { WordCloudShapeOptions } from './interface';\nimport { WORDCLOUD_SHAPE_HOOK_EVENT } from './util';\nimport type { IProgressiveTransformResult, IView } from '@visactor/vgrammar-core';\nimport { Layout } from './layout';\n\nexport const transform = (\n  options: WordCloudShapeOptions,\n  upstreamData: any[],\n  parameters?: any,\n  view?: IView\n): any[] | IProgressiveTransformResult<any[]> => {\n  /** options 配置错误提示 */\n  if (\n    !options.size ||\n    isNil(options.size[0]) ||\n    isNil(options.size[1]) ||\n    options.size[0] <= 0 ||\n    options.size[1] <= 0\n  ) {\n    const logger = Logger.getInstance();\n    logger.info('Wordcloud size dimensions must be greater than 0');\n    // size非法不报错，不进行布局，ChartSpace层会有用户初始化size为0的情况\n    return [];\n  }\n  /** size 处理, 如果是小数, segmentation 计算会有问题导致place陷入死循环 */\n  options.size = [Math.ceil(options.size[0]), Math.ceil(options.size[1])];\n\n  if (!options.shape) {\n    error('WordcloudShape shape must be specified.');\n  }\n  if (!options.text) {\n    error('WordcloudShape text must be specified.');\n  }\n\n  view?.emit && view.emit(WORDCLOUD_SHAPE_HOOK_EVENT.BEFORE_WORDCLOUD_SHAPE_LAYOUT);\n\n  // 第一次数据流到这里data为空，如果不做判断，走到布局算法会报错\n  if (!upstreamData || upstreamData.length === 0) {\n    return [];\n  }\n\n  const layout = new Layout(options, view);\n\n  layout.layout(upstreamData);\n\n  if (layout.unfinished()) {\n    return {\n      progressive: layout\n    } as unknown as IProgressiveTransformResult<any[]>;\n  }\n  return layout.output();\n};\n"]}