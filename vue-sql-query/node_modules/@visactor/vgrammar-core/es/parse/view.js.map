{"version":3,"sources":["../src/parse/view.ts"],"names":[],"mappings":"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","file":"view.js","sourcesContent":["import type { IBounds } from '@visactor/vutils';\nimport { isNumber, Bounds } from '@visactor/vutils';\nimport {\n  DefaultAnimationDelay,\n  DefaultAnimationDuration,\n  DefaultAnimationEasing,\n  DefaultAnimationOneByOne,\n  DefaultEnableExitAnimation,\n  DefaultMorph,\n  DefaultMorphAll,\n  DefaultReuse,\n  DefaultSplitPath\n} from '../graph/constants';\nimport type { GroupMarkSpec, IRunningConfig, ITheme, MarkSpec, SignalSpec } from '../types';\nimport type { IViewOptions, IViewThemeConfig, ViewSpec } from '../types/view';\nimport {\n  SIGNAL_AUTOFIT,\n  SIGNAL_HEIGHT,\n  SIGNAL_PADDING,\n  SIGNAL_VIEW_HEIGHT,\n  SIGNAL_VIEW_WIDTH,\n  SIGNAL_WIDTH,\n  SIGNAL_VIEW_BOX\n} from '../view/constants';\n\nlet markBaseId = -1;\n\nexport const BuiltInSignalID = [\n  SIGNAL_WIDTH,\n  SIGNAL_HEIGHT,\n  SIGNAL_PADDING,\n  SIGNAL_VIEW_WIDTH,\n  SIGNAL_VIEW_HEIGHT,\n  SIGNAL_VIEW_BOX,\n  SIGNAL_AUTOFIT\n];\n\nexport const builtInSignals = (option: IViewOptions, config: IViewThemeConfig, theme: ITheme): SignalSpec<any>[] => {\n  return [\n    { id: SIGNAL_WIDTH, value: option[SIGNAL_WIDTH] ?? 0 },\n    { id: SIGNAL_HEIGHT, value: option[SIGNAL_HEIGHT] ?? 0 },\n    { id: SIGNAL_PADDING, value: normalizePadding(option[SIGNAL_PADDING] ?? config[SIGNAL_PADDING] ?? theme?.padding) },\n    {\n      id: SIGNAL_VIEW_WIDTH,\n      update: {\n        callback: (signal: number, params: any) => {\n          const padding = normalizePadding(params[SIGNAL_PADDING]);\n          return params[SIGNAL_WIDTH] - padding.left - padding.right;\n        },\n        dependency: [SIGNAL_WIDTH, SIGNAL_PADDING]\n      }\n    },\n    {\n      id: SIGNAL_VIEW_HEIGHT,\n      update: {\n        callback: (signal: number, params: any) => {\n          const padding = normalizePadding(params[SIGNAL_PADDING]);\n          return params[SIGNAL_HEIGHT] - padding.top - padding.bottom;\n        },\n        dependency: [SIGNAL_HEIGHT, SIGNAL_PADDING]\n      }\n    },\n    {\n      id: SIGNAL_VIEW_BOX,\n      update: {\n        callback: (signal: IBounds, params: any) => {\n          const padding = normalizePadding(params[SIGNAL_PADDING]);\n          return (signal ? signal : new Bounds()).setValue(\n            padding.left,\n            padding.top,\n            padding.left + params[SIGNAL_VIEW_WIDTH],\n            padding.top + params[SIGNAL_VIEW_HEIGHT]\n          );\n        },\n        dependency: [SIGNAL_VIEW_WIDTH, SIGNAL_VIEW_HEIGHT, SIGNAL_PADDING]\n      }\n    },\n    {\n      id: SIGNAL_AUTOFIT,\n      value: option[SIGNAL_AUTOFIT] ?? config[SIGNAL_AUTOFIT]\n    }\n  ];\n};\n\nexport const normalizePadding = (\n  value: number | { top?: number; left?: number; right?: number; bottom?: number }\n): { top: number; left: number; right: number; bottom: number } => {\n  if (isNumber(value)) {\n    return { top: value, bottom: value, left: value, right: value };\n  }\n  return { top: value?.top ?? 0, bottom: value?.bottom ?? 0, left: value?.left ?? 0, right: value?.right ?? 0 };\n};\n\nexport const normalizeMarkTree = (spec: ViewSpec) => {\n  const traverse = (spec: MarkSpec, group: string) => {\n    spec.group = group;\n    const id = spec.id ?? `VGRAMMAR_MARK_${++markBaseId}`;\n    spec.id = id;\n    ((spec as GroupMarkSpec).marks ?? []).forEach(child => traverse(child, id));\n  };\n  (spec.marks ?? []).forEach(mark => traverse(mark, 'root'));\n  return spec;\n};\n\nexport const normalizeRunningConfig = (runningConfig: IRunningConfig): IRunningConfig => {\n  const {\n    reuse = DefaultReuse,\n    morph = DefaultMorph,\n    morphAll = DefaultMorphAll,\n    animation = {},\n    enableExitAnimation = DefaultEnableExitAnimation\n  } = runningConfig ?? {};\n  return {\n    reuse,\n    morph,\n    morphAll,\n    animation: {\n      easing: animation.easing ?? DefaultAnimationEasing,\n      delay: animation.delay ?? DefaultAnimationDelay,\n      duration: animation.duration ?? DefaultAnimationDuration,\n      oneByOne: animation.oneByOne ?? DefaultAnimationOneByOne,\n      splitPath: animation.splitPath ?? DefaultSplitPath\n    },\n    enableExitAnimation\n  };\n};\n"]}