{"version":3,"sources":["../src/interactions/view-zoom.ts"],"names":[],"mappings":"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","file":"view-zoom.js","sourcesContent":["import { throttle } from '@visactor/vutils';\nimport type { ViewZoomOptions, IView, InteractionEvent, IScale, IData, IViewZoomMixin } from '../types';\nimport { ViewNavigationBase } from './view-navigation-base';\n\nexport interface ViewZoom\n  extends Pick<\n      IViewZoomMixin,\n      'formatZoomEvent' | 'handleZoomStart' | 'handleZoomEnd' | 'handleZoomReset' | 'updateZoomRange'\n    >,\n    ViewNavigationBase<ViewZoomOptions> {}\nexport class ViewZoom extends ViewNavigationBase<ViewZoomOptions> {\n  static type: string = 'view-zoom';\n  type: string = ViewZoom.type;\n\n  static defaultOptions: ViewZoomOptions = {\n    realtime: true,\n    focus: true,\n    trigger: 'wheel',\n    endTrigger: 'pointerup',\n    triggerOff: 'dblclick',\n    rate: 1,\n    throttle: 100\n  };\n\n  protected _inited?: boolean;\n  protected _lastScale: number;\n  protected _scaleX: IScale;\n  protected _scaleY: IScale;\n  protected _data: IData;\n  protected handleStart: (e: InteractionEvent) => void;\n  protected _isStarted?: boolean;\n\n  constructor(view: IView, option?: ViewZoomOptions) {\n    super(view, Object.assign({}, ViewZoom.defaultOptions, option));\n    this.handleStart = throttle(this.handleStartInner, this.options.throttle);\n  }\n\n  protected getEvents() {\n    return [\n      { type: this.options.trigger, handler: this.handleStart },\n      { type: this.options.endTrigger, handler: this.handleEnd },\n      { type: this.options.triggerOff, handler: this.handleReset }\n    ];\n  }\n\n  handleStartInner = (e: InteractionEvent) => {\n    (this as unknown as IViewZoomMixin).formatZoomEvent(e);\n    if (!e || (this.options.shouldStart && !this.options.shouldStart(e))) {\n      return;\n    }\n\n    if (!this._inited) {\n      this._initGrammars();\n    }\n\n    this._isStarted = true;\n\n    this.updateView(\n      'start',\n      (this as unknown as IViewZoomMixin).handleZoomStart(e, this._state, {\n        rate: this.options.rate,\n        focus: this.options.focus\n      }),\n      'zoom',\n      e\n    );\n  };\n\n  handleEnd = (e: InteractionEvent) => {\n    if (!this._isStarted) {\n      return;\n    }\n\n    (this as unknown as IViewZoomMixin).formatZoomEvent(e);\n    if (!e || (this.options.shouldEnd && !this.options.shouldEnd(e))) {\n      return;\n    }\n\n    this.updateView(\n      'end',\n      (this as unknown as IViewZoomMixin).handleZoomEnd(e, this._state, {\n        rate: this.options.rate,\n        focus: this.options.focus\n      }),\n      'zoom',\n      e\n    );\n  };\n\n  handleReset = (e: InteractionEvent) => {\n    if (!this._isStarted) {\n      return;\n    }\n    if (!e || (this.options.shouldReset && !this.options.shouldReset(e))) {\n      return;\n    }\n\n    this.updateView(\n      'reset',\n      (this as unknown as IViewZoomMixin).handleZoomReset(e, this._state, {\n        rate: this.options.rate,\n        focus: this.options.focus\n      }),\n      'zoom',\n      e\n    );\n    this._isStarted = false;\n  };\n}\n"]}