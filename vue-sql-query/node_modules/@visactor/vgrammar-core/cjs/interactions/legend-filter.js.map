{"version":3,"sources":["../src/interactions/legend-filter.ts"],"names":[],"mappings":"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","file":"legend-filter.js","sourcesContent":["import { LegendEvent } from '@visactor/vrender-components';\nimport type { DataFilterOptions, IComponent, ILegend, IView, InteractionEvent } from '../types';\nimport { DataFilterRank, GrammarMarkType } from '../graph/enums';\nimport { isString } from '@visactor/vutils';\nimport { Filter } from './filter';\n\nexport class LegendFilter extends Filter {\n  static type: string = 'legend-filter';\n  type: string = LegendFilter.type;\n\n  static defaultOptions: Omit<DataFilterOptions, 'target'> = {};\n  options: DataFilterOptions;\n\n  constructor(view: IView, options?: DataFilterOptions) {\n    super(view, options);\n    this.options = Object.assign({}, LegendFilter.defaultOptions, options);\n\n    this._marks = view\n      .getMarksBySelector(this.options.source)\n      .filter(mark => mark.markType === GrammarMarkType.component && (mark as IComponent).componentType === 'legend');\n    this._data = isString(this.options.target.data)\n      ? view.getDataById(this.options.target.data)\n      : this.options.target.data;\n  }\n\n  protected getEvents() {\n    if (!this._marks || this._marks.length === 0) {\n      return [];\n    }\n\n    const legend = this._marks[0] as ILegend;\n\n    if (!this._data || !legend) {\n      return [];\n    }\n\n    const isContinuous = legend.isContinuousLegend();\n    const filter = this.options.target.filter;\n    const transform = this.options.target.transform;\n\n    const getFilterValue = (event: InteractionEvent) =>\n      isContinuous ? { start: event.detail.value[0], end: event.detail.value[1] } : event.detail.currentSelected;\n    const dataFilter = isString(filter)\n      ? isContinuous\n        ? (datum: any, filterValue: { start: number; end: number }) =>\n            datum[filter] >= filterValue.start && datum[filter] <= filterValue.end\n        : (datum: any, filterValue: any[]) => filterValue.includes(datum[filter])\n      : filter;\n\n    this._filterData(this._data, legend, DataFilterRank.legend, getFilterValue, dataFilter, transform);\n\n    const eventName = isContinuous ? 'change' : LegendEvent.legendItemClick;\n    return [\n      {\n        type: eventName,\n        handler: this.handleFilter\n      }\n    ];\n  }\n}\n"]}