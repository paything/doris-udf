{"version":3,"sources":["../src/interactions/view-drag-mixin.ts"],"names":[],"mappings":";;;AAAA,6CAAyC;AAQzC,6CAA+C;AAE/C,MAAa,aAAa;IAMd,2BAA2B,CAAC,CAAmB;QACvD,IAAI,CAAC,IAAA,cAAK,EAAE,CAAS,CAAC,SAAS,CAAC,EAAE;YAChC,MAAM,WAAW,GAAG,IAAA,cAAK,EAAC,IAAI,CAAC,UAAU,CAAC,IAAI,IAAI,CAAC,UAAU,KAAM,CAAS,CAAC,SAAS,CAAC;YACvF,IAAI,CAAC,UAAU,GAAI,CAAS,CAAC,SAAS,CAAC;YAEvC,OAAO,WAAW,CAAC;SACpB;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAES,YAAY,CAAC,CAAmB;QACxC,OAAO,IAAI,CAAC,2BAA2B,CAAC,CAAC,CAAC,CAAC;IAC7C,CAAC;IAES,aAAa,CAAC,CAAmB;QACzC,OAAO,IAAI,CAAC,2BAA2B,CAAC,CAAC,CAAC,CAAC;IAC7C,CAAC;IAED,eAAe,CACb,CAAmB,EACnB,QAAoD,EACpD,WAAmC;QAEnC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;YACzB,OAAO;SACR;QAED,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC,EAAE,CAAC,CAAC,OAAO,EAAE,CAAC;QACjD,OAAO,IAAI,CAAC;IACd,CAAC;IAED,gBAAgB,CACd,CAAmB,EACnB,QAAoD,EACpD,WAAmC;QAEnC,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC,EAAE;YAC9C,OAAO;SACR;QAED,IAAI,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,QAAQ,EAAE;YACzB,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YACxC,MAAM,CAAC,GAAG,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;YACxC,OAAO,IAAA,4BAAe,EAAC,EAAE,CAAC,EAAE,CAAC,EAAE,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAC;SACzD;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAED,aAAa,CACX,CAAmB,EACnB,QAAoD,EACpD,WAAmC;QAEnC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;YACpB,OAAO;SACR;QACD,MAAM,GAAG,GACP,CAAA,WAAW,aAAX,WAAW,uBAAX,WAAW,CAAE,QAAQ,MAAK,KAAK;YAC7B,CAAC,CAAC,IAAA,4BAAe,EACb;gBACE,CAAC,EAAE,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;gBAChC,CAAC,EAAE,CAAC,CAAC,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,CAAC;aACjC,EACD,QAAQ,EACR,WAAW,CACZ;YACH,CAAC,CAAC,IAAI,CAAC;QAEX,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QACvB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;QAEvB,OAAO,GAAG,CAAC;IACb,CAAC;CACF;AAjFD,sCAiFC","file":"view-drag-mixin.js","sourcesContent":["import { isNil } from '@visactor/vutils';\nimport type {\n  InteractionEvent,\n  IViewDragMixin,\n  ViewNavigationRange,\n  ViewDragSimpleOptions,\n  ViewStateByDim\n} from '../types';\nimport { handleScrolling } from './view-utils';\n\nexport class ViewDragMixin implements IViewDragMixin {\n  protected _pointerId: number;\n  protected _dragStart: { x: number; y: number };\n  protected _filterValueX: { start: number; end: number };\n  protected _filterValueY: { start: number; end: number };\n\n  protected _shouldTriggerDragByPointer(e: InteractionEvent) {\n    if (!isNil((e as any).pointerId)) {\n      const shouldStart = isNil(this._pointerId) || this._pointerId === (e as any).pointerId;\n      this._pointerId = (e as any).pointerId;\n\n      return shouldStart;\n    }\n\n    return true;\n  }\n\n  protected _shouldStart(e: InteractionEvent) {\n    return this._shouldTriggerDragByPointer(e);\n  }\n\n  protected _shouldUpdate(e: InteractionEvent) {\n    return this._shouldTriggerDragByPointer(e);\n  }\n\n  handleDragStart(\n    e: InteractionEvent,\n    navState: Partial<Record<'x' | 'y', ViewStateByDim>>,\n    dragOptions?: ViewDragSimpleOptions\n  ): ViewNavigationRange {\n    if (!this._shouldStart(e)) {\n      return;\n    }\n\n    this._dragStart = { x: e.canvasX, y: e.canvasY };\n    return null;\n  }\n\n  handleDragUpdate(\n    e: InteractionEvent,\n    navState: Partial<Record<'x' | 'y', ViewStateByDim>>,\n    dragOptions?: ViewDragSimpleOptions\n  ): ViewNavigationRange {\n    if (!this._dragStart || !this._shouldUpdate(e)) {\n      return;\n    }\n\n    if (dragOptions?.realtime) {\n      const x = e.canvasX - this._dragStart.x;\n      const y = e.canvasY - this._dragStart.y;\n      return handleScrolling({ x, y }, navState, dragOptions);\n    }\n\n    return null;\n  }\n\n  handleDragEnd(\n    e: InteractionEvent,\n    navState: Partial<Record<'x' | 'y', ViewStateByDim>>,\n    dragOptions?: ViewDragSimpleOptions\n  ): ViewNavigationRange {\n    if (!this._dragStart) {\n      return;\n    }\n    const res =\n      dragOptions?.realtime === false\n        ? handleScrolling(\n            {\n              x: e.canvasX - this._dragStart.x,\n              y: e.canvasY - this._dragStart.y\n            },\n            navState,\n            dragOptions\n          )\n        : null;\n\n    this._pointerId = null;\n    this._dragStart = null;\n\n    return res;\n  }\n}\n"]}