{"version":3,"sources":["../src/interactions/player-filter.ts"],"names":[],"mappings":";;;AACA,0CAAiE;AACjE,6CAA4C;AAC5C,qCAAkC;AAClC,qEAA+D;AAE/D,MAAa,YAAa,SAAQ,eAAM;IAOtC,YAAY,IAAW,EAAE,OAA2B;QAClD,KAAK,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;QANvB,SAAI,GAAW,YAAY,CAAC,IAAI,CAAC;QAO/B,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,YAAY,CAAC,cAAc,EAAE,OAAO,CAAC,CAAC;QAEvE,IAAI,CAAC,MAAM,GAAG,IAAI;aACf,kBAAkB,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC;aACvC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,KAAK,uBAAe,CAAC,SAAS,IAAK,IAAmB,CAAC,aAAa,KAAK,QAAQ,CAAC,CAAC;QAClH,IAAI,CAAC,KAAK,GAAG,IAAA,iBAAQ,EAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC;YAC7C,CAAC,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC;YAC5C,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC;IAC/B,CAAC;IAES,SAAS;QACjB,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,KAAK,CAAC,EAAE;YAC5C,OAAO,EAAE,CAAC;SACX;QAED,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAY,CAAC;QAEzC,IAAI,CAAC,IAAI,CAAC,KAAK,IAAI,CAAC,MAAM,EAAE;YAC1B,OAAO,EAAE,CAAC;SACX;QAED,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,SAAS,CAAC;QAEhD,MAAM,cAAc,GAAG,CAAC,KAAU,EAAE,EAAE,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,KAAK,EAAE,KAAK,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC;QAClG,MAAM,aAAa,GAAG,CAAC,IAAW,EAAE,WAA8B,EAAE,EAAE;YACpE,OAAO,SAAS,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,KAAK,CAAC;QACtE,CAAC,CAAC;QAEF,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAK,EAAE,MAAM,EAAE,sBAAc,CAAC,MAAM,EAAE,cAAc,EAAE,SAAS,EAAE,aAAa,CAAC,CAAC;QAEtG,OAAO;YACL;gBACE,IAAI,EAAE,oCAAe,CAAC,QAAQ;gBAC9B,OAAO,EAAE,IAAI,CAAC,YAAY;aAC3B;SACF,CAAC;IACJ,CAAC;;AA7CH,oCA8CC;AA7CQ,iBAAI,GAAW,eAAe,CAAC;AAG/B,2BAAc,GAAsC,EAAE,CAAC","file":"player-filter.js","sourcesContent":["import type { DataFilterOptions, IComponent, IPlayer, IView, PlayerFilterValue } from '../types';\nimport { DataFilterRank, GrammarMarkType } from '../graph/enums';\nimport { isString } from '@visactor/vutils';\nimport { Filter } from './filter';\nimport { PlayerEventEnum } from '@visactor/vrender-components';\n\nexport class PlayerFilter extends Filter {\n  static type: string = 'player-filter';\n  type: string = PlayerFilter.type;\n\n  static defaultOptions: Omit<DataFilterOptions, 'target'> = {};\n  options: DataFilterOptions;\n\n  constructor(view: IView, options?: DataFilterOptions) {\n    super(view, options);\n    this.options = Object.assign({}, PlayerFilter.defaultOptions, options);\n\n    this._marks = view\n      .getMarksBySelector(this.options.source)\n      .filter(mark => mark.markType === GrammarMarkType.component && (mark as IComponent).componentType === 'player');\n    this._data = isString(this.options.target.data)\n      ? view.getDataById(this.options.target.data)\n      : this.options.target.data;\n  }\n\n  protected getEvents() {\n    if (!this._marks || this._marks.length === 0) {\n      return [];\n    }\n\n    const player = this._marks[0] as IPlayer;\n\n    if (!this._data || !player) {\n      return [];\n    }\n\n    const transform = this.options.target.transform;\n\n    const getFilterValue = (event: any) => ({ index: event.detail.index, value: event.detail.value });\n    const dataTransform = (data: any[], filterValue: PlayerFilterValue) => {\n      return transform ? transform(data, filterValue) : filterValue.value;\n    };\n\n    this._filterData(this._data, player, DataFilterRank.player, getFilterValue, undefined, dataTransform);\n\n    return [\n      {\n        type: PlayerEventEnum.OnChange,\n        handler: this.handleFilter\n      }\n    ];\n  }\n}\n"]}