{"version":3,"sources":["../src/component/marker/mark-point/base-mark-point.ts"],"names":[],"mappings":"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","file":"base-mark-point.js","sourcesContent":["import type { IMarkPoint, IMarkPointSpec } from './interface';\nimport {\n  computeClipRange,\n  computeOffsetFromRegion,\n  getMarkPointProcessInfo,\n  transformLabelAttributes,\n  transformOffset,\n  transformState,\n  transformStyle\n} from '../utils';\nimport type { MarkPointAttrs } from '@visactor/vrender-components';\n// eslint-disable-next-line no-duplicate-imports\nimport { MarkPoint as MarkPointComponent } from '@visactor/vrender-components';\nimport { isValid } from '@visactor/vutils';\nimport { transformToGraphic } from '../../../util/style';\nimport { BaseMarker } from '../base-marker';\nimport { LayoutZIndex } from '../../../constant/layout';\nimport type { IGroup } from '@visactor/vrender-core';\n\nexport abstract class BaseMarkPoint extends BaseMarker<IMarkPointSpec> implements IMarkPoint {\n  static specKey = 'markPoint';\n  specKey = 'markPoint';\n\n  layoutZIndex: number = LayoutZIndex.MarkPoint;\n  protected declare _markerComponent: MarkPointComponent;\n\n  protected abstract _computePointsAttr(): any;\n\n  static _getMarkerCoordinateType(markerSpec: any): string {\n    const { doPolarProcess, doGeoProcess } = getMarkPointProcessInfo(markerSpec);\n    if (markerSpec.coordinateType === 'polar' || doPolarProcess) {\n      return 'polar';\n    } else if (markerSpec.coordinateType === 'geo' || doGeoProcess) {\n      return 'geo';\n    }\n    return 'cartesian';\n  }\n\n  protected _createMarkerComponent() {\n    const { itemContent = {}, itemLine = {}, targetSymbol = {} } = this._spec;\n    const { text: label = {}, symbol, image, richText, ...restItemContent } = itemContent;\n\n    const markPointAttrs: MarkPointAttrs = {\n      zIndex: this.layoutZIndex,\n      interactive: this._spec.interactive ?? true,\n      hover: this._spec.interactive ?? true,\n      select: this._spec.interactive ?? true,\n      position: { x: 0, y: 0 },\n      clipInRange: this._spec.clip ?? false,\n      itemContent: {\n        offsetX: transformOffset(itemContent.offsetX, this._relativeSeries.getRegion()),\n        offsetY: transformOffset(itemContent.offsetX, this._relativeSeries.getRegion()),\n        ...restItemContent // Tips: 因为网站 demo 上已经透出了 imageStyle richTextStyle 的写法，为了兼容所以这个需要在后面覆盖\n      },\n      targetSymbol: {\n        offset: targetSymbol.offset ?? 0,\n        visible: targetSymbol.visible ?? false,\n        size: targetSymbol.size ?? 20,\n        style: transformStyle(targetSymbol.style, this._markerData, this._markAttributeContext)\n      },\n      state: {\n        line: transformState(this._spec.itemLine.line?.state ?? {}, this._markerData, this._markAttributeContext),\n        lineStartSymbol: transformState(\n          this._spec.itemLine.startSymbol?.state ?? {},\n          this._markerData,\n          this._markAttributeContext\n        ),\n        lineEndSymbol: transformState(\n          this._spec.itemLine.endSymbol?.state ?? {},\n          this._markerData,\n          this._markAttributeContext\n        ),\n        symbol: transformState(\n          this._spec.itemContent.symbol?.state ?? {},\n          this._markerData,\n          this._markAttributeContext\n        ),\n        image: transformState(this._spec.itemContent.image?.state ?? {}, this._markerData, this._markAttributeContext),\n        text: transformState(this._spec.itemContent.text?.state ?? {}, this._markerData, this._markAttributeContext),\n        textBackground: transformState(\n          this._spec.itemContent.text?.labelBackground?.state,\n          this._markerData,\n          this._markAttributeContext\n        ),\n        richText: transformState(\n          this._spec.itemContent.richText?.state ?? {},\n          this._markerData,\n          this._markAttributeContext\n        ),\n        customMark: transformState(\n          this._spec.itemContent.customMark?.state ?? {},\n          this._markerData,\n          this._markAttributeContext\n        ),\n        targetItem: transformState(this._spec.targetSymbol?.state ?? {}, this._markerData, this._markAttributeContext)\n      },\n      animation: this._spec.animation ?? false,\n      animationEnter: this._spec.animationEnter,\n      animationExit: this._spec.animationExit,\n      animationUpdate: this._spec.animationUpdate\n    };\n\n    if (symbol?.style) {\n      markPointAttrs.itemContent.symbolStyle = transformToGraphic(\n        transformStyle(symbol.style, this._markerData, this._markAttributeContext)\n      );\n    }\n    if (image?.style) {\n      markPointAttrs.itemContent.imageStyle = transformStyle(image.style, this._markerData, this._markAttributeContext);\n    }\n    if (label) {\n      markPointAttrs.itemContent.textStyle = transformLabelAttributes(\n        label,\n        this._markerData,\n        this._markAttributeContext\n      );\n    }\n    if (richText?.style) {\n      markPointAttrs.itemContent.richTextStyle = transformStyle(\n        richText.style,\n        this._markerData,\n        this._markAttributeContext\n      );\n    }\n\n    const { visible, line = {}, ...restItemLine } = itemLine;\n    if (visible !== false) {\n      markPointAttrs.itemLine = {\n        ...restItemLine,\n        visible: true,\n        lineStyle: transformToGraphic(line.style)\n      } as any;\n    } else {\n      markPointAttrs.itemLine = {\n        visible: false\n      };\n    }\n\n    const markPoint = new MarkPointComponent(markPointAttrs);\n    return markPoint as unknown as IGroup;\n  }\n\n  protected _markerLayout() {\n    const spec = this._spec;\n    const data = this._markerData;\n    const relativeSeries = this._relativeSeries;\n\n    const { point } = this._computePointsAttr();\n\n    const seriesData = this._getRelativeDataView().latestData;\n    const dataPoints = data\n      ? data.latestData[0] && data.latestData[0].latestData\n        ? data.latestData[0].latestData\n        : data.latestData\n      : seriesData;\n\n    let limitRect;\n    if (spec.clip || spec.itemContent?.confine) {\n      const { minX, maxX, minY, maxY } = computeClipRange([relativeSeries.getRegion()]);\n      limitRect = {\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY\n      };\n    }\n    if (this._markerComponent) {\n      const attribute = this._markerComponent.attribute ?? {};\n      const textStyle = attribute.itemContent?.textStyle ?? {};\n      this._markerComponent.setAttributes({\n        position: point === undefined ? { x: null, y: null } : point, // setAttrs时merge时undefined会被忽略, 所以这里做转换\n        itemContent: {\n          ...attribute.itemContent,\n          textStyle: {\n            ...textStyle,\n            text: this._spec.itemContent.text?.formatMethod\n              ? // type error here will be fixed in components\n                (this._spec.itemContent.text.formatMethod(dataPoints, seriesData) as any)\n              : textStyle.text\n          },\n          offsetX: computeOffsetFromRegion(point, attribute.itemContent.offsetX, this._relativeSeries.getRegion()),\n          offsetY: computeOffsetFromRegion(point, attribute.itemContent.offsetY, this._relativeSeries.getRegion())\n        },\n        limitRect,\n        dx: this._layoutOffsetX,\n        dy: this._layoutOffsetY\n      });\n    }\n  }\n\n  protected _initDataView(): void {\n    const spec = this._spec as any;\n    const { doXYProcess, doPolarProcess, doGeoProcess } = getMarkPointProcessInfo(spec);\n    const isCoordinateProcess = isValid(spec.coordinate);\n    if (!isCoordinateProcess && !doXYProcess && !doPolarProcess && !doGeoProcess) {\n      return;\n    }\n\n    this._initCommonDataView();\n  }\n}\n"]}