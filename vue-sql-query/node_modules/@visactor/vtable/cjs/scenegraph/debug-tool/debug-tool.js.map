{"version":3,"sources":["../src/scenegraph/debug-tool/debug-tool.ts"],"names":[],"mappings":"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","file":"debug-tool.js","sourcesContent":["import type { FederatedPointerEvent, IStage, IRect, IGraphic } from './../../vrender';\nimport { createRect, getTheme } from './../../vrender';\nimport JSONFormatter from 'json-formatter-js';\n\nexport interface DebugToolOptions {\n  container?: HTMLElement;\n  infoPosition?: 'tl' | 'tr' | 'bl' | 'br';\n  infoWidth?: number;\n  infoHeight?: number;\n  mode?: 'hover' | 'click';\n  customGrapicKeys?: string[];\n}\n\nexport class DebugTool {\n  _stage: IStage;\n  _infoContainer: HTMLElement;\n  _highlightRect: HTMLElement;\n  _target: IGraphic;\n  // _rect: IRect;\n  _mode: 'hover' | 'click' = 'hover';\n  _customGrapicKeys?: string[];\n  _modeTip: HTMLElement;\n  _callback: {\n    pointermove: (e: FederatedPointerEvent) => void;\n    pointerup: (e: FederatedPointerEvent) => void;\n    pointerleave: (e: FederatedPointerEvent) => void;\n    keydown: (e: KeyboardEvent) => void;\n  };\n\n  constructor(stage: IStage, options?: DebugToolOptions) {\n    this._stage = stage;\n    this._callback = {} as any;\n\n    if (options?.customGrapicKeys) {\n      this._customGrapicKeys = options.customGrapicKeys;\n    }\n\n    // 创建信息框\n    if (options?.container) {\n      this._infoContainer = options.container;\n    } else {\n      this.createInfoContainer(options);\n    }\n\n    // 创建高亮矩形\n    this.createHighlightRect();\n\n    // 绑定stage事件\n    this.bindStageEvent();\n\n    // 绑定键盘事件\n    this.bindKeyEvent();\n  }\n\n  createInfoContainer(options?: DebugToolOptions) {\n    const position = options?.infoPosition || 'tr';\n    const width = options?.infoWidth || 300;\n    const height = options?.infoPosition || 400;\n    this._infoContainer = document.createElement('div');\n    this._infoContainer.style.position = 'fixed';\n    this._infoContainer.style.width = `${width}px`;\n    this._infoContainer.style.height = `${height}px`;\n    this._infoContainer.style.backgroundColor = 'rgba(210, 210, 210, 0.3)';\n    this._infoContainer.style.overflow = 'auto';\n    this._infoContainer.style.display = 'none';\n    switch (position) {\n      case 'tl':\n        this._infoContainer.style.top = '0px';\n        this._infoContainer.style.left = '0px';\n        break;\n      case 'tr':\n        this._infoContainer.style.top = '0px';\n        this._infoContainer.style.right = `0px`;\n        break;\n      case 'bl':\n        this._infoContainer.style.bottom = `0px`;\n        this._infoContainer.style.left = '0px';\n        break;\n      case 'br':\n        this._infoContainer.style.bottom = `0px`;\n        this._infoContainer.style.right = `0px`;\n        break;\n    }\n\n    // Tip\n    // debug 模式：hover（shift + s改变模式；shift + d控制台输出target graphic）\n    const tip = document.createElement('div');\n    const tipSpan1 = document.createElement('span');\n    tipSpan1.innerText = 'debug 模式：';\n    tip.appendChild(tipSpan1);\n    this._modeTip = document.createElement('span');\n    this._modeTip.innerText = this._mode;\n    tip.appendChild(this._modeTip);\n    const tipSpan2 = document.createElement('span');\n    tipSpan2.innerText = '（shift + s改变模式；shift + d控制台输出target graphic）';\n    tip.appendChild(tipSpan2);\n    this._infoContainer.appendChild(tip);\n\n    // document.body.append(this._infoContainer);\n    this._stage.window.getContainer().append(this._infoContainer);\n  }\n\n  createHighlightRect() {\n    const container = this._stage.window.getContainer();\n    this._highlightRect = document.createElement('div');\n    this._highlightRect.style.display = 'absolute';\n    this._highlightRect.style.border = '1px solid red';\n    this._highlightRect.style.pointerEvents = 'none';\n    this._highlightRect.style.position = 'absolute';\n    container.appendChild(this._highlightRect);\n  }\n\n  bindStageEvent() {\n    this._callback.pointermove = (e: FederatedPointerEvent) => {\n      if (this._mode !== 'hover') {\n        // do nothing\n      } else if (e.target && (e.target as unknown as IGraphic) !== this._target) {\n        // 更新bounds\n        this._target = e.target as unknown as IGraphic;\n        this.addHighlightBounds(this._target.globalAABBBounds);\n        setTimeout(() => {\n          this.updateInfo();\n        }, 100);\n      } else if (!e.target) {\n        this._target = undefined;\n        // this.removeHighlightBounds();\n        this.clearInfo();\n      }\n    };\n    this._stage.addEventListener('pointermove', this._callback.pointermove);\n\n    this._callback.pointerup = (e: FederatedPointerEvent) => {\n      if (this._mode !== 'click') {\n        // do nothing\n      } else if (e.target && (e.target as unknown as IGraphic) !== this._target) {\n        // 更新bounds\n        this._target = e.target as unknown as IGraphic;\n        this.addHighlightBounds(this._target.globalAABBBounds);\n        setTimeout(() => {\n          this.updateInfo();\n        }, 100);\n      } else if (!e.target) {\n        this._target = undefined;\n        // this.removeHighlightBounds();\n        this.clearInfo();\n      }\n    };\n    this._stage.addEventListener('pointerup', this._callback.pointerup);\n\n    this._callback.pointerleave = (e: FederatedPointerEvent) => {\n      if (this._mode === 'hover') {\n        this._target = undefined;\n        // this.removeHighlightBounds();\n        this.clearInfo();\n      }\n    };\n    this._stage.addEventListener('pointerleave', this._callback.pointerleave);\n  }\n\n  addHighlightBounds(bounds: any) {\n    // 使用VRender绘制高亮框会导致触发多余渲染，因此使用dom\n    // this._rect.setAttributes({\n    //   x: bounds.x1,\n    //   y: bounds.y1,\n    //   width: bounds.width(),\n    //   height: bounds.height(),\n    //   visible: true,\n    // });\n\n    // // 保证rect在最上层\n    // this._stage.defaultLayer.appendChild(this._rect);\n    // this._stage.renderNextFrame();\n\n    const table = (this._stage as any).table;\n    const stage = table.scenegraph.stage;\n    const stageMatrix = stage.window.getViewBoxTransform();\n\n    this._highlightRect.style.left = `${bounds.x1 + (stageMatrix.e ?? 0) + (table.options.viewBox?.x1 ?? 0)}px`;\n    this._highlightRect.style.top = `${bounds.y1 + (stageMatrix.f ?? 0) + (table.options.viewBox?.y1 ?? 0)}px`;\n    this._highlightRect.style.width = `${bounds.width()}px`;\n    this._highlightRect.style.height = `${bounds.height()}px`;\n\n    // console.log(this._highlightRect.style.left);\n  }\n\n  // removeHighlightBounds() {\n  //   this._rect.setAttribute('visible', false);\n  //   this._stage.renderNextFrame();\n  // }\n\n  updateInfo() {\n    if (!this._target) {\n      return;\n    }\n    // this._infoContainer.innerHTML = '';\n    if (this._infoContainer.children.length > 1) {\n      this._infoContainer.removeChild(this._infoContainer.children[1]);\n    }\n    this._infoContainer.style.display = 'block';\n\n    const info = {\n      customKeys: {},\n      type: this._target.type,\n      // role: (this._target as any).role,\n      globalX: this._target.globalTransMatrix.e,\n      globalY: this._target.globalTransMatrix.f,\n      attribute: this._target.attribute,\n      theme: getTheme(this._target)[this._target.type],\n      target: this._target\n    };\n\n    if (this._customGrapicKeys) {\n      this._customGrapicKeys.forEach(key => {\n        info.customKeys[key] = this._target[key];\n      });\n    } else {\n      delete info.customKeys;\n    }\n\n    const formatter = new JSONFormatter(info, 2);\n    this._infoContainer.appendChild(formatter.render());\n  }\n\n  clearInfo() {\n    this._infoContainer.style.display = 'none';\n  }\n\n  updateMode() {\n    this._modeTip.innerText = this._mode;\n  }\n\n  bindKeyEvent() {\n    this._callback.keydown = (e: KeyboardEvent) => {\n      if (e.key === 'D') {\n        console.log(this._target);\n      } else if (e.key === 'S') {\n        switch (this._mode) {\n          case 'click':\n            this._mode = 'hover';\n            break;\n          case 'hover':\n            this._mode = 'click';\n            break;\n        }\n        this.updateMode();\n      }\n    };\n    window.addEventListener('keydown', this._callback.keydown);\n  }\n\n  release() {\n    // 移除信息框\n    document.body.removeChild(this._infoContainer);\n\n    // 移除高亮框\n    this._highlightRect.parentElement.removeChild(this._highlightRect);\n\n    // 解绑stage事件\n    // this._stage.defaultLayer.removeChild(this._rect);\n    this._stage.removeEventListener('pointermove', this._callback.pointermove);\n    this._stage.removeEventListener('pointerup', this._callback.pointerup);\n    this._stage.removeEventListener('pointerleave', this._callback.pointerleave);\n\n    // 解绑键盘事件\n    window.removeEventListener('keydown', this._callback.keydown);\n  }\n}\n"]}