{"version":3,"sources":["../src/scenegraph/graphic/contributions/picker-interceptor.ts"],"names":[],"mappings":";;;;;;;;;AACA,gDAAgD;AAIzC,IAAM,wCAAwC,GAA9C,MAAM,wCAAwC;IAA9C;QACL,UAAK,GAAW,CAAC,CAAC;IA6CpB,CAAC;IA5CC,aAAa,CACX,MAAkB,EAClB,aAA6B,EAC7B,KAAiB,EACjB,UAAuB,EACvB,MAEC;QAGD,IACE,MAAM,CAAC,OAAO,KAAK,IAAI;YACvB,MAAM,CAAC,KAAK;YACX,MAAM,CAAC,KAAa,CAAC,KAAK;YAC1B,MAAM,CAAC,KAAa,CAAC,KAAK,CAAC,EAAE,KAAK,QAAQ,EAC3C;YAEA,MAAM,KAAK,GAAI,MAAM,CAAC,KAAa,CAAC,KAAK,CAAC;YAC1C,MAAM,MAAM,GAAG,KAAK,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;YAChD,MAAM,SAAS,GAAG,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC,EAAE,KAAK,CAAC,CAAC,EAAE,CAAC;YAC7C,IAAI,MAAM,IAAI,MAAM,CAAC,YAAY,EAAE;gBACjC,MAAM,CAAC,YAAY,CAAC,cAAc,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;aACtD;YAED,KAAK,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;gBAC3C,MAAM,KAAK,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;gBACxB,MAAM,YAAY,GAAG,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC,EAAE,CAAC,EAAE,SAAS,CAAC,CAAC,EAAE,CAAC;gBACxD,KAAK,CAAC,iBAAiB,CAAC,cAAc,CAAC,YAAY,EAAE,YAAY,CAAC,CAAC;gBACnE,IAAI,CAAC,KAAK,CAAC,mBAAmB,EAAE;oBAC9B,SAAS;iBACV;gBACD,MAAM,OAAO,GAAG,KAAK,CAAC,mBAAmB,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC;gBAE7D,IAAI,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC,CAAC,EAAE;oBACpD,MAAM,CAAC,OAAO,GAAG,KAAK,CAAC;oBACvB,MAAM,CAAC,KAAK,GAAG,IAAI,CAAC;oBAEpB,OAAO,MAAM,CAAC;iBACf;aACF;SACF;QAED,OAAO,MAAM,CAAC;IAChB,CAAC;CACF,CAAA;AA9CY,wCAAwC;IADpD,IAAA,oBAAU,GAAE;GACA,wCAAwC,CA8CpD;AA9CY,4FAAwC","file":"picker-interceptor.js","sourcesContent":["import type { IPickerService, IPickParams, PickResult } from './../../../vrender';\nimport { injectable } from './../../../vrender';\nimport type { IMatrix, IPointLike } from '@visactor/vutils';\n\n@injectable()\nexport class VChartPickServiceInterceptorContribution {\n  order: number = 1;\n  afterPickItem(\n    result: PickResult,\n    pickerService: IPickerService,\n    point: IPointLike,\n    pickParams: IPickParams,\n    params?: {\n      parentMatrix: IMatrix;\n    }\n  ): null | PickResult {\n    // 点击到图表的空白区域了，那么就判断该位置是否有其他图元，如果有，那就返回false，否则还是认为选中了图表\n    if (\n      result.graphic === null &&\n      result.group &&\n      (result.group as any).stage &&\n      (result.group as any).stage.id === 'vstory'\n    ) {\n      // console.log('aaaa', result);\n      const stage = (result.group as any).stage;\n      const charts = stage.getElementsByType('chart');\n      const nextPoint = { x: point.x, y: point.y };\n      if (params && params.parentMatrix) {\n        params.parentMatrix.transformPoint(point, nextPoint);\n      }\n\n      for (let i = charts.length - 1; i >= 0; i--) {\n        const chart = charts[i];\n        const pointInChart = { x: nextPoint.x, y: nextPoint.y };\n        chart.globalTransMatrix.transformPoint(pointInChart, pointInChart);\n        if (!chart.activeChartInstance) {\n          continue;\n        }\n        const viewBox = chart.activeChartInstance.getStage().viewBox;\n        // console.log(chart);\n        if (viewBox.contains(pointInChart.x, pointInChart.y)) {\n          result.graphic = chart;\n          result.group = null;\n          // result.group =\n          return result;\n        }\n      }\n    }\n\n    return result;\n  }\n}\n"]}