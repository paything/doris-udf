{"version":3,"sources":["../src/event/self-event-listener/pivot-chart/axis-click.ts"],"names":[],"mappings":"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","file":"axis-click.js","sourcesContent":["import type { FederatedPointerEvent } from './../../../vrender';\nimport type { BaseTableAPI } from '../../../ts-types/base-table';\nimport type { SceneEvent } from '../../util';\nimport { getCellEventArgsSet } from '../../util';\nimport type { PivotHeaderLayoutMap } from '../../../layout/pivot-header-layout';\nimport type { PivotChart } from '../../../PivotChart';\nimport { clearChartCacheImage } from '../../../scenegraph/refresh-node/update-chart';\n\nexport function bindAxisClickEvent(table: BaseTableAPI) {\n  if (!table.isPivotChart()) {\n    return;\n  }\n\n  table.scenegraph.tableGroup.addEventListener('click', (e: FederatedPointerEvent) => {\n    if (table.stateManager.columnMove.moving || table.stateManager.columnResize.resizing) {\n      return;\n    }\n    if (e.target.name === 'axis-label') {\n      const eventArgsSet: SceneEvent = getCellEventArgsSet(e);\n      const { col, row } = eventArgsSet.eventArgs;\n      const layout = table.internalProps.layoutMap as PivotHeaderLayoutMap;\n      let dimensionKey;\n      let dimensions: {\n        dimensionKey?: string;\n        indicatorKey?: string;\n        value?: string;\n      }[];\n      if (layout.indicatorsAsCol) {\n        dimensionKey = layout.getDimensionKeyInChartSpec(layout.rowHeaderLevelCount, row);\n        dimensions = layout.getCellHeaderPaths(layout.rowHeaderLevelCount - 2, row).rowHeaderPaths;\n      } else {\n        dimensionKey = layout.getDimensionKeyInChartSpec(col, layout.columnHeaderLevelCount);\n        dimensions = layout.getCellHeaderPaths(col, layout.columnHeaderLevelCount - 1).colHeaderPaths;\n      }\n      const filter = dimensions\n        .map(dimension => {\n          return {\n            key: dimension.dimensionKey,\n            value: dimension.value\n          };\n        })\n        .filter(dimension => dimension.key);\n      filter.push({ key: dimensionKey, value: (e.target.attribute as any).text });\n\n      if (\n        (table as PivotChart)._selectedDimensionInChart.length &&\n        isSameSelectedDimension((table as PivotChart)._selectedDimensionInChart, filter)\n      ) {\n        return;\n      }\n\n      (table as PivotChart)._selectedDimensionInChart = filter;\n\n      layout.updateDataStateToChartInstance();\n      // 清除chart缓存图片\n      clearChartCacheImage(table.scenegraph);\n      table.scenegraph.updateNextFrame();\n    } else if ((table as PivotChart)._selectedDimensionInChart?.length) {\n      (table as PivotChart)._selectedDimensionInChart.length = 0;\n      const layout = table.internalProps.layoutMap as PivotHeaderLayoutMap;\n      layout.updateDataStateToChartInstance();\n      // 清除chart缓存图片\n      clearChartCacheImage(table.scenegraph);\n      table.scenegraph.updateNextFrame();\n    }\n  });\n}\n\nfunction isSameSelectedDimension(\n  dimensions1: { key: string; value: string }[],\n  dimensions2: { key: string; value: string }[]\n): boolean {\n  if (dimensions1.length !== dimensions2.length) {\n    return false;\n  }\n  for (let i = 0; i < dimensions1.length; i++) {\n    if (dimensions1[i].key !== dimensions2[i].key || dimensions1[i].value !== dimensions2[i].value) {\n      return false;\n    }\n  }\n  return true;\n}\n"]}