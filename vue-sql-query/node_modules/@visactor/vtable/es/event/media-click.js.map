{"version":3,"sources":["../src/event/media-click.ts"],"names":[],"mappings":"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","file":"media-click.js","sourcesContent":["import { isFunction } from '@visactor/vutils';\nimport { TABLE_EVENT_TYPE } from '../core/TABLE_EVENT_TYPE';\nimport { Env } from '../tools/env';\nimport { regUrl } from '../tools/global';\nimport type { LinkColumnDefine, MousePointerCellEvent } from '../ts-types';\nimport type { BaseTableAPI, HeaderData } from '../ts-types/base-table';\nimport type { IImageColumnBodyDefine } from '../ts-types/list-table/define/image-define';\nimport { getOrApply } from '../tools/helper';\n\nexport function bindMediaClick(table: BaseTableAPI): void {\n  if (Env.mode === 'browser') {\n    // table.hasMedia = false;\n\n    table.on(TABLE_EVENT_TYPE.CLICK_CELL, (e: MousePointerCellEvent) => {\n      //如果目前是在某个icon上，如收起展开按钮 则不进行其他点击逻辑\n      const { col, row } = e;\n\n      if (e.target.type === 'image' && (e.target as any).role && (e.target as any).role.startsWith('icon')) {\n        // click icon\n        return;\n      }\n      let cellType;\n      if (table.internalProps.layoutMap.isHeader(col, row)) {\n        cellType = table.isPivotTable()\n          ? (table._getHeaderLayoutMap(col, row) as HeaderData).headerType\n          : (table.getHeaderDefine(col, row) as HeaderData).headerType;\n      } else {\n        cellType = table.getBodyColumnType(col, row);\n      }\n      const columnDefine = table.isHeader(col, row)\n        ? table.getHeaderDefine(col, row)\n        : table.getBodyColumnDefine(col, row);\n      const cellValue = table.getCellValue(col, row);\n      const cellOriginValue = table.getCellOriginValue(col, row);\n      if (cellType === 'link') {\n        let linkJump: boolean | undefined = getOrApply((columnDefine as LinkColumnDefine).linkJump, {\n          col,\n          row,\n          table,\n          value: cellValue,\n          dataValue: cellOriginValue,\n          cellHeaderPaths: undefined\n        });\n        linkJump = linkJump !== false;\n        if (!linkJump) {\n          return;\n        }\n\n        // 点击链接，打开相应页面\n        const templateLink = (columnDefine as LinkColumnDefine).templateLink;\n        let linkDetect = getOrApply((columnDefine as LinkColumnDefine).linkDetect, {\n          col,\n          row,\n          table,\n          value: cellValue,\n          dataValue: cellOriginValue,\n          cellHeaderPaths: undefined\n        });\n        linkDetect = linkDetect !== false;\n        let url;\n        if (templateLink) {\n          // 如果有模板链接，使用模板\n          const rowData = table.getCellOriginRecord(col, row);\n          if (rowData && rowData.vtableMerge) {\n            // group title\n            return;\n          }\n          const data = Object.assign(\n            {\n              __value: cellValue,\n              __dataValue: cellOriginValue\n            },\n            rowData\n          );\n          if (isFunction(templateLink)) {\n            url = templateLink(data, col, row, table);\n          } else {\n            const re = /\\{\\s*(\\S+?)\\s*\\}/g;\n            url = templateLink.replace(re, (matchs: string, key: string) => {\n              matchs;\n              return (data as any)[key];\n            });\n          }\n        } else if (!linkDetect) {\n          url = cellValue;\n        } else if (regUrl.test(cellValue)) {\n          // 没有模板链接，使用单元格内的字符串\n          url = cellValue;\n        } else {\n          return;\n        }\n\n        if (!url) {\n          return;\n        }\n\n        const linkTarget = (columnDefine as LinkColumnDefine).linkTarget;\n        const linkWindowFeatures = (columnDefine as LinkColumnDefine).linkWindowFeatures;\n        window.open(url, linkTarget, linkWindowFeatures);\n      } else if (cellType === 'image') {\n        // 点击图片，打开放大图片\n        const { clickToPreview } = columnDefine as IImageColumnBodyDefine;\n        if (clickToPreview === false) {\n          return;\n        }\n\n        // 开启蒙版\n        const overlay = document.createElement('div');\n        overlay.style.width = '100%';\n        overlay.style.height = '100%';\n        overlay.style.position = 'absolute';\n        overlay.style.top = '0';\n        overlay.style.left = '0';\n        overlay.style.backgroundColor = 'rgba(30, 30, 30, 0.4)';\n        overlay.style.display = 'flex';\n        overlay.style.justifyContent = 'center';\n        overlay.style.alignItems = 'center';\n        overlay.style.overflow = 'hidden';\n        overlay.style.zIndex = '9999';\n\n        overlay.addEventListener('click', e => {\n          if (e.target === overlay) {\n            document.body.removeChild(overlay);\n          }\n        });\n        // overlay.addEventListener('pointermove', (e) => {\n        //   e.stopPropagation();\n        //   e.preventDefault();\n        // });\n        // overlay.addEventListener('mousemove', (e) => {\n        //   e.stopPropagation();\n        //   e.preventDefault();\n        // });\n        // 创建图片\n        const image = new Image();\n        image.src = cellValue;\n        image.style.maxWidth = '80%';\n        image.style.maxHeight = '80%';\n        overlay.appendChild(image);\n\n        document.body.appendChild(overlay);\n      } else if (cellType === 'video') {\n        // 点击视频，弹出播放窗口\n        const { clickToPreview } = columnDefine as IImageColumnBodyDefine;\n        if (clickToPreview === false) {\n          return;\n        }\n\n        // 开启蒙版\n        const overlay = document.createElement('div');\n        overlay.style.width = '100%';\n        overlay.style.height = '100%';\n        overlay.style.position = 'absolute';\n        overlay.style.top = '0';\n        overlay.style.left = '0';\n        overlay.style.backgroundColor = 'rgba(30, 30, 30, 0.4)';\n        overlay.style.display = 'flex';\n        overlay.style.justifyContent = 'center';\n        overlay.style.alignItems = 'center';\n        overlay.style.overflow = 'hidden';\n        overlay.style.zIndex = '9999';\n\n        overlay.addEventListener('click', e => {\n          if (e.target === overlay) {\n            document.body.removeChild(overlay);\n          }\n        });\n\n        // 创建视频\n        const video = document.createElement('video');\n        video.src = cellValue;\n        video.style.maxWidth = '80%';\n        video.style.maxHeight = '80%';\n        video.setAttribute('preload', 'auto');\n        video.setAttribute('controls', 'true');\n        overlay.appendChild(video);\n\n        document.body.appendChild(overlay);\n      }\n    });\n  }\n}\n"]}