{"version":3,"sources":["../src/event/drill.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,gBAAgB,EAAE,MAAM,0BAA0B,CAAC;AAI5D,OAAO,EAAE,sBAAsB,EAAE,MAAM,gDAAgD,CAAC;AAExF,MAAM,UAAU,cAAc,CAAC,KAAmB;IAChD,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,eAAe,EAAE,CAAC,CAAwB,EAAE,EAAE;QAKtE,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QACvB,IAAI,GAAG,KAAK,CAAC,CAAC,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE;YAC5B,OAAO;SACR;QACD,MAAM,SAAS,GAAI,KAAK,CAAC,aAAa,CAAC,SAAkC,CAAC,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACvG,IAAI,CAAA,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,SAAS,MAAI,SAAS,aAAT,SAAS,uBAAT,SAAS,CAAE,OAAO,CAAA,EAAE;YAC9C,KAAK,CAAC,YAAY,CAAC,gBAAgB,CACjC,SAAS,CAAC,YAAY,EACtB,SAAS,CAAC,KAAK,EACf,SAAS,CAAC,SAAS,EACnB,SAAS,CAAC,OAAO,EACjB,GAAG,EACH,GAAG,CACJ,CAAC;SACH;aAAM;YACL,KAAK,CAAC,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;SACjF;IACH,CAAC,CAAC,CAAC;IACH,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,gBAAgB,EAAE,CAAC,CAAwB,EAAE,EAAE;QACvE,KAAK,CAAC,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,SAAS,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;IAClF,CAAC,CAAC,CAAC;AACL,CAAC;AAED,MAAM,UAAU,UAAU,CAAC,KAAmB;IAC5C,KAAK,CAAC,aAAa,CAAC,sBAAsB,CAAC,eAAe,EAAE,KAAK,CAAC,YAAY,CAAC,KAA2B,CAAC,CAAC;AAC9G,CAAC;AAED,MAAM,UAAU,cAAc,CAAC,KAAoB;IACjD,MAAM,UAAU,GAAI,KAAK,CAAC,aAAa,CAAC,SAAkC,CAAC,UAAU,CAAC;IACtF,MAAM,aAAa,GAAI,KAAK,CAAC,aAAa,CAAC,SAAkC,CAAC,aAAa,CAAC;IAC5F,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAC1C,MAAM,GAAG,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;QAC1B,IAAI,OAAO,GAAG,KAAK,QAAQ,IAAI,CAAC,GAAG,CAAC,SAAS,IAAI,GAAG,CAAC,OAAO,CAAC,EAAE;YAC7D,OAAO,IAAI,CAAC;SACb;KACF;IACD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,aAAa,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAC7C,MAAM,MAAM,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC;QAChC,IAAI,OAAO,MAAM,KAAK,QAAQ,IAAI,CAAC,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,OAAO,CAAC,EAAE;YACtE,OAAO,IAAI,CAAC;SACb;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC","file":"drill.js","sourcesContent":["import { TABLE_EVENT_TYPE } from '../core/TABLE_EVENT_TYPE';\nimport type { PivotHeaderLayoutMap } from '../layout/pivot-header-layout';\nimport type { DrillMenuEventInfo, MousePointerCellEvent, PivotTableAPI } from '../ts-types';\nimport type { BaseTableAPI } from '../ts-types/base-table';\nimport { PIVOT_TABLE_EVENT_TYPE } from '../ts-types/pivot-table/PIVOT_TABLE_EVENT_TYPE';\n\nexport function bindDrillEvent(table: BaseTableAPI) {\n  table.on(TABLE_EVENT_TYPE.MOUSEENTER_CELL, (e: MousePointerCellEvent) => {\n    //是否需要显示出上钻下钻按钮\n    // if (!table.isPivotTable()) {\n    //   return;\n    // }\n    const { col, row } = e;\n    if (col === -1 || row === -1) {\n      return;\n    }\n    const dimension = (table.internalProps.layoutMap as PivotHeaderLayoutMap).getHeaderDimension(col, row);\n    if (dimension?.drillDown || dimension?.drillUp) {\n      table.stateManager.updateDrillState(\n        dimension.dimensionKey,\n        dimension.title,\n        dimension.drillDown,\n        dimension.drillUp,\n        col,\n        row\n      );\n    } else {\n      table.stateManager.updateDrillState(undefined, undefined, false, false, -1, -1);\n    }\n  });\n  table.on(TABLE_EVENT_TYPE.MOUSELEAVE_TABLE, (e: MousePointerCellEvent) => {\n    table.stateManager.updateDrillState(undefined, undefined, false, false, -1, -1);\n  });\n}\n\nexport function drillClick(table: BaseTableAPI) {\n  table.fireListeners(PIVOT_TABLE_EVENT_TYPE.DRILLMENU_CLICK, table.stateManager.drill as DrillMenuEventInfo);\n}\n\nexport function checkHaveDrill(table: PivotTableAPI) {\n  const rowsDefine = (table.internalProps.layoutMap as PivotHeaderLayoutMap).rowsDefine;\n  const columnsDefine = (table.internalProps.layoutMap as PivotHeaderLayoutMap).columnsDefine;\n  for (let i = 0; i < rowsDefine.length; i++) {\n    const row = rowsDefine[i];\n    if (typeof row !== 'string' && (row.drillDown || row.drillUp)) {\n      return true;\n    }\n  }\n  for (let i = 0; i < columnsDefine.length; i++) {\n    const column = columnsDefine[i];\n    if (typeof column !== 'string' && (column.drillDown || column.drillUp)) {\n      return true;\n    }\n  }\n  return false;\n}\n"]}