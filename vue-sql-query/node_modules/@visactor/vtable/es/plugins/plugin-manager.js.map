{"version":3,"sources":["../src/plugins/plugin-manager.ts"],"names":[],"mappings":"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","file":"plugin-manager.js","sourcesContent":["import type { TableEvents } from '../core/TABLE_EVENT_TYPE';\nimport type { BaseTableAPI, BaseTableConstructorOptions } from '../ts-types/base-table';\nimport type { IVTablePlugin } from './interface';\n\nexport class PluginManager {\n  private plugins: Map<string, IVTablePlugin> = new Map();\n  private table: BaseTableAPI;\n\n  constructor(table: BaseTableAPI, options: BaseTableConstructorOptions) {\n    this.table = table;\n    options.plugins?.map(plugin => {\n      this.register(plugin);\n      this._bindTableEventForPlugin(plugin);\n    });\n  }\n\n  // 注册插件\n  register(plugin: IVTablePlugin): void {\n    this.plugins.set(plugin.id, plugin);\n  }\n\n  // 注册多个插件\n  registerAll(plugins: IVTablePlugin[]): void {\n    plugins.forEach(plugin => this.register(plugin));\n  }\n\n  // 获取插件\n  getPlugin(id: string): IVTablePlugin | undefined {\n    return this.plugins.get(id);\n  }\n  getPluginByName(name: string): IVTablePlugin | undefined {\n    return Array.from(this.plugins.values()).find(plugin => plugin.name === name);\n  }\n\n  _bindTableEventForPlugin(plugin: IVTablePlugin) {\n    plugin.runTime?.forEach(runTime => {\n      this.table.on(runTime, (...args) => {\n        plugin.run?.(...args, runTime, this.table);\n      });\n    });\n  }\n\n  // 更新所有插件\n  updatePlugins(plugins?: IVTablePlugin[]): void {\n    // 先找到plugins中没有，但this.plugins中有，也就是已经被移除的插件\n    const removedPlugins = Array.from(this.plugins.values()).filter(plugin => !plugins?.some(p => p.id === plugin.id));\n    removedPlugins.forEach(plugin => {\n      this.release();\n      this.plugins.delete(plugin.id);\n    });\n    // 更新插件\n    this.plugins.forEach(plugin => {\n      if (plugin.update) {\n        plugin.update();\n      }\n    });\n    // 添加新插件\n    const addedPlugins = plugins?.filter(plugin => !this.plugins.has(plugin.id));\n    addedPlugins?.forEach(plugin => {\n      this.register(plugin);\n      this._bindTableEventForPlugin(plugin);\n    });\n  }\n  release() {\n    this.plugins.forEach(plugin => {\n      plugin.release?.(this.table);\n    });\n  }\n}\n"]}