{"version":3,"sources":["../src/layout/chart-helper/get-axis-domain.ts"],"names":[],"mappings":"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","file":"get-axis-domain.js","sourcesContent":["import { LinearScale, LogScale, SymlogScale } from '@visactor/vscale';\nimport { isFunction, isNil, isNumber, isValid } from '@visactor/vutils';\nimport { THEME_CONSTANTS } from '../../components/axis/get-axis-attributes';\n\nconst DEFAULT_CONTINUOUS_TICK_COUNT = 5;\n/**\n * @description: get axis nice domain and tick label text\n * @param {number} min\n * @param {number} max\n * @param {ITableAxisOption} axisOption\n * @return {*}\n */\nexport function getAxisDomainRangeAndLabels(\n  min: number,\n  max: number,\n  axisOption: any,\n  isZeroAlign: boolean,\n  axisLength: number,\n  // skipTick?: boolean,\n  target?: {\n    targetTicks: number[];\n    targetRange: { min: number; max: number };\n  }\n) {\n  if (axisOption?.zero) {\n    min = Math.min(min, 0);\n    max = Math.max(max, 0);\n  }\n  if (axisOption?.expand) {\n    const domainMin = min;\n    const domainMax = max;\n    if (isValid(axisOption.expand.min)) {\n      min = domainMin - (domainMax - domainMin) * axisOption.expand.min;\n    }\n    if (isValid(axisOption.expand.max)) {\n      max = domainMax + (domainMax - domainMin) * axisOption.expand.max;\n    }\n  }\n  if (isNumber(axisOption?.min)) {\n    min = axisOption.min;\n  }\n  if (isNumber(axisOption?.max)) {\n    max = axisOption.max;\n  }\n\n  let scale;\n  if (axisOption?.type === 'log') {\n    scale = new LogScale();\n    scale.base(axisOption?.base ?? 10);\n  } else if (axisOption?.type === 'symlog') {\n    scale = new SymlogScale();\n    scale.constant(axisOption?.constant ?? 10);\n  } else {\n    scale = new LinearScale();\n  }\n  scale.domain([min, max], !!axisOption?.nice);\n\n  if (target) {\n    forceTickCountNice(scale as LinearScale, target);\n  } else if (axisOption?.nice) {\n    let tickCount = axisOption.tick?.forceTickCount ?? axisOption.tick?.tickCount ?? 10;\n    if (isFunction(tickCount)) {\n      tickCount = tickCount({\n        axisLength,\n        labelStyle: axisOption?.label?.style ?? {\n          fontSize: THEME_CONSTANTS.LABEL_FONT_SIZE\n        }\n      });\n    }\n    // 如果配置了精度优先，那么最低是10\n    // 否则就直接使用tickCount即可\n    if (axisOption.niceType === 'accurateFirst') {\n      tickCount = Math.max(10, tickCount);\n    }\n    if (isNil(axisOption.min) && isNil(axisOption.max)) {\n      scale.nice(tickCount);\n    } else if (isValid(axisOption.min) && isNil(axisOption.max)) {\n      scale.niceMax(tickCount);\n    } else if (isNil(axisOption.min) && isValid(axisOption.max)) {\n      scale.niceMin(tickCount);\n    }\n  }\n\n  delete (scale as any)._niceType; // ensure scaleTicks consistent in `measurement`, `component label` and `chart`\n  let scaleTicks;\n\n  if (target?.targetTicks?.length ?? axisOption?.tick?.forceTickCount) {\n    scaleTicks = scale.forceTicks(target?.targetTicks?.length ?? axisOption?.tick?.forceTickCount);\n  } else {\n    scaleTicks = scale.ticks(\n      isNumber(axisOption?.tick?.tickCount) ? axisOption.tick.tickCount : DEFAULT_CONTINUOUS_TICK_COUNT,\n      {\n        noDecimals: axisOption?.tick?.noDecimals\n      }\n    );\n  }\n\n  return {\n    range: scale.domain(),\n    ticks: scaleTicks\n  };\n}\n\nfunction forceTickCountNice(\n  scale: LinearScale,\n  target: {\n    targetTicks: number[];\n    targetRange: { min: number; max: number };\n  }\n) {\n  scale.niceMax(target.targetTicks.length);\n\n  // to do: nice new ticks\n}\n\nexport type GetAxisDomainRangeAndLabels = typeof getAxisDomainRangeAndLabels;\n"]}