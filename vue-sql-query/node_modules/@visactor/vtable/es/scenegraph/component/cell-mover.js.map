{"version":3,"sources":["../src/scenegraph/component/cell-mover.ts"],"names":[],"mappings":"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","file":"cell-mover.js","sourcesContent":["import type { ILine, IRect, ISymbol } from './../../vrender';\nimport { createLine, createRect, createSymbol } from './../../vrender';\nimport { getCellMergeInfo } from '../utils/get-cell-merge';\nimport type { Group } from '../graphic/group';\nimport type { BaseTableAPI } from '../../ts-types/base-table';\nimport type { SimpleHeaderLayoutMap } from '../../layout';\n\nexport class CellMover {\n  columnMoverLabel: ISymbol;\n  columnMoverLine: ILine;\n  columnMoverBack: IRect;\n  table: BaseTableAPI;\n  x?: number;\n\n  constructor(table: BaseTableAPI) {\n    const columnMoverLineWidth = table.theme.dragHeaderSplitLine.lineWidth;\n    const columnMoverLineColor = table.theme.dragHeaderSplitLine.lineColor;\n    const columnMoverShadowBlockColor = table.theme.dragHeaderSplitLine.shadowBlockColor;\n\n    this.columnMoverLabel = createSymbol({\n      visible: false,\n      pickable: false,\n      x: 0,\n      y: 0,\n      symbolType: 'triangle',\n      fill: columnMoverLineColor as string\n    });\n    this.columnMoverLine = createLine({\n      visible: false,\n      pickable: false,\n      stroke: columnMoverLineColor as string,\n      lineWidth: columnMoverLineWidth as number,\n      x: 0,\n      y: 0,\n      points: [\n        { x: 0, y: 0 },\n        { x: 0, y: 0 }\n      ]\n    });\n\n    // 列顺序调整阴影块\n    this.columnMoverBack = createRect({\n      visible: false,\n      pickable: false,\n      fill: columnMoverShadowBlockColor,\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    });\n\n    this.table = table;\n  }\n\n  appand(parent: Group) {\n    parent.appendChild(this.columnMoverLabel);\n    parent.appendChild(this.columnMoverLine);\n    parent.appendChild(this.columnMoverBack);\n  }\n\n  show(col: number, row: number, delta: number) {\n    const cellLocation = this.table.getCellLocation(col, row);\n    const mergeInfo = getCellMergeInfo(this.table, col, row);\n    if (mergeInfo) {\n      col = mergeInfo.start.col;\n      row = mergeInfo.start.row;\n    }\n\n    let rectX = 0;\n    let rectY = 0;\n    let rectWidth = 0;\n    let rectHeight = 0;\n    let rectDx = 0;\n    let rectDy = 0;\n    let symbolX = 0;\n    let symbolY = 0;\n    let symbolRotate = Math.PI;\n    const linePoints: { x: number; y: number }[] = [];\n    if (cellLocation === 'columnHeader') {\n      rectX = this.table.getColsWidth(0, col - 1) - this.table.stateManager.scroll.horizontalBarPos;\n      rectY = this.table.getRowsHeight(0, this.table.frozenRowCount - 1);\n      rectHeight = this.table.tableNoFrameHeight;\n      if (mergeInfo) {\n        rectWidth = this.table.getColsWidth(mergeInfo.start.col, mergeInfo.end.col);\n      } else {\n        rectWidth = this.table.getColWidth(col);\n      }\n      rectDx = rectX - delta;\n\n      symbolX = rectX + rectWidth;\n      symbolY = 2;\n\n      linePoints.push({ x: 0, y: 0 });\n      linePoints.push({ x: 0, y: this.table.tableNoFrameHeight });\n    } else if (\n      cellLocation === 'rowHeader' ||\n      (this.table.internalProps.layoutMap as SimpleHeaderLayoutMap).isSeriesNumberInBody(col, row)\n    ) {\n      rectY = this.table.getRowsHeight(0, row - 1) - this.table.stateManager.scroll.verticalBarPos;\n      rectX = this.table.getColsWidth(0, this.table.frozenColCount - 1);\n      rectWidth = this.table.tableNoFrameWidth;\n      if (mergeInfo) {\n        rectHeight = this.table.getRowsHeight(mergeInfo.start.row, mergeInfo.end.row);\n      } else {\n        rectHeight = this.table.getRowHeight(row);\n      }\n      rectDy = rectY - delta;\n\n      symbolX = 2;\n      symbolY = rectY + rectHeight;\n      symbolRotate = Math.PI / 2;\n\n      linePoints.push({ x: 0, y: 0 });\n      linePoints.push({ x: this.table.tableNoFrameWidth, y: 0 });\n    }\n\n    this.columnMoverBack.setAttributes({\n      visible: true,\n      x: rectX - rectDx,\n      y: rectY - rectDy,\n      width: rectWidth,\n      height: rectHeight,\n      dx: rectDx,\n      dy: rectDy\n    });\n    this.columnMoverLine.setAttributes({\n      x: symbolX,\n      y: symbolY,\n      visible: true,\n      points: linePoints\n    });\n    this.columnMoverLabel.setAttributes({\n      visible: true,\n      x: symbolX,\n      y: symbolY,\n      angle: symbolRotate\n    });\n    return {\n      backX: rectX - rectDx,\n      lineX: symbolX,\n      backY: rectY - rectDy,\n      lineY: symbolY\n    };\n  }\n\n  hide() {\n    this.columnMoverLabel.setAttribute('visible', false);\n    this.columnMoverLine.setAttribute('visible', false);\n    this.columnMoverBack.setAttribute('visible', false);\n  }\n\n  update(backX: number | undefined, lineX: number | undefined, backY: number | undefined, lineY: number | undefined) {\n    if (typeof backX === 'number' && typeof lineX === 'number') {\n      this.columnMoverLabel.setAttribute('x', lineX);\n      this.columnMoverLine.setAttribute('x', lineX);\n      this.columnMoverBack.setAttribute('x', backX);\n    } else if (typeof backY === 'number' && typeof lineY === 'number') {\n      this.columnMoverLabel.setAttribute('y', lineY);\n      this.columnMoverLine.setAttribute('y', lineY);\n      this.columnMoverBack.setAttribute('y', backY);\n    }\n  }\n\n  updateStyle() {\n    const columnMoverLineWidth = this.table.theme.dragHeaderSplitLine.lineWidth;\n    const columnMoverLineColor = this.table.theme.dragHeaderSplitLine.lineColor;\n    const columnMoverShadowBlockColor = this.table.theme.dragHeaderSplitLine.shadowBlockColor;\n\n    this.columnMoverLabel.setAttributes({\n      fill: columnMoverLineColor as string\n    });\n    this.columnMoverLine.setAttributes({\n      stroke: columnMoverLineColor as string,\n      lineWidth: columnMoverLineWidth as number\n    });\n\n    // 列顺序调整阴影块\n    this.columnMoverBack.setAttributes({\n      fill: columnMoverShadowBlockColor\n    });\n  }\n}\n"]}