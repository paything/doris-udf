{"version":3,"sources":["../src/components/legend/continue-legend/continue-legend.ts"],"names":[],"mappings":"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","file":"continue-legend.js","sourcesContent":["import { cloneDeep, get, merge } from '@visactor/vutils';\nimport type { IColorTableLegendOption, ISizeTableLegendOption } from '../../../ts-types/component/legend';\nimport type { BaseTableAPI } from '../../../ts-types/base-table';\nimport { ColorContinuousLegend, SizeContinuousLegend, LegendEvent } from './../../../vrender';\nimport { getContinuousLegendAttributes } from './get-continue-legend-attributes';\nimport { TABLE_EVENT_TYPE } from '../../../core/TABLE_EVENT_TYPE';\nimport { getQuadProps } from '../../../scenegraph/utils/padding';\nimport type { IOrientType } from '../../../ts-types/component/util';\n\nexport class ContinueTableLegend {\n  table: BaseTableAPI;\n  option: IColorTableLegendOption | ISizeTableLegendOption;\n  orient: IOrientType;\n  visible: boolean;\n  position: 'start' | 'middle' | 'end';\n  selectedData: (string | number)[];\n  legendComponent: ColorContinuousLegend | SizeContinuousLegend;\n\n  constructor(option: IColorTableLegendOption | ISizeTableLegendOption, table: BaseTableAPI) {\n    this.table = table;\n    this.option = cloneDeep(option);\n    this.orient = option.orient ?? 'left';\n    this.visible = option.visible ?? true;\n    this.position = option.position ?? 'middle';\n    this.selectedData = option.defaultSelected ?? null;\n\n    this.createComponent();\n    this.initEvent();\n  }\n\n  createComponent() {\n    const attrs = this.getLegendAttributes({\n      width: this.table.tableNoFrameWidth,\n      height: this.table.tableNoFrameHeight\n    });\n\n    let legend;\n    if (this.option.type === 'color') {\n      legend = new ColorContinuousLegend(\n        merge({}, attrs, {\n          slidable: true\n          // defaultSelected: this.selectedData\n        })\n      );\n    } else {\n      legend = new SizeContinuousLegend(\n        merge({}, attrs, {\n          slidable: true\n          // defaultSelected: this.selectedData\n        })\n      );\n    }\n    legend.name = 'legend';\n    this.legendComponent = legend;\n    if (this.visible === false) {\n      legend.setAttributes({\n        visible: false,\n        visibleAll: false\n      });\n      legend.hideAll();\n    }\n    this.table.scenegraph.stage.defaultLayer.appendChild(legend);\n\n    this.adjustTableSize(attrs);\n  }\n\n  resize() {\n    if (!this.legendComponent || this.visible === false) {\n      return;\n    }\n\n    this.legendComponent.setAttributes({\n      width: this.table.tableNoFrameWidth,\n      height: this.table.tableNoFrameHeight\n    });\n\n    this.adjustTableSize(this.legendComponent.attribute);\n  }\n\n  adjustTableSize(attrs: any) {\n    if (!this.legendComponent || this.visible === false) {\n      return;\n    }\n    // 调整位置\n    let width = isFinite(this.legendComponent.AABBBounds.width()) ? this.legendComponent.AABBBounds.width() : 0;\n    let height = isFinite(this.legendComponent.AABBBounds.height()) ? this.legendComponent.AABBBounds.height() : 0;\n    if (width <= 0 || height <= 0) {\n      return;\n    }\n    const rectWidth = this.table.tableNoFrameWidth;\n    const rectHeight = this.table.tableNoFrameHeight;\n    const padding = getQuadProps(attrs.padding ?? this.option.padding ?? 10);\n\n    let x = 0;\n    let y = 0;\n    if (this.orient === 'left') {\n      x = padding[3];\n      y = 0;\n      width += padding[1] + padding[3];\n    } else if (this.orient === 'top') {\n      x = 0;\n      y = padding[0];\n      height += padding[0] + padding[2];\n    } else if (this.orient === 'right') {\n      x = rectWidth - width - padding[1];\n      y = 0;\n      width += padding[1] + padding[3];\n    } else if (this.orient === 'bottom') {\n      x = 0;\n      y = rectHeight - height - padding[2];\n      height += padding[0] + padding[2];\n    }\n\n    const layout = this.orient === 'bottom' || this.orient === 'top' ? 'horizontal' : 'vertical';\n    const position = this.position;\n    // const { width: rectWidth, height: rectHeight } = fullSpace;\n    let offsetX = 0;\n    let offsetY = 0;\n    if (layout === 'horizontal') {\n      if (position === 'middle') {\n        offsetX = (rectWidth - width) / 2;\n      } else if (position === 'end') {\n        offsetX = rectWidth - width - padding[1];\n      } else {\n        offsetX = padding[3];\n      }\n    } else {\n      if (position === 'middle') {\n        offsetY = (rectHeight - height) / 2;\n      } else if (position === 'end') {\n        offsetY = rectHeight - height - padding[2];\n      } else {\n        offsetY = padding[0];\n      }\n    }\n\n    this.legendComponent.setAttributes({\n      dx: offsetX,\n      dy: offsetY,\n      x,\n      y\n    });\n\n    // update table size\n    if (this.orient === 'left') {\n      this.table.tableNoFrameWidth = this.table.tableNoFrameWidth - Math.ceil(width);\n      this.table.tableX += Math.ceil(width);\n    } else if (this.orient === 'top') {\n      this.table.tableNoFrameHeight = this.table.tableNoFrameHeight - Math.ceil(height);\n      this.table.tableY += Math.ceil(height);\n    } else if (this.orient === 'right') {\n      this.table.tableNoFrameWidth = this.table.tableNoFrameWidth - Math.ceil(width);\n    } else if (this.orient === 'bottom') {\n      this.table.tableNoFrameHeight = this.table.tableNoFrameHeight - Math.ceil(height);\n    }\n  }\n\n  getLegendAttributes(rect: any) {\n    const layout = this.orient === 'bottom' || this.orient === 'top' ? 'horizontal' : 'vertical';\n    const align = layout === 'horizontal' ? 'bottom' : this.orient;\n\n    const attrs = {\n      ...getContinuousLegendAttributes(this.option, rect),\n      layout,\n      align,\n      // zIndex: this.layoutZIndex,\n      min: this.option.min,\n      max: this.option.max,\n      value: this.option.value,\n      [this.option.type === 'color' ? 'colors' : 'sizeRange']:\n        this.option.type === 'color'\n          ? (this.option as IColorTableLegendOption).colors\n          : (this.option as ISizeTableLegendOption).sizeRange\n    };\n    return attrs;\n  }\n\n  initEvent() {\n    if (this.legendComponent) {\n      this.legendComponent.addEventListener('change', (e: any) => {\n        const selectedData = get(e, 'detail.value');\n        this.table.fireListeners(TABLE_EVENT_TYPE.LEGEND_CHANGE, { model: this, value: selectedData, event: e });\n        this.table.scenegraph.updateNextFrame();\n      });\n    }\n  }\n\n  getLegendBounds() {\n    const width = isFinite(this.legendComponent.AABBBounds.width()) ? this.legendComponent.AABBBounds.width() : 0;\n    const height = isFinite(this.legendComponent.AABBBounds.height()) ? this.legendComponent.AABBBounds.height() : 0;\n\n    return {\n      width: width,\n      height: height\n    };\n  }\n  release() {\n    this.legendComponent && this.table.scenegraph.stage.defaultLayer.removeChild(this.legendComponent);\n    this.legendComponent = null;\n  }\n}\n"]}